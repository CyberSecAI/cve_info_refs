=== Content from git.kernel.org_f3295b34_20250114_203355.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=69548bb663fcb63f9ee0301be808a36b9d78dac3)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=69548bb663fcb63f9ee0301be808a36b9d78dac3)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=69548bb663fcb63f9ee0301be808a36b9d78dac3)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=69548bb663fcb63f9ee0301be808a36b9d78dac3)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ryusuke Konishi <konishi.ryusuke@gmail.com> | 2024-10-20 13:51:28 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:25:54 +0100 |
| commit | [69548bb663fcb63f9ee0301be808a36b9d78dac3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=69548bb663fcb63f9ee0301be808a36b9d78dac3) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=69548bb663fcb63f9ee0301be808a36b9d78dac3)) | |
| tree | [b209b34ab3a78cb0bb26dd35eb1ebdbd1ddd8a5c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=69548bb663fcb63f9ee0301be808a36b9d78dac3) | |
| parent | [7a59817f68e79658c1c8f78fe73e0c42a4061284](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7a59817f68e79658c1c8f78fe73e0c42a4061284) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=69548bb663fcb63f9ee0301be808a36b9d78dac3&id2=7a59817f68e79658c1c8f78fe73e0c42a4061284)) | |
| download | [linux-69548bb663fcb63f9ee0301be808a36b9d78dac3.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-69548bb663fcb63f9ee0301be808a36b9d78dac3.tar.gz) | |

nilfs2: fix potential deadlock with newly created symlinkscommit b3a033e3ecd3471248d474ef263aadc0059e516a upstream.
Syzbot reported that page\_symlink(), called by nilfs\_symlink(), triggers
memory reclamation involving the filesystem layer, which can result in
circular lock dependencies among the reader/writer semaphore
nilfs->ns\_segctor\_sem, s\_writers percpu\_rwsem (intwrite) and the
fs\_reclaim pseudo lock.
This is because after commit 21fc61c73c39 ("don't put symlink bodies in
pagecache into highmem"), the gfp flags of the page cache for symbolic
links are overwritten to GFP\_KERNEL via inode\_nohighmem().
This is not a problem for symlinks read from the backing device, because
the \_\_GFP\_FS flag is dropped after inode\_nohighmem() is called. However,
when a new symlink is created with nilfs\_symlink(), the gfp flags remain
overwritten to GFP\_KERNEL. Then, memory allocation called from
page\_symlink() etc. triggers memory reclamation including the FS layer,
which may call nilfs\_evict\_inode() or nilfs\_dirty\_inode(). And these can
cause a deadlock if they are called while nilfs->ns\_segctor\_sem is held:
Fix this issue by dropping the \_\_GFP\_FS flag from the page cache GFP flags
of newly created symlinks in the same way that nilfs\_new\_inode() and
\_\_nilfs\_read\_inode() do, as a workaround until we adopt nofs allocation
scope consistently or improve the locking constraints.
Link: [https://lkml.kernel.org/r/20241020050003.4308-1-konishi.ryusuke@gmail.com](https://lkml.kernel.org/r/20241020050003.4308-1-konishi.ryusuke%40gmail.com)
Fixes: 21fc61c73c39 ("don't put symlink bodies in pagecache into highmem")
Signed-off-by: Ryusuke Konishi <konishi.ryusuke@gmail.com>
Reported-by: syzbot+9ef37ac20608f4836256@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=9ef37ac20608f4836256
Tested-by: syzbot+9ef37ac20608f4836256@syzkaller.appspotmail.com
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=69548bb663fcb63f9ee0301be808a36b9d78dac3)

| -rw-r--r-- | [fs/nilfs2/namei.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nilfs2/namei.c?id=69548bb663fcb63f9ee0301be808a36b9d78dac3) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 0 deletions

| diff --git a/fs/nilfs2/namei.c b/fs/nilfs2/namei.cindex af3a74bd0fbd48..e7596701f14fe7 100644--- a/[fs/nilfs2/namei.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/namei.c?id=7a59817f68e79658c1c8f78fe73e0c42a4061284)+++ b/[fs/nilfs2/namei.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/namei.c?id=69548bb663fcb63f9ee0301be808a36b9d78dac3)@@ -157,6 +157,9 @@ static int nilfs\_symlink(struct user\_namespace \*mnt\_userns, struct inode \*dir, /\* slow symlink \*/ inode->i\_op = &nilfs\_symlink\_inode\_operations; inode\_nohighmem(inode);+ mapping\_set\_gfp\_mask(inode->i\_mapping,+ mapping\_gfp\_constraint(inode->i\_mapping,+ ~\_\_GFP\_FS)); inode->i\_mapping->a\_ops = &nilfs\_aops; err = page\_symlink(inode, symname, l); if (err) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:32:32 +0000



=== Content from git.kernel.org_c0913972_20250114_203355.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=58c7f44c7b9e5ac7e3b1e5da2572ed7767a12f38)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=58c7f44c7b9e5ac7e3b1e5da2572ed7767a12f38)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=58c7f44c7b9e5ac7e3b1e5da2572ed7767a12f38)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=58c7f44c7b9e5ac7e3b1e5da2572ed7767a12f38)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ryusuke Konishi <konishi.ryusuke@gmail.com> | 2024-10-20 13:51:28 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:26:45 +0100 |
| commit | [58c7f44c7b9e5ac7e3b1e5da2572ed7767a12f38](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=58c7f44c7b9e5ac7e3b1e5da2572ed7767a12f38) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=58c7f44c7b9e5ac7e3b1e5da2572ed7767a12f38)) | |
| tree | [e126ef11fa903a9cfb067b98617c4c95b2ce8791](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=58c7f44c7b9e5ac7e3b1e5da2572ed7767a12f38) | |
| parent | [55d01b652e7492a0ba61f02c5a9cc82b4848235c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=55d01b652e7492a0ba61f02c5a9cc82b4848235c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=58c7f44c7b9e5ac7e3b1e5da2572ed7767a12f38&id2=55d01b652e7492a0ba61f02c5a9cc82b4848235c)) | |
| download | [linux-58c7f44c7b9e5ac7e3b1e5da2572ed7767a12f38.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-58c7f44c7b9e5ac7e3b1e5da2572ed7767a12f38.tar.gz) | |

nilfs2: fix potential deadlock with newly created symlinkscommit b3a033e3ecd3471248d474ef263aadc0059e516a upstream.
Syzbot reported that page\_symlink(), called by nilfs\_symlink(), triggers
memory reclamation involving the filesystem layer, which can result in
circular lock dependencies among the reader/writer semaphore
nilfs->ns\_segctor\_sem, s\_writers percpu\_rwsem (intwrite) and the
fs\_reclaim pseudo lock.
This is because after commit 21fc61c73c39 ("don't put symlink bodies in
pagecache into highmem"), the gfp flags of the page cache for symbolic
links are overwritten to GFP\_KERNEL via inode\_nohighmem().
This is not a problem for symlinks read from the backing device, because
the \_\_GFP\_FS flag is dropped after inode\_nohighmem() is called. However,
when a new symlink is created with nilfs\_symlink(), the gfp flags remain
overwritten to GFP\_KERNEL. Then, memory allocation called from
page\_symlink() etc. triggers memory reclamation including the FS layer,
which may call nilfs\_evict\_inode() or nilfs\_dirty\_inode(). And these can
cause a deadlock if they are called while nilfs->ns\_segctor\_sem is held:
Fix this issue by dropping the \_\_GFP\_FS flag from the page cache GFP flags
of newly created symlinks in the same way that nilfs\_new\_inode() and
\_\_nilfs\_read\_inode() do, as a workaround until we adopt nofs allocation
scope consistently or improve the locking constraints.
Link: [https://lkml.kernel.org/r/20241020050003.4308-1-konishi.ryusuke@gmail.com](https://lkml.kernel.org/r/20241020050003.4308-1-konishi.ryusuke%40gmail.com)
Fixes: 21fc61c73c39 ("don't put symlink bodies in pagecache into highmem")
Signed-off-by: Ryusuke Konishi <konishi.ryusuke@gmail.com>
Reported-by: syzbot+9ef37ac20608f4836256@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=9ef37ac20608f4836256
Tested-by: syzbot+9ef37ac20608f4836256@syzkaller.appspotmail.com
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=58c7f44c7b9e5ac7e3b1e5da2572ed7767a12f38)

| -rw-r--r-- | [fs/nilfs2/namei.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nilfs2/namei.c?id=58c7f44c7b9e5ac7e3b1e5da2572ed7767a12f38) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 0 deletions

| diff --git a/fs/nilfs2/namei.c b/fs/nilfs2/namei.cindex 180e1ce42d21ea..ffaca278acd3cb 100644--- a/[fs/nilfs2/namei.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/namei.c?id=55d01b652e7492a0ba61f02c5a9cc82b4848235c)+++ b/[fs/nilfs2/namei.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/namei.c?id=58c7f44c7b9e5ac7e3b1e5da2572ed7767a12f38)@@ -157,6 +157,9 @@ static int nilfs\_symlink(struct user\_namespace \*mnt\_userns, struct inode \*dir, /\* slow symlink \*/ inode->i\_op = &nilfs\_symlink\_inode\_operations; inode\_nohighmem(inode);+ mapping\_set\_gfp\_mask(inode->i\_mapping,+ mapping\_gfp\_constraint(inode->i\_mapping,+ ~\_\_GFP\_FS)); inode->i\_mapping->a\_ops = &nilfs\_aops; err = page\_symlink(inode, symname, l); if (err) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:32:32 +0000



=== Content from git.kernel.org_b994e7fc_20250114_203356.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9aa5d43ac4cace8fb9bd964ff6c23f599dc3cd24)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9aa5d43ac4cace8fb9bd964ff6c23f599dc3cd24)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9aa5d43ac4cace8fb9bd964ff6c23f599dc3cd24)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9aa5d43ac4cace8fb9bd964ff6c23f599dc3cd24)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ryusuke Konishi <konishi.ryusuke@gmail.com> | 2024-10-20 13:51:28 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:30:55 +0100 |
| commit | [9aa5d43ac4cace8fb9bd964ff6c23f599dc3cd24](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9aa5d43ac4cace8fb9bd964ff6c23f599dc3cd24) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9aa5d43ac4cace8fb9bd964ff6c23f599dc3cd24)) | |
| tree | [3a9a26a19d04b0dc6d1c812146eff70101cd43ec](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9aa5d43ac4cace8fb9bd964ff6c23f599dc3cd24) | |
| parent | [56c6171932a7fb267ac6cb4ff8759b93ee1d0e2e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=56c6171932a7fb267ac6cb4ff8759b93ee1d0e2e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9aa5d43ac4cace8fb9bd964ff6c23f599dc3cd24&id2=56c6171932a7fb267ac6cb4ff8759b93ee1d0e2e)) | |
| download | [linux-9aa5d43ac4cace8fb9bd964ff6c23f599dc3cd24.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9aa5d43ac4cace8fb9bd964ff6c23f599dc3cd24.tar.gz) | |

nilfs2: fix potential deadlock with newly created symlinkscommit b3a033e3ecd3471248d474ef263aadc0059e516a upstream.
Syzbot reported that page\_symlink(), called by nilfs\_symlink(), triggers
memory reclamation involving the filesystem layer, which can result in
circular lock dependencies among the reader/writer semaphore
nilfs->ns\_segctor\_sem, s\_writers percpu\_rwsem (intwrite) and the
fs\_reclaim pseudo lock.
This is because after commit 21fc61c73c39 ("don't put symlink bodies in
pagecache into highmem"), the gfp flags of the page cache for symbolic
links are overwritten to GFP\_KERNEL via inode\_nohighmem().
This is not a problem for symlinks read from the backing device, because
the \_\_GFP\_FS flag is dropped after inode\_nohighmem() is called. However,
when a new symlink is created with nilfs\_symlink(), the gfp flags remain
overwritten to GFP\_KERNEL. Then, memory allocation called from
page\_symlink() etc. triggers memory reclamation including the FS layer,
which may call nilfs\_evict\_inode() or nilfs\_dirty\_inode(). And these can
cause a deadlock if they are called while nilfs->ns\_segctor\_sem is held:
Fix this issue by dropping the \_\_GFP\_FS flag from the page cache GFP flags
of newly created symlinks in the same way that nilfs\_new\_inode() and
\_\_nilfs\_read\_inode() do, as a workaround until we adopt nofs allocation
scope consistently or improve the locking constraints.
Link: [https://lkml.kernel.org/r/20241020050003.4308-1-konishi.ryusuke@gmail.com](https://lkml.kernel.org/r/20241020050003.4308-1-konishi.ryusuke%40gmail.com)
Fixes: 21fc61c73c39 ("don't put symlink bodies in pagecache into highmem")
Signed-off-by: Ryusuke Konishi <konishi.ryusuke@gmail.com>
Reported-by: syzbot+9ef37ac20608f4836256@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=9ef37ac20608f4836256
Tested-by: syzbot+9ef37ac20608f4836256@syzkaller.appspotmail.com
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9aa5d43ac4cace8fb9bd964ff6c23f599dc3cd24)

| -rw-r--r-- | [fs/nilfs2/namei.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nilfs2/namei.c?id=9aa5d43ac4cace8fb9bd964ff6c23f599dc3cd24) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 0 deletions

| diff --git a/fs/nilfs2/namei.c b/fs/nilfs2/namei.cindex 4905063790c578..9b108052d9f71f 100644--- a/[fs/nilfs2/namei.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/namei.c?id=56c6171932a7fb267ac6cb4ff8759b93ee1d0e2e)+++ b/[fs/nilfs2/namei.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/namei.c?id=9aa5d43ac4cace8fb9bd964ff6c23f599dc3cd24)@@ -157,6 +157,9 @@ static int nilfs\_symlink(struct mnt\_idmap \*idmap, struct inode \*dir, /\* slow symlink \*/ inode->i\_op = &nilfs\_symlink\_inode\_operations; inode\_nohighmem(inode);+ mapping\_set\_gfp\_mask(inode->i\_mapping,+ mapping\_gfp\_constraint(inode->i\_mapping,+ ~\_\_GFP\_FS)); inode->i\_mapping->a\_ops = &nilfs\_aops; err = page\_symlink(inode, symname, l); if (err) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:32:33 +0000



=== Content from git.kernel.org_20a68b00_20250114_203358.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=cc38c596e648575ce58bfc31623a6506eda4b94a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cc38c596e648575ce58bfc31623a6506eda4b94a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cc38c596e648575ce58bfc31623a6506eda4b94a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cc38c596e648575ce58bfc31623a6506eda4b94a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ryusuke Konishi <konishi.ryusuke@gmail.com> | 2024-10-20 13:51:28 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:19:23 +0100 |
| commit | [cc38c596e648575ce58bfc31623a6506eda4b94a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cc38c596e648575ce58bfc31623a6506eda4b94a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=cc38c596e648575ce58bfc31623a6506eda4b94a)) | |
| tree | [4cab237378d4f296ddf2e7594d5823422b8e1a85](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cc38c596e648575ce58bfc31623a6506eda4b94a) | |
| parent | [271d282ecc15d7012e71ca82c89a6c0e13a063dd](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=271d282ecc15d7012e71ca82c89a6c0e13a063dd) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cc38c596e648575ce58bfc31623a6506eda4b94a&id2=271d282ecc15d7012e71ca82c89a6c0e13a063dd)) | |
| download | [linux-cc38c596e648575ce58bfc31623a6506eda4b94a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-cc38c596e648575ce58bfc31623a6506eda4b94a.tar.gz) | |

nilfs2: fix potential deadlock with newly created symlinkscommit b3a033e3ecd3471248d474ef263aadc0059e516a upstream.
Syzbot reported that page\_symlink(), called by nilfs\_symlink(), triggers
memory reclamation involving the filesystem layer, which can result in
circular lock dependencies among the reader/writer semaphore
nilfs->ns\_segctor\_sem, s\_writers percpu\_rwsem (intwrite) and the
fs\_reclaim pseudo lock.
This is because after commit 21fc61c73c39 ("don't put symlink bodies in
pagecache into highmem"), the gfp flags of the page cache for symbolic
links are overwritten to GFP\_KERNEL via inode\_nohighmem().
This is not a problem for symlinks read from the backing device, because
the \_\_GFP\_FS flag is dropped after inode\_nohighmem() is called. However,
when a new symlink is created with nilfs\_symlink(), the gfp flags remain
overwritten to GFP\_KERNEL. Then, memory allocation called from
page\_symlink() etc. triggers memory reclamation including the FS layer,
which may call nilfs\_evict\_inode() or nilfs\_dirty\_inode(). And these can
cause a deadlock if they are called while nilfs->ns\_segctor\_sem is held:
Fix this issue by dropping the \_\_GFP\_FS flag from the page cache GFP flags
of newly created symlinks in the same way that nilfs\_new\_inode() and
\_\_nilfs\_read\_inode() do, as a workaround until we adopt nofs allocation
scope consistently or improve the locking constraints.
Link: [https://lkml.kernel.org/r/20241020050003.4308-1-konishi.ryusuke@gmail.com](https://lkml.kernel.org/r/20241020050003.4308-1-konishi.ryusuke%40gmail.com)
Fixes: 21fc61c73c39 ("don't put symlink bodies in pagecache into highmem")
Signed-off-by: Ryusuke Konishi <konishi.ryusuke@gmail.com>
Reported-by: syzbot+9ef37ac20608f4836256@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=9ef37ac20608f4836256
Tested-by: syzbot+9ef37ac20608f4836256@syzkaller.appspotmail.com
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cc38c596e648575ce58bfc31623a6506eda4b94a)

| -rw-r--r-- | [fs/nilfs2/namei.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nilfs2/namei.c?id=cc38c596e648575ce58bfc31623a6506eda4b94a) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 0 deletions

| diff --git a/fs/nilfs2/namei.c b/fs/nilfs2/namei.cindex 08c6d985edeb6f..eeccd69cd79743 100644--- a/[fs/nilfs2/namei.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/namei.c?id=271d282ecc15d7012e71ca82c89a6c0e13a063dd)+++ b/[fs/nilfs2/namei.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/namei.c?id=cc38c596e648575ce58bfc31623a6506eda4b94a)@@ -156,6 +156,9 @@ static int nilfs\_symlink(struct inode \*dir, struct dentry \*dentry, /\* slow symlink \*/ inode->i\_op = &nilfs\_symlink\_inode\_operations; inode\_nohighmem(inode);+ mapping\_set\_gfp\_mask(inode->i\_mapping,+ mapping\_gfp\_constraint(inode->i\_mapping,+ ~\_\_GFP\_FS)); inode->i\_mapping->a\_ops = &nilfs\_aops; err = page\_symlink(inode, symname, l); if (err) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:32:35 +0000



=== Content from git.kernel.org_d168affd_20250114_203357.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c72e0df0b56c1166736dc8eb62070ebb12591447)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c72e0df0b56c1166736dc8eb62070ebb12591447)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c72e0df0b56c1166736dc8eb62070ebb12591447)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c72e0df0b56c1166736dc8eb62070ebb12591447)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ryusuke Konishi <konishi.ryusuke@gmail.com> | 2024-10-20 13:51:28 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:22:03 +0100 |
| commit | [c72e0df0b56c1166736dc8eb62070ebb12591447](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c72e0df0b56c1166736dc8eb62070ebb12591447) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c72e0df0b56c1166736dc8eb62070ebb12591447)) | |
| tree | [1b108ec2c832b33b7d606c40493f453551b6441b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c72e0df0b56c1166736dc8eb62070ebb12591447) | |
| parent | [edc84c1c1a8541cc874abd14398da737e3f81ddc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=edc84c1c1a8541cc874abd14398da737e3f81ddc) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c72e0df0b56c1166736dc8eb62070ebb12591447&id2=edc84c1c1a8541cc874abd14398da737e3f81ddc)) | |
| download | [linux-c72e0df0b56c1166736dc8eb62070ebb12591447.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c72e0df0b56c1166736dc8eb62070ebb12591447.tar.gz) | |

nilfs2: fix potential deadlock with newly created symlinkscommit b3a033e3ecd3471248d474ef263aadc0059e516a upstream.
Syzbot reported that page\_symlink(), called by nilfs\_symlink(), triggers
memory reclamation involving the filesystem layer, which can result in
circular lock dependencies among the reader/writer semaphore
nilfs->ns\_segctor\_sem, s\_writers percpu\_rwsem (intwrite) and the
fs\_reclaim pseudo lock.
This is because after commit 21fc61c73c39 ("don't put symlink bodies in
pagecache into highmem"), the gfp flags of the page cache for symbolic
links are overwritten to GFP\_KERNEL via inode\_nohighmem().
This is not a problem for symlinks read from the backing device, because
the \_\_GFP\_FS flag is dropped after inode\_nohighmem() is called. However,
when a new symlink is created with nilfs\_symlink(), the gfp flags remain
overwritten to GFP\_KERNEL. Then, memory allocation called from
page\_symlink() etc. triggers memory reclamation including the FS layer,
which may call nilfs\_evict\_inode() or nilfs\_dirty\_inode(). And these can
cause a deadlock if they are called while nilfs->ns\_segctor\_sem is held:
Fix this issue by dropping the \_\_GFP\_FS flag from the page cache GFP flags
of newly created symlinks in the same way that nilfs\_new\_inode() and
\_\_nilfs\_read\_inode() do, as a workaround until we adopt nofs allocation
scope consistently or improve the locking constraints.
Link: [https://lkml.kernel.org/r/20241020050003.4308-1-konishi.ryusuke@gmail.com](https://lkml.kernel.org/r/20241020050003.4308-1-konishi.ryusuke%40gmail.com)
Fixes: 21fc61c73c39 ("don't put symlink bodies in pagecache into highmem")
Signed-off-by: Ryusuke Konishi <konishi.ryusuke@gmail.com>
Reported-by: syzbot+9ef37ac20608f4836256@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=9ef37ac20608f4836256
Tested-by: syzbot+9ef37ac20608f4836256@syzkaller.appspotmail.com
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c72e0df0b56c1166736dc8eb62070ebb12591447)

| -rw-r--r-- | [fs/nilfs2/namei.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nilfs2/namei.c?id=c72e0df0b56c1166736dc8eb62070ebb12591447) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 0 deletions

| diff --git a/fs/nilfs2/namei.c b/fs/nilfs2/namei.cindex 08c6d985edeb6f..eeccd69cd79743 100644--- a/[fs/nilfs2/namei.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/namei.c?id=edc84c1c1a8541cc874abd14398da737e3f81ddc)+++ b/[fs/nilfs2/namei.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/namei.c?id=c72e0df0b56c1166736dc8eb62070ebb12591447)@@ -156,6 +156,9 @@ static int nilfs\_symlink(struct inode \*dir, struct dentry \*dentry, /\* slow symlink \*/ inode->i\_op = &nilfs\_symlink\_inode\_operations; inode\_nohighmem(inode);+ mapping\_set\_gfp\_mask(inode->i\_mapping,+ mapping\_gfp\_constraint(inode->i\_mapping,+ ~\_\_GFP\_FS)); inode->i\_mapping->a\_ops = &nilfs\_aops; err = page\_symlink(inode, symname, l); if (err) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:32:35 +0000



=== Content from git.kernel.org_f4c9a742_20250114_203354.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1246d86e7bbde265761932c6e2dce28c69cdcb91)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1246d86e7bbde265761932c6e2dce28c69cdcb91)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1246d86e7bbde265761932c6e2dce28c69cdcb91)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1246d86e7bbde265761932c6e2dce28c69cdcb91)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ryusuke Konishi <konishi.ryusuke@gmail.com> | 2024-10-20 13:51:28 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:28:24 +0100 |
| commit | [1246d86e7bbde265761932c6e2dce28c69cdcb91](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1246d86e7bbde265761932c6e2dce28c69cdcb91) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1246d86e7bbde265761932c6e2dce28c69cdcb91)) | |
| tree | [e4e23f9ec2ccba0883a4bb1def55819473fd9ea8](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1246d86e7bbde265761932c6e2dce28c69cdcb91) | |
| parent | [1a797936d34683411c0d7093f6bd78e9b0b2aae1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1a797936d34683411c0d7093f6bd78e9b0b2aae1) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1246d86e7bbde265761932c6e2dce28c69cdcb91&id2=1a797936d34683411c0d7093f6bd78e9b0b2aae1)) | |
| download | [linux-1246d86e7bbde265761932c6e2dce28c69cdcb91.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1246d86e7bbde265761932c6e2dce28c69cdcb91.tar.gz) | |

nilfs2: fix potential deadlock with newly created symlinkscommit b3a033e3ecd3471248d474ef263aadc0059e516a upstream.
Syzbot reported that page\_symlink(), called by nilfs\_symlink(), triggers
memory reclamation involving the filesystem layer, which can result in
circular lock dependencies among the reader/writer semaphore
nilfs->ns\_segctor\_sem, s\_writers percpu\_rwsem (intwrite) and the
fs\_reclaim pseudo lock.
This is because after commit 21fc61c73c39 ("don't put symlink bodies in
pagecache into highmem"), the gfp flags of the page cache for symbolic
links are overwritten to GFP\_KERNEL via inode\_nohighmem().
This is not a problem for symlinks read from the backing device, because
the \_\_GFP\_FS flag is dropped after inode\_nohighmem() is called. However,
when a new symlink is created with nilfs\_symlink(), the gfp flags remain
overwritten to GFP\_KERNEL. Then, memory allocation called from
page\_symlink() etc. triggers memory reclamation including the FS layer,
which may call nilfs\_evict\_inode() or nilfs\_dirty\_inode(). And these can
cause a deadlock if they are called while nilfs->ns\_segctor\_sem is held:
Fix this issue by dropping the \_\_GFP\_FS flag from the page cache GFP flags
of newly created symlinks in the same way that nilfs\_new\_inode() and
\_\_nilfs\_read\_inode() do, as a workaround until we adopt nofs allocation
scope consistently or improve the locking constraints.
Link: [https://lkml.kernel.org/r/20241020050003.4308-1-konishi.ryusuke@gmail.com](https://lkml.kernel.org/r/20241020050003.4308-1-konishi.ryusuke%40gmail.com)
Fixes: 21fc61c73c39 ("don't put symlink bodies in pagecache into highmem")
Signed-off-by: Ryusuke Konishi <konishi.ryusuke@gmail.com>
Reported-by: syzbot+9ef37ac20608f4836256@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=9ef37ac20608f4836256
Tested-by: syzbot+9ef37ac20608f4836256@syzkaller.appspotmail.com
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1246d86e7bbde265761932c6e2dce28c69cdcb91)

| -rw-r--r-- | [fs/nilfs2/namei.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nilfs2/namei.c?id=1246d86e7bbde265761932c6e2dce28c69cdcb91) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 0 deletions

| diff --git a/fs/nilfs2/namei.c b/fs/nilfs2/namei.cindex 9f9b0762ff6901..7f71aa354f3643 100644--- a/[fs/nilfs2/namei.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/namei.c?id=1a797936d34683411c0d7093f6bd78e9b0b2aae1)+++ b/[fs/nilfs2/namei.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/namei.c?id=1246d86e7bbde265761932c6e2dce28c69cdcb91)@@ -157,6 +157,9 @@ static int nilfs\_symlink(struct mnt\_idmap \*idmap, struct inode \*dir, /\* slow symlink \*/ inode->i\_op = &nilfs\_symlink\_inode\_operations; inode\_nohighmem(inode);+ mapping\_set\_gfp\_mask(inode->i\_mapping,+ mapping\_gfp\_constraint(inode->i\_mapping,+ ~\_\_GFP\_FS)); inode->i\_mapping->a\_ops = &nilfs\_aops; err = page\_symlink(inode, symname, l); if (err) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:32:32 +0000



=== Content from git.kernel.org_6753c472_20250114_203356.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=a1686db1e59f8fc016c4c9361e2119dd206f479a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a1686db1e59f8fc016c4c9361e2119dd206f479a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a1686db1e59f8fc016c4c9361e2119dd206f479a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a1686db1e59f8fc016c4c9361e2119dd206f479a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ryusuke Konishi <konishi.ryusuke@gmail.com> | 2024-10-20 13:51:28 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:20:54 +0100 |
| commit | [a1686db1e59f8fc016c4c9361e2119dd206f479a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a1686db1e59f8fc016c4c9361e2119dd206f479a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=a1686db1e59f8fc016c4c9361e2119dd206f479a)) | |
| tree | [ec50d43afdabbe0bc95b773b70e97dfba0b69f42](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a1686db1e59f8fc016c4c9361e2119dd206f479a) | |
| parent | [fcd6b59f7a774558e2525251c68aa37aff748e55](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fcd6b59f7a774558e2525251c68aa37aff748e55) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a1686db1e59f8fc016c4c9361e2119dd206f479a&id2=fcd6b59f7a774558e2525251c68aa37aff748e55)) | |
| download | [linux-a1686db1e59f8fc016c4c9361e2119dd206f479a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-a1686db1e59f8fc016c4c9361e2119dd206f479a.tar.gz) | |

nilfs2: fix potential deadlock with newly created symlinkscommit b3a033e3ecd3471248d474ef263aadc0059e516a upstream.
Syzbot reported that page\_symlink(), called by nilfs\_symlink(), triggers
memory reclamation involving the filesystem layer, which can result in
circular lock dependencies among the reader/writer semaphore
nilfs->ns\_segctor\_sem, s\_writers percpu\_rwsem (intwrite) and the
fs\_reclaim pseudo lock.
This is because after commit 21fc61c73c39 ("don't put symlink bodies in
pagecache into highmem"), the gfp flags of the page cache for symbolic
links are overwritten to GFP\_KERNEL via inode\_nohighmem().
This is not a problem for symlinks read from the backing device, because
the \_\_GFP\_FS flag is dropped after inode\_nohighmem() is called. However,
when a new symlink is created with nilfs\_symlink(), the gfp flags remain
overwritten to GFP\_KERNEL. Then, memory allocation called from
page\_symlink() etc. triggers memory reclamation including the FS layer,
which may call nilfs\_evict\_inode() or nilfs\_dirty\_inode(). And these can
cause a deadlock if they are called while nilfs->ns\_segctor\_sem is held:
Fix this issue by dropping the \_\_GFP\_FS flag from the page cache GFP flags
of newly created symlinks in the same way that nilfs\_new\_inode() and
\_\_nilfs\_read\_inode() do, as a workaround until we adopt nofs allocation
scope consistently or improve the locking constraints.
Link: [https://lkml.kernel.org/r/20241020050003.4308-1-konishi.ryusuke@gmail.com](https://lkml.kernel.org/r/20241020050003.4308-1-konishi.ryusuke%40gmail.com)
Fixes: 21fc61c73c39 ("don't put symlink bodies in pagecache into highmem")
Signed-off-by: Ryusuke Konishi <konishi.ryusuke@gmail.com>
Reported-by: syzbot+9ef37ac20608f4836256@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=9ef37ac20608f4836256
Tested-by: syzbot+9ef37ac20608f4836256@syzkaller.appspotmail.com
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a1686db1e59f8fc016c4c9361e2119dd206f479a)

| -rw-r--r-- | [fs/nilfs2/namei.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nilfs2/namei.c?id=a1686db1e59f8fc016c4c9361e2119dd206f479a) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 0 deletions

| diff --git a/fs/nilfs2/namei.c b/fs/nilfs2/namei.cindex 08c6d985edeb6f..eeccd69cd79743 100644--- a/[fs/nilfs2/namei.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/namei.c?id=fcd6b59f7a774558e2525251c68aa37aff748e55)+++ b/[fs/nilfs2/namei.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/namei.c?id=a1686db1e59f8fc016c4c9361e2119dd206f479a)@@ -156,6 +156,9 @@ static int nilfs\_symlink(struct inode \*dir, struct dentry \*dentry, /\* slow symlink \*/ inode->i\_op = &nilfs\_symlink\_inode\_operations; inode\_nohighmem(inode);+ mapping\_set\_gfp\_mask(inode->i\_mapping,+ mapping\_gfp\_constraint(inode->i\_mapping,+ ~\_\_GFP\_FS)); inode->i\_mapping->a\_ops = &nilfs\_aops; err = page\_symlink(inode, symname, l); if (err) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:32:33 +0000



=== Content from git.kernel.org_199c94c2_20250114_203357.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b3a033e3ecd3471248d474ef263aadc0059e516a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b3a033e3ecd3471248d474ef263aadc0059e516a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b3a033e3ecd3471248d474ef263aadc0059e516a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b3a033e3ecd3471248d474ef263aadc0059e516a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ryusuke Konishi <konishi.ryusuke@gmail.com> | 2024-10-20 13:51:28 +0900 |
| --- | --- | --- |
| committer | Andrew Morton <akpm@linux-foundation.org> | 2024-10-30 20:14:12 -0700 |
| commit | [b3a033e3ecd3471248d474ef263aadc0059e516a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b3a033e3ecd3471248d474ef263aadc0059e516a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b3a033e3ecd3471248d474ef263aadc0059e516a)) | |
| tree | [f0e5961ddfa005cf51d898567f187b67c72324a3](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b3a033e3ecd3471248d474ef263aadc0059e516a) | |
| parent | [d31638ff6c5437ca2968d6c22fb16524fd485013](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d31638ff6c5437ca2968d6c22fb16524fd485013) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b3a033e3ecd3471248d474ef263aadc0059e516a&id2=d31638ff6c5437ca2968d6c22fb16524fd485013)) | |
| download | [linux-b3a033e3ecd3471248d474ef263aadc0059e516a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b3a033e3ecd3471248d474ef263aadc0059e516a.tar.gz) | |

nilfs2: fix potential deadlock with newly created symlinksSyzbot reported that page\_symlink(), called by nilfs\_symlink(), triggers
memory reclamation involving the filesystem layer, which can result in
circular lock dependencies among the reader/writer semaphore
nilfs->ns\_segctor\_sem, s\_writers percpu\_rwsem (intwrite) and the
fs\_reclaim pseudo lock.
This is because after commit 21fc61c73c39 ("don't put symlink bodies in
pagecache into highmem"), the gfp flags of the page cache for symbolic
links are overwritten to GFP\_KERNEL via inode\_nohighmem().
This is not a problem for symlinks read from the backing device, because
the \_\_GFP\_FS flag is dropped after inode\_nohighmem() is called. However,
when a new symlink is created with nilfs\_symlink(), the gfp flags remain
overwritten to GFP\_KERNEL. Then, memory allocation called from
page\_symlink() etc. triggers memory reclamation including the FS layer,
which may call nilfs\_evict\_inode() or nilfs\_dirty\_inode(). And these can
cause a deadlock if they are called while nilfs->ns\_segctor\_sem is held:
Fix this issue by dropping the \_\_GFP\_FS flag from the page cache GFP flags
of newly created symlinks in the same way that nilfs\_new\_inode() and
\_\_nilfs\_read\_inode() do, as a workaround until we adopt nofs allocation
scope consistently or improve the locking constraints.
Link: [https://lkml.kernel.org/r/20241020050003.4308-1-konishi.ryusuke@gmail.com](https://lkml.kernel.org/r/20241020050003.4308-1-konishi.ryusuke%40gmail.com)
Fixes: 21fc61c73c39 ("don't put symlink bodies in pagecache into highmem")
Signed-off-by: Ryusuke Konishi <konishi.ryusuke@gmail.com>
Reported-by: syzbot+9ef37ac20608f4836256@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=9ef37ac20608f4836256
Tested-by: syzbot+9ef37ac20608f4836256@syzkaller.appspotmail.com
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b3a033e3ecd3471248d474ef263aadc0059e516a)

| -rw-r--r-- | [fs/nilfs2/namei.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nilfs2/namei.c?id=b3a033e3ecd3471248d474ef263aadc0059e516a) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 0 deletions

| diff --git a/fs/nilfs2/namei.c b/fs/nilfs2/namei.cindex 4905063790c578..9b108052d9f71f 100644--- a/[fs/nilfs2/namei.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/namei.c?id=d31638ff6c5437ca2968d6c22fb16524fd485013)+++ b/[fs/nilfs2/namei.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/namei.c?id=b3a033e3ecd3471248d474ef263aadc0059e516a)@@ -157,6 +157,9 @@ static int nilfs\_symlink(struct mnt\_idmap \*idmap, struct inode \*dir, /\* slow symlink \*/ inode->i\_op = &nilfs\_symlink\_inode\_operations; inode\_nohighmem(inode);+ mapping\_set\_gfp\_mask(inode->i\_mapping,+ mapping\_gfp\_constraint(inode->i\_mapping,+ ~\_\_GFP\_FS)); inode->i\_mapping->a\_ops = &nilfs\_aops; err = page\_symlink(inode, symname, l); if (err) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:32:34 +0000


