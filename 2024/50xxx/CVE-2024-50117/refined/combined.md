=== Content from git.kernel.org_26653b3d_20250114_223201.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=43b4fa6e0e238c6e2662f4fb61d9f51c2785fb1d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=43b4fa6e0e238c6e2662f4fb61d9f51c2785fb1d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=43b4fa6e0e238c6e2662f4fb61d9f51c2785fb1d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=43b4fa6e0e238c6e2662f4fb61d9f51c2785fb1d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mario Limonciello <mario.limonciello@amd.com> | 2024-10-11 12:23:15 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:20:51 +0100 |
| commit | [43b4fa6e0e238c6e2662f4fb61d9f51c2785fb1d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=43b4fa6e0e238c6e2662f4fb61d9f51c2785fb1d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=43b4fa6e0e238c6e2662f4fb61d9f51c2785fb1d)) | |
| tree | [d2cd726db55afdbc1788f9b79318d48e7c89e67d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=43b4fa6e0e238c6e2662f4fb61d9f51c2785fb1d) | |
| parent | [4cab98a1734738cd74042fb38564e680147b2f6c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4cab98a1734738cd74042fb38564e680147b2f6c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=43b4fa6e0e238c6e2662f4fb61d9f51c2785fb1d&id2=4cab98a1734738cd74042fb38564e680147b2f6c)) | |
| download | [linux-43b4fa6e0e238c6e2662f4fb61d9f51c2785fb1d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-43b4fa6e0e238c6e2662f4fb61d9f51c2785fb1d.tar.gz) | |

drm/amd: Guard against bad data for ATIF ACPI methodcommit bf58f03931fdcf7b3c45cb76ac13244477a60f44 upstream.
If a BIOS provides bad data in response to an ATIF method call
this causes a NULL pointer dereference in the caller.
```
? show\_regs (arch/x86/kernel/dumpstack.c:478 (discriminator 1))
? \_\_die (arch/x86/kernel/dumpstack.c:423 arch/x86/kernel/dumpstack.c:434)
? page\_fault\_oops (arch/x86/mm/fault.c:544 (discriminator 2) arch/x86/mm/fault.c:705 (discriminator 2))
? do\_user\_addr\_fault (arch/x86/mm/fault.c:440 (discriminator 1) arch/x86/mm/fault.c:1232 (discriminator 1))
? acpi\_ut\_update\_object\_reference (drivers/acpi/acpica/utdelete.c:642)
? exc\_page\_fault (arch/x86/mm/fault.c:1542)
? asm\_exc\_page\_fault (./arch/x86/include/asm/idtentry.h:623)
? amdgpu\_atif\_query\_backlight\_caps.constprop.0 (drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c:387 (discriminator 2)) amdgpu
? amdgpu\_atif\_query\_backlight\_caps.constprop.0 (drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c:386 (discriminator 1)) amdgpu
```
It has been encountered on at least one system, so guard for it.
Fixes: d38ceaf99ed0 ("drm/amdgpu: add core driver (v4)")
Acked-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Mario Limonciello <mario.limonciello@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
(cherry picked from commit c9b7c809b89f24e9372a4e7f02d64c950b07fdee)
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=43b4fa6e0e238c6e2662f4fb61d9f51c2785fb1d)

| -rw-r--r-- | [drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/amdgpu/amdgpu_acpi.c?id=43b4fa6e0e238c6e2662f4fb61d9f51c2785fb1d) | 15 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 12 insertions, 3 deletions

| diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c b/drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.cindex 1e41367ef74ee1..4597d441198d9a 100644--- a/[drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_acpi.c?id=4cab98a1734738cd74042fb38564e680147b2f6c)+++ b/[drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_acpi.c?id=43b4fa6e0e238c6e2662f4fb61d9f51c2785fb1d)@@ -85,6 +85,7 @@ static union acpi\_object \*amdgpu\_atif\_call(struct amdgpu\_atif \*atif, struct acpi\_buffer \*params) { acpi\_status status;+ union acpi\_object \*obj; union acpi\_object atif\_arg\_elements[2]; struct acpi\_object\_list atif\_arg; struct acpi\_buffer buffer = { ACPI\_ALLOCATE\_BUFFER, NULL };@@ -107,16 +108,24 @@ static union acpi\_object \*amdgpu\_atif\_call(struct amdgpu\_atif \*atif,  status = acpi\_evaluate\_object(atif->handle, NULL, &atif\_arg, &buffer);+ obj = (union acpi\_object \*)buffer.pointer; - /\* Fail only if calling the method fails and ATIF is supported \*/+ /\* Fail if calling the method fails and ATIF is supported \*/ if (ACPI\_FAILURE(status) && status != AE\_NOT\_FOUND) { DRM\_DEBUG\_DRIVER("failed to evaluate ATIF got %s\n", acpi\_format\_exception(status));- kfree(buffer.pointer);+ kfree(obj); return NULL; } - return buffer.pointer;+ if (obj->type != ACPI\_TYPE\_BUFFER) {+ DRM\_DEBUG\_DRIVER("bad object returned from ATIF: %d\n",+ obj->type);+ kfree(obj);+ return NULL;+ }++ return obj; }  /\*\* |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:30:38 +0000



=== Content from git.kernel.org_e69efc2f_20250114_223200.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=234682910971732cd4da96fd95946e296e486b38)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=234682910971732cd4da96fd95946e296e486b38)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=234682910971732cd4da96fd95946e296e486b38)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=234682910971732cd4da96fd95946e296e486b38)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mario Limonciello <mario.limonciello@amd.com> | 2024-10-11 12:23:15 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:21:59 +0100 |
| commit | [234682910971732cd4da96fd95946e296e486b38](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=234682910971732cd4da96fd95946e296e486b38) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=234682910971732cd4da96fd95946e296e486b38)) | |
| tree | [bf7029abf0190999e28665f4f77ee1c1cef8fe3f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=234682910971732cd4da96fd95946e296e486b38) | |
| parent | [c9085e2401b86841ad0a3e1475b6d96e7279f2a6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c9085e2401b86841ad0a3e1475b6d96e7279f2a6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=234682910971732cd4da96fd95946e296e486b38&id2=c9085e2401b86841ad0a3e1475b6d96e7279f2a6)) | |
| download | [linux-234682910971732cd4da96fd95946e296e486b38.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-234682910971732cd4da96fd95946e296e486b38.tar.gz) | |

drm/amd: Guard against bad data for ATIF ACPI methodcommit bf58f03931fdcf7b3c45cb76ac13244477a60f44 upstream.
If a BIOS provides bad data in response to an ATIF method call
this causes a NULL pointer dereference in the caller.
```
? show\_regs (arch/x86/kernel/dumpstack.c:478 (discriminator 1))
? \_\_die (arch/x86/kernel/dumpstack.c:423 arch/x86/kernel/dumpstack.c:434)
? page\_fault\_oops (arch/x86/mm/fault.c:544 (discriminator 2) arch/x86/mm/fault.c:705 (discriminator 2))
? do\_user\_addr\_fault (arch/x86/mm/fault.c:440 (discriminator 1) arch/x86/mm/fault.c:1232 (discriminator 1))
? acpi\_ut\_update\_object\_reference (drivers/acpi/acpica/utdelete.c:642)
? exc\_page\_fault (arch/x86/mm/fault.c:1542)
? asm\_exc\_page\_fault (./arch/x86/include/asm/idtentry.h:623)
? amdgpu\_atif\_query\_backlight\_caps.constprop.0 (drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c:387 (discriminator 2)) amdgpu
? amdgpu\_atif\_query\_backlight\_caps.constprop.0 (drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c:386 (discriminator 1)) amdgpu
```
It has been encountered on at least one system, so guard for it.
Fixes: d38ceaf99ed0 ("drm/amdgpu: add core driver (v4)")
Acked-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Mario Limonciello <mario.limonciello@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
(cherry picked from commit c9b7c809b89f24e9372a4e7f02d64c950b07fdee)
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=234682910971732cd4da96fd95946e296e486b38)

| -rw-r--r-- | [drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/amdgpu/amdgpu_acpi.c?id=234682910971732cd4da96fd95946e296e486b38) | 15 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 12 insertions, 3 deletions

| diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c b/drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.cindex 165b02e267b0ce..77886e79d75db1 100644--- a/[drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_acpi.c?id=c9085e2401b86841ad0a3e1475b6d96e7279f2a6)+++ b/[drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_acpi.c?id=234682910971732cd4da96fd95946e296e486b38)@@ -87,6 +87,7 @@ static union acpi\_object \*amdgpu\_atif\_call(struct amdgpu\_atif \*atif, struct acpi\_buffer \*params) { acpi\_status status;+ union acpi\_object \*obj; union acpi\_object atif\_arg\_elements[2]; struct acpi\_object\_list atif\_arg; struct acpi\_buffer buffer = { ACPI\_ALLOCATE\_BUFFER, NULL };@@ -109,16 +110,24 @@ static union acpi\_object \*amdgpu\_atif\_call(struct amdgpu\_atif \*atif,  status = acpi\_evaluate\_object(atif->handle, NULL, &atif\_arg, &buffer);+ obj = (union acpi\_object \*)buffer.pointer; - /\* Fail only if calling the method fails and ATIF is supported \*/+ /\* Fail if calling the method fails and ATIF is supported \*/ if (ACPI\_FAILURE(status) && status != AE\_NOT\_FOUND) { DRM\_DEBUG\_DRIVER("failed to evaluate ATIF got %s\n", acpi\_format\_exception(status));- kfree(buffer.pointer);+ kfree(obj); return NULL; } - return buffer.pointer;+ if (obj->type != ACPI\_TYPE\_BUFFER) {+ DRM\_DEBUG\_DRIVER("bad object returned from ATIF: %d\n",+ obj->type);+ kfree(obj);+ return NULL;+ }++ return obj; }  /\*\* |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:30:38 +0000



=== Content from git.kernel.org_e1c9d7d1_20250114_223203.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=bf58f03931fdcf7b3c45cb76ac13244477a60f44)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bf58f03931fdcf7b3c45cb76ac13244477a60f44)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bf58f03931fdcf7b3c45cb76ac13244477a60f44)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bf58f03931fdcf7b3c45cb76ac13244477a60f44)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mario Limonciello <mario.limonciello@amd.com> | 2024-10-11 12:23:15 -0500 |
| --- | --- | --- |
| committer | Alex Deucher <alexander.deucher@amd.com> | 2024-10-22 18:08:12 -0400 |
| commit | [bf58f03931fdcf7b3c45cb76ac13244477a60f44](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bf58f03931fdcf7b3c45cb76ac13244477a60f44) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=bf58f03931fdcf7b3c45cb76ac13244477a60f44)) | |
| tree | [08764e498c64086d3e626dc048e35b59ec781009](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bf58f03931fdcf7b3c45cb76ac13244477a60f44) | |
| parent | [42f7652d3eb527d03665b09edac47f85fb600924](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=42f7652d3eb527d03665b09edac47f85fb600924) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bf58f03931fdcf7b3c45cb76ac13244477a60f44&id2=42f7652d3eb527d03665b09edac47f85fb600924)) | |
| download | [linux-bf58f03931fdcf7b3c45cb76ac13244477a60f44.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-bf58f03931fdcf7b3c45cb76ac13244477a60f44.tar.gz) | |

drm/amd: Guard against bad data for ATIF ACPI methodIf a BIOS provides bad data in response to an ATIF method call
this causes a NULL pointer dereference in the caller.
```
? show\_regs (arch/x86/kernel/dumpstack.c:478 (discriminator 1))
? \_\_die (arch/x86/kernel/dumpstack.c:423 arch/x86/kernel/dumpstack.c:434)
? page\_fault\_oops (arch/x86/mm/fault.c:544 (discriminator 2) arch/x86/mm/fault.c:705 (discriminator 2))
? do\_user\_addr\_fault (arch/x86/mm/fault.c:440 (discriminator 1) arch/x86/mm/fault.c:1232 (discriminator 1))
? acpi\_ut\_update\_object\_reference (drivers/acpi/acpica/utdelete.c:642)
? exc\_page\_fault (arch/x86/mm/fault.c:1542)
? asm\_exc\_page\_fault (./arch/x86/include/asm/idtentry.h:623)
? amdgpu\_atif\_query\_backlight\_caps.constprop.0 (drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c:387 (discriminator 2)) amdgpu
? amdgpu\_atif\_query\_backlight\_caps.constprop.0 (drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c:386 (discriminator 1)) amdgpu
```
It has been encountered on at least one system, so guard for it.
Fixes: d38ceaf99ed0 ("drm/amdgpu: add core driver (v4)")
Acked-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Mario Limonciello <mario.limonciello@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
(cherry picked from commit c9b7c809b89f24e9372a4e7f02d64c950b07fdee)
Cc: stable@vger.kernel.org
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bf58f03931fdcf7b3c45cb76ac13244477a60f44)

| -rw-r--r-- | [drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/amdgpu/amdgpu_acpi.c?id=bf58f03931fdcf7b3c45cb76ac13244477a60f44) | 15 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 12 insertions, 3 deletions

| diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c b/drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.cindex f85ace0384d218..1f5a296f5ed2f4 100644--- a/[drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_acpi.c?id=42f7652d3eb527d03665b09edac47f85fb600924)+++ b/[drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_acpi.c?id=bf58f03931fdcf7b3c45cb76ac13244477a60f44)@@ -147,6 +147,7 @@ static union acpi\_object \*amdgpu\_atif\_call(struct amdgpu\_atif \*atif, struct acpi\_buffer \*params) { acpi\_status status;+ union acpi\_object \*obj; union acpi\_object atif\_arg\_elements[2]; struct acpi\_object\_list atif\_arg; struct acpi\_buffer buffer = { ACPI\_ALLOCATE\_BUFFER, NULL };@@ -169,16 +170,24 @@ static union acpi\_object \*amdgpu\_atif\_call(struct amdgpu\_atif \*atif,  status = acpi\_evaluate\_object(atif->handle, NULL, &atif\_arg, &buffer);+ obj = (union acpi\_object \*)buffer.pointer; - /\* Fail only if calling the method fails and ATIF is supported \*/+ /\* Fail if calling the method fails and ATIF is supported \*/ if (ACPI\_FAILURE(status) && status != AE\_NOT\_FOUND) { DRM\_DEBUG\_DRIVER("failed to evaluate ATIF got %s\n", acpi\_format\_exception(status));- kfree(buffer.pointer);+ kfree(obj); return NULL; } - return buffer.pointer;+ if (obj->type != ACPI\_TYPE\_BUFFER) {+ DRM\_DEBUG\_DRIVER("bad object returned from ATIF: %d\n",+ obj->type);+ kfree(obj);+ return NULL;+ }++ return obj; }  /\*\* |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:30:41 +0000



=== Content from git.kernel.org_2bff8a0c_20250114_223204.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=cd67af3c1762de4c2483ae4dbdd98f9ea8fa56e3)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cd67af3c1762de4c2483ae4dbdd98f9ea8fa56e3)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cd67af3c1762de4c2483ae4dbdd98f9ea8fa56e3)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cd67af3c1762de4c2483ae4dbdd98f9ea8fa56e3)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mario Limonciello <mario.limonciello@amd.com> | 2024-10-11 12:23:15 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-01 01:56:06 +0100 |
| commit | [cd67af3c1762de4c2483ae4dbdd98f9ea8fa56e3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cd67af3c1762de4c2483ae4dbdd98f9ea8fa56e3) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=cd67af3c1762de4c2483ae4dbdd98f9ea8fa56e3)) | |
| tree | [db77e717b7b3a6fcafe57b93ef5318a1cc31b197](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cd67af3c1762de4c2483ae4dbdd98f9ea8fa56e3) | |
| parent | [deee4bd713f42b686dcf2660dff4d042f6aff85b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=deee4bd713f42b686dcf2660dff4d042f6aff85b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cd67af3c1762de4c2483ae4dbdd98f9ea8fa56e3&id2=deee4bd713f42b686dcf2660dff4d042f6aff85b)) | |
| download | [linux-cd67af3c1762de4c2483ae4dbdd98f9ea8fa56e3.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-cd67af3c1762de4c2483ae4dbdd98f9ea8fa56e3.tar.gz) | |

drm/amd: Guard against bad data for ATIF ACPI methodcommit bf58f03931fdcf7b3c45cb76ac13244477a60f44 upstream.
If a BIOS provides bad data in response to an ATIF method call
this causes a NULL pointer dereference in the caller.
```
? show\_regs (arch/x86/kernel/dumpstack.c:478 (discriminator 1))
? \_\_die (arch/x86/kernel/dumpstack.c:423 arch/x86/kernel/dumpstack.c:434)
? page\_fault\_oops (arch/x86/mm/fault.c:544 (discriminator 2) arch/x86/mm/fault.c:705 (discriminator 2))
? do\_user\_addr\_fault (arch/x86/mm/fault.c:440 (discriminator 1) arch/x86/mm/fault.c:1232 (discriminator 1))
? acpi\_ut\_update\_object\_reference (drivers/acpi/acpica/utdelete.c:642)
? exc\_page\_fault (arch/x86/mm/fault.c:1542)
? asm\_exc\_page\_fault (./arch/x86/include/asm/idtentry.h:623)
? amdgpu\_atif\_query\_backlight\_caps.constprop.0 (drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c:387 (discriminator 2)) amdgpu
? amdgpu\_atif\_query\_backlight\_caps.constprop.0 (drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c:386 (discriminator 1)) amdgpu
```
It has been encountered on at least one system, so guard for it.
Fixes: d38ceaf99ed0 ("drm/amdgpu: add core driver (v4)")
Acked-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Mario Limonciello <mario.limonciello@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
(cherry picked from commit c9b7c809b89f24e9372a4e7f02d64c950b07fdee)
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cd67af3c1762de4c2483ae4dbdd98f9ea8fa56e3)

| -rw-r--r-- | [drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/amdgpu/amdgpu_acpi.c?id=cd67af3c1762de4c2483ae4dbdd98f9ea8fa56e3) | 15 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 12 insertions, 3 deletions

| diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c b/drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.cindex e32bd990800ded..d967fba2e85ec4 100644--- a/[drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_acpi.c?id=deee4bd713f42b686dcf2660dff4d042f6aff85b)+++ b/[drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_acpi.c?id=cd67af3c1762de4c2483ae4dbdd98f9ea8fa56e3)@@ -107,6 +107,7 @@ static union acpi\_object \*amdgpu\_atif\_call(struct amdgpu\_atif \*atif, struct acpi\_buffer \*params) { acpi\_status status;+ union acpi\_object \*obj; union acpi\_object atif\_arg\_elements[2]; struct acpi\_object\_list atif\_arg; struct acpi\_buffer buffer = { ACPI\_ALLOCATE\_BUFFER, NULL };@@ -129,16 +130,24 @@ static union acpi\_object \*amdgpu\_atif\_call(struct amdgpu\_atif \*atif,  status = acpi\_evaluate\_object(atif->handle, NULL, &atif\_arg, &buffer);+ obj = (union acpi\_object \*)buffer.pointer; - /\* Fail only if calling the method fails and ATIF is supported \*/+ /\* Fail if calling the method fails and ATIF is supported \*/ if (ACPI\_FAILURE(status) && status != AE\_NOT\_FOUND) { DRM\_DEBUG\_DRIVER("failed to evaluate ATIF got %s\n", acpi\_format\_exception(status));- kfree(buffer.pointer);+ kfree(obj); return NULL; } - return buffer.pointer;+ if (obj->type != ACPI\_TYPE\_BUFFER) {+ DRM\_DEBUG\_DRIVER("bad object returned from ATIF: %d\n",+ obj->type);+ kfree(obj);+ return NULL;+ }++ return obj; }  /\*\* |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:30:41 +0000



=== Content from git.kernel.org_490e9502_20250114_223201.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=58556dcbd5606a5daccaee73b2130bc16b48e025)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=58556dcbd5606a5daccaee73b2130bc16b48e025)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=58556dcbd5606a5daccaee73b2130bc16b48e025)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=58556dcbd5606a5daccaee73b2130bc16b48e025)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mario Limonciello <mario.limonciello@amd.com> | 2024-10-11 12:23:15 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:19:21 +0100 |
| commit | [58556dcbd5606a5daccaee73b2130bc16b48e025](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=58556dcbd5606a5daccaee73b2130bc16b48e025) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=58556dcbd5606a5daccaee73b2130bc16b48e025)) | |
| tree | [db4a5130440ae4098ccd46090e50388284bfb9dc](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=58556dcbd5606a5daccaee73b2130bc16b48e025) | |
| parent | [89a4a73ffd7a2e2e3da56797d9136b880f428c1c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=89a4a73ffd7a2e2e3da56797d9136b880f428c1c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=58556dcbd5606a5daccaee73b2130bc16b48e025&id2=89a4a73ffd7a2e2e3da56797d9136b880f428c1c)) | |
| download | [linux-58556dcbd5606a5daccaee73b2130bc16b48e025.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-58556dcbd5606a5daccaee73b2130bc16b48e025.tar.gz) | |

drm/amd: Guard against bad data for ATIF ACPI methodcommit bf58f03931fdcf7b3c45cb76ac13244477a60f44 upstream.
If a BIOS provides bad data in response to an ATIF method call
this causes a NULL pointer dereference in the caller.
```
? show\_regs (arch/x86/kernel/dumpstack.c:478 (discriminator 1))
? \_\_die (arch/x86/kernel/dumpstack.c:423 arch/x86/kernel/dumpstack.c:434)
? page\_fault\_oops (arch/x86/mm/fault.c:544 (discriminator 2) arch/x86/mm/fault.c:705 (discriminator 2))
? do\_user\_addr\_fault (arch/x86/mm/fault.c:440 (discriminator 1) arch/x86/mm/fault.c:1232 (discriminator 1))
? acpi\_ut\_update\_object\_reference (drivers/acpi/acpica/utdelete.c:642)
? exc\_page\_fault (arch/x86/mm/fault.c:1542)
? asm\_exc\_page\_fault (./arch/x86/include/asm/idtentry.h:623)
? amdgpu\_atif\_query\_backlight\_caps.constprop.0 (drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c:387 (discriminator 2)) amdgpu
? amdgpu\_atif\_query\_backlight\_caps.constprop.0 (drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c:386 (discriminator 1)) amdgpu
```
It has been encountered on at least one system, so guard for it.
Fixes: d38ceaf99ed0 ("drm/amdgpu: add core driver (v4)")
Acked-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Mario Limonciello <mario.limonciello@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
(cherry picked from commit c9b7c809b89f24e9372a4e7f02d64c950b07fdee)
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=58556dcbd5606a5daccaee73b2130bc16b48e025)

| -rw-r--r-- | [drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/amdgpu/amdgpu_acpi.c?id=58556dcbd5606a5daccaee73b2130bc16b48e025) | 15 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 12 insertions, 3 deletions

| diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c b/drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.cindex bbd927e800af0f..bf8044bf4734b4 100644--- a/[drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_acpi.c?id=89a4a73ffd7a2e2e3da56797d9136b880f428c1c)+++ b/[drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_acpi.c?id=58556dcbd5606a5daccaee73b2130bc16b48e025)@@ -90,6 +90,7 @@ static union acpi\_object \*amdgpu\_atif\_call(struct amdgpu\_atif \*atif, struct acpi\_buffer \*params) { acpi\_status status;+ union acpi\_object \*obj; union acpi\_object atif\_arg\_elements[2]; struct acpi\_object\_list atif\_arg; struct acpi\_buffer buffer = { ACPI\_ALLOCATE\_BUFFER, NULL };@@ -112,16 +113,24 @@ static union acpi\_object \*amdgpu\_atif\_call(struct amdgpu\_atif \*atif,  status = acpi\_evaluate\_object(atif->handle, NULL, &atif\_arg, &buffer);+ obj = (union acpi\_object \*)buffer.pointer; - /\* Fail only if calling the method fails and ATIF is supported \*/+ /\* Fail if calling the method fails and ATIF is supported \*/ if (ACPI\_FAILURE(status) && status != AE\_NOT\_FOUND) { DRM\_DEBUG\_DRIVER("failed to evaluate ATIF got %s\n", acpi\_format\_exception(status));- kfree(buffer.pointer);+ kfree(obj); return NULL; } - return buffer.pointer;+ if (obj->type != ACPI\_TYPE\_BUFFER) {+ DRM\_DEBUG\_DRIVER("bad object returned from ATIF: %d\n",+ obj->type);+ kfree(obj);+ return NULL;+ }++ return obj; }  /\*\* |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:30:39 +0000



=== Content from git.kernel.org_cbdc24df_20250114_223200.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1d7175f9c57b1abf9ecfbdfd53ea760761f52ffe)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1d7175f9c57b1abf9ecfbdfd53ea760761f52ffe)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1d7175f9c57b1abf9ecfbdfd53ea760761f52ffe)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1d7175f9c57b1abf9ecfbdfd53ea760761f52ffe)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mario Limonciello <mario.limonciello@amd.com> | 2024-10-11 12:23:15 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-01 02:02:40 +0100 |
| commit | [1d7175f9c57b1abf9ecfbdfd53ea760761f52ffe](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1d7175f9c57b1abf9ecfbdfd53ea760761f52ffe) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1d7175f9c57b1abf9ecfbdfd53ea760761f52ffe)) | |
| tree | [eb5453ec2f3375a26c1fbd3e572705be86574386](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1d7175f9c57b1abf9ecfbdfd53ea760761f52ffe) | |
| parent | [7c221ddea5889f37473bb93ebb8a3e11338425e3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7c221ddea5889f37473bb93ebb8a3e11338425e3) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1d7175f9c57b1abf9ecfbdfd53ea760761f52ffe&id2=7c221ddea5889f37473bb93ebb8a3e11338425e3)) | |
| download | [linux-1d7175f9c57b1abf9ecfbdfd53ea760761f52ffe.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1d7175f9c57b1abf9ecfbdfd53ea760761f52ffe.tar.gz) | |

drm/amd: Guard against bad data for ATIF ACPI methodcommit bf58f03931fdcf7b3c45cb76ac13244477a60f44 upstream.
If a BIOS provides bad data in response to an ATIF method call
this causes a NULL pointer dereference in the caller.
```
? show\_regs (arch/x86/kernel/dumpstack.c:478 (discriminator 1))
? \_\_die (arch/x86/kernel/dumpstack.c:423 arch/x86/kernel/dumpstack.c:434)
? page\_fault\_oops (arch/x86/mm/fault.c:544 (discriminator 2) arch/x86/mm/fault.c:705 (discriminator 2))
? do\_user\_addr\_fault (arch/x86/mm/fault.c:440 (discriminator 1) arch/x86/mm/fault.c:1232 (discriminator 1))
? acpi\_ut\_update\_object\_reference (drivers/acpi/acpica/utdelete.c:642)
? exc\_page\_fault (arch/x86/mm/fault.c:1542)
? asm\_exc\_page\_fault (./arch/x86/include/asm/idtentry.h:623)
? amdgpu\_atif\_query\_backlight\_caps.constprop.0 (drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c:387 (discriminator 2)) amdgpu
? amdgpu\_atif\_query\_backlight\_caps.constprop.0 (drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c:386 (discriminator 1)) amdgpu
```
It has been encountered on at least one system, so guard for it.
Fixes: d38ceaf99ed0 ("drm/amdgpu: add core driver (v4)")
Acked-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Mario Limonciello <mario.limonciello@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
(cherry picked from commit c9b7c809b89f24e9372a4e7f02d64c950b07fdee)
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1d7175f9c57b1abf9ecfbdfd53ea760761f52ffe)

| -rw-r--r-- | [drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/amdgpu/amdgpu_acpi.c?id=1d7175f9c57b1abf9ecfbdfd53ea760761f52ffe) | 15 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 12 insertions, 3 deletions

| diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c b/drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.cindex f85ace0384d218..1f5a296f5ed2f4 100644--- a/[drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_acpi.c?id=7c221ddea5889f37473bb93ebb8a3e11338425e3)+++ b/[drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_acpi.c?id=1d7175f9c57b1abf9ecfbdfd53ea760761f52ffe)@@ -147,6 +147,7 @@ static union acpi\_object \*amdgpu\_atif\_call(struct amdgpu\_atif \*atif, struct acpi\_buffer \*params) { acpi\_status status;+ union acpi\_object \*obj; union acpi\_object atif\_arg\_elements[2]; struct acpi\_object\_list atif\_arg; struct acpi\_buffer buffer = { ACPI\_ALLOCATE\_BUFFER, NULL };@@ -169,16 +170,24 @@ static union acpi\_object \*amdgpu\_atif\_call(struct amdgpu\_atif \*atif,  status = acpi\_evaluate\_object(atif->handle, NULL, &atif\_arg, &buffer);+ obj = (union acpi\_object \*)buffer.pointer; - /\* Fail only if calling the method fails and ATIF is supported \*/+ /\* Fail if calling the method fails and ATIF is supported \*/ if (ACPI\_FAILURE(status) && status != AE\_NOT\_FOUND) { DRM\_DEBUG\_DRIVER("failed to evaluate ATIF got %s\n", acpi\_format\_exception(status));- kfree(buffer.pointer);+ kfree(obj); return NULL; } - return buffer.pointer;+ if (obj->type != ACPI\_TYPE\_BUFFER) {+ DRM\_DEBUG\_DRIVER("bad object returned from ATIF: %d\n",+ obj->type);+ kfree(obj);+ return NULL;+ }++ return obj; }  /\*\* |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:30:37 +0000



=== Content from git.kernel.org_3330ab49_20250114_223202.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=6032287747f874b52dc8b9d7490e2799736e035f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6032287747f874b52dc8b9d7490e2799736e035f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6032287747f874b52dc8b9d7490e2799736e035f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6032287747f874b52dc8b9d7490e2799736e035f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mario Limonciello <mario.limonciello@amd.com> | 2024-10-11 12:23:15 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-01 01:52:37 +0100 |
| commit | [6032287747f874b52dc8b9d7490e2799736e035f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6032287747f874b52dc8b9d7490e2799736e035f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=6032287747f874b52dc8b9d7490e2799736e035f)) | |
| tree | [e95b8f6320d257327a64a540a0493cfcac69d355](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6032287747f874b52dc8b9d7490e2799736e035f) | |
| parent | [df75b21af792016b3096b3dd8f369c87b7cd9ae6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=df75b21af792016b3096b3dd8f369c87b7cd9ae6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6032287747f874b52dc8b9d7490e2799736e035f&id2=df75b21af792016b3096b3dd8f369c87b7cd9ae6)) | |
| download | [linux-6032287747f874b52dc8b9d7490e2799736e035f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-6032287747f874b52dc8b9d7490e2799736e035f.tar.gz) | |

drm/amd: Guard against bad data for ATIF ACPI methodcommit bf58f03931fdcf7b3c45cb76ac13244477a60f44 upstream.
If a BIOS provides bad data in response to an ATIF method call
this causes a NULL pointer dereference in the caller.
```
? show\_regs (arch/x86/kernel/dumpstack.c:478 (discriminator 1))
? \_\_die (arch/x86/kernel/dumpstack.c:423 arch/x86/kernel/dumpstack.c:434)
? page\_fault\_oops (arch/x86/mm/fault.c:544 (discriminator 2) arch/x86/mm/fault.c:705 (discriminator 2))
? do\_user\_addr\_fault (arch/x86/mm/fault.c:440 (discriminator 1) arch/x86/mm/fault.c:1232 (discriminator 1))
? acpi\_ut\_update\_object\_reference (drivers/acpi/acpica/utdelete.c:642)
? exc\_page\_fault (arch/x86/mm/fault.c:1542)
? asm\_exc\_page\_fault (./arch/x86/include/asm/idtentry.h:623)
? amdgpu\_atif\_query\_backlight\_caps.constprop.0 (drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c:387 (discriminator 2)) amdgpu
? amdgpu\_atif\_query\_backlight\_caps.constprop.0 (drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c:386 (discriminator 1)) amdgpu
```
It has been encountered on at least one system, so guard for it.
Fixes: d38ceaf99ed0 ("drm/amdgpu: add core driver (v4)")
Acked-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Mario Limonciello <mario.limonciello@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
(cherry picked from commit c9b7c809b89f24e9372a4e7f02d64c950b07fdee)
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6032287747f874b52dc8b9d7490e2799736e035f)

| -rw-r--r-- | [drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/amdgpu/amdgpu_acpi.c?id=6032287747f874b52dc8b9d7490e2799736e035f) | 15 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 12 insertions, 3 deletions

| diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c b/drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.cindex 6cded09d5878af..2f250dc861947e 100644--- a/[drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_acpi.c?id=df75b21af792016b3096b3dd8f369c87b7cd9ae6)+++ b/[drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_acpi.c?id=6032287747f874b52dc8b9d7490e2799736e035f)@@ -108,6 +108,7 @@ static union acpi\_object \*amdgpu\_atif\_call(struct amdgpu\_atif \*atif, struct acpi\_buffer \*params) { acpi\_status status;+ union acpi\_object \*obj; union acpi\_object atif\_arg\_elements[2]; struct acpi\_object\_list atif\_arg; struct acpi\_buffer buffer = { ACPI\_ALLOCATE\_BUFFER, NULL };@@ -130,16 +131,24 @@ static union acpi\_object \*amdgpu\_atif\_call(struct amdgpu\_atif \*atif,  status = acpi\_evaluate\_object(atif->handle, NULL, &atif\_arg, &buffer);+ obj = (union acpi\_object \*)buffer.pointer; - /\* Fail only if calling the method fails and ATIF is supported \*/+ /\* Fail if calling the method fails and ATIF is supported \*/ if (ACPI\_FAILURE(status) && status != AE\_NOT\_FOUND) { DRM\_DEBUG\_DRIVER("failed to evaluate ATIF got %s\n", acpi\_format\_exception(status));- kfree(buffer.pointer);+ kfree(obj); return NULL; } - return buffer.pointer;+ if (obj->type != ACPI\_TYPE\_BUFFER) {+ DRM\_DEBUG\_DRIVER("bad object returned from ATIF: %d\n",+ obj->type);+ kfree(obj);+ return NULL;+ }++ return obj; }  /\*\* |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:30:39 +0000



=== Content from git.kernel.org_17e4a4af_20250114_223203.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=975ede2a7bec52b5da1428829b3439667c8a234b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=975ede2a7bec52b5da1428829b3439667c8a234b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=975ede2a7bec52b5da1428829b3439667c8a234b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=975ede2a7bec52b5da1428829b3439667c8a234b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mario Limonciello <mario.limonciello@amd.com> | 2024-10-11 12:23:15 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-01 01:58:32 +0100 |
| commit | [975ede2a7bec52b5da1428829b3439667c8a234b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=975ede2a7bec52b5da1428829b3439667c8a234b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=975ede2a7bec52b5da1428829b3439667c8a234b)) | |
| tree | [cfa6977cda432d79c87d5c4315e8d13fbc518738](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=975ede2a7bec52b5da1428829b3439667c8a234b) | |
| parent | [004ad1a2d6841bb5765c890df72008c117ced7c7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=004ad1a2d6841bb5765c890df72008c117ced7c7) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=975ede2a7bec52b5da1428829b3439667c8a234b&id2=004ad1a2d6841bb5765c890df72008c117ced7c7)) | |
| download | [linux-975ede2a7bec52b5da1428829b3439667c8a234b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-975ede2a7bec52b5da1428829b3439667c8a234b.tar.gz) | |

drm/amd: Guard against bad data for ATIF ACPI methodcommit bf58f03931fdcf7b3c45cb76ac13244477a60f44 upstream.
If a BIOS provides bad data in response to an ATIF method call
this causes a NULL pointer dereference in the caller.
```
? show\_regs (arch/x86/kernel/dumpstack.c:478 (discriminator 1))
? \_\_die (arch/x86/kernel/dumpstack.c:423 arch/x86/kernel/dumpstack.c:434)
? page\_fault\_oops (arch/x86/mm/fault.c:544 (discriminator 2) arch/x86/mm/fault.c:705 (discriminator 2))
? do\_user\_addr\_fault (arch/x86/mm/fault.c:440 (discriminator 1) arch/x86/mm/fault.c:1232 (discriminator 1))
? acpi\_ut\_update\_object\_reference (drivers/acpi/acpica/utdelete.c:642)
? exc\_page\_fault (arch/x86/mm/fault.c:1542)
? asm\_exc\_page\_fault (./arch/x86/include/asm/idtentry.h:623)
? amdgpu\_atif\_query\_backlight\_caps.constprop.0 (drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c:387 (discriminator 2)) amdgpu
? amdgpu\_atif\_query\_backlight\_caps.constprop.0 (drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c:386 (discriminator 1)) amdgpu
```
It has been encountered on at least one system, so guard for it.
Fixes: d38ceaf99ed0 ("drm/amdgpu: add core driver (v4)")
Acked-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Mario Limonciello <mario.limonciello@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
(cherry picked from commit c9b7c809b89f24e9372a4e7f02d64c950b07fdee)
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=975ede2a7bec52b5da1428829b3439667c8a234b)

| -rw-r--r-- | [drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/amdgpu/amdgpu_acpi.c?id=975ede2a7bec52b5da1428829b3439667c8a234b) | 15 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 12 insertions, 3 deletions

| diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c b/drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.cindex 2bca37044ad0fb..fac204d6e0ea2c 100644--- a/[drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_acpi.c?id=004ad1a2d6841bb5765c890df72008c117ced7c7)+++ b/[drivers/gpu/drm/amd/amdgpu/amdgpu\_acpi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_acpi.c?id=975ede2a7bec52b5da1428829b3439667c8a234b)@@ -147,6 +147,7 @@ static union acpi\_object \*amdgpu\_atif\_call(struct amdgpu\_atif \*atif, struct acpi\_buffer \*params) { acpi\_status status;+ union acpi\_object \*obj; union acpi\_object atif\_arg\_elements[2]; struct acpi\_object\_list atif\_arg; struct acpi\_buffer buffer = { ACPI\_ALLOCATE\_BUFFER, NULL };@@ -169,16 +170,24 @@ static union acpi\_object \*amdgpu\_atif\_call(struct amdgpu\_atif \*atif,  status = acpi\_evaluate\_object(atif->handle, NULL, &atif\_arg, &buffer);+ obj = (union acpi\_object \*)buffer.pointer; - /\* Fail only if calling the method fails and ATIF is supported \*/+ /\* Fail if calling the method fails and ATIF is supported \*/ if (ACPI\_FAILURE(status) && status != AE\_NOT\_FOUND) { DRM\_DEBUG\_DRIVER("failed to evaluate ATIF got %s\n", acpi\_format\_exception(status));- kfree(buffer.pointer);+ kfree(obj); return NULL; } - return buffer.pointer;+ if (obj->type != ACPI\_TYPE\_BUFFER) {+ DRM\_DEBUG\_DRIVER("bad object returned from ATIF: %d\n",+ obj->type);+ kfree(obj);+ return NULL;+ }++ return obj; }  /\*\* |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:30:40 +0000


