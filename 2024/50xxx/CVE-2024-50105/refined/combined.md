=== Content from git.kernel.org_89a657c0_20250114_202806.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=db7e59e6a39a4d3d54ca8197c796557e6d480b0d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=db7e59e6a39a4d3d54ca8197c796557e6d480b0d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=db7e59e6a39a4d3d54ca8197c796557e6d480b0d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=db7e59e6a39a4d3d54ca8197c796557e6d480b0d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Krzysztof Kozlowski <krzysztof.kozlowski@linaro.org> | 2024-10-12 12:11:08 +0200 |
| --- | --- | --- |
| committer | Mark Brown <broonie@kernel.org> | 2024-10-22 21:00:38 +0100 |
| commit | [db7e59e6a39a4d3d54ca8197c796557e6d480b0d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=db7e59e6a39a4d3d54ca8197c796557e6d480b0d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=db7e59e6a39a4d3d54ca8197c796557e6d480b0d)) | |
| tree | [4af95865b3148a6e0355e6dd84381ca4af03a6dc](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=db7e59e6a39a4d3d54ca8197c796557e6d480b0d) | |
| parent | [b9a8ecf81066e01e8a3de35517481bc5aa0439e5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b9a8ecf81066e01e8a3de35517481bc5aa0439e5) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=db7e59e6a39a4d3d54ca8197c796557e6d480b0d&id2=b9a8ecf81066e01e8a3de35517481bc5aa0439e5)) | |
| download | [linux-db7e59e6a39a4d3d54ca8197c796557e6d480b0d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-db7e59e6a39a4d3d54ca8197c796557e6d480b0d.tar.gz) | |

ASoC: qcom: sc7280: Fix missing Soundwire runtime stream allocCommit 15c7fab0e047 ("ASoC: qcom: Move Soundwire runtime stream alloc to
soundcards") moved the allocation of Soundwire stream runtime from the
Qualcomm Soundwire driver to each individual machine sound card driver,
except that it forgot to update SC7280 card.
Just like for other Qualcomm sound cards using Soundwire, the card
driver should allocate and release the runtime. Otherwise sound
playback will result in a NULL pointer dereference or other effect of
uninitialized memory accesses (which was confirmed on SDM845 having
similar issue).
Cc: stable@vger.kernel.org
Cc: Alexey Klimov <alexey.klimov@linaro.org>
Cc: Steev Klimaszewski <steev@kali.org>
Fixes: 15c7fab0e047 ("ASoC: qcom: Move Soundwire runtime stream alloc to soundcards")
Link: [https://lore.kernel.org/r/20241010054109.16938-1-krzysztof.kozlowski@linaro.org](https://lore.kernel.org/r/20241010054109.16938-1-krzysztof.kozlowski%40linaro.org)
Signed-off-by: Krzysztof Kozlowski <krzysztof.kozlowski@linaro.org>
Link: [https://patch.msgid.link/20241012101108.129476-1-krzysztof.kozlowski@linaro.org](https://patch.msgid.link/20241012101108.129476-1-krzysztof.kozlowski%40linaro.org)
Signed-off-by: Mark Brown <broonie@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=db7e59e6a39a4d3d54ca8197c796557e6d480b0d)

| -rw-r--r-- | [sound/soc/qcom/Kconfig](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/soc/qcom/Kconfig?id=db7e59e6a39a4d3d54ca8197c796557e6d480b0d) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [sound/soc/qcom/sc7280.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/soc/qcom/sc7280.c?id=db7e59e6a39a4d3d54ca8197c796557e6d480b0d) | 10 | |  |  |  | | --- | --- | --- | |

2 files changed, 10 insertions, 1 deletions

| diff --git a/sound/soc/qcom/Kconfig b/sound/soc/qcom/Kconfigindex 3687b9db5ed469..ca7a30ebd26ab1 100644--- a/[sound/soc/qcom/Kconfig](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/qcom/Kconfig?id=b9a8ecf81066e01e8a3de35517481bc5aa0439e5)+++ b/[sound/soc/qcom/Kconfig](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/qcom/Kconfig?id=db7e59e6a39a4d3d54ca8197c796557e6d480b0d)@@ -209,6 +209,7 @@ config SND\_SOC\_SC7280 tristate "SoC Machine driver for SC7280 boards" depends on I2C && SOUNDWIRE select SND\_SOC\_QCOM\_COMMON+ select SND\_SOC\_QCOM\_SDW select SND\_SOC\_LPASS\_SC7280 select SND\_SOC\_MAX98357A select SND\_SOC\_WCD938X\_SDWdiff --git a/sound/soc/qcom/sc7280.c b/sound/soc/qcom/sc7280.cindex 207ac5da4dd430..230af8d7b205d4 100644--- a/[sound/soc/qcom/sc7280.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/qcom/sc7280.c?id=b9a8ecf81066e01e8a3de35517481bc5aa0439e5)+++ b/[sound/soc/qcom/sc7280.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/qcom/sc7280.c?id=db7e59e6a39a4d3d54ca8197c796557e6d480b0d)@@ -23,6 +23,7 @@ #include "common.h" #include "lpass.h" #include "qdsp6/q6afe.h"+#include "sdw.h"  #define DEFAULT\_MCLK\_RATE 19200000 #define RT5682\_PLL\_FREQ (48000 \* 512)@@ -316,6 +317,7 @@ static void sc7280\_snd\_shutdown(struct snd\_pcm\_substream \*substream) struct snd\_soc\_card \*card = rtd->card; struct sc7280\_snd\_data \*data = snd\_soc\_card\_get\_drvdata(card); struct snd\_soc\_dai \*cpu\_dai = snd\_soc\_rtd\_to\_cpu(rtd, 0);+ struct sdw\_stream\_runtime \*sruntime = data->sruntime[cpu\_dai->id];  switch (cpu\_dai->id) { case MI2S\_PRIMARY:@@ -333,6 +335,9 @@ static void sc7280\_snd\_shutdown(struct snd\_pcm\_substream \*substream) default: break; }++ data->sruntime[cpu\_dai->id] = NULL;+ sdw\_release\_stream(sruntime); }  static int sc7280\_snd\_startup(struct snd\_pcm\_substream \*substream)@@ -347,6 +352,8 @@ static int sc7280\_snd\_startup(struct snd\_pcm\_substream \*substream) switch (cpu\_dai->id) { case MI2S\_PRIMARY: ret = sc7280\_rt5682\_init(rtd);+ if (ret)+ return ret; break; case SECONDARY\_MI2S\_RX: codec\_dai\_fmt |= SND\_SOC\_DAIFMT\_NB\_NF | SND\_SOC\_DAIFMT\_I2S;@@ -360,7 +367,8 @@ static int sc7280\_snd\_startup(struct snd\_pcm\_substream \*substream) default: break; }- return ret;++ return qcom\_snd\_sdw\_startup(substream); }  static const struct snd\_soc\_ops sc7280\_ops = { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:26:43 +0000



=== Content from git.kernel.org_fc07697c_20250114_202805.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=176a41ebec42a921277cd34e8c0c2e776a9dd6c4)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=176a41ebec42a921277cd34e8c0c2e776a9dd6c4)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=176a41ebec42a921277cd34e8c0c2e776a9dd6c4)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=176a41ebec42a921277cd34e8c0c2e776a9dd6c4)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Krzysztof Kozlowski <krzysztof.kozlowski@linaro.org> | 2024-10-12 12:11:08 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-01 02:02:43 +0100 |
| commit | [176a41ebec42a921277cd34e8c0c2e776a9dd6c4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=176a41ebec42a921277cd34e8c0c2e776a9dd6c4) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=176a41ebec42a921277cd34e8c0c2e776a9dd6c4)) | |
| tree | [ba78e2b24ae50944a5db1cf14578cdb88310c921](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=176a41ebec42a921277cd34e8c0c2e776a9dd6c4) | |
| parent | [0fb250d3fc91a0a69fda83567e9a5da1a3cc9ae6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0fb250d3fc91a0a69fda83567e9a5da1a3cc9ae6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=176a41ebec42a921277cd34e8c0c2e776a9dd6c4&id2=0fb250d3fc91a0a69fda83567e9a5da1a3cc9ae6)) | |
| download | [linux-176a41ebec42a921277cd34e8c0c2e776a9dd6c4.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-176a41ebec42a921277cd34e8c0c2e776a9dd6c4.tar.gz) | |

ASoC: qcom: sc7280: Fix missing Soundwire runtime stream alloccommit db7e59e6a39a4d3d54ca8197c796557e6d480b0d upstream.
Commit 15c7fab0e047 ("ASoC: qcom: Move Soundwire runtime stream alloc to
soundcards") moved the allocation of Soundwire stream runtime from the
Qualcomm Soundwire driver to each individual machine sound card driver,
except that it forgot to update SC7280 card.
Just like for other Qualcomm sound cards using Soundwire, the card
driver should allocate and release the runtime. Otherwise sound
playback will result in a NULL pointer dereference or other effect of
uninitialized memory accesses (which was confirmed on SDM845 having
similar issue).
Cc: stable@vger.kernel.org
Cc: Alexey Klimov <alexey.klimov@linaro.org>
Cc: Steev Klimaszewski <steev@kali.org>
Fixes: 15c7fab0e047 ("ASoC: qcom: Move Soundwire runtime stream alloc to soundcards")
Link: [https://lore.kernel.org/r/20241010054109.16938-1-krzysztof.kozlowski@linaro.org](https://lore.kernel.org/r/20241010054109.16938-1-krzysztof.kozlowski%40linaro.org)
Signed-off-by: Krzysztof Kozlowski <krzysztof.kozlowski@linaro.org>
Link: [https://patch.msgid.link/20241012101108.129476-1-krzysztof.kozlowski@linaro.org](https://patch.msgid.link/20241012101108.129476-1-krzysztof.kozlowski%40linaro.org)
Signed-off-by: Mark Brown <broonie@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=176a41ebec42a921277cd34e8c0c2e776a9dd6c4)

| -rw-r--r-- | [sound/soc/qcom/Kconfig](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/soc/qcom/Kconfig?id=176a41ebec42a921277cd34e8c0c2e776a9dd6c4) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [sound/soc/qcom/sc7280.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/soc/qcom/sc7280.c?id=176a41ebec42a921277cd34e8c0c2e776a9dd6c4) | 10 | |  |  |  | | --- | --- | --- | |

2 files changed, 10 insertions, 1 deletions

| diff --git a/sound/soc/qcom/Kconfig b/sound/soc/qcom/Kconfigindex 762491d6f2f2e9..02a5d0a6e91876 100644--- a/[sound/soc/qcom/Kconfig](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/qcom/Kconfig?id=0fb250d3fc91a0a69fda83567e9a5da1a3cc9ae6)+++ b/[sound/soc/qcom/Kconfig](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/qcom/Kconfig?id=176a41ebec42a921277cd34e8c0c2e776a9dd6c4)@@ -208,6 +208,7 @@ config SND\_SOC\_SC7280 tristate "SoC Machine driver for SC7280 boards" depends on I2C && SOUNDWIRE select SND\_SOC\_QCOM\_COMMON+ select SND\_SOC\_QCOM\_SDW select SND\_SOC\_LPASS\_SC7280 select SND\_SOC\_MAX98357A select SND\_SOC\_WCD938X\_SDWdiff --git a/sound/soc/qcom/sc7280.c b/sound/soc/qcom/sc7280.cindex 207ac5da4dd430..230af8d7b205d4 100644--- a/[sound/soc/qcom/sc7280.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/qcom/sc7280.c?id=0fb250d3fc91a0a69fda83567e9a5da1a3cc9ae6)+++ b/[sound/soc/qcom/sc7280.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/qcom/sc7280.c?id=176a41ebec42a921277cd34e8c0c2e776a9dd6c4)@@ -23,6 +23,7 @@ #include "common.h" #include "lpass.h" #include "qdsp6/q6afe.h"+#include "sdw.h"  #define DEFAULT\_MCLK\_RATE 19200000 #define RT5682\_PLL\_FREQ (48000 \* 512)@@ -316,6 +317,7 @@ static void sc7280\_snd\_shutdown(struct snd\_pcm\_substream \*substream) struct snd\_soc\_card \*card = rtd->card; struct sc7280\_snd\_data \*data = snd\_soc\_card\_get\_drvdata(card); struct snd\_soc\_dai \*cpu\_dai = snd\_soc\_rtd\_to\_cpu(rtd, 0);+ struct sdw\_stream\_runtime \*sruntime = data->sruntime[cpu\_dai->id];  switch (cpu\_dai->id) { case MI2S\_PRIMARY:@@ -333,6 +335,9 @@ static void sc7280\_snd\_shutdown(struct snd\_pcm\_substream \*substream) default: break; }++ data->sruntime[cpu\_dai->id] = NULL;+ sdw\_release\_stream(sruntime); }  static int sc7280\_snd\_startup(struct snd\_pcm\_substream \*substream)@@ -347,6 +352,8 @@ static int sc7280\_snd\_startup(struct snd\_pcm\_substream \*substream) switch (cpu\_dai->id) { case MI2S\_PRIMARY: ret = sc7280\_rt5682\_init(rtd);+ if (ret)+ return ret; break; case SECONDARY\_MI2S\_RX: codec\_dai\_fmt |= SND\_SOC\_DAIFMT\_NB\_NF | SND\_SOC\_DAIFMT\_I2S;@@ -360,7 +367,8 @@ static int sc7280\_snd\_startup(struct snd\_pcm\_substream \*substream) default: break; }- return ret;++ return qcom\_snd\_sdw\_startup(substream); }  static const struct snd\_soc\_ops sc7280\_ops = { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:26:42 +0000


