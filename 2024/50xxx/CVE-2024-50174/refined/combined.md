=== Content from git.kernel.org_6ffb5fd7_20250115_093331.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8a585d553c11965332d7a2d74e79ef92a42bfc87)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8a585d553c11965332d7a2d74e79ef92a42bfc87)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8a585d553c11965332d7a2d74e79ef92a42bfc87)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8a585d553c11965332d7a2d74e79ef92a42bfc87)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Steven Price <steven.price@arm.com> | 2024-09-23 11:34:06 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-10 12:00:10 +0200 |
| commit | [8a585d553c11965332d7a2d74e79ef92a42bfc87](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8a585d553c11965332d7a2d74e79ef92a42bfc87) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8a585d553c11965332d7a2d74e79ef92a42bfc87)) | |
| tree | [7c346e8178f6feedc615dfd680bea89689083fcd](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8a585d553c11965332d7a2d74e79ef92a42bfc87) | |
| parent | [9ffcca5d7cb85ed1b0789849b1bb80b463d40d3b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9ffcca5d7cb85ed1b0789849b1bb80b463d40d3b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8a585d553c11965332d7a2d74e79ef92a42bfc87&id2=9ffcca5d7cb85ed1b0789849b1bb80b463d40d3b)) | |
| download | [linux-8a585d553c11965332d7a2d74e79ef92a42bfc87.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8a585d553c11965332d7a2d74e79ef92a42bfc87.tar.gz) | |

drm/panthor: Fix race when converting group handle to group object[ Upstream commit cac075706f298948898b1f63e81709df42afa75d ]
XArray provides it's own internal lock which protects the internal array
when entries are being simultaneously added and removed. However there
is still a race between retrieving the pointer from the XArray and
incrementing the reference count.
To avoid this race simply hold the internal XArray lock when
incrementing the reference count, this ensures there cannot be a racing
call to xa\_erase().
Fixes: de8548813824 ("drm/panthor: Add the scheduler logical block")
Signed-off-by: Steven Price <steven.price@arm.com>
Reviewed-by: Boris Brezillon <boris.brezillon@collabora.com>
Reviewed-by: Liviu Dudau <liviu.dudau@arm.com>
Link: [https://patchwork.freedesktop.org/patch/msgid/20240923103406.2509906-1-steven.price@arm.com](https://patchwork.freedesktop.org/patch/msgid/20240923103406.2509906-1-steven.price%40arm.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8a585d553c11965332d7a2d74e79ef92a42bfc87)

| -rw-r--r-- | [drivers/gpu/drm/panthor/panthor\_sched.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/panthor/panthor_sched.c?id=8a585d553c11965332d7a2d74e79ef92a42bfc87) | 16 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 14 insertions, 2 deletions

| diff --git a/drivers/gpu/drm/panthor/panthor\_sched.c b/drivers/gpu/drm/panthor/panthor\_sched.cindex 12b272a912f861..d21fe63ae22817 100644--- a/[drivers/gpu/drm/panthor/panthor\_sched.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/panthor/panthor_sched.c?id=9ffcca5d7cb85ed1b0789849b1bb80b463d40d3b)+++ b/[drivers/gpu/drm/panthor/panthor\_sched.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/panthor/panthor_sched.c?id=8a585d553c11965332d7a2d74e79ef92a42bfc87)@@ -3242,6 +3242,18 @@ int panthor\_group\_destroy(struct panthor\_file \*pfile, u32 group\_handle) return 0; } +static struct panthor\_group \*group\_from\_handle(struct panthor\_group\_pool \*pool,+ u32 group\_handle)+{+ struct panthor\_group \*group;++ xa\_lock(&pool->xa);+ group = group\_get(xa\_load(&pool->xa, group\_handle));+ xa\_unlock(&pool->xa);++ return group;+}+ int panthor\_group\_get\_state(struct panthor\_file \*pfile, struct drm\_panthor\_group\_get\_state \*get\_state) {@@ -3253,7 +3265,7 @@ int panthor\_group\_get\_state(struct panthor\_file \*pfile, if (get\_state->pad) return -EINVAL; - group = group\_get(xa\_load(&gpool->xa, get\_state->group\_handle));+ group = group\_from\_handle(gpool, get\_state->group\_handle); if (!group) return -EINVAL; @@ -3384,7 +3396,7 @@ panthor\_job\_create(struct panthor\_file \*pfile, job->call\_info.latest\_flush = qsubmit->latest\_flush; INIT\_LIST\_HEAD(&job->node); - job->group = group\_get(xa\_load(&gpool->xa, group\_handle));+ job->group = group\_from\_handle(gpool, group\_handle); if (!job->group) { ret = -EINVAL; goto err\_put\_job; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:32:09 +0000



=== Content from git.kernel.org_5beb03c7_20250115_093332.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=cac075706f298948898b1f63e81709df42afa75d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cac075706f298948898b1f63e81709df42afa75d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cac075706f298948898b1f63e81709df42afa75d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cac075706f298948898b1f63e81709df42afa75d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Steven Price <steven.price@arm.com> | 2024-09-23 11:34:06 +0100 |
| --- | --- | --- |
| committer | Steven Price <steven.price@arm.com> | 2024-09-23 16:09:21 +0100 |
| commit | [cac075706f298948898b1f63e81709df42afa75d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cac075706f298948898b1f63e81709df42afa75d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=cac075706f298948898b1f63e81709df42afa75d)) | |
| tree | [2bcb2d063c13c278f3dccc535aed3426f6e10fb3](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cac075706f298948898b1f63e81709df42afa75d) | |
| parent | [d92b90f9a54d9300a6e883258e79f36dab53bfae](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d92b90f9a54d9300a6e883258e79f36dab53bfae) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cac075706f298948898b1f63e81709df42afa75d&id2=d92b90f9a54d9300a6e883258e79f36dab53bfae)) | |
| download | [linux-cac075706f298948898b1f63e81709df42afa75d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-cac075706f298948898b1f63e81709df42afa75d.tar.gz) | |

drm/panthor: Fix race when converting group handle to group objectXArray provides it's own internal lock which protects the internal array
when entries are being simultaneously added and removed. However there
is still a race between retrieving the pointer from the XArray and
incrementing the reference count.
To avoid this race simply hold the internal XArray lock when
incrementing the reference count, this ensures there cannot be a racing
call to xa\_erase().
Fixes: de8548813824 ("drm/panthor: Add the scheduler logical block")
Signed-off-by: Steven Price <steven.price@arm.com>
Reviewed-by: Boris Brezillon <boris.brezillon@collabora.com>
Reviewed-by: Liviu Dudau <liviu.dudau@arm.com>
Link: [https://patchwork.freedesktop.org/patch/msgid/20240923103406.2509906-1-steven.price@arm.com](https://patchwork.freedesktop.org/patch/msgid/20240923103406.2509906-1-steven.price%40arm.com)
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cac075706f298948898b1f63e81709df42afa75d)

| -rw-r--r-- | [drivers/gpu/drm/panthor/panthor\_sched.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/panthor/panthor_sched.c?id=cac075706f298948898b1f63e81709df42afa75d) | 16 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 14 insertions, 2 deletions

| diff --git a/drivers/gpu/drm/panthor/panthor\_sched.c b/drivers/gpu/drm/panthor/panthor\_sched.cindex 12b272a912f861..d21fe63ae22817 100644--- a/[drivers/gpu/drm/panthor/panthor\_sched.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/panthor/panthor_sched.c?id=d92b90f9a54d9300a6e883258e79f36dab53bfae)+++ b/[drivers/gpu/drm/panthor/panthor\_sched.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/panthor/panthor_sched.c?id=cac075706f298948898b1f63e81709df42afa75d)@@ -3242,6 +3242,18 @@ int panthor\_group\_destroy(struct panthor\_file \*pfile, u32 group\_handle) return 0; } +static struct panthor\_group \*group\_from\_handle(struct panthor\_group\_pool \*pool,+ u32 group\_handle)+{+ struct panthor\_group \*group;++ xa\_lock(&pool->xa);+ group = group\_get(xa\_load(&pool->xa, group\_handle));+ xa\_unlock(&pool->xa);++ return group;+}+ int panthor\_group\_get\_state(struct panthor\_file \*pfile, struct drm\_panthor\_group\_get\_state \*get\_state) {@@ -3253,7 +3265,7 @@ int panthor\_group\_get\_state(struct panthor\_file \*pfile, if (get\_state->pad) return -EINVAL; - group = group\_get(xa\_load(&gpool->xa, get\_state->group\_handle));+ group = group\_from\_handle(gpool, get\_state->group\_handle); if (!group) return -EINVAL; @@ -3384,7 +3396,7 @@ panthor\_job\_create(struct panthor\_file \*pfile, job->call\_info.latest\_flush = qsubmit->latest\_flush; INIT\_LIST\_HEAD(&job->node); - job->group = group\_get(xa\_load(&gpool->xa, group\_handle));+ job->group = group\_from\_handle(gpool, group\_handle); if (!job->group) { ret = -EINVAL; goto err\_put\_job; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:32:09 +0000



=== Content from git.kernel.org_043f7140_20250115_093331.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=44742138d151c3a945460ae7beff8ae45ac0bf58)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=44742138d151c3a945460ae7beff8ae45ac0bf58)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=44742138d151c3a945460ae7beff8ae45ac0bf58)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=44742138d151c3a945460ae7beff8ae45ac0bf58)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Steven Price <steven.price@arm.com> | 2024-09-23 11:34:06 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-10 12:03:02 +0200 |
| commit | [44742138d151c3a945460ae7beff8ae45ac0bf58](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=44742138d151c3a945460ae7beff8ae45ac0bf58) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=44742138d151c3a945460ae7beff8ae45ac0bf58)) | |
| tree | [e6f598c97c724ab298a36dfd1a75e3c77d8095a4](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=44742138d151c3a945460ae7beff8ae45ac0bf58) | |
| parent | [5aedaec600ca5e0718ae833421b4ba1dfe65a4bb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5aedaec600ca5e0718ae833421b4ba1dfe65a4bb) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=44742138d151c3a945460ae7beff8ae45ac0bf58&id2=5aedaec600ca5e0718ae833421b4ba1dfe65a4bb)) | |
| download | [linux-44742138d151c3a945460ae7beff8ae45ac0bf58.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-44742138d151c3a945460ae7beff8ae45ac0bf58.tar.gz) | |

drm/panthor: Fix race when converting group handle to group object[ Upstream commit cac075706f298948898b1f63e81709df42afa75d ]
XArray provides it's own internal lock which protects the internal array
when entries are being simultaneously added and removed. However there
is still a race between retrieving the pointer from the XArray and
incrementing the reference count.
To avoid this race simply hold the internal XArray lock when
incrementing the reference count, this ensures there cannot be a racing
call to xa\_erase().
Fixes: de8548813824 ("drm/panthor: Add the scheduler logical block")
Signed-off-by: Steven Price <steven.price@arm.com>
Reviewed-by: Boris Brezillon <boris.brezillon@collabora.com>
Reviewed-by: Liviu Dudau <liviu.dudau@arm.com>
Link: [https://patchwork.freedesktop.org/patch/msgid/20240923103406.2509906-1-steven.price@arm.com](https://patchwork.freedesktop.org/patch/msgid/20240923103406.2509906-1-steven.price%40arm.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=44742138d151c3a945460ae7beff8ae45ac0bf58)

| -rw-r--r-- | [drivers/gpu/drm/panthor/panthor\_sched.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/panthor/panthor_sched.c?id=44742138d151c3a945460ae7beff8ae45ac0bf58) | 16 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 14 insertions, 2 deletions

| diff --git a/drivers/gpu/drm/panthor/panthor\_sched.c b/drivers/gpu/drm/panthor/panthor\_sched.cindex 12b272a912f861..d21fe63ae22817 100644--- a/[drivers/gpu/drm/panthor/panthor\_sched.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/panthor/panthor_sched.c?id=5aedaec600ca5e0718ae833421b4ba1dfe65a4bb)+++ b/[drivers/gpu/drm/panthor/panthor\_sched.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/panthor/panthor_sched.c?id=44742138d151c3a945460ae7beff8ae45ac0bf58)@@ -3242,6 +3242,18 @@ int panthor\_group\_destroy(struct panthor\_file \*pfile, u32 group\_handle) return 0; } +static struct panthor\_group \*group\_from\_handle(struct panthor\_group\_pool \*pool,+ u32 group\_handle)+{+ struct panthor\_group \*group;++ xa\_lock(&pool->xa);+ group = group\_get(xa\_load(&pool->xa, group\_handle));+ xa\_unlock(&pool->xa);++ return group;+}+ int panthor\_group\_get\_state(struct panthor\_file \*pfile, struct drm\_panthor\_group\_get\_state \*get\_state) {@@ -3253,7 +3265,7 @@ int panthor\_group\_get\_state(struct panthor\_file \*pfile, if (get\_state->pad) return -EINVAL; - group = group\_get(xa\_load(&gpool->xa, get\_state->group\_handle));+ group = group\_from\_handle(gpool, get\_state->group\_handle); if (!group) return -EINVAL; @@ -3384,7 +3396,7 @@ panthor\_job\_create(struct panthor\_file \*pfile, job->call\_info.latest\_flush = qsubmit->latest\_flush; INIT\_LIST\_HEAD(&job->node); - job->group = group\_get(xa\_load(&gpool->xa, group\_handle));+ job->group = group\_from\_handle(gpool, group\_handle); if (!job->group) { ret = -EINVAL; goto err\_put\_job; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:32:08 +0000


