=== Content from git.kernel.org_10d236c6_20250114_204739.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b9e52a96ec92245bf15dabba1d3d862d7a03efb8)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b9e52a96ec92245bf15dabba1d3d862d7a03efb8)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b9e52a96ec92245bf15dabba1d3d862d7a03efb8)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b9e52a96ec92245bf15dabba1d3d862d7a03efb8)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Prike Liang <Prike.Liang@amd.com> | 2024-10-31 10:59:17 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 20:00:08 +0100 |
| commit | [b9e52a96ec92245bf15dabba1d3d862d7a03efb8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b9e52a96ec92245bf15dabba1d3d862d7a03efb8) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b9e52a96ec92245bf15dabba1d3d862d7a03efb8)) | |
| tree | [af919fe2c60764a443e90f77311ca559b1a12fe6](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b9e52a96ec92245bf15dabba1d3d862d7a03efb8) | |
| parent | [83c45de6c6ce541c2536e53f17712eab36a6b7bb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=83c45de6c6ce541c2536e53f17712eab36a6b7bb) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b9e52a96ec92245bf15dabba1d3d862d7a03efb8&id2=83c45de6c6ce541c2536e53f17712eab36a6b7bb)) | |
| download | [linux-b9e52a96ec92245bf15dabba1d3d862d7a03efb8.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b9e52a96ec92245bf15dabba1d3d862d7a03efb8.tar.gz) | |

drm/amdgpu: set the right AMDGPU sg segment limitation[ Upstream commit e2e97435783979124ba92d6870415c57ecfef6a5 ]
The driver needs to set the correct max\_segment\_size;
otherwise debug\_dma\_map\_sg() will complain about the
over-mapping of the AMDGPU sg length as following:
WARNING: CPU: 6 PID: 1964 at kernel/dma/debug.c:1178 debug\_dma\_map\_sg+0x2dc/0x370
[ 364.049444] Modules linked in: veth amdgpu(OE) amdxcp drm\_exec gpu\_sched drm\_buddy drm\_ttm\_helper ttm(OE) drm\_suballoc\_helper drm\_display\_helper drm\_kms\_helper i2c\_algo\_bit rpcsec\_gss\_krb5 auth\_rpcgss nfsv4 nfs lockd grace netfs xt\_conntrack xt\_MASQUERADE nf\_conntrack\_netlink xfrm\_user xfrm\_algo iptable\_nat xt\_addrtype iptable\_filter br\_netfilter nvme\_fabrics overlay nfnetlink\_cttimeout nfnetlink openvswitch nsh nf\_conncount nf\_nat nf\_conntrack nf\_defrag\_ipv6 nf\_defrag\_ipv4 libcrc32c bridge stp llc amd\_atl intel\_rapl\_msr intel\_rapl\_common sunrpc sch\_fq\_codel snd\_hda\_codec\_realtek snd\_hda\_codec\_generic snd\_hda\_scodec\_component snd\_hda\_codec\_hdmi snd\_hda\_intel snd\_intel\_dspcfg edac\_mce\_amd binfmt\_misc snd\_hda\_codec snd\_pci\_acp6x snd\_hda\_core snd\_acp\_config snd\_hwdep snd\_soc\_acpi kvm\_amd snd\_pcm kvm snd\_seq\_midi snd\_seq\_midi\_event crct10dif\_pclmul ghash\_clmulni\_intel sha512\_ssse3 snd\_rawmidi sha256\_ssse3 sha1\_ssse3 aesni\_intel snd\_seq nls\_iso8859\_1 crypto\_simd snd\_seq\_device cryptd snd\_timer rapl input\_leds snd
[ 364.049532] ipmi\_devintf wmi\_bmof ccp serio\_raw k10temp sp5100\_tco soundcore ipmi\_msghandler cm32181 industrialio mac\_hid msr parport\_pc ppdev lp parport drm efi\_pstore ip\_tables x\_tables pci\_stub crc32\_pclmul nvme ahci libahci i2c\_piix4 r8169 nvme\_core i2c\_designware\_pci realtek i2c\_ccgx\_ucsi video wmi hid\_generic cdc\_ether usbnet usbhid hid r8152 mii
[ 364.049576] CPU: 6 PID: 1964 Comm: rocminfo Tainted: G OE 6.10.0-custom #492
[ 364.049579] Hardware name: AMD Majolica-RN/Majolica-RN, BIOS RMJ1009A 06/13/2021
[ 364.049582] RIP: 0010:debug\_dma\_map\_sg+0x2dc/0x370
[ 364.049585] Code: 89 4d b8 e8 36 b1 86 00 8b 4d b8 48 8b 55 b0 44 8b 45 a8 4c 8b 4d a0 48 89 c6 48 c7 c7 00 4b 74 bc 4c 89 4d b8 e8 b4 73 f3 ff <0f> 0b 4c 8b 4d b8 8b 15 c8 2c b8 01 85 d2 0f 85 ee fd ff ff 8b 05
[ 364.049588] RSP: 0018:ffff9ca600b57ac0 EFLAGS: 00010286
[ 364.049590] RAX: 0000000000000000 RBX: ffff88b7c132b0c8 RCX: 0000000000000027
[ 364.049592] RDX: ffff88bb0f521688 RSI: 0000000000000001 RDI: ffff88bb0f521680
[ 364.049594] RBP: ffff9ca600b57b20 R08: 000000000000006f R09: ffff9ca600b57930
[ 364.049596] R10: ffff9ca600b57928 R11: ffffffffbcb46328 R12: 0000000000000000
[ 364.049597] R13: 0000000000000001 R14: ffff88b7c19c0700 R15: ffff88b7c9059800
[ 364.049599] FS: 00007fb2d3516e80(0000) GS:ffff88bb0f500000(0000) knlGS:0000000000000000
[ 364.049601] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 364.049603] CR2: 000055610bd03598 CR3: 00000001049f6000 CR4: 0000000000350ef0
[ 364.049605] Call Trace:
[ 364.049607] <TASK>
[ 364.049609] ? show\_regs+0x6d/0x80
[ 364.049614] ? \_\_warn+0x8c/0x140
[ 364.049618] ? debug\_dma\_map\_sg+0x2dc/0x370
[ 364.049621] ? report\_bug+0x193/0x1a0
[ 364.049627] ? handle\_bug+0x46/0x80
[ 364.049631] ? exc\_invalid\_op+0x1d/0x80
[ 364.049635] ? asm\_exc\_invalid\_op+0x1f/0x30
[ 364.049642] ? debug\_dma\_map\_sg+0x2dc/0x370
[ 364.049647] \_\_dma\_map\_sg\_attrs+0x90/0xe0
[ 364.049651] dma\_map\_sgtable+0x25/0x40
[ 364.049654] amdgpu\_bo\_move+0x59a/0x850 [amdgpu]
[ 364.049935] ? srso\_return\_thunk+0x5/0x5f
[ 364.049939] ? amdgpu\_ttm\_tt\_populate+0x5d/0xc0 [amdgpu]
[ 364.050095] ttm\_bo\_handle\_move\_mem+0xc3/0x180 [ttm]
[ 364.050103] ttm\_bo\_validate+0xc1/0x160 [ttm]
[ 364.050108] ? amdgpu\_ttm\_tt\_get\_user\_pages+0xe5/0x1b0 [amdgpu]
[ 364.050263] amdgpu\_amdkfd\_gpuvm\_alloc\_memory\_of\_gpu+0xa12/0xc90 [amdgpu]
[ 364.050473] kfd\_ioctl\_alloc\_memory\_of\_gpu+0x16b/0x3b0 [amdgpu]
[ 364.050680] kfd\_ioctl+0x3c2/0x530 [amdgpu]
[ 364.050866] ? \_\_pfx\_kfd\_ioctl\_alloc\_memory\_of\_gpu+0x10/0x10 [amdgpu]
[ 364.051054] ? srso\_return\_thunk+0x5/0x5f
[ 364.051057] ? tomoyo\_file\_ioctl+0x20/0x30
[ 364.051063] \_\_x64\_sys\_ioctl+0x9c/0xd0
[ 364.051068] x64\_sys\_call+0x1219/0x20d0
[ 364.051073] do\_syscall\_64+0x51/0x120
[ 364.051077] entry\_SYSCALL\_64\_after\_hwframe+0x76/0x7e
[ 364.051081] RIP: 0033:0x7fb2d2f1a94f
Signed-off-by: Prike Liang <Prike.Liang@amd.com>
Reviewed-by: Christian König <christian.koenig@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b9e52a96ec92245bf15dabba1d3d862d7a03efb8)

| -rw-r--r-- | [drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/amdgpu/amdgpu_ttm.c?id=b9e52a96ec92245bf15dabba1d3d862d7a03efb8) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.c b/drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.cindex 6f06183e82b2b2..c89264242bea3a 100644--- a/[drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_ttm.c?id=83c45de6c6ce541c2536e53f17712eab36a6b7bb)+++ b/[drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_ttm.c?id=b9e52a96ec92245bf15dabba1d3d862d7a03efb8)@@ -1835,6 +1835,7 @@ int amdgpu\_ttm\_init(struct amdgpu\_device \*adev)  mutex\_init(&adev->mman.gtt\_window\_lock); + dma\_set\_max\_seg\_size(adev->dev, UINT\_MAX); /\* No others user of address space so set it to 0 \*/ r = ttm\_device\_init(&adev->mman.bdev, &amdgpu\_bo\_driver, adev->dev, adev\_to\_drm(adev)->anon\_inode->i\_mapping, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:46:16 +0000



=== Content from git.kernel.org_57881018_20250114_204741.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ff0346a74627a5f607a33a3852586f8c7f678329)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ff0346a74627a5f607a33a3852586f8c7f678329)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ff0346a74627a5f607a33a3852586f8c7f678329)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ff0346a74627a5f607a33a3852586f8c7f678329)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Prike Liang <Prike.Liang@amd.com> | 2024-10-31 10:59:17 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:54:44 +0100 |
| commit | [ff0346a74627a5f607a33a3852586f8c7f678329](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ff0346a74627a5f607a33a3852586f8c7f678329) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ff0346a74627a5f607a33a3852586f8c7f678329)) | |
| tree | [7ce59eabb2a8450076d3f7b99644d3c84917924e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ff0346a74627a5f607a33a3852586f8c7f678329) | |
| parent | [324a76b89f343a6e2d44b5787ea4617bba2d8e75](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=324a76b89f343a6e2d44b5787ea4617bba2d8e75) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ff0346a74627a5f607a33a3852586f8c7f678329&id2=324a76b89f343a6e2d44b5787ea4617bba2d8e75)) | |
| download | [linux-ff0346a74627a5f607a33a3852586f8c7f678329.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ff0346a74627a5f607a33a3852586f8c7f678329.tar.gz) | |

drm/amdgpu: set the right AMDGPU sg segment limitation[ Upstream commit e2e97435783979124ba92d6870415c57ecfef6a5 ]
The driver needs to set the correct max\_segment\_size;
otherwise debug\_dma\_map\_sg() will complain about the
over-mapping of the AMDGPU sg length as following:
WARNING: CPU: 6 PID: 1964 at kernel/dma/debug.c:1178 debug\_dma\_map\_sg+0x2dc/0x370
[ 364.049444] Modules linked in: veth amdgpu(OE) amdxcp drm\_exec gpu\_sched drm\_buddy drm\_ttm\_helper ttm(OE) drm\_suballoc\_helper drm\_display\_helper drm\_kms\_helper i2c\_algo\_bit rpcsec\_gss\_krb5 auth\_rpcgss nfsv4 nfs lockd grace netfs xt\_conntrack xt\_MASQUERADE nf\_conntrack\_netlink xfrm\_user xfrm\_algo iptable\_nat xt\_addrtype iptable\_filter br\_netfilter nvme\_fabrics overlay nfnetlink\_cttimeout nfnetlink openvswitch nsh nf\_conncount nf\_nat nf\_conntrack nf\_defrag\_ipv6 nf\_defrag\_ipv4 libcrc32c bridge stp llc amd\_atl intel\_rapl\_msr intel\_rapl\_common sunrpc sch\_fq\_codel snd\_hda\_codec\_realtek snd\_hda\_codec\_generic snd\_hda\_scodec\_component snd\_hda\_codec\_hdmi snd\_hda\_intel snd\_intel\_dspcfg edac\_mce\_amd binfmt\_misc snd\_hda\_codec snd\_pci\_acp6x snd\_hda\_core snd\_acp\_config snd\_hwdep snd\_soc\_acpi kvm\_amd snd\_pcm kvm snd\_seq\_midi snd\_seq\_midi\_event crct10dif\_pclmul ghash\_clmulni\_intel sha512\_ssse3 snd\_rawmidi sha256\_ssse3 sha1\_ssse3 aesni\_intel snd\_seq nls\_iso8859\_1 crypto\_simd snd\_seq\_device cryptd snd\_timer rapl input\_leds snd
[ 364.049532] ipmi\_devintf wmi\_bmof ccp serio\_raw k10temp sp5100\_tco soundcore ipmi\_msghandler cm32181 industrialio mac\_hid msr parport\_pc ppdev lp parport drm efi\_pstore ip\_tables x\_tables pci\_stub crc32\_pclmul nvme ahci libahci i2c\_piix4 r8169 nvme\_core i2c\_designware\_pci realtek i2c\_ccgx\_ucsi video wmi hid\_generic cdc\_ether usbnet usbhid hid r8152 mii
[ 364.049576] CPU: 6 PID: 1964 Comm: rocminfo Tainted: G OE 6.10.0-custom #492
[ 364.049579] Hardware name: AMD Majolica-RN/Majolica-RN, BIOS RMJ1009A 06/13/2021
[ 364.049582] RIP: 0010:debug\_dma\_map\_sg+0x2dc/0x370
[ 364.049585] Code: 89 4d b8 e8 36 b1 86 00 8b 4d b8 48 8b 55 b0 44 8b 45 a8 4c 8b 4d a0 48 89 c6 48 c7 c7 00 4b 74 bc 4c 89 4d b8 e8 b4 73 f3 ff <0f> 0b 4c 8b 4d b8 8b 15 c8 2c b8 01 85 d2 0f 85 ee fd ff ff 8b 05
[ 364.049588] RSP: 0018:ffff9ca600b57ac0 EFLAGS: 00010286
[ 364.049590] RAX: 0000000000000000 RBX: ffff88b7c132b0c8 RCX: 0000000000000027
[ 364.049592] RDX: ffff88bb0f521688 RSI: 0000000000000001 RDI: ffff88bb0f521680
[ 364.049594] RBP: ffff9ca600b57b20 R08: 000000000000006f R09: ffff9ca600b57930
[ 364.049596] R10: ffff9ca600b57928 R11: ffffffffbcb46328 R12: 0000000000000000
[ 364.049597] R13: 0000000000000001 R14: ffff88b7c19c0700 R15: ffff88b7c9059800
[ 364.049599] FS: 00007fb2d3516e80(0000) GS:ffff88bb0f500000(0000) knlGS:0000000000000000
[ 364.049601] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 364.049603] CR2: 000055610bd03598 CR3: 00000001049f6000 CR4: 0000000000350ef0
[ 364.049605] Call Trace:
[ 364.049607] <TASK>
[ 364.049609] ? show\_regs+0x6d/0x80
[ 364.049614] ? \_\_warn+0x8c/0x140
[ 364.049618] ? debug\_dma\_map\_sg+0x2dc/0x370
[ 364.049621] ? report\_bug+0x193/0x1a0
[ 364.049627] ? handle\_bug+0x46/0x80
[ 364.049631] ? exc\_invalid\_op+0x1d/0x80
[ 364.049635] ? asm\_exc\_invalid\_op+0x1f/0x30
[ 364.049642] ? debug\_dma\_map\_sg+0x2dc/0x370
[ 364.049647] \_\_dma\_map\_sg\_attrs+0x90/0xe0
[ 364.049651] dma\_map\_sgtable+0x25/0x40
[ 364.049654] amdgpu\_bo\_move+0x59a/0x850 [amdgpu]
[ 364.049935] ? srso\_return\_thunk+0x5/0x5f
[ 364.049939] ? amdgpu\_ttm\_tt\_populate+0x5d/0xc0 [amdgpu]
[ 364.050095] ttm\_bo\_handle\_move\_mem+0xc3/0x180 [ttm]
[ 364.050103] ttm\_bo\_validate+0xc1/0x160 [ttm]
[ 364.050108] ? amdgpu\_ttm\_tt\_get\_user\_pages+0xe5/0x1b0 [amdgpu]
[ 364.050263] amdgpu\_amdkfd\_gpuvm\_alloc\_memory\_of\_gpu+0xa12/0xc90 [amdgpu]
[ 364.050473] kfd\_ioctl\_alloc\_memory\_of\_gpu+0x16b/0x3b0 [amdgpu]
[ 364.050680] kfd\_ioctl+0x3c2/0x530 [amdgpu]
[ 364.050866] ? \_\_pfx\_kfd\_ioctl\_alloc\_memory\_of\_gpu+0x10/0x10 [amdgpu]
[ 364.051054] ? srso\_return\_thunk+0x5/0x5f
[ 364.051057] ? tomoyo\_file\_ioctl+0x20/0x30
[ 364.051063] \_\_x64\_sys\_ioctl+0x9c/0xd0
[ 364.051068] x64\_sys\_call+0x1219/0x20d0
[ 364.051073] do\_syscall\_64+0x51/0x120
[ 364.051077] entry\_SYSCALL\_64\_after\_hwframe+0x76/0x7e
[ 364.051081] RIP: 0033:0x7fb2d2f1a94f
Signed-off-by: Prike Liang <Prike.Liang@amd.com>
Reviewed-by: Christian König <christian.koenig@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ff0346a74627a5f607a33a3852586f8c7f678329)

| -rw-r--r-- | [drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/amdgpu/amdgpu_ttm.c?id=ff0346a74627a5f607a33a3852586f8c7f678329) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.c b/drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.cindex 2b15d938c779fc..725afb497805c4 100644--- a/[drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_ttm.c?id=324a76b89f343a6e2d44b5787ea4617bba2d8e75)+++ b/[drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_ttm.c?id=ff0346a74627a5f607a33a3852586f8c7f678329)@@ -1732,6 +1732,7 @@ int amdgpu\_ttm\_init(struct amdgpu\_device \*adev)  mutex\_init(&adev->mman.gtt\_window\_lock); + dma\_set\_max\_seg\_size(adev->dev, UINT\_MAX); /\* No others user of address space so set it to 0 \*/ r = ttm\_device\_init(&adev->mman.bdev, &amdgpu\_bo\_driver, adev->dev, adev\_to\_drm(adev)->anon\_inode->i\_mapping, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:46:18 +0000



=== Content from git.kernel.org_98a126d3_20250114_204738.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=76649ccf97e2cd72b62e34ed2fba6e0f89497eab)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=76649ccf97e2cd72b62e34ed2fba6e0f89497eab)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=76649ccf97e2cd72b62e34ed2fba6e0f89497eab)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=76649ccf97e2cd72b62e34ed2fba6e0f89497eab)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Prike Liang <Prike.Liang@amd.com> | 2024-10-31 10:59:17 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 20:03:54 +0100 |
| commit | [76649ccf97e2cd72b62e34ed2fba6e0f89497eab](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=76649ccf97e2cd72b62e34ed2fba6e0f89497eab) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=76649ccf97e2cd72b62e34ed2fba6e0f89497eab)) | |
| tree | [bd4857adcb881ee388ca283404779823e0e4b7e9](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=76649ccf97e2cd72b62e34ed2fba6e0f89497eab) | |
| parent | [920159e1bf176bdb34d77bb4c9c12fc360dce31f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=920159e1bf176bdb34d77bb4c9c12fc360dce31f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=76649ccf97e2cd72b62e34ed2fba6e0f89497eab&id2=920159e1bf176bdb34d77bb4c9c12fc360dce31f)) | |
| download | [linux-76649ccf97e2cd72b62e34ed2fba6e0f89497eab.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-76649ccf97e2cd72b62e34ed2fba6e0f89497eab.tar.gz) | |

drm/amdgpu: set the right AMDGPU sg segment limitation[ Upstream commit e2e97435783979124ba92d6870415c57ecfef6a5 ]
The driver needs to set the correct max\_segment\_size;
otherwise debug\_dma\_map\_sg() will complain about the
over-mapping of the AMDGPU sg length as following:
WARNING: CPU: 6 PID: 1964 at kernel/dma/debug.c:1178 debug\_dma\_map\_sg+0x2dc/0x370
[ 364.049444] Modules linked in: veth amdgpu(OE) amdxcp drm\_exec gpu\_sched drm\_buddy drm\_ttm\_helper ttm(OE) drm\_suballoc\_helper drm\_display\_helper drm\_kms\_helper i2c\_algo\_bit rpcsec\_gss\_krb5 auth\_rpcgss nfsv4 nfs lockd grace netfs xt\_conntrack xt\_MASQUERADE nf\_conntrack\_netlink xfrm\_user xfrm\_algo iptable\_nat xt\_addrtype iptable\_filter br\_netfilter nvme\_fabrics overlay nfnetlink\_cttimeout nfnetlink openvswitch nsh nf\_conncount nf\_nat nf\_conntrack nf\_defrag\_ipv6 nf\_defrag\_ipv4 libcrc32c bridge stp llc amd\_atl intel\_rapl\_msr intel\_rapl\_common sunrpc sch\_fq\_codel snd\_hda\_codec\_realtek snd\_hda\_codec\_generic snd\_hda\_scodec\_component snd\_hda\_codec\_hdmi snd\_hda\_intel snd\_intel\_dspcfg edac\_mce\_amd binfmt\_misc snd\_hda\_codec snd\_pci\_acp6x snd\_hda\_core snd\_acp\_config snd\_hwdep snd\_soc\_acpi kvm\_amd snd\_pcm kvm snd\_seq\_midi snd\_seq\_midi\_event crct10dif\_pclmul ghash\_clmulni\_intel sha512\_ssse3 snd\_rawmidi sha256\_ssse3 sha1\_ssse3 aesni\_intel snd\_seq nls\_iso8859\_1 crypto\_simd snd\_seq\_device cryptd snd\_timer rapl input\_leds snd
[ 364.049532] ipmi\_devintf wmi\_bmof ccp serio\_raw k10temp sp5100\_tco soundcore ipmi\_msghandler cm32181 industrialio mac\_hid msr parport\_pc ppdev lp parport drm efi\_pstore ip\_tables x\_tables pci\_stub crc32\_pclmul nvme ahci libahci i2c\_piix4 r8169 nvme\_core i2c\_designware\_pci realtek i2c\_ccgx\_ucsi video wmi hid\_generic cdc\_ether usbnet usbhid hid r8152 mii
[ 364.049576] CPU: 6 PID: 1964 Comm: rocminfo Tainted: G OE 6.10.0-custom #492
[ 364.049579] Hardware name: AMD Majolica-RN/Majolica-RN, BIOS RMJ1009A 06/13/2021
[ 364.049582] RIP: 0010:debug\_dma\_map\_sg+0x2dc/0x370
[ 364.049585] Code: 89 4d b8 e8 36 b1 86 00 8b 4d b8 48 8b 55 b0 44 8b 45 a8 4c 8b 4d a0 48 89 c6 48 c7 c7 00 4b 74 bc 4c 89 4d b8 e8 b4 73 f3 ff <0f> 0b 4c 8b 4d b8 8b 15 c8 2c b8 01 85 d2 0f 85 ee fd ff ff 8b 05
[ 364.049588] RSP: 0018:ffff9ca600b57ac0 EFLAGS: 00010286
[ 364.049590] RAX: 0000000000000000 RBX: ffff88b7c132b0c8 RCX: 0000000000000027
[ 364.049592] RDX: ffff88bb0f521688 RSI: 0000000000000001 RDI: ffff88bb0f521680
[ 364.049594] RBP: ffff9ca600b57b20 R08: 000000000000006f R09: ffff9ca600b57930
[ 364.049596] R10: ffff9ca600b57928 R11: ffffffffbcb46328 R12: 0000000000000000
[ 364.049597] R13: 0000000000000001 R14: ffff88b7c19c0700 R15: ffff88b7c9059800
[ 364.049599] FS: 00007fb2d3516e80(0000) GS:ffff88bb0f500000(0000) knlGS:0000000000000000
[ 364.049601] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 364.049603] CR2: 000055610bd03598 CR3: 00000001049f6000 CR4: 0000000000350ef0
[ 364.049605] Call Trace:
[ 364.049607] <TASK>
[ 364.049609] ? show\_regs+0x6d/0x80
[ 364.049614] ? \_\_warn+0x8c/0x140
[ 364.049618] ? debug\_dma\_map\_sg+0x2dc/0x370
[ 364.049621] ? report\_bug+0x193/0x1a0
[ 364.049627] ? handle\_bug+0x46/0x80
[ 364.049631] ? exc\_invalid\_op+0x1d/0x80
[ 364.049635] ? asm\_exc\_invalid\_op+0x1f/0x30
[ 364.049642] ? debug\_dma\_map\_sg+0x2dc/0x370
[ 364.049647] \_\_dma\_map\_sg\_attrs+0x90/0xe0
[ 364.049651] dma\_map\_sgtable+0x25/0x40
[ 364.049654] amdgpu\_bo\_move+0x59a/0x850 [amdgpu]
[ 364.049935] ? srso\_return\_thunk+0x5/0x5f
[ 364.049939] ? amdgpu\_ttm\_tt\_populate+0x5d/0xc0 [amdgpu]
[ 364.050095] ttm\_bo\_handle\_move\_mem+0xc3/0x180 [ttm]
[ 364.050103] ttm\_bo\_validate+0xc1/0x160 [ttm]
[ 364.050108] ? amdgpu\_ttm\_tt\_get\_user\_pages+0xe5/0x1b0 [amdgpu]
[ 364.050263] amdgpu\_amdkfd\_gpuvm\_alloc\_memory\_of\_gpu+0xa12/0xc90 [amdgpu]
[ 364.050473] kfd\_ioctl\_alloc\_memory\_of\_gpu+0x16b/0x3b0 [amdgpu]
[ 364.050680] kfd\_ioctl+0x3c2/0x530 [amdgpu]
[ 364.050866] ? \_\_pfx\_kfd\_ioctl\_alloc\_memory\_of\_gpu+0x10/0x10 [amdgpu]
[ 364.051054] ? srso\_return\_thunk+0x5/0x5f
[ 364.051057] ? tomoyo\_file\_ioctl+0x20/0x30
[ 364.051063] \_\_x64\_sys\_ioctl+0x9c/0xd0
[ 364.051068] x64\_sys\_call+0x1219/0x20d0
[ 364.051073] do\_syscall\_64+0x51/0x120
[ 364.051077] entry\_SYSCALL\_64\_after\_hwframe+0x76/0x7e
[ 364.051081] RIP: 0033:0x7fb2d2f1a94f
Signed-off-by: Prike Liang <Prike.Liang@amd.com>
Reviewed-by: Christian König <christian.koenig@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=76649ccf97e2cd72b62e34ed2fba6e0f89497eab)

| -rw-r--r-- | [drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/amdgpu/amdgpu_ttm.c?id=76649ccf97e2cd72b62e34ed2fba6e0f89497eab) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.c b/drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.cindex 0637414fc70e02..9f922ec50ea2dc 100644--- a/[drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_ttm.c?id=920159e1bf176bdb34d77bb4c9c12fc360dce31f)+++ b/[drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_ttm.c?id=76649ccf97e2cd72b62e34ed2fba6e0f89497eab)@@ -1851,6 +1851,7 @@ int amdgpu\_ttm\_init(struct amdgpu\_device \*adev)  mutex\_init(&adev->mman.gtt\_window\_lock); + dma\_set\_max\_seg\_size(adev->dev, UINT\_MAX); /\* No others user of address space so set it to 0 \*/ r = ttm\_device\_init(&adev->mman.bdev, &amdgpu\_bo\_driver, adev->dev, adev\_to\_drm(adev)->anon\_inode->i\_mapping, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:46:15 +0000



=== Content from git.kernel.org_ced045f8_20250114_204739.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b5807a08954fdf914ef80b49aaa6cda965ecc95c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b5807a08954fdf914ef80b49aaa6cda965ecc95c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b5807a08954fdf914ef80b49aaa6cda965ecc95c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b5807a08954fdf914ef80b49aaa6cda965ecc95c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Prike Liang <Prike.Liang@amd.com> | 2024-10-31 10:59:17 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:44:52 +0100 |
| commit | [b5807a08954fdf914ef80b49aaa6cda965ecc95c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b5807a08954fdf914ef80b49aaa6cda965ecc95c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b5807a08954fdf914ef80b49aaa6cda965ecc95c)) | |
| tree | [fe877cf2bc3e8cc208a51a9525a54d9ff196052e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b5807a08954fdf914ef80b49aaa6cda965ecc95c) | |
| parent | [b15000bcbecf27e0f7c0f149a409e5b865e28ca2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b15000bcbecf27e0f7c0f149a409e5b865e28ca2) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b5807a08954fdf914ef80b49aaa6cda965ecc95c&id2=b15000bcbecf27e0f7c0f149a409e5b865e28ca2)) | |
| download | [linux-b5807a08954fdf914ef80b49aaa6cda965ecc95c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b5807a08954fdf914ef80b49aaa6cda965ecc95c.tar.gz) | |

drm/amdgpu: set the right AMDGPU sg segment limitation[ Upstream commit e2e97435783979124ba92d6870415c57ecfef6a5 ]
The driver needs to set the correct max\_segment\_size;
otherwise debug\_dma\_map\_sg() will complain about the
over-mapping of the AMDGPU sg length as following:
WARNING: CPU: 6 PID: 1964 at kernel/dma/debug.c:1178 debug\_dma\_map\_sg+0x2dc/0x370
[ 364.049444] Modules linked in: veth amdgpu(OE) amdxcp drm\_exec gpu\_sched drm\_buddy drm\_ttm\_helper ttm(OE) drm\_suballoc\_helper drm\_display\_helper drm\_kms\_helper i2c\_algo\_bit rpcsec\_gss\_krb5 auth\_rpcgss nfsv4 nfs lockd grace netfs xt\_conntrack xt\_MASQUERADE nf\_conntrack\_netlink xfrm\_user xfrm\_algo iptable\_nat xt\_addrtype iptable\_filter br\_netfilter nvme\_fabrics overlay nfnetlink\_cttimeout nfnetlink openvswitch nsh nf\_conncount nf\_nat nf\_conntrack nf\_defrag\_ipv6 nf\_defrag\_ipv4 libcrc32c bridge stp llc amd\_atl intel\_rapl\_msr intel\_rapl\_common sunrpc sch\_fq\_codel snd\_hda\_codec\_realtek snd\_hda\_codec\_generic snd\_hda\_scodec\_component snd\_hda\_codec\_hdmi snd\_hda\_intel snd\_intel\_dspcfg edac\_mce\_amd binfmt\_misc snd\_hda\_codec snd\_pci\_acp6x snd\_hda\_core snd\_acp\_config snd\_hwdep snd\_soc\_acpi kvm\_amd snd\_pcm kvm snd\_seq\_midi snd\_seq\_midi\_event crct10dif\_pclmul ghash\_clmulni\_intel sha512\_ssse3 snd\_rawmidi sha256\_ssse3 sha1\_ssse3 aesni\_intel snd\_seq nls\_iso8859\_1 crypto\_simd snd\_seq\_device cryptd snd\_timer rapl input\_leds snd
[ 364.049532] ipmi\_devintf wmi\_bmof ccp serio\_raw k10temp sp5100\_tco soundcore ipmi\_msghandler cm32181 industrialio mac\_hid msr parport\_pc ppdev lp parport drm efi\_pstore ip\_tables x\_tables pci\_stub crc32\_pclmul nvme ahci libahci i2c\_piix4 r8169 nvme\_core i2c\_designware\_pci realtek i2c\_ccgx\_ucsi video wmi hid\_generic cdc\_ether usbnet usbhid hid r8152 mii
[ 364.049576] CPU: 6 PID: 1964 Comm: rocminfo Tainted: G OE 6.10.0-custom #492
[ 364.049579] Hardware name: AMD Majolica-RN/Majolica-RN, BIOS RMJ1009A 06/13/2021
[ 364.049582] RIP: 0010:debug\_dma\_map\_sg+0x2dc/0x370
[ 364.049585] Code: 89 4d b8 e8 36 b1 86 00 8b 4d b8 48 8b 55 b0 44 8b 45 a8 4c 8b 4d a0 48 89 c6 48 c7 c7 00 4b 74 bc 4c 89 4d b8 e8 b4 73 f3 ff <0f> 0b 4c 8b 4d b8 8b 15 c8 2c b8 01 85 d2 0f 85 ee fd ff ff 8b 05
[ 364.049588] RSP: 0018:ffff9ca600b57ac0 EFLAGS: 00010286
[ 364.049590] RAX: 0000000000000000 RBX: ffff88b7c132b0c8 RCX: 0000000000000027
[ 364.049592] RDX: ffff88bb0f521688 RSI: 0000000000000001 RDI: ffff88bb0f521680
[ 364.049594] RBP: ffff9ca600b57b20 R08: 000000000000006f R09: ffff9ca600b57930
[ 364.049596] R10: ffff9ca600b57928 R11: ffffffffbcb46328 R12: 0000000000000000
[ 364.049597] R13: 0000000000000001 R14: ffff88b7c19c0700 R15: ffff88b7c9059800
[ 364.049599] FS: 00007fb2d3516e80(0000) GS:ffff88bb0f500000(0000) knlGS:0000000000000000
[ 364.049601] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 364.049603] CR2: 000055610bd03598 CR3: 00000001049f6000 CR4: 0000000000350ef0
[ 364.049605] Call Trace:
[ 364.049607] <TASK>
[ 364.049609] ? show\_regs+0x6d/0x80
[ 364.049614] ? \_\_warn+0x8c/0x140
[ 364.049618] ? debug\_dma\_map\_sg+0x2dc/0x370
[ 364.049621] ? report\_bug+0x193/0x1a0
[ 364.049627] ? handle\_bug+0x46/0x80
[ 364.049631] ? exc\_invalid\_op+0x1d/0x80
[ 364.049635] ? asm\_exc\_invalid\_op+0x1f/0x30
[ 364.049642] ? debug\_dma\_map\_sg+0x2dc/0x370
[ 364.049647] \_\_dma\_map\_sg\_attrs+0x90/0xe0
[ 364.049651] dma\_map\_sgtable+0x25/0x40
[ 364.049654] amdgpu\_bo\_move+0x59a/0x850 [amdgpu]
[ 364.049935] ? srso\_return\_thunk+0x5/0x5f
[ 364.049939] ? amdgpu\_ttm\_tt\_populate+0x5d/0xc0 [amdgpu]
[ 364.050095] ttm\_bo\_handle\_move\_mem+0xc3/0x180 [ttm]
[ 364.050103] ttm\_bo\_validate+0xc1/0x160 [ttm]
[ 364.050108] ? amdgpu\_ttm\_tt\_get\_user\_pages+0xe5/0x1b0 [amdgpu]
[ 364.050263] amdgpu\_amdkfd\_gpuvm\_alloc\_memory\_of\_gpu+0xa12/0xc90 [amdgpu]
[ 364.050473] kfd\_ioctl\_alloc\_memory\_of\_gpu+0x16b/0x3b0 [amdgpu]
[ 364.050680] kfd\_ioctl+0x3c2/0x530 [amdgpu]
[ 364.050866] ? \_\_pfx\_kfd\_ioctl\_alloc\_memory\_of\_gpu+0x10/0x10 [amdgpu]
[ 364.051054] ? srso\_return\_thunk+0x5/0x5f
[ 364.051057] ? tomoyo\_file\_ioctl+0x20/0x30
[ 364.051063] \_\_x64\_sys\_ioctl+0x9c/0xd0
[ 364.051068] x64\_sys\_call+0x1219/0x20d0
[ 364.051073] do\_syscall\_64+0x51/0x120
[ 364.051077] entry\_SYSCALL\_64\_after\_hwframe+0x76/0x7e
[ 364.051081] RIP: 0033:0x7fb2d2f1a94f
Signed-off-by: Prike Liang <Prike.Liang@amd.com>
Reviewed-by: Christian König <christian.koenig@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b5807a08954fdf914ef80b49aaa6cda965ecc95c)

| -rw-r--r-- | [drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/amdgpu/amdgpu_ttm.c?id=b5807a08954fdf914ef80b49aaa6cda965ecc95c) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.c b/drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.cindex 870dd78d5a21ad..30e3cc9c25d031 100644--- a/[drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_ttm.c?id=b15000bcbecf27e0f7c0f149a409e5b865e28ca2)+++ b/[drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_ttm.c?id=b5807a08954fdf914ef80b49aaa6cda965ecc95c)@@ -1678,6 +1678,7 @@ int amdgpu\_ttm\_init(struct amdgpu\_device \*adev)  mutex\_init(&adev->mman.gtt\_window\_lock); + dma\_set\_max\_seg\_size(adev->dev, UINT\_MAX); /\* No others user of address space so set it to 0 \*/ r = ttm\_bo\_device\_init(&adev->mman.bdev, &amdgpu\_bo\_driver, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:46:16 +0000



=== Content from git.kernel.org_0dd96f73_20250114_204740.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e2e97435783979124ba92d6870415c57ecfef6a5)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e2e97435783979124ba92d6870415c57ecfef6a5)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e2e97435783979124ba92d6870415c57ecfef6a5)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e2e97435783979124ba92d6870415c57ecfef6a5)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Prike Liang <Prike.Liang@amd.com> | 2024-10-31 10:59:17 +0800 |
| --- | --- | --- |
| committer | Alex Deucher <alexander.deucher@amd.com> | 2024-11-05 10:35:26 -0500 |
| commit | [e2e97435783979124ba92d6870415c57ecfef6a5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e2e97435783979124ba92d6870415c57ecfef6a5) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e2e97435783979124ba92d6870415c57ecfef6a5)) | |
| tree | [9f9e54fbf13d7c6a3e17257a00396b3b303df7f2](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e2e97435783979124ba92d6870415c57ecfef6a5) | |
| parent | [990c4f580742de7bb78fa57420ffd182fc3ab4cd](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=990c4f580742de7bb78fa57420ffd182fc3ab4cd) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e2e97435783979124ba92d6870415c57ecfef6a5&id2=990c4f580742de7bb78fa57420ffd182fc3ab4cd)) | |
| download | [linux-e2e97435783979124ba92d6870415c57ecfef6a5.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e2e97435783979124ba92d6870415c57ecfef6a5.tar.gz) | |

drm/amdgpu: set the right AMDGPU sg segment limitationThe driver needs to set the correct max\_segment\_size;
otherwise debug\_dma\_map\_sg() will complain about the
over-mapping of the AMDGPU sg length as following:
WARNING: CPU: 6 PID: 1964 at kernel/dma/debug.c:1178 debug\_dma\_map\_sg+0x2dc/0x370
[ 364.049444] Modules linked in: veth amdgpu(OE) amdxcp drm\_exec gpu\_sched drm\_buddy drm\_ttm\_helper ttm(OE) drm\_suballoc\_helper drm\_display\_helper drm\_kms\_helper i2c\_algo\_bit rpcsec\_gss\_krb5 auth\_rpcgss nfsv4 nfs lockd grace netfs xt\_conntrack xt\_MASQUERADE nf\_conntrack\_netlink xfrm\_user xfrm\_algo iptable\_nat xt\_addrtype iptable\_filter br\_netfilter nvme\_fabrics overlay nfnetlink\_cttimeout nfnetlink openvswitch nsh nf\_conncount nf\_nat nf\_conntrack nf\_defrag\_ipv6 nf\_defrag\_ipv4 libcrc32c bridge stp llc amd\_atl intel\_rapl\_msr intel\_rapl\_common sunrpc sch\_fq\_codel snd\_hda\_codec\_realtek snd\_hda\_codec\_generic snd\_hda\_scodec\_component snd\_hda\_codec\_hdmi snd\_hda\_intel snd\_intel\_dspcfg edac\_mce\_amd binfmt\_misc snd\_hda\_codec snd\_pci\_acp6x snd\_hda\_core snd\_acp\_config snd\_hwdep snd\_soc\_acpi kvm\_amd snd\_pcm kvm snd\_seq\_midi snd\_seq\_midi\_event crct10dif\_pclmul ghash\_clmulni\_intel sha512\_ssse3 snd\_rawmidi sha256\_ssse3 sha1\_ssse3 aesni\_intel snd\_seq nls\_iso8859\_1 crypto\_simd snd\_seq\_device cryptd snd\_timer rapl input\_leds snd
[ 364.049532] ipmi\_devintf wmi\_bmof ccp serio\_raw k10temp sp5100\_tco soundcore ipmi\_msghandler cm32181 industrialio mac\_hid msr parport\_pc ppdev lp parport drm efi\_pstore ip\_tables x\_tables pci\_stub crc32\_pclmul nvme ahci libahci i2c\_piix4 r8169 nvme\_core i2c\_designware\_pci realtek i2c\_ccgx\_ucsi video wmi hid\_generic cdc\_ether usbnet usbhid hid r8152 mii
[ 364.049576] CPU: 6 PID: 1964 Comm: rocminfo Tainted: G OE 6.10.0-custom #492
[ 364.049579] Hardware name: AMD Majolica-RN/Majolica-RN, BIOS RMJ1009A 06/13/2021
[ 364.049582] RIP: 0010:debug\_dma\_map\_sg+0x2dc/0x370
[ 364.049585] Code: 89 4d b8 e8 36 b1 86 00 8b 4d b8 48 8b 55 b0 44 8b 45 a8 4c 8b 4d a0 48 89 c6 48 c7 c7 00 4b 74 bc 4c 89 4d b8 e8 b4 73 f3 ff <0f> 0b 4c 8b 4d b8 8b 15 c8 2c b8 01 85 d2 0f 85 ee fd ff ff 8b 05
[ 364.049588] RSP: 0018:ffff9ca600b57ac0 EFLAGS: 00010286
[ 364.049590] RAX: 0000000000000000 RBX: ffff88b7c132b0c8 RCX: 0000000000000027
[ 364.049592] RDX: ffff88bb0f521688 RSI: 0000000000000001 RDI: ffff88bb0f521680
[ 364.049594] RBP: ffff9ca600b57b20 R08: 000000000000006f R09: ffff9ca600b57930
[ 364.049596] R10: ffff9ca600b57928 R11: ffffffffbcb46328 R12: 0000000000000000
[ 364.049597] R13: 0000000000000001 R14: ffff88b7c19c0700 R15: ffff88b7c9059800
[ 364.049599] FS: 00007fb2d3516e80(0000) GS:ffff88bb0f500000(0000) knlGS:0000000000000000
[ 364.049601] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 364.049603] CR2: 000055610bd03598 CR3: 00000001049f6000 CR4: 0000000000350ef0
[ 364.049605] Call Trace:
[ 364.049607] <TASK>
[ 364.049609] ? show\_regs+0x6d/0x80
[ 364.049614] ? \_\_warn+0x8c/0x140
[ 364.049618] ? debug\_dma\_map\_sg+0x2dc/0x370
[ 364.049621] ? report\_bug+0x193/0x1a0
[ 364.049627] ? handle\_bug+0x46/0x80
[ 364.049631] ? exc\_invalid\_op+0x1d/0x80
[ 364.049635] ? asm\_exc\_invalid\_op+0x1f/0x30
[ 364.049642] ? debug\_dma\_map\_sg+0x2dc/0x370
[ 364.049647] \_\_dma\_map\_sg\_attrs+0x90/0xe0
[ 364.049651] dma\_map\_sgtable+0x25/0x40
[ 364.049654] amdgpu\_bo\_move+0x59a/0x850 [amdgpu]
[ 364.049935] ? srso\_return\_thunk+0x5/0x5f
[ 364.049939] ? amdgpu\_ttm\_tt\_populate+0x5d/0xc0 [amdgpu]
[ 364.050095] ttm\_bo\_handle\_move\_mem+0xc3/0x180 [ttm]
[ 364.050103] ttm\_bo\_validate+0xc1/0x160 [ttm]
[ 364.050108] ? amdgpu\_ttm\_tt\_get\_user\_pages+0xe5/0x1b0 [amdgpu]
[ 364.050263] amdgpu\_amdkfd\_gpuvm\_alloc\_memory\_of\_gpu+0xa12/0xc90 [amdgpu]
[ 364.050473] kfd\_ioctl\_alloc\_memory\_of\_gpu+0x16b/0x3b0 [amdgpu]
[ 364.050680] kfd\_ioctl+0x3c2/0x530 [amdgpu]
[ 364.050866] ? \_\_pfx\_kfd\_ioctl\_alloc\_memory\_of\_gpu+0x10/0x10 [amdgpu]
[ 364.051054] ? srso\_return\_thunk+0x5/0x5f
[ 364.051057] ? tomoyo\_file\_ioctl+0x20/0x30
[ 364.051063] \_\_x64\_sys\_ioctl+0x9c/0xd0
[ 364.051068] x64\_sys\_call+0x1219/0x20d0
[ 364.051073] do\_syscall\_64+0x51/0x120
[ 364.051077] entry\_SYSCALL\_64\_after\_hwframe+0x76/0x7e
[ 364.051081] RIP: 0033:0x7fb2d2f1a94f
Signed-off-by: Prike Liang <Prike.Liang@amd.com>
Reviewed-by: Christian König <christian.koenig@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e2e97435783979124ba92d6870415c57ecfef6a5)

| -rw-r--r-- | [drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/amdgpu/amdgpu_ttm.c?id=e2e97435783979124ba92d6870415c57ecfef6a5) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.c b/drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.cindex 0637414fc70e02..9f922ec50ea2dc 100644--- a/[drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_ttm.c?id=990c4f580742de7bb78fa57420ffd182fc3ab4cd)+++ b/[drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_ttm.c?id=e2e97435783979124ba92d6870415c57ecfef6a5)@@ -1851,6 +1851,7 @@ int amdgpu\_ttm\_init(struct amdgpu\_device \*adev)  mutex\_init(&adev->mman.gtt\_window\_lock); + dma\_set\_max\_seg\_size(adev->dev, UINT\_MAX); /\* No others user of address space so set it to 0 \*/ r = ttm\_device\_init(&adev->mman.bdev, &amdgpu\_bo\_driver, adev->dev, adev\_to\_drm(adev)->anon\_inode->i\_mapping, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:46:17 +0000



=== Content from git.kernel.org_f94997ed_20250114_204737.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=13c3a54f48a612a117dfd82a9dd91732261e869d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=13c3a54f48a612a117dfd82a9dd91732261e869d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=13c3a54f48a612a117dfd82a9dd91732261e869d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=13c3a54f48a612a117dfd82a9dd91732261e869d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Prike Liang <Prike.Liang@amd.com> | 2024-10-31 10:59:17 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:48:29 +0100 |
| commit | [13c3a54f48a612a117dfd82a9dd91732261e869d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=13c3a54f48a612a117dfd82a9dd91732261e869d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=13c3a54f48a612a117dfd82a9dd91732261e869d)) | |
| tree | [2dcecb61083cbfeaffa41aaf168a8fc83e9efc0e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=13c3a54f48a612a117dfd82a9dd91732261e869d) | |
| parent | [03c4c3e02cf9d4e3d2ae59668b9eb85a051c1a15](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=03c4c3e02cf9d4e3d2ae59668b9eb85a051c1a15) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=13c3a54f48a612a117dfd82a9dd91732261e869d&id2=03c4c3e02cf9d4e3d2ae59668b9eb85a051c1a15)) | |
| download | [linux-13c3a54f48a612a117dfd82a9dd91732261e869d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-13c3a54f48a612a117dfd82a9dd91732261e869d.tar.gz) | |

drm/amdgpu: set the right AMDGPU sg segment limitation[ Upstream commit e2e97435783979124ba92d6870415c57ecfef6a5 ]
The driver needs to set the correct max\_segment\_size;
otherwise debug\_dma\_map\_sg() will complain about the
over-mapping of the AMDGPU sg length as following:
WARNING: CPU: 6 PID: 1964 at kernel/dma/debug.c:1178 debug\_dma\_map\_sg+0x2dc/0x370
[ 364.049444] Modules linked in: veth amdgpu(OE) amdxcp drm\_exec gpu\_sched drm\_buddy drm\_ttm\_helper ttm(OE) drm\_suballoc\_helper drm\_display\_helper drm\_kms\_helper i2c\_algo\_bit rpcsec\_gss\_krb5 auth\_rpcgss nfsv4 nfs lockd grace netfs xt\_conntrack xt\_MASQUERADE nf\_conntrack\_netlink xfrm\_user xfrm\_algo iptable\_nat xt\_addrtype iptable\_filter br\_netfilter nvme\_fabrics overlay nfnetlink\_cttimeout nfnetlink openvswitch nsh nf\_conncount nf\_nat nf\_conntrack nf\_defrag\_ipv6 nf\_defrag\_ipv4 libcrc32c bridge stp llc amd\_atl intel\_rapl\_msr intel\_rapl\_common sunrpc sch\_fq\_codel snd\_hda\_codec\_realtek snd\_hda\_codec\_generic snd\_hda\_scodec\_component snd\_hda\_codec\_hdmi snd\_hda\_intel snd\_intel\_dspcfg edac\_mce\_amd binfmt\_misc snd\_hda\_codec snd\_pci\_acp6x snd\_hda\_core snd\_acp\_config snd\_hwdep snd\_soc\_acpi kvm\_amd snd\_pcm kvm snd\_seq\_midi snd\_seq\_midi\_event crct10dif\_pclmul ghash\_clmulni\_intel sha512\_ssse3 snd\_rawmidi sha256\_ssse3 sha1\_ssse3 aesni\_intel snd\_seq nls\_iso8859\_1 crypto\_simd snd\_seq\_device cryptd snd\_timer rapl input\_leds snd
[ 364.049532] ipmi\_devintf wmi\_bmof ccp serio\_raw k10temp sp5100\_tco soundcore ipmi\_msghandler cm32181 industrialio mac\_hid msr parport\_pc ppdev lp parport drm efi\_pstore ip\_tables x\_tables pci\_stub crc32\_pclmul nvme ahci libahci i2c\_piix4 r8169 nvme\_core i2c\_designware\_pci realtek i2c\_ccgx\_ucsi video wmi hid\_generic cdc\_ether usbnet usbhid hid r8152 mii
[ 364.049576] CPU: 6 PID: 1964 Comm: rocminfo Tainted: G OE 6.10.0-custom #492
[ 364.049579] Hardware name: AMD Majolica-RN/Majolica-RN, BIOS RMJ1009A 06/13/2021
[ 364.049582] RIP: 0010:debug\_dma\_map\_sg+0x2dc/0x370
[ 364.049585] Code: 89 4d b8 e8 36 b1 86 00 8b 4d b8 48 8b 55 b0 44 8b 45 a8 4c 8b 4d a0 48 89 c6 48 c7 c7 00 4b 74 bc 4c 89 4d b8 e8 b4 73 f3 ff <0f> 0b 4c 8b 4d b8 8b 15 c8 2c b8 01 85 d2 0f 85 ee fd ff ff 8b 05
[ 364.049588] RSP: 0018:ffff9ca600b57ac0 EFLAGS: 00010286
[ 364.049590] RAX: 0000000000000000 RBX: ffff88b7c132b0c8 RCX: 0000000000000027
[ 364.049592] RDX: ffff88bb0f521688 RSI: 0000000000000001 RDI: ffff88bb0f521680
[ 364.049594] RBP: ffff9ca600b57b20 R08: 000000000000006f R09: ffff9ca600b57930
[ 364.049596] R10: ffff9ca600b57928 R11: ffffffffbcb46328 R12: 0000000000000000
[ 364.049597] R13: 0000000000000001 R14: ffff88b7c19c0700 R15: ffff88b7c9059800
[ 364.049599] FS: 00007fb2d3516e80(0000) GS:ffff88bb0f500000(0000) knlGS:0000000000000000
[ 364.049601] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 364.049603] CR2: 000055610bd03598 CR3: 00000001049f6000 CR4: 0000000000350ef0
[ 364.049605] Call Trace:
[ 364.049607] <TASK>
[ 364.049609] ? show\_regs+0x6d/0x80
[ 364.049614] ? \_\_warn+0x8c/0x140
[ 364.049618] ? debug\_dma\_map\_sg+0x2dc/0x370
[ 364.049621] ? report\_bug+0x193/0x1a0
[ 364.049627] ? handle\_bug+0x46/0x80
[ 364.049631] ? exc\_invalid\_op+0x1d/0x80
[ 364.049635] ? asm\_exc\_invalid\_op+0x1f/0x30
[ 364.049642] ? debug\_dma\_map\_sg+0x2dc/0x370
[ 364.049647] \_\_dma\_map\_sg\_attrs+0x90/0xe0
[ 364.049651] dma\_map\_sgtable+0x25/0x40
[ 364.049654] amdgpu\_bo\_move+0x59a/0x850 [amdgpu]
[ 364.049935] ? srso\_return\_thunk+0x5/0x5f
[ 364.049939] ? amdgpu\_ttm\_tt\_populate+0x5d/0xc0 [amdgpu]
[ 364.050095] ttm\_bo\_handle\_move\_mem+0xc3/0x180 [ttm]
[ 364.050103] ttm\_bo\_validate+0xc1/0x160 [ttm]
[ 364.050108] ? amdgpu\_ttm\_tt\_get\_user\_pages+0xe5/0x1b0 [amdgpu]
[ 364.050263] amdgpu\_amdkfd\_gpuvm\_alloc\_memory\_of\_gpu+0xa12/0xc90 [amdgpu]
[ 364.050473] kfd\_ioctl\_alloc\_memory\_of\_gpu+0x16b/0x3b0 [amdgpu]
[ 364.050680] kfd\_ioctl+0x3c2/0x530 [amdgpu]
[ 364.050866] ? \_\_pfx\_kfd\_ioctl\_alloc\_memory\_of\_gpu+0x10/0x10 [amdgpu]
[ 364.051054] ? srso\_return\_thunk+0x5/0x5f
[ 364.051057] ? tomoyo\_file\_ioctl+0x20/0x30
[ 364.051063] \_\_x64\_sys\_ioctl+0x9c/0xd0
[ 364.051068] x64\_sys\_call+0x1219/0x20d0
[ 364.051073] do\_syscall\_64+0x51/0x120
[ 364.051077] entry\_SYSCALL\_64\_after\_hwframe+0x76/0x7e
[ 364.051081] RIP: 0033:0x7fb2d2f1a94f
Signed-off-by: Prike Liang <Prike.Liang@amd.com>
Reviewed-by: Christian König <christian.koenig@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=13c3a54f48a612a117dfd82a9dd91732261e869d)

| -rw-r--r-- | [drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/amdgpu/amdgpu_ttm.c?id=13c3a54f48a612a117dfd82a9dd91732261e869d) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.c b/drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.cindex 8196a8e2532660..02fdee7820a927 100644--- a/[drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_ttm.c?id=03c4c3e02cf9d4e3d2ae59668b9eb85a051c1a15)+++ b/[drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_ttm.c?id=13c3a54f48a612a117dfd82a9dd91732261e869d)@@ -1886,6 +1886,7 @@ int amdgpu\_ttm\_init(struct amdgpu\_device \*adev)  mutex\_init(&adev->mman.gtt\_window\_lock); + dma\_set\_max\_seg\_size(adev->dev, UINT\_MAX); /\* No others user of address space so set it to 0 \*/ r = ttm\_bo\_device\_init(&adev->mman.bdev, &amdgpu\_bo\_driver, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:46:13 +0000



=== Content from git.kernel.org_0679fe12_20250114_204737.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=76581147b05c2adb6b47bbc697521725f10224e4)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=76581147b05c2adb6b47bbc697521725f10224e4)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=76581147b05c2adb6b47bbc697521725f10224e4)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=76581147b05c2adb6b47bbc697521725f10224e4)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Prike Liang <Prike.Liang@amd.com> | 2024-10-31 10:59:17 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:51:39 +0100 |
| commit | [76581147b05c2adb6b47bbc697521725f10224e4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=76581147b05c2adb6b47bbc697521725f10224e4) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=76581147b05c2adb6b47bbc697521725f10224e4)) | |
| tree | [2551b3cbfc4e370908abf3037ff519564e81f97d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=76581147b05c2adb6b47bbc697521725f10224e4) | |
| parent | [53b03a43a881b0ab2ec0f980c4462b43ea92e264](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=53b03a43a881b0ab2ec0f980c4462b43ea92e264) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=76581147b05c2adb6b47bbc697521725f10224e4&id2=53b03a43a881b0ab2ec0f980c4462b43ea92e264)) | |
| download | [linux-76581147b05c2adb6b47bbc697521725f10224e4.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-76581147b05c2adb6b47bbc697521725f10224e4.tar.gz) | |

drm/amdgpu: set the right AMDGPU sg segment limitation[ Upstream commit e2e97435783979124ba92d6870415c57ecfef6a5 ]
The driver needs to set the correct max\_segment\_size;
otherwise debug\_dma\_map\_sg() will complain about the
over-mapping of the AMDGPU sg length as following:
WARNING: CPU: 6 PID: 1964 at kernel/dma/debug.c:1178 debug\_dma\_map\_sg+0x2dc/0x370
[ 364.049444] Modules linked in: veth amdgpu(OE) amdxcp drm\_exec gpu\_sched drm\_buddy drm\_ttm\_helper ttm(OE) drm\_suballoc\_helper drm\_display\_helper drm\_kms\_helper i2c\_algo\_bit rpcsec\_gss\_krb5 auth\_rpcgss nfsv4 nfs lockd grace netfs xt\_conntrack xt\_MASQUERADE nf\_conntrack\_netlink xfrm\_user xfrm\_algo iptable\_nat xt\_addrtype iptable\_filter br\_netfilter nvme\_fabrics overlay nfnetlink\_cttimeout nfnetlink openvswitch nsh nf\_conncount nf\_nat nf\_conntrack nf\_defrag\_ipv6 nf\_defrag\_ipv4 libcrc32c bridge stp llc amd\_atl intel\_rapl\_msr intel\_rapl\_common sunrpc sch\_fq\_codel snd\_hda\_codec\_realtek snd\_hda\_codec\_generic snd\_hda\_scodec\_component snd\_hda\_codec\_hdmi snd\_hda\_intel snd\_intel\_dspcfg edac\_mce\_amd binfmt\_misc snd\_hda\_codec snd\_pci\_acp6x snd\_hda\_core snd\_acp\_config snd\_hwdep snd\_soc\_acpi kvm\_amd snd\_pcm kvm snd\_seq\_midi snd\_seq\_midi\_event crct10dif\_pclmul ghash\_clmulni\_intel sha512\_ssse3 snd\_rawmidi sha256\_ssse3 sha1\_ssse3 aesni\_intel snd\_seq nls\_iso8859\_1 crypto\_simd snd\_seq\_device cryptd snd\_timer rapl input\_leds snd
[ 364.049532] ipmi\_devintf wmi\_bmof ccp serio\_raw k10temp sp5100\_tco soundcore ipmi\_msghandler cm32181 industrialio mac\_hid msr parport\_pc ppdev lp parport drm efi\_pstore ip\_tables x\_tables pci\_stub crc32\_pclmul nvme ahci libahci i2c\_piix4 r8169 nvme\_core i2c\_designware\_pci realtek i2c\_ccgx\_ucsi video wmi hid\_generic cdc\_ether usbnet usbhid hid r8152 mii
[ 364.049576] CPU: 6 PID: 1964 Comm: rocminfo Tainted: G OE 6.10.0-custom #492
[ 364.049579] Hardware name: AMD Majolica-RN/Majolica-RN, BIOS RMJ1009A 06/13/2021
[ 364.049582] RIP: 0010:debug\_dma\_map\_sg+0x2dc/0x370
[ 364.049585] Code: 89 4d b8 e8 36 b1 86 00 8b 4d b8 48 8b 55 b0 44 8b 45 a8 4c 8b 4d a0 48 89 c6 48 c7 c7 00 4b 74 bc 4c 89 4d b8 e8 b4 73 f3 ff <0f> 0b 4c 8b 4d b8 8b 15 c8 2c b8 01 85 d2 0f 85 ee fd ff ff 8b 05
[ 364.049588] RSP: 0018:ffff9ca600b57ac0 EFLAGS: 00010286
[ 364.049590] RAX: 0000000000000000 RBX: ffff88b7c132b0c8 RCX: 0000000000000027
[ 364.049592] RDX: ffff88bb0f521688 RSI: 0000000000000001 RDI: ffff88bb0f521680
[ 364.049594] RBP: ffff9ca600b57b20 R08: 000000000000006f R09: ffff9ca600b57930
[ 364.049596] R10: ffff9ca600b57928 R11: ffffffffbcb46328 R12: 0000000000000000
[ 364.049597] R13: 0000000000000001 R14: ffff88b7c19c0700 R15: ffff88b7c9059800
[ 364.049599] FS: 00007fb2d3516e80(0000) GS:ffff88bb0f500000(0000) knlGS:0000000000000000
[ 364.049601] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 364.049603] CR2: 000055610bd03598 CR3: 00000001049f6000 CR4: 0000000000350ef0
[ 364.049605] Call Trace:
[ 364.049607] <TASK>
[ 364.049609] ? show\_regs+0x6d/0x80
[ 364.049614] ? \_\_warn+0x8c/0x140
[ 364.049618] ? debug\_dma\_map\_sg+0x2dc/0x370
[ 364.049621] ? report\_bug+0x193/0x1a0
[ 364.049627] ? handle\_bug+0x46/0x80
[ 364.049631] ? exc\_invalid\_op+0x1d/0x80
[ 364.049635] ? asm\_exc\_invalid\_op+0x1f/0x30
[ 364.049642] ? debug\_dma\_map\_sg+0x2dc/0x370
[ 364.049647] \_\_dma\_map\_sg\_attrs+0x90/0xe0
[ 364.049651] dma\_map\_sgtable+0x25/0x40
[ 364.049654] amdgpu\_bo\_move+0x59a/0x850 [amdgpu]
[ 364.049935] ? srso\_return\_thunk+0x5/0x5f
[ 364.049939] ? amdgpu\_ttm\_tt\_populate+0x5d/0xc0 [amdgpu]
[ 364.050095] ttm\_bo\_handle\_move\_mem+0xc3/0x180 [ttm]
[ 364.050103] ttm\_bo\_validate+0xc1/0x160 [ttm]
[ 364.050108] ? amdgpu\_ttm\_tt\_get\_user\_pages+0xe5/0x1b0 [amdgpu]
[ 364.050263] amdgpu\_amdkfd\_gpuvm\_alloc\_memory\_of\_gpu+0xa12/0xc90 [amdgpu]
[ 364.050473] kfd\_ioctl\_alloc\_memory\_of\_gpu+0x16b/0x3b0 [amdgpu]
[ 364.050680] kfd\_ioctl+0x3c2/0x530 [amdgpu]
[ 364.050866] ? \_\_pfx\_kfd\_ioctl\_alloc\_memory\_of\_gpu+0x10/0x10 [amdgpu]
[ 364.051054] ? srso\_return\_thunk+0x5/0x5f
[ 364.051057] ? tomoyo\_file\_ioctl+0x20/0x30
[ 364.051063] \_\_x64\_sys\_ioctl+0x9c/0xd0
[ 364.051068] x64\_sys\_call+0x1219/0x20d0
[ 364.051073] do\_syscall\_64+0x51/0x120
[ 364.051077] entry\_SYSCALL\_64\_after\_hwframe+0x76/0x7e
[ 364.051081] RIP: 0033:0x7fb2d2f1a94f
Signed-off-by: Prike Liang <Prike.Liang@amd.com>
Reviewed-by: Christian König <christian.koenig@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=76581147b05c2adb6b47bbc697521725f10224e4)

| -rw-r--r-- | [drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/amdgpu/amdgpu_ttm.c?id=76581147b05c2adb6b47bbc697521725f10224e4) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.c b/drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.cindex ca00a2d5e38b55..c3bd7657487716 100644--- a/[drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_ttm.c?id=53b03a43a881b0ab2ec0f980c4462b43ea92e264)+++ b/[drivers/gpu/drm/amd/amdgpu/amdgpu\_ttm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/amdgpu_ttm.c?id=76581147b05c2adb6b47bbc697521725f10224e4)@@ -1664,6 +1664,7 @@ int amdgpu\_ttm\_init(struct amdgpu\_device \*adev)  mutex\_init(&adev->mman.gtt\_window\_lock); + dma\_set\_max\_seg\_size(adev->dev, UINT\_MAX); /\* No others user of address space so set it to 0 \*/ r = ttm\_device\_init(&adev->mman.bdev, &amdgpu\_bo\_driver, adev->dev, adev\_to\_drm(adev)->anon\_inode->i\_mapping, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:46:14 +0000


