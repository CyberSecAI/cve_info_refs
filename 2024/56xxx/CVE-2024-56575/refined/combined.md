=== Content from git.kernel.org_cc9c9631_20250115_094703.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b7a830bbc25da0f641e3ef2bac3b1766b2777a8b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b7a830bbc25da0f641e3ef2bac3b1766b2777a8b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b7a830bbc25da0f641e3ef2bac3b1766b2777a8b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b7a830bbc25da0f641e3ef2bac3b1766b2777a8b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ming Qian <ming.qian@nxp.com> | 2024-09-13 15:22:54 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-09 10:33:03 +0100 |
| commit | [b7a830bbc25da0f641e3ef2bac3b1766b2777a8b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b7a830bbc25da0f641e3ef2bac3b1766b2777a8b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b7a830bbc25da0f641e3ef2bac3b1766b2777a8b)) | |
| tree | [d8cceef084d55f2f798b353bc2f1236ea74908b4](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b7a830bbc25da0f641e3ef2bac3b1766b2777a8b) | |
| parent | [b59ab89bc83f7bff67f78c6caf484a84a6dd30f7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b59ab89bc83f7bff67f78c6caf484a84a6dd30f7) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b7a830bbc25da0f641e3ef2bac3b1766b2777a8b&id2=b59ab89bc83f7bff67f78c6caf484a84a6dd30f7)) | |
| download | [linux-b7a830bbc25da0f641e3ef2bac3b1766b2777a8b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b7a830bbc25da0f641e3ef2bac3b1766b2777a8b.tar.gz) | |

media: imx-jpeg: Ensure power suppliers be suspended before detach themcommit fd0af4cd35da0eb550ef682b71cda70a4e36f6b9 upstream.
The power suppliers are always requested to suspend asynchronously,
dev\_pm\_domain\_detach() requires the caller to ensure proper
synchronization of this function with power management callbacks.
otherwise the detach may led to kernel panic, like below:
[ 1457.107934] Unable to handle kernel NULL pointer dereference at virtual address 0000000000000040
[ 1457.116777] Mem abort info:
[ 1457.119589] ESR = 0x0000000096000004
[ 1457.123358] EC = 0x25: DABT (current EL), IL = 32 bits
[ 1457.128692] SET = 0, FnV = 0
[ 1457.131764] EA = 0, S1PTW = 0
[ 1457.134920] FSC = 0x04: level 0 translation fault
[ 1457.139812] Data abort info:
[ 1457.142707] ISV = 0, ISS = 0x00000004, ISS2 = 0x00000000
[ 1457.148196] CM = 0, WnR = 0, TnD = 0, TagAccess = 0
[ 1457.153256] GCS = 0, Overlay = 0, DirtyBit = 0, Xs = 0
[ 1457.158563] user pgtable: 4k pages, 48-bit VAs, pgdp=00000001138b6000
[ 1457.165000] [0000000000000040] pgd=0000000000000000, p4d=0000000000000000
[ 1457.171792] Internal error: Oops: 0000000096000004 [#1] PREEMPT SMP
[ 1457.178045] Modules linked in: v4l2\_jpeg wave6\_vpu\_ctrl(-) [last unloaded: mxc\_jpeg\_encdec]
[ 1457.186383] CPU: 0 PID: 51938 Comm: kworker/0:3 Not tainted 6.6.36-gd23d64eea511 #66
[ 1457.194112] Hardware name: NXP i.MX95 19X19 board (DT)
[ 1457.199236] Workqueue: pm pm\_runtime\_work
[ 1457.203247] pstate: 60400009 (nZCv daif +PAN -UAO -TCO -DIT -SSBS BTYPE=--)
[ 1457.210188] pc : genpd\_runtime\_suspend+0x20/0x290
[ 1457.214886] lr : \_\_rpm\_callback+0x48/0x1d8
[ 1457.218968] sp : ffff80008250bc50
[ 1457.222270] x29: ffff80008250bc50 x28: 0000000000000000 x27: 0000000000000000
[ 1457.229394] x26: 0000000000000000 x25: 0000000000000008 x24: 00000000000f4240
[ 1457.236518] x23: 0000000000000000 x22: ffff00008590f0e4 x21: 0000000000000008
[ 1457.243642] x20: ffff80008099c434 x19: ffff00008590f000 x18: ffffffffffffffff
[ 1457.250766] x17: 5300326563697665 x16: 645f676e696c6f6f x15: 63343a6d726f6674
[ 1457.257890] x14: 0000000000000004 x13: 00000000000003a4 x12: 0000000000000002
[ 1457.265014] x11: 0000000000000000 x10: 0000000000000a60 x9 : ffff80008250bbb0
[ 1457.272138] x8 : ffff000092937200 x7 : ffff0003fdf6af80 x6 : 0000000000000000
[ 1457.279262] x5 : 00000000410fd050 x4 : 0000000000200000 x3 : 0000000000000000
[ 1457.286386] x2 : 0000000000000000 x1 : 0000000000000000 x0 : ffff00008590f000
[ 1457.293510] Call trace:
[ 1457.295946] genpd\_runtime\_suspend+0x20/0x290
[ 1457.300296] \_\_rpm\_callback+0x48/0x1d8
[ 1457.304038] rpm\_callback+0x6c/0x78
[ 1457.307515] rpm\_suspend+0x10c/0x570
[ 1457.311077] pm\_runtime\_work+0xc4/0xc8
[ 1457.314813] process\_one\_work+0x138/0x248
[ 1457.318816] worker\_thread+0x320/0x438
[ 1457.322552] kthread+0x110/0x114
[ 1457.325767] ret\_from\_fork+0x10/0x20
Fixes: 2db16c6ed72c ("media: imx-jpeg: Add V4L2 driver for i.MX8 JPEG Encoder/Decoder")
Cc: <stable@vger.kernel.org>
Signed-off-by: Ming Qian <ming.qian@nxp.com>
Reviewed-by: TaoJiang <tao.jiang\_2@nxp.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b7a830bbc25da0f641e3ef2bac3b1766b2777a8b)

| -rw-r--r-- | [drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.c?id=b7a830bbc25da0f641e3ef2bac3b1766b2777a8b) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.c b/drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.cindex d2e100a5498a0d..e8dcd44f6e4692 100644--- a/[drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.c?id=b59ab89bc83f7bff67f78c6caf484a84a6dd30f7)+++ b/[drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.c?id=b7a830bbc25da0f641e3ef2bac3b1766b2777a8b)@@ -2674,6 +2674,8 @@ static void mxc\_jpeg\_detach\_pm\_domains(struct mxc\_jpeg\_dev \*jpeg) int i;  for (i = 0; i < jpeg->num\_domains; i++) {+ if (jpeg->pd\_dev[i] && !pm\_runtime\_suspended(jpeg->pd\_dev[i]))+ pm\_runtime\_force\_suspend(jpeg->pd\_dev[i]); if (jpeg->pd\_link[i] && !IS\_ERR(jpeg->pd\_link[i])) device\_link\_del(jpeg->pd\_link[i]); if (jpeg->pd\_dev[i] && !IS\_ERR(jpeg->pd\_dev[i])) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:45:40 +0000



=== Content from git.kernel.org_6afa9e1f_20250115_094704.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=fd0af4cd35da0eb550ef682b71cda70a4e36f6b9)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fd0af4cd35da0eb550ef682b71cda70a4e36f6b9)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fd0af4cd35da0eb550ef682b71cda70a4e36f6b9)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fd0af4cd35da0eb550ef682b71cda70a4e36f6b9)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ming Qian <ming.qian@nxp.com> | 2024-09-13 15:22:54 +0900 |
| --- | --- | --- |
| committer | Hans Verkuil <hverkuil-cisco@xs4all.nl> | 2024-10-12 16:28:25 +0200 |
| commit | [fd0af4cd35da0eb550ef682b71cda70a4e36f6b9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fd0af4cd35da0eb550ef682b71cda70a4e36f6b9) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=fd0af4cd35da0eb550ef682b71cda70a4e36f6b9)) | |
| tree | [78b0253961ae41acb0ec5eb6d6334f81dd5b21b3](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fd0af4cd35da0eb550ef682b71cda70a4e36f6b9) | |
| parent | [8cbb1a7bd5973b57898b26eb804fe44af440bb63](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8cbb1a7bd5973b57898b26eb804fe44af440bb63) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fd0af4cd35da0eb550ef682b71cda70a4e36f6b9&id2=8cbb1a7bd5973b57898b26eb804fe44af440bb63)) | |
| download | [linux-fd0af4cd35da0eb550ef682b71cda70a4e36f6b9.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-fd0af4cd35da0eb550ef682b71cda70a4e36f6b9.tar.gz) | |

media: imx-jpeg: Ensure power suppliers be suspended before detach themThe power suppliers are always requested to suspend asynchronously,
dev\_pm\_domain\_detach() requires the caller to ensure proper
synchronization of this function with power management callbacks.
otherwise the detach may led to kernel panic, like below:
[ 1457.107934] Unable to handle kernel NULL pointer dereference at virtual address 0000000000000040
[ 1457.116777] Mem abort info:
[ 1457.119589] ESR = 0x0000000096000004
[ 1457.123358] EC = 0x25: DABT (current EL), IL = 32 bits
[ 1457.128692] SET = 0, FnV = 0
[ 1457.131764] EA = 0, S1PTW = 0
[ 1457.134920] FSC = 0x04: level 0 translation fault
[ 1457.139812] Data abort info:
[ 1457.142707] ISV = 0, ISS = 0x00000004, ISS2 = 0x00000000
[ 1457.148196] CM = 0, WnR = 0, TnD = 0, TagAccess = 0
[ 1457.153256] GCS = 0, Overlay = 0, DirtyBit = 0, Xs = 0
[ 1457.158563] user pgtable: 4k pages, 48-bit VAs, pgdp=00000001138b6000
[ 1457.165000] [0000000000000040] pgd=0000000000000000, p4d=0000000000000000
[ 1457.171792] Internal error: Oops: 0000000096000004 [#1] PREEMPT SMP
[ 1457.178045] Modules linked in: v4l2\_jpeg wave6\_vpu\_ctrl(-) [last unloaded: mxc\_jpeg\_encdec]
[ 1457.186383] CPU: 0 PID: 51938 Comm: kworker/0:3 Not tainted 6.6.36-gd23d64eea511 #66
[ 1457.194112] Hardware name: NXP i.MX95 19X19 board (DT)
[ 1457.199236] Workqueue: pm pm\_runtime\_work
[ 1457.203247] pstate: 60400009 (nZCv daif +PAN -UAO -TCO -DIT -SSBS BTYPE=--)
[ 1457.210188] pc : genpd\_runtime\_suspend+0x20/0x290
[ 1457.214886] lr : \_\_rpm\_callback+0x48/0x1d8
[ 1457.218968] sp : ffff80008250bc50
[ 1457.222270] x29: ffff80008250bc50 x28: 0000000000000000 x27: 0000000000000000
[ 1457.229394] x26: 0000000000000000 x25: 0000000000000008 x24: 00000000000f4240
[ 1457.236518] x23: 0000000000000000 x22: ffff00008590f0e4 x21: 0000000000000008
[ 1457.243642] x20: ffff80008099c434 x19: ffff00008590f000 x18: ffffffffffffffff
[ 1457.250766] x17: 5300326563697665 x16: 645f676e696c6f6f x15: 63343a6d726f6674
[ 1457.257890] x14: 0000000000000004 x13: 00000000000003a4 x12: 0000000000000002
[ 1457.265014] x11: 0000000000000000 x10: 0000000000000a60 x9 : ffff80008250bbb0
[ 1457.272138] x8 : ffff000092937200 x7 : ffff0003fdf6af80 x6 : 0000000000000000
[ 1457.279262] x5 : 00000000410fd050 x4 : 0000000000200000 x3 : 0000000000000000
[ 1457.286386] x2 : 0000000000000000 x1 : 0000000000000000 x0 : ffff00008590f000
[ 1457.293510] Call trace:
[ 1457.295946] genpd\_runtime\_suspend+0x20/0x290
[ 1457.300296] \_\_rpm\_callback+0x48/0x1d8
[ 1457.304038] rpm\_callback+0x6c/0x78
[ 1457.307515] rpm\_suspend+0x10c/0x570
[ 1457.311077] pm\_runtime\_work+0xc4/0xc8
[ 1457.314813] process\_one\_work+0x138/0x248
[ 1457.318816] worker\_thread+0x320/0x438
[ 1457.322552] kthread+0x110/0x114
[ 1457.325767] ret\_from\_fork+0x10/0x20
Fixes: 2db16c6ed72c ("media: imx-jpeg: Add V4L2 driver for i.MX8 JPEG Encoder/Decoder")
Cc: <stable@vger.kernel.org>
Signed-off-by: Ming Qian <ming.qian@nxp.com>
Reviewed-by: TaoJiang <tao.jiang\_2@nxp.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fd0af4cd35da0eb550ef682b71cda70a4e36f6b9)

| -rw-r--r-- | [drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.c?id=fd0af4cd35da0eb550ef682b71cda70a4e36f6b9) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.c b/drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.cindex 7c8feecc43018e..0289822cd7f487 100644--- a/[drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.c?id=8cbb1a7bd5973b57898b26eb804fe44af440bb63)+++ b/[drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.c?id=fd0af4cd35da0eb550ef682b71cda70a4e36f6b9)@@ -2679,6 +2679,8 @@ static void mxc\_jpeg\_detach\_pm\_domains(struct mxc\_jpeg\_dev \*jpeg) int i;  for (i = 0; i < jpeg->num\_domains; i++) {+ if (jpeg->pd\_dev[i] && !pm\_runtime\_suspended(jpeg->pd\_dev[i]))+ pm\_runtime\_force\_suspend(jpeg->pd\_dev[i]); if (jpeg->pd\_link[i] && !IS\_ERR(jpeg->pd\_link[i])) device\_link\_del(jpeg->pd\_link[i]); if (jpeg->pd\_dev[i] && !IS\_ERR(jpeg->pd\_dev[i])) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:45:41 +0000



=== Content from git.kernel.org_0805dd48_20250115_094702.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2f86d104539fab9181ea7b5721f40e7b92a8bf67)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2f86d104539fab9181ea7b5721f40e7b92a8bf67)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2f86d104539fab9181ea7b5721f40e7b92a8bf67)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2f86d104539fab9181ea7b5721f40e7b92a8bf67)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ming Qian <ming.qian@nxp.com> | 2024-09-13 15:22:54 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-09 10:40:58 +0100 |
| commit | [2f86d104539fab9181ea7b5721f40e7b92a8bf67](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2f86d104539fab9181ea7b5721f40e7b92a8bf67) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2f86d104539fab9181ea7b5721f40e7b92a8bf67)) | |
| tree | [7bb25711c9b9712c43871e573cda86091e11d62a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2f86d104539fab9181ea7b5721f40e7b92a8bf67) | |
| parent | [1def915b1564f4375330bd113ea1d768a569cfd8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1def915b1564f4375330bd113ea1d768a569cfd8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2f86d104539fab9181ea7b5721f40e7b92a8bf67&id2=1def915b1564f4375330bd113ea1d768a569cfd8)) | |
| download | [linux-2f86d104539fab9181ea7b5721f40e7b92a8bf67.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2f86d104539fab9181ea7b5721f40e7b92a8bf67.tar.gz) | |

media: imx-jpeg: Ensure power suppliers be suspended before detach themcommit fd0af4cd35da0eb550ef682b71cda70a4e36f6b9 upstream.
The power suppliers are always requested to suspend asynchronously,
dev\_pm\_domain\_detach() requires the caller to ensure proper
synchronization of this function with power management callbacks.
otherwise the detach may led to kernel panic, like below:
[ 1457.107934] Unable to handle kernel NULL pointer dereference at virtual address 0000000000000040
[ 1457.116777] Mem abort info:
[ 1457.119589] ESR = 0x0000000096000004
[ 1457.123358] EC = 0x25: DABT (current EL), IL = 32 bits
[ 1457.128692] SET = 0, FnV = 0
[ 1457.131764] EA = 0, S1PTW = 0
[ 1457.134920] FSC = 0x04: level 0 translation fault
[ 1457.139812] Data abort info:
[ 1457.142707] ISV = 0, ISS = 0x00000004, ISS2 = 0x00000000
[ 1457.148196] CM = 0, WnR = 0, TnD = 0, TagAccess = 0
[ 1457.153256] GCS = 0, Overlay = 0, DirtyBit = 0, Xs = 0
[ 1457.158563] user pgtable: 4k pages, 48-bit VAs, pgdp=00000001138b6000
[ 1457.165000] [0000000000000040] pgd=0000000000000000, p4d=0000000000000000
[ 1457.171792] Internal error: Oops: 0000000096000004 [#1] PREEMPT SMP
[ 1457.178045] Modules linked in: v4l2\_jpeg wave6\_vpu\_ctrl(-) [last unloaded: mxc\_jpeg\_encdec]
[ 1457.186383] CPU: 0 PID: 51938 Comm: kworker/0:3 Not tainted 6.6.36-gd23d64eea511 #66
[ 1457.194112] Hardware name: NXP i.MX95 19X19 board (DT)
[ 1457.199236] Workqueue: pm pm\_runtime\_work
[ 1457.203247] pstate: 60400009 (nZCv daif +PAN -UAO -TCO -DIT -SSBS BTYPE=--)
[ 1457.210188] pc : genpd\_runtime\_suspend+0x20/0x290
[ 1457.214886] lr : \_\_rpm\_callback+0x48/0x1d8
[ 1457.218968] sp : ffff80008250bc50
[ 1457.222270] x29: ffff80008250bc50 x28: 0000000000000000 x27: 0000000000000000
[ 1457.229394] x26: 0000000000000000 x25: 0000000000000008 x24: 00000000000f4240
[ 1457.236518] x23: 0000000000000000 x22: ffff00008590f0e4 x21: 0000000000000008
[ 1457.243642] x20: ffff80008099c434 x19: ffff00008590f000 x18: ffffffffffffffff
[ 1457.250766] x17: 5300326563697665 x16: 645f676e696c6f6f x15: 63343a6d726f6674
[ 1457.257890] x14: 0000000000000004 x13: 00000000000003a4 x12: 0000000000000002
[ 1457.265014] x11: 0000000000000000 x10: 0000000000000a60 x9 : ffff80008250bbb0
[ 1457.272138] x8 : ffff000092937200 x7 : ffff0003fdf6af80 x6 : 0000000000000000
[ 1457.279262] x5 : 00000000410fd050 x4 : 0000000000200000 x3 : 0000000000000000
[ 1457.286386] x2 : 0000000000000000 x1 : 0000000000000000 x0 : ffff00008590f000
[ 1457.293510] Call trace:
[ 1457.295946] genpd\_runtime\_suspend+0x20/0x290
[ 1457.300296] \_\_rpm\_callback+0x48/0x1d8
[ 1457.304038] rpm\_callback+0x6c/0x78
[ 1457.307515] rpm\_suspend+0x10c/0x570
[ 1457.311077] pm\_runtime\_work+0xc4/0xc8
[ 1457.314813] process\_one\_work+0x138/0x248
[ 1457.318816] worker\_thread+0x320/0x438
[ 1457.322552] kthread+0x110/0x114
[ 1457.325767] ret\_from\_fork+0x10/0x20
Fixes: 2db16c6ed72c ("media: imx-jpeg: Add V4L2 driver for i.MX8 JPEG Encoder/Decoder")
Cc: <stable@vger.kernel.org>
Signed-off-by: Ming Qian <ming.qian@nxp.com>
Reviewed-by: TaoJiang <tao.jiang\_2@nxp.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2f86d104539fab9181ea7b5721f40e7b92a8bf67)

| -rw-r--r-- | [drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.c?id=2f86d104539fab9181ea7b5721f40e7b92a8bf67) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.c b/drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.cindex 979b03b112f841..1bf85c1cf96435 100644--- a/[drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.c?id=1def915b1564f4375330bd113ea1d768a569cfd8)+++ b/[drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.c?id=2f86d104539fab9181ea7b5721f40e7b92a8bf67)@@ -2679,6 +2679,8 @@ static void mxc\_jpeg\_detach\_pm\_domains(struct mxc\_jpeg\_dev \*jpeg) int i;  for (i = 0; i < jpeg->num\_domains; i++) {+ if (jpeg->pd\_dev[i] && !pm\_runtime\_suspended(jpeg->pd\_dev[i]))+ pm\_runtime\_force\_suspend(jpeg->pd\_dev[i]); if (jpeg->pd\_link[i] && !IS\_ERR(jpeg->pd\_link[i])) device\_link\_del(jpeg->pd\_link[i]); if (jpeg->pd\_dev[i] && !IS\_ERR(jpeg->pd\_dev[i])) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:45:39 +0000



=== Content from git.kernel.org_60d926e3_20250115_094703.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f3c4e088ec01cae45931a18ddf7cae0f4d72e1c5)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f3c4e088ec01cae45931a18ddf7cae0f4d72e1c5)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f3c4e088ec01cae45931a18ddf7cae0f4d72e1c5)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f3c4e088ec01cae45931a18ddf7cae0f4d72e1c5)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ming Qian <ming.qian@nxp.com> | 2024-09-13 15:22:54 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:50:32 +0100 |
| commit | [f3c4e088ec01cae45931a18ddf7cae0f4d72e1c5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f3c4e088ec01cae45931a18ddf7cae0f4d72e1c5) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f3c4e088ec01cae45931a18ddf7cae0f4d72e1c5)) | |
| tree | [2ec3ed5be1e02059d9d659c60d17d86f351cd741](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f3c4e088ec01cae45931a18ddf7cae0f4d72e1c5) | |
| parent | [815d14147068347e88c258233eb951b41b2792a6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=815d14147068347e88c258233eb951b41b2792a6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f3c4e088ec01cae45931a18ddf7cae0f4d72e1c5&id2=815d14147068347e88c258233eb951b41b2792a6)) | |
| download | [linux-f3c4e088ec01cae45931a18ddf7cae0f4d72e1c5.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f3c4e088ec01cae45931a18ddf7cae0f4d72e1c5.tar.gz) | |

media: imx-jpeg: Ensure power suppliers be suspended before detach themcommit fd0af4cd35da0eb550ef682b71cda70a4e36f6b9 upstream.
The power suppliers are always requested to suspend asynchronously,
dev\_pm\_domain\_detach() requires the caller to ensure proper
synchronization of this function with power management callbacks.
otherwise the detach may led to kernel panic, like below:
[ 1457.107934] Unable to handle kernel NULL pointer dereference at virtual address 0000000000000040
[ 1457.116777] Mem abort info:
[ 1457.119589] ESR = 0x0000000096000004
[ 1457.123358] EC = 0x25: DABT (current EL), IL = 32 bits
[ 1457.128692] SET = 0, FnV = 0
[ 1457.131764] EA = 0, S1PTW = 0
[ 1457.134920] FSC = 0x04: level 0 translation fault
[ 1457.139812] Data abort info:
[ 1457.142707] ISV = 0, ISS = 0x00000004, ISS2 = 0x00000000
[ 1457.148196] CM = 0, WnR = 0, TnD = 0, TagAccess = 0
[ 1457.153256] GCS = 0, Overlay = 0, DirtyBit = 0, Xs = 0
[ 1457.158563] user pgtable: 4k pages, 48-bit VAs, pgdp=00000001138b6000
[ 1457.165000] [0000000000000040] pgd=0000000000000000, p4d=0000000000000000
[ 1457.171792] Internal error: Oops: 0000000096000004 [#1] PREEMPT SMP
[ 1457.178045] Modules linked in: v4l2\_jpeg wave6\_vpu\_ctrl(-) [last unloaded: mxc\_jpeg\_encdec]
[ 1457.186383] CPU: 0 PID: 51938 Comm: kworker/0:3 Not tainted 6.6.36-gd23d64eea511 #66
[ 1457.194112] Hardware name: NXP i.MX95 19X19 board (DT)
[ 1457.199236] Workqueue: pm pm\_runtime\_work
[ 1457.203247] pstate: 60400009 (nZCv daif +PAN -UAO -TCO -DIT -SSBS BTYPE=--)
[ 1457.210188] pc : genpd\_runtime\_suspend+0x20/0x290
[ 1457.214886] lr : \_\_rpm\_callback+0x48/0x1d8
[ 1457.218968] sp : ffff80008250bc50
[ 1457.222270] x29: ffff80008250bc50 x28: 0000000000000000 x27: 0000000000000000
[ 1457.229394] x26: 0000000000000000 x25: 0000000000000008 x24: 00000000000f4240
[ 1457.236518] x23: 0000000000000000 x22: ffff00008590f0e4 x21: 0000000000000008
[ 1457.243642] x20: ffff80008099c434 x19: ffff00008590f000 x18: ffffffffffffffff
[ 1457.250766] x17: 5300326563697665 x16: 645f676e696c6f6f x15: 63343a6d726f6674
[ 1457.257890] x14: 0000000000000004 x13: 00000000000003a4 x12: 0000000000000002
[ 1457.265014] x11: 0000000000000000 x10: 0000000000000a60 x9 : ffff80008250bbb0
[ 1457.272138] x8 : ffff000092937200 x7 : ffff0003fdf6af80 x6 : 0000000000000000
[ 1457.279262] x5 : 00000000410fd050 x4 : 0000000000200000 x3 : 0000000000000000
[ 1457.286386] x2 : 0000000000000000 x1 : 0000000000000000 x0 : ffff00008590f000
[ 1457.293510] Call trace:
[ 1457.295946] genpd\_runtime\_suspend+0x20/0x290
[ 1457.300296] \_\_rpm\_callback+0x48/0x1d8
[ 1457.304038] rpm\_callback+0x6c/0x78
[ 1457.307515] rpm\_suspend+0x10c/0x570
[ 1457.311077] pm\_runtime\_work+0xc4/0xc8
[ 1457.314813] process\_one\_work+0x138/0x248
[ 1457.318816] worker\_thread+0x320/0x438
[ 1457.322552] kthread+0x110/0x114
[ 1457.325767] ret\_from\_fork+0x10/0x20
Fixes: 2db16c6ed72c ("media: imx-jpeg: Add V4L2 driver for i.MX8 JPEG Encoder/Decoder")
Cc: <stable@vger.kernel.org>
Signed-off-by: Ming Qian <ming.qian@nxp.com>
Reviewed-by: TaoJiang <tao.jiang\_2@nxp.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f3c4e088ec01cae45931a18ddf7cae0f4d72e1c5)

| -rw-r--r-- | [drivers/media/platform/imx-jpeg/mxc-jpeg.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/platform/imx-jpeg/mxc-jpeg.c?id=f3c4e088ec01cae45931a18ddf7cae0f4d72e1c5) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/drivers/media/platform/imx-jpeg/mxc-jpeg.c b/drivers/media/platform/imx-jpeg/mxc-jpeg.cindex 3f85c23d57b568..8ac844db0e8330 100644--- a/[drivers/media/platform/imx-jpeg/mxc-jpeg.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/platform/imx-jpeg/mxc-jpeg.c?id=815d14147068347e88c258233eb951b41b2792a6)+++ b/[drivers/media/platform/imx-jpeg/mxc-jpeg.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/platform/imx-jpeg/mxc-jpeg.c?id=f3c4e088ec01cae45931a18ddf7cae0f4d72e1c5)@@ -1997,6 +1997,8 @@ static void mxc\_jpeg\_detach\_pm\_domains(struct mxc\_jpeg\_dev \*jpeg) int i;  for (i = 0; i < jpeg->num\_domains; i++) {+ if (jpeg->pd\_dev[i] && !pm\_runtime\_suspended(jpeg->pd\_dev[i]))+ pm\_runtime\_force\_suspend(jpeg->pd\_dev[i]); if (jpeg->pd\_link[i] && !IS\_ERR(jpeg->pd\_link[i])) device\_link\_del(jpeg->pd\_link[i]); if (jpeg->pd\_dev[i] && !IS\_ERR(jpeg->pd\_dev[i])) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:45:40 +0000



=== Content from git.kernel.org_d0726d34_20250115_094701.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=12914fd765ba4f9d6a9a50439e8dd2e9f91423f2)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=12914fd765ba4f9d6a9a50439e8dd2e9f91423f2)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=12914fd765ba4f9d6a9a50439e8dd2e9f91423f2)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=12914fd765ba4f9d6a9a50439e8dd2e9f91423f2)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ming Qian <ming.qian@nxp.com> | 2024-09-13 15:22:54 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:54:11 +0100 |
| commit | [12914fd765ba4f9d6a9a50439e8dd2e9f91423f2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=12914fd765ba4f9d6a9a50439e8dd2e9f91423f2) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=12914fd765ba4f9d6a9a50439e8dd2e9f91423f2)) | |
| tree | [d708e9b1d2e6a8cfb719becad92a945d57e15036](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=12914fd765ba4f9d6a9a50439e8dd2e9f91423f2) | |
| parent | [34a3466a92f50c51d984f0ec2e96864886d460eb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=34a3466a92f50c51d984f0ec2e96864886d460eb) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=12914fd765ba4f9d6a9a50439e8dd2e9f91423f2&id2=34a3466a92f50c51d984f0ec2e96864886d460eb)) | |
| download | [linux-12914fd765ba4f9d6a9a50439e8dd2e9f91423f2.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-12914fd765ba4f9d6a9a50439e8dd2e9f91423f2.tar.gz) | |

media: imx-jpeg: Ensure power suppliers be suspended before detach themcommit fd0af4cd35da0eb550ef682b71cda70a4e36f6b9 upstream.
The power suppliers are always requested to suspend asynchronously,
dev\_pm\_domain\_detach() requires the caller to ensure proper
synchronization of this function with power management callbacks.
otherwise the detach may led to kernel panic, like below:
[ 1457.107934] Unable to handle kernel NULL pointer dereference at virtual address 0000000000000040
[ 1457.116777] Mem abort info:
[ 1457.119589] ESR = 0x0000000096000004
[ 1457.123358] EC = 0x25: DABT (current EL), IL = 32 bits
[ 1457.128692] SET = 0, FnV = 0
[ 1457.131764] EA = 0, S1PTW = 0
[ 1457.134920] FSC = 0x04: level 0 translation fault
[ 1457.139812] Data abort info:
[ 1457.142707] ISV = 0, ISS = 0x00000004, ISS2 = 0x00000000
[ 1457.148196] CM = 0, WnR = 0, TnD = 0, TagAccess = 0
[ 1457.153256] GCS = 0, Overlay = 0, DirtyBit = 0, Xs = 0
[ 1457.158563] user pgtable: 4k pages, 48-bit VAs, pgdp=00000001138b6000
[ 1457.165000] [0000000000000040] pgd=0000000000000000, p4d=0000000000000000
[ 1457.171792] Internal error: Oops: 0000000096000004 [#1] PREEMPT SMP
[ 1457.178045] Modules linked in: v4l2\_jpeg wave6\_vpu\_ctrl(-) [last unloaded: mxc\_jpeg\_encdec]
[ 1457.186383] CPU: 0 PID: 51938 Comm: kworker/0:3 Not tainted 6.6.36-gd23d64eea511 #66
[ 1457.194112] Hardware name: NXP i.MX95 19X19 board (DT)
[ 1457.199236] Workqueue: pm pm\_runtime\_work
[ 1457.203247] pstate: 60400009 (nZCv daif +PAN -UAO -TCO -DIT -SSBS BTYPE=--)
[ 1457.210188] pc : genpd\_runtime\_suspend+0x20/0x290
[ 1457.214886] lr : \_\_rpm\_callback+0x48/0x1d8
[ 1457.218968] sp : ffff80008250bc50
[ 1457.222270] x29: ffff80008250bc50 x28: 0000000000000000 x27: 0000000000000000
[ 1457.229394] x26: 0000000000000000 x25: 0000000000000008 x24: 00000000000f4240
[ 1457.236518] x23: 0000000000000000 x22: ffff00008590f0e4 x21: 0000000000000008
[ 1457.243642] x20: ffff80008099c434 x19: ffff00008590f000 x18: ffffffffffffffff
[ 1457.250766] x17: 5300326563697665 x16: 645f676e696c6f6f x15: 63343a6d726f6674
[ 1457.257890] x14: 0000000000000004 x13: 00000000000003a4 x12: 0000000000000002
[ 1457.265014] x11: 0000000000000000 x10: 0000000000000a60 x9 : ffff80008250bbb0
[ 1457.272138] x8 : ffff000092937200 x7 : ffff0003fdf6af80 x6 : 0000000000000000
[ 1457.279262] x5 : 00000000410fd050 x4 : 0000000000200000 x3 : 0000000000000000
[ 1457.286386] x2 : 0000000000000000 x1 : 0000000000000000 x0 : ffff00008590f000
[ 1457.293510] Call trace:
[ 1457.295946] genpd\_runtime\_suspend+0x20/0x290
[ 1457.300296] \_\_rpm\_callback+0x48/0x1d8
[ 1457.304038] rpm\_callback+0x6c/0x78
[ 1457.307515] rpm\_suspend+0x10c/0x570
[ 1457.311077] pm\_runtime\_work+0xc4/0xc8
[ 1457.314813] process\_one\_work+0x138/0x248
[ 1457.318816] worker\_thread+0x320/0x438
[ 1457.322552] kthread+0x110/0x114
[ 1457.325767] ret\_from\_fork+0x10/0x20
Fixes: 2db16c6ed72c ("media: imx-jpeg: Add V4L2 driver for i.MX8 JPEG Encoder/Decoder")
Cc: <stable@vger.kernel.org>
Signed-off-by: Ming Qian <ming.qian@nxp.com>
Reviewed-by: TaoJiang <tao.jiang\_2@nxp.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=12914fd765ba4f9d6a9a50439e8dd2e9f91423f2)

| -rw-r--r-- | [drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.c?id=12914fd765ba4f9d6a9a50439e8dd2e9f91423f2) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.c b/drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.cindex e2aa6c8065ae05..26e010f8518464 100644--- a/[drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.c?id=34a3466a92f50c51d984f0ec2e96864886d460eb)+++ b/[drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.c?id=12914fd765ba4f9d6a9a50439e8dd2e9f91423f2)@@ -2097,6 +2097,8 @@ static void mxc\_jpeg\_detach\_pm\_domains(struct mxc\_jpeg\_dev \*jpeg) int i;  for (i = 0; i < jpeg->num\_domains; i++) {+ if (jpeg->pd\_dev[i] && !pm\_runtime\_suspended(jpeg->pd\_dev[i]))+ pm\_runtime\_force\_suspend(jpeg->pd\_dev[i]); if (jpeg->pd\_link[i] && !IS\_ERR(jpeg->pd\_link[i])) device\_link\_del(jpeg->pd\_link[i]); if (jpeg->pd\_dev[i] && !IS\_ERR(jpeg->pd\_dev[i])) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:45:39 +0000


