=== Content from git.kernel.org_50d59d6d_20250114_212548.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=754ec823ee53422361da7958a8c8bf3275426912)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=754ec823ee53422361da7958a8c8bf3275426912)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=754ec823ee53422361da7958a8c8bf3275426912)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=754ec823ee53422361da7958a8c8bf3275426912)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Dumazet <edumazet@google.com> | 2024-12-04 17:05:48 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-19 18:08:52 +0100 |
| commit | [754ec823ee53422361da7958a8c8bf3275426912](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=754ec823ee53422361da7958a8c8bf3275426912) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=754ec823ee53422361da7958a8c8bf3275426912)) | |
| tree | [6c75c26b58c7f0203548220e07d357c7ea8235e4](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=754ec823ee53422361da7958a8c8bf3275426912) | |
| parent | [a6b98dd546661a62ac80350c0c6d560d6ad1df57](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a6b98dd546661a62ac80350c0c6d560d6ad1df57) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=754ec823ee53422361da7958a8c8bf3275426912&id2=a6b98dd546661a62ac80350c0c6d560d6ad1df57)) | |
| download | [linux-754ec823ee53422361da7958a8c8bf3275426912.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-754ec823ee53422361da7958a8c8bf3275426912.tar.gz) | |

tipc: fix NULL deref in cleanup\_bearer()[ Upstream commit b04d86fff66b15c07505d226431f808c15b1703c ]
syzbot found [1] that after blamed commit, ub->ubsock->sk
was NULL when attempting the atomic\_dec() :
atomic\_dec(&tipc\_net(sock\_net(ub->ubsock->sk))->wq\_count);
Fix this by caching the tipc\_net pointer.
[1]
Oops: general protection fault, probably for non-canonical address 0xdffffc0000000006: 0000 [#1] PREEMPT SMP KASAN PTI
KASAN: null-ptr-deref in range [0x0000000000000030-0x0000000000000037]
CPU: 0 UID: 0 PID: 5896 Comm: kworker/0:3 Not tainted 6.13.0-rc1-next-20241203-syzkaller #0
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 09/13/2024
Workqueue: events cleanup\_bearer
RIP: 0010:read\_pnet include/net/net\_namespace.h:387 [inline]
RIP: 0010:sock\_net include/net/sock.h:655 [inline]
RIP: 0010:cleanup\_bearer+0x1f7/0x280 net/tipc/udp\_media.c:820
Code: 18 48 89 d8 48 c1 e8 03 42 80 3c 28 00 74 08 48 89 df e8 3c f7 99 f6 48 8b 1b 48 83 c3 30 e8 f0 e4 60 00 48 89 d8 48 c1 e8 03 <42> 80 3c 28 00 74 08 48 89 df e8 1a f7 99 f6 49 83 c7 e8 48 8b 1b
RSP: 0018:ffffc9000410fb70 EFLAGS: 00010206
RAX: 0000000000000006 RBX: 0000000000000030 RCX: ffff88802fe45a00
RDX: 0000000000000001 RSI: 0000000000000008 RDI: ffffc9000410f900
RBP: ffff88807e1f0908 R08: ffffc9000410f907 R09: 1ffff92000821f20
R10: dffffc0000000000 R11: fffff52000821f21 R12: ffff888031d19980
R13: dffffc0000000000 R14: dffffc0000000000 R15: ffff88807e1f0918
FS: 0000000000000000(0000) GS:ffff8880b8600000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 0000556ca050b000 CR3: 0000000031c0c000 CR4: 00000000003526f0
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
Fixes: 6a2fa13312e5 ("tipc: Fix use-after-free of kernel socket in cleanup\_bearer().")
Reported-by: syzbot+46aa5474f179dacd1a3b@syzkaller.appspotmail.com
Closes: https://lore.kernel.org/netdev/67508b5f.050a0220.17bd51.0070.GAE@google.com/T/#u
Signed-off-by: Eric Dumazet <edumazet@google.com>
Reviewed-by: Kuniyuki Iwashima <kuniyu@amazon.com>
Link: [https://patch.msgid.link/20241204170548.4152658-1-edumazet@google.com](https://patch.msgid.link/20241204170548.4152658-1-edumazet%40google.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=754ec823ee53422361da7958a8c8bf3275426912)

| -rw-r--r-- | [net/tipc/udp\_media.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/tipc/udp_media.c?id=754ec823ee53422361da7958a8c8bf3275426912) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 1 deletions

| diff --git a/net/tipc/udp\_media.c b/net/tipc/udp\_media.cindex 3f5a12b85b2d3e..f5bd75d931c1b5 100644--- a/[net/tipc/udp\_media.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/udp_media.c?id=a6b98dd546661a62ac80350c0c6d560d6ad1df57)+++ b/[net/tipc/udp\_media.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/udp_media.c?id=754ec823ee53422361da7958a8c8bf3275426912)@@ -811,6 +811,7 @@ static void cleanup\_bearer(struct work\_struct \*work) { struct udp\_bearer \*ub = container\_of(work, struct udp\_bearer, work); struct udp\_replicast \*rcast, \*tmp;+ struct tipc\_net \*tn;  list\_for\_each\_entry\_safe(rcast, tmp, &ub->rcast.list, list) { dst\_cache\_destroy(&rcast->dst\_cache);@@ -818,10 +819,14 @@ static void cleanup\_bearer(struct work\_struct \*work) kfree\_rcu(rcast, rcu); } + tn = tipc\_net(sock\_net(ub->ubsock->sk));+ dst\_cache\_destroy(&ub->rcast.dst\_cache); udp\_tunnel\_sock\_release(ub->ubsock);++ /\* Note: could use a call\_rcu() to avoid another synchronize\_net() \*/ synchronize\_net();- atomic\_dec(&tipc\_net(sock\_net(ub->ubsock->sk))->wq\_count);+ atomic\_dec(&tn->wq\_count); kfree(ub); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:24:25 +0000



=== Content from git.kernel.org_fed97263_20250114_212553.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d1d4dfb189a115734bff81c411bc58d9e348db7d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d1d4dfb189a115734bff81c411bc58d9e348db7d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d1d4dfb189a115734bff81c411bc58d9e348db7d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d1d4dfb189a115734bff81c411bc58d9e348db7d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Dumazet <edumazet@google.com> | 2024-12-04 17:05:48 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-19 18:05:03 +0100 |
| commit | [d1d4dfb189a115734bff81c411bc58d9e348db7d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d1d4dfb189a115734bff81c411bc58d9e348db7d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d1d4dfb189a115734bff81c411bc58d9e348db7d)) | |
| tree | [6d1d094c24097eec97f1e52f6e48e78ac57f08ba](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d1d4dfb189a115734bff81c411bc58d9e348db7d) | |
| parent | [89d94cf7a77b7038dd03334391cfdd56debb55de](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=89d94cf7a77b7038dd03334391cfdd56debb55de) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d1d4dfb189a115734bff81c411bc58d9e348db7d&id2=89d94cf7a77b7038dd03334391cfdd56debb55de)) | |
| download | [linux-d1d4dfb189a115734bff81c411bc58d9e348db7d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d1d4dfb189a115734bff81c411bc58d9e348db7d.tar.gz) | |

tipc: fix NULL deref in cleanup\_bearer()[ Upstream commit b04d86fff66b15c07505d226431f808c15b1703c ]
syzbot found [1] that after blamed commit, ub->ubsock->sk
was NULL when attempting the atomic\_dec() :
atomic\_dec(&tipc\_net(sock\_net(ub->ubsock->sk))->wq\_count);
Fix this by caching the tipc\_net pointer.
[1]
Oops: general protection fault, probably for non-canonical address 0xdffffc0000000006: 0000 [#1] PREEMPT SMP KASAN PTI
KASAN: null-ptr-deref in range [0x0000000000000030-0x0000000000000037]
CPU: 0 UID: 0 PID: 5896 Comm: kworker/0:3 Not tainted 6.13.0-rc1-next-20241203-syzkaller #0
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 09/13/2024
Workqueue: events cleanup\_bearer
RIP: 0010:read\_pnet include/net/net\_namespace.h:387 [inline]
RIP: 0010:sock\_net include/net/sock.h:655 [inline]
RIP: 0010:cleanup\_bearer+0x1f7/0x280 net/tipc/udp\_media.c:820
Code: 18 48 89 d8 48 c1 e8 03 42 80 3c 28 00 74 08 48 89 df e8 3c f7 99 f6 48 8b 1b 48 83 c3 30 e8 f0 e4 60 00 48 89 d8 48 c1 e8 03 <42> 80 3c 28 00 74 08 48 89 df e8 1a f7 99 f6 49 83 c7 e8 48 8b 1b
RSP: 0018:ffffc9000410fb70 EFLAGS: 00010206
RAX: 0000000000000006 RBX: 0000000000000030 RCX: ffff88802fe45a00
RDX: 0000000000000001 RSI: 0000000000000008 RDI: ffffc9000410f900
RBP: ffff88807e1f0908 R08: ffffc9000410f907 R09: 1ffff92000821f20
R10: dffffc0000000000 R11: fffff52000821f21 R12: ffff888031d19980
R13: dffffc0000000000 R14: dffffc0000000000 R15: ffff88807e1f0918
FS: 0000000000000000(0000) GS:ffff8880b8600000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 0000556ca050b000 CR3: 0000000031c0c000 CR4: 00000000003526f0
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
Fixes: 6a2fa13312e5 ("tipc: Fix use-after-free of kernel socket in cleanup\_bearer().")
Reported-by: syzbot+46aa5474f179dacd1a3b@syzkaller.appspotmail.com
Closes: https://lore.kernel.org/netdev/67508b5f.050a0220.17bd51.0070.GAE@google.com/T/#u
Signed-off-by: Eric Dumazet <edumazet@google.com>
Reviewed-by: Kuniyuki Iwashima <kuniyu@amazon.com>
Link: [https://patch.msgid.link/20241204170548.4152658-1-edumazet@google.com](https://patch.msgid.link/20241204170548.4152658-1-edumazet%40google.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d1d4dfb189a115734bff81c411bc58d9e348db7d)

| -rw-r--r-- | [net/tipc/udp\_media.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/tipc/udp_media.c?id=d1d4dfb189a115734bff81c411bc58d9e348db7d) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 1 deletions

| diff --git a/net/tipc/udp\_media.c b/net/tipc/udp\_media.cindex 696a21208b24b6..5f278c25462e27 100644--- a/[net/tipc/udp\_media.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/udp_media.c?id=89d94cf7a77b7038dd03334391cfdd56debb55de)+++ b/[net/tipc/udp\_media.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/udp_media.c?id=d1d4dfb189a115734bff81c411bc58d9e348db7d)@@ -798,6 +798,7 @@ static void cleanup\_bearer(struct work\_struct \*work) { struct udp\_bearer \*ub = container\_of(work, struct udp\_bearer, work); struct udp\_replicast \*rcast, \*tmp;+ struct tipc\_net \*tn;  list\_for\_each\_entry\_safe(rcast, tmp, &ub->rcast.list, list) { dst\_cache\_destroy(&rcast->dst\_cache);@@ -805,10 +806,14 @@ static void cleanup\_bearer(struct work\_struct \*work) kfree\_rcu(rcast, rcu); } + tn = tipc\_net(sock\_net(ub->ubsock->sk));+ dst\_cache\_destroy(&ub->rcast.dst\_cache); udp\_tunnel\_sock\_release(ub->ubsock);++ /\* Note: could use a call\_rcu() to avoid another synchronize\_net() \*/ synchronize\_net();- atomic\_dec(&tipc\_net(sock\_net(ub->ubsock->sk))->wq\_count);+ atomic\_dec(&tn->wq\_count); kfree(ub); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:24:30 +0000



=== Content from git.kernel.org_efccd64d_20250114_212551.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=a852c82eda4991e21610837aaa160965be71f5cc)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a852c82eda4991e21610837aaa160965be71f5cc)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a852c82eda4991e21610837aaa160965be71f5cc)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a852c82eda4991e21610837aaa160965be71f5cc)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Dumazet <edumazet@google.com> | 2024-12-04 17:05:48 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-19 18:13:12 +0100 |
| commit | [a852c82eda4991e21610837aaa160965be71f5cc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a852c82eda4991e21610837aaa160965be71f5cc) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=a852c82eda4991e21610837aaa160965be71f5cc)) | |
| tree | [e0e0b88d732d58c18be387322aca0ceb61f0e0c9](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a852c82eda4991e21610837aaa160965be71f5cc) | |
| parent | [14a122007c040598559fc567d38f8a66f50b7c2a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=14a122007c040598559fc567d38f8a66f50b7c2a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a852c82eda4991e21610837aaa160965be71f5cc&id2=14a122007c040598559fc567d38f8a66f50b7c2a)) | |
| download | [linux-a852c82eda4991e21610837aaa160965be71f5cc.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-a852c82eda4991e21610837aaa160965be71f5cc.tar.gz) | |

tipc: fix NULL deref in cleanup\_bearer()[ Upstream commit b04d86fff66b15c07505d226431f808c15b1703c ]
syzbot found [1] that after blamed commit, ub->ubsock->sk
was NULL when attempting the atomic\_dec() :
atomic\_dec(&tipc\_net(sock\_net(ub->ubsock->sk))->wq\_count);
Fix this by caching the tipc\_net pointer.
[1]
Oops: general protection fault, probably for non-canonical address 0xdffffc0000000006: 0000 [#1] PREEMPT SMP KASAN PTI
KASAN: null-ptr-deref in range [0x0000000000000030-0x0000000000000037]
CPU: 0 UID: 0 PID: 5896 Comm: kworker/0:3 Not tainted 6.13.0-rc1-next-20241203-syzkaller #0
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 09/13/2024
Workqueue: events cleanup\_bearer
RIP: 0010:read\_pnet include/net/net\_namespace.h:387 [inline]
RIP: 0010:sock\_net include/net/sock.h:655 [inline]
RIP: 0010:cleanup\_bearer+0x1f7/0x280 net/tipc/udp\_media.c:820
Code: 18 48 89 d8 48 c1 e8 03 42 80 3c 28 00 74 08 48 89 df e8 3c f7 99 f6 48 8b 1b 48 83 c3 30 e8 f0 e4 60 00 48 89 d8 48 c1 e8 03 <42> 80 3c 28 00 74 08 48 89 df e8 1a f7 99 f6 49 83 c7 e8 48 8b 1b
RSP: 0018:ffffc9000410fb70 EFLAGS: 00010206
RAX: 0000000000000006 RBX: 0000000000000030 RCX: ffff88802fe45a00
RDX: 0000000000000001 RSI: 0000000000000008 RDI: ffffc9000410f900
RBP: ffff88807e1f0908 R08: ffffc9000410f907 R09: 1ffff92000821f20
R10: dffffc0000000000 R11: fffff52000821f21 R12: ffff888031d19980
R13: dffffc0000000000 R14: dffffc0000000000 R15: ffff88807e1f0918
FS: 0000000000000000(0000) GS:ffff8880b8600000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 0000556ca050b000 CR3: 0000000031c0c000 CR4: 00000000003526f0
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
Fixes: 6a2fa13312e5 ("tipc: Fix use-after-free of kernel socket in cleanup\_bearer().")
Reported-by: syzbot+46aa5474f179dacd1a3b@syzkaller.appspotmail.com
Closes: https://lore.kernel.org/netdev/67508b5f.050a0220.17bd51.0070.GAE@google.com/T/#u
Signed-off-by: Eric Dumazet <edumazet@google.com>
Reviewed-by: Kuniyuki Iwashima <kuniyu@amazon.com>
Link: [https://patch.msgid.link/20241204170548.4152658-1-edumazet@google.com](https://patch.msgid.link/20241204170548.4152658-1-edumazet%40google.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a852c82eda4991e21610837aaa160965be71f5cc)

| -rw-r--r-- | [net/tipc/udp\_media.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/tipc/udp_media.c?id=a852c82eda4991e21610837aaa160965be71f5cc) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 1 deletions

| diff --git a/net/tipc/udp\_media.c b/net/tipc/udp\_media.cindex b7e25e7e9933b6..108a4cc2e00107 100644--- a/[net/tipc/udp\_media.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/udp_media.c?id=14a122007c040598559fc567d38f8a66f50b7c2a)+++ b/[net/tipc/udp\_media.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/udp_media.c?id=a852c82eda4991e21610837aaa160965be71f5cc)@@ -807,6 +807,7 @@ static void cleanup\_bearer(struct work\_struct \*work) { struct udp\_bearer \*ub = container\_of(work, struct udp\_bearer, work); struct udp\_replicast \*rcast, \*tmp;+ struct tipc\_net \*tn;  list\_for\_each\_entry\_safe(rcast, tmp, &ub->rcast.list, list) { dst\_cache\_destroy(&rcast->dst\_cache);@@ -814,10 +815,14 @@ static void cleanup\_bearer(struct work\_struct \*work) kfree\_rcu(rcast, rcu); } + tn = tipc\_net(sock\_net(ub->ubsock->sk));+ dst\_cache\_destroy(&ub->rcast.dst\_cache); udp\_tunnel\_sock\_release(ub->ubsock);++ /\* Note: could use a call\_rcu() to avoid another synchronize\_net() \*/ synchronize\_net();- atomic\_dec(&tipc\_net(sock\_net(ub->ubsock->sk))->wq\_count);+ atomic\_dec(&tn->wq\_count); kfree(ub); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:24:28 +0000



=== Content from git.kernel.org_ff8113ce_20250114_212550.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=a771f349c95d3397636861a0a6462d4a7a7ecb25)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a771f349c95d3397636861a0a6462d4a7a7ecb25)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a771f349c95d3397636861a0a6462d4a7a7ecb25)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a771f349c95d3397636861a0a6462d4a7a7ecb25)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Dumazet <edumazet@google.com> | 2024-12-04 17:05:48 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-19 18:06:10 +0100 |
| commit | [a771f349c95d3397636861a0a6462d4a7a7ecb25](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a771f349c95d3397636861a0a6462d4a7a7ecb25) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=a771f349c95d3397636861a0a6462d4a7a7ecb25)) | |
| tree | [404173977f5b7761c9c8a60498e7a816b9b7c731](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a771f349c95d3397636861a0a6462d4a7a7ecb25) | |
| parent | [784fc67079494b070f10f228d161af2f092348c5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=784fc67079494b070f10f228d161af2f092348c5) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a771f349c95d3397636861a0a6462d4a7a7ecb25&id2=784fc67079494b070f10f228d161af2f092348c5)) | |
| download | [linux-a771f349c95d3397636861a0a6462d4a7a7ecb25.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-a771f349c95d3397636861a0a6462d4a7a7ecb25.tar.gz) | |

tipc: fix NULL deref in cleanup\_bearer()[ Upstream commit b04d86fff66b15c07505d226431f808c15b1703c ]
syzbot found [1] that after blamed commit, ub->ubsock->sk
was NULL when attempting the atomic\_dec() :
atomic\_dec(&tipc\_net(sock\_net(ub->ubsock->sk))->wq\_count);
Fix this by caching the tipc\_net pointer.
[1]
Oops: general protection fault, probably for non-canonical address 0xdffffc0000000006: 0000 [#1] PREEMPT SMP KASAN PTI
KASAN: null-ptr-deref in range [0x0000000000000030-0x0000000000000037]
CPU: 0 UID: 0 PID: 5896 Comm: kworker/0:3 Not tainted 6.13.0-rc1-next-20241203-syzkaller #0
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 09/13/2024
Workqueue: events cleanup\_bearer
RIP: 0010:read\_pnet include/net/net\_namespace.h:387 [inline]
RIP: 0010:sock\_net include/net/sock.h:655 [inline]
RIP: 0010:cleanup\_bearer+0x1f7/0x280 net/tipc/udp\_media.c:820
Code: 18 48 89 d8 48 c1 e8 03 42 80 3c 28 00 74 08 48 89 df e8 3c f7 99 f6 48 8b 1b 48 83 c3 30 e8 f0 e4 60 00 48 89 d8 48 c1 e8 03 <42> 80 3c 28 00 74 08 48 89 df e8 1a f7 99 f6 49 83 c7 e8 48 8b 1b
RSP: 0018:ffffc9000410fb70 EFLAGS: 00010206
RAX: 0000000000000006 RBX: 0000000000000030 RCX: ffff88802fe45a00
RDX: 0000000000000001 RSI: 0000000000000008 RDI: ffffc9000410f900
RBP: ffff88807e1f0908 R08: ffffc9000410f907 R09: 1ffff92000821f20
R10: dffffc0000000000 R11: fffff52000821f21 R12: ffff888031d19980
R13: dffffc0000000000 R14: dffffc0000000000 R15: ffff88807e1f0918
FS: 0000000000000000(0000) GS:ffff8880b8600000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 0000556ca050b000 CR3: 0000000031c0c000 CR4: 00000000003526f0
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
Fixes: 6a2fa13312e5 ("tipc: Fix use-after-free of kernel socket in cleanup\_bearer().")
Reported-by: syzbot+46aa5474f179dacd1a3b@syzkaller.appspotmail.com
Closes: https://lore.kernel.org/netdev/67508b5f.050a0220.17bd51.0070.GAE@google.com/T/#u
Signed-off-by: Eric Dumazet <edumazet@google.com>
Reviewed-by: Kuniyuki Iwashima <kuniyu@amazon.com>
Link: [https://patch.msgid.link/20241204170548.4152658-1-edumazet@google.com](https://patch.msgid.link/20241204170548.4152658-1-edumazet%40google.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a771f349c95d3397636861a0a6462d4a7a7ecb25)

| -rw-r--r-- | [net/tipc/udp\_media.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/tipc/udp_media.c?id=a771f349c95d3397636861a0a6462d4a7a7ecb25) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 1 deletions

| diff --git a/net/tipc/udp\_media.c b/net/tipc/udp\_media.cindex d54b5c1d3c83c0..25e733919131c7 100644--- a/[net/tipc/udp\_media.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/udp_media.c?id=784fc67079494b070f10f228d161af2f092348c5)+++ b/[net/tipc/udp\_media.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/udp_media.c?id=a771f349c95d3397636861a0a6462d4a7a7ecb25)@@ -803,6 +803,7 @@ static void cleanup\_bearer(struct work\_struct \*work) { struct udp\_bearer \*ub = container\_of(work, struct udp\_bearer, work); struct udp\_replicast \*rcast, \*tmp;+ struct tipc\_net \*tn;  list\_for\_each\_entry\_safe(rcast, tmp, &ub->rcast.list, list) { dst\_cache\_destroy(&rcast->dst\_cache);@@ -810,10 +811,14 @@ static void cleanup\_bearer(struct work\_struct \*work) kfree\_rcu(rcast, rcu); } + tn = tipc\_net(sock\_net(ub->ubsock->sk));+ dst\_cache\_destroy(&ub->rcast.dst\_cache); udp\_tunnel\_sock\_release(ub->ubsock);++ /\* Note: could use a call\_rcu() to avoid another synchronize\_net() \*/ synchronize\_net();- atomic\_dec(&tipc\_net(sock\_net(ub->ubsock->sk))->wq\_count);+ atomic\_dec(&tn->wq\_count); kfree(ub); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:24:27 +0000



=== Content from git.kernel.org_1db1a451_20250114_212547.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=07b569eda6fe6a1e83be5a587abee12d1303f95e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=07b569eda6fe6a1e83be5a587abee12d1303f95e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=07b569eda6fe6a1e83be5a587abee12d1303f95e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=07b569eda6fe6a1e83be5a587abee12d1303f95e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Dumazet <edumazet@google.com> | 2024-12-04 17:05:48 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-19 18:07:19 +0100 |
| commit | [07b569eda6fe6a1e83be5a587abee12d1303f95e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=07b569eda6fe6a1e83be5a587abee12d1303f95e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=07b569eda6fe6a1e83be5a587abee12d1303f95e)) | |
| tree | [599e0e672ffe73c6767302c62404138eb2f9d633](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=07b569eda6fe6a1e83be5a587abee12d1303f95e) | |
| parent | [a864e2e1ceda0a68116c66dff25687a46b5c25a8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a864e2e1ceda0a68116c66dff25687a46b5c25a8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=07b569eda6fe6a1e83be5a587abee12d1303f95e&id2=a864e2e1ceda0a68116c66dff25687a46b5c25a8)) | |
| download | [linux-07b569eda6fe6a1e83be5a587abee12d1303f95e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-07b569eda6fe6a1e83be5a587abee12d1303f95e.tar.gz) | |

tipc: fix NULL deref in cleanup\_bearer()[ Upstream commit b04d86fff66b15c07505d226431f808c15b1703c ]
syzbot found [1] that after blamed commit, ub->ubsock->sk
was NULL when attempting the atomic\_dec() :
atomic\_dec(&tipc\_net(sock\_net(ub->ubsock->sk))->wq\_count);
Fix this by caching the tipc\_net pointer.
[1]
Oops: general protection fault, probably for non-canonical address 0xdffffc0000000006: 0000 [#1] PREEMPT SMP KASAN PTI
KASAN: null-ptr-deref in range [0x0000000000000030-0x0000000000000037]
CPU: 0 UID: 0 PID: 5896 Comm: kworker/0:3 Not tainted 6.13.0-rc1-next-20241203-syzkaller #0
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 09/13/2024
Workqueue: events cleanup\_bearer
RIP: 0010:read\_pnet include/net/net\_namespace.h:387 [inline]
RIP: 0010:sock\_net include/net/sock.h:655 [inline]
RIP: 0010:cleanup\_bearer+0x1f7/0x280 net/tipc/udp\_media.c:820
Code: 18 48 89 d8 48 c1 e8 03 42 80 3c 28 00 74 08 48 89 df e8 3c f7 99 f6 48 8b 1b 48 83 c3 30 e8 f0 e4 60 00 48 89 d8 48 c1 e8 03 <42> 80 3c 28 00 74 08 48 89 df e8 1a f7 99 f6 49 83 c7 e8 48 8b 1b
RSP: 0018:ffffc9000410fb70 EFLAGS: 00010206
RAX: 0000000000000006 RBX: 0000000000000030 RCX: ffff88802fe45a00
RDX: 0000000000000001 RSI: 0000000000000008 RDI: ffffc9000410f900
RBP: ffff88807e1f0908 R08: ffffc9000410f907 R09: 1ffff92000821f20
R10: dffffc0000000000 R11: fffff52000821f21 R12: ffff888031d19980
R13: dffffc0000000000 R14: dffffc0000000000 R15: ffff88807e1f0918
FS: 0000000000000000(0000) GS:ffff8880b8600000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 0000556ca050b000 CR3: 0000000031c0c000 CR4: 00000000003526f0
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
Fixes: 6a2fa13312e5 ("tipc: Fix use-after-free of kernel socket in cleanup\_bearer().")
Reported-by: syzbot+46aa5474f179dacd1a3b@syzkaller.appspotmail.com
Closes: https://lore.kernel.org/netdev/67508b5f.050a0220.17bd51.0070.GAE@google.com/T/#u
Signed-off-by: Eric Dumazet <edumazet@google.com>
Reviewed-by: Kuniyuki Iwashima <kuniyu@amazon.com>
Link: [https://patch.msgid.link/20241204170548.4152658-1-edumazet@google.com](https://patch.msgid.link/20241204170548.4152658-1-edumazet%40google.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=07b569eda6fe6a1e83be5a587abee12d1303f95e)

| -rw-r--r-- | [net/tipc/udp\_media.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/tipc/udp_media.c?id=07b569eda6fe6a1e83be5a587abee12d1303f95e) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 1 deletions

| diff --git a/net/tipc/udp\_media.c b/net/tipc/udp\_media.cindex 3f5a12b85b2d3e..f5bd75d931c1b5 100644--- a/[net/tipc/udp\_media.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/udp_media.c?id=a864e2e1ceda0a68116c66dff25687a46b5c25a8)+++ b/[net/tipc/udp\_media.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/udp_media.c?id=07b569eda6fe6a1e83be5a587abee12d1303f95e)@@ -811,6 +811,7 @@ static void cleanup\_bearer(struct work\_struct \*work) { struct udp\_bearer \*ub = container\_of(work, struct udp\_bearer, work); struct udp\_replicast \*rcast, \*tmp;+ struct tipc\_net \*tn;  list\_for\_each\_entry\_safe(rcast, tmp, &ub->rcast.list, list) { dst\_cache\_destroy(&rcast->dst\_cache);@@ -818,10 +819,14 @@ static void cleanup\_bearer(struct work\_struct \*work) kfree\_rcu(rcast, rcu); } + tn = tipc\_net(sock\_net(ub->ubsock->sk));+ dst\_cache\_destroy(&ub->rcast.dst\_cache); udp\_tunnel\_sock\_release(ub->ubsock);++ /\* Note: could use a call\_rcu() to avoid another synchronize\_net() \*/ synchronize\_net();- atomic\_dec(&tipc\_net(sock\_net(ub->ubsock->sk))->wq\_count);+ atomic\_dec(&tn->wq\_count); kfree(ub); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:24:24 +0000



=== Content from git.kernel.org_80daabb2_20250114_212552.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b04d86fff66b15c07505d226431f808c15b1703c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b04d86fff66b15c07505d226431f808c15b1703c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b04d86fff66b15c07505d226431f808c15b1703c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b04d86fff66b15c07505d226431f808c15b1703c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Dumazet <edumazet@google.com> | 2024-12-04 17:05:48 +0000 |
| --- | --- | --- |
| committer | Jakub Kicinski <kuba@kernel.org> | 2024-12-05 17:36:22 -0800 |
| commit | [b04d86fff66b15c07505d226431f808c15b1703c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b04d86fff66b15c07505d226431f808c15b1703c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b04d86fff66b15c07505d226431f808c15b1703c)) | |
| tree | [46ff8995d6e44039ffa225ae8798a6fc2aa52832](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b04d86fff66b15c07505d226431f808c15b1703c) | |
| parent | [896d8946da97332d4dc80fa1937d8dd6b1c35ad4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=896d8946da97332d4dc80fa1937d8dd6b1c35ad4) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b04d86fff66b15c07505d226431f808c15b1703c&id2=896d8946da97332d4dc80fa1937d8dd6b1c35ad4)) | |
| download | [linux-b04d86fff66b15c07505d226431f808c15b1703c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b04d86fff66b15c07505d226431f808c15b1703c.tar.gz) | |

tipc: fix NULL deref in cleanup\_bearer()syzbot found [1] that after blamed commit, ub->ubsock->sk
was NULL when attempting the atomic\_dec() :
atomic\_dec(&tipc\_net(sock\_net(ub->ubsock->sk))->wq\_count);
Fix this by caching the tipc\_net pointer.
[1]
Oops: general protection fault, probably for non-canonical address 0xdffffc0000000006: 0000 [#1] PREEMPT SMP KASAN PTI
KASAN: null-ptr-deref in range [0x0000000000000030-0x0000000000000037]
CPU: 0 UID: 0 PID: 5896 Comm: kworker/0:3 Not tainted 6.13.0-rc1-next-20241203-syzkaller #0
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 09/13/2024
Workqueue: events cleanup\_bearer
RIP: 0010:read\_pnet include/net/net\_namespace.h:387 [inline]
RIP: 0010:sock\_net include/net/sock.h:655 [inline]
RIP: 0010:cleanup\_bearer+0x1f7/0x280 net/tipc/udp\_media.c:820
Code: 18 48 89 d8 48 c1 e8 03 42 80 3c 28 00 74 08 48 89 df e8 3c f7 99 f6 48 8b 1b 48 83 c3 30 e8 f0 e4 60 00 48 89 d8 48 c1 e8 03 <42> 80 3c 28 00 74 08 48 89 df e8 1a f7 99 f6 49 83 c7 e8 48 8b 1b
RSP: 0018:ffffc9000410fb70 EFLAGS: 00010206
RAX: 0000000000000006 RBX: 0000000000000030 RCX: ffff88802fe45a00
RDX: 0000000000000001 RSI: 0000000000000008 RDI: ffffc9000410f900
RBP: ffff88807e1f0908 R08: ffffc9000410f907 R09: 1ffff92000821f20
R10: dffffc0000000000 R11: fffff52000821f21 R12: ffff888031d19980
R13: dffffc0000000000 R14: dffffc0000000000 R15: ffff88807e1f0918
FS: 0000000000000000(0000) GS:ffff8880b8600000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 0000556ca050b000 CR3: 0000000031c0c000 CR4: 00000000003526f0
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
Fixes: 6a2fa13312e5 ("tipc: Fix use-after-free of kernel socket in cleanup\_bearer().")
Reported-by: syzbot+46aa5474f179dacd1a3b@syzkaller.appspotmail.com
Closes: https://lore.kernel.org/netdev/67508b5f.050a0220.17bd51.0070.GAE@google.com/T/#u
Signed-off-by: Eric Dumazet <edumazet@google.com>
Reviewed-by: Kuniyuki Iwashima <kuniyu@amazon.com>
Link: [https://patch.msgid.link/20241204170548.4152658-1-edumazet@google.com](https://patch.msgid.link/20241204170548.4152658-1-edumazet%40google.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b04d86fff66b15c07505d226431f808c15b1703c)

| -rw-r--r-- | [net/tipc/udp\_media.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/tipc/udp_media.c?id=b04d86fff66b15c07505d226431f808c15b1703c) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 1 deletions

| diff --git a/net/tipc/udp\_media.c b/net/tipc/udp\_media.cindex b7e25e7e9933b6..108a4cc2e00107 100644--- a/[net/tipc/udp\_media.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/udp_media.c?id=896d8946da97332d4dc80fa1937d8dd6b1c35ad4)+++ b/[net/tipc/udp\_media.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/udp_media.c?id=b04d86fff66b15c07505d226431f808c15b1703c)@@ -807,6 +807,7 @@ static void cleanup\_bearer(struct work\_struct \*work) { struct udp\_bearer \*ub = container\_of(work, struct udp\_bearer, work); struct udp\_replicast \*rcast, \*tmp;+ struct tipc\_net \*tn;  list\_for\_each\_entry\_safe(rcast, tmp, &ub->rcast.list, list) { dst\_cache\_destroy(&rcast->dst\_cache);@@ -814,10 +815,14 @@ static void cleanup\_bearer(struct work\_struct \*work) kfree\_rcu(rcast, rcu); } + tn = tipc\_net(sock\_net(ub->ubsock->sk));+ dst\_cache\_destroy(&ub->rcast.dst\_cache); udp\_tunnel\_sock\_release(ub->ubsock);++ /\* Note: could use a call\_rcu() to avoid another synchronize\_net() \*/ synchronize\_net();- atomic\_dec(&tipc\_net(sock\_net(ub->ubsock->sk))->wq\_count);+ atomic\_dec(&tn->wq\_count); kfree(ub); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:24:29 +0000



=== Content from git.kernel.org_23939a65_20250114_212549.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=89ecda492d0a37fd00aaffc4151f1f44c26d93ac)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=89ecda492d0a37fd00aaffc4151f1f44c26d93ac)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=89ecda492d0a37fd00aaffc4151f1f44c26d93ac)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=89ecda492d0a37fd00aaffc4151f1f44c26d93ac)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Dumazet <edumazet@google.com> | 2024-12-04 17:05:48 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-19 18:11:27 +0100 |
| commit | [89ecda492d0a37fd00aaffc4151f1f44c26d93ac](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=89ecda492d0a37fd00aaffc4151f1f44c26d93ac) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=89ecda492d0a37fd00aaffc4151f1f44c26d93ac)) | |
| tree | [fa02229ea9538279dad7392a51d85fc275dcc0a2](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=89ecda492d0a37fd00aaffc4151f1f44c26d93ac) | |
| parent | [4a9a7f9f745d8a42a6006b55536eb40dc681671a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4a9a7f9f745d8a42a6006b55536eb40dc681671a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=89ecda492d0a37fd00aaffc4151f1f44c26d93ac&id2=4a9a7f9f745d8a42a6006b55536eb40dc681671a)) | |
| download | [linux-89ecda492d0a37fd00aaffc4151f1f44c26d93ac.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-89ecda492d0a37fd00aaffc4151f1f44c26d93ac.tar.gz) | |

tipc: fix NULL deref in cleanup\_bearer()[ Upstream commit b04d86fff66b15c07505d226431f808c15b1703c ]
syzbot found [1] that after blamed commit, ub->ubsock->sk
was NULL when attempting the atomic\_dec() :
atomic\_dec(&tipc\_net(sock\_net(ub->ubsock->sk))->wq\_count);
Fix this by caching the tipc\_net pointer.
[1]
Oops: general protection fault, probably for non-canonical address 0xdffffc0000000006: 0000 [#1] PREEMPT SMP KASAN PTI
KASAN: null-ptr-deref in range [0x0000000000000030-0x0000000000000037]
CPU: 0 UID: 0 PID: 5896 Comm: kworker/0:3 Not tainted 6.13.0-rc1-next-20241203-syzkaller #0
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 09/13/2024
Workqueue: events cleanup\_bearer
RIP: 0010:read\_pnet include/net/net\_namespace.h:387 [inline]
RIP: 0010:sock\_net include/net/sock.h:655 [inline]
RIP: 0010:cleanup\_bearer+0x1f7/0x280 net/tipc/udp\_media.c:820
Code: 18 48 89 d8 48 c1 e8 03 42 80 3c 28 00 74 08 48 89 df e8 3c f7 99 f6 48 8b 1b 48 83 c3 30 e8 f0 e4 60 00 48 89 d8 48 c1 e8 03 <42> 80 3c 28 00 74 08 48 89 df e8 1a f7 99 f6 49 83 c7 e8 48 8b 1b
RSP: 0018:ffffc9000410fb70 EFLAGS: 00010206
RAX: 0000000000000006 RBX: 0000000000000030 RCX: ffff88802fe45a00
RDX: 0000000000000001 RSI: 0000000000000008 RDI: ffffc9000410f900
RBP: ffff88807e1f0908 R08: ffffc9000410f907 R09: 1ffff92000821f20
R10: dffffc0000000000 R11: fffff52000821f21 R12: ffff888031d19980
R13: dffffc0000000000 R14: dffffc0000000000 R15: ffff88807e1f0918
FS: 0000000000000000(0000) GS:ffff8880b8600000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 0000556ca050b000 CR3: 0000000031c0c000 CR4: 00000000003526f0
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
Fixes: 6a2fa13312e5 ("tipc: Fix use-after-free of kernel socket in cleanup\_bearer().")
Reported-by: syzbot+46aa5474f179dacd1a3b@syzkaller.appspotmail.com
Closes: https://lore.kernel.org/netdev/67508b5f.050a0220.17bd51.0070.GAE@google.com/T/#u
Signed-off-by: Eric Dumazet <edumazet@google.com>
Reviewed-by: Kuniyuki Iwashima <kuniyu@amazon.com>
Link: [https://patch.msgid.link/20241204170548.4152658-1-edumazet@google.com](https://patch.msgid.link/20241204170548.4152658-1-edumazet%40google.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=89ecda492d0a37fd00aaffc4151f1f44c26d93ac)

| -rw-r--r-- | [net/tipc/udp\_media.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/tipc/udp_media.c?id=89ecda492d0a37fd00aaffc4151f1f44c26d93ac) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 1 deletions

| diff --git a/net/tipc/udp\_media.c b/net/tipc/udp\_media.cindex 70a39e29a6352c..b16ca400ff559c 100644--- a/[net/tipc/udp\_media.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/udp_media.c?id=4a9a7f9f745d8a42a6006b55536eb40dc681671a)+++ b/[net/tipc/udp\_media.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/udp_media.c?id=89ecda492d0a37fd00aaffc4151f1f44c26d93ac)@@ -807,6 +807,7 @@ static void cleanup\_bearer(struct work\_struct \*work) { struct udp\_bearer \*ub = container\_of(work, struct udp\_bearer, work); struct udp\_replicast \*rcast, \*tmp;+ struct tipc\_net \*tn;  list\_for\_each\_entry\_safe(rcast, tmp, &ub->rcast.list, list) { dst\_cache\_destroy(&rcast->dst\_cache);@@ -814,10 +815,14 @@ static void cleanup\_bearer(struct work\_struct \*work) kfree\_rcu(rcast, rcu); } + tn = tipc\_net(sock\_net(ub->ubsock->sk));+ dst\_cache\_destroy(&ub->rcast.dst\_cache); udp\_tunnel\_sock\_release(ub->ubsock);++ /\* Note: could use a call\_rcu() to avoid another synchronize\_net() \*/ synchronize\_net();- atomic\_dec(&tipc\_net(sock\_net(ub->ubsock->sk))->wq\_count);+ atomic\_dec(&tn->wq\_count); kfree(ub); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:24:26 +0000


