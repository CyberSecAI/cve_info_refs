=== Content from git.kernel.org_e56fd68a_20250114_190015.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1def915b1564f4375330bd113ea1d768a569cfd8)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1def915b1564f4375330bd113ea1d768a569cfd8)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1def915b1564f4375330bd113ea1d768a569cfd8)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1def915b1564f4375330bd113ea1d768a569cfd8)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Alexander Shiyan <eagle.alexander923@gmail.com> | 2024-10-09 09:05:44 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-09 10:40:58 +0100 |
| commit | [1def915b1564f4375330bd113ea1d768a569cfd8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1def915b1564f4375330bd113ea1d768a569cfd8) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1def915b1564f4375330bd113ea1d768a569cfd8)) | |
| tree | [47bdbde5e94b96fbe32b2e9b4f5aa0a45954e006](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1def915b1564f4375330bd113ea1d768a569cfd8) | |
| parent | [6f655bc1f7127288148f0e09c4315bebdcab1f2d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6f655bc1f7127288148f0e09c4315bebdcab1f2d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1def915b1564f4375330bd113ea1d768a569cfd8&id2=6f655bc1f7127288148f0e09c4315bebdcab1f2d)) | |
| download | [linux-1def915b1564f4375330bd113ea1d768a569cfd8.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1def915b1564f4375330bd113ea1d768a569cfd8.tar.gz) | |

media: i2c: tc358743: Fix crash in the probe error path when using pollingcommit 869f38ae07f7df829da4951c3d1f7a2be09c2e9a upstream.
If an error occurs in the probe() function, we should remove the polling
timer that was alarmed earlier, otherwise the timer is called with
arguments that are already freed, which results in a crash.
------------[ cut here ]------------
WARNING: CPU: 3 PID: 0 at kernel/time/timer.c:1830 \_\_run\_timers+0x244/0x268
Modules linked in:
CPU: 3 UID: 0 PID: 0 Comm: swapper/3 Not tainted 6.11.0 #226
Hardware name: Diasom DS-RK3568-SOM-EVB (DT)
pstate: 804000c9 (Nzcv daIF +PAN -UAO -TCO -DIT -SSBS BTYPE=--)
pc : \_\_run\_timers+0x244/0x268
lr : \_\_run\_timers+0x1d4/0x268
sp : ffffff80eff2baf0
x29: ffffff80eff2bb50 x28: 7fffffffffffffff x27: ffffff80eff2bb00
x26: ffffffc080f669c0 x25: ffffff80efef6bf0 x24: ffffff80eff2bb00
x23: 0000000000000000 x22: dead000000000122 x21: 0000000000000000
x20: ffffff80efef6b80 x19: ffffff80041c8bf8 x18: ffffffffffffffff
x17: ffffffc06f146000 x16: ffffff80eff27dc0 x15: 000000000000003e
x14: 0000000000000000 x13: 00000000000054da x12: 0000000000000000
x11: 00000000000639c0 x10: 000000000000000c x9 : 0000000000000009
x8 : ffffff80eff2cb40 x7 : ffffff80eff2cb40 x6 : ffffff8002bee480
x5 : ffffffc080cb2220 x4 : ffffffc080cb2150 x3 : 00000000000f4240
x2 : 0000000000000102 x1 : ffffff80eff2bb00 x0 : ffffff80041c8bf0
Call trace:
 \_\_run\_timers+0x244/0x268
 timer\_expire\_remote+0x50/0x68
 tmigr\_handle\_remote+0x388/0x39c
 run\_timer\_softirq+0x38/0x44
 handle\_softirqs+0x138/0x298
 \_\_do\_softirq+0x14/0x20
 \_\_\_\_do\_softirq+0x10/0x1c
 call\_on\_irq\_stack+0x24/0x4c
 do\_softirq\_own\_stack+0x1c/0x2c
 irq\_exit\_rcu+0x9c/0xcc
 el1\_interrupt+0x48/0xc0
 el1h\_64\_irq\_handler+0x18/0x24
 el1h\_64\_irq+0x7c/0x80
 default\_idle\_call+0x34/0x68
 do\_idle+0x23c/0x294
 cpu\_startup\_entry+0x38/0x3c
 secondary\_start\_kernel+0x128/0x160
 \_\_secondary\_switched+0xb8/0xbc
---[ end trace 0000000000000000 ]---
Fixes: 4e66a52a2e4c ("[media] tc358743: Add support for platforms without IRQ line")
Signed-off-by: Alexander Shiyan <eagle.alexander923@gmail.com>
Cc: stable@vger.kernel.org
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1def915b1564f4375330bd113ea1d768a569cfd8)

| -rw-r--r-- | [drivers/media/i2c/tc358743.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/i2c/tc358743.c?id=1def915b1564f4375330bd113ea1d768a569cfd8) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/drivers/media/i2c/tc358743.c b/drivers/media/i2c/tc358743.cindex 65d58ddf02870d..344a670e732fa5 100644--- a/[drivers/media/i2c/tc358743.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/i2c/tc358743.c?id=6f655bc1f7127288148f0e09c4315bebdcab1f2d)+++ b/[drivers/media/i2c/tc358743.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/i2c/tc358743.c?id=1def915b1564f4375330bd113ea1d768a569cfd8)@@ -2168,8 +2168,10 @@ static int tc358743\_probe(struct i2c\_client \*client)  err\_work\_queues: cec\_unregister\_adapter(state->cec\_adap);- if (!state->i2c\_client->irq)+ if (!state->i2c\_client->irq) {+ del\_timer(&state->timer); flush\_work(&state->work\_i2c\_poll);+ } cancel\_delayed\_work(&state->delayed\_work\_enable\_hotplug); mutex\_destroy(&state->confctl\_mutex); err\_hdl: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:58:52 +0000



=== Content from git.kernel.org_5c319e67_20250114_190015.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=34a3466a92f50c51d984f0ec2e96864886d460eb)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=34a3466a92f50c51d984f0ec2e96864886d460eb)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=34a3466a92f50c51d984f0ec2e96864886d460eb)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=34a3466a92f50c51d984f0ec2e96864886d460eb)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Alexander Shiyan <eagle.alexander923@gmail.com> | 2024-10-09 09:05:44 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:54:11 +0100 |
| commit | [34a3466a92f50c51d984f0ec2e96864886d460eb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=34a3466a92f50c51d984f0ec2e96864886d460eb) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=34a3466a92f50c51d984f0ec2e96864886d460eb)) | |
| tree | [a9492238b961d4c42f603dde60820dc49c4bef14](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=34a3466a92f50c51d984f0ec2e96864886d460eb) | |
| parent | [9eb254505debc101e0475b35442c41cc9901226a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9eb254505debc101e0475b35442c41cc9901226a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=34a3466a92f50c51d984f0ec2e96864886d460eb&id2=9eb254505debc101e0475b35442c41cc9901226a)) | |
| download | [linux-34a3466a92f50c51d984f0ec2e96864886d460eb.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-34a3466a92f50c51d984f0ec2e96864886d460eb.tar.gz) | |

media: i2c: tc358743: Fix crash in the probe error path when using pollingcommit 869f38ae07f7df829da4951c3d1f7a2be09c2e9a upstream.
If an error occurs in the probe() function, we should remove the polling
timer that was alarmed earlier, otherwise the timer is called with
arguments that are already freed, which results in a crash.
------------[ cut here ]------------
WARNING: CPU: 3 PID: 0 at kernel/time/timer.c:1830 \_\_run\_timers+0x244/0x268
Modules linked in:
CPU: 3 UID: 0 PID: 0 Comm: swapper/3 Not tainted 6.11.0 #226
Hardware name: Diasom DS-RK3568-SOM-EVB (DT)
pstate: 804000c9 (Nzcv daIF +PAN -UAO -TCO -DIT -SSBS BTYPE=--)
pc : \_\_run\_timers+0x244/0x268
lr : \_\_run\_timers+0x1d4/0x268
sp : ffffff80eff2baf0
x29: ffffff80eff2bb50 x28: 7fffffffffffffff x27: ffffff80eff2bb00
x26: ffffffc080f669c0 x25: ffffff80efef6bf0 x24: ffffff80eff2bb00
x23: 0000000000000000 x22: dead000000000122 x21: 0000000000000000
x20: ffffff80efef6b80 x19: ffffff80041c8bf8 x18: ffffffffffffffff
x17: ffffffc06f146000 x16: ffffff80eff27dc0 x15: 000000000000003e
x14: 0000000000000000 x13: 00000000000054da x12: 0000000000000000
x11: 00000000000639c0 x10: 000000000000000c x9 : 0000000000000009
x8 : ffffff80eff2cb40 x7 : ffffff80eff2cb40 x6 : ffffff8002bee480
x5 : ffffffc080cb2220 x4 : ffffffc080cb2150 x3 : 00000000000f4240
x2 : 0000000000000102 x1 : ffffff80eff2bb00 x0 : ffffff80041c8bf0
Call trace:
 \_\_run\_timers+0x244/0x268
 timer\_expire\_remote+0x50/0x68
 tmigr\_handle\_remote+0x388/0x39c
 run\_timer\_softirq+0x38/0x44
 handle\_softirqs+0x138/0x298
 \_\_do\_softirq+0x14/0x20
 \_\_\_\_do\_softirq+0x10/0x1c
 call\_on\_irq\_stack+0x24/0x4c
 do\_softirq\_own\_stack+0x1c/0x2c
 irq\_exit\_rcu+0x9c/0xcc
 el1\_interrupt+0x48/0xc0
 el1h\_64\_irq\_handler+0x18/0x24
 el1h\_64\_irq+0x7c/0x80
 default\_idle\_call+0x34/0x68
 do\_idle+0x23c/0x294
 cpu\_startup\_entry+0x38/0x3c
 secondary\_start\_kernel+0x128/0x160
 \_\_secondary\_switched+0xb8/0xbc
---[ end trace 0000000000000000 ]---
Fixes: 4e66a52a2e4c ("[media] tc358743: Add support for platforms without IRQ line")
Signed-off-by: Alexander Shiyan <eagle.alexander923@gmail.com>
Cc: stable@vger.kernel.org
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=34a3466a92f50c51d984f0ec2e96864886d460eb)

| -rw-r--r-- | [drivers/media/i2c/tc358743.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/i2c/tc358743.c?id=34a3466a92f50c51d984f0ec2e96864886d460eb) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/drivers/media/i2c/tc358743.c b/drivers/media/i2c/tc358743.cindex 68628ccecd1611..45dd91d1cd8164 100644--- a/[drivers/media/i2c/tc358743.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/i2c/tc358743.c?id=9eb254505debc101e0475b35442c41cc9901226a)+++ b/[drivers/media/i2c/tc358743.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/i2c/tc358743.c?id=34a3466a92f50c51d984f0ec2e96864886d460eb)@@ -2162,8 +2162,10 @@ static int tc358743\_probe(struct i2c\_client \*client)  err\_work\_queues: cec\_unregister\_adapter(state->cec\_adap);- if (!state->i2c\_client->irq)+ if (!state->i2c\_client->irq) {+ del\_timer(&state->timer); flush\_work(&state->work\_i2c\_poll);+ } cancel\_delayed\_work(&state->delayed\_work\_enable\_hotplug); mutex\_destroy(&state->confctl\_mutex); err\_hdl: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:58:52 +0000



=== Content from git.kernel.org_f90c8636_20250114_190014.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=13193a97ddd5a6a5b11408ddbc1ae85588b1860c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=13193a97ddd5a6a5b11408ddbc1ae85588b1860c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=13193a97ddd5a6a5b11408ddbc1ae85588b1860c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=13193a97ddd5a6a5b11408ddbc1ae85588b1860c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Alexander Shiyan <eagle.alexander923@gmail.com> | 2024-10-09 09:05:44 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:44:42 +0100 |
| commit | [13193a97ddd5a6a5b11408ddbc1ae85588b1860c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=13193a97ddd5a6a5b11408ddbc1ae85588b1860c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=13193a97ddd5a6a5b11408ddbc1ae85588b1860c)) | |
| tree | [93999636d0f8d794069798ccb68a2dd7fe64aa92](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=13193a97ddd5a6a5b11408ddbc1ae85588b1860c) | |
| parent | [dfb9fe7de61f34cc241ab3900bdde93341096e0e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=dfb9fe7de61f34cc241ab3900bdde93341096e0e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=13193a97ddd5a6a5b11408ddbc1ae85588b1860c&id2=dfb9fe7de61f34cc241ab3900bdde93341096e0e)) | |
| download | [linux-13193a97ddd5a6a5b11408ddbc1ae85588b1860c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-13193a97ddd5a6a5b11408ddbc1ae85588b1860c.tar.gz) | |

media: i2c: tc358743: Fix crash in the probe error path when using pollingcommit 869f38ae07f7df829da4951c3d1f7a2be09c2e9a upstream.
If an error occurs in the probe() function, we should remove the polling
timer that was alarmed earlier, otherwise the timer is called with
arguments that are already freed, which results in a crash.
------------[ cut here ]------------
WARNING: CPU: 3 PID: 0 at kernel/time/timer.c:1830 \_\_run\_timers+0x244/0x268
Modules linked in:
CPU: 3 UID: 0 PID: 0 Comm: swapper/3 Not tainted 6.11.0 #226
Hardware name: Diasom DS-RK3568-SOM-EVB (DT)
pstate: 804000c9 (Nzcv daIF +PAN -UAO -TCO -DIT -SSBS BTYPE=--)
pc : \_\_run\_timers+0x244/0x268
lr : \_\_run\_timers+0x1d4/0x268
sp : ffffff80eff2baf0
x29: ffffff80eff2bb50 x28: 7fffffffffffffff x27: ffffff80eff2bb00
x26: ffffffc080f669c0 x25: ffffff80efef6bf0 x24: ffffff80eff2bb00
x23: 0000000000000000 x22: dead000000000122 x21: 0000000000000000
x20: ffffff80efef6b80 x19: ffffff80041c8bf8 x18: ffffffffffffffff
x17: ffffffc06f146000 x16: ffffff80eff27dc0 x15: 000000000000003e
x14: 0000000000000000 x13: 00000000000054da x12: 0000000000000000
x11: 00000000000639c0 x10: 000000000000000c x9 : 0000000000000009
x8 : ffffff80eff2cb40 x7 : ffffff80eff2cb40 x6 : ffffff8002bee480
x5 : ffffffc080cb2220 x4 : ffffffc080cb2150 x3 : 00000000000f4240
x2 : 0000000000000102 x1 : ffffff80eff2bb00 x0 : ffffff80041c8bf0
Call trace:
 \_\_run\_timers+0x244/0x268
 timer\_expire\_remote+0x50/0x68
 tmigr\_handle\_remote+0x388/0x39c
 run\_timer\_softirq+0x38/0x44
 handle\_softirqs+0x138/0x298
 \_\_do\_softirq+0x14/0x20
 \_\_\_\_do\_softirq+0x10/0x1c
 call\_on\_irq\_stack+0x24/0x4c
 do\_softirq\_own\_stack+0x1c/0x2c
 irq\_exit\_rcu+0x9c/0xcc
 el1\_interrupt+0x48/0xc0
 el1h\_64\_irq\_handler+0x18/0x24
 el1h\_64\_irq+0x7c/0x80
 default\_idle\_call+0x34/0x68
 do\_idle+0x23c/0x294
 cpu\_startup\_entry+0x38/0x3c
 secondary\_start\_kernel+0x128/0x160
 \_\_secondary\_switched+0xb8/0xbc
---[ end trace 0000000000000000 ]---
Fixes: 4e66a52a2e4c ("[media] tc358743: Add support for platforms without IRQ line")
Signed-off-by: Alexander Shiyan <eagle.alexander923@gmail.com>
Cc: stable@vger.kernel.org
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=13193a97ddd5a6a5b11408ddbc1ae85588b1860c)

| -rw-r--r-- | [drivers/media/i2c/tc358743.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/i2c/tc358743.c?id=13193a97ddd5a6a5b11408ddbc1ae85588b1860c) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/drivers/media/i2c/tc358743.c b/drivers/media/i2c/tc358743.cindex ef1460c61bea0a..f042570bc5cae1 100644--- a/[drivers/media/i2c/tc358743.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/i2c/tc358743.c?id=dfb9fe7de61f34cc241ab3900bdde93341096e0e)+++ b/[drivers/media/i2c/tc358743.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/i2c/tc358743.c?id=13193a97ddd5a6a5b11408ddbc1ae85588b1860c)@@ -2175,8 +2175,10 @@ static int tc358743\_probe(struct i2c\_client \*client)  err\_work\_queues: cec\_unregister\_adapter(state->cec\_adap);- if (!state->i2c\_client->irq)+ if (!state->i2c\_client->irq) {+ del\_timer(&state->timer); flush\_work(&state->work\_i2c\_poll);+ } cancel\_delayed\_work(&state->delayed\_work\_enable\_hotplug); mutex\_destroy(&state->confctl\_mutex); err\_hdl: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:58:51 +0000



=== Content from git.kernel.org_b017e93f_20250114_190020.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b59ab89bc83f7bff67f78c6caf484a84a6dd30f7)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b59ab89bc83f7bff67f78c6caf484a84a6dd30f7)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b59ab89bc83f7bff67f78c6caf484a84a6dd30f7)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b59ab89bc83f7bff67f78c6caf484a84a6dd30f7)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Alexander Shiyan <eagle.alexander923@gmail.com> | 2024-10-09 09:05:44 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-09 10:33:02 +0100 |
| commit | [b59ab89bc83f7bff67f78c6caf484a84a6dd30f7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b59ab89bc83f7bff67f78c6caf484a84a6dd30f7) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b59ab89bc83f7bff67f78c6caf484a84a6dd30f7)) | |
| tree | [05e7aacf1571b53975274514f84d99f4c0215d3d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b59ab89bc83f7bff67f78c6caf484a84a6dd30f7) | |
| parent | [76ef98f9131e511d59877b4a712ea1da7993655f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=76ef98f9131e511d59877b4a712ea1da7993655f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b59ab89bc83f7bff67f78c6caf484a84a6dd30f7&id2=76ef98f9131e511d59877b4a712ea1da7993655f)) | |
| download | [linux-b59ab89bc83f7bff67f78c6caf484a84a6dd30f7.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b59ab89bc83f7bff67f78c6caf484a84a6dd30f7.tar.gz) | |

media: i2c: tc358743: Fix crash in the probe error path when using pollingcommit 869f38ae07f7df829da4951c3d1f7a2be09c2e9a upstream.
If an error occurs in the probe() function, we should remove the polling
timer that was alarmed earlier, otherwise the timer is called with
arguments that are already freed, which results in a crash.
------------[ cut here ]------------
WARNING: CPU: 3 PID: 0 at kernel/time/timer.c:1830 \_\_run\_timers+0x244/0x268
Modules linked in:
CPU: 3 UID: 0 PID: 0 Comm: swapper/3 Not tainted 6.11.0 #226
Hardware name: Diasom DS-RK3568-SOM-EVB (DT)
pstate: 804000c9 (Nzcv daIF +PAN -UAO -TCO -DIT -SSBS BTYPE=--)
pc : \_\_run\_timers+0x244/0x268
lr : \_\_run\_timers+0x1d4/0x268
sp : ffffff80eff2baf0
x29: ffffff80eff2bb50 x28: 7fffffffffffffff x27: ffffff80eff2bb00
x26: ffffffc080f669c0 x25: ffffff80efef6bf0 x24: ffffff80eff2bb00
x23: 0000000000000000 x22: dead000000000122 x21: 0000000000000000
x20: ffffff80efef6b80 x19: ffffff80041c8bf8 x18: ffffffffffffffff
x17: ffffffc06f146000 x16: ffffff80eff27dc0 x15: 000000000000003e
x14: 0000000000000000 x13: 00000000000054da x12: 0000000000000000
x11: 00000000000639c0 x10: 000000000000000c x9 : 0000000000000009
x8 : ffffff80eff2cb40 x7 : ffffff80eff2cb40 x6 : ffffff8002bee480
x5 : ffffffc080cb2220 x4 : ffffffc080cb2150 x3 : 00000000000f4240
x2 : 0000000000000102 x1 : ffffff80eff2bb00 x0 : ffffff80041c8bf0
Call trace:
 \_\_run\_timers+0x244/0x268
 timer\_expire\_remote+0x50/0x68
 tmigr\_handle\_remote+0x388/0x39c
 run\_timer\_softirq+0x38/0x44
 handle\_softirqs+0x138/0x298
 \_\_do\_softirq+0x14/0x20
 \_\_\_\_do\_softirq+0x10/0x1c
 call\_on\_irq\_stack+0x24/0x4c
 do\_softirq\_own\_stack+0x1c/0x2c
 irq\_exit\_rcu+0x9c/0xcc
 el1\_interrupt+0x48/0xc0
 el1h\_64\_irq\_handler+0x18/0x24
 el1h\_64\_irq+0x7c/0x80
 default\_idle\_call+0x34/0x68
 do\_idle+0x23c/0x294
 cpu\_startup\_entry+0x38/0x3c
 secondary\_start\_kernel+0x128/0x160
 \_\_secondary\_switched+0xb8/0xbc
---[ end trace 0000000000000000 ]---
Fixes: 4e66a52a2e4c ("[media] tc358743: Add support for platforms without IRQ line")
Signed-off-by: Alexander Shiyan <eagle.alexander923@gmail.com>
Cc: stable@vger.kernel.org
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b59ab89bc83f7bff67f78c6caf484a84a6dd30f7)

| -rw-r--r-- | [drivers/media/i2c/tc358743.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/i2c/tc358743.c?id=b59ab89bc83f7bff67f78c6caf484a84a6dd30f7) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/drivers/media/i2c/tc358743.c b/drivers/media/i2c/tc358743.cindex 558152575d1022..c81dd41834043f 100644--- a/[drivers/media/i2c/tc358743.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/i2c/tc358743.c?id=76ef98f9131e511d59877b4a712ea1da7993655f)+++ b/[drivers/media/i2c/tc358743.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/i2c/tc358743.c?id=b59ab89bc83f7bff67f78c6caf484a84a6dd30f7)@@ -2159,8 +2159,10 @@ static int tc358743\_probe(struct i2c\_client \*client)  err\_work\_queues: cec\_unregister\_adapter(state->cec\_adap);- if (!state->i2c\_client->irq)+ if (!state->i2c\_client->irq) {+ del\_timer(&state->timer); flush\_work(&state->work\_i2c\_poll);+ } cancel\_delayed\_work(&state->delayed\_work\_enable\_hotplug); mutex\_destroy(&state->confctl\_mutex); err\_hdl: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:58:57 +0000



=== Content from git.kernel.org_e3600607_20250114_190019.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=815d14147068347e88c258233eb951b41b2792a6)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=815d14147068347e88c258233eb951b41b2792a6)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=815d14147068347e88c258233eb951b41b2792a6)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=815d14147068347e88c258233eb951b41b2792a6)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Alexander Shiyan <eagle.alexander923@gmail.com> | 2024-10-09 09:05:44 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:50:32 +0100 |
| commit | [815d14147068347e88c258233eb951b41b2792a6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=815d14147068347e88c258233eb951b41b2792a6) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=815d14147068347e88c258233eb951b41b2792a6)) | |
| tree | [273174972dd2b9db8b9e1c7325d5342ec2685eef](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=815d14147068347e88c258233eb951b41b2792a6) | |
| parent | [f68bb1210fbea252552d97242757f69a219e942b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f68bb1210fbea252552d97242757f69a219e942b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=815d14147068347e88c258233eb951b41b2792a6&id2=f68bb1210fbea252552d97242757f69a219e942b)) | |
| download | [linux-815d14147068347e88c258233eb951b41b2792a6.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-815d14147068347e88c258233eb951b41b2792a6.tar.gz) | |

media: i2c: tc358743: Fix crash in the probe error path when using pollingcommit 869f38ae07f7df829da4951c3d1f7a2be09c2e9a upstream.
If an error occurs in the probe() function, we should remove the polling
timer that was alarmed earlier, otherwise the timer is called with
arguments that are already freed, which results in a crash.
------------[ cut here ]------------
WARNING: CPU: 3 PID: 0 at kernel/time/timer.c:1830 \_\_run\_timers+0x244/0x268
Modules linked in:
CPU: 3 UID: 0 PID: 0 Comm: swapper/3 Not tainted 6.11.0 #226
Hardware name: Diasom DS-RK3568-SOM-EVB (DT)
pstate: 804000c9 (Nzcv daIF +PAN -UAO -TCO -DIT -SSBS BTYPE=--)
pc : \_\_run\_timers+0x244/0x268
lr : \_\_run\_timers+0x1d4/0x268
sp : ffffff80eff2baf0
x29: ffffff80eff2bb50 x28: 7fffffffffffffff x27: ffffff80eff2bb00
x26: ffffffc080f669c0 x25: ffffff80efef6bf0 x24: ffffff80eff2bb00
x23: 0000000000000000 x22: dead000000000122 x21: 0000000000000000
x20: ffffff80efef6b80 x19: ffffff80041c8bf8 x18: ffffffffffffffff
x17: ffffffc06f146000 x16: ffffff80eff27dc0 x15: 000000000000003e
x14: 0000000000000000 x13: 00000000000054da x12: 0000000000000000
x11: 00000000000639c0 x10: 000000000000000c x9 : 0000000000000009
x8 : ffffff80eff2cb40 x7 : ffffff80eff2cb40 x6 : ffffff8002bee480
x5 : ffffffc080cb2220 x4 : ffffffc080cb2150 x3 : 00000000000f4240
x2 : 0000000000000102 x1 : ffffff80eff2bb00 x0 : ffffff80041c8bf0
Call trace:
 \_\_run\_timers+0x244/0x268
 timer\_expire\_remote+0x50/0x68
 tmigr\_handle\_remote+0x388/0x39c
 run\_timer\_softirq+0x38/0x44
 handle\_softirqs+0x138/0x298
 \_\_do\_softirq+0x14/0x20
 \_\_\_\_do\_softirq+0x10/0x1c
 call\_on\_irq\_stack+0x24/0x4c
 do\_softirq\_own\_stack+0x1c/0x2c
 irq\_exit\_rcu+0x9c/0xcc
 el1\_interrupt+0x48/0xc0
 el1h\_64\_irq\_handler+0x18/0x24
 el1h\_64\_irq+0x7c/0x80
 default\_idle\_call+0x34/0x68
 do\_idle+0x23c/0x294
 cpu\_startup\_entry+0x38/0x3c
 secondary\_start\_kernel+0x128/0x160
 \_\_secondary\_switched+0xb8/0xbc
---[ end trace 0000000000000000 ]---
Fixes: 4e66a52a2e4c ("[media] tc358743: Add support for platforms without IRQ line")
Signed-off-by: Alexander Shiyan <eagle.alexander923@gmail.com>
Cc: stable@vger.kernel.org
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=815d14147068347e88c258233eb951b41b2792a6)

| -rw-r--r-- | [drivers/media/i2c/tc358743.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/i2c/tc358743.c?id=815d14147068347e88c258233eb951b41b2792a6) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/drivers/media/i2c/tc358743.c b/drivers/media/i2c/tc358743.cindex 4c6852dc40a90b..6f5ca3d63dbdb2 100644--- a/[drivers/media/i2c/tc358743.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/i2c/tc358743.c?id=f68bb1210fbea252552d97242757f69a219e942b)+++ b/[drivers/media/i2c/tc358743.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/i2c/tc358743.c?id=815d14147068347e88c258233eb951b41b2792a6)@@ -2176,8 +2176,10 @@ static int tc358743\_probe(struct i2c\_client \*client)  err\_work\_queues: cec\_unregister\_adapter(state->cec\_adap);- if (!state->i2c\_client->irq)+ if (!state->i2c\_client->irq) {+ del\_timer(&state->timer); flush\_work(&state->work\_i2c\_poll);+ } cancel\_delayed\_work(&state->delayed\_work\_enable\_hotplug); mutex\_destroy(&state->confctl\_mutex); err\_hdl: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:58:55 +0000



=== Content from git.kernel.org_0f670402_20250114_190017.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=5c9ab34c87af718bdbf9faa2b1a6ba41d15380ea)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5c9ab34c87af718bdbf9faa2b1a6ba41d15380ea)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5c9ab34c87af718bdbf9faa2b1a6ba41d15380ea)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5c9ab34c87af718bdbf9faa2b1a6ba41d15380ea)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Alexander Shiyan <eagle.alexander923@gmail.com> | 2024-10-09 09:05:44 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:47:36 +0100 |
| commit | [5c9ab34c87af718bdbf9faa2b1a6ba41d15380ea](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5c9ab34c87af718bdbf9faa2b1a6ba41d15380ea) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=5c9ab34c87af718bdbf9faa2b1a6ba41d15380ea)) | |
| tree | [4ef3525a48d91c48f0a816321f66761f694e5c90](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5c9ab34c87af718bdbf9faa2b1a6ba41d15380ea) | |
| parent | [b240a0472f8ecad7d14c566a7251f13d6ecdfec8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b240a0472f8ecad7d14c566a7251f13d6ecdfec8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5c9ab34c87af718bdbf9faa2b1a6ba41d15380ea&id2=b240a0472f8ecad7d14c566a7251f13d6ecdfec8)) | |
| download | [linux-5c9ab34c87af718bdbf9faa2b1a6ba41d15380ea.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-5c9ab34c87af718bdbf9faa2b1a6ba41d15380ea.tar.gz) | |

media: i2c: tc358743: Fix crash in the probe error path when using pollingcommit 869f38ae07f7df829da4951c3d1f7a2be09c2e9a upstream.
If an error occurs in the probe() function, we should remove the polling
timer that was alarmed earlier, otherwise the timer is called with
arguments that are already freed, which results in a crash.
------------[ cut here ]------------
WARNING: CPU: 3 PID: 0 at kernel/time/timer.c:1830 \_\_run\_timers+0x244/0x268
Modules linked in:
CPU: 3 UID: 0 PID: 0 Comm: swapper/3 Not tainted 6.11.0 #226
Hardware name: Diasom DS-RK3568-SOM-EVB (DT)
pstate: 804000c9 (Nzcv daIF +PAN -UAO -TCO -DIT -SSBS BTYPE=--)
pc : \_\_run\_timers+0x244/0x268
lr : \_\_run\_timers+0x1d4/0x268
sp : ffffff80eff2baf0
x29: ffffff80eff2bb50 x28: 7fffffffffffffff x27: ffffff80eff2bb00
x26: ffffffc080f669c0 x25: ffffff80efef6bf0 x24: ffffff80eff2bb00
x23: 0000000000000000 x22: dead000000000122 x21: 0000000000000000
x20: ffffff80efef6b80 x19: ffffff80041c8bf8 x18: ffffffffffffffff
x17: ffffffc06f146000 x16: ffffff80eff27dc0 x15: 000000000000003e
x14: 0000000000000000 x13: 00000000000054da x12: 0000000000000000
x11: 00000000000639c0 x10: 000000000000000c x9 : 0000000000000009
x8 : ffffff80eff2cb40 x7 : ffffff80eff2cb40 x6 : ffffff8002bee480
x5 : ffffffc080cb2220 x4 : ffffffc080cb2150 x3 : 00000000000f4240
x2 : 0000000000000102 x1 : ffffff80eff2bb00 x0 : ffffff80041c8bf0
Call trace:
 \_\_run\_timers+0x244/0x268
 timer\_expire\_remote+0x50/0x68
 tmigr\_handle\_remote+0x388/0x39c
 run\_timer\_softirq+0x38/0x44
 handle\_softirqs+0x138/0x298
 \_\_do\_softirq+0x14/0x20
 \_\_\_\_do\_softirq+0x10/0x1c
 call\_on\_irq\_stack+0x24/0x4c
 do\_softirq\_own\_stack+0x1c/0x2c
 irq\_exit\_rcu+0x9c/0xcc
 el1\_interrupt+0x48/0xc0
 el1h\_64\_irq\_handler+0x18/0x24
 el1h\_64\_irq+0x7c/0x80
 default\_idle\_call+0x34/0x68
 do\_idle+0x23c/0x294
 cpu\_startup\_entry+0x38/0x3c
 secondary\_start\_kernel+0x128/0x160
 \_\_secondary\_switched+0xb8/0xbc
---[ end trace 0000000000000000 ]---
Fixes: 4e66a52a2e4c ("[media] tc358743: Add support for platforms without IRQ line")
Signed-off-by: Alexander Shiyan <eagle.alexander923@gmail.com>
Cc: stable@vger.kernel.org
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5c9ab34c87af718bdbf9faa2b1a6ba41d15380ea)

| -rw-r--r-- | [drivers/media/i2c/tc358743.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/i2c/tc358743.c?id=5c9ab34c87af718bdbf9faa2b1a6ba41d15380ea) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/drivers/media/i2c/tc358743.c b/drivers/media/i2c/tc358743.cindex 8bcb4b354c8952..8e9df9007d2edb 100644--- a/[drivers/media/i2c/tc358743.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/i2c/tc358743.c?id=b240a0472f8ecad7d14c566a7251f13d6ecdfec8)+++ b/[drivers/media/i2c/tc358743.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/i2c/tc358743.c?id=5c9ab34c87af718bdbf9faa2b1a6ba41d15380ea)@@ -2176,8 +2176,10 @@ static int tc358743\_probe(struct i2c\_client \*client)  err\_work\_queues: cec\_unregister\_adapter(state->cec\_adap);- if (!state->i2c\_client->irq)+ if (!state->i2c\_client->irq) {+ del\_timer(&state->timer); flush\_work(&state->work\_i2c\_poll);+ } cancel\_delayed\_work(&state->delayed\_work\_enable\_hotplug); mutex\_destroy(&state->confctl\_mutex); err\_hdl: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:58:53 +0000



=== Content from git.kernel.org_3d382f42_20250114_190019.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=869f38ae07f7df829da4951c3d1f7a2be09c2e9a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=869f38ae07f7df829da4951c3d1f7a2be09c2e9a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=869f38ae07f7df829da4951c3d1f7a2be09c2e9a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=869f38ae07f7df829da4951c3d1f7a2be09c2e9a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Alexander Shiyan <eagle.alexander923@gmail.com> | 2024-10-09 09:05:44 +0300 |
| --- | --- | --- |
| committer | Hans Verkuil <hverkuil-cisco@xs4all.nl> | 2024-10-12 16:28:26 +0200 |
| commit | [869f38ae07f7df829da4951c3d1f7a2be09c2e9a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=869f38ae07f7df829da4951c3d1f7a2be09c2e9a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=869f38ae07f7df829da4951c3d1f7a2be09c2e9a)) | |
| tree | [0b2a62fef4bb591b39d27ef793ae54809feafd9e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=869f38ae07f7df829da4951c3d1f7a2be09c2e9a) | |
| parent | [c5120f3b20a1c026c6ef91b0fb581b81df138649](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c5120f3b20a1c026c6ef91b0fb581b81df138649) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=869f38ae07f7df829da4951c3d1f7a2be09c2e9a&id2=c5120f3b20a1c026c6ef91b0fb581b81df138649)) | |
| download | [linux-869f38ae07f7df829da4951c3d1f7a2be09c2e9a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-869f38ae07f7df829da4951c3d1f7a2be09c2e9a.tar.gz) | |

media: i2c: tc358743: Fix crash in the probe error path when using pollingIf an error occurs in the probe() function, we should remove the polling
timer that was alarmed earlier, otherwise the timer is called with
arguments that are already freed, which results in a crash.
------------[ cut here ]------------
WARNING: CPU: 3 PID: 0 at kernel/time/timer.c:1830 \_\_run\_timers+0x244/0x268
Modules linked in:
CPU: 3 UID: 0 PID: 0 Comm: swapper/3 Not tainted 6.11.0 #226
Hardware name: Diasom DS-RK3568-SOM-EVB (DT)
pstate: 804000c9 (Nzcv daIF +PAN -UAO -TCO -DIT -SSBS BTYPE=--)
pc : \_\_run\_timers+0x244/0x268
lr : \_\_run\_timers+0x1d4/0x268
sp : ffffff80eff2baf0
x29: ffffff80eff2bb50 x28: 7fffffffffffffff x27: ffffff80eff2bb00
x26: ffffffc080f669c0 x25: ffffff80efef6bf0 x24: ffffff80eff2bb00
x23: 0000000000000000 x22: dead000000000122 x21: 0000000000000000
x20: ffffff80efef6b80 x19: ffffff80041c8bf8 x18: ffffffffffffffff
x17: ffffffc06f146000 x16: ffffff80eff27dc0 x15: 000000000000003e
x14: 0000000000000000 x13: 00000000000054da x12: 0000000000000000
x11: 00000000000639c0 x10: 000000000000000c x9 : 0000000000000009
x8 : ffffff80eff2cb40 x7 : ffffff80eff2cb40 x6 : ffffff8002bee480
x5 : ffffffc080cb2220 x4 : ffffffc080cb2150 x3 : 00000000000f4240
x2 : 0000000000000102 x1 : ffffff80eff2bb00 x0 : ffffff80041c8bf0
Call trace:
 \_\_run\_timers+0x244/0x268
 timer\_expire\_remote+0x50/0x68
 tmigr\_handle\_remote+0x388/0x39c
 run\_timer\_softirq+0x38/0x44
 handle\_softirqs+0x138/0x298
 \_\_do\_softirq+0x14/0x20
 \_\_\_\_do\_softirq+0x10/0x1c
 call\_on\_irq\_stack+0x24/0x4c
 do\_softirq\_own\_stack+0x1c/0x2c
 irq\_exit\_rcu+0x9c/0xcc
 el1\_interrupt+0x48/0xc0
 el1h\_64\_irq\_handler+0x18/0x24
 el1h\_64\_irq+0x7c/0x80
 default\_idle\_call+0x34/0x68
 do\_idle+0x23c/0x294
 cpu\_startup\_entry+0x38/0x3c
 secondary\_start\_kernel+0x128/0x160
 \_\_secondary\_switched+0xb8/0xbc
---[ end trace 0000000000000000 ]---
Fixes: 4e66a52a2e4c ("[media] tc358743: Add support for platforms without IRQ line")
Signed-off-by: Alexander Shiyan <eagle.alexander923@gmail.com>
Cc: stable@vger.kernel.org
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=869f38ae07f7df829da4951c3d1f7a2be09c2e9a)

| -rw-r--r-- | [drivers/media/i2c/tc358743.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/i2c/tc358743.c?id=869f38ae07f7df829da4951c3d1f7a2be09c2e9a) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/drivers/media/i2c/tc358743.c b/drivers/media/i2c/tc358743.cindex fd49bf8240518f..c50d4e85dfd144 100644--- a/[drivers/media/i2c/tc358743.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/i2c/tc358743.c?id=c5120f3b20a1c026c6ef91b0fb581b81df138649)+++ b/[drivers/media/i2c/tc358743.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/i2c/tc358743.c?id=869f38ae07f7df829da4951c3d1f7a2be09c2e9a)@@ -2200,8 +2200,10 @@ static int tc358743\_probe(struct i2c\_client \*client)  err\_work\_queues: cec\_unregister\_adapter(state->cec\_adap);- if (!state->i2c\_client->irq)+ if (!state->i2c\_client->irq) {+ del\_timer(&state->timer); flush\_work(&state->work\_i2c\_poll);+ } cancel\_delayed\_work(&state->delayed\_work\_enable\_hotplug); mutex\_destroy(&state->confctl\_mutex); err\_hdl: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:58:56 +0000


