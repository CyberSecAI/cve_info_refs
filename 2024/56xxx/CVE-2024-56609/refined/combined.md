=== Content from git.kernel.org_8d10eac3_20250115_083603.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3e5e4a801aaf4283390cc34959c6c48f910ca5ea)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3e5e4a801aaf4283390cc34959c6c48f910ca5ea)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3e5e4a801aaf4283390cc34959c6c48f910ca5ea)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3e5e4a801aaf4283390cc34959c6c48f910ca5ea)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ping-Ke Shih <pkshih@realtek.com> | 2024-08-22 09:42:55 +0800 |
| --- | --- | --- |
| committer | Ping-Ke Shih <pkshih@realtek.com> | 2024-09-20 14:32:08 +0800 |
| commit | [3e5e4a801aaf4283390cc34959c6c48f910ca5ea](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3e5e4a801aaf4283390cc34959c6c48f910ca5ea) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3e5e4a801aaf4283390cc34959c6c48f910ca5ea)) | |
| tree | [bd2792181131207c1a4740aa3efaca86df8526d6](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3e5e4a801aaf4283390cc34959c6c48f910ca5ea) | |
| parent | [140403599b74839b0a57c5397b7e8579e5332364](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=140403599b74839b0a57c5397b7e8579e5332364) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3e5e4a801aaf4283390cc34959c6c48f910ca5ea&id2=140403599b74839b0a57c5397b7e8579e5332364)) | |
| download | [linux-3e5e4a801aaf4283390cc34959c6c48f910ca5ea.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3e5e4a801aaf4283390cc34959c6c48f910ca5ea.tar.gz) | |

wifi: rtw88: use ieee80211\_purge\_tx\_queue() to purge TX skbWhen removing kernel modules by:
rmmod rtw88\_8723cs rtw88\_8703b rtw88\_8723x rtw88\_sdio rtw88\_core
Driver uses skb\_queue\_purge() to purge TX skb, but not report tx status
causing "Have pending ack frames!" warning. Use ieee80211\_purge\_tx\_queue()
to correct this.
Since ieee80211\_purge\_tx\_queue() doesn't take locks, to prevent racing
between TX work and purge TX queue, flush and destroy TX work in advance.
wlan0: deauthenticating from aa:f5:fd:60:4c:a8 by local
choice (Reason: 3=DEAUTH\_LEAVING)
------------[ cut here ]------------
Have pending ack frames!
WARNING: CPU: 3 PID: 9232 at net/mac80211/main.c:1691
ieee80211\_free\_ack\_frame+0x5c/0x90 [mac80211]
CPU: 3 PID: 9232 Comm: rmmod Tainted: G C
6.10.1-200.fc40.aarch64 #1
Hardware name: pine64 Pine64 PinePhone Braveheart
(1.1)/Pine64 PinePhone Braveheart (1.1), BIOS 2024.01 01/01/2024
pstate: 60400005 (nZCv daif +PAN -UAO -TCO -DIT -SSBS BTYPE=--)
pc : ieee80211\_free\_ack\_frame+0x5c/0x90 [mac80211]
lr : ieee80211\_free\_ack\_frame+0x5c/0x90 [mac80211]
sp : ffff80008c1b37b0
x29: ffff80008c1b37b0 x28: ffff000003be8000 x27: 0000000000000000
x26: 0000000000000000 x25: ffff000003dc14b8 x24: ffff80008c1b37d0
x23: ffff000000ff9f80 x22: 0000000000000000 x21: 000000007fffffff
x20: ffff80007c7e93d8 x19: ffff00006e66f400 x18: 0000000000000000
x17: ffff7ffffd2b3000 x16: ffff800083fc0000 x15: 0000000000000000
x14: 0000000000000000 x13: 2173656d61726620 x12: 6b636120676e6964
x11: 0000000000000000 x10: 000000000000005d x9 : ffff8000802af2b0
x8 : ffff80008c1b3430 x7 : 0000000000000001 x6 : 0000000000000001
x5 : 0000000000000000 x4 : 0000000000000000 x3 : 0000000000000000
x2 : 0000000000000000 x1 : 0000000000000000 x0 : ffff000003be8000
Call trace:
ieee80211\_free\_ack\_frame+0x5c/0x90 [mac80211]
idr\_for\_each+0x74/0x110
ieee80211\_free\_hw+0x44/0xe8 [mac80211]
rtw\_sdio\_remove+0x9c/0xc0 [rtw88\_sdio]
sdio\_bus\_remove+0x44/0x180
device\_remove+0x54/0x90
device\_release\_driver\_internal+0x1d4/0x238
driver\_detach+0x54/0xc0
bus\_remove\_driver+0x78/0x108
driver\_unregister+0x38/0x78
sdio\_unregister\_driver+0x2c/0x40
rtw\_8723cs\_driver\_exit+0x18/0x1000 [rtw88\_8723cs]
\_\_do\_sys\_delete\_module.isra.0+0x190/0x338
\_\_arm64\_sys\_delete\_module+0x1c/0x30
invoke\_syscall+0x74/0x100
el0\_svc\_common.constprop.0+0x48/0xf0
do\_el0\_svc+0x24/0x38
el0\_svc+0x3c/0x158
el0t\_64\_sync\_handler+0x120/0x138
el0t\_64\_sync+0x194/0x198
---[ end trace 0000000000000000 ]---
Reported-by: Peter Robinson <pbrobinson@gmail.com>
Closes: https://lore.kernel.org/linux-wireless/CALeDE9OAa56KMzgknaCD3quOgYuEHFx9\_hcT=OFgmMAb+8MPyA@mail.gmail.com/
Tested-by: Ping-Ke Shih <pkshih@realtek.com> # 8723DU
Signed-off-by: Ping-Ke Shih <pkshih@realtek.com>
Link: [https://patch.msgid.link/20240822014255.10211-2-pkshih@realtek.com](https://patch.msgid.link/20240822014255.10211-2-pkshih%40realtek.com)
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3e5e4a801aaf4283390cc34959c6c48f910ca5ea)

| -rw-r--r-- | [drivers/net/wireless/realtek/rtw88/sdio.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/realtek/rtw88/sdio.c?id=3e5e4a801aaf4283390cc34959c6c48f910ca5ea) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/net/wireless/realtek/rtw88/usb.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/realtek/rtw88/usb.c?id=3e5e4a801aaf4283390cc34959c6c48f910ca5ea) | 5 | |  |  |  | | --- | --- | --- | |

2 files changed, 6 insertions, 5 deletions

| diff --git a/drivers/net/wireless/realtek/rtw88/sdio.c b/drivers/net/wireless/realtek/rtw88/sdio.cindex 21d0754dd7f6ac..b67e551fcee3ef 100644--- a/[drivers/net/wireless/realtek/rtw88/sdio.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/realtek/rtw88/sdio.c?id=140403599b74839b0a57c5397b7e8579e5332364)+++ b/[drivers/net/wireless/realtek/rtw88/sdio.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/realtek/rtw88/sdio.c?id=3e5e4a801aaf4283390cc34959c6c48f910ca5ea)@@ -1297,12 +1297,12 @@ static void rtw\_sdio\_deinit\_tx(struct rtw\_dev \*rtwdev) struct rtw\_sdio \*rtwsdio = (struct rtw\_sdio \*)rtwdev->priv; int i; - for (i = 0; i < RTK\_MAX\_TX\_QUEUE\_NUM; i++)- skb\_queue\_purge(&rtwsdio->tx\_queue[i]);- flush\_workqueue(rtwsdio->txwq); destroy\_workqueue(rtwsdio->txwq); kfree(rtwsdio->tx\_handler\_data);++ for (i = 0; i < RTK\_MAX\_TX\_QUEUE\_NUM; i++)+ ieee80211\_purge\_tx\_queue(rtwdev->hw, &rtwsdio->tx\_queue[i]); }  int rtw\_sdio\_probe(struct sdio\_func \*sdio\_func,diff --git a/drivers/net/wireless/realtek/rtw88/usb.c b/drivers/net/wireless/realtek/rtw88/usb.cindex e83ab6fb83f5b7..dbc7d8d734949f 100644--- a/[drivers/net/wireless/realtek/rtw88/usb.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/realtek/rtw88/usb.c?id=140403599b74839b0a57c5397b7e8579e5332364)+++ b/[drivers/net/wireless/realtek/rtw88/usb.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/realtek/rtw88/usb.c?id=3e5e4a801aaf4283390cc34959c6c48f910ca5ea)@@ -423,10 +423,11 @@ static void rtw\_usb\_tx\_handler(struct work\_struct \*work)  static void rtw\_usb\_tx\_queue\_purge(struct rtw\_usb \*rtwusb) {+ struct rtw\_dev \*rtwdev = rtwusb->rtwdev; int i;  for (i = 0; i < ARRAY\_SIZE(rtwusb->tx\_queue); i++)- skb\_queue\_purge(&rtwusb->tx\_queue[i]);+ ieee80211\_purge\_tx\_queue(rtwdev->hw, &rtwusb->tx\_queue[i]); }  static void rtw\_usb\_write\_port\_complete(struct urb \*urb)@@ -889,9 +890,9 @@ static void rtw\_usb\_deinit\_tx(struct rtw\_dev \*rtwdev) { struct rtw\_usb \*rtwusb = rtw\_get\_usb\_priv(rtwdev); - rtw\_usb\_tx\_queue\_purge(rtwusb); flush\_workqueue(rtwusb->txwq); destroy\_workqueue(rtwusb->txwq);+ rtw\_usb\_tx\_queue\_purge(rtwusb); }  static int rtw\_usb\_intf\_init(struct rtw\_dev \*rtwdev, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:34:40 +0000



=== Content from git.kernel.org_e2a3df30_20250115_083604.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9bca6528f20325d30c22236b23116f161d418f6d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9bca6528f20325d30c22236b23116f161d418f6d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9bca6528f20325d30c22236b23116f161d418f6d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9bca6528f20325d30c22236b23116f161d418f6d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ping-Ke Shih <pkshih@realtek.com> | 2024-08-22 09:42:55 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 20:03:42 +0100 |
| commit | [9bca6528f20325d30c22236b23116f161d418f6d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9bca6528f20325d30c22236b23116f161d418f6d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9bca6528f20325d30c22236b23116f161d418f6d)) | |
| tree | [56247e5ec572fd03c10c62e42dd576f53d597078](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9bca6528f20325d30c22236b23116f161d418f6d) | |
| parent | [ef3da232796a139ad906a046738f9f4daf53dab1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ef3da232796a139ad906a046738f9f4daf53dab1) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9bca6528f20325d30c22236b23116f161d418f6d&id2=ef3da232796a139ad906a046738f9f4daf53dab1)) | |
| download | [linux-9bca6528f20325d30c22236b23116f161d418f6d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9bca6528f20325d30c22236b23116f161d418f6d.tar.gz) | |

wifi: rtw88: use ieee80211\_purge\_tx\_queue() to purge TX skb[ Upstream commit 3e5e4a801aaf4283390cc34959c6c48f910ca5ea ]
When removing kernel modules by:
rmmod rtw88\_8723cs rtw88\_8703b rtw88\_8723x rtw88\_sdio rtw88\_core
Driver uses skb\_queue\_purge() to purge TX skb, but not report tx status
causing "Have pending ack frames!" warning. Use ieee80211\_purge\_tx\_queue()
to correct this.
Since ieee80211\_purge\_tx\_queue() doesn't take locks, to prevent racing
between TX work and purge TX queue, flush and destroy TX work in advance.
wlan0: deauthenticating from aa:f5:fd:60:4c:a8 by local
choice (Reason: 3=DEAUTH\_LEAVING)
------------[ cut here ]------------
Have pending ack frames!
WARNING: CPU: 3 PID: 9232 at net/mac80211/main.c:1691
ieee80211\_free\_ack\_frame+0x5c/0x90 [mac80211]
CPU: 3 PID: 9232 Comm: rmmod Tainted: G C
6.10.1-200.fc40.aarch64 #1
Hardware name: pine64 Pine64 PinePhone Braveheart
(1.1)/Pine64 PinePhone Braveheart (1.1), BIOS 2024.01 01/01/2024
pstate: 60400005 (nZCv daif +PAN -UAO -TCO -DIT -SSBS BTYPE=--)
pc : ieee80211\_free\_ack\_frame+0x5c/0x90 [mac80211]
lr : ieee80211\_free\_ack\_frame+0x5c/0x90 [mac80211]
sp : ffff80008c1b37b0
x29: ffff80008c1b37b0 x28: ffff000003be8000 x27: 0000000000000000
x26: 0000000000000000 x25: ffff000003dc14b8 x24: ffff80008c1b37d0
x23: ffff000000ff9f80 x22: 0000000000000000 x21: 000000007fffffff
x20: ffff80007c7e93d8 x19: ffff00006e66f400 x18: 0000000000000000
x17: ffff7ffffd2b3000 x16: ffff800083fc0000 x15: 0000000000000000
x14: 0000000000000000 x13: 2173656d61726620 x12: 6b636120676e6964
x11: 0000000000000000 x10: 000000000000005d x9 : ffff8000802af2b0
x8 : ffff80008c1b3430 x7 : 0000000000000001 x6 : 0000000000000001
x5 : 0000000000000000 x4 : 0000000000000000 x3 : 0000000000000000
x2 : 0000000000000000 x1 : 0000000000000000 x0 : ffff000003be8000
Call trace:
ieee80211\_free\_ack\_frame+0x5c/0x90 [mac80211]
idr\_for\_each+0x74/0x110
ieee80211\_free\_hw+0x44/0xe8 [mac80211]
rtw\_sdio\_remove+0x9c/0xc0 [rtw88\_sdio]
sdio\_bus\_remove+0x44/0x180
device\_remove+0x54/0x90
device\_release\_driver\_internal+0x1d4/0x238
driver\_detach+0x54/0xc0
bus\_remove\_driver+0x78/0x108
driver\_unregister+0x38/0x78
sdio\_unregister\_driver+0x2c/0x40
rtw\_8723cs\_driver\_exit+0x18/0x1000 [rtw88\_8723cs]
\_\_do\_sys\_delete\_module.isra.0+0x190/0x338
\_\_arm64\_sys\_delete\_module+0x1c/0x30
invoke\_syscall+0x74/0x100
el0\_svc\_common.constprop.0+0x48/0xf0
do\_el0\_svc+0x24/0x38
el0\_svc+0x3c/0x158
el0t\_64\_sync\_handler+0x120/0x138
el0t\_64\_sync+0x194/0x198
---[ end trace 0000000000000000 ]---
Reported-by: Peter Robinson <pbrobinson@gmail.com>
Closes: https://lore.kernel.org/linux-wireless/CALeDE9OAa56KMzgknaCD3quOgYuEHFx9\_hcT=OFgmMAb+8MPyA@mail.gmail.com/
Tested-by: Ping-Ke Shih <pkshih@realtek.com> # 8723DU
Signed-off-by: Ping-Ke Shih <pkshih@realtek.com>
Link: [https://patch.msgid.link/20240822014255.10211-2-pkshih@realtek.com](https://patch.msgid.link/20240822014255.10211-2-pkshih%40realtek.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9bca6528f20325d30c22236b23116f161d418f6d)

| -rw-r--r-- | [drivers/net/wireless/realtek/rtw88/sdio.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/realtek/rtw88/sdio.c?id=9bca6528f20325d30c22236b23116f161d418f6d) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/net/wireless/realtek/rtw88/usb.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/realtek/rtw88/usb.c?id=9bca6528f20325d30c22236b23116f161d418f6d) | 5 | |  |  |  | | --- | --- | --- | |

2 files changed, 6 insertions, 5 deletions

| diff --git a/drivers/net/wireless/realtek/rtw88/sdio.c b/drivers/net/wireless/realtek/rtw88/sdio.cindex 21d0754dd7f6ac..b67e551fcee3ef 100644--- a/[drivers/net/wireless/realtek/rtw88/sdio.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/realtek/rtw88/sdio.c?id=ef3da232796a139ad906a046738f9f4daf53dab1)+++ b/[drivers/net/wireless/realtek/rtw88/sdio.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/realtek/rtw88/sdio.c?id=9bca6528f20325d30c22236b23116f161d418f6d)@@ -1297,12 +1297,12 @@ static void rtw\_sdio\_deinit\_tx(struct rtw\_dev \*rtwdev) struct rtw\_sdio \*rtwsdio = (struct rtw\_sdio \*)rtwdev->priv; int i; - for (i = 0; i < RTK\_MAX\_TX\_QUEUE\_NUM; i++)- skb\_queue\_purge(&rtwsdio->tx\_queue[i]);- flush\_workqueue(rtwsdio->txwq); destroy\_workqueue(rtwsdio->txwq); kfree(rtwsdio->tx\_handler\_data);++ for (i = 0; i < RTK\_MAX\_TX\_QUEUE\_NUM; i++)+ ieee80211\_purge\_tx\_queue(rtwdev->hw, &rtwsdio->tx\_queue[i]); }  int rtw\_sdio\_probe(struct sdio\_func \*sdio\_func,diff --git a/drivers/net/wireless/realtek/rtw88/usb.c b/drivers/net/wireless/realtek/rtw88/usb.cindex b17a429bcd2994..07695294767acb 100644--- a/[drivers/net/wireless/realtek/rtw88/usb.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/realtek/rtw88/usb.c?id=ef3da232796a139ad906a046738f9f4daf53dab1)+++ b/[drivers/net/wireless/realtek/rtw88/usb.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/realtek/rtw88/usb.c?id=9bca6528f20325d30c22236b23116f161d418f6d)@@ -423,10 +423,11 @@ static void rtw\_usb\_tx\_handler(struct work\_struct \*work)  static void rtw\_usb\_tx\_queue\_purge(struct rtw\_usb \*rtwusb) {+ struct rtw\_dev \*rtwdev = rtwusb->rtwdev; int i;  for (i = 0; i < ARRAY\_SIZE(rtwusb->tx\_queue); i++)- skb\_queue\_purge(&rtwusb->tx\_queue[i]);+ ieee80211\_purge\_tx\_queue(rtwdev->hw, &rtwusb->tx\_queue[i]); }  static void rtw\_usb\_write\_port\_complete(struct urb \*urb)@@ -888,9 +889,9 @@ static void rtw\_usb\_deinit\_tx(struct rtw\_dev \*rtwdev) { struct rtw\_usb \*rtwusb = rtw\_get\_usb\_priv(rtwdev); - rtw\_usb\_tx\_queue\_purge(rtwusb); flush\_workqueue(rtwusb->txwq); destroy\_workqueue(rtwusb->txwq);+ rtw\_usb\_tx\_queue\_purge(rtwusb); }  static int rtw\_usb\_intf\_init(struct rtw\_dev \*rtwdev, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:34:41 +0000


