=== Content from git.kernel.org_5f9d1f74_20250114_180525.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=13355dd37e22edbcb99c599f783233188740a650)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=13355dd37e22edbcb99c599f783233188740a650)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=13355dd37e22edbcb99c599f783233188740a650)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=13355dd37e22edbcb99c599f783233188740a650)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Shannon Nelson <shannon.nelson@amd.com> | 2024-12-12 13:31:56 -0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-27 14:02:03 +0100 |
| commit | [13355dd37e22edbcb99c599f783233188740a650](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=13355dd37e22edbcb99c599f783233188740a650) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=13355dd37e22edbcb99c599f783233188740a650)) | |
| tree | [4fc7bfba11dc910e270fc082c44f2a93db0a91ee](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=13355dd37e22edbcb99c599f783233188740a650) | |
| parent | [ee2e931b2b46de9af7f681258e8ec8e2cd81cfc6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ee2e931b2b46de9af7f681258e8ec8e2cd81cfc6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=13355dd37e22edbcb99c599f783233188740a650&id2=ee2e931b2b46de9af7f681258e8ec8e2cd81cfc6)) | |
| download | [linux-13355dd37e22edbcb99c599f783233188740a650.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-13355dd37e22edbcb99c599f783233188740a650.tar.gz) | |

ionic: no double destroy workqueue[ Upstream commit 746e6ae2e202b062b9deee7bd86d94937997ecd7 ]
There are some FW error handling paths that can cause us to
try to destroy the workqueue more than once, so let's be sure
we're checking for that.
The case where this popped up was in an AER event where the
handlers got called in such a way that ionic\_reset\_prepare()
and thus ionic\_dev\_teardown() got called twice in a row.
The second time through the workqueue was already destroyed,
and destroy\_workqueue() choked on the bad wq pointer.
We didn't hit this in AER handler testing before because at
that time we weren't using a private workqueue. Later we
replaced the use of the system workqueue with our own private
workqueue but hadn't rerun the AER handler testing since then.
Fixes: 9e25450da700 ("ionic: add private workqueue per-device")
Signed-off-by: Shannon Nelson <shannon.nelson@amd.com>
Reviewed-by: Jacob Keller <jacob.e.keller@intel.com>
Link: [https://patch.msgid.link/20241212213157.12212-3-shannon.nelson@amd.com](https://patch.msgid.link/20241212213157.12212-3-shannon.nelson%40amd.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=13355dd37e22edbcb99c599f783233188740a650)

| -rw-r--r-- | [drivers/net/ethernet/pensando/ionic/ionic\_dev.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/pensando/ionic/ionic_dev.c?id=13355dd37e22edbcb99c599f783233188740a650) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/pensando/ionic/ionic\_dev.c b/drivers/net/ethernet/pensando/ionic/ionic\_dev.cindex 9e42d599840ded..57edcde9e6f8c6 100644--- a/[drivers/net/ethernet/pensando/ionic/ionic\_dev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/pensando/ionic/ionic_dev.c?id=ee2e931b2b46de9af7f681258e8ec8e2cd81cfc6)+++ b/[drivers/net/ethernet/pensando/ionic/ionic\_dev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/pensando/ionic/ionic_dev.c?id=13355dd37e22edbcb99c599f783233188740a650)@@ -277,7 +277,10 @@ void ionic\_dev\_teardown(struct ionic \*ionic) idev->phy\_cmb\_pages = 0; idev->cmb\_npages = 0; - destroy\_workqueue(ionic->wq);+ if (ionic->wq) {+ destroy\_workqueue(ionic->wq);+ ionic->wq = NULL;+ } mutex\_destroy(&idev->cmb\_inuse\_lock); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:04:02 +0000



=== Content from git.kernel.org_65710141_20250114_180525.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=746e6ae2e202b062b9deee7bd86d94937997ecd7)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=746e6ae2e202b062b9deee7bd86d94937997ecd7)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=746e6ae2e202b062b9deee7bd86d94937997ecd7)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=746e6ae2e202b062b9deee7bd86d94937997ecd7)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Shannon Nelson <shannon.nelson@amd.com> | 2024-12-12 13:31:56 -0800 |
| --- | --- | --- |
| committer | Jakub Kicinski <kuba@kernel.org> | 2024-12-15 14:33:31 -0800 |
| commit | [746e6ae2e202b062b9deee7bd86d94937997ecd7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=746e6ae2e202b062b9deee7bd86d94937997ecd7) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=746e6ae2e202b062b9deee7bd86d94937997ecd7)) | |
| tree | [d3858a13a3b8938f02a0b7404ae01a31805e5301](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=746e6ae2e202b062b9deee7bd86d94937997ecd7) | |
| parent | [9590d32e090ea2751e131ae5273859ca22f5ac14](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9590d32e090ea2751e131ae5273859ca22f5ac14) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=746e6ae2e202b062b9deee7bd86d94937997ecd7&id2=9590d32e090ea2751e131ae5273859ca22f5ac14)) | |
| download | [linux-746e6ae2e202b062b9deee7bd86d94937997ecd7.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-746e6ae2e202b062b9deee7bd86d94937997ecd7.tar.gz) | |

ionic: no double destroy workqueueThere are some FW error handling paths that can cause us to
try to destroy the workqueue more than once, so let's be sure
we're checking for that.
The case where this popped up was in an AER event where the
handlers got called in such a way that ionic\_reset\_prepare()
and thus ionic\_dev\_teardown() got called twice in a row.
The second time through the workqueue was already destroyed,
and destroy\_workqueue() choked on the bad wq pointer.
We didn't hit this in AER handler testing before because at
that time we weren't using a private workqueue. Later we
replaced the use of the system workqueue with our own private
workqueue but hadn't rerun the AER handler testing since then.
Fixes: 9e25450da700 ("ionic: add private workqueue per-device")
Signed-off-by: Shannon Nelson <shannon.nelson@amd.com>
Reviewed-by: Jacob Keller <jacob.e.keller@intel.com>
Link: [https://patch.msgid.link/20241212213157.12212-3-shannon.nelson@amd.com](https://patch.msgid.link/20241212213157.12212-3-shannon.nelson%40amd.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=746e6ae2e202b062b9deee7bd86d94937997ecd7)

| -rw-r--r-- | [drivers/net/ethernet/pensando/ionic/ionic\_dev.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/pensando/ionic/ionic_dev.c?id=746e6ae2e202b062b9deee7bd86d94937997ecd7) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/pensando/ionic/ionic\_dev.c b/drivers/net/ethernet/pensando/ionic/ionic\_dev.cindex 9e42d599840ded..57edcde9e6f8c6 100644--- a/[drivers/net/ethernet/pensando/ionic/ionic\_dev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/pensando/ionic/ionic_dev.c?id=9590d32e090ea2751e131ae5273859ca22f5ac14)+++ b/[drivers/net/ethernet/pensando/ionic/ionic\_dev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/pensando/ionic/ionic_dev.c?id=746e6ae2e202b062b9deee7bd86d94937997ecd7)@@ -277,7 +277,10 @@ void ionic\_dev\_teardown(struct ionic \*ionic) idev->phy\_cmb\_pages = 0; idev->cmb\_npages = 0; - destroy\_workqueue(ionic->wq);+ if (ionic->wq) {+ destroy\_workqueue(ionic->wq);+ ionic->wq = NULL;+ } mutex\_destroy(&idev->cmb\_inuse\_lock); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:04:02 +0000


