=== Content from git.kernel.org_9d0dac65_20250115_084649.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e08dc2dc3c3f7938df0e4476fe3e6fdec5583c1d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e08dc2dc3c3f7938df0e4476fe3e6fdec5583c1d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e08dc2dc3c3f7938df0e4476fe3e6fdec5583c1d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e08dc2dc3c3f7938df0e4476fe3e6fdec5583c1d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Suraj Sonawane <surajsonawane0215@gmail.com> | 2024-11-18 21:56:09 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-19 18:11:26 +0100 |
| commit | [e08dc2dc3c3f7938df0e4476fe3e6fdec5583c1d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e08dc2dc3c3f7938df0e4476fe3e6fdec5583c1d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e08dc2dc3c3f7938df0e4476fe3e6fdec5583c1d)) | |
| tree | [fb5c00969b35de81acd82cf25eca0aca421e7421](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e08dc2dc3c3f7938df0e4476fe3e6fdec5583c1d) | |
| parent | [567df47c3e458c0a5c8c626eb506ca3b5bfc68f1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=567df47c3e458c0a5c8c626eb506ca3b5bfc68f1) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e08dc2dc3c3f7938df0e4476fe3e6fdec5583c1d&id2=567df47c3e458c0a5c8c626eb506ca3b5bfc68f1)) | |
| download | [linux-e08dc2dc3c3f7938df0e4476fe3e6fdec5583c1d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e08dc2dc3c3f7938df0e4476fe3e6fdec5583c1d.tar.gz) | |

acpi: nfit: vmalloc-out-of-bounds Read in acpi\_nfit\_ctl[ Upstream commit 265e98f72bac6c41a4492d3e30a8e5fd22fe0779 ]
Fix an issue detected by syzbot with KASAN:
BUG: KASAN: vmalloc-out-of-bounds in cmd\_to\_func drivers/acpi/nfit/
core.c:416 [inline]
BUG: KASAN: vmalloc-out-of-bounds in acpi\_nfit\_ctl+0x20e8/0x24a0
drivers/acpi/nfit/core.c:459
The issue occurs in cmd\_to\_func when the call\_pkg->nd\_reserved2
array is accessed without verifying that call\_pkg points to a buffer
that is appropriately sized as a struct nd\_cmd\_pkg. This can lead
to out-of-bounds access and undefined behavior if the buffer does not
have sufficient space.
To address this, a check was added in acpi\_nfit\_ctl() to ensure that
buf is not NULL and that buf\_len is less than sizeof(\*call\_pkg)
before accessing it. This ensures safe access to the members of
call\_pkg, including the nd\_reserved2 array.
Reported-by: syzbot+7534f060ebda6b8b51b3@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=7534f060ebda6b8b51b3
Tested-by: syzbot+7534f060ebda6b8b51b3@syzkaller.appspotmail.com
Fixes: ebe9f6f19d80 ("acpi/nfit: Fix bus command validation")
Signed-off-by: Suraj Sonawane <surajsonawane0215@gmail.com>
Reviewed-by: Alison Schofield <alison.schofield@intel.com>
Reviewed-by: Dave Jiang <dave.jiang@intel.com>
Link: [https://patch.msgid.link/20241118162609.29063-1-surajsonawane0215@gmail.com](https://patch.msgid.link/20241118162609.29063-1-surajsonawane0215%40gmail.com)
Signed-off-by: Ira Weiny <ira.weiny@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e08dc2dc3c3f7938df0e4476fe3e6fdec5583c1d)

| -rw-r--r-- | [drivers/acpi/nfit/core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/acpi/nfit/core.c?id=e08dc2dc3c3f7938df0e4476fe3e6fdec5583c1d) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 1 deletions

| diff --git a/drivers/acpi/nfit/core.c b/drivers/acpi/nfit/core.cindex 7d88db451cfbfe..7918923e3b7417 100644--- a/[drivers/acpi/nfit/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/acpi/nfit/core.c?id=567df47c3e458c0a5c8c626eb506ca3b5bfc68f1)+++ b/[drivers/acpi/nfit/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/acpi/nfit/core.c?id=e08dc2dc3c3f7938df0e4476fe3e6fdec5583c1d)@@ -454,8 +454,13 @@ int acpi\_nfit\_ctl(struct nvdimm\_bus\_descriptor \*nd\_desc, struct nvdimm \*nvdimm, if (cmd\_rc) \*cmd\_rc = -EINVAL; - if (cmd == ND\_CMD\_CALL)+ if (cmd == ND\_CMD\_CALL) {+ if (!buf || buf\_len < sizeof(\*call\_pkg))+ return -EINVAL;+ call\_pkg = buf;+ }+ func = cmd\_to\_func(nfit\_mem, cmd, call\_pkg, &family); if (func < 0) return func; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:45:27 +0000



=== Content from git.kernel.org_c0bdcd6f_20250115_084649.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=bbdb3307f609ec4dc9558770f464ede01fe52aed)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bbdb3307f609ec4dc9558770f464ede01fe52aed)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bbdb3307f609ec4dc9558770f464ede01fe52aed)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bbdb3307f609ec4dc9558770f464ede01fe52aed)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Suraj Sonawane <surajsonawane0215@gmail.com> | 2024-11-18 21:56:09 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-19 18:07:19 +0100 |
| commit | [bbdb3307f609ec4dc9558770f464ede01fe52aed](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bbdb3307f609ec4dc9558770f464ede01fe52aed) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=bbdb3307f609ec4dc9558770f464ede01fe52aed)) | |
| tree | [1c0c534db8db9d13e63dbe366d573b8dda371c96](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bbdb3307f609ec4dc9558770f464ede01fe52aed) | |
| parent | [c052f775ee6ccacd3c97e4cf41a2a657e63d4259](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c052f775ee6ccacd3c97e4cf41a2a657e63d4259) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bbdb3307f609ec4dc9558770f464ede01fe52aed&id2=c052f775ee6ccacd3c97e4cf41a2a657e63d4259)) | |
| download | [linux-bbdb3307f609ec4dc9558770f464ede01fe52aed.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-bbdb3307f609ec4dc9558770f464ede01fe52aed.tar.gz) | |

acpi: nfit: vmalloc-out-of-bounds Read in acpi\_nfit\_ctl[ Upstream commit 265e98f72bac6c41a4492d3e30a8e5fd22fe0779 ]
Fix an issue detected by syzbot with KASAN:
BUG: KASAN: vmalloc-out-of-bounds in cmd\_to\_func drivers/acpi/nfit/
core.c:416 [inline]
BUG: KASAN: vmalloc-out-of-bounds in acpi\_nfit\_ctl+0x20e8/0x24a0
drivers/acpi/nfit/core.c:459
The issue occurs in cmd\_to\_func when the call\_pkg->nd\_reserved2
array is accessed without verifying that call\_pkg points to a buffer
that is appropriately sized as a struct nd\_cmd\_pkg. This can lead
to out-of-bounds access and undefined behavior if the buffer does not
have sufficient space.
To address this, a check was added in acpi\_nfit\_ctl() to ensure that
buf is not NULL and that buf\_len is less than sizeof(\*call\_pkg)
before accessing it. This ensures safe access to the members of
call\_pkg, including the nd\_reserved2 array.
Reported-by: syzbot+7534f060ebda6b8b51b3@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=7534f060ebda6b8b51b3
Tested-by: syzbot+7534f060ebda6b8b51b3@syzkaller.appspotmail.com
Fixes: ebe9f6f19d80 ("acpi/nfit: Fix bus command validation")
Signed-off-by: Suraj Sonawane <surajsonawane0215@gmail.com>
Reviewed-by: Alison Schofield <alison.schofield@intel.com>
Reviewed-by: Dave Jiang <dave.jiang@intel.com>
Link: [https://patch.msgid.link/20241118162609.29063-1-surajsonawane0215@gmail.com](https://patch.msgid.link/20241118162609.29063-1-surajsonawane0215%40gmail.com)
Signed-off-by: Ira Weiny <ira.weiny@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bbdb3307f609ec4dc9558770f464ede01fe52aed)

| -rw-r--r-- | [drivers/acpi/nfit/core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/acpi/nfit/core.c?id=bbdb3307f609ec4dc9558770f464ede01fe52aed) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 1 deletions

| diff --git a/drivers/acpi/nfit/core.c b/drivers/acpi/nfit/core.cindex 2575d6c51f898b..9cc83df22de495 100644--- a/[drivers/acpi/nfit/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/acpi/nfit/core.c?id=c052f775ee6ccacd3c97e4cf41a2a657e63d4259)+++ b/[drivers/acpi/nfit/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/acpi/nfit/core.c?id=bbdb3307f609ec4dc9558770f464ede01fe52aed)@@ -454,8 +454,13 @@ int acpi\_nfit\_ctl(struct nvdimm\_bus\_descriptor \*nd\_desc, struct nvdimm \*nvdimm, if (cmd\_rc) \*cmd\_rc = -EINVAL; - if (cmd == ND\_CMD\_CALL)+ if (cmd == ND\_CMD\_CALL) {+ if (!buf || buf\_len < sizeof(\*call\_pkg))+ return -EINVAL;+ call\_pkg = buf;+ }+ func = cmd\_to\_func(nfit\_mem, cmd, call\_pkg, &family); if (func < 0) return func; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:45:26 +0000



=== Content from git.kernel.org_bce02513_20250115_084646.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=143f723e9eb4f0302ffb7adfdc7ef77eab3f68e0)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=143f723e9eb4f0302ffb7adfdc7ef77eab3f68e0)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=143f723e9eb4f0302ffb7adfdc7ef77eab3f68e0)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=143f723e9eb4f0302ffb7adfdc7ef77eab3f68e0)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Suraj Sonawane <surajsonawane0215@gmail.com> | 2024-11-18 21:56:09 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-19 18:08:52 +0100 |
| commit | [143f723e9eb4f0302ffb7adfdc7ef77eab3f68e0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=143f723e9eb4f0302ffb7adfdc7ef77eab3f68e0) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=143f723e9eb4f0302ffb7adfdc7ef77eab3f68e0)) | |
| tree | [b588de47d1c2e0deec7bcaea01a0acf05ab664d7](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=143f723e9eb4f0302ffb7adfdc7ef77eab3f68e0) | |
| parent | [3faaad820cca8d782e7affa2d02bab1ea1dbbf44](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3faaad820cca8d782e7affa2d02bab1ea1dbbf44) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=143f723e9eb4f0302ffb7adfdc7ef77eab3f68e0&id2=3faaad820cca8d782e7affa2d02bab1ea1dbbf44)) | |
| download | [linux-143f723e9eb4f0302ffb7adfdc7ef77eab3f68e0.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-143f723e9eb4f0302ffb7adfdc7ef77eab3f68e0.tar.gz) | |

acpi: nfit: vmalloc-out-of-bounds Read in acpi\_nfit\_ctl[ Upstream commit 265e98f72bac6c41a4492d3e30a8e5fd22fe0779 ]
Fix an issue detected by syzbot with KASAN:
BUG: KASAN: vmalloc-out-of-bounds in cmd\_to\_func drivers/acpi/nfit/
core.c:416 [inline]
BUG: KASAN: vmalloc-out-of-bounds in acpi\_nfit\_ctl+0x20e8/0x24a0
drivers/acpi/nfit/core.c:459
The issue occurs in cmd\_to\_func when the call\_pkg->nd\_reserved2
array is accessed without verifying that call\_pkg points to a buffer
that is appropriately sized as a struct nd\_cmd\_pkg. This can lead
to out-of-bounds access and undefined behavior if the buffer does not
have sufficient space.
To address this, a check was added in acpi\_nfit\_ctl() to ensure that
buf is not NULL and that buf\_len is less than sizeof(\*call\_pkg)
before accessing it. This ensures safe access to the members of
call\_pkg, including the nd\_reserved2 array.
Reported-by: syzbot+7534f060ebda6b8b51b3@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=7534f060ebda6b8b51b3
Tested-by: syzbot+7534f060ebda6b8b51b3@syzkaller.appspotmail.com
Fixes: ebe9f6f19d80 ("acpi/nfit: Fix bus command validation")
Signed-off-by: Suraj Sonawane <surajsonawane0215@gmail.com>
Reviewed-by: Alison Schofield <alison.schofield@intel.com>
Reviewed-by: Dave Jiang <dave.jiang@intel.com>
Link: [https://patch.msgid.link/20241118162609.29063-1-surajsonawane0215@gmail.com](https://patch.msgid.link/20241118162609.29063-1-surajsonawane0215%40gmail.com)
Signed-off-by: Ira Weiny <ira.weiny@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=143f723e9eb4f0302ffb7adfdc7ef77eab3f68e0)

| -rw-r--r-- | [drivers/acpi/nfit/core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/acpi/nfit/core.c?id=143f723e9eb4f0302ffb7adfdc7ef77eab3f68e0) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 1 deletions

| diff --git a/drivers/acpi/nfit/core.c b/drivers/acpi/nfit/core.cindex 6d4ac934cd499a..1535fe19664655 100644--- a/[drivers/acpi/nfit/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/acpi/nfit/core.c?id=3faaad820cca8d782e7affa2d02bab1ea1dbbf44)+++ b/[drivers/acpi/nfit/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/acpi/nfit/core.c?id=143f723e9eb4f0302ffb7adfdc7ef77eab3f68e0)@@ -454,8 +454,13 @@ int acpi\_nfit\_ctl(struct nvdimm\_bus\_descriptor \*nd\_desc, struct nvdimm \*nvdimm, if (cmd\_rc) \*cmd\_rc = -EINVAL; - if (cmd == ND\_CMD\_CALL)+ if (cmd == ND\_CMD\_CALL) {+ if (!buf || buf\_len < sizeof(\*call\_pkg))+ return -EINVAL;+ call\_pkg = buf;+ }+ func = cmd\_to\_func(nfit\_mem, cmd, call\_pkg, &family); if (func < 0) return func; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:45:23 +0000



=== Content from git.kernel.org_c5e6f22c_20250115_084647.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=212846fafb753a48e869e2a342fc1e24048da771)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=212846fafb753a48e869e2a342fc1e24048da771)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=212846fafb753a48e869e2a342fc1e24048da771)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=212846fafb753a48e869e2a342fc1e24048da771)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Suraj Sonawane <surajsonawane0215@gmail.com> | 2024-11-18 21:56:09 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-19 18:13:11 +0100 |
| commit | [212846fafb753a48e869e2a342fc1e24048da771](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=212846fafb753a48e869e2a342fc1e24048da771) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=212846fafb753a48e869e2a342fc1e24048da771)) | |
| tree | [b2cf57854dae76f3ba82ffde49a60a3944095e66](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=212846fafb753a48e869e2a342fc1e24048da771) | |
| parent | [6234eda093721539e9b88ea5ee354d564cfaed9d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6234eda093721539e9b88ea5ee354d564cfaed9d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=212846fafb753a48e869e2a342fc1e24048da771&id2=6234eda093721539e9b88ea5ee354d564cfaed9d)) | |
| download | [linux-212846fafb753a48e869e2a342fc1e24048da771.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-212846fafb753a48e869e2a342fc1e24048da771.tar.gz) | |

acpi: nfit: vmalloc-out-of-bounds Read in acpi\_nfit\_ctl[ Upstream commit 265e98f72bac6c41a4492d3e30a8e5fd22fe0779 ]
Fix an issue detected by syzbot with KASAN:
BUG: KASAN: vmalloc-out-of-bounds in cmd\_to\_func drivers/acpi/nfit/
core.c:416 [inline]
BUG: KASAN: vmalloc-out-of-bounds in acpi\_nfit\_ctl+0x20e8/0x24a0
drivers/acpi/nfit/core.c:459
The issue occurs in cmd\_to\_func when the call\_pkg->nd\_reserved2
array is accessed without verifying that call\_pkg points to a buffer
that is appropriately sized as a struct nd\_cmd\_pkg. This can lead
to out-of-bounds access and undefined behavior if the buffer does not
have sufficient space.
To address this, a check was added in acpi\_nfit\_ctl() to ensure that
buf is not NULL and that buf\_len is less than sizeof(\*call\_pkg)
before accessing it. This ensures safe access to the members of
call\_pkg, including the nd\_reserved2 array.
Reported-by: syzbot+7534f060ebda6b8b51b3@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=7534f060ebda6b8b51b3
Tested-by: syzbot+7534f060ebda6b8b51b3@syzkaller.appspotmail.com
Fixes: ebe9f6f19d80 ("acpi/nfit: Fix bus command validation")
Signed-off-by: Suraj Sonawane <surajsonawane0215@gmail.com>
Reviewed-by: Alison Schofield <alison.schofield@intel.com>
Reviewed-by: Dave Jiang <dave.jiang@intel.com>
Link: [https://patch.msgid.link/20241118162609.29063-1-surajsonawane0215@gmail.com](https://patch.msgid.link/20241118162609.29063-1-surajsonawane0215%40gmail.com)
Signed-off-by: Ira Weiny <ira.weiny@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=212846fafb753a48e869e2a342fc1e24048da771)

| -rw-r--r-- | [drivers/acpi/nfit/core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/acpi/nfit/core.c?id=212846fafb753a48e869e2a342fc1e24048da771) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 1 deletions

| diff --git a/drivers/acpi/nfit/core.c b/drivers/acpi/nfit/core.cindex 5429ec9ef06f06..a5d47819b3a4e2 100644--- a/[drivers/acpi/nfit/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/acpi/nfit/core.c?id=6234eda093721539e9b88ea5ee354d564cfaed9d)+++ b/[drivers/acpi/nfit/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/acpi/nfit/core.c?id=212846fafb753a48e869e2a342fc1e24048da771)@@ -454,8 +454,13 @@ int acpi\_nfit\_ctl(struct nvdimm\_bus\_descriptor \*nd\_desc, struct nvdimm \*nvdimm, if (cmd\_rc) \*cmd\_rc = -EINVAL; - if (cmd == ND\_CMD\_CALL)+ if (cmd == ND\_CMD\_CALL) {+ if (!buf || buf\_len < sizeof(\*call\_pkg))+ return -EINVAL;+ call\_pkg = buf;+ }+ func = cmd\_to\_func(nfit\_mem, cmd, call\_pkg, &family); if (func < 0) return func; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:45:24 +0000



=== Content from git.kernel.org_9bb2021d_20250115_084649.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=616aa5f3c86e0479bcbb81e41c08c43ff32af637)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=616aa5f3c86e0479bcbb81e41c08c43ff32af637)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=616aa5f3c86e0479bcbb81e41c08c43ff32af637)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=616aa5f3c86e0479bcbb81e41c08c43ff32af637)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Suraj Sonawane <surajsonawane0215@gmail.com> | 2024-11-18 21:56:09 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-19 18:06:09 +0100 |
| commit | [616aa5f3c86e0479bcbb81e41c08c43ff32af637](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=616aa5f3c86e0479bcbb81e41c08c43ff32af637) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=616aa5f3c86e0479bcbb81e41c08c43ff32af637)) | |
| tree | [47bda26be2d58fa527bfb64c57275e7f8afe12be](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=616aa5f3c86e0479bcbb81e41c08c43ff32af637) | |
| parent | [632fb232b6bbf8277edcbe9ecd4b4d98ecb122eb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=632fb232b6bbf8277edcbe9ecd4b4d98ecb122eb) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=616aa5f3c86e0479bcbb81e41c08c43ff32af637&id2=632fb232b6bbf8277edcbe9ecd4b4d98ecb122eb)) | |
| download | [linux-616aa5f3c86e0479bcbb81e41c08c43ff32af637.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-616aa5f3c86e0479bcbb81e41c08c43ff32af637.tar.gz) | |

acpi: nfit: vmalloc-out-of-bounds Read in acpi\_nfit\_ctl[ Upstream commit 265e98f72bac6c41a4492d3e30a8e5fd22fe0779 ]
Fix an issue detected by syzbot with KASAN:
BUG: KASAN: vmalloc-out-of-bounds in cmd\_to\_func drivers/acpi/nfit/
core.c:416 [inline]
BUG: KASAN: vmalloc-out-of-bounds in acpi\_nfit\_ctl+0x20e8/0x24a0
drivers/acpi/nfit/core.c:459
The issue occurs in cmd\_to\_func when the call\_pkg->nd\_reserved2
array is accessed without verifying that call\_pkg points to a buffer
that is appropriately sized as a struct nd\_cmd\_pkg. This can lead
to out-of-bounds access and undefined behavior if the buffer does not
have sufficient space.
To address this, a check was added in acpi\_nfit\_ctl() to ensure that
buf is not NULL and that buf\_len is less than sizeof(\*call\_pkg)
before accessing it. This ensures safe access to the members of
call\_pkg, including the nd\_reserved2 array.
Reported-by: syzbot+7534f060ebda6b8b51b3@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=7534f060ebda6b8b51b3
Tested-by: syzbot+7534f060ebda6b8b51b3@syzkaller.appspotmail.com
Fixes: ebe9f6f19d80 ("acpi/nfit: Fix bus command validation")
Signed-off-by: Suraj Sonawane <surajsonawane0215@gmail.com>
Reviewed-by: Alison Schofield <alison.schofield@intel.com>
Reviewed-by: Dave Jiang <dave.jiang@intel.com>
Link: [https://patch.msgid.link/20241118162609.29063-1-surajsonawane0215@gmail.com](https://patch.msgid.link/20241118162609.29063-1-surajsonawane0215%40gmail.com)
Signed-off-by: Ira Weiny <ira.weiny@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=616aa5f3c86e0479bcbb81e41c08c43ff32af637)

| -rw-r--r-- | [drivers/acpi/nfit/core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/acpi/nfit/core.c?id=616aa5f3c86e0479bcbb81e41c08c43ff32af637) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 1 deletions

| diff --git a/drivers/acpi/nfit/core.c b/drivers/acpi/nfit/core.cindex 2306abb09f7f5e..16857612103ef1 100644--- a/[drivers/acpi/nfit/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/acpi/nfit/core.c?id=632fb232b6bbf8277edcbe9ecd4b4d98ecb122eb)+++ b/[drivers/acpi/nfit/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/acpi/nfit/core.c?id=616aa5f3c86e0479bcbb81e41c08c43ff32af637)@@ -453,8 +453,13 @@ int acpi\_nfit\_ctl(struct nvdimm\_bus\_descriptor \*nd\_desc, struct nvdimm \*nvdimm, if (cmd\_rc) \*cmd\_rc = -EINVAL; - if (cmd == ND\_CMD\_CALL)+ if (cmd == ND\_CMD\_CALL) {+ if (!buf || buf\_len < sizeof(\*call\_pkg))+ return -EINVAL;+ call\_pkg = buf;+ }+ func = cmd\_to\_func(nfit\_mem, cmd, call\_pkg, &family); if (func < 0) return func; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:45:26 +0000



=== Content from git.kernel.org_47f3f1bc_20250115_084648.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=265e98f72bac6c41a4492d3e30a8e5fd22fe0779)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=265e98f72bac6c41a4492d3e30a8e5fd22fe0779)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=265e98f72bac6c41a4492d3e30a8e5fd22fe0779)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=265e98f72bac6c41a4492d3e30a8e5fd22fe0779)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Suraj Sonawane <surajsonawane0215@gmail.com> | 2024-11-18 21:56:09 +0530 |
| --- | --- | --- |
| committer | Ira Weiny <ira.weiny@intel.com> | 2024-12-04 14:58:44 -0600 |
| commit | [265e98f72bac6c41a4492d3e30a8e5fd22fe0779](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=265e98f72bac6c41a4492d3e30a8e5fd22fe0779) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=265e98f72bac6c41a4492d3e30a8e5fd22fe0779)) | |
| tree | [028c304337c50f351cb59571843bb113d881b7d5](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=265e98f72bac6c41a4492d3e30a8e5fd22fe0779) | |
| parent | [40384c840ea1944d7c5a392e8975ed088ecf0b37](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=40384c840ea1944d7c5a392e8975ed088ecf0b37) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=265e98f72bac6c41a4492d3e30a8e5fd22fe0779&id2=40384c840ea1944d7c5a392e8975ed088ecf0b37)) | |
| download | [linux-265e98f72bac6c41a4492d3e30a8e5fd22fe0779.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-265e98f72bac6c41a4492d3e30a8e5fd22fe0779.tar.gz) | |

acpi: nfit: vmalloc-out-of-bounds Read in acpi\_nfit\_ctlFix an issue detected by syzbot with KASAN:
BUG: KASAN: vmalloc-out-of-bounds in cmd\_to\_func drivers/acpi/nfit/
core.c:416 [inline]
BUG: KASAN: vmalloc-out-of-bounds in acpi\_nfit\_ctl+0x20e8/0x24a0
drivers/acpi/nfit/core.c:459
The issue occurs in cmd\_to\_func when the call\_pkg->nd\_reserved2
array is accessed without verifying that call\_pkg points to a buffer
that is appropriately sized as a struct nd\_cmd\_pkg. This can lead
to out-of-bounds access and undefined behavior if the buffer does not
have sufficient space.
To address this, a check was added in acpi\_nfit\_ctl() to ensure that
buf is not NULL and that buf\_len is less than sizeof(\*call\_pkg)
before accessing it. This ensures safe access to the members of
call\_pkg, including the nd\_reserved2 array.
Reported-by: syzbot+7534f060ebda6b8b51b3@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=7534f060ebda6b8b51b3
Tested-by: syzbot+7534f060ebda6b8b51b3@syzkaller.appspotmail.com
Fixes: ebe9f6f19d80 ("acpi/nfit: Fix bus command validation")
Signed-off-by: Suraj Sonawane <surajsonawane0215@gmail.com>
Reviewed-by: Alison Schofield <alison.schofield@intel.com>
Reviewed-by: Dave Jiang <dave.jiang@intel.com>
Link: [https://patch.msgid.link/20241118162609.29063-1-surajsonawane0215@gmail.com](https://patch.msgid.link/20241118162609.29063-1-surajsonawane0215%40gmail.com)
Signed-off-by: Ira Weiny <ira.weiny@intel.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=265e98f72bac6c41a4492d3e30a8e5fd22fe0779)

| -rw-r--r-- | [drivers/acpi/nfit/core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/acpi/nfit/core.c?id=265e98f72bac6c41a4492d3e30a8e5fd22fe0779) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 1 deletions

| diff --git a/drivers/acpi/nfit/core.c b/drivers/acpi/nfit/core.cindex 5429ec9ef06f06..a5d47819b3a4e2 100644--- a/[drivers/acpi/nfit/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/acpi/nfit/core.c?id=40384c840ea1944d7c5a392e8975ed088ecf0b37)+++ b/[drivers/acpi/nfit/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/acpi/nfit/core.c?id=265e98f72bac6c41a4492d3e30a8e5fd22fe0779)@@ -454,8 +454,13 @@ int acpi\_nfit\_ctl(struct nvdimm\_bus\_descriptor \*nd\_desc, struct nvdimm \*nvdimm, if (cmd\_rc) \*cmd\_rc = -EINVAL; - if (cmd == ND\_CMD\_CALL)+ if (cmd == ND\_CMD\_CALL) {+ if (!buf || buf\_len < sizeof(\*call\_pkg))+ return -EINVAL;+ call\_pkg = buf;+ }+ func = cmd\_to\_func(nfit\_mem, cmd, call\_pkg, &family); if (func < 0) return func; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:45:25 +0000


