=== Content from github.com_c194a31d_20250114_210204.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkarmada-io%2Fkarmada%2Fcommit%2F40ec488b18a461ab0f871d2c9ec8665b361f0d50)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkarmada-io%2Fkarmada%2Fcommit%2F40ec488b18a461ab0f871d2c9ec8665b361f0d50)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=karmada-io%2Fkarmada)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[karmada-io](/karmada-io)
/
**[karmada](/karmada-io/karmada)**
Public

* [Notifications](/login?return_to=%2Fkarmada-io%2Fkarmada) You must be signed in to change notification settings
* [Fork
  907](/login?return_to=%2Fkarmada-io%2Fkarmada)
* [Star
   4.6k](/login?return_to=%2Fkarmada-io%2Fkarmada)

* [Code](/karmada-io/karmada)
* [Issues
  411](/karmada-io/karmada/issues)
* [Pull requests
  190](/karmada-io/karmada/pulls)
* [Discussions](/karmada-io/karmada/discussions)
* [Actions](/karmada-io/karmada/actions)
* [Projects
  10](/karmada-io/karmada/projects)
* [Security](/karmada-io/karmada/security)
* [Insights](/karmada-io/karmada/pulse)

Additional navigation options

* [Code](/karmada-io/karmada)
* [Issues](/karmada-io/karmada/issues)
* [Pull requests](/karmada-io/karmada/pulls)
* [Discussions](/karmada-io/karmada/discussions)
* [Actions](/karmada-io/karmada/actions)
* [Projects](/karmada-io/karmada/projects)
* [Security](/karmada-io/karmada/security)
* [Insights](/karmada-io/karmada/pulse)

## Commit

[Permalink](/karmada-io/karmada/commit/40ec488b18a461ab0f871d2c9ec8665b361f0d50)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request [#5713](https://github.com/karmada-io/karmada/pull/5713) from zhzhuang-zju/ctl-crds

[Browse files](/karmada-io/karmada/tree/40ec488b18a461ab0f871d2c9ec8665b361f0d50)
Browse the repository at this point in the history

```
karmadactl init: add CRDs archive verification to enhance file system robustness
```

* Loading branch information

[![@karmada-bot](https://avatars.githubusercontent.com/u/76678816?s=40&v=4)](/karmada-bot)

[karmada-bot](/karmada-io/karmada/commits?author=karmada-bot "View all commits by karmada-bot")
authored
Nov 27, 2024

2 parents
[f78e7e2](/karmada-io/karmada/commit/f78e7e2a3d02bed04e9bc7abd3ae7b3ac56862d2)
+
[b7afcaf](/karmada-io/karmada/commit/b7afcaf5a251477ee3879ae02b1cc3e022408cc8)

commit 40ec488

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**38 additions**
and
**7 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* pkg

  + karmadactl/cmdinit

    - kubernetes

      * pkg/karmadactl/cmdinit/kubernetes/deploy.go
        [deploy.go](#diff-776fb9a52f4103df692224f37cc7934d3a55426f41787848f25c30a3f49a4b12)
    - utils

      * pkg/karmadactl/cmdinit/utils/util.go
        [util.go](#diff-2a0eb53ed9afbfa69df6785a5230782d36d47a435718648851f62278e6d22383)
  + util/validation

    - pkg/util/validation/validation\_test.go
      [validation\_test.go](#diff-d768f968ff01a564507c324ed4d6041c7834361a883f78e3192272a8694e4b8d)

## There are no files selected for viewing

29 changes: 23 additions & 6 deletions

29
[pkg/karmadactl/cmdinit/kubernetes/deploy.go](#diff-776fb9a52f4103df692224f37cc7934d3a55426f41787848f25c30a3f49a4b12 "pkg/karmadactl/cmdinit/kubernetes/deploy.go")

Show comments

[View file](/karmada-io/karmada/blob/40ec488b18a461ab0f871d2c9ec8665b361f0d50/pkg/karmadactl/cmdinit/kubernetes/deploy.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -23,6 +23,7 @@ import ( |
|  |  | "net" |
|  |  | "os" |
|  |  | "path" |
|  |  | "path/filepath" |
|  |  | "strings" |
|  |  | "time" |
|  |  |  |
| Expand All | | @@ -43,6 +44,7 @@ import ( |
|  |  | globaloptions "github.com/karmada-io/karmada/pkg/karmadactl/options" |
|  |  | "github.com/karmada-io/karmada/pkg/karmadactl/util" |
|  |  | "github.com/karmada-io/karmada/pkg/karmadactl/util/apiclient" |
|  |  | "github.com/karmada-io/karmada/pkg/util/validation" |
|  |  | "github.com/karmada-io/karmada/pkg/version" |
|  |  | ) |
|  |  |  |
| Expand Down  Expand Up | | @@ -381,19 +383,34 @@ func (i \*CommandInitOption) genCerts() error { |
|  |  |  |
|  |  | // prepareCRD download or unzip `crds.tar.gz` to `options.DataPath` |
|  |  | func (i \*CommandInitOption) prepareCRD() error { |
|  |  | var filename string |
|  |  | if strings.HasPrefix(i.CRDs, "http") { |
|  |  | filename := i.KarmadaDataPath + "/" + path.Base(i.CRDs) |
|  |  | filename = i.KarmadaDataPath + "/" + path.Base(i.CRDs) |
|  |  | klog.Infof("download crds file:%s", i.CRDs) |
|  |  | if err := utils.DownloadFile(i.CRDs, filename); err != nil { |
|  |  | return err |
|  |  | } |
|  |  | if err := utils.DeCompress(filename, i.KarmadaDataPath); err != nil { |
|  |  | return err |
|  |  | } else { |
|  |  | filename = i.CRDs |
|  |  | klog.Infoln("local crds file name:", i.CRDs) |
|  |  | } |
|  |  |  |
|  |  | if err := validation.ValidateTarball(filename, validation.ValidateCrdsTarBall); err != nil { |
|  |  | return fmt.Errorf("inValid crd tar, err: %w", err) |
|  |  | } |
|  |  |  |
|  |  | if err := utils.DeCompress(filename, i.KarmadaDataPath); err != nil { |
|  |  | return err |
|  |  | } |
|  |  |  |
|  |  | for \_, archive := range validation.CrdsArchive { |
|  |  | expectedDir := filepath.Join(i.KarmadaDataPath, archive) |
|  |  | exist, \_ := utils.PathExists(expectedDir) |
|  |  | if !exist { |
|  |  | return fmt.Errorf("lacking the necessary file path: %s", expectedDir) |
|  |  | } |
|  |  | return nil |
|  |  | } |
|  |  | klog.Infoln("local crds file name:", i.CRDs) |
|  |  | return utils.DeCompress(i.CRDs, i.KarmadaDataPath) |
|  |  | return nil |
|  |  | } |
|  |  |  |
|  |  | func (i \*CommandInitOption) createCertsSecrets() error { |
| Expand Down | |  |

14 changes: 14 additions & 0 deletions

14
[pkg/karmadactl/cmdinit/utils/util.go](#diff-2a0eb53ed9afbfa69df6785a5230782d36d47a435718648851f62278e6d22383 "pkg/karmadactl/cmdinit/utils/util.go")

Show comments

[View file](/karmada-io/karmada/blob/40ec488b18a461ab0f871d2c9ec8665b361f0d50/pkg/karmadactl/cmdinit/utils/util.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -157,3 +157,17 @@ func ListFiles(path string) []string { |
|  |  | } |
|  |  | return files |
|  |  | } |
|  |  |  |
|  |  | // PathExists check whether the path is exist |
|  |  | func PathExists(path string) (bool, error) { |
|  |  | \_, err := os.Stat(path) |
|  |  | if err == nil { |
|  |  | return true, nil |
|  |  | } |
|  |  |  |
|  |  | if os.IsNotExist(err) { |
|  |  | return false, nil |
|  |  | } |
|  |  |  |
|  |  | return false, err |
|  |  | } |

2 changes: 1 addition & 1 deletion

2
[pkg/util/validation/validation\_test.go](#diff-d768f968ff01a564507c324ed4d6041c7834361a883f78e3192272a8694e4b8d "pkg/util/validation/validation_test.go")

Show comments

[View file](/karmada-io/karmada/blob/40ec488b18a461ab0f871d2c9ec8665b361f0d50/pkg/util/validation/validation_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -721,7 +721,7 @@ func TestValidateApplicationFailover(t \*testing.T) { |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | func TestCheckOperatorCrdsTar(t \*testing.T) { |
|  |  | func TestValidateCrdsTarBall(t \*testing.T) { |
|  |  | testItems := []struct { |
|  |  | name string |
|  |  | header \*tar.Header |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `40ec488`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkarmada-io%2Fkarmada%2Fcommit%2F40ec488b18a461ab0f871d2c9ec8665b361f0d50) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_efa2f98a_20250114_210207.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkarmada-io%2Fkarmada%2Fcommit%2Ff78e7e2a3d02bed04e9bc7abd3ae7b3ac56862d2)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkarmada-io%2Fkarmada%2Fcommit%2Ff78e7e2a3d02bed04e9bc7abd3ae7b3ac56862d2)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=karmada-io%2Fkarmada)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[karmada-io](/karmada-io)
/
**[karmada](/karmada-io/karmada)**
Public

* [Notifications](/login?return_to=%2Fkarmada-io%2Fkarmada) You must be signed in to change notification settings
* [Fork
  907](/login?return_to=%2Fkarmada-io%2Fkarmada)
* [Star
   4.6k](/login?return_to=%2Fkarmada-io%2Fkarmada)

* [Code](/karmada-io/karmada)
* [Issues
  411](/karmada-io/karmada/issues)
* [Pull requests
  190](/karmada-io/karmada/pulls)
* [Discussions](/karmada-io/karmada/discussions)
* [Actions](/karmada-io/karmada/actions)
* [Projects
  10](/karmada-io/karmada/projects)
* [Security](/karmada-io/karmada/security)
* [Insights](/karmada-io/karmada/pulse)

Additional navigation options

* [Code](/karmada-io/karmada)
* [Issues](/karmada-io/karmada/issues)
* [Pull requests](/karmada-io/karmada/pulls)
* [Discussions](/karmada-io/karmada/discussions)
* [Actions](/karmada-io/karmada/actions)
* [Projects](/karmada-io/karmada/projects)
* [Security](/karmada-io/karmada/security)
* [Insights](/karmada-io/karmada/pulse)

## Commit

[Permalink](/karmada-io/karmada/commit/f78e7e2a3d02bed04e9bc7abd3ae7b3ac56862d2)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request [#5703](https://github.com/karmada-io/karmada/pull/5703) from zhzhuang-zju/security

[Browse files](/karmada-io/karmada/tree/f78e7e2a3d02bed04e9bc7abd3ae7b3ac56862d2)
Browse the repository at this point in the history

```
karmada-operator: add CRDs archive verification to enhance file system robustness
```

* Loading branch information

[![@karmada-bot](https://avatars.githubusercontent.com/u/76678816?s=40&v=4)](/karmada-bot)

[karmada-bot](/karmada-io/karmada/commits?author=karmada-bot "View all commits by karmada-bot")
authored
Nov 27, 2024

2 parents
[8bf3786](/karmada-io/karmada/commit/8bf37863c5f89845272b0f463ac13048d5ab7d87)
+
[63590cb](/karmada-io/karmada/commit/63590cbeee3ef23d66799ffcee5b39d5a005115f)

commit f78e7e2

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**215 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* operator/pkg/tasks/init

  + operator/pkg/tasks/init/crd.go
    [crd.go](#diff-aea40ece69fce8fd5385c56e5183345d8ef8955c34603fab3d2d9af8ae1d3a94)
* pkg/util/validation

  + pkg/util/validation/validation.go
    [validation.go](#diff-c529ef335406b764ff4fda089e3b5a770d671162986c01cb0143abc1f3c9d91a)
  + pkg/util/validation/validation\_test.go
    [validation\_test.go](#diff-d768f968ff01a564507c324ed4d6041c7834361a883f78e3192272a8694e4b8d)

## There are no files selected for viewing

32 changes: 32 additions & 0 deletions

32
[operator/pkg/tasks/init/crd.go](#diff-aea40ece69fce8fd5385c56e5183345d8ef8955c34603fab3d2d9af8ae1d3a94 "operator/pkg/tasks/init/crd.go")

Show comments

[View file](/karmada-io/karmada/blob/f78e7e2a3d02bed04e9bc7abd3ae7b3ac56862d2/operator/pkg/tasks/init/crd.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -23,13 +23,15 @@ import ( |
|  |  | "fmt" |
|  |  | "os" |
|  |  | "path" |
|  |  | "path/filepath" |
|  |  | "strings" |
|  |  |  |
|  |  | "k8s.io/klog/v2" |
|  |  |  |
|  |  | operatorv1alpha1 "github.com/karmada-io/karmada/operator/pkg/apis/operator/v1alpha1" |
|  |  | "github.com/karmada-io/karmada/operator/pkg/util" |
|  |  | "github.com/karmada-io/karmada/operator/pkg/workflow" |
|  |  | "github.com/karmada-io/karmada/pkg/util/validation" |
|  |  | ) |
|  |  |  |
|  |  | var ( |
| Expand All | | @@ -53,6 +55,10 @@ func NewPrepareCrdsTask() workflow.Task { |
|  |  | Name: "Unpack", |
|  |  | Run: runUnpack, |
|  |  | }, |
|  |  | { |
|  |  | Name: "post-check", |
|  |  | Run: postCheck, |
|  |  | }, |
|  |  | }, |
|  |  | } |
|  |  | } |
| Expand Down  Expand Up | | @@ -154,6 +160,9 @@ func runUnpack(r workflow.RunData) error { |
|  |  | exist, \_ := util.PathExists(crdsPath) |
|  |  | if !exist { |
|  |  | klog.V(2).InfoS("[runUnpack] CRD yaml files do not exist, unpacking tar file", "unpackDir", crdsDir) |
|  |  | if err = validation.ValidateTarball(crdsTarPath, validation.ValidateCrdsTarBall); err != nil { |
|  |  | return fmt.Errorf("[unpack] inValid crd tar, err: %w", err) |
|  |  | } |
|  |  | if err := util.Unpack(crdsTarPath, crdsDir); err != nil { |
|  |  | return fmt.Errorf("[unpack] failed to unpack crd tar, err: %w", err) |
|  |  | } |
| Expand All | | @@ -165,6 +174,29 @@ func runUnpack(r workflow.RunData) error { |
|  |  | return nil |
|  |  | } |
|  |  |  |
|  |  | func postCheck(r workflow.RunData) error { |
|  |  | data, ok := r.(InitData) |
|  |  | if !ok { |
|  |  | return errors.New("post-check task invoked with an invalid data struct") |
|  |  | } |
|  |  |  |
|  |  | crdsDir, err := getCrdsDir(data) |
|  |  | if err != nil { |
|  |  | return fmt.Errorf("[post-check] failed to get CRD dir, err: %w", err) |
|  |  | } |
|  |  |  |
|  |  | for \_, archive := range validation.CrdsArchive { |
|  |  | expectedDir := filepath.Join(crdsDir, archive) |
|  |  | exist, \_ := util.PathExists(expectedDir) |
|  |  | if !exist { |
|  |  | return fmt.Errorf("[post-check] Lacking the necessary file path: %s", expectedDir) |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | klog.V(2).InfoS("[post-check] Successfully post-check the crd tar archive", "karmada", klog.KObj(data)) |
|  |  | return nil |
|  |  | } |
|  |  |  |
|  |  | func existCrdsTar(crdsDir string) bool { |
|  |  | files := util.ListFiles(crdsDir) |
|  |  | klog.V(2).InfoS("[existCrdsTar] Checking for CRD tar file in directory", "directory", crdsDir) |
| Expand Down | |  |

88 changes: 88 additions & 0 deletions

88
[pkg/util/validation/validation.go](#diff-c529ef335406b764ff4fda089e3b5a770d671162986c01cb0143abc1f3c9d91a "pkg/util/validation/validation.go")

Show comments

[View file](/karmada-io/karmada/blob/f78e7e2a3d02bed04e9bc7abd3ae7b3ac56862d2/pkg/util/validation/validation.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -17,7 +17,13 @@ limitations under the License. |
|  |  | package validation |
|  |  |  |
|  |  | import ( |
|  |  | "archive/tar" |
|  |  | "compress/gzip" |
|  |  | "fmt" |
|  |  | "io" |
|  |  | "os" |
|  |  | "path/filepath" |
|  |  | "strings" |
|  |  |  |
|  |  | "github.com/go-openapi/jsonpointer" |
|  |  | corev1 "k8s.io/api/core/v1" |
| Expand Down  Expand Up | | @@ -372,3 +378,85 @@ func validateOverrideOperator(operator policyv1alpha1.OverriderOperator, value a |
|  |  | } |
|  |  | return allErrs |
|  |  | } |
|  |  |  |
|  |  | // CrdsArchive defines the expected tar archive. |
|  |  | var CrdsArchive = []string{"crds", "crds/bases", "crds/patches"} |
|  |  |  |
|  |  | // ValidateTarball opens a .tar.gz file, and validates each |
|  |  | // entry in the tar archive using a provided validate function. |
|  |  | func ValidateTarball(tarball string, validate func(\*tar.Header) error) error { |
|  |  | r, err := os.Open(tarball) |
|  |  | if err != nil { |
|  |  | return err |
|  |  | } |
|  |  | defer r.Close() |
|  |  |  |
|  |  | gr, err := gzip.NewReader(r) |
|  |  | if err != nil { |
|  |  | return fmt.Errorf("new reader failed. %v", err) |
|  |  | } |
|  |  | defer gr.Close() |
|  |  |  |
|  |  | tr := tar.NewReader(gr) |
|  |  | for { |
|  |  | header, err := tr.Next() |
|  |  | if err != nil { |
|  |  | if err == io.EOF { |
|  |  | break |
|  |  | } |
|  |  | return err |
|  |  | } |
|  |  |  |
|  |  | if err = validate(header); err != nil { |
|  |  | return err |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | return nil |
|  |  | } |
|  |  |  |
|  |  | // ValidateCrdsTarBall checks if the CRDs package complies with file specifications. |
|  |  | // It verifies the following: |
|  |  | // 1. Whether the path is clean. |
|  |  | // 2. Whether the file directory structure meets expectations. |
|  |  | func ValidateCrdsTarBall(header \*tar.Header) error { |
|  |  | switch header.Typeflag { |
|  |  | case tar.TypeDir: |
|  |  | // in Unix-like systems, directory paths in tar archives end with a slash (/) to distinguish them from file paths. |
|  |  | if strings.HasSuffix(header.Name, "/") && len(header.Name) > 1 { |
|  |  | if !isCleanPath(header.Name[:len(header.Name)-1]) { |
|  |  | return fmt.Errorf("the given file contains unclean file dir: %s", header.Name) |
|  |  | } |
|  |  | } else { |
|  |  | if !isCleanPath(header.Name) { |
|  |  | return fmt.Errorf("the given file contains unclean file dir: %s", header.Name) |
|  |  | } |
|  |  | } |
|  |  | if !isExpectedPath(header.Name, CrdsArchive) { |
|  |  | return fmt.Errorf("the given file contains unexpected file dir: %s", header.Name) |
|  |  | } |
|  |  | case tar.TypeReg: |
|  |  | if !isCleanPath(header.Name) { |
|  |  | return fmt.Errorf("the given file contains unclean file path: %s", header.Name) |
|  |  | } |
|  |  | if !isExpectedPath(header.Name, CrdsArchive) { |
|  |  | return fmt.Errorf("the given file contains unexpected file path: %s", header.Name) |
|  |  | } |
|  |  | default: |
|  |  | return fmt.Errorf("unknown type: %v in %s", header.Typeflag, header.Name) |
|  |  | } |
|  |  | return nil |
|  |  | } |
|  |  |  |
|  |  | func isExpectedPath(path string, expectedDirs []string) bool { |
|  |  | for \_, dir := range expectedDirs { |
|  |  | if path == dir || strings.HasPrefix(path, dir+"/") { |
|  |  | return true |
|  |  | } |
|  |  | } |
|  |  | return false |
|  |  | } |
|  |  |  |
|  |  | func isCleanPath(path string) bool { |
|  |  | return path == filepath.Clean(path) |
|  |  | } |

95 changes: 95 additions & 0 deletions

95
[pkg/util/validation/validation\_test.go](#diff-d768f968ff01a564507c324ed4d6041c7834361a883f78e3192272a8694e4b8d "pkg/util/validation/validation_test.go")

Show comments

[View file](/karmada-io/karmada/blob/f78e7e2a3d02bed04e9bc7abd3ae7b3ac56862d2/pkg/util/validation/validation_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -17,9 +17,12 @@ limitations under the License. |
|  |  | package validation |
|  |  |  |
|  |  | import ( |
|  |  | "archive/tar" |
|  |  | "fmt" |
|  |  | "strings" |
|  |  | "testing" |
|  |  |  |
|  |  | "github.com/stretchr/testify/assert" |
|  |  | corev1 "k8s.io/api/core/v1" |
|  |  | "k8s.io/apimachinery/pkg/util/validation/field" |
|  |  | "k8s.io/utils/ptr" |
| Expand Down  Expand Up | | @@ -717,3 +720,95 @@ func TestValidateApplicationFailover(t \*testing.T) { |
|  |  | }) |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | func TestCheckOperatorCrdsTar(t \*testing.T) { |
|  |  | testItems := []struct { |
|  |  | name string |
|  |  | header \*tar.Header |
|  |  | expectedErr error |
|  |  | }{ |
|  |  | { |
|  |  | name: "unclean file dir 'crds/../'", |
|  |  | header: &tar.Header{ |
|  |  | Name: "crds/../", |
|  |  | Typeflag: tar.TypeDir, |
|  |  | }, |
|  |  | expectedErr: fmt.Errorf("the given file contains unclean file dir: %s", "crds/../"), |
|  |  | }, |
|  |  | { |
|  |  | name: "unclean file dir 'crds/..'", |
|  |  | header: &tar.Header{ |
|  |  | Name: "crds/..", |
|  |  | Typeflag: tar.TypeDir, |
|  |  | }, |
|  |  | expectedErr: fmt.Errorf("the given file contains unclean file dir: %s", "crds/.."), |
|  |  | }, |
|  |  | { |
|  |  | name: "unexpected file dir '../crds'", |
|  |  | header: &tar.Header{ |
|  |  | Name: "../crds", |
|  |  | Typeflag: tar.TypeDir, |
|  |  | }, |
|  |  | expectedErr: fmt.Errorf("the given file contains unexpected file dir: %s", "../crds"), |
|  |  | }, |
|  |  | { |
|  |  | name: "unexpected file dir '..'", |
|  |  | header: &tar.Header{ |
|  |  | Name: "..", |
|  |  | Typeflag: tar.TypeDir, |
|  |  | }, |
|  |  | expectedErr: fmt.Errorf("the given file contains unexpected file dir: %s", ".."), |
|  |  | }, |
|  |  | { |
|  |  | name: "expected file dir 'crds/'", |
|  |  | header: &tar.Header{ |
|  |  | Name: "crds/", |
|  |  | Typeflag: tar.TypeDir, |
|  |  | }, |
|  |  | expectedErr: nil, |
|  |  | }, |
|  |  | { |
|  |  | name: "expected file dir 'crds'", |
|  |  | header: &tar.Header{ |
|  |  | Name: "crds", |
|  |  | Typeflag: tar.TypeDir, |
|  |  | }, |
|  |  | expectedErr: nil, |
|  |  | }, |
|  |  | { |
|  |  | name: "unclean file path 'crds/../a.yaml'", |
|  |  | header: &tar.Header{ |
|  |  | Name: "crds/../a.yaml", |
|  |  | Typeflag: tar.TypeReg, |
|  |  | }, |
|  |  | expectedErr: fmt.Errorf("the given file contains unclean file path: %s", "crds/../a.yaml"), |
|  |  | }, |
|  |  | { |
|  |  | name: "unexpected file path '../crds/a.yaml'", |
|  |  | header: &tar.Header{ |
|  |  | Name: "../crds/a.yaml", |
|  |  | Typeflag: tar.TypeReg, |
|  |  | }, |
|  |  | expectedErr: fmt.Errorf("the given file contains unexpected file path: %s", "../crds/a.yaml"), |
|  |  | }, |
|  |  | { |
|  |  | name: "unexpected file path '../a.yaml'", |
|  |  | header: &tar.Header{ |
|  |  | Name: "../a.yaml", |
|  |  | Typeflag: tar.TypeReg, |
|  |  | }, |
|  |  | expectedErr: fmt.Errorf("the given file contains unexpected file path: %s", "../a.yaml"), |
|  |  | }, |
|  |  | { |
|  |  | name: "expected file path 'crds/a.yaml'", |
|  |  | header: &tar.Header{ |
|  |  | Name: "crds/a.yaml", |
|  |  | Typeflag: tar.TypeReg, |
|  |  | }, |
|  |  | expectedErr: nil, |
|  |  | }, |
|  |  | } |
|  |  | for \_, item := range testItems { |
|  |  | assert.Equal(t, item.expectedErr, ValidateCrdsTarBall(item.header)) |
|  |  | } |
|  |  | } |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `f78e7e2`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkarmada-io%2Fkarmada%2Fcommit%2Ff78e7e2a3d02bed04e9bc7abd3ae7b3ac56862d2) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_85b9aba2_20250114_210211.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkarmada-io%2Fkarmada%2Fpull%2F5713)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkarmada-io%2Fkarmada%2Fpull%2F5713)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=karmada-io%2Fkarmada)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[karmada-io](/karmada-io)
/
**[karmada](/karmada-io/karmada)**
Public

* [Notifications](/login?return_to=%2Fkarmada-io%2Fkarmada) You must be signed in to change notification settings
* [Fork
  907](/login?return_to=%2Fkarmada-io%2Fkarmada)
* [Star
   4.6k](/login?return_to=%2Fkarmada-io%2Fkarmada)

* [Code](/karmada-io/karmada)
* [Issues
  411](/karmada-io/karmada/issues)
* [Pull requests
  190](/karmada-io/karmada/pulls)
* [Discussions](/karmada-io/karmada/discussions)
* [Actions](/karmada-io/karmada/actions)
* [Projects
  10](/karmada-io/karmada/projects)
* [Security](/karmada-io/karmada/security)
* [Insights](/karmada-io/karmada/pulse)

Additional navigation options

* [Code](/karmada-io/karmada)
* [Issues](/karmada-io/karmada/issues)
* [Pull requests](/karmada-io/karmada/pulls)
* [Discussions](/karmada-io/karmada/discussions)
* [Actions](/karmada-io/karmada/actions)
* [Projects](/karmada-io/karmada/projects)
* [Security](/karmada-io/karmada/security)
* [Insights](/karmada-io/karmada/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fkarmada-io%2Fkarmada%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fkarmada-io%2Fkarmada%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# karmadactl init: add CRDs archive verification to enhance file system robustness #5713

 Merged

[karmada-bot](/karmada-bot)
merged 1 commit into
[karmada-io:master](/karmada-io/karmada/tree/master "karmada-io/karmada:master")
from
[zhzhuang-zju:ctl-crds](/zhzhuang-zju/karmada/tree/ctl-crds "zhzhuang-zju/karmada:ctl-crds")

Nov 27, 2024

 Merged

# [karmadactl init: add CRDs archive verification to enhance file system robustness](#top) #5713

[karmada-bot](/karmada-bot)
merged 1 commit into
[karmada-io:master](/karmada-io/karmada/tree/master "karmada-io/karmada:master")
from
[zhzhuang-zju:ctl-crds](/zhzhuang-zju/karmada/tree/ctl-crds "zhzhuang-zju/karmada:ctl-crds")

Nov 27, 2024

[Conversation
6](/karmada-io/karmada/pull/5713)
[Commits
1](/karmada-io/karmada/pull/5713/commits)
[Checks
17](/karmada-io/karmada/pull/5713/checks)
[Files changed](/karmada-io/karmada/pull/5713/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![zhzhuang-zju](https://avatars.githubusercontent.com/u/81208264?s=60&v=4)](/zhzhuang-zju)

Copy link

Contributor

### @zhzhuang-zju **[zhzhuang-zju](/zhzhuang-zju)** commented [Oct 19, 2024](#issue-2598809590)

**What type of PR is this?**

/kind feature

**What this PR does / why we need it**:

`karmadactl init` provides a custom download path for CRDs files. Before processing the files, it's necessary to validate the CRDs archive to enhance system robustness.

* check if its file name includes unclean paths.
* check if the CRDs archive has the expected directory structure.

**Which issue(s) this PR fixes**:

Fixes #

**Special notes for your reviewer**:

**Does this PR introduce a user-facing change?**:

```

```

Sorry, something went wrong.

All reactions

[![@karmada-bot](https://avatars.githubusercontent.com/u/76678816?s=40&u=fcd90b8b6679eaa786ceb69dd03ec72e6f11dd09&v=4)](/karmada-bot)
[karmada-bot](/karmada-bot)
added
the
[kind/feature](/karmada-io/karmada/labels/kind/feature)
Categorizes issue or PR as related to a new feature.
label
[Oct 19, 2024](#event-14729470984)

 [![@karmada-bot](https://avatars.githubusercontent.com/u/76678816?s=40&u=fcd90b8b6679eaa786ceb69dd03ec72e6f11dd09&v=4)](/karmada-bot)
[karmada-bot](/karmada-bot)
requested review from
[chaosi-zju](/chaosi-zju) and
[prodanlabs](/prodanlabs)
[October 19, 2024 06:34](#event-14729471104)

[![@karmada-bot](https://avatars.githubusercontent.com/u/76678816?s=40&u=fcd90b8b6679eaa786ceb69dd03ec72e6f11dd09&v=4)](/karmada-bot)
[karmada-bot](/karmada-bot)
added
the
[size/L](/karmada-io/karmada/labels/size/L)
Denotes a PR that changes 100-499 lines, ignoring generated files.
label
[Oct 19, 2024](#event-14729471397)

[![@codecov-commenter](https://avatars.githubusercontent.com/u/65553080?s=80&u=b7ee84d82e25b493051d810390e97b15f716d7ef&v=4)](/codecov-commenter)

Copy link

### **[codecov-commenter](/codecov-commenter)** commented [Oct 19, 2024](#issuecomment-2423622370) • edited Loading

|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| ⚠️ Please install the ['codecov app svg image'](https://private-user-images.githubusercontent.com/152432831/340411587-e90313f4-9d3a-4b63-8b54-cfe14e7ec20d.svg?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY4ODg4MjksIm5iZiI6MTczNjg4ODUyOSwicGF0aCI6Ii8xNTI0MzI4MzEvMzQwNDExNTg3LWU5MDMxM2Y0LTlkM2EtNGI2My04YjU0LWNmZTE0ZTdlYzIwZC5zdmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjUwMTE0JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI1MDExNFQyMTAyMDlaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT1jOTRlNDE0ODZlZWU4OGMwYjQwZDExMjdkMTMwMWM5ZTA4NzcxMGYyMTRjZjY5ZmFjYWUxZDgyYTNlZWIxZDZiJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.vBO8PDPoAIWX9MmaBWlXllN9cGo4oGVutS8WCh6Zdc0) to ensure uploads and comments are reliably processed by Codecov. [Codecov](https://app.codecov.io/gh/karmada-io/karmada/pull/5713?dropdown=coverage&src=pr&el=h1&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=karmada-io) Report Attention: Patch coverage is `0%` with `27 lines` in your changes missing coverage. Please review.  Project coverage is 46.28%. Comparing base [(`f78e7e2`)](https://app.codecov.io/gh/karmada-io/karmada/commit/f78e7e2a3d02bed04e9bc7abd3ae7b3ac56862d2?dropdown=coverage&el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=karmada-io) to head [(`b7afcaf`)](https://app.codecov.io/gh/karmada-io/karmada/commit/b7afcaf5a251477ee3879ae02b1cc3e022408cc8?dropdown=coverage&el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=karmada-io).   | [Files with missing lines](https://app.codecov.io/gh/karmada-io/karmada/pull/5713?dropdown=coverage&src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=karmada-io) | Patch % | Lines | | --- | --- | --- | | [pkg/karmadactl/cmdinit/kubernetes/deploy.go](https://app.codecov.io/gh/karmada-io/karmada/pull/5713?src=pr&el=tree&filepath=pkg%2Fkarmadactl%2Fcmdinit%2Fkubernetes%2Fdeploy.go&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=karmada-io#diff-cGtnL2thcm1hZGFjdGwvY21kaW5pdC9rdWJlcm5ldGVzL2RlcGxveS5nbw==) | 0.00% | [18 Missing ⚠️](https://app.codecov.io/gh/karmada-io/karmada/pull/5713?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=karmada-io) | | [pkg/karmadactl/cmdinit/utils/util.go](https://app.codecov.io/gh/karmada-io/karmada/pull/5713?src=pr&el=tree&filepath=pkg%2Fkarmadactl%2Fcmdinit%2Futils%2Futil.go&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=karmada-io#diff-cGtnL2thcm1hZGFjdGwvY21kaW5pdC91dGlscy91dGlsLmdv) | 0.00% | [9 Missing ⚠️](https://app.codecov.io/gh/karmada-io/karmada/pull/5713?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=karmada-io) |   ❗ Your organization needs to install the [Codecov GitHub app](https://github.com/apps/codecov/installations/select_target) to enable full functionality. Additional details and impacted files ``` @@            Coverage Diff             @@ ##           master    #5713      +/-   ## ========================================== - Coverage   46.30%   46.28%   -0.03%      ==========================================   Files         663      663                 Lines       54686    54707      +21      ========================================== - Hits        25324    25322       -2      - Misses      27737    27760      +23        Partials     1625     1625               ```  | [Flag](https://app.codecov.io/gh/karmada-io/karmada/pull/5713/flags?src=pr&el=flags&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=karmada-io) | Coverage Δ |  | | --- | --- | --- | | [unittests](https://app.codecov.io/gh/karmada-io/karmada/pull/5713/flags?src=pr&el=flag&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=karmada-io) | `46.28% <0.00%> (-0.03%)` | ⬇️ |   Flags with carried forward coverage won't be shown. [Click here](https://docs.codecov.io/docs/carryforward-flags?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=karmada-io#carryforward-flags-in-the-pull-request-comment) to find out more.  [☔ View full report in Codecov by Sentry](https://app.codecov.io/gh/karmada-io/karmada/pull/5713?dropdown=coverage&src=pr&el=continue&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=karmada-io). 📢 Have feedback on the report? [Share it here](https://about.codecov.io/codecov-pr-comment-feedback/?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=karmada-io). |

All reactions

Sorry, something went wrong.

 [![@zhzhuang-zju](https://avatars.githubusercontent.com/u/81208264?s=40&u=60cc38ec532e3d5ac03ed411152d6552af110a35&v=4)](/zhzhuang-zju)
[zhzhuang-zju](/zhzhuang-zju)
[force-pushed](/karmada-io/karmada/compare/0c2028dfbce78720e894319e7b51ecfef66d8fc8..5c9e1db3e6e96c12aef324427bd041a92b36180d)
the
ctl-crds

branch
from
[`0c2028d`](/karmada-io/karmada/commit/0c2028dfbce78720e894319e7b51ecfef66d8fc8) to
[`5c9e1db`](/karmada-io/karmada/commit/5c9e1db3e6e96c12aef324427bd041a92b36180d)  [Compare](/karmada-io/karmada/compare/0c2028dfbce78720e894319e7b51ecfef66d8fc8..5c9e1db3e6e96c12aef324427bd041a92b36180d)
[October 19, 2024 06:59](#event-14729518121)

 [![@zhzhuang-zju](https://avatars.githubusercontent.com/u/81208264?s=40&u=60cc38ec532e3d5ac03ed411152d6552af110a35&v=4)](/zhzhuang-zju)
[zhzhuang-zju](/zhzhuang-zju)
[force-pushed](/karmada-io/karmada/compare/5c9e1db3e6e96c12aef324427bd041a92b36180d..b61abdd1a574b1b7aa6b7dad60c9c7724f043972)
the
ctl-crds

branch
from
[`5c9e1db`](/karmada-io/karmada/commit/5c9e1db3e6e96c12aef324427bd041a92b36180d) to
[`b61abdd`](/karmada-io/karmada/commit/b61abdd1a574b1b7aa6b7dad60c9c7724f043972)  [Compare](/karmada-io/karmada/compare/5c9e1db3e6e96c12aef324427bd041a92b36180d..b61abdd1a574b1b7aa6b7dad60c9c7724f043972)
[November 26, 2024 06:34](#event-15431022168)

[![@RainbowMango](https://avatars.githubusercontent.com/u/8268873?s=80&u=343e0b241bfb179405ad49ebb179555abf5ee505&v=4)](/RainbowMango)

Copy link

Member

### **[RainbowMango](/RainbowMango)** commented [Nov 27, 2024](#issuecomment-2503020001)

| Wait for [#5703](https://github.com/karmada-io/karmada/pull/5703) as the two PR will share common functions. |
| --- |

All reactions

Sorry, something went wrong.

[![@zhzhuang-zju](https://avatars.githubusercontent.com/u/81208264?s=40&v=4)](/zhzhuang-zju)

`[karmadactl init: add CRDs archive verification to enhance file system…](/karmada-io/karmada/pull/5713/commits/b7afcaf5a251477ee3879ae02b1cc3e022408cc8 "karmadactl init: add CRDs archive verification to enhance file system robustness

Signed-off-by: zhzhuang-zju <m17799853869@163.com>")`
 …

`[b7afcaf](/karmada-io/karmada/pull/5713/commits/b7afcaf5a251477ee3879ae02b1cc3e022408cc8)`

```
… robustness

Signed-off-by: zhzhuang-zju <m17799853869@163.com>
```

 [![@zhzhuang-zju](https://avatars.githubusercontent.com/u/81208264?s=40&u=60cc38ec532e3d5ac03ed411152d6552af110a35&v=4)](/zhzhuang-zju)
[zhzhuang-zju](/zhzhuang-zju)
[force-pushed](/karmada-io/karmada/compare/b61abdd1a574b1b7aa6b7dad60c9c7724f043972..b7afcaf5a251477ee3879ae02b1cc3e022408cc8)
the
ctl-crds

branch
from
[`b61abdd`](/karmada-io/karmada/commit/b61abdd1a574b1b7aa6b7dad60c9c7724f043972) to
[`b7afcaf`](/karmada-io/karmada/commit/b7afcaf5a251477ee3879ae02b1cc3e022408cc8)  [Compare](/karmada-io/karmada/compare/b61abdd1a574b1b7aa6b7dad60c9c7724f043972..b7afcaf5a251477ee3879ae02b1cc3e022408cc8)
[November 27, 2024 08:48](#event-15449120862)

[![@karmada-bot](https://avatars.githubusercontent.com/u/76678816?s=40&u=fcd90b8b6679eaa786ceb69dd03ec72e6f11dd09&v=4)](/karmada-bot)
[karmada-bot](/karmada-bot)
added
[size/M](/karmada-io/karmada/labels/size/M)
Denotes a PR that changes 30-99 lines, ignoring generated files.
and removed
[size/L](/karmada-io/karmada/labels/size/L)
Denotes a PR that changes 100-499 lines, ignoring generated files.
labels
[Nov 27, 2024](#event-15449124343)

[![@zhzhuang-zju](https://avatars.githubusercontent.com/u/81208264?s=80&u=60cc38ec532e3d5ac03ed411152d6552af110a35&v=4)](/zhzhuang-zju)

Copy link

Contributor

Author

### **[zhzhuang-zju](/zhzhuang-zju)** commented [Nov 27, 2024](#issuecomment-2503272516)

| Wait for [#5703](https://github.com/karmada-io/karmada/pull/5703) as the two PR will share common functions.  done~ |
| --- |

All reactions

Sorry, something went wrong.

[![RainbowMango](https://avatars.githubusercontent.com/u/8268873?s=60&v=4)](/RainbowMango)

**[RainbowMango](/RainbowMango)**
reviewed
[Nov 27, 2024](#pullrequestreview-2464407641)

 [View reviewed changes](/karmada-io/karmada/pull/5713/files/b7afcaf5a251477ee3879ae02b1cc3e022408cc8)

Copy link

Member

### @RainbowMango **[RainbowMango](/RainbowMango)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

/assign

Sorry, something went wrong.

All reactions

[![@karmada-bot](https://avatars.githubusercontent.com/u/76678816?s=40&u=fcd90b8b6679eaa786ceb69dd03ec72e6f11dd09&v=4)](/karmada-bot)
[karmada-bot](/karmada-bot)
assigned [RainbowMango](/RainbowMango)
[Nov 27, 2024](#event-15449471995)

[![RainbowMango](https://avatars.githubusercontent.com/u/8268873?s=60&v=4)](/RainbowMango)

**[RainbowMango](/RainbowMango)**
approved these changes
[Nov 27, 2024](#pullrequestreview-2464468016)

 [View reviewed changes](/karmada-io/karmada/pull/5713/files/b7afcaf5a251477ee3879ae02b1cc3e022408cc8)

Copy link

Member

### @RainbowMango **[RainbowMango](/RainbowMango)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

/lgtm

/approve

Sorry, something went wrong.

All reactions

[![@karmada-bot](https://avatars.githubusercontent.com/u/76678816?s=40&u=fcd90b8b6679eaa786ceb69dd03ec72e6f11dd09&v=4)](/karmada-bot)
[karmada-bot](/karmada-bot)
added
the
[lgtm](/karmada-io/karmada/labels/lgtm)
Indicates that a PR is ready to be merged.
label
[Nov 27, 2024](#event-15449770905)

[![@karmada-bot](https://avatars.githubusercontent.com/u/76678816?s=80&u=fcd90b8b6679eaa786ceb69dd03ec72e6f11dd09&v=4)](/karmada-bot)

Copy link

Collaborator

### **[karmada-bot](/karmada-bot)** commented [Nov 27, 2024](#issuecomment-2503380413)

| [APPROVALNOTIFIER] This PR is **APPROVED**  This pull-request has been approved by: *[RainbowMango](https://github.com/karmada-io/karmada/pull/5713#pullrequestreview-2464468016 "Approved")*  The full list of commands accepted by this bot can be found [here](https://go.k8s.io/bot-commands?repo=karmada-io%2Fkarmada).  The pull request process is described [here](https://git.k8s.io/community/contributors/guide/owners.md#the-code-review-process)  Needs approval from an approver in each of these files:  * ~~[pkg/karmadactl/cmdinit/OWNERS](https://github.com/karmada-io/karmada/blob/master/pkg/karmadactl/cmdinit/OWNERS)~~ [RainbowMango] * ~~[pkg/util/OWNERS](https://github.com/karmada-io/karmada/blob/master/pkg/util/OWNERS)~~ [RainbowMango]   Approvers can indicate their approval by writing `/approve` in a comment Approvers can cancel approval by writing `/approve cancel` in a comment |
| --- |

All reactions

Sorry, something went wrong.

[![@karmada-bot](https://avatars.githubusercontent.com/u/76678816?s=40&u=fcd90b8b6679eaa786ceb69dd03ec72e6f11dd09&v=4)](/karmada-bot)
[karmada-bot](/karmada-bot)
added
the
[approved](/karmada-io/karmada/labels/approved)
Indicates a PR has been approved by an approver from all required OWNERS files.
label
[Nov 27, 2024](#event-15449772649)

 Hide details
View details

[![@karmada-bot](https://avatars.githubusercontent.com/u/76678816?s=40&u=fcd90b8b6679eaa786ceb69dd03ec72e6f11dd09&v=4)](/karmada-bot)
[karmada-bot](/karmada-bot)
merged commit [`40ec488`](/karmada-io/karmada/commit/40ec488b18a461ab0f871d2c9ec8665b361f0d50)
into
karmada-io:master

[Nov 27, 2024](https://github.com/karmada-io/karmada/pull/5713#event-15449888901)
18 checks passed

[![@zhzhuang-zju](https://avatars.githubusercontent.com/u/81208264?s=40&u=60cc38ec532e3d5ac03ed411152d6552af110a35&v=4)](/zhzhuang-zju)
[zhzhuang-zju](/zhzhuang-zju)
mentioned this pull request
[Dec 28, 2024](#ref-pullrequest-2761664098)

[Add zhzhuang-zju to the security groups
karmada-io/community#94](/karmada-io/community/pull/94)
 Merged

This was referenced Jan 3, 2025

[x/vulndb: potential Go vuln in github.com/karmada-io/karmada: GHSA-cwrh-575j-8vr3
golang/vulndb#3363](/golang/vulndb/issues/3363)

Closed

[x/vulndb: potential Go vuln in github.com/karmada-io/karmada: CVE-2024-56514
golang/vulndb#3366](/golang/vulndb/issues/3366)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fkarmada-io%2Fkarmada%2Fpull%2F5713)

Reviewers

[![@RainbowMango](https://avatars.githubusercontent.com/u/8268873?s=40&v=4)](/RainbowMango) [RainbowMango](/RainbowMango)

RainbowMango approved these changes

[![@chaosi-zju](https://avatars.githubusercontent.com/u/30589999?s=40&v=4)](/chaosi-zju) [chaosi-zju](/chaosi-zju)

 Awaiting requested review from chaosi-zju

[![@prodanlabs](https://avatars.githubusercontent.com/u/28917392?s=40&v=4)](/prodanlabs) [prodanlabs](/prodanlabs)

 Awaiting requested review from prodanlabs

Assignees

[![@RainbowMango](https://avatars.githubusercontent.com/u/8268873?s=40&v=4)](/RainbowMango) [RainbowMango](/RainbowMango)

Labels

[approved](/karmada-io/karmada/labels/approved)
Indicates a PR has been approved by an approver from all required OWNERS files.
[kind/feature](/karmada-io/karmada/labels/kind/feature)
Categorizes issue or PR as related to a new feature.
[lgtm](/karmada-io/karmada/labels/lgtm)
Indicates that a PR is ready to be merged.
[size/M](/karmada-io/karmada/labels/size/M)
Denotes a PR that changes 30-99 lines, ignoring generated files.

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

4 participants

[![@zhzhuang-zju](https://avatars.githubusercontent.com/u/81208264?s=52&v=4)](/zhzhuang-zju) [![@codecov-commenter](https://avatars.githubusercontent.com/u/65553080?s=52&v=4)](/codecov-commenter) [![@RainbowMango](https://avatars.githubusercontent.com/u/8268873?s=52&v=4)](/RainbowMango) [![@karmada-bot](https://avatars.githubusercontent.com/u/76678816?s=52&v=4)](/karmada-bot)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_d417b34c_20250114_210209.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkarmada-io%2Fkarmada%2Fpull%2F5703)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkarmada-io%2Fkarmada%2Fpull%2F5703)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=karmada-io%2Fkarmada)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[karmada-io](/karmada-io)
/
**[karmada](/karmada-io/karmada)**
Public

* [Notifications](/login?return_to=%2Fkarmada-io%2Fkarmada) You must be signed in to change notification settings
* [Fork
  907](/login?return_to=%2Fkarmada-io%2Fkarmada)
* [Star
   4.6k](/login?return_to=%2Fkarmada-io%2Fkarmada)

* [Code](/karmada-io/karmada)
* [Issues
  411](/karmada-io/karmada/issues)
* [Pull requests
  190](/karmada-io/karmada/pulls)
* [Discussions](/karmada-io/karmada/discussions)
* [Actions](/karmada-io/karmada/actions)
* [Projects
  10](/karmada-io/karmada/projects)
* [Security](/karmada-io/karmada/security)
* [Insights](/karmada-io/karmada/pulse)

Additional navigation options

* [Code](/karmada-io/karmada)
* [Issues](/karmada-io/karmada/issues)
* [Pull requests](/karmada-io/karmada/pulls)
* [Discussions](/karmada-io/karmada/discussions)
* [Actions](/karmada-io/karmada/actions)
* [Projects](/karmada-io/karmada/projects)
* [Security](/karmada-io/karmada/security)
* [Insights](/karmada-io/karmada/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fkarmada-io%2Fkarmada%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fkarmada-io%2Fkarmada%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# karmada-operator: add CRDs archive verification to enhance file system robustness #5703

 Merged

[karmada-bot](/karmada-bot)
merged 1 commit into
[karmada-io:master](/karmada-io/karmada/tree/master "karmada-io/karmada:master")
from
[zhzhuang-zju:security](/zhzhuang-zju/karmada/tree/security "zhzhuang-zju/karmada:security")

Nov 27, 2024

 Merged

# [karmada-operator: add CRDs archive verification to enhance file system robustness](#top) #5703

[karmada-bot](/karmada-bot)
merged 1 commit into
[karmada-io:master](/karmada-io/karmada/tree/master "karmada-io/karmada:master")
from
[zhzhuang-zju:security](/zhzhuang-zju/karmada/tree/security "zhzhuang-zju/karmada:security")

Nov 27, 2024

[Conversation
8](/karmada-io/karmada/pull/5703)
[Commits
1](/karmada-io/karmada/pull/5703/commits)
[Checks
17](/karmada-io/karmada/pull/5703/checks)
[Files changed](/karmada-io/karmada/pull/5703/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![zhzhuang-zju](https://avatars.githubusercontent.com/u/81208264?s=60&v=4)](/zhzhuang-zju)

Copy link

Contributor

### @zhzhuang-zju **[zhzhuang-zju](/zhzhuang-zju)** commented [Oct 17, 2024](#issue-2593532318)

**What type of PR is this?**

/kind feature

**What this PR does / why we need it**:

`karmada-operator` provides a custom download path for CRDs files. Before processing the files, it's necessary to validate the CRDs archive to enhance system robustness.

* Check if its file name includes relative paths.
* check if the CRDs archive has the expected directory structure.

**Which issue(s) this PR fixes**:

Fixes #

**Special notes for your reviewer**:

`karamdactl init` has the same issue, and its enhancement is ongoing

**Does this PR introduce a user-facing change?**:

```

```

Sorry, something went wrong.

All reactions

[![@karmada-bot](https://avatars.githubusercontent.com/u/76678816?s=40&u=fcd90b8b6679eaa786ceb69dd03ec72e6f11dd09&v=4)](/karmada-bot)
[karmada-bot](/karmada-bot)
added
the
[kind/feature](/karmada-io/karmada/labels/kind/feature)
Categorizes issue or PR as related to a new feature.
label
[Oct 17, 2024](#event-14692343894)

 [![@karmada-bot](https://avatars.githubusercontent.com/u/76678816?s=40&u=fcd90b8b6679eaa786ceb69dd03ec72e6f11dd09&v=4)](/karmada-bot)
[karmada-bot](/karmada-bot)
requested review from
[calvin0327](/calvin0327) and
[chaosi-zju](/chaosi-zju)
[October 17, 2024 03:49](#event-14692344338)

[![@karmada-bot](https://avatars.githubusercontent.com/u/76678816?s=40&u=fcd90b8b6679eaa786ceb69dd03ec72e6f11dd09&v=4)](/karmada-bot)
[karmada-bot](/karmada-bot)
added
the
[size/M](/karmada-io/karmada/labels/size/M)
Denotes a PR that changes 30-99 lines, ignoring generated files.
label
[Oct 17, 2024](#event-14692345111)

 [![@zhzhuang-zju](https://avatars.githubusercontent.com/u/81208264?s=40&u=60cc38ec532e3d5ac03ed411152d6552af110a35&v=4)](/zhzhuang-zju)
[zhzhuang-zju](/zhzhuang-zju)
[force-pushed](/karmada-io/karmada/compare/9c403607becf89da3305325dd69e717622b44cec..6e3566ca02bfbcdabd2ec549455d94f43d16c432)
the
security

branch
from
[`9c40360`](/karmada-io/karmada/commit/9c403607becf89da3305325dd69e717622b44cec) to
[`6e3566c`](/karmada-io/karmada/commit/6e3566ca02bfbcdabd2ec549455d94f43d16c432)  [Compare](/karmada-io/karmada/compare/9c403607becf89da3305325dd69e717622b44cec..6e3566ca02bfbcdabd2ec549455d94f43d16c432)
[October 17, 2024 03:52](#event-14692357950)

[![@codecov-commenter](https://avatars.githubusercontent.com/u/65553080?s=80&u=b7ee84d82e25b493051d810390e97b15f716d7ef&v=4)](/codecov-commenter)

Copy link

### **[codecov-commenter](/codecov-commenter)** commented [Oct 17, 2024](#issuecomment-2418453560) • edited Loading

|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| ⚠️ Please install the ['codecov app svg image'](https://private-user-images.githubusercontent.com/152432831/340411587-e90313f4-9d3a-4b63-8b54-cfe14e7ec20d.svg?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY4ODg4MjcsIm5iZiI6MTczNjg4ODUyNywicGF0aCI6Ii8xNTI0MzI4MzEvMzQwNDExNTg3LWU5MDMxM2Y0LTlkM2EtNGI2My04YjU0LWNmZTE0ZTdlYzIwZC5zdmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjUwMTE0JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI1MDExNFQyMTAyMDdaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT1lY2E2MjA0NjljOWQ2MTgxMWI3NjE2MzkyYTA4OTUyNDM1YmQwYzcxN2ZhYTg1MjMzZGNlMjVkNjNiZmI3ZDE3JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.ZGpxDO27JT1A-C2BY6LVUC7Ppl4m6jt0pZAZBfnWZRM) to ensure uploads and comments are reliably processed by Codecov. [Codecov](https://app.codecov.io/gh/karmada-io/karmada/pull/5703?dropdown=coverage&src=pr&el=h1&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=karmada-io) Report Attention: Patch coverage is `38.27160%` with `50 lines` in your changes missing coverage. Please review.  Project coverage is 46.28%. Comparing base [(`ccdf485`)](https://app.codecov.io/gh/karmada-io/karmada/commit/ccdf485204ba245b5c6d369af2114156f387212e?dropdown=coverage&el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=karmada-io) to head [(`63590cb`)](https://app.codecov.io/gh/karmada-io/karmada/commit/63590cbeee3ef23d66799ffcee5b39d5a005115f?dropdown=coverage&el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=karmada-io). Report is 131 commits behind head on master.   | [Files with missing lines](https://app.codecov.io/gh/karmada-io/karmada/pull/5703?dropdown=coverage&src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=karmada-io) | Patch % | Lines | | --- | --- | --- | | [pkg/util/validation/validation.go](https://app.codecov.io/gh/karmada-io/karmada/pull/5703?src=pr&el=tree&filepath=pkg%2Futil%2Fvalidation%2Fvalidation.go&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=karmada-io#diff-cGtnL3V0aWwvdmFsaWRhdGlvbi92YWxpZGF0aW9uLmdv) | 54.38% | [26 Missing ⚠️](https://app.codecov.io/gh/karmada-io/karmada/pull/5703?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=karmada-io) | | [operator/pkg/tasks/init/crd.go](https://app.codecov.io/gh/karmada-io/karmada/pull/5703?src=pr&el=tree&filepath=operator%2Fpkg%2Ftasks%2Finit%2Fcrd.go&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=karmada-io#diff-b3BlcmF0b3IvcGtnL3Rhc2tzL2luaXQvY3JkLmdv) | 0.00% | [23 Missing and 1 partial ⚠️](https://app.codecov.io/gh/karmada-io/karmada/pull/5703?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=karmada-io) |   ❗ Your organization needs to install the [Codecov GitHub app](https://github.com/apps/codecov/installations/select_target) to enable full functionality. Additional details and impacted files ``` @@            Coverage Diff             @@ ##           master    #5703      +/-   ## ========================================== + Coverage   46.21%   46.28%   +0.07%      ==========================================   Files         663      663                 Lines       54592    54686      +94      ========================================== + Hits        25230    25314      +84      - Misses      27735    27745      +10        Partials     1627     1627               ```  | [Flag](https://app.codecov.io/gh/karmada-io/karmada/pull/5703/flags?src=pr&el=flags&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=karmada-io) | Coverage Δ |  | | --- | --- | --- | | [unittests](https://app.codecov.io/gh/karmada-io/karmada/pull/5703/flags?src=pr&el=flag&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=karmada-io) | `46.28% <38.27%> (+0.07%)` | ⬆️ |   Flags with carried forward coverage won't be shown. [Click here](https://docs.codecov.io/docs/carryforward-flags?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=karmada-io#carryforward-flags-in-the-pull-request-comment) to find out more.  [☔ View full report in Codecov by Sentry](https://app.codecov.io/gh/karmada-io/karmada/pull/5703?dropdown=coverage&src=pr&el=continue&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=karmada-io). 📢 Have feedback on the report? [Share it here](https://about.codecov.io/codecov-pr-comment-feedback/?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=karmada-io). |

All reactions

Sorry, something went wrong.

 [![@zhzhuang-zju](https://avatars.githubusercontent.com/u/81208264?s=40&u=60cc38ec532e3d5ac03ed411152d6552af110a35&v=4)](/zhzhuang-zju)
[zhzhuang-zju](/zhzhuang-zju)
[force-pushed](/karmada-io/karmada/compare/bc24da3c9bef8b66e77f5e2c6d6c73da68356eaf..61c1f128c698473b88307444346c3ccc01becd13)
the
security

branch
2 times, most recently
from
[`bc24da3`](/karmada-io/karmada/commit/bc24da3c9bef8b66e77f5e2c6d6c73da68356eaf) to
[`61c1f12`](/karmada-io/karmada/commit/61c1f128c698473b88307444346c3ccc01becd13)  [Compare](/karmada-io/karmada/compare/bc24da3c9bef8b66e77f5e2c6d6c73da68356eaf..61c1f128c698473b88307444346c3ccc01becd13)
[October 18, 2024 10:04](#event-14716914915)

[![@karmada-bot](https://avatars.githubusercontent.com/u/76678816?s=40&u=fcd90b8b6679eaa786ceb69dd03ec72e6f11dd09&v=4)](/karmada-bot)
[karmada-bot](/karmada-bot)
added
[size/L](/karmada-io/karmada/labels/size/L)
Denotes a PR that changes 100-499 lines, ignoring generated files.
and removed
[size/M](/karmada-io/karmada/labels/size/M)
Denotes a PR that changes 30-99 lines, ignoring generated files.
labels
[Oct 18, 2024](#event-14716919731)

 [![@zhzhuang-zju](https://avatars.githubusercontent.com/u/81208264?s=40&u=60cc38ec532e3d5ac03ed411152d6552af110a35&v=4)](/zhzhuang-zju)
[zhzhuang-zju](/zhzhuang-zju)
[force-pushed](/karmada-io/karmada/compare/c178c66c3a98f0261af56c216fcd2639f430877e..a809285b7b6c8558aac4c04827aa044cc5ed5ee7)
the
security

branch
2 times, most recently
from
[`c178c66`](/karmada-io/karmada/commit/c178c66c3a98f0261af56c216fcd2639f430877e) to
[`a809285`](/karmada-io/karmada/commit/a809285b7b6c8558aac4c04827aa044cc5ed5ee7)  [Compare](/karmada-io/karmada/compare/c178c66c3a98f0261af56c216fcd2639f430877e..a809285b7b6c8558aac4c04827aa044cc5ed5ee7)
[October 19, 2024 06:54](#event-14729508090)

[![@zhzhuang-zju](https://avatars.githubusercontent.com/u/81208264?s=40&u=60cc38ec532e3d5ac03ed411152d6552af110a35&v=4)](/zhzhuang-zju)
[zhzhuang-zju](/zhzhuang-zju)
changed the title
~~add CRDs archive verification to enhance file system robustness~~
karmada-operator: add CRDs archive verification to enhance file system robustness
[Oct 24, 2024](#event-14843977678)

 [![@zhzhuang-zju](https://avatars.githubusercontent.com/u/81208264?s=40&u=60cc38ec532e3d5ac03ed411152d6552af110a35&v=4)](/zhzhuang-zju)
[zhzhuang-zju](/zhzhuang-zju)
[force-pushed](/karmada-io/karmada/compare/a809285b7b6c8558aac4c04827aa044cc5ed5ee7..be0716bb7e9d91f51bccc34d33a375718f674a92)
the
security

branch
from
[`a809285`](/karmada-io/karmada/commit/a809285b7b6c8558aac4c04827aa044cc5ed5ee7) to
[`be0716b`](/karmada-io/karmada/commit/be0716bb7e9d91f51bccc34d33a375718f674a92)  [Compare](/karmada-io/karmada/compare/a809285b7b6c8558aac4c04827aa044cc5ed5ee7..be0716bb7e9d91f51bccc34d33a375718f674a92)
[November 26, 2024 03:39](#event-15429738589)

[![@zhzhuang-zju](https://avatars.githubusercontent.com/u/81208264?s=80&u=60cc38ec532e3d5ac03ed411152d6552af110a35&v=4)](/zhzhuang-zju)

Copy link

Contributor

Author

### **[zhzhuang-zju](/zhzhuang-zju)** commented [Nov 26, 2024](#issuecomment-2499593086)

| cc [@RainbowMango](https://github.com/RainbowMango) |
| --- |

All reactions

Sorry, something went wrong.

[![RainbowMango](https://avatars.githubusercontent.com/u/8268873?s=60&v=4)](/RainbowMango)

**[RainbowMango](/RainbowMango)**
reviewed
[Nov 27, 2024](#pullrequestreview-2463999715)

 [View reviewed changes](/karmada-io/karmada/pull/5703/files)

Copy link

Member

### @RainbowMango **[RainbowMango](/RainbowMango)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Just a nit, otherwise LGTM.

Sorry, something went wrong.

All reactions

[operator/pkg/util/util.go](/karmada-io/karmada/pull/5703/files#diff-446877996a68977ebbe7a266d28d871ec7ed605a890373f9648a082813055db4)
Outdated

Show resolved

Hide resolved

[![RainbowMango](https://avatars.githubusercontent.com/u/8268873?s=60&v=4)](/RainbowMango)

**[RainbowMango](/RainbowMango)**
reviewed
[Nov 27, 2024](#pullrequestreview-2464005096)

 [View reviewed changes](/karmada-io/karmada/pull/5703/files)

[operator/pkg/tasks/init/crd.go](/karmada-io/karmada/pull/5703/files#diff-aea40ece69fce8fd5385c56e5183345d8ef8955c34603fab3d2d9af8ae1d3a94)
Outdated

Show resolved

Hide resolved

[![@RainbowMango](https://avatars.githubusercontent.com/u/8268873?s=40&u=343e0b241bfb179405ad49ebb179555abf5ee505&v=4)](/RainbowMango)
[RainbowMango](/RainbowMango)
mentioned this pull request
[Nov 27, 2024](#ref-pullrequest-2598809590)

[karmadactl init: add CRDs archive verification to enhance file system robustness
#5713](/karmada-io/karmada/pull/5713)
 Merged

 [![@zhzhuang-zju](https://avatars.githubusercontent.com/u/81208264?s=40&u=60cc38ec532e3d5ac03ed411152d6552af110a35&v=4)](/zhzhuang-zju)
[zhzhuang-zju](/zhzhuang-zju)
[force-pushed](/karmada-io/karmada/compare/be0716bb7e9d91f51bccc34d33a375718f674a92..ff72f332c30f3cea1c49b1c6c3ad19e28fbbcdfa)
the
security

branch
from
[`be0716b`](/karmada-io/karmada/commit/be0716bb7e9d91f51bccc34d33a375718f674a92) to
[`ff72f33`](/karmada-io/karmada/commit/ff72f332c30f3cea1c49b1c6c3ad19e28fbbcdfa)  [Compare](/karmada-io/karmada/compare/be0716bb7e9d91f51bccc34d33a375718f674a92..ff72f332c30f3cea1c49b1c6c3ad19e28fbbcdfa)
[November 27, 2024 06:56](#event-15447828952)

[![@zhzhuang-zju](https://avatars.githubusercontent.com/u/81208264?s=40&v=4)](/zhzhuang-zju)

`[karmada-operator: add CRDs archive verification to enhance file syste…](/karmada-io/karmada/pull/5703/commits/63590cbeee3ef23d66799ffcee5b39d5a005115f "karmada-operator: add CRDs archive verification to enhance file system robustness

Signed-off-by: zhzhuang-zju <m17799853869@163.com>")`
 …

`[63590cb](/karmada-io/karmada/pull/5703/commits/63590cbeee3ef23d66799ffcee5b39d5a005115f)`

```
…m robustness

Signed-off-by: zhzhuang-zju <m17799853869@163.com>
```

 [![@zhzhuang-zju](https://avatars.githubusercontent.com/u/81208264?s=40&u=60cc38ec532e3d5ac03ed411152d6552af110a35&v=4)](/zhzhuang-zju)
[zhzhuang-zju](/zhzhuang-zju)
[force-pushed](/karmada-io/karmada/compare/ff72f332c30f3cea1c49b1c6c3ad19e28fbbcdfa..63590cbeee3ef23d66799ffcee5b39d5a005115f)
the
security

branch
from
[`ff72f33`](/karmada-io/karmada/commit/ff72f332c30f3cea1c49b1c6c3ad19e28fbbcdfa) to
[`63590cb`](/karmada-io/karmada/commit/63590cbeee3ef23d66799ffcee5b39d5a005115f)  [Compare](/karmada-io/karmada/compare/ff72f332c30f3cea1c49b1c6c3ad19e28fbbcdfa..63590cbeee3ef23d66799ffcee5b39d5a005115f)
[November 27, 2024 07:08](#event-15447928558)

[![RainbowMango](https://avatars.githubusercontent.com/u/8268873?s=60&v=4)](/RainbowMango)

**[RainbowMango](/RainbowMango)**
approved these changes
[Nov 27, 2024](#pullrequestreview-2464282894)

 [View reviewed changes](/karmada-io/karmada/pull/5703/files/63590cbeee3ef23d66799ffcee5b39d5a005115f)

Copy link

Member

### @RainbowMango **[RainbowMango](/RainbowMango)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

/lgtm

/approve

Sorry, something went wrong.

All reactions

[![@karmada-bot](https://avatars.githubusercontent.com/u/76678816?s=40&u=fcd90b8b6679eaa786ceb69dd03ec72e6f11dd09&v=4)](/karmada-bot)
[karmada-bot](/karmada-bot)
assigned [RainbowMango](/RainbowMango)
[Nov 27, 2024](#event-15448872091)

[![@karmada-bot](https://avatars.githubusercontent.com/u/76678816?s=40&u=fcd90b8b6679eaa786ceb69dd03ec72e6f11dd09&v=4)](/karmada-bot)
[karmada-bot](/karmada-bot)
added
the
[lgtm](/karmada-io/karmada/labels/lgtm)
Indicates that a PR is ready to be merged.
label
[Nov 27, 2024](#event-15448872346)

[![@karmada-bot](https://avatars.githubusercontent.com/u/76678816?s=80&u=fcd90b8b6679eaa786ceb69dd03ec72e6f11dd09&v=4)](/karmada-bot)

Copy link

Collaborator

### **[karmada-bot](/karmada-bot)** commented [Nov 27, 2024](#issuecomment-2503229535)

| [APPROVALNOTIFIER] This PR is **APPROVED**  This pull-request has been approved by: *[RainbowMango](https://github.com/karmada-io/karmada/pull/5703#pullrequestreview-2464282894 "Approved")*  The full list of commands accepted by this bot can be found [here](https://go.k8s.io/bot-commands?repo=karmada-io%2Fkarmada).  The pull request process is described [here](https://git.k8s.io/community/contributors/guide/owners.md#the-code-review-process)  Needs approval from an approver in each of these files:  * ~~[operator/OWNERS](https://github.com/karmada-io/karmada/blob/master/operator/OWNERS)~~ [RainbowMango] * ~~[pkg/util/OWNERS](https://github.com/karmada-io/karmada/blob/master/pkg/util/OWNERS)~~ [RainbowMango]   Approvers can indicate their approval by writing `/approve` in a comment Approvers can cancel approval by writing `/approve cancel` in a comment |
| --- |

All reactions

Sorry, something went wrong.

[![@karmada-bot](https://avatars.githubusercontent.com/u/76678816?s=40&u=fcd90b8b6679eaa786ceb69dd03ec72e6f11dd09&v=4)](/karmada-bot)
[karmada-bot](/karmada-bot)
added
the
[approved](/karmada-io/karmada/labels/approved)
Indicates a PR has been approved by an approver from all required OWNERS files.
label
[Nov 27, 2024](#event-15448873623)

 Hide details
View details

[![@karmada-bot](https://avatars.githubusercontent.com/u/76678816?s=40&u=fcd90b8b6679eaa786ceb69dd03ec72e6f11dd09&v=4)](/karmada-bot)
[karmada-bot](/karmada-bot)
merged commit [`f78e7e2`](/karmada-io/karmada/commit/f78e7e2a3d02bed04e9bc7abd3ae7b3ac56862d2)
into
karmada-io:master

[Nov 27, 2024](https://github.com/karmada-io/karmada/pull/5703#event-15448875340)
18 checks passed

[![@zhzhuang-zju](https://avatars.githubusercontent.com/u/81208264?s=40&u=60cc38ec532e3d5ac03ed411152d6552af110a35&v=4)](/zhzhuang-zju)
[zhzhuang-zju](/zhzhuang-zju)
mentioned this pull request
[Dec 28, 2024](#ref-pullrequest-2761664098)

[Add zhzhuang-zju to the security groups
karmada-io/community#94](/karmada-io/community/pull/94)
 Merged

This was referenced Jan 3, 2025

[x/vulndb: potential Go vuln in github.com/karmada-io/karmada: GHSA-cwrh-575j-8vr3
golang/vulndb#3363](/golang/vulndb/issues/3363)

Closed

[x/vulndb: potential Go vuln in github.com/karmada-io/karmada: CVE-2024-56514
golang/vulndb#3366](/golang/vulndb/issues/3366)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fkarmada-io%2Fkarmada%2Fpull%2F5703)

Reviewers

[![@RainbowMango](https://avatars.githubusercontent.com/u/8268873?s=40&v=4)](/RainbowMango) [RainbowMango](/RainbowMango)

RainbowMango approved these changes

[![@calvin0327](https://avatars.githubusercontent.com/u/45745657?s=40&v=4)](/calvin0327) [calvin0327](/calvin0327)

 Awaiting requested review from calvin0327

[![@chaosi-zju](https://avatars.githubusercontent.com/u/30589999?s=40&v=4)](/chaosi-zju) [chaosi-zju](/chaosi-zju)

 Awaiting requested review from chaosi-zju

Assignees

[![@RainbowMango](https://avatars.githubusercontent.com/u/8268873?s=40&v=4)](/RainbowMango) [RainbowMango](/RainbowMango)

Labels

[approved](/karmada-io/karmada/labels/approved)
Indicates a PR has been approved by an approver from all required OWNERS files.
[kind/feature](/karmada-io/karmada/labels/kind/feature)
Categorizes issue or PR as related to a new feature.
[lgtm](/karmada-io/karmada/labels/lgtm)
Indicates that a PR is ready to be merged.
[size/L](/karmada-io/karmada/labels/size/L)
Denotes a PR that changes 100-499 lines, ignoring generated files.

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

4 participants

[![@zhzhuang-zju](https://avatars.githubusercontent.com/u/81208264?s=52&v=4)](/zhzhuang-zju) [![@codecov-commenter](https://avatars.githubusercontent.com/u/65553080?s=52&v=4)](/codecov-commenter) [![@karmada-bot](https://avatars.githubusercontent.com/u/76678816?s=52&v=4)](/karmada-bot) [![@RainbowMango](https://avatars.githubusercontent.com/u/8268873?s=52&v=4)](/RainbowMango)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_8ee9768b_20250114_210213.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkarmada-io%2Fkarmada%2Fsecurity%2Fadvisories%2FGHSA-cwrh-575j-8vr3)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkarmada-io%2Fkarmada%2Fsecurity%2Fadvisories%2FGHSA-cwrh-575j-8vr3)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=karmada-io%2Fkarmada)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[karmada-io](/karmada-io)
/
**[karmada](/karmada-io/karmada)**
Public

* [Notifications](/login?return_to=%2Fkarmada-io%2Fkarmada) You must be signed in to change notification settings
* [Fork
  907](/login?return_to=%2Fkarmada-io%2Fkarmada)
* [Star
   4.6k](/login?return_to=%2Fkarmada-io%2Fkarmada)

* [Code](/karmada-io/karmada)
* [Issues
  411](/karmada-io/karmada/issues)
* [Pull requests
  190](/karmada-io/karmada/pulls)
* [Discussions](/karmada-io/karmada/discussions)
* [Actions](/karmada-io/karmada/actions)
* [Projects
  10](/karmada-io/karmada/projects)
* [Security](/karmada-io/karmada/security)
* [Insights](/karmada-io/karmada/pulse)

Additional navigation options

* [Code](/karmada-io/karmada)
* [Issues](/karmada-io/karmada/issues)
* [Pull requests](/karmada-io/karmada/pulls)
* [Discussions](/karmada-io/karmada/discussions)
* [Actions](/karmada-io/karmada/actions)
* [Projects](/karmada-io/karmada/projects)
* [Security](/karmada-io/karmada/security)
* [Insights](/karmada-io/karmada/pulse)

# Tar Slips in CRDs archive extraction

Moderate

[RainbowMango](/RainbowMango)
published
GHSA-cwrh-575j-8vr3
Jan 3, 2025

## Package

gomod

karmada-operator
([Go](/advisories?query=ecosystem%3Ago))

## Affected versions

>= 1.11.0, < 1.12.0

## Patched versions

1.12.0

gomod

karmadactl
([Go](/advisories?query=ecosystem%3Ago))

< 1.12.0

1.12.0

## Description

### Impact

*What kind of vulnerability is it? Who is impacted?*

Both in karmadactl and karmada-operator, it is possible to supply a filesystem path, or an HTTP(s) URL to retrieve the custom resource definitions(CRDs) needed by karmada. The CRDs are downloaded as a gzipped tarfile and are vulnerable to a TarSlip vulnerability. An attacker able to supply a malicious CRD file into a karmada initialization could write arbitrary files in arbitrary paths of the filesystem.

### Patches

*Has the problem been patched? What versions should users upgrade to?*

From karmada version v1.12.0, when processing custom CRDs files, CRDs archive verification is utilized to enhance file system robustness.

### Workarounds

*Is there a way for users to fix or remediate the vulnerability without upgrading?*

When using `karmadactl init` to set up Karmada, if you need to set flag `--crd` to customize the CRD files required for karmada initialization, you can manually inspect the CRD files to check whether they contain sequences such as `../` that would alter file paths, to determine if they potentially include malicious files.

When using karmada-operator to set up Karmada, you must upgrade your karmada-operator to one of the fixed versions.

### References

*Are there any links users can visit to find out more?*

1. Enhancements made from the Karmada community: [#5713](https://github.com/karmada-io/karmada/pull/5713), [#5703](https://github.com/karmada-io/karmada/pull/5703)

### Severity

Moderate

### CVE ID

CVE-2024-56514

### Weaknesses

No CWEs

### Credits

* [![@zhzhuang-zju](https://avatars.githubusercontent.com/u/81208264?s=40&v=4)](/zhzhuang-zju)
  [zhzhuang-zju](/zhzhuang-zju)
  Remediation developer
* [![@RainbowMango](https://avatars.githubusercontent.com/u/8268873?s=40&v=4)](/RainbowMango)
  [RainbowMango](/RainbowMango)
  Remediation reviewer
* [![@TheZ3ro](https://avatars.githubusercontent.com/u/686894?s=40&v=4)](/TheZ3ro)
  [TheZ3ro](/TheZ3ro)
  Remediation verifier
* [![@suidpit](https://avatars.githubusercontent.com/u/25264901?s=40&v=4)](/suidpit)
  [suidpit](/suidpit)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


