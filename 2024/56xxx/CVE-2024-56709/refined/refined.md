The provided content relates to CVE-2024-56709.

**Root cause of vulnerability:**
The vulnerability arises from a race condition in the io_uring subsystem. Specifically, task work related to io_uring requests can be executed after the task has been terminated. This termination process can nullify the `->io_wq` pointer, leading to a null pointer dereference when `io_queue_iowq()` attempts to forward the request. This occurs because task work can execute in a deferred context (task_work or a fallback path).

**Weaknesses/vulnerabilities present:**
- **Race Condition:**  A race exists between the termination of a task associated with an io_uring context and the execution of deferred task work that may reference the io_uring's workqueue.
- **Null Pointer Dereference:** If the `->io_wq` pointer is null due to task termination, a null pointer dereference occurs in `io_queue_iowq()`.

**Impact of exploitation:**
The primary impact is a kernel crash due to the null pointer dereference, resulting in a denial-of-service.

**Attack vectors:**
An attacker could trigger this vulnerability by:
1. Closing a DEFER_TASKRUN io_uring ring.
2. Immediately killing the associated task.
3. This leads to task work being executed when the io_uring's workqueue is already nullified.

**Required attacker capabilities/position:**
The attacker needs the capability to create and interact with io_uring rings and control task termination. This typically requires local access.
The attacker does not need a privileged account.

**Additional Notes:**

- The fix introduces a check in `io_queue_iowq()` to determine if the io_uring workqueue (`tctx->io_wq`) is valid, preventing the null pointer dereference. It also checks if the current context is a kernel thread `(current->flags & PF_KTHREAD)` because the user can first close the io_uring ring and then kill the task.
- The fix includes a call to `io_req_task_queue_fail(req, -ECANCELED)` which fails the requests that would have resulted in a crash due to the race condition.
- The fix was backported to multiple stable branches of the Linux kernel.