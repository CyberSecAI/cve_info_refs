=== Content from git.kernel.org_b0597a17_20250114_184341.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3c818ad07e964bca3d27adac1e1f50e1e3c9180e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3c818ad07e964bca3d27adac1e1f50e1e3c9180e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3c818ad07e964bca3d27adac1e1f50e1e3c9180e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3c818ad07e964bca3d27adac1e1f50e1e3c9180e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Qiu-ji Chen <chenqiuji666@gmail.com> | 2024-09-27 16:39:02 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:44:38 +0100 |
| commit | [3c818ad07e964bca3d27adac1e1f50e1e3c9180e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3c818ad07e964bca3d27adac1e1f50e1e3c9180e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3c818ad07e964bca3d27adac1e1f50e1e3c9180e)) | |
| tree | [ac6dfe5623844882b8f8ad5d19e7e673262f2056](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3c818ad07e964bca3d27adac1e1f50e1e3c9180e) | |
| parent | [c8e5e170d97ab10cf4dd1dfee9172a3856c3519b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c8e5e170d97ab10cf4dd1dfee9172a3856c3519b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3c818ad07e964bca3d27adac1e1f50e1e3c9180e&id2=c8e5e170d97ab10cf4dd1dfee9172a3856c3519b)) | |
| download | [linux-3c818ad07e964bca3d27adac1e1f50e1e3c9180e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3c818ad07e964bca3d27adac1e1f50e1e3c9180e.tar.gz) | |

media: wl128x: Fix atomicity violation in fmc\_send\_cmd()commit ca59f9956d4519ab18ab2270be47c6b8c6ced091 upstream.
Atomicity violation occurs when the fmc\_send\_cmd() function is executed
simultaneously with the modification of the fmdev->resp\_skb value.
Consider a scenario where, after passing the validity check within the
function, a non-null fmdev->resp\_skb variable is assigned a null value.
This results in an invalid fmdev->resp\_skb variable passing the validity
check. As seen in the later part of the function, skb = fmdev->resp\_skb;
when the invalid fmdev->resp\_skb passes the check, a null pointer
dereference error may occur at line 478, evt\_hdr = (void \*)skb->data;
To address this issue, it is recommended to include the validity check of
fmdev->resp\_skb within the locked section of the function. This
modification ensures that the value of fmdev->resp\_skb does not change
during the validation process, thereby maintaining its validity.
This possible bug is found by an experimental static analysis tool
developed by our team. This tool analyzes the locking APIs
to extract function pairs that can be concurrently executed, and then
analyzes the instructions in the paired functions to identify possible
concurrency bugs including data races and atomicity violations.
Fixes: e8454ff7b9a4 ("[media] drivers:media:radio: wl128x: FM Driver Common sources")
Cc: stable@vger.kernel.org
Signed-off-by: Qiu-ji Chen <chenqiuji666@gmail.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3c818ad07e964bca3d27adac1e1f50e1e3c9180e)

| -rw-r--r-- | [drivers/media/radio/wl128x/fmdrv\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/radio/wl128x/fmdrv_common.c?id=3c818ad07e964bca3d27adac1e1f50e1e3c9180e) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/media/radio/wl128x/fmdrv\_common.c b/drivers/media/radio/wl128x/fmdrv\_common.cindex cce97c9d54090e..f3ea60073865d1 100644--- a/[drivers/media/radio/wl128x/fmdrv\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/radio/wl128x/fmdrv_common.c?id=c8e5e170d97ab10cf4dd1dfee9172a3856c3519b)+++ b/[drivers/media/radio/wl128x/fmdrv\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/radio/wl128x/fmdrv_common.c?id=3c818ad07e964bca3d27adac1e1f50e1e3c9180e)@@ -463,11 +463,12 @@ int fmc\_send\_cmd(struct fmdev \*fmdev, u8 fm\_op, u16 type, void \*payload, jiffies\_to\_msecs(FM\_DRV\_TX\_TIMEOUT) / 1000); return -ETIMEDOUT; }+ spin\_lock\_irqsave(&fmdev->resp\_skb\_lock, flags); if (!fmdev->resp\_skb) {+ spin\_unlock\_irqrestore(&fmdev->resp\_skb\_lock, flags); fmerr("Response SKB is missing\n"); return -EFAULT; }- spin\_lock\_irqsave(&fmdev->resp\_skb\_lock, flags); skb = fmdev->resp\_skb; fmdev->resp\_skb = NULL; spin\_unlock\_irqrestore(&fmdev->resp\_skb\_lock, flags); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:42:18 +0000



=== Content from git.kernel.org_77d4679f_20250114_184340.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=372dc9509122e5d45d4c12978e31c3c7d00aaca4)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=372dc9509122e5d45d4c12978e31c3c7d00aaca4)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=372dc9509122e5d45d4c12978e31c3c7d00aaca4)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=372dc9509122e5d45d4c12978e31c3c7d00aaca4)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Qiu-ji Chen <chenqiuji666@gmail.com> | 2024-09-27 16:39:02 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:54:04 +0100 |
| commit | [372dc9509122e5d45d4c12978e31c3c7d00aaca4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=372dc9509122e5d45d4c12978e31c3c7d00aaca4) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=372dc9509122e5d45d4c12978e31c3c7d00aaca4)) | |
| tree | [cbb8a7a0879eb05a64e3b36bb5e42930bfa90910](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=372dc9509122e5d45d4c12978e31c3c7d00aaca4) | |
| parent | [18023f0992ee72315f5def29013bbb8f85232c05](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=18023f0992ee72315f5def29013bbb8f85232c05) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=372dc9509122e5d45d4c12978e31c3c7d00aaca4&id2=18023f0992ee72315f5def29013bbb8f85232c05)) | |
| download | [linux-372dc9509122e5d45d4c12978e31c3c7d00aaca4.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-372dc9509122e5d45d4c12978e31c3c7d00aaca4.tar.gz) | |

media: wl128x: Fix atomicity violation in fmc\_send\_cmd()commit ca59f9956d4519ab18ab2270be47c6b8c6ced091 upstream.
Atomicity violation occurs when the fmc\_send\_cmd() function is executed
simultaneously with the modification of the fmdev->resp\_skb value.
Consider a scenario where, after passing the validity check within the
function, a non-null fmdev->resp\_skb variable is assigned a null value.
This results in an invalid fmdev->resp\_skb variable passing the validity
check. As seen in the later part of the function, skb = fmdev->resp\_skb;
when the invalid fmdev->resp\_skb passes the check, a null pointer
dereference error may occur at line 478, evt\_hdr = (void \*)skb->data;
To address this issue, it is recommended to include the validity check of
fmdev->resp\_skb within the locked section of the function. This
modification ensures that the value of fmdev->resp\_skb does not change
during the validation process, thereby maintaining its validity.
This possible bug is found by an experimental static analysis tool
developed by our team. This tool analyzes the locking APIs
to extract function pairs that can be concurrently executed, and then
analyzes the instructions in the paired functions to identify possible
concurrency bugs including data races and atomicity violations.
Fixes: e8454ff7b9a4 ("[media] drivers:media:radio: wl128x: FM Driver Common sources")
Cc: stable@vger.kernel.org
Signed-off-by: Qiu-ji Chen <chenqiuji666@gmail.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=372dc9509122e5d45d4c12978e31c3c7d00aaca4)

| -rw-r--r-- | [drivers/media/radio/wl128x/fmdrv\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/radio/wl128x/fmdrv_common.c?id=372dc9509122e5d45d4c12978e31c3c7d00aaca4) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/media/radio/wl128x/fmdrv\_common.c b/drivers/media/radio/wl128x/fmdrv\_common.cindex 8a316de70e6c36..df26dbf914e812 100644--- a/[drivers/media/radio/wl128x/fmdrv\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/radio/wl128x/fmdrv_common.c?id=18023f0992ee72315f5def29013bbb8f85232c05)+++ b/[drivers/media/radio/wl128x/fmdrv\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/radio/wl128x/fmdrv_common.c?id=372dc9509122e5d45d4c12978e31c3c7d00aaca4)@@ -466,11 +466,12 @@ int fmc\_send\_cmd(struct fmdev \*fmdev, u8 fm\_op, u16 type, void \*payload, jiffies\_to\_msecs(FM\_DRV\_TX\_TIMEOUT) / 1000); return -ETIMEDOUT; }+ spin\_lock\_irqsave(&fmdev->resp\_skb\_lock, flags); if (!fmdev->resp\_skb) {+ spin\_unlock\_irqrestore(&fmdev->resp\_skb\_lock, flags); fmerr("Response SKB is missing\n"); return -EFAULT; }- spin\_lock\_irqsave(&fmdev->resp\_skb\_lock, flags); skb = fmdev->resp\_skb; fmdev->resp\_skb = NULL; spin\_unlock\_irqrestore(&fmdev->resp\_skb\_lock, flags); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:42:17 +0000



=== Content from git.kernel.org_d158ac6f_20250114_184344.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ed228b74d8a500380150965d5becabf9a1e33141)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ed228b74d8a500380150965d5becabf9a1e33141)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ed228b74d8a500380150965d5becabf9a1e33141)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ed228b74d8a500380150965d5becabf9a1e33141)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Qiu-ji Chen <chenqiuji666@gmail.com> | 2024-09-27 16:39:02 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:51:17 +0100 |
| commit | [ed228b74d8a500380150965d5becabf9a1e33141](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ed228b74d8a500380150965d5becabf9a1e33141) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ed228b74d8a500380150965d5becabf9a1e33141)) | |
| tree | [aa54d44242dfbb184434d0ca836245d2ccee97a5](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ed228b74d8a500380150965d5becabf9a1e33141) | |
| parent | [20082e2e8b798395f96e7e1d77405d1012e1d150](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=20082e2e8b798395f96e7e1d77405d1012e1d150) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ed228b74d8a500380150965d5becabf9a1e33141&id2=20082e2e8b798395f96e7e1d77405d1012e1d150)) | |
| download | [linux-ed228b74d8a500380150965d5becabf9a1e33141.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ed228b74d8a500380150965d5becabf9a1e33141.tar.gz) | |

media: wl128x: Fix atomicity violation in fmc\_send\_cmd()commit ca59f9956d4519ab18ab2270be47c6b8c6ced091 upstream.
Atomicity violation occurs when the fmc\_send\_cmd() function is executed
simultaneously with the modification of the fmdev->resp\_skb value.
Consider a scenario where, after passing the validity check within the
function, a non-null fmdev->resp\_skb variable is assigned a null value.
This results in an invalid fmdev->resp\_skb variable passing the validity
check. As seen in the later part of the function, skb = fmdev->resp\_skb;
when the invalid fmdev->resp\_skb passes the check, a null pointer
dereference error may occur at line 478, evt\_hdr = (void \*)skb->data;
To address this issue, it is recommended to include the validity check of
fmdev->resp\_skb within the locked section of the function. This
modification ensures that the value of fmdev->resp\_skb does not change
during the validation process, thereby maintaining its validity.
This possible bug is found by an experimental static analysis tool
developed by our team. This tool analyzes the locking APIs
to extract function pairs that can be concurrently executed, and then
analyzes the instructions in the paired functions to identify possible
concurrency bugs including data races and atomicity violations.
Fixes: e8454ff7b9a4 ("[media] drivers:media:radio: wl128x: FM Driver Common sources")
Cc: stable@vger.kernel.org
Signed-off-by: Qiu-ji Chen <chenqiuji666@gmail.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ed228b74d8a500380150965d5becabf9a1e33141)

| -rw-r--r-- | [drivers/media/radio/wl128x/fmdrv\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/radio/wl128x/fmdrv_common.c?id=ed228b74d8a500380150965d5becabf9a1e33141) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/media/radio/wl128x/fmdrv\_common.c b/drivers/media/radio/wl128x/fmdrv\_common.cindex 6142484d5cb4ef..d9287a935a9ef2 100644--- a/[drivers/media/radio/wl128x/fmdrv\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/radio/wl128x/fmdrv_common.c?id=20082e2e8b798395f96e7e1d77405d1012e1d150)+++ b/[drivers/media/radio/wl128x/fmdrv\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/radio/wl128x/fmdrv_common.c?id=ed228b74d8a500380150965d5becabf9a1e33141)@@ -465,11 +465,12 @@ int fmc\_send\_cmd(struct fmdev \*fmdev, u8 fm\_op, u16 type, void \*payload, jiffies\_to\_msecs(FM\_DRV\_TX\_TIMEOUT) / 1000); return -ETIMEDOUT; }+ spin\_lock\_irqsave(&fmdev->resp\_skb\_lock, flags); if (!fmdev->resp\_skb) {+ spin\_unlock\_irqrestore(&fmdev->resp\_skb\_lock, flags); fmerr("Response SKB is missing\n"); return -EFAULT; }- spin\_lock\_irqsave(&fmdev->resp\_skb\_lock, flags); skb = fmdev->resp\_skb; fmdev->resp\_skb = NULL; spin\_unlock\_irqrestore(&fmdev->resp\_skb\_lock, flags); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:42:21 +0000



=== Content from git.kernel.org_dfe0ca3f_20250114_184343.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d7408a052aa1b4f6fb6f1c7a8877b84017a07ac9)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d7408a052aa1b4f6fb6f1c7a8877b84017a07ac9)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d7408a052aa1b4f6fb6f1c7a8877b84017a07ac9)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d7408a052aa1b4f6fb6f1c7a8877b84017a07ac9)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Qiu-ji Chen <chenqiuji666@gmail.com> | 2024-09-27 16:39:02 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:48:11 +0100 |
| commit | [d7408a052aa1b4f6fb6f1c7a8877b84017a07ac9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d7408a052aa1b4f6fb6f1c7a8877b84017a07ac9) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d7408a052aa1b4f6fb6f1c7a8877b84017a07ac9)) | |
| tree | [afbfa83c889bca70315623f4706f39fe013219c8](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d7408a052aa1b4f6fb6f1c7a8877b84017a07ac9) | |
| parent | [f74b360a012a105274d69ba9ad444982620f69ee](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f74b360a012a105274d69ba9ad444982620f69ee) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d7408a052aa1b4f6fb6f1c7a8877b84017a07ac9&id2=f74b360a012a105274d69ba9ad444982620f69ee)) | |
| download | [linux-d7408a052aa1b4f6fb6f1c7a8877b84017a07ac9.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d7408a052aa1b4f6fb6f1c7a8877b84017a07ac9.tar.gz) | |

media: wl128x: Fix atomicity violation in fmc\_send\_cmd()commit ca59f9956d4519ab18ab2270be47c6b8c6ced091 upstream.
Atomicity violation occurs when the fmc\_send\_cmd() function is executed
simultaneously with the modification of the fmdev->resp\_skb value.
Consider a scenario where, after passing the validity check within the
function, a non-null fmdev->resp\_skb variable is assigned a null value.
This results in an invalid fmdev->resp\_skb variable passing the validity
check. As seen in the later part of the function, skb = fmdev->resp\_skb;
when the invalid fmdev->resp\_skb passes the check, a null pointer
dereference error may occur at line 478, evt\_hdr = (void \*)skb->data;
To address this issue, it is recommended to include the validity check of
fmdev->resp\_skb within the locked section of the function. This
modification ensures that the value of fmdev->resp\_skb does not change
during the validation process, thereby maintaining its validity.
This possible bug is found by an experimental static analysis tool
developed by our team. This tool analyzes the locking APIs
to extract function pairs that can be concurrently executed, and then
analyzes the instructions in the paired functions to identify possible
concurrency bugs including data races and atomicity violations.
Fixes: e8454ff7b9a4 ("[media] drivers:media:radio: wl128x: FM Driver Common sources")
Cc: stable@vger.kernel.org
Signed-off-by: Qiu-ji Chen <chenqiuji666@gmail.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d7408a052aa1b4f6fb6f1c7a8877b84017a07ac9)

| -rw-r--r-- | [drivers/media/radio/wl128x/fmdrv\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/radio/wl128x/fmdrv_common.c?id=d7408a052aa1b4f6fb6f1c7a8877b84017a07ac9) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/media/radio/wl128x/fmdrv\_common.c b/drivers/media/radio/wl128x/fmdrv\_common.cindex 6142484d5cb4ef..d9287a935a9ef2 100644--- a/[drivers/media/radio/wl128x/fmdrv\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/radio/wl128x/fmdrv_common.c?id=f74b360a012a105274d69ba9ad444982620f69ee)+++ b/[drivers/media/radio/wl128x/fmdrv\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/radio/wl128x/fmdrv_common.c?id=d7408a052aa1b4f6fb6f1c7a8877b84017a07ac9)@@ -465,11 +465,12 @@ int fmc\_send\_cmd(struct fmdev \*fmdev, u8 fm\_op, u16 type, void \*payload, jiffies\_to\_msecs(FM\_DRV\_TX\_TIMEOUT) / 1000); return -ETIMEDOUT; }+ spin\_lock\_irqsave(&fmdev->resp\_skb\_lock, flags); if (!fmdev->resp\_skb) {+ spin\_unlock\_irqrestore(&fmdev->resp\_skb\_lock, flags); fmerr("Response SKB is missing\n"); return -EFAULT; }- spin\_lock\_irqsave(&fmdev->resp\_skb\_lock, flags); skb = fmdev->resp\_skb; fmdev->resp\_skb = NULL; spin\_unlock\_irqrestore(&fmdev->resp\_skb\_lock, flags); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:42:20 +0000



=== Content from git.kernel.org_05e6425e_20250114_184342.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=80a3b2ee01eecf22dfa06968b3cde92c691dea10)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=80a3b2ee01eecf22dfa06968b3cde92c691dea10)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=80a3b2ee01eecf22dfa06968b3cde92c691dea10)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=80a3b2ee01eecf22dfa06968b3cde92c691dea10)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Qiu-ji Chen <chenqiuji666@gmail.com> | 2024-09-27 16:39:02 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 14:02:56 +0100 |
| commit | [80a3b2ee01eecf22dfa06968b3cde92c691dea10](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=80a3b2ee01eecf22dfa06968b3cde92c691dea10) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=80a3b2ee01eecf22dfa06968b3cde92c691dea10)) | |
| tree | [cdbd637da6882d2f74079d2748911f400819840d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=80a3b2ee01eecf22dfa06968b3cde92c691dea10) | |
| parent | [8e04747ffc0c64f955c6464a4c0bc62be683e26a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8e04747ffc0c64f955c6464a4c0bc62be683e26a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=80a3b2ee01eecf22dfa06968b3cde92c691dea10&id2=8e04747ffc0c64f955c6464a4c0bc62be683e26a)) | |
| download | [linux-80a3b2ee01eecf22dfa06968b3cde92c691dea10.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-80a3b2ee01eecf22dfa06968b3cde92c691dea10.tar.gz) | |

media: wl128x: Fix atomicity violation in fmc\_send\_cmd()commit ca59f9956d4519ab18ab2270be47c6b8c6ced091 upstream.
Atomicity violation occurs when the fmc\_send\_cmd() function is executed
simultaneously with the modification of the fmdev->resp\_skb value.
Consider a scenario where, after passing the validity check within the
function, a non-null fmdev->resp\_skb variable is assigned a null value.
This results in an invalid fmdev->resp\_skb variable passing the validity
check. As seen in the later part of the function, skb = fmdev->resp\_skb;
when the invalid fmdev->resp\_skb passes the check, a null pointer
dereference error may occur at line 478, evt\_hdr = (void \*)skb->data;
To address this issue, it is recommended to include the validity check of
fmdev->resp\_skb within the locked section of the function. This
modification ensures that the value of fmdev->resp\_skb does not change
during the validation process, thereby maintaining its validity.
This possible bug is found by an experimental static analysis tool
developed by our team. This tool analyzes the locking APIs
to extract function pairs that can be concurrently executed, and then
analyzes the instructions in the paired functions to identify possible
concurrency bugs including data races and atomicity violations.
Fixes: e8454ff7b9a4 ("[media] drivers:media:radio: wl128x: FM Driver Common sources")
Cc: stable@vger.kernel.org
Signed-off-by: Qiu-ji Chen <chenqiuji666@gmail.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=80a3b2ee01eecf22dfa06968b3cde92c691dea10)

| -rw-r--r-- | [drivers/media/radio/wl128x/fmdrv\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/radio/wl128x/fmdrv_common.c?id=80a3b2ee01eecf22dfa06968b3cde92c691dea10) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/media/radio/wl128x/fmdrv\_common.c b/drivers/media/radio/wl128x/fmdrv\_common.cindex 3d36f323a8f8f7..4d032436691c1b 100644--- a/[drivers/media/radio/wl128x/fmdrv\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/radio/wl128x/fmdrv_common.c?id=8e04747ffc0c64f955c6464a4c0bc62be683e26a)+++ b/[drivers/media/radio/wl128x/fmdrv\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/radio/wl128x/fmdrv_common.c?id=80a3b2ee01eecf22dfa06968b3cde92c691dea10)@@ -466,11 +466,12 @@ int fmc\_send\_cmd(struct fmdev \*fmdev, u8 fm\_op, u16 type, void \*payload, jiffies\_to\_msecs(FM\_DRV\_TX\_TIMEOUT) / 1000); return -ETIMEDOUT; }+ spin\_lock\_irqsave(&fmdev->resp\_skb\_lock, flags); if (!fmdev->resp\_skb) {+ spin\_unlock\_irqrestore(&fmdev->resp\_skb\_lock, flags); fmerr("Response SKB is missing\n"); return -EFAULT; }- spin\_lock\_irqsave(&fmdev->resp\_skb\_lock, flags); skb = fmdev->resp\_skb; fmdev->resp\_skb = NULL; spin\_unlock\_irqrestore(&fmdev->resp\_skb\_lock, flags); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:42:19 +0000



=== Content from git.kernel.org_8e2976da_20250114_184343.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d16109c9fdc1b8cea4fe63b42e06e926c3f68990)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d16109c9fdc1b8cea4fe63b42e06e926c3f68990)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d16109c9fdc1b8cea4fe63b42e06e926c3f68990)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d16109c9fdc1b8cea4fe63b42e06e926c3f68990)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Qiu-ji Chen <chenqiuji666@gmail.com> | 2024-09-27 16:39:02 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 10:59:41 +0100 |
| commit | [d16109c9fdc1b8cea4fe63b42e06e926c3f68990](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d16109c9fdc1b8cea4fe63b42e06e926c3f68990) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d16109c9fdc1b8cea4fe63b42e06e926c3f68990)) | |
| tree | [2b566cf39261e1be0d2dfbc3915cffd931c76fe2](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d16109c9fdc1b8cea4fe63b42e06e926c3f68990) | |
| parent | [bcfa652eacd23c73962879afe99fa534daa7bad0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bcfa652eacd23c73962879afe99fa534daa7bad0) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d16109c9fdc1b8cea4fe63b42e06e926c3f68990&id2=bcfa652eacd23c73962879afe99fa534daa7bad0)) | |
| download | [linux-d16109c9fdc1b8cea4fe63b42e06e926c3f68990.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d16109c9fdc1b8cea4fe63b42e06e926c3f68990.tar.gz) | |

media: wl128x: Fix atomicity violation in fmc\_send\_cmd()commit ca59f9956d4519ab18ab2270be47c6b8c6ced091 upstream.
Atomicity violation occurs when the fmc\_send\_cmd() function is executed
simultaneously with the modification of the fmdev->resp\_skb value.
Consider a scenario where, after passing the validity check within the
function, a non-null fmdev->resp\_skb variable is assigned a null value.
This results in an invalid fmdev->resp\_skb variable passing the validity
check. As seen in the later part of the function, skb = fmdev->resp\_skb;
when the invalid fmdev->resp\_skb passes the check, a null pointer
dereference error may occur at line 478, evt\_hdr = (void \*)skb->data;
To address this issue, it is recommended to include the validity check of
fmdev->resp\_skb within the locked section of the function. This
modification ensures that the value of fmdev->resp\_skb does not change
during the validation process, thereby maintaining its validity.
This possible bug is found by an experimental static analysis tool
developed by our team. This tool analyzes the locking APIs
to extract function pairs that can be concurrently executed, and then
analyzes the instructions in the paired functions to identify possible
concurrency bugs including data races and atomicity violations.
Fixes: e8454ff7b9a4 ("[media] drivers:media:radio: wl128x: FM Driver Common sources")
Cc: stable@vger.kernel.org
Signed-off-by: Qiu-ji Chen <chenqiuji666@gmail.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d16109c9fdc1b8cea4fe63b42e06e926c3f68990)

| -rw-r--r-- | [drivers/media/radio/wl128x/fmdrv\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/radio/wl128x/fmdrv_common.c?id=d16109c9fdc1b8cea4fe63b42e06e926c3f68990) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/media/radio/wl128x/fmdrv\_common.c b/drivers/media/radio/wl128x/fmdrv\_common.cindex cccf1a743f4e61..f22a558ad80704 100644--- a/[drivers/media/radio/wl128x/fmdrv\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/radio/wl128x/fmdrv_common.c?id=bcfa652eacd23c73962879afe99fa534daa7bad0)+++ b/[drivers/media/radio/wl128x/fmdrv\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/radio/wl128x/fmdrv_common.c?id=d16109c9fdc1b8cea4fe63b42e06e926c3f68990)@@ -472,11 +472,12 @@ int fmc\_send\_cmd(struct fmdev \*fmdev, u8 fm\_op, u16 type, void \*payload, jiffies\_to\_msecs(FM\_DRV\_TX\_TIMEOUT) / 1000); return -ETIMEDOUT; }+ spin\_lock\_irqsave(&fmdev->resp\_skb\_lock, flags); if (!fmdev->resp\_skb) {+ spin\_unlock\_irqrestore(&fmdev->resp\_skb\_lock, flags); fmerr("Response SKB is missing\n"); return -EFAULT; }- spin\_lock\_irqsave(&fmdev->resp\_skb\_lock, flags); skb = fmdev->resp\_skb; fmdev->resp\_skb = NULL; spin\_unlock\_irqrestore(&fmdev->resp\_skb\_lock, flags); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:42:20 +0000



=== Content from git.kernel.org_15403bb8_20250114_184340.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2e63c908de357048180516b84740ed62dac0b269)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2e63c908de357048180516b84740ed62dac0b269)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2e63c908de357048180516b84740ed62dac0b269)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2e63c908de357048180516b84740ed62dac0b269)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Qiu-ji Chen <chenqiuji666@gmail.com> | 2024-09-27 16:39:02 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 13:54:21 +0100 |
| commit | [2e63c908de357048180516b84740ed62dac0b269](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2e63c908de357048180516b84740ed62dac0b269) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2e63c908de357048180516b84740ed62dac0b269)) | |
| tree | [7fec23eb4d48d148323c96f5da908a9f779b9871](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2e63c908de357048180516b84740ed62dac0b269) | |
| parent | [2f8cb07e1d6eefa1b41fa647808201c5cbeeaa3b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2f8cb07e1d6eefa1b41fa647808201c5cbeeaa3b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2e63c908de357048180516b84740ed62dac0b269&id2=2f8cb07e1d6eefa1b41fa647808201c5cbeeaa3b)) | |
| download | [linux-2e63c908de357048180516b84740ed62dac0b269.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2e63c908de357048180516b84740ed62dac0b269.tar.gz) | |

media: wl128x: Fix atomicity violation in fmc\_send\_cmd()commit ca59f9956d4519ab18ab2270be47c6b8c6ced091 upstream.
Atomicity violation occurs when the fmc\_send\_cmd() function is executed
simultaneously with the modification of the fmdev->resp\_skb value.
Consider a scenario where, after passing the validity check within the
function, a non-null fmdev->resp\_skb variable is assigned a null value.
This results in an invalid fmdev->resp\_skb variable passing the validity
check. As seen in the later part of the function, skb = fmdev->resp\_skb;
when the invalid fmdev->resp\_skb passes the check, a null pointer
dereference error may occur at line 478, evt\_hdr = (void \*)skb->data;
To address this issue, it is recommended to include the validity check of
fmdev->resp\_skb within the locked section of the function. This
modification ensures that the value of fmdev->resp\_skb does not change
during the validation process, thereby maintaining its validity.
This possible bug is found by an experimental static analysis tool
developed by our team. This tool analyzes the locking APIs
to extract function pairs that can be concurrently executed, and then
analyzes the instructions in the paired functions to identify possible
concurrency bugs including data races and atomicity violations.
Fixes: e8454ff7b9a4 ("[media] drivers:media:radio: wl128x: FM Driver Common sources")
Cc: stable@vger.kernel.org
Signed-off-by: Qiu-ji Chen <chenqiuji666@gmail.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2e63c908de357048180516b84740ed62dac0b269)

| -rw-r--r-- | [drivers/media/radio/wl128x/fmdrv\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/radio/wl128x/fmdrv_common.c?id=2e63c908de357048180516b84740ed62dac0b269) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/media/radio/wl128x/fmdrv\_common.c b/drivers/media/radio/wl128x/fmdrv\_common.cindex 3d36f323a8f8f7..4d032436691c1b 100644--- a/[drivers/media/radio/wl128x/fmdrv\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/radio/wl128x/fmdrv_common.c?id=2f8cb07e1d6eefa1b41fa647808201c5cbeeaa3b)+++ b/[drivers/media/radio/wl128x/fmdrv\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/radio/wl128x/fmdrv_common.c?id=2e63c908de357048180516b84740ed62dac0b269)@@ -466,11 +466,12 @@ int fmc\_send\_cmd(struct fmdev \*fmdev, u8 fm\_op, u16 type, void \*payload, jiffies\_to\_msecs(FM\_DRV\_TX\_TIMEOUT) / 1000); return -ETIMEDOUT; }+ spin\_lock\_irqsave(&fmdev->resp\_skb\_lock, flags); if (!fmdev->resp\_skb) {+ spin\_unlock\_irqrestore(&fmdev->resp\_skb\_lock, flags); fmerr("Response SKB is missing\n"); return -EFAULT; }- spin\_lock\_irqsave(&fmdev->resp\_skb\_lock, flags); skb = fmdev->resp\_skb; fmdev->resp\_skb = NULL; spin\_unlock\_irqrestore(&fmdev->resp\_skb\_lock, flags); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:42:17 +0000



=== Content from git.kernel.org_ef76a9f6_20250114_184341.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=378ce4e08ca2b1ac7bbf1d57b68643ca4226c5f8)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=378ce4e08ca2b1ac7bbf1d57b68643ca4226c5f8)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=378ce4e08ca2b1ac7bbf1d57b68643ca4226c5f8)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=378ce4e08ca2b1ac7bbf1d57b68643ca4226c5f8)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Qiu-ji Chen <chenqiuji666@gmail.com> | 2024-09-27 16:39:02 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-09 10:32:51 +0100 |
| commit | [378ce4e08ca2b1ac7bbf1d57b68643ca4226c5f8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=378ce4e08ca2b1ac7bbf1d57b68643ca4226c5f8) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=378ce4e08ca2b1ac7bbf1d57b68643ca4226c5f8)) | |
| tree | [1ebbb86abe3ebf592d0e2524441d7fdd5ae3329d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=378ce4e08ca2b1ac7bbf1d57b68643ca4226c5f8) | |
| parent | [c68dab1665325d00620d671a182a7edb1a538c97](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c68dab1665325d00620d671a182a7edb1a538c97) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=378ce4e08ca2b1ac7bbf1d57b68643ca4226c5f8&id2=c68dab1665325d00620d671a182a7edb1a538c97)) | |
| download | [linux-378ce4e08ca2b1ac7bbf1d57b68643ca4226c5f8.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-378ce4e08ca2b1ac7bbf1d57b68643ca4226c5f8.tar.gz) | |

media: wl128x: Fix atomicity violation in fmc\_send\_cmd()commit ca59f9956d4519ab18ab2270be47c6b8c6ced091 upstream.
Atomicity violation occurs when the fmc\_send\_cmd() function is executed
simultaneously with the modification of the fmdev->resp\_skb value.
Consider a scenario where, after passing the validity check within the
function, a non-null fmdev->resp\_skb variable is assigned a null value.
This results in an invalid fmdev->resp\_skb variable passing the validity
check. As seen in the later part of the function, skb = fmdev->resp\_skb;
when the invalid fmdev->resp\_skb passes the check, a null pointer
dereference error may occur at line 478, evt\_hdr = (void \*)skb->data;
To address this issue, it is recommended to include the validity check of
fmdev->resp\_skb within the locked section of the function. This
modification ensures that the value of fmdev->resp\_skb does not change
during the validation process, thereby maintaining its validity.
This possible bug is found by an experimental static analysis tool
developed by our team. This tool analyzes the locking APIs
to extract function pairs that can be concurrently executed, and then
analyzes the instructions in the paired functions to identify possible
concurrency bugs including data races and atomicity violations.
Fixes: e8454ff7b9a4 ("[media] drivers:media:radio: wl128x: FM Driver Common sources")
Cc: stable@vger.kernel.org
Signed-off-by: Qiu-ji Chen <chenqiuji666@gmail.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=378ce4e08ca2b1ac7bbf1d57b68643ca4226c5f8)

| -rw-r--r-- | [drivers/media/radio/wl128x/fmdrv\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/radio/wl128x/fmdrv_common.c?id=378ce4e08ca2b1ac7bbf1d57b68643ca4226c5f8) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/media/radio/wl128x/fmdrv\_common.c b/drivers/media/radio/wl128x/fmdrv\_common.cindex 3da8e5102becc2..1225dab9fc7d3e 100644--- a/[drivers/media/radio/wl128x/fmdrv\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/radio/wl128x/fmdrv_common.c?id=c68dab1665325d00620d671a182a7edb1a538c97)+++ b/[drivers/media/radio/wl128x/fmdrv\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/radio/wl128x/fmdrv_common.c?id=378ce4e08ca2b1ac7bbf1d57b68643ca4226c5f8)@@ -466,11 +466,12 @@ int fmc\_send\_cmd(struct fmdev \*fmdev, u8 fm\_op, u16 type, void \*payload, jiffies\_to\_msecs(FM\_DRV\_TX\_TIMEOUT) / 1000); return -ETIMEDOUT; }+ spin\_lock\_irqsave(&fmdev->resp\_skb\_lock, flags); if (!fmdev->resp\_skb) {+ spin\_unlock\_irqrestore(&fmdev->resp\_skb\_lock, flags); fmerr("Response SKB is missing\n"); return -EFAULT; }- spin\_lock\_irqsave(&fmdev->resp\_skb\_lock, flags); skb = fmdev->resp\_skb; fmdev->resp\_skb = NULL; spin\_unlock\_irqrestore(&fmdev->resp\_skb\_lock, flags); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:42:18 +0000



=== Content from git.kernel.org_3112d545_20250114_184342.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ca59f9956d4519ab18ab2270be47c6b8c6ced091)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ca59f9956d4519ab18ab2270be47c6b8c6ced091)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ca59f9956d4519ab18ab2270be47c6b8c6ced091)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ca59f9956d4519ab18ab2270be47c6b8c6ced091)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Qiu-ji Chen <chenqiuji666@gmail.com> | 2024-09-27 16:39:02 +0800 |
| --- | --- | --- |
| committer | Hans Verkuil <hverkuil-cisco@xs4all.nl> | 2024-10-12 16:28:26 +0200 |
| commit | [ca59f9956d4519ab18ab2270be47c6b8c6ced091](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ca59f9956d4519ab18ab2270be47c6b8c6ced091) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ca59f9956d4519ab18ab2270be47c6b8c6ced091)) | |
| tree | [a3b70001c1f355174879ca71216912d9ff6ec16b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ca59f9956d4519ab18ab2270be47c6b8c6ced091) | |
| parent | [b8fc42dc065742bc68df6a61a2aff8cbe364fa17](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b8fc42dc065742bc68df6a61a2aff8cbe364fa17) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ca59f9956d4519ab18ab2270be47c6b8c6ced091&id2=b8fc42dc065742bc68df6a61a2aff8cbe364fa17)) | |
| download | [linux-ca59f9956d4519ab18ab2270be47c6b8c6ced091.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ca59f9956d4519ab18ab2270be47c6b8c6ced091.tar.gz) | |

media: wl128x: Fix atomicity violation in fmc\_send\_cmd()Atomicity violation occurs when the fmc\_send\_cmd() function is executed
simultaneously with the modification of the fmdev->resp\_skb value.
Consider a scenario where, after passing the validity check within the
function, a non-null fmdev->resp\_skb variable is assigned a null value.
This results in an invalid fmdev->resp\_skb variable passing the validity
check. As seen in the later part of the function, skb = fmdev->resp\_skb;
when the invalid fmdev->resp\_skb passes the check, a null pointer
dereference error may occur at line 478, evt\_hdr = (void \*)skb->data;
To address this issue, it is recommended to include the validity check of
fmdev->resp\_skb within the locked section of the function. This
modification ensures that the value of fmdev->resp\_skb does not change
during the validation process, thereby maintaining its validity.
This possible bug is found by an experimental static analysis tool
developed by our team. This tool analyzes the locking APIs
to extract function pairs that can be concurrently executed, and then
analyzes the instructions in the paired functions to identify possible
concurrency bugs including data races and atomicity violations.
Fixes: e8454ff7b9a4 ("[media] drivers:media:radio: wl128x: FM Driver Common sources")
Cc: stable@vger.kernel.org
Signed-off-by: Qiu-ji Chen <chenqiuji666@gmail.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ca59f9956d4519ab18ab2270be47c6b8c6ced091)

| -rw-r--r-- | [drivers/media/radio/wl128x/fmdrv\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/radio/wl128x/fmdrv_common.c?id=ca59f9956d4519ab18ab2270be47c6b8c6ced091) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/media/radio/wl128x/fmdrv\_common.c b/drivers/media/radio/wl128x/fmdrv\_common.cindex 3d36f323a8f8f7..4d032436691c1b 100644--- a/[drivers/media/radio/wl128x/fmdrv\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/radio/wl128x/fmdrv_common.c?id=b8fc42dc065742bc68df6a61a2aff8cbe364fa17)+++ b/[drivers/media/radio/wl128x/fmdrv\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/radio/wl128x/fmdrv_common.c?id=ca59f9956d4519ab18ab2270be47c6b8c6ced091)@@ -466,11 +466,12 @@ int fmc\_send\_cmd(struct fmdev \*fmdev, u8 fm\_op, u16 type, void \*payload, jiffies\_to\_msecs(FM\_DRV\_TX\_TIMEOUT) / 1000); return -ETIMEDOUT; }+ spin\_lock\_irqsave(&fmdev->resp\_skb\_lock, flags); if (!fmdev->resp\_skb) {+ spin\_unlock\_irqrestore(&fmdev->resp\_skb\_lock, flags); fmerr("Response SKB is missing\n"); return -EFAULT; }- spin\_lock\_irqsave(&fmdev->resp\_skb\_lock, flags); skb = fmdev->resp\_skb; fmdev->resp\_skb = NULL; spin\_unlock\_irqrestore(&fmdev->resp\_skb\_lock, flags); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:42:19 +0000


