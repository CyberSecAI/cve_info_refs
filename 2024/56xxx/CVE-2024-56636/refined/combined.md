=== Content from git.kernel.org_487d5079_20250114_211926.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2ee7bdc7cb40abfe658a71fbd10c7db2f4fc4f9a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2ee7bdc7cb40abfe658a71fbd10c7db2f4fc4f9a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2ee7bdc7cb40abfe658a71fbd10c7db2f4fc4f9a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2ee7bdc7cb40abfe658a71fbd10c7db2f4fc4f9a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Dumazet <edumazet@google.com> | 2024-12-03 18:21:21 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:54:23 +0100 |
| commit | [2ee7bdc7cb40abfe658a71fbd10c7db2f4fc4f9a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2ee7bdc7cb40abfe658a71fbd10c7db2f4fc4f9a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2ee7bdc7cb40abfe658a71fbd10c7db2f4fc4f9a)) | |
| tree | [bf09f51f4a2eaf5c08c2f217055de04aed70b854](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2ee7bdc7cb40abfe658a71fbd10c7db2f4fc4f9a) | |
| parent | [a1a68b5702cb09bba79d0624d39bf98c21c00617](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a1a68b5702cb09bba79d0624d39bf98c21c00617) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2ee7bdc7cb40abfe658a71fbd10c7db2f4fc4f9a&id2=a1a68b5702cb09bba79d0624d39bf98c21c00617)) | |
| download | [linux-2ee7bdc7cb40abfe658a71fbd10c7db2f4fc4f9a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2ee7bdc7cb40abfe658a71fbd10c7db2f4fc4f9a.tar.gz) | |

geneve: do not assume mac header is set in geneve\_xmit\_skb()[ Upstream commit 8588c99c7d47448fcae39e3227d6e2bb97aad86d ]
We should not assume mac header is set in output path.
Use skb\_eth\_hdr() instead of eth\_hdr() to fix the issue.
sysbot reported the following :
WARNING: CPU: 0 PID: 11635 at include/linux/skbuff.h:3052 skb\_mac\_header include/linux/skbuff.h:3052 [inline]
WARNING: CPU: 0 PID: 11635 at include/linux/skbuff.h:3052 eth\_hdr include/linux/if\_ether.h:24 [inline]
WARNING: CPU: 0 PID: 11635 at include/linux/skbuff.h:3052 geneve\_xmit\_skb drivers/net/geneve.c:898 [inline]
WARNING: CPU: 0 PID: 11635 at include/linux/skbuff.h:3052 geneve\_xmit+0x4c38/0x5730 drivers/net/geneve.c:1039
Modules linked in:
CPU: 0 UID: 0 PID: 11635 Comm: syz.4.1423 Not tainted 6.12.0-syzkaller-10296-gaaf20f870da0 #0
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 09/13/2024
RIP: 0010:skb\_mac\_header include/linux/skbuff.h:3052 [inline]
RIP: 0010:eth\_hdr include/linux/if\_ether.h:24 [inline]
RIP: 0010:geneve\_xmit\_skb drivers/net/geneve.c:898 [inline]
RIP: 0010:geneve\_xmit+0x4c38/0x5730 drivers/net/geneve.c:1039
Code: 21 c6 02 e9 35 d4 ff ff e8 a5 48 4c fb 90 0f 0b 90 e9 fd f5 ff ff e8 97 48 4c fb 90 0f 0b 90 e9 d8 f5 ff ff e8 89 48 4c fb 90 <0f> 0b 90 e9 41 e4 ff ff e8 7b 48 4c fb 90 0f 0b 90 e9 cd e7 ff ff
RSP: 0018:ffffc90003b2f870 EFLAGS: 00010283
RAX: 000000000000037a RBX: 000000000000ffff RCX: ffffc9000dc3d000
RDX: 0000000000080000 RSI: ffffffff86428417 RDI: 0000000000000003
RBP: ffffc90003b2f9f0 R08: 0000000000000003 R09: 000000000000ffff
R10: 000000000000ffff R11: 0000000000000002 R12: ffff88806603c000
R13: 0000000000000000 R14: ffff8880685b2780 R15: 0000000000000e23
FS: 00007fdc2deed6c0(0000) GS:ffff8880b8600000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 0000001b30a1dff8 CR3: 0000000056b8c000 CR4: 00000000003526f0
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
Call Trace:
<TASK>
\_\_netdev\_start\_xmit include/linux/netdevice.h:5002 [inline]
netdev\_start\_xmit include/linux/netdevice.h:5011 [inline]
\_\_dev\_direct\_xmit+0x58a/0x720 net/core/dev.c:4490
dev\_direct\_xmit include/linux/netdevice.h:3181 [inline]
packet\_xmit+0x1e4/0x360 net/packet/af\_packet.c:285
packet\_snd net/packet/af\_packet.c:3146 [inline]
packet\_sendmsg+0x2700/0x5660 net/packet/af\_packet.c:3178
sock\_sendmsg\_nosec net/socket.c:711 [inline]
\_\_sock\_sendmsg net/socket.c:726 [inline]
\_\_sys\_sendto+0x488/0x4f0 net/socket.c:2197
\_\_do\_sys\_sendto net/socket.c:2204 [inline]
\_\_se\_sys\_sendto net/socket.c:2200 [inline]
\_\_x64\_sys\_sendto+0xe0/0x1c0 net/socket.c:2200
do\_syscall\_x64 arch/x86/entry/common.c:52 [inline]
do\_syscall\_64+0xcd/0x250 arch/x86/entry/common.c:83
entry\_SYSCALL\_64\_after\_hwframe+0x77/0x7f
Fixes: a025fb5f49ad ("geneve: Allow configuration of DF behaviour")
Reported-by: syzbot+3ec5271486d7cb2d242a@syzkaller.appspotmail.com
Closes: https://lore.kernel.org/netdev/674f4b72.050a0220.17bd51.004a.GAE@google.com/T/#u
Signed-off-by: Eric Dumazet <edumazet@google.com>
Reviewed-by: Stefano Brivio <sbrivio@redhat.com>
Link: [https://patch.msgid.link/20241203182122.2725517-1-edumazet@google.com](https://patch.msgid.link/20241203182122.2725517-1-edumazet%40google.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2ee7bdc7cb40abfe658a71fbd10c7db2f4fc4f9a)

| -rw-r--r-- | [drivers/net/geneve.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/geneve.c?id=2ee7bdc7cb40abfe658a71fbd10c7db2f4fc4f9a) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/net/geneve.c b/drivers/net/geneve.cindex c4a49a75250e3f..27b570678c9fc7 100644--- a/[drivers/net/geneve.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/geneve.c?id=a1a68b5702cb09bba79d0624d39bf98c21c00617)+++ b/[drivers/net/geneve.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/geneve.c?id=2ee7bdc7cb40abfe658a71fbd10c7db2f4fc4f9a)@@ -990,7 +990,7 @@ static int geneve\_xmit\_skb(struct sk\_buff \*skb, struct net\_device \*dev, if (geneve->cfg.df == GENEVE\_DF\_SET) { df = htons(IP\_DF); } else if (geneve->cfg.df == GENEVE\_DF\_INHERIT) {- struct ethhdr \*eth = eth\_hdr(skb);+ struct ethhdr \*eth = skb\_eth\_hdr(skb);  if (ntohs(eth->h\_proto) == ETH\_P\_IPV6) { df = htons(IP\_DF); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:18:03 +0000



=== Content from git.kernel.org_4a82e1f1_20250114_211928.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d9fa09ca004befe9cf826d6820439cb6f93cecd7)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d9fa09ca004befe9cf826d6820439cb6f93cecd7)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d9fa09ca004befe9cf826d6820439cb6f93cecd7)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d9fa09ca004befe9cf826d6820439cb6f93cecd7)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Dumazet <edumazet@google.com> | 2024-12-03 18:21:21 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:48:20 +0100 |
| commit | [d9fa09ca004befe9cf826d6820439cb6f93cecd7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d9fa09ca004befe9cf826d6820439cb6f93cecd7) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d9fa09ca004befe9cf826d6820439cb6f93cecd7)) | |
| tree | [c00628e1026fd82f2e48cc59999c6b638cc48f2b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d9fa09ca004befe9cf826d6820439cb6f93cecd7) | |
| parent | [d93efe18b49a17c3576f57ce2d535822c8406e8b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d93efe18b49a17c3576f57ce2d535822c8406e8b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d9fa09ca004befe9cf826d6820439cb6f93cecd7&id2=d93efe18b49a17c3576f57ce2d535822c8406e8b)) | |
| download | [linux-d9fa09ca004befe9cf826d6820439cb6f93cecd7.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d9fa09ca004befe9cf826d6820439cb6f93cecd7.tar.gz) | |

geneve: do not assume mac header is set in geneve\_xmit\_skb()[ Upstream commit 8588c99c7d47448fcae39e3227d6e2bb97aad86d ]
We should not assume mac header is set in output path.
Use skb\_eth\_hdr() instead of eth\_hdr() to fix the issue.
sysbot reported the following :
WARNING: CPU: 0 PID: 11635 at include/linux/skbuff.h:3052 skb\_mac\_header include/linux/skbuff.h:3052 [inline]
WARNING: CPU: 0 PID: 11635 at include/linux/skbuff.h:3052 eth\_hdr include/linux/if\_ether.h:24 [inline]
WARNING: CPU: 0 PID: 11635 at include/linux/skbuff.h:3052 geneve\_xmit\_skb drivers/net/geneve.c:898 [inline]
WARNING: CPU: 0 PID: 11635 at include/linux/skbuff.h:3052 geneve\_xmit+0x4c38/0x5730 drivers/net/geneve.c:1039
Modules linked in:
CPU: 0 UID: 0 PID: 11635 Comm: syz.4.1423 Not tainted 6.12.0-syzkaller-10296-gaaf20f870da0 #0
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 09/13/2024
RIP: 0010:skb\_mac\_header include/linux/skbuff.h:3052 [inline]
RIP: 0010:eth\_hdr include/linux/if\_ether.h:24 [inline]
RIP: 0010:geneve\_xmit\_skb drivers/net/geneve.c:898 [inline]
RIP: 0010:geneve\_xmit+0x4c38/0x5730 drivers/net/geneve.c:1039
Code: 21 c6 02 e9 35 d4 ff ff e8 a5 48 4c fb 90 0f 0b 90 e9 fd f5 ff ff e8 97 48 4c fb 90 0f 0b 90 e9 d8 f5 ff ff e8 89 48 4c fb 90 <0f> 0b 90 e9 41 e4 ff ff e8 7b 48 4c fb 90 0f 0b 90 e9 cd e7 ff ff
RSP: 0018:ffffc90003b2f870 EFLAGS: 00010283
RAX: 000000000000037a RBX: 000000000000ffff RCX: ffffc9000dc3d000
RDX: 0000000000080000 RSI: ffffffff86428417 RDI: 0000000000000003
RBP: ffffc90003b2f9f0 R08: 0000000000000003 R09: 000000000000ffff
R10: 000000000000ffff R11: 0000000000000002 R12: ffff88806603c000
R13: 0000000000000000 R14: ffff8880685b2780 R15: 0000000000000e23
FS: 00007fdc2deed6c0(0000) GS:ffff8880b8600000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 0000001b30a1dff8 CR3: 0000000056b8c000 CR4: 00000000003526f0
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
Call Trace:
<TASK>
\_\_netdev\_start\_xmit include/linux/netdevice.h:5002 [inline]
netdev\_start\_xmit include/linux/netdevice.h:5011 [inline]
\_\_dev\_direct\_xmit+0x58a/0x720 net/core/dev.c:4490
dev\_direct\_xmit include/linux/netdevice.h:3181 [inline]
packet\_xmit+0x1e4/0x360 net/packet/af\_packet.c:285
packet\_snd net/packet/af\_packet.c:3146 [inline]
packet\_sendmsg+0x2700/0x5660 net/packet/af\_packet.c:3178
sock\_sendmsg\_nosec net/socket.c:711 [inline]
\_\_sock\_sendmsg net/socket.c:726 [inline]
\_\_sys\_sendto+0x488/0x4f0 net/socket.c:2197
\_\_do\_sys\_sendto net/socket.c:2204 [inline]
\_\_se\_sys\_sendto net/socket.c:2200 [inline]
\_\_x64\_sys\_sendto+0xe0/0x1c0 net/socket.c:2200
do\_syscall\_x64 arch/x86/entry/common.c:52 [inline]
do\_syscall\_64+0xcd/0x250 arch/x86/entry/common.c:83
entry\_SYSCALL\_64\_after\_hwframe+0x77/0x7f
Fixes: a025fb5f49ad ("geneve: Allow configuration of DF behaviour")
Reported-by: syzbot+3ec5271486d7cb2d242a@syzkaller.appspotmail.com
Closes: https://lore.kernel.org/netdev/674f4b72.050a0220.17bd51.004a.GAE@google.com/T/#u
Signed-off-by: Eric Dumazet <edumazet@google.com>
Reviewed-by: Stefano Brivio <sbrivio@redhat.com>
Link: [https://patch.msgid.link/20241203182122.2725517-1-edumazet@google.com](https://patch.msgid.link/20241203182122.2725517-1-edumazet%40google.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d9fa09ca004befe9cf826d6820439cb6f93cecd7)

| -rw-r--r-- | [drivers/net/geneve.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/geneve.c?id=d9fa09ca004befe9cf826d6820439cb6f93cecd7) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/net/geneve.c b/drivers/net/geneve.cindex d0b7d1b9222186..e7412edb84dcd4 100644--- a/[drivers/net/geneve.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/geneve.c?id=d93efe18b49a17c3576f57ce2d535822c8406e8b)+++ b/[drivers/net/geneve.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/geneve.c?id=d9fa09ca004befe9cf826d6820439cb6f93cecd7)@@ -983,7 +983,7 @@ static int geneve\_xmit\_skb(struct sk\_buff \*skb, struct net\_device \*dev, if (geneve->cfg.df == GENEVE\_DF\_SET) { df = htons(IP\_DF); } else if (geneve->cfg.df == GENEVE\_DF\_INHERIT) {- struct ethhdr \*eth = eth\_hdr(skb);+ struct ethhdr \*eth = skb\_eth\_hdr(skb);  if (ntohs(eth->h\_proto) == ETH\_P\_IPV6) { df = htons(IP\_DF); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:18:05 +0000



=== Content from git.kernel.org_3abc55e2_20250114_211927.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=97ce3a4ec55eac6b5e2949ffb04028d604afda3b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=97ce3a4ec55eac6b5e2949ffb04028d604afda3b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=97ce3a4ec55eac6b5e2949ffb04028d604afda3b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=97ce3a4ec55eac6b5e2949ffb04028d604afda3b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Dumazet <edumazet@google.com> | 2024-12-03 18:21:21 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:59:40 +0100 |
| commit | [97ce3a4ec55eac6b5e2949ffb04028d604afda3b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=97ce3a4ec55eac6b5e2949ffb04028d604afda3b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=97ce3a4ec55eac6b5e2949ffb04028d604afda3b)) | |
| tree | [074c658493860b8530b48f30bfc4a1fae58b64e7](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=97ce3a4ec55eac6b5e2949ffb04028d604afda3b) | |
| parent | [711525430d12d9e024f17209c0e8fc2841ce3ea1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=711525430d12d9e024f17209c0e8fc2841ce3ea1) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=97ce3a4ec55eac6b5e2949ffb04028d604afda3b&id2=711525430d12d9e024f17209c0e8fc2841ce3ea1)) | |
| download | [linux-97ce3a4ec55eac6b5e2949ffb04028d604afda3b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-97ce3a4ec55eac6b5e2949ffb04028d604afda3b.tar.gz) | |

geneve: do not assume mac header is set in geneve\_xmit\_skb()[ Upstream commit 8588c99c7d47448fcae39e3227d6e2bb97aad86d ]
We should not assume mac header is set in output path.
Use skb\_eth\_hdr() instead of eth\_hdr() to fix the issue.
sysbot reported the following :
WARNING: CPU: 0 PID: 11635 at include/linux/skbuff.h:3052 skb\_mac\_header include/linux/skbuff.h:3052 [inline]
WARNING: CPU: 0 PID: 11635 at include/linux/skbuff.h:3052 eth\_hdr include/linux/if\_ether.h:24 [inline]
WARNING: CPU: 0 PID: 11635 at include/linux/skbuff.h:3052 geneve\_xmit\_skb drivers/net/geneve.c:898 [inline]
WARNING: CPU: 0 PID: 11635 at include/linux/skbuff.h:3052 geneve\_xmit+0x4c38/0x5730 drivers/net/geneve.c:1039
Modules linked in:
CPU: 0 UID: 0 PID: 11635 Comm: syz.4.1423 Not tainted 6.12.0-syzkaller-10296-gaaf20f870da0 #0
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 09/13/2024
RIP: 0010:skb\_mac\_header include/linux/skbuff.h:3052 [inline]
RIP: 0010:eth\_hdr include/linux/if\_ether.h:24 [inline]
RIP: 0010:geneve\_xmit\_skb drivers/net/geneve.c:898 [inline]
RIP: 0010:geneve\_xmit+0x4c38/0x5730 drivers/net/geneve.c:1039
Code: 21 c6 02 e9 35 d4 ff ff e8 a5 48 4c fb 90 0f 0b 90 e9 fd f5 ff ff e8 97 48 4c fb 90 0f 0b 90 e9 d8 f5 ff ff e8 89 48 4c fb 90 <0f> 0b 90 e9 41 e4 ff ff e8 7b 48 4c fb 90 0f 0b 90 e9 cd e7 ff ff
RSP: 0018:ffffc90003b2f870 EFLAGS: 00010283
RAX: 000000000000037a RBX: 000000000000ffff RCX: ffffc9000dc3d000
RDX: 0000000000080000 RSI: ffffffff86428417 RDI: 0000000000000003
RBP: ffffc90003b2f9f0 R08: 0000000000000003 R09: 000000000000ffff
R10: 000000000000ffff R11: 0000000000000002 R12: ffff88806603c000
R13: 0000000000000000 R14: ffff8880685b2780 R15: 0000000000000e23
FS: 00007fdc2deed6c0(0000) GS:ffff8880b8600000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 0000001b30a1dff8 CR3: 0000000056b8c000 CR4: 00000000003526f0
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
Call Trace:
<TASK>
\_\_netdev\_start\_xmit include/linux/netdevice.h:5002 [inline]
netdev\_start\_xmit include/linux/netdevice.h:5011 [inline]
\_\_dev\_direct\_xmit+0x58a/0x720 net/core/dev.c:4490
dev\_direct\_xmit include/linux/netdevice.h:3181 [inline]
packet\_xmit+0x1e4/0x360 net/packet/af\_packet.c:285
packet\_snd net/packet/af\_packet.c:3146 [inline]
packet\_sendmsg+0x2700/0x5660 net/packet/af\_packet.c:3178
sock\_sendmsg\_nosec net/socket.c:711 [inline]
\_\_sock\_sendmsg net/socket.c:726 [inline]
\_\_sys\_sendto+0x488/0x4f0 net/socket.c:2197
\_\_do\_sys\_sendto net/socket.c:2204 [inline]
\_\_se\_sys\_sendto net/socket.c:2200 [inline]
\_\_x64\_sys\_sendto+0xe0/0x1c0 net/socket.c:2200
do\_syscall\_x64 arch/x86/entry/common.c:52 [inline]
do\_syscall\_64+0xcd/0x250 arch/x86/entry/common.c:83
entry\_SYSCALL\_64\_after\_hwframe+0x77/0x7f
Fixes: a025fb5f49ad ("geneve: Allow configuration of DF behaviour")
Reported-by: syzbot+3ec5271486d7cb2d242a@syzkaller.appspotmail.com
Closes: https://lore.kernel.org/netdev/674f4b72.050a0220.17bd51.004a.GAE@google.com/T/#u
Signed-off-by: Eric Dumazet <edumazet@google.com>
Reviewed-by: Stefano Brivio <sbrivio@redhat.com>
Link: [https://patch.msgid.link/20241203182122.2725517-1-edumazet@google.com](https://patch.msgid.link/20241203182122.2725517-1-edumazet%40google.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=97ce3a4ec55eac6b5e2949ffb04028d604afda3b)

| -rw-r--r-- | [drivers/net/geneve.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/geneve.c?id=97ce3a4ec55eac6b5e2949ffb04028d604afda3b) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/net/geneve.c b/drivers/net/geneve.cindex 8333a5620deffd..b939d4711c59b6 100644--- a/[drivers/net/geneve.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/geneve.c?id=711525430d12d9e024f17209c0e8fc2841ce3ea1)+++ b/[drivers/net/geneve.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/geneve.c?id=97ce3a4ec55eac6b5e2949ffb04028d604afda3b)@@ -986,7 +986,7 @@ static int geneve\_xmit\_skb(struct sk\_buff \*skb, struct net\_device \*dev, if (geneve->cfg.df == GENEVE\_DF\_SET) { df = htons(IP\_DF); } else if (geneve->cfg.df == GENEVE\_DF\_INHERIT) {- struct ethhdr \*eth = eth\_hdr(skb);+ struct ethhdr \*eth = skb\_eth\_hdr(skb);  if (ntohs(eth->h\_proto) == ETH\_P\_IPV6) { df = htons(IP\_DF); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:18:05 +0000



=== Content from git.kernel.org_18972610_20250114_211928.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b65958284401016b983078c68f70b047537f4aba)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b65958284401016b983078c68f70b047537f4aba)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b65958284401016b983078c68f70b047537f4aba)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b65958284401016b983078c68f70b047537f4aba)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Dumazet <edumazet@google.com> | 2024-12-03 18:21:21 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:51:28 +0100 |
| commit | [b65958284401016b983078c68f70b047537f4aba](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b65958284401016b983078c68f70b047537f4aba) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b65958284401016b983078c68f70b047537f4aba)) | |
| tree | [7ba21c2b83eaa749b13e034b9a58023019e184b3](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b65958284401016b983078c68f70b047537f4aba) | |
| parent | [c20f91bd939553be347196ecf4ab7b69dff19193](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c20f91bd939553be347196ecf4ab7b69dff19193) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b65958284401016b983078c68f70b047537f4aba&id2=c20f91bd939553be347196ecf4ab7b69dff19193)) | |
| download | [linux-b65958284401016b983078c68f70b047537f4aba.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b65958284401016b983078c68f70b047537f4aba.tar.gz) | |

geneve: do not assume mac header is set in geneve\_xmit\_skb()[ Upstream commit 8588c99c7d47448fcae39e3227d6e2bb97aad86d ]
We should not assume mac header is set in output path.
Use skb\_eth\_hdr() instead of eth\_hdr() to fix the issue.
sysbot reported the following :
WARNING: CPU: 0 PID: 11635 at include/linux/skbuff.h:3052 skb\_mac\_header include/linux/skbuff.h:3052 [inline]
WARNING: CPU: 0 PID: 11635 at include/linux/skbuff.h:3052 eth\_hdr include/linux/if\_ether.h:24 [inline]
WARNING: CPU: 0 PID: 11635 at include/linux/skbuff.h:3052 geneve\_xmit\_skb drivers/net/geneve.c:898 [inline]
WARNING: CPU: 0 PID: 11635 at include/linux/skbuff.h:3052 geneve\_xmit+0x4c38/0x5730 drivers/net/geneve.c:1039
Modules linked in:
CPU: 0 UID: 0 PID: 11635 Comm: syz.4.1423 Not tainted 6.12.0-syzkaller-10296-gaaf20f870da0 #0
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 09/13/2024
RIP: 0010:skb\_mac\_header include/linux/skbuff.h:3052 [inline]
RIP: 0010:eth\_hdr include/linux/if\_ether.h:24 [inline]
RIP: 0010:geneve\_xmit\_skb drivers/net/geneve.c:898 [inline]
RIP: 0010:geneve\_xmit+0x4c38/0x5730 drivers/net/geneve.c:1039
Code: 21 c6 02 e9 35 d4 ff ff e8 a5 48 4c fb 90 0f 0b 90 e9 fd f5 ff ff e8 97 48 4c fb 90 0f 0b 90 e9 d8 f5 ff ff e8 89 48 4c fb 90 <0f> 0b 90 e9 41 e4 ff ff e8 7b 48 4c fb 90 0f 0b 90 e9 cd e7 ff ff
RSP: 0018:ffffc90003b2f870 EFLAGS: 00010283
RAX: 000000000000037a RBX: 000000000000ffff RCX: ffffc9000dc3d000
RDX: 0000000000080000 RSI: ffffffff86428417 RDI: 0000000000000003
RBP: ffffc90003b2f9f0 R08: 0000000000000003 R09: 000000000000ffff
R10: 000000000000ffff R11: 0000000000000002 R12: ffff88806603c000
R13: 0000000000000000 R14: ffff8880685b2780 R15: 0000000000000e23
FS: 00007fdc2deed6c0(0000) GS:ffff8880b8600000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 0000001b30a1dff8 CR3: 0000000056b8c000 CR4: 00000000003526f0
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
Call Trace:
<TASK>
\_\_netdev\_start\_xmit include/linux/netdevice.h:5002 [inline]
netdev\_start\_xmit include/linux/netdevice.h:5011 [inline]
\_\_dev\_direct\_xmit+0x58a/0x720 net/core/dev.c:4490
dev\_direct\_xmit include/linux/netdevice.h:3181 [inline]
packet\_xmit+0x1e4/0x360 net/packet/af\_packet.c:285
packet\_snd net/packet/af\_packet.c:3146 [inline]
packet\_sendmsg+0x2700/0x5660 net/packet/af\_packet.c:3178
sock\_sendmsg\_nosec net/socket.c:711 [inline]
\_\_sock\_sendmsg net/socket.c:726 [inline]
\_\_sys\_sendto+0x488/0x4f0 net/socket.c:2197
\_\_do\_sys\_sendto net/socket.c:2204 [inline]
\_\_se\_sys\_sendto net/socket.c:2200 [inline]
\_\_x64\_sys\_sendto+0xe0/0x1c0 net/socket.c:2200
do\_syscall\_x64 arch/x86/entry/common.c:52 [inline]
do\_syscall\_64+0xcd/0x250 arch/x86/entry/common.c:83
entry\_SYSCALL\_64\_after\_hwframe+0x77/0x7f
Fixes: a025fb5f49ad ("geneve: Allow configuration of DF behaviour")
Reported-by: syzbot+3ec5271486d7cb2d242a@syzkaller.appspotmail.com
Closes: https://lore.kernel.org/netdev/674f4b72.050a0220.17bd51.004a.GAE@google.com/T/#u
Signed-off-by: Eric Dumazet <edumazet@google.com>
Reviewed-by: Stefano Brivio <sbrivio@redhat.com>
Link: [https://patch.msgid.link/20241203182122.2725517-1-edumazet@google.com](https://patch.msgid.link/20241203182122.2725517-1-edumazet%40google.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b65958284401016b983078c68f70b047537f4aba)

| -rw-r--r-- | [drivers/net/geneve.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/geneve.c?id=b65958284401016b983078c68f70b047537f4aba) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/net/geneve.c b/drivers/net/geneve.cindex d7440cc4be80ba..10e3d69205a4f0 100644--- a/[drivers/net/geneve.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/geneve.c?id=c20f91bd939553be347196ecf4ab7b69dff19193)+++ b/[drivers/net/geneve.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/geneve.c?id=b65958284401016b983078c68f70b047537f4aba)@@ -985,7 +985,7 @@ static int geneve\_xmit\_skb(struct sk\_buff \*skb, struct net\_device \*dev, if (geneve->cfg.df == GENEVE\_DF\_SET) { df = htons(IP\_DF); } else if (geneve->cfg.df == GENEVE\_DF\_INHERIT) {- struct ethhdr \*eth = eth\_hdr(skb);+ struct ethhdr \*eth = skb\_eth\_hdr(skb);  if (ntohs(eth->h\_proto) == ETH\_P\_IPV6) { df = htons(IP\_DF); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:18:05 +0000



=== Content from git.kernel.org_71186413_20250114_211926.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=177b72ed7c77b11e46dd4336d73a87a77a5603af)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=177b72ed7c77b11e46dd4336d73a87a77a5603af)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=177b72ed7c77b11e46dd4336d73a87a77a5603af)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=177b72ed7c77b11e46dd4336d73a87a77a5603af)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Dumazet <edumazet@google.com> | 2024-12-03 18:21:21 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 20:03:08 +0100 |
| commit | [177b72ed7c77b11e46dd4336d73a87a77a5603af](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=177b72ed7c77b11e46dd4336d73a87a77a5603af) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=177b72ed7c77b11e46dd4336d73a87a77a5603af)) | |
| tree | [67634aaed9337718c32fbe13acccfb45b6608dd2](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=177b72ed7c77b11e46dd4336d73a87a77a5603af) | |
| parent | [68292db0d06944be271046a2ac7c868d32296285](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=68292db0d06944be271046a2ac7c868d32296285) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=177b72ed7c77b11e46dd4336d73a87a77a5603af&id2=68292db0d06944be271046a2ac7c868d32296285)) | |
| download | [linux-177b72ed7c77b11e46dd4336d73a87a77a5603af.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-177b72ed7c77b11e46dd4336d73a87a77a5603af.tar.gz) | |

geneve: do not assume mac header is set in geneve\_xmit\_skb()[ Upstream commit 8588c99c7d47448fcae39e3227d6e2bb97aad86d ]
We should not assume mac header is set in output path.
Use skb\_eth\_hdr() instead of eth\_hdr() to fix the issue.
sysbot reported the following :
WARNING: CPU: 0 PID: 11635 at include/linux/skbuff.h:3052 skb\_mac\_header include/linux/skbuff.h:3052 [inline]
WARNING: CPU: 0 PID: 11635 at include/linux/skbuff.h:3052 eth\_hdr include/linux/if\_ether.h:24 [inline]
WARNING: CPU: 0 PID: 11635 at include/linux/skbuff.h:3052 geneve\_xmit\_skb drivers/net/geneve.c:898 [inline]
WARNING: CPU: 0 PID: 11635 at include/linux/skbuff.h:3052 geneve\_xmit+0x4c38/0x5730 drivers/net/geneve.c:1039
Modules linked in:
CPU: 0 UID: 0 PID: 11635 Comm: syz.4.1423 Not tainted 6.12.0-syzkaller-10296-gaaf20f870da0 #0
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 09/13/2024
RIP: 0010:skb\_mac\_header include/linux/skbuff.h:3052 [inline]
RIP: 0010:eth\_hdr include/linux/if\_ether.h:24 [inline]
RIP: 0010:geneve\_xmit\_skb drivers/net/geneve.c:898 [inline]
RIP: 0010:geneve\_xmit+0x4c38/0x5730 drivers/net/geneve.c:1039
Code: 21 c6 02 e9 35 d4 ff ff e8 a5 48 4c fb 90 0f 0b 90 e9 fd f5 ff ff e8 97 48 4c fb 90 0f 0b 90 e9 d8 f5 ff ff e8 89 48 4c fb 90 <0f> 0b 90 e9 41 e4 ff ff e8 7b 48 4c fb 90 0f 0b 90 e9 cd e7 ff ff
RSP: 0018:ffffc90003b2f870 EFLAGS: 00010283
RAX: 000000000000037a RBX: 000000000000ffff RCX: ffffc9000dc3d000
RDX: 0000000000080000 RSI: ffffffff86428417 RDI: 0000000000000003
RBP: ffffc90003b2f9f0 R08: 0000000000000003 R09: 000000000000ffff
R10: 000000000000ffff R11: 0000000000000002 R12: ffff88806603c000
R13: 0000000000000000 R14: ffff8880685b2780 R15: 0000000000000e23
FS: 00007fdc2deed6c0(0000) GS:ffff8880b8600000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 0000001b30a1dff8 CR3: 0000000056b8c000 CR4: 00000000003526f0
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
Call Trace:
<TASK>
\_\_netdev\_start\_xmit include/linux/netdevice.h:5002 [inline]
netdev\_start\_xmit include/linux/netdevice.h:5011 [inline]
\_\_dev\_direct\_xmit+0x58a/0x720 net/core/dev.c:4490
dev\_direct\_xmit include/linux/netdevice.h:3181 [inline]
packet\_xmit+0x1e4/0x360 net/packet/af\_packet.c:285
packet\_snd net/packet/af\_packet.c:3146 [inline]
packet\_sendmsg+0x2700/0x5660 net/packet/af\_packet.c:3178
sock\_sendmsg\_nosec net/socket.c:711 [inline]
\_\_sock\_sendmsg net/socket.c:726 [inline]
\_\_sys\_sendto+0x488/0x4f0 net/socket.c:2197
\_\_do\_sys\_sendto net/socket.c:2204 [inline]
\_\_se\_sys\_sendto net/socket.c:2200 [inline]
\_\_x64\_sys\_sendto+0xe0/0x1c0 net/socket.c:2200
do\_syscall\_x64 arch/x86/entry/common.c:52 [inline]
do\_syscall\_64+0xcd/0x250 arch/x86/entry/common.c:83
entry\_SYSCALL\_64\_after\_hwframe+0x77/0x7f
Fixes: a025fb5f49ad ("geneve: Allow configuration of DF behaviour")
Reported-by: syzbot+3ec5271486d7cb2d242a@syzkaller.appspotmail.com
Closes: https://lore.kernel.org/netdev/674f4b72.050a0220.17bd51.004a.GAE@google.com/T/#u
Signed-off-by: Eric Dumazet <edumazet@google.com>
Reviewed-by: Stefano Brivio <sbrivio@redhat.com>
Link: [https://patch.msgid.link/20241203182122.2725517-1-edumazet@google.com](https://patch.msgid.link/20241203182122.2725517-1-edumazet%40google.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=177b72ed7c77b11e46dd4336d73a87a77a5603af)

| -rw-r--r-- | [drivers/net/geneve.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/geneve.c?id=177b72ed7c77b11e46dd4336d73a87a77a5603af) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/net/geneve.c b/drivers/net/geneve.cindex 7f611c74eb629b..ba15a0a4ce629e 100644--- a/[drivers/net/geneve.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/geneve.c?id=68292db0d06944be271046a2ac7c868d32296285)+++ b/[drivers/net/geneve.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/geneve.c?id=177b72ed7c77b11e46dd4336d73a87a77a5603af)@@ -895,7 +895,7 @@ static int geneve\_xmit\_skb(struct sk\_buff \*skb, struct net\_device \*dev, if (geneve->cfg.df == GENEVE\_DF\_SET) { df = htons(IP\_DF); } else if (geneve->cfg.df == GENEVE\_DF\_INHERIT) {- struct ethhdr \*eth = eth\_hdr(skb);+ struct ethhdr \*eth = skb\_eth\_hdr(skb);  if (ntohs(eth->h\_proto) == ETH\_P\_IPV6) { df = htons(IP\_DF); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:18:03 +0000



=== Content from git.kernel.org_64df22f9_20250114_211927.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8588c99c7d47448fcae39e3227d6e2bb97aad86d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8588c99c7d47448fcae39e3227d6e2bb97aad86d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8588c99c7d47448fcae39e3227d6e2bb97aad86d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8588c99c7d47448fcae39e3227d6e2bb97aad86d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Dumazet <edumazet@google.com> | 2024-12-03 18:21:21 +0000 |
| --- | --- | --- |
| committer | Jakub Kicinski <kuba@kernel.org> | 2024-12-04 19:21:47 -0800 |
| commit | [8588c99c7d47448fcae39e3227d6e2bb97aad86d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8588c99c7d47448fcae39e3227d6e2bb97aad86d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8588c99c7d47448fcae39e3227d6e2bb97aad86d)) | |
| tree | [d7dfb3b319375150447d2166b03d73c9778cddc8](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8588c99c7d47448fcae39e3227d6e2bb97aad86d) | |
| parent | [217bbf156f93ada86b91617489e7ba8a0904233c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=217bbf156f93ada86b91617489e7ba8a0904233c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8588c99c7d47448fcae39e3227d6e2bb97aad86d&id2=217bbf156f93ada86b91617489e7ba8a0904233c)) | |
| download | [linux-8588c99c7d47448fcae39e3227d6e2bb97aad86d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8588c99c7d47448fcae39e3227d6e2bb97aad86d.tar.gz) | |

geneve: do not assume mac header is set in geneve\_xmit\_skb()We should not assume mac header is set in output path.
Use skb\_eth\_hdr() instead of eth\_hdr() to fix the issue.
sysbot reported the following :
WARNING: CPU: 0 PID: 11635 at include/linux/skbuff.h:3052 skb\_mac\_header include/linux/skbuff.h:3052 [inline]
WARNING: CPU: 0 PID: 11635 at include/linux/skbuff.h:3052 eth\_hdr include/linux/if\_ether.h:24 [inline]
WARNING: CPU: 0 PID: 11635 at include/linux/skbuff.h:3052 geneve\_xmit\_skb drivers/net/geneve.c:898 [inline]
WARNING: CPU: 0 PID: 11635 at include/linux/skbuff.h:3052 geneve\_xmit+0x4c38/0x5730 drivers/net/geneve.c:1039
Modules linked in:
CPU: 0 UID: 0 PID: 11635 Comm: syz.4.1423 Not tainted 6.12.0-syzkaller-10296-gaaf20f870da0 #0
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 09/13/2024
RIP: 0010:skb\_mac\_header include/linux/skbuff.h:3052 [inline]
RIP: 0010:eth\_hdr include/linux/if\_ether.h:24 [inline]
RIP: 0010:geneve\_xmit\_skb drivers/net/geneve.c:898 [inline]
RIP: 0010:geneve\_xmit+0x4c38/0x5730 drivers/net/geneve.c:1039
Code: 21 c6 02 e9 35 d4 ff ff e8 a5 48 4c fb 90 0f 0b 90 e9 fd f5 ff ff e8 97 48 4c fb 90 0f 0b 90 e9 d8 f5 ff ff e8 89 48 4c fb 90 <0f> 0b 90 e9 41 e4 ff ff e8 7b 48 4c fb 90 0f 0b 90 e9 cd e7 ff ff
RSP: 0018:ffffc90003b2f870 EFLAGS: 00010283
RAX: 000000000000037a RBX: 000000000000ffff RCX: ffffc9000dc3d000
RDX: 0000000000080000 RSI: ffffffff86428417 RDI: 0000000000000003
RBP: ffffc90003b2f9f0 R08: 0000000000000003 R09: 000000000000ffff
R10: 000000000000ffff R11: 0000000000000002 R12: ffff88806603c000
R13: 0000000000000000 R14: ffff8880685b2780 R15: 0000000000000e23
FS: 00007fdc2deed6c0(0000) GS:ffff8880b8600000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 0000001b30a1dff8 CR3: 0000000056b8c000 CR4: 00000000003526f0
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
Call Trace:
<TASK>
\_\_netdev\_start\_xmit include/linux/netdevice.h:5002 [inline]
netdev\_start\_xmit include/linux/netdevice.h:5011 [inline]
\_\_dev\_direct\_xmit+0x58a/0x720 net/core/dev.c:4490
dev\_direct\_xmit include/linux/netdevice.h:3181 [inline]
packet\_xmit+0x1e4/0x360 net/packet/af\_packet.c:285
packet\_snd net/packet/af\_packet.c:3146 [inline]
packet\_sendmsg+0x2700/0x5660 net/packet/af\_packet.c:3178
sock\_sendmsg\_nosec net/socket.c:711 [inline]
\_\_sock\_sendmsg net/socket.c:726 [inline]
\_\_sys\_sendto+0x488/0x4f0 net/socket.c:2197
\_\_do\_sys\_sendto net/socket.c:2204 [inline]
\_\_se\_sys\_sendto net/socket.c:2200 [inline]
\_\_x64\_sys\_sendto+0xe0/0x1c0 net/socket.c:2200
do\_syscall\_x64 arch/x86/entry/common.c:52 [inline]
do\_syscall\_64+0xcd/0x250 arch/x86/entry/common.c:83
entry\_SYSCALL\_64\_after\_hwframe+0x77/0x7f
Fixes: a025fb5f49ad ("geneve: Allow configuration of DF behaviour")
Reported-by: syzbot+3ec5271486d7cb2d242a@syzkaller.appspotmail.com
Closes: https://lore.kernel.org/netdev/674f4b72.050a0220.17bd51.004a.GAE@google.com/T/#u
Signed-off-by: Eric Dumazet <edumazet@google.com>
Reviewed-by: Stefano Brivio <sbrivio@redhat.com>
Link: [https://patch.msgid.link/20241203182122.2725517-1-edumazet@google.com](https://patch.msgid.link/20241203182122.2725517-1-edumazet%40google.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8588c99c7d47448fcae39e3227d6e2bb97aad86d)

| -rw-r--r-- | [drivers/net/geneve.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/geneve.c?id=8588c99c7d47448fcae39e3227d6e2bb97aad86d) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/net/geneve.c b/drivers/net/geneve.cindex 2f29b1386b1c81..bc658bc6088546 100644--- a/[drivers/net/geneve.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/geneve.c?id=217bbf156f93ada86b91617489e7ba8a0904233c)+++ b/[drivers/net/geneve.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/geneve.c?id=8588c99c7d47448fcae39e3227d6e2bb97aad86d)@@ -895,7 +895,7 @@ static int geneve\_xmit\_skb(struct sk\_buff \*skb, struct net\_device \*dev, if (geneve->cfg.df == GENEVE\_DF\_SET) { df = htons(IP\_DF); } else if (geneve->cfg.df == GENEVE\_DF\_INHERIT) {- struct ethhdr \*eth = eth\_hdr(skb);+ struct ethhdr \*eth = skb\_eth\_hdr(skb);  if (ntohs(eth->h\_proto) == ETH\_P\_IPV6) { df = htons(IP\_DF); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:18:04 +0000


