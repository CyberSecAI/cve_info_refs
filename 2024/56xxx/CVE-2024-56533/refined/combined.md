=== Content from git.kernel.org_4509ebd5_20250114_185347.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=24fe9f7ca83ec9acf765339054951f5cd9ae5c5d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=24fe9f7ca83ec9acf765339054951f5cd9ae5c5d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=24fe9f7ca83ec9acf765339054951f5cd9ae5c5d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=24fe9f7ca83ec9acf765339054951f5cd9ae5c5d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Takashi Iwai <tiwai@suse.de> | 2024-11-13 12:10:35 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:47:56 +0100 |
| commit | [24fe9f7ca83ec9acf765339054951f5cd9ae5c5d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=24fe9f7ca83ec9acf765339054951f5cd9ae5c5d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=24fe9f7ca83ec9acf765339054951f5cd9ae5c5d)) | |
| tree | [d862104819450ee1c521e37ae418c625244cc0ed](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=24fe9f7ca83ec9acf765339054951f5cd9ae5c5d) | |
| parent | [d5a733ee2624b8692e67bcb2beceb22911b106d7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d5a733ee2624b8692e67bcb2beceb22911b106d7) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=24fe9f7ca83ec9acf765339054951f5cd9ae5c5d&id2=d5a733ee2624b8692e67bcb2beceb22911b106d7)) | |
| download | [linux-24fe9f7ca83ec9acf765339054951f5cd9ae5c5d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-24fe9f7ca83ec9acf765339054951f5cd9ae5c5d.tar.gz) | |

ALSA: usx2y: Use snd\_card\_free\_when\_closed() at disconnection[ Upstream commit dafb28f02be407e07a6f679e922a626592b481b0 ]
The USB disconnect callback is supposed to be short and not too-long
waiting. OTOH, the current code uses snd\_card\_free() at
disconnection, but this waits for the close of all used fds, hence it
can take long. It eventually blocks the upper layer USB ioctls, which
may trigger a soft lockup.
An easy workaround is to replace snd\_card\_free() with
snd\_card\_free\_when\_closed(). This variant returns immediately while
the release of resources is done asynchronously by the card device
release at the last close.
Fixes: 230cd5e24853 ("[ALSA] prevent oops & dead keyboard on usb unplugging while the device is be ing used")
Reported-by: syzbot+73582d08864d8268b6fd@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=73582d08864d8268b6fd
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Link: [https://patch.msgid.link/20241113111042.15058-2-tiwai@suse.de](https://patch.msgid.link/20241113111042.15058-2-tiwai%40suse.de)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=24fe9f7ca83ec9acf765339054951f5cd9ae5c5d)

| -rw-r--r-- | [sound/usb/usx2y/usbusx2y.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/usb/usx2y/usbusx2y.c?id=24fe9f7ca83ec9acf765339054951f5cd9ae5c5d) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/sound/usb/usx2y/usbusx2y.c b/sound/usb/usx2y/usbusx2y.cindex 9d5a33c4ff2f39..c567e58ceb4fd8 100644--- a/[sound/usb/usx2y/usbusx2y.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/usx2y/usbusx2y.c?id=d5a733ee2624b8692e67bcb2beceb22911b106d7)+++ b/[sound/usb/usx2y/usbusx2y.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/usx2y/usbusx2y.c?id=24fe9f7ca83ec9acf765339054951f5cd9ae5c5d)@@ -396,7 +396,7 @@ static void snd\_usx2y\_disconnect(struct usb\_interface \*intf) } if (usx2y->us428ctls\_sharedmem) wake\_up(&usx2y->us428ctls\_wait\_queue\_head);- snd\_card\_free(card);+ snd\_card\_free\_when\_closed(card); }  static int snd\_usx2y\_probe(struct usb\_interface \*intf, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:52:24 +0000



=== Content from git.kernel.org_d4a53c75_20250114_185351.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e869642a77a9b3b98b0ab2c8fec7af4385140909)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e869642a77a9b3b98b0ab2c8fec7af4385140909)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e869642a77a9b3b98b0ab2c8fec7af4385140909)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e869642a77a9b3b98b0ab2c8fec7af4385140909)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Takashi Iwai <tiwai@suse.de> | 2024-11-13 12:10:35 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 14:01:57 +0100 |
| commit | [e869642a77a9b3b98b0ab2c8fec7af4385140909](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e869642a77a9b3b98b0ab2c8fec7af4385140909) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e869642a77a9b3b98b0ab2c8fec7af4385140909)) | |
| tree | [9aed2b4445b31620b202f26b9ee5ba81a1ad2012](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e869642a77a9b3b98b0ab2c8fec7af4385140909) | |
| parent | [449b1a71788af14c6ecebf1eab4f004b86b281b8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=449b1a71788af14c6ecebf1eab4f004b86b281b8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e869642a77a9b3b98b0ab2c8fec7af4385140909&id2=449b1a71788af14c6ecebf1eab4f004b86b281b8)) | |
| download | [linux-e869642a77a9b3b98b0ab2c8fec7af4385140909.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e869642a77a9b3b98b0ab2c8fec7af4385140909.tar.gz) | |

ALSA: usx2y: Use snd\_card\_free\_when\_closed() at disconnection[ Upstream commit dafb28f02be407e07a6f679e922a626592b481b0 ]
The USB disconnect callback is supposed to be short and not too-long
waiting. OTOH, the current code uses snd\_card\_free() at
disconnection, but this waits for the close of all used fds, hence it
can take long. It eventually blocks the upper layer USB ioctls, which
may trigger a soft lockup.
An easy workaround is to replace snd\_card\_free() with
snd\_card\_free\_when\_closed(). This variant returns immediately while
the release of resources is done asynchronously by the card device
release at the last close.
Fixes: 230cd5e24853 ("[ALSA] prevent oops & dead keyboard on usb unplugging while the device is be ing used")
Reported-by: syzbot+73582d08864d8268b6fd@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=73582d08864d8268b6fd
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Link: [https://patch.msgid.link/20241113111042.15058-2-tiwai@suse.de](https://patch.msgid.link/20241113111042.15058-2-tiwai%40suse.de)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e869642a77a9b3b98b0ab2c8fec7af4385140909)

| -rw-r--r-- | [sound/usb/usx2y/usbusx2y.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/usb/usx2y/usbusx2y.c?id=e869642a77a9b3b98b0ab2c8fec7af4385140909) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/sound/usb/usx2y/usbusx2y.c b/sound/usb/usx2y/usbusx2y.cindex 2f9cede242b3a9..5f81c68fd42b68 100644--- a/[sound/usb/usx2y/usbusx2y.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/usx2y/usbusx2y.c?id=449b1a71788af14c6ecebf1eab4f004b86b281b8)+++ b/[sound/usb/usx2y/usbusx2y.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/usx2y/usbusx2y.c?id=e869642a77a9b3b98b0ab2c8fec7af4385140909)@@ -422,7 +422,7 @@ static void snd\_usx2y\_disconnect(struct usb\_interface \*intf) } if (usx2y->us428ctls\_sharedmem) wake\_up(&usx2y->us428ctls\_wait\_queue\_head);- snd\_card\_free(card);+ snd\_card\_free\_when\_closed(card); }  static int snd\_usx2y\_probe(struct usb\_interface \*intf, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:52:28 +0000



=== Content from git.kernel.org_12634b4e_20250114_185351.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ffbfc6c4330fc233698529656798bee44fea96f5)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ffbfc6c4330fc233698529656798bee44fea96f5)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ffbfc6c4330fc233698529656798bee44fea96f5)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ffbfc6c4330fc233698529656798bee44fea96f5)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Takashi Iwai <tiwai@suse.de> | 2024-11-13 12:10:35 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 13:53:25 +0100 |
| commit | [ffbfc6c4330fc233698529656798bee44fea96f5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ffbfc6c4330fc233698529656798bee44fea96f5) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ffbfc6c4330fc233698529656798bee44fea96f5)) | |
| tree | [293bc737e23623d391d1374c95b58d264e7b1b22](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ffbfc6c4330fc233698529656798bee44fea96f5) | |
| parent | [56840151bd29da24564484d268d67779e6878691](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=56840151bd29da24564484d268d67779e6878691) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ffbfc6c4330fc233698529656798bee44fea96f5&id2=56840151bd29da24564484d268d67779e6878691)) | |
| download | [linux-ffbfc6c4330fc233698529656798bee44fea96f5.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ffbfc6c4330fc233698529656798bee44fea96f5.tar.gz) | |

ALSA: usx2y: Use snd\_card\_free\_when\_closed() at disconnection[ Upstream commit dafb28f02be407e07a6f679e922a626592b481b0 ]
The USB disconnect callback is supposed to be short and not too-long
waiting. OTOH, the current code uses snd\_card\_free() at
disconnection, but this waits for the close of all used fds, hence it
can take long. It eventually blocks the upper layer USB ioctls, which
may trigger a soft lockup.
An easy workaround is to replace snd\_card\_free() with
snd\_card\_free\_when\_closed(). This variant returns immediately while
the release of resources is done asynchronously by the card device
release at the last close.
Fixes: 230cd5e24853 ("[ALSA] prevent oops & dead keyboard on usb unplugging while the device is be ing used")
Reported-by: syzbot+73582d08864d8268b6fd@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=73582d08864d8268b6fd
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Link: [https://patch.msgid.link/20241113111042.15058-2-tiwai@suse.de](https://patch.msgid.link/20241113111042.15058-2-tiwai%40suse.de)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ffbfc6c4330fc233698529656798bee44fea96f5)

| -rw-r--r-- | [sound/usb/usx2y/usbusx2y.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/usb/usx2y/usbusx2y.c?id=ffbfc6c4330fc233698529656798bee44fea96f5) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/sound/usb/usx2y/usbusx2y.c b/sound/usb/usx2y/usbusx2y.cindex 52f4e6652407d5..4c4ce0319d624d 100644--- a/[sound/usb/usx2y/usbusx2y.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/usx2y/usbusx2y.c?id=56840151bd29da24564484d268d67779e6878691)+++ b/[sound/usb/usx2y/usbusx2y.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/usx2y/usbusx2y.c?id=ffbfc6c4330fc233698529656798bee44fea96f5)@@ -423,7 +423,7 @@ static void snd\_usx2y\_disconnect(struct usb\_interface \*intf) } if (usx2y->us428ctls\_sharedmem) wake\_up(&usx2y->us428ctls\_wait\_queue\_head);- snd\_card\_free(card);+ snd\_card\_free\_when\_closed(card); }  static int snd\_usx2y\_probe(struct usb\_interface \*intf, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:52:28 +0000



=== Content from git.kernel.org_cce3a66e_20250114_185348.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=7bd8838c0ea886679a32834fdcacab296d072fbe)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7bd8838c0ea886679a32834fdcacab296d072fbe)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7bd8838c0ea886679a32834fdcacab296d072fbe)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7bd8838c0ea886679a32834fdcacab296d072fbe)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Takashi Iwai <tiwai@suse.de> | 2024-11-13 12:10:35 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:53:33 +0100 |
| commit | [7bd8838c0ea886679a32834fdcacab296d072fbe](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7bd8838c0ea886679a32834fdcacab296d072fbe) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=7bd8838c0ea886679a32834fdcacab296d072fbe)) | |
| tree | [e82e01ae017c430fb56ec6512d6e6a46a947789a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7bd8838c0ea886679a32834fdcacab296d072fbe) | |
| parent | [f61b836ce94fc5642073cfa3f2e07b822a0ef641](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f61b836ce94fc5642073cfa3f2e07b822a0ef641) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7bd8838c0ea886679a32834fdcacab296d072fbe&id2=f61b836ce94fc5642073cfa3f2e07b822a0ef641)) | |
| download | [linux-7bd8838c0ea886679a32834fdcacab296d072fbe.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-7bd8838c0ea886679a32834fdcacab296d072fbe.tar.gz) | |

ALSA: usx2y: Use snd\_card\_free\_when\_closed() at disconnection[ Upstream commit dafb28f02be407e07a6f679e922a626592b481b0 ]
The USB disconnect callback is supposed to be short and not too-long
waiting. OTOH, the current code uses snd\_card\_free() at
disconnection, but this waits for the close of all used fds, hence it
can take long. It eventually blocks the upper layer USB ioctls, which
may trigger a soft lockup.
An easy workaround is to replace snd\_card\_free() with
snd\_card\_free\_when\_closed(). This variant returns immediately while
the release of resources is done asynchronously by the card device
release at the last close.
Fixes: 230cd5e24853 ("[ALSA] prevent oops & dead keyboard on usb unplugging while the device is be ing used")
Reported-by: syzbot+73582d08864d8268b6fd@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=73582d08864d8268b6fd
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Link: [https://patch.msgid.link/20241113111042.15058-2-tiwai@suse.de](https://patch.msgid.link/20241113111042.15058-2-tiwai%40suse.de)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7bd8838c0ea886679a32834fdcacab296d072fbe)

| -rw-r--r-- | [sound/usb/usx2y/usbusx2y.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/usb/usx2y/usbusx2y.c?id=7bd8838c0ea886679a32834fdcacab296d072fbe) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/sound/usb/usx2y/usbusx2y.c b/sound/usb/usx2y/usbusx2y.cindex 52f4e6652407d5..4c4ce0319d624d 100644--- a/[sound/usb/usx2y/usbusx2y.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/usx2y/usbusx2y.c?id=f61b836ce94fc5642073cfa3f2e07b822a0ef641)+++ b/[sound/usb/usx2y/usbusx2y.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/usx2y/usbusx2y.c?id=7bd8838c0ea886679a32834fdcacab296d072fbe)@@ -423,7 +423,7 @@ static void snd\_usx2y\_disconnect(struct usb\_interface \*intf) } if (usx2y->us428ctls\_sharedmem) wake\_up(&usx2y->us428ctls\_wait\_queue\_head);- snd\_card\_free(card);+ snd\_card\_free\_when\_closed(card); }  static int snd\_usx2y\_probe(struct usb\_interface \*intf, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:52:25 +0000



=== Content from git.kernel.org_29dfdf4d_20250114_185349.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=befcca1777525e37c659b4129d8ac7463b07ef67)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=befcca1777525e37c659b4129d8ac7463b07ef67)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=befcca1777525e37c659b4129d8ac7463b07ef67)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=befcca1777525e37c659b4129d8ac7463b07ef67)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Takashi Iwai <tiwai@suse.de> | 2024-11-13 12:10:35 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:50:58 +0100 |
| commit | [befcca1777525e37c659b4129d8ac7463b07ef67](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=befcca1777525e37c659b4129d8ac7463b07ef67) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=befcca1777525e37c659b4129d8ac7463b07ef67)) | |
| tree | [6c2b45911e7889bcb16139fd28658582a6304c2f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=befcca1777525e37c659b4129d8ac7463b07ef67) | |
| parent | [8772cba765741a2b7dc8b808947c58cf7473ce42](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8772cba765741a2b7dc8b808947c58cf7473ce42) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=befcca1777525e37c659b4129d8ac7463b07ef67&id2=8772cba765741a2b7dc8b808947c58cf7473ce42)) | |
| download | [linux-befcca1777525e37c659b4129d8ac7463b07ef67.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-befcca1777525e37c659b4129d8ac7463b07ef67.tar.gz) | |

ALSA: usx2y: Use snd\_card\_free\_when\_closed() at disconnection[ Upstream commit dafb28f02be407e07a6f679e922a626592b481b0 ]
The USB disconnect callback is supposed to be short and not too-long
waiting. OTOH, the current code uses snd\_card\_free() at
disconnection, but this waits for the close of all used fds, hence it
can take long. It eventually blocks the upper layer USB ioctls, which
may trigger a soft lockup.
An easy workaround is to replace snd\_card\_free() with
snd\_card\_free\_when\_closed(). This variant returns immediately while
the release of resources is done asynchronously by the card device
release at the last close.
Fixes: 230cd5e24853 ("[ALSA] prevent oops & dead keyboard on usb unplugging while the device is be ing used")
Reported-by: syzbot+73582d08864d8268b6fd@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=73582d08864d8268b6fd
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Link: [https://patch.msgid.link/20241113111042.15058-2-tiwai@suse.de](https://patch.msgid.link/20241113111042.15058-2-tiwai%40suse.de)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=befcca1777525e37c659b4129d8ac7463b07ef67)

| -rw-r--r-- | [sound/usb/usx2y/usbusx2y.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/usb/usx2y/usbusx2y.c?id=befcca1777525e37c659b4129d8ac7463b07ef67) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/sound/usb/usx2y/usbusx2y.c b/sound/usb/usx2y/usbusx2y.cindex 099bee662af6b7..c3292afa883ee8 100644--- a/[sound/usb/usx2y/usbusx2y.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/usx2y/usbusx2y.c?id=8772cba765741a2b7dc8b808947c58cf7473ce42)+++ b/[sound/usb/usx2y/usbusx2y.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/usx2y/usbusx2y.c?id=befcca1777525e37c659b4129d8ac7463b07ef67)@@ -423,7 +423,7 @@ static void snd\_usx2y\_disconnect(struct usb\_interface \*intf) } if (usx2y->us428ctls\_sharedmem) wake\_up(&usx2y->us428ctls\_wait\_queue\_head);- snd\_card\_free(card);+ snd\_card\_free\_when\_closed(card); }  static int snd\_usx2y\_probe(struct usb\_interface \*intf, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:52:26 +0000



=== Content from git.kernel.org_ac4a912c_20250114_185350.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e07605d855c4104d981653146a330ea48f6266ed)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e07605d855c4104d981653146a330ea48f6266ed)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e07605d855c4104d981653146a330ea48f6266ed)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e07605d855c4104d981653146a330ea48f6266ed)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Takashi Iwai <tiwai@suse.de> | 2024-11-13 12:10:35 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-09 10:32:11 +0100 |
| commit | [e07605d855c4104d981653146a330ea48f6266ed](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e07605d855c4104d981653146a330ea48f6266ed) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e07605d855c4104d981653146a330ea48f6266ed)) | |
| tree | [12937c9e392b8f2347f671b560623f66812cebd6](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e07605d855c4104d981653146a330ea48f6266ed) | |
| parent | [440f6a15700e234fdc3ef27245c4c501c894b7de](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=440f6a15700e234fdc3ef27245c4c501c894b7de) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e07605d855c4104d981653146a330ea48f6266ed&id2=440f6a15700e234fdc3ef27245c4c501c894b7de)) | |
| download | [linux-e07605d855c4104d981653146a330ea48f6266ed.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e07605d855c4104d981653146a330ea48f6266ed.tar.gz) | |

ALSA: usx2y: Use snd\_card\_free\_when\_closed() at disconnection[ Upstream commit dafb28f02be407e07a6f679e922a626592b481b0 ]
The USB disconnect callback is supposed to be short and not too-long
waiting. OTOH, the current code uses snd\_card\_free() at
disconnection, but this waits for the close of all used fds, hence it
can take long. It eventually blocks the upper layer USB ioctls, which
may trigger a soft lockup.
An easy workaround is to replace snd\_card\_free() with
snd\_card\_free\_when\_closed(). This variant returns immediately while
the release of resources is done asynchronously by the card device
release at the last close.
Fixes: 230cd5e24853 ("[ALSA] prevent oops & dead keyboard on usb unplugging while the device is be ing used")
Reported-by: syzbot+73582d08864d8268b6fd@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=73582d08864d8268b6fd
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Link: [https://patch.msgid.link/20241113111042.15058-2-tiwai@suse.de](https://patch.msgid.link/20241113111042.15058-2-tiwai%40suse.de)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e07605d855c4104d981653146a330ea48f6266ed)

| -rw-r--r-- | [sound/usb/usx2y/usbusx2y.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/usb/usx2y/usbusx2y.c?id=e07605d855c4104d981653146a330ea48f6266ed) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/sound/usb/usx2y/usbusx2y.c b/sound/usb/usx2y/usbusx2y.cindex 52f4e6652407d5..4c4ce0319d624d 100644--- a/[sound/usb/usx2y/usbusx2y.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/usx2y/usbusx2y.c?id=440f6a15700e234fdc3ef27245c4c501c894b7de)+++ b/[sound/usb/usx2y/usbusx2y.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/usx2y/usbusx2y.c?id=e07605d855c4104d981653146a330ea48f6266ed)@@ -423,7 +423,7 @@ static void snd\_usx2y\_disconnect(struct usb\_interface \*intf) } if (usx2y->us428ctls\_sharedmem) wake\_up(&usx2y->us428ctls\_wait\_queue\_head);- snd\_card\_free(card);+ snd\_card\_free\_when\_closed(card); }  static int snd\_usx2y\_probe(struct usb\_interface \*intf, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:52:27 +0000



=== Content from git.kernel.org_26f9946d_20250114_185349.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=dafb28f02be407e07a6f679e922a626592b481b0)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=dafb28f02be407e07a6f679e922a626592b481b0)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=dafb28f02be407e07a6f679e922a626592b481b0)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=dafb28f02be407e07a6f679e922a626592b481b0)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Takashi Iwai <tiwai@suse.de> | 2024-11-13 12:10:35 +0100 |
| --- | --- | --- |
| committer | Takashi Iwai <tiwai@suse.de> | 2024-11-13 13:33:46 +0100 |
| commit | [dafb28f02be407e07a6f679e922a626592b481b0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=dafb28f02be407e07a6f679e922a626592b481b0) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=dafb28f02be407e07a6f679e922a626592b481b0)) | |
| tree | [ada9fdf3a615d0de844ae1bbdee970b13bf3c289](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=dafb28f02be407e07a6f679e922a626592b481b0) | |
| parent | [f69c2861b05e29c69abed6aafe0cefd224d9d4db](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f69c2861b05e29c69abed6aafe0cefd224d9d4db) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=dafb28f02be407e07a6f679e922a626592b481b0&id2=f69c2861b05e29c69abed6aafe0cefd224d9d4db)) | |
| download | [linux-dafb28f02be407e07a6f679e922a626592b481b0.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-dafb28f02be407e07a6f679e922a626592b481b0.tar.gz) | |

ALSA: usx2y: Use snd\_card\_free\_when\_closed() at disconnectionThe USB disconnect callback is supposed to be short and not too-long
waiting. OTOH, the current code uses snd\_card\_free() at
disconnection, but this waits for the close of all used fds, hence it
can take long. It eventually blocks the upper layer USB ioctls, which
may trigger a soft lockup.
An easy workaround is to replace snd\_card\_free() with
snd\_card\_free\_when\_closed(). This variant returns immediately while
the release of resources is done asynchronously by the card device
release at the last close.
Fixes: 230cd5e24853 ("[ALSA] prevent oops & dead keyboard on usb unplugging while the device is be ing used")
Reported-by: syzbot+73582d08864d8268b6fd@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=73582d08864d8268b6fd
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Link: [https://patch.msgid.link/20241113111042.15058-2-tiwai@suse.de](https://patch.msgid.link/20241113111042.15058-2-tiwai%40suse.de)
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=dafb28f02be407e07a6f679e922a626592b481b0)

| -rw-r--r-- | [sound/usb/usx2y/usbusx2y.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/usb/usx2y/usbusx2y.c?id=dafb28f02be407e07a6f679e922a626592b481b0) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/sound/usb/usx2y/usbusx2y.c b/sound/usb/usx2y/usbusx2y.cindex 2f9cede242b3a9..5f81c68fd42b68 100644--- a/[sound/usb/usx2y/usbusx2y.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/usx2y/usbusx2y.c?id=f69c2861b05e29c69abed6aafe0cefd224d9d4db)+++ b/[sound/usb/usx2y/usbusx2y.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/usx2y/usbusx2y.c?id=dafb28f02be407e07a6f679e922a626592b481b0)@@ -422,7 +422,7 @@ static void snd\_usx2y\_disconnect(struct usb\_interface \*intf) } if (usx2y->us428ctls\_sharedmem) wake\_up(&usx2y->us428ctls\_wait\_queue\_head);- snd\_card\_free(card);+ snd\_card\_free\_when\_closed(card); }  static int snd\_usx2y\_probe(struct usb\_interface \*intf, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:52:27 +0000


