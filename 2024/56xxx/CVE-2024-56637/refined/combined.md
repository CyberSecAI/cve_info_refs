=== Content from git.kernel.org_f53111df_20250114_184553.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=90bf312a6b6b3d6012137f6776a4052ee85e0340)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=90bf312a6b6b3d6012137f6776a4052ee85e0340)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=90bf312a6b6b3d6012137f6776a4052ee85e0340)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=90bf312a6b6b3d6012137f6776a4052ee85e0340)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Phil Sutter <phil@nwl.cc> | 2024-11-29 16:30:38 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:59:38 +0100 |
| commit | [90bf312a6b6b3d6012137f6776a4052ee85e0340](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=90bf312a6b6b3d6012137f6776a4052ee85e0340) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=90bf312a6b6b3d6012137f6776a4052ee85e0340)) | |
| tree | [aec46b7df607a5554afa6e82d0cc63e7c0cdf20a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=90bf312a6b6b3d6012137f6776a4052ee85e0340) | |
| parent | [f6dc30c4698d1ec3bc0e72d7361d9f8415da9767](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f6dc30c4698d1ec3bc0e72d7361d9f8415da9767) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=90bf312a6b6b3d6012137f6776a4052ee85e0340&id2=f6dc30c4698d1ec3bc0e72d7361d9f8415da9767)) | |
| download | [linux-90bf312a6b6b3d6012137f6776a4052ee85e0340.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-90bf312a6b6b3d6012137f6776a4052ee85e0340.tar.gz) | |

netfilter: ipset: Hold module reference while requesting a module[ Upstream commit 456f010bfaefde84d3390c755eedb1b0a5857c3c ]
User space may unload ip\_set.ko while it is itself requesting a set type
backend module, leading to a kernel crash. The race condition may be
provoked by inserting an mdelay() right after the nfnl\_unlock() call.
Fixes: a7b4f989a629 ("netfilter: ipset: IP set core support")
Signed-off-by: Phil Sutter <phil@nwl.cc>
Acked-by: Jozsef Kadlecsik <kadlec@netfilter.org>
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=90bf312a6b6b3d6012137f6776a4052ee85e0340)

| -rw-r--r-- | [net/netfilter/ipset/ip\_set\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/netfilter/ipset/ip_set_core.c?id=90bf312a6b6b3d6012137f6776a4052ee85e0340) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 0 deletions

| diff --git a/net/netfilter/ipset/ip\_set\_core.c b/net/netfilter/ipset/ip\_set\_core.cindex 61431690cbd5f1..cc20e6d56807c6 100644--- a/[net/netfilter/ipset/ip\_set\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_core.c?id=f6dc30c4698d1ec3bc0e72d7361d9f8415da9767)+++ b/[net/netfilter/ipset/ip\_set\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_core.c?id=90bf312a6b6b3d6012137f6776a4052ee85e0340)@@ -104,14 +104,19 @@ find\_set\_type(const char \*name, u8 family, u8 revision) static bool load\_settype(const char \*name) {+ if (!try\_module\_get(THIS\_MODULE))+ return false;+ nfnl\_unlock(NFNL\_SUBSYS\_IPSET); pr\_debug("try to load ip\_set\_%s\n", name); if (request\_module("ip\_set\_%s", name) < 0) { pr\_warn("Can't find ip\_set type %s\n", name); nfnl\_lock(NFNL\_SUBSYS\_IPSET);+ module\_put(THIS\_MODULE); return false; } nfnl\_lock(NFNL\_SUBSYS\_IPSET);+ module\_put(THIS\_MODULE); return true; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:44:30 +0000



=== Content from git.kernel.org_0cbd388d_20250114_184554.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e5e2d3024753fdaca818b822e3827614bacbdccf)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e5e2d3024753fdaca818b822e3827614bacbdccf)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e5e2d3024753fdaca818b822e3827614bacbdccf)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e5e2d3024753fdaca818b822e3827614bacbdccf)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Phil Sutter <phil@nwl.cc> | 2024-11-29 16:30:38 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:44:46 +0100 |
| commit | [e5e2d3024753fdaca818b822e3827614bacbdccf](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e5e2d3024753fdaca818b822e3827614bacbdccf) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e5e2d3024753fdaca818b822e3827614bacbdccf)) | |
| tree | [11427b797acc5b145c83e6b822d681f6532210ec](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e5e2d3024753fdaca818b822e3827614bacbdccf) | |
| parent | [4458046617dfadc351162dbaea1945c57eebdf36](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4458046617dfadc351162dbaea1945c57eebdf36) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e5e2d3024753fdaca818b822e3827614bacbdccf&id2=4458046617dfadc351162dbaea1945c57eebdf36)) | |
| download | [linux-e5e2d3024753fdaca818b822e3827614bacbdccf.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e5e2d3024753fdaca818b822e3827614bacbdccf.tar.gz) | |

netfilter: ipset: Hold module reference while requesting a module[ Upstream commit 456f010bfaefde84d3390c755eedb1b0a5857c3c ]
User space may unload ip\_set.ko while it is itself requesting a set type
backend module, leading to a kernel crash. The race condition may be
provoked by inserting an mdelay() right after the nfnl\_unlock() call.
Fixes: a7b4f989a629 ("netfilter: ipset: IP set core support")
Signed-off-by: Phil Sutter <phil@nwl.cc>
Acked-by: Jozsef Kadlecsik <kadlec@netfilter.org>
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e5e2d3024753fdaca818b822e3827614bacbdccf)

| -rw-r--r-- | [net/netfilter/ipset/ip\_set\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/netfilter/ipset/ip_set_core.c?id=e5e2d3024753fdaca818b822e3827614bacbdccf) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 0 deletions

| diff --git a/net/netfilter/ipset/ip\_set\_core.c b/net/netfilter/ipset/ip\_set\_core.cindex 83fa95ecaad47c..1ce19162ebf79b 100644--- a/[net/netfilter/ipset/ip\_set\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_core.c?id=4458046617dfadc351162dbaea1945c57eebdf36)+++ b/[net/netfilter/ipset/ip\_set\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_core.c?id=e5e2d3024753fdaca818b822e3827614bacbdccf)@@ -103,14 +103,19 @@ find\_set\_type(const char \*name, u8 family, u8 revision) static bool load\_settype(const char \*name) {+ if (!try\_module\_get(THIS\_MODULE))+ return false;+ nfnl\_unlock(NFNL\_SUBSYS\_IPSET); pr\_debug("try to load ip\_set\_%s\n", name); if (request\_module("ip\_set\_%s", name) < 0) { pr\_warn("Can't find ip\_set type %s\n", name); nfnl\_lock(NFNL\_SUBSYS\_IPSET);+ module\_put(THIS\_MODULE); return false; } nfnl\_lock(NFNL\_SUBSYS\_IPSET);+ module\_put(THIS\_MODULE); return true; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:44:31 +0000



=== Content from git.kernel.org_5fb08ef7_20250114_184552.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=5bae60a933ba5d16eed55c6b279be51bcbbc79b0)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5bae60a933ba5d16eed55c6b279be51bcbbc79b0)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5bae60a933ba5d16eed55c6b279be51bcbbc79b0)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5bae60a933ba5d16eed55c6b279be51bcbbc79b0)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Phil Sutter <phil@nwl.cc> | 2024-11-29 16:30:38 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:54:23 +0100 |
| commit | [5bae60a933ba5d16eed55c6b279be51bcbbc79b0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5bae60a933ba5d16eed55c6b279be51bcbbc79b0) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=5bae60a933ba5d16eed55c6b279be51bcbbc79b0)) | |
| tree | [a7be427252676cfde73351ab181efe50f7f565e8](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5bae60a933ba5d16eed55c6b279be51bcbbc79b0) | |
| parent | [082b0dac789a874ea1996e8438c42ce37de13b8b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=082b0dac789a874ea1996e8438c42ce37de13b8b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5bae60a933ba5d16eed55c6b279be51bcbbc79b0&id2=082b0dac789a874ea1996e8438c42ce37de13b8b)) | |
| download | [linux-5bae60a933ba5d16eed55c6b279be51bcbbc79b0.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-5bae60a933ba5d16eed55c6b279be51bcbbc79b0.tar.gz) | |

netfilter: ipset: Hold module reference while requesting a module[ Upstream commit 456f010bfaefde84d3390c755eedb1b0a5857c3c ]
User space may unload ip\_set.ko while it is itself requesting a set type
backend module, leading to a kernel crash. The race condition may be
provoked by inserting an mdelay() right after the nfnl\_unlock() call.
Fixes: a7b4f989a629 ("netfilter: ipset: IP set core support")
Signed-off-by: Phil Sutter <phil@nwl.cc>
Acked-by: Jozsef Kadlecsik <kadlec@netfilter.org>
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5bae60a933ba5d16eed55c6b279be51bcbbc79b0)

| -rw-r--r-- | [net/netfilter/ipset/ip\_set\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/netfilter/ipset/ip_set_core.c?id=5bae60a933ba5d16eed55c6b279be51bcbbc79b0) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 0 deletions

| diff --git a/net/netfilter/ipset/ip\_set\_core.c b/net/netfilter/ipset/ip\_set\_core.cindex 0b24b638bfd2ed..56215fb63b645e 100644--- a/[net/netfilter/ipset/ip\_set\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_core.c?id=082b0dac789a874ea1996e8438c42ce37de13b8b)+++ b/[net/netfilter/ipset/ip\_set\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_core.c?id=5bae60a933ba5d16eed55c6b279be51bcbbc79b0)@@ -104,14 +104,19 @@ find\_set\_type(const char \*name, u8 family, u8 revision) static bool load\_settype(const char \*name) {+ if (!try\_module\_get(THIS\_MODULE))+ return false;+ nfnl\_unlock(NFNL\_SUBSYS\_IPSET); pr\_debug("try to load ip\_set\_%s\n", name); if (request\_module("ip\_set\_%s", name) < 0) { pr\_warn("Can't find ip\_set type %s\n", name); nfnl\_lock(NFNL\_SUBSYS\_IPSET);+ module\_put(THIS\_MODULE); return false; } nfnl\_lock(NFNL\_SUBSYS\_IPSET);+ module\_put(THIS\_MODULE); return true; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:44:29 +0000



=== Content from git.kernel.org_a4872bd0_20250114_184551.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=0e67805e805c1f3edd6f43adbe08ea14b552694b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0e67805e805c1f3edd6f43adbe08ea14b552694b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0e67805e805c1f3edd6f43adbe08ea14b552694b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0e67805e805c1f3edd6f43adbe08ea14b552694b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Phil Sutter <phil@nwl.cc> | 2024-11-29 16:30:38 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:51:28 +0100 |
| commit | [0e67805e805c1f3edd6f43adbe08ea14b552694b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0e67805e805c1f3edd6f43adbe08ea14b552694b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=0e67805e805c1f3edd6f43adbe08ea14b552694b)) | |
| tree | [5744321446fe8b10af9a6c845839a0558b8c1872](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0e67805e805c1f3edd6f43adbe08ea14b552694b) | |
| parent | [c7d644f76949ff3b103787bab070108fec6c2165](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c7d644f76949ff3b103787bab070108fec6c2165) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0e67805e805c1f3edd6f43adbe08ea14b552694b&id2=c7d644f76949ff3b103787bab070108fec6c2165)) | |
| download | [linux-0e67805e805c1f3edd6f43adbe08ea14b552694b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-0e67805e805c1f3edd6f43adbe08ea14b552694b.tar.gz) | |

netfilter: ipset: Hold module reference while requesting a module[ Upstream commit 456f010bfaefde84d3390c755eedb1b0a5857c3c ]
User space may unload ip\_set.ko while it is itself requesting a set type
backend module, leading to a kernel crash. The race condition may be
provoked by inserting an mdelay() right after the nfnl\_unlock() call.
Fixes: a7b4f989a629 ("netfilter: ipset: IP set core support")
Signed-off-by: Phil Sutter <phil@nwl.cc>
Acked-by: Jozsef Kadlecsik <kadlec@netfilter.org>
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0e67805e805c1f3edd6f43adbe08ea14b552694b)

| -rw-r--r-- | [net/netfilter/ipset/ip\_set\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/netfilter/ipset/ip_set_core.c?id=0e67805e805c1f3edd6f43adbe08ea14b552694b) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 0 deletions

| diff --git a/net/netfilter/ipset/ip\_set\_core.c b/net/netfilter/ipset/ip\_set\_core.cindex f2f6b7325c706e..72e5638206c0e4 100644--- a/[net/netfilter/ipset/ip\_set\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_core.c?id=c7d644f76949ff3b103787bab070108fec6c2165)+++ b/[net/netfilter/ipset/ip\_set\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_core.c?id=0e67805e805c1f3edd6f43adbe08ea14b552694b)@@ -104,14 +104,19 @@ find\_set\_type(const char \*name, u8 family, u8 revision) static bool load\_settype(const char \*name) {+ if (!try\_module\_get(THIS\_MODULE))+ return false;+ nfnl\_unlock(NFNL\_SUBSYS\_IPSET); pr\_debug("try to load ip\_set\_%s\n", name); if (request\_module("ip\_set\_%s", name) < 0) { pr\_warn("Can't find ip\_set type %s\n", name); nfnl\_lock(NFNL\_SUBSYS\_IPSET);+ module\_put(THIS\_MODULE); return false; } nfnl\_lock(NFNL\_SUBSYS\_IPSET);+ module\_put(THIS\_MODULE); return true; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:44:28 +0000



=== Content from git.kernel.org_a5ad9898_20250114_184552.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=456f010bfaefde84d3390c755eedb1b0a5857c3c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=456f010bfaefde84d3390c755eedb1b0a5857c3c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=456f010bfaefde84d3390c755eedb1b0a5857c3c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=456f010bfaefde84d3390c755eedb1b0a5857c3c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Phil Sutter <phil@nwl.cc> | 2024-11-29 16:30:38 +0100 |
| --- | --- | --- |
| committer | Pablo Neira Ayuso <pablo@netfilter.org> | 2024-12-04 15:39:22 +0100 |
| commit | [456f010bfaefde84d3390c755eedb1b0a5857c3c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=456f010bfaefde84d3390c755eedb1b0a5857c3c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=456f010bfaefde84d3390c755eedb1b0a5857c3c)) | |
| tree | [91bf2f49fc03be087674f0b33deb94c875ff6959](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=456f010bfaefde84d3390c755eedb1b0a5857c3c) | |
| parent | [7b1d83da254be3bf054965c8f3b1ad976f460ae5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7b1d83da254be3bf054965c8f3b1ad976f460ae5) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=456f010bfaefde84d3390c755eedb1b0a5857c3c&id2=7b1d83da254be3bf054965c8f3b1ad976f460ae5)) | |
| download | [linux-456f010bfaefde84d3390c755eedb1b0a5857c3c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-456f010bfaefde84d3390c755eedb1b0a5857c3c.tar.gz) | |

netfilter: ipset: Hold module reference while requesting a moduleUser space may unload ip\_set.ko while it is itself requesting a set type
backend module, leading to a kernel crash. The race condition may be
provoked by inserting an mdelay() right after the nfnl\_unlock() call.
Fixes: a7b4f989a629 ("netfilter: ipset: IP set core support")
Signed-off-by: Phil Sutter <phil@nwl.cc>
Acked-by: Jozsef Kadlecsik <kadlec@netfilter.org>
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=456f010bfaefde84d3390c755eedb1b0a5857c3c)

| -rw-r--r-- | [net/netfilter/ipset/ip\_set\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/netfilter/ipset/ip_set_core.c?id=456f010bfaefde84d3390c755eedb1b0a5857c3c) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 0 deletions

| diff --git a/net/netfilter/ipset/ip\_set\_core.c b/net/netfilter/ipset/ip\_set\_core.cindex 61431690cbd5f1..cc20e6d56807c6 100644--- a/[net/netfilter/ipset/ip\_set\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_core.c?id=7b1d83da254be3bf054965c8f3b1ad976f460ae5)+++ b/[net/netfilter/ipset/ip\_set\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_core.c?id=456f010bfaefde84d3390c755eedb1b0a5857c3c)@@ -104,14 +104,19 @@ find\_set\_type(const char \*name, u8 family, u8 revision) static bool load\_settype(const char \*name) {+ if (!try\_module\_get(THIS\_MODULE))+ return false;+ nfnl\_unlock(NFNL\_SUBSYS\_IPSET); pr\_debug("try to load ip\_set\_%s\n", name); if (request\_module("ip\_set\_%s", name) < 0) { pr\_warn("Can't find ip\_set type %s\n", name); nfnl\_lock(NFNL\_SUBSYS\_IPSET);+ module\_put(THIS\_MODULE); return false; } nfnl\_lock(NFNL\_SUBSYS\_IPSET);+ module\_put(THIS\_MODULE); return true; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:44:28 +0000



=== Content from git.kernel.org_8b92a09e_20250114_184552.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=6099b5d3e37145484fac4b8b4070c3f1abfb3519)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6099b5d3e37145484fac4b8b4070c3f1abfb3519)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6099b5d3e37145484fac4b8b4070c3f1abfb3519)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6099b5d3e37145484fac4b8b4070c3f1abfb3519)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Phil Sutter <phil@nwl.cc> | 2024-11-29 16:30:38 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:48:20 +0100 |
| commit | [6099b5d3e37145484fac4b8b4070c3f1abfb3519](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6099b5d3e37145484fac4b8b4070c3f1abfb3519) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=6099b5d3e37145484fac4b8b4070c3f1abfb3519)) | |
| tree | [6845b48eaa733dfd37aa35edee3de20d8415fb88](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6099b5d3e37145484fac4b8b4070c3f1abfb3519) | |
| parent | [98ea587a40484f2286efcb8baa94024bf3b7f438](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=98ea587a40484f2286efcb8baa94024bf3b7f438) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6099b5d3e37145484fac4b8b4070c3f1abfb3519&id2=98ea587a40484f2286efcb8baa94024bf3b7f438)) | |
| download | [linux-6099b5d3e37145484fac4b8b4070c3f1abfb3519.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-6099b5d3e37145484fac4b8b4070c3f1abfb3519.tar.gz) | |

netfilter: ipset: Hold module reference while requesting a module[ Upstream commit 456f010bfaefde84d3390c755eedb1b0a5857c3c ]
User space may unload ip\_set.ko while it is itself requesting a set type
backend module, leading to a kernel crash. The race condition may be
provoked by inserting an mdelay() right after the nfnl\_unlock() call.
Fixes: a7b4f989a629 ("netfilter: ipset: IP set core support")
Signed-off-by: Phil Sutter <phil@nwl.cc>
Acked-by: Jozsef Kadlecsik <kadlec@netfilter.org>
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6099b5d3e37145484fac4b8b4070c3f1abfb3519)

| -rw-r--r-- | [net/netfilter/ipset/ip\_set\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/netfilter/ipset/ip_set_core.c?id=6099b5d3e37145484fac4b8b4070c3f1abfb3519) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 0 deletions

| diff --git a/net/netfilter/ipset/ip\_set\_core.c b/net/netfilter/ipset/ip\_set\_core.cindex bac92369a5436c..a265efd31ba964 100644--- a/[net/netfilter/ipset/ip\_set\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_core.c?id=98ea587a40484f2286efcb8baa94024bf3b7f438)+++ b/[net/netfilter/ipset/ip\_set\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_core.c?id=6099b5d3e37145484fac4b8b4070c3f1abfb3519)@@ -104,14 +104,19 @@ find\_set\_type(const char \*name, u8 family, u8 revision) static bool load\_settype(const char \*name) {+ if (!try\_module\_get(THIS\_MODULE))+ return false;+ nfnl\_unlock(NFNL\_SUBSYS\_IPSET); pr\_debug("try to load ip\_set\_%s\n", name); if (request\_module("ip\_set\_%s", name) < 0) { pr\_warn("Can't find ip\_set type %s\n", name); nfnl\_lock(NFNL\_SUBSYS\_IPSET);+ module\_put(THIS\_MODULE); return false; } nfnl\_lock(NFNL\_SUBSYS\_IPSET);+ module\_put(THIS\_MODULE); return true; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:44:30 +0000



=== Content from git.kernel.org_4eb4fc35_20250114_184553.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ba5e070f36682d07ca7ad2a953e6c9d96be19dca)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ba5e070f36682d07ca7ad2a953e6c9d96be19dca)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ba5e070f36682d07ca7ad2a953e6c9d96be19dca)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ba5e070f36682d07ca7ad2a953e6c9d96be19dca)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Phil Sutter <phil@nwl.cc> | 2024-11-29 16:30:38 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 20:03:08 +0100 |
| commit | [ba5e070f36682d07ca7ad2a953e6c9d96be19dca](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ba5e070f36682d07ca7ad2a953e6c9d96be19dca) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ba5e070f36682d07ca7ad2a953e6c9d96be19dca)) | |
| tree | [0d3240828ec5730df70e7ab17583798a497d1973](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ba5e070f36682d07ca7ad2a953e6c9d96be19dca) | |
| parent | [152a8c179f2e812562e1333a1b24b2623db7dbd5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=152a8c179f2e812562e1333a1b24b2623db7dbd5) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ba5e070f36682d07ca7ad2a953e6c9d96be19dca&id2=152a8c179f2e812562e1333a1b24b2623db7dbd5)) | |
| download | [linux-ba5e070f36682d07ca7ad2a953e6c9d96be19dca.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ba5e070f36682d07ca7ad2a953e6c9d96be19dca.tar.gz) | |

netfilter: ipset: Hold module reference while requesting a module[ Upstream commit 456f010bfaefde84d3390c755eedb1b0a5857c3c ]
User space may unload ip\_set.ko while it is itself requesting a set type
backend module, leading to a kernel crash. The race condition may be
provoked by inserting an mdelay() right after the nfnl\_unlock() call.
Fixes: a7b4f989a629 ("netfilter: ipset: IP set core support")
Signed-off-by: Phil Sutter <phil@nwl.cc>
Acked-by: Jozsef Kadlecsik <kadlec@netfilter.org>
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ba5e070f36682d07ca7ad2a953e6c9d96be19dca)

| -rw-r--r-- | [net/netfilter/ipset/ip\_set\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/netfilter/ipset/ip_set_core.c?id=ba5e070f36682d07ca7ad2a953e6c9d96be19dca) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 0 deletions

| diff --git a/net/netfilter/ipset/ip\_set\_core.c b/net/netfilter/ipset/ip\_set\_core.cindex 61431690cbd5f1..cc20e6d56807c6 100644--- a/[net/netfilter/ipset/ip\_set\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_core.c?id=152a8c179f2e812562e1333a1b24b2623db7dbd5)+++ b/[net/netfilter/ipset/ip\_set\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_core.c?id=ba5e070f36682d07ca7ad2a953e6c9d96be19dca)@@ -104,14 +104,19 @@ find\_set\_type(const char \*name, u8 family, u8 revision) static bool load\_settype(const char \*name) {+ if (!try\_module\_get(THIS\_MODULE))+ return false;+ nfnl\_unlock(NFNL\_SUBSYS\_IPSET); pr\_debug("try to load ip\_set\_%s\n", name); if (request\_module("ip\_set\_%s", name) < 0) { pr\_warn("Can't find ip\_set type %s\n", name); nfnl\_lock(NFNL\_SUBSYS\_IPSET);+ module\_put(THIS\_MODULE); return false; } nfnl\_lock(NFNL\_SUBSYS\_IPSET);+ module\_put(THIS\_MODULE); return true; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:44:31 +0000


