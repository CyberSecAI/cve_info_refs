=== Content from git.kernel.org_ae4c35e9_20250114_200635.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=543d0eb40e45c6a51f1bff02f417b602e54472d5)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=543d0eb40e45c6a51f1bff02f417b602e54472d5)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=543d0eb40e45c6a51f1bff02f417b602e54472d5)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=543d0eb40e45c6a51f1bff02f417b602e54472d5)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Todd Kjos <tkjos@google.com> | 2024-10-01 23:11:47 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 13:53:45 +0100 |
| commit | [543d0eb40e45c6a51f1bff02f417b602e54472d5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=543d0eb40e45c6a51f1bff02f417b602e54472d5) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=543d0eb40e45c6a51f1bff02f417b602e54472d5)) | |
| tree | [dfe81d50ca3be5675c877eb1a6b91b0887f0877e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=543d0eb40e45c6a51f1bff02f417b602e54472d5) | |
| parent | [734118ac8aeec068afa66d307cc8be87e6719fa6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=734118ac8aeec068afa66d307cc8be87e6719fa6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=543d0eb40e45c6a51f1bff02f417b602e54472d5&id2=734118ac8aeec068afa66d307cc8be87e6719fa6)) | |
| download | [linux-543d0eb40e45c6a51f1bff02f417b602e54472d5.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-543d0eb40e45c6a51f1bff02f417b602e54472d5.tar.gz) | |

PCI: Fix reset\_method\_store() memory leak[ Upstream commit 2985b1844f3f3447f2d938eff1ef6762592065a5 ]
In reset\_method\_store(), a string is allocated via kstrndup() and assigned
to the local "options". options is then used in with strsep() to find
spaces:
while ((name = strsep(&options, " ")) != NULL) {
If there are no remaining spaces, then options is set to NULL by strsep(),
so the subsequent kfree(options) doesn't free the memory allocated via
kstrndup().
Fix by using a separate tmp\_options to iterate with strsep() so options is
preserved.
Link: [https://lore.kernel.org/r/20241001231147.3583649-1-tkjos@google.com](https://lore.kernel.org/r/20241001231147.3583649-1-tkjos%40google.com)
Fixes: d88f521da3ef ("PCI: Allow userspace to query and set device reset mechanism")
Signed-off-by: Todd Kjos <tkjos@google.com>
Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=543d0eb40e45c6a51f1bff02f417b602e54472d5)

| -rw-r--r-- | [drivers/pci/pci.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/pci/pci.c?id=543d0eb40e45c6a51f1bff02f417b602e54472d5) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 2 deletions

| diff --git a/drivers/pci/pci.c b/drivers/pci/pci.cindex 51407c376a2227..1a720cae37a1ec 100644--- a/[drivers/pci/pci.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/pci.c?id=734118ac8aeec068afa66d307cc8be87e6719fa6)+++ b/[drivers/pci/pci.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/pci.c?id=543d0eb40e45c6a51f1bff02f417b602e54472d5)@@ -5233,7 +5233,7 @@ static ssize\_t reset\_method\_store(struct device \*dev, const char \*buf, size\_t count) { struct pci\_dev \*pdev = to\_pci\_dev(dev);- char \*options, \*name;+ char \*options, \*tmp\_options, \*name; int m, n; u8 reset\_methods[PCI\_NUM\_RESET\_METHODS] = { 0 }; @@ -5253,7 +5253,8 @@ static ssize\_t reset\_method\_store(struct device \*dev, return -ENOMEM;  n = 0;- while ((name = strsep(&options, " ")) != NULL) {+ tmp\_options = options;+ while ((name = strsep(&tmp\_options, " ")) != NULL) { if (sysfs\_streq(name, "")) continue; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:05:13 +0000



=== Content from git.kernel.org_1924016c_20250114_200633.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2985b1844f3f3447f2d938eff1ef6762592065a5)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2985b1844f3f3447f2d938eff1ef6762592065a5)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2985b1844f3f3447f2d938eff1ef6762592065a5)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2985b1844f3f3447f2d938eff1ef6762592065a5)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Todd Kjos <tkjos@google.com> | 2024-10-01 23:11:47 +0000 |
| --- | --- | --- |
| committer | Bjorn Helgaas <bhelgaas@google.com> | 2024-10-02 16:36:35 -0500 |
| commit | [2985b1844f3f3447f2d938eff1ef6762592065a5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2985b1844f3f3447f2d938eff1ef6762592065a5) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2985b1844f3f3447f2d938eff1ef6762592065a5)) | |
| tree | [9d96384fd76542bbb4d44a03cce7e613e0c1a10a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2985b1844f3f3447f2d938eff1ef6762592065a5) | |
| parent | [43ee11adcb940204948ac0ca3a05d6178f0e8b08](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=43ee11adcb940204948ac0ca3a05d6178f0e8b08) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2985b1844f3f3447f2d938eff1ef6762592065a5&id2=43ee11adcb940204948ac0ca3a05d6178f0e8b08)) | |
| download | [linux-2985b1844f3f3447f2d938eff1ef6762592065a5.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2985b1844f3f3447f2d938eff1ef6762592065a5.tar.gz) | |

PCI: Fix reset\_method\_store() memory leakIn reset\_method\_store(), a string is allocated via kstrndup() and assigned
to the local "options". options is then used in with strsep() to find
spaces:
while ((name = strsep(&options, " ")) != NULL) {
If there are no remaining spaces, then options is set to NULL by strsep(),
so the subsequent kfree(options) doesn't free the memory allocated via
kstrndup().
Fix by using a separate tmp\_options to iterate with strsep() so options is
preserved.
Link: [https://lore.kernel.org/r/20241001231147.3583649-1-tkjos@google.com](https://lore.kernel.org/r/20241001231147.3583649-1-tkjos%40google.com)
Fixes: d88f521da3ef ("PCI: Allow userspace to query and set device reset mechanism")
Signed-off-by: Todd Kjos <tkjos@google.com>
Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2985b1844f3f3447f2d938eff1ef6762592065a5)

| -rw-r--r-- | [drivers/pci/pci.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/pci/pci.c?id=2985b1844f3f3447f2d938eff1ef6762592065a5) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 2 deletions

| diff --git a/drivers/pci/pci.c b/drivers/pci/pci.cindex 7d85c04fbba2ae..0e6562ff3dcf89 100644--- a/[drivers/pci/pci.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/pci.c?id=43ee11adcb940204948ac0ca3a05d6178f0e8b08)+++ b/[drivers/pci/pci.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/pci.c?id=2985b1844f3f3447f2d938eff1ef6762592065a5)@@ -5244,7 +5244,7 @@ static ssize\_t reset\_method\_store(struct device \*dev, const char \*buf, size\_t count) { struct pci\_dev \*pdev = to\_pci\_dev(dev);- char \*options, \*name;+ char \*options, \*tmp\_options, \*name; int m, n; u8 reset\_methods[PCI\_NUM\_RESET\_METHODS] = { 0 }; @@ -5264,7 +5264,8 @@ static ssize\_t reset\_method\_store(struct device \*dev, return -ENOMEM;  n = 0;- while ((name = strsep(&options, " ")) != NULL) {+ tmp\_options = options;+ while ((name = strsep(&tmp\_options, " ")) != NULL) { if (sysfs\_streq(name, "")) continue; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:05:10 +0000



=== Content from git.kernel.org_7d04fcec_20250114_200634.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=403efb4457c0c8f8f51e904cc57d39193780c6bd)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=403efb4457c0c8f8f51e904cc57d39193780c6bd)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=403efb4457c0c8f8f51e904cc57d39193780c6bd)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=403efb4457c0c8f8f51e904cc57d39193780c6bd)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Todd Kjos <tkjos@google.com> | 2024-10-01 23:11:47 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:51:04 +0100 |
| commit | [403efb4457c0c8f8f51e904cc57d39193780c6bd](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=403efb4457c0c8f8f51e904cc57d39193780c6bd) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=403efb4457c0c8f8f51e904cc57d39193780c6bd)) | |
| tree | [8963f968a934bcd27bcd156ecaf1c96faeb462b2](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=403efb4457c0c8f8f51e904cc57d39193780c6bd) | |
| parent | [656af7b3dcf1442308ffbea242406d8d4eeb0fa4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=656af7b3dcf1442308ffbea242406d8d4eeb0fa4) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=403efb4457c0c8f8f51e904cc57d39193780c6bd&id2=656af7b3dcf1442308ffbea242406d8d4eeb0fa4)) | |
| download | [linux-403efb4457c0c8f8f51e904cc57d39193780c6bd.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-403efb4457c0c8f8f51e904cc57d39193780c6bd.tar.gz) | |

PCI: Fix reset\_method\_store() memory leak[ Upstream commit 2985b1844f3f3447f2d938eff1ef6762592065a5 ]
In reset\_method\_store(), a string is allocated via kstrndup() and assigned
to the local "options". options is then used in with strsep() to find
spaces:
while ((name = strsep(&options, " ")) != NULL) {
If there are no remaining spaces, then options is set to NULL by strsep(),
so the subsequent kfree(options) doesn't free the memory allocated via
kstrndup().
Fix by using a separate tmp\_options to iterate with strsep() so options is
preserved.
Link: [https://lore.kernel.org/r/20241001231147.3583649-1-tkjos@google.com](https://lore.kernel.org/r/20241001231147.3583649-1-tkjos%40google.com)
Fixes: d88f521da3ef ("PCI: Allow userspace to query and set device reset mechanism")
Signed-off-by: Todd Kjos <tkjos@google.com>
Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=403efb4457c0c8f8f51e904cc57d39193780c6bd)

| -rw-r--r-- | [drivers/pci/pci.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/pci/pci.c?id=403efb4457c0c8f8f51e904cc57d39193780c6bd) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 2 deletions

| diff --git a/drivers/pci/pci.c b/drivers/pci/pci.cindex ee1d74f89a05f8..09d1b697466029 100644--- a/[drivers/pci/pci.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/pci.c?id=656af7b3dcf1442308ffbea242406d8d4eeb0fa4)+++ b/[drivers/pci/pci.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/pci.c?id=403efb4457c0c8f8f51e904cc57d39193780c6bd)@@ -5214,7 +5214,7 @@ static ssize\_t reset\_method\_store(struct device \*dev, const char \*buf, size\_t count) { struct pci\_dev \*pdev = to\_pci\_dev(dev);- char \*options, \*name;+ char \*options, \*tmp\_options, \*name; int m, n; u8 reset\_methods[PCI\_NUM\_RESET\_METHODS] = { 0 }; @@ -5234,7 +5234,8 @@ static ssize\_t reset\_method\_store(struct device \*dev, return -ENOMEM;  n = 0;- while ((name = strsep(&options, " ")) != NULL) {+ tmp\_options = options;+ while ((name = strsep(&tmp\_options, " ")) != NULL) { if (sysfs\_streq(name, "")) continue; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:05:11 +0000



=== Content from git.kernel.org_70f8ea2c_20250114_200636.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8e098baf6bc3f3a6aefc383509aba07e202f7ee0)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8e098baf6bc3f3a6aefc383509aba07e202f7ee0)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8e098baf6bc3f3a6aefc383509aba07e202f7ee0)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8e098baf6bc3f3a6aefc383509aba07e202f7ee0)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Todd Kjos <tkjos@google.com> | 2024-10-01 23:11:47 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-09 10:32:24 +0100 |
| commit | [8e098baf6bc3f3a6aefc383509aba07e202f7ee0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8e098baf6bc3f3a6aefc383509aba07e202f7ee0) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8e098baf6bc3f3a6aefc383509aba07e202f7ee0)) | |
| tree | [b50d32566199e03bf524f45d73b4a829da83b574](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8e098baf6bc3f3a6aefc383509aba07e202f7ee0) | |
| parent | [e30cab288c8d9bb505a15d0da74f5ffaca268992](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e30cab288c8d9bb505a15d0da74f5ffaca268992) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8e098baf6bc3f3a6aefc383509aba07e202f7ee0&id2=e30cab288c8d9bb505a15d0da74f5ffaca268992)) | |
| download | [linux-8e098baf6bc3f3a6aefc383509aba07e202f7ee0.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8e098baf6bc3f3a6aefc383509aba07e202f7ee0.tar.gz) | |

PCI: Fix reset\_method\_store() memory leak[ Upstream commit 2985b1844f3f3447f2d938eff1ef6762592065a5 ]
In reset\_method\_store(), a string is allocated via kstrndup() and assigned
to the local "options". options is then used in with strsep() to find
spaces:
while ((name = strsep(&options, " ")) != NULL) {
If there are no remaining spaces, then options is set to NULL by strsep(),
so the subsequent kfree(options) doesn't free the memory allocated via
kstrndup().
Fix by using a separate tmp\_options to iterate with strsep() so options is
preserved.
Link: [https://lore.kernel.org/r/20241001231147.3583649-1-tkjos@google.com](https://lore.kernel.org/r/20241001231147.3583649-1-tkjos%40google.com)
Fixes: d88f521da3ef ("PCI: Allow userspace to query and set device reset mechanism")
Signed-off-by: Todd Kjos <tkjos@google.com>
Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8e098baf6bc3f3a6aefc383509aba07e202f7ee0)

| -rw-r--r-- | [drivers/pci/pci.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/pci/pci.c?id=8e098baf6bc3f3a6aefc383509aba07e202f7ee0) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 2 deletions

| diff --git a/drivers/pci/pci.c b/drivers/pci/pci.cindex 93f2f4dcf6d696..830877efe50597 100644--- a/[drivers/pci/pci.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/pci.c?id=e30cab288c8d9bb505a15d0da74f5ffaca268992)+++ b/[drivers/pci/pci.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/pci.c?id=8e098baf6bc3f3a6aefc383509aba07e202f7ee0)@@ -5444,7 +5444,7 @@ static ssize\_t reset\_method\_store(struct device \*dev, const char \*buf, size\_t count) { struct pci\_dev \*pdev = to\_pci\_dev(dev);- char \*options, \*name;+ char \*options, \*tmp\_options, \*name; int m, n; u8 reset\_methods[PCI\_NUM\_RESET\_METHODS] = { 0 }; @@ -5464,7 +5464,8 @@ static ssize\_t reset\_method\_store(struct device \*dev, return -ENOMEM;  n = 0;- while ((name = strsep(&options, " ")) != NULL) {+ tmp\_options = options;+ while ((name = strsep(&tmp\_options, " ")) != NULL) { if (sysfs\_streq(name, "")) continue; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:05:13 +0000



=== Content from git.kernel.org_37e19399_20250114_200637.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=931d07ccffcc3614f20aaf602b31e89754e21c59)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=931d07ccffcc3614f20aaf602b31e89754e21c59)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=931d07ccffcc3614f20aaf602b31e89754e21c59)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=931d07ccffcc3614f20aaf602b31e89754e21c59)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Todd Kjos <tkjos@google.com> | 2024-10-01 23:11:47 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:53:43 +0100 |
| commit | [931d07ccffcc3614f20aaf602b31e89754e21c59](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=931d07ccffcc3614f20aaf602b31e89754e21c59) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=931d07ccffcc3614f20aaf602b31e89754e21c59)) | |
| tree | [9c4a404c056bbb723209593074e4e90fb05c7a1d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=931d07ccffcc3614f20aaf602b31e89754e21c59) | |
| parent | [4fe12d6bf73ac4a5ef08334b28db30bcb029c357](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4fe12d6bf73ac4a5ef08334b28db30bcb029c357) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=931d07ccffcc3614f20aaf602b31e89754e21c59&id2=4fe12d6bf73ac4a5ef08334b28db30bcb029c357)) | |
| download | [linux-931d07ccffcc3614f20aaf602b31e89754e21c59.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-931d07ccffcc3614f20aaf602b31e89754e21c59.tar.gz) | |

PCI: Fix reset\_method\_store() memory leak[ Upstream commit 2985b1844f3f3447f2d938eff1ef6762592065a5 ]
In reset\_method\_store(), a string is allocated via kstrndup() and assigned
to the local "options". options is then used in with strsep() to find
spaces:
while ((name = strsep(&options, " ")) != NULL) {
If there are no remaining spaces, then options is set to NULL by strsep(),
so the subsequent kfree(options) doesn't free the memory allocated via
kstrndup().
Fix by using a separate tmp\_options to iterate with strsep() so options is
preserved.
Link: [https://lore.kernel.org/r/20241001231147.3583649-1-tkjos@google.com](https://lore.kernel.org/r/20241001231147.3583649-1-tkjos%40google.com)
Fixes: d88f521da3ef ("PCI: Allow userspace to query and set device reset mechanism")
Signed-off-by: Todd Kjos <tkjos@google.com>
Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=931d07ccffcc3614f20aaf602b31e89754e21c59)

| -rw-r--r-- | [drivers/pci/pci.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/pci/pci.c?id=931d07ccffcc3614f20aaf602b31e89754e21c59) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 2 deletions

| diff --git a/drivers/pci/pci.c b/drivers/pci/pci.cindex 0baf5c03ef4cb8..e08354b811073f 100644--- a/[drivers/pci/pci.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/pci.c?id=4fe12d6bf73ac4a5ef08334b28db30bcb029c357)+++ b/[drivers/pci/pci.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/pci.c?id=931d07ccffcc3614f20aaf602b31e89754e21c59)@@ -5308,7 +5308,7 @@ static ssize\_t reset\_method\_store(struct device \*dev, const char \*buf, size\_t count) { struct pci\_dev \*pdev = to\_pci\_dev(dev);- char \*options, \*name;+ char \*options, \*tmp\_options, \*name; int m, n; u8 reset\_methods[PCI\_NUM\_RESET\_METHODS] = { 0 }; @@ -5328,7 +5328,8 @@ static ssize\_t reset\_method\_store(struct device \*dev, return -ENOMEM;  n = 0;- while ((name = strsep(&options, " ")) != NULL) {+ tmp\_options = options;+ while ((name = strsep(&tmp\_options, " ")) != NULL) { if (sysfs\_streq(name, "")) continue; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:05:14 +0000



=== Content from git.kernel.org_1a1d7f09_20250114_200638.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=fe6fae61f3b993160aef5fe2b7141a83872c144f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fe6fae61f3b993160aef5fe2b7141a83872c144f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fe6fae61f3b993160aef5fe2b7141a83872c144f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fe6fae61f3b993160aef5fe2b7141a83872c144f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Todd Kjos <tkjos@google.com> | 2024-10-01 23:11:47 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 14:02:18 +0100 |
| commit | [fe6fae61f3b993160aef5fe2b7141a83872c144f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fe6fae61f3b993160aef5fe2b7141a83872c144f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=fe6fae61f3b993160aef5fe2b7141a83872c144f)) | |
| tree | [e3fe6ef14b7eef84f3078b9ab2b521d3002e89c4](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fe6fae61f3b993160aef5fe2b7141a83872c144f) | |
| parent | [18259d272b4badefa662cfc604a919e0a630069a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=18259d272b4badefa662cfc604a919e0a630069a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fe6fae61f3b993160aef5fe2b7141a83872c144f&id2=18259d272b4badefa662cfc604a919e0a630069a)) | |
| download | [linux-fe6fae61f3b993160aef5fe2b7141a83872c144f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-fe6fae61f3b993160aef5fe2b7141a83872c144f.tar.gz) | |

PCI: Fix reset\_method\_store() memory leak[ Upstream commit 2985b1844f3f3447f2d938eff1ef6762592065a5 ]
In reset\_method\_store(), a string is allocated via kstrndup() and assigned
to the local "options". options is then used in with strsep() to find
spaces:
while ((name = strsep(&options, " ")) != NULL) {
If there are no remaining spaces, then options is set to NULL by strsep(),
so the subsequent kfree(options) doesn't free the memory allocated via
kstrndup().
Fix by using a separate tmp\_options to iterate with strsep() so options is
preserved.
Link: [https://lore.kernel.org/r/20241001231147.3583649-1-tkjos@google.com](https://lore.kernel.org/r/20241001231147.3583649-1-tkjos%40google.com)
Fixes: d88f521da3ef ("PCI: Allow userspace to query and set device reset mechanism")
Signed-off-by: Todd Kjos <tkjos@google.com>
Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fe6fae61f3b993160aef5fe2b7141a83872c144f)

| -rw-r--r-- | [drivers/pci/pci.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/pci/pci.c?id=fe6fae61f3b993160aef5fe2b7141a83872c144f) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 2 deletions

| diff --git a/drivers/pci/pci.c b/drivers/pci/pci.cindex 225a6cd2e9ca3b..08f170fd3efb3e 100644--- a/[drivers/pci/pci.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/pci.c?id=18259d272b4badefa662cfc604a919e0a630069a)+++ b/[drivers/pci/pci.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/pci.c?id=fe6fae61f3b993160aef5fe2b7141a83872c144f)@@ -5248,7 +5248,7 @@ static ssize\_t reset\_method\_store(struct device \*dev, const char \*buf, size\_t count) { struct pci\_dev \*pdev = to\_pci\_dev(dev);- char \*options, \*name;+ char \*options, \*tmp\_options, \*name; int m, n; u8 reset\_methods[PCI\_NUM\_RESET\_METHODS] = { 0 }; @@ -5268,7 +5268,8 @@ static ssize\_t reset\_method\_store(struct device \*dev, return -ENOMEM;  n = 0;- while ((name = strsep(&options, " ")) != NULL) {+ tmp\_options = options;+ while ((name = strsep(&tmp\_options, " ")) != NULL) { if (sysfs\_streq(name, "")) continue; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:05:15 +0000


