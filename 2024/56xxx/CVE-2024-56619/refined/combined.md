=== Content from git.kernel.org_537769f5_20250114_224016.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e3732102a9d638d8627d14fdf7b208462f0520e0)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e3732102a9d638d8627d14fdf7b208462f0520e0)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e3732102a9d638d8627d14fdf7b208462f0520e0)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e3732102a9d638d8627d14fdf7b208462f0520e0)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ryusuke Konishi <konishi.ryusuke@gmail.com> | 2024-11-20 02:23:37 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:48:24 +0100 |
| commit | [e3732102a9d638d8627d14fdf7b208462f0520e0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e3732102a9d638d8627d14fdf7b208462f0520e0) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e3732102a9d638d8627d14fdf7b208462f0520e0)) | |
| tree | [8de8315a47f922579db332d8043b7280dba80cd4](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e3732102a9d638d8627d14fdf7b208462f0520e0) | |
| parent | [df43d8da6bacf74c34f74012f21a82cd02a6bd3f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=df43d8da6bacf74c34f74012f21a82cd02a6bd3f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e3732102a9d638d8627d14fdf7b208462f0520e0&id2=df43d8da6bacf74c34f74012f21a82cd02a6bd3f)) | |
| download | [linux-e3732102a9d638d8627d14fdf7b208462f0520e0.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e3732102a9d638d8627d14fdf7b208462f0520e0.tar.gz) | |

nilfs2: fix potential out-of-bounds memory access in nilfs\_find\_entry()commit 985ebec4ab0a28bb5910c3b1481a40fbf7f9e61d upstream.
Syzbot reported that when searching for records in a directory where the
inode's i\_size is corrupted and has a large value, memory access outside
the folio/page range may occur, or a use-after-free bug may be detected if
KASAN is enabled.
This is because nilfs\_last\_byte(), which is called by nilfs\_find\_entry()
and others to calculate the number of valid bytes of directory data in a
page from i\_size and the page index, loses the upper 32 bits of the 64-bit
size information due to an inappropriate type of local variable to which
the i\_size value is assigned.
This caused a large byte offset value due to underflow in the end address
calculation in the calling nilfs\_find\_entry(), resulting in memory access
that exceeds the folio/page size.
Fix this issue by changing the type of the local variable causing the bit
loss from "unsigned int" to "u64". The return value of nilfs\_last\_byte()
is also of type "unsigned int", but it is truncated so as not to exceed
PAGE\_SIZE and no bit loss occurs, so no change is required.
Link: [https://lkml.kernel.org/r/20241119172403.9292-1-konishi.ryusuke@gmail.com](https://lkml.kernel.org/r/20241119172403.9292-1-konishi.ryusuke%40gmail.com)
Fixes: 2ba466d74ed7 ("nilfs2: directory entry operations")
Signed-off-by: Ryusuke Konishi <konishi.ryusuke@gmail.com>
Reported-by: syzbot+96d5d14c47d97015c624@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=96d5d14c47d97015c624
Tested-by: syzbot+96d5d14c47d97015c624@syzkaller.appspotmail.com
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e3732102a9d638d8627d14fdf7b208462f0520e0)

| -rw-r--r-- | [fs/nilfs2/dir.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nilfs2/dir.c?id=e3732102a9d638d8627d14fdf7b208462f0520e0) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/fs/nilfs2/dir.c b/fs/nilfs2/dir.cindex 365cae5c3e3519..cd363e2fc071d5 100644--- a/[fs/nilfs2/dir.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/dir.c?id=df43d8da6bacf74c34f74012f21a82cd02a6bd3f)+++ b/[fs/nilfs2/dir.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/dir.c?id=e3732102a9d638d8627d14fdf7b208462f0520e0)@@ -76,7 +76,7 @@ static inline void nilfs\_put\_page(struct page \*page) \*/ static unsigned int nilfs\_last\_byte(struct inode \*inode, unsigned long page\_nr) {- unsigned int last\_byte = inode->i\_size;+ u64 last\_byte = inode->i\_size;  last\_byte -= page\_nr << PAGE\_SHIFT; if (last\_byte > PAGE\_SIZE) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:38:52 +0000



=== Content from git.kernel.org_5411a83d_20250114_224011.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=5af8366625182f01f6d8465c9a3210574673af57)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5af8366625182f01f6d8465c9a3210574673af57)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5af8366625182f01f6d8465c9a3210574673af57)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5af8366625182f01f6d8465c9a3210574673af57)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ryusuke Konishi <konishi.ryusuke@gmail.com> | 2024-11-20 02:23:37 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:54:34 +0100 |
| commit | [5af8366625182f01f6d8465c9a3210574673af57](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5af8366625182f01f6d8465c9a3210574673af57) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=5af8366625182f01f6d8465c9a3210574673af57)) | |
| tree | [05537835aae1bee89d270697f77841f1d0ee5150](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5af8366625182f01f6d8465c9a3210574673af57) | |
| parent | [897222612979fa473a9b98f8f1907cfe09896cd6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=897222612979fa473a9b98f8f1907cfe09896cd6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5af8366625182f01f6d8465c9a3210574673af57&id2=897222612979fa473a9b98f8f1907cfe09896cd6)) | |
| download | [linux-5af8366625182f01f6d8465c9a3210574673af57.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-5af8366625182f01f6d8465c9a3210574673af57.tar.gz) | |

nilfs2: fix potential out-of-bounds memory access in nilfs\_find\_entry()commit 985ebec4ab0a28bb5910c3b1481a40fbf7f9e61d upstream.
Syzbot reported that when searching for records in a directory where the
inode's i\_size is corrupted and has a large value, memory access outside
the folio/page range may occur, or a use-after-free bug may be detected if
KASAN is enabled.
This is because nilfs\_last\_byte(), which is called by nilfs\_find\_entry()
and others to calculate the number of valid bytes of directory data in a
page from i\_size and the page index, loses the upper 32 bits of the 64-bit
size information due to an inappropriate type of local variable to which
the i\_size value is assigned.
This caused a large byte offset value due to underflow in the end address
calculation in the calling nilfs\_find\_entry(), resulting in memory access
that exceeds the folio/page size.
Fix this issue by changing the type of the local variable causing the bit
loss from "unsigned int" to "u64". The return value of nilfs\_last\_byte()
is also of type "unsigned int", but it is truncated so as not to exceed
PAGE\_SIZE and no bit loss occurs, so no change is required.
Link: [https://lkml.kernel.org/r/20241119172403.9292-1-konishi.ryusuke@gmail.com](https://lkml.kernel.org/r/20241119172403.9292-1-konishi.ryusuke%40gmail.com)
Fixes: 2ba466d74ed7 ("nilfs2: directory entry operations")
Signed-off-by: Ryusuke Konishi <konishi.ryusuke@gmail.com>
Reported-by: syzbot+96d5d14c47d97015c624@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=96d5d14c47d97015c624
Tested-by: syzbot+96d5d14c47d97015c624@syzkaller.appspotmail.com
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5af8366625182f01f6d8465c9a3210574673af57)

| -rw-r--r-- | [fs/nilfs2/dir.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nilfs2/dir.c?id=5af8366625182f01f6d8465c9a3210574673af57) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/fs/nilfs2/dir.c b/fs/nilfs2/dir.cindex b60f4fb9a40539..889e3e570213a9 100644--- a/[fs/nilfs2/dir.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/dir.c?id=897222612979fa473a9b98f8f1907cfe09896cd6)+++ b/[fs/nilfs2/dir.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/dir.c?id=5af8366625182f01f6d8465c9a3210574673af57)@@ -76,7 +76,7 @@ static inline void nilfs\_put\_page(struct page \*page) \*/ static unsigned int nilfs\_last\_byte(struct inode \*inode, unsigned long page\_nr) {- unsigned int last\_byte = inode->i\_size;+ u64 last\_byte = inode->i\_size;  last\_byte -= page\_nr << PAGE\_SHIFT; if (last\_byte > PAGE\_SIZE) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:38:48 +0000



=== Content from git.kernel.org_51b1abde_20250114_224013.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c3afea07477baccdbdec4483f8d5e59d42a3f67f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c3afea07477baccdbdec4483f8d5e59d42a3f67f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c3afea07477baccdbdec4483f8d5e59d42a3f67f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c3afea07477baccdbdec4483f8d5e59d42a3f67f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ryusuke Konishi <konishi.ryusuke@gmail.com> | 2024-11-20 02:23:37 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:59:54 +0100 |
| commit | [c3afea07477baccdbdec4483f8d5e59d42a3f67f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c3afea07477baccdbdec4483f8d5e59d42a3f67f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c3afea07477baccdbdec4483f8d5e59d42a3f67f)) | |
| tree | [b88a66b4e0ca7e57918657386f27b40d35a23e8b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c3afea07477baccdbdec4483f8d5e59d42a3f67f) | |
| parent | [1e30b52edf175eee6bd096bd5d38de37ba98a871](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1e30b52edf175eee6bd096bd5d38de37ba98a871) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c3afea07477baccdbdec4483f8d5e59d42a3f67f&id2=1e30b52edf175eee6bd096bd5d38de37ba98a871)) | |
| download | [linux-c3afea07477baccdbdec4483f8d5e59d42a3f67f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c3afea07477baccdbdec4483f8d5e59d42a3f67f.tar.gz) | |

nilfs2: fix potential out-of-bounds memory access in nilfs\_find\_entry()commit 985ebec4ab0a28bb5910c3b1481a40fbf7f9e61d upstream.
Syzbot reported that when searching for records in a directory where the
inode's i\_size is corrupted and has a large value, memory access outside
the folio/page range may occur, or a use-after-free bug may be detected if
KASAN is enabled.
This is because nilfs\_last\_byte(), which is called by nilfs\_find\_entry()
and others to calculate the number of valid bytes of directory data in a
page from i\_size and the page index, loses the upper 32 bits of the 64-bit
size information due to an inappropriate type of local variable to which
the i\_size value is assigned.
This caused a large byte offset value due to underflow in the end address
calculation in the calling nilfs\_find\_entry(), resulting in memory access
that exceeds the folio/page size.
Fix this issue by changing the type of the local variable causing the bit
loss from "unsigned int" to "u64". The return value of nilfs\_last\_byte()
is also of type "unsigned int", but it is truncated so as not to exceed
PAGE\_SIZE and no bit loss occurs, so no change is required.
Link: [https://lkml.kernel.org/r/20241119172403.9292-1-konishi.ryusuke@gmail.com](https://lkml.kernel.org/r/20241119172403.9292-1-konishi.ryusuke%40gmail.com)
Fixes: 2ba466d74ed7 ("nilfs2: directory entry operations")
Signed-off-by: Ryusuke Konishi <konishi.ryusuke@gmail.com>
Reported-by: syzbot+96d5d14c47d97015c624@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=96d5d14c47d97015c624
Tested-by: syzbot+96d5d14c47d97015c624@syzkaller.appspotmail.com
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c3afea07477baccdbdec4483f8d5e59d42a3f67f)

| -rw-r--r-- | [fs/nilfs2/dir.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nilfs2/dir.c?id=c3afea07477baccdbdec4483f8d5e59d42a3f67f) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/fs/nilfs2/dir.c b/fs/nilfs2/dir.cindex ddf8e575e489ca..652279c8b1680a 100644--- a/[fs/nilfs2/dir.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/dir.c?id=1e30b52edf175eee6bd096bd5d38de37ba98a871)+++ b/[fs/nilfs2/dir.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/dir.c?id=c3afea07477baccdbdec4483f8d5e59d42a3f67f)@@ -76,7 +76,7 @@ static inline void nilfs\_put\_page(struct page \*page) \*/ static unsigned int nilfs\_last\_byte(struct inode \*inode, unsigned long page\_nr) {- unsigned int last\_byte = inode->i\_size;+ u64 last\_byte = inode->i\_size;  last\_byte -= page\_nr << PAGE\_SHIFT; if (last\_byte > PAGE\_SIZE) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:38:50 +0000



=== Content from git.kernel.org_68b533ed_20250114_224008.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=31f7b57a77d4c82a34ddcb6ff35b5aa577ef153e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=31f7b57a77d4c82a34ddcb6ff35b5aa577ef153e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=31f7b57a77d4c82a34ddcb6ff35b5aa577ef153e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=31f7b57a77d4c82a34ddcb6ff35b5aa577ef153e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ryusuke Konishi <konishi.ryusuke@gmail.com> | 2024-11-20 02:23:37 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 20:03:25 +0100 |
| commit | [31f7b57a77d4c82a34ddcb6ff35b5aa577ef153e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=31f7b57a77d4c82a34ddcb6ff35b5aa577ef153e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=31f7b57a77d4c82a34ddcb6ff35b5aa577ef153e)) | |
| tree | [56623c9235c78ed527a2b63fae10c88316060dca](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=31f7b57a77d4c82a34ddcb6ff35b5aa577ef153e) | |
| parent | [5a717f43c2ead191e413e0bba4df926b38ece44b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5a717f43c2ead191e413e0bba4df926b38ece44b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=31f7b57a77d4c82a34ddcb6ff35b5aa577ef153e&id2=5a717f43c2ead191e413e0bba4df926b38ece44b)) | |
| download | [linux-31f7b57a77d4c82a34ddcb6ff35b5aa577ef153e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-31f7b57a77d4c82a34ddcb6ff35b5aa577ef153e.tar.gz) | |

nilfs2: fix potential out-of-bounds memory access in nilfs\_find\_entry()commit 985ebec4ab0a28bb5910c3b1481a40fbf7f9e61d upstream.
Syzbot reported that when searching for records in a directory where the
inode's i\_size is corrupted and has a large value, memory access outside
the folio/page range may occur, or a use-after-free bug may be detected if
KASAN is enabled.
This is because nilfs\_last\_byte(), which is called by nilfs\_find\_entry()
and others to calculate the number of valid bytes of directory data in a
page from i\_size and the page index, loses the upper 32 bits of the 64-bit
size information due to an inappropriate type of local variable to which
the i\_size value is assigned.
This caused a large byte offset value due to underflow in the end address
calculation in the calling nilfs\_find\_entry(), resulting in memory access
that exceeds the folio/page size.
Fix this issue by changing the type of the local variable causing the bit
loss from "unsigned int" to "u64". The return value of nilfs\_last\_byte()
is also of type "unsigned int", but it is truncated so as not to exceed
PAGE\_SIZE and no bit loss occurs, so no change is required.
Link: [https://lkml.kernel.org/r/20241119172403.9292-1-konishi.ryusuke@gmail.com](https://lkml.kernel.org/r/20241119172403.9292-1-konishi.ryusuke%40gmail.com)
Fixes: 2ba466d74ed7 ("nilfs2: directory entry operations")
Signed-off-by: Ryusuke Konishi <konishi.ryusuke@gmail.com>
Reported-by: syzbot+96d5d14c47d97015c624@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=96d5d14c47d97015c624
Tested-by: syzbot+96d5d14c47d97015c624@syzkaller.appspotmail.com
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=31f7b57a77d4c82a34ddcb6ff35b5aa577ef153e)

| -rw-r--r-- | [fs/nilfs2/dir.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nilfs2/dir.c?id=31f7b57a77d4c82a34ddcb6ff35b5aa577ef153e) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/fs/nilfs2/dir.c b/fs/nilfs2/dir.cindex a8602729586ab7..f61c58fbf117d3 100644--- a/[fs/nilfs2/dir.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/dir.c?id=5a717f43c2ead191e413e0bba4df926b38ece44b)+++ b/[fs/nilfs2/dir.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/dir.c?id=31f7b57a77d4c82a34ddcb6ff35b5aa577ef153e)@@ -70,7 +70,7 @@ static inline unsigned int nilfs\_chunk\_size(struct inode \*inode) \*/ static unsigned int nilfs\_last\_byte(struct inode \*inode, unsigned long page\_nr) {- unsigned int last\_byte = inode->i\_size;+ u64 last\_byte = inode->i\_size;  last\_byte -= page\_nr << PAGE\_SHIFT; if (last\_byte > PAGE\_SIZE) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:38:45 +0000



=== Content from git.kernel.org_08e70222_20250114_224009.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=48eb6e7404948032bbe811c5affbe39f6b316951)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=48eb6e7404948032bbe811c5affbe39f6b316951)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=48eb6e7404948032bbe811c5affbe39f6b316951)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=48eb6e7404948032bbe811c5affbe39f6b316951)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ryusuke Konishi <konishi.ryusuke@gmail.com> | 2024-11-20 02:23:37 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:51:33 +0100 |
| commit | [48eb6e7404948032bbe811c5affbe39f6b316951](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=48eb6e7404948032bbe811c5affbe39f6b316951) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=48eb6e7404948032bbe811c5affbe39f6b316951)) | |
| tree | [5140aec7942fe87c7a8a8d3c61b5d13a49c4c2eb](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=48eb6e7404948032bbe811c5affbe39f6b316951) | |
| parent | [87bf3ea841a5d77beae6bb85af36b2b3848407ee](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=87bf3ea841a5d77beae6bb85af36b2b3848407ee) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=48eb6e7404948032bbe811c5affbe39f6b316951&id2=87bf3ea841a5d77beae6bb85af36b2b3848407ee)) | |
| download | [linux-48eb6e7404948032bbe811c5affbe39f6b316951.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-48eb6e7404948032bbe811c5affbe39f6b316951.tar.gz) | |

nilfs2: fix potential out-of-bounds memory access in nilfs\_find\_entry()commit 985ebec4ab0a28bb5910c3b1481a40fbf7f9e61d upstream.
Syzbot reported that when searching for records in a directory where the
inode's i\_size is corrupted and has a large value, memory access outside
the folio/page range may occur, or a use-after-free bug may be detected if
KASAN is enabled.
This is because nilfs\_last\_byte(), which is called by nilfs\_find\_entry()
and others to calculate the number of valid bytes of directory data in a
page from i\_size and the page index, loses the upper 32 bits of the 64-bit
size information due to an inappropriate type of local variable to which
the i\_size value is assigned.
This caused a large byte offset value due to underflow in the end address
calculation in the calling nilfs\_find\_entry(), resulting in memory access
that exceeds the folio/page size.
Fix this issue by changing the type of the local variable causing the bit
loss from "unsigned int" to "u64". The return value of nilfs\_last\_byte()
is also of type "unsigned int", but it is truncated so as not to exceed
PAGE\_SIZE and no bit loss occurs, so no change is required.
Link: [https://lkml.kernel.org/r/20241119172403.9292-1-konishi.ryusuke@gmail.com](https://lkml.kernel.org/r/20241119172403.9292-1-konishi.ryusuke%40gmail.com)
Fixes: 2ba466d74ed7 ("nilfs2: directory entry operations")
Signed-off-by: Ryusuke Konishi <konishi.ryusuke@gmail.com>
Reported-by: syzbot+96d5d14c47d97015c624@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=96d5d14c47d97015c624
Tested-by: syzbot+96d5d14c47d97015c624@syzkaller.appspotmail.com
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=48eb6e7404948032bbe811c5affbe39f6b316951)

| -rw-r--r-- | [fs/nilfs2/dir.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nilfs2/dir.c?id=48eb6e7404948032bbe811c5affbe39f6b316951) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/fs/nilfs2/dir.c b/fs/nilfs2/dir.cindex 365cae5c3e3519..cd363e2fc071d5 100644--- a/[fs/nilfs2/dir.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/dir.c?id=87bf3ea841a5d77beae6bb85af36b2b3848407ee)+++ b/[fs/nilfs2/dir.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/dir.c?id=48eb6e7404948032bbe811c5affbe39f6b316951)@@ -76,7 +76,7 @@ static inline void nilfs\_put\_page(struct page \*page) \*/ static unsigned int nilfs\_last\_byte(struct inode \*inode, unsigned long page\_nr) {- unsigned int last\_byte = inode->i\_size;+ u64 last\_byte = inode->i\_size;  last\_byte -= page\_nr << PAGE\_SHIFT; if (last\_byte > PAGE\_SIZE) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:38:46 +0000



=== Content from git.kernel.org_37e7b2cf_20250114_224007.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=09d6d05579fd46e61abf6e457bb100ff11f3a9d3)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=09d6d05579fd46e61abf6e457bb100ff11f3a9d3)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=09d6d05579fd46e61abf6e457bb100ff11f3a9d3)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=09d6d05579fd46e61abf6e457bb100ff11f3a9d3)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ryusuke Konishi <konishi.ryusuke@gmail.com> | 2024-11-20 02:23:37 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:44:49 +0100 |
| commit | [09d6d05579fd46e61abf6e457bb100ff11f3a9d3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=09d6d05579fd46e61abf6e457bb100ff11f3a9d3) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=09d6d05579fd46e61abf6e457bb100ff11f3a9d3)) | |
| tree | [6d0854227ab37ceb3b838fc319a34e0d44b238a3](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=09d6d05579fd46e61abf6e457bb100ff11f3a9d3) | |
| parent | [0bdf3905cda73fb133163d9e9b1b8024d4df3e62](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0bdf3905cda73fb133163d9e9b1b8024d4df3e62) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=09d6d05579fd46e61abf6e457bb100ff11f3a9d3&id2=0bdf3905cda73fb133163d9e9b1b8024d4df3e62)) | |
| download | [linux-09d6d05579fd46e61abf6e457bb100ff11f3a9d3.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-09d6d05579fd46e61abf6e457bb100ff11f3a9d3.tar.gz) | |

nilfs2: fix potential out-of-bounds memory access in nilfs\_find\_entry()commit 985ebec4ab0a28bb5910c3b1481a40fbf7f9e61d upstream.
Syzbot reported that when searching for records in a directory where the
inode's i\_size is corrupted and has a large value, memory access outside
the folio/page range may occur, or a use-after-free bug may be detected if
KASAN is enabled.
This is because nilfs\_last\_byte(), which is called by nilfs\_find\_entry()
and others to calculate the number of valid bytes of directory data in a
page from i\_size and the page index, loses the upper 32 bits of the 64-bit
size information due to an inappropriate type of local variable to which
the i\_size value is assigned.
This caused a large byte offset value due to underflow in the end address
calculation in the calling nilfs\_find\_entry(), resulting in memory access
that exceeds the folio/page size.
Fix this issue by changing the type of the local variable causing the bit
loss from "unsigned int" to "u64". The return value of nilfs\_last\_byte()
is also of type "unsigned int", but it is truncated so as not to exceed
PAGE\_SIZE and no bit loss occurs, so no change is required.
Link: [https://lkml.kernel.org/r/20241119172403.9292-1-konishi.ryusuke@gmail.com](https://lkml.kernel.org/r/20241119172403.9292-1-konishi.ryusuke%40gmail.com)
Fixes: 2ba466d74ed7 ("nilfs2: directory entry operations")
Signed-off-by: Ryusuke Konishi <konishi.ryusuke@gmail.com>
Reported-by: syzbot+96d5d14c47d97015c624@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=96d5d14c47d97015c624
Tested-by: syzbot+96d5d14c47d97015c624@syzkaller.appspotmail.com
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=09d6d05579fd46e61abf6e457bb100ff11f3a9d3)

| -rw-r--r-- | [fs/nilfs2/dir.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nilfs2/dir.c?id=09d6d05579fd46e61abf6e457bb100ff11f3a9d3) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/fs/nilfs2/dir.c b/fs/nilfs2/dir.cindex 365cae5c3e3519..cd363e2fc071d5 100644--- a/[fs/nilfs2/dir.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/dir.c?id=0bdf3905cda73fb133163d9e9b1b8024d4df3e62)+++ b/[fs/nilfs2/dir.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/dir.c?id=09d6d05579fd46e61abf6e457bb100ff11f3a9d3)@@ -76,7 +76,7 @@ static inline void nilfs\_put\_page(struct page \*page) \*/ static unsigned int nilfs\_last\_byte(struct inode \*inode, unsigned long page\_nr) {- unsigned int last\_byte = inode->i\_size;+ u64 last\_byte = inode->i\_size;  last\_byte -= page\_nr << PAGE\_SHIFT; if (last\_byte > PAGE\_SIZE) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:38:44 +0000



=== Content from git.kernel.org_13736a57_20250114_224012.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=985ebec4ab0a28bb5910c3b1481a40fbf7f9e61d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=985ebec4ab0a28bb5910c3b1481a40fbf7f9e61d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=985ebec4ab0a28bb5910c3b1481a40fbf7f9e61d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=985ebec4ab0a28bb5910c3b1481a40fbf7f9e61d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ryusuke Konishi <konishi.ryusuke@gmail.com> | 2024-11-20 02:23:37 +0900 |
| --- | --- | --- |
| committer | Andrew Morton <akpm@linux-foundation.org> | 2024-12-05 19:54:43 -0800 |
| commit | [985ebec4ab0a28bb5910c3b1481a40fbf7f9e61d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=985ebec4ab0a28bb5910c3b1481a40fbf7f9e61d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=985ebec4ab0a28bb5910c3b1481a40fbf7f9e61d)) | |
| tree | [0318e0f5423610154a30417aead8ffc9abe8c31e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=985ebec4ab0a28bb5910c3b1481a40fbf7f9e61d) | |
| parent | [e30a0361b8515d424c73c67de1a43e45a13b8ba2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e30a0361b8515d424c73c67de1a43e45a13b8ba2) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=985ebec4ab0a28bb5910c3b1481a40fbf7f9e61d&id2=e30a0361b8515d424c73c67de1a43e45a13b8ba2)) | |
| download | [linux-985ebec4ab0a28bb5910c3b1481a40fbf7f9e61d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-985ebec4ab0a28bb5910c3b1481a40fbf7f9e61d.tar.gz) | |

nilfs2: fix potential out-of-bounds memory access in nilfs\_find\_entry()Syzbot reported that when searching for records in a directory where the
inode's i\_size is corrupted and has a large value, memory access outside
the folio/page range may occur, or a use-after-free bug may be detected if
KASAN is enabled.
This is because nilfs\_last\_byte(), which is called by nilfs\_find\_entry()
and others to calculate the number of valid bytes of directory data in a
page from i\_size and the page index, loses the upper 32 bits of the 64-bit
size information due to an inappropriate type of local variable to which
the i\_size value is assigned.
This caused a large byte offset value due to underflow in the end address
calculation in the calling nilfs\_find\_entry(), resulting in memory access
that exceeds the folio/page size.
Fix this issue by changing the type of the local variable causing the bit
loss from "unsigned int" to "u64". The return value of nilfs\_last\_byte()
is also of type "unsigned int", but it is truncated so as not to exceed
PAGE\_SIZE and no bit loss occurs, so no change is required.
Link: [https://lkml.kernel.org/r/20241119172403.9292-1-konishi.ryusuke@gmail.com](https://lkml.kernel.org/r/20241119172403.9292-1-konishi.ryusuke%40gmail.com)
Fixes: 2ba466d74ed7 ("nilfs2: directory entry operations")
Signed-off-by: Ryusuke Konishi <konishi.ryusuke@gmail.com>
Reported-by: syzbot+96d5d14c47d97015c624@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=96d5d14c47d97015c624
Tested-by: syzbot+96d5d14c47d97015c624@syzkaller.appspotmail.com
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=985ebec4ab0a28bb5910c3b1481a40fbf7f9e61d)

| -rw-r--r-- | [fs/nilfs2/dir.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nilfs2/dir.c?id=985ebec4ab0a28bb5910c3b1481a40fbf7f9e61d) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/fs/nilfs2/dir.c b/fs/nilfs2/dir.cindex 14e8d82f862980..0a3aea6c416bc6 100644--- a/[fs/nilfs2/dir.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/dir.c?id=e30a0361b8515d424c73c67de1a43e45a13b8ba2)+++ b/[fs/nilfs2/dir.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nilfs2/dir.c?id=985ebec4ab0a28bb5910c3b1481a40fbf7f9e61d)@@ -70,7 +70,7 @@ static inline unsigned int nilfs\_chunk\_size(struct inode \*inode) \*/ static unsigned int nilfs\_last\_byte(struct inode \*inode, unsigned long page\_nr) {- unsigned int last\_byte = inode->i\_size;+ u64 last\_byte = inode->i\_size;  last\_byte -= page\_nr << PAGE\_SHIFT; if (last\_byte > PAGE\_SIZE) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:38:49 +0000


