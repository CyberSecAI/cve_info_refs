=== Content from git.kernel.org_6446b41f_20250114_232140.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8fac3266c68a8e647240b8ac8d0b82f1821edf85)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8fac3266c68a8e647240b8ac8d0b82f1821edf85)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8fac3266c68a8e647240b8ac8d0b82f1821edf85)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8fac3266c68a8e647240b8ac8d0b82f1821edf85)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Kalle Valo <quic\_kvalo@quicinc.com> | 2024-10-07 19:59:27 +0300 |
| --- | --- | --- |
| committer | Jeff Johnson <quic\_jjohnson@quicinc.com> | 2024-10-11 07:21:54 -0700 |
| commit | [8fac3266c68a8e647240b8ac8d0b82f1821edf85](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8fac3266c68a8e647240b8ac8d0b82f1821edf85) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8fac3266c68a8e647240b8ac8d0b82f1821edf85)) | |
| tree | [72f688e368222bddcf2a56531337946647ac55f8](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8fac3266c68a8e647240b8ac8d0b82f1821edf85) | |
| parent | [15d91424ea822ddfb28ed18564343b3ff9d382fe](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=15d91424ea822ddfb28ed18564343b3ff9d382fe) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8fac3266c68a8e647240b8ac8d0b82f1821edf85&id2=15d91424ea822ddfb28ed18564343b3ff9d382fe)) | |
| download | [linux-8fac3266c68a8e647240b8ac8d0b82f1821edf85.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8fac3266c68a8e647240b8ac8d0b82f1821edf85.tar.gz) | |

wifi: ath12k: fix atomic calls in ath12k\_mac\_op\_set\_bitrate\_mask()When I try to manually set bitrates:
iw wlan0 set bitrates legacy-2.4 1
I get sleeping from invalid context error, see below. Fix that by switching to
use recently introduced ieee80211\_iterate\_stations\_mtx().
Do note that WCN6855 firmware is still crashing, I'm not sure if that firmware
even supports bitrate WMI commands and should we consider disabling
ath12k\_mac\_op\_set\_bitrate\_mask() for WCN6855? But that's for another patch.
BUG: sleeping function called from invalid context at drivers/net/wireless/ath/ath12k/wmi.c:420
in\_atomic(): 0, irqs\_disabled(): 0, non\_block: 0, pid: 2236, name: iw
preempt\_count: 0, expected: 0
RCU nest depth: 1, expected: 0
3 locks held by iw/2236:
#0: ffffffffabc6f1d8 (cb\_lock){++++}-{3:3}, at: genl\_rcv+0x14/0x40
#1: ffff888138410810 (&rdev->wiphy.mtx){+.+.}-{3:3}, at: nl80211\_pre\_doit+0x54d/0x800 [cfg80211]
#2: ffffffffab2cfaa0 (rcu\_read\_lock){....}-{1:2}, at: ieee80211\_iterate\_stations\_atomic+0x2f/0x200 [mac80211]
CPU: 3 UID: 0 PID: 2236 Comm: iw Not tainted 6.11.0-rc7-wt-ath+ #1772
Hardware name: Intel(R) Client Systems NUC8i7HVK/NUC8i7HVB, BIOS HNKBLi70.86A.0067.2021.0528.1339 05/28/2021
Call Trace:
<TASK>
dump\_stack\_lvl+0xa4/0xe0
dump\_stack+0x10/0x20
\_\_might\_resched+0x363/0x5a0
? \_\_alloc\_skb+0x165/0x340
\_\_might\_sleep+0xad/0x160
ath12k\_wmi\_cmd\_send+0xb1/0x3d0 [ath12k]
? ath12k\_wmi\_init\_wcn7850+0xa40/0xa40 [ath12k]
? \_\_netdev\_alloc\_skb+0x45/0x7b0
? \_\_asan\_memset+0x39/0x40
? ath12k\_wmi\_alloc\_skb+0xf0/0x150 [ath12k]
? reacquire\_held\_locks+0x4d0/0x4d0
ath12k\_wmi\_set\_peer\_param+0x340/0x5b0 [ath12k]
ath12k\_mac\_disable\_peer\_fixed\_rate+0xa3/0x110 [ath12k]
? ath12k\_mac\_vdev\_stop+0x4f0/0x4f0 [ath12k]
ieee80211\_iterate\_stations\_atomic+0xd4/0x200 [mac80211]
ath12k\_mac\_op\_set\_bitrate\_mask+0x5d2/0x1080 [ath12k]
? ath12k\_mac\_vif\_chan+0x320/0x320 [ath12k]
drv\_set\_bitrate\_mask+0x267/0x470 [mac80211]
ieee80211\_set\_bitrate\_mask+0x4cc/0x8a0 [mac80211]
? \_\_this\_cpu\_preempt\_check+0x13/0x20
nl80211\_set\_tx\_bitrate\_mask+0x2bc/0x530 [cfg80211]
? nl80211\_parse\_tx\_bitrate\_mask+0x2320/0x2320 [cfg80211]
? trace\_contention\_end+0xef/0x140
? rtnl\_unlock+0x9/0x10
? nl80211\_pre\_doit+0x557/0x800 [cfg80211]
genl\_family\_rcv\_msg\_doit+0x1f0/0x2e0
? genl\_family\_rcv\_msg\_attrs\_parse.isra.0+0x250/0x250
? ns\_capable+0x57/0xd0
genl\_family\_rcv\_msg+0x34c/0x600
? genl\_family\_rcv\_msg\_dumpit+0x310/0x310
? \_\_lock\_acquire+0xc62/0x1de0
? he\_set\_mcs\_mask.isra.0+0x8d0/0x8d0 [cfg80211]
? nl80211\_parse\_tx\_bitrate\_mask+0x2320/0x2320 [cfg80211]
? cfg80211\_external\_auth\_request+0x690/0x690 [cfg80211]
genl\_rcv\_msg+0xa0/0x130
netlink\_rcv\_skb+0x14c/0x400
? genl\_family\_rcv\_msg+0x600/0x600
? netlink\_ack+0xd70/0xd70
? rwsem\_optimistic\_spin+0x4f0/0x4f0
? genl\_rcv+0x14/0x40
? down\_read\_killable+0x580/0x580
? netlink\_deliver\_tap+0x13e/0x350
? \_\_this\_cpu\_preempt\_check+0x13/0x20
genl\_rcv+0x23/0x40
netlink\_unicast+0x45e/0x790
? netlink\_attachskb+0x7f0/0x7f0
netlink\_sendmsg+0x7eb/0xdb0
? netlink\_unicast+0x790/0x790
? \_\_this\_cpu\_preempt\_check+0x13/0x20
? selinux\_socket\_sendmsg+0x31/0x40
? netlink\_unicast+0x790/0x790
\_\_sock\_sendmsg+0xc9/0x160
\_\_\_\_sys\_sendmsg+0x620/0x990
? kernel\_sendmsg+0x30/0x30
? \_\_copy\_msghdr+0x410/0x410
? \_\_kasan\_check\_read+0x11/0x20
? mark\_lock+0xe6/0x1470
\_\_\_sys\_sendmsg+0xe9/0x170
? copy\_msghdr\_from\_user+0x120/0x120
? \_\_lock\_acquire+0xc62/0x1de0
? do\_fault\_around+0x2c6/0x4e0
? do\_user\_addr\_fault+0x8c1/0xde0
? reacquire\_held\_locks+0x220/0x4d0
? do\_user\_addr\_fault+0x8c1/0xde0
? \_\_kasan\_check\_read+0x11/0x20
? \_\_fdget+0x4e/0x1d0
? sockfd\_lookup\_light+0x1a/0x170
\_\_sys\_sendmsg+0xd2/0x180
? \_\_sys\_sendmsg\_sock+0x20/0x20
? reacquire\_held\_locks+0x4d0/0x4d0
? debug\_smp\_processor\_id+0x17/0x20
\_\_x64\_sys\_sendmsg+0x72/0xb0
? lockdep\_hardirqs\_on+0x7d/0x100
x64\_sys\_call+0x894/0x9f0
do\_syscall\_64+0x64/0x130
entry\_SYSCALL\_64\_after\_hwframe+0x4b/0x53
RIP: 0033:0x7f230fe04807
Code: 64 89 02 48 c7 c0 ff ff ff ff eb bb 0f 1f 80 00 00 00 00 f3 0f 1e fa 64 8b 04 25 18 00 00 00 85 c0 75 10 b8 2e 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 51 c3 48 83 ec 28 89 54 24 1c 48 89 74 24 10
RSP: 002b:00007ffe996a7ea8 EFLAGS: 00000246 ORIG\_RAX: 000000000000002e
RAX: ffffffffffffffda RBX: 0000556f9f9c3390 RCX: 00007f230fe04807
RDX: 0000000000000000 RSI: 00007ffe996a7ee0 RDI: 0000000000000003
RBP: 0000556f9f9c88c0 R08: 0000000000000002 R09: 0000000000000000
R10: 0000556f965ca190 R11: 0000000000000246 R12: 0000556f9f9c8780
R13: 00007ffe996a7ee0 R14: 0000556f9f9c87d0 R15: 0000556f9f9c88c0
</TASK>
Tested-on: WCN7850 hw2.0 PCI WLAN.HMT.1.0.c5-00481-QCAHMTSWPL\_V1.0\_V2.0\_SILICONZ-3
Signed-off-by: Kalle Valo <quic\_kvalo@quicinc.com>
Link: [https://patch.msgid.link/20241007165932.78081-2-kvalo@kernel.org](https://patch.msgid.link/20241007165932.78081-2-kvalo%40kernel.org)
Signed-off-by: Jeff Johnson <quic\_jjohnson@quicinc.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8fac3266c68a8e647240b8ac8d0b82f1821edf85)

| -rw-r--r-- | [drivers/net/wireless/ath/ath12k/mac.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/ath/ath12k/mac.c?id=8fac3266c68a8e647240b8ac8d0b82f1821edf85) | 18 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 9 deletions

| diff --git a/drivers/net/wireless/ath/ath12k/mac.c b/drivers/net/wireless/ath/ath12k/mac.cindex 6d0784a21558ea..8946141aa0dce6 100644--- a/[drivers/net/wireless/ath/ath12k/mac.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/ath/ath12k/mac.c?id=15d91424ea822ddfb28ed18564343b3ff9d382fe)+++ b/[drivers/net/wireless/ath/ath12k/mac.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/ath/ath12k/mac.c?id=8fac3266c68a8e647240b8ac8d0b82f1821edf85)@@ -8186,9 +8186,9 @@ ath12k\_mac\_op\_set\_bitrate\_mask(struct ieee80211\_hw \*hw, arvif->vdev\_id, ret); goto out; }- ieee80211\_iterate\_stations\_atomic(hw,- ath12k\_mac\_disable\_peer\_fixed\_rate,- arvif);+ ieee80211\_iterate\_stations\_mtx(hw,+ ath12k\_mac\_disable\_peer\_fixed\_rate,+ arvif); } else if (ath12k\_mac\_bitrate\_mask\_get\_single\_nss(ar, band, mask, &single\_nss)) { rate = WMI\_FIXED\_RATE\_NONE;@@ -8233,16 +8233,16 @@ ath12k\_mac\_op\_set\_bitrate\_mask(struct ieee80211\_hw \*hw, goto out; } - ieee80211\_iterate\_stations\_atomic(hw,- ath12k\_mac\_disable\_peer\_fixed\_rate,- arvif);+ ieee80211\_iterate\_stations\_mtx(hw,+ ath12k\_mac\_disable\_peer\_fixed\_rate,+ arvif);  mutex\_lock(&ar->conf\_mutex);  arvif->bitrate\_mask = \*mask;- ieee80211\_iterate\_stations\_atomic(hw,- ath12k\_mac\_set\_bitrate\_mask\_iter,- arvif);+ ieee80211\_iterate\_stations\_mtx(hw,+ ath12k\_mac\_set\_bitrate\_mask\_iter,+ arvif);  mutex\_unlock(&ar->conf\_mutex); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:20:18 +0000



=== Content from git.kernel.org_bd18c58a_20250114_232140.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2093f062b26805789b73f2af214691475d9baa29)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2093f062b26805789b73f2af214691475d9baa29)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2093f062b26805789b73f2af214691475d9baa29)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2093f062b26805789b73f2af214691475d9baa29)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Kalle Valo <quic\_kvalo@quicinc.com> | 2024-10-07 19:59:27 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 20:03:46 +0100 |
| commit | [2093f062b26805789b73f2af214691475d9baa29](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2093f062b26805789b73f2af214691475d9baa29) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2093f062b26805789b73f2af214691475d9baa29)) | |
| tree | [b406b0fe19e2437d4d92e4493a75f9e00c7e2c34](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2093f062b26805789b73f2af214691475d9baa29) | |
| parent | [fbdf26dcc6d697b9fd44668d415b8c01771c7fd5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fbdf26dcc6d697b9fd44668d415b8c01771c7fd5) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2093f062b26805789b73f2af214691475d9baa29&id2=fbdf26dcc6d697b9fd44668d415b8c01771c7fd5)) | |
| download | [linux-2093f062b26805789b73f2af214691475d9baa29.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2093f062b26805789b73f2af214691475d9baa29.tar.gz) | |

wifi: ath12k: fix atomic calls in ath12k\_mac\_op\_set\_bitrate\_mask()[ Upstream commit 8fac3266c68a8e647240b8ac8d0b82f1821edf85 ]
When I try to manually set bitrates:
iw wlan0 set bitrates legacy-2.4 1
I get sleeping from invalid context error, see below. Fix that by switching to
use recently introduced ieee80211\_iterate\_stations\_mtx().
Do note that WCN6855 firmware is still crashing, I'm not sure if that firmware
even supports bitrate WMI commands and should we consider disabling
ath12k\_mac\_op\_set\_bitrate\_mask() for WCN6855? But that's for another patch.
BUG: sleeping function called from invalid context at drivers/net/wireless/ath/ath12k/wmi.c:420
in\_atomic(): 0, irqs\_disabled(): 0, non\_block: 0, pid: 2236, name: iw
preempt\_count: 0, expected: 0
RCU nest depth: 1, expected: 0
3 locks held by iw/2236:
#0: ffffffffabc6f1d8 (cb\_lock){++++}-{3:3}, at: genl\_rcv+0x14/0x40
#1: ffff888138410810 (&rdev->wiphy.mtx){+.+.}-{3:3}, at: nl80211\_pre\_doit+0x54d/0x800 [cfg80211]
#2: ffffffffab2cfaa0 (rcu\_read\_lock){....}-{1:2}, at: ieee80211\_iterate\_stations\_atomic+0x2f/0x200 [mac80211]
CPU: 3 UID: 0 PID: 2236 Comm: iw Not tainted 6.11.0-rc7-wt-ath+ #1772
Hardware name: Intel(R) Client Systems NUC8i7HVK/NUC8i7HVB, BIOS HNKBLi70.86A.0067.2021.0528.1339 05/28/2021
Call Trace:
<TASK>
dump\_stack\_lvl+0xa4/0xe0
dump\_stack+0x10/0x20
\_\_might\_resched+0x363/0x5a0
? \_\_alloc\_skb+0x165/0x340
\_\_might\_sleep+0xad/0x160
ath12k\_wmi\_cmd\_send+0xb1/0x3d0 [ath12k]
? ath12k\_wmi\_init\_wcn7850+0xa40/0xa40 [ath12k]
? \_\_netdev\_alloc\_skb+0x45/0x7b0
? \_\_asan\_memset+0x39/0x40
? ath12k\_wmi\_alloc\_skb+0xf0/0x150 [ath12k]
? reacquire\_held\_locks+0x4d0/0x4d0
ath12k\_wmi\_set\_peer\_param+0x340/0x5b0 [ath12k]
ath12k\_mac\_disable\_peer\_fixed\_rate+0xa3/0x110 [ath12k]
? ath12k\_mac\_vdev\_stop+0x4f0/0x4f0 [ath12k]
ieee80211\_iterate\_stations\_atomic+0xd4/0x200 [mac80211]
ath12k\_mac\_op\_set\_bitrate\_mask+0x5d2/0x1080 [ath12k]
? ath12k\_mac\_vif\_chan+0x320/0x320 [ath12k]
drv\_set\_bitrate\_mask+0x267/0x470 [mac80211]
ieee80211\_set\_bitrate\_mask+0x4cc/0x8a0 [mac80211]
? \_\_this\_cpu\_preempt\_check+0x13/0x20
nl80211\_set\_tx\_bitrate\_mask+0x2bc/0x530 [cfg80211]
? nl80211\_parse\_tx\_bitrate\_mask+0x2320/0x2320 [cfg80211]
? trace\_contention\_end+0xef/0x140
? rtnl\_unlock+0x9/0x10
? nl80211\_pre\_doit+0x557/0x800 [cfg80211]
genl\_family\_rcv\_msg\_doit+0x1f0/0x2e0
? genl\_family\_rcv\_msg\_attrs\_parse.isra.0+0x250/0x250
? ns\_capable+0x57/0xd0
genl\_family\_rcv\_msg+0x34c/0x600
? genl\_family\_rcv\_msg\_dumpit+0x310/0x310
? \_\_lock\_acquire+0xc62/0x1de0
? he\_set\_mcs\_mask.isra.0+0x8d0/0x8d0 [cfg80211]
? nl80211\_parse\_tx\_bitrate\_mask+0x2320/0x2320 [cfg80211]
? cfg80211\_external\_auth\_request+0x690/0x690 [cfg80211]
genl\_rcv\_msg+0xa0/0x130
netlink\_rcv\_skb+0x14c/0x400
? genl\_family\_rcv\_msg+0x600/0x600
? netlink\_ack+0xd70/0xd70
? rwsem\_optimistic\_spin+0x4f0/0x4f0
? genl\_rcv+0x14/0x40
? down\_read\_killable+0x580/0x580
? netlink\_deliver\_tap+0x13e/0x350
? \_\_this\_cpu\_preempt\_check+0x13/0x20
genl\_rcv+0x23/0x40
netlink\_unicast+0x45e/0x790
? netlink\_attachskb+0x7f0/0x7f0
netlink\_sendmsg+0x7eb/0xdb0
? netlink\_unicast+0x790/0x790
? \_\_this\_cpu\_preempt\_check+0x13/0x20
? selinux\_socket\_sendmsg+0x31/0x40
? netlink\_unicast+0x790/0x790
\_\_sock\_sendmsg+0xc9/0x160
\_\_\_\_sys\_sendmsg+0x620/0x990
? kernel\_sendmsg+0x30/0x30
? \_\_copy\_msghdr+0x410/0x410
? \_\_kasan\_check\_read+0x11/0x20
? mark\_lock+0xe6/0x1470
\_\_\_sys\_sendmsg+0xe9/0x170
? copy\_msghdr\_from\_user+0x120/0x120
? \_\_lock\_acquire+0xc62/0x1de0
? do\_fault\_around+0x2c6/0x4e0
? do\_user\_addr\_fault+0x8c1/0xde0
? reacquire\_held\_locks+0x220/0x4d0
? do\_user\_addr\_fault+0x8c1/0xde0
? \_\_kasan\_check\_read+0x11/0x20
? \_\_fdget+0x4e/0x1d0
? sockfd\_lookup\_light+0x1a/0x170
\_\_sys\_sendmsg+0xd2/0x180
? \_\_sys\_sendmsg\_sock+0x20/0x20
? reacquire\_held\_locks+0x4d0/0x4d0
? debug\_smp\_processor\_id+0x17/0x20
\_\_x64\_sys\_sendmsg+0x72/0xb0
? lockdep\_hardirqs\_on+0x7d/0x100
x64\_sys\_call+0x894/0x9f0
do\_syscall\_64+0x64/0x130
entry\_SYSCALL\_64\_after\_hwframe+0x4b/0x53
RIP: 0033:0x7f230fe04807
Code: 64 89 02 48 c7 c0 ff ff ff ff eb bb 0f 1f 80 00 00 00 00 f3 0f 1e fa 64 8b 04 25 18 00 00 00 85 c0 75 10 b8 2e 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 51 c3 48 83 ec 28 89 54 24 1c 48 89 74 24 10
RSP: 002b:00007ffe996a7ea8 EFLAGS: 00000246 ORIG\_RAX: 000000000000002e
RAX: ffffffffffffffda RBX: 0000556f9f9c3390 RCX: 00007f230fe04807
RDX: 0000000000000000 RSI: 00007ffe996a7ee0 RDI: 0000000000000003
RBP: 0000556f9f9c88c0 R08: 0000000000000002 R09: 0000000000000000
R10: 0000556f965ca190 R11: 0000000000000246 R12: 0000556f9f9c8780
R13: 00007ffe996a7ee0 R14: 0000556f9f9c87d0 R15: 0000556f9f9c88c0
</TASK>
Tested-on: WCN7850 hw2.0 PCI WLAN.HMT.1.0.c5-00481-QCAHMTSWPL\_V1.0\_V2.0\_SILICONZ-3
Signed-off-by: Kalle Valo <quic\_kvalo@quicinc.com>
Link: [https://patch.msgid.link/20241007165932.78081-2-kvalo@kernel.org](https://patch.msgid.link/20241007165932.78081-2-kvalo%40kernel.org)
Signed-off-by: Jeff Johnson <quic\_jjohnson@quicinc.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2093f062b26805789b73f2af214691475d9baa29)

| -rw-r--r-- | [drivers/net/wireless/ath/ath12k/mac.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/ath/ath12k/mac.c?id=2093f062b26805789b73f2af214691475d9baa29) | 18 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 9 deletions

| diff --git a/drivers/net/wireless/ath/ath12k/mac.c b/drivers/net/wireless/ath/ath12k/mac.cindex 6d0784a21558ea..8946141aa0dce6 100644--- a/[drivers/net/wireless/ath/ath12k/mac.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/ath/ath12k/mac.c?id=fbdf26dcc6d697b9fd44668d415b8c01771c7fd5)+++ b/[drivers/net/wireless/ath/ath12k/mac.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/ath/ath12k/mac.c?id=2093f062b26805789b73f2af214691475d9baa29)@@ -8186,9 +8186,9 @@ ath12k\_mac\_op\_set\_bitrate\_mask(struct ieee80211\_hw \*hw, arvif->vdev\_id, ret); goto out; }- ieee80211\_iterate\_stations\_atomic(hw,- ath12k\_mac\_disable\_peer\_fixed\_rate,- arvif);+ ieee80211\_iterate\_stations\_mtx(hw,+ ath12k\_mac\_disable\_peer\_fixed\_rate,+ arvif); } else if (ath12k\_mac\_bitrate\_mask\_get\_single\_nss(ar, band, mask, &single\_nss)) { rate = WMI\_FIXED\_RATE\_NONE;@@ -8233,16 +8233,16 @@ ath12k\_mac\_op\_set\_bitrate\_mask(struct ieee80211\_hw \*hw, goto out; } - ieee80211\_iterate\_stations\_atomic(hw,- ath12k\_mac\_disable\_peer\_fixed\_rate,- arvif);+ ieee80211\_iterate\_stations\_mtx(hw,+ ath12k\_mac\_disable\_peer\_fixed\_rate,+ arvif);  mutex\_lock(&ar->conf\_mutex);  arvif->bitrate\_mask = \*mask;- ieee80211\_iterate\_stations\_atomic(hw,- ath12k\_mac\_set\_bitrate\_mask\_iter,- arvif);+ ieee80211\_iterate\_stations\_mtx(hw,+ ath12k\_mac\_set\_bitrate\_mask\_iter,+ arvif);  mutex\_unlock(&ar->conf\_mutex); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:20:17 +0000


