=== Content from git.kernel.org_8a91946c_20250114_200200.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=901070571bc191d1d8d7a1379bc5ba9446200999)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=901070571bc191d1d8d7a1379bc5ba9446200999)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=901070571bc191d1d8d7a1379bc5ba9446200999)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=901070571bc191d1d8d7a1379bc5ba9446200999)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Li Zetao <lizetao1@huawei.com> | 2024-10-10 23:41:13 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-09 10:40:59 +0100 |
| commit | [901070571bc191d1d8d7a1379bc5ba9446200999](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=901070571bc191d1d8d7a1379bc5ba9446200999) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=901070571bc191d1d8d7a1379bc5ba9446200999)) | |
| tree | [417d3ea56280d87ff3b56a55092c96270d6b2dbd](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=901070571bc191d1d8d7a1379bc5ba9446200999) | |
| parent | [ff1c45c865e1e44fd539669c4154b1f95a9c2407](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ff1c45c865e1e44fd539669c4154b1f95a9c2407) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=901070571bc191d1d8d7a1379bc5ba9446200999&id2=ff1c45c865e1e44fd539669c4154b1f95a9c2407)) | |
| download | [linux-901070571bc191d1d8d7a1379bc5ba9446200999.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-901070571bc191d1d8d7a1379bc5ba9446200999.tar.gz) | |

media: ts2020: fix null-ptr-deref in ts2020\_probe()commit 4a058b34b52ed3feb1f3ff6fd26aefeeeed20cba upstream.
KASAN reported a null-ptr-deref issue when executing the following
command:
# echo ts2020 0x20 > /sys/bus/i2c/devices/i2c-0/new\_device
KASAN: null-ptr-deref in range [0x0000000000000010-0x0000000000000017]
CPU: 53 UID: 0 PID: 970 Comm: systemd-udevd Not tainted 6.12.0-rc2+ #24
Hardware name: QEMU Standard PC (Q35 + ICH9, 2009)
RIP: 0010:ts2020\_probe+0xad/0xe10 [ts2020]
RSP: 0018:ffffc9000abbf598 EFLAGS: 00010202
RAX: dffffc0000000000 RBX: 0000000000000000 RCX: ffffffffc0714809
RDX: 0000000000000002 RSI: ffff88811550be00 RDI: 0000000000000010
RBP: ffff888109868800 R08: 0000000000000001 R09: fffff52001577eb6
R10: 0000000000000000 R11: ffffc9000abbff50 R12: ffffffffc0714790
R13: 1ffff92001577eb8 R14: ffffffffc07190d0 R15: 0000000000000001
FS: 00007f95f13b98c0(0000) GS:ffff888149280000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 0000555d2634b000 CR3: 0000000152236000 CR4: 00000000000006f0
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
Call Trace:
<TASK>
ts2020\_probe+0xad/0xe10 [ts2020]
i2c\_device\_probe+0x421/0xb40
really\_probe+0x266/0x850
...
The cause of the problem is that when using sysfs to dynamically register
an i2c device, there is no platform data, but the probe process of ts2020
needs to use platform data, resulting in a null pointer being accessed.
Solve this problem by adding checks to platform data.
Fixes: dc245a5f9b51 ("[media] ts2020: implement I2C client bindings")
Cc: <stable@vger.kernel.org>
Signed-off-by: Li Zetao <lizetao1@huawei.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=901070571bc191d1d8d7a1379bc5ba9446200999)

| -rw-r--r-- | [drivers/media/dvb-frontends/ts2020.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/dvb-frontends/ts2020.c?id=901070571bc191d1d8d7a1379bc5ba9446200999) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 1 deletions

| diff --git a/drivers/media/dvb-frontends/ts2020.c b/drivers/media/dvb-frontends/ts2020.cindex a5baca2449c76d..e25add6cc38e94 100644--- a/[drivers/media/dvb-frontends/ts2020.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-frontends/ts2020.c?id=ff1c45c865e1e44fd539669c4154b1f95a9c2407)+++ b/[drivers/media/dvb-frontends/ts2020.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-frontends/ts2020.c?id=901070571bc191d1d8d7a1379bc5ba9446200999)@@ -553,13 +553,19 @@ static void ts2020\_regmap\_unlock(void \*\_\_dev) static int ts2020\_probe(struct i2c\_client \*client) { struct ts2020\_config \*pdata = client->dev.platform\_data;- struct dvb\_frontend \*fe = pdata->fe;+ struct dvb\_frontend \*fe; struct ts2020\_priv \*dev; int ret; u8 u8tmp; unsigned int utmp; char \*chip\_str; + if (!pdata) {+ dev\_err(&client->dev, "platform data is mandatory\n");+ return -EINVAL;+ }++ fe = pdata->fe; dev = kzalloc(sizeof(\*dev), GFP\_KERNEL); if (!dev) { ret = -ENOMEM; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:00:37 +0000



=== Content from git.kernel.org_e0ba95da_20250114_200200.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=a2ed3b780f34e4a6403064208bc2c99d1ed85026)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a2ed3b780f34e4a6403064208bc2c99d1ed85026)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a2ed3b780f34e4a6403064208bc2c99d1ed85026)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a2ed3b780f34e4a6403064208bc2c99d1ed85026)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Li Zetao <lizetao1@huawei.com> | 2024-10-10 23:41:13 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-09 10:33:03 +0100 |
| commit | [a2ed3b780f34e4a6403064208bc2c99d1ed85026](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a2ed3b780f34e4a6403064208bc2c99d1ed85026) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=a2ed3b780f34e4a6403064208bc2c99d1ed85026)) | |
| tree | [08d4bb2fd449699faf08abb28f883604d1e87e32](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a2ed3b780f34e4a6403064208bc2c99d1ed85026) | |
| parent | [9ca2c2ad6ffa287e5d2f89ee358dedc547820f84](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9ca2c2ad6ffa287e5d2f89ee358dedc547820f84) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a2ed3b780f34e4a6403064208bc2c99d1ed85026&id2=9ca2c2ad6ffa287e5d2f89ee358dedc547820f84)) | |
| download | [linux-a2ed3b780f34e4a6403064208bc2c99d1ed85026.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-a2ed3b780f34e4a6403064208bc2c99d1ed85026.tar.gz) | |

media: ts2020: fix null-ptr-deref in ts2020\_probe()commit 4a058b34b52ed3feb1f3ff6fd26aefeeeed20cba upstream.
KASAN reported a null-ptr-deref issue when executing the following
command:
# echo ts2020 0x20 > /sys/bus/i2c/devices/i2c-0/new\_device
KASAN: null-ptr-deref in range [0x0000000000000010-0x0000000000000017]
CPU: 53 UID: 0 PID: 970 Comm: systemd-udevd Not tainted 6.12.0-rc2+ #24
Hardware name: QEMU Standard PC (Q35 + ICH9, 2009)
RIP: 0010:ts2020\_probe+0xad/0xe10 [ts2020]
RSP: 0018:ffffc9000abbf598 EFLAGS: 00010202
RAX: dffffc0000000000 RBX: 0000000000000000 RCX: ffffffffc0714809
RDX: 0000000000000002 RSI: ffff88811550be00 RDI: 0000000000000010
RBP: ffff888109868800 R08: 0000000000000001 R09: fffff52001577eb6
R10: 0000000000000000 R11: ffffc9000abbff50 R12: ffffffffc0714790
R13: 1ffff92001577eb8 R14: ffffffffc07190d0 R15: 0000000000000001
FS: 00007f95f13b98c0(0000) GS:ffff888149280000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 0000555d2634b000 CR3: 0000000152236000 CR4: 00000000000006f0
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
Call Trace:
<TASK>
ts2020\_probe+0xad/0xe10 [ts2020]
i2c\_device\_probe+0x421/0xb40
really\_probe+0x266/0x850
...
The cause of the problem is that when using sysfs to dynamically register
an i2c device, there is no platform data, but the probe process of ts2020
needs to use platform data, resulting in a null pointer being accessed.
Solve this problem by adding checks to platform data.
Fixes: dc245a5f9b51 ("[media] ts2020: implement I2C client bindings")
Cc: <stable@vger.kernel.org>
Signed-off-by: Li Zetao <lizetao1@huawei.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a2ed3b780f34e4a6403064208bc2c99d1ed85026)

| -rw-r--r-- | [drivers/media/dvb-frontends/ts2020.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/dvb-frontends/ts2020.c?id=a2ed3b780f34e4a6403064208bc2c99d1ed85026) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 1 deletions

| diff --git a/drivers/media/dvb-frontends/ts2020.c b/drivers/media/dvb-frontends/ts2020.cindex a5ebce57f35e6e..d49facd92cc00c 100644--- a/[drivers/media/dvb-frontends/ts2020.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-frontends/ts2020.c?id=9ca2c2ad6ffa287e5d2f89ee358dedc547820f84)+++ b/[drivers/media/dvb-frontends/ts2020.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-frontends/ts2020.c?id=a2ed3b780f34e4a6403064208bc2c99d1ed85026)@@ -553,13 +553,19 @@ static void ts2020\_regmap\_unlock(void \*\_\_dev) static int ts2020\_probe(struct i2c\_client \*client) { struct ts2020\_config \*pdata = client->dev.platform\_data;- struct dvb\_frontend \*fe = pdata->fe;+ struct dvb\_frontend \*fe; struct ts2020\_priv \*dev; int ret; u8 u8tmp; unsigned int utmp; char \*chip\_str; + if (!pdata) {+ dev\_err(&client->dev, "platform data is mandatory\n");+ return -EINVAL;+ }++ fe = pdata->fe; dev = kzalloc(sizeof(\*dev), GFP\_KERNEL); if (!dev) { ret = -ENOMEM; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:00:38 +0000



=== Content from git.kernel.org_e7514a81_20250114_200159.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=4a058b34b52ed3feb1f3ff6fd26aefeeeed20cba)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4a058b34b52ed3feb1f3ff6fd26aefeeeed20cba)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4a058b34b52ed3feb1f3ff6fd26aefeeeed20cba)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4a058b34b52ed3feb1f3ff6fd26aefeeeed20cba)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Li Zetao <lizetao1@huawei.com> | 2024-10-10 23:41:13 +0800 |
| --- | --- | --- |
| committer | Hans Verkuil <hverkuil-cisco@xs4all.nl> | 2024-10-12 16:28:26 +0200 |
| commit | [4a058b34b52ed3feb1f3ff6fd26aefeeeed20cba](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4a058b34b52ed3feb1f3ff6fd26aefeeeed20cba) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=4a058b34b52ed3feb1f3ff6fd26aefeeeed20cba)) | |
| tree | [0537392fcb329a4851c819b3ed48565e4f5328c2](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4a058b34b52ed3feb1f3ff6fd26aefeeeed20cba) | |
| parent | [0f514068fbc5d4d189c817adc7c4e32cffdc2e47](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0f514068fbc5d4d189c817adc7c4e32cffdc2e47) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4a058b34b52ed3feb1f3ff6fd26aefeeeed20cba&id2=0f514068fbc5d4d189c817adc7c4e32cffdc2e47)) | |
| download | [linux-4a058b34b52ed3feb1f3ff6fd26aefeeeed20cba.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-4a058b34b52ed3feb1f3ff6fd26aefeeeed20cba.tar.gz) | |

media: ts2020: fix null-ptr-deref in ts2020\_probe()KASAN reported a null-ptr-deref issue when executing the following
command:
# echo ts2020 0x20 > /sys/bus/i2c/devices/i2c-0/new\_device
KASAN: null-ptr-deref in range [0x0000000000000010-0x0000000000000017]
CPU: 53 UID: 0 PID: 970 Comm: systemd-udevd Not tainted 6.12.0-rc2+ #24
Hardware name: QEMU Standard PC (Q35 + ICH9, 2009)
RIP: 0010:ts2020\_probe+0xad/0xe10 [ts2020]
RSP: 0018:ffffc9000abbf598 EFLAGS: 00010202
RAX: dffffc0000000000 RBX: 0000000000000000 RCX: ffffffffc0714809
RDX: 0000000000000002 RSI: ffff88811550be00 RDI: 0000000000000010
RBP: ffff888109868800 R08: 0000000000000001 R09: fffff52001577eb6
R10: 0000000000000000 R11: ffffc9000abbff50 R12: ffffffffc0714790
R13: 1ffff92001577eb8 R14: ffffffffc07190d0 R15: 0000000000000001
FS: 00007f95f13b98c0(0000) GS:ffff888149280000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 0000555d2634b000 CR3: 0000000152236000 CR4: 00000000000006f0
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
Call Trace:
<TASK>
ts2020\_probe+0xad/0xe10 [ts2020]
i2c\_device\_probe+0x421/0xb40
really\_probe+0x266/0x850
...
The cause of the problem is that when using sysfs to dynamically register
an i2c device, there is no platform data, but the probe process of ts2020
needs to use platform data, resulting in a null pointer being accessed.
Solve this problem by adding checks to platform data.
Fixes: dc245a5f9b51 ("[media] ts2020: implement I2C client bindings")
Cc: <stable@vger.kernel.org>
Signed-off-by: Li Zetao <lizetao1@huawei.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4a058b34b52ed3feb1f3ff6fd26aefeeeed20cba)

| -rw-r--r-- | [drivers/media/dvb-frontends/ts2020.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/dvb-frontends/ts2020.c?id=4a058b34b52ed3feb1f3ff6fd26aefeeeed20cba) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 1 deletions

| diff --git a/drivers/media/dvb-frontends/ts2020.c b/drivers/media/dvb-frontends/ts2020.cindex a5baca2449c76d..e25add6cc38e94 100644--- a/[drivers/media/dvb-frontends/ts2020.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-frontends/ts2020.c?id=0f514068fbc5d4d189c817adc7c4e32cffdc2e47)+++ b/[drivers/media/dvb-frontends/ts2020.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-frontends/ts2020.c?id=4a058b34b52ed3feb1f3ff6fd26aefeeeed20cba)@@ -553,13 +553,19 @@ static void ts2020\_regmap\_unlock(void \*\_\_dev) static int ts2020\_probe(struct i2c\_client \*client) { struct ts2020\_config \*pdata = client->dev.platform\_data;- struct dvb\_frontend \*fe = pdata->fe;+ struct dvb\_frontend \*fe; struct ts2020\_priv \*dev; int ret; u8 u8tmp; unsigned int utmp; char \*chip\_str; + if (!pdata) {+ dev\_err(&client->dev, "platform data is mandatory\n");+ return -EINVAL;+ }++ fe = pdata->fe; dev = kzalloc(sizeof(\*dev), GFP\_KERNEL); if (!dev) { ret = -ENOMEM; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:00:36 +0000



=== Content from git.kernel.org_3efa1c50_20250114_200159.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=5a53f97cd5977911850b695add057f9965c1a2d6)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5a53f97cd5977911850b695add057f9965c1a2d6)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5a53f97cd5977911850b695add057f9965c1a2d6)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5a53f97cd5977911850b695add057f9965c1a2d6)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Li Zetao <lizetao1@huawei.com> | 2024-10-10 23:41:13 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:47:36 +0100 |
| commit | [5a53f97cd5977911850b695add057f9965c1a2d6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5a53f97cd5977911850b695add057f9965c1a2d6) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=5a53f97cd5977911850b695add057f9965c1a2d6)) | |
| tree | [16c5ba39f7dc232d3d4b5bffc1232ffeaa0e418f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5a53f97cd5977911850b695add057f9965c1a2d6) | |
| parent | [5c9ab34c87af718bdbf9faa2b1a6ba41d15380ea](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5c9ab34c87af718bdbf9faa2b1a6ba41d15380ea) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5a53f97cd5977911850b695add057f9965c1a2d6&id2=5c9ab34c87af718bdbf9faa2b1a6ba41d15380ea)) | |
| download | [linux-5a53f97cd5977911850b695add057f9965c1a2d6.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-5a53f97cd5977911850b695add057f9965c1a2d6.tar.gz) | |

media: ts2020: fix null-ptr-deref in ts2020\_probe()commit 4a058b34b52ed3feb1f3ff6fd26aefeeeed20cba upstream.
KASAN reported a null-ptr-deref issue when executing the following
command:
# echo ts2020 0x20 > /sys/bus/i2c/devices/i2c-0/new\_device
KASAN: null-ptr-deref in range [0x0000000000000010-0x0000000000000017]
CPU: 53 UID: 0 PID: 970 Comm: systemd-udevd Not tainted 6.12.0-rc2+ #24
Hardware name: QEMU Standard PC (Q35 + ICH9, 2009)
RIP: 0010:ts2020\_probe+0xad/0xe10 [ts2020]
RSP: 0018:ffffc9000abbf598 EFLAGS: 00010202
RAX: dffffc0000000000 RBX: 0000000000000000 RCX: ffffffffc0714809
RDX: 0000000000000002 RSI: ffff88811550be00 RDI: 0000000000000010
RBP: ffff888109868800 R08: 0000000000000001 R09: fffff52001577eb6
R10: 0000000000000000 R11: ffffc9000abbff50 R12: ffffffffc0714790
R13: 1ffff92001577eb8 R14: ffffffffc07190d0 R15: 0000000000000001
FS: 00007f95f13b98c0(0000) GS:ffff888149280000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 0000555d2634b000 CR3: 0000000152236000 CR4: 00000000000006f0
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
Call Trace:
<TASK>
ts2020\_probe+0xad/0xe10 [ts2020]
i2c\_device\_probe+0x421/0xb40
really\_probe+0x266/0x850
...
The cause of the problem is that when using sysfs to dynamically register
an i2c device, there is no platform data, but the probe process of ts2020
needs to use platform data, resulting in a null pointer being accessed.
Solve this problem by adding checks to platform data.
Fixes: dc245a5f9b51 ("[media] ts2020: implement I2C client bindings")
Cc: <stable@vger.kernel.org>
Signed-off-by: Li Zetao <lizetao1@huawei.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5a53f97cd5977911850b695add057f9965c1a2d6)

| -rw-r--r-- | [drivers/media/dvb-frontends/ts2020.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/dvb-frontends/ts2020.c?id=5a53f97cd5977911850b695add057f9965c1a2d6) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 1 deletions

| diff --git a/drivers/media/dvb-frontends/ts2020.c b/drivers/media/dvb-frontends/ts2020.cindex 1f1004ccce1e48..8e5eefe0894173 100644--- a/[drivers/media/dvb-frontends/ts2020.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-frontends/ts2020.c?id=5c9ab34c87af718bdbf9faa2b1a6ba41d15380ea)+++ b/[drivers/media/dvb-frontends/ts2020.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-frontends/ts2020.c?id=5a53f97cd5977911850b695add057f9965c1a2d6)@@ -554,13 +554,19 @@ static int ts2020\_probe(struct i2c\_client \*client, const struct i2c\_device\_id \*id) { struct ts2020\_config \*pdata = client->dev.platform\_data;- struct dvb\_frontend \*fe = pdata->fe;+ struct dvb\_frontend \*fe; struct ts2020\_priv \*dev; int ret; u8 u8tmp; unsigned int utmp; char \*chip\_str; + if (!pdata) {+ dev\_err(&client->dev, "platform data is mandatory\n");+ return -EINVAL;+ }++ fe = pdata->fe; dev = kzalloc(sizeof(\*dev), GFP\_KERNEL); if (!dev) { ret = -ENOMEM; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:00:37 +0000



=== Content from git.kernel.org_4b7a0406_20250114_200202.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ced1c04e82e3ecc246b921b9733f0df0866aa50d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ced1c04e82e3ecc246b921b9733f0df0866aa50d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ced1c04e82e3ecc246b921b9733f0df0866aa50d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ced1c04e82e3ecc246b921b9733f0df0866aa50d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Li Zetao <lizetao1@huawei.com> | 2024-10-10 23:41:13 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:44:42 +0100 |
| commit | [ced1c04e82e3ecc246b921b9733f0df0866aa50d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ced1c04e82e3ecc246b921b9733f0df0866aa50d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ced1c04e82e3ecc246b921b9733f0df0866aa50d)) | |
| tree | [9cbf9db1096e0f0a40cedd3a3b55dceb863b5ab0](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ced1c04e82e3ecc246b921b9733f0df0866aa50d) | |
| parent | [13193a97ddd5a6a5b11408ddbc1ae85588b1860c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=13193a97ddd5a6a5b11408ddbc1ae85588b1860c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ced1c04e82e3ecc246b921b9733f0df0866aa50d&id2=13193a97ddd5a6a5b11408ddbc1ae85588b1860c)) | |
| download | [linux-ced1c04e82e3ecc246b921b9733f0df0866aa50d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ced1c04e82e3ecc246b921b9733f0df0866aa50d.tar.gz) | |

media: ts2020: fix null-ptr-deref in ts2020\_probe()commit 4a058b34b52ed3feb1f3ff6fd26aefeeeed20cba upstream.
KASAN reported a null-ptr-deref issue when executing the following
command:
# echo ts2020 0x20 > /sys/bus/i2c/devices/i2c-0/new\_device
KASAN: null-ptr-deref in range [0x0000000000000010-0x0000000000000017]
CPU: 53 UID: 0 PID: 970 Comm: systemd-udevd Not tainted 6.12.0-rc2+ #24
Hardware name: QEMU Standard PC (Q35 + ICH9, 2009)
RIP: 0010:ts2020\_probe+0xad/0xe10 [ts2020]
RSP: 0018:ffffc9000abbf598 EFLAGS: 00010202
RAX: dffffc0000000000 RBX: 0000000000000000 RCX: ffffffffc0714809
RDX: 0000000000000002 RSI: ffff88811550be00 RDI: 0000000000000010
RBP: ffff888109868800 R08: 0000000000000001 R09: fffff52001577eb6
R10: 0000000000000000 R11: ffffc9000abbff50 R12: ffffffffc0714790
R13: 1ffff92001577eb8 R14: ffffffffc07190d0 R15: 0000000000000001
FS: 00007f95f13b98c0(0000) GS:ffff888149280000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 0000555d2634b000 CR3: 0000000152236000 CR4: 00000000000006f0
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
Call Trace:
<TASK>
ts2020\_probe+0xad/0xe10 [ts2020]
i2c\_device\_probe+0x421/0xb40
really\_probe+0x266/0x850
...
The cause of the problem is that when using sysfs to dynamically register
an i2c device, there is no platform data, but the probe process of ts2020
needs to use platform data, resulting in a null pointer being accessed.
Solve this problem by adding checks to platform data.
Fixes: dc245a5f9b51 ("[media] ts2020: implement I2C client bindings")
Cc: <stable@vger.kernel.org>
Signed-off-by: Li Zetao <lizetao1@huawei.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ced1c04e82e3ecc246b921b9733f0df0866aa50d)

| -rw-r--r-- | [drivers/media/dvb-frontends/ts2020.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/dvb-frontends/ts2020.c?id=ced1c04e82e3ecc246b921b9733f0df0866aa50d) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 1 deletions

| diff --git a/drivers/media/dvb-frontends/ts2020.c b/drivers/media/dvb-frontends/ts2020.cindex 06dedd42e7b194..1ffed35c6c6afd 100644--- a/[drivers/media/dvb-frontends/ts2020.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-frontends/ts2020.c?id=13193a97ddd5a6a5b11408ddbc1ae85588b1860c)+++ b/[drivers/media/dvb-frontends/ts2020.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-frontends/ts2020.c?id=ced1c04e82e3ecc246b921b9733f0df0866aa50d)@@ -554,13 +554,19 @@ static int ts2020\_probe(struct i2c\_client \*client, const struct i2c\_device\_id \*id) { struct ts2020\_config \*pdata = client->dev.platform\_data;- struct dvb\_frontend \*fe = pdata->fe;+ struct dvb\_frontend \*fe; struct ts2020\_priv \*dev; int ret; u8 u8tmp; unsigned int utmp; char \*chip\_str; + if (!pdata) {+ dev\_err(&client->dev, "platform data is mandatory\n");+ return -EINVAL;+ }++ fe = pdata->fe; dev = kzalloc(sizeof(\*dev), GFP\_KERNEL); if (!dev) { ret = -ENOMEM; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:00:39 +0000



=== Content from git.kernel.org_a9d0ae99_20250114_200203.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=dc03866b5f4aa2668946f8384a1e5286ae53bbaa)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=dc03866b5f4aa2668946f8384a1e5286ae53bbaa)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=dc03866b5f4aa2668946f8384a1e5286ae53bbaa)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=dc03866b5f4aa2668946f8384a1e5286ae53bbaa)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Li Zetao <lizetao1@huawei.com> | 2024-10-10 23:41:13 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:54:11 +0100 |
| commit | [dc03866b5f4aa2668946f8384a1e5286ae53bbaa](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=dc03866b5f4aa2668946f8384a1e5286ae53bbaa) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=dc03866b5f4aa2668946f8384a1e5286ae53bbaa)) | |
| tree | [c7671aa3e987e855c99cfc1e1209a3126be199f2](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=dc03866b5f4aa2668946f8384a1e5286ae53bbaa) | |
| parent | [12914fd765ba4f9d6a9a50439e8dd2e9f91423f2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=12914fd765ba4f9d6a9a50439e8dd2e9f91423f2) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=dc03866b5f4aa2668946f8384a1e5286ae53bbaa&id2=12914fd765ba4f9d6a9a50439e8dd2e9f91423f2)) | |
| download | [linux-dc03866b5f4aa2668946f8384a1e5286ae53bbaa.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-dc03866b5f4aa2668946f8384a1e5286ae53bbaa.tar.gz) | |

media: ts2020: fix null-ptr-deref in ts2020\_probe()commit 4a058b34b52ed3feb1f3ff6fd26aefeeeed20cba upstream.
KASAN reported a null-ptr-deref issue when executing the following
command:
# echo ts2020 0x20 > /sys/bus/i2c/devices/i2c-0/new\_device
KASAN: null-ptr-deref in range [0x0000000000000010-0x0000000000000017]
CPU: 53 UID: 0 PID: 970 Comm: systemd-udevd Not tainted 6.12.0-rc2+ #24
Hardware name: QEMU Standard PC (Q35 + ICH9, 2009)
RIP: 0010:ts2020\_probe+0xad/0xe10 [ts2020]
RSP: 0018:ffffc9000abbf598 EFLAGS: 00010202
RAX: dffffc0000000000 RBX: 0000000000000000 RCX: ffffffffc0714809
RDX: 0000000000000002 RSI: ffff88811550be00 RDI: 0000000000000010
RBP: ffff888109868800 R08: 0000000000000001 R09: fffff52001577eb6
R10: 0000000000000000 R11: ffffc9000abbff50 R12: ffffffffc0714790
R13: 1ffff92001577eb8 R14: ffffffffc07190d0 R15: 0000000000000001
FS: 00007f95f13b98c0(0000) GS:ffff888149280000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 0000555d2634b000 CR3: 0000000152236000 CR4: 00000000000006f0
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
Call Trace:
<TASK>
ts2020\_probe+0xad/0xe10 [ts2020]
i2c\_device\_probe+0x421/0xb40
really\_probe+0x266/0x850
...
The cause of the problem is that when using sysfs to dynamically register
an i2c device, there is no platform data, but the probe process of ts2020
needs to use platform data, resulting in a null pointer being accessed.
Solve this problem by adding checks to platform data.
Fixes: dc245a5f9b51 ("[media] ts2020: implement I2C client bindings")
Cc: <stable@vger.kernel.org>
Signed-off-by: Li Zetao <lizetao1@huawei.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=dc03866b5f4aa2668946f8384a1e5286ae53bbaa)

| -rw-r--r-- | [drivers/media/dvb-frontends/ts2020.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/dvb-frontends/ts2020.c?id=dc03866b5f4aa2668946f8384a1e5286ae53bbaa) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 1 deletions

| diff --git a/drivers/media/dvb-frontends/ts2020.c b/drivers/media/dvb-frontends/ts2020.cindex 2f64f1a8bc2333..28de1c7de38f7c 100644--- a/[drivers/media/dvb-frontends/ts2020.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-frontends/ts2020.c?id=12914fd765ba4f9d6a9a50439e8dd2e9f91423f2)+++ b/[drivers/media/dvb-frontends/ts2020.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-frontends/ts2020.c?id=dc03866b5f4aa2668946f8384a1e5286ae53bbaa)@@ -554,13 +554,19 @@ static int ts2020\_probe(struct i2c\_client \*client, const struct i2c\_device\_id \*id) { struct ts2020\_config \*pdata = client->dev.platform\_data;- struct dvb\_frontend \*fe = pdata->fe;+ struct dvb\_frontend \*fe; struct ts2020\_priv \*dev; int ret; u8 u8tmp; unsigned int utmp; char \*chip\_str; + if (!pdata) {+ dev\_err(&client->dev, "platform data is mandatory\n");+ return -EINVAL;+ }++ fe = pdata->fe; dev = kzalloc(sizeof(\*dev), GFP\_KERNEL); if (!dev) { ret = -ENOMEM; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:00:40 +0000



=== Content from git.kernel.org_20e4624c_20250114_200201.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b6208d1567f929105011bcdfd738f59a6bdc1088)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b6208d1567f929105011bcdfd738f59a6bdc1088)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b6208d1567f929105011bcdfd738f59a6bdc1088)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b6208d1567f929105011bcdfd738f59a6bdc1088)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Li Zetao <lizetao1@huawei.com> | 2024-10-10 23:41:13 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:50:32 +0100 |
| commit | [b6208d1567f929105011bcdfd738f59a6bdc1088](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b6208d1567f929105011bcdfd738f59a6bdc1088) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b6208d1567f929105011bcdfd738f59a6bdc1088)) | |
| tree | [68b8a8d643cbbabe2c3aa3fe3808e62ebcedb544](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b6208d1567f929105011bcdfd738f59a6bdc1088) | |
| parent | [f3c4e088ec01cae45931a18ddf7cae0f4d72e1c5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f3c4e088ec01cae45931a18ddf7cae0f4d72e1c5) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b6208d1567f929105011bcdfd738f59a6bdc1088&id2=f3c4e088ec01cae45931a18ddf7cae0f4d72e1c5)) | |
| download | [linux-b6208d1567f929105011bcdfd738f59a6bdc1088.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b6208d1567f929105011bcdfd738f59a6bdc1088.tar.gz) | |

media: ts2020: fix null-ptr-deref in ts2020\_probe()commit 4a058b34b52ed3feb1f3ff6fd26aefeeeed20cba upstream.
KASAN reported a null-ptr-deref issue when executing the following
command:
# echo ts2020 0x20 > /sys/bus/i2c/devices/i2c-0/new\_device
KASAN: null-ptr-deref in range [0x0000000000000010-0x0000000000000017]
CPU: 53 UID: 0 PID: 970 Comm: systemd-udevd Not tainted 6.12.0-rc2+ #24
Hardware name: QEMU Standard PC (Q35 + ICH9, 2009)
RIP: 0010:ts2020\_probe+0xad/0xe10 [ts2020]
RSP: 0018:ffffc9000abbf598 EFLAGS: 00010202
RAX: dffffc0000000000 RBX: 0000000000000000 RCX: ffffffffc0714809
RDX: 0000000000000002 RSI: ffff88811550be00 RDI: 0000000000000010
RBP: ffff888109868800 R08: 0000000000000001 R09: fffff52001577eb6
R10: 0000000000000000 R11: ffffc9000abbff50 R12: ffffffffc0714790
R13: 1ffff92001577eb8 R14: ffffffffc07190d0 R15: 0000000000000001
FS: 00007f95f13b98c0(0000) GS:ffff888149280000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 0000555d2634b000 CR3: 0000000152236000 CR4: 00000000000006f0
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
Call Trace:
<TASK>
ts2020\_probe+0xad/0xe10 [ts2020]
i2c\_device\_probe+0x421/0xb40
really\_probe+0x266/0x850
...
The cause of the problem is that when using sysfs to dynamically register
an i2c device, there is no platform data, but the probe process of ts2020
needs to use platform data, resulting in a null pointer being accessed.
Solve this problem by adding checks to platform data.
Fixes: dc245a5f9b51 ("[media] ts2020: implement I2C client bindings")
Cc: <stable@vger.kernel.org>
Signed-off-by: Li Zetao <lizetao1@huawei.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b6208d1567f929105011bcdfd738f59a6bdc1088)

| -rw-r--r-- | [drivers/media/dvb-frontends/ts2020.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/dvb-frontends/ts2020.c?id=b6208d1567f929105011bcdfd738f59a6bdc1088) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 1 deletions

| diff --git a/drivers/media/dvb-frontends/ts2020.c b/drivers/media/dvb-frontends/ts2020.cindex 4e89193f8e6a91..cc91ee838efe6e 100644--- a/[drivers/media/dvb-frontends/ts2020.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-frontends/ts2020.c?id=f3c4e088ec01cae45931a18ddf7cae0f4d72e1c5)+++ b/[drivers/media/dvb-frontends/ts2020.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-frontends/ts2020.c?id=b6208d1567f929105011bcdfd738f59a6bdc1088)@@ -554,13 +554,19 @@ static int ts2020\_probe(struct i2c\_client \*client, const struct i2c\_device\_id \*id) { struct ts2020\_config \*pdata = client->dev.platform\_data;- struct dvb\_frontend \*fe = pdata->fe;+ struct dvb\_frontend \*fe; struct ts2020\_priv \*dev; int ret; u8 u8tmp; unsigned int utmp; char \*chip\_str; + if (!pdata) {+ dev\_err(&client->dev, "platform data is mandatory\n");+ return -EINVAL;+ }++ fe = pdata->fe; dev = kzalloc(sizeof(\*dev), GFP\_KERNEL); if (!dev) { ret = -ENOMEM; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:00:38 +0000


