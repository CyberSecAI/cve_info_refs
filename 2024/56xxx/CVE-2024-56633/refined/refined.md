```
{
  "vulnerability": {
    "root_cause": "The sk memory accounting logic in `__SK_REDIRECT` in `tcp_bpf_sendmsg` was pre-uncharging bytes before they were actually sent, leading to potential double frees or memory leaks.",
    "weaknesses": [
      "Incorrect memory accounting",
      "Potential double free",
      "Potential memory leak"
    ],
    "impact": "Incorrect socket memory accounting, leading to kernel warnings and potential instability. In specific scenarios, it may lead to a double free or memory leak.",
     "attack_vectors": "The vulnerability is triggered through the use of the `tcp_bpf_sendmsg` function with `__SK_REDIRECT` or `__SK_DROP` evaluations when a `psock->apply_bytes` value smaller than `msg->sg.size` is in effect. Exploitation requires the ability to trigger the specific code path involving redirect or drop actions within the BPF program.",
    "required_capabilities": "An attacker would need the capability to load and execute a BPF program that uses sockmap functionality and can trigger the `__SK_REDIRECT` or `__SK_DROP` actions within the `tcp_bpf_sendmsg` function."
  },
  "affected_code": [
    {
      "file": "net/ipv4/tcp_bpf.c",
      "lines_removed": [
        441,
        456,
        468,
        487
      ],
      "lines_added": [
        452,
        457,
        469
      ]
    }
  ]
}
```