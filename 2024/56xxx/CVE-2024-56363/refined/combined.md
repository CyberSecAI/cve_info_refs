=== Content from github.com_1f3e56bf_20250115_102447.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAPTRS%2FAPTRS%2Fcommit%2F9f6b6e4a56a9119eb12126a4909441e83b6d7c11)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAPTRS%2FAPTRS%2Fcommit%2F9f6b6e4a56a9119eb12126a4909441e83b6d7c11)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=APTRS%2FAPTRS)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[APTRS](/APTRS)
/
**[APTRS](/APTRS/APTRS)**
Public

* [Notifications](/login?return_to=%2FAPTRS%2FAPTRS) You must be signed in to change notification settings
* [Fork
  98](/login?return_to=%2FAPTRS%2FAPTRS)
* [Star
   821](/login?return_to=%2FAPTRS%2FAPTRS)

* [Code](/APTRS/APTRS)
* [Issues
  1](/APTRS/APTRS/issues)
* [Pull requests
  9](/APTRS/APTRS/pulls)
* [Discussions](/APTRS/APTRS/discussions)
* [Actions](/APTRS/APTRS/actions)
* [Projects
  2](/APTRS/APTRS/projects)
* [Wiki](/APTRS/APTRS/wiki)
* [Security](/APTRS/APTRS/security)
* [Insights](/APTRS/APTRS/pulse)

Additional navigation options

* [Code](/APTRS/APTRS)
* [Issues](/APTRS/APTRS/issues)
* [Pull requests](/APTRS/APTRS/pulls)
* [Discussions](/APTRS/APTRS/discussions)
* [Actions](/APTRS/APTRS/actions)
* [Projects](/APTRS/APTRS/projects)
* [Wiki](/APTRS/APTRS/wiki)
* [Security](/APTRS/APTRS/security)
* [Insights](/APTRS/APTRS/pulse)

## Commit

[Permalink](/APTRS/APTRS/commit/9f6b6e4a56a9119eb12126a4909441e83b6d7c11)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fixed SSTI

[Browse files](/APTRS/APTRS/tree/9f6b6e4a56a9119eb12126a4909441e83b6d7c11)
Browse the repository at this point in the history

* Loading branch information

[![@Anof-cyber](https://avatars.githubusercontent.com/u/39705906?s=40&v=4)](/Anof-cyber)

[Anof-cyber](/APTRS/APTRS/commits?author=Anof-cyber "View all commits by Anof-cyber")
committed
Dec 22, 2024

1 parent
[9091c22](/APTRS/APTRS/commit/9091c22f0f13b10f802eb9913c3c3adbd394d080)

commit 9f6b6e4

 Show file tree

 Hide file tree

Showing
**7 changed files**
with
**62 additions**
and
**105 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* APTRS

  + lib

    - APTRS/lib/htmldocx.py
      [htmldocx.py](#diff-08ac7c227422776878b7d0a11b459475b604b8750a9fc3dda1a0056b366bbf5e)
  + project

    - APTRS/project/report.py
      [report.py](#diff-bfe0a5e8fa3633ef7faf884f5595c56c0ba5e2e53b2f6d5e74a148c93a15d3fe)
    - views

      * APTRS/project/views/project.py
        [project.py](#diff-3a9618cda0c298965e96feda220d79ffe861b7f95b9df3888286b8ded6f906a7)
  + utils

    - APTRS/utils/doc\_style.py
      [doc\_style.py](#diff-910d42c7c6dd1bde763e1004fd0765207409b42ec2e22f4a4855240c601ae44f)
    - APTRS/utils/image\_parsing.py
      [image\_parsing.py](#diff-d607a9471eb6c174733964557530224b5d8aadadd8e47a55ea938160ed4944d8)
    - APTRS/utils/validators.py
      [validators.py](#diff-63d394abfc60d009a52c4b6e7e8b314fc8be684a191d315e46dda339c533ac53)
* README.md
  [README.md](#diff-b335630551682c19a781afebcf4d07bf978fb1f8ac04c6bf87428ed5106870f5)

## There are no files selected for viewing

34 changes: 21 additions & 13 deletions

34
[APTRS/lib/htmldocx.py](#diff-08ac7c227422776878b7d0a11b459475b604b8750a9fc3dda1a0056b366bbf5e "APTRS/lib/htmldocx.py")

Show comments

[View file](/APTRS/APTRS/blob/9f6b6e4a56a9119eb12126a4909441e83b6d7c11/APTRS/lib/htmldocx.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -21,7 +21,8 @@ |
|  |  | import urllib.request |
|  |  | from urllib.parse import urlparse |
|  |  | from html.parser import HTMLParser |
|  |  |  |
|  |  | import requests |
|  |  | from requests.packages.urllib3.exceptions import InsecureRequestWarning |
|  |  | import docx, docx.table |
|  |  | from docx import Document |
|  |  | from docx.shared import RGBColor, Pt, Inches |
| Expand Down  Expand Up | | @@ -52,20 +53,25 @@ def is\_url(url): |
|  |  | care if it's a url or a file path, and they're pretty distinguishable |
|  |  | """ |
|  |  | parts = urlparse(url) |
|  |  | print(all([parts.scheme, parts.netloc, parts.path])) |
|  |  | return all([parts.scheme, parts.netloc, parts.path]) |
|  |  |  |
|  |  | def fetch\_image(url): |
|  |  | def fetch\_image(url, headers, base\_url): |
|  |  | """ |
|  |  | Attempts to fetch an image from a url. |
|  |  | If successful returns a bytes object, else returns None |
|  |  |  |
|  |  | :return: |
|  |  | """ |
|  |  | try: |
|  |  | with urllib.request.urlopen(url) as response: |
|  |  | # security flaw? |
|  |  | return io.BytesIO(response.read()) |
|  |  | except urllib.error.URLError: |
|  |  | requests.packages.urllib3.disable\_warnings(InsecureRequestWarning) |
|  |  | full\_url = base\_url + url |
|  |  | headers = { |
|  |  | "Authorization": f"Bearer {headers}" |
|  |  | } |
|  |  | response = requests.get(full\_url, headers=headers,verify=False) |
|  |  | if response.status\_code == 200: |
|  |  | return io.BytesIO(response.content) |
|  |  | else: |
|  |  | return None |
|  |  |  |
|  |  | def remove\_last\_occurence(ls, x): |
| Expand Down  Expand Up | | @@ -183,7 +189,7 @@ def \_\_init\_\_(self): |
|  |  | self.table\_style = DEFAULT\_TABLE\_STYLE |
|  |  | self.paragraph\_style = DEFAULT\_PARAGRAPH\_STYLE |
|  |  |  |
|  |  | def set\_initial\_attrs(self, document=None): |
|  |  | def set\_initial\_attrs(self, document=None, headers=None, base\_url=None): |
|  |  | self.tags = { |
|  |  | 'span': [], |
|  |  | 'list': [], |
| Expand All | | @@ -192,6 +198,8 @@ def set\_initial\_attrs(self, document=None): |
|  |  | self.doc = document |
|  |  | else: |
|  |  | self.doc = Document() |
|  |  | self.headers = headers |
|  |  | self.base\_url = base\_url |
|  |  | self.bs = self.options['fix-html'] # whether or not to clean with BeautifulSoup |
|  |  | self.document = self.doc |
|  |  | self.include\_tables = True #TODO add this option back in? |
| Expand Down  Expand Up | | @@ -307,10 +315,10 @@ def handle\_img(self, current\_attrs): |
|  |  | return |
|  |  | src = current\_attrs['src'] |
|  |  | # fetch image |
|  |  | src\_is\_url = is\_url(src) |
|  |  | src\_is\_url = True #is\_url(self.base\_url + src) APTRS does not support local images |
|  |  | if src\_is\_url: |
|  |  | try: |
|  |  | image = fetch\_image(src) |
|  |  | image = fetch\_image(src,self.headers, self.base\_url) |
|  |  | except urllib.error.URLError: |
|  |  | image = None |
|  |  | else: |
| Expand All | | @@ -319,7 +327,7 @@ def handle\_img(self, current\_attrs): |
|  |  | if image: |
|  |  | try: |
|  |  | if isinstance(self.doc, docx.document.Document): |
|  |  | self.doc.add\_picture(image) |
|  |  | self.doc.add\_picture(image,width=Inches(6.69291), height=Inches(4.2244094)) |
|  |  | else: |
|  |  | self.add\_image\_to\_cell(self.doc, image) |
|  |  | except FileNotFoundError: |
| Expand Down  Expand Up | | @@ -629,12 +637,12 @@ def run\_process(self, html): |
|  |  | self.get\_tables() |
|  |  | self.feed(html) |
|  |  |  |
|  |  | def add\_html\_to\_document(self, html, document): |
|  |  | def add\_html\_to\_document(self, html, document,headers, base\_url): |
|  |  | if not isinstance(html, str): |
|  |  | raise ValueError('First argument needs to be a %s' % str) |
|  |  | elif not isinstance(document, docx.document.Document) and not isinstance(document, docx.table.\_Cell): |
|  |  | raise ValueError('Second argument needs to be a %s' % docx.document.Document) |
|  |  | self.set\_initial\_attrs(document) |
|  |  | self.set\_initial\_attrs(document,headers, base\_url) |
|  |  | self.run\_process(html) |
|  |  |  |
|  |  | def add\_html\_to\_cell(self, html, cell): |
| Expand Down | |  |

12 changes: 4 additions & 8 deletions

12
[APTRS/project/report.py](#diff-bfe0a5e8fa3633ef7faf884f5595c56c0ba5e2e53b2f6d5e74a148c93a15d3fe "APTRS/project/report.py")

Show comments

[View file](/APTRS/APTRS/blob/9f6b6e4a56a9119eb12126a4909441e83b6d7c11/APTRS/project/report.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -18,7 +18,7 @@ |
|  |  | from docxtpl import DocxTemplate,RichText |
|  |  | from django.shortcuts import get\_object\_or\_404 |
|  |  | from datetime import datetime |
|  |  | import jinja2 |
|  |  | from jinja2.sandbox import SandboxedEnvironment |
|  |  | import html |
|  |  | import traceback |
|  |  |  |
| Expand All | | @@ -36,18 +36,14 @@ |
|  |  | token = None |
|  |  |  |
|  |  |  |
|  |  | def CheckReport(Report\_format,Report\_type,pk,url,standard,request): |
|  |  | def CheckReport(Report\_format,Report\_type,pk,url,standard,request,access\_token): |
|  |  | global base\_url |
|  |  | base\_url = url |
|  |  | if Report\_format == "excel": |
|  |  | response = CreateExcel(pk) |
|  |  |  |
|  |  | global token |
|  |  | auth\_header = request.headers.get('Authorization') |
|  |  | if auth\_header: |
|  |  | token = auth\_header.split(' ')[1] if auth\_header.startswith('Bearer ') else None |
|  |  | else: |
|  |  | token = request.cookies.get('access\_token') |
|  |  | token = access\_token |
|  |  | if Report\_format == "docx": |
|  |  | response = generate\_vulnerability\_document(pk,Report\_type,standard) |
|  |  | if Report\_format == "pdf": |
| Expand Down  Expand Up | | @@ -107,7 +103,7 @@ def generate\_vulnerability\_document(pk,Report\_type,standard): |
|  |  | 'standard':standard,'totalvulnerability':totalvulnerability,'totalretest':totalretest,'projectscope':projectscope, |
|  |  | 'page\_break': RichText('\f'),'new\_line': RichText('\n') |
|  |  | } |
|  |  | jinja\_env = jinja2.Environment() |
|  |  | jinja\_env = SandboxedEnvironment(autoescape=True) |
|  |  | jinja\_env.trim\_blocks = True |
|  |  | jinja\_env.lstrip\_blocks = True |
|  |  | doc.render(context,jinja\_env) |
| Expand Down | |  |

8 changes: 5 additions & 3 deletions

8
[APTRS/project/views/project.py](#diff-3a9618cda0c298965e96feda220d79ffe861b7f95b9df3888286b8ded6f906a7 "APTRS/project/views/project.py")

Show comments

[View file](/APTRS/APTRS/blob/9f6b6e4a56a9119eb12126a4909441e83b6d7c11/APTRS/project/views/project.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -5,7 +5,7 @@ |
|  |  | from django.core.cache import cache |
|  |  | from django.utils.decorators import method\_decorator |
|  |  | from django.views.decorators.cache import cache\_page |
|  |  |  |
|  |  | from rest\_framework\_simplejwt.tokens import RefreshToken |
|  |  | from rest\_framework import status, views |
|  |  | from rest\_framework.decorators import (api\_view, permission\_classes) |
|  |  | from rest\_framework.permissions import IsAuthenticated,IsAdminUser |
| Expand Down  Expand Up | | @@ -266,6 +266,8 @@ def project\_report(request, pk): |
|  |  | except ValueError as e: |
|  |  | logging.error(f"Error: {e}") |
|  |  | return Response({"Status": "Failed", "Message": "Report Standards are not provided"}) |
|  |  |  |
|  |  | output = CheckReport(report\_format,report\_type,pk,url,standard,request) |
|  |  |  |
|  |  | refresh = RefreshToken.for\_user(request.user) # generate new token for user to access auth protected images for report, user token in request might be close to expiry, so refreshing it to have new 30 mins token |
|  |  | access\_token = refresh.access\_token |
|  |  | output = CheckReport(report\_format,report\_type,pk,url,standard,request,access\_token) |
|  |  | return output |

29 changes: 3 additions & 26 deletions

29
[APTRS/utils/doc\_style.py](#diff-910d42c7c6dd1bde763e1004fd0765207409b42ec2e22f4a4855240c601ae44f "APTRS/utils/doc_style.py")

Show comments

[View file](/APTRS/APTRS/blob/9f6b6e4a56a9119eb12126a4909441e83b6d7c11/APTRS/utils/doc_style.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -3,8 +3,9 @@ |
|  |  | from docx import Document |
|  |  | import io |
|  |  | from lib.htmldocx import HtmlToDocx |
|  |  | from utils.image\_parsing import find\_images |
|  |  | import logging |
|  |  |  |
|  |  | logger = logging.getLogger(\_\_name\_\_) |
|  |  |  |
|  |  | def apply\_font\_style(element, font\_name, font\_size): |
|  |  | if hasattr(element, 'font'): |
| Expand All | | @@ -27,22 +28,8 @@ def get\_subdoc(doc,raw\_html, headers, base\_url): |
|  |  | temp\_parser = HtmlToDocx() |
|  |  |  |
|  |  | if raw\_html is not None: |
|  |  |  |
|  |  | images = find\_images(raw\_html, headers, base\_url) |
|  |  | ''' |
|  |  | CKEDITOR HTML allow images like POC images, html imc tag will have src=/api/project/getimage/?filename=img-uuid.jpg |
|  |  | The use of API allow to handle both case in case images stored on cloud bucket or locally |
|  |  | with that images are mostly POC and contain senstive info, its easy to prevent direct access to image as /api/\* need auth token. |
|  |  | This also fix, ckeditor html direclty stored in db, if s3 url used in case of s3 allowed, having signed url in src would fail to load images if signed url expired |
|  |  |  |
|  |  | Adding fix for docxtpl , instead of url for src replacing it with image byte |
|  |  | ''' |
|  |  | # Convert image src paths - doctpl does not support loading img over url, adding image full path |
|  |  | for i, img in enumerate(images): |
|  |  | raw\_html = raw\_html.replace(img['html\_tag'], f"{{{{img{i}}}}}") |
|  |  |  |
|  |  | # Convert HTML to temporary DOCX |
|  |  | temp\_parser.add\_html\_to\_document(raw\_html, temp\_doc) |
|  |  | temp\_parser.add\_html\_to\_document(raw\_html, temp\_doc,headers, base\_url) |
|  |  |  |
|  |  | # Resize images in the temporary DOCX |
|  |  | ## https://stackoverflow.com/questions/76571366/resizing-all-images-in-a-word-document-using-python |
| Expand Down  Expand Up | | @@ -83,18 +70,8 @@ def get\_subdoc(doc,raw\_html, headers, base\_url): |
|  |  | sub\_docxtpl = DocxTemplate(subdoc\_tmp) |
|  |  | context = {} |
|  |  |  |
|  |  | # handle image bytes and place image byte as inline imaage in doc |
|  |  | for i, img in enumerate(images): |
|  |  | img\_obj = InlineImage(sub\_docxtpl, img['bytes'],width=Inches(6.69291), height=Inches(4.2244094)) |
|  |  | context[f"img{i}"] = img\_obj |
|  |  |  |
|  |  | sub\_docxtpl.render(context) |
|  |  | sub\_docxtpl.save(subdoc\_tmp) |
|  |  | subdoc\_tmp.seek(0) |
|  |  |  |
|  |  |  |
|  |  |  |
|  |  |  |
|  |  | # Create docxtpl subdoc object |
|  |  | subdoc = doc.new\_subdoc(subdoc\_tmp) |
|  |  | return subdoc |
| Expand Down | |  |

43 changes: 0 additions & 43 deletions

43
[APTRS/utils/image\_parsing.py](#diff-d607a9471eb6c174733964557530224b5d8aadadd8e47a55ea938160ed4944d8 "APTRS/utils/image_parsing.py")

Show comments

[View file](/APTRS/APTRS/blob/9091c22f0f13b10f802eb9913c3c3adbd394d080/APTRS/utils/image_parsing.py)
Edit file

Delete file

Load diff

This file was deleted.

Oops, something went wrong.

Retry

4 changes: 3 additions & 1 deletion

4
[APTRS/utils/validators.py](#diff-63d394abfc60d009a52c4b6e7e8b314fc8be684a191d315e46dda339c533ac53 "APTRS/utils/validators.py")

Show comments

[View file](/APTRS/APTRS/blob/9f6b6e4a56a9119eb12126a4909441e83b6d7c11/APTRS/utils/validators.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -4,6 +4,8 @@ |
|  |  | from django.conf import settings |
|  |  | from django.core.exceptions import ValidationError |
|  |  | from django.utils.translation import gettext as \_ |
|  |  | from jinja2.sandbox import SandboxedEnvironment |
|  |  | from docxtpl import InlineImage |
|  |  |  |
|  |  | ALLOWED\_TAGS = settings.ALLOWED\_TAGS |
|  |  |  |
| Expand Down  Expand Up | | @@ -121,4 +123,4 @@ def get\_base\_url(request=None): |
|  |  | base\_url = f"{request.scheme}://{request.get\_host()}" |
|  |  | else: |
|  |  | raise Exception("Request is required when not using Docker.") |
|  |  | return base\_url |
|  |  | return base\_url |

37 changes: 26 additions & 11 deletions

37
[README.md](#diff-b335630551682c19a781afebcf4d07bf978fb1f8ac04c6bf87428ed5106870f5 "README.md")

Show comments

[View file](/APTRS/APTRS/blob/9f6b6e4a56a9119eb12126a4909441e83b6d7c11/README.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -25,19 +25,10 @@ APTRS (Automated Penetration Testing Reporting System) is a Python and Django-ba |
|  |  | ![GitHub contributors from allcontributors.org](https://img.shields.io/github/all-contributors/aptrs/aptrs) |
|  |  |  |
|  |  |  |
|  |  | \*\*Support APTRS\*\* |
|  |  |  |
|  |  |  |
|  |  | <a href="https://github.com/sponsors/APTRS"><img src="https://img.shields.io/static/v1?label=Sponsor&message=%E2%9D%A4&logo=GitHub&color=%23fe8e86" alt="Sponsor APTRS" width="230" height="50"></a> |
|  |  | <br/><br/> |
|  |  |  |
|  |  | If you've found APTRS helpful and valuable, your support through donations is greatly appreciated. |
|  |  |  |
|  |  |  |
|  |  | ## Documentation |
|  |  |  |
|  |  | > [!WARNING] |
|  |  | > Please ensure to review the Deployment Guide for configuration and security instructions from the documentation. |
|  |  | > [!Note] |
|  |  | > Please ensure to review the Installation and Deployment Guide from the documentation. |
|  |  |  |
|  |  |  |
|  |  |  |
| Expand All | | @@ -50,7 +41,18 @@ If you've found APTRS helpful and valuable, your support through donations is gr |
|  |  | > [!NOTE] |
|  |  | > Default creds are sourav.kalal@aptrs.com & I-am-Weak-Password-Please-Change-Me |
|  |  |  |
|  |  | Quick Installation |
|  |  |  |
|  |  | > [!Warning] |
|  |  | > Please ensure to review the documentation for Security Configuration for ENV and other Installation methods. |
|  |  |  |
|  |  | ```bash |
|  |  | git clone https://github.com/APTRS/APTRS |
|  |  | cd APTRS |
|  |  | cp env.docker .env |
|  |  | nano .env |
|  |  | docker-compose up |
|  |  | ``` |
|  |  |  |
|  |  |  |
|  |  |  |
| Expand All | | @@ -68,6 +70,19 @@ If you've found APTRS helpful and valuable, your support through donations is gr |
|  |  | - Manage Project Status, Schedules and Retest |
|  |  |  |
|  |  |  |
|  |  | ## Support APTRS |
|  |  |  |
|  |  | If you've found APTRS helpful and valuable, please consider supporting the project. Your donations are crucial in helping maintain and improve APTRS, which is primarily maintained by a single dedicated developer. Your support will ensure the continued development of new features, timely updates, and the overall sustainability of the project. Every contribution, no matter how small, makes a significant difference and is greatly appreciated. Thank you for your generosity and support! |
|  |  | <div style="display: flex; flex-direction: column; align-items: center; border: 1px solid #000; padding: 10px; width: 350px;"><b>Bitcoin</b> |
|  |  | <img src="https://raw.githubusercontent.com/APTRS/APTRS-Changelog/refs/heads/main/images/BTC.png" alt="BTC Wallet QR Code" width="200" height="200"> |
|  |  | <p style="margin-top: 10px; text-align: center;">bc1qusxngf2w5gl2g8hw82ggct59227k4963f9fwhm</p> |
|  |  | </div> |
|  |  | <br/><br/> |
|  |  | <a href="https://github.com/sponsors/APTRS"><img src="https://img.shields.io/static/v1?label=Sponsor&message=%E2%9D%A4&logo=GitHub&color=%23fe8e86" alt="Sponsor APTRS" width="230" height="50"></a> |
|  |  | <br/><br/> |
|  |  |  |
|  |  |  |
|  |  |  |
|  |  | ## Sponsor |
|  |  |  |
|  |  | <p>This project is supported by:</p> |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `9f6b6e4`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAPTRS%2FAPTRS%2Fcommit%2F9f6b6e4a56a9119eb12126a4909441e83b6d7c11) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_eed53299_20250115_102448.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAPTRS%2FAPTRS%2Fsecurity%2Fadvisories%2FGHSA-h4w2-hvcg-938j)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAPTRS%2FAPTRS%2Fsecurity%2Fadvisories%2FGHSA-h4w2-hvcg-938j)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=APTRS%2FAPTRS)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[APTRS](/APTRS)
/
**[APTRS](/APTRS/APTRS)**
Public

* [Notifications](/login?return_to=%2FAPTRS%2FAPTRS) You must be signed in to change notification settings
* [Fork
  98](/login?return_to=%2FAPTRS%2FAPTRS)
* [Star
   821](/login?return_to=%2FAPTRS%2FAPTRS)

* [Code](/APTRS/APTRS)
* [Issues
  1](/APTRS/APTRS/issues)
* [Pull requests
  9](/APTRS/APTRS/pulls)
* [Discussions](/APTRS/APTRS/discussions)
* [Actions](/APTRS/APTRS/actions)
* [Projects
  2](/APTRS/APTRS/projects)
* [Wiki](/APTRS/APTRS/wiki)
* [Security](/APTRS/APTRS/security)
* [Insights](/APTRS/APTRS/pulse)

Additional navigation options

* [Code](/APTRS/APTRS)
* [Issues](/APTRS/APTRS/issues)
* [Pull requests](/APTRS/APTRS/pulls)
* [Discussions](/APTRS/APTRS/discussions)
* [Actions](/APTRS/APTRS/actions)
* [Projects](/APTRS/APTRS/projects)
* [Wiki](/APTRS/APTRS/wiki)
* [Security](/APTRS/APTRS/security)
* [Insights](/APTRS/APTRS/pulse)

# Server Side Template Injection

High

[Anof-cyber](/Anof-cyber)
published
GHSA-h4w2-hvcg-938j
Dec 23, 2024

## Package

No package listed

## Affected versions

1.0

## Patched versions

1.0.1

## Description

### Summary

A server-side template injection (SSTI) vulnerability in a web application allows an attacker to inject arbitrary Jinja2 code into a template, potentially executing malicious code on the server. This can lead to unauthorized access, data leakage, or even remote code execution, depending on the configuration.

### Details

The vulnerability occurs in the web application's handling of user-supplied input that is incorporated into a Jinja2 template. Specifically, when user input is improperly sanitized or validated, an attacker can inject Jinja2 syntax into the template, causing the server to execute arbitrary code. For example, an attacker might be able to inject expressions like {{ config }}, {{ self.**class**.**mro**[1].**subclasses**() }}, or more dangerous payloads that trigger execution of arbitrary Python code.

The vulnerability can be reproduced by submitting crafted input to all the template fields handled by ckeditor, that are passed directly to a Jinja2 template. If the input is rendered without sufficient sanitization, it results in the execution of malicious Jinja2 code on the server.

### PoC

1. Create a new project and under the summary page submit a payload such as `{{self._TemplateReference__context.cycler.__init__.__globals__.os.popen(self.__init__.__globals__.__str__()[1786:1788]).read()}}` in the input fields. In this case, it was found that the 'Description' , 'Solution' and all other fields handled by ckeditor are found to be vulnerable.
2. Under the Reports page, generate a new report with Microsoft Word format.
3. If the application fails to properly sanitize or validate the input, the Jinja2 engine will execute the code, potentially allowing the attacker to execute system code.

### Impact

This vulnerability is a server-side template injection (SSTI), which can lead to:

1. Remote code execution (RCE): If an attacker can execute arbitrary Python code, they could compromise the server and gain control over it.
2. Data leakage: Sensitive information could be exposed by executing malicious code within the template.

Reported By - [Hrishikesh Kotwalkar](https://www.linkedin.com/in/hrishikesh-k-481595126)

### Severity

High

7.8

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Local

Attack complexity
Low

Privileges required
Low

User interaction
None

Scope
Unchanged

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H

### CVE ID

CVE-2024-56363

### Weaknesses

[CWE-97](/advisories?query=cwe%3A97)

### Credits

* [![@hrishikeshkotwalkar](https://avatars.githubusercontent.com/u/48652347?s=40&v=4)](/hrishikeshkotwalkar)
  [hrishikeshkotwalkar](/hrishikeshkotwalkar)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


