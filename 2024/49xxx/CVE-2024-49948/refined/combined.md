=== Content from git.kernel.org_9c45a717_20250114_211416.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=27a8fabc54d2f960d47bdfbebf2bdc6e8a92a4c4)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=27a8fabc54d2f960d47bdfbebf2bdc6e8a92a4c4)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=27a8fabc54d2f960d47bdfbebf2bdc6e8a92a4c4)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=27a8fabc54d2f960d47bdfbebf2bdc6e8a92a4c4)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Dumazet <edumazet@google.com> | 2024-09-24 15:02:57 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:21:32 +0200 |
| commit | [27a8fabc54d2f960d47bdfbebf2bdc6e8a92a4c4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=27a8fabc54d2f960d47bdfbebf2bdc6e8a92a4c4) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=27a8fabc54d2f960d47bdfbebf2bdc6e8a92a4c4)) | |
| tree | [df44badedf6fa99dadd7c5aaf8f7bd061fd2a331](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=27a8fabc54d2f960d47bdfbebf2bdc6e8a92a4c4) | |
| parent | [d6114993e0a89fde84a60a60a8329a571580b174](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d6114993e0a89fde84a60a60a8329a571580b174) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=27a8fabc54d2f960d47bdfbebf2bdc6e8a92a4c4&id2=d6114993e0a89fde84a60a60a8329a571580b174)) | |
| download | [linux-27a8fabc54d2f960d47bdfbebf2bdc6e8a92a4c4.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-27a8fabc54d2f960d47bdfbebf2bdc6e8a92a4c4.tar.gz) | |

net: add more sanity checks to qdisc\_pkt\_len\_init()[ Upstream commit ab9a9a9e9647392a19e7a885b08000e89c86b535 ]
One path takes care of SKB\_GSO\_DODGY, assuming
skb->len is bigger than hdr\_len.
virtio\_net\_hdr\_to\_skb() does not fully dissect TCP headers,
it only make sure it is at least 20 bytes.
It is possible for an user to provide a malicious 'GSO' packet,
total length of 80 bytes.
- 20 bytes of IPv4 header
- 60 bytes TCP header
- a small gso\_size like 8
virtio\_net\_hdr\_to\_skb() would declare this packet as a normal
GSO packet, because it would see 40 bytes of payload,
bigger than gso\_size.
We need to make detect this case to not underflow
qdisc\_skb\_cb(skb)->pkt\_len.
Fixes: 1def9238d4aa ("net\_sched: more precise pkt\_len computation")
Signed-off-by: Eric Dumazet <edumazet@google.com>
Reviewed-by: Willem de Bruijn <willemb@google.com>
Reviewed-by: David Ahern <dsahern@kernel.org>
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=27a8fabc54d2f960d47bdfbebf2bdc6e8a92a4c4)

| -rw-r--r-- | [net/core/dev.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/core/dev.c?id=27a8fabc54d2f960d47bdfbebf2bdc6e8a92a4c4) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 3 deletions

| diff --git a/net/core/dev.c b/net/core/dev.cindex d14b9484e2bc19..9a6c1603ef77e8 100644--- a/[net/core/dev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/core/dev.c?id=d6114993e0a89fde84a60a60a8329a571580b174)+++ b/[net/core/dev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/core/dev.c?id=27a8fabc54d2f960d47bdfbebf2bdc6e8a92a4c4)@@ -3805,10 +3805,14 @@ static void qdisc\_pkt\_len\_init(struct sk\_buff \*skb) hdr\_len += sizeof(struct udphdr); } - if (shinfo->gso\_type & SKB\_GSO\_DODGY)- gso\_segs = DIV\_ROUND\_UP(skb->len - hdr\_len,- shinfo->gso\_size);+ if (unlikely(shinfo->gso\_type & SKB\_GSO\_DODGY)) {+ int payload = skb->len - hdr\_len; + /\* Malicious packet. \*/+ if (payload <= 0)+ return;+ gso\_segs = DIV\_ROUND\_UP(payload, shinfo->gso\_size);+ } qdisc\_skb\_cb(skb)->pkt\_len += (gso\_segs - 1) \* hdr\_len; } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:12:53 +0000



=== Content from git.kernel.org_1ae208ed_20250114_211415.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2415f465730e48b6e38da1c7c097317bf5dd2d20)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2415f465730e48b6e38da1c7c097317bf5dd2d20)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2415f465730e48b6e38da1c7c097317bf5dd2d20)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2415f465730e48b6e38da1c7c097317bf5dd2d20)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Dumazet <edumazet@google.com> | 2024-09-24 15:02:57 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:11:21 +0200 |
| commit | [2415f465730e48b6e38da1c7c097317bf5dd2d20](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2415f465730e48b6e38da1c7c097317bf5dd2d20) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2415f465730e48b6e38da1c7c097317bf5dd2d20)) | |
| tree | [871bf254f3d7ef393c711642032b2f4f121500a2](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2415f465730e48b6e38da1c7c097317bf5dd2d20) | |
| parent | [939c88cbdc668dadd8cfa7a35d9066331239041c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=939c88cbdc668dadd8cfa7a35d9066331239041c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2415f465730e48b6e38da1c7c097317bf5dd2d20&id2=939c88cbdc668dadd8cfa7a35d9066331239041c)) | |
| download | [linux-2415f465730e48b6e38da1c7c097317bf5dd2d20.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2415f465730e48b6e38da1c7c097317bf5dd2d20.tar.gz) | |

net: add more sanity checks to qdisc\_pkt\_len\_init()[ Upstream commit ab9a9a9e9647392a19e7a885b08000e89c86b535 ]
One path takes care of SKB\_GSO\_DODGY, assuming
skb->len is bigger than hdr\_len.
virtio\_net\_hdr\_to\_skb() does not fully dissect TCP headers,
it only make sure it is at least 20 bytes.
It is possible for an user to provide a malicious 'GSO' packet,
total length of 80 bytes.
- 20 bytes of IPv4 header
- 60 bytes TCP header
- a small gso\_size like 8
virtio\_net\_hdr\_to\_skb() would declare this packet as a normal
GSO packet, because it would see 40 bytes of payload,
bigger than gso\_size.
We need to make detect this case to not underflow
qdisc\_skb\_cb(skb)->pkt\_len.
Fixes: 1def9238d4aa ("net\_sched: more precise pkt\_len computation")
Signed-off-by: Eric Dumazet <edumazet@google.com>
Reviewed-by: Willem de Bruijn <willemb@google.com>
Reviewed-by: David Ahern <dsahern@kernel.org>
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2415f465730e48b6e38da1c7c097317bf5dd2d20)

| -rw-r--r-- | [net/core/dev.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/core/dev.c?id=2415f465730e48b6e38da1c7c097317bf5dd2d20) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 3 deletions

| diff --git a/net/core/dev.c b/net/core/dev.cindex 96e093e2206f48..8a22ce15b7f53f 100644--- a/[net/core/dev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/core/dev.c?id=939c88cbdc668dadd8cfa7a35d9066331239041c)+++ b/[net/core/dev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/core/dev.c?id=2415f465730e48b6e38da1c7c097317bf5dd2d20)@@ -3795,10 +3795,14 @@ static void qdisc\_pkt\_len\_init(struct sk\_buff \*skb) hdr\_len += sizeof(struct udphdr); } - if (shinfo->gso\_type & SKB\_GSO\_DODGY)- gso\_segs = DIV\_ROUND\_UP(skb->len - hdr\_len,- shinfo->gso\_size);+ if (unlikely(shinfo->gso\_type & SKB\_GSO\_DODGY)) {+ int payload = skb->len - hdr\_len; + /\* Malicious packet. \*/+ if (payload <= 0)+ return;+ gso\_segs = DIV\_ROUND\_UP(payload, shinfo->gso\_size);+ } qdisc\_skb\_cb(skb)->pkt\_len += (gso\_segs - 1) \* hdr\_len; } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:12:52 +0000



=== Content from git.kernel.org_8cf31b7b_20250114_211417.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=473426a1d53a68dd1e718e6cd00d57936993fa6c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=473426a1d53a68dd1e718e6cd00d57936993fa6c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=473426a1d53a68dd1e718e6cd00d57936993fa6c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=473426a1d53a68dd1e718e6cd00d57936993fa6c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Dumazet <edumazet@google.com> | 2024-09-24 15:02:57 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:20:36 +0100 |
| commit | [473426a1d53a68dd1e718e6cd00d57936993fa6c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=473426a1d53a68dd1e718e6cd00d57936993fa6c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=473426a1d53a68dd1e718e6cd00d57936993fa6c)) | |
| tree | [de2be4aa5b4e87d7d63bc2fa669e352757689262](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=473426a1d53a68dd1e718e6cd00d57936993fa6c) | |
| parent | [1598d70ad9c7d0a4d9d54b82094e9f45908fda6d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1598d70ad9c7d0a4d9d54b82094e9f45908fda6d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=473426a1d53a68dd1e718e6cd00d57936993fa6c&id2=1598d70ad9c7d0a4d9d54b82094e9f45908fda6d)) | |
| download | [linux-473426a1d53a68dd1e718e6cd00d57936993fa6c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-473426a1d53a68dd1e718e6cd00d57936993fa6c.tar.gz) | |

net: add more sanity checks to qdisc\_pkt\_len\_init()[ Upstream commit ab9a9a9e9647392a19e7a885b08000e89c86b535 ]
One path takes care of SKB\_GSO\_DODGY, assuming
skb->len is bigger than hdr\_len.
virtio\_net\_hdr\_to\_skb() does not fully dissect TCP headers,
it only make sure it is at least 20 bytes.
It is possible for an user to provide a malicious 'GSO' packet,
total length of 80 bytes.
- 20 bytes of IPv4 header
- 60 bytes TCP header
- a small gso\_size like 8
virtio\_net\_hdr\_to\_skb() would declare this packet as a normal
GSO packet, because it would see 40 bytes of payload,
bigger than gso\_size.
We need to make detect this case to not underflow
qdisc\_skb\_cb(skb)->pkt\_len.
Fixes: 1def9238d4aa ("net\_sched: more precise pkt\_len computation")
Signed-off-by: Eric Dumazet <edumazet@google.com>
Reviewed-by: Willem de Bruijn <willemb@google.com>
Reviewed-by: David Ahern <dsahern@kernel.org>
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=473426a1d53a68dd1e718e6cd00d57936993fa6c)

| -rw-r--r-- | [net/core/dev.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/core/dev.c?id=473426a1d53a68dd1e718e6cd00d57936993fa6c) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 3 deletions

| diff --git a/net/core/dev.c b/net/core/dev.cindex 5e75359acd0c57..8f2f14df3610bc 100644--- a/[net/core/dev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/core/dev.c?id=1598d70ad9c7d0a4d9d54b82094e9f45908fda6d)+++ b/[net/core/dev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/core/dev.c?id=473426a1d53a68dd1e718e6cd00d57936993fa6c)@@ -3383,10 +3383,14 @@ static void qdisc\_pkt\_len\_init(struct sk\_buff \*skb) hdr\_len += sizeof(struct udphdr); } - if (shinfo->gso\_type & SKB\_GSO\_DODGY)- gso\_segs = DIV\_ROUND\_UP(skb->len - hdr\_len,- shinfo->gso\_size);+ if (unlikely(shinfo->gso\_type & SKB\_GSO\_DODGY)) {+ int payload = skb->len - hdr\_len; + /\* Malicious packet. \*/+ if (payload <= 0)+ return;+ gso\_segs = DIV\_ROUND\_UP(payload, shinfo->gso\_size);+ } qdisc\_skb\_cb(skb)->pkt\_len += (gso\_segs - 1) \* hdr\_len; } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:12:54 +0000



=== Content from git.kernel.org_0fe4fe95_20250114_211419.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9b0ee571d20a238a22722126abdfde61f1b2bdd0)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9b0ee571d20a238a22722126abdfde61f1b2bdd0)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9b0ee571d20a238a22722126abdfde61f1b2bdd0)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9b0ee571d20a238a22722126abdfde61f1b2bdd0)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Dumazet <edumazet@google.com> | 2024-09-24 15:02:57 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-10 11:57:17 +0200 |
| commit | [9b0ee571d20a238a22722126abdfde61f1b2bdd0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9b0ee571d20a238a22722126abdfde61f1b2bdd0) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9b0ee571d20a238a22722126abdfde61f1b2bdd0)) | |
| tree | [a688f257911f18c3fd80d86e5037146bb58ab175](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9b0ee571d20a238a22722126abdfde61f1b2bdd0) | |
| parent | [25ab0b87dbd89cecef8a9c60a02bb97832e471d1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=25ab0b87dbd89cecef8a9c60a02bb97832e471d1) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9b0ee571d20a238a22722126abdfde61f1b2bdd0&id2=25ab0b87dbd89cecef8a9c60a02bb97832e471d1)) | |
| download | [linux-9b0ee571d20a238a22722126abdfde61f1b2bdd0.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9b0ee571d20a238a22722126abdfde61f1b2bdd0.tar.gz) | |

net: add more sanity checks to qdisc\_pkt\_len\_init()[ Upstream commit ab9a9a9e9647392a19e7a885b08000e89c86b535 ]
One path takes care of SKB\_GSO\_DODGY, assuming
skb->len is bigger than hdr\_len.
virtio\_net\_hdr\_to\_skb() does not fully dissect TCP headers,
it only make sure it is at least 20 bytes.
It is possible for an user to provide a malicious 'GSO' packet,
total length of 80 bytes.
- 20 bytes of IPv4 header
- 60 bytes TCP header
- a small gso\_size like 8
virtio\_net\_hdr\_to\_skb() would declare this packet as a normal
GSO packet, because it would see 40 bytes of payload,
bigger than gso\_size.
We need to make detect this case to not underflow
qdisc\_skb\_cb(skb)->pkt\_len.
Fixes: 1def9238d4aa ("net\_sched: more precise pkt\_len computation")
Signed-off-by: Eric Dumazet <edumazet@google.com>
Reviewed-by: Willem de Bruijn <willemb@google.com>
Reviewed-by: David Ahern <dsahern@kernel.org>
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9b0ee571d20a238a22722126abdfde61f1b2bdd0)

| -rw-r--r-- | [net/core/dev.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/core/dev.c?id=9b0ee571d20a238a22722126abdfde61f1b2bdd0) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 3 deletions

| diff --git a/net/core/dev.c b/net/core/dev.cindex 877ebaff955860..70f757707f1a2f 100644--- a/[net/core/dev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/core/dev.c?id=25ab0b87dbd89cecef8a9c60a02bb97832e471d1)+++ b/[net/core/dev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/core/dev.c?id=9b0ee571d20a238a22722126abdfde61f1b2bdd0)@@ -3754,10 +3754,14 @@ static void qdisc\_pkt\_len\_init(struct sk\_buff \*skb) hdr\_len += sizeof(struct udphdr); } - if (shinfo->gso\_type & SKB\_GSO\_DODGY)- gso\_segs = DIV\_ROUND\_UP(skb->len - hdr\_len,- shinfo->gso\_size);+ if (unlikely(shinfo->gso\_type & SKB\_GSO\_DODGY)) {+ int payload = skb->len - hdr\_len; + /\* Malicious packet. \*/+ if (payload <= 0)+ return;+ gso\_segs = DIV\_ROUND\_UP(payload, shinfo->gso\_size);+ } qdisc\_skb\_cb(skb)->pkt\_len += (gso\_segs - 1) \* hdr\_len; } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:12:56 +0000



=== Content from git.kernel.org_3e3cba36_20250114_211420.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ab9a9a9e9647392a19e7a885b08000e89c86b535)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ab9a9a9e9647392a19e7a885b08000e89c86b535)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ab9a9a9e9647392a19e7a885b08000e89c86b535)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ab9a9a9e9647392a19e7a885b08000e89c86b535)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Dumazet <edumazet@google.com> | 2024-09-24 15:02:57 +0000 |
| --- | --- | --- |
| committer | Paolo Abeni <pabeni@redhat.com> | 2024-10-01 11:47:05 +0200 |
| commit | [ab9a9a9e9647392a19e7a885b08000e89c86b535](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ab9a9a9e9647392a19e7a885b08000e89c86b535) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ab9a9a9e9647392a19e7a885b08000e89c86b535)) | |
| tree | [a1459d6153629dc225628a0994b929b7251e227a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ab9a9a9e9647392a19e7a885b08000e89c86b535) | |
| parent | [c20029db28399ecc50e556964eaba75c43b1e2f1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c20029db28399ecc50e556964eaba75c43b1e2f1) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ab9a9a9e9647392a19e7a885b08000e89c86b535&id2=c20029db28399ecc50e556964eaba75c43b1e2f1)) | |
| download | [linux-ab9a9a9e9647392a19e7a885b08000e89c86b535.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ab9a9a9e9647392a19e7a885b08000e89c86b535.tar.gz) | |

net: add more sanity checks to qdisc\_pkt\_len\_init()One path takes care of SKB\_GSO\_DODGY, assuming
skb->len is bigger than hdr\_len.
virtio\_net\_hdr\_to\_skb() does not fully dissect TCP headers,
it only make sure it is at least 20 bytes.
It is possible for an user to provide a malicious 'GSO' packet,
total length of 80 bytes.
- 20 bytes of IPv4 header
- 60 bytes TCP header
- a small gso\_size like 8
virtio\_net\_hdr\_to\_skb() would declare this packet as a normal
GSO packet, because it would see 40 bytes of payload,
bigger than gso\_size.
We need to make detect this case to not underflow
qdisc\_skb\_cb(skb)->pkt\_len.
Fixes: 1def9238d4aa ("net\_sched: more precise pkt\_len computation")
Signed-off-by: Eric Dumazet <edumazet@google.com>
Reviewed-by: Willem de Bruijn <willemb@google.com>
Reviewed-by: David Ahern <dsahern@kernel.org>
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ab9a9a9e9647392a19e7a885b08000e89c86b535)

| -rw-r--r-- | [net/core/dev.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/core/dev.c?id=ab9a9a9e9647392a19e7a885b08000e89c86b535) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 3 deletions

| diff --git a/net/core/dev.c b/net/core/dev.cindex 7d3d34a3bdf568..ea5fbcd133ae4c 100644--- a/[net/core/dev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/core/dev.c?id=c20029db28399ecc50e556964eaba75c43b1e2f1)+++ b/[net/core/dev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/core/dev.c?id=ab9a9a9e9647392a19e7a885b08000e89c86b535)@@ -3766,10 +3766,14 @@ static void qdisc\_pkt\_len\_init(struct sk\_buff \*skb) hdr\_len += sizeof(struct udphdr); } - if (shinfo->gso\_type & SKB\_GSO\_DODGY)- gso\_segs = DIV\_ROUND\_UP(skb->len - hdr\_len,- shinfo->gso\_size);+ if (unlikely(shinfo->gso\_type & SKB\_GSO\_DODGY)) {+ int payload = skb->len - hdr\_len; + /\* Malicious packet. \*/+ if (payload <= 0)+ return;+ gso\_segs = DIV\_ROUND\_UP(payload, shinfo->gso\_size);+ } qdisc\_skb\_cb(skb)->pkt\_len += (gso\_segs - 1) \* hdr\_len; } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:12:57 +0000



=== Content from git.kernel.org_060e8cd2_20250114_211422.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ff1c3cadcf405ab37dd91418a62a7acecf3bc5e2)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ff1c3cadcf405ab37dd91418a62a7acecf3bc5e2)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ff1c3cadcf405ab37dd91418a62a7acecf3bc5e2)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ff1c3cadcf405ab37dd91418a62a7acecf3bc5e2)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Dumazet <edumazet@google.com> | 2024-09-24 15:02:57 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-10 12:00:08 +0200 |
| commit | [ff1c3cadcf405ab37dd91418a62a7acecf3bc5e2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ff1c3cadcf405ab37dd91418a62a7acecf3bc5e2) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ff1c3cadcf405ab37dd91418a62a7acecf3bc5e2)) | |
| tree | [154ca5eda32e7b3567af8a9f0b13eb6ffffff955](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ff1c3cadcf405ab37dd91418a62a7acecf3bc5e2) | |
| parent | [f959cce8a2a04ce776aa8b78e83ce339e0d7fbac](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f959cce8a2a04ce776aa8b78e83ce339e0d7fbac) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ff1c3cadcf405ab37dd91418a62a7acecf3bc5e2&id2=f959cce8a2a04ce776aa8b78e83ce339e0d7fbac)) | |
| download | [linux-ff1c3cadcf405ab37dd91418a62a7acecf3bc5e2.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ff1c3cadcf405ab37dd91418a62a7acecf3bc5e2.tar.gz) | |

net: add more sanity checks to qdisc\_pkt\_len\_init()[ Upstream commit ab9a9a9e9647392a19e7a885b08000e89c86b535 ]
One path takes care of SKB\_GSO\_DODGY, assuming
skb->len is bigger than hdr\_len.
virtio\_net\_hdr\_to\_skb() does not fully dissect TCP headers,
it only make sure it is at least 20 bytes.
It is possible for an user to provide a malicious 'GSO' packet,
total length of 80 bytes.
- 20 bytes of IPv4 header
- 60 bytes TCP header
- a small gso\_size like 8
virtio\_net\_hdr\_to\_skb() would declare this packet as a normal
GSO packet, because it would see 40 bytes of payload,
bigger than gso\_size.
We need to make detect this case to not underflow
qdisc\_skb\_cb(skb)->pkt\_len.
Fixes: 1def9238d4aa ("net\_sched: more precise pkt\_len computation")
Signed-off-by: Eric Dumazet <edumazet@google.com>
Reviewed-by: Willem de Bruijn <willemb@google.com>
Reviewed-by: David Ahern <dsahern@kernel.org>
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ff1c3cadcf405ab37dd91418a62a7acecf3bc5e2)

| -rw-r--r-- | [net/core/dev.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/core/dev.c?id=ff1c3cadcf405ab37dd91418a62a7acecf3bc5e2) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 3 deletions

| diff --git a/net/core/dev.c b/net/core/dev.cindex 62ec4bf8bcd881..d716a046eaf971 100644--- a/[net/core/dev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/core/dev.c?id=f959cce8a2a04ce776aa8b78e83ce339e0d7fbac)+++ b/[net/core/dev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/core/dev.c?id=ff1c3cadcf405ab37dd91418a62a7acecf3bc5e2)@@ -3756,10 +3756,14 @@ static void qdisc\_pkt\_len\_init(struct sk\_buff \*skb) hdr\_len += sizeof(struct udphdr); } - if (shinfo->gso\_type & SKB\_GSO\_DODGY)- gso\_segs = DIV\_ROUND\_UP(skb->len - hdr\_len,- shinfo->gso\_size);+ if (unlikely(shinfo->gso\_type & SKB\_GSO\_DODGY)) {+ int payload = skb->len - hdr\_len; + /\* Malicious packet. \*/+ if (payload <= 0)+ return;+ gso\_segs = DIV\_ROUND\_UP(payload, shinfo->gso\_size);+ } qdisc\_skb\_cb(skb)->pkt\_len += (gso\_segs - 1) \* hdr\_len; } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:12:59 +0000



=== Content from git.kernel.org_2dcaaae3_20250114_211421.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d7d1a28f5dd57b4d83def876f8d7b4403bd37df9)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d7d1a28f5dd57b4d83def876f8d7b4403bd37df9)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d7d1a28f5dd57b4d83def876f8d7b4403bd37df9)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d7d1a28f5dd57b4d83def876f8d7b4403bd37df9)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Dumazet <edumazet@google.com> | 2024-09-24 15:02:57 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:19:10 +0100 |
| commit | [d7d1a28f5dd57b4d83def876f8d7b4403bd37df9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d7d1a28f5dd57b4d83def876f8d7b4403bd37df9) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d7d1a28f5dd57b4d83def876f8d7b4403bd37df9)) | |
| tree | [1df4068f304d58c72a4744c8416948919aa76224](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d7d1a28f5dd57b4d83def876f8d7b4403bd37df9) | |
| parent | [d70ca7598943572d5e384227bd268acb5109bf72](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d70ca7598943572d5e384227bd268acb5109bf72) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d7d1a28f5dd57b4d83def876f8d7b4403bd37df9&id2=d70ca7598943572d5e384227bd268acb5109bf72)) | |
| download | [linux-d7d1a28f5dd57b4d83def876f8d7b4403bd37df9.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d7d1a28f5dd57b4d83def876f8d7b4403bd37df9.tar.gz) | |

net: add more sanity checks to qdisc\_pkt\_len\_init()[ Upstream commit ab9a9a9e9647392a19e7a885b08000e89c86b535 ]
One path takes care of SKB\_GSO\_DODGY, assuming
skb->len is bigger than hdr\_len.
virtio\_net\_hdr\_to\_skb() does not fully dissect TCP headers,
it only make sure it is at least 20 bytes.
It is possible for an user to provide a malicious 'GSO' packet,
total length of 80 bytes.
- 20 bytes of IPv4 header
- 60 bytes TCP header
- a small gso\_size like 8
virtio\_net\_hdr\_to\_skb() would declare this packet as a normal
GSO packet, because it would see 40 bytes of payload,
bigger than gso\_size.
We need to make detect this case to not underflow
qdisc\_skb\_cb(skb)->pkt\_len.
Fixes: 1def9238d4aa ("net\_sched: more precise pkt\_len computation")
Signed-off-by: Eric Dumazet <edumazet@google.com>
Reviewed-by: Willem de Bruijn <willemb@google.com>
Reviewed-by: David Ahern <dsahern@kernel.org>
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d7d1a28f5dd57b4d83def876f8d7b4403bd37df9)

| -rw-r--r-- | [net/core/dev.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/core/dev.c?id=d7d1a28f5dd57b4d83def876f8d7b4403bd37df9) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 3 deletions

| diff --git a/net/core/dev.c b/net/core/dev.cindex 916a095eaee274..0409c051ed5d4e 100644--- a/[net/core/dev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/core/dev.c?id=d70ca7598943572d5e384227bd268acb5109bf72)+++ b/[net/core/dev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/core/dev.c?id=d7d1a28f5dd57b4d83def876f8d7b4403bd37df9)@@ -3443,10 +3443,14 @@ static void qdisc\_pkt\_len\_init(struct sk\_buff \*skb) hdr\_len += sizeof(struct udphdr); } - if (shinfo->gso\_type & SKB\_GSO\_DODGY)- gso\_segs = DIV\_ROUND\_UP(skb->len - hdr\_len,- shinfo->gso\_size);+ if (unlikely(shinfo->gso\_type & SKB\_GSO\_DODGY)) {+ int payload = skb->len - hdr\_len; + /\* Malicious packet. \*/+ if (payload <= 0)+ return;+ gso\_segs = DIV\_ROUND\_UP(payload, shinfo->gso\_size);+ } qdisc\_skb\_cb(skb)->pkt\_len += (gso\_segs - 1) \* hdr\_len; } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:12:58 +0000



=== Content from git.kernel.org_fc49d7f0_20250114_211414.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1eebe602a8d8264a12e35e39d0645fa88dbbacdd)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1eebe602a8d8264a12e35e39d0645fa88dbbacdd)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1eebe602a8d8264a12e35e39d0645fa88dbbacdd)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1eebe602a8d8264a12e35e39d0645fa88dbbacdd)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Dumazet <edumazet@google.com> | 2024-09-24 15:02:57 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-10 12:03:00 +0200 |
| commit | [1eebe602a8d8264a12e35e39d0645fa88dbbacdd](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1eebe602a8d8264a12e35e39d0645fa88dbbacdd) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1eebe602a8d8264a12e35e39d0645fa88dbbacdd)) | |
| tree | [b2964fba3ccaf4cea99f9ba4b3433f5d7824b2ec](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1eebe602a8d8264a12e35e39d0645fa88dbbacdd) | |
| parent | [81fd007dcd47c34471766249853e4d4bce8eea4b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=81fd007dcd47c34471766249853e4d4bce8eea4b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1eebe602a8d8264a12e35e39d0645fa88dbbacdd&id2=81fd007dcd47c34471766249853e4d4bce8eea4b)) | |
| download | [linux-1eebe602a8d8264a12e35e39d0645fa88dbbacdd.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1eebe602a8d8264a12e35e39d0645fa88dbbacdd.tar.gz) | |

net: add more sanity checks to qdisc\_pkt\_len\_init()[ Upstream commit ab9a9a9e9647392a19e7a885b08000e89c86b535 ]
One path takes care of SKB\_GSO\_DODGY, assuming
skb->len is bigger than hdr\_len.
virtio\_net\_hdr\_to\_skb() does not fully dissect TCP headers,
it only make sure it is at least 20 bytes.
It is possible for an user to provide a malicious 'GSO' packet,
total length of 80 bytes.
- 20 bytes of IPv4 header
- 60 bytes TCP header
- a small gso\_size like 8
virtio\_net\_hdr\_to\_skb() would declare this packet as a normal
GSO packet, because it would see 40 bytes of payload,
bigger than gso\_size.
We need to make detect this case to not underflow
qdisc\_skb\_cb(skb)->pkt\_len.
Fixes: 1def9238d4aa ("net\_sched: more precise pkt\_len computation")
Signed-off-by: Eric Dumazet <edumazet@google.com>
Reviewed-by: Willem de Bruijn <willemb@google.com>
Reviewed-by: David Ahern <dsahern@kernel.org>
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1eebe602a8d8264a12e35e39d0645fa88dbbacdd)

| -rw-r--r-- | [net/core/dev.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/core/dev.c?id=1eebe602a8d8264a12e35e39d0645fa88dbbacdd) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 3 deletions

| diff --git a/net/core/dev.c b/net/core/dev.cindex 7f2355574cecac..dd87f5fb2f3a7d 100644--- a/[net/core/dev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/core/dev.c?id=81fd007dcd47c34471766249853e4d4bce8eea4b)+++ b/[net/core/dev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/core/dev.c?id=1eebe602a8d8264a12e35e39d0645fa88dbbacdd)@@ -3758,10 +3758,14 @@ static void qdisc\_pkt\_len\_init(struct sk\_buff \*skb) hdr\_len += sizeof(struct udphdr); } - if (shinfo->gso\_type & SKB\_GSO\_DODGY)- gso\_segs = DIV\_ROUND\_UP(skb->len - hdr\_len,- shinfo->gso\_size);+ if (unlikely(shinfo->gso\_type & SKB\_GSO\_DODGY)) {+ int payload = skb->len - hdr\_len; + /\* Malicious packet. \*/+ if (payload <= 0)+ return;+ gso\_segs = DIV\_ROUND\_UP(payload, shinfo->gso\_size);+ } qdisc\_skb\_cb(skb)->pkt\_len += (gso\_segs - 1) \* hdr\_len; } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:12:51 +0000



=== Content from git.kernel.org_277ceb39_20250114_211418.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=566a931a1436d0e0ad13708ea55479b95426213c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=566a931a1436d0e0ad13708ea55479b95426213c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=566a931a1436d0e0ad13708ea55479b95426213c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=566a931a1436d0e0ad13708ea55479b95426213c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Dumazet <edumazet@google.com> | 2024-09-24 15:02:57 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:08:07 +0200 |
| commit | [566a931a1436d0e0ad13708ea55479b95426213c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=566a931a1436d0e0ad13708ea55479b95426213c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=566a931a1436d0e0ad13708ea55479b95426213c)) | |
| tree | [159433327b661a44fe641ecb763eeb622d4742cc](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=566a931a1436d0e0ad13708ea55479b95426213c) | |
| parent | [ba26060a29d3ca1bfc737aa79f7125128f35147c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ba26060a29d3ca1bfc737aa79f7125128f35147c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=566a931a1436d0e0ad13708ea55479b95426213c&id2=ba26060a29d3ca1bfc737aa79f7125128f35147c)) | |
| download | [linux-566a931a1436d0e0ad13708ea55479b95426213c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-566a931a1436d0e0ad13708ea55479b95426213c.tar.gz) | |

net: add more sanity checks to qdisc\_pkt\_len\_init()[ Upstream commit ab9a9a9e9647392a19e7a885b08000e89c86b535 ]
One path takes care of SKB\_GSO\_DODGY, assuming
skb->len is bigger than hdr\_len.
virtio\_net\_hdr\_to\_skb() does not fully dissect TCP headers,
it only make sure it is at least 20 bytes.
It is possible for an user to provide a malicious 'GSO' packet,
total length of 80 bytes.
- 20 bytes of IPv4 header
- 60 bytes TCP header
- a small gso\_size like 8
virtio\_net\_hdr\_to\_skb() would declare this packet as a normal
GSO packet, because it would see 40 bytes of payload,
bigger than gso\_size.
We need to make detect this case to not underflow
qdisc\_skb\_cb(skb)->pkt\_len.
Fixes: 1def9238d4aa ("net\_sched: more precise pkt\_len computation")
Signed-off-by: Eric Dumazet <edumazet@google.com>
Reviewed-by: Willem de Bruijn <willemb@google.com>
Reviewed-by: David Ahern <dsahern@kernel.org>
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=566a931a1436d0e0ad13708ea55479b95426213c)

| -rw-r--r-- | [net/core/dev.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/core/dev.c?id=566a931a1436d0e0ad13708ea55479b95426213c) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 3 deletions

| diff --git a/net/core/dev.c b/net/core/dev.cindex 0da9ca0a423052..5edab9328d5e05 100644--- a/[net/core/dev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/core/dev.c?id=ba26060a29d3ca1bfc737aa79f7125128f35147c)+++ b/[net/core/dev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/core/dev.c?id=566a931a1436d0e0ad13708ea55479b95426213c)@@ -3767,10 +3767,14 @@ static void qdisc\_pkt\_len\_init(struct sk\_buff \*skb) hdr\_len += sizeof(struct udphdr); } - if (shinfo->gso\_type & SKB\_GSO\_DODGY)- gso\_segs = DIV\_ROUND\_UP(skb->len - hdr\_len,- shinfo->gso\_size);+ if (unlikely(shinfo->gso\_type & SKB\_GSO\_DODGY)) {+ int payload = skb->len - hdr\_len; + /\* Malicious packet. \*/+ if (payload <= 0)+ return;+ gso\_segs = DIV\_ROUND\_UP(payload, shinfo->gso\_size);+ } qdisc\_skb\_cb(skb)->pkt\_len += (gso\_segs - 1) \* hdr\_len; } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:12:55 +0000


