=== Content from github.com_74eda3cf_20250115_095848.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FIcinga%2Ficinga2%2Fsecurity%2Fadvisories%2FGHSA-j7wq-r9mg-9wpv)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FIcinga%2Ficinga2%2Fsecurity%2Fadvisories%2FGHSA-j7wq-r9mg-9wpv)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=Icinga%2Ficinga2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Icinga](/Icinga)
/
**[icinga2](/Icinga/icinga2)**
Public

* [Notifications](/login?return_to=%2FIcinga%2Ficinga2) You must be signed in to change notification settings
* [Fork
  579](/login?return_to=%2FIcinga%2Ficinga2)
* [Star
   2k](/login?return_to=%2FIcinga%2Ficinga2)

* [Code](/Icinga/icinga2)
* [Issues
  321](/Icinga/icinga2/issues)
* [Pull requests
  155](/Icinga/icinga2/pulls)
* [Actions](/Icinga/icinga2/actions)
* [Projects
  1](/Icinga/icinga2/projects)
* [Security](/Icinga/icinga2/security)
* [Insights](/Icinga/icinga2/pulse)

Additional navigation options

* [Code](/Icinga/icinga2)
* [Issues](/Icinga/icinga2/issues)
* [Pull requests](/Icinga/icinga2/pulls)
* [Actions](/Icinga/icinga2/actions)
* [Projects](/Icinga/icinga2/projects)
* [Security](/Icinga/icinga2/security)
* [Insights](/Icinga/icinga2/pulse)

# TLS Certificate Validation Bypass for JSON-RPC and HTTP API Connections

Critical

[julianbrost](/julianbrost)
published
GHSA-j7wq-r9mg-9wpv
Nov 12, 2024

## Package

No package listed

## Affected versions

>= 2.4.0, <= 2.14.2

## Patched versions

v2.14.3, v2.13.10, v2.12.11, v2.11.12

## Description

### Impact

The TLS certificate validation in all Icinga 2 versions starting from 2.4.0 was flawed, allowing an attacker to impersonate both trusted cluster nodes as well as any API users that use TLS client certificates for authentication (`ApiUser` objects with the `client_cn` attribute set).

By impersonating a trusted cluster node like a master or satellite, an attacker can supply a malicious configuration update to other nodes (if the `accept_config` attribute of the `ApiListener` object is set to true) or instruct the other node to execute malicious commands directly (if `the accept_commands` attribute of the `ApiListener` object is set to true). These attributes are expected to be set in most distributed installations, but in case they are not, an attacker can still retrieve potentially sensitive information.

When impersonating API users, the impact depends on the permissions configured for the individual users using certificate authentication. This may include permissions like updating the configuration and executing commands as well.

We expect most installations to be affected by this vulnerability and recommend upgrading as soon as possible.

### Patches

The following fixed versions were released:

* v2.14.3
* v2.13.10
* v2.12.11
* v2.11.12

The source code for the new versions can be found in our [Git repository](https://github.com/Icinga/icinga2/releases). Updated binary packages are available on [packages.icinga.com](https://packages.icinga.com/) and the Icinga for Windows repository. Updated container images are available on [Docker Hub](https://hub.docker.com/r/icinga/icinga2/tags). Updated Helm Charts are provided in the corresponding [repository](https://github.com/Icinga/helm-charts/tree/main/charts/icinga-stack).

Given the severity of the issue, users are advised to upgrade immediately.

### Workarounds

There is no known way to work around this in Icinga 2. Access to the Icinga 2 API port can be restricted using firewalls to reduce the impact.

### Details

In order to allow some time for patching, the full report with more details on the vulnerability including how to reproduce it will be released in two weeks on 2024-11-26.

### Acknowledgements

We would like to thank [Finn Steglich](https://github.com/fsteglich) for finding and reporting this issue.

### References

* [Announcement on icinga.com](https://icinga.com/blog/2024/11/12/critical-icinga-2-security-releases-2-14-3)
* Patch (source code): [master branch](https://github.com/Icinga/icinga2/commit/869a7d6f0fe38c748e67bacc1fbdd42c933030f6), [v2.14.3](https://github.com/Icinga/icinga2/commit/2febc5e18ae0c93d989e64ebc2a9fd90e7205ad8), [v2.13.10](https://github.com/Icinga/icinga2/commit/3504fc7ed688c10d86988e2029a65efc311393fe), [v2.12.11](https://github.com/Icinga/icinga2/commit/0419a2c36de408e9a703aec0962061ec9a285d3c), [v2.11.12](https://github.com/Icinga/icinga2/commit/8fed6608912c752b337d977f730547875a820831)

### For more information

If you have any questions or comments about this advisory, please ask in our [community forum](https://community.icinga.com/) or email us at info@icinga.com.

For reporting possible security issues, please see [the information on our website](https://icinga.com/company/contact/security-issues/).

### Severity

Critical

9.8

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H

### CVE ID

CVE-2024-49369

### Weaknesses

[CWE-295](/advisories?query=cwe%3A295)

### Credits

* [![@fsteglich](https://avatars.githubusercontent.com/u/28145282?s=40&v=4)](/fsteglich)
  [fsteglich](/fsteglich)
  Finder

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_76214ccf_20250115_095841.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FIcinga%2Ficinga2%2Fcommit%2F2febc5e18ae0c93d989e64ebc2a9fd90e7205ad8)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FIcinga%2Ficinga2%2Fcommit%2F2febc5e18ae0c93d989e64ebc2a9fd90e7205ad8)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=Icinga%2Ficinga2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Icinga](/Icinga)
/
**[icinga2](/Icinga/icinga2)**
Public

* [Notifications](/login?return_to=%2FIcinga%2Ficinga2) You must be signed in to change notification settings
* [Fork
  579](/login?return_to=%2FIcinga%2Ficinga2)
* [Star
   2k](/login?return_to=%2FIcinga%2Ficinga2)

* [Code](/Icinga/icinga2)
* [Issues
  321](/Icinga/icinga2/issues)
* [Pull requests
  155](/Icinga/icinga2/pulls)
* [Actions](/Icinga/icinga2/actions)
* [Projects
  1](/Icinga/icinga2/projects)
* [Security](/Icinga/icinga2/security)
* [Insights](/Icinga/icinga2/pulse)

Additional navigation options

* [Code](/Icinga/icinga2)
* [Issues](/Icinga/icinga2/issues)
* [Pull requests](/Icinga/icinga2/pulls)
* [Actions](/Icinga/icinga2/actions)
* [Projects](/Icinga/icinga2/projects)
* [Security](/Icinga/icinga2/security)
* [Insights](/Icinga/icinga2/pulse)

## Commit

[Permalink](/Icinga/icinga2/commit/2febc5e18ae0c93d989e64ebc2a9fd90e7205ad8)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Security: fix TLS certificate validation bypass

[Browse files](/Icinga/icinga2/tree/2febc5e18ae0c93d989e64ebc2a9fd90e7205ad8)
Browse the repository at this point in the history

```
The previous validation in set_verify_callback() could be bypassed, tricking
Icinga 2 into treating invalid certificates as valid. To fix this, the
validation checks were moved into the IsVerifyOK() function.

This is tracked as CVE-2024-49369, more details will be published at a later time.
```

* Loading branch information

[![@julianbrost](https://avatars.githubusercontent.com/u/18552?s=40&v=4)](/julianbrost) [![@Al2Klimov](https://avatars.githubusercontent.com/u/6053266?s=40&v=4)](/Al2Klimov)

[julianbrost](/Icinga/icinga2/commits?author=julianbrost "View all commits by julianbrost")
authored and
[Al2Klimov](/Icinga/icinga2/commits?author=Al2Klimov "View all commits by Al2Klimov")
committed
Oct 22, 2024

1 parent
[fc4ff8b](/Icinga/icinga2/commit/fc4ff8b7af2343311b93fcc5439687d625d3e7c2)

commit 2febc5e

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**51 additions**
and
**19 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* lib/base

  + lib/base/tlsstream.cpp
    [tlsstream.cpp](#diff-f3f4d5a51b324266bf5e97e270fc06b11c8e2c2cb0e448eea580a0735ce0b6b4)
  + lib/base/tlsstream.hpp
    [tlsstream.hpp](#diff-85e3ad61abcf25637662ca991f62423b109dfac4062fd7c63583379dc36f2b75)

## There are no files selected for viewing

62 changes: 48 additions & 14 deletions

62
[lib/base/tlsstream.cpp](#diff-f3f4d5a51b324266bf5e97e270fc06b11c8e2c2cb0e448eea580a0735ce0b6b4 "lib/base/tlsstream.cpp")

Show comments

[View file](/Icinga/icinga2/blob/2febc5e18ae0c93d989e64ebc2a9fd90e7205ad8/lib/base/tlsstream.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -18,14 +18,48 @@ |
|  |  |  |
|  |  | using namespace icinga; |
|  |  |  |
|  |  | bool UnbufferedAsioTlsStream::IsVerifyOK() const |
|  |  | /\*\* |
|  |  | \* Checks whether the TLS handshake was completed with a valid peer certificate. |
|  |  | \* |
|  |  | \* @return true if the peer presented a valid certificate, false otherwise |
|  |  | \*/ |
|  |  | bool UnbufferedAsioTlsStream::IsVerifyOK() |
|  |  | { |
|  |  | return m\_VerifyOK; |
|  |  | if (!SSL\_is\_init\_finished(native\_handle())) { |
|  |  | // handshake was not completed |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | if (GetPeerCertificate() == nullptr) { |
|  |  | // no peer certificate was sent |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | return SSL\_get\_verify\_result(native\_handle()) == X509\_V\_OK; |
|  |  | } |
|  |  |  |
|  |  | String UnbufferedAsioTlsStream::GetVerifyError() const |
|  |  | /\*\* |
|  |  | \* Returns a human-readable error string for situations where IsVerifyOK() returns false. |
|  |  | \* |
|  |  | \* If the handshake was completed and a peer certificate was provided, |
|  |  | \* the string additionally contains the OpenSSL verification error code. |
|  |  | \* |
|  |  | \* @return string containing the error message |
|  |  | \*/ |
|  |  | String UnbufferedAsioTlsStream::GetVerifyError() |
|  |  | { |
|  |  | return m\_VerifyError; |
|  |  | if (!SSL\_is\_init\_finished(native\_handle())) { |
|  |  | return "handshake not completed"; |
|  |  | } |
|  |  |  |
|  |  | if (GetPeerCertificate() == nullptr) { |
|  |  | return "no peer certificate provided"; |
|  |  | } |
|  |  |  |
|  |  | std::ostringstream buf; |
|  |  | long err = SSL\_get\_verify\_result(native\_handle()); |
|  |  | buf << "code " << err << ": " << X509\_verify\_cert\_error\_string(err); |
|  |  | return buf.str(); |
|  |  | } |
|  |  |  |
|  |  | std::shared\_ptr<X509> UnbufferedAsioTlsStream::GetPeerCertificate() |
| Expand All | | @@ -43,17 +77,17 @@ void UnbufferedAsioTlsStream::BeforeHandshake(handshake\_type type) |
|  |  |  |
|  |  | set\_verify\_mode(ssl::verify\_peer | ssl::verify\_client\_once); |
|  |  |  |
|  |  | set\_verify\_callback([this](bool preverified, ssl::verify\_context& ctx) { |
|  |  | if (!preverified) { |
|  |  | m\_VerifyOK = false; |
|  |  |  |
|  |  | std::ostringstream msgbuf; |
|  |  | int err = X509\_STORE\_CTX\_get\_error(ctx.native\_handle()); |
|  |  |  |
|  |  | msgbuf << "code " << err << ": " << X509\_verify\_cert\_error\_string(err); |
|  |  | m\_VerifyError = msgbuf.str(); |
|  |  | } |
|  |  | set\_verify\_callback([](bool preverified, ssl::verify\_context& ctx) { |
|  |  | (void) preverified; |
|  |  | (void) ctx; |
|  |  |  |
|  |  | /\* Continue the handshake even if an invalid peer certificate was presented. The verification result has to be |
|  |  | \* checked using the IsVerifyOK() method. |
|  |  | \* |
|  |  | \* Such connections are used for the initial enrollment of nodes where they use a self-signed certificate to |
|  |  | \* send a certificate request and receive their valid certificate after approval (manually by the administrator |
|  |  | \* or using a certificate ticket). |
|  |  | \*/ |
|  |  | return true; |
|  |  | }); |
|  |  |  |
| Expand Down | |  |

8 changes: 3 additions & 5 deletions

8
[lib/base/tlsstream.hpp](#diff-85e3ad61abcf25637662ca991f62423b109dfac4062fd7c63583379dc36f2b75 "lib/base/tlsstream.hpp")

Show comments

[View file](/Icinga/icinga2/blob/2febc5e18ae0c93d989e64ebc2a9fd90e7205ad8/lib/base/tlsstream.hpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -70,12 +70,12 @@ class UnbufferedAsioTlsStream : public AsioTcpTlsStream |
|  |  | public: |
|  |  | inline |
|  |  | UnbufferedAsioTlsStream(UnbufferedAsioTlsStreamParams& init) |
|  |  | : AsioTcpTlsStream(init.IoContext, init.SslContext), m\_VerifyOK(true), m\_Hostname(init.Hostname) |
|  |  | : AsioTcpTlsStream(init.IoContext, init.SslContext), m\_Hostname(init.Hostname) |
|  |  | { |
|  |  | } |
|  |  |  |
|  |  | bool IsVerifyOK() const; |
|  |  | String GetVerifyError() const; |
|  |  | bool IsVerifyOK(); |
|  |  | String GetVerifyError(); |
|  |  | std::shared\_ptr<X509> GetPeerCertificate(); |
|  |  |  |
|  |  | template<class... Args> |
| Expand All | | @@ -97,8 +97,6 @@ class UnbufferedAsioTlsStream : public AsioTcpTlsStream |
|  |  | } |
|  |  |  |
|  |  | private: |
|  |  | bool m\_VerifyOK; |
|  |  | String m\_VerifyError; |
|  |  | String m\_Hostname; |
|  |  |  |
|  |  | void BeforeHandshake(handshake\_type type); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `2febc5e`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FIcinga%2Ficinga2%2Fcommit%2F2febc5e18ae0c93d989e64ebc2a9fd90e7205ad8) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from icinga.com_864fd74d_20250115_095850.html ===


[![Icinga](https://icinga.com/wp-content/uploads/2022/01/icinga-logo-inverted-104.png)](https://icinga.com/)

* Products
  + - [Icinga Stack explained
      Learn about the Icinga Monitoring Stack.](https://icinga.com/products/)
  + - [Infrastructure Monitoring
      Observe your entire IT in one place.](https://icinga.com/products/infrastructure-monitoring/)
  + - [Monitoring Automation
      Monitor massive amounts of data.](https://icinga.com/products/monitoring-automation/)
  + - [Cloud Monitoring
      Monitor the private, the public and the hybrid.](https://icinga.com/products/cloud-monitoring/)
  + - [Metrics & Logs
      Get the context and recognize trends.](https://icinga.com/products/metrics-and-logs/)
  + - [Analytics
      Analyze your data and perform proactively.](https://icinga.com/products/analytics/)
  + - [Notifications
      Get alerted and react with confidence.](https://icinga.com/products/notifications/)
* Solutions
  + - Monitoring
    - [Server Monitoring](https://icinga.com/solutions/server-monitoring/)
    - [Network Monitoring](https://icinga.com/solutions/network-monitoring/)
    - [Database Monitoring](https://icinga.com/solutions/database-monitoring/)
    - [Application Monitoring](https://icinga.com/solutions/application-monitoring/)
    - [Windows Monitoring](https://icinga.com/solutions/windows-monitoring/)
    - [VMware Monitoring](https://icinga.com/solutions/vmware-monitoring/)
    - [Environmental Monitoring](https://icinga.com/solutions/environmental-monitoring/)
  + - Operations
    - [Monitoring at Scale](https://icinga.com/solutions/monitoring-at-scale/)
    - [ITSM Integration](https://icinga.com/solutions/itsm-integration/)
    - [Monitoring and Security](https://icinga.com/solutions/monitoring-and-security/)
    - Access
    - [Business Reporting](https://icinga.com/solutions/business-reporting/)
    - [Teamwork Manager](https://icinga.com/solutions/teamwork-manager/)
    - [Accessibility](https://icinga.com/solutions/accessibility/)
  + - Customer Stories
    - [ING
      Banking](https://icinga.com/company/customers/ing/)
    - [Magazine Luiza
      Retail](https://icinga.com/company/customers/magazine-luiza/)
    - [Deutsche Telekom Security
      Telecom](https://icinga.com/company/customers/deutsche-telekom-security/)
    - [Binero
      Cloud](https://icinga.com/company/customers/binero/)
    - [City of Cologne
      Governmental](https://icinga.com/company/customers/city-of-cologne/)
    - [View all customer stories](https://icinga.com/company/customers/)
* [Subscriptions](https://icinga.com/subscriptions/)
* Services
  + [Support](https://icinga.com/services/support/)
  + [Consulting](https://icinga.com/services/consulting-services/)
  + [Trainings](https://icinga.com/services/trainings/)
  + [Certification](https://icinga.com/certification/)
* Resources
  + [Docs](https://icinga.com/docs/)
  + [Blog](https://icinga.com/blog/)
  + [Community](https://icinga.com/community/)
  + [Roadmap](https://icinga.com/roadmap/)
  + [Case Studies](https://icinga.com/company/customers/)
* [Contact Sales](https://icinga.com/contact-sales/)
* [Get Started](https://icinga.com/get-started/)

Select Page

# Critical Icinga 2 Security Releases: 2.14.3, 2.13.10, 2.12.11, 2.11.12 (CVE-2024-49369)

by [Julian Brost](https://icinga.com/blog/author/jbrost/ "Posts by Julian Brost") | Nov 12, 2024

![Icinga 2 Security Announcement, Versions 2.14.3, 2.13.10, 2.12.11, 2.11.12](https://icinga.com/wp-content/uploads/2024/11/Infrastructure-Two-Lines-3.jpg "Icinga 2 Security Announcement for versions 2.14.3, 2.13.10, 2.12.11, 2.11.12")

Today, we are releasing security updates for Icinga 2 fixing a critical vulnerability that allowed to bypass the certificate validation for JSON-RPC and HTTP API connections.

### Impact

The TLS certificate validation in all Icinga 2 versions starting from 2.4.0 was flawed, allowing an attacker to impersonate both trusted cluster nodes as well as any API users that use TLS client certificates for authentication (`ApiUser` objects with the `client_cn` attribute set).

By impersonating a trusted cluster node like a master or satellite, an attacker can supply a malicious configuration update to other nodes (if the `accept_config` attribute of the `ApiListener` object is set to true) or instruct the other node to execute malicious commands directly (if `the accept_commands` attribute of the `ApiListener` object is set to true). These attributes are expected to be set in most distributed installations, but in case they are not, an attacker can still retrieve potentially sensitive information.

When impersonating API users, the impact depends on the permissions configured for the individual users using certificate authentication. This may include permissions like updating the configuration and executing commands as well.

We expect most installations to be affected by this vulnerability and recommend upgrading as soon as possible.

### Patches

The following fixed versions were released:

* v2.14.3
* v2.13.10
* v2.12.11
* v2.11.12

The source code for the new versions can be found in our [Git repository](https://github.com/Icinga/icinga2/releases). Updated binary packages are available on [packages.icinga.com](https://packages.icinga.com/) and the Icinga for Windows repository. Updated container images are available on [Docker Hub](https://hub.docker.com/r/icinga/icinga2/tags). Updated Helm Charts are provided in the corresponding [repository](https://github.com/Icinga/helm-charts/tree/main/charts/icinga-stack).

Given the severity of the issue, users are advised to upgrade immediately.

### Workarounds

There is no known way to work around this in Icinga 2. Access to the Icinga 2 API port can be restricted using firewalls to reduce the impact.

### Details

In order to allow some time for patching, the full report with more details on the vulnerability including how to reproduce it will be released in two weeks on 2024-11-26.

### Acknowledgements

We would like to thank [Finn Steglich](https://github.com/fsteglich) for finding and reporting this issue.

### References

* [GitHub Security Advisory](https://github.com/Icinga/icinga2/security/advisories/GHSA-j7wq-r9mg-9wpv)
* Patch (source code): [master branch](https://github.com/Icinga/icinga2/commit/869a7d6f0fe38c748e67bacc1fbdd42c933030f6), [v2.14.3](https://github.com/Icinga/icinga2/commit/2febc5e18ae0c93d989e64ebc2a9fd90e7205ad8), [v2.13.10](https://github.com/Icinga/icinga2/commit/3504fc7ed688c10d86988e2029a65efc311393fe), [v2.12.11](https://github.com/Icinga/icinga2/commit/0419a2c36de408e9a703aec0962061ec9a285d3c), [v2.11.12](https://github.com/Icinga/icinga2/commit/8fed6608912c752b337d977f730547875a820831)

### For more information

If you have any questions or comments about this advisory, please ask in our [community forum](https://community.icinga.com/) or email us at info@icinga.com.

For reporting possible security issues, please see [the information on our website](https://icinga.com/company/contact/security-issues/).

## You May Also Like…

[![Releasing Icinga DB v1.2.1](data:image/svg+xml...)![Releasing Icinga DB v1.2.1](https://icinga.com/wp-content/uploads/2024/12/Infrastructure-One-Line-400x250.png)](https://icinga.com/blog/releasing-icinga-db-v1-2-1/)
## [Releasing Icinga DB v1.2.1](https://icinga.com/blog/releasing-icinga-db-v1-2-1/)

Dec 18, 2024

Today we are releasing a new version of Icinga DB, version 1.2.1, a maintenance release that addresses HA issues and...

[![Releasing Icinga Director v1.11.3](data:image/svg+xml...)![Releasing Icinga Director v1.11.3](https://icinga.com/wp-content/uploads/2024/12/Icinga-Director-v1.11.3-400x250.png)](https://icinga.com/blog/releasing-icinga-director-v1-11-3/)
## [Releasing Icinga Director v1.11.3](https://icinga.com/blog/releasing-icinga-director-v1-11-3/)

Dec 12, 2024

We are happy to announce the release of Icinga Director version 1.11.3. This release addresses few important bug fixes...

[![Releasing Icinga Director v1.11.2](data:image/svg+xml...)![Releasing Icinga Director v1.11.2](https://icinga.com/wp-content/uploads/2024/11/icinga-director-v1.11.2-400x250.png)](https://icinga.com/blog/releasing-icinga-director-v1-11-2/)
## [Releasing Icinga Director v1.11.2](https://icinga.com/blog/releasing-icinga-director-v1-11-2/)

Nov 20, 2024

We are pleased to announce the release of Icinga Director version 1.11.2, which addresses several important bug fixes...

![](data:image/svg+xml...)![](https://icinga.com/wp-content/uploads/2020/03/lala_right.png)

## Subscribe to our Newsletter

A monthly digest of the latest Icinga news, releases, articles and community topics.

Subscribe

**Icinga Stack**

[Infrastructure Monitoring](/products/infrastructure-monitoring/)
[Monitoring Automation](/products/automation/)
[Cloud Monitoring](/products/cloud-monitoring/)
[Metrics & Logs](/products/metrics-logs/)
[Notifications](/products/notifications/)
[Analytics](/products/analytics/)
[Icinga Integrations](https://icinga.com/products/integrations/)

**Resources**

[Get Started](/get-started/)
[Docs](/docs/)
[Blog](/blog/)
[Community](/community/)
[Case Studies](/company/customers/)
[Newsletter](/company/newsletter/)

**Services**

[Consulting](/services/consulting-services/)
[Trainings](/services/trainings/)
[Support](/services/support/)
[Subscriptions](/subscriptions/)

**Connect**
[Forum](https://community.icinga.com)
[GitHub](https://github.com/Icinga)

**Company**

[About Us](/company/)
[Partners](/company/partners/)
[Press & Media](/company/press-media/)
[Contact Us](/company/contact/)

[Imprint](/company/imprint)   [Privacy](/company/privacy-policy)   [Terms](/company/terms-of-use)

© 2009 - 2025 Icinga GmbH

[![](data:image/svg+xml...)![](https://icinga.com/wp-content/uploads/2018/04/icinga-logo-icon-inverted-512.png)](https://icinga.com)

* [Follow](https://twitter.com/icinga "Follow on X")
* [Follow](https://facebook.com/icinga "Follow on Facebook")
* [Follow](https://www.youtube.com/icinga "Follow on Youtube")
* [Follow](https://www.linkedin.com/company/icinga "Follow on LinkedIn")
* [Follow](/feed/ "Follow on RSS")



=== Content from github.com_ad95344a_20250115_095845.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FIcinga%2Ficinga2%2Fcommit%2F869a7d6f0fe38c748e67bacc1fbdd42c933030f6)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FIcinga%2Ficinga2%2Fcommit%2F869a7d6f0fe38c748e67bacc1fbdd42c933030f6)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=Icinga%2Ficinga2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Icinga](/Icinga)
/
**[icinga2](/Icinga/icinga2)**
Public

* [Notifications](/login?return_to=%2FIcinga%2Ficinga2) You must be signed in to change notification settings
* [Fork
  579](/login?return_to=%2FIcinga%2Ficinga2)
* [Star
   2k](/login?return_to=%2FIcinga%2Ficinga2)

* [Code](/Icinga/icinga2)
* [Issues
  321](/Icinga/icinga2/issues)
* [Pull requests
  155](/Icinga/icinga2/pulls)
* [Actions](/Icinga/icinga2/actions)
* [Projects
  1](/Icinga/icinga2/projects)
* [Security](/Icinga/icinga2/security)
* [Insights](/Icinga/icinga2/pulse)

Additional navigation options

* [Code](/Icinga/icinga2)
* [Issues](/Icinga/icinga2/issues)
* [Pull requests](/Icinga/icinga2/pulls)
* [Actions](/Icinga/icinga2/actions)
* [Projects](/Icinga/icinga2/projects)
* [Security](/Icinga/icinga2/security)
* [Insights](/Icinga/icinga2/pulse)

## Commit

[Permalink](/Icinga/icinga2/commit/869a7d6f0fe38c748e67bacc1fbdd42c933030f6)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Security: fix TLS certificate validation bypass

[Browse files](/Icinga/icinga2/tree/869a7d6f0fe38c748e67bacc1fbdd42c933030f6)
Browse the repository at this point in the history

```
The previous validation in set_verify_callback() could be bypassed, tricking
Icinga 2 into treating invalid certificates as valid. To fix this, the
validation checks were moved into the IsVerifyOK() function.

This is tracked as CVE-2024-49369, more details will be published at a later time.
```

* Loading branch information

[![@julianbrost](https://avatars.githubusercontent.com/u/18552?s=40&v=4)](/julianbrost) [![@Al2Klimov](https://avatars.githubusercontent.com/u/6053266?s=40&v=4)](/Al2Klimov)

[julianbrost](/Icinga/icinga2/commits?author=julianbrost "View all commits by julianbrost")
authored and
[Al2Klimov](/Icinga/icinga2/commits?author=Al2Klimov "View all commits by Al2Klimov")
committed
Oct 22, 2024

1 parent
[c6de69c](/Icinga/icinga2/commit/c6de69cfe4ad91c33c12d525c2672342cfde909c)

commit 869a7d6

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**51 additions**
and
**19 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* lib/base

  + lib/base/tlsstream.cpp
    [tlsstream.cpp](#diff-f3f4d5a51b324266bf5e97e270fc06b11c8e2c2cb0e448eea580a0735ce0b6b4)
  + lib/base/tlsstream.hpp
    [tlsstream.hpp](#diff-85e3ad61abcf25637662ca991f62423b109dfac4062fd7c63583379dc36f2b75)

## There are no files selected for viewing

62 changes: 48 additions & 14 deletions

62
[lib/base/tlsstream.cpp](#diff-f3f4d5a51b324266bf5e97e270fc06b11c8e2c2cb0e448eea580a0735ce0b6b4 "lib/base/tlsstream.cpp")

Show comments

[View file](/Icinga/icinga2/blob/869a7d6f0fe38c748e67bacc1fbdd42c933030f6/lib/base/tlsstream.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -18,14 +18,48 @@ |
|  |  |  |
|  |  | using namespace icinga; |
|  |  |  |
|  |  | bool UnbufferedAsioTlsStream::IsVerifyOK() const |
|  |  | /\*\* |
|  |  | \* Checks whether the TLS handshake was completed with a valid peer certificate. |
|  |  | \* |
|  |  | \* @return true if the peer presented a valid certificate, false otherwise |
|  |  | \*/ |
|  |  | bool UnbufferedAsioTlsStream::IsVerifyOK() |
|  |  | { |
|  |  | return m\_VerifyOK; |
|  |  | if (!SSL\_is\_init\_finished(native\_handle())) { |
|  |  | // handshake was not completed |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | if (GetPeerCertificate() == nullptr) { |
|  |  | // no peer certificate was sent |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | return SSL\_get\_verify\_result(native\_handle()) == X509\_V\_OK; |
|  |  | } |
|  |  |  |
|  |  | String UnbufferedAsioTlsStream::GetVerifyError() const |
|  |  | /\*\* |
|  |  | \* Returns a human-readable error string for situations where IsVerifyOK() returns false. |
|  |  | \* |
|  |  | \* If the handshake was completed and a peer certificate was provided, |
|  |  | \* the string additionally contains the OpenSSL verification error code. |
|  |  | \* |
|  |  | \* @return string containing the error message |
|  |  | \*/ |
|  |  | String UnbufferedAsioTlsStream::GetVerifyError() |
|  |  | { |
|  |  | return m\_VerifyError; |
|  |  | if (!SSL\_is\_init\_finished(native\_handle())) { |
|  |  | return "handshake not completed"; |
|  |  | } |
|  |  |  |
|  |  | if (GetPeerCertificate() == nullptr) { |
|  |  | return "no peer certificate provided"; |
|  |  | } |
|  |  |  |
|  |  | std::ostringstream buf; |
|  |  | long err = SSL\_get\_verify\_result(native\_handle()); |
|  |  | buf << "code " << err << ": " << X509\_verify\_cert\_error\_string(err); |
|  |  | return buf.str(); |
|  |  | } |
|  |  |  |
|  |  | std::shared\_ptr<X509> UnbufferedAsioTlsStream::GetPeerCertificate() |
| Expand All | | @@ -43,17 +77,17 @@ void UnbufferedAsioTlsStream::BeforeHandshake(handshake\_type type) |
|  |  |  |
|  |  | set\_verify\_mode(ssl::verify\_peer | ssl::verify\_client\_once); |
|  |  |  |
|  |  | set\_verify\_callback([this](bool preverified, ssl::verify\_context& ctx) { |
|  |  | if (!preverified) { |
|  |  | m\_VerifyOK = false; |
|  |  |  |
|  |  | std::ostringstream msgbuf; |
|  |  | int err = X509\_STORE\_CTX\_get\_error(ctx.native\_handle()); |
|  |  |  |
|  |  | msgbuf << "code " << err << ": " << X509\_verify\_cert\_error\_string(err); |
|  |  | m\_VerifyError = msgbuf.str(); |
|  |  | } |
|  |  | set\_verify\_callback([](bool preverified, ssl::verify\_context& ctx) { |
|  |  | (void) preverified; |
|  |  | (void) ctx; |
|  |  |  |
|  |  | /\* Continue the handshake even if an invalid peer certificate was presented. The verification result has to be |
|  |  | \* checked using the IsVerifyOK() method. |
|  |  | \* |
|  |  | \* Such connections are used for the initial enrollment of nodes where they use a self-signed certificate to |
|  |  | \* send a certificate request and receive their valid certificate after approval (manually by the administrator |
|  |  | \* or using a certificate ticket). |
|  |  | \*/ |
|  |  | return true; |
|  |  | }); |
|  |  |  |
| Expand Down | |  |

8 changes: 3 additions & 5 deletions

8
[lib/base/tlsstream.hpp](#diff-85e3ad61abcf25637662ca991f62423b109dfac4062fd7c63583379dc36f2b75 "lib/base/tlsstream.hpp")

Show comments

[View file](/Icinga/icinga2/blob/869a7d6f0fe38c748e67bacc1fbdd42c933030f6/lib/base/tlsstream.hpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -70,12 +70,12 @@ class UnbufferedAsioTlsStream : public AsioTcpTlsStream |
|  |  | public: |
|  |  | inline |
|  |  | UnbufferedAsioTlsStream(UnbufferedAsioTlsStreamParams& init) |
|  |  | : AsioTcpTlsStream(init.IoContext, init.SslContext), m\_VerifyOK(true), m\_Hostname(init.Hostname) |
|  |  | : AsioTcpTlsStream(init.IoContext, init.SslContext), m\_Hostname(init.Hostname) |
|  |  | { |
|  |  | } |
|  |  |  |
|  |  | bool IsVerifyOK() const; |
|  |  | String GetVerifyError() const; |
|  |  | bool IsVerifyOK(); |
|  |  | String GetVerifyError(); |
|  |  | std::shared\_ptr<X509> GetPeerCertificate(); |
|  |  |  |
|  |  | template<class... Args> |
| Expand All | | @@ -97,8 +97,6 @@ class UnbufferedAsioTlsStream : public AsioTcpTlsStream |
|  |  | } |
|  |  |  |
|  |  | private: |
|  |  | bool m\_VerifyOK; |
|  |  | String m\_VerifyError; |
|  |  | String m\_Hostname; |
|  |  |  |
|  |  | void BeforeHandshake(handshake\_type type); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `869a7d6`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FIcinga%2Ficinga2%2Fcommit%2F869a7d6f0fe38c748e67bacc1fbdd42c933030f6) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_f2a0d576_20250115_095839.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FIcinga%2Ficinga2%2Fcommit%2F0419a2c36de408e9a703aec0962061ec9a285d3c)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FIcinga%2Ficinga2%2Fcommit%2F0419a2c36de408e9a703aec0962061ec9a285d3c)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=Icinga%2Ficinga2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Icinga](/Icinga)
/
**[icinga2](/Icinga/icinga2)**
Public

* [Notifications](/login?return_to=%2FIcinga%2Ficinga2) You must be signed in to change notification settings
* [Fork
  579](/login?return_to=%2FIcinga%2Ficinga2)
* [Star
   2k](/login?return_to=%2FIcinga%2Ficinga2)

* [Code](/Icinga/icinga2)
* [Issues
  321](/Icinga/icinga2/issues)
* [Pull requests
  155](/Icinga/icinga2/pulls)
* [Actions](/Icinga/icinga2/actions)
* [Projects
  1](/Icinga/icinga2/projects)
* [Security](/Icinga/icinga2/security)
* [Insights](/Icinga/icinga2/pulse)

Additional navigation options

* [Code](/Icinga/icinga2)
* [Issues](/Icinga/icinga2/issues)
* [Pull requests](/Icinga/icinga2/pulls)
* [Actions](/Icinga/icinga2/actions)
* [Projects](/Icinga/icinga2/projects)
* [Security](/Icinga/icinga2/security)
* [Insights](/Icinga/icinga2/pulse)

## Commit

[Permalink](/Icinga/icinga2/commit/0419a2c36de408e9a703aec0962061ec9a285d3c)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Security: fix TLS certificate validation bypass

[Browse files](/Icinga/icinga2/tree/0419a2c36de408e9a703aec0962061ec9a285d3c)
Browse the repository at this point in the history

```
The previous validation in set_verify_callback() could be bypassed, tricking
Icinga 2 into treating invalid certificates as valid. To fix this, the
validation checks were moved into the IsVerifyOK() function.

This is tracked as CVE-2024-49369, more details will be published at a later time.
```

* Loading branch information

[![@julianbrost](https://avatars.githubusercontent.com/u/18552?s=40&v=4)](/julianbrost) [![@Al2Klimov](https://avatars.githubusercontent.com/u/6053266?s=40&v=4)](/Al2Klimov)

[julianbrost](/Icinga/icinga2/commits?author=julianbrost "View all commits by julianbrost")
authored and
[Al2Klimov](/Icinga/icinga2/commits?author=Al2Klimov "View all commits by Al2Klimov")
committed
Oct 22, 2024

1 parent
[c890969](/Icinga/icinga2/commit/c890969e7bfbdea7c4761e6bc23e0ec641f22d13)

commit 0419a2c

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**51 additions**
and
**19 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* lib/base

  + lib/base/tlsstream.cpp
    [tlsstream.cpp](#diff-f3f4d5a51b324266bf5e97e270fc06b11c8e2c2cb0e448eea580a0735ce0b6b4)
  + lib/base/tlsstream.hpp
    [tlsstream.hpp](#diff-85e3ad61abcf25637662ca991f62423b109dfac4062fd7c63583379dc36f2b75)

## There are no files selected for viewing

62 changes: 48 additions & 14 deletions

62
[lib/base/tlsstream.cpp](#diff-f3f4d5a51b324266bf5e97e270fc06b11c8e2c2cb0e448eea580a0735ce0b6b4 "lib/base/tlsstream.cpp")

Show comments

[View file](/Icinga/icinga2/blob/0419a2c36de408e9a703aec0962061ec9a285d3c/lib/base/tlsstream.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -18,14 +18,48 @@ |
|  |  |  |
|  |  | using namespace icinga; |
|  |  |  |
|  |  | bool UnbufferedAsioTlsStream::IsVerifyOK() const |
|  |  | /\*\* |
|  |  | \* Checks whether the TLS handshake was completed with a valid peer certificate. |
|  |  | \* |
|  |  | \* @return true if the peer presented a valid certificate, false otherwise |
|  |  | \*/ |
|  |  | bool UnbufferedAsioTlsStream::IsVerifyOK() |
|  |  | { |
|  |  | return m\_VerifyOK; |
|  |  | if (!SSL\_is\_init\_finished(native\_handle())) { |
|  |  | // handshake was not completed |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | if (GetPeerCertificate() == nullptr) { |
|  |  | // no peer certificate was sent |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | return SSL\_get\_verify\_result(native\_handle()) == X509\_V\_OK; |
|  |  | } |
|  |  |  |
|  |  | String UnbufferedAsioTlsStream::GetVerifyError() const |
|  |  | /\*\* |
|  |  | \* Returns a human-readable error string for situations where IsVerifyOK() returns false. |
|  |  | \* |
|  |  | \* If the handshake was completed and a peer certificate was provided, |
|  |  | \* the string additionally contains the OpenSSL verification error code. |
|  |  | \* |
|  |  | \* @return string containing the error message |
|  |  | \*/ |
|  |  | String UnbufferedAsioTlsStream::GetVerifyError() |
|  |  | { |
|  |  | return m\_VerifyError; |
|  |  | if (!SSL\_is\_init\_finished(native\_handle())) { |
|  |  | return "handshake not completed"; |
|  |  | } |
|  |  |  |
|  |  | if (GetPeerCertificate() == nullptr) { |
|  |  | return "no peer certificate provided"; |
|  |  | } |
|  |  |  |
|  |  | std::ostringstream buf; |
|  |  | long err = SSL\_get\_verify\_result(native\_handle()); |
|  |  | buf << "code " << err << ": " << X509\_verify\_cert\_error\_string(err); |
|  |  | return buf.str(); |
|  |  | } |
|  |  |  |
|  |  | std::shared\_ptr<X509> UnbufferedAsioTlsStream::GetPeerCertificate() |
| Expand All | | @@ -43,17 +77,17 @@ void UnbufferedAsioTlsStream::BeforeHandshake(handshake\_type type) |
|  |  |  |
|  |  | set\_verify\_mode(ssl::verify\_peer | ssl::verify\_client\_once); |
|  |  |  |
|  |  | set\_verify\_callback([this](bool preverified, ssl::verify\_context& ctx) { |
|  |  | if (!preverified) { |
|  |  | m\_VerifyOK = false; |
|  |  |  |
|  |  | std::ostringstream msgbuf; |
|  |  | int err = X509\_STORE\_CTX\_get\_error(ctx.native\_handle()); |
|  |  |  |
|  |  | msgbuf << "code " << err << ": " << X509\_verify\_cert\_error\_string(err); |
|  |  | m\_VerifyError = msgbuf.str(); |
|  |  | } |
|  |  | set\_verify\_callback([](bool preverified, ssl::verify\_context& ctx) { |
|  |  | (void) preverified; |
|  |  | (void) ctx; |
|  |  |  |
|  |  | /\* Continue the handshake even if an invalid peer certificate was presented. The verification result has to be |
|  |  | \* checked using the IsVerifyOK() method. |
|  |  | \* |
|  |  | \* Such connections are used for the initial enrollment of nodes where they use a self-signed certificate to |
|  |  | \* send a certificate request and receive their valid certificate after approval (manually by the administrator |
|  |  | \* or using a certificate ticket). |
|  |  | \*/ |
|  |  | return true; |
|  |  | }); |
|  |  |  |
| Expand Down | |  |

8 changes: 3 additions & 5 deletions

8
[lib/base/tlsstream.hpp](#diff-85e3ad61abcf25637662ca991f62423b109dfac4062fd7c63583379dc36f2b75 "lib/base/tlsstream.hpp")

Show comments

[View file](/Icinga/icinga2/blob/0419a2c36de408e9a703aec0962061ec9a285d3c/lib/base/tlsstream.hpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -70,12 +70,12 @@ class UnbufferedAsioTlsStream : public AsioTcpTlsStream |
|  |  | public: |
|  |  | inline |
|  |  | UnbufferedAsioTlsStream(UnbufferedAsioTlsStreamParams& init) |
|  |  | : AsioTcpTlsStream(init.IoContext, init.SslContext), m\_VerifyOK(true), m\_Hostname(init.Hostname) |
|  |  | : AsioTcpTlsStream(init.IoContext, init.SslContext), m\_Hostname(init.Hostname) |
|  |  | { |
|  |  | } |
|  |  |  |
|  |  | bool IsVerifyOK() const; |
|  |  | String GetVerifyError() const; |
|  |  | bool IsVerifyOK(); |
|  |  | String GetVerifyError(); |
|  |  | std::shared\_ptr<X509> GetPeerCertificate(); |
|  |  |  |
|  |  | template<class... Args> |
| Expand All | | @@ -97,8 +97,6 @@ class UnbufferedAsioTlsStream : public AsioTcpTlsStream |
|  |  | } |
|  |  |  |
|  |  | private: |
|  |  | bool m\_VerifyOK; |
|  |  | String m\_VerifyError; |
|  |  | String m\_Hostname; |
|  |  |  |
|  |  | void BeforeHandshake(handshake\_type type); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `0419a2c`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FIcinga%2Ficinga2%2Fcommit%2F0419a2c36de408e9a703aec0962061ec9a285d3c) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_44097a62_20250115_095843.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FIcinga%2Ficinga2%2Fcommit%2F3504fc7ed688c10d86988e2029a65efc311393fe)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FIcinga%2Ficinga2%2Fcommit%2F3504fc7ed688c10d86988e2029a65efc311393fe)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=Icinga%2Ficinga2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Icinga](/Icinga)
/
**[icinga2](/Icinga/icinga2)**
Public

* [Notifications](/login?return_to=%2FIcinga%2Ficinga2) You must be signed in to change notification settings
* [Fork
  579](/login?return_to=%2FIcinga%2Ficinga2)
* [Star
   2k](/login?return_to=%2FIcinga%2Ficinga2)

* [Code](/Icinga/icinga2)
* [Issues
  321](/Icinga/icinga2/issues)
* [Pull requests
  155](/Icinga/icinga2/pulls)
* [Actions](/Icinga/icinga2/actions)
* [Projects
  1](/Icinga/icinga2/projects)
* [Security](/Icinga/icinga2/security)
* [Insights](/Icinga/icinga2/pulse)

Additional navigation options

* [Code](/Icinga/icinga2)
* [Issues](/Icinga/icinga2/issues)
* [Pull requests](/Icinga/icinga2/pulls)
* [Actions](/Icinga/icinga2/actions)
* [Projects](/Icinga/icinga2/projects)
* [Security](/Icinga/icinga2/security)
* [Insights](/Icinga/icinga2/pulse)

## Commit

[Permalink](/Icinga/icinga2/commit/3504fc7ed688c10d86988e2029a65efc311393fe)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Security: fix TLS certificate validation bypass

[Browse files](/Icinga/icinga2/tree/3504fc7ed688c10d86988e2029a65efc311393fe)
Browse the repository at this point in the history

```
The previous validation in set_verify_callback() could be bypassed, tricking
Icinga 2 into treating invalid certificates as valid. To fix this, the
validation checks were moved into the IsVerifyOK() function.

This is tracked as CVE-2024-49369, more details will be published at a later time.
```

* Loading branch information

[![@julianbrost](https://avatars.githubusercontent.com/u/18552?s=40&v=4)](/julianbrost) [![@Al2Klimov](https://avatars.githubusercontent.com/u/6053266?s=40&v=4)](/Al2Klimov)

[julianbrost](/Icinga/icinga2/commits?author=julianbrost "View all commits by julianbrost")
authored and
[Al2Klimov](/Icinga/icinga2/commits?author=Al2Klimov "View all commits by Al2Klimov")
committed
Oct 22, 2024

1 parent
[84672b3](/Icinga/icinga2/commit/84672b34b2be36f863921e089c3b144e585f0896)

commit 3504fc7

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**51 additions**
and
**19 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* lib/base

  + lib/base/tlsstream.cpp
    [tlsstream.cpp](#diff-f3f4d5a51b324266bf5e97e270fc06b11c8e2c2cb0e448eea580a0735ce0b6b4)
  + lib/base/tlsstream.hpp
    [tlsstream.hpp](#diff-85e3ad61abcf25637662ca991f62423b109dfac4062fd7c63583379dc36f2b75)

## There are no files selected for viewing

62 changes: 48 additions & 14 deletions

62
[lib/base/tlsstream.cpp](#diff-f3f4d5a51b324266bf5e97e270fc06b11c8e2c2cb0e448eea580a0735ce0b6b4 "lib/base/tlsstream.cpp")

Show comments

[View file](/Icinga/icinga2/blob/3504fc7ed688c10d86988e2029a65efc311393fe/lib/base/tlsstream.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -18,14 +18,48 @@ |
|  |  |  |
|  |  | using namespace icinga; |
|  |  |  |
|  |  | bool UnbufferedAsioTlsStream::IsVerifyOK() const |
|  |  | /\*\* |
|  |  | \* Checks whether the TLS handshake was completed with a valid peer certificate. |
|  |  | \* |
|  |  | \* @return true if the peer presented a valid certificate, false otherwise |
|  |  | \*/ |
|  |  | bool UnbufferedAsioTlsStream::IsVerifyOK() |
|  |  | { |
|  |  | return m\_VerifyOK; |
|  |  | if (!SSL\_is\_init\_finished(native\_handle())) { |
|  |  | // handshake was not completed |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | if (GetPeerCertificate() == nullptr) { |
|  |  | // no peer certificate was sent |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | return SSL\_get\_verify\_result(native\_handle()) == X509\_V\_OK; |
|  |  | } |
|  |  |  |
|  |  | String UnbufferedAsioTlsStream::GetVerifyError() const |
|  |  | /\*\* |
|  |  | \* Returns a human-readable error string for situations where IsVerifyOK() returns false. |
|  |  | \* |
|  |  | \* If the handshake was completed and a peer certificate was provided, |
|  |  | \* the string additionally contains the OpenSSL verification error code. |
|  |  | \* |
|  |  | \* @return string containing the error message |
|  |  | \*/ |
|  |  | String UnbufferedAsioTlsStream::GetVerifyError() |
|  |  | { |
|  |  | return m\_VerifyError; |
|  |  | if (!SSL\_is\_init\_finished(native\_handle())) { |
|  |  | return "handshake not completed"; |
|  |  | } |
|  |  |  |
|  |  | if (GetPeerCertificate() == nullptr) { |
|  |  | return "no peer certificate provided"; |
|  |  | } |
|  |  |  |
|  |  | std::ostringstream buf; |
|  |  | long err = SSL\_get\_verify\_result(native\_handle()); |
|  |  | buf << "code " << err << ": " << X509\_verify\_cert\_error\_string(err); |
|  |  | return buf.str(); |
|  |  | } |
|  |  |  |
|  |  | std::shared\_ptr<X509> UnbufferedAsioTlsStream::GetPeerCertificate() |
| Expand All | | @@ -43,17 +77,17 @@ void UnbufferedAsioTlsStream::BeforeHandshake(handshake\_type type) |
|  |  |  |
|  |  | set\_verify\_mode(ssl::verify\_peer | ssl::verify\_client\_once); |
|  |  |  |
|  |  | set\_verify\_callback([this](bool preverified, ssl::verify\_context& ctx) { |
|  |  | if (!preverified) { |
|  |  | m\_VerifyOK = false; |
|  |  |  |
|  |  | std::ostringstream msgbuf; |
|  |  | int err = X509\_STORE\_CTX\_get\_error(ctx.native\_handle()); |
|  |  |  |
|  |  | msgbuf << "code " << err << ": " << X509\_verify\_cert\_error\_string(err); |
|  |  | m\_VerifyError = msgbuf.str(); |
|  |  | } |
|  |  | set\_verify\_callback([](bool preverified, ssl::verify\_context& ctx) { |
|  |  | (void) preverified; |
|  |  | (void) ctx; |
|  |  |  |
|  |  | /\* Continue the handshake even if an invalid peer certificate was presented. The verification result has to be |
|  |  | \* checked using the IsVerifyOK() method. |
|  |  | \* |
|  |  | \* Such connections are used for the initial enrollment of nodes where they use a self-signed certificate to |
|  |  | \* send a certificate request and receive their valid certificate after approval (manually by the administrator |
|  |  | \* or using a certificate ticket). |
|  |  | \*/ |
|  |  | return true; |
|  |  | }); |
|  |  |  |
| Expand Down | |  |

8 changes: 3 additions & 5 deletions

8
[lib/base/tlsstream.hpp](#diff-85e3ad61abcf25637662ca991f62423b109dfac4062fd7c63583379dc36f2b75 "lib/base/tlsstream.hpp")

Show comments

[View file](/Icinga/icinga2/blob/3504fc7ed688c10d86988e2029a65efc311393fe/lib/base/tlsstream.hpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -70,12 +70,12 @@ class UnbufferedAsioTlsStream : public AsioTcpTlsStream |
|  |  | public: |
|  |  | inline |
|  |  | UnbufferedAsioTlsStream(UnbufferedAsioTlsStreamParams& init) |
|  |  | : AsioTcpTlsStream(init.IoContext, init.SslContext), m\_VerifyOK(true), m\_Hostname(init.Hostname) |
|  |  | : AsioTcpTlsStream(init.IoContext, init.SslContext), m\_Hostname(init.Hostname) |
|  |  | { |
|  |  | } |
|  |  |  |
|  |  | bool IsVerifyOK() const; |
|  |  | String GetVerifyError() const; |
|  |  | bool IsVerifyOK(); |
|  |  | String GetVerifyError(); |
|  |  | std::shared\_ptr<X509> GetPeerCertificate(); |
|  |  |  |
|  |  | template<class... Args> |
| Expand All | | @@ -97,8 +97,6 @@ class UnbufferedAsioTlsStream : public AsioTcpTlsStream |
|  |  | } |
|  |  |  |
|  |  | private: |
|  |  | bool m\_VerifyOK; |
|  |  | String m\_VerifyError; |
|  |  | String m\_Hostname; |
|  |  |  |
|  |  | void BeforeHandshake(handshake\_type type); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `3504fc7`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FIcinga%2Ficinga2%2Fcommit%2F3504fc7ed688c10d86988e2029a65efc311393fe) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_4d25ad34_20250115_095847.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FIcinga%2Ficinga2%2Fcommit%2F8fed6608912c752b337d977f730547875a820831)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FIcinga%2Ficinga2%2Fcommit%2F8fed6608912c752b337d977f730547875a820831)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=Icinga%2Ficinga2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Icinga](/Icinga)
/
**[icinga2](/Icinga/icinga2)**
Public

* [Notifications](/login?return_to=%2FIcinga%2Ficinga2) You must be signed in to change notification settings
* [Fork
  579](/login?return_to=%2FIcinga%2Ficinga2)
* [Star
   2k](/login?return_to=%2FIcinga%2Ficinga2)

* [Code](/Icinga/icinga2)
* [Issues
  321](/Icinga/icinga2/issues)
* [Pull requests
  155](/Icinga/icinga2/pulls)
* [Actions](/Icinga/icinga2/actions)
* [Projects
  1](/Icinga/icinga2/projects)
* [Security](/Icinga/icinga2/security)
* [Insights](/Icinga/icinga2/pulse)

Additional navigation options

* [Code](/Icinga/icinga2)
* [Issues](/Icinga/icinga2/issues)
* [Pull requests](/Icinga/icinga2/pulls)
* [Actions](/Icinga/icinga2/actions)
* [Projects](/Icinga/icinga2/projects)
* [Security](/Icinga/icinga2/security)
* [Insights](/Icinga/icinga2/pulse)

## Commit

[Permalink](/Icinga/icinga2/commit/8fed6608912c752b337d977f730547875a820831)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Security: fix TLS certificate validation bypass

[Browse files](/Icinga/icinga2/tree/8fed6608912c752b337d977f730547875a820831)
Browse the repository at this point in the history

```
The previous validation in set_verify_callback() could be bypassed, tricking
Icinga 2 into treating invalid certificates as valid. To fix this, the
validation checks were moved into the IsVerifyOK() function.

This is tracked as CVE-2024-49369, more details will be published at a later time.
```

* Loading branch information

[![@julianbrost](https://avatars.githubusercontent.com/u/18552?s=40&v=4)](/julianbrost) [![@Al2Klimov](https://avatars.githubusercontent.com/u/6053266?s=40&v=4)](/Al2Klimov)

[julianbrost](/Icinga/icinga2/commits?author=julianbrost "View all commits by julianbrost")
authored and
[Al2Klimov](/Icinga/icinga2/commits?author=Al2Klimov "View all commits by Al2Klimov")
committed
Oct 22, 2024

1 parent
[08e2d9f](/Icinga/icinga2/commit/08e2d9fc00f1eaebc40404f69a602644f3f032f6)

commit 8fed660

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**51 additions**
and
**19 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* lib/base

  + lib/base/tlsstream.cpp
    [tlsstream.cpp](#diff-f3f4d5a51b324266bf5e97e270fc06b11c8e2c2cb0e448eea580a0735ce0b6b4)
  + lib/base/tlsstream.hpp
    [tlsstream.hpp](#diff-85e3ad61abcf25637662ca991f62423b109dfac4062fd7c63583379dc36f2b75)

## There are no files selected for viewing

62 changes: 48 additions & 14 deletions

62
[lib/base/tlsstream.cpp](#diff-f3f4d5a51b324266bf5e97e270fc06b11c8e2c2cb0e448eea580a0735ce0b6b4 "lib/base/tlsstream.cpp")

Show comments

[View file](/Icinga/icinga2/blob/8fed6608912c752b337d977f730547875a820831/lib/base/tlsstream.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -18,14 +18,48 @@ |
|  |  |  |
|  |  | using namespace icinga; |
|  |  |  |
|  |  | bool UnbufferedAsioTlsStream::IsVerifyOK() const |
|  |  | /\*\* |
|  |  | \* Checks whether the TLS handshake was completed with a valid peer certificate. |
|  |  | \* |
|  |  | \* @return true if the peer presented a valid certificate, false otherwise |
|  |  | \*/ |
|  |  | bool UnbufferedAsioTlsStream::IsVerifyOK() |
|  |  | { |
|  |  | return m\_VerifyOK; |
|  |  | if (!SSL\_is\_init\_finished(native\_handle())) { |
|  |  | // handshake was not completed |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | if (GetPeerCertificate() == nullptr) { |
|  |  | // no peer certificate was sent |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | return SSL\_get\_verify\_result(native\_handle()) == X509\_V\_OK; |
|  |  | } |
|  |  |  |
|  |  | String UnbufferedAsioTlsStream::GetVerifyError() const |
|  |  | /\*\* |
|  |  | \* Returns a human-readable error string for situations where IsVerifyOK() returns false. |
|  |  | \* |
|  |  | \* If the handshake was completed and a peer certificate was provided, |
|  |  | \* the string additionally contains the OpenSSL verification error code. |
|  |  | \* |
|  |  | \* @return string containing the error message |
|  |  | \*/ |
|  |  | String UnbufferedAsioTlsStream::GetVerifyError() |
|  |  | { |
|  |  | return m\_VerifyError; |
|  |  | if (!SSL\_is\_init\_finished(native\_handle())) { |
|  |  | return "handshake not completed"; |
|  |  | } |
|  |  |  |
|  |  | if (GetPeerCertificate() == nullptr) { |
|  |  | return "no peer certificate provided"; |
|  |  | } |
|  |  |  |
|  |  | std::ostringstream buf; |
|  |  | long err = SSL\_get\_verify\_result(native\_handle()); |
|  |  | buf << "code " << err << ": " << X509\_verify\_cert\_error\_string(err); |
|  |  | return buf.str(); |
|  |  | } |
|  |  |  |
|  |  | std::shared\_ptr<X509> UnbufferedAsioTlsStream::GetPeerCertificate() |
| Expand All | | @@ -43,17 +77,17 @@ void UnbufferedAsioTlsStream::BeforeHandshake(handshake\_type type) |
|  |  |  |
|  |  | set\_verify\_mode(ssl::verify\_peer | ssl::verify\_client\_once); |
|  |  |  |
|  |  | set\_verify\_callback([this](bool preverified, ssl::verify\_context& ctx) { |
|  |  | if (!preverified) { |
|  |  | m\_VerifyOK = false; |
|  |  |  |
|  |  | std::ostringstream msgbuf; |
|  |  | int err = X509\_STORE\_CTX\_get\_error(ctx.native\_handle()); |
|  |  |  |
|  |  | msgbuf << "code " << err << ": " << X509\_verify\_cert\_error\_string(err); |
|  |  | m\_VerifyError = msgbuf.str(); |
|  |  | } |
|  |  | set\_verify\_callback([](bool preverified, ssl::verify\_context& ctx) { |
|  |  | (void) preverified; |
|  |  | (void) ctx; |
|  |  |  |
|  |  | /\* Continue the handshake even if an invalid peer certificate was presented. The verification result has to be |
|  |  | \* checked using the IsVerifyOK() method. |
|  |  | \* |
|  |  | \* Such connections are used for the initial enrollment of nodes where they use a self-signed certificate to |
|  |  | \* send a certificate request and receive their valid certificate after approval (manually by the administrator |
|  |  | \* or using a certificate ticket). |
|  |  | \*/ |
|  |  | return true; |
|  |  | }); |
|  |  |  |
| Expand Down | |  |

8 changes: 3 additions & 5 deletions

8
[lib/base/tlsstream.hpp](#diff-85e3ad61abcf25637662ca991f62423b109dfac4062fd7c63583379dc36f2b75 "lib/base/tlsstream.hpp")

Show comments

[View file](/Icinga/icinga2/blob/8fed6608912c752b337d977f730547875a820831/lib/base/tlsstream.hpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -69,12 +69,12 @@ class UnbufferedAsioTlsStream : public AsioTcpTlsStream |
|  |  | public: |
|  |  | inline |
|  |  | UnbufferedAsioTlsStream(UnbufferedAsioTlsStreamParams& init) |
|  |  | : AsioTcpTlsStream(init.IoContext, init.SslContext), m\_VerifyOK(true), m\_Hostname(init.Hostname) |
|  |  | : AsioTcpTlsStream(init.IoContext, init.SslContext), m\_Hostname(init.Hostname) |
|  |  | { |
|  |  | } |
|  |  |  |
|  |  | bool IsVerifyOK() const; |
|  |  | String GetVerifyError() const; |
|  |  | bool IsVerifyOK(); |
|  |  | String GetVerifyError(); |
|  |  | std::shared\_ptr<X509> GetPeerCertificate(); |
|  |  |  |
|  |  | template<class... Args> |
| Expand All | | @@ -96,8 +96,6 @@ class UnbufferedAsioTlsStream : public AsioTcpTlsStream |
|  |  | } |
|  |  |  |
|  |  | private: |
|  |  | bool m\_VerifyOK; |
|  |  | String m\_VerifyError; |
|  |  | String m\_Hostname; |
|  |  |  |
|  |  | void BeforeHandshake(handshake\_type type); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `8fed660`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FIcinga%2Ficinga2%2Fcommit%2F8fed6608912c752b337d977f730547875a820831) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


