=== Content from github.com_d613fb95_20250115_175838.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjackc%2Fpgproto3%2Fsecurity%2Fadvisories%2FGHSA-7jwh-3vrq-q3m8)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjackc%2Fpgproto3%2Fsecurity%2Fadvisories%2FGHSA-7jwh-3vrq-q3m8)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=jackc%2Fpgproto3)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[jackc](/jackc)
/
**[pgproto3](/jackc/pgproto3)**
Public

* [Notifications](/login?return_to=%2Fjackc%2Fpgproto3) You must be signed in to change notification settings
* [Fork
  44](/login?return_to=%2Fjackc%2Fpgproto3)
* [Star
   166](/login?return_to=%2Fjackc%2Fpgproto3)

* [Code](/jackc/pgproto3)
* [Issues
  3](/jackc/pgproto3/issues)
* [Pull requests
  0](/jackc/pgproto3/pulls)
* [Actions](/jackc/pgproto3/actions)
* [Projects
  0](/jackc/pgproto3/projects)
* [Security](/jackc/pgproto3/security)
* [Insights](/jackc/pgproto3/pulse)

Additional navigation options

* [Code](/jackc/pgproto3)
* [Issues](/jackc/pgproto3/issues)
* [Pull requests](/jackc/pgproto3/pulls)
* [Actions](/jackc/pgproto3/actions)
* [Projects](/jackc/pgproto3/projects)
* [Security](/jackc/pgproto3/security)
* [Insights](/jackc/pgproto3/pulse)

# SQL Injection via Protocol Message Size Overflow

Moderate

[jackc](/jackc)
published
GHSA-7jwh-3vrq-q3m8
Mar 4, 2024

## Package

gomod

github.com/jackc/pgproto3
([Go](/advisories?query=ecosystem%3Ago))

## Affected versions

< v2.3.3

## Patched versions

v2.3.3

## Description

### Impact

SQL injection can occur if an attacker can cause a single query or bind message to exceed 4 GB in size. An integer overflow in the calculated message size can cause the one large message to be sent as multiple messages under the attacker's control.

### Patches

The problem is resolved in v2.3.3

### Workarounds

Reject user input large enough to cause a single query or bind message to exceed 4 GB in size.

### Severity

Moderate

### CVE ID

CVE-2024-27304

### Weaknesses

No CWEs

### Credits

* [![@paul-gerste-sonarsource](https://avatars.githubusercontent.com/u/79814126?s=40&v=4)](/paul-gerste-sonarsource)
  [paul-gerste-sonarsource](/paul-gerste-sonarsource)
  Finder

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from www.youtube.com_2c7438d5_20250115_175843.html ===
[00:00] welcome everybody to SQL injection isn't
[00:03] dead smuggling queries at the protocol
[00:06] level or how I like to call it SQL
[00:09] injection lower
[00:11] decks because usually with SQL injection
[00:13] you're at the high level like at the
[00:15] bridge where the captain and the high
[00:16] ranking officers are and they're
[00:18] speaking their query language and their
[00:20] business language but today we're going
[00:23] to do go down to the lower decks where
[00:25] the mechanics are and where they shift
[00:27] around the bits and bites
[00:30] so to hook you at the beginning I have a
[00:32] small teaser this code snippit is a
[00:34] small HTTP request Handler written in go
[00:37] and it just takes a user ID from the
[00:40] body and uses it in a prepared statement
[00:42] to select the user and if you think
[00:44] everything's fine here there's no way
[00:46] for skl injection then you should stay
[00:48] because I'm going to prove you
[00:50] wrong and at a high level in this talk
[00:53] we're going to look at how applications
[00:55] talk to their databases over the network
[00:57] and how attackers can inject in that
[01:00] connection and what can go wrong and
[01:03] also how prevalent the problem
[01:05] is a bit about me I'm Paul I'm a
[01:08] vulnerability researcher at sonar's R&D
[01:11] team and if you don't know sonar we're
[01:13] the home of clean code so we help
[01:14] developers Write Clean code which also
[01:16] means secure code and that's why we look
[01:18] at a lot of code and uh try to find
[01:21] stuff there so for the rough outline
[01:24] first we're going to look at the idea of
[01:26] all of this research and then we'll go
[01:28] into the main part of the talk which is
[01:29] is attacking the database wire protocols
[01:32] and we're going to focus on post grass
[01:34] and mongodb here then we'll put things
[01:37] into perspective uh by looking at the
[01:39] real world applicability of the research
[01:41] and then give you some ideas for future
[01:43] re future research and draw some
[01:46] takeaways so in short the idea is to do
[01:50] request smuggling but for binary
[01:53] protocols and of course for this I have
[01:55] to mention James kettle's HTP DC attacks
[01:59] where you BAS basically cause a
[02:00] disagreement between two systems over
[02:02] the end of a HTTP request for example
[02:05] between a reverse proxy and an upstream
[02:07] backend and if they don't agree on where
[02:09] a message ends or a HTTP request in this
[02:12] case then the attacker can do some bad
[02:15] things and the root causes of this were
[02:17] many fold but some examples are text
[02:19] parsing where one system would only
[02:21] accept the exact word chunked and the
[02:24] other one would also allow a tapped
[02:26] character in front uh or they were
[02:28] logical where one system used the
[02:29] content length header and the other used
[02:31] the transfer encoding and then things
[02:33] were off again but what about other
[02:36] protocols and specifically what about
[02:38] binary
[02:39] protocols uh where do they have M
[02:42] message boundaries how do they do it um
[02:44] some of them have delimiters where for
[02:47] example in null terminated strings the
[02:49] null bite is the delimiter that tells
[02:50] the end of the string or you might have
[02:53] length Fields uh and there's an entirely
[02:55] entire family of protocols that are
[02:57] called tlv or type length value
[02:59] protocols because I have a type field
[03:01] and then a length field and then the
[03:03] rest of the message is the
[03:05] value so how could we desync in these
[03:08] protocols uh for the limiters it sounds
[03:11] quite easy you just have to find a way
[03:12] to put a delimiter where it's not
[03:14] supposed to be in a value of course it's
[03:17] not that simple but at least you
[03:19] directly have an idea of what you could
[03:21] do uh but for length Fields I was stuck
[03:24] for a moment and thought about okay you
[03:25] have a length field it has a fixed size
[03:27] it has a fixed location in the message
[03:29] so what could go wrong there and then I
[03:31] thought okay maybe some indianness
[03:33] issues or maybe uh integer overflows and
[03:37] I wanted to go deeper into that so for
[03:40] that I first looked at the Modern web
[03:42] application landscape where are binary
[03:45] protocols used there so at the center
[03:47] you always have the application and it
[03:49] talks to databases or caches uh storages
[03:54] message cues structured logging and so
[03:57] on and I wanted to focus on connection
[04:00] between the application and the
[04:02] database uh and that was because I
[04:04] thought that if I would find something
[04:07] it would have a great applicability
[04:08] because every almost every web app has a
[04:11] database um then there's a big potential
[04:14] severity because databases are high
[04:16] value targets because they either
[04:17] contain interesting data like personal
[04:19] information or relevant data to the
[04:22] application for example used for
[04:24] authentication and then also the
[04:26] exploitability should be quite good
[04:28] because what web app has a database but
[04:31] doesn't let the user query something
[04:33] from that database right so we have kind
[04:36] of guaranteed user
[04:38] input so let's start in and look at some
[04:42] uh database wire protocols and for that
[04:44] I have a small overview of four uh
[04:47] popular databases and how their messages
[04:50] in their protocols look like so for
[04:53] postgress this is how a message looks
[04:55] like uh you have a type byte then a 4
[04:57] byte length and then develop which in
[05:00] this case is just uh the string that's
[05:02] an SQL
[05:03] statement for MySQL it looks kind of
[05:06] similar your first have the length it's
[05:08] only three bytes but then you have a one
[05:10] bite sequence which would allow you to
[05:13] send multiple packets that would be
[05:15] reassembled to one big message at the
[05:17] end and there Al of course Al you have
[05:20] the value for redis which is not exactly
[05:23] a binary protocol but their docs kind of
[05:26] read like this uh because they talk
[05:28] about oh here the have this bite so I
[05:30] wanted to include it anyways there you
[05:33] first have a type bite then you have a
[05:34] length but it's not a fixed size field
[05:37] it's a decimal integer that has to be
[05:39] pared then you have a delimiter and then
[05:41] the value and then another
[05:43] delimiter and finally for mongodb um
[05:47] it's a little bit longer you first have
[05:48] the message length again a 4 byte field
[05:51] then you have a little bit more metadata
[05:53] for example the op code is like the
[05:54] message type and then the value is a
[05:56] little bit more of a complicated binary
[05:58] structure called B
[06:01] on so let's start with postgress uh
[06:05] again this is how a packet looks there
[06:07] one byte type identifier 4 byte integer
[06:10] length field and then the value so I
[06:13] thought about okay 4 byte integer Fields
[06:16] you can fit quite big numbers in there
[06:18] like 2 to the^ of 32 minus 1 which is
[06:21] roughly the size of 4 GB but maybe what
[06:25] if we could somehow make a query that's
[06:29] bigger than that how do actually
[06:31] libraries handle this um this kind of
[06:34] too large thing and for that I started
[06:38] to look into code of postgress client
[06:40] libraries and I found the first bug this
[06:43] is the code of a library called PGX it's
[06:46] written in go and this function is
[06:48] supposed to encode the content of a of a
[06:51] message into a larger message buffer so
[06:54] first it writes the message type in this
[06:56] case it's a B for a bind message then it
[06:59] saves the offset where it should later
[07:01] write the size to then it adds all of
[07:04] the actual data of the message and
[07:07] finally it writes the size and to do
[07:09] that it first slices the message buffer
[07:12] to the exact size of what is included in
[07:15] the length for example not the type bite
[07:18] then it takes the length of this sliced
[07:19] buffer and here the length is of type
[07:22] int which in most modern systems is a
[07:24] 64-bit integer but then this is
[07:28] truncated down explicitly to an
[07:30] in32 so we have a problem here because
[07:33] if the length was bigger than what can
[07:35] be expressed in an
[07:36] in32 we now have a truncation and the
[07:39] number becomes very small but then the
[07:41] library still sends all of the data
[07:44] after that so then if the database has
[07:46] to parse this message it will just see a
[07:48] very small length and only parse a very
[07:50] small message and then try to parse
[07:53] whatever is coming after that as more
[07:55] messages but in fact it's data from the
[07:58] first message
[08:00] so let's look at this again with example
[08:02] messenges um so here we have a very
[08:05] small one we have a four by value and
[08:08] then the length becomes eight because
[08:09] the size of the length field itself is
[08:11] also included in the length so it's a
[08:13] length of
[08:14] eight this is how the largest possible
[08:18] message looks like you can see the
[08:19] length is filled to the brim with hex FF
[08:23] because the value is just almost 4
[08:25] gigabytes of Ace but still everything's
[08:27] good because the application can Express
[08:30] this length in the four bytes and so the
[08:32] database will parse the same
[08:34] size but if we make it just a little bit
[08:37] larger we can see that the truncation
[08:40] happens because the most significant bit
[08:42] is not represented in the length anymore
[08:44] so the length is just four which means
[08:46] this is a tiny message and then after
[08:48] that in the connection there come some
[08:50] garbage A's that the database can't
[08:52] really understand but if the attacker
[08:54] chooses not A's but some bites that the
[08:58] database can understand they can craft
[09:00] an injected message
[09:02] here so let's zoom out again and look at
[09:05] this again this is the small message all
[09:08] is good this is the large message that
[09:11] does not cause a truncation so both the
[09:14] application and the data base see it and
[09:16] pars it the same
[09:17] way but if we make the size a little bit
[09:20] too big the application thinks it's
[09:22] writing this big number but actually
[09:25] because of the truncation bug it writes
[09:27] a small number so when the database
[09:29] pares it it sees one small message and
[09:32] then garbage or if the payload is
[09:35] cleverly crafted it sees more messages
[09:38] that can contain attacker controlled SQL
[09:40] statements like this one that adds a new
[09:42] admin
[09:44] user so the impact is quite High here um
[09:47] you can inject entire SQL statements
[09:50] you're not limited to Union based or
[09:52] subquery based SQL injection like with
[09:54] the very classic ones it's more like if
[09:56] you have stack queries enabled so you
[09:58] can just finish the first statement that
[10:01] you're injecting into and then have a
[10:03] whole another one that can be an insert
[10:05] even if the other one was a select and
[10:07] so on so this means the attacker can
[10:10] essentially read write and delete all
[10:12] the data in the database with the
[10:14] permissions of the application and if
[10:16] the database is configured insecurely
[10:18] this can already lead to code execution
[10:20] um or you just have all of the data from
[10:23] the database which is bad
[10:25] enough the only thing that's a little
[10:27] bit less convenient than with classic
[10:29] SQL injections is that data exfiltration
[10:33] is a little bit uh less straightforward
[10:36] because if you're injecting more
[10:38] messages into the connection then the
[10:40] application will still only process the
[10:42] answer for the first message so you
[10:45] don't directly get the result of your
[10:47] injected message where you maybe select
[10:49] all the password reset tokens of users
[10:52] um so you have to go uh a different
[10:54] route of maybe doing a sub cury and then
[10:56] using an insert to put this data you
[10:58] want to exfiltrate another table and
[11:00] then use business logic of the
[11:01] application to access the data so it
[11:03] still works just a little less
[11:06] convenient but how does this look in the
[11:08] real world uh some of you might have
[11:11] already noticed that if we control all
[11:13] of these A's that we have in a message
[11:15] why can't we just directly put any SQL
[11:17] statement in the first place why do we
[11:19] need to have the Overflow and you would
[11:21] be correct because this was just the
[11:24] simplification so let's look at how this
[11:26] actually looks um this is a two line
[11:29] code snippet uh the ID here is user
[11:32] controlled in this case it's a very
[11:34] small one and then we have our query you
[11:37] might recognize it from the teaser code
[11:38] snippet that uses the ID to select a
[11:41] user from the database and the resulting
[11:43] packet or message that's sent over the
[11:45] wire looks like this we have our type
[11:47] bite then a small length and then we
[11:49] have the value with a trailing null bite
[11:52] uh all is fine here but now if the
[11:54] attacker makes the user controlled ID
[11:57] very large for a gigabyte
[11:59] then suddenly the length in the packet
[12:01] is smaller than before even then even
[12:04] though we send more data so we see that
[12:06] the truncation happened and now when the
[12:09] database tries to parse this packet um
[12:11] it will see okay it's a length of 38
[12:14] bytes so I'm going to parse until that
[12:17] and after that it will try to parse the
[12:19] next message so the attacker has to put
[12:21] their cleverly crafted payLo at that
[12:23] exact offset in this big buffer of
[12:27] a but how does the attacker know this
[12:31] offset um the offset depends on the
[12:34] query that they are injecting into and
[12:37] uh especially on the injection point in
[12:38] the query and the length of the whole
[12:40] query so if you know these things you
[12:43] can just calculate the offset and you're
[12:45] done but maybe you're lazy and don't
[12:47] want to do the math or you don't know
[12:48] the query because it's kind of a
[12:50] blackbox test um so what can you do
[12:53] then and of course the naive solution is
[12:55] to Brute Force the offsets uh but
[12:58] unfortunately you for each try you have
[13:00] to send four gigabytes which is slow
[13:02] even on local setups and on like
[13:04] production setups it creates a lot of
[13:06] noise and risks Deni of service because
[13:08] it's a lot of data so can we make this
[13:11] more
[13:12] reliable and the first technique uh I
[13:15] tried out here was to borrow something
[13:17] from binary exploitation from 20 plus
[13:19] years ago which is called a knob slat
[13:22] and mapped to this problem we just use a
[13:25] lot of very small message at the
[13:27] beginning of the buffer so that when we
[13:29] hit the start of one of these messages
[13:32] uh everything's fine because the message
[13:33] is parsed and then the next one and then
[13:35] the next one and so on until at the very
[13:38] end the big message with the actual Atta
[13:41] SQL payload is poed and executed but if
[13:45] we hit any other bite um the database
[13:48] will cause a fatal error because it
[13:50] cannot par there and it will close the
[13:53] connection between the application and
[13:54] the database but usually that's not too
[13:56] bad because applications have connection
[13:58] pools and they just reopen connections
[14:01] if they get
[14:02] closed so let's visualize this this is
[14:05] the smallest possible message in the
[14:07] posterous wire protocol so we repeat
[14:09] this a lot of times and in the end we
[14:12] have our actual payload so if the offset
[14:16] happens to align with the first or the
[14:18] fifth and so on buy it then we're good
[14:21] but if it hits one of the other biets
[14:24] then there's this fatal parsing error
[14:25] and the connection is closed so if that
[14:28] happens we can try again and now we just
[14:31] prepended one petting bite and then if
[14:35] it if the offset happened to align with
[14:37] the second bite and so on then now this
[14:40] attempt would be lucky otherwise we'
[14:41] just try again and again and again until
[14:45] we're lucky at the last
[14:47] try uh so this means that after a
[14:50] maximum of five attempts uh the attack
[14:53] is successful because each try has a 20%
[14:55] chance of success and we can repeat the
[14:57] attack but still in the worst case we
[15:00] have to send 5 Time 4 GB which can still
[15:03] be a lot so maybe we can make it even
[15:06] better and for this I looked at what was
[15:09] holding us back with the last strategy
[15:12] and here it was the length bites because
[15:14] those were not valid type bites so not a
[15:16] valid start of a message so maybe we can
[15:19] make them valid type bites and I call
[15:22] this technique trampolines and what we
[15:24] do here is first we just use the Q which
[15:27] is a valid Tye bite for each bite uh
[15:30] because this is also uh some big length
[15:34] it's hex 51 51 and so on and uh we can
[15:38] see down below the whole Atta uh payload
[15:42] and uh we'll see how things are parsed
[15:45] when the offset hits certain uh certain
[15:47] bites here so if it hits the very
[15:50] beginning uh the database parles it like
[15:52] this first Q is the type bite and then
[15:55] qqqq is the length of the first message
[15:58] so the database will parse the following
[16:01] whatever qqqq means as a number bytes
[16:04] and try to run this as a query and of
[16:06] course this will cause like a semantic
[16:08] syntax error but this does not close the
[16:11] connection so the datab base will just
[16:13] complain with error response but
[16:15] continue paing the next message so this
[16:17] is like jumping over this many bytes so
[16:21] that's the trampoline right there and
[16:23] where we land after that we have a
[16:25] preconstructed message that has the
[16:27] exact size that then does another jump
[16:30] that ends up at right at the uh end of
[16:34] the attacker payload where the actual
[16:36] SQL uh statement message is so if we
[16:40] would have hit any of the other bites
[16:42] things look slightly different but not
[16:44] too different here the length is pared
[16:47] as Q SSS the S is also a very valid type
[16:51] bite uh now it jumps over some more
[16:55] bytes and it lands at a different
[16:57] preconstructed message that again has
[16:59] the exact size that it does the right
[17:01] jump to land at the
[17:04] end but does this actually work like we
[17:07] plan to do and unfortunately uh after I
[17:11] tried to implement this I noticed well
[17:13] postgress has a logical maximum message
[17:16] size next to the actual size that you
[17:19] can possibly fit into four bytes and
[17:21] this is just under 1 Gigabyte so the
[17:24] first bite of the length can never be
[17:26] larger than hex 3F so that's bad because
[17:29] with a q that doesn't
[17:31] work so what if we just use 3F as the
[17:35] type and all of the length bites then
[17:38] also doesn't work because x3f is not a
[17:40] valid type bite and also none below that
[17:44] at least not for messages from the
[17:46] application to the database um so I had
[17:49] to use a compromise here which is an
[17:50] alternating pattern and with this uh now
[17:54] every second bite is a valid type bite
[17:56] so a valid start of a message so so H we
[17:59] if we have hit any of those uh bites
[18:02] we're good because everything is pars
[18:03] okay and then we can do our trampolines
[18:05] like I just showed and if we hit any of
[18:08] the other bites like the null bite then
[18:10] we get the error and the connection is
[18:12] closed but still we can try again so
[18:14] after a maximum of two attempts we are
[18:17] successful um which is much better than
[18:20] the initial brute
[18:22] force all right let's see how many
[18:26] vulnerable libraries there were that we
[18:27] found and and this is just a selection
[18:30] we looked at more but uh these are only
[18:32] the ones that were potentially
[18:34] vulnerable so for a go we tested four
[18:37] libraries and we found all of them to be
[18:39] vulnerable and also exploitable and I'm
[18:41] going to go into exploitability in a
[18:43] minute unfortunately only one of them uh
[18:47] fixed the issues we reported and the
[18:48] others did not so they are still
[18:50] vulnerable in the latest version for C
[18:53] there was one Library we looked at it
[18:55] was vulnerable and exploitable but
[18:57] unfortunately they fix and also
[18:59] backported it to older branches of the
[19:02] library uh so that's great to see and
[19:05] then for Java and Java Script uh we
[19:08] tested a bunch of libraries and a lot of
[19:10] them were in theory vulnerable they had
[19:12] overflows without the right checks but
[19:15] they were not exploitable uh and this
[19:17] was most of the times due to language
[19:19] limitations where for example you cannot
[19:21] have large enough strings or buffers
[19:24] that would be more than 4 GB so their
[19:26] length would never overflow the 4 by
[19:28] length field and we're going to look at
[19:31] into these language differences
[19:33] later so short disclosure timeline for
[19:36] transparency we sent out the advisories
[19:38] in February this year then PGX fixed in
[19:42] March n pgsql fixed in May and for a PG
[19:45] and PG driver the maintainer first
[19:48] responded to our advisory but then
[19:50] stopped and didn't Implement fixes until
[19:52] now and for a PQ we couldn't even reach
[19:55] the maintainers we tried to do it via
[19:57] their GitHub made an issue or made a
[19:58] poll request with the fix but they got
[20:00] no attention
[20:03] unfortunately so now let's go from
[20:05] vulnerable libraries to exploitable
[20:07] Applications so first we have a set of
[20:09] applications that use these libraries or
[20:12] have used the libraries in a vulnerable
[20:13] version um and these for example include
[20:16] grafana or G or S thing but we weren't
[20:19] able to confirm if there's an
[20:21] exploitable path here so they might be
[20:23] but we haven't proven it yet and then
[20:26] there's a set of applications that we
[20:29] found to be vulnerable in a non-default
[20:31] configuration for example metam or G and
[20:35] then there was also The Sweet Spot which
[20:37] is applications that are vulnerable in
[20:39] the default config and our example here
[20:42] was Harbor and harbor is a container
[20:45] registry it's a cncf graduate project
[20:47] which means it's quite mature and people
[20:49] are using it uh it's also apparently
[20:51] part of the mare tanzu cinas but we
[20:54] don't look into more of that so we don't
[20:56] know if that's exploitable in that
[20:57] scenario as well well um but in its
[21:00] default version uh it's vulnerable in
[21:03] the default configuration and also
[21:05] pre-authentication which is quite bad so
[21:08] they fixed this in version 2.11 which is
[21:11] the latest one uh by updating their
[21:13] dependency so if you have a Harware
[21:15] instance you definitely should update to
[21:17] the latest version and I'm going to try
[21:20] to demo the Harware exploit now I'm
[21:23] going to try to do it live I also have a
[21:25] backup video um but let's see so first I
[21:29] will try to log in as the attacker to
[21:33] show that there should be no uh attacker
[21:37] user as you can see the login doesn't
[21:39] work so now if we start the exploit and
[21:43] I hope this works over the unstable
[21:46] internet um we have to wait a bit so
[21:50] there we see the query that the exploit
[21:52] is sending this is an insert query that
[21:54] will insert the attacka user into the
[21:56] database so then we could log in in and
[21:59] as we can see it's sending a lot of
[22:00] bytes 4 gigabytes so it takes some time
[22:05] um and if it's Works successfully then
[22:07] we should be able to log in and have
[22:10] administrative privileges in the Harare
[22:12] application so that we then could send
[22:15] uh or mess with the containers in there
[22:17] so we saw an error which is expected
[22:19] here so if I now try to log in
[22:23] again we should log in successfully I
[22:26] hope
[22:29] okay it doesn't seem to work I have to
[22:30] switch to the backup
[22:36] video and there on the left now we try
[22:38] to log in
[22:40] again and there we can see we can now
[22:42] log in and have admin
[22:51] privileges all right that was postgress
[22:54] now also let's look at mongodb to show
[22:56] that it's not a postgress and go only
[22:59] problem so to look back this is what a
[23:02] message in mongodb looks like we have a
[23:04] 4 by length field this time it's little
[23:06] Indian then we have two metadata fields
[23:09] that are not relevant here and then we
[23:10] have the op code which is like the
[23:12] message type and then the value is a
[23:14] complex binary structure that's called
[23:16] bon which I think stands for binary Json
[23:19] and it's some nested data uh that's
[23:21] serialized to tlv sections so they also
[23:24] have lengths
[23:25] again and to directly look at some code
[23:28] it's a little bit more but I'm going to
[23:29] walk you through it we first have uh a
[23:32] line here that takes the content bytes
[23:34] so it takes the query and puts it into
[23:36] this B Bon
[23:39] representation then it computes the
[23:41] total length of the message by adding
[23:43] the header length and all and so on and
[23:46] this is saved as a type usze variable
[23:49] again on most modern systems this is a
[23:51] 64-bit
[23:53] integer and then again this is truncated
[23:55] explicitly to an INT 32 because that
[23:58] what fits into the field so the
[24:00] developer had to cut it down here but of
[24:03] course this is the same issue as before
[24:05] if the length was larger what can than
[24:08] what can be expressed here um we have
[24:10] our truncation and things go wrong the
[24:12] exact same way as it did for post
[24:15] dress so for crafting a payload for
[24:18] mongodb it's a little bit more involved
[24:21] because we have to avoid bad bites uh
[24:23] the payload uh must be valid utf8
[24:26] because the strings are serialized as
[24:28] utf8 to the wire so we cannot create any
[24:31] byes that are invalid
[24:32] utf8 but the problem is the message type
[24:35] that we need to write in order to craft
[24:37] the right injected message is hex dd7
[24:41] and that's always invalid utf8 so how
[24:43] can we do that and also size Fields
[24:47] inside the message could become some
[24:50] bite values that would also be inv valid
[24:51] utfa so we have to be careful there as
[24:53] well and the solution was to just use
[24:56] other metadata of the message we're
[24:58] injecting into to create these bite
[25:01] values and I have an example for that so
[25:04] this is a normal mongodb query it just
[25:07] queries for a movie based on a few
[25:08] attributes and this is serialized to the
[25:11] following Bon document in the beginning
[25:14] we have in blue the length of the whole
[25:16] document then in red we have a type uh
[25:19] identifier that says the next key value
[25:21] pair has a string value then in yellow
[25:24] we have the uh key which in this case is
[25:27] title with a the trailing null bite then
[25:29] in blue again we have the length of the
[25:31] following string and then in green we
[25:34] have the actual string with a
[25:35] terminating null bite then we have the
[25:37] next key value Pairs and so on and at
[25:39] the end we have another null bite that
[25:41] shows the end of the document so if we
[25:44] want to have the hex uh sequence dd7
[25:47] anywhere in here we cannot use the
[25:49] yellow and green Parts because they have
[25:51] to be AV valid utf8 but what we can do
[25:54] is for example use the length of a
[25:56] string and just make the string the
[25:59] length that will when serialized to
[26:02] bytes will be the exact bite sequence we
[26:05] need so here we need to subtract one
[26:07] because there's a appended null bite but
[26:10] then we have the dd7 there and with this
[26:12] trick now we can craft the entire
[26:15] injected message I cannot go into all of
[26:18] this here because we don't have time but
[26:20] this is the trick you need to be able to
[26:22] do
[26:23] it so we also looked at libraries here
[26:26] and uh we found the official rust
[26:29] mongodb client library to be vulnerable
[26:31] and exploitable uh we sent out our
[26:34] advisory also in February and they fixed
[26:36] in March so if you use this especially
[26:38] if you use it in production which I
[26:40] doubt because it's rust but then you
[26:42] should update to
[26:45] 2.8.2 okay let's now take a step back uh
[26:49] we've seen all the cool bugs and the
[26:50] exploitation but is this actually
[26:53] applicable to the real world uh we've
[26:55] seen the demo but maybe this was just a
[26:57] lucky punch
[26:58] so let's talk about constraints and
[27:01] especially about the elephant in the
[27:02] room which here weighs 4 gbt because a
[27:06] lot of you probably are thinking well
[27:08] can we actually send 4 gigabytes into
[27:11] all the applications aren't apps
[27:13] limiting input sizes and you would be
[27:15] right now there's a lot of common
[27:17] protections like default body size
[27:19] limits of your favorite web framework or
[27:21] maybe Json and Forum decode maximum
[27:24] sizes or you have your reverse proxy
[27:26] that's limiting request size and and so
[27:29] on and I also encountered this and
[27:31] thought about some potential bypasses
[27:33] here so the first idea is that sometimes
[27:36] end points are just unprotected maybe
[27:39] your framework doesn't have a default
[27:40] size limit and also sometimes the
[27:43] developers explicitly disable the limits
[27:46] this was the case with Harbor for
[27:47] example they have an engine X reverse
[27:50] proxy which usually has a 1 Megabyte
[27:53] request limit but they explicitly
[27:55] disabled it I guess because they need to
[27:57] receive big docka images so they need
[27:59] more uh request size but this also meant
[28:02] that the whole API is now not limited
[28:04] anymore and the go framework that's used
[28:07] under the hood of the server did not
[28:09] limit this so we could send our big
[28:12] payload the next trick would be to use
[28:15] compression uh this on the one hand
[28:18] allows you to send your attacker payload
[28:20] much quicker because you can compress it
[28:21] down and don't have to send 4 GB over
[28:24] the internet and also there can be logic
[28:26] bucks where maybe your reverse proxy or
[28:28] your framework first checks the request
[28:31] size but does the decompression after
[28:34] that so the check is essentially useless
[28:37] because your compressed data will
[28:39] inflate a lot and you can craft a big uh
[28:43] payload that after decompression still
[28:45] causes the Overflow so for engine X for
[28:48] example this works because engine X does
[28:50] not look at the body it doesn't try to
[28:51] decompress it it just looks at the raw
[28:53] size of the request so if your back end
[28:56] does decompression then you could bypass
[28:59] this and also for example the JavaScript
[29:01] fastify framework does both checks the
[29:04] body size and also does the
[29:06] decompression but it does it in the
[29:07] wrong order so you can bypass the
[29:10] limit then you might also have
[29:12] websockets uh support on the server of
[29:15] your target uh this is cool because
[29:17] websockets also in theory uh supports
[29:19] compression it's not always enabled but
[29:22] it can help you but even without that a
[29:25] single web ciruit request can be super
[29:27] large I I think it's a 64-bit integer uh
[29:30] the size field so you can definitely
[29:33] send 4 gab messages with that and maybe
[29:36] U the middle Wares and filters that are
[29:38] present in your framework don't apply to
[29:40] each individual web circuit message so
[29:43] maybe there's no limit
[29:45] there then you could also use alternate
[29:48] body types for example a multipod form
[29:50] instead of adjacent body and maybe the
[29:53] limits are different there or the
[29:55] developer forgot to configure a limit so
[29:57] this could be another
[29:59] bypass and then this one which I like
[30:01] the most is a little bit more creative
[30:03] and open which I call server site
[30:05] creation which is you just find other
[30:07] means of bringing a big string to the
[30:10] server uh without sending it in your
[30:12] request and one example is ssrf where
[30:15] you point uh some functionality of the
[30:18] server to an attacka server which then
[30:21] returns a very large response and if
[30:23] this one gets saved into the database or
[30:25] used in a query it will also cause the
[30:27] overlow and this for example worked in
[30:30] Gog where you have a web hooks feature
[30:33] uh but beyond the ssrf you might also
[30:35] have templating or a translation that
[30:37] you could use to inflate a string and
[30:40] this all depends on the business logic
[30:42] and the features of the server so that's
[30:44] where you can get creative to find
[30:47] bypasses all right now that we've seen
[30:49] how we might bypass limitations of
[30:51] Frameworks and servers we also need to
[30:53] look at languages we already seen some
[30:56] differences at the vulnerable Library
[30:58] so we need to see how well languages
[31:01] handle large payloads like how big can
[31:03] strings and buffers be and also what
[31:05] about integer overflows does every
[31:07] language have silent integer overflows
[31:09] or maybe some languages are
[31:11] safe so for the large payloads we can
[31:14] see that go Python and rust out of the
[31:17] languages we we looked at uh have large
[31:20] enough string and buffer sizes that uh
[31:22] you can send for gigabytes and they can
[31:24] handle it for Java uh you're out of luck
[31:27] and we also saw See the s seen this with
[31:31] uh unexploitable libraries in Java and
[31:34] that's because uh strings and buffers
[31:36] here are backed by arrays which have
[31:38] integer indexes so you cannot index more
[31:43] than I think yeah two to the power 31
[31:45] here for C the string size is not big
[31:49] enough but the buffer size is so if you
[31:52] have uh multiple strings that you
[31:54] control then you can still end up with a
[31:56] buffer that becomes bigger than than 4
[31:58] GB and for JavaScript it totally depends
[32:01] on the implementation for node strings
[32:04] are much smaller compared to the other
[32:05] languages but buffers can be large
[32:09] enough for integer overflows we can see
[32:12] that uh for addition overflows which
[32:15] just means you add two integers um we
[32:18] can see that in go Java and C CP a
[32:21] silent integer overflow happens so it
[32:23] will just wrap around for JavaScript uh
[32:26] there will be no overflow things will
[32:28] just get more inaccurate because it's
[32:30] JavaScript and they use floats under the
[32:33] hood and in Python you have arbitrarily
[32:35] sized integers so you cannot overflow
[32:39] that and in Rust it depends on how you
[32:41] build your project if you build it in
[32:43] debug mode the compiler will emit a
[32:46] check that checks for overflows but in a
[32:48] release build it will not do
[32:51] that and for serialization overflows
[32:54] which uh basically is the case when you
[32:56] have a standard function in your
[32:58] language that allows you to write a
[33:01] integer to a fixed size field um does
[33:04] this function check for overflows or not
[33:07] and in all of the type save languages
[33:08] this does not does not apply because the
[33:10] types that the function can receive uh
[33:13] cannot overflow uh the size field or the
[33:17] the field that it gets serialized to uh
[33:19] but this this just means that the
[33:21] developers now have to do the check
[33:22] before casting to this type and we've
[33:25] seen that this leads to bugs in uh our
[33:27] go and rust examples in JavaScript it's
[33:30] again Implement implementation dependent
[33:33] uh I think in no JS it does the check
[33:35] but in bun or Dino it might not do it
[33:38] and in Python the struck. pack function
[33:42] actually does a check if you pass it too
[33:44] large integer it will throw an error if
[33:46] you try to serialize it to a twoo small
[33:49] field so to summarize the real world
[33:52] applicability we can say that in a lot
[33:55] of times we can send large payloads past
[33:57] Li uh the
[33:59] limits um for silent inter integer
[34:02] overflows or truncations uh we also seen
[34:05] that in many languages it works or the
[34:07] developers do the mistake for the
[34:09] language and we also seen that you can
[34:12] definitely exploit some real world
[34:13] applications with
[34:16] this all right now let's look at what is
[34:20] there more to do in this kind of
[34:22] research for binary protocol
[34:24] smuggling but first I have to give a
[34:26] small disclaimer here please don't go
[34:29] out and send 4 GB to every API endpoint
[34:32] in your buck Bounty scope because you
[34:34] will crash systems you will get blocked
[34:36] and you will ruin a devops engineer day
[34:38] because they have to look at the
[34:40] monitoring alert so don't do it
[34:43] please um but speaking of this it would
[34:47] be cool to actually have a non-invasive
[34:49] detection mechanism uh in whitebox test
[34:51] it's okay you can make your local
[34:53] testing environment and just hammer it
[34:55] with gigabytes of data but of course in
[34:57] Black box tests that doesn't work so if
[35:00] we could find a methodology to find for
[35:03] example a fingerprint of a database
[35:05] client lbrary being used and we would
[35:07] know that this library is vulnerable to
[35:09] these kind of texts then we could either
[35:11] directly report it or only do the large
[35:14] payload then and if would this would be
[35:17] a tool it would be great uh to Aid you
[35:19] in in pentests and so
[35:22] on and of course uh it would be awesome
[35:25] to research a lot of more stuff uh more
[35:28] protocols like there's more databases
[35:30] than we stuff than the stuff we looked
[35:31] at today and there's all of the other
[35:33] systems caches message cues and so on
[35:36] that the application has to talk to we
[35:39] can also try to find more DN techniques
[35:41] for example look into protocols that use
[35:43] the limiters and not size fields and we
[35:46] can also find more large payload message
[35:49] which is uh ways to bypass the filters
[35:52] of a framework for example to bypass the
[35:55] request size limits uh or maybe we can
[35:58] find generic ways of making a server
[36:01] craft a very large string um maybe
[36:04] there's some way to do
[36:06] this and of course all of the stuff we
[36:09] looked at today had four byte length
[36:11] Fields but what about 2 byte length
[36:14] Fields this would be much easier to
[36:16] exploit sending 65 kiloby instead of 4
[36:19] gab uh is much easier you don't have the
[36:23] hustle with all the uh limitations and I
[36:26] already already started to look into
[36:28] this a little bit so uh stay tuned for
[36:30] more to come in the future but feel free
[36:32] to also go out and check this
[36:36] yourself so let's wrap things up uh I
[36:40] have a few takeaways and the first one
[36:42] is that I think integer overflows are
[36:44] still relevant in memory safe languages
[36:47] of course in C if you have an integer
[36:49] overflow uh it's easily easy to get some
[36:52] memory corruption with it so uh that's
[36:55] done but in memory safe languages um the
[36:58] worst case that can happen is a array
[37:00] out of bounds or whatever but with these
[37:03] data attacks uh in the uh binary
[37:05] protocols that we've seen today uh now
[37:08] we have a new way of exploiting these
[37:09] and I think developers kind of forgot
[37:12] about integer overflows and maybe
[37:14] researches as well at least in the
[37:16] memory safe
[37:17] languages then we also seen that uh it's
[37:20] entirely feasible to send large amounts
[37:22] of data even with uh protections because
[37:25] there's many ways how you can buy bypass
[37:27] these protections and finally to get
[37:30] back to the title SQL injection isn't
[37:33] dead of course it was never dead at Le
[37:36] at least not in the real world we've
[37:38] seen a lot of uh real world applications
[37:40] uh with SQL injections but on paper you
[37:43] could say uh developers have the right
[37:46] tools to write secure SQL based
[37:49] applications they have parameterized
[37:51] queries they have query Builders they
[37:54] have orm so if they use all of this and
[37:57] the ation is safe so if you can't hack
[38:00] it you just have to go a level
[38:02] deeper thank you
[38:04] [Applause]

=== Content from avatars.githubusercontent.com_01d86c9d_20250115_182124.html ===
ï¿½PNG

   
IHDR   (   (   ï¿½/:   EIDATxï¿½ï¿½W]sï¿½ï¿½ï¿½\_iWï¿½dKï¿½ï¿½%vã„„Lhï¿½ï¿½Nï¿½gfï¿½ï¿½pï¿½ï¿½nï¿½Ã;`ï¿½0ï¿½ï¿½ï¿½ï¿½ï¿½EKï¿½ï¿½ï¿½Þ”cï¿½Iï¿½ï¿½ï¿½7Ù²eï¿½kï¿½Lï¿½ ï¿½ï¿½<ï¿½ï¿½fï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Eï¿½ï¿½ï¿½s\ï¿½ï¿½ï¿½Kkf"ï¿½Mï¿½Cï¿½0Oï¿½Wï¿½ï¿½ï¿½5ï¿½ï¿½8ï¿½kï¿½ï¿½Ô¿ï¿½ï¿½w:ï¿½ï¿½ï¿½Sï¿½0ï¿½DEQUUEAbï¿½Xï¿½{jPï¿½ï¿½ï¿½ï¿½S(ï¿½ï¿½ t]ï¿½ï¿½ï¿½O?ï¿½dï¿½6Õ”ï¿½ï¿½766t]ï¿½zï¿½ï¿½ï¿½ ï¿½ï¿½ï¿½Ê¢ï¿½ï¿½,ï¿½ï¿½X5Mï¿½ï¿½ï¿½mï¿½ï¿½KKK ï¿½fï¿½ï¿½iï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Í“ï¿½ï¿½Jï¿½ï¿½ï¿½eï¿½ï¿½6ï¿½ï¿½ï¿½ ï¿½Vï¿½}ï¿½ï¿½ï¿½ï¿½ï¿½Ø¶Mï¿½ï¿½rkkk{{{ï¿½ï¿½=~ï¿½Bhï¿½ï¿½`0ï¿½ï¿½ï¿½\\\ï¿½yï¿½uÝ¿ï¿½2ï¿½ï¿½ï¿½5ï¿½lï¿½ï¿½\_}ï¿½ï¿½ï¿½iï¿½Hï¿½ï¿½0ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ad2ï¿½ï¿½ï¿½ï¿½ï¿½p(ï¿½ï¿½mÛNï¿½^ï¿½\_ï¿½~ï¿½ï¿½ï¿½Ù ï¿½eï¿½&Ìµï¿½ï¿½ï¿½ï¿½nï¿½F#ï¿½#ï¿½Lï¿½'ï¿½ï¿½fsï¿½ï¿½ï¿½(cAXï¿½ï¿½,k0Ü¿ï¿½ï¿½7ï¿½ï¿½fï¿½ï¿½Yï¿½ï¿½ï¿½Õ³ï¿½}ï¿½ï¿½ï¿½!ï¿½Ø¶mï¿½aï¿½ï¿½ï¿½Õ«Wï¿½ï¿½ï¿½Sï¿½T"ï¿½ï¿½fï¿½ï¿½("ï¿½Aï¿½ï¿½cï¿½=zï¿½ï¿½ï¿½U,ï¿½z0ï¿½yï¿½eaLyï¿½ï¿½ï¿½ï¿½<ï¿½ï¿½W\*ï¿½ï¿½ï¿½ï¿½bï¿½ï¿½Nï¿½eYï¿½8cï¿½ &ï¿½\|ï¿½Ç·ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½wï¿½jï¿½ï¿½
ï¿½
ï¿½>ï¿½;kï¿½ï¿½xï¿½ï¿½ï¿½ï¿½ï¿½CË²rï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½B\*ï¿½ï¿½'9C/ï¿½\ï¿½ï¿½ï¿½ï¿½tï¿½ï¿½Eï¿½,ï¿½ï¿½ï¿½à£>zï¿½ï¿½ï¿½Tï¿½Fï¿½ggï¿½J-h4ï¿½ï¿½QWï¿½ï¿½ï¿½$ï¿½IQ!ï¿½ ï¿½ï¿½Cï¿½E}Ä²ï¿½ï¿½ï¿½zï¿½\ï¿½ï¿½rAï¿½ï¿½ï›¦9ï¿½\*4eï¿½bBHï¿½i"ï¿½0Æ’$e2ï¿½Ë²VcB×®ï¿½A%ï¿½aï¿½T\*uï¿½Æk×®ï¿½ï¿½ï¿½l6ï¿½ï¿½ï¿½=Ï›ï¿½ï¿½ï¿½ï¿½ï¿½,ï¿½ï¿½j5ï¿½ï¿½ï¿½Iï¿½ï¿½bï¿½>Æ‹ï¿½HCï¿½qï¿½ ï¿½ï¿½,ï¿½Jï¿½drii !ï¿½ï¿½vï¿½ï¿½Fï¿½
MQOï¿½Aï¿½ï¿½Ë²ï¿½(ï¿½!,ï¿½qï¿½ï¿½ï¿½!ï¿½ï¿½yï¿½0Bï¿½aXï¿½UUï¿½X,zï¿½gï¿½6-)sUï¿½ï¿½ï¿½.Kï¿½ï¿½oï¿½ï¿½ï¿½ï¿½ï¿½Nï¿½Cq]ï¿½ï¿½é˜¦ï¿½iï¿½ï¿½(ï¿½ï¿½ï¿½
ï¿½ï¿½ ï¿½Fï¿½ï¿½eYï¿½X,V\*UUAH&ï¿½ï¿½L&#ï¿½ï¿½ï¿½"Jï¿½\ÃŒï¿½cEQï¿½ï¿½t]ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½RNuï¿½Kï¿½gï¿½ï¿½(ï¿½wï¿½}ï¿½Rï¿½1ï¿½ï¿½m#ï¿½6662ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½\.Wï¿½T4Mï¿½ï¿½ï¿½ï¿½{ï¿½ï¿½ï¿½  ï¿½H$ï¿½Iï¿½9Çï¿½Ç­VKEï¿½ï¿½ï¿½xï¿½ï¿½Aï¿½ï¿½d'ï¿½Sï¿½5ï¿½{:ï¿½ï¿½ï¿½ï¿½iï¿½ï¿½ï¿½ï¿½ï¿½ï¿½qï¿½XLï¿½å““ï¿½fï¿½Y(ï¿½Ü¹&Ï;wï¿½ï¿½  xï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½\_ï¿½ï¿½ï¿½ï¿½ï¿½rï¿½<Ï¥<ï¿½~}xxï¿½é§Ÿjï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½>ï¿½paa!ï¿½NW\*ï¿½ï¿½`Pï¿½VUU]\\ï¿½ï¿½b  EQhTï¿½ï¿½ï¿½ï¿½Qï¿½Vkï¿½Ú½{ï¿½>ï¿½ï¿½Ãï¿½ï¿½ï¿½ï¿½ï¿½ï¿½sï¿½Kï¿½ï¿½O>ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½vï¿½ï¿½ï¿½ï¿½ï¿½y^ï¿½å……ï¿½Rï¿½!ï¿½eï¿½RGï¿½Sï¿½zZRï¿½ï¿½ï¿½Zï¿½6ï¿½ï¿½ï¿½&ï¿½ï¿½ï¿½ï¿½4!ï¿½tï¿½ ï¿½ï¿½ï¿½Ï®ï¿½ï¿½ï¿½1ï¿½eï¿½X,.--)ï¿½B"ï¿½ï¿½ï¿½;-ï¿½ï¿½ï¿½ï¿½
Ã˜ï¿½Ç—,ï¿½ï¿½\_ï¿½ï¿½9ï¿½~ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½aï¿½ï¿½Ù¶
!ï¿½$ï¿½ï¿½:-aï¿½ï¿½+Wï¿½lllï¿½ï¿½ï¿½uï¿½ï¿½ï¿½ï¿½Ù³gï¿½1!ï¿½ï¿½ï¿½\* ï¿½qï¿½ï¿½&Zï¿½<ï¿½ï¿½4ï¿½ï¿½lï¿½ï¿½cï¿½u}ß§Zï¿½Dè½’$ï¿½qï¿½ï¿½Mï¿½clYÖƒ,Ëšï¿½ï¿½rï¿½ï¿½ï¿½Iï¿½.<ï¿½ï¿½ï¿½ï¿½B]ï¿½ï¿½ï¿½vï¿½×³,ï¿½ï¿½<ï¿½q|ï¿½gï¿½k×®ï¿½z=ï¿½ï¿½ï¿½ï¿½\*ï¿½ï¿½ï¿½zï¿½ï¿½ï¿½ï¿½|ï¿½ï¿½Úšï¿½ï¿½ifXï¿½ï¿½}ï¿½ï¿½ï¿½DLï¿½l4ï¿½ï¿½!ï¿½Wï¿½VÚ§ï¿½ï¿½nï¿½Pï¿½8ï¿½nï¿½ï¿½ï¿½`ï¿½2gï¿½
ï¿½|:D;Ë²ï¿½ï¿½ï¿½ï¿½}Yï¿½EQLï¿½Rï¿½e2Aï¿½RJï¿½ï¿½eY!ï¿½4Yï¿½Eï¿½ï¿½Iï¿½cNï¿½" |ï¿½Í¿ï¿½ï¿½ï¿½hï¿½ï¿½ï¿½Bï¿½ï¿½ERï¿½xA.gï¿½ï¿½tï¿½!ï¿½yï¿½}ï¿½Zï¿½m{ï¿½ï¿½ï¿½ï¿½%Irï¿½&1ï¿½sï¿½ï¿½wï¿½Gï¿½ï¿½>ï¿½Bï¿½~ï¿½ï¿½ qT1d!ï¿½G
cï¿½ï¿½ï¿½ï¿½Ý»ï¿½ï¿½4ï¿½0ï¿½ï¿½ï¿½ï¿½Dï¿½ï¿½ï¿½ ï¿½Jï¿½ï¿½ï¿½Ã¿ï¿½Nhï¿½dEQ|ß·mï¿½ï¿½hï¿½r95ï¿½ï¿½yï¿½2`ï¿½N:1ï¿½0ï¿½ï¿½~ï¿½å—£Ñˆï¿½ï¿½ï¿½ ï¿½fï¿½ï¿½nï¿½fYï¿½qï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½>}ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½hDï¿½
ï¿½ï¿½&R&ï¿½ ï¿½ï¿½ï¿½ï¿½xï¿½bï¿½RI%ï¿½4[&=ï¿½ ï¿½ï¿½ï¿½Zï¿½ï¿½ï¿½çŽï¿½ï¿½ï¿½&!Dï¿½ï¿½ï¿½ï¿½ï¿½ï¿½e]ï¿½ï¿½ï¿½~<ï¿½eï¿½"ï¿½ï¿½ï¿½Ý»wï¿½ï¿½ï¿½eYï¿½ï¿½ï¿½ï¿½Sï¿½ï¿½ï¿½Oï¿½ï¿½T\*!ï¿½Vï¿½ï¿½ï¿½ï¿½ï¿½Iï¿½^Dï¿½ï¿½ï¿½ï¿½>|ï¿½ï¿½ï¿½,ï¿½Jï¿½VB8ï¿½t]ï¿½d2ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½;ï¿½ï¿½ï¿½Kï¿½ï¿½ï¿½7ï¿½ï¿½4ï¿½>ï¿½ï¿½ï¿½^{ï¿½ï¿½hï¿½Uï¿½qï¿½uï¿½ï¿½ï¿½bï¿½ã¸·ï¿½zï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½?88(ï¿½Ë™Lï¿½ï¿½oï¿½ï¿½ï¿½yï¿½ï¿½Y^^.
ï¿½=ï¿½yc\\*ï¿½nÝºï¿½ucï¿½ï¿½ï¿½ï¿½ï¿½|&Iï¿½|ï¿½ï¿½ï¿½Ç¹rï¿½ï¿½  ï¿½ï¿½:ï¿½cï¿½ï¿½    IENDï¿½B`ï¿½

=== Content from github.com_50997669_20250115_175842.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjackc%2Fpgx%2Fcommit%2Ff94eb0e2f96782042c96801b5ac448f44f0a81df)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjackc%2Fpgx%2Fcommit%2Ff94eb0e2f96782042c96801b5ac448f44f0a81df)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=jackc%2Fpgx)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[jackc](/jackc)
/
**[pgx](/jackc/pgx)**
Public

* [Notifications](/login?return_to=%2Fjackc%2Fpgx) You must be signed in to change notification settings
* [Fork
  867](/login?return_to=%2Fjackc%2Fpgx)
* [Star
   11.1k](/login?return_to=%2Fjackc%2Fpgx)

* [Code](/jackc/pgx)
* [Issues
  201](/jackc/pgx/issues)
* [Pull requests
  21](/jackc/pgx/pulls)
* [Discussions](/jackc/pgx/discussions)
* [Actions](/jackc/pgx/actions)
* [Projects
  0](/jackc/pgx/projects)
* [Wiki](/jackc/pgx/wiki)
* [Security](/jackc/pgx/security)
* [Insights](/jackc/pgx/pulse)

Additional navigation options

* [Code](/jackc/pgx)
* [Issues](/jackc/pgx/issues)
* [Pull requests](/jackc/pgx/pulls)
* [Discussions](/jackc/pgx/discussions)
* [Actions](/jackc/pgx/actions)
* [Projects](/jackc/pgx/projects)
* [Wiki](/jackc/pgx/wiki)
* [Security](/jackc/pgx/security)
* [Insights](/jackc/pgx/pulse)

## Commit

[Permalink](/jackc/pgx/commit/f94eb0e2f96782042c96801b5ac448f44f0a81df)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Always wrap arguments in parentheses in the SQL sanitizer

[Browse files](/jackc/pgx/tree/f94eb0e2f96782042c96801b5ac448f44f0a81df)
Browse the repository at this point in the history

* Loading branch information

[![@jackc](https://avatars.githubusercontent.com/u/94130?s=40&v=4)](/jackc)

[jackc](/jackc/pgx/commits?author=jackc "View all commits by jackc")
committed
Mar 4, 2024

1 parent
[826a892](/jackc/pgx/commit/826a89229b8b1cdf18e4190afa437d3df9901b9c)

commit f94eb0e

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**14 additions**
and
**20 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* internal/sanitize

  + internal/sanitize/sanitize.go
    [sanitize.go](#diff-65a99c1d9a3b358d8aebc18eb1f6d77c6142f66cdb2f330b66577681b38365ff)
  + internal/sanitize/sanitize\_test.go
    [sanitize\_test.go](#diff-d2b05d2f489d1b754d3334b5f7b79670af519f89c1c3518b107860d79cd4e8ac)

## There are no files selected for viewing

14 changes: 4 additions & 10 deletions

14
[internal/sanitize/sanitize.go](#diff-65a99c1d9a3b358d8aebc18eb1f6d77c6142f66cdb2f330b66577681b38365ff "internal/sanitize/sanitize.go")

Show comments

[View file](/jackc/pgx/blob/f94eb0e2f96782042c96801b5ac448f44f0a81df/internal/sanitize/sanitize.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -44,18 +44,8 @@ func (q \*Query) Sanitize(args ...interface{}) (string, error) { |
|  |  | str = "null" |
|  |  | case int64: |
|  |  | str = strconv.FormatInt(arg, 10) |
|  |  | // Prevent SQL injection via Line Comment Creation |
|  |  | // https://github.com/jackc/pgx/security/advisories/GHSA-m7wr-2xf7-cm9p |
|  |  | if arg < 0 { |
|  |  | str = "(" + str + ")" |
|  |  | } |
|  |  | case float64: |
|  |  | // Prevent SQL injection via Line Comment Creation |
|  |  | // https://github.com/jackc/pgx/security/advisories/GHSA-m7wr-2xf7-cm9p |
|  |  | str = strconv.FormatFloat(arg, 'f', -1, 64) |
|  |  | if arg < 0 { |
|  |  | str = "(" + str + ")" |
|  |  | } |
|  |  | case bool: |
|  |  | str = strconv.FormatBool(arg) |
|  |  | case []byte: |
| Expand All | | @@ -68,6 +58,10 @@ func (q \*Query) Sanitize(args ...interface{}) (string, error) { |
|  |  | return "", fmt.Errorf("invalid arg type: %T", arg) |
|  |  | } |
|  |  | argUse[argIdx] = true |
|  |  |  |
|  |  | // Prevent SQL injection via Line Comment Creation |
|  |  | // https://github.com/jackc/pgx/security/advisories/GHSA-m7wr-2xf7-cm9p |
|  |  | str = "(" + str + ")" |
|  |  | default: |
|  |  | return "", fmt.Errorf("invalid Part type: %T", part) |
|  |  | } |
| Expand Down | |  |

20 changes: 10 additions & 10 deletions

20
[internal/sanitize/sanitize\_test.go](#diff-d2b05d2f489d1b754d3334b5f7b79670af519f89c1c3518b107860d79cd4e8ac "internal/sanitize/sanitize_test.go")

Show comments

[View file](/jackc/pgx/blob/f94eb0e2f96782042c96801b5ac448f44f0a81df/internal/sanitize/sanitize_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -127,52 +127,52 @@ func TestQuerySanitize(t \*testing.T) { |
|  |  | { |
|  |  | query: sanitize.Query{Parts: []sanitize.Part{"select 42"}}, |
|  |  | args: []interface{}{}, |
|  |  | expected: `select 42`, |
|  |  | expected: `select (42)`, |
|  |  | }, |
|  |  | { |
|  |  | query: sanitize.Query{Parts: []sanitize.Part{"select ", 1}}, |
|  |  | args: []interface{}{int64(42)}, |
|  |  | expected: `select 42`, |
|  |  | expected: `select (42)`, |
|  |  | }, |
|  |  | { |
|  |  | query: sanitize.Query{Parts: []sanitize.Part{"select ", 1}}, |
|  |  | args: []interface{}{float64(1.23)}, |
|  |  | expected: `select 1.23`, |
|  |  | expected: `select (1.23)`, |
|  |  | }, |
|  |  | { |
|  |  | query: sanitize.Query{Parts: []sanitize.Part{"select ", 1}}, |
|  |  | args: []interface{}{true}, |
|  |  | expected: `select true`, |
|  |  | expected: `select (true)`, |
|  |  | }, |
|  |  | { |
|  |  | query: sanitize.Query{Parts: []sanitize.Part{"select ", 1}}, |
|  |  | args: []interface{}{[]byte{0, 1, 2, 3, 255}}, |
|  |  | expected: `select '\x00010203ff'`, |
|  |  | expected: `select ('\x00010203ff')`, |
|  |  | }, |
|  |  | { |
|  |  | query: sanitize.Query{Parts: []sanitize.Part{"select ", 1}}, |
|  |  | args: []interface{}{nil}, |
|  |  | expected: `select null`, |
|  |  | expected: `select (null)`, |
|  |  | }, |
|  |  | { |
|  |  | query: sanitize.Query{Parts: []sanitize.Part{"select ", 1}}, |
|  |  | args: []interface{}{"foobar"}, |
|  |  | expected: `select 'foobar'`, |
|  |  | expected: `select ('foobar')`, |
|  |  | }, |
|  |  | { |
|  |  | query: sanitize.Query{Parts: []sanitize.Part{"select ", 1}}, |
|  |  | args: []interface{}{"foo'bar"}, |
|  |  | expected: `select 'foo''bar'`, |
|  |  | expected: `select ('foo''bar')`, |
|  |  | }, |
|  |  | { |
|  |  | query: sanitize.Query{Parts: []sanitize.Part{"select ", 1}}, |
|  |  | args: []interface{}{`foo\'bar`}, |
|  |  | expected: `select 'foo\''bar'`, |
|  |  | expected: `select ('foo\''bar')`, |
|  |  | }, |
|  |  | { |
|  |  | query: sanitize.Query{Parts: []sanitize.Part{"insert ", 1}}, |
|  |  | args: []interface{}{time.Date(2020, time.March, 1, 23, 59, 59, 999999999, time.UTC)}, |
|  |  | expected: `insert '2020-03-01 23:59:59.999999Z'`, |
|  |  | expected: `insert ('2020-03-01 23:59:59.999999Z')`, |
|  |  | }, |
|  |  | { |
|  |  | query: sanitize.Query{Parts: []sanitize.Part{"select 1-", 1}}, |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `f94eb0e`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjackc%2Fpgx%2Fcommit%2Ff94eb0e2f96782042c96801b5ac448f44f0a81df) to comment.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from github.com_fa169832_20250115_175838.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjackc%2Fpgproto3%2Fcommit%2F945c2126f6db8f3bea7eeebe307c01fe92bca007)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjackc%2Fpgproto3%2Fcommit%2F945c2126f6db8f3bea7eeebe307c01fe92bca007)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=jackc%2Fpgproto3)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[jackc](/jackc)
/
**[pgproto3](/jackc/pgproto3)**
Public

* [Notifications](/login?return_to=%2Fjackc%2Fpgproto3) You must be signed in to change notification settings
* [Fork
  44](/login?return_to=%2Fjackc%2Fpgproto3)
* [Star
   166](/login?return_to=%2Fjackc%2Fpgproto3)

* [Code](/jackc/pgproto3)
* [Issues
  3](/jackc/pgproto3/issues)
* [Pull requests
  0](/jackc/pgproto3/pulls)
* [Actions](/jackc/pgproto3/actions)
* [Projects
  0](/jackc/pgproto3/projects)
* [Security](/jackc/pgproto3/security)
* [Insights](/jackc/pgproto3/pulse)

Additional navigation options

* [Code](/jackc/pgproto3)
* [Issues](/jackc/pgproto3/issues)
* [Pull requests](/jackc/pgproto3/pulls)
* [Actions](/jackc/pgproto3/actions)
* [Projects](/jackc/pgproto3/projects)
* [Security](/jackc/pgproto3/security)
* [Insights](/jackc/pgproto3/pulse)

## Commit

[Permalink](/jackc/pgproto3/commit/945c2126f6db8f3bea7eeebe307c01fe92bca007)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Backport fixes from pgx v5

[Browse files](/jackc/pgproto3/tree/945c2126f6db8f3bea7eeebe307c01fe92bca007)
Browse the repository at this point in the history

```
Check for overflow on uint16 sizes in pgproto3

Do not allow protocol messages larger than ~1GB

The PostgreSQL server will reject messages greater than ~1 GB anyway.
However, worse than that is that a message that is larger than 4 GB
could wrap the 32-bit integer message size and be interpreted by the
server as multiple messages. This could allow a malicious client to
inject arbitrary protocol messages.

[GHSA-mrww-27vc-gghv](https://github.com/jackc/pgx/security/advisories/GHSA-mrww-27vc-gghv "GHSA-mrww-27vc-gghv")
```

* Loading branch information

[![@jackc](https://avatars.githubusercontent.com/u/94130?s=40&v=4)](/jackc)

[jackc](/jackc/pgproto3/commits?author=jackc "View all commits by jackc")
committed
Mar 4, 2024

1 parent
[0c0f7b0](/jackc/pgproto3/commit/0c0f7b03fb4967dfff8de06d07a9fe20baf83449)

commit 945c212

 Show file tree

 Hide file tree

Showing
**59 changed files**
with
**359 additions**
and
**359 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* authentication\_cleartext\_password.go
  [authentication\_cleartext\_password.go](#diff-3ffeff3af747d27dcd0078fdf01cb0f5bfd8a9bb43ebbb8585f52cf0408071ae)
* authentication\_gss.go
  [authentication\_gss.go](#diff-6fda8d8234ca762183612f92c8f2ace0337c5a4ec5f666d610d9c3dc776144a5)
* authentication\_gss\_continue.go
  [authentication\_gss\_continue.go](#diff-30c7a76c5b592780e9b06d085728084998b3378d448eecf257c32d75f437ebfa)
* authentication\_md5\_password.go
  [authentication\_md5\_password.go](#diff-b08605904bf9946d997c0cf2e0a5fd67993082adc964947f79534f418c35b00d)
* authentication\_ok.go
  [authentication\_ok.go](#diff-8ec54088fb5dbc89708898d3821279fafa3d4838b5fc2c6cd1efa657abae5bf9)
* authentication\_sasl.go
  [authentication\_sasl.go](#diff-0633743faa1735d86e068fc66089aeadd7a3c3adb557611b7f18216a6a9e1943)
* authentication\_sasl\_continue.go
  [authentication\_sasl\_continue.go](#diff-b8034d8958143ac180dcbe48049aa5ffe0c77a86571af65d3a45353404c7d1d7)
* authentication\_sasl\_final.go
  [authentication\_sasl\_final.go](#diff-8ee981dbe9f1142c8fcf494388023501a5e938860711dc4c0b9e0e4aabaf4695)
* backend.go
  [backend.go](#diff-f7febf2126e4c13f0730b2d06b8a6d3bdcb748f6379770c478888c2e4ea1949e)
* backend\_key\_data.go
  [backend\_key\_data.go](#diff-e3cc188cb666e9fc818db39fa186a51f7cd690937f452fd44c816d1a500c1b6c)
* backend\_test.go
  [backend\_test.go](#diff-948240fcba2ce7149ab3368fce810af3577a17af881a6668936de8190d95acf3)
* bind.go
  [bind.go](#diff-aade326d3512b5a2ada6faa791ddec468f2a0adedb352339c9e314e74c8949d2)
* bind\_complete.go
  [bind\_complete.go](#diff-377c23e59c8a83818e891ed3cdd3e86fd5dee714f9727a96ba92ad2cb9de1e1d)
* bind\_test.go
  [bind\_test.go](#diff-00ddec41d7347850f21b9acaeecd783b25cd152e45f033b31d34775ea7c69052)
* cancel\_request.go
  [cancel\_request.go](#diff-1bfb818b937e3855172bab35f709b3768d8f3213623c7a758c96bf282568e1d8)
* close.go
  [close.go](#diff-e388b94dc680f496cb6026bdaecce464a253c5a9802871e472dcc78f98d5a549)
* close\_complete.go
  [close\_complete.go](#diff-ac53bd32c9d4d978b4d907b847c9979545cd27dfd63a2103148e35b2649621e0)
* command\_complete.go
  [command\_complete.go](#diff-8625e100b2a22b38f09895a37002bda8685a4d880fc0cc33b3e97011f6e0ba08)
* copy\_both\_response.go
  [copy\_both\_response.go](#diff-d34860ee739557fae3e1f70854972df4191c841d4cfaa0bf3431a25005ec50eb)
* copy\_both\_response\_test.go
  [copy\_both\_response\_test.go](#diff-84cb9ff7b9638a09470b6c28d2faa937e3176fa0c45e7247651f53301932c917)
* copy\_data.go
  [copy\_data.go](#diff-2a22440ae83f9e1e518b658fbaed6ca72b6abc68392de0eeb07a7b96cf562fd4)
* copy\_done.go
  [copy\_done.go](#diff-5b5596f794df18deb6563fa238399186e845a2fea155f93805026bb63e5b16f6)
* copy\_fail.go
  [copy\_fail.go](#diff-6afc83ea63bc4bc0be640f20f87e2b68391dcb5208d5a829c5d226d9b22e2818)
* copy\_in\_response.go
  [copy\_in\_response.go](#diff-d4d99b220cf1fc4eed0c31d8946cbb556607e284c51987b6a2084d54f7d7358b)
* copy\_out\_response.go
  [copy\_out\_response.go](#diff-b20f6adc29baf882d94ffdd334590dd3904dea4f2b072d989a628f5bbd77793d)
* data\_row.go
  [data\_row.go](#diff-d3a5bf6f86be9798e532e1f0d89775adc1abcda4e071397e7c51188a47cd9913)
* describe.go
  [describe.go](#diff-41208779b1f270f25f5e0873ec3956237dac83e7b5cb5e051a3c1a9d677c3fff)
* empty\_query\_response.go
  [empty\_query\_response.go](#diff-b006f148e2afc584bf9484f6862cd4822952ba8d9ccf967283a9b2b10ca375cc)
* error\_response.go
  [error\_response.go](#diff-07e07fc7de99af43be5b3ab64b820eaab97baa1d88635f938358c4b8a4984876)
* example/pgfortune

  + example/pgfortune/server.go
    [server.go](#diff-181f79167c6470e6cdbd4399cd4b9378861644e6ae4d68bfd1bae8a50d1a3183)
* execute.go
  [execute.go](#diff-5ea248285d6f827851f0ddbaaec23a72d15effc59ad4b825263b31fb836db5cd)
* flush.go
  [flush.go](#diff-fb68754d649a1b4f552423fa95e573f691e846d50c4d56fd0186889a95cb1753)
* frontend.go
  [frontend.go](#diff-2672f514c405d5e00230c62d044bd4e5b3a70ea6e8e8cf9a68fc4e42e043f65a)
* function\_call.go
  [function\_call.go](#diff-be93b5e2b3f841c8103c395cef31283c7f637a712991735827276fac0334fce9)
* function\_call\_response.go
  [function\_call\_response.go](#diff-189e62ae1e50ebe38c4ec7f878e1d20e44aab63eb913dd4af0b82bbea176e4f8)
* function\_call\_test.go
  [function\_call\_test.go](#diff-f19f9cf51ac5ff2d3e2a6bc2567d61540c459923aa2a3244eb3d34f1c8f42f3a)
* gss\_enc\_request.go
  [gss\_enc\_request.go](#diff-06b61fe8adedba5b87b810fe4de5404f8100a5a1932fcfed3222f6e50b8ad0c9)
* gss\_response.go
  [gss\_response.go](#diff-e4a24a8a7a2a3282e5fa26495ee968b4c6bb583467120d1894538d610b4f5dbc)
* no\_data.go
  [no\_data.go](#diff-cfe980f42eec9d36798a6f209f63e761a7493d256ea10449eb75b660d5029ace)
* notice\_response.go
  [notice\_response.go](#diff-4bb119aefde9a2472f8d23d09e22f6881ca227ae28450811a0a2a2bfe61644fb)
* notification\_response.go
  [notification\_response.go](#diff-dea788597824d72540e5087ba48c8fcd1d568fb4e1b3aa484f9a770d325181f2)
* parameter\_description.go
  [parameter\_description.go](#diff-337ba3b3ca35d683c7b185e7a0c222c25c7c30bfc38d40a89fd77949f5866341)
* parameter\_status.go
  [parameter\_status.go](#diff-04a805fad946b1e10d4fbe30a2892e326f040d2ce8670a8cd21d921e381f9f82)
* parse.go
  [parse.go](#diff-1596bd8ceb74246828aacab827b39a33075c86baa627fbbeb7491bd31eef1169)
* parse\_complete.go
  [parse\_complete.go](#diff-1bd0bc899483e57787a3aab48b6565473c837981fb35e674df5ea89ad5848790)
* password\_message.go
  [password\_message.go](#diff-da00f426ac5c66c3375044eab536bc9838fc27803f81bb96649112edf7564ae4)
* pgproto3.go
  [pgproto3.go](#diff-a1170dfd05e2499e0350879792c054fd217d11e7e5a3c6bb0b966830e79ad8ad)
* pgproto3\_private\_test.go
  [pgproto3\_private\_test.go](#diff-34f77319d8135e95f92de7155ba8ab0158e9e4625eb9163f21e9d55c317590a9)
* portal\_suspended.go
  [portal\_suspended.go](#diff-ca4bf0ed9ae647ea113a35d954318eda5d6d86a74fe6f3ef99969b2800b8da7d)
* query.go
  [query.go](#diff-66f9c6b00ef4ad1dbef1133865440121c8d03aec3333e8b6dd97ac3560b91ac7)
* query\_test.go
  [query\_test.go](#diff-a1e45d129806a2c1ddddeab3dbc022da3b9f120b260d397f0c1a5fe414afc97d)
* ready\_for\_query.go
  [ready\_for\_query.go](#diff-e29b8f7ee6f67feef3bdbdfe2aa6b1c49876ef6ea037a9fdc761764020fae302)
* row\_description.go
  [row\_description.go](#diff-faf1f15b2dee9a26d5c3b78dc4a9f47221b3607eeffc39883e6819f3281ae405)
* sasl\_initial\_response.go
  [sasl\_initial\_response.go](#diff-1b60dce72aeb87622d31a018a4601d15fd54532490db5a0c5c905084c4517fc4)
* sasl\_response.go
  [sasl\_response.go](#diff-456f0faec611376808958213f450a792c88ac1810398afeb762e7adcc81b8dc3)
* ssl\_request.go
  [ssl\_request.go](#diff-22071c1f2b7f154f601953e13774c4cc5f82b93d32d3eb6fbe911ac33f2b84d2)
* startup\_message.go
  [startup\_message.go](#diff-2cfde8979ac30055f3c09ddfc0dfd024eef1ceadb52830f127526384549a5172)
* sync.go
  [sync.go](#diff-d41679517cfd690d16b66f15bf8af782a50081525eb9df1af20ccc8f10d092ae)
* terminate.go
  [terminate.go](#diff-2de7cecfb3986761e068272dcf64723dbce7f9d38cf77ab11031ad3c66b9496b)

## There are no files selected for viewing

7 changes: 3 additions & 4 deletions

7
[authentication\_cleartext\_password.go](#diff-3ffeff3af747d27dcd0078fdf01cb0f5bfd8a9bb43ebbb8585f52cf0408071ae "authentication_cleartext_password.go")

Show comments

[View file](/jackc/pgproto3/blob/945c2126f6db8f3bea7eeebe307c01fe92bca007/authentication_cleartext_password.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -35,11 +35,10 @@ func (dst \*AuthenticationCleartextPassword) Decode(src []byte) error { |
|  |  | } |
|  |  |  |
|  |  | // Encode encodes src into dst. dst will include the 1 byte message type identifier and the 4 byte message length. |
|  |  | func (src \*AuthenticationCleartextPassword) Encode(dst []byte) []byte { |
|  |  | dst = append(dst, 'R') |
|  |  | dst = pgio.AppendInt32(dst, 8) |
|  |  | func (src \*AuthenticationCleartextPassword) Encode(dst []byte) ([]byte, error) { |
|  |  | dst, sp := beginMessage(dst, 'R') |
|  |  | dst = pgio.AppendUint32(dst, AuthTypeCleartextPassword) |
|  |  | return dst |
|  |  | return finishMessage(dst, sp) |
|  |  | } |
|  |  |  |
|  |  | // MarshalJSON implements encoding/json.Marshaler. |
| Expand Down | |  |

8 changes: 4 additions & 4 deletions

8
[authentication\_gss.go](#diff-6fda8d8234ca762183612f92c8f2ace0337c5a4ec5f666d610d9c3dc776144a5 "authentication_gss.go")

Show comments

[View file](/jackc/pgproto3/blob/945c2126f6db8f3bea7eeebe307c01fe92bca007/authentication_gss.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -4,6 +4,7 @@ import ( |
|  |  | "encoding/binary" |
|  |  | "encoding/json" |
|  |  | "errors" |
|  |  |  |
|  |  | "github.com/jackc/pgio" |
|  |  | ) |
|  |  |  |
| Expand All | | @@ -26,11 +27,10 @@ func (a \*AuthenticationGSS) Decode(src []byte) error { |
|  |  | return nil |
|  |  | } |
|  |  |  |
|  |  | func (a \*AuthenticationGSS) Encode(dst []byte) []byte { |
|  |  | dst = append(dst, 'R') |
|  |  | dst = pgio.AppendInt32(dst, 4) |
|  |  | func (a \*AuthenticationGSS) Encode(dst []byte) ([]byte, error) { |
|  |  | dst, sp := beginMessage(dst, 'R') |
|  |  | dst = pgio.AppendUint32(dst, AuthTypeGSS) |
|  |  | return dst |
|  |  | return finishMessage(dst, sp) |
|  |  | } |
|  |  |  |
|  |  | func (a \*AuthenticationGSS) MarshalJSON() ([]byte, error) { |
| Expand Down | |  |

8 changes: 4 additions & 4 deletions

8
[authentication\_gss\_continue.go](#diff-30c7a76c5b592780e9b06d085728084998b3378d448eecf257c32d75f437ebfa "authentication_gss_continue.go")

Show comments

[View file](/jackc/pgproto3/blob/945c2126f6db8f3bea7eeebe307c01fe92bca007/authentication_gss_continue.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -4,6 +4,7 @@ import ( |
|  |  | "encoding/binary" |
|  |  | "encoding/json" |
|  |  | "errors" |
|  |  |  |
|  |  | "github.com/jackc/pgio" |
|  |  | ) |
|  |  |  |
| Expand All | | @@ -30,12 +31,11 @@ func (a \*AuthenticationGSSContinue) Decode(src []byte) error { |
|  |  | return nil |
|  |  | } |
|  |  |  |
|  |  | func (a \*AuthenticationGSSContinue) Encode(dst []byte) []byte { |
|  |  | dst = append(dst, 'R') |
|  |  | dst = pgio.AppendInt32(dst, int32(len(a.Data))+8) |
|  |  | func (a \*AuthenticationGSSContinue) Encode(dst []byte) ([]byte, error) { |
|  |  | dst, sp := beginMessage(dst, 'R') |
|  |  | dst = pgio.AppendUint32(dst, AuthTypeGSSCont) |
|  |  | dst = append(dst, a.Data...) |
|  |  | return dst |
|  |  | return finishMessage(dst, sp) |
|  |  | } |
|  |  |  |
|  |  | func (a \*AuthenticationGSSContinue) MarshalJSON() ([]byte, error) { |
| Expand Down | |  |

7 changes: 3 additions & 4 deletions

7
[authentication\_md5\_password.go](#diff-b08605904bf9946d997c0cf2e0a5fd67993082adc964947f79534f418c35b00d "authentication_md5_password.go")

Show comments

[View file](/jackc/pgproto3/blob/945c2126f6db8f3bea7eeebe307c01fe92bca007/authentication_md5_password.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -38,12 +38,11 @@ func (dst \*AuthenticationMD5Password) Decode(src []byte) error { |
|  |  | } |
|  |  |  |
|  |  | // Encode encodes src into dst. dst will include the 1 byte message type identifier and the 4 byte message length. |
|  |  | func (src \*AuthenticationMD5Password) Encode(dst []byte) []byte { |
|  |  | dst = append(dst, 'R') |
|  |  | dst = pgio.AppendInt32(dst, 12) |
|  |  | func (src \*AuthenticationMD5Password) Encode(dst []byte) ([]byte, error) { |
|  |  | dst, sp := beginMessage(dst, 'R') |
|  |  | dst = pgio.AppendUint32(dst, AuthTypeMD5Password) |
|  |  | dst = append(dst, src.Salt[:]...) |
|  |  | return dst |
|  |  | return finishMessage(dst, sp) |
|  |  | } |
|  |  |  |
|  |  | // MarshalJSON implements encoding/json.Marshaler. |
| Expand Down | |  |

7 changes: 3 additions & 4 deletions

7
[authentication\_ok.go](#diff-8ec54088fb5dbc89708898d3821279fafa3d4838b5fc2c6cd1efa657abae5bf9 "authentication_ok.go")

Show comments

[View file](/jackc/pgproto3/blob/945c2126f6db8f3bea7eeebe307c01fe92bca007/authentication_ok.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -35,11 +35,10 @@ func (dst \*AuthenticationOk) Decode(src []byte) error { |
|  |  | } |
|  |  |  |
|  |  | // Encode encodes src into dst. dst will include the 1 byte message type identifier and the 4 byte message length. |
|  |  | func (src \*AuthenticationOk) Encode(dst []byte) []byte { |
|  |  | dst = append(dst, 'R') |
|  |  | dst = pgio.AppendInt32(dst, 8) |
|  |  | func (src \*AuthenticationOk) Encode(dst []byte) ([]byte, error) { |
|  |  | dst, sp := beginMessage(dst, 'R') |
|  |  | dst = pgio.AppendUint32(dst, AuthTypeOk) |
|  |  | return dst |
|  |  | return finishMessage(dst, sp) |
|  |  | } |
|  |  |  |
|  |  | // MarshalJSON implements encoding/json.Marshaler. |
| Expand Down | |  |

10 changes: 3 additions & 7 deletions

10
[authentication\_sasl.go](#diff-0633743faa1735d86e068fc66089aeadd7a3c3adb557611b7f18216a6a9e1943 "authentication_sasl.go")

Show comments

[View file](/jackc/pgproto3/blob/945c2126f6db8f3bea7eeebe307c01fe92bca007/authentication_sasl.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -46,10 +46,8 @@ func (dst \*AuthenticationSASL) Decode(src []byte) error { |
|  |  | } |
|  |  |  |
|  |  | // Encode encodes src into dst. dst will include the 1 byte message type identifier and the 4 byte message length. |
|  |  | func (src \*AuthenticationSASL) Encode(dst []byte) []byte { |
|  |  | dst = append(dst, 'R') |
|  |  | sp := len(dst) |
|  |  | dst = pgio.AppendInt32(dst, -1) |
|  |  | func (src \*AuthenticationSASL) Encode(dst []byte) ([]byte, error) { |
|  |  | dst, sp := beginMessage(dst, 'R') |
|  |  | dst = pgio.AppendUint32(dst, AuthTypeSASL) |
|  |  |  |
|  |  | for \_, s := range src.AuthMechanisms { |
| Expand All | | @@ -58,9 +56,7 @@ func (src \*AuthenticationSASL) Encode(dst []byte) []byte { |
|  |  | } |
|  |  | dst = append(dst, 0) |
|  |  |  |
|  |  | pgio.SetInt32(dst[sp:], int32(len(dst[sp:]))) |
|  |  |  |
|  |  | return dst |
|  |  | return finishMessage(dst, sp) |
|  |  | } |
|  |  |  |
|  |  | // MarshalJSON implements encoding/json.Marshaler. |
| Expand Down | |  |

12 changes: 3 additions & 9 deletions

12
[authentication\_sasl\_continue.go](#diff-b8034d8958143ac180dcbe48049aa5ffe0c77a86571af65d3a45353404c7d1d7 "authentication_sasl_continue.go")

Show comments

[View file](/jackc/pgproto3/blob/945c2126f6db8f3bea7eeebe307c01fe92bca007/authentication_sasl_continue.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -38,17 +38,11 @@ func (dst \*AuthenticationSASLContinue) Decode(src []byte) error { |
|  |  | } |
|  |  |  |
|  |  | // Encode encodes src into dst. dst will include the 1 byte message type identifier and the 4 byte message length. |
|  |  | func (src \*AuthenticationSASLContinue) Encode(dst []byte) []byte { |
|  |  | dst = append(dst, 'R') |
|  |  | sp := len(dst) |
|  |  | dst = pgio.AppendInt32(dst, -1) |
|  |  | func (src \*AuthenticationSASLContinue) Encode(dst []byte) ([]byte, error) { |
|  |  | dst, sp := beginMessage(dst, 'R') |
|  |  | dst = pgio.AppendUint32(dst, AuthTypeSASLContinue) |
|  |  |  |
|  |  | dst = append(dst, src.Data...) |
|  |  |  |
|  |  | pgio.SetInt32(dst[sp:], int32(len(dst[sp:]))) |
|  |  |  |
|  |  | return dst |
|  |  | return finishMessage(dst, sp) |
|  |  | } |
|  |  |  |
|  |  | // MarshalJSON implements encoding/json.Marshaler. |
| Expand Down | |  |

12 changes: 3 additions & 9 deletions

12
[authentication\_sasl\_final.go](#diff-8ee981dbe9f1142c8fcf494388023501a5e938860711dc4c0b9e0e4aabaf4695 "authentication_sasl_final.go")

Show comments

[View file](/jackc/pgproto3/blob/945c2126f6db8f3bea7eeebe307c01fe92bca007/authentication_sasl_final.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -38,17 +38,11 @@ func (dst \*AuthenticationSASLFinal) Decode(src []byte) error { |
|  |  | } |
|  |  |  |
|  |  | // Encode encodes src into dst. dst will include the 1 byte message type identifier and the 4 byte message length. |
|  |  | func (src \*AuthenticationSASLFinal) Encode(dst []byte) []byte { |
|  |  | dst = append(dst, 'R') |
|  |  | sp := len(dst) |
|  |  | dst = pgio.AppendInt32(dst, -1) |
|  |  | func (src \*AuthenticationSASLFinal) Encode(dst []byte) ([]byte, error) { |
|  |  | dst, sp := beginMessage(dst, 'R') |
|  |  | dst = pgio.AppendUint32(dst, AuthTypeSASLFinal) |
|  |  |  |
|  |  | dst = append(dst, src.Data...) |
|  |  |  |
|  |  | pgio.SetInt32(dst[sp:], int32(len(dst[sp:]))) |
|  |  |  |
|  |  | return dst |
|  |  | return finishMessage(dst, sp) |
|  |  | } |
|  |  |  |
|  |  | // MarshalJSON implements encoding/json.Unmarshaler. |
| Expand Down | |  |

15 changes: 10 additions & 5 deletions

15
[backend.go](#diff-f7febf2126e4c13f0730b2d06b8a6d3bdcb748f6379770c478888c2e4ea1949e "backend.go")

Show comments

[View file](/jackc/pgproto3/blob/945c2126f6db8f3bea7eeebe307c01fe92bca007/backend.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -49,7 +49,12 @@ func NewBackend(cr ChunkReader, w io.Writer) \*Backend { |
|  |  |  |
|  |  | // Send sends a message to the frontend. |
|  |  | func (b \*Backend) Send(msg BackendMessage) error { |
|  |  | \_, err := b.w.Write(msg.Encode(nil)) |
|  |  | buf, err := msg.Encode(nil) |
|  |  | if err != nil { |
|  |  | return err |
|  |  | } |
|  |  |  |
|  |  | \_, err = b.w.Write(buf) |
|  |  | return err |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -184,11 +189,11 @@ func (b \*Backend) Receive() (FrontendMessage, error) { |
|  |  | // contextual identification of FrontendMessages. For example, in the |
|  |  | // PG message flow documentation for PasswordMessage: |
|  |  | // |
|  |  | //  Byte1('p') |
|  |  | //  Byte1('p') |
|  |  | // |
|  |  | //  Identifies the message as a password response. Note that this is also used for |
|  |  | // GSSAPI, SSPI and SASL response messages. The exact message type can be deduced from |
|  |  | // the context. |
|  |  | //  Identifies the message as a password response. Note that this is also used for |
|  |  | //  GSSAPI, SSPI and SASL response messages. The exact message type can be deduced from |
|  |  | //  the context. |
|  |  | // |
|  |  | // Since the Frontend does not know about the state of a backend, it is important |
|  |  | // to call SetAuthType() after an authentication request is received by the Frontend. |
| Expand Down | |  |

7 changes: 3 additions & 4 deletions

7
[backend\_key\_data.go](#diff-e3cc188cb666e9fc818db39fa186a51f7cd690937f452fd44c816d1a500c1b6c "backend_key_data.go")

Show comments

[View file](/jackc/pgproto3/blob/945c2126f6db8f3bea7eeebe307c01fe92bca007/backend_key_data.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -29,12 +29,11 @@ func (dst \*BackendKeyData) Decode(src []byte) error { |
|  |  | } |
|  |  |  |
|  |  | // Encode encodes src into dst. dst will include the 1 byte message type identifier and the 4 byte message length. |
|  |  | func (src \*BackendKeyData) Encode(dst []byte) []byte { |
|  |  | dst = append(dst, 'K') |
|  |  | dst = pgio.AppendUint32(dst, 12) |
|  |  | func (src \*BackendKeyData) Encode(dst []byte) ([]byte, error) { |
|  |  | dst, sp := beginMessage(dst, 'K') |
|  |  | dst = pgio.AppendUint32(dst, src.ProcessID) |
|  |  | dst = pgio.AppendUint32(dst, src.SecretKey) |
|  |  | return dst |
|  |  | return finishMessage(dst, sp) |
|  |  | } |
|  |  |  |
|  |  | // MarshalJSON implements encoding/json.Marshaler. |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[backend\_test.go](#diff-948240fcba2ce7149ab3368fce810af3577a17af881a6668936de8190d95acf3 "backend_test.go")

Show comments

[View file](/jackc/pgproto3/blob/945c2126f6db8f3bea7eeebe307c01fe92bca007/backend_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -71,8 +71,8 @@ func TestStartupMessage(t \*testing.T) { |
|  |  | "username": "tester", |
|  |  | }, |
|  |  | } |
|  |  | dst := []byte{} |
|  |  | dst = want.Encode(dst) |
|  |  | dst, err := want.Encode([]byte{}) |
|  |  | require.NoError(t, err) |
|  |  |  |
|  |  | server := &interruptReader{} |
|  |  | server.push(dst) |
| Expand Down | |  |

21 changes: 14 additions & 7 deletions

21
[bind.go](#diff-aade326d3512b5a2ada6faa791ddec468f2a0adedb352339c9e314e74c8949d2 "bind.go")

Show comments

[View file](/jackc/pgproto3/blob/945c2126f6db8f3bea7eeebe307c01fe92bca007/bind.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -5,7 +5,9 @@ import ( |
|  |  | "encoding/binary" |
|  |  | "encoding/hex" |
|  |  | "encoding/json" |
|  |  | "errors" |
|  |  | "fmt" |
|  |  | "math" |
|  |  |  |
|  |  | "github.com/jackc/pgio" |
|  |  | ) |
| Expand Down  Expand Up | | @@ -108,21 +110,25 @@ func (dst \*Bind) Decode(src []byte) error { |
|  |  | } |
|  |  |  |
|  |  | // Encode encodes src into dst. dst will include the 1 byte message type identifier and the 4 byte message length. |
|  |  | func (src \*Bind) Encode(dst []byte) []byte { |
|  |  | dst = append(dst, 'B') |
|  |  | sp := len(dst) |
|  |  | dst = pgio.AppendInt32(dst, -1) |
|  |  | func (src \*Bind) Encode(dst []byte) ([]byte, error) { |
|  |  | dst, sp := beginMessage(dst, 'B') |
|  |  |  |
|  |  | dst = append(dst, src.DestinationPortal...) |
|  |  | dst = append(dst, 0) |
|  |  | dst = append(dst, src.PreparedStatement...) |
|  |  | dst = append(dst, 0) |
|  |  |  |
|  |  | if len(src.ParameterFormatCodes) > math.MaxUint16 { |
|  |  | return nil, errors.New("too many parameter format codes") |
|  |  | } |
|  |  | dst = pgio.AppendUint16(dst, uint16(len(src.ParameterFormatCodes))) |
|  |  | for \_, fc := range src.ParameterFormatCodes { |
|  |  | dst = pgio.AppendInt16(dst, fc) |
|  |  | } |
|  |  |  |
|  |  | if len(src.Parameters) > math.MaxUint16 { |
|  |  | return nil, errors.New("too many parameters") |
|  |  | } |
|  |  | dst = pgio.AppendUint16(dst, uint16(len(src.Parameters))) |
|  |  | for \_, p := range src.Parameters { |
|  |  | if p == nil { |
| Expand All | | @@ -134,14 +140,15 @@ func (src \*Bind) Encode(dst []byte) []byte { |
|  |  | dst = append(dst, p...) |
|  |  | } |
|  |  |  |
|  |  | if len(src.ResultFormatCodes) > math.MaxUint16 { |
|  |  | return nil, errors.New("too many result format codes") |
|  |  | } |
|  |  | dst = pgio.AppendUint16(dst, uint16(len(src.ResultFormatCodes))) |
|  |  | for \_, fc := range src.ResultFormatCodes { |
|  |  | dst = pgio.AppendInt16(dst, fc) |
|  |  | } |
|  |  |  |
|  |  | pgio.SetInt32(dst[sp:], int32(len(dst[sp:]))) |
|  |  |  |
|  |  | return dst |
|  |  | return finishMessage(dst, sp) |
|  |  | } |
|  |  |  |
|  |  | // MarshalJSON implements encoding/json.Marshaler. |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[bind\_complete.go](#diff-377c23e59c8a83818e891ed3cdd3e86fd5dee714f9727a96ba92ad2cb9de1e1d "bind_complete.go")

Show comments

[View file](/jackc/pgproto3/blob/945c2126f6db8f3bea7eeebe307c01fe92bca007/bind_complete.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -20,8 +20,8 @@ func (dst \*BindComplete) Decode(src []byte) error { |
|  |  | } |
|  |  |  |
|  |  | // Encode encodes src into dst. dst will include the 1 byte message type identifier and the 4 byte message length. |
|  |  | func (src \*BindComplete) Encode(dst []byte) []byte { |
|  |  | return append(dst, '2', 0, 0, 0, 4) |
|  |  | func (src \*BindComplete) Encode(dst []byte) ([]byte, error) { |
|  |  | return append(dst, '2', 0, 0, 0, 4), nil |
|  |  | } |
|  |  |  |
|  |  | // MarshalJSON implements encoding/json.Marshaler. |
| Expand Down | |  |

20 changes: 20 additions & 0 deletions

20
[bind\_test.go](#diff-00ddec41d7347850f21b9acaeecd783b25cd152e45f033b31d34775ea7c69052 "bind_test.go")

Show comments

[View file](/jackc/pgproto3/blob/945c2126f6db8f3bea7eeebe307c01fe92bca007/bind_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,20 @@ |
|  |  | package pgproto3\_test |
|  |  |  |
|  |  | import ( |
|  |  | "testing" |
|  |  |  |
|  |  | "github.com/jackc/pgproto3/v2" |
|  |  | "github.com/stretchr/testify/require" |
|  |  | ) |
|  |  |  |
|  |  | func TestBindBiggerThanMaxMessageBodyLen(t \*testing.T) { |
|  |  | t.Parallel() |
|  |  |  |
|  |  | // Maximum allowed size. |
|  |  | \_, err := (&pgproto3.Bind{Parameters: [][]byte{make([]byte, pgproto3.MaxMessageBodyLen-16)}}).Encode(nil) |
|  |  | require.NoError(t, err) |
|  |  |  |
|  |  | // 1 byte too big |
|  |  | \_, err = (&pgproto3.Bind{Parameters: [][]byte{make([]byte, pgproto3.MaxMessageBodyLen-15)}}).Encode(nil) |
|  |  | require.Error(t, err) |
|  |  | } |

4 changes: 2 additions & 2 deletions

4
[cancel\_request.go](#diff-1bfb818b937e3855172bab35f709b3768d8f3213623c7a758c96bf282568e1d8 "cancel_request.go")

Show comments

[View file](/jackc/pgproto3/blob/945c2126f6db8f3bea7eeebe307c01fe92bca007/cancel_request.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -36,12 +36,12 @@ func (dst \*CancelRequest) Decode(src []byte) error { |
|  |  | } |
|  |  |  |
|  |  | // Encode encodes src into dst. dst will include the 4 byte message length. |
|  |  | func (src \*CancelRequest) Encode(dst []byte) []byte { |
|  |  | func (src \*CancelRequest) Encode(dst []byte) ([]byte, error) { |
|  |  | dst = pgio.AppendInt32(dst, 16) |
|  |  | dst = pgio.AppendInt32(dst, cancelRequestCode) |
|  |  | dst = pgio.AppendUint32(dst, src.ProcessID) |
|  |  | dst = pgio.AppendUint32(dst, src.SecretKey) |
|  |  | return dst |
|  |  | return dst, nil |
|  |  | } |
|  |  |  |
|  |  | // MarshalJSON implements encoding/json.Marshaler. |
| Expand Down | |  |

14 changes: 3 additions & 11 deletions

14
[close.go](#diff-e388b94dc680f496cb6026bdaecce464a253c5a9802871e472dcc78f98d5a549 "close.go")

Show comments

[View file](/jackc/pgproto3/blob/945c2126f6db8f3bea7eeebe307c01fe92bca007/close.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -4,8 +4,6 @@ import ( |
|  |  | "bytes" |
|  |  | "encoding/json" |
|  |  | "errors" |
|  |  |  |
|  |  | "github.com/jackc/pgio" |
|  |  | ) |
|  |  |  |
|  |  | type Close struct { |
| Expand Down  Expand Up | | @@ -37,18 +35,12 @@ func (dst \*Close) Decode(src []byte) error { |
|  |  | } |
|  |  |  |
|  |  | // Encode encodes src into dst. dst will include the 1 byte message type identifier and the 4 byte message length. |
|  |  | func (src \*Close) Encode(dst []byte) []byte { |
|  |  | dst = append(dst, 'C') |
|  |  | sp := len(dst) |
|  |  | dst = pgio.AppendInt32(dst, -1) |
|  |  |  |
|  |  | func (src \*Close) Encode(dst []byte) ([]byte, error) { |
|  |  | dst, sp := beginMessage(dst, 'C') |
|  |  | dst = append(dst, src.ObjectType) |
|  |  | dst = append(dst, src.Name...) |
|  |  | dst = append(dst, 0) |
|  |  |  |
|  |  | pgio.SetInt32(dst[sp:], int32(len(dst[sp:]))) |
|  |  |  |
|  |  | return dst |
|  |  | return finishMessage(dst, sp) |
|  |  | } |
|  |  |  |
|  |  | // MarshalJSON implements encoding/json.Marshaler. |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[close\_complete.go](#diff-ac53bd32c9d4d978b4d907b847c9979545cd27dfd63a2103148e35b2649621e0 "close_complete.go")

Show comments

[View file](/jackc/pgproto3/blob/945c2126f6db8f3bea7eeebe307c01fe92bca007/close_complete.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -20,8 +20,8 @@ func (dst \*CloseComplete) Decode(src []byte) error { |
|  |  | } |
|  |  |  |
|  |  | // Encode encodes src into dst. dst will include the 1 byte message type identifier and the 4 byte message length. |
|  |  | func (src \*CloseComplete) Encode(dst []byte) []byte { |
|  |  | return append(dst, '3', 0, 0, 0, 4) |
|  |  | func (src \*CloseComplete) Encode(dst []byte) ([]byte, error) { |
|  |  | return append(dst, '3', 0, 0, 0, 4), nil |
|  |  | } |
|  |  |  |
|  |  | // MarshalJSON implements encoding/json.Marshaler. |
| Expand Down | |  |

14 changes: 3 additions & 11 deletions

14
[command\_complete.go](#diff-8625e100b2a22b38f09895a37002bda8685a4d880fc0cc33b3e97011f6e0ba08 "command_complete.go")

Show comments

[View file](/jackc/pgproto3/blob/945c2126f6db8f3bea7eeebe307c01fe92bca007/command_complete.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -3,8 +3,6 @@ package pgproto3 |
|  |  | import ( |
|  |  | "bytes" |
|  |  | "encoding/json" |
|  |  |  |
|  |  | "github.com/jackc/pgio" |
|  |  | ) |
|  |  |  |
|  |  | type CommandComplete struct { |
| Expand All | | @@ -28,17 +26,11 @@ func (dst \*CommandComplete) Decode(src []byte) error { |
|  |  | } |
|  |  |  |
|  |  | // Encode encodes src into dst. dst will include the 1 byte message type identifier and the 4 byte message length. |
|  |  | func (src \*CommandComplete) Encode(dst []byte) []byte { |
|  |  | dst = append(dst, 'C') |
|  |  | sp := len(dst) |
|  |  | dst = pgio.AppendInt32(dst, -1) |
|  |  |  |
|  |  | func (src \*CommandComplete) Encode(dst []byte) ([]byte, error) { |
|  |  | dst, sp := beginMessage(dst, 'C') |
|  |  | dst = append(dst, src.CommandTag...) |
|  |  | dst = append(dst, 0) |
|  |  |  |
|  |  | pgio.SetInt32(dst[sp:], int32(len(dst[sp:]))) |
|  |  |  |
|  |  | return dst |
|  |  | return finishMessage(dst, sp) |
|  |  | } |
|  |  |  |
|  |  | // MarshalJSON implements encoding/json.Marshaler. |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `945c212`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjackc%2Fpgproto3%2Fcommit%2F945c2126f6db8f3bea7eeebe307c01fe92bca007) to comment.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from github.com_d038d949_20250115_175841.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjackc%2Fpgx%2Fcommit%2Fadbb38f298c76e283ffc7c7a3f571036fea47fd4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjackc%2Fpgx%2Fcommit%2Fadbb38f298c76e283ffc7c7a3f571036fea47fd4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=jackc%2Fpgx)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[jackc](/jackc)
/
**[pgx](/jackc/pgx)**
Public

* [Notifications](/login?return_to=%2Fjackc%2Fpgx) You must be signed in to change notification settings
* [Fork
  867](/login?return_to=%2Fjackc%2Fpgx)
* [Star
   11.1k](/login?return_to=%2Fjackc%2Fpgx)

* [Code](/jackc/pgx)
* [Issues
  201](/jackc/pgx/issues)
* [Pull requests
  21](/jackc/pgx/pulls)
* [Discussions](/jackc/pgx/discussions)
* [Actions](/jackc/pgx/actions)
* [Projects
  0](/jackc/pgx/projects)
* [Wiki](/jackc/pgx/wiki)
* [Security](/jackc/pgx/security)
* [Insights](/jackc/pgx/pulse)

Additional navigation options

* [Code](/jackc/pgx)
* [Issues](/jackc/pgx/issues)
* [Pull requests](/jackc/pgx/pulls)
* [Discussions](/jackc/pgx/discussions)
* [Actions](/jackc/pgx/actions)
* [Projects](/jackc/pgx/projects)
* [Wiki](/jackc/pgx/wiki)
* [Security](/jackc/pgx/security)
* [Insights](/jackc/pgx/pulse)

## Commit

[Permalink](/jackc/pgx/commit/adbb38f298c76e283ffc7c7a3f571036fea47fd4)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Do not allow protocol messages larger than ~1GB

[Browse files](/jackc/pgx/tree/adbb38f298c76e283ffc7c7a3f571036fea47fd4)
Browse the repository at this point in the history

```
The PostgreSQL server will reject messages greater than ~1 GB anyway.
However, worse than that is that a message that is larger than 4 GB
could wrap the 32-bit integer message size and be interpreted by the
server as multiple messages. This could allow a malicious client to
inject arbitrary protocol messages.

[GHSA-mrww-27vc-gghv](https://github.com/jackc/pgx/security/advisories/GHSA-mrww-27vc-gghv "GHSA-mrww-27vc-gghv")
```

* Loading branch information

[![@jackc](https://avatars.githubusercontent.com/u/94130?s=40&v=4)](/jackc)

[jackc](/jackc/pgx/commits?author=jackc "View all commits by jackc")
committed
Mar 4, 2024

1 parent
[c1b0a01](/jackc/pgx/commit/c1b0a01ca75ac9eb3a7dbc1396f583ab5dbf9557)

commit adbb38f

 Show file tree

 Hide file tree

Showing
**61 changed files**
with
**472 additions**
and
**390 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* pgconn

  + pgconn/pgconn.go
    [pgconn.go](#diff-7600c6d53b2bb66dc26f15ff10fb080ad09158eea6e7562a8dc1db33d1ea2abf)
  + pgconn/pgconn\_test.go
    [pgconn\_test.go](#diff-a1f52733c928c12d80518f57b1fe7690f7e7bebfad553e49ab95c6f771dc98fb)
* pgproto3

  + pgproto3/authentication\_cleartext\_password.go
    [authentication\_cleartext\_password.go](#diff-38c76f51e017a694a19e8e7a7cdb41f70280f235aeafdd8a390d87fee15aa6ef)
  + pgproto3/authentication\_gss.go
    [authentication\_gss.go](#diff-ec2183f27b1a76a36b7e0ccfd8b5d7b0527ad683ff8d580618a0725f076585f8)
  + pgproto3/authentication\_gss\_continue.go
    [authentication\_gss\_continue.go](#diff-3cd6d6522dc4595558ada46aef50bd1b5ce2e028c1d8e8ea0905c6a0d7791d38)
  + pgproto3/authentication\_md5\_password.go
    [authentication\_md5\_password.go](#diff-016a086162de2b578b767df3b942dc2790c45054464d97d07232755f7f8d10da)
  + pgproto3/authentication\_ok.go
    [authentication\_ok.go](#diff-ce955941403217f8553936cc0a8bbcce97b61b6d29fc241c2674181277b1607d)
  + pgproto3/authentication\_sasl.go
    [authentication\_sasl.go](#diff-4ac4f9c69f0a306649d3e6f3eb13e18f124441eef4bf900730ddf6d6170f5e0b)
  + pgproto3/authentication\_sasl\_continue.go
    [authentication\_sasl\_continue.go](#diff-855f5302d6cf906fd945cecdf572f1ed828e7ae79d0f1ef69ba10f9ca084b805)
  + pgproto3/authentication\_sasl\_final.go
    [authentication\_sasl\_final.go](#diff-27dfc99c73eef994216ebd4a3d06b9cf07914b060e1d35fd0ac5a3889b5b1914)
  + pgproto3/backend.go
    [backend.go](#diff-c800068371a84ed703aa469fcf44c113a161d24b1ec303a92cc4c3faa04224f7)
  + pgproto3/backend\_key\_data.go
    [backend\_key\_data.go](#diff-128f59a154a00808842306a398733a4894d91c04e4d3dc836f50a1bd09b8ea4b)
  + pgproto3/backend\_test.go
    [backend\_test.go](#diff-200cf71b6cdc7666454cb4af57c7ca5d1ac2b29391ead2890372ad75acf89a61)
  + pgproto3/bind.go
    [bind.go](#diff-4f1131e5f16ed00c734c09f24ea9b3be93ce0ca9db2f8b89eb306b6e355a6866)
  + pgproto3/bind\_complete.go
    [bind\_complete.go](#diff-09388e44b6be8fdce1afb277bea0efc52a23362a1bd9027358d5d8944cb0cf21)
  + pgproto3/bind\_test.go
    [bind\_test.go](#diff-03bf19469853c0558df0ab044091bbf4f1ead1e2a8a28f4c116e6e6a2599de69)
  + pgproto3/cancel\_request.go
    [cancel\_request.go](#diff-1df41ed868f6c30def57e50c9c43b91d5ceaba69c347ba61d9522bce39d1cfb4)
  + pgproto3/close.go
    [close.go](#diff-7ecf1553f757a3d4999ccc03f9085b524ef2e0812e17fca9e4efe8b6a60b94fc)
  + pgproto3/close\_complete.go
    [close\_complete.go](#diff-d9b6a7d30cb09232166738c52a9dabd1913eb87b503c4703acc1ba1abbe51ec6)
  + pgproto3/command\_complete.go
    [command\_complete.go](#diff-c7a654585478b02af3f14b6de54c64497f6ac1ee145aa208bbfa4f2d1d25e725)
  + pgproto3/copy\_both\_response.go
    [copy\_both\_response.go](#diff-9b18ffe86554b533a182224462d4ff0b89538d42ab5bd1322f5a13b11e9d19a3)
  + pgproto3/copy\_both\_response\_test.go
    [copy\_both\_response\_test.go](#diff-a8905d5520058094001d7c5d687f03cdbbe9fdca2687eb573a92a42d29ba632e)
  + pgproto3/copy\_data.go
    [copy\_data.go](#diff-c11b3ffccb7391125febda67e29c1c49e510b68463af4a35cb075a07bcdd2abf)
  + pgproto3/copy\_done.go
    [copy\_done.go](#diff-2a15d391fd0555e62cc5c78ae97158eff3e7e4679e9fb81ac27de9bef0aa0737)
  + pgproto3/copy\_fail.go
    [copy\_fail.go](#diff-f8ead4b2d078d63d26d0f2b397d33075a405e1008d836a365aa66820fdede4ba)
  + pgproto3/copy\_in\_response.go
    [copy\_in\_response.go](#diff-271bc1375e64b3a672c2d8a913eab4cee0fae32d299da278c172436f8cc89b7d)
  + pgproto3/copy\_out\_response.go
    [copy\_out\_response.go](#diff-8f78463d68b697a97e511f250206bb533225326d7c16707d8d6bd6b4f588bddc)
  + pgproto3/data\_row.go
    [data\_row.go](#diff-714b0ef3de9ce32a383c0e98c8cfd5a88e45e805f8e34cc97f5ef0785ddca74e)
  + pgproto3/describe.go
    [describe.go](#diff-120dfac93ef49196f2812bc56c3864410dda3cece89d907793daac9197becba1)
  + pgproto3/empty\_query\_response.go
    [empty\_query\_response.go](#diff-564792ad03af30744815bb616501333528dcf0e70a678d48a2d232b3b43a9b50)
  + pgproto3/error\_response.go
    [error\_response.go](#diff-7ea9dc5fb90c1e8869be61305c06738bfc59168b7d22f15b083c5e79aeefadcb)
  + example/pgfortune

    - pgproto3/example/pgfortune/server.go
      [server.go](#diff-9fe7e62242ecbfa61b4fe2da3cbc70b3d9e0b136df356bd6ca27f9345a577c25)
  + pgproto3/execute.go
    [execute.go](#diff-9461a4a769dd30981cfb8657ba7fdeec4f51e3426fa1ede422705fd4ee15f2f7)
  + pgproto3/flush.go
    [flush.go](#diff-2014722a87be890cebbbfc56a0480b7852c5001f3fec200cadaed69e4cf259d3)
  + pgproto3/frontend.go
    [frontend.go](#diff-f4c8380917c592f3d8f3670028c19b80e9a5198d8d0581d60d3f264090307b49)
  + pgproto3/function\_call.go
    [function\_call.go](#diff-e888f2b31baa439d5c4c56f31f674cc07df64fc9b41f70a14ee4a5ffb9e4366e)
  + pgproto3/function\_call\_response.go
    [function\_call\_response.go](#diff-ae380ae773e06f52e7d5fe5e5bd7cf8102a64aa72a1f57825cc8853e3308e3b7)
  + pgproto3/function\_call\_test.go
    [function\_call\_test.go](#diff-a5aa14eeac8e4cb16321135ef63521bc9f9ec510ba944b006768e0fe683a0473)
  + pgproto3/gss\_enc\_request.go
    [gss\_enc\_request.go](#diff-859fde024c9e4e1b55f9b98101f262801b46ffaef1228bb59a68589b377b2a01)
  + pgproto3/gss\_response.go
    [gss\_response.go](#diff-5d85a1d6f5086f9a18c00878bee0b806c6c40b275035d8f63ea9ee62e118da69)
  + pgproto3/no\_data.go
    [no\_data.go](#diff-a23a207dcd5b3d9bd6f35a4bb301219549241afb072d4e2336febef2b2f6f2d8)
  + pgproto3/notice\_response.go
    [notice\_response.go](#diff-081244b5a9fd31ded1c24d7f0da8b18fb4b3ccaa551b7f4241ce7257151ac772)
  + pgproto3/notification\_response.go
    [notification\_response.go](#diff-4da471bd4a2ba95e3637104c43f8ddf0de954abaadcb878c272f6da0448b0758)
  + pgproto3/parameter\_description.go
    [parameter\_description.go](#diff-558715943f228027625c3d99348d1b44f734922d6dce2956308f1de1d8057c62)
  + pgproto3/parameter\_status.go
    [parameter\_status.go](#diff-5dc2d68d17e84a1a43c4ac1852b2ceed584cdf966652da62b16785e43013174b)
  + pgproto3/parse.go
    [parse.go](#diff-f58b0a43b7a2eda6ca3f08ecf300726d730a2d7be969e458577df6a574cadbdd)
  + pgproto3/parse\_complete.go
    [parse\_complete.go](#diff-97cfefdf59bea57e17540629f074554bf27c8b2473e1798727328476b2c645f8)
  + pgproto3/password\_message.go
    [password\_message.go](#diff-e9376589ba59d33cba997c676dc5ea2f55f0ceea78f5fa7bd6abeb257bce9f37)
  + pgproto3/pgproto3.go
    [pgproto3.go](#diff-8bf170adb7f9502badfa4e6410ac2190e19e780bb67b2f8015bd29d9fde60c41)
  + pgproto3/pgproto3\_private\_test.go
    [pgproto3\_private\_test.go](#diff-e799055d7800c1e7ee37ae6910e41fe60902e97be1d7adf58bbac641b645a471)
  + pgproto3/portal\_suspended.go
    [portal\_suspended.go](#diff-6f3e50321dae46cdd1636f0d808e63c65cf6d24ce1130a7eed7480a3bbb5a35a)
  + pgproto3/query.go
    [query.go](#diff-896f824236f506e8c37644be9fc4e2d1e0e792960fe4c827fe3bc48cc16bf696)
  + pgproto3/query\_test.go
    [query\_test.go](#diff-d85db1d6800c0f334ce3ffc1a09fbf7af49eeb5cc39a887decb95ddbaa4348fd)
  + pgproto3/ready\_for\_query.go
    [ready\_for\_query.go](#diff-500c7ef4213a776f3f38b0f27b018f388f5436fe4b28de0a5c93812a26a4d109)
  + pgproto3/row\_description.go
    [row\_description.go](#diff-2843d9dd12f0f0564378b038e9bfe900ecf10467281a8d3b946f18be94b59caf)
  + pgproto3/sasl\_initial\_response.go
    [sasl\_initial\_response.go](#diff-2b50cc1a5983c857c4e0ff18653b6530b324d79f1d84ad32526b21d3c64747c0)
  + pgproto3/sasl\_response.go
    [sasl\_response.go](#diff-35aa9cbd2ae1f8cf0a6ee0398e77b9ec320c199c05992ec43d17f3b53e0742cd)
  + pgproto3/ssl\_request.go
    [ssl\_request.go](#diff-72c5e846de48db15d0328e46e20c6e84dbc3df15c22cadc5da8428fb97b6070a)
  + pgproto3/startup\_message.go
    [startup\_message.go](#diff-5c81b1261761c7375835e32afaf0238b833f3246ab05b5447d3b5f2eb79a3357)
  + pgproto3/sync.go
    [sync.go](#diff-29f396558ca8a0779aefab54e529ad21f42d28e215ec69a9ae90ca0f6e2f786d)
  + pgproto3/terminate.go
    [terminate.go](#diff-6655957172b0b7ec2138e3cc36e032671b34395d56a8bde60ef037a6606288f4)

## There are no files selected for viewing

46 changes: 41 additions & 5 deletions

46
[pgconn/pgconn.go](#diff-7600c6d53b2bb66dc26f15ff10fb080ad09158eea6e7562a8dc1db33d1ea2abf "pgconn/pgconn.go")

Show comments

[View file](/jackc/pgx/blob/adbb38f298c76e283ffc7c7a3f571036fea47fd4/pgconn/pgconn.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1674,25 +1674,55 @@ func (rr \*ResultReader) concludeCommand(commandTag CommandTag, err error) { |
|  |  | // Batch is a collection of queries that can be sent to the PostgreSQL server in a single round-trip. |
|  |  | type Batch struct { |
|  |  | buf []byte |
|  |  | err error |
|  |  | } |
|  |  |  |
|  |  | // ExecParams appends an ExecParams command to the batch. See PgConn.ExecParams for parameter descriptions. |
|  |  | func (batch \*Batch) ExecParams(sql string, paramValues [][]byte, paramOIDs []uint32, paramFormats []int16, resultFormats []int16) { |
|  |  | batch.buf = (&pgproto3.Parse{Query: sql, ParameterOIDs: paramOIDs}).Encode(batch.buf) |
|  |  | if batch.err != nil { |
|  |  | return |
|  |  | } |
|  |  |  |
|  |  | batch.buf, batch.err = (&pgproto3.Parse{Query: sql, ParameterOIDs: paramOIDs}).Encode(batch.buf) |
|  |  | if batch.err != nil { |
|  |  | return |
|  |  | } |
|  |  | batch.ExecPrepared("", paramValues, paramFormats, resultFormats) |
|  |  | } |
|  |  |  |
|  |  | // ExecPrepared appends an ExecPrepared e command to the batch. See PgConn.ExecPrepared for parameter descriptions. |
|  |  | func (batch \*Batch) ExecPrepared(stmtName string, paramValues [][]byte, paramFormats []int16, resultFormats []int16) { |
|  |  | batch.buf = (&pgproto3.Bind{PreparedStatement: stmtName, ParameterFormatCodes: paramFormats, Parameters: paramValues, ResultFormatCodes: resultFormats}).Encode(batch.buf) |
|  |  | batch.buf = (&pgproto3.Describe{ObjectType: 'P'}).Encode(batch.buf) |
|  |  | batch.buf = (&pgproto3.Execute{}).Encode(batch.buf) |
|  |  | if batch.err != nil { |
|  |  | return |
|  |  | } |
|  |  |  |
|  |  | batch.buf, batch.err = (&pgproto3.Bind{PreparedStatement: stmtName, ParameterFormatCodes: paramFormats, Parameters: paramValues, ResultFormatCodes: resultFormats}).Encode(batch.buf) |
|  |  | if batch.err != nil { |
|  |  | return |
|  |  | } |
|  |  |  |
|  |  | batch.buf, batch.err = (&pgproto3.Describe{ObjectType: 'P'}).Encode(batch.buf) |
|  |  | if batch.err != nil { |
|  |  | return |
|  |  | } |
|  |  |  |
|  |  | batch.buf, batch.err = (&pgproto3.Execute{}).Encode(batch.buf) |
|  |  | if batch.err != nil { |
|  |  | return |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | // ExecBatch executes all the queries in batch in a single round-trip. Execution is implicitly transactional unless a |
|  |  | // transaction is already in progress or SQL contains transaction control statements. This is a simpler way of executing |
|  |  | // multiple queries in a single round trip than using pipeline mode. |
|  |  | func (pgConn \*PgConn) ExecBatch(ctx context.Context, batch \*Batch) \*MultiResultReader { |
|  |  | if batch.err != nil { |
|  |  | return &MultiResultReader{ |
|  |  | closed: true, |
|  |  | err: batch.err, |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | if err := pgConn.lock(); err != nil { |
|  |  | return &MultiResultReader{ |
|  |  | closed: true, |
| Expand All | | @@ -1718,7 +1748,13 @@ func (pgConn \*PgConn) ExecBatch(ctx context.Context, batch \*Batch) \*MultiResultR |
|  |  | pgConn.contextWatcher.Watch(ctx) |
|  |  | } |
|  |  |  |
|  |  | batch.buf = (&pgproto3.Sync{}).Encode(batch.buf) |
|  |  | batch.buf, batch.err = (&pgproto3.Sync{}).Encode(batch.buf) |
|  |  | if batch.err != nil { |
|  |  | multiResult.closed = true |
|  |  | multiResult.err = batch.err |
|  |  | pgConn.unlock() |
|  |  | return multiResult |
|  |  | } |
|  |  |  |
|  |  | pgConn.enterPotentialWriteReadDeadlock() |
|  |  | defer pgConn.exitPotentialWriteReadDeadlock() |
| Expand Down | |  |

13 changes: 10 additions & 3 deletions

13
[pgconn/pgconn\_test.go](#diff-a1f52733c928c12d80518f57b1fe7690f7e7bebfad553e49ab95c6f771dc98fb "pgconn/pgconn_test.go")

Show comments

[View file](/jackc/pgx/blob/adbb38f298c76e283ffc7c7a3f571036fea47fd4/pgconn/pgconn_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -3363,9 +3363,9 @@ func TestSNISupport(t \*testing.T) { |
|  |  | return |
|  |  | } |
|  |  |  |
|  |  | srv.Write((&pgproto3.AuthenticationOk{}).Encode(nil)) |
|  |  | srv.Write((&pgproto3.BackendKeyData{ProcessID: 0, SecretKey: 0}).Encode(nil)) |
|  |  | srv.Write((&pgproto3.ReadyForQuery{TxStatus: 'I'}).Encode(nil)) |
|  |  | srv.Write(mustEncode((&pgproto3.AuthenticationOk{}).Encode(nil))) |
|  |  | srv.Write(mustEncode((&pgproto3.BackendKeyData{ProcessID: 0, SecretKey: 0}).Encode(nil))) |
|  |  | srv.Write(mustEncode((&pgproto3.ReadyForQuery{TxStatus: 'I'}).Encode(nil))) |
|  |  |  |
|  |  | serverSNINameChan <- sniHost |
|  |  | }() |
| Expand Down  Expand Up | | @@ -3472,3 +3472,10 @@ func TestFatalErrorReceivedInPipelineMode(t \*testing.T) { |
|  |  | err = pipeline.Close() |
|  |  | require.Error(t, err) |
|  |  | } |
|  |  |  |
|  |  | func mustEncode(buf []byte, err error) []byte { |
|  |  | if err != nil { |
|  |  | panic(err) |
|  |  | } |
|  |  | return buf |
|  |  | } |

7 changes: 3 additions & 4 deletions

7
[pgproto3/authentication\_cleartext\_password.go](#diff-38c76f51e017a694a19e8e7a7cdb41f70280f235aeafdd8a390d87fee15aa6ef "pgproto3/authentication_cleartext_password.go")

Show comments

[View file](/jackc/pgx/blob/adbb38f298c76e283ffc7c7a3f571036fea47fd4/pgproto3/authentication_cleartext_password.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -35,11 +35,10 @@ func (dst \*AuthenticationCleartextPassword) Decode(src []byte) error { |
|  |  | } |
|  |  |  |
|  |  | // Encode encodes src into dst. dst will include the 1 byte message type identifier and the 4 byte message length. |
|  |  | func (src \*AuthenticationCleartextPassword) Encode(dst []byte) []byte { |
|  |  | dst = append(dst, 'R') |
|  |  | dst = pgio.AppendInt32(dst, 8) |
|  |  | func (src \*AuthenticationCleartextPassword) Encode(dst []byte) ([]byte, error) { |
|  |  | dst, sp := beginMessage(dst, 'R') |
|  |  | dst = pgio.AppendUint32(dst, AuthTypeCleartextPassword) |
|  |  | return dst |
|  |  | return finishMessage(dst, sp) |
|  |  | } |
|  |  |  |
|  |  | // MarshalJSON implements encoding/json.Marshaler. |
| Expand Down | |  |

7 changes: 3 additions & 4 deletions

7
[pgproto3/authentication\_gss.go](#diff-ec2183f27b1a76a36b7e0ccfd8b5d7b0527ad683ff8d580618a0725f076585f8 "pgproto3/authentication_gss.go")

Show comments

[View file](/jackc/pgx/blob/adbb38f298c76e283ffc7c7a3f571036fea47fd4/pgproto3/authentication_gss.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -27,11 +27,10 @@ func (a \*AuthenticationGSS) Decode(src []byte) error { |
|  |  | return nil |
|  |  | } |
|  |  |  |
|  |  | func (a \*AuthenticationGSS) Encode(dst []byte) []byte { |
|  |  | dst = append(dst, 'R') |
|  |  | dst = pgio.AppendInt32(dst, 4) |
|  |  | func (a \*AuthenticationGSS) Encode(dst []byte) ([]byte, error) { |
|  |  | dst, sp := beginMessage(dst, 'R') |
|  |  | dst = pgio.AppendUint32(dst, AuthTypeGSS) |
|  |  | return dst |
|  |  | return finishMessage(dst, sp) |
|  |  | } |
|  |  |  |
|  |  | func (a \*AuthenticationGSS) MarshalJSON() ([]byte, error) { |
| Expand Down | |  |

7 changes: 3 additions & 4 deletions

7
[pgproto3/authentication\_gss\_continue.go](#diff-3cd6d6522dc4595558ada46aef50bd1b5ce2e028c1d8e8ea0905c6a0d7791d38 "pgproto3/authentication_gss_continue.go")

Show comments

[View file](/jackc/pgx/blob/adbb38f298c76e283ffc7c7a3f571036fea47fd4/pgproto3/authentication_gss_continue.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -31,12 +31,11 @@ func (a \*AuthenticationGSSContinue) Decode(src []byte) error { |
|  |  | return nil |
|  |  | } |
|  |  |  |
|  |  | func (a \*AuthenticationGSSContinue) Encode(dst []byte) []byte { |
|  |  | dst = append(dst, 'R') |
|  |  | dst = pgio.AppendInt32(dst, int32(len(a.Data))+8) |
|  |  | func (a \*AuthenticationGSSContinue) Encode(dst []byte) ([]byte, error) { |
|  |  | dst, sp := beginMessage(dst, 'R') |
|  |  | dst = pgio.AppendUint32(dst, AuthTypeGSSCont) |
|  |  | dst = append(dst, a.Data...) |
|  |  | return dst |
|  |  | return finishMessage(dst, sp) |
|  |  | } |
|  |  |  |
|  |  | func (a \*AuthenticationGSSContinue) MarshalJSON() ([]byte, error) { |
| Expand Down | |  |

7 changes: 3 additions & 4 deletions

7
[pgproto3/authentication\_md5\_password.go](#diff-016a086162de2b578b767df3b942dc2790c45054464d97d07232755f7f8d10da "pgproto3/authentication_md5_password.go")

Show comments

[View file](/jackc/pgx/blob/adbb38f298c76e283ffc7c7a3f571036fea47fd4/pgproto3/authentication_md5_password.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -38,12 +38,11 @@ func (dst \*AuthenticationMD5Password) Decode(src []byte) error { |
|  |  | } |
|  |  |  |
|  |  | // Encode encodes src into dst. dst will include the 1 byte message type identifier and the 4 byte message length. |
|  |  | func (src \*AuthenticationMD5Password) Encode(dst []byte) []byte { |
|  |  | dst = append(dst, 'R') |
|  |  | dst = pgio.AppendInt32(dst, 12) |
|  |  | func (src \*AuthenticationMD5Password) Encode(dst []byte) ([]byte, error) { |
|  |  | dst, sp := beginMessage(dst, 'R') |
|  |  | dst = pgio.AppendUint32(dst, AuthTypeMD5Password) |
|  |  | dst = append(dst, src.Salt[:]...) |
|  |  | return dst |
|  |  | return finishMessage(dst, sp) |
|  |  | } |
|  |  |  |
|  |  | // MarshalJSON implements encoding/json.Marshaler. |
| Expand Down | |  |

7 changes: 3 additions & 4 deletions

7
[pgproto3/authentication\_ok.go](#diff-ce955941403217f8553936cc0a8bbcce97b61b6d29fc241c2674181277b1607d "pgproto3/authentication_ok.go")

Show comments

[View file](/jackc/pgx/blob/adbb38f298c76e283ffc7c7a3f571036fea47fd4/pgproto3/authentication_ok.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -35,11 +35,10 @@ func (dst \*AuthenticationOk) Decode(src []byte) error { |
|  |  | } |
|  |  |  |
|  |  | // Encode encodes src into dst. dst will include the 1 byte message type identifier and the 4 byte message length. |
|  |  | func (src \*AuthenticationOk) Encode(dst []byte) []byte { |
|  |  | dst = append(dst, 'R') |
|  |  | dst = pgio.AppendInt32(dst, 8) |
|  |  | func (src \*AuthenticationOk) Encode(dst []byte) ([]byte, error) { |
|  |  | dst, sp := beginMessage(dst, 'R') |
|  |  | dst = pgio.AppendUint32(dst, AuthTypeOk) |
|  |  | return dst |
|  |  | return finishMessage(dst, sp) |
|  |  | } |
|  |  |  |
|  |  | // MarshalJSON implements encoding/json.Marshaler. |
| Expand Down | |  |

10 changes: 3 additions & 7 deletions

10
[pgproto3/authentication\_sasl.go](#diff-4ac4f9c69f0a306649d3e6f3eb13e18f124441eef4bf900730ddf6d6170f5e0b "pgproto3/authentication_sasl.go")

Show comments

[View file](/jackc/pgx/blob/adbb38f298c76e283ffc7c7a3f571036fea47fd4/pgproto3/authentication_sasl.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -47,10 +47,8 @@ func (dst \*AuthenticationSASL) Decode(src []byte) error { |
|  |  | } |
|  |  |  |
|  |  | // Encode encodes src into dst. dst will include the 1 byte message type identifier and the 4 byte message length. |
|  |  | func (src \*AuthenticationSASL) Encode(dst []byte) []byte { |
|  |  | dst = append(dst, 'R') |
|  |  | sp := len(dst) |
|  |  | dst = pgio.AppendInt32(dst, -1) |
|  |  | func (src \*AuthenticationSASL) Encode(dst []byte) ([]byte, error) { |
|  |  | dst, sp := beginMessage(dst, 'R') |
|  |  | dst = pgio.AppendUint32(dst, AuthTypeSASL) |
|  |  |  |
|  |  | for \_, s := range src.AuthMechanisms { |
| Expand All | | @@ -59,9 +57,7 @@ func (src \*AuthenticationSASL) Encode(dst []byte) []byte { |
|  |  | } |
|  |  | dst = append(dst, 0) |
|  |  |  |
|  |  | pgio.SetInt32(dst[sp:], int32(len(dst[sp:]))) |
|  |  |  |
|  |  | return dst |
|  |  | return finishMessage(dst, sp) |
|  |  | } |
|  |  |  |
|  |  | // MarshalJSON implements encoding/json.Marshaler. |
| Expand Down | |  |

12 changes: 3 additions & 9 deletions

12
[pgproto3/authentication\_sasl\_continue.go](#diff-855f5302d6cf906fd945cecdf572f1ed828e7ae79d0f1ef69ba10f9ca084b805 "pgproto3/authentication_sasl_continue.go")

Show comments

[View file](/jackc/pgx/blob/adbb38f298c76e283ffc7c7a3f571036fea47fd4/pgproto3/authentication_sasl_continue.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -38,17 +38,11 @@ func (dst \*AuthenticationSASLContinue) Decode(src []byte) error { |
|  |  | } |
|  |  |  |
|  |  | // Encode encodes src into dst. dst will include the 1 byte message type identifier and the 4 byte message length. |
|  |  | func (src \*AuthenticationSASLContinue) Encode(dst []byte) []byte { |
|  |  | dst = append(dst, 'R') |
|  |  | sp := len(dst) |
|  |  | dst = pgio.AppendInt32(dst, -1) |
|  |  | func (src \*AuthenticationSASLContinue) Encode(dst []byte) ([]byte, error) { |
|  |  | dst, sp := beginMessage(dst, 'R') |
|  |  | dst = pgio.AppendUint32(dst, AuthTypeSASLContinue) |
|  |  |  |
|  |  | dst = append(dst, src.Data...) |
|  |  |  |
|  |  | pgio.SetInt32(dst[sp:], int32(len(dst[sp:]))) |
|  |  |  |
|  |  | return dst |
|  |  | return finishMessage(dst, sp) |
|  |  | } |
|  |  |  |
|  |  | // MarshalJSON implements encoding/json.Marshaler. |
| Expand Down | |  |

12 changes: 3 additions & 9 deletions

12
[pgproto3/authentication\_sasl\_final.go](#diff-27dfc99c73eef994216ebd4a3d06b9cf07914b060e1d35fd0ac5a3889b5b1914 "pgproto3/authentication_sasl_final.go")

Show comments

[View file](/jackc/pgx/blob/adbb38f298c76e283ffc7c7a3f571036fea47fd4/pgproto3/authentication_sasl_final.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -38,17 +38,11 @@ func (dst \*AuthenticationSASLFinal) Decode(src []byte) error { |
|  |  | } |
|  |  |  |
|  |  | // Encode encodes src into dst. dst will include the 1 byte message type identifier and the 4 byte message length. |
|  |  | func (src \*AuthenticationSASLFinal) Encode(dst []byte) []byte { |
|  |  | dst = append(dst, 'R') |
|  |  | sp := len(dst) |
|  |  | dst = pgio.AppendInt32(dst, -1) |
|  |  | func (src \*AuthenticationSASLFinal) Encode(dst []byte) ([]byte, error) { |
|  |  | dst, sp := beginMessage(dst, 'R') |
|  |  | dst = pgio.AppendUint32(dst, AuthTypeSASLFinal) |
|  |  |  |
|  |  | dst = append(dst, src.Data...) |
|  |  |  |
|  |  | pgio.SetInt32(dst[sp:], int32(len(dst[sp:]))) |
|  |  |  |
|  |  | return dst |
|  |  | return finishMessage(dst, sp) |
|  |  | } |
|  |  |  |
|  |  | // MarshalJSON implements encoding/json.Unmarshaler. |
| Expand Down | |  |

25 changes: 21 additions & 4 deletions

25
[pgproto3/backend.go](#diff-c800068371a84ed703aa469fcf44c113a161d24b1ec303a92cc4c3faa04224f7 "pgproto3/backend.go")

Show comments

[View file](/jackc/pgx/blob/adbb38f298c76e283ffc7c7a3f571036fea47fd4/pgproto3/backend.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -16,7 +16,8 @@ type Backend struct { |
|  |  | // before it is actually transmitted (i.e. before Flush). |
|  |  | tracer \*tracer |
|  |  |  |
|  |  | wbuf []byte |
|  |  | wbuf []byte |
|  |  | encodeError error |
|  |  |  |
|  |  | // Frontend message flyweights |
|  |  | bind Bind |
| Expand Down  Expand Up | | @@ -55,18 +56,34 @@ func NewBackend(r io.Reader, w io.Writer) \*Backend { |
|  |  | return &Backend{cr: cr, w: w} |
|  |  | } |
|  |  |  |
|  |  | // Send sends a message to the frontend (i.e. the client). The message is not guaranteed to be written until Flush is |
|  |  | // called. |
|  |  | // Send sends a message to the frontend (i.e. the client). The message is buffered until Flush is called. Any error |
|  |  | // encountered will be returned from Flush. |
|  |  | func (b \*Backend) Send(msg BackendMessage) { |
|  |  | if b.encodeError != nil { |
|  |  | return |
|  |  | } |
|  |  |  |
|  |  | prevLen := len(b.wbuf) |
|  |  | b.wbuf = msg.Encode(b.wbuf) |
|  |  | newBuf, err := msg.Encode(b.wbuf) |
|  |  | if err != nil { |
|  |  | b.encodeError = err |
|  |  | return |
|  |  | } |
|  |  | b.wbuf = newBuf |
|  |  |  |
|  |  | if b.tracer != nil { |
|  |  | b.tracer.traceMessage('B', int32(len(b.wbuf)-prevLen), msg) |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | // Flush writes any pending messages to the frontend (i.e. the client). |
|  |  | func (b \*Backend) Flush() error { |
|  |  | if err := b.encodeError; err != nil { |
|  |  | b.encodeError = nil |
|  |  | b.wbuf = b.wbuf[:0] |
|  |  | return &writeError{err: err, safeToRetry: true} |
|  |  | } |
|  |  |  |
|  |  | n, err := b.w.Write(b.wbuf) |
|  |  |  |
|  |  | const maxLen = 1024 |
| Expand Down | |  |

7 changes: 3 additions & 4 deletions

7
[pgproto3/backend\_key\_data.go](#diff-128f59a154a00808842306a398733a4894d91c04e4d3dc836f50a1bd09b8ea4b "pgproto3/backend_key_data.go")

Show comments

[View file](/jackc/pgx/blob/adbb38f298c76e283ffc7c7a3f571036fea47fd4/pgproto3/backend_key_data.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -29,12 +29,11 @@ func (dst \*BackendKeyData) Decode(src []byte) error { |
|  |  | } |
|  |  |  |
|  |  | // Encode encodes src into dst. dst will include the 1 byte message type identifier and the 4 byte message length. |
|  |  | func (src \*BackendKeyData) Encode(dst []byte) []byte { |
|  |  | dst = append(dst, 'K') |
|  |  | dst = pgio.AppendUint32(dst, 12) |
|  |  | func (src \*BackendKeyData) Encode(dst []byte) ([]byte, error) { |
|  |  | dst, sp := beginMessage(dst, 'K') |
|  |  | dst = pgio.AppendUint32(dst, src.ProcessID) |
|  |  | dst = pgio.AppendUint32(dst, src.SecretKey) |
|  |  | return dst |
|  |  | return finishMessage(dst, sp) |
|  |  | } |
|  |  |  |
|  |  | // MarshalJSON implements encoding/json.Marshaler. |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[pgproto3/backend\_test.go](#diff-200cf71b6cdc7666454cb4af57c7ca5d1ac2b29391ead2890372ad75acf89a61 "pgproto3/backend_test.go")

Show comments

[View file](/jackc/pgx/blob/adbb38f298c76e283ffc7c7a3f571036fea47fd4/pgproto3/backend_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -71,8 +71,8 @@ func TestStartupMessage(t \*testing.T) { |
|  |  | "username": "tester", |
|  |  | }, |
|  |  | } |
|  |  | dst := []byte{} |
|  |  | dst = want.Encode(dst) |
|  |  | dst, err := want.Encode([]byte{}) |
|  |  | require.NoError(t, err) |
|  |  |  |
|  |  | server := &interruptReader{} |
|  |  | server.push(dst) |
| Expand Down | |  |

10 changes: 3 additions & 7 deletions

10
[pgproto3/bind.go](#diff-4f1131e5f16ed00c734c09f24ea9b3be93ce0ca9db2f8b89eb306b6e355a6866 "pgproto3/bind.go")

Show comments

[View file](/jackc/pgx/blob/adbb38f298c76e283ffc7c7a3f571036fea47fd4/pgproto3/bind.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -108,10 +108,8 @@ func (dst \*Bind) Decode(src []byte) error { |
|  |  | } |
|  |  |  |
|  |  | // Encode encodes src into dst. dst will include the 1 byte message type identifier and the 4 byte message length. |
|  |  | func (src \*Bind) Encode(dst []byte) []byte { |
|  |  | dst = append(dst, 'B') |
|  |  | sp := len(dst) |
|  |  | dst = pgio.AppendInt32(dst, -1) |
|  |  | func (src \*Bind) Encode(dst []byte) ([]byte, error) { |
|  |  | dst, sp := beginMessage(dst, 'B') |
|  |  |  |
|  |  | dst = append(dst, src.DestinationPortal...) |
|  |  | dst = append(dst, 0) |
| Expand Down  Expand Up | | @@ -139,9 +137,7 @@ func (src \*Bind) Encode(dst []byte) []byte { |
|  |  | dst = pgio.AppendInt16(dst, fc) |
|  |  | } |
|  |  |  |
|  |  | pgio.SetInt32(dst[sp:], int32(len(dst[sp:]))) |
|  |  |  |
|  |  | return dst |
|  |  | return finishMessage(dst, sp) |
|  |  | } |
|  |  |  |
|  |  | // MarshalJSON implements encoding/json.Marshaler. |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[pgproto3/bind\_complete.go](#diff-09388e44b6be8fdce1afb277bea0efc52a23362a1bd9027358d5d8944cb0cf21 "pgproto3/bind_complete.go")

Show comments

[View file](/jackc/pgx/blob/adbb38f298c76e283ffc7c7a3f571036fea47fd4/pgproto3/bind_complete.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -20,8 +20,8 @@ func (dst \*BindComplete) Decode(src []byte) error { |
|  |  | } |
|  |  |  |
|  |  | // Encode encodes src into dst. dst will include the 1 byte message type identifier and the 4 byte message length. |
|  |  | func (src \*BindComplete) Encode(dst []byte) []byte { |
|  |  | return append(dst, '2', 0, 0, 0, 4) |
|  |  | func (src \*BindComplete) Encode(dst []byte) ([]byte, error) { |
|  |  | return append(dst, '2', 0, 0, 0, 4), nil |
|  |  | } |
|  |  |  |
|  |  | // MarshalJSON implements encoding/json.Marshaler. |
| Expand Down | |  |

20 changes: 20 additions & 0 deletions

20
[pgproto3/bind\_test.go](#diff-03bf19469853c0558df0ab044091bbf4f1ead1e2a8a28f4c116e6e6a2599de69 "pgproto3/bind_test.go")

Show comments

[View file](/jackc/pgx/blob/adbb38f298c76e283ffc7c7a3f571036fea47fd4/pgproto3/bind_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,20 @@ |
|  |  | package pgproto3\_test |
|  |  |  |
|  |  | import ( |
|  |  | "testing" |
|  |  |  |
|  |  | "github.com/jackc/pgx/v5/pgproto3" |
|  |  | "github.com/stretchr/testify/require" |
|  |  | ) |
|  |  |  |
|  |  | func TestBindBiggerThanMaxMessageBodyLen(t \*testing.T) { |
|  |  | t.Parallel() |
|  |  |  |
|  |  | // Maximum allowed size. |
|  |  | \_, err := (&pgproto3.Bind{Parameters: [][]byte{make([]byte, pgproto3.MaxMessageBodyLen-16)}}).Encode(nil) |
|  |  | require.NoError(t, err) |
|  |  |  |
|  |  | // 1 byte too big |
|  |  | \_, err = (&pgproto3.Bind{Parameters: [][]byte{make([]byte, pgproto3.MaxMessageBodyLen-15)}}).Encode(nil) |
|  |  | require.Error(t, err) |
|  |  | } |

4 changes: 2 additions & 2 deletions

4
[pgproto3/cancel\_request.go](#diff-1df41ed868f6c30def57e50c9c43b91d5ceaba69c347ba61d9522bce39d1cfb4 "pgproto3/cancel_request.go")

Show comments

[View file](/jackc/pgx/blob/adbb38f298c76e283ffc7c7a3f571036fea47fd4/pgproto3/cancel_request.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -36,12 +36,12 @@ func (dst \*CancelRequest) Decode(src []byte) error { |
|  |  | } |
|  |  |  |
|  |  | // Encode encodes src into dst. dst will include the 4 byte message length. |
|  |  | func (src \*CancelRequest) Encode(dst []byte) []byte { |
|  |  | func (src \*CancelRequest) Encode(dst []byte) ([]byte, error) { |
|  |  | dst = pgio.AppendInt32(dst, 16) |
|  |  | dst = pgio.AppendInt32(dst, cancelRequestCode) |
|  |  | dst = pgio.AppendUint32(dst, src.ProcessID) |
|  |  | dst = pgio.AppendUint32(dst, src.SecretKey) |
|  |  | return dst |
|  |  | return dst, nil |
|  |  | } |
|  |  |  |
|  |  | // MarshalJSON implements encoding/json.Marshaler. |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `adbb38f`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjackc%2Fpgx%2Fcommit%2Fadbb38f298c76e283ffc7c7a3f571036fea47fd4) to comment.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from github.com_736efebe_20250115_175843.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjackc%2Fpgx%2Fsecurity%2Fadvisories%2FGHSA-mrww-27vc-gghv)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjackc%2Fpgx%2Fsecurity%2Fadvisories%2FGHSA-mrww-27vc-gghv)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=jackc%2Fpgx)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[jackc](/jackc)
/
**[pgx](/jackc/pgx)**
Public

* [Notifications](/login?return_to=%2Fjackc%2Fpgx) You must be signed in to change notification settings
* [Fork
  867](/login?return_to=%2Fjackc%2Fpgx)
* [Star
   11.1k](/login?return_to=%2Fjackc%2Fpgx)

* [Code](/jackc/pgx)
* [Issues
  201](/jackc/pgx/issues)
* [Pull requests
  21](/jackc/pgx/pulls)
* [Discussions](/jackc/pgx/discussions)
* [Actions](/jackc/pgx/actions)
* [Projects
  0](/jackc/pgx/projects)
* [Wiki](/jackc/pgx/wiki)
* [Security](/jackc/pgx/security)
* [Insights](/jackc/pgx/pulse)

Additional navigation options

* [Code](/jackc/pgx)
* [Issues](/jackc/pgx/issues)
* [Pull requests](/jackc/pgx/pulls)
* [Discussions](/jackc/pgx/discussions)
* [Actions](/jackc/pgx/actions)
* [Projects](/jackc/pgx/projects)
* [Wiki](/jackc/pgx/wiki)
* [Security](/jackc/pgx/security)
* [Insights](/jackc/pgx/pulse)

# SQL Injection via Protocol Message Size Overflow

Moderate

[jackc](/jackc)
published
GHSA-mrww-27vc-gghv
Mar 4, 2024

## Package

gomod

github.com/jackc/pgx
([Go](/advisories?query=ecosystem%3Ago))

## Affected versions

< v4.18.2, < v5.5.4

## Patched versions

v4.18.2, v5.5.4

## Description

### Impact

SQL injection can occur if an attacker can cause a single query or bind message to exceed 4 GB in size. An integer overflow in the calculated message size can cause the one large message to be sent as multiple messages under the attacker's control.

### Patches

The problem is resolved in v4.18.2 and v5.5.4.

### Workarounds

Reject user input large enough to cause a single query or bind message to exceed 4 GB in size.

### Severity

Moderate

### CVE ID

CVE-2024-27304

### Weaknesses

No CWEs

### Credits

* [![@paul-gerste-sonarsource](https://avatars.githubusercontent.com/u/79814126?s=40&v=4)](/paul-gerste-sonarsource)
  [paul-gerste-sonarsource](/paul-gerste-sonarsource)
  Finder

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from github.com_1982fd96_20250115_175842.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjackc%2Fpgx%2Fcommit%2Fc543134753a0c5d22881c12404025724cb05ffd8)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjackc%2Fpgx%2Fcommit%2Fc543134753a0c5d22881c12404025724cb05ffd8)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=jackc%2Fpgx)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[jackc](/jackc)
/
**[pgx](/jackc/pgx)**
Public

* [Notifications](/login?return_to=%2Fjackc%2Fpgx) You must be signed in to change notification settings
* [Fork
  867](/login?return_to=%2Fjackc%2Fpgx)
* [Star
   11.1k](/login?return_to=%2Fjackc%2Fpgx)

* [Code](/jackc/pgx)
* [Issues
  201](/jackc/pgx/issues)
* [Pull requests
  21](/jackc/pgx/pulls)
* [Discussions](/jackc/pgx/discussions)
* [Actions](/jackc/pgx/actions)
* [Projects
  0](/jackc/pgx/projects)
* [Wiki](/jackc/pgx/wiki)
* [Security](/jackc/pgx/security)
* [Insights](/jackc/pgx/pulse)

Additional navigation options

* [Code](/jackc/pgx)
* [Issues](/jackc/pgx/issues)
* [Pull requests](/jackc/pgx/pulls)
* [Discussions](/jackc/pgx/discussions)
* [Actions](/jackc/pgx/actions)
* [Projects](/jackc/pgx/projects)
* [Wiki](/jackc/pgx/wiki)
* [Security](/jackc/pgx/security)
* [Insights](/jackc/pgx/pulse)

## Commit

[Permalink](/jackc/pgx/commit/c543134753a0c5d22881c12404025724cb05ffd8)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

SQL sanitizer wraps arguments in parentheses

[Browse files](/jackc/pgx/tree/c543134753a0c5d22881c12404025724cb05ffd8)
Browse the repository at this point in the history

```
pgx v5 was not vulnerable to [CVE-2024-27289](https://github.com/advisories/GHSA-m7wr-2xf7-cm9p "CVE-2024-27289") do to how the sanitizer was
being called. But the sanitizer itself still had the underlying issue.
This commit ports the fix from pgx v4 to v5 to ensure that the issue
does not emerge if pgx uses the sanitizer differently in the future.
```

* Loading branch information

[![@jackc](https://avatars.githubusercontent.com/u/94130?s=40&v=4)](/jackc)

[jackc](/jackc/pgx/commits?author=jackc "View all commits by jackc")
committed
Mar 4, 2024

1 parent
[20344df](/jackc/pgx/commit/20344dfae83e672eff73a03324398543a1d87f43)

commit c543134

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**23 additions**
and
**9 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* internal/sanitize

  + internal/sanitize/sanitize.go
    [sanitize.go](#diff-65a99c1d9a3b358d8aebc18eb1f6d77c6142f66cdb2f330b66577681b38365ff)
  + internal/sanitize/sanitize\_test.go
    [sanitize\_test.go](#diff-d2b05d2f489d1b754d3334b5f7b79670af519f89c1c3518b107860d79cd4e8ac)

## There are no files selected for viewing

4 changes: 4 additions & 0 deletions

4
[internal/sanitize/sanitize.go](#diff-65a99c1d9a3b358d8aebc18eb1f6d77c6142f66cdb2f330b66577681b38365ff "internal/sanitize/sanitize.go")

Show comments

[View file](/jackc/pgx/blob/c543134753a0c5d22881c12404025724cb05ffd8/internal/sanitize/sanitize.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -63,6 +63,10 @@ func (q \*Query) Sanitize(args ...any) (string, error) { |
|  |  | return "", fmt.Errorf("invalid arg type: %T", arg) |
|  |  | } |
|  |  | argUse[argIdx] = true |
|  |  |  |
|  |  | // Prevent SQL injection via Line Comment Creation |
|  |  | // https://github.com/jackc/pgx/security/advisories/GHSA-m7wr-2xf7-cm9p |
|  |  | str = "(" + str + ")" |
|  |  | default: |
|  |  | return "", fmt.Errorf("invalid Part type: %T", part) |
|  |  | } |
| Expand Down | |  |

28 changes: 19 additions & 9 deletions

28
[internal/sanitize/sanitize\_test.go](#diff-d2b05d2f489d1b754d3334b5f7b79670af519f89c1c3518b107860d79cd4e8ac "internal/sanitize/sanitize_test.go")

Show comments

[View file](/jackc/pgx/blob/c543134753a0c5d22881c12404025724cb05ffd8/internal/sanitize/sanitize_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -132,47 +132,57 @@ func TestQuerySanitize(t \*testing.T) { |
|  |  | { |
|  |  | query: sanitize.Query{Parts: []sanitize.Part{"select ", 1}}, |
|  |  | args: []any{int64(42)}, |
|  |  | expected: `select 42`, |
|  |  | expected: `select (42)`, |
|  |  | }, |
|  |  | { |
|  |  | query: sanitize.Query{Parts: []sanitize.Part{"select ", 1}}, |
|  |  | args: []any{float64(1.23)}, |
|  |  | expected: `select 1.23`, |
|  |  | expected: `select (1.23)`, |
|  |  | }, |
|  |  | { |
|  |  | query: sanitize.Query{Parts: []sanitize.Part{"select ", 1}}, |
|  |  | args: []any{true}, |
|  |  | expected: `select true`, |
|  |  | expected: `select (true)`, |
|  |  | }, |
|  |  | { |
|  |  | query: sanitize.Query{Parts: []sanitize.Part{"select ", 1}}, |
|  |  | args: []any{[]byte{0, 1, 2, 3, 255}}, |
|  |  | expected: `select '\x00010203ff'`, |
|  |  | expected: `select ('\x00010203ff')`, |
|  |  | }, |
|  |  | { |
|  |  | query: sanitize.Query{Parts: []sanitize.Part{"select ", 1}}, |
|  |  | args: []any{nil}, |
|  |  | expected: `select null`, |
|  |  | expected: `select (null)`, |
|  |  | }, |
|  |  | { |
|  |  | query: sanitize.Query{Parts: []sanitize.Part{"select ", 1}}, |
|  |  | args: []any{"foobar"}, |
|  |  | expected: `select 'foobar'`, |
|  |  | expected: `select ('foobar')`, |
|  |  | }, |
|  |  | { |
|  |  | query: sanitize.Query{Parts: []sanitize.Part{"select ", 1}}, |
|  |  | args: []any{"foo'bar"}, |
|  |  | expected: `select 'foo''bar'`, |
|  |  | expected: `select ('foo''bar')`, |
|  |  | }, |
|  |  | { |
|  |  | query: sanitize.Query{Parts: []sanitize.Part{"select ", 1}}, |
|  |  | args: []any{`foo\'bar`}, |
|  |  | expected: `select 'foo\''bar'`, |
|  |  | expected: `select ('foo\''bar')`, |
|  |  | }, |
|  |  | { |
|  |  | query: sanitize.Query{Parts: []sanitize.Part{"insert ", 1}}, |
|  |  | args: []any{time.Date(2020, time.March, 1, 23, 59, 59, 999999999, time.UTC)}, |
|  |  | expected: `insert '2020-03-01 23:59:59.999999Z'`, |
|  |  | expected: `insert ('2020-03-01 23:59:59.999999Z')`, |
|  |  | }, |
|  |  | { |
|  |  | query: sanitize.Query{Parts: []sanitize.Part{"select 1-", 1}}, |
|  |  | args: []any{int64(-1)}, |
|  |  | expected: `select 1-(-1)`, |
|  |  | }, |
|  |  | { |
|  |  | query: sanitize.Query{Parts: []sanitize.Part{"select 1-", 1}}, |
|  |  | args: []any{float64(-1)}, |
|  |  | expected: `select 1-(-1)`, |
|  |  | }, |
|  |  | } |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `c543134`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjackc%2Fpgx%2Fcommit%2Fc543134753a0c5d22881c12404025724cb05ffd8) to comment.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.


