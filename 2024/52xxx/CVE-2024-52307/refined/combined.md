=== Content from www.openwall.com_18c341a6_20250114_184029.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](../../../2024/11/26/6) [[next>]](2) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <Z0chtLMDRnrhmwTt@kasco.suse.de>
Date: Wed, 27 Nov 2024 14:42:09 +0100
From: Matthias Gerstner <mgerstner@...e.de>
To: oss-security@...ts.openwall.com
Subject: authentik: remote timing attack in MetricsView HTTP Basic Auth
 (CVE-2024-52307)

Hello list,

this report is about a remote timing attack in Authentik [1]. Authentik is a
popular open source identity provider that can be self-hosted. SUSE IT is
considering to use this software internally in the future and thus we have
been asked to have a look at its security.

The Authentik version we examined was 2024.8.3. Beyond the finding in this
report, we also discovered the possibility to access SSL private keys without
authentication, but this was independently discovered and fixed in
parallel [2] by upstream before we had a chance to report it. The only
CVE-worthy finding that was left is discussed in the next section. Some
general insights into the security of Authentik are given in section 2).

We also offer a rendered version of this report on our blog in [3].

1) Vulnerability Details
========================

The MetricsView, reachable via URL "/-/metrics/", implements HTTP basic auth
in "authentik/root/monitoring.py:27" [4]. The expected username is hard-coded
to be `monitor`. The expected password is the constant `settings.SECRET_KEY`,
which is the same as the `AUTHENTIK_SECRET_KEY`, generated when setting up
Authentik. According to documentation it is used for cookie signing and in
older versions also for "unique user IDs".

To verify the password, the implementation uses the regular Python "=="
string comparison operator. This operator will optimize the string comparison,
making it likely possible to employ timing attacks to guess the correct
`SECRET_KEY`. Security research has repeatedly shown that timing attacks
are a realistic danger, even over the network.

Exploiting this vulnerability is likely complex, but a determined
attacker might be able to develop a successful approach. We did not look in
more detail into how to exploit the issue.

Upstream published a security advisory [5] and provides fixes for this issue
in versions 2024.10.3 and 2024.8.5. It is also possible to employ a workaround
by making the affected API endpoint inaccessible for remote users.

2) Review Summary
=================

Authentik is a big project consisting of about 10,000 lines of Golang code and
nearly 100,000 lines of Python code. It uses various web frameworks and a
rather complex set of abstractions. Reviewing this in full with our limited
resources is impossible. Thus we concentrated on inspecting the accessible
REST API endpoints and tried to get a general feel for the robustness of the
software.

The web frameworks and development style used in Authentik result in pretty
robust REST API endpoints. Even when issues are found, the upstream project
shows that it is well organized and manages to fix them quickly and
transparently.

The sheer amount of features supported by Authentik in terms of network
protocols, authentication mechanisms etc. is big and results in a level of
complexity that is hard to manage. Keeping track of the interactions of all
these features with client and third party systems is a challenge. Authentik
also implements a complex permission framework of over 500 different
privileges for controlling access to the system. We suggest to train
administrators of such systems well to avoid that issues are introduced
through bad configuration of the system.

A bit of a problematic area that we identified in Authentik is its
deployment. It only offers Docker-Compose or Kubernetes based installation.
No official bare-metal installation support exists. The minimum setup requires
four containers that are connected via an isolated network. One container is
running the Postgres database, one is running the Redis in-memory key/value
store, another one is running the actual Authentik server components and an
"Authentik Worker" container is running the celeryd task scheduler. We looked
into the containers and noted the following aspects:

* Two of the containers (Postgres and Redis) are based on Alpine Linux and the
  other two (Authentik Server and Worker) are based on Debian Linux.
* The local security within some of these containers is not fully maintained,
  e.g. in the Authentik Server container there exist globally accessible
  IPC sockets and unsafe temporary file permissions in /dev/shm. This means
  that the local security is only based on the container isolation. As soon as
  an attacker is able to run code in this container, there is little
  defense-in-depth.
* The file system hierarchy standard is violated in some of the containers,
  the / directory is cluttered with proprietary Authentik directories. A
  custom Python installation is placed there, for example.

Consequently, one must not only consider the security of Authentik itself, but
also the security of at least four different Linux containers running two
different Linux distributions and the customized Python stacks involved etc.
Users have to rely on Authentik upstream to properly maintain the security of
these components.

Offering a bare-metal installation could address the concerns in this area.
Individual services on modern Linux can still benefit from isolation features
(e.g. via protection settings in systemd service units [6]), while the system
packages and distribution security are transparent and under full control of
the Admin. Of course this likely makes things more complex for the upstream
developers, when they no longer have full control of the Linux environment
that Authentik is running in.

3) Timeline
===========

2024-10-25: We reported the finding to <security@...uthentik.io>, offering coordinated disclosure.
2024-10-28: Upstream replied and confirmed the issue.
2024-11-13: Upstream obtained a CVE and informed us they would publish the issue within a week.
2024-11-21: Upstream published fixes and a security advisory [5].

4) References
=============

[1]: <https://github.com/goauthentik/authentik>
[2]: <https://github.com/goauthentik/authentik/security/advisories/GHSA-qxqc-27pr-wgc8>
[3]: <https://security.opensuse.org/2024/11/26/authentik-timing-attack.html>
[4]: <https://github.com/goauthentik/authentik/blob/fd1d252d44a010fad558bed2d315577a9d8d1f2b/authentik/root/monitoring.py#L27>
[5]: <https://github.com/goauthentik/authentik/security/advisories/GHSA-2xrw-5f2x-m56j>
[6]: <https://documentation.suse.com/smart/security/html/systemd-securing/index.html>

Regards

Matthias

--
Matthias Gerstner <matthias.gerstner@...e.de>
Security Engineer
<https://www.suse.com/security>
GPG Key ID: 0x14C405C971923553

SUSE Software Solutions Germany GmbH
HRB 36809, AG Nürnberg
Geschäftsführer: Ivo Totev, Andrew McDonald, Werner Knoblich

Download attachment "[signature.asc](1/1)" of type "application/pgp-signature" (834 bytes)

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from github.com_13446961_20250114_184033.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Fsecurity%2Fadvisories%2FGHSA-2xrw-5f2x-m56j)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Fsecurity%2Fadvisories%2FGHSA-2xrw-5f2x-m56j)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=goauthentik%2Fauthentik)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[goauthentik](/goauthentik)
/
**[authentik](/goauthentik/authentik)**
Public

* [Notifications](/login?return_to=%2Fgoauthentik%2Fauthentik) You must be signed in to change notification settings
* [Fork
  984](/login?return_to=%2Fgoauthentik%2Fauthentik)
* [Star
   14.5k](/login?return_to=%2Fgoauthentik%2Fauthentik)

* [Code](/goauthentik/authentik)
* [Issues
  614](/goauthentik/authentik/issues)
* [Pull requests
  114](/goauthentik/authentik/pulls)
* [Discussions](/goauthentik/authentik/discussions)
* [Actions](/goauthentik/authentik/actions)
* [Security](/goauthentik/authentik/security)
* [Insights](/goauthentik/authentik/pulse)

Additional navigation options

* [Code](/goauthentik/authentik)
* [Issues](/goauthentik/authentik/issues)
* [Pull requests](/goauthentik/authentik/pulls)
* [Discussions](/goauthentik/authentik/discussions)
* [Actions](/goauthentik/authentik/actions)
* [Security](/goauthentik/authentik/security)
* [Insights](/goauthentik/authentik/pulse)

# Timing attack due to a lack of constant time comparison for metrics view

Moderate

[BeryJu](/BeryJu)
published
GHSA-2xrw-5f2x-m56j
Nov 21, 2024

## Package

authentik

## Affected versions

< 2024.10.3
< 2024.8.5

## Patched versions

2024.10.3
2024.8.5

## Description

### Summary

Due to the usage of a non-constant time comparison for the `/-/metrics/` endpoint it was possible to brute-force the `SECRET_KEY`, which is used to authenticate the endpoint. The `/-/metrics/` endpoint returns Prometheus metrics and is not intended to be accessed directly, as the Go proxy running in the authentik server container fetches data from this endpoint and serves it on a separate port (9300 by default), which can be scraped by Prometheus without being exposed publicly.

### Patches

authentik 2024.8.5 and 2024.10.3 fix this issue, for other versions the workaround below can be used.

### Impact

With enough attempts the `SECRET_KEY` of the authentik installation can be brute-forced, which can be used to sign new or modify existing cookies.

### Workarounds

Since the `/-/metrics/` endpoint is not intended to be accessed publicly, requests to the endpoint can be blocked by the reverse proxy/load balancer used in conjunction with authentik.

For example for nginx:

```
location /-/metrics/ {
    deny all;
    return 404;
}

```
### For more information

If you have any questions or comments about this advisory:

* Email us at security@goauthentik.io.

### Severity

Moderate

6.3

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v4 base metrics

##### Exploitability Metrics

Attack Vector
Network

Attack Complexity
Low

Attack Requirements
Present

Privileges Required
None

User interaction
None
##### Vulnerable System Impact Metrics

Confidentiality
Low

Integrity
Low

Availability
Low
##### Subsequent System Impact Metrics

Confidentiality
Low

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v4 base metrics

##### Exploitability Metrics

Attack Vector:
This metric reflects the context by which vulnerability exploitation is possible. This metric value (and consequently the resulting severity) will be larger the more remote (logically, and physically) an attacker can be in order to exploit the vulnerable system. The assumption is that the number of potential attackers for a vulnerability that could be exploited from across a network is larger than the number of potential attackers that could exploit a vulnerability requiring physical access to a device, and therefore warrants a greater severity.

Attack Complexity:
This metric captures measurable actions that must be taken by the attacker to actively evade or circumvent existing built-in security-enhancing conditions in order to obtain a working exploit. These are conditions whose primary purpose is to increase security and/or increase exploit engineering complexity. A vulnerability exploitable without a target-specific variable has a lower complexity than a vulnerability that would require non-trivial customization. This metric is meant to capture security mechanisms utilized by the vulnerable system.

Attack Requirements:
This metric captures the prerequisite deployment and execution conditions or variables of the vulnerable system that enable the attack. These differ from security-enhancing techniques/technologies (ref Attack Complexity) as the primary purpose of these conditions is not to explicitly mitigate attacks, but rather, emerge naturally as a consequence of the deployment and execution of the vulnerable system.

Privileges Required:
This metric describes the level of privileges an attacker must possess prior to successfully exploiting the vulnerability. The method by which the attacker obtains privileged credentials prior to the attack (e.g., free trial accounts), is outside the scope of this metric. Generally, self-service provisioned accounts do not constitute a privilege requirement if the attacker can grant themselves privileges as part of the attack.

User interaction:
This metric captures the requirement for a human user, other than the attacker, to participate in the successful compromise of the vulnerable system. This metric determines whether the vulnerability can be exploited solely at the will of the attacker, or whether a separate user (or user-initiated process) must participate in some manner.
##### Vulnerable System Impact Metrics

Confidentiality:
This metric measures the impact to the confidentiality of the information managed by the VULNERABLE SYSTEM due to a successfully exploited vulnerability. Confidentiality refers to limiting information access and disclosure to only authorized users, as well as preventing access by, or disclosure to, unauthorized ones.

Integrity:
This metric measures the impact to integrity of a successfully exploited vulnerability. Integrity refers to the trustworthiness and veracity of information. Integrity of the VULNERABLE SYSTEM is impacted when an attacker makes unauthorized modification of system data. Integrity is also impacted when a system user can repudiate critical actions taken in the context of the system (e.g. due to insufficient logging).

Availability:
This metric measures the impact to the availability of the VULNERABLE SYSTEM resulting from a successfully exploited vulnerability. While the Confidentiality and Integrity impact metrics apply to the loss of confidentiality or integrity of data (e.g., information, files) used by the system, this metric refers to the loss of availability of the impacted system itself, such as a networked service (e.g., web, database, email). Since availability refers to the accessibility of information resources, attacks that consume network bandwidth, processor cycles, or disk space all impact the availability of a system.
##### Subsequent System Impact Metrics

Confidentiality:
This metric measures the impact to the confidentiality of the information managed by the SUBSEQUENT SYSTEM due to a successfully exploited vulnerability. Confidentiality refers to limiting information access and disclosure to only authorized users, as well as preventing access by, or disclosure to, unauthorized ones.

Integrity:
This metric measures the impact to integrity of a successfully exploited vulnerability. Integrity refers to the trustworthiness and veracity of information. Integrity of the SUBSEQUENT SYSTEM is impacted when an attacker makes unauthorized modification of system data. Integrity is also impacted when a system user can repudiate critical actions taken in the context of the system (e.g. due to insufficient logging).

Availability:
This metric measures the impact to the availability of the SUBSEQUENT SYSTEM resulting from a successfully exploited vulnerability. While the Confidentiality and Integrity impact metrics apply to the loss of confidentiality or integrity of data (e.g., information, files) used by the system, this metric refers to the loss of availability of the impacted system itself, such as a networked service (e.g., web, database, email). Since availability refers to the accessibility of information resources, attacks that consume network bandwidth, processor cycles, or disk space all impact the availability of a system.

 CVSS:4.0/AV:N/AC:L/AT:P/PR:N/UI:N/VC:L/VI:L/VA:L/SC:L/SI:N/SA:N

### CVE ID

CVE-2024-52307

### Weaknesses

[CWE-208](/advisories?query=cwe%3A208)

### Credits

* [![@mgerstner](https://avatars.githubusercontent.com/u/24227799?s=40&v=4)](/mgerstner)
  [mgerstner](/mgerstner)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_d4570b06_20250114_184032.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Fcommit%2F5ea4580884f99369f0ccfe484c04cb03a66e65b8)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Fcommit%2F5ea4580884f99369f0ccfe484c04cb03a66e65b8)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=goauthentik%2Fauthentik)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[goauthentik](/goauthentik)
/
**[authentik](/goauthentik/authentik)**
Public

* [Notifications](/login?return_to=%2Fgoauthentik%2Fauthentik) You must be signed in to change notification settings
* [Fork
  984](/login?return_to=%2Fgoauthentik%2Fauthentik)
* [Star
   14.5k](/login?return_to=%2Fgoauthentik%2Fauthentik)

* [Code](/goauthentik/authentik)
* [Issues
  614](/goauthentik/authentik/issues)
* [Pull requests
  114](/goauthentik/authentik/pulls)
* [Discussions](/goauthentik/authentik/discussions)
* [Actions](/goauthentik/authentik/actions)
* [Security](/goauthentik/authentik/security)
* [Insights](/goauthentik/authentik/pulse)

Additional navigation options

* [Code](/goauthentik/authentik)
* [Issues](/goauthentik/authentik/issues)
* [Pull requests](/goauthentik/authentik/pulls)
* [Discussions](/goauthentik/authentik/discussions)
* [Actions](/goauthentik/authentik/actions)
* [Security](/goauthentik/authentik/security)
* [Insights](/goauthentik/authentik/pulse)

## Commit

[Permalink](/goauthentik/authentik/commit/5ea4580884f99369f0ccfe484c04cb03a66e65b8)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

security: fix CVE 2024 52307 ([#12115](https://github.com/goauthentik/authentik/pull/12115))

[Browse files](/goauthentik/authentik/tree/5ea4580884f99369f0ccfe484c04cb03a66e65b8)
Browse the repository at this point in the history

```
* security: fix CVE-2024-52307

Signed-off-by: Jens Langhammer <jens@goauthentik.io>

* add docs

Signed-off-by: Jens Langhammer <jens@goauthentik.io>

* fix tests

Signed-off-by: Jens Langhammer <jens@goauthentik.io>

---------

Signed-off-by: Jens Langhammer <jens@goauthentik.io>
```

* Loading branch information

[![@BeryJu](https://avatars.githubusercontent.com/u/1932513?s=40&v=4)](/BeryJu)

[BeryJu](/goauthentik/authentik/commits?author=BeryJu "View all commits by BeryJu")
authored
Nov 21, 2024

1 parent
[e9c29e1](/goauthentik/authentik/commit/e9c29e1644e9199b4ba58d2b10eb8c322138eea2)

commit 5ea4580

 Show file tree

 Hide file tree

Showing
**7 changed files**
with
**87 additions**
and
**20 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* authentik/root

  + authentik/root/monitoring.py
    [monitoring.py](#diff-2b54499b31eb9b8882d0687bace82233a99b49f10cb5e0c47f200a0635bdabd2)
  + authentik/root/tests.py
    [tests.py](#diff-12432f091066849c1078ffb9b42f75dba8373d812110bde2e703bcdc41992793)
* internal/web

  + internal/web/metrics.go
    [metrics.go](#diff-ecf2d61c9b32476bb49b1fe68b64546d3a4abdfa8963f99f6f33e6303e3d4e5d)
  + internal/web/web.go
    [web.go](#diff-7293ff93fbf8f2eda2ab11650a35222acd1e269601669e270478acd3b5b4c413)
* website

  + docs

    - developer-docs/releases

      * website/docs/developer-docs/releases/index.md
        [index.md](#diff-7870d05e37468088f92305901ac0b0109af4d81cfd18e788d91ebf845f2d9929)
    - security/cves

      * website/docs/security/cves/CVE-2024-52307.md
        [CVE-2024-52307.md](#diff-605a90428c773d16f6807e9d7386ec311581a23d0bbc3a42a7bd788ed570a6c4)
  + website/sidebars.js
    [sidebars.js](#diff-4caaf3187919c98f42856c140e32964b0829fc19165f3c989a6cd4ea088a7164)

## There are no files selected for viewing

21 changes: 11 additions & 10 deletions

21
[authentik/root/monitoring.py](#diff-2b54499b31eb9b8882d0687bace82233a99b49f10cb5e0c47f200a0635bdabd2 "authentik/root/monitoring.py")

Show comments

[View file](/goauthentik/authentik/blob/5ea4580884f99369f0ccfe484c04cb03a66e65b8/authentik/root/monitoring.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,6 +1,8 @@ |
|  |  | """Metrics view""" |
|  |  |  |
|  |  | from base64 import b64encode |
|  |  | from hmac import compare\_digest |
|  |  | from pathlib import Path |
|  |  | from tempfile import gettempdir |
|  |  |  |
|  |  | from django.conf import settings |
|  |  | from django.db import connections |
| Expand All | | @@ -16,22 +18,21 @@ |
|  |  |  |
|  |  |  |
|  |  | class MetricsView(View): |
|  |  | """Wrapper around ExportToDjangoView, using http-basic auth""" |
|  |  | """Wrapper around ExportToDjangoView with authentication, accessed by the authentik router""" |
|  |  |  |
|  |  | def \_\_init\_\_(self, \*\*kwargs): |
|  |  | \_tmp = Path(gettempdir()) |
|  |  | with open(\_tmp / "authentik-core-metrics.key") as \_f: |
|  |  | self.monitoring\_key = \_f.read() |
|  |  |  |
|  |  | def get(self, request: HttpRequest) -> HttpResponse: |
|  |  | """Check for HTTP-Basic auth""" |
|  |  | auth\_header = request.META.get("HTTP\_AUTHORIZATION", "") |
|  |  | auth\_type, \_, given\_credentials = auth\_header.partition(" ") |
|  |  | credentials = f"monitor:{settings.SECRET\_KEY}" |
|  |  | expected = b64encode(str.encode(credentials)).decode() |
|  |  | authed = auth\_type == "Basic" and given\_credentials == expected |
|  |  | authed = auth\_type == "Bearer" and compare\_digest(given\_credentials, self.monitoring\_key) |
|  |  | if not authed and not settings.DEBUG: |
|  |  | response = HttpResponse(status=401) |
|  |  | response["WWW-Authenticate"] = 'Basic realm="authentik-monitoring"' |
|  |  | return response |
|  |  |  |
|  |  | return HttpResponse(status=401) |
|  |  | monitoring\_set.send\_robust(self) |
|  |  |  |
|  |  | return ExportToDjangoView(request) |
|  |  |  |
|  |  |  |
| Expand Down | |  |

18 changes: 14 additions & 4 deletions

18
[authentik/root/tests.py](#diff-12432f091066849c1078ffb9b42f75dba8373d812110bde2e703bcdc41992793 "authentik/root/tests.py")

Show comments

[View file](/goauthentik/authentik/blob/5ea4580884f99369f0ccfe484c04cb03a66e65b8/authentik/root/tests.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,24 +1,34 @@ |
|  |  | """root tests""" |
|  |  |  |
|  |  | from base64 import b64encode |
|  |  | from pathlib import Path |
|  |  | from secrets import token\_urlsafe |
|  |  | from tempfile import gettempdir |
|  |  |  |
|  |  | from django.conf import settings |
|  |  | from django.test import TestCase |
|  |  | from django.urls import reverse |
|  |  |  |
|  |  |  |
|  |  | class TestRoot(TestCase): |
|  |  | """Test root application""" |
|  |  |  |
|  |  | def setUp(self): |
|  |  | \_tmp = Path(gettempdir()) |
|  |  | self.token = token\_urlsafe(32) |
|  |  | with open(\_tmp / "authentik-core-metrics.key", "w") as \_f: |
|  |  | \_f.write(self.token) |
|  |  |  |
|  |  | def tearDown(self): |
|  |  | \_tmp = Path(gettempdir()) |
|  |  | (\_tmp / "authentik-core-metrics.key").unlink() |
|  |  |  |
|  |  | def test\_monitoring\_error(self): |
|  |  | """Test monitoring without any credentials""" |
|  |  | response = self.client.get(reverse("metrics")) |
|  |  | self.assertEqual(response.status\_code, 401) |
|  |  |  |
|  |  | def test\_monitoring\_ok(self): |
|  |  | """Test monitoring with credentials""" |
|  |  | creds = "Basic " + b64encode(f"monitor:{settings.SECRET\_KEY}".encode()).decode("utf-8") |
|  |  | auth\_headers = {"HTTP\_AUTHORIZATION": creds} |
|  |  | auth\_headers = {"HTTP\_AUTHORIZATION": f"Bearer {self.token}"} |
|  |  | response = self.client.get(reverse("metrics"), \*\*auth\_headers) |
|  |  | self.assertEqual(response.status\_code, 200) |
|  |  |  |
| Expand Down | |  |

25 changes: 22 additions & 3 deletions

25
[internal/web/metrics.go](#diff-ecf2d61c9b32476bb49b1fe68b64546d3a4abdfa8963f99f6f33e6303e3d4e5d "internal/web/metrics.go")

Show comments

[View file](/goauthentik/authentik/blob/5ea4580884f99369f0ccfe484c04cb03a66e65b8/internal/web/metrics.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,11 +1,15 @@ |
|  |  | package web |
|  |  |  |
|  |  | import ( |
|  |  | "encoding/base64" |
|  |  | "fmt" |
|  |  | "io" |
|  |  | "net/http" |
|  |  | "os" |
|  |  | "path" |
|  |  |  |
|  |  | "github.com/gorilla/mux" |
|  |  | "github.com/gorilla/securecookie" |
|  |  | "github.com/prometheus/client\_golang/prometheus" |
|  |  | "github.com/prometheus/client\_golang/prometheus/promauto" |
|  |  | "github.com/prometheus/client\_golang/prometheus/promhttp" |
| Expand All | | @@ -14,14 +18,25 @@ import ( |
|  |  | "goauthentik.io/internal/utils/sentry" |
|  |  | ) |
|  |  |  |
|  |  | const MetricsKeyFile = "authentik-core-metrics.key" |
|  |  |  |
|  |  | var Requests = promauto.NewHistogramVec(prometheus.HistogramOpts{ |
|  |  | Name: "authentik\_main\_request\_duration\_seconds", |
|  |  | Help: "API request latencies in seconds", |
|  |  | }, []string{"dest"}) |
|  |  |  |
|  |  | func (ws \*WebServer) runMetricsServer() { |
|  |  | m := mux.NewRouter() |
|  |  | l := log.WithField("logger", "authentik.router.metrics") |
|  |  | tmp := os.TempDir() |
|  |  | key := base64.StdEncoding.EncodeToString(securecookie.GenerateRandomKey(64)) |
|  |  | keyPath := path.Join(tmp, MetricsKeyFile) |
|  |  | err := os.WriteFile(keyPath, []byte(key), 0o600) |
|  |  | if err != nil { |
|  |  | l.WithError(err).Warning("failed to save metrics key") |
|  |  | return |
|  |  | } |
|  |  |  |
|  |  | m := mux.NewRouter() |
|  |  | m.Use(sentry.SentryNoSampleMiddleware) |
|  |  | m.Path("/metrics").HandlerFunc(func(rw http.ResponseWriter, r \*http.Request) { |
|  |  | promhttp.InstrumentMetricHandler( |
| Expand All | | @@ -36,7 +51,7 @@ func (ws \*WebServer) runMetricsServer() { |
|  |  | l.WithError(err).Warning("failed to get upstream metrics") |
|  |  | return |
|  |  | } |
|  |  | re.SetBasicAuth("monitor", config.Get().SecretKey) |
|  |  | re.Header.Set("Authorization", fmt.Sprintf("Bearer %s", key)) |
|  |  | res, err := ws.upstreamHttpClient().Do(re) |
|  |  | if err != nil { |
|  |  | l.WithError(err).Warning("failed to get upstream metrics") |
| Expand All | | @@ -49,9 +64,13 @@ func (ws \*WebServer) runMetricsServer() { |
|  |  | } |
|  |  | }) |
|  |  | l.WithField("listen", config.Get().Listen.Metrics).Info("Starting Metrics server") |
|  |  | err := http.ListenAndServe(config.Get().Listen.Metrics, m) |
|  |  | err = http.ListenAndServe(config.Get().Listen.Metrics, m) |
|  |  | if err != nil { |
|  |  | l.WithError(err).Warning("Failed to start metrics server") |
|  |  | } |
|  |  | l.WithField("listen", config.Get().Listen.Metrics).Info("Stopping Metrics server") |
|  |  | err = os.Remove(keyPath) |
|  |  | if err != nil { |
|  |  | l.WithError(err).Warning("failed to remove metrics key file") |
|  |  | } |
|  |  | } |

2 changes: 1 addition & 1 deletion

2
[internal/web/web.go](#diff-7293ff93fbf8f2eda2ab11650a35222acd1e269601669e270478acd3b5b4c413 "internal/web/web.go")

Show comments

[View file](/goauthentik/authentik/blob/5ea4580884f99369f0ccfe484c04cb03a66e65b8/internal/web/web.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -53,7 +53,7 @@ func NewWebServer() \*WebServer { |
|  |  | loggingHandler.Use(web.NewLoggingHandler(l, nil)) |
|  |  |  |
|  |  | tmp := os.TempDir() |
|  |  | socketPath := path.Join(tmp, "authentik-core.sock") |
|  |  | socketPath := path.Join(tmp, UnixSocketName) |
|  |  |  |
|  |  | // create http client to talk to backend, normal client if we're in debug more |
|  |  | // and a client that connects to our socket when in non debug mode |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[website/docs/developer-docs/releases/index.md](#diff-7870d05e37468088f92305901ac0b0109af4d81cfd18e788d91ebf845f2d9929 "website/docs/developer-docs/releases/index.md")

Show comments

[View file](/goauthentik/authentik/blob/5ea4580884f99369f0ccfe484c04cb03a66e65b8/website/docs/developer-docs/releases/index.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -78,7 +78,7 @@ Short summary of the issue |
|  |  |  |
|  |  | ### Patches |
|  |  |  |
|  |  | authentik x, y and z fix this issue, for other versions the workaround can be used. |
|  |  | authentik x, y and z fix this issue, for other versions the workaround below can be used. |
|  |  |  |
|  |  | ### Impact |
|  |  |  |
| Expand All | | @@ -96,7 +96,7 @@ Describe a workaround if possible |
|  |  |  |
|  |  | If you have any questions or comments about this advisory: |
|  |  |  |
|  |  | - Email us at [security@goauthentik.io](mailto:security@goauthentik.io) |
|  |  | - Email us at [security@goauthentik.io](mailto:security@goauthentik.io). |
|  |  | ``` |
|  |  |  |
|  |  | </details> |
| Expand Down | |  |

36 changes: 36 additions & 0 deletions

36
[website/docs/security/cves/CVE-2024-52307.md](#diff-605a90428c773d16f6807e9d7386ec311581a23d0bbc3a42a7bd788ed570a6c4 "website/docs/security/cves/CVE-2024-52307.md")

Show comments

[View file](/goauthentik/authentik/blob/5ea4580884f99369f0ccfe484c04cb03a66e65b8/website/docs/security/cves/CVE-2024-52307.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,36 @@ |
|  |  | # CVE-2024-52307 |
|  |  |  |
|  |  | \_Reported by [@mgerstner](https://github.com/mgerstner)\_ |
|  |  |  |
|  |  | ## Timing attack due to a lack of constant time comparison for metrics view |
|  |  |  |
|  |  | ### Summary |
|  |  |  |
|  |  | Due to the usage of a non-constant time comparison for the `/-/metrics/` endpoint it was possible to brute-force the `SECRET\_KEY`, which is used to authenticate the endpoint. The `/-/metrics/` endpoint returns Prometheus metrics and is not intended to be accessed directly, as the Go proxy running in the authentik server container fetches data from this endpoint and serves it on a separate port (9300 by default), which can be scraped by Prometheus without being exposed publicly. |
|  |  |  |
|  |  | ### Patches |
|  |  |  |
|  |  | authentik 2024.8.5 and 2024.10.3 fix this issue, for other versions the workaround below can be used. |
|  |  |  |
|  |  | ### Impact |
|  |  |  |
|  |  | With enough attempts the `SECRET\_KEY` of the authentik installation can be brute-forced, which can be used to sign new or modify existing cookies. |
|  |  |  |
|  |  | ### Workarounds |
|  |  |  |
|  |  | Since the `/-/metrics/` endpoint is not intended to be accessed publicly, requests to the endpoint can be blocked by the reverse proxy/load balancer used in conjunction with authentik. |
|  |  |  |
|  |  | For example for nginx: |
|  |  |  |
|  |  | ``` |
|  |  | location /-/metrics/ { |
|  |  | deny all; |
|  |  | return 404; |
|  |  | } |
|  |  | ``` |
|  |  |  |
|  |  | ### For more information |
|  |  |  |
|  |  | If you have any questions or comments about this advisory: |
|  |  |  |
|  |  | - Email us at [security@goauthentik.io](mailto:security@goauthentik.io). |

1 change: 1 addition & 0 deletions

1
[website/sidebars.js](#diff-4caaf3187919c98f42856c140e32964b0829fc19165f3c989a6cd4ea088a7164 "website/sidebars.js")

Show comments

[View file](/goauthentik/authentik/blob/5ea4580884f99369f0ccfe484c04cb03a66e65b8/website/sidebars.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -658,6 +658,7 @@ export default { |
|  |  | type: "category", |
|  |  | label: "2024", |
|  |  | items: [ |
|  |  | "security/cves/CVE-2024-52307", |
|  |  | "security/cves/CVE-2024-52287", |
|  |  | "security/cves/CVE-2024-47077", |
|  |  | "security/cves/CVE-2024-47070", |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `5ea4580`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Fcommit%2F5ea4580884f99369f0ccfe484c04cb03a66e65b8) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


