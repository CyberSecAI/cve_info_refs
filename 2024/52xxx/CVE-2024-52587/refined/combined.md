=== Content from github.com_7bcae601_20250114_213341.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fstep-security%2Fharden-runner%2Fsecurity%2Fadvisories%2FGHSA-g85v-wf27-67xc)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fstep-security%2Fharden-runner%2Fsecurity%2Fadvisories%2FGHSA-g85v-wf27-67xc)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=step-security%2Fharden-runner)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[step-security](/step-security)
/
**[harden-runner](/step-security/harden-runner)**
Public

* [Notifications](/login?return_to=%2Fstep-security%2Fharden-runner) You must be signed in to change notification settings
* [Fork
  52](/login?return_to=%2Fstep-security%2Fharden-runner)
* [Star
   645](/login?return_to=%2Fstep-security%2Fharden-runner)

* [Code](/step-security/harden-runner)
* [Issues
  19](/step-security/harden-runner/issues)
* [Pull requests
  9](/step-security/harden-runner/pulls)
* [Discussions](/step-security/harden-runner/discussions)
* [Actions](/step-security/harden-runner/actions)
* [Projects
  0](/step-security/harden-runner/projects)
* [Security](/step-security/harden-runner/security)
* [Insights](/step-security/harden-runner/pulse)

Additional navigation options

* [Code](/step-security/harden-runner)
* [Issues](/step-security/harden-runner/issues)
* [Pull requests](/step-security/harden-runner/pulls)
* [Discussions](/step-security/harden-runner/discussions)
* [Actions](/step-security/harden-runner/actions)
* [Projects](/step-security/harden-runner/projects)
* [Security](/step-security/harden-runner/security)
* [Insights](/step-security/harden-runner/pulse)

# Command injection weaknesses in `setup.ts` and `arc-runner.ts`

Low

[varunsh-coder](/varunsh-coder)
published
GHSA-g85v-wf27-67xc
Nov 18, 2024

## Package

actions

step-security/harden-runner
([GitHub Actions](/advisories?query=ecosystem%3Aactions))

## Affected versions

< v2.10.2

## Patched versions

v2.10.2

## Description

### Summary

Versions of step-security/harden-runner prior to v2.10.2 contain multiple command injection weaknesses via environment variables that could potentially be exploited under specific conditions. However, due to the current execution order of pre-steps in GitHub Actions and the placement of harden-runner as the first step in a job, the likelihood of exploitation is low as the Harden-Runner action reads the environment variable during the pre-step stage. There are no known exploits at this time.

### Details

1. setup.ts:169 [1](https://github.com/step-security/harden-runner/blob/951b48540b429070694bc8abd82fd6901eb123ca/src/setup.ts#L169) performs `execSync` with a command that gets

   invoked after interpretation by the shell. This command includes an

   interpolated `process.env.USER` variable, which an attacker could

   modify (without actually creating a new user) to inject arbitrary

   shell expressions into this `execSync`. This may or may not be likely

   in practice, but I believe the hygienic way to perform the underlying

   operation is to use `execFileSync` or similar and bypass the

   underlying shell evaluation.
2. setup.ts:229 [2](https://github.com/step-security/harden-runner/blob/951b48540b429070694bc8abd82fd6901eb123ca/src/setup.ts#L229) has a nearly identical `execSync` to (1) above,

   but with `$USER` for shell-level interpolation rather than string

   interpolation. However, this is still injectable and would be best

   replaced by an `execFileSync`, per above.
3. arc-runner:40-44 [3](https://github.com/step-security/harden-runner/blob/951b48540b429070694bc8abd82fd6901eb123ca/src/arc-runner.ts#L40-L44) has an `execSync` with multiple string

   interpolations. Most of these do not appear immediately injectible

   (since they appear to come from presumed trusted API responses), but

   the expansion of `getRunnerTempDir()` may be injectable due to its

   dependence on potentially attacker-controllable environment variables

   (e.g. `RUNNER_TEMP`). The underlying operation appears to be a trivial

   file copy, so this entire subprocess should in theory be replaceable

   with ordinary NodeJS `fs` API calls instead.
4. arc-runner:53 [4](https://github.com/step-security/harden-runner/blob/951b48540b429070694bc8abd82fd6901eb123ca/src/arc-runner.ts#L53) demonstrates the same weakness, and has the same

   resolution as (3).
5. arc-runner:57 demonstrates the same weakness as (3) and (4), and

   has the same resolution.
6. arc-runner:61 demonstrates the same weakness as (3), (4), and (5),

   and has the same resolution.

### Acknowledgment

We thank [@woodruffw](https://github.com/woodruffw) for the thorough analysis, bringing these issues to our attention, and working with us on the fix.

### Severity

Low

### CVE ID

CVE-2024-52587

### Weaknesses

[CWE-78](/advisories?query=cwe%3A78)

### Credits

* [![@woodruffw](https://avatars.githubusercontent.com/u/3059210?s=40&v=4)](/woodruffw)
  [woodruffw](/woodruffw)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_04ac9b51_20250114_213327.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fstep-security%2Fharden-runner%2Fblob%2F951b48540b429070694bc8abd82fd6901eb123ca%2Fsrc%2Farc-runner.ts)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fstep-security%2Fharden-runner%2Fblob%2F951b48540b429070694bc8abd82fd6901eb123ca%2Fsrc%2Farc-runner.ts)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=step-security%2Fharden-runner)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[step-security](/step-security)
/
**[harden-runner](/step-security/harden-runner)**
Public

* [Notifications](/login?return_to=%2Fstep-security%2Fharden-runner) You must be signed in to change notification settings
* [Fork
  52](/login?return_to=%2Fstep-security%2Fharden-runner)
* [Star
   645](/login?return_to=%2Fstep-security%2Fharden-runner)

* [Code](/step-security/harden-runner)
* [Issues
  19](/step-security/harden-runner/issues)
* [Pull requests
  9](/step-security/harden-runner/pulls)
* [Discussions](/step-security/harden-runner/discussions)
* [Actions](/step-security/harden-runner/actions)
* [Projects
  0](/step-security/harden-runner/projects)
* [Security](/step-security/harden-runner/security)
* [Insights](/step-security/harden-runner/pulse)

Additional navigation options

* [Code](/step-security/harden-runner)
* [Issues](/step-security/harden-runner/issues)
* [Pull requests](/step-security/harden-runner/pulls)
* [Discussions](/step-security/harden-runner/discussions)
* [Actions](/step-security/harden-runner/actions)
* [Projects](/step-security/harden-runner/projects)
* [Security](/step-security/harden-runner/security)
* [Insights](/step-security/harden-runner/pulse)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_d8566a31_20250114_213331.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fstep-security%2Fharden-runner%2Fblob%2F951b48540b429070694bc8abd82fd6901eb123ca%2Fsrc%2Fsetup.ts)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fstep-security%2Fharden-runner%2Fblob%2F951b48540b429070694bc8abd82fd6901eb123ca%2Fsrc%2Fsetup.ts)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=step-security%2Fharden-runner)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[step-security](/step-security)
/
**[harden-runner](/step-security/harden-runner)**
Public

* [Notifications](/login?return_to=%2Fstep-security%2Fharden-runner) You must be signed in to change notification settings
* [Fork
  52](/login?return_to=%2Fstep-security%2Fharden-runner)
* [Star
   645](/login?return_to=%2Fstep-security%2Fharden-runner)

* [Code](/step-security/harden-runner)
* [Issues
  19](/step-security/harden-runner/issues)
* [Pull requests
  9](/step-security/harden-runner/pulls)
* [Discussions](/step-security/harden-runner/discussions)
* [Actions](/step-security/harden-runner/actions)
* [Projects
  0](/step-security/harden-runner/projects)
* [Security](/step-security/harden-runner/security)
* [Insights](/step-security/harden-runner/pulse)

Additional navigation options

* [Code](/step-security/harden-runner)
* [Issues](/step-security/harden-runner/issues)
* [Pull requests](/step-security/harden-runner/pulls)
* [Discussions](/step-security/harden-runner/discussions)
* [Actions](/step-security/harden-runner/actions)
* [Projects](/step-security/harden-runner/projects)
* [Security](/step-security/harden-runner/security)
* [Insights](/step-security/harden-runner/pulse)

## Files

 951b485
## Breadcrumbs

1. [harden-runner](/step-security/harden-runner/tree/951b48540b429070694bc8abd82fd6901eb123ca)
2. /[src](/step-security/harden-runner/tree/951b48540b429070694bc8abd82fd6901eb123ca/src)
/
# setup.ts

Copy path Blame  Blame
## Latest commit

## History

[History](/step-security/harden-runner/commits/951b48540b429070694bc8abd82fd6901eb123ca/src/setup.ts)308 lines (278 loc) · 9.67 KB 951b485
## Breadcrumbs

1. [harden-runner](/step-security/harden-runner/tree/951b48540b429070694bc8abd82fd6901eb123ca)
2. /[src](/step-security/harden-runner/tree/951b48540b429070694bc8abd82fd6901eb123ca/src)
/
# setup.ts

Top
## File metadata and controls

* Code
* Blame

308 lines (278 loc) · 9.67 KB[Raw](https://github.com/step-security/harden-runner/raw/951b48540b429070694bc8abd82fd6901eb123ca/src/setup.ts)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308import \* as core from "@actions/core";import \* as cp from "child\_process";import \* as fs from "fs";import \* as httpm from "@actions/http-client";import \* as path from "path";import { v4 as uuidv4 } from "uuid";import \* as common from "./common";import \* as tc from "@actions/tool-cache";import { verifyChecksum } from "./checksum";import isDocker from "is-docker";import { context } from "@actions/github";import { EOL } from "os";import { ArtifactCacheEntry, cacheKey, cacheFile, CompressionMethod, isValidEvent,} from "./cache";import { Configuration, PolicyResponse } from "./interfaces";import { fetchPolicy, mergeConfigs } from "./policy-utils";import \* as cache from "@actions/cache";import { getCacheEntry } from "@actions/cache/lib/internal/cacheHttpClient";import \* as utils from "@actions/cache/lib/internal/cacheUtils";import { isArcRunner, sendAllowedEndpoints } from "./arc-runner";import { STEPSECURITY\_API\_URL, STEPSECURITY\_WEB\_URL } from "./configs";import { isGithubHosted, isTLSEnabled } from "./tls-inspect";
interface MonitorResponse { runner\_ip\_address?: string; one\_time\_key?: string; monitoring\_started?: boolean;}
(async () => { try { console.log("[harden-runner] pre-step");
 if (process.platform !== "linux") { console.log(common.UBUNTU\_MESSAGE); return; } if (isDocker()) { console.log(common.CONTAINER\_MESSAGE); return; }
 var correlation\_id = uuidv4(); var api\_url = STEPSECURITY\_API\_URL; var web\_url = STEPSECURITY\_WEB\_URL;
 let confg: Configuration = { repo: process.env["GITHUB\_REPOSITORY"], run\_id: process.env["GITHUB\_RUN\_ID"], correlation\_id: correlation\_id, working\_directory: process.env["GITHUB\_WORKSPACE"], api\_url: api\_url, allowed\_endpoints: core.getInput("allowed-endpoints"), egress\_policy: core.getInput("egress-policy"), disable\_telemetry: core.getBooleanInput("disable-telemetry"), disable\_sudo: core.getBooleanInput("disable-sudo"), disable\_file\_monitoring: core.getBooleanInput("disable-file-monitoring"), private: context?.payload?.repository?.private || false, is\_github\_hosted: isGithubHosted(), is\_debug: core.isDebug(), one\_time\_key: "", };
 let policyName = core.getInput("policy"); if (policyName !== "") { console.log(`Fetching policy from API with name: ${policyName}`); try { let idToken: string = await core.getIDToken(); let result: PolicyResponse = await fetchPolicy( context.repo.owner, policyName, idToken ); confg = mergeConfigs(confg, result); } catch (err) { core.info(`[!] ${err}`); core.setFailed(err); } } fs.appendFileSync( process.env.GITHUB\_STATE, `disableSudo=${confg.disable\_sudo}${EOL}`, { encoding: "utf8", } ); core.info(`[!] Current Configuration: \n${JSON.stringify(confg)}\n`);
 if (confg.egress\_policy !== "audit" && confg.egress\_policy !== "block") { core.setFailed("egress-policy must be either audit or block"); }
 if (confg.egress\_policy === "block" && confg.allowed\_endpoints === "") { core.warning( "egress-policy is set to block (default) and allowed-endpoints is empty. No outbound traffic will be allowed for job steps." ); }
 if (confg.disable\_telemetry !== true && confg.disable\_telemetry !== false) { core.setFailed("disable-telemetry must be a boolean value"); }
 if (isValidEvent() && confg.egress\_policy === "block") { try { const cacheResult = await cache.saveCache( [path.join(\_\_dirname, "cache.txt")], cacheKey ); console.log(cacheResult); } catch (exception) { console.log(exception); } try { const compressionMethod: CompressionMethod = await utils.getCompressionMethod(); const cacheFilePath = path.join(\_\_dirname, "cache.txt"); core.info(`cacheFilePath ${cacheFilePath}`); const cacheEntry: ArtifactCacheEntry = await getCacheEntry( [cacheKey], [cacheFilePath], { compressionMethod: compressionMethod, } ); const url = new URL(cacheEntry.archiveLocation); core.info(`Adding cacheHost: ${url.hostname}:443 to allowed-endpoints`); confg.allowed\_endpoints += ` ${url.hostname}:443`; } catch (exception) { // some exception has occurred. core.info(`Unable to fetch cacheURL`); if (confg.egress\_policy === "block") { core.info("Switching egress-policy to audit mode"); confg.egress\_policy = "audit"; } } }
 if (!confg.disable\_telemetry || confg.egress\_policy === "audit") { common.printInfo(web\_url); }
 if (isArcRunner()) { console.log(`[!] ${common.ARC\_RUNNER\_MESSAGE}`); if (confg.egress\_policy === "block") { sendAllowedEndpoints(confg.allowed\_endpoints); await sleep(10000); } return; }
 const runnerName = process.env.RUNNER\_NAME || ""; core.info(`RUNNER\_NAME: ${runnerName}`); if (!isGithubHosted()) { fs.appendFileSync(process.env.GITHUB\_STATE, `selfHosted=true${EOL}`, { encoding: "utf8", }); if (!fs.existsSync("/home/agent/agent")) { core.info(common.SELF\_HOSTED\_NO\_AGENT\_MESSAGE); return; } if (confg.egress\_policy === "block") { try { if (process.env.USER) { cp.execSync(`sudo chown -R ${process.env.USER} /home/agent`); } const confgStr = JSON.stringify(confg); fs.writeFileSync("/home/agent/block\_event.json", confgStr); await sleep(5000); } catch (error) { core.info(`[!] Unable to write block\_event.json: ${error}`); } } return; }
 let \_http = new httpm.HttpClient(); let statusCode; \_http.requestOptions = { socketTimeout: 3 \* 1000 }; let addSummary = "false"; try { const monitorRequestData = { correlation\_id: correlation\_id, job: process.env["GITHUB\_JOB"], }; const resp = await \_http.postJson<MonitorResponse>( `${api\_url}/github/${process.env["GITHUB\_REPOSITORY"]}/actions/runs/${process.env["GITHUB\_RUN\_ID"]}/monitor`, monitorRequestData );
 const responseData = resp.result; statusCode = resp.statusCode; // adding error code to check whether agent is getting installed or not. fs.appendFileSync( process.env.GITHUB\_STATE, `monitorStatusCode=${statusCode}${EOL}`, { encoding: "utf8", } );
 if (statusCode === 200 && responseData) { console.log(`Runner IP Address: ${responseData.runner\_ip\_address}`); confg.one\_time\_key = responseData.one\_time\_key; addSummary = responseData.monitoring\_started ? "true" : "false"; } } catch (e) { console.log(`error in connecting to ${api\_url}: ${e}`); } fs.appendFileSync( process.env.GITHUB\_STATE, `addSummary=${addSummary}${EOL}`, { encoding: "utf8", } );
 console.log(`Step Security Job Correlation ID: ${correlation\_id}`); if (String(statusCode) === common.STATUS\_HARDEN\_RUNNER\_UNAVAILABLE) { console.log(common.HARDEN\_RUNNER\_UNAVAILABLE\_MESSAGE); return; }
 const confgStr = JSON.stringify(confg); cp.execSync("sudo mkdir -p /home/agent"); cp.execSync("sudo chown -R $USER /home/agent");
 // Note: to avoid github rate limiting let token = core.getInput("token"); let auth = `token ${token}`;
 let downloadPath: string;
 if (await isTLSEnabled(context.repo.owner)) { downloadPath = await tc.downloadTool( "https://packages.stepsecurity.io/github-hosted/harden-runner\_1.2.3\_linux\_amd64.tar.gz" ); verifyChecksum(downloadPath, true); // NOTE: verifying tls\_agent's checksum, before extracting } else { downloadPath = await tc.downloadTool( "https://github.com/step-security/agent/releases/download/v0.13.7/agent\_0.13.7\_linux\_amd64.tar.gz", undefined, auth );
 verifyChecksum(downloadPath, false); // NOTE: verifying agent's checksum, before extracting }
 const extractPath = await tc.extractTar(downloadPath);
 let cmd = "cp", args = [path.join(extractPath, "agent"), "/home/agent/agent"];
 cp.execFileSync(cmd, args);
 cp.execSync("chmod +x /home/agent/agent");
 fs.writeFileSync("/home/agent/agent.json", confgStr);
 cmd = "sudo"; args = [ "cp", path.join(\_\_dirname, "agent.service"), "/etc/systemd/system/agent.service", ]; cp.execFileSync(cmd, args); cp.execSync("sudo systemctl daemon-reload"); cp.execSync("sudo service agent start", { timeout: 15000 });
 // Check that the file exists locally var statusFile = "/home/agent/agent.status"; var logFile = "/home/agent/agent.log"; var counter = 0; while (true) { if (!fs.existsSync(statusFile)) { counter++; if (counter > 30) { console.log("timed out"); if (fs.existsSync(logFile)) { var content = fs.readFileSync(logFile, "utf-8"); console.log(content); } break; } await sleep(300); } // The file \*does\* exist else { // Read the file var content = fs.readFileSync(statusFile, "utf-8"); console.log(content); break; } } } catch (error) { core.setFailed(error.message); } // see https://github.com/ruby/setup-ruby/issues/543 process.exit(0);})();
export function sleep(ms) { return new Promise((resolve) => { setTimeout(resolve, ms); });}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_8bc4ea80_20250114_213325.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fstep-security%2Fharden-runner%2Fblob%2F951b48540b429070694bc8abd82fd6901eb123ca%2Fsrc%2Farc-runner.ts)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fstep-security%2Fharden-runner%2Fblob%2F951b48540b429070694bc8abd82fd6901eb123ca%2Fsrc%2Farc-runner.ts)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=step-security%2Fharden-runner)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[step-security](/step-security)
/
**[harden-runner](/step-security/harden-runner)**
Public

* [Notifications](/login?return_to=%2Fstep-security%2Fharden-runner) You must be signed in to change notification settings
* [Fork
  52](/login?return_to=%2Fstep-security%2Fharden-runner)
* [Star
   645](/login?return_to=%2Fstep-security%2Fharden-runner)

* [Code](/step-security/harden-runner)
* [Issues
  19](/step-security/harden-runner/issues)
* [Pull requests
  9](/step-security/harden-runner/pulls)
* [Discussions](/step-security/harden-runner/discussions)
* [Actions](/step-security/harden-runner/actions)
* [Projects
  0](/step-security/harden-runner/projects)
* [Security](/step-security/harden-runner/security)
* [Insights](/step-security/harden-runner/pulse)

Additional navigation options

* [Code](/step-security/harden-runner)
* [Issues](/step-security/harden-runner/issues)
* [Pull requests](/step-security/harden-runner/pulls)
* [Discussions](/step-security/harden-runner/discussions)
* [Actions](/step-security/harden-runner/actions)
* [Projects](/step-security/harden-runner/projects)
* [Security](/step-security/harden-runner/security)
* [Insights](/step-security/harden-runner/pulse)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_100871e1_20250114_213327.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fstep-security%2Fharden-runner%2Fblob%2F951b48540b429070694bc8abd82fd6901eb123ca%2Fsrc%2Farc-runner.ts)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fstep-security%2Fharden-runner%2Fblob%2F951b48540b429070694bc8abd82fd6901eb123ca%2Fsrc%2Farc-runner.ts)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=step-security%2Fharden-runner)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[step-security](/step-security)
/
**[harden-runner](/step-security/harden-runner)**
Public

* [Notifications](/login?return_to=%2Fstep-security%2Fharden-runner) You must be signed in to change notification settings
* [Fork
  52](/login?return_to=%2Fstep-security%2Fharden-runner)
* [Star
   645](/login?return_to=%2Fstep-security%2Fharden-runner)

* [Code](/step-security/harden-runner)
* [Issues
  19](/step-security/harden-runner/issues)
* [Pull requests
  9](/step-security/harden-runner/pulls)
* [Discussions](/step-security/harden-runner/discussions)
* [Actions](/step-security/harden-runner/actions)
* [Projects
  0](/step-security/harden-runner/projects)
* [Security](/step-security/harden-runner/security)
* [Insights](/step-security/harden-runner/pulse)

Additional navigation options

* [Code](/step-security/harden-runner)
* [Issues](/step-security/harden-runner/issues)
* [Pull requests](/step-security/harden-runner/pulls)
* [Discussions](/step-security/harden-runner/discussions)
* [Actions](/step-security/harden-runner/actions)
* [Projects](/step-security/harden-runner/projects)
* [Security](/step-security/harden-runner/security)
* [Insights](/step-security/harden-runner/pulse)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_4dd467e3_20250114_213338.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fstep-security%2Fharden-runner%2Fcommit%2F0080882f6c36860b6ba35c610c98ce87d4e2f26f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fstep-security%2Fharden-runner%2Fcommit%2F0080882f6c36860b6ba35c610c98ce87d4e2f26f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=step-security%2Fharden-runner)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[step-security](/step-security)
/
**[harden-runner](/step-security/harden-runner)**
Public

* [Notifications](/login?return_to=%2Fstep-security%2Fharden-runner) You must be signed in to change notification settings
* [Fork
  52](/login?return_to=%2Fstep-security%2Fharden-runner)
* [Star
   645](/login?return_to=%2Fstep-security%2Fharden-runner)

* [Code](/step-security/harden-runner)
* [Issues
  19](/step-security/harden-runner/issues)
* [Pull requests
  9](/step-security/harden-runner/pulls)
* [Discussions](/step-security/harden-runner/discussions)
* [Actions](/step-security/harden-runner/actions)
* [Projects
  0](/step-security/harden-runner/projects)
* [Security](/step-security/harden-runner/security)
* [Insights](/step-security/harden-runner/pulse)

Additional navigation options

* [Code](/step-security/harden-runner)
* [Issues](/step-security/harden-runner/issues)
* [Pull requests](/step-security/harden-runner/pulls)
* [Discussions](/step-security/harden-runner/discussions)
* [Actions](/step-security/harden-runner/actions)
* [Projects](/step-security/harden-runner/projects)
* [Security](/step-security/harden-runner/security)
* [Insights](/step-security/harden-runner/pulse)

## Commit

[Permalink](/step-security/harden-runner/commit/0080882f6c36860b6ba35c610c98ce87d4e2f26f)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request [#476](https://github.com/step-security/harden-runner/pull/476) from step-security/rc-16

[Browse files](/step-security/harden-runner/tree/0080882f6c36860b6ba35c610c98ce87d4e2f26f)
Browse the repository at this point in the history

```
Release v2.10.2
```

* Loading branch information

[![@varunsh-coder](https://avatars.githubusercontent.com/u/25015917?s=40&v=4)](/varunsh-coder)

[varunsh-coder](/step-security/harden-runner/commits?author=varunsh-coder "View all commits by varunsh-coder")
authored
Nov 18, 2024

2 parents
[91182cc](/step-security/harden-runner/commit/91182cccc01eb5e619899d80e4e971d6181294a7)
+
[4a3a88b](/step-security/harden-runner/commit/4a3a88bbf8f2e304f84e1042472c02dce37eba82)

commit 0080882

 Show file tree

 Hide file tree

Showing
**11 changed files**
with
**149 additions**
and
**97 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* dist

  + dist/index.js
    [index.js](#diff-3d2b59189eeedc2d428ddd632e97658fe310f587f7cb63b01f9b98ffc11c0197)
  + dist/index.js.map
    [index.js.map](#diff-686e6cd6ce5f2208eb103998759b4c22b099eaa9cd2f06e9b44666c09c2a4c72)
  + post

    - dist/post/index.js
      [index.js](#diff-eea1ca3fdc6a403999c772c2d33850f536e82c0db92f629738e84728892f6c4e)
    - dist/post/index.js.map
      [index.js.map](#diff-7e391e651659d81852cbd3e92dd9a16a2fb71245a2695afba484096f5489e7a2)
  + pre

    - dist/pre/index.js
      [index.js](#diff-334992c518754bdca55e5da37b0c9a8c0e3150438fc14d5d55745493a06dafb4)
    - dist/pre/index.js.map
      [index.js.map](#diff-ce072758453782fcc53865d34cd42708563bb4b300be83cd6f2ee103833ca701)
* src

  + src/arc-runner.test.ts
    [arc-runner.test.ts](#diff-7b02f8f0672eab8e3d205fc9a18b1f09e0cd10482144af10142b643ee96bdcb4)
  + src/arc-runner.ts
    [arc-runner.ts](#diff-c03c3ef0908531b30ec25c75180e9ddb626110662044a3a475b7788e2ff579ac)
  + src/cleanup.ts
    [cleanup.ts](#diff-00def875f44d042f744ce17ba1e10a92590c2e459229ed8fd1f786698da70ce9)
  + src/index.ts
    [index.ts](#diff-a2a171449d862fe29692ce031981047d7ab755ae7f84c707aef80701b3ea0c80)
  + src/setup.ts
    [setup.ts](#diff-5d1af95661c2f11542bf816c46ed8d5f2a014b5666437e05a9f8f00647bd7df1)

## There are no files selected for viewing

48 changes: 46 additions & 2 deletions

48
[dist/index.js](#diff-3d2b59189eeedc2d428ddd632e97658fe310f587f7cb63b01f9b98ffc11c0197 "dist/index.js")

Show comments

[View file](/step-security/harden-runner/blob/0080882f6c36860b6ba35c610c98ce87d4e2f26f/dist/index.js)
Edit file

Delete file

Load diff

Some generated files are not rendered by default. Learn more about [how customized files appear on GitHub](https://docs.github.com/github/administering-a-repository/customizing-how-changed-files-appear-on-github).

Oops, something went wrong.

Retry

2 changes: 1 addition & 1 deletion

2
[dist/index.js.map](#diff-686e6cd6ce5f2208eb103998759b4c22b099eaa9cd2f06e9b44666c09c2a4c72 "dist/index.js.map")

Show comments

[View file](/step-security/harden-runner/blob/0080882f6c36860b6ba35c610c98ce87d4e2f26f/dist/index.js.map)
Edit file

Delete file

Load diff

Large diffs are not rendered by default.

Oops, something went wrong.

Retry

89 changes: 61 additions & 28 deletions

89
[dist/post/index.js](#diff-eea1ca3fdc6a403999c772c2d33850f536e82c0db92f629738e84728892f6c4e "dist/post/index.js")

Show comments

[View file](/step-security/harden-runner/blob/0080882f6c36860b6ba35c610c98ce87d4e2f26f/dist/post/index.js)
Edit file

Delete file

Load diff

Some generated files are not rendered by default. Learn more about [how customized files appear on GitHub](https://docs.github.com/github/administering-a-repository/customizing-how-changed-files-appear-on-github).

Oops, something went wrong.

Retry

2 changes: 1 addition & 1 deletion

2
[dist/post/index.js.map](#diff-7e391e651659d81852cbd3e92dd9a16a2fb71245a2695afba484096f5489e7a2 "dist/post/index.js.map")

Show comments

[View file](/step-security/harden-runner/blob/0080882f6c36860b6ba35c610c98ce87d4e2f26f/dist/post/index.js.map)
Edit file

Delete file

Load diff

Large diffs are not rendered by default.

Oops, something went wrong.

Retry

34 changes: 15 additions & 19 deletions

34
[dist/pre/index.js](#diff-334992c518754bdca55e5da37b0c9a8c0e3150438fc14d5d55745493a06dafb4 "dist/pre/index.js")

Show comments

[View file](/step-security/harden-runner/blob/0080882f6c36860b6ba35c610c98ce87d4e2f26f/dist/pre/index.js)
Edit file

Delete file

Load diff

Some generated files are not rendered by default. Learn more about [how customized files appear on GitHub](https://docs.github.com/github/administering-a-repository/customizing-how-changed-files-appear-on-github).

Oops, something went wrong.

Retry

2 changes: 1 addition & 1 deletion

2
[dist/pre/index.js.map](#diff-ce072758453782fcc53865d34cd42708563bb4b300be83cd6f2ee103833ca701 "dist/pre/index.js.map")

Show comments

[View file](/step-security/harden-runner/blob/0080882f6c36860b6ba35c610c98ce87d4e2f26f/dist/pre/index.js.map)
Edit file

Delete file

Load diff

Large diffs are not rendered by default.

Oops, something went wrong.

Retry

13 changes: 1 addition & 12 deletions

13
[src/arc-runner.test.ts](#diff-7b02f8f0672eab8e3d205fc9a18b1f09e0cd10482144af10142b643ee96bdcb4 "src/arc-runner.test.ts")

Show comments

[View file](/step-security/harden-runner/blob/0080882f6c36860b6ba35c610c98ce87d4e2f26f/src/arc-runner.test.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,20 +1,9 @@ |
|  |  | import { isArcRunner, sendAllowedEndpoints } from "./arc-runner"; |
|  |  |  |
|  |  |  |
|  |  | it("should correctly recognize arc based runner", async () => { |
|  |  | process.env["GITHUB\_ACTIONS\_RUNNER\_EXTRA\_USER\_AGENT"] = |
|  |  | "actions-runner-controller/2.0.1"; |
|  |  |  |
|  |  | let isArc: boolean =  await isArcRunner(); |
|  |  | let isArc: boolean = await isArcRunner(); |
|  |  | expect(isArc).toBe(true); |
|  |  |  |
|  |  | }); |
|  |  |  |
|  |  |  |
|  |  | it("should write endpoint files", ()=>{ |
|  |  | process.env["isTest"] = "1" |
|  |  |  |
|  |  | let allowed\_endpoints = ["github.com:443", "\*.google.com:443", "youtube.com"].join(" "); |
|  |  | sendAllowedEndpoints(allowed\_endpoints); |
|  |  |  |
|  |  | }) |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `0080882`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fstep-security%2Fharden-runner%2Fcommit%2F0080882f6c36860b6ba35c610c98ce87d4e2f26f) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_bd5405a2_20250114_213326.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fstep-security%2Fharden-runner%2Fblob%2F951b48540b429070694bc8abd82fd6901eb123ca%2Fsrc%2Farc-runner.ts)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fstep-security%2Fharden-runner%2Fblob%2F951b48540b429070694bc8abd82fd6901eb123ca%2Fsrc%2Farc-runner.ts)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=step-security%2Fharden-runner)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[step-security](/step-security)
/
**[harden-runner](/step-security/harden-runner)**
Public

* [Notifications](/login?return_to=%2Fstep-security%2Fharden-runner) You must be signed in to change notification settings
* [Fork
  52](/login?return_to=%2Fstep-security%2Fharden-runner)
* [Star
   645](/login?return_to=%2Fstep-security%2Fharden-runner)

* [Code](/step-security/harden-runner)
* [Issues
  19](/step-security/harden-runner/issues)
* [Pull requests
  9](/step-security/harden-runner/pulls)
* [Discussions](/step-security/harden-runner/discussions)
* [Actions](/step-security/harden-runner/actions)
* [Projects
  0](/step-security/harden-runner/projects)
* [Security](/step-security/harden-runner/security)
* [Insights](/step-security/harden-runner/pulse)

Additional navigation options

* [Code](/step-security/harden-runner)
* [Issues](/step-security/harden-runner/issues)
* [Pull requests](/step-security/harden-runner/pulls)
* [Discussions](/step-security/harden-runner/discussions)
* [Actions](/step-security/harden-runner/actions)
* [Projects](/step-security/harden-runner/projects)
* [Security](/step-security/harden-runner/security)
* [Insights](/step-security/harden-runner/pulse)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_b9ce3721_20250114_213334.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fstep-security%2Fharden-runner%2Fblob%2F951b48540b429070694bc8abd82fd6901eb123ca%2Fsrc%2Fsetup.ts)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fstep-security%2Fharden-runner%2Fblob%2F951b48540b429070694bc8abd82fd6901eb123ca%2Fsrc%2Fsetup.ts)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=step-security%2Fharden-runner)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[step-security](/step-security)
/
**[harden-runner](/step-security/harden-runner)**
Public

* [Notifications](/login?return_to=%2Fstep-security%2Fharden-runner) You must be signed in to change notification settings
* [Fork
  52](/login?return_to=%2Fstep-security%2Fharden-runner)
* [Star
   645](/login?return_to=%2Fstep-security%2Fharden-runner)

* [Code](/step-security/harden-runner)
* [Issues
  19](/step-security/harden-runner/issues)
* [Pull requests
  9](/step-security/harden-runner/pulls)
* [Discussions](/step-security/harden-runner/discussions)
* [Actions](/step-security/harden-runner/actions)
* [Projects
  0](/step-security/harden-runner/projects)
* [Security](/step-security/harden-runner/security)
* [Insights](/step-security/harden-runner/pulse)

Additional navigation options

* [Code](/step-security/harden-runner)
* [Issues](/step-security/harden-runner/issues)
* [Pull requests](/step-security/harden-runner/pulls)
* [Discussions](/step-security/harden-runner/discussions)
* [Actions](/step-security/harden-runner/actions)
* [Projects](/step-security/harden-runner/projects)
* [Security](/step-security/harden-runner/security)
* [Insights](/step-security/harden-runner/pulse)

## Files

 951b485
## Breadcrumbs

1. [harden-runner](/step-security/harden-runner/tree/951b48540b429070694bc8abd82fd6901eb123ca)
2. /[src](/step-security/harden-runner/tree/951b48540b429070694bc8abd82fd6901eb123ca/src)
/
# setup.ts

Copy path Blame  Blame
## Latest commit

## History

[History](/step-security/harden-runner/commits/951b48540b429070694bc8abd82fd6901eb123ca/src/setup.ts)308 lines (278 loc) · 9.67 KB 951b485
## Breadcrumbs

1. [harden-runner](/step-security/harden-runner/tree/951b48540b429070694bc8abd82fd6901eb123ca)
2. /[src](/step-security/harden-runner/tree/951b48540b429070694bc8abd82fd6901eb123ca/src)
/
# setup.ts

Top
## File metadata and controls

* Code
* Blame

308 lines (278 loc) · 9.67 KB[Raw](https://github.com/step-security/harden-runner/raw/951b48540b429070694bc8abd82fd6901eb123ca/src/setup.ts)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308import \* as core from "@actions/core";import \* as cp from "child\_process";import \* as fs from "fs";import \* as httpm from "@actions/http-client";import \* as path from "path";import { v4 as uuidv4 } from "uuid";import \* as common from "./common";import \* as tc from "@actions/tool-cache";import { verifyChecksum } from "./checksum";import isDocker from "is-docker";import { context } from "@actions/github";import { EOL } from "os";import { ArtifactCacheEntry, cacheKey, cacheFile, CompressionMethod, isValidEvent,} from "./cache";import { Configuration, PolicyResponse } from "./interfaces";import { fetchPolicy, mergeConfigs } from "./policy-utils";import \* as cache from "@actions/cache";import { getCacheEntry } from "@actions/cache/lib/internal/cacheHttpClient";import \* as utils from "@actions/cache/lib/internal/cacheUtils";import { isArcRunner, sendAllowedEndpoints } from "./arc-runner";import { STEPSECURITY\_API\_URL, STEPSECURITY\_WEB\_URL } from "./configs";import { isGithubHosted, isTLSEnabled } from "./tls-inspect";
interface MonitorResponse { runner\_ip\_address?: string; one\_time\_key?: string; monitoring\_started?: boolean;}
(async () => { try { console.log("[harden-runner] pre-step");
 if (process.platform !== "linux") { console.log(common.UBUNTU\_MESSAGE); return; } if (isDocker()) { console.log(common.CONTAINER\_MESSAGE); return; }
 var correlation\_id = uuidv4(); var api\_url = STEPSECURITY\_API\_URL; var web\_url = STEPSECURITY\_WEB\_URL;
 let confg: Configuration = { repo: process.env["GITHUB\_REPOSITORY"], run\_id: process.env["GITHUB\_RUN\_ID"], correlation\_id: correlation\_id, working\_directory: process.env["GITHUB\_WORKSPACE"], api\_url: api\_url, allowed\_endpoints: core.getInput("allowed-endpoints"), egress\_policy: core.getInput("egress-policy"), disable\_telemetry: core.getBooleanInput("disable-telemetry"), disable\_sudo: core.getBooleanInput("disable-sudo"), disable\_file\_monitoring: core.getBooleanInput("disable-file-monitoring"), private: context?.payload?.repository?.private || false, is\_github\_hosted: isGithubHosted(), is\_debug: core.isDebug(), one\_time\_key: "", };
 let policyName = core.getInput("policy"); if (policyName !== "") { console.log(`Fetching policy from API with name: ${policyName}`); try { let idToken: string = await core.getIDToken(); let result: PolicyResponse = await fetchPolicy( context.repo.owner, policyName, idToken ); confg = mergeConfigs(confg, result); } catch (err) { core.info(`[!] ${err}`); core.setFailed(err); } } fs.appendFileSync( process.env.GITHUB\_STATE, `disableSudo=${confg.disable\_sudo}${EOL}`, { encoding: "utf8", } ); core.info(`[!] Current Configuration: \n${JSON.stringify(confg)}\n`);
 if (confg.egress\_policy !== "audit" && confg.egress\_policy !== "block") { core.setFailed("egress-policy must be either audit or block"); }
 if (confg.egress\_policy === "block" && confg.allowed\_endpoints === "") { core.warning( "egress-policy is set to block (default) and allowed-endpoints is empty. No outbound traffic will be allowed for job steps." ); }
 if (confg.disable\_telemetry !== true && confg.disable\_telemetry !== false) { core.setFailed("disable-telemetry must be a boolean value"); }
 if (isValidEvent() && confg.egress\_policy === "block") { try { const cacheResult = await cache.saveCache( [path.join(\_\_dirname, "cache.txt")], cacheKey ); console.log(cacheResult); } catch (exception) { console.log(exception); } try { const compressionMethod: CompressionMethod = await utils.getCompressionMethod(); const cacheFilePath = path.join(\_\_dirname, "cache.txt"); core.info(`cacheFilePath ${cacheFilePath}`); const cacheEntry: ArtifactCacheEntry = await getCacheEntry( [cacheKey], [cacheFilePath], { compressionMethod: compressionMethod, } ); const url = new URL(cacheEntry.archiveLocation); core.info(`Adding cacheHost: ${url.hostname}:443 to allowed-endpoints`); confg.allowed\_endpoints += ` ${url.hostname}:443`; } catch (exception) { // some exception has occurred. core.info(`Unable to fetch cacheURL`); if (confg.egress\_policy === "block") { core.info("Switching egress-policy to audit mode"); confg.egress\_policy = "audit"; } } }
 if (!confg.disable\_telemetry || confg.egress\_policy === "audit") { common.printInfo(web\_url); }
 if (isArcRunner()) { console.log(`[!] ${common.ARC\_RUNNER\_MESSAGE}`); if (confg.egress\_policy === "block") { sendAllowedEndpoints(confg.allowed\_endpoints); await sleep(10000); } return; }
 const runnerName = process.env.RUNNER\_NAME || ""; core.info(`RUNNER\_NAME: ${runnerName}`); if (!isGithubHosted()) { fs.appendFileSync(process.env.GITHUB\_STATE, `selfHosted=true${EOL}`, { encoding: "utf8", }); if (!fs.existsSync("/home/agent/agent")) { core.info(common.SELF\_HOSTED\_NO\_AGENT\_MESSAGE); return; } if (confg.egress\_policy === "block") { try { if (process.env.USER) { cp.execSync(`sudo chown -R ${process.env.USER} /home/agent`); } const confgStr = JSON.stringify(confg); fs.writeFileSync("/home/agent/block\_event.json", confgStr); await sleep(5000); } catch (error) { core.info(`[!] Unable to write block\_event.json: ${error}`); } } return; }
 let \_http = new httpm.HttpClient(); let statusCode; \_http.requestOptions = { socketTimeout: 3 \* 1000 }; let addSummary = "false"; try { const monitorRequestData = { correlation\_id: correlation\_id, job: process.env["GITHUB\_JOB"], }; const resp = await \_http.postJson<MonitorResponse>( `${api\_url}/github/${process.env["GITHUB\_REPOSITORY"]}/actions/runs/${process.env["GITHUB\_RUN\_ID"]}/monitor`, monitorRequestData );
 const responseData = resp.result; statusCode = resp.statusCode; // adding error code to check whether agent is getting installed or not. fs.appendFileSync( process.env.GITHUB\_STATE, `monitorStatusCode=${statusCode}${EOL}`, { encoding: "utf8", } );
 if (statusCode === 200 && responseData) { console.log(`Runner IP Address: ${responseData.runner\_ip\_address}`); confg.one\_time\_key = responseData.one\_time\_key; addSummary = responseData.monitoring\_started ? "true" : "false"; } } catch (e) { console.log(`error in connecting to ${api\_url}: ${e}`); } fs.appendFileSync( process.env.GITHUB\_STATE, `addSummary=${addSummary}${EOL}`, { encoding: "utf8", } );
 console.log(`Step Security Job Correlation ID: ${correlation\_id}`); if (String(statusCode) === common.STATUS\_HARDEN\_RUNNER\_UNAVAILABLE) { console.log(common.HARDEN\_RUNNER\_UNAVAILABLE\_MESSAGE); return; }
 const confgStr = JSON.stringify(confg); cp.execSync("sudo mkdir -p /home/agent"); cp.execSync("sudo chown -R $USER /home/agent");
 // Note: to avoid github rate limiting let token = core.getInput("token"); let auth = `token ${token}`;
 let downloadPath: string;
 if (await isTLSEnabled(context.repo.owner)) { downloadPath = await tc.downloadTool( "https://packages.stepsecurity.io/github-hosted/harden-runner\_1.2.3\_linux\_amd64.tar.gz" ); verifyChecksum(downloadPath, true); // NOTE: verifying tls\_agent's checksum, before extracting } else { downloadPath = await tc.downloadTool( "https://github.com/step-security/agent/releases/download/v0.13.7/agent\_0.13.7\_linux\_amd64.tar.gz", undefined, auth );
 verifyChecksum(downloadPath, false); // NOTE: verifying agent's checksum, before extracting }
 const extractPath = await tc.extractTar(downloadPath);
 let cmd = "cp", args = [path.join(extractPath, "agent"), "/home/agent/agent"];
 cp.execFileSync(cmd, args);
 cp.execSync("chmod +x /home/agent/agent");
 fs.writeFileSync("/home/agent/agent.json", confgStr);
 cmd = "sudo"; args = [ "cp", path.join(\_\_dirname, "agent.service"), "/etc/systemd/system/agent.service", ]; cp.execFileSync(cmd, args); cp.execSync("sudo systemctl daemon-reload"); cp.execSync("sudo service agent start", { timeout: 15000 });
 // Check that the file exists locally var statusFile = "/home/agent/agent.status"; var logFile = "/home/agent/agent.log"; var counter = 0; while (true) { if (!fs.existsSync(statusFile)) { counter++; if (counter > 30) { console.log("timed out"); if (fs.existsSync(logFile)) { var content = fs.readFileSync(logFile, "utf-8"); console.log(content); } break; } await sleep(300); } // The file \*does\* exist else { // Read the file var content = fs.readFileSync(statusFile, "utf-8"); console.log(content); break; } } } catch (error) { core.setFailed(error.message); } // see https://github.com/ruby/setup-ruby/issues/543 process.exit(0);})();
export function sleep(ms) { return new Promise((resolve) => { setTimeout(resolve, ms); });}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


