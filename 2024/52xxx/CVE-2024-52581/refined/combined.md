=== Content from github.com_aced9e7a_20250114_193250.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flitestar-org%2Flitestar%2Fsecurity%2Fadvisories%2FGHSA-gjcc-jvgw-wvwj)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flitestar-org%2Flitestar%2Fsecurity%2Fadvisories%2FGHSA-gjcc-jvgw-wvwj)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=litestar-org%2Flitestar)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[litestar-org](/litestar-org)
/
**[litestar](/litestar-org/litestar)**
Public

* [Notifications](/login?return_to=%2Flitestar-org%2Flitestar) You must be signed in to change notification settings
* [Fork
  390](/login?return_to=%2Flitestar-org%2Flitestar)
* [Star
   5.8k](/login?return_to=%2Flitestar-org%2Flitestar)

* [Code](/litestar-org/litestar)
* [Issues
  180](/litestar-org/litestar/issues)
* [Pull requests
  15](/litestar-org/litestar/pulls)
* [Discussions](/litestar-org/litestar/discussions)
* [Actions](/litestar-org/litestar/actions)
* [Projects
  3](/litestar-org/litestar/projects)
* [Security](/litestar-org/litestar/security)
* [Insights](/litestar-org/litestar/pulse)

Additional navigation options

* [Code](/litestar-org/litestar)
* [Issues](/litestar-org/litestar/issues)
* [Pull requests](/litestar-org/litestar/pulls)
* [Discussions](/litestar-org/litestar/discussions)
* [Actions](/litestar-org/litestar/actions)
* [Projects](/litestar-org/litestar/projects)
* [Security](/litestar-org/litestar/security)
* [Insights](/litestar-org/litestar/pulse)

# Unbounded resource consumption (DoS vulnerability)

High

[provinzkraut](/provinzkraut)
published
GHSA-gjcc-jvgw-wvwj
Nov 20, 2024

## Package

pip

litestar
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

<=2.12.1

## Patched versions

>=2.13.0

pip

starlite
([pip](/advisories?query=ecosystem%3Apip))

<=1.51.16

None

## Description

### Summary

Litestar offers multiple methods to return a parsed representation of the request body, as well as extractors that rely on those parsers to map request content to structured data types. Multiple of those parsers do not have size limits when reading the request body into memory, which allows an attacker to cause excessive memory consumption on the server by sending large requests.

### Details

The `Request` methods to parse json, msgpack or form-data all read the entire request stream into memory via `await self.body()` without a prior size check or size limit. There may be other places (e.g. extractors) where this can happen.

For most formats, a configurable size limit would be sufficient to mitigate this issue. The total request size can also be limited by a proxy (e.g. nginx) in front of the actual application as a workaround. However, for applications that actually want to accept large file uploads via `multipart/form-data`, a simple size limit would not be practical. The multipart parser currently used by Litestar expects a single byte string as input and does not support incremental parsing via `Request.stream()`. Applications could bypass the Litestar parser and use a [streaming parser](https://pypi.org/project/multipart/) to read from `Request.stream()` instead, but that would not work with extractors and other features of the framework. Switching the parser for a different implementation is currently not possible via public APIs.

### PoC

Start an applications that accesses `Request.json()`, `Request.msgpack()` or `Request.form()` or uses an extractor that relies on those parsers internally, and send a large request with a matching content type. The actual content of the request does not matter. For example: `curl -F "foo=</dev/random" http://127.0.0.1:8000/`) for `multipart/form-data`. Server memory consumption will increase very quickly until memory (and swap) are exhausted.

### Impact

This is a denial of service (DoS) vulnerability affecting all Litestar applications that process json, msgpack or form-data submission requests.

### Severity

High

8.7

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v4 base metrics

##### Exploitability Metrics

Attack Vector
Network

Attack Complexity
Low

Attack Requirements
None

Privileges Required
None

User interaction
None
##### Vulnerable System Impact Metrics

Confidentiality
None

Integrity
None

Availability
High
##### Subsequent System Impact Metrics

Confidentiality
None

Integrity
None

Availability
Low

Learn more about base metrics

# CVSS v4 base metrics

##### Exploitability Metrics

Attack Vector:
This metric reflects the context by which vulnerability exploitation is possible. This metric value (and consequently the resulting severity) will be larger the more remote (logically, and physically) an attacker can be in order to exploit the vulnerable system. The assumption is that the number of potential attackers for a vulnerability that could be exploited from across a network is larger than the number of potential attackers that could exploit a vulnerability requiring physical access to a device, and therefore warrants a greater severity.

Attack Complexity:
This metric captures measurable actions that must be taken by the attacker to actively evade or circumvent existing built-in security-enhancing conditions in order to obtain a working exploit. These are conditions whose primary purpose is to increase security and/or increase exploit engineering complexity. A vulnerability exploitable without a target-specific variable has a lower complexity than a vulnerability that would require non-trivial customization. This metric is meant to capture security mechanisms utilized by the vulnerable system.

Attack Requirements:
This metric captures the prerequisite deployment and execution conditions or variables of the vulnerable system that enable the attack. These differ from security-enhancing techniques/technologies (ref Attack Complexity) as the primary purpose of these conditions is not to explicitly mitigate attacks, but rather, emerge naturally as a consequence of the deployment and execution of the vulnerable system.

Privileges Required:
This metric describes the level of privileges an attacker must possess prior to successfully exploiting the vulnerability. The method by which the attacker obtains privileged credentials prior to the attack (e.g., free trial accounts), is outside the scope of this metric. Generally, self-service provisioned accounts do not constitute a privilege requirement if the attacker can grant themselves privileges as part of the attack.

User interaction:
This metric captures the requirement for a human user, other than the attacker, to participate in the successful compromise of the vulnerable system. This metric determines whether the vulnerability can be exploited solely at the will of the attacker, or whether a separate user (or user-initiated process) must participate in some manner.
##### Vulnerable System Impact Metrics

Confidentiality:
This metric measures the impact to the confidentiality of the information managed by the VULNERABLE SYSTEM due to a successfully exploited vulnerability. Confidentiality refers to limiting information access and disclosure to only authorized users, as well as preventing access by, or disclosure to, unauthorized ones.

Integrity:
This metric measures the impact to integrity of a successfully exploited vulnerability. Integrity refers to the trustworthiness and veracity of information. Integrity of the VULNERABLE SYSTEM is impacted when an attacker makes unauthorized modification of system data. Integrity is also impacted when a system user can repudiate critical actions taken in the context of the system (e.g. due to insufficient logging).

Availability:
This metric measures the impact to the availability of the VULNERABLE SYSTEM resulting from a successfully exploited vulnerability. While the Confidentiality and Integrity impact metrics apply to the loss of confidentiality or integrity of data (e.g., information, files) used by the system, this metric refers to the loss of availability of the impacted system itself, such as a networked service (e.g., web, database, email). Since availability refers to the accessibility of information resources, attacks that consume network bandwidth, processor cycles, or disk space all impact the availability of a system.
##### Subsequent System Impact Metrics

Confidentiality:
This metric measures the impact to the confidentiality of the information managed by the SUBSEQUENT SYSTEM due to a successfully exploited vulnerability. Confidentiality refers to limiting information access and disclosure to only authorized users, as well as preventing access by, or disclosure to, unauthorized ones.

Integrity:
This metric measures the impact to integrity of a successfully exploited vulnerability. Integrity refers to the trustworthiness and veracity of information. Integrity of the SUBSEQUENT SYSTEM is impacted when an attacker makes unauthorized modification of system data. Integrity is also impacted when a system user can repudiate critical actions taken in the context of the system (e.g. due to insufficient logging).

Availability:
This metric measures the impact to the availability of the SUBSEQUENT SYSTEM resulting from a successfully exploited vulnerability. While the Confidentiality and Integrity impact metrics apply to the loss of confidentiality or integrity of data (e.g., information, files) used by the system, this metric refers to the loss of availability of the impacted system itself, such as a networked service (e.g., web, database, email). Since availability refers to the accessibility of information resources, attacks that consume network bandwidth, processor cycles, or disk space all impact the availability of a system.

 CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:N/VI:N/VA:H/SC:N/SI:N/SA:L

### CVE ID

CVE-2024-52581

### Weaknesses

[CWE-770](/advisories?query=cwe%3A770)

### Credits

* [![@defnull](https://avatars.githubusercontent.com/u/62740?s=40&v=4)](/defnull)
  [defnull](/defnull)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_7f7a8fe8_20250114_193249.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flitestar-org%2Flitestar%2Fcommit%2F53c1473b5ff7502816a9a339ffc90731bb0c2138)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flitestar-org%2Flitestar%2Fcommit%2F53c1473b5ff7502816a9a339ffc90731bb0c2138)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=litestar-org%2Flitestar)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[litestar-org](/litestar-org)
/
**[litestar](/litestar-org/litestar)**
Public

* [Notifications](/login?return_to=%2Flitestar-org%2Flitestar) You must be signed in to change notification settings
* [Fork
  390](/login?return_to=%2Flitestar-org%2Flitestar)
* [Star
   5.8k](/login?return_to=%2Flitestar-org%2Flitestar)

* [Code](/litestar-org/litestar)
* [Issues
  180](/litestar-org/litestar/issues)
* [Pull requests
  15](/litestar-org/litestar/pulls)
* [Discussions](/litestar-org/litestar/discussions)
* [Actions](/litestar-org/litestar/actions)
* [Projects
  3](/litestar-org/litestar/projects)
* [Security](/litestar-org/litestar/security)
* [Insights](/litestar-org/litestar/pulse)

Additional navigation options

* [Code](/litestar-org/litestar)
* [Issues](/litestar-org/litestar/issues)
* [Pull requests](/litestar-org/litestar/pulls)
* [Discussions](/litestar-org/litestar/discussions)
* [Actions](/litestar-org/litestar/actions)
* [Projects](/litestar-org/litestar/projects)
* [Security](/litestar-org/litestar/security)
* [Insights](/litestar-org/litestar/pulse)

## Commit

[Permalink](/litestar-org/litestar/commit/53c1473b5ff7502816a9a339ffc90731bb0c2138)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge commit from fork

[Browse files](/litestar-org/litestar/tree/53c1473b5ff7502816a9a339ffc90731bb0c2138)
Browse the repository at this point in the history

```
Co-authored-by: Jacob Coffee <jacob@z7x.org>
Co-authored-by: guacs <126393040+guacs@users.noreply.github.com>
```

* Loading branch information

[![@provinzkraut](https://avatars.githubusercontent.com/u/25355197?s=40&v=4)](/provinzkraut) [![@JacobCoffee](https://avatars.githubusercontent.com/u/45884264?s=40&v=4)](/JacobCoffee) [![@guacs](https://avatars.githubusercontent.com/u/126393040?s=40&v=4)](/guacs)

3 people

committed
Nov 20, 2024

1 parent
[7e56814](/litestar-org/litestar/commit/7e56814e3284b233435250d87a96c983f17008c6)

commit 53c1473

 Show file tree

 Hide file tree

Showing
**13 changed files**
with
**387 additions**
and
**67 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* docs/usage

  + docs/usage/requests.rst
    [requests.rst](#diff-ee2805368fe82cf58e987e3f01ae5badc7d19f7db5757e42c10018ad4f283079)
* litestar

  + litestar/app.py
    [app.py](#diff-aafe5108c7066a200611b26a20476f1531aa99eeed494f88855478371a8ab544)
  + config

    - litestar/config/app.py
      [app.py](#diff-1acf69e1e5d8293e649af79c475f45012cefb2eb5dca9bc0951a528c81254e95)
  + connection

    - litestar/connection/request.py
      [request.py](#diff-7e7a74645db07ad58b81fa7bd63ed557e8e205d98741b78784bd7b3be0b03fee)
  + litestar/controller.py
    [controller.py](#diff-2af14fee912e4afdc78431b0458e8da99bec3741ed6e385e34ad70f9ec9bdfde)
  + exceptions

    - litestar/exceptions/http\_exceptions.py
      [http\_exceptions.py](#diff-e276543e38914fb5a8cc8c6ca0452f4ad1c718e6149e983e39cbdcc7c50b4b82)
  + handlers/http\_handlers

    - litestar/handlers/http\_handlers/base.py
      [base.py](#diff-797a267995b794faf75fa73544d19a6d717c2650ae5d2e5329ed12ec70d06577)
    - litestar/handlers/http\_handlers/decorators.py
      [decorators.py](#diff-16d7379da5237e3246b4295ba4c24269617ed68ae8f0a019012ba42380052cad)
  + litestar/router.py
    [router.py](#diff-60c86c16f2fecfb59d82328d979cdc742f5d04b4871b35452af6b1c9014d6085)
* tests

  + tests/conftest.py
    [conftest.py](#diff-e52e4ddd58b7ef887ab03c04116e676f6280b824ab7469d5d3080e5cba4f2128)
  + unit

    - test\_connection

      * tests/unit/test\_connection/test\_connection\_caching.py
        [test\_connection\_caching.py](#diff-ab7c5c33b9c2460a347e705579556d3974e108d9b6c4c8633f1526c3f5b98d4a)
      * tests/unit/test\_connection/test\_request.py
        [test\_request.py](#diff-e40a557e7ca56b3dc7a45dc06d99d8c0117b5c0a5416846f34857421d588435f)
    - test\_handlers/test\_http\_handlers

      * tests/unit/test\_handlers/test\_http\_handlers/test\_resolution.py
        [test\_resolution.py](#diff-12dc09c4ae48204562dd888b3e0fa3819a369444a457fc8a002b4a0bb61ae204)

## There are no files selected for viewing

49 changes: 49 additions & 0 deletions

49
[docs/usage/requests.rst](#diff-ee2805368fe82cf58e987e3f01ae5badc7d19f7db5757e42c10018ad4f283079 "docs/usage/requests.rst")

Show comments

[View file](/litestar-org/litestar/blob/53c1473b5ff7502816a9a339ffc90731bb0c2138/docs/usage/requests.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -160,3 +160,52 @@ The example below illustrates how to implement custom request class for the whol |
|  |  | class on multiple layers, the layer closest to the route handler will take precedence. |
|  |  |  |
|  |  | You can read more about this in the :ref:`usage/applications:layered architecture` section |
|  |  |  |
|  |  |  |
|  |  | Limits |
|  |  | ------- |
|  |  |  |
|  |  | Body size |
|  |  | ^^^^^^^^^^ |
|  |  |  |
|  |  | A limit for the allowed request body size can be set on all layers via the |
|  |  | ``request\_max\_body\_size`` parameter and defaults to 10MB. If a request body exceeds this |
|  |  | limit, a ``413 - Request Entity Too Large`` |
|  |  | response will be returned. This limit applies to all methods of consuming the request |
|  |  | body, including requesting it via the ``body`` parameter in a route handler and |
|  |  | consuming it through a manually constructed :class:`~litestar.connection.Request` |
|  |  | instance, e.g. in a middleware. |
|  |  |  |
|  |  | To disable this limit for a specific handler / router / controller, it can be set to |
|  |  | :obj:`None`. |
|  |  |  |
|  |  | .. danger:: |
|  |  | Setting ``request\_max\_body\_size=None`` is strongly discouraged as it exposes the |
|  |  | application to a denial of service (DoS) attack by sending arbitrarily large |
|  |  | request bodies to the affected endpoint. Because Litestar has to read the whole body |
|  |  | to perform certain actions, such as parsing JSON, it will fill up all the available |
|  |  | memory / swap until the application / server crashes, should no outside limits be |
|  |  | imposed. |
|  |  |  |
|  |  | This is generally only recommended in environments where the application is running |
|  |  | behind a reverse proxy such as NGINX, where a size limit is already set. |
|  |  |  |
|  |  |  |
|  |  | .. danger:: |
|  |  | Since ``request\_max\_body\_size`` is handled on a per-request basis, it won't affect |
|  |  | middlewares or ASGI handlers when they try to access the request body via the raw |
|  |  | ASGI events. To avoid this, middlewares and ASGI handlers should construct a |
|  |  | :class:`~litestar.connection.Request` instance and use the regular |
|  |  | :meth:`~litestar.connection.Request.stream` / |
|  |  | :meth:`~litestar.connection.Request.body` or content-appropriate method to consume |
|  |  | the request body in a safe manner. |
|  |  |  |
|  |  |  |
|  |  | .. tip:: |
|  |  | For requests that define a ``Content-Length`` header, Litestar will not attempt to |
|  |  | read the request body should the header value exceed the ``request\_max\_body\_size``. |
|  |  |  |
|  |  | If the header value is within the allowed bounds, Litestar will verify during the |
|  |  | streaming of the request body that it does not exceed the size specified in the |
|  |  | header. Should the request exceed this size, it will abort the request with a |
|  |  | ``400 - Bad Request``. |

5 changes: 5 additions & 0 deletions

5
[litestar/app.py](#diff-aafe5108c7066a200611b26a20476f1531aa99eeed494f88855478371a8ab544 "litestar/app.py")

Show comments

[View file](/litestar-org/litestar/blob/53c1473b5ff7502816a9a339ffc90731bb0c2138/litestar/app.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -202,6 +202,7 @@ def \_\_init\_\_( |
|  |  | path: str | None = None, |
|  |  | plugins: Sequence[PluginProtocol] | None = None, |
|  |  | request\_class: type[Request] | None = None, |
|  |  | request\_max\_body\_size: int | None = 10\_000\_000, |
|  |  | response\_cache\_config: ResponseCacheConfig | None = None, |
|  |  | response\_class: type[Response] | None = None, |
|  |  | response\_cookies: ResponseCookies | None = None, |
| Expand Down  Expand Up | | @@ -286,6 +287,8 @@ def \_\_init\_\_( |
|  |  | pdb\_on\_exception: Drop into the PDB when an exception occurs. |
|  |  | plugins: Sequence of plugins. |
|  |  | request\_class: An optional subclass of :class:`Request <.connection.Request>` to use for http connections. |
|  |  | request\_max\_body\_size: Maximum allowed size of the request body in bytes. If this size is exceeded, a |
|  |  | '413 - Request Entity Too Large' error response is returned. |
|  |  | response\_class: A custom subclass of :class:`Response <.response.Response>` to be used as the app's default |
|  |  | response. |
|  |  | response\_cookies: A sequence of :class:`Cookie <.datastructures.Cookie>`. |
| Expand Down  Expand Up | | @@ -361,6 +364,7 @@ def \_\_init\_\_( |
|  |  | pdb\_on\_exception=pdb\_on\_exception, |
|  |  | plugins=self.\_get\_default\_plugins(list(plugins or [])), |
|  |  | request\_class=request\_class, |
|  |  | request\_max\_body\_size=request\_max\_body\_size, |
|  |  | response\_cache\_config=response\_cache\_config or ResponseCacheConfig(), |
|  |  | response\_class=response\_class, |
|  |  | response\_cookies=response\_cookies or [], |
| Expand Down  Expand Up | | @@ -464,6 +468,7 @@ def \_\_init\_\_( |
|  |  | parameters=config.parameters, |
|  |  | path=config.path, |
|  |  | request\_class=self.request\_class, |
|  |  | request\_max\_body\_size=request\_max\_body\_size, |
|  |  | response\_class=config.response\_class, |
|  |  | response\_cookies=config.response\_cookies, |
|  |  | response\_headers=config.response\_headers, |
| Expand Down | |  |

3 changes: 3 additions & 0 deletions

3
[litestar/config/app.py](#diff-1acf69e1e5d8293e649af79c475f45012cefb2eb5dca9bc0951a528c81254e95 "litestar/config/app.py")

Show comments

[View file](/litestar-org/litestar/blob/53c1473b5ff7502816a9a339ffc90731bb0c2138/litestar/config/app.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -163,6 +163,9 @@ class AppConfig: |
|  |  | """List of :class:`SerializationPluginProtocol <.plugins.SerializationPluginProtocol>`.""" |
|  |  | request\_class: type[Request] | None = field(default=None) |
|  |  | """An optional subclass of :class:`Request <.connection.Request>` to use for http connections.""" |
|  |  | request\_max\_body\_size: int | None | EmptyType = Empty |
|  |  | """Maximum allowed size of the request body in bytes. If this size is exceeded, a '413 - Request Entity Too Large' |
|  |  | error response is returned.""" |
|  |  | response\_class: type[Response] | None = field(default=None) |
|  |  | """A custom subclass of :class:`Response <.response.Response>` to be used as the app's default response.""" |
|  |  | response\_cookies: ResponseCookies = field(default\_factory=list) |
| Expand Down | |  |

66 changes: 61 additions & 5 deletions

66
[litestar/connection/request.py](#diff-7e7a74645db07ad58b81fa7bd63ed557e8e205d98741b78784bd7b3be0b03fee "litestar/connection/request.py")

Show comments

[View file](/litestar-org/litestar/blob/53c1473b5ff7502816a9a339ffc90731bb0c2138/litestar/connection/request.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,7 +1,8 @@ |
|  |  | from \_\_future\_\_ import annotations |
|  |  |  |
|  |  | import math |
|  |  | import warnings |
|  |  | from typing import TYPE\_CHECKING, Any, AsyncGenerator, Generic |
|  |  | from typing import TYPE\_CHECKING, Any, AsyncGenerator, Generic, cast |
|  |  |  |
|  |  | from litestar.\_multipart import parse\_content\_header, parse\_multipart\_form |
|  |  | from litestar.\_parsers import parse\_url\_encoded\_form\_data |
| Expand All | | @@ -17,12 +18,14 @@ |
|  |  | from litestar.datastructures.multi\_dicts import FormMultiDict |
|  |  | from litestar.enums import ASGIExtension, RequestEncodingType |
|  |  | from litestar.exceptions import ( |
|  |  | ClientException, |
|  |  | InternalServerException, |
|  |  | LitestarException, |
|  |  | LitestarWarning, |
|  |  | ) |
|  |  | from litestar.exceptions.http\_exceptions import RequestEntityTooLarge |
|  |  | from litestar.serialization import decode\_json, decode\_msgpack |
|  |  | from litestar.types import Empty |
|  |  | from litestar.types import Empty, HTTPReceiveMessage |
|  |  |  |
|  |  | \_\_all\_\_ = ("Request",) |
|  |  |  |
| Expand Down  Expand Up | | @@ -52,6 +55,7 @@ class Request(Generic[UserT, AuthT, StateT], ASGIConnection["HTTPRouteHandler", |
|  |  | "\_msgpack", |
|  |  | "\_content\_type", |
|  |  | "\_accept", |
|  |  | "\_content\_length", |
|  |  | "is\_connected", |
|  |  | "supports\_push\_promise", |
|  |  | ) |
| Expand Down  Expand Up | | @@ -79,6 +83,7 @@ def \_\_init\_\_(self, scope: Scope, receive: Receive = empty\_receive, send: Send = |
|  |  | self.\_msgpack: Any = Empty |
|  |  | self.\_content\_type: tuple[str, dict[str, str]] | EmptyType = Empty |
|  |  | self.\_accept: Accept | EmptyType = Empty |
|  |  | self.\_content\_length: int | None | EmptyType = Empty |
|  |  | self.supports\_push\_promise = ASGIExtension.SERVER\_PUSH in self.\_server\_extensions |
|  |  |  |
|  |  | @property |
| Expand Down  Expand Up | | @@ -152,6 +157,21 @@ async def msgpack(self) -> Any: |
|  |  | ) |
|  |  | return self.\_msgpack |
|  |  |  |
|  |  | @property |
|  |  | def content\_length(self) -> int | None: |
|  |  | cached\_content\_length = self.\_content\_length |
|  |  | if cached\_content\_length is not Empty: |
|  |  | return cached\_content\_length |
|  |  |  |
|  |  | content\_length\_header = self.headers.get("content-length") |
|  |  | try: |
|  |  | content\_length = self.\_content\_length = ( |
|  |  | int(content\_length\_header) if content\_length\_header is not None else None |
|  |  | ) |
|  |  | except ValueError: |
|  |  | raise ClientException(f"Invalid content-length: {content\_length\_header!r}") from None |
|  |  | return content\_length |
|  |  |  |
|  |  | async def stream(self) -> AsyncGenerator[bytes, None]: |
|  |  | """Return an async generator that streams chunks of bytes. |
|  |  |  |
| Expand All | | @@ -164,10 +184,46 @@ async def stream(self) -> AsyncGenerator[bytes, None]: |
|  |  | if self.\_body is Empty: |
|  |  | if not self.is\_connected: |
|  |  | raise InternalServerException("stream consumed") |
|  |  | while event := await self.receive(): |
|  |  |  |
|  |  | announced\_content\_length = self.content\_length |
|  |  | # setting this to 'math.inf' as a micro-optimisation; Comparing against a |
|  |  | # float is slightly faster than checking if a value is 'None' and then |
|  |  | # comparing it to an int. since we expect a limit to be set most of the |
|  |  | # time, this is a bit more efficient |
|  |  | max\_content\_length = self.route\_handler.resolve\_request\_max\_body\_size() or math.inf |
|  |  |  |
|  |  | # if the 'content-length' header is set, and exceeds the limit, we can bail |
|  |  | # out early before reading anything |
|  |  | if announced\_content\_length is not None and announced\_content\_length > max\_content\_length: |
|  |  | raise RequestEntityTooLarge |
|  |  |  |
|  |  | total\_bytes\_streamed: int = 0 |
|  |  | while event := cast("HTTPReceiveMessage", await self.receive()): |
|  |  | if event["type"] == "http.request": |
|  |  | if event["body"]: |
|  |  | yield event["body"] |
|  |  | body = event["body"] |
|  |  | if body: |
|  |  | total\_bytes\_streamed += len(body) |
|  |  |  |
|  |  | # if a 'content-length' header was set, check if we have |
|  |  | # received more bytes than specified. in most cases this should |
|  |  | # be caught before it hits the application layer and an ASGI |
|  |  | # server (e.g. uvicorn) will not allow this, but since it's not |
|  |  | # forbidden according to the HTTP or ASGI spec, we err on the |
|  |  | # side of caution and still perform this check. |
|  |  | # |
|  |  | # uvicorn documented behaviour for this case: |
|  |  | # https://github.com/encode/uvicorn/blob/fe3910083e3990695bc19c2ef671dd447262ae18/docs/server-behavior.md?plain=1#L11 |
|  |  | if announced\_content\_length: |
|  |  | if total\_bytes\_streamed > announced\_content\_length: |
|  |  | raise ClientException("Malformed request") |
|  |  |  |
|  |  | # we don't have a 'content-length' header, likely a chunked |
|  |  | # transfer. we don't really care and simply check if we have |
|  |  | # received more bytes than allowed |
|  |  | elif total\_bytes\_streamed > max\_content\_length: |
|  |  | raise RequestEntityTooLarge |
|  |  |  |
|  |  | yield body |
|  |  |  |
|  |  | if not event.get("more\_body", False): |
|  |  | break |
| Expand Down | |  |

10 changes: 10 additions & 0 deletions

10
[litestar/controller.py](#diff-2af14fee912e4afdc78431b0458e8da99bec3741ed6e385e34ad70f9ec9bdfde "litestar/controller.py")

Show comments

[View file](/litestar-org/litestar/blob/53c1473b5ff7502816a9a339ffc90731bb0c2138/litestar/controller.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -64,6 +64,7 @@ class Controller: |
|  |  | "parameters", |
|  |  | "path", |
|  |  | "request\_class", |
|  |  | "request\_max\_body\_size", |
|  |  | "response\_class", |
|  |  | "response\_cookies", |
|  |  | "response\_headers", |
| Expand Down  Expand Up | | @@ -136,6 +137,11 @@ class Controller: |
|  |  | """A custom subclass of :class:`Request <.connection.Request>` to be used as the default request for all route |
|  |  | handlers under the controller. |
|  |  | """ |
|  |  | request\_max\_body\_size: int | None | EmptyType |
|  |  | """ |
|  |  | Maximum allowed size of the request body in bytes. If this size is exceeded, a '413 - Request Entity Too Large' |
|  |  | error response is returned.""" |
|  |  |  |
|  |  | response\_class: type[Response] | None |
|  |  | """A custom subclass of :class:`Response <.response.Response>` to be used as the default response for all route |
|  |  | handlers under the controller. |
| Expand Down  Expand Up | | @@ -191,6 +197,9 @@ def \_\_init\_\_(self, owner: Router) -> None: |
|  |  | if not hasattr(self, "include\_in\_schema"): |
|  |  | self.include\_in\_schema = Empty |
|  |  |  |
|  |  | if not hasattr(self, "request\_max\_body\_size"): |
|  |  | self.request\_max\_body\_size = Empty |
|  |  |  |
|  |  | self.signature\_namespace = add\_types\_to\_signature\_namespace( |
|  |  | getattr(self, "signature\_types", []), getattr(self, "signature\_namespace", {}) |
|  |  | ) |
| Expand Down  Expand Up | | @@ -235,6 +244,7 @@ def as\_router(self) -> Router: |
|  |  | type\_encoders=self.type\_encoders, |
|  |  | type\_decoders=self.type\_decoders, |
|  |  | websocket\_class=self.websocket\_class, |
|  |  | request\_max\_body\_size=self.request\_max\_body\_size, |
|  |  | ) |
|  |  | router.owner = self.owner |
|  |  | return router |
| Expand Down | |  |

6 changes: 6 additions & 0 deletions

6
[litestar/exceptions/http\_exceptions.py](#diff-e276543e38914fb5a8cc8c6ca0452f4ad1c718e6149e983e39cbdcc7c50b4b82 "litestar/exceptions/http_exceptions.py")

Show comments

[View file](/litestar-org/litestar/blob/53c1473b5ff7502816a9a339ffc90731bb0c2138/litestar/exceptions/http_exceptions.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -10,6 +10,7 @@ |
|  |  | HTTP\_403\_FORBIDDEN, |
|  |  | HTTP\_404\_NOT\_FOUND, |
|  |  | HTTP\_405\_METHOD\_NOT\_ALLOWED, |
|  |  | HTTP\_413\_REQUEST\_ENTITY\_TOO\_LARGE, |
|  |  | HTTP\_429\_TOO\_MANY\_REQUESTS, |
|  |  | HTTP\_500\_INTERNAL\_SERVER\_ERROR, |
|  |  | HTTP\_503\_SERVICE\_UNAVAILABLE, |
| Expand Down  Expand Up | | @@ -119,6 +120,11 @@ class MethodNotAllowedException(ClientException): |
|  |  | status\_code = HTTP\_405\_METHOD\_NOT\_ALLOWED |
|  |  |  |
|  |  |  |
|  |  | class RequestEntityTooLarge(ClientException): |
|  |  | status\_code = HTTP\_413\_REQUEST\_ENTITY\_TOO\_LARGE |
|  |  | detail = "Request Entity Too Large" |
|  |  |  |
|  |  |  |
|  |  | class TooManyRequestsException(ClientException): |
|  |  | """Request limits have been exceeded.""" |
|  |  |  |
| Expand Down | |  |

26 changes: 26 additions & 0 deletions

26
[litestar/handlers/http\_handlers/base.py](#diff-797a267995b794faf75fa73544d19a6d717c2650ae5d2e5329ed12ec70d06577 "litestar/handlers/http_handlers/base.py")

Show comments

[View file](/litestar-org/litestar/blob/53c1473b5ff7502816a9a339ffc90731bb0c2138/litestar/handlers/http_handlers/base.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -82,6 +82,7 @@ class HTTPRouteHandler(BaseRouteHandler): |
|  |  | "\_resolved\_request\_class", |
|  |  | "\_resolved\_tags", |
|  |  | "\_resolved\_security", |
|  |  | "\_resolved\_request\_max\_body\_size", |
|  |  | "after\_request", |
|  |  | "after\_response", |
|  |  | "background", |
| Expand Down  Expand Up | | @@ -113,6 +114,7 @@ class HTTPRouteHandler(BaseRouteHandler): |
|  |  | "sync\_to\_thread", |
|  |  | "tags", |
|  |  | "template\_name", |
|  |  | "request\_max\_body\_size", |
|  |  | ) |
|  |  |  |
|  |  | has\_sync\_callable: bool |
| Expand All | | @@ -139,6 +141,7 @@ def \_\_init\_\_( |
|  |  | name: str | None = None, |
|  |  | opt: Mapping[str, Any] | None = None, |
|  |  | request\_class: type[Request] | None = None, |
|  |  | request\_max\_body\_size: int | None | EmptyType = Empty, |
|  |  | response\_class: type[Response] | None = None, |
|  |  | response\_cookies: ResponseCookies | None = None, |
|  |  | response\_headers: ResponseHeaders | None = None, |
| Expand Down  Expand Up | | @@ -204,6 +207,8 @@ def \_\_init\_\_( |
|  |  | :class:`ASGI Scope <.types.Scope>`. |
|  |  | request\_class: A custom subclass of :class:`Request <.connection.Request>` to be used as route handler's |
|  |  | default request. |
|  |  | request\_max\_body\_size: Maximum allowed size of the request body in bytes. If this size is exceeded, |
|  |  | a '413 - Request Entity Too Large' error response is returned. |
|  |  | response\_class: A custom subclass of :class:`Response <.response.Response>` to be used as route handler's |
|  |  | default response. |
|  |  | response\_cookies: A sequence of :class:`Cookie <.datastructures.Cookie>` instances. |
| Expand Down  Expand Up | | @@ -272,6 +277,7 @@ def \_\_init\_\_( |
|  |  | self.response\_class = response\_class |
|  |  | self.response\_cookies: Sequence[Cookie] | None = narrow\_response\_cookies(response\_cookies) |
|  |  | self.response\_headers: Sequence[ResponseHeader] | None = narrow\_response\_headers(response\_headers) |
|  |  | self.request\_max\_body\_size = request\_max\_body\_size |
|  |  |  |
|  |  | self.sync\_to\_thread = sync\_to\_thread |
|  |  | # OpenAPI related attributes |
| Expand All | | @@ -297,6 +303,7 @@ def \_\_init\_\_( |
|  |  | self.\_resolved\_request\_class: type[Request] | EmptyType = Empty |
|  |  | self.\_resolved\_security: list[SecurityRequirement] | EmptyType = Empty |
|  |  | self.\_resolved\_tags: list[str] | EmptyType = Empty |
|  |  | self.\_resolved\_request\_max\_body\_size: int | EmptyType | None = Empty |
|  |  |  |
|  |  | def \_\_call\_\_(self, fn: AnyCallable) -> HTTPRouteHandler: |
|  |  | """Replace a function with itself.""" |
| Expand Down  Expand Up | | @@ -473,6 +480,25 @@ def resolve\_tags(self) -> list[str]: |
|  |  |  |
|  |  | return self.\_resolved\_tags |
|  |  |  |
|  |  | def resolve\_request\_max\_body\_size(self) -> int | None: |
|  |  | if (resolved\_limits := self.\_resolved\_request\_max\_body\_size) is not Empty: |
|  |  | return resolved\_limits |
|  |  |  |
|  |  | max\_body\_size = self.\_resolved\_request\_max\_body\_size = next( # pyright: ignore |
|  |  | ( |
|  |  | max\_body\_size |
|  |  | for layer in reversed(self.ownership\_layers) |
|  |  | if (max\_body\_size := layer.request\_max\_body\_size) is not Empty |
|  |  | ), |
|  |  | Empty, |
|  |  | ) |
|  |  | if max\_body\_size is Empty: |
|  |  | raise ImproperlyConfiguredException( |
|  |  | "'request\_max\_body\_size' set to 'Empty' on all layers. To omit a limit, " |
|  |  | "set 'request\_max\_body\_size=None'" |
|  |  | ) |
|  |  | return max\_body\_size |
|  |  |  |
|  |  | def get\_response\_handler(self, is\_response\_type\_data: bool = False) -> Callable[[Any], Awaitable[ASGIApp]]: |
|  |  | """Resolve the response\_handler function for the route handler. |
|  |  |  |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `53c1473`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flitestar-org%2Flitestar%2Fcommit%2F53c1473b5ff7502816a9a339ffc90731bb0c2138) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_dd086e2d_20250114_193246.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flitestar-org%2Flitestar%2Fblob%2Fmain%2Flitestar%2F_multipart.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flitestar-org%2Flitestar%2Fblob%2Fmain%2Flitestar%2F_multipart.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=litestar-org%2Flitestar)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[litestar-org](/litestar-org)
/
**[litestar](/litestar-org/litestar)**
Public

* [Notifications](/login?return_to=%2Flitestar-org%2Flitestar) You must be signed in to change notification settings
* [Fork
  390](/login?return_to=%2Flitestar-org%2Flitestar)
* [Star
   5.8k](/login?return_to=%2Flitestar-org%2Flitestar)

* [Code](/litestar-org/litestar)
* [Issues
  180](/litestar-org/litestar/issues)
* [Pull requests
  15](/litestar-org/litestar/pulls)
* [Discussions](/litestar-org/litestar/discussions)
* [Actions](/litestar-org/litestar/actions)
* [Projects
  3](/litestar-org/litestar/projects)
* [Security](/litestar-org/litestar/security)
* [Insights](/litestar-org/litestar/pulse)

Additional navigation options

* [Code](/litestar-org/litestar)
* [Issues](/litestar-org/litestar/issues)
* [Pull requests](/litestar-org/litestar/pulls)
* [Discussions](/litestar-org/litestar/discussions)
* [Actions](/litestar-org/litestar/actions)
* [Projects](/litestar-org/litestar/projects)
* [Security](/litestar-org/litestar/security)
* [Insights](/litestar-org/litestar/pulse)

## Files

 main
## Breadcrumbs

1. [litestar](/litestar-org/litestar/tree/main)
2. /[litestar](/litestar-org/litestar/tree/main/litestar)
/
# \_multipart.py

Copy path Blame  Blame
## Latest commit

## History

[History](/litestar-org/litestar/commits/main/litestar/_multipart.py)139 lines (111 loc) · 4.85 KB main
## Breadcrumbs

1. [litestar](/litestar-org/litestar/tree/main)
2. /[litestar](/litestar-org/litestar/tree/main/litestar)
/
# \_multipart.py

Top
## File metadata and controls

* Code
* Blame

139 lines (111 loc) · 4.85 KB[Raw](https://github.com/litestar-org/litestar/raw/refs/heads/main/litestar/_multipart.py)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139from \_\_future\_\_ import annotations
import refrom collections import defaultdictfrom typing import TYPE\_CHECKING, Any, AsyncGenerator
from multipart import ( # type: ignore[import-untyped] MultipartSegment, ParserError, ParserLimitReached, PushMultipartParser,)
from litestar.datastructures.upload\_file import UploadFilefrom litestar.exceptions import ClientException
\_\_all\_\_ = ("parse\_content\_header", "parse\_multipart\_form")
from litestar.utils.compat import async\_next
if TYPE\_CHECKING: from litestar.types import TypeDecodersSequence
\_token = r"([\w!#$%&'\*+\-.^\_`|~]+)" # noqa: S105\_quoted = r'"([^"]\*)"'\_param = re.compile(rf";\s\*{\_token}=(?:{\_token}|{\_quoted})", re.ASCII)\_firefox\_quote\_escape = re.compile(r'\\"(?!; |\s\*$)')
def parse\_content\_header(value: str) -> tuple[str, dict[str, str]]: """Parse content-type and content-disposition header values.
 Args: value: A header string value to parse.
 Returns: A tuple containing the normalized header string and a dictionary of parameters. """ value = \_firefox\_quote\_escape.sub("%22", value) pos = value.find(";") if pos == -1: options: dict[str, str] = {} else: options = { m.group(1).lower(): m.group(2) or m.group(3).replace("%22", '"') for m in \_param.finditer(value[pos:]) } value = value[:pos] return value.strip().lower(), options
async def \_close\_upload\_files(fields: dict[str, list[Any]]) -> None: for values in fields.values(): for value in values: if isinstance(value, UploadFile): await value.close()
async def parse\_multipart\_form( # noqa: C901 stream: AsyncGenerator[bytes, None], boundary: bytes, multipart\_form\_part\_limit: int = 1000, type\_decoders: TypeDecodersSequence | None = None,) -> dict[str, Any]: """Parse multipart form data.
 Args: stream: Body of the request. boundary: Boundary of the multipart message. multipart\_form\_part\_limit: Limit of the number of parts allowed. type\_decoders: A sequence of type decoders to use.
 Returns: A dictionary of parsed results. """
 fields: defaultdict[str, list[Any]] = defaultdict(list)
 chunk = await async\_next(stream, b"") if not chunk: return fields
 data: UploadFile | bytearray = bytearray()
 try: with PushMultipartParser(boundary, max\_segment\_count=multipart\_form\_part\_limit) as parser: segment: MultipartSegment | None = None while not parser.closed: for form\_part in parser.parse(chunk): if isinstance(form\_part, MultipartSegment): segment = form\_part if segment.filename: data = UploadFile( content\_type=segment.content\_type or "text/plain", filename=segment.filename, headers=dict(segment.headerlist), ) elif form\_part: if isinstance(data, UploadFile): await data.write(form\_part) else: data.extend(form\_part) else: # end of part if segment is None: # we have reached the end of a segment before we have # received a complete header segment raise ClientException("Unexpected eof in multipart/form-data")
 if isinstance(data, UploadFile): await data.seek(0) fields[segment.name].append(data) elif data: fields[segment.name].append(data.decode(segment.charset or "utf-8")) else: fields[segment.name].append(None)
 # reset for next part data = bytearray() segment = None
 chunk = await async\_next(stream, b"")
 except ParserError as exc: # if an exception is raised, make sure that all 'UploadFile's are closed if isinstance(data, UploadFile): await data.close() await \_close\_upload\_files(fields)
 raise ClientException("Invalid multipart/form-data") from exc except ParserLimitReached: if isinstance(data, UploadFile): await data.close() await \_close\_upload\_files(fields)
 # FIXME (3.0): This should raise a '413 - Request Entity Too Large', but for # backwards compatibility, we keep it as a 400 for now raise ClientException("Request Entity Too Large") from None
 return {k: v if len(v) > 1 else v[0] for k, v in fields.items()}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_742894cf_20250114_193251.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flitestar-org%2Flitestar%2Fsecurity%2Fadvisories%2FGHSA-p24m-863f-fm6q)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flitestar-org%2Flitestar%2Fsecurity%2Fadvisories%2FGHSA-p24m-863f-fm6q)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=litestar-org%2Flitestar)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[litestar-org](/litestar-org)
/
**[litestar](/litestar-org/litestar)**
Public

* [Notifications](/login?return_to=%2Flitestar-org%2Flitestar) You must be signed in to change notification settings
* [Fork
  390](/login?return_to=%2Flitestar-org%2Flitestar)
* [Star
   5.8k](/login?return_to=%2Flitestar-org%2Flitestar)

* [Code](/litestar-org/litestar)
* [Issues
  180](/litestar-org/litestar/issues)
* [Pull requests
  15](/litestar-org/litestar/pulls)
* [Discussions](/litestar-org/litestar/discussions)
* [Actions](/litestar-org/litestar/actions)
* [Projects
  3](/litestar-org/litestar/projects)
* [Security](/litestar-org/litestar/security)
* [Insights](/litestar-org/litestar/pulse)

Additional navigation options

* [Code](/litestar-org/litestar)
* [Issues](/litestar-org/litestar/issues)
* [Pull requests](/litestar-org/litestar/pulls)
* [Discussions](/litestar-org/litestar/discussions)
* [Actions](/litestar-org/litestar/actions)
* [Projects](/litestar-org/litestar/projects)
* [Security](/litestar-org/litestar/security)
* [Insights](/litestar-org/litestar/pulse)

# DoS vulnerability when parsing multipart request body

High

[peterschutt](/peterschutt)
published
GHSA-p24m-863f-fm6q
Feb 15, 2023

## Package

pip

starlite
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

<=1.51.1

## Patched versions

1.51.2

## Description

### Summary

The request body parsing in `starlite` allows a potentially unauthenticated

attacker to consume a large amount of CPU time and RAM.

### Details

The multipart body parser processes an unlimited number of file parts.

The multipart body parser processes an unlimited number of field parts.

### Impact

This is a remote, potentially unauthenticated Denial of Service vulnerability.

This vulnerability affects applications with a request handler that accepts

a `Body(media_type=RequestEncodingType.MULTI_PART)`.

The large amount of CPU time required for processing requests can block all

available worker processes and significantly delay or slow down the processing

of legitimate user requests.

The large amount of RAM accumulated while processing requests can lead to

Out-Of-Memory kills.

Complete DoS is achievable by sending many concurrent multipart requests in a

loop.

### Severity

High

7.5

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
None

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H

### CVE ID

CVE-2023-25578

### Weaknesses

[CWE-770](/advisories?query=cwe%3A770)

### Credits

* [![@das7pad](https://avatars.githubusercontent.com/u/17931887?s=40&v=4)](/das7pad)
  [das7pad](/das7pad)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


