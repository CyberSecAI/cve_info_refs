=== Content from marc.info_e3d5b4b1_20250125_080356.html ===

```
[[prev in list](?l=bugtraq&m=88723142002919&w=2)] [[next in list](?l=bugtraq&m=88704258804054&w=2)] [prev in thread] [next in thread]
List:       [bugtraq](?l=bugtraq&r=1&w=2)
Subject:    ALERT: IIS4 allows proxied password attacks over NetBIOS
From:       [mnemonix <mnemonix () GLOBALNET ! CO ! UK>](?a=90455992200001&r=1&w=2)
Date:       [1998-02-09 4:35:48](?l=bugtraq&r=1&w=2&b=199802)
[Download RAW [message](?l=bugtraq&m=91983486431506&q=mbox) or [body](?l=bugtraq&m=91983486431506&q=raw)]

Introduction
Internet Information Server 4.0 has an interesting feature that can allow a
remote attacker to attack user accounts local to the Web Server as well as
other machines across the Internet. Added to this if your Web Server is
behind a firewall performing network address translation, machines on the
clean side of the firewall can be attacked, too.

Details
By default every install of Internet Information Server 4 creates a virtual
directory "/IISADMPWD". This directory contains a number of .htr files.
Anonymous users are allowed access to this files, they are not restricted to
the loopback address (127.0.0.1). The following is a list of files found in
the /IISADMPWD directory, which physically maps to
c:\winnt\system32\inetsrv\iisadmpwd.

achg.htr
aexp.htr
aexp2.htr
aexp2b.htr
aexp3.htr
aexp4.htr
aexp4b.htr
anot.htr
anot3.htr

The files, save for a few, are pretty much variants of the same file and
allow a user to change their password via the Web. This can be used in such
scenarios as mentioned in the Introduction. Not only this but, like the vrfy
command in the SMTP service it can be used to enumerate valid accounts
through guess work. If the user account does not exist a message will be
returned saying,  "invalid domain". If the account exists, but the password
is wrong then the message will say so. If an IP address followed by a
backslash precedes the account name then the IIS server will contact the
remote machine, over the NetBIOS session port, and attempt to change the
user's password. (IPADDRESS\ACNAME)

Mechanics
Consider aexp3.htr. This produces an HTML form requesting the UserID, old
password, new password and confirm new password. The form's action is a POST
to  /_AuthChangeUrl?

/_AuthChangeUrl? is a "virtual file" in memory that actually maps to
achg.htr. W3SVC.dll maintains this in memory and has a function,
AuthChangeUrl( ), which links this to the achg.htr file. (To see this
function make a copy of w3svc.dll, rename it to w3svc.txt and open it in
notepad. If you can't see it straight away use Find from Edit on the
Menubar).

.htr files are handled by ISM.DLL and so control is passed across from
W3SVC.DLL. ISM.DLL then uses the NetUserGetInfo ( ) and
NetUserChangePassword ( ) functions. (Again, open up ism.dll in notepad and
you can see references to these functions.) The password is changed if the
entered information was correct.

If, however, the request is to change a password on a remote machine, the
SYSTEM then logs onto the remote machine through a null session then
establishes a secure session over which to trade the account and password
information.

Solution
If you don't require this service, then remove the /IISADMPWD virtual
directory. This will prevent attackers from "proxing" password attacks. If
you do require the service and only need to change passwords on accounts
local to the server, disabling the Workstation service should prevent this.
If you
require this service and want to be able to change passwords on remote
machines, do your best to limit where NetBIOS based traffic over TCP port
139 can get to.

Cheers,
David Litchfield
<http://www.infowar.co.uk/mnemonix/>

[[prev in list](?l=bugtraq&m=88723142002919&w=2)] [[next in list](?l=bugtraq&m=88704258804054&w=2)] [prev in thread] [next in thread]

```

[Configure](?q=configure) |
[About](?q=about) |
[News](?q=news) |
Add a list |
Sponsored by [KoreLogic](http://www.korelogic.com/)



=== Content from marc.info_fc58cb38_20250125_080356.html ===

```
[[prev in list](?l=bugtraq&m=91999114413051&w=2)] [[next in list](?l=bugtraq&m=92004435810093&w=2)] [[prev in thread](?l=ntbugtraq&m=92000044518275&w=2)] [next in thread]
List:       [bugtraq](?l=bugtraq&r=1&w=2)
Subject:    [Re: IIS4 allows proxied password attacks over NetBIOS](?t=91999026000001&r=1&w=2)
From:       [Russ <Russ.Cooper () RC ! ON ! CA>](?a=90366062300004&r=1&w=2)
Date:       [1999-02-26 3:25:00](?l=bugtraq&r=1&w=2&b=199902)
[Download RAW [message](?l=bugtraq&m=92000623021036&q=mbox) or [body](?l=bugtraq&m=92000623021036&q=raw)]

One of the beautiful things about being a (mostly) respected moderator
of a technical list is that you get to be technically incompetent while
making some social commentary...can you say Doh?...Doh!!

Mnemonix is right and I was wrong...with qualifications.

1. Mnemonix is right, you can access the /IISADMPWD virtual directory
anonymously and execute the .htr's found there. No restrictions other
than having to know the right syntax (which Nemo withheld, IMO,
correctly). Result could be very slow enumeration of user accounts
(read: guess a valid account name, then try brute forcing password
changes).

2. I was wrong because I was looking at a completely different aspect of
IIS, its Administration utility, not the virtual directory Nemo referred
to allowing password change (read: I'm stubborn, single-minded, and too
often "glimpse-read")

Qualifications;

1. The reason its vulnerable by default is because Microsoft did not
implement what they documented (surprise!). The documentation states
that the Metabase property "PasswordChangeFlags" has a default value of
0. This value would prevent password changes over any channel other than
an SSL channel. Fact is the default value is 1. This value allows
password changes over any channel. (note: value can only be seen through
MetaEdit or a script). No SSL, no ability to do password changes (or the
enumeration Nemo describes)

Had they implemented what they documented, the risk to a default install
would be "reduced", obviously Nemo's attack would still work if the
server had an SSL cert installed. The SSL wouldn't do anything to
prevent it (other than to slow it down further).

2. Chances of success are still very limited (you don't know the UserID
you're trying to change a password for, so you've got to find a valid
userID, then try and discover through brute force a valid password for
it) and primarily based on no knowledge of security (weak/blank
passwords on well-known account IDs). In the case of his bounce
suggestion of going to an internal remote machine there's the added
complication of figuring out an IP address if behind FW or NAT. He says
the IP address is reported in a HEAD request, but that's not by default.

Workarounds (assuming you need to use this feature);

1. Use NTLM authentication. That forces a logon before permission to
change passwords.

2. Read your logs.

3. Enable Account Expiry and Lockout. Use Metabase properties
"PasswordExpirePrenotifyDays" and "PasswordCacheTTL" to notify users who
log on that their password is going to expire.

4. Strong passwords *and*, for the very first time I can think of,
finally a *good* reason to rename the Administrator account...;-]

5. Edit ACHG.HTR and remove the error handling sections. It tries to be
"friendly" (read: insecurely verbose), but you can take out the error
definitions and just let it respond "Nope!" to anything that didn't
work. No feedback means enumerating is, well, less meaningfully done
automatically.

Cheers,
Russ - NTBugtraq moderator

[[prev in list](?l=bugtraq&m=91999114413051&w=2)] [[next in list](?l=bugtraq&m=92004435810093&w=2)] [[prev in thread](?l=ntbugtraq&m=92000044518275&w=2)] [next in thread]

```

[Configure](?q=configure) |
[About](?q=about) |
[News](?q=news) |
Add a list |
Sponsored by [KoreLogic](http://www.korelogic.com/)


