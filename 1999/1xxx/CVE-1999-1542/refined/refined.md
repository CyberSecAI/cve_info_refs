- **Root cause of vulnerability**: The `rpmmail` script, when executed via a `.forward` file, uses `system(3)` to execute commands. This function calls `/bin/sh -c`. On systems where `/bin/sh` is linked to `/bin/bash` version 2, bash drops privileges on startup if the effective user ID (euid) does not match the real user ID (uid). However, if `/bin/sh` is linked to an interpreter like `/bin/ksh`, the setuid bit is preserved allowing execution with elevated privileges. The vulnerability is present because a carefully crafted mail message with shell commands can be injected into the `system(3)` call.
- **Weaknesses/vulnerabilities present**:
    - Unsafe use of `system(3)` with user-controlled input in the `rpmmail` script.
    - `rpmmail` is setuid root, allowing execution with elevated privileges.
    - Insecure default configuration where `/bin/sh` points to bash v2 on some systems, which drops privileges by default.
- **Impact of exploitation**:
    - **Local exploitation**: Can result in command execution with the privileges of the user running `rpmmail` (typically root).
    - **Remote exploitation**: Can result in either remote command execution with root privileges (if `/bin/sh` does not point to bash v2), or remote command execution with the privileges of the unprivileged user used to run the mail delivery process (e.g., nobody).
- **Attack vectors**:
    - **Remote**: Sending a specially crafted email to `rpmmail@vulnerablehost` which exploits the .forward file's execution of `rpmmail` and the system(3) call within it.
        - The email includes shell commands in the MAIL FROM header, which is then passed to `system(3)`.
    - **Local**: Using `echo "From: ;/usr/bin/id;" | /home/rpmmail/rpmmail -c bah`, where the shell command after "From: ;" will be executed by the `/home/rpmmail/rpmmail` program.
- **Required attacker capabilities/position**:
    - **Remote**: Ability to send email to a vulnerable server.
    - **Local**: Ability to execute commands on the vulnerable machine.