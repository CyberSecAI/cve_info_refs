=== Content from seclists.org_ddb3f8f2_20250125_131411.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![bugtraq logo](/images/bugtraq-logo.png)](/bugtraq/)
## [Bugtraq](/bugtraq/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](263)
[By Date](date.html#264)
[![Next](/images/right-icon-16x16.png)](265)

[![Previous](/images/left-icon-16x16.png)](263)
[By Thread](index.html#264)
[![Next](/images/right-icon-16x16.png)](269)

![](/shared/images/nst-icons.svg#search)

# Invalid WINS entries

---

*From*: "Byrne, David" <dbyrne () TIAA-CREF ORG>

*Date*: Wed, 17 Jan 2001 16:35:49 -0500

---

```
After playing around with some WINS problems we were having, I discovered
something that doesn't seem to bother very many people. WINS does nothing to
verify the 1Ch (domain controllers) registrations sent to it. This allows an
attacker to overwrite some or all of the Domain Controllers in the record.
The new entries could be pointing at a box that will participate in the
logon process long enough to capture user names and passwords. If the
passwords are only hashed with LanMan (not NTLM), they can be easily broken
with L0phtCrack. A less malicious problem can occur if someone brings up a
server that incorrectly thinks it is a Domain Controller. Although the
server cannot participate in the domain, it will register itself with WINS
in the 1Ch record and workstations will still send logon requests to it.

The best work around I could think of is to use static entries for records
that are sensitive (there are probably more besides 1Ch). Domain Controllers
shouldn't be changed very often, so the management work would be minimal.
When I contacted Microsoft, I was told that they were aware of this, but did
not consider it a significant problem. They confirmed that static records
were the best solution.

Attached is a PERL script that can demonstrate the problem. Use it
cautiously.

David Byrne, MCSE
TIAA CREF

 <<wins2.pl>>

```

**Attachment:
[wins2.pl](att-264/wins2_pl.bin)**

*Description:*

---

[![Previous](/images/left-icon-16x16.png)](263)
[By Date](date.html#264)
[![Next](/images/right-icon-16x16.png)](265)

[![Previous](/images/left-icon-16x16.png)](263)
[By Thread](index.html#264)
[![Next](/images/right-icon-16x16.png)](269)

### Current thread:

* **Invalid WINS entries** *Byrne, David (Jan 17)*
  + [Re: Invalid WINS entries](269) *Attonbitus Deus (Jan 18)*
  + [Re: Invalid WINS entries](271) *3APA3A (Jan 18)*
  + [Re: Invalid WINS entries](276) *Paul L Schmehl (Jan 18)*
  + <Possible follow-ups>
  + [Re: Invalid WINS entries](274) *Fulton L. Preston Jr. (Jan 18)*
  + [Re: Invalid WINS entries](289) *Byrne, David (Jan 18)*
    - [Re: Invalid WINS entries](291) *Attonbitus Deus (Jan 18)*
  + [Re: Invalid WINS entries](298) *Russ (Jan 19)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")



=== Content from seclists.org_6e3a68f2_20250125_131416.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![bugtraq logo](/images/bugtraq-logo.png)](/bugtraq/)
## [Bugtraq](/bugtraq/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](288)
[By Date](date.html#289)
[![Next](/images/right-icon-16x16.png)](290)

[![Previous](/images/left-icon-16x16.png)](274)
[By Thread](index.html#289)
[![Next](/images/right-icon-16x16.png)](291)

![](/shared/images/nst-icons.svg#search)

# Re: Invalid WINS entries

---

*From*: "Byrne, David" <dbyrne () TIAA-CREF ORG>

*Date*: Thu, 18 Jan 2001 12:57:06 -0500

---

```
First, I think you're right about the secure channel for NT, but does this
apply to 9x as well?

Second, even though a bogus DC won't participate in a domain, it will still
register itself in the 1C record. Try it if you don't believe me. I also
disagree that an H-node configuration is "properly configured". NetBIOS
broadcasts only allow you to query your network segment (assuming you aren't
forwarding broadcasts). This system might work fine in a small environment,
but P-node is the only way to go for an enterprise scale operation.

David Byrne, MCSE
TIAA CREF

 -----Original Message-----
From:   Attonbitus Deus [mailto:Thor () HAMMEROFGOD COM]
Sent:   Wednesday, January 17, 2001 5:54 PM
To:     BUGTRAQ () SECURITYFOCUS COM
Subject:        Re: Invalid WINS entries

It doesn't work that way.  If you put a bogus BDC on the lan, the server
service won't even start unless its computer account is verified against the
dc based on the SID.  Same with putting a bogus PDC with the same domain
name...  A workstation won't even set up a secure channel in the first place
unless its account is verified which must happen before the
challenge/response take's place (insofar as NtLmSsp is concerned.)

Granted, you could screw with WINS a bit, but even then the IP stack will
fall back on broadcast to find a 'real' dc if you have properly configured
your node type to 0x8 (Hybrid).  If you are already on the LAN to the point
of doing all this stuff, just capture SMB packets over a few days---

```

---

[![Previous](/images/left-icon-16x16.png)](288)
[By Date](date.html#289)
[![Next](/images/right-icon-16x16.png)](290)

[![Previous](/images/left-icon-16x16.png)](274)
[By Thread](index.html#289)
[![Next](/images/right-icon-16x16.png)](291)

### Current thread:

* [Invalid WINS entries](264) *Byrne, David (Jan 17)*
  + [Re: Invalid WINS entries](269) *Attonbitus Deus (Jan 18)*
  + [Re: Invalid WINS entries](271) *3APA3A (Jan 18)*
  + [Re: Invalid WINS entries](276) *Paul L Schmehl (Jan 18)*
  + <Possible follow-ups>
  + [Re: Invalid WINS entries](274) *Fulton L. Preston Jr. (Jan 18)*
  + **Re: Invalid WINS entries** *Byrne, David (Jan 18)*
    - [Re: Invalid WINS entries](291) *Attonbitus Deus (Jan 18)*
  + [Re: Invalid WINS entries](298) *Russ (Jan 19)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")



=== Content from seclists.org_ae171175_20250125_131415.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![bugtraq logo](/images/bugtraq-logo.png)](/bugtraq/)
## [Bugtraq](/bugtraq/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](275)
[By Date](date.html#276)
[![Next](/images/right-icon-16x16.png)](277)

[![Previous](/images/left-icon-16x16.png)](271)
[By Thread](index.html#276)
[![Next](/images/right-icon-16x16.png)](274)

![](/shared/images/nst-icons.svg#search)

# Re: Invalid WINS entries

---

*From*: Paul L Schmehl <pauls () UTDALLAS EDU>

*Date*: Wed, 17 Jan 2001 23:00:59 -0600

---

```

(Posted to BUGTRAQ and mailed to David Byrne.)

I reported this problem to Microsoft, NTBUGTRAQ and the Samba folks
(PR#10706) over two years ago.  (10/23/98)  I posted an explanation to
NTBUGTRAQ on March 2, 1999.

We were able to capture logins using a Red Hat box running Samba (1.9.18p5)
"masquerading" as a DC and compile a list of username/password combos in
clear text.  We were also able to create a DoS condition in the domain,
where logins began to fail throughout the network.

MS's response was that because WINS uses NetBIOS, which has no security
capabilities, there was no way to prevent that sort of hijacking.  Their
answer is Active Directory, Kerberos and DNS.

We were not able to find a way to exploit it remotely **if** you are
blocking NetBIOS at the DMZ, as you should be (both outgoing and incoming.)

--On Wednesday, January 17, 2001 4:35 PM -0500 "Byrne, David"
<dbyrne () TIAA-CREF ORG> wrote:

```
> ```
>
> After playing around with some WINS problems we were having, I discovered
> something that doesn't seem to bother very many people. WINS does nothing
> to verify the 1Ch (domain controllers) registrations sent to it.
>
> ```

```

Paul L. Schmehl, pauls () utdallas edu
Supervisor, Support Services
The University of Texas at Dallas

```

---

[![Previous](/images/left-icon-16x16.png)](275)
[By Date](date.html#276)
[![Next](/images/right-icon-16x16.png)](277)

[![Previous](/images/left-icon-16x16.png)](271)
[By Thread](index.html#276)
[![Next](/images/right-icon-16x16.png)](274)

### Current thread:

* [Invalid WINS entries](264) *Byrne, David (Jan 17)*
  + [Re: Invalid WINS entries](269) *Attonbitus Deus (Jan 18)*
  + [Re: Invalid WINS entries](271) *3APA3A (Jan 18)*
  + **Re: Invalid WINS entries** *Paul L Schmehl (Jan 18)*
  + <Possible follow-ups>
  + [Re: Invalid WINS entries](274) *Fulton L. Preston Jr. (Jan 18)*
  + [Re: Invalid WINS entries](289) *Byrne, David (Jan 18)*
    - [Re: Invalid WINS entries](291) *Attonbitus Deus (Jan 18)*
  + [Re: Invalid WINS entries](298) *Russ (Jan 19)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")



=== Content from seclists.org_716e0fa4_20250125_131412.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![bugtraq logo](/images/bugtraq-logo.png)](/bugtraq/)
## [Bugtraq](/bugtraq/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](268)
[By Date](date.html#269)
[![Next](/images/right-icon-16x16.png)](270)

[![Previous](/images/left-icon-16x16.png)](264)
[By Thread](index.html#269)
[![Next](/images/right-icon-16x16.png)](271)

![](/shared/images/nst-icons.svg#search)

# Re: Invalid WINS entries

---

*From*: Attonbitus Deus <Thor () HAMMEROFGOD COM>

*Date*: Wed, 17 Jan 2001 16:54:06 -0800

---

```
It doesn't work that way.  If you put a bogus BDC on the lan, the server
service won't even start unless its computer account is verified against the
dc based on the SID.  Same with putting a bogus PDC with the same domain
name...  A workstation won't even set up a secure channel in the first place
unless its account is verified which must happen before the
challenge/response take's place (insofar as NtLmSsp is concerned.)

Granted, you could screw with WINS a bit, but even then the IP stack will
fall back on broadcast to find a 'real' dc if you have properly configured
your node type to 0x8 (Hybrid).  If you are already on the LAN to the point
of doing all this stuff, just capture SMB packets over a few days---

---------------------------------
Attonbitus Deus
Thor () HammerofGod Com

----- Original Message -----
From: "Byrne, David" <dbyrne () TIAA-CREF ORG>
To: <BUGTRAQ () SECURITYFOCUS COM>
Sent: Wednesday, January 17, 2001 1:35 PM
Subject: Invalid WINS entries

```
> ```
> After playing around with some WINS problems we were having, I discovered
> something that doesn't seem to bother very many people. WINS does nothing
>
> ```

```
to

```
> ```
> verify the 1Ch (domain controllers) registrations sent to it. This allows
>
> ```

```
an

```
> ```
> attacker to overwrite some or all of the Domain Controllers in the record.
> The new entries could be pointing at a box that will participate in the
> logon process long enough to capture user names and passwords. If the
> passwords are only hashed with LanMan (not NTLM), they can be easily
>
> ```

```
broken

```
> ```
> with L0phtCrack. A less malicious problem can occur if someone brings up a
> server that incorrectly thinks it is a Domain Controller. Although the
> server cannot participate in the domain, it will register itself with WINS
> in the 1Ch record and workstations will still send logon requests to it.
>
> The best work around I could think of is to use static entries for records
> that are sensitive (there are probably more besides 1Ch). Domain
>
> ```

```
Controllers

```
> ```
> shouldn't be changed very often, so the management work would be minimal.
> When I contacted Microsoft, I was told that they were aware of this, but
>
> ```

```
did

```
> ```
> not consider it a significant problem. They confirmed that static records
> were the best solution.
>
> Attached is a PERL script that can demonstrate the problem. Use it
> cautiously.
>
>
> David Byrne, MCSE
> TIAA CREF
>
>  <<wins2.pl>>
>
>
>
> ```

```

```

---

[![Previous](/images/left-icon-16x16.png)](268)
[By Date](date.html#269)
[![Next](/images/right-icon-16x16.png)](270)

[![Previous](/images/left-icon-16x16.png)](264)
[By Thread](index.html#269)
[![Next](/images/right-icon-16x16.png)](271)

### Current thread:

* [Invalid WINS entries](264) *Byrne, David (Jan 17)*
  + **Re: Invalid WINS entries** *Attonbitus Deus (Jan 18)*
  + [Re: Invalid WINS entries](271) *3APA3A (Jan 18)*
  + [Re: Invalid WINS entries](276) *Paul L Schmehl (Jan 18)*
  + <Possible follow-ups>
  + [Re: Invalid WINS entries](274) *Fulton L. Preston Jr. (Jan 18)*
  + [Re: Invalid WINS entries](289) *Byrne, David (Jan 18)*
    - [Re: Invalid WINS entries](291) *Attonbitus Deus (Jan 18)*
  + [Re: Invalid WINS entries](298) *Russ (Jan 19)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")



=== Content from seclists.org_3c1b8db8_20250125_131415.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![bugtraq logo](/images/bugtraq-logo.png)](/bugtraq/)
## [Bugtraq](/bugtraq/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](273)
[By Date](date.html#274)
[![Next](/images/right-icon-16x16.png)](275)

[![Previous](/images/left-icon-16x16.png)](276)
[By Thread](index.html#274)
[![Next](/images/right-icon-16x16.png)](289)

![](/shared/images/nst-icons.svg#search)

# Re: Invalid WINS entries

---

*From*: "Fulton L. Preston Jr." <fulton () PRESTONS ORG>

*Date*: Wed, 17 Jan 2001 23:04:42 -0500

---

```
Interesting perl script but this method works just as well for a good
old fashioned DDoS:

About two years ago a friend of mine and I did something similar with a
Samba server.  I configured Samba to be a PDC for a Domain and pointed
it towards my friends WINS server for his network.  The Samba domain
name was the same as his.  Using snoop on a Sun box I watched the
traffic between the Linux server with Samba and the NT WINS server when
I started the Samba server.  I don't have the captures anymore but here
is a basic re-creation of the events:

Samba to WINS: I am the PDC
WINS to Samba: Uh, I don't think so.
Samba to WINS: Yes I am
WINS to Samba: Didn't you hear me the first time?
Samba to WINS (using Jedi hand waving motion):  <<I AM THE PDC>>
WINS to Samba: YOU ARE THE PDC

Elapsed time: 2 seconds.

Result:  No one in that NT Domain could login, print, or use Outlook.
It even caused the Exchange server to wig out.  All workstations and
member servers started sending their auth requests to the Samba server.
I didn't check to see if it was LanMan or NTLM, that was not the point
of the experiment at that time.

Solution: Use static IP's for PDC/BDC's and enter static entries into
WINS.  More importantly, block TCP/UDP 135-139 at firewalls (or at least
only pass trusted IP's)

Interesting side effect:  The PDC would not auth anybody even when
static entries into WINS were added and the Samba server was shutdown.
A reboot of the PDC and BDC was necessary to restore the trust of the
PDC/BDC's.

Lesson learned:  Large corporations or military bases with large scale
networks that let ports 135-139 through the firewalls without filtering
are subject to this type of attack.  Imagine a 25,000+ user network not
able to login, print, etc...  The overall costs are pretty staggering,
especially if it continues for days, even more sickening is how many
passwords could be snatched by doing this, even if only for a few
minutes.  Sad part of this lesson is that way too many large networks
are STILL vulnerable to this.  The only thing needed is a WINS server
address.  In the case of some NT DNS servers that information is easily
harvested since there is a value for WINS recursive lookup if it is set
by the admins (read: EVIL! Do not do this, only for internal DNS servers
behind firewalls if it must be done!)

Enjoy,
Fulton Preston

[This is supposed to be an annoying signature.  Annoyed yet?]

-----Original Message-----
From: Byrne, David [mailto:dbyrne () TIAA-CREF ORG]
Sent: Wednesday, January 17, 2001 4:36 PM
To: BUGTRAQ () SECURITYFOCUS COM
Subject: Invalid WINS entries

After playing around with some WINS problems we were having, I
discovered
something that doesn't seem to bother very many people. WINS does
nothing to
verify the 1Ch (domain controllers) registrations sent to it. This
allows an
attacker to overwrite some or all of the Domain Controllers in the
record.
The new entries could be pointing at a box that will participate in the
logon process long enough to capture user names and passwords. If the
passwords are only hashed with LanMan (not NTLM), they can be easily
broken
with L0phtCrack. A less malicious problem can occur if someone brings up
a
server that incorrectly thinks it is a Domain Controller. Although the
server cannot participate in the domain, it will register itself with
WINS
in the 1Ch record and workstations will still send logon requests to it.

The best work around I could think of is to use static entries for
records
that are sensitive (there are probably more besides 1Ch). Domain
Controllers
shouldn't be changed very often, so the management work would be
minimal.
When I contacted Microsoft, I was told that they were aware of this, but
did
not consider it a significant problem. They confirmed that static
records
were the best solution.

Attached is a PERL script that can demonstrate the problem. Use it
cautiously.

David Byrne, MCSE
TIAA CREF

 <<wins2.pl>>

```

---

[![Previous](/images/left-icon-16x16.png)](273)
[By Date](date.html#274)
[![Next](/images/right-icon-16x16.png)](275)

[![Previous](/images/left-icon-16x16.png)](276)
[By Thread](index.html#274)
[![Next](/images/right-icon-16x16.png)](289)

### Current thread:

* [Invalid WINS entries](264) *Byrne, David (Jan 17)*
  + [Re: Invalid WINS entries](269) *Attonbitus Deus (Jan 18)*
  + [Re: Invalid WINS entries](271) *3APA3A (Jan 18)*
  + [Re: Invalid WINS entries](276) *Paul L Schmehl (Jan 18)*
  + <Possible follow-ups>
  + **Re: Invalid WINS entries** *Fulton L. Preston Jr. (Jan 18)*
  + [Re: Invalid WINS entries](289) *Byrne, David (Jan 18)*
    - [Re: Invalid WINS entries](291) *Attonbitus Deus (Jan 18)*
  + [Re: Invalid WINS entries](298) *Russ (Jan 19)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")



=== Content from seclists.org_c090d069_20250125_131413.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![bugtraq logo](/images/bugtraq-logo.png)](/bugtraq/)
## [Bugtraq](/bugtraq/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](270)
[By Date](date.html#271)
[![Next](/images/right-icon-16x16.png)](272)

[![Previous](/images/left-icon-16x16.png)](269)
[By Thread](index.html#271)
[![Next](/images/right-icon-16x16.png)](276)

![](/shared/images/nst-icons.svg#search)

# Re: Invalid WINS entries

---

*From*: 3APA3A <3APA3A () SECURITY NNOV RU>

*Date*: Thu, 18 Jan 2001 13:04:29 +0300

---

```
Dear Byrne, David,

While adding new Windows NT workstation into NT domain workstation and
PDC  do  key  exchange.  Same  process  is  between  domains  in trust
relationships. This keys are used to establish secure channel for user
authentication. Keys prevents attack you described.

The  only  situation  your  scenario  works is user logon from Windows
95/98 host. This is known, documented problem.

BTW,  it  looks  like  NT  queries WINS about DC only in case it can't
contact  DC  which  does  last  authentication and there is no DC's in
local network and it doesn't depend on node type.

MS  recommends to filter WINS traffic to prevent WINS from any DoS and
spoofing attacks.

18.01.2001 0:35, you wrote: Invalid WINS entries;

B> After playing around with some WINS problems we were having, I discovered
B> something that doesn't seem to bother very many people. WINS does nothing to
B> verify the 1Ch (domain controllers) registrations sent to it. This allows an
B> attacker to overwrite some or all of the Domain Controllers in the record.
B> The new entries could be pointing at a box that will participate in the
B> logon process long enough to capture user names and passwords. If the
B> passwords are only hashed with LanMan (not NTLM), they can be easily broken
B> with L0phtCrack. A less malicious problem can occur if someone brings up a
B> server that incorrectly thinks it is a Domain Controller. Although the
B> server cannot participate in the domain, it will register itself with WINS
B> in the 1Ch record and workstations will still send logon requests to it.

B> The best work around I could think of is to use static entries for records
B> that are sensitive (there are probably more besides 1Ch). Domain Controllers
B> shouldn't be changed very often, so the management work would be minimal.
B> When I contacted Microsoft, I was told that they were aware of this, but did
B> not consider it a significant problem. They confirmed that static records
B> were the best solution.

B> Attached is a PERL script that can demonstrate the problem. Use it
B> cautiously.

B> David Byrne, MCSE
B> TIAA CREF

B>  <<wins2.pl>>

--
   Vladimir Dubrovin                  Sandy, ISP
    Sandy CCd chief               Customers Care dept
  <http://www.sandy.ru>           Nizhny Novgorod, Russia

<http://www.security.nnov.ru>

```

---

[![Previous](/images/left-icon-16x16.png)](270)
[By Date](date.html#271)
[![Next](/images/right-icon-16x16.png)](272)

[![Previous](/images/left-icon-16x16.png)](269)
[By Thread](index.html#271)
[![Next](/images/right-icon-16x16.png)](276)

### Current thread:

* [Invalid WINS entries](264) *Byrne, David (Jan 17)*
  + [Re: Invalid WINS entries](269) *Attonbitus Deus (Jan 18)*
  + **Re: Invalid WINS entries** *3APA3A (Jan 18)*
  + [Re: Invalid WINS entries](276) *Paul L Schmehl (Jan 18)*
  + <Possible follow-ups>
  + [Re: Invalid WINS entries](274) *Fulton L. Preston Jr. (Jan 18)*
  + [Re: Invalid WINS entries](289) *Byrne, David (Jan 18)*
    - [Re: Invalid WINS entries](291) *Attonbitus Deus (Jan 18)*
  + [Re: Invalid WINS entries](298) *Russ (Jan 19)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")



=== Content from seclists.org_9add5fdc_20250125_131417.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![bugtraq logo](/images/bugtraq-logo.png)](/bugtraq/)
## [Bugtraq](/bugtraq/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](297)
[By Date](date.html#298)
[![Next](/images/right-icon-16x16.png)](299)

[![Previous](/images/left-icon-16x16.png)](291)
[By Thread](index.html#298)
[![Next](/images/right-icon-16x16.png)](265)

![](/shared/images/nst-icons.svg#search)

# Re: Invalid WINS entries

---

*From*: Russ <Russ.Cooper () RC ON CA>

*Date*: Fri, 19 Jan 2001 03:43:27 -0500

---

```
-----BEGIN PGP SIGNED MESSAGE-----

My take is this isn't a security issue.

WINS is definitely not a security mechanism, WINS is a replacement
for NBNS, or NetBIOS Name Services from Ungermann-Bass and the late
80's LANMAN environments. Its strictly intended to prevent the old
broadcast storms some of us may remember having to fire-fight.

The fact that the NT Domain Authentication environment relies upon
NetBIOS machine types (e.g. 1Ch) to determine whom to direct logon
attempts to is not a security design, but simply the LANMAN-way. It
was never secure from hijacking unless everyone was polite and didn't
do what you noticed (implemented in Samba by Ashton/Leighton/Allison
so Samba could participate *correctly* in an NT Domain).

NTLMv2 and the various options it makes available, such as
SMB-signing, was intended to thwart MITM attacks and spoofing of
things like 1Chs, but it doesn't affect the basic operation of WINS.
If you allow dynamic registrations then a WINS server will accept a
broadcast of any server type and add its record.

The question is only whether or not such a record will be used by
clients.

The election process for PDCs in an NT environment assumes that all
parties are cooperating. If they do, then the process goes smoothly.
Whomever responds first to the election call basically wins the
election. Since all parties are supposedly looking at the same
election results, they're supposed to back off when they see they're
not the winner. Your observations of the reaction of a valid PDC, one
that knows it won the election, to an insistent PDC saying it still
holds the token is consistent with registry tweaks available to force
one NT box to be PDC in an environment where two NT boxes believe,
honestly, they're both PDC. NT 3.5/3.51 in WAN environments
notoriously corrupted Domain Master Browser/Segment Master Browser
tables with or without WINS which sometimes required forcing a PDC by
some means other than elections.

Ergo, NT ended up with a failover mechanism built in to deal with
such insistence. Of course it expected the insistence to come from
another NT box, not a Samba server (and a *normal* Samba server will
behave appropriately).

If you rely upon WINS to enforce your authentication realm then you
are sorely misguided. Anyone who installed Win95's first releases
into NT Domains has probably experienced the unreliability of WINS to
maintain Browse Masters and, by extension, the loss of an
authenticating DC due to a conflicting client broadcast. There are
good reasons why MS dropped further WINS development.

Static entries only prevent entries from being over-written, they
don't prevent the arguments between an insistent box (e.g. a
mal-configured Samba Server or an errant Win9x box) and those that
believe themselves to be who they think they are. They won't prevent
boxes from disappearing from the network, or segments from believing
someone other than the WINS server. They can also cause other
problems. NT 4.0 SP4 introduced the ability to immediately delete
dynamic WINS entries (not available through WINS Manager prior to
SP4, only via a tool called WINSCL.exe), or Tombstone out dynamic
WINS entries that aren't desired (or malicious attempts to DoS a DC
via WINS). For more details, see;

<http://support.microsoft.com/support/kb/articles/Q184/6/93.asp>

SMB-signing, OTOH, can make NT/W2K-only environments resistant to
this type of tampering (not the WINS servers, but the client's being
fooled into talking to someone other than the *real thang*).

```
> ```
> First, I think you're right about the secure channel for NT, but
> does this apply to 9x as well?
>
> ```

```

No, 9x machines don't have machine accounts in NT domains and don't
use a secure channel prior to authentication.

```
> ```
> Second, even though a bogus DC won't participate in a domain, it
> will still register itself in the 1C record.
>
> ```

```

Not sure how you can describe something as a "bogus DC". You can set
up a Samba server to be a DC in an NT Domain, nothing bogus about it.
Anything can advertise itself as a NetBIOS 1C and have it registered
in the WINS dB, WINS does nothing to verify that the machine
advertising itself is, in fact, what it claims to be (in terms of
serviceability), unless of course NTLMv2/SMB-signing is enabled.

That aside, you should also realize the way WINS servers return 1Ch
entries when queried. Basically, if the WINS server is a DC then it
will return its own address as the first address the querying client
should try, followed by up to 24 additional DC addresses it knows
about in order according to date and time of registration (oldest
first).

Ergo, your attack is thwarted if the WINS server is also a DC for the
domain that the client is attempting to auth to. For more details,
see;

<http://support.microsoft.com/support/kb/articles/Q167/3/65.asp>

```
> ```
> I also disagree that an H-node configuration is "properly
> configured". NetBIOS broadcasts only allow you to query your network
> segment (assuming you aren't forwarding broadcasts). This system
> might work fine in a
> small environment, but P-node is the only way to go for an
> enterprise scale operation.
>
> ```

```

Couple of problems here. H-node uses P-node first, and falls back to
B-node when a NBNS (WINS) registration fails. Ergo, if I can't get to
the WINS server I'm still allowed to get to the network. P-node only
would prevent your networking from initializing if your WINS server
was inaccessible (due to a router down, server unavailable,
whatever). In an Enterprise environment its far more likely that the
WINS server might not be accessible than in a small environment, ergo
I'd argue that P-node only is most applicable in small environments
rather than enterprise size. H-node will minimize the support calls.
H-node configured clients that fail on P-node will continue to retry
registration with the unavailable WINS server until it becomes
available, using B-node in the meantime. For more details, see;

<http://support.microsoft.com/support/kb/articles/q119/4/93.asp>

Further, NetBIOS clients will still rely upon local Browse Masters
regardless of what WINS tells them. After registering themselves with
the WINS server, they won't go back to it unless they need to resolve
a name they don't have in their cache already. Anything on the same
segment as the client will be in its cache and, therefore, not
require a WINS query. See the section titled "How WINS works" at the
bottom of;

<http://support.microsoft.com/support/kb/articles/q119/4/93.asp>

Cheers,
Russ - Surgeon General of TruSecure Corporation/NTBugtraq Editor

-----BEGIN PGP SIGNATURE-----
Version: PGP Personal Privacy 6.5.2

iQCVAwUBOmf+LxBh2Kw/l7p5AQHifwP/SnuFczSOZ37EyZg6JE/a+MiKoYnZofW7
OILdGcrZczxBfbc4ZTgNPTz1gjNNshhh5CBdwerYB6FPqXGe57AO4W/YI6uI/cl2
l56dq7gMTxzPXez0GGFCe+eur1NyKmqMzQPHzVua2GJLkgwCqExYwaeLysmvh6lO
mKuwUd85QVM=
=wiaW
-----END PGP SIGNATURE-----

```

---

[![Previous](/images/left-icon-16x16.png)](297)
[By Date](date.html#298)
[![Next](/images/right-icon-16x16.png)](299)

[![Previous](/images/left-icon-16x16.png)](291)
[By Thread](index.html#298)
[![Next](/images/right-icon-16x16.png)](265)

### Current thread:

* [Invalid WINS entries](264) *Byrne, David (Jan 17)*
  + [Re: Invalid WINS entries](269) *Attonbitus Deus (Jan 18)*
  + [Re: Invalid WINS entries](271) *3APA3A (Jan 18)*
  + [Re: Invalid WINS entries](276) *Paul L Schmehl (Jan 18)*
  + <Possible follow-ups>
  + [Re: Invalid WINS entries](274) *Fulton L. Preston Jr. (Jan 18)*
  + [Re: Invalid WINS entries](289) *Byrne, David (Jan 18)*
    - [Re: Invalid WINS entries](291) *Attonbitus Deus (Jan 18)*
  + **Re: Invalid WINS entries** *Russ (Jan 19)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")


