=== Content from bneg.io_ed5ab10a_20250125_071835.html ===

[Skip to content](#content)
# [bneg](https://bneg.io/)

If you seek peace, prepare for war

Menu

Search

* [Home](/)
* [About](https://bneg.io/about/)
* [Contact](https://bneg.io/contact/)

Search for:

Search

[![](https://bneg.io/wp-content/uploads/2017/05/cropped-20160704-jjj_3927.jpg)](https://bneg.io/)
# Vulnerabilities in Cohu 3960HD

On [May 12, 2017May 13, 2017](https://bneg.io/2017/05/12/vulnerabilities-in-cohu-3960hd/) By [Jeremy Johnson](https://bneg.io/author/beyondnegative/)In [Red Team](https://bneg.io/category/red-team/), [Vulnerabilities](https://bneg.io/category/red-team/vulnerabilities/)

[[Originally posted at Critical Informatics]](https://criticalinformatics.com/cohu-3960hd-camera-vulnerabilities/)

## **Vulnerabilities Summary**

The Cohu 3960HD Series cameras contain multiple vulnerabilities: directory listing, unauthenticated XMLRPC commands, arbitrary file upload and code execution, source code disclosure, failed session expiration, and client-side input validation vulnerabilities were discovered. The directory listing issue led to the discovery of other included vulnerabilities.

## **Product Overview**

The Cohu 3960HD is a rugged IP enabled pan/tilt/zoom camera designed for outdoor use in critical infrastructure. Research and experience shows they are often used as traffic cameras.The camera has two main interfaces for interaction, a web interface and an API.

## **Timeline**

8/27/2015 – Discovered vulnerabilities

9/10/2015 – Shodan shows ~200 devices directly connected to internet

12/2/2015 – Internal conversations on disclosure (legal issues)

2/29/2016 – Contact with client to discuss remediation of vulnerabilities

3/2/2016 – Vendor notified of vulnerabilities, follow up call scheduled

3/15/2016 – Meeting scheduled, then cancelled

3/17/2016 – Meeting scheduled, then cancelled

4/1/2016 – Email from client to vendor sent requesting follow-up

4/12/2016 – Vendor states they have been performing a security assessment on their newer camera

4/21/2016 – Vendor response states vulnerabilities are corrected in new hardware model

9/29/2016 – Client provides permission to publish vulnerability

5/4/2017 – Vendor contacted to get update and informed of intent to publish. Vulnerabilities not patched as the 3960HD “had reached maturity”, in other words end-of-life.

## **Vulnerability Classes**

[CWE-548](https://cwe.mitre.org/data/definitions/548.html) – Information Exposure Through Directory Listing

[CWE-319](https://cwe.mitre.org/data/definitions/319.html) – Cleartext Transmission of Sensitive Information

[CWE-306](https://cwe.mitre.org/data/definitions/306.html) – Missing Authentication for Critical Function

[CWE-434](https://cwe.mitre.org/data/definitions/434.html) – Unrestricted Upload of File with Dangerous Type

[CWE-540](https://cwe.mitre.org/data/definitions/540.html) – Information Exposure Through Source Code

[CWE-602](https://cwe.mitre.org/data/definitions/602.html) – Client Side Enforcement of Server-Side Security

## **CVE IDs**

[CVE-2017-8860](https://cve.mitre.org/cgi-bin/cvename.cgi?name=2017-8860)

[CVE-2017-8861](https://cve.mitre.org/cgi-bin/cvename.cgi?name=2017-8861)

[CVE-2017-8862](https://cve.mitre.org/cgi-bin/cvename.cgi?name=2017-8862)

[CVE-2017-8863](https://cve.mitre.org/cgi-bin/cvename.cgi?name=2017-8863)

[CVE-2017-8864](https://cve.mitre.org/cgi-bin/cvename.cgi?name=2017-8864)

## **Vulnerability Details**

### **Information Exposure Through Directory Listing**

Appending an extra “/” on <http://cohu_camera_ip/> results in a full directory listing

```
GET // HTTP/1.1
Host: cohu_camera_ip
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Cookie: session=-- [REDACTED]

HTTP/1.1 200 OK
Date: Thu, 08 Jan 1970 03:36:38 GMT
Server: Cohu Camera
Content-Type: text/html
Content-Length: 7953

<html>
<head>
<title>Directory listing of /ambarella/appweb/web                </title>
<style type="text/css">
body {font-family:courier new,verdana,sans-serif;background-color:#eeeeee;}
table{font-size: 12px; font-weight:bold}
</style>
</head>
<body>
<p/>
<center>
<h2>Directory listing of //drwxr-xr-x</td>
<td>default</td>
<td>default</td>
<td align="right">0</td>
<td>1970-01-01T00:00:00.876Z</td>
<td>1970-01-01T00:00:00.787Z</td>
<td><a href="/">..</a></td>
</tr>                        <tr>
<td>drwxr-xr-x</td>
<td>default</td>
<td>default</td>
<td align="right">0</td>
<td>1970-01-17T09:47:27.203Z</td>
<td>1970-01-01T00:00:00.787Z</td>
<td><a href="/js">js</a></td>

```
### **Cleartext Transmission of Sensitive Information**

The Cohu 3960HD is not capable of running the SSL libraries due to processor constraints. The lack of encrypted communications exposes both the HTTP and XMLRPC services to content sniffing and man in the middle attacks.

### **Missing Authentication for Critical Function**

Port 1236/TCP accepts unauthenticated XML SOAP formatted commands. These commands can be used to change IP addresses, user names, and passwords

The following configuration parameters can be sent:

```
CM_CFGIP_ALL,
CM_CFGIP_USEDHCP,
CM_CFGIP_DEVICEIP,
CM_CFGIP_SUBNETMASK,
CM_CFGIP_GATEWAYADDRESS,
CM_CFGIP_HOSTNAME,
CM_CFGIP_USEDNSSERVER,
CM_CFGIP_DOMAIN,
CM_CFGIP_DNSSERVER,
CM_CFGIP_USERNAME,
CM_CFGIP_PASSWORD,
CM_CFGIP_END,
CM_CFGSTREAMING_ALL = 32,
CM_CFGSTREAMING_STREAM1TRANSPORT,
CM_CFGSTREAMING_STREAM1MULTIADDRESS,
CM_CFGSTREAMING_STREAM1MAXPACKETSIZE,
CM_CFGSTREAMING_STREAM2TRANSPORT = 48,
CM_CFGSTREAMING_STREAM2MULTIADDRESS,
CM_CFGSTREAMING_STREAM2MAXPACKETSIZE,
CM_CFGSTREAMING_END,
CM_CFGFORMAT_ALL = 64,
CM_CFGFORMAT_SENSORINPUT,
CM_CFGFORMAT_FRAMERATE,
CM_CFGFORMAT_ENCODING,
CM_CFGFORMAT_STREAM1RESOLUTION,
CM_CFGFORMAT_STREAM1FRAMERATE,
CM_CFGFORMAT_STREAM1BITRATE,

```
### **Unrestricted Upload of File with Dangerous Type**

As part of the firmware upload process, webupgrade.sh unpacks the tar file and runs postinstall.sh. Any tar file could be uploaded with a malicious postinstall.sh, which the camera would execute with root privileges.

### **Information Exposure Through Source Code**

Due to the directory listing, and the failure of the web server to recognize “.esp” as server-side code, the web server displays the full source code of “.esp” web pages. This reveals more information about the system and potential attacks paths and targets. Multiple cases of this exist on the platform.

```
GET /upgrade.esp HTTP/1.1
Host: cohu_camera_ip
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Referer: [http://172.16.0.2//](http://172.16.0.2/)
Cookie: session=--[REDACTED]

HTTP/1.1 200 OK
Date: Thu, 08 Jan 1970 03:36:38 GMT
Last-Modified: Wed, 03 Dec 2014 22:53:19 GMT
Content-Length: 691
Content-Type: text/plain
Date: Thu, 08 Jan 1970 03:36:38 GMT
Server: Cohu Camera

<html>
<head>
<title>Cohu Firmware Upgrade Completed</title>
<META HTTP-EQUIV="Refresh" CONTENT="2;url=/cgi-bin/upgrade.cgi">
<style type="text/css">
body {
color: black; background: #CCCCCC;
margin-left: 10%; margin-right: 10%;
}
h1, h2 { margin-left: -5%; }
hr { color: gray; }
</style>
</head>

<%
if (request["REQUEST_METHOD"] == "POST") {
write("<br/><hr/> <p><br/>File " + files['uploadFile'].CLIENT_FILENAME +
" has been uploaded.</p>");
target = "/tmp/cohuupload";
rename(files['uploadFile'].FILENAME, target);
write ("<p><h3>Please wait as the new image is written on permanent storage...</h3></p> <br/><hr/>");
}
%>
</html>
```

**AND**

GET /tmp/tmp\_root/bin/postinstall.sh

```
#!/bin/sh
doneFile="/tmp/upgradeweb.done"
lockFile="/tmp/upgradeweb.lock"
status="/tmp/upgradeweb.status"

countDots() {
cnt=`cat $lockFile`
echo "0" > $lockFile
i=0
while [ $i -lt $cnt ]; do
echo -n " ." >> $status
i=`expr $i + 1`
done
echo "" >> $status
}

doneStatus=0
untarDir=`echo $0 | sed -e 's|\(.*\)/bin/.*$|\1|'`

echo "Checking MAC address" >> $status
mac=""
eeprom_out="/tmp/eeprom.out"
if [ ! -f $eeprom_out ]; then
/usr/local/bin/eeprom_read > $eeprom_out
if [ ! -f $eeprom_out ]; then
echo "Failed to read EEPROM: Is it programmed? " >> $status
exit 4
fi
fi
```
### **Client Side Enforcement of Server Side Security**

Multiple cases of using client-side code to check server-side parameters and configuration changes. Client side code (Javascript) can be manipulated or disabled before being sent back to the server to inject spurious information to the system to cause failure or compromise.

**Sample (many other instances)**

```
function submit_changes(save) {
var ctl;
var xml = "";
if (!form.Validate()) {
var logMessage = new LogMessage();
logMessage.Header = "Form validation errors!";
for (var i = 0; i < form.ValidationErrors.length; i++) {
logMessage.Lines[logMessage.Lines.length] = form.ValidationErrors[i]
}

document.Logger.LogUserInfo(logMessage);
return;
}
form.ApplyData();

if (!passwordsAreEqual())
return;

try {
//set settings
var xmlRequest = (new SetFTPEmailRequest(form.FTP, form.Email)).ToXml();
document.Logger.LogDebug(xmlRequest);
var info;
if (info = opener.soapRequest("device_service", xmlRequest)) {
var xmlFault = info.getElementsByTagName("Fault");

if (xmlFault.length > 0) {
var fault = new FaultResponse(xmlFault[0]);
document.Logger.LogDebug("Can not set FTP and Email Configuration Settings. ServiceResponse: " + fault.ToString());
}

else {
document.Logger.LogDebug(info.xml);
setAllAsDefault();
}
}
}
```
### Share this:

* [Twitter](https://bneg.io/2017/05/12/vulnerabilities-in-cohu-3960hd/?share=twitter "Click to share on Twitter")
* [Facebook](https://bneg.io/2017/05/12/vulnerabilities-in-cohu-3960hd/?share=facebook "Click to share on Facebook")
Like Loading...

## Post navigation

[Previous
#### Rome Didn’t Fall in a Day: Building A Resilient Empire C2, Part One](https://bneg.io/2017/05/08/rome-didnt-fall-in-a-day-building-a-resilient-empire-c2-part-one/)[Next
#### Dropbox for the Empire](https://bneg.io/2017/05/13/dropbox-for-the-empire/)

### Leave a comment [Cancel reply](/2017/05/12/vulnerabilities-in-cohu-3960hd/#respond)

Δ

# Search

Search for:

Search

# Social

* [View beyondnegative’s profile on Twitter](https://twitter.com/beyondnegative/)
* [View jeremy-johnson-b11a7ab5’s profile on LinkedIn](https://www.linkedin.com/in/jeremy-johnson-b11a7ab5/)
* [View bneg’s profile on GitHub](https://github.com/bneg/)
# Popular Posts

* [iTerm2 Customizations for Hackers](https://bneg.io/2018/01/15/iterm2-customizations-for-hackers/)
* [Automated Empire Infrastructure](https://bneg.io/2017/11/06/automated-empire-infrastructure/)
* [Empire without PowerShell.exe](https://bneg.io/2017/07/26/empire-without-powershell-exe/)
* [Purple Team: Your First Pentest Results](https://bneg.io/2017/06/19/purple-team-your-first-pentest-results/)
* [Purple Team: About Beacons](https://bneg.io/2017/06/09/purple-team-about-beacons/)
* [Empire Post Exploitation – Unprivileged Agent to DA Walkthrough](https://bneg.io/2017/05/24/empire-post-exploitation/)
* [Athena: The CIA's RAT vs Empire](https://bneg.io/2017/05/22/athena-the-cias-rat-vs-empire/)
* [Rome Didn’t Fall in a Day: Building A Resilient Empire C2, Part Two](https://bneg.io/2017/05/18/rome-didnt-fall-in-a-day-building-a-resilient-empire-c2-part-two/)
* [Dropbox for the Empire](https://bneg.io/2017/05/13/dropbox-for-the-empire/)
* [Vulnerabilities in Cohu 3960HD](https://bneg.io/2017/05/12/vulnerabilities-in-cohu-3960hd/)
# My Twitter Ramblings

[My Tweets](https://twitter.com/%40beyondnegative)

# Tags

[0-Days](https://bneg.io/tag/0-days/)
[empire](https://bneg.io/tag/empire/)
[infrastructure](https://bneg.io/tag/infrastructure/)
[reversing](https://bneg.io/tag/reversing/)
[vault7](https://bneg.io/tag/vault7/)
# Category Cloud

[Blue Team](https://bneg.io/category/blue-team/ "Blue Team (1)") [Commentary](https://bneg.io/category/commentary/ "Commentary (1)") [Pentesting](https://bneg.io/category/pentesting/ "Pentesting (2)") [Red Team](https://bneg.io/category/red-team/ "Red Team (10)") [Uncategorized](https://bneg.io/category/uncategorized/ "Uncategorized (4)") [Vulnerabilities](https://bneg.io/category/red-team/vulnerabilities/ "Vulnerabilities (1)") [War Story](https://bneg.io/category/war-story/ "War Story (2)")

[Create a website or blog at WordPress.com](https://wordpress.com/?ref=footer_custom_svg "Create a website or blog at WordPress.com")

* [Comment](https://bneg.io/2017/05/12/vulnerabilities-in-cohu-3960hd/#respond)
* Reblog
* Subscribe
  Subscribed

  + [![](https://secure.gravatar.com/blavatar/a05f3ee83b3255b3e9dc95dce8872a6f3a7903b41ce32522fe734a7ace6cd2ac?s=50&d=https%3A%2F%2Fs2.wp.com%2Fi%2Flogo%2Fwpcom-gray-white.png)](https://bneg.io)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fbneg.io%252F2017%252F05%252F12%252Fvulnerabilities-in-cohu-3960hd%252F)
* Privacy
* + [![](https://secure.gravatar.com/blavatar/a05f3ee83b3255b3e9dc95dce8872a6f3a7903b41ce32522fe734a7ace6cd2ac?s=50&d=https%3A%2F%2Fs2.wp.com%2Fi%2Flogo%2Fwpcom-gray-white.png) bneg](https://bneg.io)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fbneg.io%252F2017%252F05%252F12%252Fvulnerabilities-in-cohu-3960hd%252F)
  + [Copy shortlink](https://wp.me/p8e6MK-5m)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://bneg.io/2017/05/12/vulnerabilities-in-cohu-3960hd/)
  + [View post in Reader](https://wordpress.com/read/blogs/121573366/posts/332)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

%d

![](https://pixel.wp.com/b.gif?v=noscript)


