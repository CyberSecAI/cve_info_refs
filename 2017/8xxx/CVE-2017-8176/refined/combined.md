=== Content from support.huawei.com_48908a3b_20250124_170840.html ===


Product Name or Keywords (e.g. BSC6900)

Your browser version is too early. Some functions of the website may be unavailable. To obtain better user experience, upgrade the browser to the latest version.

Carrier
[Enterprise](/enterprise/en/index.html)

* 中文
* [Account Description](/carriermysupport/mySpaceNaviAction#click=myAccount)
* [Log Out](/carrierindex/logoutServlet "Log Out")

* 中文
* Sign in

* ### Carrier

  Products, Solutions and Services for Carrier
* ### [Corporate](http://www.huawei.com/en)

  [About Huawei, Press & Events , and More](http://carrier.huawei.com/en)
* ### [Consumer](http://consumer.huawei.com/en)

  [Smartphones, PC & Tablets, Wearables and More](http://consumer.huawei.com/en)
* ### [Enterprise](http://e.huawei.com/en)

  [Products, Solutions and Services for Enterprise](http://e.huawei.com/en)

Carrier
Chinese
[Log in](https://uniportal-beta.huawei.com/uniportal/?redirect=https://rnd-supportv8.huawei.com/carrierindex/)
[Log Out](/carrierindex/logoutServlet)

Back To Main Menu
Huawei Websites

Carrier

Products, Solutions and Services for Carrier

[Corporate](https://www.huawei.com/en/)

[Consumer](http://consumer.huawei.com/en)

Smartphones, PC & Tablets, Wearables and More

[Enterprise](https://e.huawei.com/en/)

Products, Solutions and Services for Enterprise

[Huawei Cloud](https://www.huaweicloud.com/intl/en-us/)

Toggle Navigation

* [Industry Insights](https://www.huawei.com/en/publications)
* Spotlight
  Back To Main Menu
  ### Lighting up the Connected Future

  + Building the best, future-oriented networks: Simplified, resilient, intelligent.
  + [Learn More](https://carrier.huawei.com/en/spotlight/netx-2025)

  ### Lighting up the Digital Future

  + Enabling operator success, cultivating new business, and facilitating user migration to 5G:
    Exploring new industry opportunities and unlocking the potential of home broadband.
  + [Learn More](https://carrier.huawei.com/en/spotlight/business-success)

  ### Lighting up the Green Future

  + Huawei empowers green connections with innovative solutions and connects the unconnected.
  + [Learn More](https://carrier.huawei.com/en/spotlight/better-world)
* Products & Solutions
  Back To Main Menu
  Products & Solutions

  ### Wireless Network

  + [5G](https://carrier.huawei.com/en/spotlight/5g)
  + [Learn More](https://carrier.huawei.com/en/products/wireless-network)

  ### Fixed Network

  + [Digital Managed Network Solutio](https://carrier.huawei.com/en/products/fixed-network/sub-solution-data-communication/Digital-Managed-Network-Solution)
  + [Premium Private Lines, Driving New Growth of ToB Services](https://carrier.huawei.com/en/products/fixed-network/agile-b2b-leased-line-services-enable-wan)
  + [Learn More](https://carrier.huawei.com/en/products/fixed-network)

  ### Cloud Core Network

  + [Telco Cloud](https://carrier.huawei.com/en/products/core-network/telco-cloud)
  + [SmartPCC](https://carrier.huawei.com/en/products/core-network/SmartPCC)
  + [SDM](https://carrier.huawei.com/en/products/core-network/sdm)
  + [5G MEC](https://carrier.huawei.com/en/products/core-network/5g-mec)
  + [Learn More](https://carrier.huawei.com/en/products/core-network)

  ### Service and Software

  + [Software Business](https://carrier.huawei.com/en/products/service-and-software/software-business)
  + [Learn More](https://carrier.huawei.com/en/products/service-and-software)

  ### Digital Power

  + [Site Power Facility](https://digitalpower.huawei.com/cn/site-power-facility/)
  + [Data Center Facility & Critical Power](https://digitalpower.huawei.com/cn/data-center-facility/)
  + [Learn More](https://carrier.huawei.com/cn/products/digital-power)

  ### Autonomous Driving Network (ADN) Solution

  + [iMaster NAIE](https://www.huaweicloud.com/product/naie.html)
  + [iMaster NCE](https://carrier.huawei.com/en/products/fixed-network)
  + [Learn More](https://carrier.huawei.com/en/adn)

  ### +IT, New Growth

  + [Internal IT Cloud Solution](https://carrier.huawei.com/en/products/it-new/internal-it-cloud)
  + [B2B Cloud Solution](https://carrier.huawei.com/en/products/it-new/cloud-tob)
  + [OneStorage Solution](https://carrier.huawei.com/en/products/it-new/onestorage)
  + [OceanStor Distributed Storage](https://carrier.huawei.com/en/products/it-new/oceanstorpacific)
  + [Learn More](https://carrier.huawei.com/en/products/it-new)
* Support
  Support
  Back To Main Menu
  Support

  ### Online technical support, software download, and document sharing, we're ready to help you with any problems you encounter. Please input the keyword!

  + [Wireless Network](/carrier/navi?coltype=product#allProduct=true&col=product&path=PBI1-7851894)
  + [Fixed Network](/carrier/navi?coltype=product#allProduct=true&col=product&path=PBI1-7275726)
  + [Cloud Core Network](/carrier/navi?coltype=product#allProduct=true&col=product&path=PBI1-21262245)
  + [Digital Power](/carrier/navi?coltype=product#allProduct=true&col=product&path=PBI1-7921455)
  + [Service and Software](/carrier/navi?coltype=product#allProduct=true&col=product&path=PBI1-7275736)
  + [Group Space](/groupspace/?lang=en)
  + [Carrier Network Common](/carrier/navi?coltype=product#allProduct=true&col=product&path=PBI1-8132379)
  + [Bulletins](/carrier/navi?coltype=news#col=bulletin)
  + [Documentation Express](/carrier/navi?coltype=other#col=other/pigeon&path=PAN-DE)
  + [HedEx Lite](/carrier/hdxDownload)

My Interests

All Product

#### Information

×

OK

You have not followed any products. Click OK to go to My Support settings page.

Product Name or Keywords
Support
There are no resources available under this node. Try again in another node.
Return to previous level after
Back to Home
You have not logged in. Please [log in](https://uniportal.huawei.com/uniportal/?redirect=http://support.huawei.com/carrier/personalSetting!forward.action&nls=en).

If you do not have an account, [register](https://uniportal.huawei.com/accounts/register.do?method=toRegister&appurl=http://support.huawei.com/carrier/personalSetting!forward.action&nls=en) an account before you log in.
You do not have the required permissions to perform this operation
The website is under construction
Search Scope:

Copy path

### Information For

* [Consumer](http://consumer.huawei.com/en)
* [Enterprise](http://e.huawei.com/en)
* [Partners](https://partner.huawei.com/web/worldwide/home)

### About Huawei

* [Trust Center](https://www.huawei.com/en/trust-center)
* [Our Company](https://www.huawei.com/en/corporate-information)
* [Events](https://www.huawei.com/en/events)
* [News](https://www.huawei.com/en/news)

### Quick Links

* [Huawei Group](https://www.huawei.com/en/)
* [Consumer Business](http://consumer.huawei.com/en/)
* [Enterprise Business](https://e.huawei.com/en/)

### Discover

* [Success Stories](https://www.huawei.com/en/cases)
* [Industry Insights](https://www.huawei.com/en/industry-insights)
* [Publications](https://www.huawei.com/en/publications)
* [Huawei Blog](https://blog.huawei.com/)
* [Huawei Facts](https://www.huawei.com/en/facts)

Copyright ©2024 Huawei Technologies Co., Ltd.

* [Terms of use](https://www.huawei.com/en/legal)
* [Privacy Policy](/carrierindex/privacyAction)
* [Contact](http://www.huawei.com/en/contact-us)
* [Cookies](https://support.huawei.com/carrier/docview%21docview?nid=NEWS2100021644&path=NN-000003/NN-0002154120)
* Cookie Settings
* [Report content](/carrier/en/complaint-page)

Information
Your session has expired. Please refresh the page.
The number of products in shopping cart exceeds the upper limit
OK
As your browser cannot support adding to 'My Favoriates' automatically, please use Ctrl+D by yourself.
长时间未操作或已退出登录，请重新登录en

####

×

OK

Cancel



=== Content from security.my_01522b67_20250124_170839.html ===


* [Home](/)
* [Contact Us](/contact-us)
* [Ask me anything](/ask)
* [Archive](/archive)
* [RSS](https://security.my/rss)

# [Security.my](/)

[Permalink](https://security.my/post/165370836947/cve-2017-8176 "Permalink")
## [CVE-2017-8176](https://security.my/post/165370836947/cve-2017-8176)

This vulnerability was found on a huawei STB that is used by a popular ISP here in Malaysia. The flaw lies in the fact that the software relies on the client to enforce subscription validation.

The web-server that the STB connects to retrieve the UI runs over HTTP and this parameter is modifiable through a configuration menu. By relaying HTTP traffic to a custom proxy running on the STB, we can substitute the requested HTML files that contain subscription validation with local files that have them removed and enable the viewing of all the channels for free.

This vulnerability affects all the STBs (Mips/Arm/Android Firmware)

Source code of the custom proxy used is available at @ <http://github.com/klks/swproxy>

To note, huawei was very responsive and professional in communications. They also asked that public disclosure be delayed to Sept 15th to ensure their customers had a chance to fully roll out the fix for this vulnerability.

Posted September 16, 2017 at 1:35 am
[2 notes](https://security.my/post/165370836947/cve-2017-8176#post-notes)

[Previous Post](https://security.my/post/164060141367)
[Next Post](https://security.my/post/167641556637)

## Show notes Hide notes

2. [![](https://assets.tumblr.com/images/default_avatar/sphere_closed_16.png)](https://rugshaan-blog.tumblr.com/ "Untitled")[rugshaan-blog](https://rugshaan-blog.tumblr.com/post/167566207237 "Untitled") reblogged this from [securitymy](https://security.my/ "Security.my") and added:
   > [Responsum : World’s Latest Security Technology See offenders from a distance of 3.5 km away with 360 degree view from...](https://rugshaan-blog.tumblr.com/post/167566207237 "View post")
3. [![](https://assets.tumblr.com/images/default_avatar/octahedron_open_16.png)](https://laksamanagroup4u-blog.tumblr.com/ "Untitled ")[laksamanagroup4u-blog](https://laksamanagroup4u-blog.tumblr.com/ "Untitled") liked this
4. [![](https://assets.tumblr.com/images/default_avatar_16.png)](https://security.my/ "Security.my")[securitymy](https://security.my/ "Security.my") posted this

Copyright © 2012–2025 Security.my.

Powered by [Tumblr](https://www.tumblr.com)

Natural Elegance theme by [Dan Hauk](http://www.danhauk.com)

![](https://px.srvcs.tumblr.com/impixu?T=1737738519&J=eyJ0eXBlIjoidXJsIiwidXJsIjoiaHR0cDovL3NlY3VyaXR5Lm15L3Bvc3QvMTY1MzcwODM2OTQ3L2N2ZS0yMDE3LTgxNzYiLCJyZXF0eXBlIjowLCJyb3V0ZSI6Ii9wb3N0LzppZC86c3VtbWFyeSIsIm5vc2NyaXB0IjoxfQ==&U=PNHGGMLHAH&K=9cc631ff2f13206fd4d5151a32e92688b2a40ab8c666e394f52cf8cd46f29142&R=)![](https://px.srvcs.tumblr.com/impixu?T=1737738519&J=eyJ0eXBlIjoicG9zdCIsInVybCI6Imh0dHA6Ly9zZWN1cml0eS5teS9wb3N0LzE2NTM3MDgzNjk0Ny9jdmUtMjAxNy04MTc2IiwicmVxdHlwZSI6MCwicm91dGUiOiIvcG9zdC86aWQvOnN1bW1hcnkiLCJwb3N0cyI6W3sicG9zdGlkIjoiMTY1MzcwODM2OTQ3IiwiYmxvZ2lkIjo3NzM1NDUyNiwic291cmNlIjozM31dLCJub3NjcmlwdCI6MX0=&U=GECKDAADND&K=fb90dbddd6e89f8eacef3ad3848d0369d57da5a7799e25ba7b6b83aada42917c&R=)

=== Content from security.my_c14add6d_20250126_022911.html ===


* [Home](/)
* [Contact Us](/contact-us)
* [Ask me anything](/ask)
* [Archive](/archive)
* [RSS](https://security.my/rss)

# [Security.my](/)

[Permalink](https://security.my/post/165370836947/cve-2017-8176 "Permalink")
## [CVE-2017-8176](https://security.my/post/165370836947/cve-2017-8176)

This vulnerability was found on a huawei STB that is used by a popular ISP here in Malaysia. The flaw lies in the fact that the software relies on the client to enforce subscription validation.

The web-server that the STB connects to retrieve the UI runs over HTTP and this parameter is modifiable through a configuration menu. By relaying HTTP traffic to a custom proxy running on the STB, we can substitute the requested HTML files that contain subscription validation with local files that have them removed and enable the viewing of all the channels for free.

This vulnerability affects all the STBs (Mips/Arm/Android Firmware)

Source code of the custom proxy used is available at @ <http://github.com/klks/swproxy>

To note, huawei was very responsive and professional in communications. They also asked that public disclosure be delayed to Sept 15th to ensure their customers had a chance to fully roll out the fix for this vulnerability.

Posted September 16, 2017 at 1:35 am
[2 notes](https://security.my/post/165370836947/cve-2017-8176#post-notes)

[Previous Post](https://security.my/post/164060141367)
[Next Post](https://security.my/post/167641556637)

## Show notes Hide notes

2. [![](https://assets.tumblr.com/images/default_avatar/sphere_closed_16.png)](https://rugshaan-blog.tumblr.com/ "Untitled")[rugshaan-blog](https://rugshaan-blog.tumblr.com/post/167566207237 "Untitled") reblogged this from [securitymy](https://security.my/ "Security.my") and added:
   > [Responsum : World’s Latest Security Technology See offenders from a distance of 3.5 km away with 360 degree view from...](https://rugshaan-blog.tumblr.com/post/167566207237 "View post")
3. [![](https://assets.tumblr.com/images/default_avatar/octahedron_open_16.png)](https://laksamanagroup4u-blog.tumblr.com/ "Untitled ")[laksamanagroup4u-blog](https://laksamanagroup4u-blog.tumblr.com/ "Untitled") liked this
4. [![](https://assets.tumblr.com/images/default_avatar_16.png)](https://security.my/ "Security.my")[securitymy](https://security.my/ "Security.my") posted this

Copyright © 2012–2025 Security.my.

Powered by [Tumblr](https://www.tumblr.com)

Natural Elegance theme by [Dan Hauk](http://www.danhauk.com)

![](https://px.srvcs.tumblr.com/impixu?T=1737858551&J=eyJ0eXBlIjoidXJsIiwidXJsIjoiaHR0cDovL3NlY3VyaXR5Lm15L3Bvc3QvMTY1MzcwODM2OTQ3L2N2ZS0yMDE3LTgxNzYiLCJyZXF0eXBlIjowLCJyb3V0ZSI6Ii9wb3N0LzppZC86c3VtbWFyeSIsIm5vc2NyaXB0IjoxfQ==&U=MNABBFBEBM&K=1eb499c0a7cd0fc7aea0da930cd8ad79773276f9462d86784aba9556120343f3&R=)![](https://px.srvcs.tumblr.com/impixu?T=1737858551&J=eyJ0eXBlIjoicG9zdCIsInVybCI6Imh0dHA6Ly9zZWN1cml0eS5teS9wb3N0LzE2NTM3MDgzNjk0Ny9jdmUtMjAxNy04MTc2IiwicmVxdHlwZSI6MCwicm91dGUiOiIvcG9zdC86aWQvOnN1bW1hcnkiLCJwb3N0cyI6W3sicG9zdGlkIjoiMTY1MzcwODM2OTQ3IiwiYmxvZ2lkIjo3NzM1NDUyNiwic291cmNlIjozM31dLCJub3NjcmlwdCI6MX0=&U=FNJCPNDELF&K=f50167e0256e5b4f6a9120524b3b52807642f6e2ce0a9b182ebf7b02d7d88110&R=)

=== Content from security.my_dad37b2e_20250126_022911.html ===
xml version="1.0" encoding="UTF-8"?
Security.myTumblr (3.0; @securitymy)https://security.my/CVE-2018-10717 - MiniUPnP ngiflib 0.4 Buffer Overflow<p>Our finding here is collaboration with @rempah. Long short story, we run a fuzzer (AFL) targeting the <a href="https://github.com/miniupnp/ngiflib" target="\_blank">ngiflib</a> version 0.4. </p><!-- more --><p><b>Description</b></p><p>The DecodeGifImg function in ngiflib.c in MiniUPnP ngiflib 0.4 does not consider the bounds of the pixels data structure, which allows remote attackers to cause a denial of service (WritePixels heap-based buffer overflow and application crash) or possibly have unspecified other impact via a crafted GIF file, a different vulnerability than CVE-2018-10677.</p><p><b>Technical Analysis</b></p><p>There&rsquo;s an buffer overflow found in ngiflib.c line 206. Size of \*\*tocopy\*\* exceeded the \*\*pixels\*\* size, and when copying into \*\*context-&gt;frbuff\_p.p8\*\* it overflow here. </p><p><b>Affected code</b>:</p><pre>static void WritePixels(struct ngiflib\_img \* i, struct ngiflib\_decode\_context \* context, const u8 \* pixels, u16 n) {
u16 tocopy;
struct ngiflib\_gif \* p = i-&gt;parent;
while(n &gt; 0) {
tocopy = (context-&gt;Xtogo &lt; n) ? context-&gt;Xtogo : n;
if(!i-&gt;gce.transparent\_flag) {
#ifndef NGIFLIB\_INDEXED\_ONLY
if(p-&gt;mode &amp; NGIFLIB\_MODE\_INDEXED) {
#endif /\* NGIFLIB\_INDEXED\_ONLY \*/
ngiflib\_memcpy(context-&gt;frbuff\_p.p8, pixels, tocopy); \*\*// crash happened here\*\*
pixels += tocopy;
</pre><p><b>ASAN output</b>:</p><pre>==3568==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x63000000fe00 at pc 0x7fc5dfe17904 bp 0x7ffd40601780 sp 0x7ffd40600f28
WRITE of size 1 at 0x63000000fe00 thread T0
#0 0x7fc5dfe17903 in \_\_asan\_memcpy (/usr/lib/x86\_64-linux-gnu/libasan.so.2+0x8c903)
#1 0x40bb4b in memcpy /usr/include/x86\_64-linux-gnu/bits/string3.h:53
#2 0x40bb4b in WritePixels /home/john/ngiflib/ngif/ngiflib.c:206
#3 0x40bb4b in DecodeGifImg /home/john/ngiflib/ngif/ngiflib.c:548
#4 0x411cc3 in LoadGif /home/john/ngiflib/ngif/ngiflib.c:784
#5 0x404d5f in SDL\_LoadAnimatedGif /home/john/ngiflib/ngif/ngiflibSDL.c:136
#6 0x401fa7 in main /home/john/ngiflib/ngif/SDLaffgif.c:107
#7 0x7fc5df74882f in \_\_libc\_start\_main (/lib/x86\_64-linux-gnu/libc.so.6+0x2082f)
#8 0x403118 in \_start (/home/john/ngiflib/ngif/SDLaffgif+0x403118)
0x63000000fe00 is located 0 bytes to the right of 64000-byte region [0x630000000400,0x63000000fe00)
allocated by thread T0 here:
#0 0x7fc5dfe23602 in malloc (/usr/lib/x86\_64-linux-gnu/libasan.so.2+0x98602)
#1 0x41390b in LoadGif /home/john/ngiflib/ngif/ngiflib.c:607
SUMMARY: AddressSanitizer: heap-buffer-overflow ??:0 \_\_asan\_memcpy
Shadow bytes around the buggy address:
0x0c607fff9f70: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x0c607fff9f80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x0c607fff9f90: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x0c607fff9fa0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x0c607fff9fb0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
=&gt;0x0c607fff9fc0:[fa]fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x0c607fff9fd0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x0c607fff9fe0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x0c607fff9ff0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x0c607fffa000: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x0c607fffa010: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
Addressable: 00
Partially addressable: 01 02 03 04 05 06 07
Heap left redzone: fa
Heap right redzone: fb
Freed heap region: fd
Stack left redzone: f1
Stack mid redzone: f2
Stack right redzone: f3
Stack partial redzone: f4
Stack after return: f5
Stack use after scope: f8
Global redzone: f9
Global init order: f6
Poisoned by user: f7
Container overflow: fc
Array cookie: ac
Intra object redzone: bb
ASan internal: fe
==3568==ABORTING</pre><p>Fixed:</p><p><a href="https://github.com/miniupnp/ngiflib/commit/cf429e0a2fe26b5f01ce0c8e9b79432e94509b6e" target="\_blank">https://github.com/miniupnp/ngiflib/commit/cf429e0a2fe26b5f01ce0c8e9b79432e94509b6e</a></p><p>References:</p><ul><li><a href="https://github.com/miniupnp/ngiflib/issues/3" target="\_blank">https://github.com/miniupnp/ngiflib/issues/3</a><br/></li><li><a href="https://nvd.nist.gov/vuln/detail/CVE-2018-10717" target="\_blank">https://nvd.nist.gov/vuln/detail/CVE-2018-10717</a><br/></li><li><a href="https://exchange.xforce.ibmcloud.com/vulnerabilities/142847" target="\_blank">https://exchange.xforce.ibmcloud.com/vulnerabilities/142847</a></li></ul>https://security.my/post/175296434267https://security.my/post/175296434267Wed, 27 Jun 2018 13:32:10 +0800bug vulnerabilityDisassemble SX OS payload.bin and extract the first AES Key<p>Here is how I dissassembled the payload.bin for SX OS</p><!-- more --><p>Using IDA Pro, load up payload.bin, select ARM Little-endian as processor and .settings below for memory organization</p><figure data-orig-width="360" data-orig-height="502" class="tmblr-full"><img src="https://64.media.tumblr.com/7e5dd619f96635b178a7369f1c73542c/tumblr\_inline\_paods0RC8o1rya2cv\_540.png" data-orig-width="360" data-orig-height="502"/></figure><p>Convert the address below to code</p><figure data-orig-width="657" data-orig-height="393" class="tmblr-full"><img src="https://64.media.tumblr.com/00b4b36dfd2c85d2a91a22190374d415/tumblr\_inline\_paoduuw47V1rya2cv\_540.png" data-orig-width="657" data-orig-height="393"/></figure><p>The First AES Key and CTR used by nwert’s tx\_unpack script (<a href="https://gist.github.com/nwert/9430a454c64248dd1186868c00b682c6" target="\_blank">https://gist.github.com/nwert/9430a454c64248dd1186868c00b682c6</a>) for stage2 is found in sub\_40030188.</p><p><br/></p><figure data-orig-width="717" data-orig-height="624" class="tmblr-full"><img src="https://64.media.tumblr.com/3fc8c30fab318cf61e4fed2564cf9fa7/tumblr\_inline\_paody0y79d1rya2cv\_540.png" data-orig-width="717" data-orig-height="624"/></figure><p>-klks</p>https://security.my/post/175107560212https://security.my/post/175107560212Thu, 21 Jun 2018 21:41:25 +0800SlimPDF Reader - NULL Pointer Dereference<p>Vulnerability: NULL Pointer Dereference <br/>Product: SlimPDF Reader - (SlimPDF Reader.exe)<br/>Tested on: Windows 10<br/>Reference: <a href="https://cwe.mitre.org/data/definitions/476.html" target="\_blank">https://cwe.mitre.org/data/definitions/476.html</a><br/>Impact: Denial of Service (can be achieved via Remote)<br/>Reported: <a href="https://support.investintech.com/hc/en-us/requests/14369" target="\_blank">https://support.investintech.com/hc/en-us/requests/14369</a></p><p><b>Summary</b><br/>A vulnerability in SlimPDF Reader could allow an unauthenticated, remote attacker to cause a denial of service (DoS) condition.</p><p>The vulnerability is due to improper processing of certain PDF documents by the affected system. An attacker could exploit this vulnerability by persuading a trusted user to open a malicious PDF document using the affected application. When the application processes the malicious document, it may dereference a NULL pointer. The error could cause the application to crash, resulting in a DoS condition.</p><!-- more --><p><b>Vulnerability Description</b><br/>NULL Pointer in SlimPDF Reader.exe in Investintech SlimPDF Reader 1.0.12 allows attacker to locally and remotely trigger Denial-of-Service. SlimPDF does not contained any other components except its own EXE file. The affected components on the executable itself (SlimPDF Reader.exe) failed to parse stream objects in PDF file.</p><p><b>Initial analysis</b><br/>To trigger the NULL pointer, open PDF with SlimPDF Reader. Upon opening the PDF, an exception occured.</p><pre>(f84.cdc): Access violation - code c0000005 (first chance)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
\*\*\* WARNING: Unable to verify checksum for C:\Program Files (x86)\Investintech.com Inc\SlimPDF Reader 1.0\SlimPDF Reader.exe
\*\*\* ERROR: Module load completed but symbols could not be loaded for C:\Program Files (x86)\Investintech.com Inc\SlimPDF Reader 1.0\SlimPDF Reader.exe
SlimPDF\_Reader+0x3457c:
0043457c 394608 cmp dword ptr [esi+8],eax ds:002b:00000008=????????
</pre><p>Looking at the exception code c0000005, it is a code for an access violation. That means that the program is accessing a memory address to which hasn&rsquo;t right to do. </p><pre>0:000:x86&gt; .exr -1
ExceptionAddress: 0043457c (SlimPDF\_Reader+0x0003457c)
ExceptionCode: c0000005 (Access violation)
ExceptionFlags: 00000000
NumberParameters: 2
Parameter[0]: 00000000
Parameter[1]: 00000008
Attempt to read from address 00000008
0:000:x86&gt; r
eax=00000002 ebx=023274a8 ecx=04357020 edx=00000005 esi=00000000 edi=0231e928
eip=0043457c esp=0019f6e0 ebp=0019f860 iopl=0 nv up ei pl zr na pe nc
cs=0023 ss=002b ds=002b es=002b fs=0053 gs=002b efl=00210246
SlimPDF\_Reader+0x3457c:
0043457c 394608 cmp dword ptr [esi+8],eax ds:002b:00000008=????????
If we see the registers above, we can see ESI contained NULL value. We can see this via memory:
0:000:x86&gt; dc esi
00000000 ???????? ???????? ???????? ???????? ????????????????
00000010 ???????? ???????? ???????? ???????? ????????????????
00000020 ???????? ???????? ???????? ???????? ????????????????
00000030 ???????? ???????? ???????? ???????? ????????????????
00000040 ???????? ???????? ???????? ???????? ????????????????
00000050 ???????? ???????? ???????? ???????? ????????????????
00000060 ???????? ???????? ???????? ???????? ????????????????
00000070 ???????? ???????? ???????? ???????? ????????????????</pre><p><b>Root Cause</b><br/>Inspecting the issue leads to the failure parsing the stream object thus causing NULL pointer dereference.</p><pre>.text:0043456D mov eax, [ebx+8] ; [ebx+8] is already containing invalid value
.text:00434570 cmp eax, 2 ;
.text:00434573 mov esi, [ebx+28h] ; [ebx+28h] containing our PDF stream (invalid value), pointer to
.text:00434576 jnz loc\_434826 ; zero flag set here, so no jump
.text:0043457C cmp [esi+8], eax ; continue executing and crash
</pre><p>
We can see the object stream in EBX as in following:
</p><pre>0:000:x86&gt; dps 023274a8
023274a8 ffffffff
023274ac ffffffff
023274b0 00000002
023274b4 41414141
023274b8 41410033
023274bc 41414141
023274c0 41414141
023274c4 41414141
023274c8 00000001
023274cc 0000000f
023274d0 00000000
023274d4 00000000
023274d8 00000000
023274dc 41414141
023274e0 bdd3747d
023274e4 80002241
023274e8 ffffffff
023274ec ffffffff
023274f0 00000000
023274f4 41414141
023274f8 41414100
023274fc 41414141
02327500 41414141
02327504 41414141
02327508 00000000
0232750c 0000000f
02327510 00000000
02327514 00000000
02327518 00000000
0232751c 41414141
02327520 bddb7445
02327524 80002341
</pre><p>
EAX containing pointer to an invalid memory:
</p><pre>0:000:x86&gt; db poi (ebx+8)
00000002 ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ?? ????????????????
00000012 ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ?? ????????????????
00000022 ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ?? ????????????????
00000032 ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ?? ????????????????
00000042 ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ?? ????????????????
00000052 ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ?? ????????????????
00000062 ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ?? ????????????????
00000072 ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ?? ????????????????
</pre><p>
Result from !analyze:
</p><pre>0:000:x86&gt; !analyze -v
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
\* \*
\* Exception Analysis \*
\* \*
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
GetUrlPageData2 (WinHttp) failed: 12002.
KEY\_VALUES\_STRING: 1
TIMELINE\_ANALYSIS: 1
Timeline: !analyze.Start
Name: &lt;blank&gt;
Time: 2018-05-28T05:55:00.250Z
Diff: 250 mSec
Timeline: Dump.Current
Name: &lt;blank&gt;
Time: 2018-05-28T05:55:00.0Z
Diff: 0 mSec
Timeline: Process.Start
Name: &lt;blank&gt;
Time: 2018-05-28T04:16:48.0Z
Diff: 5892000 mSec
Timeline: OS.Boot
Name: &lt;blank&gt;
Time: 2018-05-26T16:13:30.0Z
Diff: 135690000 mSec
DUMP\_CLASS: 2
DUMP\_QUALIFIER: 0
FAULTING\_IP:
SlimPDF\_Reader+3457c
0043457c 394608 cmp dword ptr [esi+8],eax
EXCEPTION\_RECORD: (.exr -1)
ExceptionAddress: 0043457c (SlimPDF\_Reader+0x0003457c)
ExceptionCode: c0000005 (Access violation)
ExceptionFlags: 00000000
NumberParameters: 2
Parameter[0]: 00000000
Parameter[1]: 00000008
Attempt to read from address 00000008
FAULTING\_THREAD: 00000cdc
DEFAULT\_BUCKET\_ID: NULL\_CLASS\_PTR\_READ
PROCESS\_NAME: SlimPDF Reader.exe
FOLLOWUP\_IP:
SlimPDF\_Reader+3457c
0043457c 394608 cmp dword ptr [esi+8],eax
READ\_ADDRESS: 00000008
ERROR\_CODE: (NTSTATUS) 0xc0000005 - The instruction at 0x%p referenced memory at 0x%p. The memory could not be %s.
EXCEPTION\_CODE: (NTSTATUS) 0xc0000005 - The instruction at 0x%p referenced memory at 0x%p. The memory could not be %s.
EXCEPTION\_CODE\_STR: c0000005
EXCEPTION\_PARAMETER1: 00000000
EXCEPTION\_PARAMETER2: 00000008
WATSON\_BKT\_PROCSTAMP: 4ecd831a
WATSON\_BKT\_PROCVER: 1.0.1.12
PROCESS\_VER\_PRODUCT: SlimPDF Reader
WATSON\_BKT\_MODULE: SlimPDF Reader.exe
WATSON\_BKT\_MODSTAMP: 4ecd831a
WATSON\_BKT\_MODOFFSET: 3457c
WATSON\_BKT\_MODVER: 1.0.1.12
MODULE\_VER\_PRODUCT: SlimPDF Reader
BUILD\_VERSION\_STRING: 10240.17443.amd64fre.th1.170602-2340
MODLIST\_WITH\_TSCHKSUM\_HASH: 2b36701f96731def5752c269357e7e5a2679befb
MODLIST\_SHA1\_HASH: d231aecbd4b1f32bc2f593851f16d87c2da75c72
NTGLOBALFLAG: 400
PROCESS\_BAM\_CURRENT\_THROTTLED: 0
PROCESS\_BAM\_PREVIOUS\_THROTTLED: 0
APPLICATION\_VERIFIER\_FLAGS: 0
PRODUCT\_TYPE: 1
SUITE\_MASK: 272
DUMP\_TYPE: fe
ANALYSIS\_SESSION\_HOST: DESKTOP-1IBEKMI
ANALYSIS\_SESSION\_TIME: 05-28-2018 13:55:00.0250
ANALYSIS\_VERSION: 10.0.17134.1 amd64fre
THREAD\_ATTRIBUTES:
OS\_LOCALE: ENU
PROBLEM\_CLASSES:
ID: [0n309]
Type: [@ACCESS\_VIOLATION]
Class: Addendum
Scope: BUCKET\_ID
Name: Omit
Data: Omit
PID: [Unspecified]
TID: [0xcdc]
Frame: [0] : SlimPDF\_Reader
ID: [0n281]
Type: [INVALID\_POINTER\_READ]
Class: Primary
Scope: BUCKET\_ID
Name: Add
Data: Omit
PID: [Unspecified]
TID: [0xcdc]
Frame: [0] : SlimPDF\_Reader
ID: [0n306]
Type: [NULL\_CLASS\_PTR\_READ]
Class: Primary
Scope: DEFAULT\_BUCKET\_ID (Failure Bucket ID prefix)
BUCKET\_ID
Name: Add
Data: Omit
PID: [0xf84]
TID: [0xcdc]
Frame: [0] : SlimPDF\_Reader
ID: [0n156]
Type: [ZEROED\_STACK]
Class: Addendum
Scope: BUCKET\_ID
Name: Add
Data: Omit
PID: [0xf84]
TID: [0xcdc]
Frame: [0] : SlimPDF\_Reader
BUGCHECK\_STR: APPLICATION\_FAULT\_NULL\_CLASS\_PTR\_READ\_INVALID\_POINTER\_READ\_ZEROED\_STACK
PRIMARY\_PROBLEM\_CLASS: APPLICATION\_FAULT
LAST\_CONTROL\_TRANSFER: from 0044211b to 0043457c
STACK\_TEXT:
WARNING: Stack unwind information not available. Following frames may be wrong.
0019f860 0044211b 0231d3b0 0231deb8 00000000 SlimPDF\_Reader+0x3457c
0019f8e4 00443702 0231d270 022f7ef8 022f7f28 SlimPDF\_Reader+0x4211b
0019f914 0041be0d 00000001 00000000 0231d3b0 SlimPDF\_Reader+0x43702
0019f984 0041d20b 00000001 022df730 3f0119b6 SlimPDF\_Reader+0x1be0d
0019f9d4 0045fbf0 00000001 00000001 3f0119b6 SlimPDF\_Reader+0x1d20b
0019fa78 004cee26 0000007c 004cdea8 022b5340 SlimPDF\_Reader+0x5fbf0
0019fb60 004afa7e 52fbf7b5 0000000f 022e1c38 SlimPDF\_Reader+0xcee26
0019fbf4 004ab964 0000000f 00000000 0052df50 SlimPDF\_Reader+0xafa7e
0019fc14 004ae035 0000000f 00000000 00000000 SlimPDF\_Reader+0xab964
0019fc7c 004ae0c2 00000000 0003084a 0000000f SlimPDF\_Reader+0xae035
0019fc9c 74904923 0003084a 0000000f 00000000 SlimPDF\_Reader+0xae0c2
0019fcc8 748e4790 004ae08e 0003084a 0000000f USER32!\_InternalCallWinProc+0x2b
0019fd70 748e4370 004ae08e 00000000 0000000f USER32!UserCallWinProcCheckWow+0x1f0
0019fdd0 748eb179 00eed8f0 00000000 0000000f USER32!DispatchClientMessage+0xf0
0019fe10 777fad66 0019fe2c 00000020 0019fe90 USER32!\_\_fnDWORD+0x49
0019fe48 7490509c 748e419b 008aafd0 787b6351 ntdll\_77790000!KiUserCallbackDispatcher+0x36
0019fe4c 748e419b 008aafd0 787b6351 008aafa0 USER32!NtUserDispatchMessage+0xc
0019fea0 748e3e50 78629df1 00000000 004b1d6c USER32!DispatchMessageWorker+0x33b
0019feac 004b1d6c 008aafd0 008aafd0 00599b10 USER32!DispatchMessageW+0x10
00000000 00000000 00000000 00000000 00000000 SlimPDF\_Reader+0xb1d6c
STACK\_COMMAND: ~0s ; .cxr ; kb
THREAD\_SHA1\_HASH\_MOD\_FUNC: 23c6551acd70e2ee68c3fe17230a519c8d2edbd8
THREAD\_SHA1\_HASH\_MOD\_FUNC\_OFFSET: c0fb1c21cd18236bfb477e6f4ab150f37a3c72a8
THREAD\_SHA1\_HASH\_MOD: fca436a783f277e0e687fc89df0c8a6506b6fcd9
FAULT\_INSTR\_CODE: 75084639
SYMBOL\_STACK\_INDEX: 0
SYMBOL\_NAME: SlimPDF\_Reader+3457c
FOLLOWUP\_NAME: MachineOwner
MODULE\_NAME: SlimPDF\_Reader
IMAGE\_NAME: SlimPDF\_Reader.exe
DEBUG\_FLR\_IMAGE\_TIMESTAMP: 4ecd831a
FAILURE\_BUCKET\_ID: NULL\_CLASS\_PTR\_READ\_c0000005\_SlimPDF\_Reader.exe!Unknown
BUCKET\_ID: APPLICATION\_FAULT\_NULL\_CLASS\_PTR\_READ\_INVALID\_POINTER\_READ\_ZEROED\_STACK\_SlimPDF\_Reader+3457c
FAILURE\_EXCEPTION\_CODE: c0000005
FAILURE\_IMAGE\_NAME: SlimPDF\_Reader.exe
BUCKET\_ID\_IMAGE\_STR: SlimPDF\_Reader.exe
FAILURE\_MODULE\_NAME: SlimPDF\_Reader
BUCKET\_ID\_MODULE\_STR: SlimPDF\_Reader
FAILURE\_FUNCTION\_NAME: Unknown
BUCKET\_ID\_FUNCTION\_STR: Unknown
BUCKET\_ID\_OFFSET: 3457c
BUCKET\_ID\_MODTIMEDATESTAMP: 4ecd831a
BUCKET\_ID\_MODCHECKSUM: 0
BUCKET\_ID\_MODVER\_STR: 1.0.1.12
BUCKET\_ID\_PREFIX\_STR: APPLICATION\_FAULT\_NULL\_CLASS\_PTR\_READ\_INVALID\_POINTER\_READ\_ZEROED\_STACK\_
FAILURE\_PROBLEM\_CLASS: APPLICATION\_FAULT
FAILURE\_SYMBOL\_NAME: SlimPDF\_Reader.exe!Unknown
WATSON\_STAGEONE\_URL: <a href="http://watson.microsoft.com/StageOne/SlimPDF" target="\_blank">http://watson.microsoft.com/StageOne/SlimPDF</a> Reader.exe/1.0.1.12/4ecd831a/SlimPDF Reader.exe/1.0.1.12/4ecd831a/c0000005/0003457c.htm?Retriage=1
TARGET\_TIME: 2018-05-28T05:55:11.000Z
OSBUILD: 10240
OSSERVICEPACK: 17113
SERVICEPACK\_NUMBER: 0
OS\_REVISION: 0
OSPLATFORM\_TYPE: x64
OSNAME: Windows 10
OSEDITION: Windows 10 WinNt SingleUserTS
USER\_LCID: 0
OSBUILD\_TIMESTAMP: 2016-09-07 11:54:11
BUILDDATESTAMP\_STR: 170602-2340
BUILDLAB\_STR: th1
BUILDOSVER\_STR: 10.0.10240.17443.amd64fre.th1.170602-2340
ANALYSIS\_SESSION\_ELAPSED\_TIME: 81ce
ANALYSIS\_SOURCE: UM
FAILURE\_ID\_HASH\_STRING: um:null\_class\_ptr\_read\_c0000005\_slimpdf\_reader.exe!unknown
FAILURE\_ID\_HASH: {46980e42-0101-b5c8-decb-c547562bd18a}
Followup: MachineOwner
---------
</pre>https://security.my/post/174422883442https://security.my/post/174422883442Thu, 31 May 2018 11:05:51 +0800CVE-2018-1000097 - Sharutils Buffer Overflow<p>Vulnerability Title: Sharutils (unshar) Buffer Overflow</p><p>CVE: CVE-2018-1000097</p><p>Date (reported): Feb 21, 2018</p><p>Vendor: <a href="https://www.gnu.org/software/sharutils/" target="\_blank">https://www.gnu.org/software/sharutils/</a></p><p>Software Link: <a href="https://ftp.gnu.org/gnu/sharutils/sharutils-4.15.2.tar.gz" target="\_blank">https://ftp.gnu.org/gnu/sharutils/sharutils-4.15.2.tar.gz</a></p><p>Affected Version: 4.15.2 (stable released May 30, 2015)</p><p>Tested on: Ubuntu 16.04 LTS</p><p>Severity: Medium</p><p><b><br/></b></p><p><b>Summary</b></p><p>Sharutils is a package for creating and manipulating shell archives that can be readily emailed. A shell archive is a file that can be processed by a Bourne-type shell to unpack the original collection of files. Shar makes so-called shell archives out of many files, preparing them for transmission by electronic mail services (converting binary data to ASCII representations, breaking the text into multiple shar scripts, etc.). Unshar is the safe way to extract and reassemble the original files. It will automatically strip off the mail headers and other introductory text.</p><p><b>Vulnerability Description</b></p><p>Sharutils sharutils (unshar command) version 4.15.2 contains a Buffer Overflow vulnerability in Affected component on the file unshar.c at line 75, function looks\_like\_c\_code. Failure to perform checking of the buffer containing input line that can result in Could lead to code execution. This attack appear to be exploitable via Victim have to run unshar command on a specially crafted file.</p><p><b>Sharutils Fuzzing</b></p><p>We fuzzed the sharutils package (unshar) with AFL and came up with quite number of results. Our setup:</p><ol><li>Compile the program with the following command &ldquo;<b>CC=afl-gcc CXX=afl-g++ AFL\_USE\_ASAN=1 ./configure</b>&rdquo;</li><li>Once it passed, then run &ldquo;<b>AFL\_USE\_ASAN=1 make</b>&rdquo;</li><li>This will compile the binary with ASAN and AFL.</li></ol><p>Once configure properly, we run the AFL fuzzer with the following command &ldquo;<b>afl-fuzz -m none -i input/ -o output/ &ndash; ./unshar @@</b>&rdquo;. Within 4 hours, we managed to get 5 unique crashed. See the result of AFL:
</p><figure class="tmblr-full" data-orig-height="346" data-orig-width="540" data-orig-src="https://64.media.tumblr.com/88b8354516852d573e7d7623f7e64c3b/tumblr\_inline\_p65kmqGsjM1rn2vmr\_540.png"><img src="https://64.media.tumblr.com/879525296c82c0f6f94db9a34cbd414f/tumblr\_inline\_p7g3lpZVaN1rn2vmr\_540.png" alt="" data-orig-height="346" data-orig-width="540" data-orig-src="https://64.media.tumblr.com/88b8354516852d573e7d7623f7e64c3b/tumblr\_inline\_p65kmqGsjM1rn2vmr\_540.png"/></figure><p>We then verified if the crashed are indeed valid. </p><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">john@fuzzing<span style="color: #333333">:~/</span>sharutils<span style="color: #333333">-</span>4.15.2<span style="color: #333333">/</span>src$ .<span style="color: #333333">/</span>unshar output<span style="color: #333333">/</span>crashes<span style="color: #333333">/</span>id<span style="color: #333333">:</span>000000,sig<span style="color: #333333">:</span>06,src<span style="color: #333333">:</span>000052,op<span style="color: #333333">:</span>havoc,rep<span style="color: #333333">:</span>64
<span style="color: #333333">=================================================================</span>
<span style="color: #333333">==</span>20801<span style="color: #333333">==</span>ERROR<span style="color: #333333">:</span> AddressSanitizer<span style="color: #333333">:</span> heap<span style="color: #333333">-</span>buffer<span style="color: #333333">-</span>overflow on address 0xb6101100 at pc 0x0804c6e3 bp 0xbfcb9138 sp 0xbfcb9128
READ of size 1 at 0xb6101100 thread T0
#0 0x804c6e2 in looks\_like\_c\_code <span style="color: #333333">/</span>home<span style="color: #333333">/</span>john<span style="color: #333333">/</span>sharutils<span style="color: #333333">-</span>4.15.2<span style="color: #333333">/</span>src<span style="color: #333333">/</span>unshar.c<span style="color: #333333">:</span>81
#1 0x804c6e2 in find\_archive <span style="color: #333333">/</span>home<span style="color: #333333">/</span>john<span style="color: #333333">/</span>sharutils<span style="color: #333333">-</span>4.15.2<span style="color: #333333">/</span>src<span style="color: #333333">/</span>unshar.c<span style="color: #333333">:</span>253
#2 0x804c6e2 in unshar\_file <span style="color: #333333">/</span>home<span style="color: #333333">/</span>john<span style="color: #333333">/</span>sharutils<span style="color: #333333">-</span>4.15.2<span style="color: #333333">/</span>src<span style="color: #333333">/</span>unshar.c<span style="color: #333333">:</span>379
#3 0x804a2f4 in validate\_fname <span style="color: #333333">/</span>home<span style="color: #333333">/</span>john<span style="color: #333333">/</span>sharutils<span style="color: #333333">-</span>4.15.2<span style="color: #333333">/</span>src<span style="color: #333333">/</span>unshar<span style="color: #333333">-</span>opts.c<span style="color: #333333">:</span>604
#4 0x804a2f4 in main <span style="color: #333333">/</span>home<span style="color: #333333">/</span>john<span style="color: #333333">/</span>sharutils<span style="color: #333333">-</span>4.15.2<span style="color: #333333">/</span>src<span style="color: #333333">/</span>unshar<span style="color: #333333">-</span>opts.c<span style="color: #333333">:</span>639
#5 0xb787d636 in \_\_libc\_start\_main (<span style="color: #333333">/</span>lib<span style="color: #333333">/</span>i386<span style="color: #333333">-</span>linux<span style="color: #333333">-</span>gnu<span style="color: #333333">/</span>libc.so.6<span style="color: #333333">+</span>0x18636)
#6 0x804ab95 (<span style="color: #333333">/</span>home<span style="color: #333333">/</span>john<span style="color: #333333">/</span>sharutils<span style="color: #333333">-</span>4.15.2<span style="color: #333333">/</span>src<span style="color: #333333">/</span>unshar<span style="color: #333333">+</span>0x804ab95)
0xb6101100 is located 0 bytes to the right of 4096<span style="color: #333333">-</span>byte region [0xb6100100,0xb6101100)
allocated by thread T0 here<span style="color: #333333">:</span>
#0 0xb7ab1dee in malloc (<span style="color: #333333">/</span>usr<span style="color: #333333">/</span>lib<span style="color: #333333">/</span>i386<span style="color: #333333">-</span>linux<span style="color: #333333">-</span>gnu<span style="color: #333333">/</span>libasan.so.2<span style="color: #333333">+</span>0x96dee)
#1 0x804c9e4 in init\_unshar <span style="color: #333333">/</span>home<span style="color: #333333">/</span>john<span style="color: #333333">/</span>sharutils<span style="color: #333333">-</span>4.15.2<span style="color: #333333">/</span>src<span style="color: #333333">/</span>unshar.c<span style="color: #333333">:</span>450
#2 0xb787d636 in \_\_libc\_start\_main (<span style="color: #333333">/</span>lib<span style="color: #333333">/</span>i386<span style="color: #333333">-</span>linux<span style="color: #333333">-</span>gnu<span style="color: #333333">/</span>libc.so.6<span style="color: #333333">+</span>0x18636)
SUMMARY: AddressSanitizer<span style="color: #333333">:</span> heap<span style="color: #333333">-</span>buffer<span style="color: #333333">-</span>overflow <span style="color: #333333">/</span>home<span style="color: #333333">/</span>john<span style="color: #333333">/</span>sharutils<span style="color: #333333">-</span>4.15.2<span style="color: #333333">/</span>src<span style="color: #333333">/</span>unshar.c<span style="color: #333333">:</span>81 looks\_like\_c\_code
Shadow bytes around the buggy address<span style="color: #333333">:</span>
0x36c201d0<span style="color: #333333">:</span> 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x36c201e0<span style="color: #333333">:</span> 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x36c201f0<span style="color: #333333">:</span> 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x36c20200<span style="color: #333333">:</span> 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x36c20210<span style="color: #333333">:</span> 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
<span style="color: #333333">=&gt;</span>0x36c20220<span style="color: #333333">:</span>[fa]fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x36c20230<span style="color: #333333">:</span> fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x36c20240<span style="color: #333333">:</span> fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x36c20250<span style="color: #333333">:</span> fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x36c20260<span style="color: #333333">:</span> fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x36c20270<span style="color: #333333">:</span> fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes)<span style="color: #333333">:</span>
Addressable: 00
Partially addressable<span style="color: #333333">:</span> 01 02 03 04 05 06 07
Heap left redzone<span style="color: #333333">:</span> fa
Heap right redzone<span style="color: #333333">:</span> fb
Freed heap region<span style="color: #333333">:</span> fd
Stack left redzone<span style="color: #333333">:</span> f1
Stack mid redzone<span style="color: #333333">:</span> f2
Stack right redzone<span style="color: #333333">:</span> f3
Stack partial redzone<span style="color: #333333">:</span> f4
Stack after return<span style="color: #333333">:</span> f5
Stack use after scope<span style="color: #333333">:</span> f8
Global redzone<span style="color: #333333">:</span> f9
Global init order<span style="color: #333333">:</span> f6
Poisoned by user<span style="color: #333333">:</span> f7
Container overflow<span style="color: #333333">:</span> fc
Array cookie<span style="color: #333333">:</span> ac
Intra object redzone<span style="color: #333333">:</span> bb
ASan internal<span style="color: #333333">:</span> fe
<span style="color: #333333">==</span>20801<span style="color: #333333">==</span>ABORTING
</pre></div>
<p><b>Vulnerability</b></p><p>Our observation found that it was from unshar.c and the root cause started on &ldquo;find\_archive()&rdquo;. In the line 449, we can see rw\_buffer has allocated rw\_base\_size which is 8192 bytes. </p><p>Line 449 - 450:</p><pre>rw\_base\_size = GET\_PAGE\_SIZE;
rw\_buffer = malloc (rw\_base\_size);
</pre><p>At line 45, you can see the GET\_PAGE\_SIZE buffer size has been set to 8192 bytes. </p><p>Line 45:</p><pre># define GET\_PAGE\_SIZE 8192
</pre><p>We observed the size of BUFSIZ was allocated to 8192 bytes, however in this case the rw\_base\_size size is not similar with the memory page allocation. Thus, the issue allow to write out of the allocated memory for rw\_buffer. Failure to do so, can lead to application crash. </p><p>Line 243 - 249:</p><pre>if (!fgets (rw\_buffer, BUFSIZ, file)) // BUFSIZ is not equal to rw\_buffer (allocated buffer) that leads to overflow
{
if (!start)
error (0, 0, \_("Found no shell commands in %s"), name);
return false;
}
</pre><p><b>Patch</b></p><p>We reported the security issue via proper channel by sending an email to security@gnu.org and to Bugtraq mailing-list. Initially, we find out Red Hat / Fedora Security team taking care of the issue, <a href="https://bugzilla.redhat.com/show\_bug.cgi?id=1548018" target="\_blank">https://bugzilla.redhat.com/show\_bug.cgi?id=1548018</a> and ship the fixed to stable repository on 2018-03-06. It then follow by Ubuntu security and published advisory <a href="https://usn.ubuntu.com/3605-1/" target="\_blank">https://usn.ubuntu.com/3605-1/</a> on 2018-03-22. </p><p>Patch Diff:</p><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">diff <span style="color: #333333">-</span>Nru sharutils<span style="color: #333333">-</span>4.15.2<span style="color: #333333">/</span>debian<span style="color: #333333">/</span>changelog sharutils<span style="color: #333333">-</span>4.15.2<span style="color: #333333">/</span>debian<span style="color: #333333">/</span>changelog
<span style="color: #333333">---</span> sharutils<span style="color: #333333">-</span>4.15.2<span style="color: #333333">/</span>debian<span style="color: #333333">/</span>changelog 2015<span style="color: #333333">-</span>08<span style="color: #333333">-</span>03 15<span style="color: #333333">:</span>31<span style="color: #333333">:</span>35.000000000 <span style="color: #333333">+</span>0000
<span style="color: #333333">+++</span> sharutils<span style="color: #333333">-</span>4.15.2<span style="color: #333333">/</span>debian<span style="color: #333333">/</span>changelog 2018<span style="color: #333333">-</span>03<span style="color: #333333">-</span>21 23<span style="color: #333333">:</span>30<span style="color: #333333">:</span>23.000000000 <span style="color: #333333">+</span>0000
@@ <span style="color: #333333">-</span>1,3 <span style="color: #333333">+</span>1,12 @@
<span style="color: #333333">+</span>sharutils (1<span style="color: #333333">:</span>4.15.2<span style="color: #333333">-</span>1ubuntu0.1) xenial<span style="color: #333333">-</span>security; urgency<span style="color: #333333">=</span>medium
<span style="color: #333333">+</span>
<span style="color: #333333">+</span> <span style="color: #333333">\*</span> SECURITY UPDATE<span style="color: #333333">:</span> Buffer overflow
<span style="color: #333333">+</span> <span style="color: #333333">-</span> debian<span style="color: #333333">/</span>patches<span style="color: #333333">/</span>CVE<span style="color: #333333">-</span>2018<span style="color: #333333">-</span>1000097.patch<span style="color: #333333">:</span> fix in
<span style="color: #333333">+</span> src<span style="color: #333333">/</span>unshar.c.
<span style="color: #333333">+</span> <span style="color: #333333">-</span> CVE<span style="color: #333333">-</span>2018<span style="color: #333333">-</span>1000097
<span style="color: #333333">+</span>
<span style="color: #333333">+</span> <span style="color: #333333">--</span> Leonidas S. Barbosa <span style="color: #333333">&lt;</span>leo.barbosa@canonical.com<span style="color: #333333">&gt;</span> Wed, 21 Mar 2018 20<span style="color: #333333">:</span>30<span style="color: #333333">:</span>03 <span style="color: #333333">-</span>0300
<span style="color: #333333">+</span>
sharutils (1<span style="color: #333333">:</span>4.15.2<span style="color: #333333">-</span>1) unstable; urgency<span style="color: #333333">=</span>medium
<span style="color: #333333">\*</span> New upstream release.
diff <span style="color: #333333">-</span>Nru sharutils<span style="color: #333333">-</span>4.15.2<span style="color: #333333">/</span>debian<span style="color: #333333">/</span>control sharutils<span style="color: #333333">-</span>4.15.2<span style="color: #333333">/</span>debian<span style="color: #333333">/</span>control
<span style="color: #333333">---</span> sharutils<span style="color: #333333">-</span>4.15.2<span style="color: #333333">/</span>debian<span style="color: #333333">/</span>control 2015<span style="color: #333333">-</span>05<span style="color: #333333">-</span>31 23<span style="color: #333333">:</span>39<span style="color: #333333">:</span>08.000000000 <span style="color: #333333">+</span>0000
<span style="color: #333333">+++</span> sharutils<span style="color: #333333">-</span>4.15.2<span style="color: #333333">/</span>debian<span style="color: #333333">/</span>control 2018<span style="color: #333333">-</span>03<span style="color: #333333">-</span>21 23<span style="color: #333333">:</span>30<span style="color: #333333">:</span>26.000000000 <span style="color: #333333">+</span>0000
@@ <span style="color: #333333">-</span>1,7 <span style="color: #333333">+</span>1,8 @@
Source: sharutils
Section: utils
Priority: optional
<span style="color: #333333">-</span>Maintainer<span style="color: #333333">:</span> Santiago Vila <span style="color: #333333">&lt;</span>sanvila@debian.org<span style="color: #333333">&gt;</span>
<span style="color: #333333">+</span>Maintainer<span style="color: #333333">:</span> Ubuntu Developers <span style="color: #333333">&lt;</span>ubuntu<span style="color: #333333">-</span>devel<span style="color: #333333">-</span>discuss@lists.ubuntu.com<span style="color: #333333">&gt;</span>
<span style="color: #333333">+</span>XSBC<span style="color: #333333">-</span>Original<span style="color: #333333">-</span>Maintainer<span style="color: #333333">:</span> Santiago Vila <span style="color: #333333">&lt;</span>sanvila@debian.org<span style="color: #333333">&gt;</span>
Standards<span style="color: #333333">-</span>Version<span style="color: #333333">:</span> 3.9.6
Build<span style="color: #333333">-</span>Depends<span style="color: #333333">:</span> debhelper (<span style="color: #333333">&gt;=</span> 9.20120311), texinfo
Homepage: http<span style="color: #333333">:</span><span style="color: #888888">//www.gnu.org/software/sharutils/</span>
diff <span style="color: #333333">-</span>Nru sharutils<span style="color: #333333">-</span>4.15.2<span style="color: #333333">/</span>debian<span style="color: #333333">/</span>patches<span style="color: #333333">/</span>CVE<span style="color: #333333">-</span>2018<span style="color: #333333">-</span>1000097.patch sharutils<span style="color: #333333">-</span>4.15.2<span style="color: #333333">/</span>debian<span style="color: #333333">/</span>patches<span style="color: #333333">/</span>CVE<span style="color: #333333">-</span>2018<span style="color: #333333">-</span>1000097.patch
<span style="color: #333333">---</span> sharutils<span style="color: #333333">-</span>4.15.2<span style="color: #333333">/</span>debian<span style="color: #333333">/</span>patches<span style="color: #333333">/</span>CVE<span style="color: #333333">-</span>2018<span style="color: #333333">-</span>1000097.patch 1970<span style="color: #333333">-</span>01<span style="color: #333333">-</span>01 00<span style="color: #333333">:</span>00<span style="color: #333333">:</span>00.000000000 <span style="color: #333333">+</span>0000
<span style="color: #333333">+++</span> sharutils<span style="color: #333333">-</span>4.15.2<span style="color: #333333">/</span>debian<span style="color: #333333">/</span>patches<span style="color: #333333">/</span>CVE<span style="color: #333333">-</span>2018<span style="color: #333333">-</span>1000097.patch 2018<span style="color: #333333">-</span>03<span style="color: #333333">-</span>21 23<span style="color: #333333">:</span>29<span style="color: #333333">:</span>56.000000000 <span style="color: #333333">+</span>0000
@@ <span style="color: #333333">-</span>0,0 <span style="color: #333333">+</span>1,59 @@
<span style="color: #333333">+</span>Backported of<span style="color: #333333">:</span>
<span style="color: #333333">+</span>
<span style="color: #333333">+</span>The bellow patch should fix it. I don't know if sharutils author prefers
<span style="color: #333333">+</span>reading up to a memory page size or an I<span style="color: #333333">/</span>O buffer size.
<span style="color: #333333">+</span>
<span style="color: #333333">+</span>
<span style="color: #333333">+&gt;</span>From 1067cdba6d08f2a765cb0ea371189a5b703eb4db Mon Sep 17 00<span style="color: #333333">:</span>00<span style="color: #333333">:</span>00 2001
<span style="color: #333333">+</span>From<span style="color: #333333">:</span> <span style="color: #333333">=?</span>UTF<span style="color: #333333">-</span>8<span style="color: #333333">?</span>q<span style="color: #333333">?</span>Petr<span style="color: #333333">=</span>20P<span style="color: #333333">=</span>C3<span style="color: #333333">=</span>ADsa<span style="color: #333333">=</span>C5<span style="color: #333333">=</span>99<span style="color: #333333">?=</span> <span style="color: #333333">&lt;</span>address@hidden<span style="color: #333333">&gt;</span>
<span style="color: #333333">+</span>Date<span style="color: #333333">:</span> Thu, 22 Feb 2018 16<span style="color: #333333">:</span>39<span style="color: #333333">:</span>43 <span style="color: #333333">+</span>0100
<span style="color: #333333">+</span>Subject<span style="color: #333333">:</span> [PATCH] Fix a heap<span style="color: #333333">-</span>buffer<span style="color: #333333">-</span>overflow in find\_archive()
<span style="color: #333333">+</span>MIME<span style="color: #333333">-</span>Version<span style="color: #333333">:</span> 1.0
<span style="color: #333333">+</span>Content<span style="color: #333333">-</span>Type<span style="color: #333333">:</span> text<span style="color: #333333">/</span>plain; charset<span style="color: #333333">=</span>UTF<span style="color: #333333">-</span>8
<span style="color: #333333">+</span>Content<span style="color: #333333">-</span>Transfer<span style="color: #333333">-</span>Encoding<span style="color: #333333">:</span> 8bit
<span style="color: #333333">+</span>
<span style="color: #333333">+</span>rw\_buffer has allocated rw\_base\_size bytes. But subsequend fgets() in
<span style="color: #333333">+</span>find\_archive() reads up<span style="color: #333333">-</span>to BUFSIZ bytes.
<span style="color: #333333">+</span>
<span style="color: #333333">+</span>On my system, BUFSIZ is 8192. rw\_base\_size is usually equaled to
<span style="color: #333333">+</span>a memory page size, 4096 on my system. Thus find\_archive() can write
<span style="color: #333333">+</span>beyonded allocated memmory for rw\_buffer array<span style="color: #333333">:</span>
<span style="color: #333333">+</span>
<span style="color: #333333">+</span>$ valgrind <span style="color: #333333">--</span> .<span style="color: #333333">/</span>unshar
<span style="color: #333333">+/</span>tmp<span style="color: #333333">/</span>id\<span style="color: #333333">:</span>000000\,sig\<span style="color: #333333">:</span>06\,src\<span style="color: #333333">:</span>000005<span style="color: #333333">+</span>000030\,op\<span style="color: #333333">:</span>splice\,rep\<span style="color: #333333">:</span>4
<span style="color: #333333">+==</span>30582<span style="color: #333333">==</span> Memcheck, a memory error detector
<span style="color: #333333">+==</span>30582<span style="color: #333333">==</span> Copyright (C) 2002<span style="color: #333333">-</span>2017, and GNU GPL'd, by Julian Seward et al.
<span style="color: #333333">+==</span>30582<span style="color: #333333">==</span> Using Valgrind<span style="color: #333333">-</span>3.13.0 and LibVEX; rerun with <span style="color: #333333">-</span>h for copyright info
<span style="color: #333333">+==</span>30582<span style="color: #333333">==</span> Command<span style="color: #333333">:</span> .<span style="color: #333333">/</span>unshar
<span style="color: #333333">+/</span>tmp<span style="color: #333333">/</span>id<span style="color: #333333">:</span>000000,sig<span style="color: #333333">:</span>06,src<span style="color: #333333">:</span>000005<span style="color: #333333">+</span>000030,op<span style="color: #333333">:</span>splice,rep<span style="color: #333333">:</span>4
<span style="color: #333333">+==</span>30582<span style="color: #333333">==</span>
<span style="color: #333333">+==</span>30582<span style="color: #333333">==</span> Invalid write of size 1
<span style="color: #333333">+==</span>30582<span style="color: #333333">==</span> at 0x4EAB480<span style="color: #333333">:</span> \_IO\_getline\_info (in <span style="color: #333333">/</span>usr<span style="color: #333333">/</span>lib64<span style="color: #333333">/</span>libc<span style="color: #333333">-</span>2.27.so)
<span style="color: #333333">+==</span>30582<span style="color: #333333">==</span> by 0x4EB47C2<span style="color: #333333">:</span> fgets\_unlocked (in <span style="color: #333333">/</span>usr<span style="color: #333333">/</span>lib64<span style="color: #333333">/</span>libc<span style="color: #333333">-</span>2.27.so)
<span style="color: #333333">+==</span>30582<span style="color: #333333">==</span> by 0x10BF60<span style="color: #333333">:</span> fgets\_unlocked (stdio2.h<span style="color: #333333">:</span>320)
<span style="color: #333333">+==</span>30582<span style="color: #333333">==</span> by 0x10BF60<span style="color: #333333">:</span> find\_archive (unshar.c<span style="color: #333333">:</span>243)
<span style="color: #333333">+==</span>30582<span style="color: #333333">==</span> by 0x10BF60<span style="color: #333333">:</span> unshar\_file (unshar.c<span style="color: #333333">:</span>379)
<span style="color: #333333">+==</span>30582<span style="color: #333333">==</span> by 0x10BCCC<span style="color: #333333">:</span> validate\_fname (unshar<span style="color: #333333">-</span>opts.c<span style="color: #333333">:</span>604)
<span style="color: #333333">+==</span>30582<span style="color: #333333">==</span> by 0x10BCCC<span style="color: #333333">:</span> main (unshar<span style="color: #333333">-</span>opts.c<span style="color: #333333">:</span>639)
<span style="color: #333333">+==</span>30582<span style="color: #333333">==</span> Address 0x523a790 is 0 bytes after a block of size 4,096 alloc'd
<span style="color: #333333">+==</span>30582<span style="color: #333333">==</span> at 0x4C2DBBB<span style="color: #333333">:</span> malloc (vg\_replace\_malloc.c<span style="color: #333333">:</span>299)
<span style="color: #333333">+==</span>30582<span style="color: #333333">==</span> by 0x10C670<span style="color: #333333">:</span> init\_unshar (unshar.c<span style="color: #333333">:</span>450)
<span style="color: #333333">+==</span>30582<span style="color: #333333">==</span> by 0x10BC55<span style="color: #333333">:</span> main (unshar<span style="color: #333333">-</span>opts.c<span style="color: #333333">:</span>630)
<span style="color: #333333">+</span>
<span style="color: #333333">+</span>This was reported in
<span style="color: #333333">+&lt;</span>http<span style="color: #333333">:</span><span style="color: #888888">//lists.gnu.org/archive/html/bug-gnu-utils/2018-02/msg00004.html&gt;.</span>
<span style="color: #333333">+</span>
<span style="color: #333333">+</span>Signed<span style="color: #333333">-</span>off<span style="color: #333333">-</span>by<span style="color: #333333">:</span> Petr PÃ­saÅ™ <span style="color: #333333">&lt;</span>address@hidden<span style="color: #333333">&gt;</span>
<span style="color: #333333">+</span>diff <span style="color: #333333">--</span>git a<span style="color: #333333">/</span>src<span style="color: #333333">/</span>unshar.c b<span style="color: #333333">/</span>src<span style="color: #333333">/</span>unshar.c
<span style="color: #333333">+</span>index 80bc3a9..0fc3773 100644
<span style="color: #333333">+---</span> a<span style="color: #333333">/</span>src<span style="color: #333333">/</span>unshar.c
<span style="color: #333333">++++</span> b<span style="color: #333333">/</span>src<span style="color: #333333">/</span>unshar.c
<span style="color: #333333">+</span>@@ <span style="color: #333333">-</span>240,7 <span style="color: #333333">+</span>240,7 @@ find\_archive (char const <span style="color: #333333">\*</span> name, FILE <span style="color: #333333">\*</span> file, off\_t start)
<span style="color: #333333">+</span> off\_t position <span style="color: #333333">=</span> ftello (file);
<span style="color: #333333">+</span>
<span style="color: #333333">+</span> <span style="color: #888888">/\* Read next line, fail if no more and no previous process. \*/</span>
<span style="color: #333333">+-</span> if (<span style="color: #333333">!</span>fgets (rw\_buffer, BUFSIZ, file))
<span style="color: #333333">++</span> if (<span style="color: #333333">!</span>fgets (rw\_buffer, rw\_base\_size, file))
<span style="color: #333333">+</span> {
<span style="color: #333333">+</span> if (<span style="color: #333333">!</span>start)
<span style="color: #333333">+</span> error (0, 0, \_("Found no shell commands in %s"), name);
diff <span style="color: #333333">-</span>Nru sharutils<span style="color: #333333">-</span>4.15.2<span style="color: #333333">/</span>debian<span style="color: #333333">/</span>patches<span style="color: #333333">/</span>series sharutils<span style="color: #333333">-</span>4.15.2<span style="color: #333333">/</span>debian<span style="color: #333333">/</span>patches<span style="color: #333333">/</span>series
<span style="color: #333333">---</span> sharutils<span style="color: #333333">-</span>4.15.2<span style="color: #333333">/</span>debian<span style="color: #333333">/</span>patches<span style="color: #333333">/</span>series 2015<span style="color: #333333">-</span>05<span style="color: #333333">-</span>11 16<span style="color: #333333">:</span>41<span style="color: #333333">:</span>13.000000000 <span style="color: #333333">+</span>0000
<span style="color: #333333">+++</span> sharutils<span style="color: #333333">-</span>4.15.2<span style="color: #333333">/</span>debian<span style="color: #333333">/</span>patches<span style="color: #333333">/</span>series 2018<span style="color: #333333">-</span>03<span style="color: #333333">-</span>21 23<span style="color: #333333">:</span>29<span style="color: #333333">:</span>56.000000000 <span style="color: #333333">+</span>0000
@@ <span style="color: #333333">-</span>1 <span style="color: #333333">+</span>1,2 @@
99<span style="color: #333333">-</span>config<span style="color: #333333">-</span>guess<span style="color: #333333">-</span>config<span style="color: #333333">-</span>sub
<span style="color: #333333">+</span>CVE<span style="color: #333333">-</span>2018<span style="color: #333333">-</span>1000097.patch
</pre></div>https://security.my/post/172240369887https://security.my/post/172240369887Mon, 26 Mar 2018 00:00:33 +0800CVE-2017-1000414 - Division by Zero Vulnerability Analysis<p><b>Vulnerability Title</b>: JPEGSnoop &ldquo;JfifDecode.cpp&rdquo; Integer Division by Zero<br/><b>Date</b>: 6/5/2017<br/><b>Vendor</b>: <a href="http://www.impulseadventure.com/photo/" target="\_blank">http://www.impulseadventure.com/photo/</a><br/><b>Software Link</b>: <a href="http://www.impulseadventure.com/dl.php?file=JPEGsnoop\_v1\_7\_5.zip" target="\_blank">http://www.impulseadventure.com/dl.php?file=JPEGsnoop\_v1\_7\_5.zip</a><br/><b>Affected Version</b>: 1.7.5<br/><b>Tested on</b>: Windows 7 (32-bit), Windows 10</p><p><b>Summary</b><br/>JPEGsnoop is a free Windows application that examines and decodes the inner details of JPEG, MotionJPEG AVI and Photoshop files. It can also be used to analyze the source of an image to test its authenticity.</p><p><b>Vulnerability Description</b><br/>JPEGsnoop suffers from a division by zero attack when handling JFIF decoding, resulting in denial of service vulnerability and possibly loss of data. The vulnerable part found to perform a calculations that require all tables to be present. Details of the divide by zero issue:</p><p>⦁ Exception happened on the EIP:0x011d2a1d, this can be disassemble (instruction pointer leads to where it crash).<br/>⦁ Disassemble of EIP<br/> 0:000&gt; u 011d2a1d <br/> JPEGsnoop+0x32a1d:<br/> 011d2a1d f7b48f78110000  div     eax,dword ptr [edi+ecx\*4+1178h]<br/> 011d2a24 33d2            xor     edx,edx<br/> 011d2a26 894508          mov     dword ptr [ebp+8],eax<br/> 011d2a29 8b877c190000    mov     eax,dword ptr [edi+197Ch]<br/> 011d2a2f f7b48f78150000  div     eax,dword ptr [edi+ecx\*4+1578h]<br/> 011d2a36 83bf8c19000002  cmp     dword ptr [edi+198Ch],2<br/> 011d2a3d 7414            je      JPEGsnoop+0x32a53 (011d2a53)<br/> 011d2a3f 50              push    eax<br/><br/>⦁ We need to take note on the registers where exception happened. This will help us to determine the exception are indeed correct.<br/> 0:000&gt; r<br/> eax=00000000 ebx=00eb2378 ecx=00000000 edx=00000000 esi=05f5ab28 edi=00eb09e8<br/> eip=011d2a1d esp=007ce5c8 ebp=007ce5f4 iopl=0         nv up ei pl zr na pe nc<br/> cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00010246<br/> JPEGsnoop+0x32a1d:<br/> 011d2a1d f7b48f78110000  div     eax,dword ptr [edi+ecx\*4+1178h] ds:002b:00eb1b60=00000000</p><p>⦁ We can see the instruction &ldquo;div eax, dword ptr [edi+ecx\*4+1178h], so we break down as:<br/> edi = 00eb09e8<br/> ecx = 00000000 \* 4<br/> 0x1178</p><p> The math:<br/> dword ptr &mdash; 00eb09e8 + 00000000 \* 4 + 1178 = 0xeb1b60 &lt;&mdash; data segment <br/> eax &mdash; 0x00000000</p><p> Divide eax with the data segment value:<br/> 0xeb1b60 / 0x00000000 = value cannot be divide with zero</p><p> Thus, resulting to denial of service to the vulnerable application. </p><p>Below are the results of crash dump and disassembly of the root cause:</p><p>&mdash;Crash Dump&mdash;<br/>(5d4.39c): Integer divide-by-zero - code c0000094 (first chance)<br/>First chance exceptions are reported before any exception handling.<br/>This exception may be expected and handled.<br/>\*\*\* WARNING: Unable to verify checksum for JPEGsnoop.exe<br/>\*\*\* ERROR: Module load completed but symbols could not be loaded for JPEGsnoop.exe<br/>eax=00000000 ebx=00eb2378 ecx=00000000 edx=00000000 esi=05f5ab28 edi=00eb09e8<br/>eip=011d2a1d esp=007ce5c8 ebp=007ce5f4 iopl=0         nv up ei pl zr na pe nc<br/>cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00010246<br/>JPEGsnoop+0x32a1d:<br/>011d2a1d f7b48f78110000  div     eax,dword ptr [edi+ecx\*4+1178h] ds:002b:00eb1b60=00000000</p><p>&mdash;Disassembly&mdash;<br/>.text:004329C2 loc\_4329C2:                             ; CODE XREF: sub\_432800+1B1j<br/>.text:004329C2                                         ; sub\_432800+1BBj<br/>.text:004329C2                 push    3               ; int<br/>.text:004329C4                 lea     ebx, [edi+1990h]<br/>.text:004329CA                 push    offset a?x?     ; &rdquo;?x?&ldquo;<br/>.text:004329CF                 mov     ecx, ebx<br/>.text:004329D1                 call    sub\_401AC0<br/>.text:004329D6                 push    4               ; int<br/>.text:004329D8                 lea     ecx, [edi+1DE8h]<br/>.text:004329DE                 push    offset aNone    ; &quot;NONE&rdquo;<br/>.text:004329E3                 call    sub\_401AC0<br/>.text:004329E8                 push    4               ; int<br/>.text:004329EA                 lea     ecx, [edi+1DECh]<br/>.text:004329F0                 push    offset aNone    ; &ldquo;NONE&rdquo;<br/>.text:004329F5                 call    sub\_401AC0<br/>.text:004329FA                 cmp     byte ptr [edi+20h], 0<br/>.text:004329FE                 jz      loc\_432B3F<br/>.text:00432A04                 mov     eax, [edi+974h]<br/>.text:00432A0A                 cmp     eax, 3<br/>.text:00432A0D                 jnz     short loc\_432A67<br/>.text:00432A0F                 mov     ecx, [edi+980h]<br/>.text:00432A15                 mov     eax, [edi+1978h]<br/>.text:00432A1B                 xor     edx, edx<br/>.text:00432A1D                 div     dword ptr [edi+ecx\*4+1178h] &lt;&mdash; vulnerability here<br/>.text:00432A24                 xor     edx, edx<br/>.text:00432A26                 mov     dword ptr [ebp+ArgList], eax<br/>.text:00432A29                 mov     eax, [edi+197Ch]<br/>.text:00432A2F                 div     dword ptr [edi+ecx\*4+1578h]<br/>.text:00432A36                 cmp     dword ptr [edi+198Ch], 2<br/>.text:00432A3D                 jz      short loc\_432A53<br/>.text:00432A3F                 push    eax<br/>.text:00432A40                 push    dword ptr [ebp+ArgList] ; ArgList<br/>.text:00432A43                 push    offset aUxU     ; &ldquo;%ux%u&rdquo;<br/>.text:00432A48                 push    ebx             ; int<br/>.text:00432A49                 call    sub\_401650<br/>.text:00432A4E                 add     esp, 10h<br/>.text:00432A51                 jmp     short loc\_432A78<br/>.text:00432A53 ; &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;<br/>.text:00432A53<br/>.text:00432A53 loc\_432A53:                             ; CODE XREF: sub\_432800+23Dj<br/>.text:00432A53                 push    dword ptr [ebp+ArgList]<br/>.text:00432A56                 push    eax             ; ArgList<br/>.text:00432A57                 push    offset aUxU     ; &ldquo;%ux%u&rdquo;<br/>.text:00432A5C                 push    ebx             ; int<br/>.text:00432A5D                 call    sub\_401650<br/>.text:00432A62                 add     esp, 10h<br/>.text:00432A65                 jmp     short loc\_432A78</p><p><b>Patch</b><br/>Released in version 1.8.0:<br/>- <a href="http://www.impulseadventure.com/photo/jpeg-snoop.html" target="\_blank">http://www.impulseadventure.com/photo/jpeg-snoop.html</a><br/>- <a href="http://www.impulseadventure.com/photo/jpeg-snoop-history.html%C2%A0" target="\_blank">http://www.impulseadventure.com/photo/jpeg-snoop-history.html </a>(Fixed vulnerability (div0) with invalid DQT)</p>https://security.my/post/172233583457https://security.my/post/172233583457Sun, 25 Mar 2018 19:05:35 +0800Wargames.my 2017 - Notepad<p>This is a tough challenge. The bug is SQL injection in subdomain param. And it is blind based. So we need sqlmap for that. :)</p><p>Payload: <b>select1.notepad.wargames.my:8080&rsquo; </b><br/></p><figure class="tmblr-full" data-orig-height="646" data-orig-width="864"><img src="https://64.media.tumblr.com/67eaa64af26e6fad5dee6900dc0ca951/tumblr\_inline\_ozrwwjIssZ1vrbjc2\_540.png" data-orig-height="646" data-orig-width="864"/></figure><p>Then, dump the admin email as we can reset password later. Run sqlmap again and grab the admin token. Now, we can reset admin password and login to admin portal. <br/></p><p>There are admin page to edit template. Here come the RCE to grab the flag. We need to use phpinfo() to get the path first. Then after checking for disabled\_function, lucky <b>file\_get\_contents</b> is allowed. Use that function to get the flag. <br/></p><figure class="tmblr-full" data-orig-height="586" data-orig-width="1230"><img src="https://64.media.tumblr.com/115ed2ede1e0947c5ca6cda90880fd08/tumblr\_inline\_ozrwsctIbF1vrbjc2\_540.png" data-orig-height="586" data-orig-width="1230"/></figure>https://security.my/post/167735532322https://security.my/post/167735532322Tue, 21 Nov 2017 23:13:08 +0800Wargames.my 2017 - Ezfilesharing<p>This web challenge hints are:</p><ol>
<li>do you able to retrieve the source code? - <i>need to download the source</i> code!!!<br/></li>
<li>4 character, browse it and im yours - <i>We dont understand this hint. lol.</i></li>
<li>silly developer leaving his code changes tracker folder.. - <i>tracker??.. hurmm..</i></li>
</ol><p>Fuzzing for directory/files and we got .git folder. Nice, public git folder meaning we can get the source code.</p><figure data-orig-width="526" data-orig-height="570" class="tmblr-full"><img src="https://64.media.tumblr.com/38272c4af1a81b2d4ef0b47c31a40e0c/tumblr\_inline\_ozntmuW3lA1vrbjc2\_540.png" data-orig-width="526" data-orig-height="570"/></figure><p>We use this tools to dump and extract the source code: <a href="https://github.com/internetwache/GitTools" target="\_blank">https://github.com/internetwache/GitTools</a></p><figure class="tmblr-full" data-orig-height="464" data-orig-width="851"><img src="https://64.media.tumblr.com/684c0d1337a766bd8be621e066b95d0a/tumblr\_inline\_ozntswxWnj1vrbjc2\_540.png" data-orig-height="464" data-orig-width="851"/></figure><p>Which folder do we need? Lets check the main header.</p><figure class="tmblr-full" data-orig-height="95" data-orig-width="969"><img src="https://64.media.tumblr.com/228707dd52ae696586c0255dc5aaf7bc/tumblr\_inline\_ozntuhSbSH1vrbjc2\_540.png" data-orig-height="95" data-orig-width="969"/></figure><p>So we use the 2-6f3&hellip;&hellip;&hellip;&hellip;&hellip;&hellip;&hellip;771d. And the flag is in index.php file.</p><figure class="tmblr-full" data-orig-height="258" data-orig-width="603"><img src="https://64.media.tumblr.com/3a3f70d600e6574977d785c990905981/tumblr\_inline\_ozntxbm8mW1vrbjc2\_540.png" data-orig-height="258" data-orig-width="603"/></figure>https://security.my/post/167654986547https://security.my/post/167654986547Sun, 19 Nov 2017 18:18:18 +0800Wargames.my 2017 - MailMarketer<p>We are landed to default page of Ubuntu. The hints are:</p><ol>
<li>what are other default page for apache2 with mod\_php installed - ok, must be index.php<br/></li><li>Just do it! - still dont understant until now. lol.</li></ol><p>As the challenge is MailMarketer, the bug might be in “mail“ function related. There are a page to sent email and the function works. We try to sent email and look at the headers (took some time to notice this). They use phpmailer version 5.2.21 which has public exploit. You can refer to this: <a href="https://www.exploit-db.com/exploits/43056/" target="\_blank">https://www.exploit-db.com/exploits/43056/.</a></p><p style=""><br/></p><p>The exploit payload is using <b>&lt;img src=&ldquo;&lt;file to read&gt;&rdquo;&gt;</b>. So, what do we need to read? After some fuzzing, there are flag.php file. We include the file:</p><p><b>&lt;img src=&ldquo;&lt;/var/www/html/flag.php&gt;&rdquo;&gt;</b></p><p>&hellip;sent email and we got the flag.php as attachment which contain flag.</p><p>Flag: WGMY:{3Ma1L\_H3ad3r\_1z\_Ju1cy}that is for mail</p>https://security.my/post/167654707367https://security.my/post/167654707367Sun, 19 Nov 2017 18:02:39 +0800Wargames.my 2017 - Unreachable<p>This is the pcap challenge. The hints are:</p><ol>
<li>he is tracing backwardly. - read it from bottom to up?<br/></li>
<li>nothing to do with Traceroute - ok then..<br/></li>
<li>&ldquo;hello IT, I can&rsquo;t access to this server&rdquo; .. what IT support always start with? - ping?<br/></li>
<li>RFC 792 - icmp?<br/></li>
</ol><p>Lets fireup wireshark and apply this filter: <b>(icmp) &amp;&amp; (ip.src == 192.168.1.8). <br/></b></p><figure class="tmblr-full" data-orig-height="851" data-orig-width="1387"><img src="https://64.media.tumblr.com/eca210412e16f24fcbbceed5f54bcc2c/tumblr\_inline\_ozns5cEO7m1vrbjc2\_540.png" data-orig-height="851" data-orig-width="1387"/></figure><p>Now, export the displayed result by Export Packet Dissections -&gt; As Plain Text.</p><figure class="tmblr-full" data-orig-height="745" data-orig-width="901"><img src="https://64.media.tumblr.com/8a6b54042f3aac4ccc94f6cb44e5b157/tumblr\_inline\_ozns4ecas51vrbjc2\_540.png" data-orig-height="745" data-orig-width="901"/></figure><p>As hint #1 said “tracing backwardly“, we look the data from bottom of the file. And notice there are differences between each packet frames. That is the flag for this challenge.</p><figure class="tmblr-full" data-orig-height="851" data-orig-width="1392"><img src="https://64.media.tumblr.com/dbeddf38233eea21dc396bc7c3a4b563/tumblr\_inline\_oznsfxvvJN1vrbjc2\_540.png" data-orig-height="851" data-orig-width="1392"/></figure><p>At first we thought the flag is: <b>flag\_is\_p!ngp0ng~</b> but it is not but <b>p!ngp0ng~</b> <br/></p>https://security.my/post/167654446252https://security.my/post/167654446252Sun, 19 Nov 2017 17:48:21 +0800Wargames.my 2017 - BeatMe<p>We didn&rsquo;t manage to solve this in time but wanted to share my notes on it.</p><p>After beautifying the source, we used an AST solver (<a href="http://m1el.github.io/esdeobfuscate/" target="\_blank">http://m1el.github.io/esdeobfuscate/</a>) to clean the code up (thanks to <a href="https://twitter.com/najashark" target="\_blank">@najashark</a> for pointing this out).</p><p>Next we tried to narrow down the keyspace using the code below.</p><pre><code>
&lt;html&gt;
&lt;body&gt;
&lt;script&gt;
function nyahsulit(flag, key, input) {
keluar = '';
for(i = 0; i &lt; flag.length; i++) {
var fi = flag[i].charCodeAt(0);
kt = ''
var alch = '0123456789abcdef';
for(j=0;j&lt;16;j++){
if(i-1 &lt; 0)
var v\_xor = fi^(alch[j].charCodeAt(0));
else
var v\_xor = fi^(alch[j].charCodeAt(0)^(i-1));
if(v\_xor &gt;= 0x2e &amp;&amp; v\_xor &lt;= 0x7E){
kt += "(" + alch[j] + ")" + String.fromCharCode(v\_xor) + ", ";
//kt += String.fromCharCode(v\_xor) + ", ";
}
}
//var kk = key.charCodeAt(0);
//temp = String.fromCharCode(fi^kk);
//key = String.fromCharCode(i^input[i].charCodeAt(0));
keluar += "[" + i + "] = " + kt + "\n";
}
return(keluar);
}
var flag = window.decodeURIComponent('f%7F\*%3A%5CM%0DN%0B%02L%1A%02X%084O%15Z)JC%04~WHl%18eH%1DP');
var key = String.fromCharCode(0x11);
var ret = nyahsulit(flag, key, 'd23456');
console.log(ret);
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>And we also tried bruteforcing using the code below (this would have taken too long)</p><pre><code>
import md5
import itertools
import string
def bruteforce(charset, maxlength):
return (''.join(candidate)
for candidate in itertools.chain.from\_iterable(itertools.product(charset, repeat=i)
for i in range(maxlength, maxlength + 1)))
for comb in bruteforce(string.ascii\_lowercase, 12):
#s = "0" \* (3-len(s)) + s
m = md5.new()
m.update("".join(comb))
h = m.hexdigest()
if h[0] == '8' and h[1] == 'f' and h[2] == 'a' and h[3] == 'e' and h[4] == '2' and h[-2] == '3':
print("".join(comb), h)
</code></pre><p>Another alternative we tried was trying to filter out the first few chars of the hash at <a href="https://md5db.net/explore/18FA" target="\_blank">https://md5db.net/explore/18FA</a></p><figure class="tmblr-full" data-orig-height="577" data-orig-width="797"><img src="https://64.media.tumblr.com/4af889b088ed0e7e83736b87d77c8f66/tumblr\_inline\_ozn80snaCn1rya2cv\_540.png" data-orig-height="577" data-orig-width="797"/></figure><p>Decryption key: bountyhunter</p><p>Flag: WGMY:{ny4hsul17\_x0r\_not\_s3LaMa7}</p>https://security.my/post/167644013197https://security.my/post/167644013197Sun, 19 Nov 2017 10:24:36 +0800Wargames.my 2017 - YSoSerial<p>This challenge a pcap with USB traffic is provided, after analysis, we found that it involved keyboard input and transfer of files to a flashdrive.</p><hr><p>We first extracted contents of the flashdrive to find a python script below.</p><figure data-orig-width="602" data-orig-height="483" class="tmblr-full"><img src="https://64.media.tumblr.com/70025183d9e8fed890a3984598387867/tumblr\_inline\_ozn6z0bz8x1rya2cv\_540.png" data-orig-width="602" data-orig-height="483"/></figure><p>Next we isolated and extracted the keyboard inputs and used the python processing script below (taken and adapted from <a href="https://habrahabr.ru/post/335012/" target="\_blank">https://habrahabr.ru/post/335012/</a>) to extract the keystrokes.</p><pre><code>
#!/usr/bin/python
import binascii
import dpkt
import struct
import sys
# Start the pcap file parsing
f = open(sys.argv[1], 'rb')
pcap = dpkt.pcap.Reader(f)
# Create a partial mapping from keycodes to ASCII chars
keys = {}
keys.update({
i + 0x4: chr(i + ord('a'))
for i in range(26)
})
keys.update({
i + 0x1e: chr(i + ord('1'))
for i in range(9)
})
keys[0x27] = '0'
keys.update({
0x28: '\n',
0x2a: '[BACKSPACE]',
0x2b: '\t',
0x2c: ' ',
0x2d: '-',
0x2e: '=',
0x2f: '[',
0x30: ']',
0x31: '\\',
0x33: ';',
0x34: '\'',
0x35: '`',
0x36: ',',
0x37: '.',
0x38: '/',
0x4f: '[RIGHT\_ARROW]',
0x50: '[LEFT\_ARROW]',
0x52: '[KEY\_UP]',
0x58: '[ENTER]'
})
keys\_shift = {}
keys\_shift.update({
i + 0x4: chr(i + ord('A'))
for i in range(26)
})
keys\_shift.update({
0x1e: '!',
0x1f: '@',
0x20: '#',
0x21: '$',
0x22: '%',
0x23: '^',
0x24: '&amp;',
0x25: '\*',
0x26: '(',
0x27: ')',
0x2e: '+',
0x2f: '{',
0x30: '}',
0x31: '|',
0x33: ':',
0x34: '"',
0x35: '~',
0x36: '&lt;',
0x37: '&gt;',
0x38: '?',
})
txt = ''
# Then iterate over each USB frame
i = 0
for ts, buf in pcap:
i += 1
print(repr(txt))
buf = buf[-8:]
if buf == "\x00" \* 8: continue
#print(repr(buf))
key\_code = ord(buf[2])
shift\_state = ord(buf[0])
if not key\_code:
continue
if shift\_state:
# print('[%d] key\_code: %s char: %s' % (i, hex(key\_code), keys\_shift[key\_code]))
txt += keys\_shift[key\_code]
else:
#print('[%d] key\_code: %s char: %s' % (i, hex(key\_code), keys[key\_code]))
try:
txt += keys[key\_code]
except:
print(hex(key\_code))
txt += "\*"
# sys.stdout.write(keys[key\_code])
print(txt)
</code></pre><p>This gave us the result below.</p><figure class="tmblr-full" data-orig-height="223" data-orig-width="519"><img src="https://64.media.tumblr.com/b6ccecaedbaf940b7b5a7ec57d337d94/tumblr\_inline\_ozn79zboVO1rya2cv\_540.png" data-orig-height="223" data-orig-width="519"/></figure><p>Reordering the keystrokes gave us the below and running it provided us with the flag.</p><figure class="tmblr-full" data-orig-height="73" data-orig-width="522"><img src="https://64.media.tumblr.com/faa6b157ef5f20864fe701e49111a59b/tumblr\_inline\_ozn7eoi7rw1rya2cv\_540.png" data-orig-height="73" data-orig-width="522"/></figure><p>Flag: UniVers4l\_53r1al\_bu5</p>https://security.my/post/167643675557https://security.my/post/167643675557Sun, 19 Nov 2017 10:11:40 +0800Wargames.my 2017 - Rans0me-N00b-W4r3<p>Reverse engineer protection to recover data. Below is the algorithm used,</p><figure data-orig-width="675" data-orig-height="665" class="tmblr-full"><img src="https://64.media.tumblr.com/0a352722cf08f5eed4067e464ac273f4/tumblr\_inline\_ozn6g0JhzB1rya2cv\_540.png" data-orig-width="675" data-orig-height="665"/></figure><p>After doing abit of digging, we find a very very very similar implementation from Microsoft @ <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa382044(v=vs.85).aspx" target="\_blank">https://msdn.microsoft.com/en-us/library/windows/desktop/aa382044(v=vs.85).aspx</a></p><p>The password is derived from the file name with the first char replaced, we implemented this and decrypted the flag.</p><p>Below is the code which generated the first char of the password.</p><figure data-orig-height="154" data-orig-width="256"><img src="https://64.media.tumblr.com/da895a958256d9c1e96be29ff4e45ab8/tumblr\_inline\_ozn6qs2x831rya2cv\_540.png" data-orig-height="154" data-orig-width="256"/></figure><p>Below is the decrypted flag file</p><figure class="tmblr-full" data-orig-height="124" data-orig-width="389"><img src="https://64.media.tumblr.com/c7c79ba0daac0df43b3fc3d7bfad63cb/tumblr\_inline\_ozn6n81fzh1rya2cv\_540.png" data-orig-height="124" data-orig-width="389"/></figure><p>Flag: L4m3R4n$0mwAr31zL4m3</p>https://security.my/post/167643301287https://security.my/post/167643301287Sun, 19 Nov 2017 09:57:31 +0800Wargames.my 2017 - Selimut Tetangga Challenge<p>This challenge required you to connect via SCTP protocol, do that and it will give you the flag, we used the template code from <a href="http://matrixsust.blogspot.my/2011/11/basic-sctp-client-server-code-in-c.html" target="\_blank">http://matrixsust.blogspot.my/2011/11/basic-sctp-client-server-code-in-c.html</a></p><p>Below is the decompiled code we identified flag sending from</p><figure class="tmblr-full" data-orig-height="424" data-orig-width="596"><img src="https://64.media.tumblr.com/65cfe552a07fb2b3beafa9ca2f5cd75f/tumblr\_inline\_ozn5zn7DzN1rya2cv\_540.png" data-orig-height="424" data-orig-width="596"/></figure><p>Using the template C code, we managed to connect and get the flag.</p><figure class="tmblr-full" data-orig-height="527" data-orig-width="456"><img src="https://64.media.tumblr.com/3c881995c515dceea7389199c5f61775/tumblr\_inline\_ozn62bD7Py1rya2cv\_540.png" data-orig-height="527" data-orig-width="456"/></figure><p>Flag: wgmy{y0u\_c4n\_und3rst4nd\_pr0t0c0l\_y0u\_m0f0}</p>https://security.my/post/167642923927https://security.my/post/167642923927Sun, 19 Nov 2017 09:42:49 +0800Wargames.my 2017 - Brazzer Challenge<p>This challenge is a fairly simple one, you connect to it, then it connect back to you on a random port with the flag. We solved this thanks to a many-to-one nat with Mikrotik.</p><p>Below is the code that does the connect back.</p><figure data-orig-width="870" data-orig-height="605" class="tmblr-full"><img src="https://64.media.tumblr.com/20694a605f24a5c90ab88e8e825a44bf/tumblr\_inline\_ozn5d4POik1rya2cv\_540.png" data-orig-width="870" data-orig-height="605"/></figure><p>And the flag is xor’d with the port number its connecting back with.</p><figure data-orig-width="553" data-orig-height="159" class="tmblr-full"><img src="https://64.media.tumblr.com/b80ece52bedd479c874c147712a72f85/tumblr\_inline\_ozn5esg9OF1rya2cv\_540.png" data-orig-width="553" data-orig-height="159"/></figure><p>I then used my Mikrotik to forward all connections from this server to a netcat listening on my pc. The connection finally came back on port 51038 and using the data received, we are able to recover the flag.</p><pre><code>
import struct
#wgmy{r34l\_m4n\_w4tch\_br4zz3r5}
key = 0xC4D0
data = open("flag\_51038", 'rb').read()
x = map(''.join, zip(\*[iter(data)]\*4))
for y in x:
y = struct.unpack("&lt;L", y)[0]
y = y ^ key
print(struct.pack("&lt;L", y))
</code></pre><p>Flag: wgmy{r34l\_m4n\_w4tch\_br4zz3r5}
</p>https://security.my/post/167642687732https://security.my/post/167642687732Sun, 19 Nov 2017 09:33:47 +0800Wargames.my 2017 - I Open At The Close<p>This challenge requires you to download a 1GB file from [http://1511.wargames.my/](<a href="http://1511.wargames.my/" target="\_blank">http://1511.wargames.my/</a>), the only catch is, each IP is rate limited to 5600bps.
</p><p>We solved it by using the HTTP Range Header</p><pre><code>import http.client
conn = http.client.HTTPConnection('1511.wargames.my')
conn.request("GET", '/images.img', headers={'Range': 'bytes=1073741820-1073741857'})
resp = conn.getresponse()
resp.status
if resp.status == http.client.PARTIAL\_CONTENT:
print("OK")
resp.getheader('content-range')
content = resp.read()
print(len(content))
print(content[::-1])
</code></pre>
<p>Flag: wrgm:{doyoulikebigfiles}</p>https://security.my/post/167642228737https://security.my/post/167642228737Sun, 19 Nov 2017 09:16:21 +0800Wargames.my 2017 - Scoreboard<p>Congratulations to the winners and kudos to the organizers for a great game. See you guys again next year!!!!!!</p><figure data-orig-width="1191" data-orig-height="620" class="tmblr-full"><img src="https://64.media.tumblr.com/7ba23e28b8f4d4eed339a85465003db7/tumblr\_inline\_ozn3o1xqg31rya2cv\_540.png" alt="image" data-orig-width="1191" data-orig-height="620"/></figure>https://security.my/post/167641556637https://security.my/post/167641556637Sun, 19 Nov 2017 08:51:18 +0800CVE-2017-8176<p>This vulnerability was found on a huawei STB that is used by a popular ISP here in Malaysia. The flaw lies in the fact that the software relies on the client to enforce subscription validation.</p><p>The web-server that the STB connects to retrieve the UI runs over HTTP and this parameter is modifiable through a configuration menu. By relaying HTTP traffic to a custom proxy running on the STB, we can substitute the requested HTML files that contain subscription validation with local files that have them removed and enable the viewing of all the channels for free.</p><p>This vulnerability affects all the STBs (Mips/Arm/Android Firmware)</p><p>Source code of the custom proxy used is available at @ <a href="http://github.com/klks/swproxy" target="\_blank">http://github.com/klks/swproxy</a></p><p>To note, huawei was very responsive and professional in communications. They also asked that public disclosure be delayed to Sept 15th to ensure their customers had a chance to fully roll out the fix for this vulnerability.</p>https://security.my/post/165370836947https://security.my/post/165370836947Sat, 16 Sep 2017 01:35:19 +0800Bug: Out-Of-Bound<p>Results from our fuzzer. Out-Of-Boundary bug :) It looks like Bug 1 and Bug 2 are almost same (the path of its execution).</p><p>Bug 1<br/>=====<br/>eax=00000000 ebx=07b30554 ecx=07a8dda0 edx=ffffffff esi=07a8dda0 edi=07a9d1d0<br/>eip=67950144 esp=0acfaa7c ebp=0acfaa7c iopl=0         nv up ei pl zr na pe nc<br/>cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246<br/>MSHTML!CTreeNode::ShouldHaveLayout+0x7b:<br/>67950144 5d              pop     ebp</p><p>MSHTML!CTreeNode::ShouldHaveLayout+0x7b:<br/>67950144 5d              pop     ebp<br/>67950145 c20400          ret     4<br/>67950148 8bcb            mov     ecx,ebx<br/>6795014a e83e0e0100      call    MSHTML!CElement::EnsureStandardsModeChecked (67960f8d)<br/>6795014f e978ffffff      jmp     MSHTML!CTreeNode::ShouldHaveLayout+0x14 (679500cc)<br/>67950154 90              nop<br/>67950155 90              nop<br/>67950156 90              nop</p><p>0:025&gt; k 10<br/>ChildEBP RetAddr  <br/>0acfaa7c 67970664 MSHTML!CTreeNode::ShouldHaveLayout+0x7b<br/>0acfaa8c 6796e7b1 MSHTML!CTreeNode::GetUpdatedParentLayoutNode+0x39<br/>0acfaa9c 6797518d MSHTML!CTreeNode::GetUpdatedParentLayout+0xe<br/>0acfaaac 68725943 MSHTML!CTreeNode::GetUpdatedNearestLayout+0x24<br/>0acfab04 6872623e MSHTML!CSelectionRenderingServiceProvider::InvalidateSegment+0x17f<br/>0acfab34 682933c9 MSHTML!CSelectionRenderingServiceProvider::PrivateClearSegment+0x8c<br/>0acfab4c 6824d0ee MSHTML!CDoc::RemoveSegment+0x39<br/>0acfab80 67b6e671 MSHTML!CSelTrackServices::ClearSelection+0x6d2cf3<br/>0acfaba4 67c5cf99 MSHTML!CSelectionManager::ChangeTracker+0x56<br/>0acfabc0 688c8a7c MSHTML!CSelectionManager::SetCurrentTracker+0x14<br/>0acfac48 688c9406 MSHTML!CSelectionManager::Select+0x8ee<br/>0acfacbc 688f74bb MSHTML!CSelectionManager::SelectAll+0x868<br/>0acfad00 67d96d56 MSHTML!CSelectAllCommand::PrivateExec+0x20b<br/>0acfad34 67b55e2f MSHTML!CCommand::Exec+0xbd<br/>0acfad68 67b55c13 MSHTML!CMshtmlEd::Exec+0x13a<br/>0acfadb0 67aba8fd MSHTML!CEditRouter::ExecEditCommand+0x131</p><p>Bug 2<br/>=====<br/>eax=00000000 ebx=033fd5c4 ecx=089ff9e0 edx=ffffffff esi=07eef8d8 edi=089f6e40<br/>eip=68b40658 esp=032ea628 ebp=032ea62c iopl=0         nv up ei pl zr na pe nc<br/>cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00200246<br/>MSHTML!CTreeNode::GetUpdatedParentLayoutNode+0x2d:<br/>68b40658 7515            jne     MSHTML!CTreeNode::GetUpdatedParentLayoutNode+0x44 (68b4066f) [br=0]</p><p>0:007&gt; u<br/>MSHTML!CTreeNode::GetUpdatedParentLayoutNode+0x2d:<br/>68b40658 7515            jne     MSHTML!CTreeNode::GetUpdatedParentLayoutNode+0x44 (68b4066f)<br/>68b4065a ff7508          push    dword ptr [ebp+8]<br/>68b4065d 8bce            mov     ecx,esi<br/>68b4065f e854fafdff      call    MSHTML!CTreeNode::ShouldHaveLayout (68b200b8)<br/>68b40664 85c0            test    eax,eax<br/>68b40666 74c7            je      MSHTML!CTreeNode::GetUpdatedParentLayoutNode+0x8 (68b4062f)<br/>68b40668 8bc6            mov     eax,esi<br/>68b4066a 5e              pop     esi</p><p>0:007&gt; k 10<br/>ChildEBP RetAddr  <br/>032ea62c 68b3e7b1 MSHTML!CTreeNode::GetUpdatedParentLayoutNode+0x2d<br/>032ea63c 68b4518d MSHTML!CTreeNode::GetUpdatedParentLayout+0xe<br/>032ea64c 698f5943 MSHTML!CTreeNode::GetUpdatedNearestLayout+0x24<br/>032ea6a4 698f6741 MSHTML!CSelectionRenderingServiceProvider::InvalidateSegment+0x17f<br/>032ea6e0 698f4e46 MSHTML!CSelectionRenderingServiceProvider::UpdateSegment+0x233<br/>032ea718 6947b3a3 MSHTML!CSelectionRenderingServiceProvider::AddSegmentEx+0x256<br/>032ea73c 6945e952 MSHTML!CMarkup::AddSegmentEx+0x2b<br/>032ea76c 6945e8eb MSHTML!CDoc::AddSegmentEx+0x52<br/>032ea78c 69ad38b9 MSHTML!CDoc::AddSegment+0x1b<br/>032ea7c0 69ad3476 MSHTML!CSelTrackServices::CreateSelectionSegments+0xeb<br/>032ea7d0 69adb144 MSHTML!CSelTrackServices::ConstrainAndSelect+0x33<br/>032ea818 69ad8a96 MSHTML!CSelectTracker::Position+0x1ae<br/>032ea85c 68e2cfbd MSHTML!CSelectTracker::Init2+0x136<br/>032ea880 69a98a7c MSHTML!CSelectionManager::SetCurrentTracker+0x38<br/>032ea908 69a99406 MSHTML!CSelectionManager::Select+0x8ee<br/>032ea97c 69ac74bb MSHTML!CSelectionManager::SelectAll+0x868</p><p>0:007&gt; dds ecx<br/>089ff9e0  68a81768 MSHTML!CBlockElement::`vftable&rsquo;</p><p>Bug 3<br/>=====<br/>eax=00000000 ebx=68a7a4e0 ecx=00000000 edx=00000000 esi=099655c0 edi=0cf890b0<br/>eip=68b44c7d esp=0cf89098 ebp=0cf890a8 iopl=0         nv up ei pl zr na pe nc<br/>cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246<br/>MSHTML!CElement::GetAAlang+0x48:<br/>68b44c7d 5b              pop     ebx</p><p>0:027&gt; k 10<br/>ChildEBP RetAddr  <br/>0cf890a8 68b44bfa MSHTML!CElement::GetAAlang+0x48<br/>0cf890c8 68b4486e MSHTML!CElement::GetCascadedLang+0x113<br/>0cf89198 68b442f1 MSHTML!CStyleSheetArray::BuildListOfProbableRules+0x315<br/>0cf8925c 68dd1747 MSHTML!CStyleSheetArray::BuildListOfMatchedRules+0x57<br/>0cf894ac 68e0e8ed MSHTML!CStyleSheetArray::Apply+0x8e<br/>0cf89774 68a0f152 MSHTML!CElement::ApplyStyleSheets+0xd4f<br/>0cf897b4 68b43b61 MSHTML!CElement::ApplyDefaultFormat+0x116<br/>0cf897e4 68b43bda MSHTML!CBlockElement::ApplyDefaultFormat+0x11c<br/>0cf89ab0 68e4a2d1 MSHTML!CElement::ComputeFormatsVirtual+0xc31<br/>0cf89b50 69055f43 MSHTML!CElement::ComputeFormats+0x4d2<br/>0cf8a830 68a82103 MSHTML!CTreeNode::ComputeFormatsHelper+0xab<br/>0cf8a844 693299c1 MSHTML!CTreeNode::GetFancyFormatIndexHelper+0x11<br/>0cf8a85c 69305090 MSHTML!CTreeNode::ShouldHaveLayout+0x8c9909<br/>0cf8a8c8 68afd3cc MSHTML!CMarkup::RangeAffected+0x807731<br/>0cf8a97c 68e85326 MSHTML!CMarkup::NotifyElementEnterTree+0x1e2<br/>0cf8a9f8 68e7ec0d MSHTML!CMarkup::InsertElementInternalWithInclusions+0x289</p><p>0:027&gt; u<br/>MSHTML!CElement::GetAAlang+0x48:<br/>68b44c7d 5b              pop     ebx<br/>68b44c7e 8be5            mov     esp,ebp<br/>68b44c80 5d              pop     ebp<br/>68b44c81 c3              ret<br/>68b44c82 8b4010          mov     eax,dword ptr [eax+10h]<br/>68b44c85 83f801          cmp     eax,1<br/>68b44c88 0f86c2f6ffff    jbe     MSHTML!CStyleSheetArray::BuildListOfMatchedRules+0xb6 (68b44350)<br/>68b44c8e ff3568e0ad69    push    dword ptr [MSHTML!ns\_sse::fnCompareTwoProbableRuleEntry (69ade068)]</p>https://security.my/post/164060141367https://security.my/post/164060141367Fri, 11 Aug 2017 21:28:18 +0800State the Art of Fuzzing and Exploitation: Usable or Useless?<p><i><b><a href="https://en.wikipedia.org/wiki/Fuzzing" target="\_blank">Fuzzing</a> or fuzz testing is an automated software testing technique that involves providing invalid, unexpected, or random data as inputs to a computer program</b></i>. Today we shared our finding for the past few years fuzzing most (vulnerable) popular browser, Internet Explorer. We have seen many (notable) security researcher performed fuzzing in a large scale with different approach and idea. It is time for us to share our thoughts and experienced. </p><p><b>So Why Fuzzing? </b></p><ol><li>Reduce time consumption</li><li>Uncover the unknown</li><li>Reverse engineering is tedious work </li></ol><p><b>Method and Technology</b></p><ol><li>Static - Mutation and Generation</li><li>Blackbox - Framework</li></ol><p>Writing a (browser) fuzzer from scratch are indeed pain in the ass, including understanding of the browser technology, specification (W3C), code to write (JS, HTML, CSS, XML, etc.). There’s a number of great fuzzer being released to public. The idea and concept behind the fuzzer provides more input to write a new one, rewrite or adding a new feature that is missing from the original code. A great combination with the well known fuzzer framework such as <a href="https://github.com/stephenfewer/grinder" target="\_blank">Grinder</a> assist much in handle the fuzzing state. Our main idea writing a fuzzer:</p><ul><li>Collect POC, templates, as much as we can / have</li><li>Creating multiple mutations for each test case</li><li>Dictionary is our specifications here (reading / understanding MSDN, W3C, MDN)</li><li>We focused more on DOM fuzzing (the rest too but not that much)</li><li>We used <a href="https://github.com/aoh/radamsa" target="\_blank">radamsa</a> too :)</li><li>We created a simple framework to help us in automate few stuff such as analyzing the crash state (e.g. PyDBG, WinappDBG), restart browser (timeout, crashed state).</li><li>And of course reverse engineer interesting stuff :)</li></ul><p>Our fuzzer consists of:</p><ul><li>Generator</li><li>Randomization</li><li>Auto start debugging (Access Violation Read)</li><li>Process Enumeration (We need to debug the child process not the parent)</li><li>Auto generate POC (some POC not really reliable, need a little tweak or GTFO)</li><li>Logging capability</li></ul><p>We have found numbers of issue (some are non-security issue) in the past and yet validate it still working till this write up. We have reported a few issue to vendor, unfortunately it gets rejected. For the past few years, we have seen many security (exploit) mitigation being introduced such as MemProt (MemGC), Heap Isolation, Virtual Table Guard (vtguard) and the powerful one Control Flow Guard (CFG). We have seen a number of research paper being published bypassing the security mitigation implemented in the browser. </p><p>Quick look at exploit mitigation that has been introduced:</p><ul><li>Example of MemProt / MemGC implementation</li><ul><li>6b024838 e81f000000      call    MSHTML!CEventObj::~CEventObj <br/>6b02483d f6450801        test    byte ptr [ebp+8],1<br/>6b024841 740d            je      MSHTML!CEventObj::`vector deleting destructor&rsquo;+0x20<br/>6b024843 8b0d8041d66b    mov     ecx,dword ptr [MSHTML!g\_hProcessHeap (6bd64180)]<br/>6b024849 8bd6            mov     edx,esi<br/>6b02484b e8a0942300      call    MSHTML!MemoryProtection::HeapFree (6b25dcf0)<br/><br/></li></ul><li>Example of VTGuard implementation</li><ul><li>6b02380f 8b33            mov     esi,dword ptr [ebx]<br/>6b023811 81be28030000c000306b cmp dword ptr [esi+328h],offset MSHTML!\_\_vtguard (6b3000c0)<br/>6b02381b 7536            jne     MSHTML!CElement::IsLinkedContentElement+0x5c (6b023853)<br/><br/></li></ul><li>Example of CFG implementation</li><ul><li>6b02418f ff156c10d76b    call    dword ptr [MSHTML!\_\_guard\_check\_icall\_fptr (6bd7106c)]<br/>6b024195 ffd6            call    esi<br/></li></ul></ul><p>The exploit mitigation can be found when debugging IE and we noticed some area are indeed protected in a few layer. Thus, making the vulnerability almost died (non-exploitable). However, there’s a few way in order to bypass the mitigation. We won’t discuss those stuff here. Example of how the exploit mitigation mitigate the pointer of controlled data:</p><p>6b024b8e 8bf4            mov     esi,esp<br/>6b024b90 51              push    ecx<br/>6b024b91 8bcf            mov     ecx,edi<br/>6b024b93 ff156c10d76b    call    dword ptr [MSHTML!\_\_guard\_check\_icall\_fptr (6bd7106c)]<br/>6b024b99 ffd7            call    edi<br/></p><p>We can see the disassembly offset “6b024b99″ were pointing to EDI. For example if we have data that already controlled, we can send an instruction to execute shellcode. However, the offset ”6b024b93″ is making the next instruction pointed to another place (indirect pointer). Verifying the pointer jump to another place:</p><p>0:009&gt; dds MSHTML!\_\_guard\_check\_icall\_fptr<br/>6bd7106c  77162170 ntdll!LdrpValidateUserCallTarget<br/>6bd71070  6b3002a0 MSHTML!CBlockedParentUnit::Add</p><p>Another example of CFG details can be found <a href="http://deroko.phearless.org/cfgicall.txt" target="\_blank">here</a>.</p><p>We shared a few issue that we found in the past. Some we figure out it still worked until this write up, some are fixed and some are not (just a crash triggered during fuzzing, which we believed unreliable or memory exhausted):</p><ul><li>Issue 1 - MSHTML!CMarkupPointer::UnEmbed
</li><ul><li>(3144.3dd4): Stack overflow - code c00000fd (first chance)<br/>First chance exceptions are reported before any exception handling.<br/>This exception may be expected and handled.<br/>eax=6abd3ecc ebx=061d3000 ecx=6b307880 edx=50555555 esi=0d2734a0 edi=6b307880<br/>eip=6b25969a esp=061d3000 ebp=061d3048 iopl=0         nv up ei pl nz ac pe nc<br/>cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00010216<br/>MSHTML!CMarkupPointer::UnEmbed+0x1a:<br/>6b25969a ff156c10d76b    call    dword ptr [MSHTML!\_\_guard\_check\_icall\_fptr (6bd7106c)] ds:002b:6bd7106c={ntdll!LdrpValidateUserCallTarget (77162170)}</li></ul><li>Issue 2 - MSHTML!CTsfTextStore::Initialize
</li><ul><li>(220c.5340): Access violation - code c0000005 (first chance)<br/>First chance exceptions are reported before any exception handling.<br/>This exception may be expected and handled.<br/>eax=00000000 ebx=04c703cc ecx=04c9c900 edx=00000000 esi=00000000 edi=04c702e0<br/>eip=6b9be3b4 esp=0695bd70 ebp=0695bd98 iopl=0         nv up ei pl zr na pe nc<br/>cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00010246<br/>MSHTML!CTsfTextStore::Initialize+0x77:<br/>6b9be3b4 8b0e            mov     ecx,dword ptr [esi]  ds:002b:00000000=????????<br/></li></ul><li>Issue 3 - WININET!ProxyBrokerClientResolver::ComMTAKeepAliveThread
</li><ul><li>0:009&gt; !wow64exts.sw<br/>Switched to 32bit mode<br/>0:009:x86&gt; kb<br/>ChildEBP RetAddr  Args to Child              <br/>0d58fd64 74382e51 00000050 00000000 00000000 ntdll\_77bb0000!ZwWaitForSingleObject+0x15<br/>0d58fd78 764c14ab 00000050 00000000 00000000 VFBASICS!AVrfpNtWaitForSingleObject+0x21<br/>0d58fde4 74382c8b 00000050 ffffffff 00000000 KERNELBASE!WaitForSingleObjectEx+0x98<br/>0d58fe00 74382cfb 00000050 ffffffff 00000000 VFBASICS!AVrfpWaitForSingleObjectExCommon+0xa1<br/>0d58fe20 76511194 00000050 ffffffff 00000000 VFBASICS!AVrfpKernelbaseWaitForSingleObjectEx+0x1c<br/>0d58fe38 76511148 00000050 ffffffff 00000000 KERNEL32!WaitForSingleObjectExImplementation+0x75<br/>0d58fe4c 74382a54 00000050 ffffffff 096baf94 KERNEL32!WaitForSingleObject+0x12<br/>0d58fe64 74382a9c 00000050 ffffffff 7438f418 VFBASICS!AVrfpWaitForSingleObjectCommon+0x9e<br/>0d58fe80 76336a63 00000050 ffffffff 762df3d8 VFBASICS!AVrfpKernel32WaitForSingleObject+0x23<br/>0d58feb0 76336b20 00000000 0c2c6fe0 743a4bf0 WININET!ProxyBrokerClientResolver::ComMTAKeepAliveThread+0xd5<br/>0d58fec8 7438602c 096baf38 4d0d531f 00000000 WININET!ProxyBrokerClientResolver::ComMTAKeepAliveThreadStart+0x30<br/>0d58ff00 7651337a 0c2c6fe0 0d58ff4c 77be92e2 VFBASICS!AVrfpStandardThreadFunction+0x2f<br/>0d58ff0c 77be92e2 0c2c6fe0 4efe9fa8 00000000 KERNEL32!BaseThreadInitThunk+0xe<br/>0d58ff4c 77be92b5 74385ffd 0c2c6fe0 ffffffff ntdll\_77bb0000!\_\_RtlUserThreadStart+0x70<br/>0d58ff64 00000000 74385ffd 0c2c6fe0 00000000 ntdll\_77bb0000!\_RtlUserThreadStart+0x1b</li></ul><li>Issue 4 - iertutil!\_IsoThreadWindowsPump
</li><ul><li>ModLoad: 00000000`3a510000 00000000`3a59c000   C:\Windows\SysWOW64\uiautomationcore.dll<br/>wow64cpu!CpupSyscallStub+0x9:<br/>00000000`73f12e09 c3              ret<br/>0:003&gt; kb<br/>RetAddr           : Args to Child                                                           : Call Site<br/>00000000`73f1283e : 00000000`75780735 00000000`00000023 00000000`00000246 00000000`0af2fca8 : wow64cpu!CpupSyscallStub+0x9<br/>00000000`73f8d286 : 00000000`0aa9fd20 00000000`73f11920 00000000`00000000 00000000`0aa9ec70 : wow64cpu!WaitForMultipleObjects32+0x3b<br/>00000000`73f8c69e : 00000000`00000000 00000000`00000000 00000000`00000000 00000000`00000000 : wow64!RunCpuSimulation+0xa<br/>00000000`77a44ff4 : 00000000`00000000 00000000`7efdf000 00000000`7efad000 00000000`00000000 : wow64!Wow64LdrpInitialize+0x42a<br/>00000000`779fb78e : 00000000`0aa9f260 00000000`00000000 00000000`7efdf000 00000000`00000000 : ntdll! ?? ::FNODOBFM::`string&rsquo;+0x25c64<br/>00000000`00000000 : 00000000`00000000 00000000`00000000 00000000`00000000 00000000`00000000 : ntdll!LdrInitializeThunk+0xe<br/>0:003&gt; !sw<br/>Switched to 32bit mode<br/>0:003:x86&gt; kb<br/>ChildEBP RetAddr  Args to Child              <br/>0af2fb2c 764c15f7 00000001 0af2fb7c 00000001 ntdll\_77bb0000!ZwWaitForMultipleObjects+0x15<br/>0af2fbc8 74972dab 0af2fb7c 0af2fc3c 00000000 KERNELBASE!WaitForMultipleObjectsEx+0x100<br/>0af2fbec 74972e27 00000001 0af2fc3c 00000000 VFBASICS!AVrfpWaitForMultipleObjectsExCommon+0xa7<br/>0af2fc14 76511a0c 00000001 0af2fc3c 00000000 VFBASICS!AVrfpKernelbaseWaitForMultipleObjectsEx+0x22<br/>0af2fc5c 74972dab 00000001 7efde000 00000000 KERNEL32!WaitForMultipleObjectsExImplementation+0xe0<br/>0af2fc80 74972dfc 00000001 0af2fcd0 00000000 VFBASICS!AVrfpWaitForMultipleObjectsExCommon+0xa7<br/>0af2fca8 7578086a 00000001 0af2fcd0 00000000 VFBASICS!AVrfpKernel32WaitForMultipleObjectsEx+0x2c<br/>0af2fcfc 759ebaf3 000000f8 00000000 ffffffff USER32!RealMsgWaitForMultipleObjectsEx+0x14d<br/>0af2fd54 759eec26 06ee0f18 0af2fddc 6c2530d0 iertutil!\_IsoThreadWindowsPump+0xed<br/>0af2fdd0 74a33991 089f8d58 00000000 0a954fe0 iertutil!IsoManagerThreadNonzero\_WindowsPump+0xa6<br/>0af2fe08 7497602c 09930fe8 4af940b3 00000000 IEShims!NS\_CreateThread::DesktopIE\_ThreadProc+0x94<br/>0af2fe40 7651337a 0a954fe0 0af2fe8c 77be92e2 VFBASICS!AVrfpStandardThreadFunction+0x2f<br/>0af2fe4c 77be92e2 0a954fe0 49a58c4c 00000000 KERNEL32!BaseThreadInitThunk+0xe<br/>0af2fe8c 77be92b5 74975ffd 0a954fe0 ffffffff ntdll\_77bb0000!\_\_RtlUserThreadStart+0x70<br/>0af2fea4 00000000 74975ffd 0a954fe0 00000000 ntdll\_77bb0000!\_RtlUserThreadStart+0x1b<br/></li></ul><li>Issue 5 - SHLWAPI!StrCmpICW+0xd
</li><ul><li>STACK\_TEXT:  <br/>0c1b8a9c 6b1adb68 00000000 6b1adb90 0c1b8adc SHLWAPI!StrCmpICW+0xd<br/>0c1b8abc 6a381fd9 5096aeac 69ed0df0 0c1b8af0 IEFRAME!CShellOcx::GetIDsOfNames+0x48<br/>0c1b8ae8 6a383e78 00000000 00000001 0c1b8b54 MSHTML!COleSite::GetDispIDFromControl+0x66<br/>0c1b8afc 6a740e03 64ba2e90 00000000 00000001 MSHTML!COleSite::GetCustomDispID+0x48<br/>0c1b8b2c 6a542532 64ba2e90 ffffffff 6efecde0 MSHTML!COleSiteDispatchTypeOperations::GetDispId+0x73<br/>0c1b8b58 7445e2d6 79326ff0 6efecde0 699f24e0 MSHTML!CDispatchTypeOperations::HasOwnProperty+0x9f<br/>0c1b8bb4 746151d3 ffffffff 553138b8 7444cf00 JSCRIPT9!Js::CustomExternalObject::HasProperty+0x10d<br/>0c1b8bd0 745c10d3 699f24e0 ffffffff 553138b8 JSCRIPT9!Js::JavascriptOperators::OP\_HasProperty+0x67<br/>0c1b8c44 7456ccc5 59987bd4 00000008 0c1b8d04 JSCRIPT9!JavascriptDispatch::GetPropertyIdWithFlag+0x1b6<br/>0c1b8ca8 7456cbdc 59987bd4 00000008 0c1b8d04 JSCRIPT9!JavascriptDispatch::GetPropertyIdWithFlagWithScriptEnter+0x96<br/>0c1b8d20 21bac8dc 699e2c84 59987bd4 00000008 JSCRIPT9!JavascriptDispatch::GetDispID+0xbc<br/>0c1b8d60 21b8350c 0c1b8f38 0c1b8e50 5d374e00 vbscript!GetDispatchDispID+0x144<br/>0c1b8fa4 21b8526e 0c1b9130 336d1c9b 5cd36fd0 vbscript!CScriptRuntime::RunNoEH+0x1951<br/>0c1b8ff4 21b8518b 0c1b9130 337cefe0 3ddd9fe8 vbscript!CScriptRuntime::Run+0xc3<br/>0c1b9104 21b859bd 0c1b9130 00000000 5cd36fd0 vbscript!CScriptEntryPoint::Call+0x10b<br/>0c1b9178 21ba9b50 337cefe0 0c1bb3a8 00000000 vbscript!CSession::Execute+0x156<br/>0c1b920c 6a447bad 33d48fe0 00000002 00000409 vbscript!NameTbl::InvokeEx+0x37a<br/>0c1b9250 6a39dc38 58c23f48 00002712 00000409 MSHTML!CScriptCollection::InvokeEx+0xc5<br/>0c1bb2cc 69fd008b 0c5cde30 00002712 00000409 MSHTML!CWindow::InvokeEx+0x3a9<br/>0c1bb300 69fd00b5 0c5cde30 00002712 00000409 MSHTML!CBase::VersionedInvokeEx+0xcf<br/>0c1bb340 6a39de0e 0c5cde30 00002712 00000409 MSHTML!CBase::PrivateInvokeEx+0xbd<br/>0c1bb3bc 6a12ed5b 5f08ef68 00002712 00000409 MSHTML!COmWindowProxy::InvokeEx+0x2b4<br/>0c1bb3f0 6a48821c 5f08ef68 00002712 00000409 MSHTML!CBase::VersionedInvokeEx+0x8b<br/>0c1bb4a0 7458dfbe 69cc3ab0 10000001 55880e40 MSHTML!CJScript9Holder::Trampoline\_DispatchMethod+0x232<br/>0c1bb4d8 7458df27 10000001 0c1bb530 1a36dcd7 JSCRIPT9!Js::JavascriptFunction::CallFunction&lt;0&gt;+0x69<br/>0c1bb520 7445c956 69cc3ab0 10000001 55880e40 JSCRIPT9!Js::ExternalType::ExternalEntryThunk+0x93<br/>0c1bb7c8 7445d229 1e01c04a 699f3120 1e01c000 JSCRIPT9!Js::InterpreterStackFrame::Process+0x1e72<br/>0c1bb8ec 0b8b0fe9 0c1bb900 0c1bb944 7445699a JSCRIPT9!Js::InterpreterStackFrame::InterpreterThunk&lt;1&gt;+0x200<br/>WARNING: Frame IP not in any known module. Following frames may be wrong.<br/>0c1bb8f8 7445699a 699e3560 00000002 55880e40 0xb8b0fe9<br/>0c1bb944 74457081 00000002 0c1bbadc 1a36d04f JSCRIPT9!Js::JavascriptFunction::CallFunction&lt;1&gt;+0x91<br/>0c1bb9b8 74456fb6 553138b8 00000002 0c1bbadc JSCRIPT9!Js::JavascriptFunction::CallRootFunction+0xb9<br/>0c1bba00 74456f49 0c1bba2c 00000002 0c1bbadc JSCRIPT9!ScriptSite::CallRootFunction+0x42<br/>0c1bba4c 745fb4d4 699e3560 0c1bba7c 00000000 JSCRIPT9!ScriptSite::Execute+0xd2<br/>0c1bbab0 6a3376ad 6efecde0 699e3560 00000002 JSCRIPT9!ScriptEngineBase::Execute+0xc8<br/>0c1bbb6c 6a337547 699e3560 5806cfa0 19a2cfc0 MSHTML!CListenerDispatch::InvokeVar+0x15a<br/>0c1bbb98 6a337232 5806cfa0 19a2cfc0 0c1bbd44 MSHTML!CListenerDispatch::Invoke+0x6d<br/>0c1bbc38 6a3373a6 0c1bbd44 00000001 5806cfa0 MSHTML!CEventMgr::\_InvokeListeners+0x210<br/>0c1bbc50 6a3372c3 5806cfa0 00000000 00000001 MSHTML!CEventMgr::\_InvokeListenersOnWindow+0x42<br/>0c1bbce0 6a337000 0c1bbd44 00000000 5806cfa0 MSHTML!CEventMgr::\_InvokeListeners+0x150<br/>0c1bbe40 69f9eba9 00000000 ffffffff 00000000 MSHTML!CEventMgr::Dispatch+0x4d5<br/>0c1bbe68 6a588900 57510fe0 ffffffff 1b892f68 MSHTML!CEventMgr::DispatchEvent+0x90<br/>0c1bbea0 69fd18e7 73124bb0 1c170f48 69f06e70 MSHTML!COmWindowProxy::Fire\_onload+0x146<br/>0c1bbf00 69fd1537 1b3fcbd0 1c170f48 1b3fcbec MSHTML!CMarkup::OnLoadStatusDone+0x373<br/>0c1bbf14 69fd071c 00000004 69fb05c0 0c1bc374 MSHTML!CMarkup::OnLoadStatus+0xe7<br/>0c1bc358 69fb05d2 10000019 0c1bc3ac 69f07b33 MSHTML!CProgSink::DoUpdate+0x48b<br/>0c1bc364 69f07b33 1c170f48 1c170f48 00000000 MSHTML!CProgSink::OnMethodCall+0x12<br/>0c1bc3ac 69eed45e 1b2ef2f0 00000000 69eed0c0 MSHTML!GlobalWndOnMethodCall+0x17b<br/>0c1bc400 775d62fa 000a0498 00008002 00000000 MSHTML!GlobalWndProc+0x12e<br/>0c1bc42c 775d6d3a 69eed0c0 000a0498 00008002 USER32!InternalCallWinProc+0x23<br/>0c1bc4a4 775d77c4 00000000 69eed0c0 000a0498 USER32!UserCallWinProcCheckWow+0x109<br/>0c1bc504 775d788a 69eed0c0 00000000 0c1bf6e4 USER32!DispatchMessageWorker+0x3bc<br/>0c1bc514 6b17a638 0c1bc554 06f92e48 09f3dfe0 USER32!DispatchMessageW+0xf<br/>0c1bf6e4 6b1d5f88 0c1bf7b0 6b1d5c00 06f94ff0 IEFRAME!CTabWindow::\_TabWindowThreadProc+0x464<br/>0c1bf7a4 7735e7bc 06f92e48 0c1bf7c8 6b2456e0 IEFRAME!LCIETab\_ThreadProc+0x3e7<br/>0c1bf7bc 6ecc4b01 06f94ff0 00000000 0affafe0 iertutil!\_IsoThreadProc\_WrapperToReleaseScope+0x1c<br/>0c1bf7f4 6f0f602c 0b473fe8 63130241 00000000 IEShims!NS\_CreateThread::DesktopIE\_ThreadProc+0x94<br/>0c1bf82c 76cc337a 0affafe0 0c1bf878 77e192e2 VFBASICS!AVrfpStandardThreadFunction+0x2f<br/>0c1bf838 77e192e2 0affafe0 7bf2ce2a 00000000 KERNEL32!BaseThreadInitThunk+0xe<br/>0c1bf878 77e192b5 6f0f5ffd 0affafe0 ffffffff ntdll\_77de0000!\_\_RtlUserThreadStart+0x70<br/>0c1bf890 00000000 6f0f5ffd 0affafe0 00000000 ntdll\_77de0000!\_RtlUserThreadStart+0x1b</li></ul></ul><p>Here we providing an example of issue found when fuzzing. The function <b>WININET!ProxyBrokerClientResolver::ComMTAKeepAliveThreadStart </b>leads to the root cause. Our testing found that this is only work on IE11 (as per testing). The issue seems to be patched (either internally or reported) with latest update of IE11. </p><p>A simple JavaScript can be crafted in the way:</p><p><i>var start = Date.now();<br/>Date.now() - start &lt;= 0xFFFF;</i></p><p>Successful execution may leads to crash path below:</p><p>Crash analysis:<br/>0:009&gt; !wow64exts.sw<br/>Switched to 32bit mode<br/>0:009:x86&gt; kb<br/>ChildEBP RetAddr  Args to Child              <br/>0d58fd64 74382e51 00000050 00000000 00000000 ntdll\_77bb0000!ZwWaitForSingleObject+0x15<br/>0d58fd78 764c14ab 00000050 00000000 00000000 VFBASICS!AVrfpNtWaitForSingleObject+0x21<br/>0d58fde4 74382c8b 00000050 ffffffff 00000000 KERNELBASE!WaitForSingleObjectEx+0x98<br/>0d58fe00 74382cfb 00000050 ffffffff 00000000 VFBASICS!AVrfpWaitForSingleObjectExCommon+0xa1<br/>0d58fe20 76511194 00000050 ffffffff 00000000 VFBASICS!AVrfpKernelbaseWaitForSingleObjectEx+0x1c<br/>0d58fe38 76511148 00000050 ffffffff 00000000 KERNEL32!WaitForSingleObjectExImplementation+0x75<br/>0d58fe4c 74382a54 00000050 ffffffff 096baf94 KERNEL32!WaitForSingleObject+0x12<br/>0d58fe64 74382a9c 00000050 ffffffff 7438f418 VFBASICS!AVrfpWaitForSingleObjectCommon+0x9e<br/>0d58fe80 76336a63 00000050 ffffffff 762df3d8 VFBASICS!AVrfpKernel32WaitForSingleObject+0x23<br/>0d58feb0 76336b20 00000000 0c2c6fe0 743a4bf0 WININET!ProxyBrokerClientResolver::ComMTAKeepAliveThread+0xd5<br/>0d58fec8 7438602c 096baf38 4d0d531f 00000000 WININET!ProxyBrokerClientResolver::ComMTAKeepAliveThreadStart+0x30<br/>0d58ff00 7651337a 0c2c6fe0 0d58ff4c 77be92e2 VFBASICS!AVrfpStandardThreadFunction+0x2f<br/>0d58ff0c 77be92e2 0c2c6fe0 4efe9fa8 00000000 KERNEL32!BaseThreadInitThunk+0xe<br/>0d58ff4c 77be92b5 74385ffd 0c2c6fe0 ffffffff ntdll\_77bb0000!\_\_RtlUserThreadStart+0x70<br/>0d58ff64 00000000 74385ffd 0c2c6fe0 00000000 ntdll\_77bb0000!\_RtlUserThreadStart+0x1b</p><p>Disassemble of crashed path:</p><p>0:009:x86&gt; u 76336b20 <br/>WININET!ProxyBrokerClientResolver::ComMTAKeepAliveThreadStart+0x30:<br/>76336b20 8bf0            mov     esi,eax<br/>76336b22 85f6            test    esi,esi<br/>76336b24 7907            jns     WININET!ProxyBrokerClientResolver::ComMTAKeepAliveThreadStart+0x3d (76336b2d)<br/>76336b26 c745fc15040000  mov     dword ptr [ebp-4],415h<br/>76336b2d f605f8d53b7610  test    byte ptr [WININET!g\_rgWppEnabledFlagsPerLevel+0xc (763bd5f8)],10h<br/>76336b34 7412            je      WININET!ProxyBrokerClientResolver::ComMTAKeepAliveThreadStart+0x58 (76336b48)<br/>76336b36 8bce            mov     ecx,esi<br/>76336b38 e8e0faeeff      call    WININET!WX\_WIN32\_FROM\_HR (7622661d)</p><p>Browser fuzzing are getting harder and harder with a lot of competitor (you named it) doing the same thing. The other approach still can be achieved although the competition are tough! We can see the most popular vulnerabilities these days are getting harder to exploit due to the mitigation. </p><p>Keep on fuzzing :)</p><p>I guess that’s all for today. Selamat Hari Raya :)<br/></p><p>-n</p>https://security.my/post/162136584642https://security.my/post/162136584642Fri, 23 Jun 2017 05:10:10 +08002013\_ISACA\_Presentation - Black Hats Final (Amin & Marcus).pdf<a href="https://drive.google.com/open?id=0B8DowiPZ3o4MN1U3QUp2alF5YzQ">2013\_ISACA\_Presentation - Black Hats Final (Amin & Marcus).pdf</a>: <p>Another presentation RuFI0 and I did back in 2013</p>https://security.my/post/159488709412https://security.my/post/159488709412Wed, 12 Apr 2017 20:55:44 +0800

