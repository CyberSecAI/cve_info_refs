=== Content from sourceware.org_ee068660_20250125_231758.html ===


Sourceware Bugzilla – Bug 21440
Malicious PE with invalid extended relocation can cause binutils/objdumo 2.28 to allocate any-size big memory
Last modified: 2017-05-02 10:58:19 UTC

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=21440&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=21440&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 21440**](show_bug.cgi?id=21440)
- Malicious PE with invalid extended relocation can cause binutils/objdumo 2.28 to allocate any-size big memory

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
Malicious PE with invalid extended relocation can cause binutils/objdumo 2.28...

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | binutils | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=binutils "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | binutils ([show other bugs](buglist.cgi?component=binutils&product=binutils&bug_status=__open__)) | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | 2.28 | |  | | | [Importance](page.cgi?id=fields.html#importance): | P2 critical | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Not yet assigned to anyone | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2017-04-27 06:10 UTC by jgj212 | | --- | --- | | Modified: | 2017-05-02 10:58 UTC ([History](show_activity.cgi?id=21440)) | | CC List: | 1 user (show)  nickc | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Host:](page.cgi?id=fields.html#cf_gcchost "A custom Free Text field in this installation of Bugzilla.") |  | | [Target:](page.cgi?id=fields.html#cf_gcctarget "A custom Free Text field in this installation of Bugzilla.") |  | | [Build:](page.cgi?id=fields.html#cf_gccbuild "A custom Free Text field in this installation of Bugzilla.") |  | | [Last reconfirmed:](page.cgi?id=fields.html#cf_reconfirmed_on "A custom Date/Time field in this installation of Bugzilla.") |  | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [**Malicious PE with invalid extended relocation sample**](attachment.cgi?id=10029 "View the content of the attachment") (2.72 KB, application/x-msdownload)  [2017-04-27 06:10 UTC](#attach_10029 "Go to the comment associated with the attachment"), jgj212 | [Details](attachment.cgi?id=10029&action=edit) | | [View All](attachment.cgi?bugid=21440&action=viewall)  [Add an attachment](attachment.cgi?bugid=21440&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=21440&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=21440#c0)  jgj212    2017-04-27 06:10:21 UTC  ``` Created [attachment 10029](attachment.cgi?id=10029 "Malicious PE with invalid extended relocation sample") [[details]](attachment.cgi?id=10029&action=edit "Malicious PE with invalid extended relocation sample") Malicious PE with invalid extended relocation sample  ----------------------- $objdump -x $FILE -----------------------  With x option, objdump will allocate memory to store relocation data, this is done in the following function: static void dump_relocs_in_section (bfd *abfd, 			asection *section, 			void *dummy ATTRIBUTE_UNUSED) { 	…. 	relsize = bfd_get_reloc_upper_bound (abfd, section); //can be controlled 	… 	relpp = (arelent **) xmalloc (relsize);  //allocate memory   	relcount = bfd_canonicalize_reloc (abfd, section, relpp, syms);  //read reloc data 	… }  the relsize is computed as : (asect->reloc_count + 1) * sizeof (arelent *)    // coff_get_reloc_upper_bound(…)  In the coff standard, reoc_count is WORD, which is 16bit wide. sizeof (arelent *) is constant and small. So normally, the result is small. But when PE section contain extended relocation, everything will go bad.   PE section header is inited in the following function: static void coff_set_alignment_hook (bfd * abfd ATTRIBUTE_UNUSED, 			 asection * section, 			 void * scnhdr) { 	… 	/* Check for extended relocs.  */ 	if (hdr->s_flags & IMAGE_SCN_LNK_NRELOC_OVFL) 	{ struct external_reloc dst;       struct internal_reloc n;       file_ptr oldpos = bfd_tell (abfd);       bfd_size_type relsz = bfd_coff_relsz (abfd);        if (bfd_seek (abfd, (file_ptr) hdr->s_relptr, 0) != 0) //seek to the first reloc data 	 return; 	         if (bfd_bread (& dst, relsz, abfd) != relsz) //read the first reloc data 	  return;         coff_swap_reloc_in (abfd, &dst, &n);//fill struct       if (bfd_seek (abfd, oldpos, 0) != 0) 		return;        section->reloc_count = hdr->s_nreloc = n.r_vaddr - 1;  //can be controlled       section->rel_filepos += relsz; } … }	  From the above, when pe section contain extended relocation, reloc_count is assigned from n.r_vaddr.  n is a instance of struct internal_reloc as follow: struct internal_reloc {   bfd_vma r_vaddr;		/* Virtual address of reference */   long r_symndx;		/* Index into symbol table	*/   unsigned short r_type;	/* Relocation type		*/   unsigned char r_size;		/* Used by RS/6000 and ECOFF	*/   unsigned char r_extern;	/* Used by ECOFF		*/   unsigned long r_offset;	/* Used by Alpha ECOFF, SPARC, others */ };  r_vaddr's type is unsigned long, it can be 32bit and 64bit, according to the os-archive. it is from the dst, which is a instance of struct external_reloc as follow: struct external_reloc {   char r_vaddr[4];   char r_symndx[4];   char r_type[2]; };  So n.r_vaddr is really 32bit wide,  section->reloc_count is also 32bit wide. (asect->reloc_count + 1) * sizeof (arelent *) can be very large.   To control the memory size, it just need to modify the r_vaddr field of first reloc data, if can be from 0 to 0Xffffffff.    This could cause memory exhaustion to dos. ```  [Comment 1](show_bug.cgi?id=21440#c1)  jgj212    2017-04-27 10:20:00 UTC  ``` Credit:The bug was discovered by ADLab of Venustech ```  [Comment 2](show_bug.cgi?id=21440#c2)  Sourceware Commits    2017-05-02 10:56:08 UTC  ``` The master branch has been updated by Nick Clifton <nickc@sourceware.org>:  <https://sourceware.org/git/gitweb.cgi?p=binutils-gdb.git;h=39ff1b79f687b65f4144ddb379f22587003443fb>  commit 39ff1b79f687b65f4144ddb379f22587003443fb Author: Nick Clifton <nickc@redhat.com> Date:   Tue May 2 11:54:53 2017 +0100      Prevent memory exhaustion from a corrupt PE binary with an overlarge number of relocs.          	[PR 21440](show_bug.cgi?id=21440 "RESOLVED FIXED - Malicious PE with invalid extended relocation can cause binutils/objdumo 2.28 to allocate any-size big memory")     	* objdump.c (dump_relocs_in_section): Check for an excessive     	number of relocs before attempting to dump them. ```  [Comment 3](show_bug.cgi?id=21440#c3)  Nick Clifton    2017-05-02 10:58:19 UTC  ``` Thanks for reporting this bug.  I have applied a patch to add a check for the reloc size being larger than the size of the file, and hence invalid, before an attempt is made to allocate memory for the relocs.  I think that this should resolve the problem.  Cheers   Nick ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=21440)
* - [XML](show_bug.cgi?ctype=xml&id=21440)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=21440)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=21440&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=21440&GoAheadAndLogIn=1#forgot)
    Login:

    [x]



=== Content from security.gentoo.org_b2097e66_20250125_231757.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# Binutils: Multiple vulnerabilities — GLSA **201709-02**

Multiple vulnerabilities have been found in Binutils, the worst of
which may allow remote attackers to cause a Denial of Service condition.

### Affected packages

| Package | **sys-devel/binutils** on all architectures |
| --- | --- |
| Affected versions | < **2.28.1** |
| Unaffected versions | >= **2.28.1** |

### Background

The GNU Binutils are a collection of tools to create, modify and analyse
binary files. Many of the files use BFD, the Binary File Descriptor
library, to do low-level manipulation.

### Description

Multiple vulnerabilities have been discovered in Binutils. Please review
References for additional information.

### Impact

A remote attacker, by enticing a user to compile/execute a specially
crafted ELF file, PE File, or binary file, could possibly cause a Denial
of Service condition.

### Workaround

There is no known workaround at this time.

### Resolution

All Binutils users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=sys-devel/binutils-2.28.1"

```
### References

* [CVE-2017-6965](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2017-6965)
* [CVE-2017-6966](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2017-6966)
* [CVE-2017-6969](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2017-6969)
* [CVE-2017-7614](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2017-7614)
* [CVE-2017-8392](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2017-8392)
* [CVE-2017-8393](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2017-8393)
* [CVE-2017-8394](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2017-8394)
* [CVE-2017-8395](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2017-8395)
* [CVE-2017-8396](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2017-8396)
* [CVE-2017-8397](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2017-8397)
* [CVE-2017-8398](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2017-8398)
* [CVE-2017-8421](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2017-8421)
* [CVE-2017-9038](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2017-9038)
* [CVE-2017-9039](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2017-9039)
* [CVE-2017-9040](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2017-9040)
* [CVE-2017-9041](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2017-9041)
* [CVE-2017-9042](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2017-9042)
* [CVE-2017-9742](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2017-9742)
* [CVE-2017-9954](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2017-9954)

**Release date**

September 17, 2017

**Latest revision**

September 17, 2017: 1

**Severity**

normal

**Exploitable**

remote

**Bugzilla entries**

* [618006](https://bugs.gentoo.org/show_bug.cgi?id=618006)
* [618514](https://bugs.gentoo.org/show_bug.cgi?id=618514)
* [618516](https://bugs.gentoo.org/show_bug.cgi?id=618516)
* [618520](https://bugs.gentoo.org/show_bug.cgi?id=618520)
* [618826](https://bugs.gentoo.org/show_bug.cgi?id=618826)
* [621130](https://bugs.gentoo.org/show_bug.cgi?id=621130)
* [624524](https://bugs.gentoo.org/show_bug.cgi?id=624524)
* [624702](https://bugs.gentoo.org/show_bug.cgi?id=624702)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**


