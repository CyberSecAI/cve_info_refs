=== Content from github.com_81faebca_20250125_060327.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FVirusTotal%2Fyara%2Fcommit%2F83d799804648c2a0895d40a19835d9b757c6fa4e)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FVirusTotal%2Fyara%2Fcommit%2F83d799804648c2a0895d40a19835d9b757c6fa4e)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=VirusTotal%2Fyara)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[VirusTotal](/VirusTotal)
/
**[yara](/VirusTotal/yara)**
Public

* [Notifications](/login?return_to=%2FVirusTotal%2Fyara) You must be signed in to change notification settings
* [Fork
  1.5k](/login?return_to=%2FVirusTotal%2Fyara)
* [Star
   8.5k](/login?return_to=%2FVirusTotal%2Fyara)

* [Code](/VirusTotal/yara)
* [Issues
  152](/VirusTotal/yara/issues)
* [Pull requests
  23](/VirusTotal/yara/pulls)
* [Discussions](/VirusTotal/yara/discussions)
* [Actions](/VirusTotal/yara/actions)
* [Projects
  0](/VirusTotal/yara/projects)
* [Wiki](/VirusTotal/yara/wiki)
* [Security](/VirusTotal/yara/security)
* [Insights](/VirusTotal/yara/pulse)

Additional navigation options

* [Code](/VirusTotal/yara)
* [Issues](/VirusTotal/yara/issues)
* [Pull requests](/VirusTotal/yara/pulls)
* [Discussions](/VirusTotal/yara/discussions)
* [Actions](/VirusTotal/yara/actions)
* [Projects](/VirusTotal/yara/projects)
* [Wiki](/VirusTotal/yara/wiki)
* [Security](/VirusTotal/yara/security)
* [Insights](/VirusTotal/yara/pulse)

## Commit

[Permalink](/VirusTotal/yara/commit/83d799804648c2a0895d40a19835d9b757c6fa4e)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix issue [#646](https://github.com/VirusTotal/yara/issues/646) ([#648](https://github.com/VirusTotal/yara/pull/648))

[Browse files](/VirusTotal/yara/tree/83d799804648c2a0895d40a19835d9b757c6fa4e)
Browse the repository at this point in the history

```
* Fix issue [#646](https://github.com/VirusTotal/yara/issues/646) and some edge cases with wide regexps using \b and \B

* Rename function IS_WORD_CHAR to _yr_re_is_word_char
```

* Loading branch information

[![@plusvic](https://avatars.githubusercontent.com/u/182937?s=40&v=4)](/plusvic)

[plusvic](/VirusTotal/yara/commits?author=plusvic "View all commits by plusvic")
authored
Apr 27, 2017

1 parent
[f12262c](/VirusTotal/yara/commit/f12262c21f0c98fec0647de0c3e76c0c55961d78)

commit 83d7998

 Show file tree

 Hide file tree

Showing
**5 changed files**
with
**135 additions**
and
**45 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* libyara

  + libyara/exec.c
    [exec.c](#diff-b9cb8d707e398c02610df83e6a9a6d6a2ed0a1e9b76108b8ef45916b000f2155)
  + include/yara

    - libyara/include/yara/re.h
      [re.h](#diff-d7f94bbdeb80e2b20bc09e007b18dde65c4e26440ce512fc384516330ea9a2cb)
  + libyara/re.c
    [re.c](#diff-6c957242fc63f630ecb0cee26df7883507dcd51b9f31c009f47b0c9f1f837727)
  + libyara/scan.c
    [scan.c](#diff-92dc7831899877868399600fbc070b657d1b71c5d806b07bf49931f7c09953b0)
* tests

  + tests/test-rules.c
    [test-rules.c](#diff-18a752fd9c912d4a79b9fceb659e3dd218a6d3dda56d8cf4a2aa0bcb08464052)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[libyara/exec.c](#diff-b9cb8d707e398c02610df83e6a9a6d6a2ed0a1e9b76108b8ef45916b000f2155 "libyara/exec.c")

Show comments

[View file](/VirusTotal/yara/blob/83d799804648c2a0895d40a19835d9b757c6fa4e/libyara/exec.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -850,6 +850,7 @@ int yr\_execute\_code( |
|  |  | (uint8\_t\*) r2.re->code, |
|  |  | (uint8\_t\*) r1.ss->c\_string, |
|  |  | r1.ss->length, |
|  |  | 0, |
|  |  | r2.re->flags | RE\_FLAGS\_SCAN, |
|  |  | NULL, |
|  |  | NULL) >= 0; |
| Expand Down | |  |

15 changes: 4 additions & 11 deletions

15
[libyara/include/yara/re.h](#diff-d7f94bbdeb80e2b20bc09e007b18dde65c4e26440ce512fc384516330ea9a2cb "libyara/include/yara/re.h")

Show comments

[View file](/VirusTotal/yara/blob/83d799804648c2a0895d40a19835d9b757c6fa4e/libyara/include/yara/re.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -94,7 +94,6 @@ SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. |
|  |  | #define RE\_FLAGS\_NO\_CASE 0x20 |
|  |  | #define RE\_FLAGS\_SCAN 0x40 |
|  |  | #define RE\_FLAGS\_DOT\_ALL 0x80 |
|  |  | #define RE\_FLAGS\_NOT\_AT\_START 0x100 |
|  |  | #define RE\_FLAGS\_GREEDY 0x400 |
|  |  | #define RE\_FLAGS\_UNGREEDY 0x800 |
|  |  |  |
| Expand All | | @@ -107,14 +106,6 @@ typedef struct RE\_ERROR RE\_ERROR; |
|  |  | typedef uint8\_t RE\_SPLIT\_ID\_TYPE; |
|  |  |  |
|  |  |  |
|  |  | #define CHAR\_IN\_CLASS(chr, cls) \ |
|  |  | ((cls)[(chr) / 8] & 1 << ((chr) % 8)) |
|  |  |  |
|  |  |  |
|  |  | #define IS\_WORD\_CHAR(chr) \ |
|  |  | (isalnum(chr) || (chr) == '\_') |
|  |  |  |
|  |  |  |
|  |  | struct RE\_NODE |
|  |  | { |
|  |  | int type; |
| Expand Down  Expand Up | | @@ -213,7 +204,8 @@ void yr\_re\_node\_destroy( |
|  |  | int yr\_re\_exec( |
|  |  | uint8\_t\* re\_code, |
|  |  | uint8\_t\* input, |
|  |  | size\_t input\_size, |
|  |  | size\_t input\_forwards\_size, |
|  |  | size\_t input\_backwards\_size, |
|  |  | int flags, |
|  |  | RE\_MATCH\_CALLBACK\_FUNC callback, |
|  |  | void\* callback\_args); |
| Expand All | | @@ -222,7 +214,8 @@ int yr\_re\_exec( |
|  |  | int yr\_re\_fast\_exec( |
|  |  | uint8\_t\* re\_code, |
|  |  | uint8\_t\* input, |
|  |  | size\_t input\_size, |
|  |  | size\_t input\_forwards\_size, |
|  |  | size\_t input\_backwards\_size, |
|  |  | int flags, |
|  |  | RE\_MATCH\_CALLBACK\_FUNC callback, |
|  |  | void\* callback\_args); |
| Expand Down | |  |

110 changes: 79 additions & 31 deletions

110
[libyara/re.c](#diff-6c957242fc63f630ecb0cee26df7883507dcd51b9f31c009f47b0c9f1f837727 "libyara/re.c")

Show comments

[View file](/VirusTotal/yara/blob/83d799804648c2a0895d40a19835d9b757c6fa4e/libyara/re.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -140,6 +140,24 @@ typedef struct \_RE\_THREAD\_STORAGE |
|  |  | YR\_THREAD\_STORAGE\_KEY thread\_storage\_key = 0; |
|  |  |  |
|  |  |  |
|  |  | #define CHAR\_IN\_CLASS(chr, cls) \ |
|  |  | ((cls)[(chr) / 8] & 1 << ((chr) % 8)) |
|  |  |  |
|  |  |  |
|  |  | int \_yr\_re\_is\_word\_char( |
|  |  | uint8\_t\* input, |
|  |  | int character\_size) |
|  |  | { |
|  |  | int result = ((isalnum(\*input) || (\*input) == '\_')); |
|  |  |  |
|  |  | if (character\_size == 2) |
|  |  | result = result && (\*(input + 1) == 0); |
|  |  |  |
|  |  | return result; |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  |  |
|  |  | // |
|  |  | // yr\_re\_initialize |
|  |  | // |
| Expand Down  Expand Up | | @@ -360,6 +378,7 @@ int yr\_re\_match( |
|  |  | re->code, |
|  |  | (uint8\_t\*) target, |
|  |  | strlen(target), |
|  |  | 0, |
|  |  | re->flags | RE\_FLAGS\_SCAN, |
|  |  | NULL, |
|  |  | NULL); |
| Expand Down  Expand Up | | @@ -1799,18 +1818,30 @@ int \_yr\_re\_fiber\_sync( |
|  |  | // |
|  |  | // yr\_re\_exec |
|  |  | // |
|  |  | // Executes a regular expression |
|  |  | // Executes a regular expression. The specified regular expression will try to |
|  |  | // match the data starting at the address specified by "input". The "input" |
|  |  | // pointer can point to any address inside a memory buffer. Arguments |
|  |  | // "input\_forwards\_size" and "input\_backwards\_size" indicate how many bytes |
|  |  | // can be accesible starting at "input" and going forwards and backwards |
|  |  | // respectively. |
|  |  | // |
|  |  | // <--- input\_backwards\_size -->|<----------- input\_forwards\_size --------> |
|  |  | // |-------- memory buffer -----------------------------------------------| |
|  |  | // ^ |
|  |  | // input |
|  |  | // |
|  |  | // Args: |
|  |  | // uint8\_t\* re\_code - Regexp code be executed |
|  |  | // uint8\_t\* input - Pointer to input data |
|  |  | // size\_t input\_size - Input data size |
|  |  | // size\_t input\_forwards\_size - Number of accessible bytes starting at |
|  |  | // "input" and going forwards. |
|  |  | // size\_t input\_backwards\_size - Number of accessible bytes starting at |
|  |  | // "input" and going backwards |
|  |  | // int flags - Flags: |
|  |  | // RE\_FLAGS\_SCAN |
|  |  | // RE\_FLAGS\_BACKWARDS |
|  |  | // RE\_FLAGS\_EXHAUSTIVE |
|  |  | // RE\_FLAGS\_WIDE |
|  |  | // RE\_FLAGS\_NOT\_AT\_START |
|  |  | // RE\_FLAGS\_NO\_CASE |
|  |  | // RE\_FLAGS\_DOT\_ALL |
|  |  | // RE\_MATCH\_CALLBACK\_FUNC callback - Callback function |
| Expand All | | @@ -1825,10 +1856,12 @@ int \_yr\_re\_fiber\_sync( |
|  |  | // -4 Too many fibers |
|  |  | // -5 Unknown fatal error |
|  |  |  |
|  |  |  |
|  |  | int yr\_re\_exec( |
|  |  | uint8\_t\* re\_code, |
|  |  | uint8\_t\* input\_data, |
|  |  | size\_t input\_size, |
|  |  | size\_t input\_forwards\_size, |
|  |  | size\_t input\_backwards\_size, |
|  |  | int flags, |
|  |  | RE\_MATCH\_CALLBACK\_FUNC callback, |
|  |  | void\* callback\_args) |
| Expand Down  Expand Up | | @@ -1858,18 +1891,23 @@ int yr\_re\_exec( |
|  |  | #define ACTION\_KILL 2 |
|  |  | #define ACTION\_KILL\_TAIL 3 |
|  |  |  |
|  |  | #define prolog if (bytes\_matched >= max\_bytes\_matched) \ |
|  |  | #define prolog { \ |
|  |  | if ((bytes\_matched >= max\_bytes\_matched) || \ |
|  |  | (character\_size == 2 && \*(input + 1) != 0)) \ |
|  |  | { \ |
|  |  | action = ACTION\_KILL; \ |
|  |  | break; \ |
|  |  | } |
|  |  | } \ |
|  |  | } |
|  |  |  |
|  |  | #define fail\_if\_error(e) switch (e) { \ |
|  |  | #define fail\_if\_error(e) { \ |
|  |  | switch (e) { \ |
|  |  | case ERROR\_INSUFFICIENT\_MEMORY: \ |
|  |  | return -2; \ |
|  |  | case ERROR\_TOO\_MANY\_RE\_FIBERS: \ |
|  |  | return -4; \ |
|  |  | } |
|  |  | } \ |
|  |  | } |
|  |  |  |
|  |  | if (\_yr\_re\_alloc\_storage(&storage) != ERROR\_SUCCESS) |
|  |  | return -2; |
| Expand All | | @@ -1884,14 +1922,17 @@ int yr\_re\_exec( |
|  |  |  |
|  |  | if (flags & RE\_FLAGS\_BACKWARDS) |
|  |  | { |
|  |  | max\_bytes\_matched = (int) yr\_min(input\_backwards\_size, RE\_SCAN\_LIMIT); |
|  |  | input -= character\_size; |
|  |  | input\_incr = -input\_incr; |
|  |  | } |
|  |  |  |
|  |  | max\_bytes\_matched = (int) yr\_min(input\_size, RE\_SCAN\_LIMIT); |
|  |  | else |
|  |  | { |
|  |  | max\_bytes\_matched = (int) yr\_min(input\_forwards\_size, RE\_SCAN\_LIMIT); |
|  |  | } |
|  |  |  |
|  |  | // Round down max\_bytes\_matched to a multiple of character\_size, this way if |
|  |  | // character\_size is 2 and input\_size is odd we are ignoring the |
|  |  | // character\_size is 2 and max\_bytes\_matched is odd we are ignoring the |
|  |  | // extra byte which can't match anyways. |
|  |  |  |
|  |  | max\_bytes\_matched = max\_bytes\_matched - max\_bytes\_matched % character\_size; |
| Expand Down  Expand Up | | @@ -1973,14 +2014,14 @@ int yr\_re\_exec( |
|  |  |  |
|  |  | case RE\_OPCODE\_WORD\_CHAR: |
|  |  | prolog; |
|  |  | match = IS\_WORD\_CHAR(\*input); |
|  |  | match = \_yr\_re\_is\_word\_char(input, character\_size); |
|  |  | action = match ? ACTION\_NONE : ACTION\_KILL; |
|  |  | fiber->ip += 1; |
|  |  | break; |
|  |  |  |
|  |  | case RE\_OPCODE\_NON\_WORD\_CHAR: |
|  |  | prolog; |
|  |  | match = !IS\_WORD\_CHAR(\*input); |
|  |  | match = !\_yr\_re\_is\_word\_char(input, character\_size); |
|  |  | action = match ? ACTION\_NONE : ACTION\_KILL; |
|  |  | fiber->ip += 1; |
|  |  | break; |
| Expand Down  Expand Up | | @@ -2028,16 +2069,25 @@ int yr\_re\_exec( |
|  |  | case RE\_OPCODE\_WORD\_BOUNDARY: |
|  |  | case RE\_OPCODE\_NON\_WORD\_BOUNDARY: |
|  |  |  |
|  |  | if (bytes\_matched == 0 && |
|  |  | !(flags & RE\_FLAGS\_NOT\_AT\_START) && |
|  |  | !(flags & RE\_FLAGS\_BACKWARDS)) |
|  |  | if (bytes\_matched == 0 && input\_backwards\_size < character\_size) |
|  |  | { |
|  |  | match = TRUE; |
|  |  | } |
|  |  | else if (bytes\_matched >= max\_bytes\_matched) |
|  |  | { |
|  |  | match = TRUE; |
|  |  | else if (IS\_WORD\_CHAR(\*(input - input\_incr)) != IS\_WORD\_CHAR(\*input)) |
|  |  | match = TRUE; |
|  |  | } |
|  |  | else |
|  |  | match = FALSE; |
|  |  | { |
|  |  | assert(input < input\_data + input\_forwards\_size); |
|  |  | assert(input >= input\_data - input\_backwards\_size); |
|  |  |  |
|  |  | assert(input - input\_incr < input\_data + input\_forwards\_size); |
|  |  | assert(input - input\_incr >= input\_data - input\_backwards\_size); |
|  |  |  |
|  |  | match = \_yr\_re\_is\_word\_char(input, character\_size) != \ |
|  |  | \_yr\_re\_is\_word\_char(input - input\_incr, character\_size); |
|  |  | } |
|  |  |  |
|  |  | if (\*ip == RE\_OPCODE\_NON\_WORD\_BOUNDARY) |
|  |  | match = !match; |
| Expand All | | @@ -2048,16 +2098,16 @@ int yr\_re\_exec( |
|  |  |  |
|  |  | case RE\_OPCODE\_MATCH\_AT\_START: |
|  |  | if (flags & RE\_FLAGS\_BACKWARDS) |
|  |  | kill = input\_size > (size\_t) bytes\_matched; |
|  |  | kill = input\_backwards\_size > (size\_t) bytes\_matched; |
|  |  | else |
|  |  | kill = (flags & RE\_FLAGS\_NOT\_AT\_START) || (bytes\_matched != 0); |
|  |  | kill = input\_backwards\_size > 0 || (bytes\_matched != 0); |
|  |  | action = kill ? ACTION\_KILL : ACTION\_CONTINUE; |
|  |  | fiber->ip += 1; |
|  |  | break; |
|  |  |  |
|  |  | case RE\_OPCODE\_MATCH\_AT\_END: |
|  |  | kill = flags & RE\_FLAGS\_BACKWARDS || |
|  |  | input\_size > (size\_t) bytes\_matched; |
|  |  | input\_forwards\_size > (size\_t) bytes\_matched; |
|  |  | action = kill ? ACTION\_KILL : ACTION\_CONTINUE; |
|  |  | fiber->ip += 1; |
|  |  | break; |
| Expand Down  Expand Up | | @@ -2134,13 +2184,6 @@ int yr\_re\_exec( |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | if (flags & RE\_FLAGS\_WIDE && |
|  |  | bytes\_matched < max\_bytes\_matched && |
|  |  | \*(input + 1) != 0) |
|  |  | { |
|  |  | \_yr\_re\_fiber\_kill\_all(&fibers, &storage->fiber\_pool); |
|  |  | } |
|  |  |  |
|  |  | input += input\_incr; |
|  |  | bytes\_matched += character\_size; |
|  |  |  |
| Expand All | | @@ -2164,7 +2207,8 @@ int yr\_re\_exec( |
|  |  | int yr\_re\_fast\_exec( |
|  |  | uint8\_t\* code, |
|  |  | uint8\_t\* input\_data, |
|  |  | size\_t input\_size, |
|  |  | size\_t input\_forwards\_size, |
|  |  | size\_t input\_backwards\_size, |
|  |  | int flags, |
|  |  | RE\_MATCH\_CALLBACK\_FUNC callback, |
|  |  | void\* callback\_args) |
| Expand All | | @@ -2187,7 +2231,11 @@ int yr\_re\_fast\_exec( |
|  |  | int input\_incr; |
|  |  | int sp = 0; |
|  |  | int bytes\_matched; |
|  |  | int max\_bytes\_matched = input\_size; |
|  |  | int max\_bytes\_matched; |
|  |  |  |
|  |  | max\_bytes\_matched = flags & RE\_FLAGS\_BACKWARDS ? |
|  |  | input\_backwards\_size : |
|  |  | input\_forwards\_size; |
|  |  |  |
|  |  | input\_incr = flags & RE\_FLAGS\_BACKWARDS ? -1 : 1; |
|  |  |  |
| Expand Down | |  |

10 changes: 7 additions & 3 deletions

10
[libyara/scan.c](#diff-92dc7831899877868399600fbc070b657d1b71c5d806b07bf49931f7c09953b0 "libyara/scan.c")

Show comments

[View file](/VirusTotal/yara/blob/83d799804648c2a0895d40a19835d9b757c6fa4e/libyara/scan.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -528,7 +528,8 @@ int \_yr\_scan\_match\_callback( |
|  |  | typedef int (\*RE\_EXEC\_FUNC)( |
|  |  | uint8\_t\* code, |
|  |  | uint8\_t\* input, |
|  |  | size\_t input\_size, |
|  |  | size\_t input\_forwards\_size, |
|  |  | size\_t input\_backwards\_size, |
|  |  | int flags, |
|  |  | RE\_MATCH\_CALLBACK\_FUNC callback, |
|  |  | void\* callback\_args); |
| Expand Down  Expand Up | | @@ -569,7 +570,8 @@ int \_yr\_scan\_verify\_re\_match( |
|  |  | ac\_match->forward\_code, |
|  |  | data + offset, |
|  |  | data\_size - offset, |
|  |  | offset > 0 ? flags | RE\_FLAGS\_NOT\_AT\_START : flags, |
|  |  | offset, |
|  |  | flags, |
|  |  | NULL, |
|  |  | NULL); |
|  |  | } |
| Expand All | | @@ -581,7 +583,8 @@ int \_yr\_scan\_verify\_re\_match( |
|  |  | ac\_match->forward\_code, |
|  |  | data + offset, |
|  |  | data\_size - offset, |
|  |  | offset > 0 ? flags | RE\_FLAGS\_NOT\_AT\_START : flags, |
|  |  | offset, |
|  |  | flags, |
|  |  | NULL, |
|  |  | NULL); |
|  |  | } |
| Expand Down  Expand Up | | @@ -616,6 +619,7 @@ int \_yr\_scan\_verify\_re\_match( |
|  |  | backward\_matches = exec( |
|  |  | ac\_match->backward\_code, |
|  |  | data + offset, |
|  |  | data\_size - offset, |
|  |  | offset, |
|  |  | flags | RE\_FLAGS\_BACKWARDS | RE\_FLAGS\_EXHAUSTIVE, |
|  |  | \_yr\_scan\_match\_callback, |
| Expand Down | |  |

44 changes: 44 additions & 0 deletions

44
[tests/test-rules.c](#diff-18a752fd9c912d4a79b9fceb659e3dd218a6d3dda56d8cf4a2aa0bcb08464052 "tests/test-rules.c")

Show comments

[View file](/VirusTotal/yara/blob/83d799804648c2a0895d40a19835d9b757c6fa4e/tests/test-rules.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -901,6 +901,50 @@ void test\_re() |
|  |  | "rule test { strings: $a = /a.{1,2}b/ wide condition: !a == 8 }", |
|  |  | "a\0x\0x\0b\0"); |
|  |  |  |
|  |  | assert\_true\_rule\_blob( |
|  |  | "rule test { strings: $a = /\\babc/ wide condition: $a }", |
|  |  | "a\0b\0c\0"); |
|  |  |  |
|  |  | assert\_true\_rule\_blob( |
|  |  | "rule test { strings: $a = /\\babc/ wide condition: $a }", |
|  |  | "\0a\0b\0c\0"); |
|  |  |  |
|  |  | assert\_true\_rule\_blob( |
|  |  | "rule test { strings: $a = /\\babc/ wide condition: $a }", |
|  |  | "\ta\0b\0c\0"); |
|  |  |  |
|  |  | assert\_false\_rule\_blob( |
|  |  | "rule test { strings: $a = /\\babc/ wide condition: $a }", |
|  |  | "x\0a\0b\0c\0"); |
|  |  |  |
|  |  | assert\_true\_rule\_blob( |
|  |  | "rule test { strings: $a = /\\babc/ wide condition: $a }", |
|  |  | "x\ta\0b\0c\0"); |
|  |  |  |
|  |  | assert\_true\_rule\_blob( |
|  |  | "rule test { strings: $a = /abc\\b/ wide condition: $a }", |
|  |  | "a\0b\0c\0"); |
|  |  |  |
|  |  | assert\_true\_rule\_blob( |
|  |  | "rule test { strings: $a = /abc\\b/ wide condition: $a }", |
|  |  | "a\0b\0c\0\0"); |
|  |  |  |
|  |  | assert\_true\_rule\_blob( |
|  |  | "rule test { strings: $a = /abc\\b/ wide condition: $a }", |
|  |  | "a\0b\0c\0\t"); |
|  |  |  |
|  |  | assert\_false\_rule\_blob( |
|  |  | "rule test { strings: $a = /abc\\b/ wide condition: $a }", |
|  |  | "a\0b\0c\0x\0"); |
|  |  |  |
|  |  | assert\_true\_rule\_blob( |
|  |  | "rule test { strings: $a = /abc\\b/ wide condition: $a }", |
|  |  | "a\0b\0c\0b\t"); |
|  |  |  |
|  |  | assert\_false\_rule\_blob( |
|  |  | "rule test { strings: $a = /\\b/ wide condition: $a }", |
|  |  | "abc"); |
|  |  |  |
|  |  | assert\_regexp\_syntax\_error(")"); |
|  |  | assert\_true\_regexp("abc", "abc", "abc"); |
|  |  | assert\_false\_regexp("abc", "xbc"); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `83d7998`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FVirusTotal%2Fyara%2Fcommit%2F83d799804648c2a0895d40a19835d9b757c6fa4e) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_d0c4f8a0_20250125_060329.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FVirusTotal%2Fyara%2Fissues%2F646)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FVirusTotal%2Fyara%2Fissues%2F646)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=VirusTotal%2Fyara)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[VirusTotal](/VirusTotal)
/
**[yara](/VirusTotal/yara)**
Public

* [Notifications](/login?return_to=%2FVirusTotal%2Fyara) You must be signed in to change notification settings
* [Fork
  1.5k](/login?return_to=%2FVirusTotal%2Fyara)
* [Star
   8.5k](/login?return_to=%2FVirusTotal%2Fyara)

* [Code](/VirusTotal/yara)
* [Issues
  152](/VirusTotal/yara/issues)
* [Pull requests
  23](/VirusTotal/yara/pulls)
* [Discussions](/VirusTotal/yara/discussions)
* [Actions](/VirusTotal/yara/actions)
* [Projects
  0](/VirusTotal/yara/projects)
* [Wiki](/VirusTotal/yara/wiki)
* [Security](/VirusTotal/yara/security)
* [Insights](/VirusTotal/yara/pulse)

Additional navigation options

* [Code](/VirusTotal/yara)
* [Issues](/VirusTotal/yara/issues)
* [Pull requests](/VirusTotal/yara/pulls)
* [Discussions](/VirusTotal/yara/discussions)
* [Actions](/VirusTotal/yara/actions)
* [Projects](/VirusTotal/yara/projects)
* [Wiki](/VirusTotal/yara/wiki)
* [Security](/VirusTotal/yara/security)
* [Insights](/VirusTotal/yara/pulse)

# Out of bounds read in yr\_re\_exec() #646

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[Out of bounds read in yr\_re\_exec()](#top)#646Copy link[![@fumfel](https://avatars.githubusercontent.com/u/5985287?v=4&size=80)](/fumfel)
## Description

[![@fumfel](https://avatars.githubusercontent.com/u/5985287?v=4&size=48)](/fumfel)[fumfel](https://github.com/fumfel)opened [on Apr 26, 2017](https://github.com/VirusTotal/yara/issues/646#issue-224348157)

**Out of bounds read in yr\_re\_exec()**

Git HEAD: [dac4595](https://github.com/VirusTotal/yara/commit/dac45955053e3650f9407e4bc50482bf025fb15e)

[Payload](https://github.com/VirusTotal/yara/files/957305/yara_oobr_yr_re_exec.txt)

Command: `yara yara_oobr_yr_re_exec strings`

ASAN:

```
==2886==ERROR: AddressSanitizer: SEGV on unknown address 0x7fd0b5d63fff (pc 0x00000051eb38 bp 0x7ffc623d3ad0 sp 0x7ffc623d3900 T0)
==2886==The signal is caused by a READ memory access.
    #0 0x51eb37 in yr_re_exec XYZ/yara/libyara/re.c:2037:20
    #1 0x53da37 in _yr_scan_verify_re_match XYZ/yara/libyara/scan.c:580:23
    #2 0x53ed63 in yr_scan_verify_match XYZ/yara/libyara/scan.c:762:5
    #3 0x53678f in _yr_rules_scan_mem_block XYZ/yara/libyara/rules.c:276:9
    #4 0x538242 in yr_rules_scan_mem_blocks XYZ/yara/libyara/rules.c:452:5
    #5 0x53909b in yr_rules_scan_mem XYZ/yara/libyara/rules.c:586:10
    #6 0x53909b in yr_rules_scan_file XYZ/yara/libyara/rules.c:610
    #7 0x4f9143 in main XYZ/yara/yara.c:1229:14
    #8 0x7fd0b499d82f in __libc_start_main /build/glibc-9tT8Do/glibc-2.23/csu/../csu/libc-start.c:291
    #9 0x41a858 in _start (XYZ/yara/yara+0x41a858)

AddressSanitizer can not provide additional info.
SUMMARY: AddressSanitizer: SEGV XYZ/yara/libyara/re.c:2037:20 in yr_re_exec
==2886==ABORTING

```
## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


