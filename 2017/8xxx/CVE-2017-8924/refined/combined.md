=== Content from github.com_bf1bafde_20250125_005902.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F654b404f2a222f918af9b0cd18ad469d0c941a8e)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F654b404f2a222f918af9b0cd18ad469d0c941a8e)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.9k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  437](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/654b404f2a222f918af9b0cd18ad469d0c941a8e)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

USB: serial: io\_ti: fix information leak in completion handler

[Browse files](/torvalds/linux/tree/654b404f2a222f918af9b0cd18ad469d0c941a8e)
Browse the repository at this point in the history

```
Add missing sanity check to the bulk-in completion handler to avoid an
integer underflow that can be triggered by a malicious device.

This avoids leaking 128 kB of memory content from after the URB transfer
buffer to user space.

Fixes: [8c209e6](https://github.com/torvalds/linux/commit/8c209e6782ca0e3046803fc04a5ac01c8c10437a) ("USB: make actual_length in struct urb field u32")
Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
Cc: stable <stable@vger.kernel.org>	# 2.6.30
Signed-off-by: Johan Hovold <johan@kernel.org>
```

* Loading branch information

[![@jhovold](https://avatars.githubusercontent.com/u/601896?s=40&v=4)](/jhovold)

[jhovold](/torvalds/linux/commits?author=jhovold "View all commits by jhovold")
committed
Mar 8, 2017

1 parent
[367ec17](/torvalds/linux/commit/367ec1706745912702c187722065285cd4d2aee7)

commit 654b404

Showing
**1 changed file**
with
**1 addition**
and
**1 deletion**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[drivers/usb/serial/io\_ti.c](#diff-b920568c8fc0dccfaa3fb5c61543013b5ea98f2c730264b92586d76488a9794c "drivers/usb/serial/io_ti.c")

Show comments

[View file](/torvalds/linux/blob/654b404f2a222f918af9b0cd18ad469d0c941a8e/drivers/usb/serial/io_ti.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1761,7 +1761,7 @@ static void edge\_bulk\_in\_callback(struct urb \*urb) |
|  |  |  |
|  |  | port\_number = edge\_port->port->port\_number; |
|  |  |  |
|  |  | if (edge\_port->lsr\_event) { |
|  |  | if (urb->actual\_length > 0 && edge\_port->lsr\_event) { |
|  |  | edge\_port->lsr\_event = 0; |
|  |  | dev\_dbg(dev, "%s ===== Port %u LSR Status = %02x, Data = %02x ======\n", |
|  |  | \_\_func\_\_, port\_number, edge\_port->lsr\_mask, \*data); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `654b404`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F654b404f2a222f918af9b0cd18ad469d0c941a8e) to comment.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from git.kernel.org_8a01b63a_20250125_005855.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=654b404f2a222f918af9b0cd18ad469d0c941a8e)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=654b404f2a222f918af9b0cd18ad469d0c941a8e)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=654b404f2a222f918af9b0cd18ad469d0c941a8e)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=654b404f2a222f918af9b0cd18ad469d0c941a8e)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johan Hovold <johan@kernel.org> | 2017-03-06 17:36:40 +0100 |
| --- | --- | --- |
| committer | Johan Hovold <johan@kernel.org> | 2017-03-08 16:14:39 +0100 |
| commit | [654b404f2a222f918af9b0cd18ad469d0c941a8e](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=654b404f2a222f918af9b0cd18ad469d0c941a8e) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=654b404f2a222f918af9b0cd18ad469d0c941a8e)) | |
| tree | [b7e70ce55058ed9d8e8581e152457e3a42b22b5b](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=654b404f2a222f918af9b0cd18ad469d0c941a8e) | |
| parent | [367ec1706745912702c187722065285cd4d2aee7](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=367ec1706745912702c187722065285cd4d2aee7) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=654b404f2a222f918af9b0cd18ad469d0c941a8e&id2=367ec1706745912702c187722065285cd4d2aee7)) | |
| download | [linux-654b404f2a222f918af9b0cd18ad469d0c941a8e.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-654b404f2a222f918af9b0cd18ad469d0c941a8e.tar.gz) | |

USB: serial: io\_ti: fix information leak in completion handlerAdd missing sanity check to the bulk-in completion handler to avoid an
integer underflow that can be triggered by a malicious device.
This avoids leaking 128 kB of memory content from after the URB transfer
buffer to user space.
Fixes: 8c209e6782ca ("USB: make actual\_length in struct urb field u32")
Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
Cc: stable <stable@vger.kernel.org> # 2.6.30
Signed-off-by: Johan Hovold <johan@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=654b404f2a222f918af9b0cd18ad469d0c941a8e)

| -rw-r--r-- | [drivers/usb/serial/io\_ti.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/drivers/usb/serial/io_ti.c?id=654b404f2a222f918af9b0cd18ad469d0c941a8e) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/usb/serial/io\_ti.c b/drivers/usb/serial/io\_ti.cindex 4561dd4cde8b87..a76b95d3215787 100644--- a/[drivers/usb/serial/io\_ti.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/usb/serial/io_ti.c?id=367ec1706745912702c187722065285cd4d2aee7)+++ b/[drivers/usb/serial/io\_ti.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/usb/serial/io_ti.c?id=654b404f2a222f918af9b0cd18ad469d0c941a8e)@@ -1761,7 +1761,7 @@ static void edge\_bulk\_in\_callback(struct urb \*urb)  port\_number = edge\_port->port->port\_number; - if (edge\_port->lsr\_event) {+ if (urb->actual\_length > 0 && edge\_port->lsr\_event) { edge\_port->lsr\_event = 0; dev\_dbg(dev, "%s ===== Port %u LSR Status = %02x, Data = %02x ======\n", \_\_func\_\_, port\_number, edge\_port->lsr\_mask, \*data); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-25 00:57:33 +0000



=== Content from www.debian.org_53c632c0_20250125_005901.html ===


---

[[Date Prev](msg00147.html)][[Date Next](msg00149.html)]
[[Thread Prev](msg00147.html)][[Thread Next](msg00149.html)]
[[Date Index](maillist.html#00148)]
[[Thread Index](threads.html#00148)]

# [SECURITY] [DSA 3886-1] linux security update

---

* *To*: debian-security-announce@lists.debian.org
* *Subject*: [SECURITY] [DSA 3886-1] linux security update
* *From*: Salvatore Bonaccorso <carnil@debian.org>
* *Date*: Mon, 19 Jun 2017 15:49:09 +0000
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/E1dMyvN-0007fb-Ls%40master.debian.org)Â [E1dMyvN-0007fb-Ls@master.debian.org](msg00148.html)>
* *Reply-to*: debian-security-announce-request@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian Security Advisory DSA-3886-1                   security@debian.org
<https://www.debian.org/security/>                     Salvatore Bonaccorso
June 19, 2017                         <https://www.debian.org/security/faq>
- -------------------------------------------------------------------------

Package        : linux
CVE ID         : CVE-2017-0605 CVE-2017-7487 CVE-2017-7645 CVE-2017-7895
                 CVE-2017-8064 CVE-2017-8890 CVE-2017-8924 CVE-2017-8925
                 CVE-2017-9074 CVE-2017-9075 CVE-2017-9076 CVE-2017-9077
                 CVE-2017-9242 CVE-2017-1000364

Several vulnerabilities have been discovered in the Linux kernel that
may lead to a privilege escalation, denial of service or information
leaks.

CVE-2017-0605

    A buffer overflow flaw was discovered in the trace subsystem.

CVE-2017-7487

    Li Qiang reported a reference counter leak in the ipxitf_ioctl
    function which may result into a use-after-free vulnerability,
    triggerable when a IPX interface is configured.

CVE-2017-7645

    Tuomas Haanpaa and Matti Kamunen from Synopsys Ltd discovered that
    the NFSv2 and NFSv3 server implementations are vulnerable to an
    out-of-bounds memory access issue while processing arbitrarily long
    arguments sent by NFSv2/NFSv3 PRC clients, leading to a denial of
    service.

CVE-2017-7895

    Ari Kauppi from Synopsys Ltd discovered that the NFSv2 and NFSv3
    server implementations do not properly handle payload bounds
    checking of WRITE requests. A remote attacker with write access to a
    NFS mount can take advantage of this flaw to read chunks of
    arbitrary memory from both kernel-space and user-space.

CVE-2017-8064

    Arnd Bergmann found that the DVB-USB core misused the device
    logging system, resulting in a use-after-free vulnerability, with
    unknown security impact.

CVE-2017-8890

    It was discovered that the net_csk_clone_lock() function allows a
    remote attacker to cause a double free leading to a denial of
    service or potentially have other impact.

CVE-2017-8924

    Johan Hovold found that the io_ti USB serial driver could leak
    sensitive information if a malicious USB device was connected.

CVE-2017-8925

    Johan Hovold found a reference counter leak in the omninet USB
    serial driver, resulting in a use-after-free vulnerability.  This
    can be triggered by a local user permitted to open tty devices.

CVE-2017-9074

    Andrey Konovalov reported that the IPv6 fragmentation
    implementation could read beyond the end of a packet buffer.  A
    local user or guest VM might be able to use this to leak sensitive
    information or to cause a denial of service (crash).

CVE-2017-9075

    Andrey Konovalov reported that the SCTP/IPv6 implementation
    wrongly initialised address lists on connected sockets, resulting
    in a use-after-free vulnerability, a similar issue to
    CVE-2017-8890.  This can be triggered by any local user.

CVE-2017-9076 / CVE-2017-9077

    Cong Wang found that the TCP/IPv6 and DCCP/IPv6 implementations
    wrongly initialised address lists on connected sockets, a similar
    issue to CVE-2017-9075.

CVE-2017-9242

    Andrey Konovalov reported a packet buffer overrun in the IPv6
    implementation.  A local user could use this for denial of service
    (memory corruption; crash) and possibly for privilege escalation.

CVE-2017-1000364

    The Qualys Research Labs discovered that the size of the stack guard
    page is not sufficiently large. The stack-pointer can jump over the
    guard-page and moving from the stack into another memory region
    without accessing the guard-page. In this case no page-fault
    exception is raised and the stack extends into the other memory
    region. An attacker can exploit this flaw for privilege escalation.

    The default stack gap protection is set to 256 pages and can be
    configured via the stack_guard_gap kernel parameter on the kernel
    command line.

    Further details can be found at
    <https://www.qualys.com/2017/06/19/stack-clash/stack-clash.txt>

For the oldstable distribution (jessie), these problems have been fixed
in version 3.16.43-2+deb8u1.

For the stable distribution (stretch), these problems have been fixed in
version 4.9.30-2+deb9u1 or earlier versions before the stretch release.

We recommend that you upgrade your linux packages.

Further information about Debian Security Advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://www.debian.org/security/>

Mailing list: debian-security-announce@lists.debian.org
-----BEGIN PGP SIGNATURE-----

iQKTBAEBCgB9FiEERkRAmAjBceBVMd3uBUy48xNDz0QFAllH7wxfFIAAAAAALgAo
aXNzdWVyLWZwckBub3RhdGlvbnMub3BlbnBncC5maWZ0aGhvcnNlbWFuLm5ldDQ2
NDQ0MDk4MDhDMTcxRTA1NTMxRERFRTA1NENCOEYzMTM0M0NGNDQACgkQBUy48xND
z0R38w/+MgLDpftRSRxAsR0QMJwt89Kmp8aw4X8NnUF2epaR0gSERD45BB9iB8Em
0QsP0hPqJZwmTDelo54EOKuJjcXEtAgHBLBAJj7AvGIJz1MKiJcsUQJItVUr6itA
KjJtab8IFYkXxg3aL3UiSed0+eWO+ODNuFk251/dvdYLv/IRGXfep24978ktM1mj
Gykywmvr9eOaSlRfr/cHYuO6v0No5wL8OGiPM+abl9i8lN/dXxllEEQEUm+me6O6
pnrBk0bGOh3fQS/lqhiv4q/T3V5ux56jgj/iu4L3YF3Neui/oc1Ip8wTPGhj/JuJ
4rwjoHSXRSLtHHModfL3O92Atu5n74ZjpbCpZnu/BMxwcqq8NxrOpht1dbB77auM
vkVtcKY7/fmlwgkbK2KQGmLmzcSxXN9GymR26DAVZbetWyLDoxkIrPJeamWK2I+T
A+cDBnx2QEzXazi7H73CqLREp11AndWRIqnHs1urVfa6Q3RUQG7zwg7MCEMP0vhv
qFsXLW3B6kNQPa9ptM+Y/cNHz4+5GfEI5eeoEQ4pw+4uopxRhCJwQ0/SiaSXG1vZ
2Pj9U0qOo7iDLCAKDWFDdCze4msPyOBoNKcxkbTz+EB5RQy3amXbexavjmXcWZ/4
GfRnMkwwFVlIN1rF9Vu/ehhi8iYDilL8+3gVgX2QyKlHYbS30dg=
=cr+H
-----END PGP SIGNATURE-----

```

---



=== Content from www.kernel.org_6a068226_20250125_005902.html ===
commit 8ea22fb3114dbba2c1f86148cb199ca939304113
Author: Greg Kroah-Hartman
Date: Sat Mar 18 19:19:00 2017 +0800
Linux 4.10.4
commit 42b16fffb79bb925f579d2b4e1835835088682f8
Author: Kamal Heib
Date: Wed Jan 18 14:10:32 2017 +0200
IB/mlx5: Verify that Q counters are supported
commit 45bded2c216da6010184ac5ebe88c27f73439009 upstream.
Make sure that the Q counters are supported by the FW before trying
to allocate/deallocte them, this will avoid driver load failure when
they aren't supported by the FW.
Fixes: 0837e86a7a34 ('IB/mlx5: Add per port counters')
Signed-off-by: Kamal Heib
Reviewed-by: Mark Bloch
Signed-off-by: Leon Romanovsky
Signed-off-by: Doug Ledford
Signed-off-by: Greg Kroah-Hartman
commit dc37bb8db47b16395dfa05b59ee2e6fb9cbd6d07
Author: Theodore Ts'o
Date: Tue Feb 14 11:31:15 2017 -0500
ext4: don't BUG when truncating encrypted inodes on the orphan list
commit 0d06863f903ac5f4f6efb0273079d27de3e53a28 upstream.
Fix a BUG when the kernel tries to mount a file system constructed as
follows:
echo foo > foo.txt
mke2fs -Fq -t ext4 -O encrypt foo.img 100
debugfs -w foo.img << EOF
write foo.txt a
set\_inode\_field a i\_flags 0x80800
set\_super\_value s\_last\_orphan 12
quit
EOF
root@kvm-xfstests:~# mount -o loop foo.img /mnt
[ 160.238770] ------------[ cut here ]------------
[ 160.240106] kernel BUG at /usr/projects/linux/ext4/fs/ext4/inode.c:3874!
[ 160.240106] invalid opcode: 0000 [#1] SMP
[ 160.240106] Modules linked in:
[ 160.240106] CPU: 0 PID: 2547 Comm: mount Tainted: G W 4.10.0-rc3-00034-gcdd33b941b67 #227
[ 160.240106] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.10.1-1 04/01/2014
[ 160.240106] task: f4518000 task.stack: f47b6000
[ 160.240106] EIP: ext4\_block\_zero\_page\_range+0x1a7/0x2b4
[ 160.240106] EFLAGS: 00010246 CPU: 0
[ 160.240106] EAX: 00000001 EBX: f7be4b50 ECX: f47b7dc0 EDX: 00000007
[ 160.240106] ESI: f43b05a8 EDI: f43babec EBP: f47b7dd0 ESP: f47b7dac
[ 160.240106] DS: 007b ES: 007b FS: 00d8 GS: 0033 SS: 0068
[ 160.240106] CR0: 80050033 CR2: bfd85b08 CR3: 34a00680 CR4: 000006f0
[ 160.240106] Call Trace:
[ 160.240106] ext4\_truncate+0x1e9/0x3e5
[ 160.240106] ext4\_fill\_super+0x286f/0x2b1e
[ 160.240106] ? set\_blocksize+0x2e/0x7e
[ 160.240106] mount\_bdev+0x114/0x15f
[ 160.240106] ext4\_mount+0x15/0x17
[ 160.240106] ? ext4\_calculate\_overhead+0x39d/0x39d
[ 160.240106] mount\_fs+0x58/0x115
[ 160.240106] vfs\_kern\_mount+0x4b/0xae
[ 160.240106] do\_mount+0x671/0x8c3
[ 160.240106] ? \_copy\_from\_user+0x70/0x83
[ 160.240106] ? strndup\_user+0x31/0x46
[ 160.240106] SyS\_mount+0x57/0x7b
[ 160.240106] do\_int80\_syscall\_32+0x4f/0x61
[ 160.240106] entry\_INT80\_32+0x2f/0x2f
[ 160.240106] EIP: 0xb76b919e
[ 160.240106] EFLAGS: 00000246 CPU: 0
[ 160.240106] EAX: ffffffda EBX: 08053838 ECX: 08052188 EDX: 080537e8
[ 160.240106] ESI: c0ed0000 EDI: 00000000 EBP: 080537e8 ESP: bfa13660
[ 160.240106] DS: 007b ES: 007b FS: 0000 GS: 0033 SS: 007b
[ 160.240106] Code: 59 8b 00 a8 01 0f 84 09 01 00 00 8b 07 66 25 00 f0 66 3d 00 80 75 61 89 f8 e8 3e e2 ff ff 84 c0 74 56 83 bf 48 02 00 00 00 75 02 <0f> 0b 81 7d e8 00 10 00 00 74 02 0f 0b 8b 43 04 8b 53 08 31 c9
[ 160.240106] EIP: ext4\_block\_zero\_page\_range+0x1a7/0x2b4 SS:ESP: 0068:f47b7dac
[ 160.317241] ---[ end trace d6a773a375c810a5 ]---
The problem is that when the kernel tries to truncate an inode in
ext4\_truncate(), it tries to clear any on-disk data beyond i\_size.
Without the encryption key, it can't do that, and so it triggers a
BUG.
E2fsck does \*not\* provide this service, and in practice most file
systems have their orphan list processed by e2fsck, so to avoid
crashing, this patch skips this step if we don't have access to the
encryption key (which is the case when processing the orphan list; in
all other cases, we will have the encryption key, or the kernel
wouldn't have allowed the file to be opened).
An open question is whether the fact that e2fsck isn't clearing the
bytes beyond i\_size causing problems --- and if we've lived with it
not doing it for so long, can we drop this from the kernel replay of
the orphan list in all cases (not just when we don't have the key for
encrypted inodes).
Addresses-Google-Bug: #35209576
Signed-off-by: Theodore Ts'o
Signed-off-by: Eric Biggers
Signed-off-by: Greg Kroah-Hartman
commit 1cda29082a3012a09020c77db2d56b7b25dbc18e
Author: Sean Young
Date: Wed Feb 22 18:48:01 2017 -0300
rc: raw decoder for keymap protocol is not loaded on register
commit 413808685dd7c9b54bbc5af79da2eaddd0fc3cb2 upstream.
When the protocol is set via the sysfs protocols attribute, the
decoder is loaded. However, when it is not when a device is first
plugged in or registered.
Fixes: acc1c3c ("[media] media: rc: load decoder modules on-demand")
Signed-off-by: Sean Young
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 22fc2f9efa27f5b70cc2d40036adda681ce645b5
Author: Mikulas Patocka
Date: Wed Feb 15 11:26:10 2017 -0500
dm: flush queued bios when process blocks to avoid deadlock
commit d67a5f4b5947aba4bfe9a80a2b86079c215ca755 upstream.
Commit df2cb6daa4 ("block: Avoid deadlocks with bio allocation by
stacking drivers") created a workqueue for every bio set and code
in bio\_alloc\_bioset() that tries to resolve some low-memory deadlocks
by redirecting bios queued on current->bio\_list to the workqueue if the
system is low on memory. However other deadlocks (see below \*\*) may
happen, without any low memory condition, because generic\_make\_request
is queuing bios to current->bio\_list (rather than submitting them).
\*\* the related dm-snapshot deadlock is detailed here:
https://www.redhat.com/archives/dm-devel/2016-July/msg00065.html
Fix this deadlock by redirecting any bios on current->bio\_list to the
bio\_set's rescue workqueue on every schedule() call. Consequently,
when the process blocks on a mutex, the bios queued on
current->bio\_list are dispatched to independent workqueus and they can
complete without waiting for the mutex to be available.
The structure blk\_plug contains an entry cb\_list and this list can contain
arbitrary callback functions that are called when the process blocks.
To implement this fix DM (ab)uses the onstack plug's cb\_list interface
to get its flush\_current\_bio\_list() called at schedule() time.
This fixes the snapshot deadlock - if the map method blocks,
flush\_current\_bio\_list() will be called and it redirects bios waiting
on current->bio\_list to appropriate workqueues.
Fixes: https://bugzilla.redhat.com/show\_bug.cgi?id=1267650
Depends-on: df2cb6daa4 ("block: Avoid deadlocks with bio allocation by stacking drivers")
Signed-off-by: Mikulas Patocka
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit 2030aedc540441d3272eec140b2c5d629e67804d
Author: Sean Young
Date: Sat Feb 25 08:28:16 2017 -0300
serial\_ir: ensure we're ready to receive interrupts
commit 0265634eb9e04a16ae99941c320718c38eb865e0 upstream.
When the interrupt requested with devm\_request\_irq(), serial\_ir.rcdev
is still null so will cause null deference if the irq handler is called
early on.
Also ensure that timeout\_timer is setup.
Link: http://lkml.kernel.org/r/CA+55aFxsh2uF8gi5sN\_guY3Z+tiLv7LpJYKBw+y8vqLzp+TsnQ@mail.gmail.com
[mchehab@s-opensource.com: moved serial\_ir\_probe() back to its original place]
Signed-off-by: Sean Young
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 81383a00ce830d9134c82fd247625956f8d9032c
Author: Takashi Iwai
Date: Mon Feb 20 14:58:25 2017 +0100
drm/i915/gvt: Fix superfluous newline in GVT\_DISPLAY\_READY env var
commit d8e9b2b9097c117880dc22933239d05199c60b96 upstream.
send\_display\_send\_uevent() sends two environment variable, and the
first one GVT\_DISPLAY\_READY is set including a new line at the end of
the string; that is obviously superfluous and wrong -- at least, it
\*looks\* so when you only read the code.
However, it doesn't appear in the actual output by a (supposedly
unexpected) trick. The code uses snprintf() and truncates the string
in size 20 bytes. This makes the string as GVT\_DISPLAY\_READY=0 or
...=1 including the trailing NUL-letter. That is, the '\n' found in
the format string is always cut off as a result.
Although the code gives the correct result, it is confusing. This
patch addresses it, just removing the superfluous '\n' from the format
string for avoiding further confusion. If the argument "ready" were
not a bool, the size 20 should be corrected as well. But it's a
bool, so we can leave the magic number 20 as is for now.
FWIW, the bug was spotted by a new GCC7 warning:
drivers/gpu/drm/i915/gvt/handlers.c: In function 'pvinfo\_mmio\_write':
drivers/gpu/drm/i915/gvt/handlers.c:1042:34: error: 'snprintf' output truncated before the last format character [-Werror=format-truncation=]
snprintf(display\_ready\_str, 20, "GVT\_DISPLAY\_READY=%d\n", ready);
^~~~~~~~~~~~~~~~~~~~~~~~
drivers/gpu/drm/i915/gvt/handlers.c:1042:2: note: 'snprintf' output 21 bytes into a destination of size 20
snprintf(display\_ready\_str, 20, "GVT\_DISPLAY\_READY=%d\n", ready);
^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Fixes: 04d348ae3f0a ("drm/i915/gvt: vGPU display virtualization")
Bugzilla: https://bugzilla.suse.com/show\_bug.cgi?id=1025903
Reported-by: Richard Biener
Signed-off-by: Takashi Iwai
Signed-off-by: Zhenyu Wang
Signed-off-by: Greg Kroah-Hartman
commit 523379cd6b655118f5823fdbc11064bd5e88b908
Author: Jintack Lim
Date: Mon Mar 6 05:42:37 2017 -0800
KVM: arm/arm64: Let vcpu thread modify its own active state
commit 370a0ec1819990f8e2a93df7cc9c0146980ed45f upstream.
Currently, if a vcpu thread tries to change the active state of an
interrupt which is already on the same vcpu's AP list, it will loop
forever. Since the VGIC mmio handler is called after a vcpu has
already synced back the LR state to the struct vgic\_irq, we can just
let it proceed safely.
Reviewed-by: Marc Zyngier
Signed-off-by: Jintack Lim
Signed-off-by: Christoffer Dall
Signed-off-by: Marc Zyngier
Signed-off-by: Greg Kroah-Hartman
commit 1f9175b9ee7ca23995e377a05c3d93ac9457ab9c
Author: Janosch Frank
Date: Thu Mar 2 15:23:42 2017 +0100
KVM: s390: Fix guest migration for huge guests resulting in panic
commit 2e4d88009f57057df7672fa69a32b5224af54d37 upstream.
While we can technically not run huge page guests right now, we can
setup a guest with huge pages. Trying to migrate it will trigger a
VM\_BUG\_ON and, if the kernel is not configured to panic on a BUG, it
will happily try to work on non-existing page table entries.
With this patch, we always return "dirty" if we encounter a large page
when migrating. This at least fixes the immediate problem until we
have proper handling for both kind of pages.
Fixes: 15f36eb ("KVM: s390: Add proper dirty bitmap support to S390 kvm.")
Signed-off-by: Janosch Frank
Acked-by: Christian Borntraeger
Signed-off-by: Martin Schwidefsky
Signed-off-by: Greg Kroah-Hartman
commit 45dc259a4734ac166581ecbc3a0407a866cac92e
Author: Krzysztof Kozlowski
Date: Sat Feb 25 18:36:44 2017 +0200
serial: samsung: Continue to work if DMA request fails
commit f98c7bce570bdbe344b74ff5daa7dfeef3f22929 upstream.
If DMA is not available (even when configured in DeviceTree), the driver
will fail the startup procedure thus making serial console not
available.
For example this causes boot failure on QEMU ARMv7 (Exynos4210, SMDKC210):
[ Â  Â 1.302575] OF: amba\_device\_add() failed (-19) for /amba/pdma@12680000
...
[ Â  11.435732] samsung-uart 13800000.serial: DMA request failed
[ Â  72.963893] samsung-uart 13800000.serial: DMA request failed
[ Â  73.143361] Kernel panic - not syncing: Attempted to kill init! exitcode=0x00000000
DMA is not necessary for serial to work, so continue with UART startup
after emitting a warning.
Fixes: 62c37eedb74c ("serial: samsung: add dma reqest/release functions")
Signed-off-by: Krzysztof Kozlowski
Signed-off-by: Greg Kroah-Hartman
commit 7daf817d076d0cfa63491423bcb33ac3bac56994
Author: Johan Hovold
Date: Mon Mar 6 17:36:40 2017 +0100
USB: serial: io\_ti: fix information leak in completion handler
commit 654b404f2a222f918af9b0cd18ad469d0c941a8e upstream.
Add missing sanity check to the bulk-in completion handler to avoid an
integer underflow that can be triggered by a malicious device.
This avoids leaking 128 kB of memory content from after the URB transfer
buffer to user space.
Fixes: 8c209e6782ca ("USB: make actual\_length in struct urb field u32")
Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
Signed-off-by: Johan Hovold
Signed-off-by: Greg Kroah-Hartman
commit 9bb084c79f20f1955f1f3fd8e1d1726484f49017
Author: Johan Hovold
Date: Mon Mar 6 17:36:37 2017 +0100
USB: serial: io\_ti: fix NULL-deref in interrupt callback
commit 0b1d250afb8eb9d65afb568bac9b9f9253a82b49 upstream.
Fix a NULL-pointer dereference in the interrupt callback should a
malicious device send data containing a bad port number by adding the
missing sanity check.
Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
Signed-off-by: Johan Hovold
Signed-off-by: Greg Kroah-Hartman
commit 14bca59b1660196c87e424c2d42c23075800b530
Author: Johan Hovold
Date: Tue Mar 7 16:11:04 2017 +0100
USB: iowarrior: fix NULL-deref in write
commit de46e56653de7b3b54baa625bd582635008b8d05 upstream.
Make sure to verify that we have the required interrupt-out endpoint for
IOWarrior56 devices to avoid dereferencing a NULL-pointer in write
should a malicious device lack such an endpoint.
Fixes: 946b960d13c1 ("USB: add driver for iowarrior devices.")
Signed-off-by: Johan Hovold
Signed-off-by: Greg Kroah-Hartman
commit 5ec59765f503ca208af2fa78796f7e4f842f6e00
Author: Johan Hovold
Date: Tue Mar 7 16:11:03 2017 +0100
USB: iowarrior: fix NULL-deref at probe
commit b7321e81fc369abe353cf094d4f0dc2fe11ab95f upstream.
Make sure to check for the required interrupt-in endpoint to avoid
dereferencing a NULL-pointer should a malicious device lack such an
endpoint.
Note that a fairly recent change purported to fix this issue, but added
an insufficient test on the number of endpoints only, a test which can
now be removed.
Fixes: 4ec0ef3a8212 ("USB: iowarrior: fix oops with malicious USB descriptors")
Fixes: 946b960d13c1 ("USB: add driver for iowarrior devices.")
Signed-off-by: Johan Hovold
Signed-off-by: Greg Kroah-Hartman
commit cc6ba470ebf84af1898dc305b307b0564c3963e6
Author: Johan Hovold
Date: Mon Mar 6 17:36:38 2017 +0100
USB: serial: omninet: fix reference leaks at open
commit 30572418b445d85fcfe6c8fe84c947d2606767d8 upstream.
This driver needlessly took another reference to the tty on open, a
reference which was then never released on close. This lead to not just
a leak of the tty, but also a driver reference leak that prevented the
driver from being unloaded after a port had once been opened.
Fixes: 4a90f09b20f4 ("tty: usb-serial krefs")
Signed-off-by: Johan Hovold
Signed-off-by: Greg Kroah-Hartman
commit dc944b117e6c84ca95449bbbab089dfa07d703e6
Author: Johan Hovold
Date: Mon Mar 6 17:36:41 2017 +0100
USB: serial: safe\_serial: fix information leak in completion handler
commit 8c76d7cd520ebffc1ea9ea0850d87a224a50c7f2 upstream.
Add missing sanity check to the bulk-in completion handler to avoid an
integer underflow that could be triggered by a malicious device.
This avoids leaking up to 56 bytes from after the URB transfer buffer to
user space.
Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
Signed-off-by: Johan Hovold
Signed-off-by: Greg Kroah-Hartman
commit a062cb39594667bd3953f71cbcf7e0b276998f56
Author: Guenter Roeck
Date: Thu Mar 9 15:39:37 2017 +0200
usb: host: xhci-plat: Fix timeout on removal of hot pluggable xhci controllers
commit dcc7620cad5ad1326a78f4031a7bf4f0e5b42984 upstream.
Upstream commit 98d74f9ceaef ("xhci: fix 10 second timeout on removal of
PCI hotpluggable xhci controllers") fixes a problem with hot pluggable PCI
xhci controllers which can result in excessive timeouts, to the point where
the system reports a deadlock.
The same problem is seen with hot pluggable xhci controllers using the
xhci-plat driver, such as the driver used for Type-C ports on rk3399.
Similar to hot-pluggable PCI controllers, the driver for this chip
removes the xhci controller from the system when the Type-C cable is
disconnected.
The solution for PCI devices works just as well for non-PCI devices
and avoids the problem.
Signed-off-by: Guenter Roeck
Signed-off-by: Mathias Nyman
Signed-off-by: Greg Kroah-Hartman
commit 7202353681d5ada29e12029f1bc187bc098d552d
Author: Peter Chen
Date: Thu Mar 9 15:39:36 2017 +0200
usb: host: xhci-dbg: HCIVERSION should be a binary number
commit f95e60a7dbecd2de816bb3ad517b3d4fbc20b507 upstream.
According to xHCI spec, HCIVERSION containing a BCD encoding
of the xHCI specification revision number, 0100h corresponds
to xHCI version 1.0. Change "100" as "0x100".
Cc: Lu Baolu
Fixes: 04abb6de2825 ("xhci: Read and parse new xhci 1.1 capability register")
Signed-off-by: Peter Chen
Signed-off-by: Mathias Nyman
Signed-off-by: Greg Kroah-Hartman
commit 222095ea64875d3f6e2d4c58b03df8220d164c35
Author: Roger Quadros
Date: Thu Mar 2 10:44:58 2017 +0200
Revert "usb: gadget: uvc: Add missing call for additional setup data"
commit eb38d913c27f32f4df173791051fecf6aca34173 upstream.
This reverts commit 4fbac5206afd01b717d4bdc58793d471f3391b4b.
This commit breaks g\_webcam when used with uvc-gadget [1].
The user space application (e.g. uvc-gadget) is responsible for
sending response to UVC class specific requests on control endpoint
in uvc\_send\_response() in uvc\_v4l2.c.
The bad commit was causing a duplicate response to be sent with
incorrect response data thus causing UVC probe to fail at the host
and broken control transfer endpoint at the gadget.
[1] - git://git.ideasonboard.org/uvc-gadget.git
Acked-by: Laurent Pinchart
Signed-off-by: Roger Quadros
Signed-off-by: Felipe Balbi
Signed-off-by: Greg Kroah-Hartman
commit d60b1053a5bbc89f2a728cf92ebc16586f307d66
Author: Felipe Balbi
Date: Tue Jan 31 14:54:45 2017 +0200
usb: gadget: function: f\_fs: pass companion descriptor along
commit 2bfa0719ac2a9b2f3c91345873d3cdebd0296ba9 upstream.
If we're dealing with SuperSpeed endpoints, we need
to make sure to pass along the companion descriptor
and initialize fields needed by the Gadget
API. Eventually, f\_fs.c should be converted to use
config\_ep\_by\_speed() like all other functions,
though.
Signed-off-by: Felipe Balbi
Signed-off-by: Greg Kroah-Hartman
commit a0f69738c10e7f5bec6ecb85280c94d92207f1d9
Author: Jelle Martijn Kok
Date: Tue Feb 21 12:48:18 2017 +0100
usb: ohci-at91: Do not drop unhandled USB suspend control requests
commit 85550f9148a852ed363a386577ad31b97b95dfb8 upstream.
In patch 2e2aa1bc7eff90ecm, USB suspend and wakeup control requests are
passed to SFR\_OHCIICR register. If a processor does not have such a
register, this hub control request will be dropped.
If no such a SFR register is available, all USB suspend control requests
will now be processed using ohci\_hub\_control()
(like before patch 2e2aa1bc7eff90ecm.)
Tested on an Atmel AT91SAM9G20 with an on-board TI TUSB2046B hub chip
If the last USB device is unplugged from the USB hub, the hub goes into
sleep and will not wakeup when an USB devices is inserted.
Fixes: 2e2aa1bc7eff90ec ("usb: ohci-at91: Forcibly suspend ports while USB suspend")
Signed-off-by: Jelle Martijn Kok
Tested-by: Wenyou Yang
Cc: Wenyou Yang
Cc: Alan Stern
Acked-by: Nicolas Ferre
Reviewed-by: Alexandre Belloni
Signed-off-by: Greg Kroah-Hartman
commit 25b1a4fdd8ae998f3117f5c63a201682f1d3bb8c
Author: Roger Quadros
Date: Wed Feb 15 13:38:22 2017 +0200
usb: dwc3-omap: Fix missing break in dwc3\_omap\_set\_mailbox()
commit 0913750f9fb6f26bcd00c8f9dd9a8d1b8d031246 upstream.
We need to break from all cases if we want to treat
each one of them separately.
Reported-by: Gustavo A. R. Silva
Fixes: d2728fb3e01f ("usb: dwc3: omap: Pass VBUS and ID events transparently")
Signed-off-by: Roger Quadros
Signed-off-by: Felipe Balbi
Signed-off-by: Greg Kroah-Hartman
commit 894a0dfaaef7d00782bd22e4475c535942796176
Author: Felipe Balbi
Date: Tue Jan 31 13:24:54 2017 +0200
usb: dwc3: gadget: make Set Endpoint Configuration macros safe
commit 7369090a9fb57c3fc705ce355d2e4523a5a24716 upstream.
Some gadget drivers are bad, bad boys. We notice
that ADB was passing bad Burst Size which caused top
bits of param0 to be overwritten which confused DWC3
when running this command.
In order to avoid future issues, we're going to make
sure values passed by macros are always safe for the
controller. Note that ADB still needs a fix to \*not\*
pass bad values.
Reported-by: Mohamed Abbas
Sugested-by: Adam Andruszak
Signed-off-by: Felipe Balbi
Signed-off-by: Greg Kroah-Hartman
commit c73210fdd40d39993a195c06422fb988b1f5fbcc
Author: Peter Chen
Date: Tue Feb 28 14:25:45 2017 +0800
usb: gadget: dummy\_hcd: clear usb\_gadget region before registration
commit 5bbc852676ae08e818241cf66a3ffe4be44225c4 upstream.
When the user does device unbind and rebind test, the kernel will
show below dump due to usb\_gadget memory region is dirty after unbind.
Clear usb\_gadget region for every new probe.
root@imx6qdlsolo:/sys/bus/platform/drivers/dummy\_udc# echo dummy\_udc.0 > bind
[ 102.523312] kobject (eddd78b0): tried to init an initialized object, something is seriously wrong.
[ 102.532447] CPU: 0 PID: 734 Comm: sh Not tainted 4.10.0-rc7-00872-g1b2b8e9 #1298
[ 102.539866] Hardware name: Freescale i.MX6 SoloX (Device Tree)
[ 102.545717] Backtrace:
[ 102.548225] [] (dump\_backtrace) from [] (show\_stack+0x18/0x1c)
[ 102.555822] r7:ede34000 r6:60010013 r5:00000000 r4:c0f29418
[ 102.561512] [] (show\_stack) from [] (dump\_stack+0xb4/0xe8)
[ 102.568764] [] (dump\_stack) from [] (kobject\_init+0x80/0x9c)
[ 102.576187] r10:0000001f r9:eddd7000 r8:eeaf8c10 r7:eddd78a8 r6:c177891c r5:c0f3b060
[ 102.584036] r4:eddd78b0 r3:00000000
[ 102.587641] [] (kobject\_init) from [] (device\_initialize+0x28/0xf8)
[ 102.595665] r5:eebc4800 r4:eddd78a8
[ 102.599268] [] (device\_initialize) from [] (device\_register+0x14/0x20)
[ 102.607556] r7:eddd78a8 r6:00000000 r5:eebc4800 r4:eddd78a8
[ 102.613256] [] (device\_register) from [] (usb\_add\_gadget\_udc\_release+0x8c/0x1ec)
[ 102.622410] r5:eebc4800 r4:eddd7860
[ 102.626015] [] (usb\_add\_gadget\_udc\_release) from [] (usb\_add\_gadget\_udc+0x14/0x18)
[ 102.635351] r10:0000001f r9:eddd7000 r8:eddd788c r7:bf003770 r6:eddd77f8 r5:eddd7818
[ 102.643198] r4:eddd785c r3:eddd7b24
[ 102.646834] [] (usb\_add\_gadget\_udc) from [] (dummy\_udc\_probe+0x170/0x1c4 [dummy\_hcd])
[ 102.656458] [] (dummy\_udc\_probe [dummy\_hcd]) from [] (platform\_drv\_probe+0x54/0xb8)
[ 102.665881] r10:00000008 r9:c1778960 r8:bf004128 r7:fffffdfb r6:bf004128 r5:eeaf8c10
[ 102.673727] r4:eeaf8c10
[ 102.676293] [] (platform\_drv\_probe) from [] (driver\_probe\_device+0x264/0x474)
[ 102.685186] r7:00000000 r6:00000000 r5:c1778960 r4:eeaf8c10
[ 102.690876] [] (driver\_probe\_device) from [] (bind\_store+0xb8/0x14c)
[ 102.698994] r10:eeb3bb4c r9:ede34000 r8:0000000c r7:eeaf8c44 r6:bf004128 r5:c0f3b668
[ 102.706840] r4:eeaf8c10
[ 102.709402] [] (bind\_store) from [] (drv\_attr\_store+0x28/0x34)
[ 102.716998] r9:ede34000 r8:00000000 r7:ee3863c0 r6:ee3863c0 r5:c0538c80 r4:c053970c
[ 102.724776] [] (drv\_attr\_store) from [] (sysfs\_kf\_write+0x50/0x54)
[ 102.732711] r5:c0538c80 r4:0000000c
[ 102.736313] [] (sysfs\_kf\_write) from [] (kernfs\_fop\_write+0x100/0x214)
[ 102.744599] r7:ee3863c0 r6:eeb3bb40 r5:00000000 r4:00000000
[ 102.750287] [] (kernfs\_fop\_write) from [] (\_\_vfs\_write+0x34/0x120)
[ 102.758231] r10:00000000 r9:ede34000 r8:c0108bc4 r7:0000000c r6:ede35f80 r5:c029bd84
[ 102.766077] r4:ee223780
[ 102.768638] [] (\_\_vfs\_write) from [] (vfs\_write+0xa8/0x170)
[ 102.775974] r9:ede34000 r8:c0108bc4 r7:ede35f80 r6:01861cb0 r5:ee223780 r4:0000000c
[ 102.783743] [] (vfs\_write) from [] (SyS\_write+0x4c/0xa8)
[ 102.790818] r9:ede34000 r8:c0108bc4 r7:0000000c r6:01861cb0 r5:ee223780 r4:ee223780
[ 102.798595] [] (SyS\_write) from [] (ret\_fast\_syscall+0x0/0x1c)
[ 102.806188] r7:00000004 r6:b6e83d58 r5:01861cb0 r4:0000000c
Fixes: 90fccb529d24 ("usb: gadget: Gadget directory cleanup - group UDC drivers")
Acked-by: Alan Stern
Signed-off-by: Peter Chen
Tested-by: Xiaolong Ye
Reported-by: Fengguang Wu
Signed-off-by: Felipe Balbi
Signed-off-by: Greg Kroah-Hartman
commit b5ea65b25a33168f49350b7b50a933376d340b26
Author: Ethan Zhao
Date: Mon Feb 27 17:08:44 2017 +0900
PCI: Prevent VPD access for QLogic ISP2722
commit 0d5370d1d85251e5893ab7c90a429464de2e140b upstream.
QLogic ISP2722-based 16/32Gb Fibre Channel to PCIe Adapter has the VPD
access issue too, while read the common pci-sysfs access interface shown as
/sys/devices/pci0000:00/0000:00:03.2/0000:0b:00.0/vpd
with simple 'cat' could cause system hang and panic:
Kernel panic - not syncing: An NMI occurred. Depending on your system the reason for the NMI is logged in any one of the following resources:
1. Integrated Management Log (IML)
2. OA Syslog
3. OA Forward Progress Log
4. iLO Event Log
CPU: 0 PID: 15070 Comm: udevadm Not tainted 4.1.12
Hardware name: HP ProLiant DL380 Gen9/ProLiant DL380 Gen9, BIOS P89 12/27/2015
0000000000000086 000000007f0cdf51 ffff880c4fa05d58 ffffffff817193de
ffffffffa00b42d8 0000000000000075 ffff880c4fa05dd8 ffffffff81714072
0000000000000008 ffff880c4fa05de8 ffff880c4fa05d88 000000007f0cdf51
Call Trace:
 [] dump\_stack+0x63/0x81
[] panic+0xd0/0x20e
[] hpwdt\_pretimeout+0xdd/0xe0 [hpwdt]
[] ? sched\_clock+0x9/0x10
[] nmi\_handle+0x91/0x170
[] ? nmi\_handle+0x9c/0x170
[] io\_check\_error+0x1e/0xa0
[] default\_do\_nmi+0x99/0x140
[] do\_nmi+0xf4/0x170
[] end\_repeat\_nmi+0x1a/0x1e
[] ? pci\_conf1\_read+0xeb/0x120
[] ? pci\_conf1\_read+0xeb/0x120
[] ? pci\_conf1\_read+0xeb/0x120
<> [] raw\_pci\_read+0x23/0x40
[] pci\_read+0x2c/0x30
[] pci\_user\_read\_config\_word+0x72/0x110
[] pci\_vpd\_pci22\_wait+0x96/0x130
[] pci\_vpd\_pci22\_read+0xdb/0x1a0
[] pci\_read\_vpd+0x20/0x30
[] read\_vpd\_attr+0x30/0x40
[] sysfs\_kf\_bin\_read+0x47/0x70
[] kernfs\_fop\_read+0xae/0x180
[] \_\_vfs\_read+0x37/0x100
[] ? security\_file\_permission+0x84/0xa0
[] ? rw\_verify\_area+0x56/0xe0
[] vfs\_read+0x86/0x140
[] SyS\_read+0x55/0xd0
[] system\_call\_fastpath+0x12/0x71
Shutting down cpus with NMI
Kernel Offset: disabled
drm\_kms\_helper: panic occurred, switching back to text console
So blacklist the access to its VPD.
Signed-off-by: Ethan Zhao
Signed-off-by: Bjorn Helgaas
Signed-off-by: Greg Kroah-Hartman
commit 27469baaef1aaee8c0da5b6cc696a77b8a1b79e2
Author: Balbir Singh
Date: Fri Mar 3 11:58:44 2017 +1100
powerpc/xics: Work around limitations of OPAL XICS priority handling
commit a69e2fb70350a66f91175cd2625f1e8215c5b6e9 upstream.
The CPPR (Current Processor Priority Register) of a XICS interrupt
presentation controller contains a value N, such that only interrupts
with a priority "more favoured" than N will be received by the CPU,
where "more favoured" means "less than". So if the CPPR has the value 5
then only interrupts with a priority of 0-4 inclusive will be received.
In theory the CPPR can support a value of 0 to 255 inclusive.
In practice Linux only uses values of 0, 4, 5 and 0xff. Setting the CPPR
to 0 rejects all interrupts, setting it to 0xff allows all interrupts.
The values 4 and 5 are used to differentiate IPIs from external
interrupts. Setting the CPPR to 5 allows IPIs to be received but not
external interrupts.
The CPPR emulation in the OPAL XICS implementation only directly
supports priorities 0 and 0xff. All other priorities are considered
equivalent, and mapped to a single priority value internally. This means
when using icp-opal we can not allow IPIs but not externals.
This breaks Linux's use of priority values when a CPU is hot unplugged.
After migrating IRQs away from the CPU that is being offlined, we set
the priority to 5, meaning we still want the offline CPU to receive
IPIs. But the effect of the OPAL XICS emulation's use of a single
priority value is that all interrupts are rejected by the CPU. With the
CPU offline, and not receiving IPIs, we may not be able to wake it up to
bring it back online.
The first part of the fix is in icp\_opal\_set\_cpu\_priority(). CPPR values
of 0 to 4 inclusive will correctly cause all interrupts to be rejected,
so we pass those CPPR values through to OPAL. However if we are called
with a CPPR of 5 or greater, the caller is expecting to be able to allow
IPIs but not external interrupts. We know this doesn't work, so instead
of rejecting all interrupts we choose the opposite which is to allow all
interrupts. This is still not correct behaviour, but we know for the
only existing caller (xics\_migrate\_irqs\_away()), that it is the better
option.
The other part of the fix is in xics\_migrate\_irqs\_away(). Instead of
setting priority (CPPR) to 0, and then back to 5 before migrating IRQs,
we migrate the IRQs before setting the priority back to 5. This should
have no effect on an ICP backend with a working set\_priority(), and on
icp-opal it means we will keep all interrupts blocked until after we've
finished doing the IRQ migration. Additionally we wait for 5ms after
doing the migration to make sure there are no IRQs in flight.
Fixes: d74361881f0d ("powerpc/xics: Add ICP OPAL backend")
Suggested-by: Michael Ellerman
Reported-by: Vaidyanathan Srinivasan
Tested-by: Vaidyanathan Srinivasan
Signed-off-by: Balbir Singh
[mpe: Rewrote comments and change log, change delay to 5ms]
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit 74e236a5bd9988b1c7649763ab2e731c2607c953
Author: Laurentiu Tudor
Date: Thu Feb 16 09:11:29 2017 -0600
powerpc/booke: Fix boot crash due to null hugepd
commit 3fb66a70a4ae886445743354e4b60e54058bb3ff upstream.
On 32-bit book-e machines, hugepd\_ok() no longer takes into account null
hugepd values, causing this crash at boot:
Unable to handle kernel paging request for data at address 0x80000000
...
NIP [c0018378] follow\_huge\_addr+0x38/0xf0
LR [c001836c] follow\_huge\_addr+0x2c/0xf0
Call Trace:
follow\_huge\_addr+0x2c/0xf0 (unreliable)
follow\_page\_mask+0x40/0x3e0
\_\_get\_user\_pages+0xc8/0x450
get\_user\_pages\_remote+0x8c/0x250
copy\_strings+0x110/0x390
copy\_strings\_kernel+0x2c/0x50
do\_execveat\_common+0x478/0x630
do\_execve+0x2c/0x40
try\_to\_run\_init\_process+0x18/0x60
kernel\_init+0xbc/0x110
ret\_from\_kernel\_thread+0x5c/0x64
This impacts all nxp (ex-freescale) 32-bit booke platforms.
This was caused by the change of hugepd\_t.pd from signed to unsigned,
and the update to the nohash version of hugepd\_ok(). Previously
hugepd\_ok() could exclude all non-huge and NULL pgds using > 0, whereas
now we need to explicitly check that the value is not zero and also that
PD\_HUGE is \*clear\*.
This isn't protected by the pgd\_none() check in \_\_find\_linux\_pte\_or\_hugepte()
because on 32-bit we use pgtable-nopud.h, which causes the pgd\_none()
check to be always false.
Fixes: 20717e1ff526 ("powerpc/mm: Fix little-endian 4K hugetlb")
Reported-by: Madalin-Cristian Bucur
Signed-off-by: Laurentiu Tudor
[mpe: Flesh out change log details.]
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit 1006828d11041e2cea082f3df8c5f233def9a4d8
Author: Ravi Bangoria
Date: Tue Feb 14 14:46:42 2017 +0530
powerpc: Emulation support for load/store instructions on LE
commit e148bd17f48bd17fca2f4f089ec879fa6e47e34c upstream.
emulate\_step() uses a number of underlying kernel functions that were
initially not enabled for LE. This has been rectified since. So, fix
emulate\_step() for LE for the corresponding instructions.
Reported-by: Anton Blanchard
Signed-off-by: Ravi Bangoria
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit 80eae855b694634ff2384885437fcf651dc5eb21
Author: Qi Hou
Date: Fri Mar 3 15:57:11 2017 +0800
i2c: add missing of\_node\_put in i2c\_mux\_del\_adapters
commit 2e1e4949f9dfb053122785cd73540bb1e61f768b upstream.
Refcount of of\_node is increased with of\_node\_get() in i2c\_mux\_add\_adapter().
It must be decreased with of\_node\_put() in i2c\_mux\_del\_adapters().
Signed-off-by: Qi Hou
Reviewed-by: Zhang Xiao
Signed-off-by: Peter Rosin
Signed-off-by: Greg Kroah-Hartman
commit be20197df07db889c8825ce99fa2ee700894e91c
Author: Jonathan McDowell
Date: Wed Feb 15 18:29:15 2017 -0200
dw2102: don't do DMA on stack
commit 606142af57dad981b78707234cfbd15f9f7b7125 upstream.
On Kernel 4.9, WARNINGs about doing DMA on stack are hit at
the dw2102 driver: one in su3000\_power\_ctrl() and the other in tt\_s2\_4600\_frontend\_attach().
Both were due to the use of buffers on the stack as parameters to
dvb\_usb\_generic\_rw() and the resulting attempt to do DMA with them.
The device was non-functional as a result.
So, switch this driver over to use a buffer within the device state
structure, as has been done with other DVB-USB drivers.
Tested with TechnoTrend TT-connect S2-4600.
[mchehab@osg.samsung.com: fixed a warning at su3000\_i2c\_transfer() that
state var were dereferenced before check 'd']
Signed-off-by: Jonathan McDowell
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 7399dec22e729305ac7597bf3950492ce8f97c24
Author: Ard Biesheuvel
Date: Wed Mar 1 19:05:54 2017 +0000
efi/arm: Fix boot crash with CONFIG\_CPUMASK\_OFFSTACK=y
commit d1eb98143c56f24fef125f5bbed49ae0b52fb7d6 upstream.
On ARM and arm64, we use a dedicated mm\_struct to map the UEFI
Runtime Services regions, which allows us to map those regions
on demand, and in a way that is guaranteed to be compatible
with incoming kernels across kexec.
As it turns out, we don't fully initialize the mm\_struct in the
same way as process mm\_structs are initialized on fork(), which
results in the following crash on ARM if CONFIG\_CPUMASK\_OFFSTACK=y
is enabled:
...
EFI Variables Facility v0.08 2004-May-17
Unable to handle kernel NULL pointer dereference at virtual address 00000000
[...]
Process swapper/0 (pid: 1)
...
\_\_memzero()
check\_and\_switch\_context()
virt\_efi\_get\_next\_variable()
efivar\_init()
efivars\_sysfs\_init()
do\_one\_initcall()
...
This is due to a missing call to mm\_init\_cpumask(), so add it.
Signed-off-by: Ard Biesheuvel
Cc: Linus Torvalds
Cc: Matt Fleming
Cc: Peter Zijlstra
Cc: Thomas Gleixner
Cc: linux-efi@vger.kernel.org
Link: http://lkml.kernel.org/r/1488395154-29786-1-git-send-email-ard.biesheuvel@linaro.org
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit da603aadd53a9a5ac18eaac09f61a5af74b9a52e
Author: Eric W. Biederman
Date: Sun Mar 5 15:03:22 2017 -0600
ucount: Remove the atomicity from ucount->count
commit 040757f738e13caaa9c5078bca79aa97e11dde88 upstream.
Always increment/decrement ucount->count under the ucounts\_lock. The
increments are there already and moving the decrements there means the
locking logic of the code is simpler. This simplification in the
locking logic fixes a race between put\_ucounts and get\_ucounts that
could result in a use-after-free because the count could go zero then
be found by get\_ucounts and then be freed by put\_ucounts.
A bug presumably this one was found by a combination of syzkaller and
KASAN. JongWhan Kim reported the syzkaller failure and Dmitry Vyukov
spotted the race in the code.
Fixes: f6b2db1a3e8d ("userns: Make the count of user namespaces per user")
Reported-by: JongHwan Kim
Reported-by: Dmitry Vyukov
Reviewed-by: Andrei Vagin
Signed-off-by: "Eric W. Biederman"
Signed-off-by: Greg Kroah-Hartman
commit b7e9ef5cf4d9562c3a1a15beee269a0b18f71976
Author: Rik van Riel
Date: Wed Sep 28 22:55:54 2016 -0400
tracing: Add #undef to fix compile error
commit bf7165cfa23695c51998231c4efa080fe1d3548d upstream.
There are several trace include files that define TRACE\_INCLUDE\_FILE.
Include several of them in the same .c file (as I currently have in
some code I am working on), and the compile will blow up with a
"warning: "TRACE\_INCLUDE\_FILE" redefined #define TRACE\_INCLUDE\_FILE syscalls"
Every other include file in include/trace/events/ avoids that issue
by having a #undef TRACE\_INCLUDE\_FILE before the #define; syscalls.h
should have one, too.
Link: http://lkml.kernel.org/r/20160928225554.13bd7ac6@annuminas.surriel.com
Fixes: b8007ef74222 ("tracing: Separate raw syscall from syscall tracer")
Signed-off-by: Rik van Riel
Signed-off-by: Steven Rostedt (VMware)
Signed-off-by: Greg Kroah-Hartman
commit 3eded4f5bab12be59f4750658def0e2762aeebb7
Author: Stefan Wahren
Date: Thu Feb 16 21:20:45 2017 +0000
i2c: bcm2835: Avoid possible NULL ptr dereference
commit ababb08938df7ac245d30a58b95b94ecf8dc04fc upstream.
Since commit e2474541032d ("bcm2835: Fix hang for writing messages
larger than 16 bytes") the interrupt handler is prone to a possible
NULL pointer dereference. This could happen if an interrupt fires
before curr\_msg is set by bcm2835\_i2c\_xfer\_msg() and randomly occurs
on the RPi 3. Even this is an unexpected behavior the driver must
handle that with an error instead of a crash.
Reported-by: Peter Robinson
Fixes: e2474541032d ("bcm2835: Fix hang for writing messages larger than 16 bytes")
Signed-off-by: Stefan Wahren
Acked-by: Noralf TrÃ¸nnes
Signed-off-by: Wolfram Sang
Signed-off-by: Greg Kroah-Hartman
commit 393be4bcb329936d6963d7135b395fe853f1568e
Author: Arnd Bergmann
Date: Tue Jan 17 16:18:43 2017 +0100
MIPS: ralink: Remove unused rt\*\_wdt\_reset functions
commit 886f9c69fc68f56ddea34d3de51ac1fc2ac8dfbc upstream.
All pointers to these functions were removed, so now they produce
warnings:
arch/mips/ralink/rt305x.c:92:13: error: 'rt305x\_wdt\_reset' defined but not used [-Werror=unused-function]
This removes the functions. If we need them again, the patch can be
reverted later.
Fixes: f576fb6a0700 ("MIPS: ralink: cleanup the soc specific pinmux data")
Signed-off-by: Arnd Bergmann
Cc: John Crispin
Cc: Colin Ian King
Cc: linux-mips@linux-mips.org
Cc: linux-kernel@vger.kernel.org
Patchwork: https://patchwork.linux-mips.org/patch/15044/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 4ddb085a9b0a471a78774baeae98c1e3457f0128
Author: Arnd Bergmann
Date: Tue Jan 17 16:18:41 2017 +0100
MIPS: ralink: Remove unused timer functions
commit d92240d12a9c010e0094bbc9280aae4a6be9a2d5 upstream.
The functions were originally used for the module unload path,
but are not referenced any more and just cause warnings:
arch/mips/ralink/timer.c:104:13: error: 'rt\_timer\_disable' defined but not used [-Werror=unused-function]
arch/mips/ralink/timer.c:74:13: error: 'rt\_timer\_free' defined but not used [-Werror=unused-function]
Cc: Paul Gortmaker
Fixes: 62ee73d284e7 ("MIPS: ralink: Make timer explicitly non-modular")
Signed-off-by: Arnd Bergmann
Cc: Paul Gortmaker
Cc: John Crispin
Cc: linux-mips@linux-mips.org
Cc: linux-kernel@vger.kernel.org
Patchwork: https://patchwork.linux-mips.org/patch/15041/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit e1d9f7592b804195d91ce6eb2bffef30ca7edf77
Author: John Crispin
Date: Tue Dec 20 19:12:46 2016 +0100
MIPS: ralink: Cosmetic change to prom\_init().
commit 9c48568b3692f1a56cbf1935e4eea835e6b185b1 upstream.
Over the years the code has been changed various times leading to
argc/argv being defined in a different function to where we actually
use the variables. Clean this up by moving them to prom\_init\_cmdline().
Signed-off-by: John Crispin
Cc: linux-mips@linux-mips.org
Patchwork: https://patchwork.linux-mips.org/patch/14902/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 02b210c18667004c532cfb78efb0bcb0d158e6ff
Author: Arnd Bergmann
Date: Fri Feb 3 10:49:17 2017 +0100
mtd: pmcmsp: use kstrndup instead of kmalloc+strncpy
commit 906b268477bc03daaa04f739844c120fe4dbc991 upstream.
kernelci.org reports a warning for this driver, as it copies a local
variable into a 'const char \*' string:
drivers/mtd/maps/pmcmsp-flash.c:149:30: warning: passing argument 1 of 'strncpy' discards 'const' qualifier from pointer target type [-Wdiscarded-qualifiers]
Using kstrndup() simplifies the code and avoids the warning.
Signed-off-by: Arnd Bergmann
Acked-by: Marek Vasut
Signed-off-by: Brian Norris
Signed-off-by: Greg Kroah-Hartman
commit ee9cc4c573d5702fedb0c2c1d36589f5e7861e8a
Author: Arnd Bergmann
Date: Wed Jan 11 15:29:49 2017 +0100
MIPS: Update lemote2f\_defconfig for CPU\_FREQ\_STAT change
commit b3f6046186ef45acfeebc5a59c9fb45cefc685e7 upstream.
Since linux-4.8, CPU\_FREQ\_STAT is a bool symbol, causing a warning in
kernelci.org:
arch/mips/configs/lemote2f\_defconfig:42:warning: symbol value 'm' invalid for CPU\_FREQ\_STAT
This updates the defconfig to have the feature built-in.
Fixes: 1aefc75b2449 ("cpufreq: stats: Make the stats code non-modular")
Signed-off-by: Arnd Bergmann
Cc: linux-mips@linux-mips.org
Cc: linux-kernel@vger.kernel.org
Patchwork: https://patchwork.linux-mips.org/patch/15000/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 9ad686e6937aaf98312bf330bb2f25b72bfbc9e9
Author: Arnd Bergmann
Date: Tue Jan 17 16:18:46 2017 +0100
MIPS: ip22: Fix ip28 build for modern gcc
commit 23ca9b522383d3b9b7991d8586db30118992af4a upstream.
kernelci reports a failure of the ip28\_defconfig build after upgrading its
gcc version:
arch/mips/sgi-ip22/Platform:29: \*\*\* gcc doesn't support needed option -mr10k-cache-barrier=store. Stop.
The problem apparently is that the -mr10k-cache-barrier=store option is now
rejected for CPUs other than r10k. Explicitly including the CPU in the
check fixes this and is safe because both options were introduced in
gcc-4.4.
Signed-off-by: Arnd Bergmann
Cc: linux-mips@linux-mips.org
Cc: linux-kernel@vger.kernel.org
Patchwork: https://patchwork.linux-mips.org/patch/15049/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 715bb84b6ff6e59b7fe20d39735647da2344c004
Author: Arnd Bergmann
Date: Wed Jan 11 15:29:50 2017 +0100
MIPS: Update ip27\_defconfig for SCSI\_DH change
commit ea58fca1842a5dc410cae4167b01643db971a4e2 upstream.
Since linux-4.3, SCSI\_DH is a bool symbol, causing a warning in
kernelci.org:
arch/mips/configs/ip27\_defconfig:136:warning: symbol value 'm' invalid for SCSI\_DH
This updates the defconfig to have the feature built-in.
Fixes: 086b91d052eb ("scsi\_dh: integrate into the core SCSI code")
Signed-off-by: Arnd Bergmann
Cc: linux-mips@linux-mips.org
Cc: linux-kernel@vger.kernel.org
Patchwork: https://patchwork.linux-mips.org/patch/15001/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit b57e5d5daf996a908052adb0634ade95eea1466f
Author: Arnd Bergmann
Date: Fri Feb 3 17:43:50 2017 +0100
MIPS: ip27: Disable qlge driver in defconfig
commit b617649468390713db1515ea79fc772d2eb897a8 upstream.
One of the last remaining failures in kernelci.org is for a gcc bug:
drivers/net/ethernet/qlogic/qlge/qlge\_main.c:4819:1: error: insn does not satisfy its constraints:
drivers/net/ethernet/qlogic/qlge/qlge\_main.c:4819:1: internal compiler error: in extract\_constrain\_insn, at recog.c:2190
This is apparently broken in gcc-6 but fixed in gcc-7, and I cannot
reproduce the problem here. However, it is clear that ip27\_defconfig
does not actually need this driver as the platform has only PCI-X but
not PCIe, and the qlge adapter in turn is PCIe-only.
The driver was originally enabled in 2010 along with lots of other
drivers.
Fixes: 59d302b342e5 ("MIPS: IP27: Make defconfig useful again.")
Signed-off-by: Arnd Bergmann
Cc: Ralf Baechle
Cc: linux-mips@linux-mips.org
Cc: linux-kernel@vger.kernel.org
Patchwork: https://patchwork.linux-mips.org/patch/15197/
Signed-off-by: James Hogan
Signed-off-by: Greg Kroah-Hartman
commit 2260890bb6c74e63fc954701e24890b5fe065a9c
Author: Arnd Bergmann
Date: Tue Jan 17 16:18:36 2017 +0100
MIPS: VDSO: avoid duplicate CAC\_BASE definition
commit 1742ac265046f34223e06d5d283496f0291be259 upstream.
vdso.h includes  implicitly after defining CONFIG\_32BITS.
This defeats the override in mach-ip27/spaces.h, leading to
a build error that shows up in kernelci.org:
In file included from arch/mips/include/asm/mach-ip27/spaces.h:29:0,
from arch/mips/include/asm/page.h:12,
from arch/mips/vdso/vdso.h:26,
from arch/mips/vdso/gettimeofday.c:11:
arch/mips/include/asm/mach-generic/spaces.h:28:0: error: "CAC\_BASE" redefined [-Werror]
#define CAC\_BASE \_AC(0x80000000, UL)
An earlier patch tried to make the second definition conditional,
but that patch had the #ifdef in the wrong place, and would lead
to another warning:
arch/mips/include/asm/io.h: In function 'phys\_to\_virt':
arch/mips/include/asm/io.h:138:9: error: cast to pointer from integer of different size [-Werror=int-to-pointer-cast]
For all I can tell, there is no other reason than vdso32 to ever
include this file with CONFIG\_32BITS set, and the vdso itself should
never refer to the base addresses as it is running in user space,
so adding an #ifdef here is safe.
Link: https://patchwork.kernel.org/patch/9418187/
Fixes: 3ffc17d8768b ("MIPS: Adjust MIPS64 CAC\_BASE to reflect Config.K0")
Signed-off-by: Arnd Bergmann
Cc: Paul Burton
Cc: linux-mips@linux-mips.org
Cc: linux-kernel@vger.kernel.org
Patchwork: https://patchwork.linux-mips.org/patch/15039/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit d2b0d01a11b35ba4d6c406d5ba470a6358a23ae1
Author: Arnd Bergmann
Date: Wed Jan 11 15:29:48 2017 +0100
MIPS: Update defconfigs for NF\_CT\_PROTO\_DCCP/UDPLITE change
commit 9ddc16ad8e0bc7742fc96d5aaabc5b8698512cd1 upstream.
In linux-4.10-rc, NF\_CT\_PROTO\_UDPLITE and NF\_CT\_PROTO\_DCCP are bool
symbols instead of tristate, and kernelci.org reports a bunch of
warnings for this, like:
arch/mips/configs/malta\_kvm\_guest\_defconfig:63:warning: symbol value 'm' invalid for NF\_CT\_PROTO\_UDPLITE
arch/mips/configs/malta\_defconfig:62:warning: symbol value 'm' invalid for NF\_CT\_PROTO\_DCCP
arch/mips/configs/malta\_defconfig:63:warning: symbol value 'm' invalid for NF\_CT\_PROTO\_UDPLITE
arch/mips/configs/ip22\_defconfig:70:warning: symbol value 'm' invalid for NF\_CT\_PROTO\_DCCP
arch/mips/configs/ip22\_defconfig:71:warning: symbol value 'm' invalid for NF\_CT\_PROTO\_UDPLITE
This changes all the MIPS defconfigs with these symbols to have them
built-in.
Fixes: 9b91c96c5d1f ("netfilter: conntrack: built-in support for UDPlite")
Fixes: c51d39010a1b ("netfilter: conntrack: built-in support for DCCP")
Signed-off-by: Arnd Bergmann
Cc: linux-mips@linux-mips.org
Cc: linux-kernel@vger.kernel.org
Patchwork: https://patchwork.linux-mips.org/patch/14999/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit aab419fc398064487a734646352211daf5fa5833
Author: Arnd Bergmann
Date: Fri Feb 3 23:33:23 2017 +0100
crypto: improve gcc optimization flags for serpent and wp512
commit 7d6e9105026788c497f0ab32fa16c82f4ab5ff61 upstream.
An ancient gcc bug (first reported in 2003) has apparently resurfaced
on MIPS, where kernelci.org reports an overly large stack frame in the
whirlpool hash algorithm:
crypto/wp512.c:987:1: warning: the frame size of 1112 bytes is larger than 1024 bytes [-Wframe-larger-than=]
With some testing in different configurations, I'm seeing large
variations in stack frames size up to 1500 bytes for what should have
around 300 bytes at most. I also checked the reference implementation,
which is essentially the same code but also comes with some test and
benchmarking infrastructure.
It seems that recent compiler versions on at least arm, arm64 and powerpc
have a partial fix for this problem, but enabling "-fsched-pressure", but
even with that fix they suffer from the issue to a certain degree. Some
testing on arm64 shows that the time needed to hash a given amount of
data is roughly proportional to the stack frame size here, which makes
sense given that the wp512 implementation is doing lots of loads for
table lookups, and the problem with the overly large stack is a result
of doing a lot more loads and stores for spilled registers (as seen from
inspecting the object code).
Disabling -fschedule-insns consistently fixes the problem for wp512,
in my collection of cross-compilers, the results are consistently better
or identical when comparing the stack sizes in this function, though
some architectures (notable x86) have schedule-insns disabled by
default.
The four columns are:
default: -O2
press: -O2 -fsched-pressure
nopress: -O2 -fschedule-insns -fno-sched-pressure
nosched: -O2 -no-schedule-insns (disables sched-pressure)
default press nopress nosched
alpha-linux-gcc-4.9.3 1136 848 1136 176
am33\_2.0-linux-gcc-4.9.3 2100 2076 2100 2104
arm-linux-gnueabi-gcc-4.9.3 848 848 1048 352
cris-linux-gcc-4.9.3 272 272 272 272
frv-linux-gcc-4.9.3 1128 1000 1128 280
hppa64-linux-gcc-4.9.3 1128 336 1128 184
hppa-linux-gcc-4.9.3 644 308 644 276
i386-linux-gcc-4.9.3 352 352 352 352
m32r-linux-gcc-4.9.3 720 656 720 268
microblaze-linux-gcc-4.9.3 1108 604 1108 256
mips64-linux-gcc-4.9.3 1328 592 1328 208
mips-linux-gcc-4.9.3 1096 624 1096 240
powerpc64-linux-gcc-4.9.3 1088 432 1088 160
powerpc-linux-gcc-4.9.3 1080 584 1080 224
s390-linux-gcc-4.9.3 456 456 624 360
sh3-linux-gcc-4.9.3 292 292 292 292
sparc64-linux-gcc-4.9.3 992 240 992 208
sparc-linux-gcc-4.9.3 680 592 680 312
x86\_64-linux-gcc-4.9.3 224 240 272 224
xtensa-linux-gcc-4.9.3 1152 704 1152 304
aarch64-linux-gcc-7.0.0 224 224 1104 208
arm-linux-gnueabi-gcc-7.0.1 824 824 1048 352
mips-linux-gcc-7.0.0 1120 648 1120 272
x86\_64-linux-gcc-7.0.1 240 240 304 240
arm-linux-gnueabi-gcc-4.4.7 840 392
arm-linux-gnueabi-gcc-4.5.4 784 728 784 320
arm-linux-gnueabi-gcc-4.6.4 736 728 736 304
arm-linux-gnueabi-gcc-4.7.4 944 784 944 352
arm-linux-gnueabi-gcc-4.8.5 464 464 760 352
arm-linux-gnueabi-gcc-4.9.3 848 848 1048 352
arm-linux-gnueabi-gcc-5.3.1 824 824 1064 336
arm-linux-gnueabi-gcc-6.1.1 808 808 1056 344
arm-linux-gnueabi-gcc-7.0.1 824 824 1048 352
Trying the same test for serpent-generic, the picture is a bit different,
and while -fno-schedule-insns is generally better here than the default,
-fsched-pressure wins overall, so I picked that instead.
default press nopress nosched
alpha-linux-gcc-4.9.3 1392 864 1392 960
am33\_2.0-linux-gcc-4.9.3 536 524 536 528
arm-linux-gnueabi-gcc-4.9.3 552 552 776 536
cris-linux-gcc-4.9.3 528 528 528 528
frv-linux-gcc-4.9.3 536 400 536 504
hppa64-linux-gcc-4.9.3 524 208 524 480
hppa-linux-gcc-4.9.3 768 472 768 508
i386-linux-gcc-4.9.3 564 564 564 564
m32r-linux-gcc-4.9.3 712 576 712 532
microblaze-linux-gcc-4.9.3 724 392 724 512
mips64-linux-gcc-4.9.3 720 384 720 496
mips-linux-gcc-4.9.3 728 384 728 496
powerpc64-linux-gcc-4.9.3 704 304 704 480
powerpc-linux-gcc-4.9.3 704 296 704 480
s390-linux-gcc-4.9.3 560 560 592 536
sh3-linux-gcc-4.9.3 540 540 540 540
sparc64-linux-gcc-4.9.3 544 352 544 496
sparc-linux-gcc-4.9.3 544 344 544 496
x86\_64-linux-gcc-4.9.3 528 536 576 528
xtensa-linux-gcc-4.9.3 752 544 752 544
aarch64-linux-gcc-7.0.0 432 432 656 480
arm-linux-gnueabi-gcc-7.0.1 616 616 808 536
mips-linux-gcc-7.0.0 720 464 720 488
x86\_64-linux-gcc-7.0.1 536 528 600 536
arm-linux-gnueabi-gcc-4.4.7 592 440
arm-linux-gnueabi-gcc-4.5.4 776 448 776 544
arm-linux-gnueabi-gcc-4.6.4 776 448 776 544
arm-linux-gnueabi-gcc-4.7.4 768 448 768 544
arm-linux-gnueabi-gcc-4.8.5 488 488 776 544
arm-linux-gnueabi-gcc-4.9.3 552 552 776 536
arm-linux-gnueabi-gcc-5.3.1 552 552 776 536
arm-linux-gnueabi-gcc-6.1.1 560 560 776 536
arm-linux-gnueabi-gcc-7.0.1 616 616 808 536
I did not do any runtime tests with serpent, so it is possible that stack
frame size does not directly correlate with runtime performance here and
it actually makes things worse, but it's more likely to help here, and
the reduced stack frame size is probably enough reason to apply the patch,
especially given that the crypto code is often used in deep call chains.
Link: https://kernelci.org/build/id/58797d7559b5149efdf6c3a9/logs/
Link: http://www.larc.usp.br/~pbarreto/WhirlpoolPage.html
Link: https://gcc.gnu.org/bugzilla/show\_bug.cgi?id=11488
Link: https://gcc.gnu.org/bugzilla/show\_bug.cgi?id=79149
Cc: Ralf Baechle
Signed-off-by: Arnd Bergmann
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit 5af39bb8492fa22958a4d3a76fe3665b0da26e45
Author: Johan Hovold
Date: Fri Feb 24 19:11:28 2017 +0100
USB: serial: digi\_acceleport: fix OOB-event processing
commit 2e46565cf622dd0534a9d8bffe152a577b48d7aa upstream.
A recent change claimed to fix an off-by-one error in the OOB-port
completion handler, but instead introduced such an error. This could
specifically led to modem-status changes going unnoticed, effectively
breaking TIOCMGET.
Note that the offending commit fixes a loop-condition underflow and is
marked for stable, but should not be backported without this fix.
Reported-by: Ben Hutchings
Fixes: 2d380889215f ("USB: serial: digi\_acceleport: fix OOB data sanity
check")
Signed-off-by: Johan Hovold
Signed-off-by: Greg Kroah-Hartman
commit 2d32308355a87817bfab465223fc3ddc0571fc9f
Author: Johan Hovold
Date: Tue Jan 31 17:17:27 2017 +0100
USB: serial: digi\_acceleport: fix OOB data sanity check
commit 2d380889215fe20b8523345649dee0579821800c upstream.
Make sure to check for short transfers to avoid underflow in a loop
condition when parsing the receive buffer.
Also fix an off-by-one error in the incomplete sanity check which could
lead to invalid data being parsed.
Fixes: 8c209e6782ca ("USB: make actual\_length in struct urb field u32")
Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
Reviewed-by: Greg Kroah-Hartman
Signed-off-by: Johan Hovold
Signed-off-by: Greg Kroah-Hartman
commit a3137ad2e14fb95bbb26dec23afcbff38deaa589
Author: Georgi Djakov
Date: Thu Nov 17 17:20:26 2016 +0200
ARM: qcom\_defconfig: Enable RPM/RPM-SMD clocks
commit 2ec8258fe4d039ce312a1e59ba4b8419ad96d808 upstream.
Enable support for clocks, controlled by the RPM processor on
Qualcomm platforms.
Signed-off-by: Georgi Djakov
Signed-off-by: Andy Gross
Signed-off-by: Greg Kroah-Hartman
commit fa190b2a7f87d81d015025badbd082d4a1ad9b62
Author: William Breathitt Gray
Date: Thu Feb 9 10:03:41 2017 -0500
iio: 104-quad-8: Fix off-by-one error when addressing flag register
commit ca8d8e03b4c9ad447d1e882cc8014e538f653018 upstream.
The flag register is offset by 1 from the respective channel data
register. This patch fixes an off-by-one error when attempting to read a
channel flag register where the base address was not properly offset.
Fixes: 28e5d3bb0325 ("iio: 104-quad-8: Add IIO support for the ACCES 104-QUAD-8")
Signed-off-by: William Breathitt Gray
Signed-off-by: Jonathan Cameron
Signed-off-by: Greg Kroah-Hartman

