=== Content from www.debian.org_0a5a272c_20250124_192242.html ===


---

[[Date Prev](msg00181.html)][[Date Next](msg00183.html)]
[[Thread Prev](msg00181.html)][[Thread Next](msg00183.html)]
[[Date Index](maillist.html#00182)]
[[Thread Index](threads.html#00182)]

# [SECURITY] [DSA 3920-1] qemu security update

---

* *To*: debian-security-announce@lists.debian.org
* *Subject*: [SECURITY] [DSA 3920-1] qemu security update
* *From*: Moritz Muehlenhoff <jmm@debian.org>
* *Date*: Tue, 25 Jul 2017 22:06:11 +0200
* *Message-id*: <[[🔎]](/msgid-search/20170725200611.zk5rs7rtn6niugns%40pisco.westfalen.local) [20170725200611.zk5rs7rtn6niugns@pisco.westfalen.local](msg00182.html)>
* *Reply-to*: debian-security-announce-request@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

- -------------------------------------------------------------------------
Debian Security Advisory DSA-3920-1                   security@debian.org
<https://www.debian.org/security/>                       Moritz Muehlenhoff
July 25, 2017                         <https://www.debian.org/security/faq>
- -------------------------------------------------------------------------

Package        : qemu
CVE ID         : CVE-2017-9310 CVE-2017-9330 CVE-2017-9373 CVE-2017-9374
                 CVE-2017-9375 CVE-2017-9524 CVE-2017-10664 CVE-2017-10911

Multiple vulnerabilities were found in in qemu, a fast processor
emulator:

CVE-2017-9310

    Denial of service via infinite loop in e1000e NIC emulation.

CVE-2017-9330

    Denial of service via infinite loop in USB OHCI emulation.

CVE-2017-9373

    Denial of service via memory leak in IDE AHCI emulation.

CVE-2017-9374

    Denial of service via memory leak in USB EHCI emulation.

CVE-2017-9375

    Denial of service via memory leak in USB XHCI emulation.

CVE-2017-9524

    Denial of service in qemu-nbd server.

CVE-2017-10664

    Denial of service in qemu-nbd server.

CVE-2017-10911

    Information leak in Xen blkif response handling.

For the oldstable distribution (jessie), a separate DSA will be issued.

For the stable distribution (stretch), these problems have been fixed in
version 1:2.8+dfsg-6+deb9u1.

For the unstable distribution (sid), these problems will be fixed soon.

We recommend that you upgrade your qemu packages.

Further information about Debian Security Advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://www.debian.org/security/>

Mailing list: debian-security-announce@lists.debian.org
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCAAdFiEEtuYvPRKsOElcDakFEMKTtsN8TjYFAll3pJEACgkQEMKTtsN8
TjahDA//Sh2XpnQW8/lsiHJVE4HY53zY+f4PWAe7G5c9fHF8cpDMQyLg2qpL6cli
bP/i3xvYXd0oBhra5gDvgIgyYvbrizzJMkOOOCMAmcwwW7wH2eoCvHDR1UvhJgc2
+OJT4ijgtupvFpkb+j335UK/snT4Ltt7PbZ0dOcn/CdJtfIXyM2uTLRzIrFjKmVA
I9HDzGYUa9kkheEEDU930fKpdOPtOJ98Ji/Ah9dj/we6wZ/4E8Y+OSiGqFJZBGBA
5QGuSEtelpD4I0ZFe3qhnFETi3avNV82S4hnLFGTgWTe0rEDLZWLloEr5LP7+tEa
J04zu5ACSdOiQ1QOAJSnRId2j5SvNgZjlXlwwzcool4IMy10GDvzuw7WuswV4qsM
GC5yiCfWbB10Hw9tp/ZMqyAg5Qy66rSCy3nMoP4UWcrpCO4LocPvQxYNwvS6/ALQ
uWwd8ygaHe2TVIWStc8DBfSnFto5jWImggsRo3CBzwBrgqlM4TYZsYjUyYjuYESD
SoeN2dfCoMgOkOboo0hOM6eSPX9e5VcwnlopwHmWU5E25EFhBfIKNJpq3TEM5QS2
RV32/uz27TZFiin6DPhZqZ6f62qdjPuhIw4M0W2Q1NkiSQNRPE+++314N/88b1to
QnY0wf9xd6C82TJMnzCPb7C+KCjKIjgVIB4TkEGpsmxs4OOTBBY=
=kL4T
-----END PGP SIGNATURE-----

```

---



=== Content from xenbits.xen.org_66d2c4cd_20250124_192245.html ===

# Information

| Advisory | [XSA-216](advisory-216.html) |
| --- | --- |
| Public release | 2017-06-20 11:58 |
| Updated | 2017-07-07 13:52 |
| Version | 5 |
| CVE(s) | [CVE-2017-10911](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-10911) |
| Title | blkif responses leak backend stack data |

# Files

<advisory-216.txt> (signed advisory file)

<xsa216-linux-2.6.18-xen.patch>

<xsa216-linux-4.4.patch>

<xsa216-linux-4.11.patch>

<xsa216-qemuu.patch>

<xsa216-qemuu-4.5.patch>

<xsa216-qemuu-4.7.patch>
# Advisory

---

```

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

            Xen Security Advisory CVE-2017-10911 / XSA-216
                              version 5

                blkif responses leak backend stack data

UPDATES IN VERSION 5
====================

CVE assigned.

ISSUE DESCRIPTION
=================

The block interface response structure has some discontiguous fields.
Certain backends populate the structure fields of an otherwise
uninitialized instance of this structure on their stacks, leaking
data through the (internal or trailing) padding field.

IMPACT
======

A malicious unprivileged guest may be able to obtain sensitive
information from the host or other guests.

VULNERABLE SYSTEMS
==================

All Linux versions supporting the xen-blkback, blkback, or blktap
drivers are vulnerable.

FreeBSD, NetBSD and Windows (with or without PV drivers) are not
vulnerable (either because they do not have backends at all, or
because they use a different implementation technique which does not
suffer from this problem).

All qemu versions supporting the Xen block backend are vulnerable.  The
qemu-xen-traditional code base does not include such code, so is not
vulnerable.  Note that an instance of qemu will be spawned to provide
the backend for most non-raw-format disks; so you may need to apply the
patch to qemu even if you use only PV guests.

MITIGATION
==========

There's no mitigation available for x86 PV and ARM guests.

For x86 HVM guests it may be possible to change the guest
configuaration such that a fully virtualized disk is being made
available instead.  However, this would normally entail changes inside
the guest itself.

CREDITS
=======

This issue was discovered by Anthony Perard of Citrix.

RESOLUTION
==========

Applying the appropriate attached patch resolves this issue.

xsa216-linux-4.11.patch           Linux 4.5 ... 4.11
xsa216-linux-4.4.patch            Linux 3.3 ... 4.4
xsa216-qemuu.patch                qemu-upstream master, 4.8
xsa216-qemuu-4.7.patch            qemu-upstream 4.7, 4.6
xsa216-qemuu-4.5.patch            qemu-upstream 4.5
xsa216-linux-2.6.18-xen.patch     linux-2.6.18-xen.hg

$ sha256sum xsa216*
[d316e16f8da2078966e9d7d516dd0a9ed5a29c3bc479974374c8fa778859913d  xsa216-linux-2.6.18-xen.patch](xsa216-linux-2.6.18-xen.patch)
[4440fe324b61baf0f3f5a73352c4d9ac6f94917e216d8421263a5e67445852db  xsa216-linux-4.4.patch](xsa216-linux-4.4.patch)
[eb24bfc0303e13e08fd3710463aea139a92a3f83db7f35119c4d3831154a6453  xsa216-linux-4.11.patch](xsa216-linux-4.11.patch)
[b4b8f68fa05d718c5be7023c84d942e43725bcc563ea15556ee9646f6f9bf7e7  xsa216-qemuu.patch](xsa216-qemuu.patch)
[4fc3665ff07ec79fb31ac66a3fd360a45b7ec546c549c04284f0128ad0c5beba  xsa216-qemuu-4.5.patch](xsa216-qemuu-4.5.patch)
[a0e0dfd5ea2643ae14c220124194388017a3656db3e6ce430913cda800c43aad  xsa216-qemuu-4.7.patch](xsa216-qemuu-4.7.patch)
$

DEPLOYMENT DURING EMBARGO
=========================

Deployment of the patches described above (or others which are
substantially similar) is permitted during the embargo, even on
public-facing systems with untrusted guest users and administrators.

However, deployment of the mitigation is NOT permitted (except where
all the affected systems and VMs are administered and used only by
organisations which are members of the Xen Project Security Issues
Predisclosure List).  Specifically, deployment on public cloud systems
is NOT permitted.  This is because this produces a guest-visible
change which will indicate which component contains the vulnerability.

Additionally, distribution of updated software is prohibited (except to other
members of the predisclosure list).

Predisclosure list members who wish to deploy significantly different
patches and/or mitigations, please contact the Xen Project Security
Team.

(Note: this during-embargo deployment notice is retained in
post-embargo publicly released Xen Project advisories, even though it
is then no longer applicable.  This is to enable the community to have
oversight of the Xen Project Security Team's decisionmaking.)

For more information about permissible uses of embargoed information,
consult the Xen Project community's agreed Security Policy:
  <http://www.xenproject.org/security-policy.html>
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBCAAGBQJZX5IiAAoJEIP+FMlX6CvZdK8IALydeCfUgLpTzeVaRidXkO9M
dlChA1fXn5ZRlQxvGGIzatkl2Em99+JfIyW21AoVqFAyIYbYkbV7zmp82HpHAZfB
Ib5tFUS4ki1paXXcBtQSvgsz7Sxh5obZnCzyguOcSthZ0/Ude5mh9ImsnKepNxQi
GbMBY9xsBv+tclRLiaGUIBgKwtNc0AXpQhWAkbAEWjdYSN2CGsS37Z9Hi0GOoID/
Z49g7/shKDyrHxR1ph0uFqZOkCW8Um3qpORzwHIwpsqleY7Y5E9Ib/QXDOV7wJ1m
IDhkSmYf6kXjJ1yhwjRw4UgsGWj/TDyi9d6HxYU9DVHY1b5lWuNjbbyeMuVpR8A=
=18b8
-----END PGP SIGNATURE-----

```

---

Xenproject.org Security Team


=== Content from git.kernel.org_91dbc56f_20250124_192242.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=089bc0143f489bd3a4578bdff5f4ca68fb26f341)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=089bc0143f489bd3a4578bdff5f4ca68fb26f341)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=089bc0143f489bd3a4578bdff5f4ca68fb26f341)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=089bc0143f489bd3a4578bdff5f4ca68fb26f341)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jan Beulich <jbeulich@suse.com> | 2017-06-13 16:28:27 -0400 |
| --- | --- | --- |
| committer | Konrad Rzeszutek Wilk <konrad.wilk@oracle.com> | 2017-06-13 16:28:32 -0400 |
| commit | [089bc0143f489bd3a4578bdff5f4ca68fb26f341](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=089bc0143f489bd3a4578bdff5f4ca68fb26f341) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=089bc0143f489bd3a4578bdff5f4ca68fb26f341)) | |
| tree | [cacf9b2c4a98d97f7b697537fbbcd0909eb7ff1f](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=089bc0143f489bd3a4578bdff5f4ca68fb26f341) | |
| parent | [a24fa22ce22ae302b3bf8f7008896d52d5d57b8d](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=a24fa22ce22ae302b3bf8f7008896d52d5d57b8d) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=089bc0143f489bd3a4578bdff5f4ca68fb26f341&id2=a24fa22ce22ae302b3bf8f7008896d52d5d57b8d)) | |
| download | [linux-089bc0143f489bd3a4578bdff5f4ca68fb26f341.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-089bc0143f489bd3a4578bdff5f4ca68fb26f341.tar.gz) | |

xen-blkback: don't leak stack data via response ringRather than constructing a local structure instance on the stack, fill
the fields directly on the shared ring, just like other backends do.
Build on the fact that all response structure flavors are actually
identical (the old code did make this assumption too).
This is XSA-216.
Cc: stable@vger.kernel.org
Signed-off-by: Jan Beulich <jbeulich@suse.com>
Reviewed-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=089bc0143f489bd3a4578bdff5f4ca68fb26f341)

| -rw-r--r-- | [drivers/block/xen-blkback/blkback.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/drivers/block/xen-blkback/blkback.c?id=089bc0143f489bd3a4578bdff5f4ca68fb26f341) | 23 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/block/xen-blkback/common.h](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/drivers/block/xen-blkback/common.h?id=089bc0143f489bd3a4578bdff5f4ca68fb26f341) | 25 | |  |  |  | | --- | --- | --- | |

2 files changed, 17 insertions, 31 deletions

| diff --git a/drivers/block/xen-blkback/blkback.c b/drivers/block/xen-blkback/blkback.cindex 6b14c509f3c7bb..0e824091a12fac 100644--- a/[drivers/block/xen-blkback/blkback.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/block/xen-blkback/blkback.c?id=a24fa22ce22ae302b3bf8f7008896d52d5d57b8d)+++ b/[drivers/block/xen-blkback/blkback.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/block/xen-blkback/blkback.c?id=089bc0143f489bd3a4578bdff5f4ca68fb26f341)@@ -1433,34 +1433,35 @@ static int dispatch\_rw\_block\_io(struct xen\_blkif\_ring \*ring, static void make\_response(struct xen\_blkif\_ring \*ring, u64 id, unsigned short op, int st) {- struct blkif\_response resp;+ struct blkif\_response \*resp; unsigned long flags; union blkif\_back\_rings \*blk\_rings; int notify; - resp.id = id;- resp.operation = op;- resp.status = st;- spin\_lock\_irqsave(&ring->blk\_ring\_lock, flags); blk\_rings = &ring->blk\_rings; /\* Place on the response ring for the relevant domain. \*/ switch (ring->blkif->blk\_protocol) { case BLKIF\_PROTOCOL\_NATIVE:- memcpy(RING\_GET\_RESPONSE(&blk\_rings->native, blk\_rings->native.rsp\_prod\_pvt),- &resp, sizeof(resp));+ resp = RING\_GET\_RESPONSE(&blk\_rings->native,+ blk\_rings->native.rsp\_prod\_pvt); break; case BLKIF\_PROTOCOL\_X86\_32:- memcpy(RING\_GET\_RESPONSE(&blk\_rings->x86\_32, blk\_rings->x86\_32.rsp\_prod\_pvt),- &resp, sizeof(resp));+ resp = RING\_GET\_RESPONSE(&blk\_rings->x86\_32,+ blk\_rings->x86\_32.rsp\_prod\_pvt); break; case BLKIF\_PROTOCOL\_X86\_64:- memcpy(RING\_GET\_RESPONSE(&blk\_rings->x86\_64, blk\_rings->x86\_64.rsp\_prod\_pvt),- &resp, sizeof(resp));+ resp = RING\_GET\_RESPONSE(&blk\_rings->x86\_64,+ blk\_rings->x86\_64.rsp\_prod\_pvt); break; default: BUG(); }++ resp->id = id;+ resp->operation = op;+ resp->status = st;+ blk\_rings->common.rsp\_prod\_pvt++; RING\_PUSH\_RESPONSES\_AND\_CHECK\_NOTIFY(&blk\_rings->common, notify); spin\_unlock\_irqrestore(&ring->blk\_ring\_lock, flags);diff --git a/drivers/block/xen-blkback/common.h b/drivers/block/xen-blkback/common.hindex 638597b17a38c1..ecb35fe8ca8dbb 100644--- a/[drivers/block/xen-blkback/common.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/block/xen-blkback/common.h?id=a24fa22ce22ae302b3bf8f7008896d52d5d57b8d)+++ b/[drivers/block/xen-blkback/common.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/block/xen-blkback/common.h?id=089bc0143f489bd3a4578bdff5f4ca68fb26f341)@@ -75,9 +75,8 @@ extern unsigned int xenblk\_max\_queues; struct blkif\_common\_request { char dummy; };-struct blkif\_common\_response {- char dummy;-};++/\* i386 protocol version \*/  struct blkif\_x86\_32\_request\_rw { uint8\_t nr\_segments; /\* number of segments \*/@@ -129,14 +128,6 @@ struct blkif\_x86\_32\_request { } u; } \_\_attribute\_\_((\_\_packed\_\_)); -/\* i386 protocol version \*/-#pragma pack(push, 4)-struct blkif\_x86\_32\_response {- uint64\_t id; /\* copied from request \*/- uint8\_t operation; /\* copied from request \*/- int16\_t status; /\* BLKIF\_RSP\_??? \*/-};-#pragma pack(pop) /\* x86\_64 protocol version \*/  struct blkif\_x86\_64\_request\_rw {@@ -193,18 +184,12 @@ struct blkif\_x86\_64\_request { } u; } \_\_attribute\_\_((\_\_packed\_\_)); -struct blkif\_x86\_64\_response {- uint64\_t \_\_attribute\_\_((\_\_aligned\_\_(8))) id;- uint8\_t operation; /\* copied from request \*/- int16\_t status; /\* BLKIF\_RSP\_??? \*/-};- DEFINE\_RING\_TYPES(blkif\_common, struct blkif\_common\_request,- struct blkif\_common\_response);+ struct blkif\_response); DEFINE\_RING\_TYPES(blkif\_x86\_32, struct blkif\_x86\_32\_request,- struct blkif\_x86\_32\_response);+ struct blkif\_response \_\_packed); DEFINE\_RING\_TYPES(blkif\_x86\_64, struct blkif\_x86\_64\_request,- struct blkif\_x86\_64\_response);+ struct blkif\_response);  union blkif\_back\_rings { struct blkif\_back\_ring native; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-24 19:21:19 +0000



=== Content from www.kernel.org_58342c70_20250124_192244.html ===
commit 8afcfa55e6a7d8c58bdb4355bd544602e6f0c3ad
Author: Greg Kroah-Hartman
Date: Thu Jun 29 13:03:17 2017 +0200
Linux 4.11.8
commit bc3512188f51f99b0b7c9714426483a5f6740a06
Author: Arend Van Spriel
Date: Fri Jun 16 09:36:35 2017 +0100
brcmfmac: fix uninitialized warning in brcmf\_usb\_probe\_phase2()
commit 35abcd4f9f303ac4f10f99b3f7e993e5f2e6fa37 upstream.
This fixes the following warning:
drivers/net/wireless/broadcom/brcm80211/brcmfmac/usb.c: In function
'brcmf\_usb\_probe\_phase2':
drivers/net/wireless/broadcom/brcm80211/brcmfmac/usb.c:1198:2:
warning: 'devinfo' may be used uninitialized in this function
[-Wmaybe-uninitialized]
mutex\_unlock(&devinfo->dev\_init\_lock);
Fixes: 6d0507a777fb ("brcmfmac: add parameter to pass error code in firmware callback")
Cc: Stephen Rothwell
Reported-by: Kalle Valo
Signed-off-by: Arend van Spriel
Signed-off-by: Kalle Valo
Signed-off-by: Greg Kroah-Hartman
commit e5d12fe110cf59b8b0d7cea21521fd7761237d7d
Author: Willem de Bruijn
Date: Wed May 17 11:24:47 2017 -0400
netfilter: xtables: fix build failure from COMPAT\_XT\_ALIGN outside CONFIG\_COMPAT
commit 751a9c763849f5859cb69ea44b0430d00672f637 upstream.
The patch in the Fixes references COMPAT\_XT\_ALIGN in the definition
of XT\_DATA\_TO\_USER, outside an #ifdef CONFIG\_COMPAT block.
Split XT\_DATA\_TO\_USER into separate compat and non compat variants and
define the first inside an CONFIG\_COMPAT block.
This simplifies both variants by removing branches inside the macro.
Fixes: 324318f0248c ("netfilter: xtables: zero padding in data\_to\_user")
Reported-by: Stephen Rothwell
Signed-off-by: Willem de Bruijn
Signed-off-by: Pablo Neira Ayuso
Cc: Florian Westphal
Signed-off-by: Greg Kroah-Hartman
commit 865cdeeae70ae9f9a0ecce183401cc61ee756287
Author: Willem de Bruijn
Date: Tue May 9 16:17:37 2017 -0400
netfilter: xtables: zero padding in data\_to\_user
commit 324318f0248c31be8a08984146e7e4dd7cdd091d upstream.
When looking up an iptables rule, the iptables binary compares the
aligned match and target data (XT\_ALIGN). In some cases this can
exceed the actual data size to include padding bytes.
Before commit f77bc5b23fb1 ("iptables: use match, target and data
copy\_to\_user helpers") the malloc()ed bytes were overwritten by the
kernel with kzalloced contents, zeroing the padding and making the
comparison succeed. After this patch, the kernel copies and clears
only data, leaving the padding bytes undefined.
Extend the clear operation from data size to aligned data size to
include the padding bytes, if any.
Padding bytes can be observed in both match and target, and the bug
triggered, by issuing a rule with match icmp and target ACCEPT:
iptables -t mangle -A INPUT -i lo -p icmp --icmp-type 1 -j ACCEPT
iptables -t mangle -D INPUT -i lo -p icmp --icmp-type 1 -j ACCEPT
Fixes: f77bc5b23fb1 ("iptables: use match, target and data copy\_to\_user helpers")
Reported-by: Paul Moore
Reported-by: Richard Guy Briggs
Signed-off-by: Willem de Bruijn
Signed-off-by: Pablo Neira Ayuso
Cc: Florian Westphal
Signed-off-by: Greg Kroah-Hartman
commit 958c8a07d59e196b577d7b81817f5fc9f17edf19
Author: Russell King
Date: Tue May 30 16:21:51 2017 +0100
net: phy: fix marvell phy status reading
commit 898805e0cdf7fd860ec21bf661d3a0285a3defbd upstream.
The Marvell driver incorrectly provides phydev->lp\_advertising as the
logical and of the link partner's advert and our advert. This is
incorrect - this field is supposed to store the link parter's unmodified
advertisment.
This allows ethtool to report the correct link partner auto-negotiation
status.
Fixes: be937f1f89ca ("Marvell PHY m88e1111 driver fix")
Signed-off-by: Russell King
Reviewed-by: Andrew Lunn
Reviewed-by: Florian Fainelli
Signed-off-by: David S. Miller
Signed-off-by: Amit Pundir
Signed-off-by: Greg Kroah-Hartman
commit dc95f4a320f05539ef5fb5ba9b7a4bd349c866ab
Author: Hauke Mehrtens
Date: Mon Apr 17 01:38:05 2017 +0200
spi: double time out tolerance
commit 833bfade96561216aa2129516a5926a0326860a2 upstream.
The generic SPI code calculates how long the issued transfer would take
and adds 100ms in addition to the timeout as tolerance. On my 500 MHz
Lantiq Mips SoC I am getting timeouts from the SPI like this when the
system boots up:
m25p80 spi32766.4: SPI transfer timed out
blk\_update\_request: I/O error, dev mtdblock3, sector 2
SQUASHFS error: squashfs\_read\_data failed to read block 0x6e
After increasing the tolerance for the timeout to 200ms I haven't seen
these SPI transfer time outs any more.
The Lantiq SPI driver in use here has an extra work queue in between,
which gets triggered when the controller send the last word and the
hardware FIFOs used for reading and writing are only 8 words long.
Signed-off-by: Hauke Mehrtens
Signed-off-by: Mark Brown
Signed-off-by: Amit Pundir
Signed-off-by: Greg Kroah-Hartman
commit 87e67ff633d834342583aba6ffb0d073aade8f2c
Author: William Wu
Date: Tue Apr 25 17:45:48 2017 +0800
usb: gadget: f\_fs: avoid out of bounds access on comp\_desc
commit b7f73850bb4fac1e2209a4dd5e636d39be92f42c upstream.
Companion descriptor is only used for SuperSpeed endpoints,
if the endpoints are HighSpeed or FullSpeed, the Companion
descriptor will not allocated, so we can only access it if
gadget is SuperSpeed.
I can reproduce this issue on Rockchip platform rk3368 SoC
which supports USB 2.0, and use functionfs for ADB. Kernel
build with CONFIG\_KASAN=y and CONFIG\_SLUB\_DEBUG=y report
the following BUG:
==================================================================
BUG: KASAN: slab-out-of-bounds in ffs\_func\_set\_alt+0x224/0x3a0 at addr ffffffc0601f6509
Read of size 1 by task swapper/0/0
============================================================================
BUG kmalloc-256 (Not tainted): kasan: bad access detected
----------------------------------------------------------------------------
Disabling lock debugging due to kernel taint
INFO: Allocated in ffs\_func\_bind+0x52c/0x99c age=1275 cpu=0 pid=1
alloc\_debug\_processing+0x128/0x17c
\_\_\_slab\_alloc.constprop.58+0x50c/0x610
\_\_slab\_alloc.isra.55.constprop.57+0x24/0x34
\_\_kmalloc+0xe0/0x250
ffs\_func\_bind+0x52c/0x99c
usb\_add\_function+0xd8/0x1d4
configfs\_composite\_bind+0x48c/0x570
udc\_bind\_to\_driver+0x6c/0x170
usb\_udc\_attach\_driver+0xa4/0xd0
gadget\_dev\_desc\_UDC\_store+0xcc/0x118
configfs\_write\_file+0x1a0/0x1f8
\_\_vfs\_write+0x64/0x174
vfs\_write+0xe4/0x200
SyS\_write+0x68/0xc8
el0\_svc\_naked+0x24/0x28
INFO: Freed in inode\_doinit\_with\_dentry+0x3f0/0x7c4 age=1275 cpu=7 pid=247
...
Call trace:
[] dump\_backtrace+0x0/0x230
[] show\_stack+0x14/0x1c
[] dump\_stack+0xa0/0xc8
[] print\_trailer+0x188/0x198
[] object\_err+0x3c/0x4c
[] kasan\_report+0x324/0x4dc
[] \_\_asan\_load1+0x24/0x50
[] ffs\_func\_set\_alt+0x224/0x3a0
[] composite\_setup+0xdcc/0x1ac8
[] android\_setup+0x124/0x1a0
[] \_setup+0x54/0x74
[] handle\_ep0+0x3288/0x4390
[] dwc\_otg\_pcd\_handle\_out\_ep\_intr+0x14dc/0x2ae4
[] dwc\_otg\_pcd\_handle\_intr+0x1ec/0x298
[] dwc\_otg\_pcd\_irq+0x10/0x20
[] handle\_irq\_event\_percpu+0x124/0x3ac
[] handle\_irq\_event+0x60/0xa0
[] handle\_fasteoi\_irq+0x10c/0x1d4
[] generic\_handle\_irq+0x30/0x40
[] \_\_handle\_domain\_irq+0xac/0xdc
[] gic\_handle\_irq+0x64/0xa4
...
Memory state around the buggy address:
ffffffc0601f6400: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
ffffffc0601f6480: 00 00 00 00 00 00 00 00 00 00 06 fc fc fc fc fc
>ffffffc0601f6500: fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc
^
ffffffc0601f6580: fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc
ffffffc0601f6600: fc fc fc fc fc fc fc fc 00 00 00 00 00 00 00 00
==================================================================
Signed-off-by: William Wu
Signed-off-by: Felipe Balbi
Cc: Jerry Zhang
Signed-off-by: Greg Kroah-Hartman
commit 5693426a5c055e93fb1d6786e73d896db107f40b
Author: Daniel Vetter
Date: Tue Jun 20 22:28:37 2017 +0200
drm: Fix GETCONNECTOR regression
commit e94ac3510b6a0f696f2c442c4fc4051c8101ef12 upstream.
In
commit 91eefc05f0ac71902906b2058360e61bd25137fe
Author: Daniel Vetter
Date: Wed Dec 14 00:08:10 2016 +0100
drm: Tighten locking in drm\_mode\_getconnector
I reordered the logic a bit in that IOCTL, but that broke userspace
since it'll get the new mode list, but not the new property values.
Fix that again.
v2: Fix up the error path handling when copy\_to\_user for the modes
failes (Dhinakaran).
Fixes: 91eefc05f0ac ("drm: Tighten locking in drm\_mode\_getconnector")
Cc: Sean Paul
Cc: Daniel Vetter
Cc: Jani Nikula
Cc: David Airlie
Cc: dri-devel@lists.freedesktop.org
Reported-by: "H.J. Lu"
Tested-by: "H.J. Lu"
Bugzilla: https://bugs.freedesktop.org/show\_bug.cgi?id=100576
Cc: "H.J. Lu"
Cc: "Pandiyan, Dhinakaran"
Reviewed-by: Sean Paul
Reviewed-by: Dhinakaran Pandiyan
Signed-off-by: Daniel Vetter
Link: http://patchwork.freedesktop.org/patch/msgid/20170620202837.1701-1-daniel.vetter@ffwll.ch
Signed-off-by: Greg Kroah-Hartman
commit 575cd7d4cec3ad0aa13c9d156fbcc3979db6f3ae
Author: David Howells
Date: Thu Jun 15 00:12:24 2017 +0100
rxrpc: Fix several cases where a padded len isn't checked in ticket decode
commit 5f2f97656ada8d811d3c1bef503ced266fcd53a0 upstream.
This fixes CVE-2017-7482.
When a kerberos 5 ticket is being decoded so that it can be loaded into an
rxrpc-type key, there are several places in which the length of a
variable-length field is checked to make sure that it's not going to
overrun the available data - but the data is padded to the nearest
four-byte boundary and the code doesn't check for this extra. This could
lead to the size-remaining variable wrapping and the data pointer going
over the end of the buffer.
Fix this by making the various variable-length data checks use the padded
length.
Reported-by: 石磊
Signed-off-by: David Howells
Reviewed-by: Marc Dionne
Reviewed-by: Dan Carpenter
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 017294bd93f4c1b3fcd004483195c88cb0f7794e
Author: Jarkko Nikula
Date: Mon Jun 19 15:53:01 2017 +0300
ACPI / scan: Fix enumeration for special SPI and I2C devices
commit e4330d8bf669139a983255d1801733b64c2ae841 upstream.
Commit f406270bf73d ("ACPI / scan: Set the visited flag for all
enumerated devices") caused that two group of special SPI or I2C
devices do not enumerate. SPI and I2C devices are expected to be
enumerated by the SPI and I2C subsystems but change caused that
acpi\_bus\_attach() marks those devices with acpi\_device\_set\_enumerated().
First group of devices are matched using Device Tree compatible property
with special \_HID "PRP0001". Those devices have matched scan handler,
acpi\_scan\_attach\_handler() retuns 1 and acpi\_bus\_attach() marks them
with acpi\_device\_set\_enumerated().
Second group of devices without valid \_HID such as "LNXVIDEO" have
device->pnp.type.platform\_id set to zero and change again marks them
with acpi\_device\_set\_enumerated().
Fix this by flagging the SPI and I2C devices during struct acpi\_device
object initialization time and let the code in acpi\_bus\_attach() to go
through the device\_attach() and acpi\_default\_enumeration() path for all
SPI and I2C devices.
Fixes: f406270bf73d (ACPI / scan: Set the visited flag for all enumerated devices)
Signed-off-by: Jarkko Nikula
Acked-by: Mika Westerberg
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit 3645b8f1fb789a9f5f149e064c32e08124467e15
Author: Rafael J. Wysocki
Date: Mon Apr 17 01:19:50 2017 +0200
ACPI / scan: Apply default enumeration to devices with ACPI drivers
commit f5beabfe61794d9a9d9549d387cda2bffd81e504 upstream.
The current code in acpi\_bus\_attach() is inconsistent with respect
to device objects with ACPI drivers bound to them, as it allows
ACPI drivers to bind to device objects with existing "physical"
device companions, but it doesn't allow "physical" device objects
to be created for ACPI device objects with ACPI drivers bound to
them. Thus, in some cases, the outcome depends on the ordering
of events which is confusing at best.
For this reason, modify acpi\_bus\_attach() to call
acpi\_default\_enumeration() for device objects with the
pnp.type.platform\_id flag set regardless of whether or not
any ACPI drivers are bound to them.
Signed-off-by: Rafael J. Wysocki
Reviewed-by: Mika Westerberg
Reviewed-by: Joey Lee
Cc: Jarkko Nikula
Signed-off-by: Greg Kroah-Hartman
commit e79fccb184cf0b3d014b15f610e10dd1fc8c4950
Author: Junshan Fang
Date: Thu Jun 15 14:02:20 2017 +0800
drm/amdgpu: add Polaris12 DID
commit 6e88491cf2a3b17199c78bd53348b39dc6a88275 upstream.
Signed-off-by: Junshan Fang
Reviewed-by: Roger.He
Signed-off-by: Alex Deucher
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit 033b267d4f6fd2ceb45241d64ad3813087dde663
Author: Alex Deucher
Date: Thu Jun 15 11:12:28 2017 -0400
drm/amdgpu: adjust default display clock
commit 52b482b0f4fd6d5267faf29fe91398e203f3c230 upstream.
Increase the default display clock on newer asics to
accomodate some high res modes with really high refresh
rates.
bug: https://bugs.freedesktop.org/show\_bug.cgi?id=93826
Acked-by: Chunming Zhou
Acked-by: Christian König
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit 0e01b65960f926a9804b4f8d1c388482a9ba9bbe
Author: Alex Deucher
Date: Thu Jun 15 10:55:11 2017 -0400
drm/amdgpu/atom: fix ps allocation size for EnableDispPowerGating
commit 05b4017b37f1fce4b7185f138126dd8decdb381f upstream.
We were using the wrong structure which lead to an overflow
on some boards.
bug: https://bugs.freedesktop.org/show\_bug.cgi?id=101387
Acked-by: Chunming Zhou
Acked-by: Christian König
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit 08a02c2c3f29f448d2b3617f61a8131bde4ae72f
Author: Alex Deucher
Date: Mon Jun 19 15:59:58 2017 -0400
drm/radeon: add a quirk for Toshiba Satellite L20-183
commit acfd6ee4fa7ebeee75511825fe02be3f7ac1d668 upstream.
Fixes resume from suspend.
bug: https://bugzilla.kernel.org/show\_bug.cgi?id=196121
Reported-by: Przemek
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit b54ffeb713420637d7a4e40d8d2d85d43797f7b6
Author: Alex Deucher
Date: Mon Jun 19 12:52:47 2017 -0400
drm/radeon: add a PX quirk for another K53TK variant
commit 4eb59793cca00b0e629b6d55b5abb5acb82c5868 upstream.
Disable PX on these systems.
bug: https://bugs.freedesktop.org/show\_bug.cgi?id=101491
Signed-off-by: Alex Deucher
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit 47a1f8d951dc1e167d7b4a63792303b51377d1c3
Author: Nicholas Bellinger
Date: Wed Jun 7 20:29:50 2017 -0700
iscsi-target: Reject immediate data underflow larger than SCSI transfer length
commit abb85a9b512e8ca7ad04a5a8a6db9664fe644974 upstream.
When iscsi WRITE underflow occurs there are two different scenarios
that can happen.
Normally in practice, when an EDTL vs. SCSI CDB TRANSFER LENGTH
underflow is detected, the iscsi immediate data payload is the
smaller SCSI CDB TRANSFER LENGTH.
That is, when a host fabric LLD is using a fixed size EDTL for
a specific control CDB, the SCSI CDB TRANSFER LENGTH and actual
SCSI payload ends up being smaller than EDTL. In iscsi, this
means the received iscsi immediate data payload matches the
smaller SCSI CDB TRANSFER LENGTH, because there is no more
SCSI payload to accept beyond SCSI CDB TRANSFER LENGTH.
However, it's possible for a malicous host to send a WRITE
underflow where EDTL is larger than SCSI CDB TRANSFER LENGTH,
but incoming iscsi immediate data actually matches EDTL.
In the wild, we've never had a iscsi host environment actually
try to do this.
For this special case, it's wrong to truncate part of the
control CDB payload and continue to process the command during
underflow when immediate data payload received was larger than
SCSI CDB TRANSFER LENGTH, so go ahead and reject and drop the
bogus payload as a defensive action.
Note this potential bug was originally relaxed by the following
for allowing WRITE underflow in MSFT FCP host environments:
commit c72c5250224d475614a00c1d7e54a67f77cd3410
Author: Roland Dreier
Date: Wed Jul 22 15:08:18 2015 -0700
target: allow underflow/overflow for PR OUT etc. commands
Cc: Roland Dreier
Cc: Mike Christie
Cc: Hannes Reinecke
Cc: Martin K. Petersen
Signed-off-by: Nicholas Bellinger
Signed-off-by: Greg Kroah-Hartman
commit 600966d6bc4d1602c17849e9b4eee68240054f0e
Author: Nicholas Bellinger
Date: Sat Jun 3 05:35:47 2017 -0700
iscsi-target: Fix delayed logout processing greater than SECONDS\_FOR\_LOGOUT\_COMP
commit 105fa2f44e504c830697b0c794822112d79808dc upstream.
This patch fixes a BUG() in iscsit\_close\_session() that could be
triggered when iscsit\_logout\_post\_handler() execution from within
tx thread context was not run for more than SECONDS\_FOR\_LOGOUT\_COMP
(15 seconds), and the TCP connection didn't already close before
then forcing tx thread context to automatically exit.
This would manifest itself during explicit logout as:
[33206.974254] 1 connection(s) still exist for iSCSI session to iqn.1993-08.org.debian:01:3f5523242179
[33206.980184] INFO: NMI handler (kgdb\_nmi\_handler) took too long to run: 2100.772 msecs
[33209.078643] ------------[ cut here ]------------
[33209.078646] kernel BUG at drivers/target/iscsi/iscsi\_target.c:4346!
Normally when explicit logout attempt fails, the tx thread context
exits and iscsit\_close\_connection() from rx thread context does the
extra cleanup once it detects conn->conn\_logout\_remove has not been
cleared by the logout type specific post handlers.
To address this special case, if the logout post handler in tx thread
context detects conn->tx\_thread\_active has already been cleared, simply
return and exit in order for existing iscsit\_close\_connection()
logic from rx thread context do failed logout cleanup.
Reported-by: Bart Van Assche
Tested-by: Bart Van Assche
Cc: Mike Christie
Cc: Hannes Reinecke
Cc: Sagi Grimberg
Tested-by: Gary Guo
Tested-by: Chu Yuan Lin
Signed-off-by: Nicholas Bellinger
Signed-off-by: Greg Kroah-Hartman
commit 852a804236ee6d04ec45e639d047b7c88e5e96d8
Author: Nicholas Bellinger
Date: Fri Jun 2 20:00:17 2017 -0700
target: Fix kref->refcount underflow in transport\_cmd\_finish\_abort
commit 73d4e580ccc5c3e05cea002f18111f66c9c07034 upstream.
This patch fixes a se\_cmd->cmd\_kref underflow during CMD\_T\_ABORTED
when a fabric driver drops it's second reference from below the
target\_core\_tmr.c based callers of transport\_cmd\_finish\_abort().
Recently with the conversion of kref to refcount\_t, this bug was
manifesting itself as:
[705519.601034] refcount\_t: underflow; use-after-free.
[705519.604034] INFO: NMI handler (kgdb\_nmi\_handler) took too long to run: 20116.512 msecs
[705539.719111] ------------[ cut here ]------------
[705539.719117] WARNING: CPU: 3 PID: 26510 at lib/refcount.c:184 refcount\_sub\_and\_test+0x33/0x51
Since the original kref atomic\_t based kref\_put() didn't check for
underflow and only invoked the final callback when zero was reached,
this bug did not manifest in practice since all se\_cmd memory is
using preallocated tags.
To address this, go ahead and propigate the existing return from
transport\_put\_cmd() up via transport\_cmd\_finish\_abort(), and
change transport\_cmd\_finish\_abort() + core\_tmr\_handle\_tas\_abort()
callers to only do their local target\_put\_sess\_cmd() if necessary.
Reported-by: Bart Van Assche
Tested-by: Bart Van Assche
Cc: Mike Christie
Cc: Hannes Reinecke
Cc: Christoph Hellwig
Cc: Himanshu Madhani
Cc: Sagi Grimberg
Tested-by: Gary Guo
Tested-by: Chu Yuan Lin
Signed-off-by: Nicholas Bellinger
Signed-off-by: Greg Kroah-Hartman
commit 830146b6390a8f2cedbc7dc5e78331987c0418fa
Author: Will Deacon
Date: Thu Jun 8 16:44:22 2017 -0700
arm64/vdso: Fix nsec handling for CLOCK\_MONOTONIC\_RAW
commit dbb236c1ceb697a559e0694ac4c9e7b9131d0b16 upstream.
Recently vDSO support for CLOCK\_MONOTONIC\_RAW was added in
49eea433b326 ("arm64: Add support for CLOCK\_MONOTONIC\_RAW in
clock\_gettime() vDSO"). Noticing that the core timekeeping code
never set tkr\_raw.xtime\_nsec, the vDSO implementation didn't
bother exposing it via the data page and instead took the
unshifted tk->raw\_time.tv\_nsec value which was then immediately
shifted left in the vDSO code.
Unfortunately, by accellerating the MONOTONIC\_RAW clockid, it
uncovered potential 1ns time inconsistencies caused by the
timekeeping core not handing sub-ns resolution.
Now that the core code has been fixed and is actually setting
tkr\_raw.xtime\_nsec, we need to take that into account in the
vDSO by adding it to the shifted raw\_time value, in order to
fix the user-visible inconsistency. Rather than do that at each
use (and expand the data page in the process), instead perform
the shift/addition operation when populating the data page and
remove the shift from the vDSO code entirely.
[jstultz: minor whitespace tweak, tried to improve commit
message to make it more clear this fixes a regression]
Reported-by: John Stultz
Signed-off-by: Will Deacon
Signed-off-by: John Stultz
Tested-by: Daniel Mentz
Acked-by: Kevin Brodsky
Cc: Prarit Bhargava
Cc: Richard Cochran
Cc: Stephen Boyd
Cc: Miroslav Lichvar
Link: http://lkml.kernel.org/r/1496965462-20003-4-git-send-email-john.stultz@linaro.org
Signed-off-by: Thomas Gleixner
Signed-off-by: Greg Kroah-Hartman
commit 102d12f1567fa3d637bbb2885691fa4aca367f33
Author: John Stultz
Date: Thu Jun 8 16:44:21 2017 -0700
time: Fix CLOCK\_MONOTONIC\_RAW sub-nanosecond accounting
commit 3d88d56c5873f6eebe23e05c3da701960146b801 upstream.
Due to how the MONOTONIC\_RAW accumulation logic was handled,
there is the potential for a 1ns discontinuity when we do
accumulations. This small discontinuity has for the most part
gone un-noticed, but since ARM64 enabled CLOCK\_MONOTONIC\_RAW
in their vDSO clock\_gettime implementation, we've seen failures
with the inconsistency-check test in kselftest.
This patch addresses the issue by using the same sub-ns
accumulation handling that CLOCK\_MONOTONIC uses, which avoids
the issue for in-kernel users.
Since the ARM64 vDSO implementation has its own clock\_gettime
calculation logic, this patch reduces the frequency of errors,
but failures are still seen. The ARM64 vDSO will need to be
updated to include the sub-nanosecond xtime\_nsec values in its
calculation for this issue to be completely fixed.
Signed-off-by: John Stultz
Tested-by: Daniel Mentz
Cc: Prarit Bhargava
Cc: Kevin Brodsky
Cc: Richard Cochran
Cc: Stephen Boyd
Cc: Will Deacon
Cc: Miroslav Lichvar
Link: http://lkml.kernel.org/r/1496965462-20003-3-git-send-email-john.stultz@linaro.org
Signed-off-by: Thomas Gleixner
Signed-off-by: Greg Kroah-Hartman
commit fa79bdd4c3e513d68bd13b40e7dc81b32376dc22
Author: John Stultz
Date: Thu Jun 8 16:44:20 2017 -0700
time: Fix clock->read(clock) race around clocksource changes
commit ceea5e3771ed2378668455fa21861bead7504df5 upstream.
In tests, which excercise switching of clocksources, a NULL
pointer dereference can be observed on AMR64 platforms in the
clocksource read() function:
u64 clocksource\_mmio\_readl\_down(struct clocksource \*c)
{
return ~(u64)readl\_relaxed(to\_mmio\_clksrc(c)->reg) & c->mask;
}
This is called from the core timekeeping code via:
cycle\_now = tkr->read(tkr->clock);
tkr->read is the cached tkr->clock->read() function pointer.
When the clocksource is changed then tkr->clock and tkr->read
are updated sequentially. The code above results in a sequential
load operation of tkr->read and tkr->clock as well.
If the store to tkr->clock hits between the loads of tkr->read
and tkr->clock, then the old read() function is called with the
new clock pointer. As a consequence the read() function
dereferences a different data structure and the resulting 'reg'
pointer can point anywhere including NULL.
This problem was introduced when the timekeeping code was
switched over to use struct tk\_read\_base. Before that, it was
theoretically possible as well when the compiler decided to
reload clock in the code sequence:
now = tk->clock->read(tk->clock);
Add a helper function which avoids the issue by reading
tk\_read\_base->clock once into a local variable clk and then issue
the read function via clk->read(clk). This guarantees that the
read() function always gets the proper clocksource pointer handed
in.
Since there is now no use for the tkr.read pointer, this patch
also removes it, and to address stopping the fast timekeeper
during suspend/resume, it introduces a dummy clocksource to use
rather then just a dummy read function.
Signed-off-by: John Stultz
Acked-by: Ingo Molnar
Cc: Prarit Bhargava
Cc: Richard Cochran
Cc: Stephen Boyd
Cc: Miroslav Lichvar
Cc: Daniel Mentz
Link: http://lkml.kernel.org/r/1496965462-20003-2-git-send-email-john.stultz@linaro.org
Signed-off-by: Thomas Gleixner
Signed-off-by: Greg Kroah-Hartman
commit 0f3ae212fc0481c45db124bc858a129f897fd18b
Author: Arend Van Spriel
Date: Mon Jun 12 12:47:34 2017 +0100
brcmfmac: unbind all devices upon failure in firmware callback
commit 7a51461fc2da82a6c565a3ee65c41c197f28225d upstream.
When request firmware fails, brcmf\_ops\_sdio\_remove is being called and
brcmf\_bus freed. In such circumstancies if you do a suspend/resume cycle
the kernel hangs on resume due a NULL pointer dereference in resume
function. So in brcmf\_sdio\_firmware\_callback() we need to unbind the
driver from both sdio\_func devices when firmware load failure is indicated.
Tested-by: Enric Balletbo i Serra
Reviewed-by: Hante Meuleman
Reviewed-by: Pieter-Paul Giesberts
Reviewed-by: Franky Lin
Signed-off-by: Arend van Spriel
Signed-off-by: Kalle Valo
Signed-off-by: Greg Kroah-Hartman
commit 2cb9b88c7ddcfe80d5dc2f9015e7dfd34bf53ecb
Author: Arend Van Spriel
Date: Mon Jun 12 12:47:33 2017 +0100
brcmfmac: use firmware callback upon failure to load
commit 03fb0e8393fae8ebb6710a99387853ed0becbc8e upstream.
When firmware loading failed the code used to unbind the device provided
by the calling code. However, for the sdio driver two devices are bound
and both need to be released upon failure. The callback has been extended
with parameter to pass error code so add that in this commit upon firmware
loading failure.
Reviewed-by: Hante Meuleman
Reviewed-by: Pieter-Paul Giesberts
Reviewed-by: Franky Lin
Signed-off-by: Arend van Spriel
Signed-off-by: Kalle Valo
Signed-off-by: Greg Kroah-Hartman
commit 1e5c71934d0907f5fd59763cbf9a3e63fa205e3b
Author: Arend Van Spriel
Date: Mon Jun 12 12:47:32 2017 +0100
brcmfmac: add parameter to pass error code in firmware callback
commit 6d0507a777fbc533f7f1bf5664a81982dd50dece upstream.
Extend the parameters in the firmware callback so it can be called
upon success and failure. This allows the caller to properly clear
all resources in the failure path. Right now the error code is
always zero, ie. success.
Reviewed-by: Hante Meuleman
Reviewed-by: Pieter-Paul Giesberts
Reviewed-by: Franky Lin
Signed-off-by: Arend van Spriel
Signed-off-by: Kalle Valo
Signed-off-by: Greg Kroah-Hartman
commit b6bfede20b73939dd8862cf32b3d3619845295fb
Author: Daniel Drake
Date: Mon Jun 19 19:48:52 2017 -0700
Input: i8042 - add Fujitsu Lifebook AH544 to notimeout list
commit 817ae460c784f32cd45e60b2b1b21378c3c6a847 upstream.
Without this quirk, the touchpad is not responsive on this product, with
the following message repeated in the logs:
psmouse serio1: bad data from KBC - timeout
Add it to the notimeout list alongside other similar Fujitsu laptops.
Signed-off-by: Daniel Drake
Signed-off-by: Dmitry Torokhov
Signed-off-by: Greg Kroah-Hartman
commit fc1c180ba6e8b000784a4b0e71e4d8db8ba38b3f
Author: Naveen N. Rao
Date: Wed Jun 14 00:12:00 2017 +0530
powerpc/64s: Handle data breakpoints in Radix mode
commit d89ba5353f301971dd7d2f9fdf25c4432728f38e upstream.
On Power9, trying to use data breakpoints throws the splat shown
below. This is because the check for a data breakpoint in DSISR is in
do\_hash\_page(), which is not called when in Radix mode.
Unable to handle kernel paging request for data at address 0xc000000000e19218
Faulting instruction address: 0xc0000000001155e8
cpu 0x0: Vector: 300 (Data Access) at [c0000000ef1e7b20]
pc: c0000000001155e8: find\_pid\_ns+0x48/0xe0
lr: c000000000116ac4: find\_task\_by\_vpid+0x44/0x90
sp: c0000000ef1e7da0
msr: 9000000000009033
dar: c000000000e19218
dsisr: 400000
Move the check to handle\_page\_fault() so as to catch data breakpoints
in both Hash and Radix MMU modes.
We have to change the check in do\_hash\_page() against 0xa410 to use
0xa450, so as to include the value of (DSISR\_DABRMATCH << 16).
There are two sites that call handle\_page\_fault() when in Radix, both
already pass DSISR in r4.
Fixes: caca285e5ab4 ("powerpc/mm/radix: Use STD\_MMU\_64 to properly isolate hash related code")
Reported-by: Shriya R. Kulkarni
Signed-off-by: Naveen N. Rao
[mpe: Fix the fall-through case on hash, we need to reload DSISR]
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit 7a6c505366cc259f0bf39a7fc703501a55f48d33
Author: Naveen N. Rao
Date: Thu Jun 1 16:18:15 2017 +0530
powerpc/kprobes: Pause function\_graph tracing during jprobes handling
commit a9f8553e935f26cb5447f67e280946b0923cd2dc upstream.
This fixes a crash when function\_graph and jprobes are used together.
This is essentially commit 237d28db036e ("ftrace/jprobes/x86: Fix
conflict between jprobes and function graph tracing"), but for powerpc.
Jprobes breaks function\_graph tracing since the jprobe hook needs to use
jprobe\_return(), which never returns back to the hook, but instead to
the original jprobe'd function. The solution is to momentarily pause
function\_graph tracing before invoking the jprobe hook and re-enable it
when returning back to the original jprobe'd function.
Fixes: 6794c78243bf ("powerpc64: port of the function graph tracer")
Signed-off-by: Naveen N. Rao
Acked-by: Masami Hiramatsu
Acked-by: Steven Rostedt (VMware)
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit e6281e0df1887c1032f7f789bba0e1bd2ab7ad45
Author: Eric W. Biederman
Date: Tue Jun 13 04:31:16 2017 -0500
signal: Only reschedule timers on signals timers have sent
commit 57db7e4a2d92c2d3dfbca4ef8057849b2682436b upstream.
Thomas Gleixner wrote:
> The CRIU support added a 'feature' which allows a user space task to send
> arbitrary (kernel) signals to itself. The changelog says:
>
> The kernel prevents sending of siginfo with positive si\_code, because
> these codes are reserved for kernel. I think we can allow a task to
> send such a siginfo to itself. This operation should not be dangerous.
>
> Quite contrary to that claim, it turns out that it is outright dangerous
> for signals with info->si\_code == SI\_TIMER. The following code sequence in
> a user space task allows to crash the kernel:
>
> id = timer\_create(CLOCK\_XXX, ..... signo = SIGX);
> timer\_set(id, ....);
> info->si\_signo = SIGX;
> info->si\_code = SI\_TIMER:
> info->\_sifields.\_timer.\_tid = id;
> info->\_sifields.\_timer.\_sys\_private = 2;
> rt\_[tg]sigqueueinfo(..., SIGX, info);
> sigemptyset(&sigset);
> sigaddset(&sigset, SIGX);
> rt\_sigtimedwait(sigset, info);
>
> For timers based on CLOCK\_PROCESS\_CPUTIME\_ID, CLOCK\_THREAD\_CPUTIME\_ID this
> results in a kernel crash because sigwait() dequeues the signal and the
> dequeue code observes:
>
> info->si\_code == SI\_TIMER && info->\_sifields.\_timer.\_sys\_private != 0
>
> which triggers the following callchain:
>
> do\_schedule\_next\_timer() -> posix\_cpu\_timer\_schedule() -> arm\_timer()
>
> arm\_timer() executes a list\_add() on the timer, which is already armed via
> the timer\_set() syscall. That's a double list add which corrupts the posix
> cpu timer list. As a consequence the kernel crashes on the next operation
> touching the posix cpu timer list.
>
> Posix clocks which are internally implemented based on hrtimers are not
> affected by this because hrtimer\_start() can handle already armed timers
> nicely, but it's a reliable way to trigger the WARN\_ON() in
> hrtimer\_forward(), which complains about calling that function on an
> already armed timer.
This problem has existed since the posix timer code was merged into
2.5.63. A few releases earlier in 2.5.60 ptrace gained the ability to
inject not just a signal (which linux has supported since 1.0) but the
full siginfo of a signal.
The core problem is that the code will reschedule in response to
signals getting dequeued not just for signals the timers sent but
for other signals that happen to a si\_code of SI\_TIMER.
Avoid this confusion by testing to see if the queued signal was
preallocated as all timer signals are preallocated, and so far
only the timer code preallocates signals.
Move the check for if a timer needs to be rescheduled up into
collect\_signal where the preallocation check must be performed,
and pass the result back to dequeue\_signal where the code reschedules
timers. This makes it clear why the code cares about preallocated
timers.
Reported-by: Thomas Gleixner
History Tree: https://git.kernel.org/pub/scm/linux/kernel/git/tglx/history.git
Reference: 66dd34ad31e5 ("signal: allow to send any siginfo to itself")
Reference: 1669ce53e2ff ("Add PTRACE\_GETSIGINFO and PTRACE\_SETSIGINFO")
Fixes: db8b50ba75f2 ("[PATCH] POSIX clocks & timers")
Signed-off-by: "Eric W. Biederman"
Signed-off-by: Greg Kroah-Hartman
commit 3a182635e01636c8c021b53ce103efa95125d460
Author: Jason A. Donenfeld
Date: Thu Jun 15 00:45:26 2017 +0200
random: silence compiler warnings and fix race
commit 4a072c71f49b0a0e495ea13423bdb850da73c58c upstream.
Odd versions of gcc for the sh4 architecture will actually warn about
flags being used while uninitialized, so we set them to zero. Non crazy
gccs will optimize that out again, so it doesn't make a difference.
Next, over aggressive gccs could inline the expression that defines
use\_lock, which could then introduce a race resulting in a lock
imbalance. By using READ\_ONCE, we prevent that fate. Finally, we make
that assignment const, so that gcc can still optimize a nice amount.
Finally, we fix a potential deadlock between primary\_crng.lock and
batched\_entropy\_reset\_lock, where they could be called in opposite
order. Moving the call to invalidate\_batched\_entropy to outside the lock
rectifies this issue.
Fixes: b169c13de473a85b3c859bb36216a4cb5f00a54a
Signed-off-by: Jason A. Donenfeld
Signed-off-by: Theodore Ts'o
Signed-off-by: Greg Kroah-Hartman
commit 1429fdb15fd9dc9ecb8eb7616b1f8c0a65a42762
Author: Sebastian Parschauer
Date: Tue Jun 6 13:53:13 2017 +0200
HID: Add quirk for Dell PIXART OEM mouse
commit 3db28271f0feae129262d30e41384a7c4c767987 upstream.
This mouse is also known under other IDs. It needs the quirk
ALWAYS\_POLL or will disconnect in runlevel 1 or 3.
Signed-off-by: Sebastian Parschauer
Signed-off-by: Jiri Kosina
Signed-off-by: Greg Kroah-Hartman
commit abef7afb35a99572d975f3e38bdc86e6f2a23cd6
Author: Raju Rangoju
Date: Mon Jun 19 19:46:00 2017 +0530
cxgb4: notify uP to route ctrlq compl to rdma rspq
commit dec6b33163d24e2c19ba521c89fffbaab53ae986 upstream.
During the module initialisation there is a possible race
(basically race between uld and lld) where neither the uld
nor lld notifies the uP about where to route the ctrl queue
completions. LLD skips notifying uP as the rdma queues were
not created by then (will leave it to ULD to notify the uP).
As the ULD comes up, it also skips notifying the uP as the
flag FULL\_INIT\_DONE is not set yet (ULD assumes that the
interface is not up yet).
Consequently, this race between uld and lld leaves uP
unnotified about where to send the ctrl queue completions
to, leading to iwarp RI\_RES WR failure.
Here is the race:
CPU 0 CPU1
- allocates nic rx queus
- t4\_sge\_alloc\_ctrl\_txq()
(if rdma rsp queues exists,
tell uP to route ctrl queue
compl to rdma rspq)
- acquires the mutex\_lock
- allocates rdma response queues
- if FULL\_INIT\_DONE set,
tell uP to route ctrl queue compl
to rdma rspq
- relinquishes mutex\_lock
- acquires the mutex\_lock
- enable\_rx()
- set FULL\_INIT\_DONE
- relinquishes mutex\_lock
This patch fixes the above issue.
Fixes: e7519f9926f1('cxgb4: avoid enabling napi twice to the same queue')
Signed-off-by: Raju Rangoju
Acked-by: Steve Wise
Signed-off-by: Ganesh Goudar
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 4eec15d336aab2a7133859c2e9270809c5a66b08
Author: Christophe Jaillet
Date: Sun Jun 11 09:12:47 2017 +0200
CIFS: Fix some return values in case of error in 'crypt\_message'
commit 517a6e43c4872c89794af5b377fa085e47345952 upstream.
'rc' is known to be 0 at this point. So if 'init\_sg' or 'kzalloc' fails, we
should return -ENOMEM instead.
Also remove a useless 'rc' in a debug message as it is meaningless here.
Fixes: 026e93dc0a3ee ("CIFS: Encrypt SMB3 requests before sending")
Signed-off-by: Christophe JAILLET
Reviewed-by: Pavel Shilovsky
Reviewed-by: Aurelien Aptel
Signed-off-by: Steve French
Signed-off-by: Greg Kroah-Hartman
commit dcaa5a53ccfd82c1a0c152ac771381a83e7a65e0
Author: Pavel Shilovsky
Date: Tue Jun 6 16:58:58 2017 -0700
CIFS: Improve readdir verbosity
commit dcd87838c06f05ab7650b249ebf0d5b57ae63e1e upstream.
Downgrade the loglevel for SMB2 to prevent filling the log
with messages if e.g. readdir was interrupted. Also make SMB2
and SMB1 codepaths do the same logging during readdir.
Signed-off-by: Pavel Shilovsky
Signed-off-by: Steve French
Signed-off-by: Greg Kroah-Hartman
commit 3ff8eda23a8a2d59ed19bffa9642726f1919669a
Author: Paul Mackerras
Date: Fri Jun 16 11:53:19 2017 +1000
KVM: PPC: Book3S HV: Save/restore host values of debug registers
commit 7ceaa6dcd8c6f59588428cec37f3c8093dd1011f upstream.
At present, HV KVM on POWER8 and POWER9 machines loses any instruction
or data breakpoint set in the host whenever a guest is run.
Instruction breakpoints are currently only used by xmon, but ptrace
and the perf\_event subsystem can set data breakpoints as well as xmon.
To fix this, we save the host values of the debug registers (CIABR,
DAWR and DAWRX) before entering the guest and restore them on exit.
To provide space to save them in the stack frame, we expand the stack
frame allocated by kvmppc\_hv\_entry() from 112 to 144 bytes.
Fixes: b005255e12a3 ("KVM: PPC: Book3S HV: Context-switch new POWER8 SPRs", 2014-01-08)
Signed-off-by: Paul Mackerras
Signed-off-by: Greg Kroah-Hartman
commit 324df574b964ca030e3fe4469bc9a38b6bc1e9b1
Author: Paul Mackerras
Date: Thu Jun 15 15:43:17 2017 +1000
KVM: PPC: Book3S HV: Restore critical SPRs to host values on guest exit
commit 4c3bb4ccd074e1a0552078c0bf94c662367a1658 upstream.
This restores several special-purpose registers (SPRs) to sane values
on guest exit that were missed before.
TAR and VRSAVE are readable and writable by userspace, and we need to
save and restore them to prevent the guest from potentially affecting
userspace execution (not that TAR or VRSAVE are used by any known
program that run uses the KVM\_RUN ioctl). We save/restore these
in kvmppc\_vcpu\_run\_hv() rather than on every guest entry/exit.
FSCR affects userspace execution in that it can prohibit access to
certain facilities by userspace. We restore it to the normal value
for the task on exit from the KVM\_RUN ioctl.
IAMR is normally 0, and is restored to 0 on guest exit. However,
with a radix host on POWER9, it is set to a value that prevents the
kernel from executing user-accessible memory. On POWER9, we save
IAMR on guest entry and restore it on guest exit to the saved value
rather than 0. On POWER8 we continue to set it to 0 on guest exit.
PSPB is normally 0. We restore it to 0 on guest exit to prevent
userspace taking advantage of the guest having set it non-zero
(which would allow userspace to set its SMT priority to high).
UAMOR is normally 0. We restore it to 0 on guest exit to prevent
the AMR from being used as a covert channel between userspace
processes, since the AMR is not context-switched at present.
Fixes: b005255e12a3 ("KVM: PPC: Book3S HV: Context-switch new POWER8 SPRs", 2014-01-08)
Signed-off-by: Paul Mackerras
Signed-off-by: Greg Kroah-Hartman
commit 4ae3f3581ff3a021bd40bd1e2cda704d737b8b3d
Author: Paul Mackerras
Date: Tue Jun 6 16:47:22 2017 +1000
KVM: PPC: Book3S HV: Context-switch EBB registers properly
commit ca8efa1df1d15a1795a2da57f9f6aada6ed6b946 upstream.
This adds code to save the values of three SPRs (special-purpose
registers) used by userspace to control event-based branches (EBBs),
which are essentially interrupts that get delivered directly to
userspace. These registers are loaded up with guest values when
entering the guest, and their values are saved when exiting the
guest, but we were not saving the host values and restoring them
before going back to userspace.
On POWER8 this would only affect userspace programs which explicitly
request the use of EBBs and also use the KVM\_RUN ioctl, since the
only source of EBBs on POWER8 is the PMU, and there is an explicit
enable bit in the PMU registers (and those PMU registers do get
properly context-switched between host and guest). On POWER9 there
is provision for externally-generated EBBs, and these are not subject
to the control in the PMU registers.
Since these registers only affect userspace, we can save them when
we first come in from userspace and restore them before returning to
userspace, rather than saving/restoring the host values on every
guest entry/exit. Similarly, we don't need to worry about their
values on offline secondary threads since they execute in the context
of the idle task, which never executes in userspace.
Fixes: b005255e12a3 ("KVM: PPC: Book3S HV: Context-switch new POWER8 SPRs", 2014-01-08)
Signed-off-by: Paul Mackerras
Signed-off-by: Greg Kroah-Hartman
commit a7d29e276e1b9ec0d67f7788f356a9f81c4443ad
Author: Paul Mackerras
Date: Tue Jun 6 14:35:30 2017 +1000
KVM: PPC: Book3S HV: Ignore timebase offset on POWER9 DD1
commit 3d3efb68c19e539f0535c93a5258c1299270215f upstream.
POWER9 DD1 has an erratum where writing to the TBU40 register, which
is used to apply an offset to the timebase, can cause the timebase to
lose counts. This results in the timebase on some CPUs getting out of
sync with other CPUs, which then results in misbehaviour of the
timekeeping code.
To work around the problem, we make KVM ignore the timebase offset for
all guests on POWER9 DD1 machines. This means that live migration
cannot be supported on POWER9 DD1 machines.
Signed-off-by: Paul Mackerras
Signed-off-by: Greg Kroah-Hartman
commit 4d9c6828d004dec97fe7b757e13d309e6d566a90
Author: Paul Mackerras
Date: Thu Jun 15 16:10:27 2017 +1000
KVM: PPC: Book3S HV: Preserve userspace HTM state properly
commit 46a704f8409f79fd66567ad3f8a7304830a84293 upstream.
If userspace attempts to call the KVM\_RUN ioctl when it has hardware
transactional memory (HTM) enabled, the values that it has put in the
HTM-related SPRs TFHAR, TFIAR and TEXASR will get overwritten by
guest values. To fix this, we detect this condition and save those
SPR values in the thread struct, and disable HTM for the task. If
userspace goes to access those SPRs or the HTM facility in future,
a TM-unavailable interrupt will occur and the handler will reload
those SPRs and re-enable HTM.
If userspace has started a transaction and suspended it, we would
currently lose the transactional state in the guest entry path and
would almost certainly get a "TM Bad Thing" interrupt, which would
cause the host to crash. To avoid this, we detect this case and
return from the KVM\_RUN ioctl with an EINVAL error, with the KVM
exit reason set to KVM\_EXIT\_FAIL\_ENTRY.
Fixes: b005255e12a3 ("KVM: PPC: Book3S HV: Context-switch new POWER8 SPRs", 2014-01-08)
Signed-off-by: Paul Mackerras
Signed-off-by: Greg Kroah-Hartman
commit 1e0d799688df53ceaecb1f09716466d0368b4a2a
Author: Paul Mackerras
Date: Mon May 22 16:25:14 2017 +1000
KVM: PPC: Book3S HV: Cope with host using large decrementer mode
commit 2f2724630f7a8d582470f03ee56b96746767d270 upstream.
POWER9 introduces a new mode for the decrementer register, called
large decrementer mode, in which the decrementer counter is 56 bits
wide rather than 32, and reads are sign-extended rather than
zero-extended. For the decrementer, this new mode is optional and
controlled by a bit in the LPCR. The hypervisor decrementer (HDEC)
is 56 bits wide on POWER9 and has no mode control.
Since KVM code reads and writes the decrementer and hypervisor
decrementer registers in a few places, it needs to be aware of the
need to treat the decrementer value as a 64-bit quantity, and only do
a 32-bit sign extension when large decrementer mode is not in effect.
Similarly, the HDEC should always be treated as a 64-bit quantity on
POWER9. We define a new EXTEND\_HDEC macro to encapsulate the feature
test for POWER9 and the sign extension.
To enable the sign extension to be removed in large decrementer mode,
we test the LPCR\_LD bit in the host LPCR image stored in the struct
kvm for the guest. If is set then large decrementer mode is enabled
and the sign extension should be skipped.
This is partly based on an earlier patch by Oliver O'Halloran.
Signed-off-by: Paul Mackerras
Signed-off-by: Greg Kroah-Hartman
commit 5d34bddddcdbe45e04dc22b4bdad32bf7f116d02
Author: Heiko Carstens
Date: Mon Jun 19 08:02:28 2017 +0200
KVM: s390: gaccess: fix real-space designation asce handling for gmap shadows
commit addb63c18a0d52a9ce2611d039f981f7b6148d2b upstream.
For real-space designation asces the asce origin part is only a token.
The asce token origin must not be used to generate an effective
address for storage references. This however is erroneously done
within kvm\_s390\_shadow\_tables().
Furthermore within the same function the wrong parts of virtual
addresses are used to generate a corresponding real address
(e.g. the region second index is used as region first index).
Both of the above can result in incorrect address translations. Only
for real space designations with a token origin of zero and addresses
below one megabyte the translation was correct.
Furthermore replace a "!asce.r" statement with a "!\*fake" statement to
make it more obvious that a specific condition has nothing to do with
the architecture, but with the fake handling of real space designations.
Fixes: 3218f7094b6b ("s390/mm: support real-space for gmap shadows")
Cc: David Hildenbrand
Signed-off-by: Heiko Carstens
Reviewed-by: Martin Schwidefsky
Signed-off-by: Christian Borntraeger
Signed-off-by: Greg Kroah-Hartman
commit 87ee4cdd8cd6dfbb14039739ddeaefff328f824e
Author: James Cowgill
Date: Tue Jun 20 10:57:51 2017 +0100
KVM: MIPS: Fix maybe-uninitialized build failure
commit e27a9eca5d4a392b96ce5d5238c8d637bcb0a52c upstream.
This commit fixes a "maybe-uninitialized" build failure in
arch/mips/kvm/tlb.c when KVM, DYNAMIC\_DEBUG and JUMP\_LABEL are all
enabled. The failure is:
In file included from ./include/linux/printk.h:329:0,
from ./include/linux/kernel.h:13,
from ./include/asm-generic/bug.h:15,
from ./arch/mips/include/asm/bug.h:41,
from ./include/linux/bug.h:4,
from ./include/linux/thread\_info.h:11,
from ./include/asm-generic/current.h:4,
from ./arch/mips/include/generated/asm/current.h:1,
from ./include/linux/sched.h:11,
from arch/mips/kvm/tlb.c:13:
arch/mips/kvm/tlb.c: In function ‘kvm\_mips\_host\_tlb\_inv’:
./include/linux/dynamic\_debug.h:126:3: error: ‘idx\_kernel’ may be used uninitialized in this function [-Werror=maybe-uninitialized]
\_\_dynamic\_pr\_debug(&descriptor, pr\_fmt(fmt), \
^~~~~~~~~~~~~~~~~~
arch/mips/kvm/tlb.c:169:16: note: ‘idx\_kernel’ was declared here
int idx\_user, idx\_kernel;
^~~~~~~~~~
There is a similar error relating to "idx\_user". Both errors were
observed with GCC 6.
As far as I can tell, it is impossible for either idx\_user or idx\_kernel
to be uninitialized when they are later read in the calls to kvm\_debug,
but to satisfy the compiler, add zero initializers to both variables.
Signed-off-by: James Cowgill
Fixes: 57e3869cfaae ("KVM: MIPS/TLB: Generalise host TLB invalidate to kernel ASID")
Acked-by: James Hogan
Signed-off-by: Radim Krčmář
Signed-off-by: Greg Kroah-Hartman
commit 3af2b32a50c23af81403e6fed880f18e9ae0cb30
Author: Paolo Bonzini
Date: Wed Jun 7 15:13:14 2017 +0200
KVM: x86: fix singlestepping over syscall
commit c8401dda2f0a00cd25c0af6a95ed50e478d25de4 upstream.
TF is handled a bit differently for syscall and sysret, compared
to the other instructions: TF is checked after the instruction completes,
so that the OS can disable #DB at a syscall by adding TF to FMASK.
When the sysret is executed the #DB is taken "as if" the syscall insn
just completed.
KVM emulates syscall so that it can trap 32-bit syscall on Intel processors.
Fix the behavior, otherwise you could get #DB on a user stack which is not
nice. This does not affect Linux guests, as they use an IST or task gate
for #DB.
This fixes CVE-2017-7518.
Reported-by: Andy Lutomirski
Signed-off-by: Paolo Bonzini
Signed-off-by: Radim Krčmář
Signed-off-by: Greg Kroah-Hartman
commit 75d735389044a333d6ecd44e03fb25f8b413bf92
Author: Björn Töpel
Date: Wed Jun 21 18:41:34 2017 +0200
perf probe: Fix probe definition for inlined functions
commit 7598f8bc1383ffd77686cb4e92e749bef3c75937 upstream.
In commit 613f050d68a8 ("perf probe: Fix to probe on gcc generated
functions in modules"), the offset from symbol is, incorrectly, added
to the trace point address. This leads to incorrect probe trace points
for inlined functions and when using relative line number on symbols.
Prior this patch:
$ perf probe -m nf\_nat -D in\_range
p:probe/in\_range nf\_nat:in\_range.isra.9+0
$ perf probe -m i40e -D i40e\_clean\_rx\_irq
p:probe/i40e\_clean\_rx\_irq i40e:i40e\_napi\_poll+2212
$ perf probe -m i40e -D i40e\_clean\_rx\_irq:16
p:probe/i40e\_clean\_rx\_irq i40e:i40e\_lan\_xmit\_frame+626
After:
$ perf probe -m nf\_nat -D in\_range
p:probe/in\_range nf\_nat:in\_range.isra.9+0
$ perf probe -m i40e -D i40e\_clean\_rx\_irq
p:probe/i40e\_clean\_rx\_irq i40e:i40e\_napi\_poll+1106
$ perf probe -m i40e -D i40e\_clean\_rx\_irq:16
p:probe/i40e\_clean\_rx\_irq i40e:i40e\_napi\_poll+2665
Committer testing:
Using 'pfunct', a tool found in the 'dwarves' package [1], one can ask what are
the functions that while not being explicitely marked as inline, were inlined
by the compiler:
# pfunct --cc\_inlined /lib/modules/4.12.0-rc4+/kernel/drivers/net/ethernet/intel/e1000e/e1000e.ko | head
\_\_ew32
e1000\_regdump
e1000e\_dump\_ps\_pages
e1000\_desc\_unused
e1000e\_systim\_to\_hwtstamp
e1000e\_rx\_hwtstamp
e1000e\_update\_rdt\_wa
e1000e\_update\_tdt\_wa
e1000\_put\_txbuf
e1000\_consume\_page
Then ask 'perf probe' to produce the kprobe\_tracer probe definitions for two of
them:
# perf probe -m e1000e -D e1000e\_rx\_hwtstamp
p:probe/e1000e\_rx\_hwtstamp e1000e:e1000\_receive\_skb+74
# perf probe -m e1000e -D e1000\_consume\_page
p:probe/e1000\_consume\_page e1000e:e1000\_clean\_jumbo\_rx\_irq+876
p:probe/e1000\_consume\_page\_1 e1000e:e1000\_clean\_jumbo\_rx\_irq+1506
p:probe/e1000\_consume\_page\_2 e1000e:e1000\_clean\_rx\_irq\_ps+1074
Now lets concentrate on the 'e1000\_consume\_page' one, that was inlined twice in
e1000\_clean\_jumbo\_rx\_irq(), lets see what readelf says about the DWARF tags for
that function:
$ readelf -wi /lib/modules/4.12.0-rc4+/kernel/drivers/net/ethernet/intel/e1000e/e1000e.ko
<1><13e27b>: Abbrev Number: 121 (DW\_TAG\_subprogram)
<13e27c> DW\_AT\_name : (indirect string, offset: 0xa8945): e1000\_clean\_jumbo\_rx\_irq
<13e287> DW\_AT\_low\_pc : 0x17a30
<3><13e6ef>: Abbrev Number: 119 (DW\_TAG\_inlined\_subroutine)
<13e6f0> DW\_AT\_abstract\_origin: <0x13ed2c>
<13e6f4> DW\_AT\_low\_pc : 0x17be6
<1><13ed2c>: Abbrev Number: 142 (DW\_TAG\_subprogram)
<13ed2e> DW\_AT\_name : (indirect string, offset: 0xa54c3): e1000\_consume\_page
So, the first time in e1000\_clean\_jumbo\_rx\_irq() where e1000\_consume\_page() is
inlined is at PC 0x17be6, which subtracted from e1000\_clean\_jumbo\_rx\_irq()'s
address, gives us the offset we should use in the probe definition:
0x17be6 - 0x17a30 = 438
but above we have 876, which is twice as much.
Lets see the second inline expansion of e1000\_consume\_page() in
e1000\_clean\_jumbo\_rx\_irq():
<3><13e86e>: Abbrev Number: 119 (DW\_TAG\_inlined\_subroutine)
<13e86f> DW\_AT\_abstract\_origin: <0x13ed2c>
<13e873> DW\_AT\_low\_pc : 0x17d21
0x17d21 - 0x17a30 = 753
So we where adding it at twice the offset from the containing function as we
should.
And then after this patch:
# perf probe -m e1000e -D e1000e\_rx\_hwtstamp
p:probe/e1000e\_rx\_hwtstamp e1000e:e1000\_receive\_skb+37
# perf probe -m e1000e -D e1000\_consume\_page
p:probe/e1000\_consume\_page e1000e:e1000\_clean\_jumbo\_rx\_irq+438
p:probe/e1000\_consume\_page\_1 e1000e:e1000\_clean\_jumbo\_rx\_irq+753
p:probe/e1000\_consume\_page\_2 e1000e:e1000\_clean\_jumbo\_rx\_irq+1353
#
Which matches the two first expansions and shows that because we were
doubling the offset it would spill over the next function:
readelf -sw /lib/modules/4.12.0-rc4+/kernel/drivers/net/ethernet/intel/e1000e/e1000e.ko
673: 0000000000017a30 1626 FUNC LOCAL DEFAULT 2 e1000\_clean\_jumbo\_rx\_irq
674: 0000000000018090 2013 FUNC LOCAL DEFAULT 2 e1000\_clean\_rx\_irq\_ps
This is the 3rd inline expansion of e1000\_consume\_page() in
e1000\_clean\_jumbo\_rx\_irq():
<3><13ec77>: Abbrev Number: 119 (DW\_TAG\_inlined\_subroutine)
<13ec78> DW\_AT\_abstract\_origin: <0x13ed2c>
<13ec7c> DW\_AT\_low\_pc : 0x17f79
0x17f79 - 0x17a30 = 1353
So:
0x17a30 + 2 \* 1353 = 0x184c2
And:
0x184c2 - 0x18090 = 1074
Which explains the bogus third expansion for e1000\_consume\_page() to end up at:
p:probe/e1000\_consume\_page\_2 e1000e:e1000\_clean\_rx\_irq\_ps+1074
All fixed now :-)
[1] https://git.kernel.org/pub/scm/devel/pahole/pahole.git/
Signed-off-by: Björn Töpel
Tested-by: Arnaldo Carvalho de Melo
Acked-by: Magnus Karlsson
Acked-by: Masami Hiramatsu
Fixes: 613f050d68a8 ("perf probe: Fix to probe on gcc generated functions in modules")
Link: http://lkml.kernel.org/r/20170621164134.5701-1-bjorn.topel@gmail.com
Signed-off-by: Arnaldo Carvalho de Melo
Signed-off-by: Greg Kroah-Hartman
commit d46eda1978c83f07e64d76e5710d4ec7716ef30b
Author: Kan Liang
Date: Mon Jun 19 07:26:09 2017 -0700
perf/x86/intel: Add 1G DTLB load/store miss support for SKL
commit fb3a5055cd7098f8d1dd0cd38d7172211113255f upstream.
Current DTLB load/store miss events (0x608/0x649) only counts 4K,2M and
4M page size.
Need to extend the events to support any page size (4K/2M/4M/1G).
The complete DTLB load/store miss events are:
DTLB\_LOAD\_MISSES.WALK\_COMPLETED 0xe08
DTLB\_STORE\_MISSES.WALK\_COMPLETED 0xe49
Signed-off-by: Kan Liang
Cc: Alexander Shishkin
Cc: Arnaldo Carvalho de Melo
Cc: Jiri Olsa
Cc: Linus Torvalds
Cc: Peter Zijlstra
Cc: Thomas Gleixner
Cc: eranian@google.com
Link: http://lkml.kernel.org/r/20170619142609.11058-1-kan.liang@intel.com
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit 1a640581c85fac9b11e317d317c3f9b0a911e257
Author: Ilya Matveychikov
Date: Fri Jun 23 15:08:49 2017 -0700
lib/cmdline.c: fix get\_options() overflow while parsing ranges
commit a91e0f680bcd9e10c253ae8b62462a38bd48f09f upstream.
When using get\_options() it's possible to specify a range of numbers,
like 1-100500. The problem is that it doesn't track array size while
calling internally to get\_range() which iterates over the range and
fills the memory with numbers.
Link: http://lkml.kernel.org/r/2613C75C-B04D-4BFF-82A6-12F97BA0F620@gmail.com
Signed-off-by: Ilya V. Matveychikov
Cc: Jonathan Corbet
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 5f83a744143d999dc89bd30277a4bc673a7dbb0d
Author: Jan Kara
Date: Fri Jun 23 15:08:46 2017 -0700
fs/dax.c: fix inefficiency in dax\_writeback\_mapping\_range()
commit 1eb643d02b21412e603b42cdd96010a2ac31c05f upstream.
dax\_writeback\_mapping\_range() fails to update iteration index when
searching radix tree for entries needing cache flushing. Thus each
pagevec worth of entries is searched starting from the start which is
inefficient and prone to livelocks. Update index properly.
Link: http://lkml.kernel.org/r/20170619124531.21491-1-jack@suse.cz
Fixes: 9973c98ecfda3 ("dax: add support for fsync/sync")
Signed-off-by: Jan Kara
Reviewed-by: Ross Zwisler
Cc: Dan Williams
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 909c25623aca614a9074ddc7bd8433447f39bcf6
Author: NeilBrown
Date: Fri Jun 23 15:08:43 2017 -0700
autofs: sanity check status reported with AUTOFS\_DEV\_IOCTL\_FAIL
commit 9fa4eb8e490a28de40964b1b0e583d8db4c7e57c upstream.
If a positive status is passed with the AUTOFS\_DEV\_IOCTL\_FAIL ioctl,
autofs4\_d\_automount() will return
ERR\_PTR(status)
with that status to follow\_automount(), which will then dereference an
invalid pointer.
So treat a positive status the same as zero, and map to ENOENT.
See comment in systemd src/core/automount.c::automount\_send\_ready().
Link: http://lkml.kernel.org/r/871sqwczx5.fsf@notabene.neil.brown.name
Signed-off-by: NeilBrown
Cc: Ian Kent
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit a2063a20547005c2e345591642f5483da7ad9a2d
Author: Ravi Bangoria
Date: Thu Jun 15 19:16:48 2017 +0530
powerpc/perf: Fix oops when kthread execs user process
commit bf05fc25f268cd62f147f368fe65ad3e5b04fe9f upstream.
When a kthread calls call\_usermodehelper() the steps are:
1. allocate current->mm
2. load\_elf\_binary()
3. populate current->thread.regs
While doing this, interrupts are not disabled. If there is a perf
interrupt in the middle of this process (i.e. step 1 has completed
but not yet reached to step 3) and if perf tries to read userspace
regs, kernel oops with following log:
Unable to handle kernel paging request for data at address 0x00000000
Faulting instruction address: 0xc0000000000da0fc
...
Call Trace:
perf\_output\_sample\_regs+0x6c/0xd0
perf\_output\_sample+0x4e4/0x830
perf\_event\_output\_forward+0x64/0x90
\_\_perf\_event\_overflow+0x8c/0x1e0
record\_and\_restart+0x220/0x5c0
perf\_event\_interrupt+0x2d8/0x4d0
performance\_monitor\_exception+0x54/0x70
performance\_monitor\_common+0x158/0x160
--- interrupt: f01 at avtab\_search\_node+0x150/0x1a0
LR = avtab\_search\_node+0x100/0x1a0
...
load\_elf\_binary+0x6e8/0x15a0
search\_binary\_handler+0xe8/0x290
do\_execveat\_common.isra.14+0x5f4/0x840
call\_usermodehelper\_exec\_async+0x170/0x210
ret\_from\_kernel\_thread+0x5c/0x7c
Fix it by setting abi to PERF\_SAMPLE\_REGS\_ABI\_NONE when userspace
pt\_regs are not set.
Fixes: ed4a4ef85cf5 ("powerpc/perf: Add support for sampling interrupt register state")
Signed-off-by: Ravi Bangoria
Acked-by: Naveen N. Rao
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit fed07e89078ddfbdddb2c54f340a934e94bee2b2
Author: Kees Cook
Date: Fri Jun 23 15:08:57 2017 -0700
fs/exec.c: account for argv/envp pointers
commit 98da7d08850fb8bdeb395d6368ed15753304aa0c upstream.
When limiting the argv/envp strings during exec to 1/4 of the stack limit,
the storage of the pointers to the strings was not included. This means
that an exec with huge numbers of tiny strings could eat 1/4 of the stack
limit in strings and then additional space would be later used by the
pointers to the strings.
For example, on 32-bit with a 8MB stack rlimit, an exec with 1677721
single-byte strings would consume less than 2MB of stack, the max (8MB /
4) amount allowed, but the pointers to the strings would consume the
remaining additional stack space (1677721 \* 4 == 6710884).
The result (1677721 + 6710884 == 8388605) would exhaust stack space
entirely. Controlling this stack exhaustion could result in
pathological behavior in setuid binaries (CVE-2017-1000365).
[akpm@linux-foundation.org: additional commenting from Kees]
Fixes: b6a2fea39318 ("mm: variable length argument support")
Link: http://lkml.kernel.org/r/20170622001720.GA32173@beast
Signed-off-by: Kees Cook
Acked-by: Rik van Riel
Acked-by: Michal Hocko
Cc: Alexander Viro
Cc: Qualys Security Advisory
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit c8bfdd083e78ac516b6876c6760bfda3c56a4554
Author: Takashi Iwai
Date: Wed Jun 14 07:37:14 2017 +0200
ALSA: hda - Apply quirks to Broxton-T, too
commit c7ecb9068e6772c43941ce609f08bc53f36e1dce upstream.
Broxton-T was a forgotten child and we didn't apply the quirks for
Skylake+ properly. Meanwhile, a quirk for reducing the DMA latency
seems specific to the early Broxton model, so we leave as is.
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 14487f9f6e8779e959802a540d4ffd6c85570de2
Author: Megha Dey
Date: Wed Jun 14 09:51:56 2017 +0530
ALSA: hda - Add Coffelake PCI ID
commit e79b0006c45c9b0b22f3ea54ff6e256b34c1f208 upstream.
Coffelake is another Intel part, so need to add PCI ID for it.
Signed-off-by: Megha Dey
Signed-off-by: Subhransu S. Prusty
Acked-by: Vinod Koul
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit e6dc243c285dcf210765a7189194eeabca84b117
Author: Takashi Iwai
Date: Wed Jun 14 16:20:32 2017 +0200
ALSA: pcm: Don't treat NULL chmap as a fatal error
commit 2deaeaf102d692cb6f764123b1df7aa118a8e97c upstream.
The standard PCM chmap helper callbacks treat the NULL info->chmap as
a fatal error and spews the kernel warning with stack trace when
CONFIG\_SND\_DEBUG is on. This was OK, originally it was supposed to be
always static and non-NULL. But, as the recent addition of Intel LPE
audio driver shows, the chmap content may vary dynamically, and it can
be even NULL when disconnected. The user still sees the kernel
warning unnecessarily.
For clearing such a confusion, this patch simply removes the
snd\_BUG\_ON() in each place, just returns an error without warning.
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit c06718bcbd1375d25b7d1efe83eeda65ee7a6272
Author: Takashi Sakamoto
Date: Sun Jun 11 16:08:21 2017 +0900
ALSA: firewire-lib: Fix stall of process context at packet error
commit 4a9bfafc64f44ef83de4e00ca1b57352af6cd8c2 upstream.
At Linux v3.5, packet processing can be done in process context of ALSA
PCM application as well as software IRQ context for OHCI 1394. Below is
an example of the callgraph (some calls are omitted).
ioctl(2) with e.g. HWSYNC
(sound/core/pcm\_native.c)
->snd\_pcm\_common\_ioctl1()
->snd\_pcm\_hwsync()
->snd\_pcm\_stream\_lock\_irq
(sound/core/pcm\_lib.c)
->snd\_pcm\_update\_hw\_ptr()
->snd\_pcm\_udpate\_hw\_ptr0()
->struct snd\_pcm\_ops.pointer()
(sound/firewire/\*)
= Each handler on drivers in ALSA firewire stack
(sound/firewire/amdtp-stream.c)
->amdtp\_stream\_pcm\_pointer()
(drivers/firewire/core-iso.c)
->fw\_iso\_context\_flush\_completions()
->struct fw\_card\_driver.flush\_iso\_completion()
(drivers/firewire/ohci.c)
= flush\_iso\_completions()
->struct fw\_iso\_context.callback.sc
(sound/firewire/amdtp-stream.c)
= in\_stream\_callback() or out\_stream\_callback()
->...
->snd\_pcm\_stream\_unlock\_irq
When packet queueing error occurs or detecting invalid packets in
'in\_stream\_callback()' or 'out\_stream\_callback()', 'snd\_pcm\_stop\_xrun()'
is called on local CPU with disabled IRQ.
(sound/firewire/amdtp-stream.c)
in\_stream\_callback() or out\_stream\_callback()
->amdtp\_stream\_pcm\_abort()
->snd\_pcm\_stop\_xrun()
->snd\_pcm\_stream\_lock\_irqsave()
->snd\_pcm\_stop()
->snd\_pcm\_stream\_unlock\_irqrestore()
The process is stalled on the CPU due to attempt to acquire recursive lock.
[ 562.630853] INFO: rcu\_sched detected stalls on CPUs/tasks:
[ 562.630861] 2-...: (1 GPs behind) idle=37d/140000000000000/0 softirq=38323/38323 fqs=7140
[ 562.630862] (detected by 3, t=15002 jiffies, g=21036, c=21035, q=5933)
[ 562.630866] Task dump for CPU 2:
[ 562.630867] alsa-source-OXF R running task 0 6619 1 0x00000008
[ 562.630870] Call Trace:
[ 562.630876] ? vt\_console\_print+0x79/0x3e0
[ 562.630880] ? msg\_print\_text+0x9d/0x100
[ 562.630883] ? up+0x32/0x50
[ 562.630885] ? irq\_work\_queue+0x8d/0xa0
[ 562.630886] ? console\_unlock+0x2b6/0x4b0
[ 562.630888] ? vprintk\_emit+0x312/0x4a0
[ 562.630892] ? dev\_vprintk\_emit+0xbf/0x230
[ 562.630895] ? do\_sys\_poll+0x37a/0x550
[ 562.630897] ? dev\_printk\_emit+0x4e/0x70
[ 562.630900] ? \_\_dev\_printk+0x3c/0x80
[ 562.630903] ? \_raw\_spin\_lock+0x20/0x30
[ 562.630909] ? snd\_pcm\_stream\_lock+0x31/0x50 [snd\_pcm]
[ 562.630914] ? \_snd\_pcm\_stream\_lock\_irqsave+0x2e/0x40 [snd\_pcm]
[ 562.630918] ? snd\_pcm\_stop\_xrun+0x16/0x70 [snd\_pcm]
[ 562.630922] ? in\_stream\_callback+0x3e6/0x450 [snd\_firewire\_lib]
[ 562.630925] ? handle\_ir\_packet\_per\_buffer+0x8e/0x1a0 [firewire\_ohci]
[ 562.630928] ? ohci\_flush\_iso\_completions+0xa3/0x130 [firewire\_ohci]
[ 562.630932] ? fw\_iso\_context\_flush\_completions+0x15/0x20 [firewire\_core]
[ 562.630935] ? amdtp\_stream\_pcm\_pointer+0x2d/0x40 [snd\_firewire\_lib]
[ 562.630938] ? pcm\_capture\_pointer+0x19/0x20 [snd\_oxfw]
[ 562.630943] ? snd\_pcm\_update\_hw\_ptr0+0x47/0x3d0 [snd\_pcm]
[ 562.630945] ? poll\_select\_copy\_remaining+0x150/0x150
[ 562.630947] ? poll\_select\_copy\_remaining+0x150/0x150
[ 562.630952] ? snd\_pcm\_update\_hw\_ptr+0x10/0x20 [snd\_pcm]
[ 562.630956] ? snd\_pcm\_hwsync+0x45/0xb0 [snd\_pcm]
[ 562.630960] ? snd\_pcm\_common\_ioctl1+0x1ff/0xc90 [snd\_pcm]
[ 562.630962] ? futex\_wake+0x90/0x170
[ 562.630966] ? snd\_pcm\_capture\_ioctl1+0x136/0x260 [snd\_pcm]
[ 562.630970] ? snd\_pcm\_capture\_ioctl+0x27/0x40 [snd\_pcm]
[ 562.630972] ? do\_vfs\_ioctl+0xa3/0x610
[ 562.630974] ? vfs\_read+0x11b/0x130
[ 562.630976] ? SyS\_ioctl+0x79/0x90
[ 562.630978] ? entry\_SYSCALL\_64\_fastpath+0x1e/0xad
This commit fixes the above bug. This assumes two cases:
1. Any error is detected in software IRQ context of OHCI 1394 context.
In this case, PCM substream should be aborted in packet handler. On the
other hand, it should not be done in any process context. TO distinguish
these two context, use 'in\_interrupt()' macro.
2. Any error is detect in process context of ALSA PCM application.
In this case, PCM substream should not be aborted in packet handler
because PCM substream lock is acquired. The task to abort PCM substream
should be done in ALSA PCM core. For this purpose, SNDRV\_PCM\_POS\_XRUN is
returned at 'struct snd\_pcm\_ops.pointer()'.
Suggested-by: Clemens Ladisch
Fixes: e9148dddc3c7("ALSA: firewire-lib: flush completed packets when reading PCM position")
Signed-off-by: Takashi Sakamoto
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit b919d2dc590952b2985e43d03b2724b84e5dc2a0
Author: Jan Beulich
Date: Tue Jun 13 16:28:27 2017 -0400
xen-blkback: don't leak stack data via response ring
commit 089bc0143f489bd3a4578bdff5f4ca68fb26f341 upstream.
Rather than constructing a local structure instance on the stack, fill
the fields directly on the shared ring, just like other backends do.
Build on the fact that all response structure flavors are actually
identical (the old code did make this assumption too).
This is XSA-216.
Signed-off-by: Jan Beulich
Reviewed-by: Konrad Rzeszutek Wilk
Signed-off-by: Konrad Rzeszutek Wilk
Signed-off-by: Greg Kroah-Hartman
commit 7bffd6bb0c2a0b7e867ecd44aea82e8f0c6e6294
Author: Juergen Gross
Date: Thu May 18 17:28:47 2017 +0200
xen/blkback: fix disconnect while I/Os in flight
commit 46464411307746e6297a034a9983a22c9dfc5a0c upstream.
Today disconnecting xen-blkback is broken in case there are still
I/Os in flight: xen\_blkif\_disconnect() will bail out early without
releasing all resources in the hope it will be called again when
the last request has terminated. This, however, won't happen as
xen\_blkif\_free() won't be called on termination of the last running
request: xen\_blkif\_put() won't decrement the blkif refcnt to 0 as
xen\_blkif\_disconnect() didn't finish before thus some xen\_blkif\_put()
calls in xen\_blkif\_disconnect() didn't happen.
To solve this deadlock xen\_blkif\_disconnect() and
xen\_blkif\_alloc\_rings() shouldn't use xen\_blkif\_put() and
xen\_blkif\_get() but use some other way to do their accounting of
resources.
This at once fixes another error in xen\_blkif\_disconnect(): when it
returned early with -EBUSY for another ring than 0 it would call
xen\_blkif\_put() again for already handled rings on a subsequent call.
This will lead to inconsistencies in the refcnt handling.
Signed-off-by: Juergen Gross
Tested-by: Steven Haigh
Acked-by: Roger Pau Monné
Signed-off-by: Konrad Rzeszutek Wilk
Signed-off-by: Greg Kroah-Hartman
commit 61ab4c4a857e145bc9a3a38075bdb718651b8a6d
Author: Boris Brezillon
Date: Wed May 24 18:34:29 2017 +0200
clk: sunxi-ng: sun5i: Fix ahb\_bist\_clk definition
commit 370d9192719e6c174167888cf9240df2542e3b4b upstream.
AHB BIST gate is actually controlled with bit 7.
This bug was detected while trying to use the NAND controller which is
using the DMA engine to transfer data to the NAND.
Since the ahb\_bist\_clk gate bit conflicts with the ahb\_dma\_clk gate bit,
the core was disabling the DMA engine clock as part of its 'disable
unused clks' procedure, which was causing all DMA transfers to fail after
this point.
Fixes: 5e73761786d6 ("clk: sunxi-ng: Add sun5i CCU driver")
Reported-by: Angus Ainslie
Signed-off-by: Boris Brezillon
Tested-by: Angus Ainslie
Reviewed-by: Chen-Yu Tsai
Signed-off-by: Michael Turquette
Link: lkml.kernel.org/r/1495643669-28221-1-git-send-email-boris.brezillon@free-electrons.com
Signed-off-by: Greg Kroah-Hartman
commit 744b0f61b424d437e8773495c80b84c37a739e81
Author: Yong Deng
Date: Fri May 5 18:31:57 2017 +0800
clk: sunxi-ng: v3s: Fix usb otg device reset bit
commit 7ffc781ec46ef1e9aedb482f5f04425bd8bb2753 upstream.
V3S's usb otg device reset bit should be 24, not 23.
Signed-off-by: Yong Deng
Reviewed-By: Icenowy Zheng
Signed-off-by: Maxime Ripard
Signed-off-by: Greg Kroah-Hartman
commit 861b4d9542e696fb60a20281840f4258e29ba5d4
Author: Chen-Yu Tsai
Date: Wed May 3 11:13:46 2017 +0800
clk: sunxi-ng: a31: Correct lcd1-ch1 clock register offset
commit 38b8f823864707eb1cf331d2247608c419ed388c upstream.
The register offset for the lcd1-ch1 clock was incorrectly pointing to
the lcd0-ch1 clock. This resulted in the lcd0-ch1 clock being disabled
when the clk core disables unused clocks. This then stops the simplefb
HDMI output path.
Reported-by: Bob Ham
Fixes: c6e6c96d8fa6 ("clk: sunxi-ng: Add A31/A31s clocks")
Signed-off-by: Chen-Yu Tsai
Signed-off-by: Maxime Ripard
Signed-off-by: Greg Kroah-Hartman


=== Content from www.debian.org_8df7d79c_20250124_192243.html ===


---

[[Date Prev](msg00206.html)][[Date Next](msg00208.html)]
[[Thread Prev](msg00206.html)][[Thread Next](msg00208.html)]
[[Date Index](maillist.html#00207)]
[[Thread Index](threads.html#00207)]

# [SECURITY] [DSA 3945-1] linux security update

---

* *To*: debian-security-announce@lists.debian.org
* *Subject*: [SECURITY] [DSA 3945-1] linux security update
* *From*: Salvatore Bonaccorso <carnil@debian.org>
* *Date*: Thu, 17 Aug 2017 18:40:05 +0000
* *Message-id*: <[[🔎]](/msgid-search/E1diPi9-0005PI-4M%40master.debian.org) [E1diPi9-0005PI-4M@master.debian.org](msg00207.html)>
* *Reply-to*: debian-security-announce-request@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian Security Advisory DSA-3945-1                   security@debian.org
<https://www.debian.org/security/>                     Salvatore Bonaccorso
August 17, 2017                       <https://www.debian.org/security/faq>
- -------------------------------------------------------------------------

Package        : linux
CVE ID         : CVE-2014-9940 CVE-2017-7346 CVE-2017-7482 CVE-2017-7533
                 CVE-2017-7541 CVE-2017-7542 CVE-2017-7889 CVE-2017-9605
                 CVE-2017-10911 CVE-2017-11176 CVE-2017-1000363
                 CVE-2017-1000365

Several vulnerabilities have been discovered in the Linux kernel that
may lead to a privilege escalation, denial of service or information
leaks.

CVE-2014-9940

    A use-after-free flaw in the voltage and current regulator driver
    could allow a local user to cause a denial of service or potentially
    escalate privileges.

CVE-2017-7346

    Li Qiang discovered that the DRM driver for VMware virtual GPUs does
    not properly check user-controlled values in the
    vmw_surface_define_ioctl() functions for upper limits. A local user
    can take advantage of this flaw to cause a denial of service.

CVE-2017-7482

    Shi Lei discovered that RxRPC Kerberos 5 ticket handling code does
    not properly verify metadata, leading to information disclosure,
    denial of service or potentially execution of arbitrary code.

CVE-2017-7533

    Fan Wu and Shixiong Zhao discovered a race condition between inotify
    events and VFS rename operations allowing an unprivileged local
    attacker to cause a denial of service or escalate privileges.

CVE-2017-7541

    A buffer overflow flaw in the Broadcom IEEE802.11n PCIe SoftMAC WLAN
    driver could allow a local user to cause kernel memory corruption,
    leading to a denial of service or potentially privilege escalation.

CVE-2017-7542

    An integer overflow vulnerability in the ip6_find_1stfragopt()
    function was found allowing a local attacker with privileges to open
    raw sockets to cause a denial of service.

CVE-2017-7889

    Tommi Rantala and Brad Spengler reported that the mm subsystem does
    not properly enforce the CONFIG_STRICT_DEVMEM protection mechanism,
    allowing a local attacker with access to /dev/mem to obtain
    sensitive information or potentially execute arbitrary code.

CVE-2017-9605

    Murray McAllister discovered that the DRM driver for VMware virtual
    GPUs does not properly initialize memory, potentially allowing a
    local attacker to obtain sensitive information from uninitialized
    kernel memory via a crafted ioctl call.

CVE-2017-10911 / XSA-216

    Anthony Perard of Citrix discovered an information leak flaw in Xen
    blkif response handling, allowing a malicious unprivileged guest to
    obtain sensitive information from the host or other guests.

CVE-2017-11176

    It was discovered that the mq_notify() function does not set the
    sock pointer to NULL upon entry into the retry logic. An attacker
    can take advantage of this flaw during a userspace close of a
    Netlink socket to cause a denial of service or potentially cause
    other impact.

CVE-2017-1000363

    Roee Hay reported that the lp driver does not properly bounds-check
    passed arguments, allowing a local attacker with write access to the
    kernel command line arguments to execute arbitrary code.

CVE-2017-1000365

    It was discovered that argument and environment pointers are not
    taken properly into account to the imposed size restrictions on
    arguments and environmental strings passed through
    RLIMIT_STACK/RLIMIT_INFINITY. A local attacker can take advantage of
    this flaw in conjunction with other flaws to execute arbitrary code.

For the oldstable distribution (jessie), these problems have been fixed
in version 3.16.43-2+deb8u3.

We recommend that you upgrade your linux packages.

Further information about Debian Security Advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://www.debian.org/security/>

Mailing list: debian-security-announce@lists.debian.org
-----BEGIN PGP SIGNATURE-----

iQKTBAEBCgB9FiEERkRAmAjBceBVMd3uBUy48xNDz0QFAlmV4s9fFIAAAAAALgAo
aXNzdWVyLWZwckBub3RhdGlvbnMub3BlbnBncC5maWZ0aGhvcnNlbWFuLm5ldDQ2
NDQ0MDk4MDhDMTcxRTA1NTMxRERFRTA1NENCOEYzMTM0M0NGNDQACgkQBUy48xND
z0SZMhAAhBfaeydc3sP6ce4m24nh4FJRrkZudj04Z1Kloq5+diW3zc1ZzQV6+75x
QZTCmQKqFL7ueLb+jB3whCfg4BHbeTygu3+6eIAYyWFDpmfFRIAjVtLE6HAwC5cr
MM1DyA0AhxtcquoBiCvsmIxKRq5akVn0vSBL4qg3+DXTmjrV1ZGNmECLa5SUO7MF
idIUyvEMOX1TmMAEZBaQqslg4o4lgXXiL9GgB2rbFnPDzHQENZ1li/jkP5iFhSGH
s4mFj0pkwlVYoIa6xdC69kQI49USbpUv5okdthsuDKmm2oj/TuozOIAdcsNFTfts
wYLRic8OrhSYD1ZeXdy6FVzMb5s1alm2zcmDu7xQwSKy5TtVJII+DPWn9EonQaK9
OfazCvQBJ4Tip6CEBl0NFACIO9Y6+ExF2Ens/jJwAWDYOWkGGLTjsWf6TlxAGshl
c8TLvDfZW7hFcs8fPc9YFQQA1OyUA1GCPlLhXltGV2kwIN+iaR3vk/DrJ0kEaaZz
/rklgqvhfYmtx0Hp3pmwJkHCj/S3zIfK8AvZ+SU2hYw9TUxm02JHig/GSbF3eiwL
DvP1PVbXwT9n6ePw0yMkkfaEZBCGFWFnvT2kTBQhSYBfUVLo1KVOJ5gmPdxHda0b
lgtZszmHa+bj5C6DN/OMGBZC/7wgbt7jEyZht3Ke+20z2n+z/yE=
=Dibe
-----END PGP SIGNATURE-----

```

---



=== Content from www.debian.org_2ca54075_20250124_192242.html ===


---

[[Date Prev](msg00188.html)][[Date Next](msg00190.html)]
[[Thread Prev](msg00188.html)][[Thread Next](msg00190.html)]
[[Date Index](maillist.html#00189)]
[[Thread Index](threads.html#00189)]

# [SECURITY] [DSA 3927-1] linux security update

---

* *To*: debian-security-announce@lists.debian.org
* *Subject*: [SECURITY] [DSA 3927-1] linux security update
* *From*: Salvatore Bonaccorso <carnil@debian.org>
* *Date*: Mon, 07 Aug 2017 05:18:53 +0000
* *Message-id*: <[[🔎]](/msgid-search/E1deaRJ-0005eV-LB%40master.debian.org) [E1deaRJ-0005eV-LB@master.debian.org](msg00189.html)>
* *Reply-to*: debian-security-announce-request@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian Security Advisory DSA-3927-1                   security@debian.org
<https://www.debian.org/security/>                     Salvatore Bonaccorso
August 07, 2017                       <https://www.debian.org/security/faq>
- -------------------------------------------------------------------------

Package        : linux
CVE ID         : CVE-2017-7346 CVE-2017-7482 CVE-2017-7533 CVE-2017-7541
                 CVE-2017-7542 CVE-2017-9605 CVE-2017-10810 CVE-2017-10911
                 CVE-2017-11176 CVE-2017-1000365

Several vulnerabilities have been discovered in the Linux kernel that
may lead to a privilege escalation, denial of service or information
leaks.

CVE-2017-7346

    Li Qiang discovered that the DRM driver for VMware virtual GPUs does
    not properly check user-controlled values in the
    vmw_surface_define_ioctl() functions for upper limits. A local user
    can take advantage of this flaw to cause a denial of service.

CVE-2017-7482

    Shi Lei discovered that RxRPC Kerberos 5 ticket handling code does
    not properly verify metadata, leading to information disclosure,
    denial of service or potentially execution of arbitrary code.

CVE-2017-7533

    Fan Wu and Shixiong Zhao discovered a race condition between inotify
    events and VFS rename operations allowing an unprivileged local
    attacker to cause a denial of service or escalate privileges.

CVE-2017-7541

    A buffer overflow flaw in the Broadcom IEEE802.11n PCIe SoftMAC WLAN
    driver could allow a local user to cause kernel memory corruption,
    leading to a denial of service or potentially privilege escalation.

CVE-2017-7542

    An integer overflow vulnerability in the ip6_find_1stfragopt()
    function was found allowing a local attacker with privileges to open
    raw sockets to cause a denial of service.

CVE-2017-9605

    Murray McAllister discovered that the DRM driver for VMware virtual
    GPUs does not properly initialize memory, potentially allowing a
    local attacker to obtain sensitive information from uninitialized
    kernel memory via a crafted ioctl call.

CVE-2017-10810

    Li Qiang discovered a memory leak flaw within the VirtIO GPU driver
    resulting in denial of service (memory consumption).

CVE-2017-10911 / XSA-216

    Anthony Perard of Citrix discovered an information leak flaw in Xen
    blkif response handling, allowing a malicious unprivileged guest to
    obtain sensitive information from the host or other guests.

CVE-2017-11176

    It was discovered that the mq_notify() function does not set the
    sock pointer to NULL upon entry into the retry logic. An attacker
    can take advantage of this flaw during a user-space close of a
    Netlink socket to cause a denial of service or potentially cause
    other impact.

CVE-2017-1000365

    It was discovered that argument and environment pointers are not
    taken properly into account to the imposed size restrictions on
    arguments and environmental strings passed through
    RLIMIT_STACK/RLIMIT_INFINITY. A local attacker can take advantage of
    this flaw in conjunction with other flaws to execute arbitrary code.

For the oldstable distribution (jessie), these problems will be fixed in
a subsequent DSA.

For the stable distribution (stretch), these problems have been fixed in
version 4.9.30-2+deb9u3.

We recommend that you upgrade your linux packages.

Further information about Debian Security Advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://www.debian.org/security/>

Mailing list: debian-security-announce@lists.debian.org
-----BEGIN PGP SIGNATURE-----

iQKTBAEBCgB9FiEERkRAmAjBceBVMd3uBUy48xNDz0QFAlmH92RfFIAAAAAALgAo
aXNzdWVyLWZwckBub3RhdGlvbnMub3BlbnBncC5maWZ0aGhvcnNlbWFuLm5ldDQ2
NDQ0MDk4MDhDMTcxRTA1NTMxRERFRTA1NENCOEYzMTM0M0NGNDQACgkQBUy48xND
z0Q3wg//Trx3JpxUkvUY1x33AnhJqGg/9GShz6U1MGnBjKkNwpUH8FICXDHbzYzP
n7GULdxgvtVQypfJni9+Gsvk6EcILcNUTUb9e9gknfLFumHl5KUhAJIOh9Fdb/u2
VYvGwFT5OaO/JqXARhxa3a+SHCSybslUSuyp3hxvjTT0jcl8wBTgkeQYKdlqJp8v
ArklOQoAHVXs+Xq1PFSFDdoN9aOryIXcqGytnx/y1KqH3U4FpQn8AcIIAB53YN5X
NF+GmOewvgZn/7xkVGrqbvh8bhst/Yv5A3CTl1EvY8biApuWYGIKpQiThUtgQs8U
eD/0xoP3rN+NxWoMWyACZqrKH5VaSkcwkkBTGa4BlklHaElFHhlIFXdnP4lMdCZ4
tSBd8UGPFwtF3cyq/nH+9tVmnAqH95sclLf8yvkxxv+vtbZsixJJRlnRdf/nszuT
OOVFsRp/7l7MuqiLErHJkPKHoQ7rZ847GF5flCev6rz7OLQKA2IKPj4RdQKcQ+Ze
Vv6/ZtTcKspD7EoQJyrTC8MBJYvY0g7kswzQDUxKqJA2hIkVY3FEhh94ONZAUady
x6+Nb/a/oAlcZ0wjev1p8ayxtfAAaiuuqxoGbd7rdZkyB1C0eb13XdiOI7yDkdVp
4G8iVjOUdYdKRXlxW9FX+rZhS+yEX8ZbWNZGqThEc/oX0uj6XVo=
=82mY
-----END PGP SIGNATURE-----

```

---



=== Content from lists.debian.org_3b1720b0_20250124_192245.html ===


---

[[Date Prev](msg00006.html)][[Date Next](msg00008.html)]
[[Thread Prev](msg00006.html)][[Thread Next](msg00008.html)]
[[Date Index](maillist.html#00007)]
[[Thread Index](threads.html#00007)]

# [SECURITY] [DLA 1497-1] qemu security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 1497-1] qemu security update
* *From*: "Santiago R.R." <santiagorr@riseup.net>
* *Date*: Thu, 6 Sep 2018 20:49:12 +0200
* *Message-id*: <[[🔎]](/msgid-search/20180906184912.GA24423%40novelo) [20180906184912.GA24423@novelo](msg00007.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
Package        : qemu
Version        : 1:2.1+dfsg-12+deb8u7
CVE ID         : CVE-2015-8666 CVE-2016-2198 CVE-2016-6833 CVE-2016-6835
                 CVE-2016-8576 CVE-2016-8667 CVE-2016-8669 CVE-2016-9602
                 CVE-2016-9603 CVE-2016-9776 CVE-2016-9907 CVE-2016-9911
                 CVE-2016-9914 CVE-2016-9915 CVE-2016-9916 CVE-2016-9921
                 CVE-2016-9922 CVE-2016-10155 CVE-2017-2615 CVE-2017-2620
                 CVE-2017-5525 CVE-2017-5526 CVE-2017-5579 CVE-2017-5667
                 CVE-2017-5715 CVE-2017-5856 CVE-2017-5973 CVE-2017-5987
                 CVE-2017-6505 CVE-2017-7377 CVE-2017-7493 CVE-2017-7718
                 CVE-2017-7980 CVE-2017-8086 CVE-2017-8112 CVE-2017-8309
                 CVE-2017-8379 CVE-2017-9330 CVE-2017-9373 CVE-2017-9374
                 CVE-2017-9503 CVE-2017-10806 CVE-2017-10911
                 CVE-2017-11434 CVE-2017-14167 CVE-2017-15038
                 CVE-2017-15289 CVE-2017-16845 CVE-2017-18030
                 CVE-2017-18043 CVE-2018-5683 CVE-2018-7550
Debian Bug     : 813193 834904 835031 840945 840950 847496 847951 847953
                 847960 851910 852232 853002 853006 853996 854731 855159
                 855611 855791 856399 856969 857744 859854 860785 861348
                 861351 862280 862289 863943 864216 864568 865754 867751
                 869171 869706 874606 877890 880832 882136 886532 887392
                 892041

Several vulnerabilities were found in qemu, a fast processor emulator:

CVE-2015-8666

    Heap-based buffer overflow in QEMU when built with the
    Q35-chipset-based PC system emulator

CVE-2016-2198

    Null pointer dereference in ehci_caps_write in the USB EHCI support
    that may result in denial of service

CVE-2016-6833

    Use after free while writing in the vmxnet3 device that could be used
    to cause a denial of service

CVE-2016-6835

    Buffer overflow in vmxnet_tx_pkt_parse_headers() in vmxnet3 device
    that could result in denial of service

CVE-2016-8576

    Infinite loop vulnerability in xhci_ring_fetch in the USB xHCI support

CVE-2016-8667 / CVE-2016-8669

    Divide by zero errors in set_next_tick in the JAZZ RC4030 chipset
    emulator, and in serial_update_parameters of some serial devices, that
    could result in denial of service

CVE-2016-9602

   Improper link following with VirtFS

CVE-2016-9603

    Heap buffer overflow via vnc connection in the Cirrus CLGD 54xx VGA
    emulator support

CVE-2016-9776

    Infinite loop while receiving data in the ColdFire Fast Ethernet
    Controller emulator

CVE-2016-9907

    Memory leakage in the USB redirector usb-guest support

CVE-2016-9911

    Memory leakage in ehci_init_transfer in the USB EHCI support

CVE-2016-9914 / CVE-2016-9915 / CVE-2016-9916

    Plan 9 File System (9pfs): add missing cleanup operation in
    FileOperations, in the handle backend and in the proxy backend driver

CVE-2016-9921 / CVE-2016-9922

    Divide by zero in cirrus_do_copy in the Cirrus CLGD 54xx VGA Emulator
    support

CVE-2016-10155

    Memory leak in hw/watchdog/wdt_i6300esb.c allowing local guest OS
    privileged users to cause a denial of service via a large number of
    device unplug operations.

CVE-2017-2615 / CVE-2017-2620 / CVE-2017-18030 / CVE-2018-5683 / CVE-2017-7718

    Out-of-bounds access issues in the Cirrus CLGD 54xx VGA emulator
    support, that could result in denial of service

CVE-2017-5525 / CVE-2017-5526

    Memory leakage issues in the ac97 and es1370 device emulation

CVE-2017-5579

    Most memory leakage in the 16550A UART emulation

CVE-2017-5667

    Out-of-bounds access during multi block SDMA transfer in the SDHCI
    emulation support.

CVE-2017-5715

    Mitigations against the Spectre v2 vulnerability. For more information
    please refer to <https://www.qemu.org/2018/01/04/spectre/>

CVE-2017-5856

    Memory leak in the MegaRAID SAS 8708EM2 Host Bus Adapter emulation
    support

CVE-2017-5973 / CVE-2017-5987 / CVE-2017-6505

    Infinite loop issues in the USB xHCI, in the transfer mode register
    of the SDHCI protocol, and the USB ohci_service_ed_list

CVE-2017-7377

    9pfs: host memory leakage via v9fs_create

CVE-2017-7493

    Improper access control issues in the host directory sharing via
    9pfs support.

CVE-2017-7980

    Heap-based buffer overflow in the Cirrus VGA device that could allow
    local guest OS users to execute arbitrary code or cause a denial of
    service

CVE-2017-8086

    9pfs: host memory leakage via v9pfs_list_xattr

CVE-2017-8112

    Infinite loop in the VMWare PVSCSI emulation

CVE-2017-8309 / CVE-2017-8379

    Host memory leakage issues via the audio capture buffer and the
    keyboard input event handlers

CVE-2017-9330

    Infinite loop due to incorrect return value in USB OHCI that may
    result in denial of service

CVE-2017-9373 / CVE-2017-9374

    Host memory leakage during hot unplug in IDE AHCI and USB emulated
    devices that could result in denial of service

CVE-2017-9503

    Null pointer dereference while processing megasas command

CVE-2017-10806

    Stack buffer overflow in USB redirector

CVE-2017-10911

    Xen disk may leak stack data via response ring

CVE-2017-11434

    Out-of-bounds read while parsing Slirp/DHCP options

CVE-2017-14167

    Out-of-bounds access while processing multiboot headers that could
    result in the execution of arbitrary code

CVE-2017-15038

    9pfs: information disclosure when reading extended attributes

CVE-2017-15289

    Out-of-bounds write access issue in the Cirrus graphic adaptor that
    could result in denial of service

CVE-2017-16845

    Information leak in the PS/2 mouse and keyboard emulation support that
    could be exploited during instance migration

CVE-2017-18043

    Integer overflow in the macro ROUND_UP (n, d) that could result in
    denial of service

CVE-2018-7550

    Incorrect handling of memory during multiboot that could may result in
    execution of arbitrary code

For Debian 8 "Jessie", these problems have been fixed in version
1:2.1+dfsg-12+deb8u7.

We recommend that you upgrade your qemu packages.

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

```

**Attachment:
[signature.asc](pgpABG05BsA7I.pgp)**

*Description:* PGP signature

---



=== Content from github.com_03995b4f_20250124_192245.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F089bc0143f489bd3a4578bdff5f4ca68fb26f341)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F089bc0143f489bd3a4578bdff5f4ca68fb26f341)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.9k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  437](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/089bc0143f489bd3a4578bdff5f4ca68fb26f341)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

xen-blkback: don't leak stack data via response ring

[Browse files](/torvalds/linux/tree/089bc0143f489bd3a4578bdff5f4ca68fb26f341)
Browse the repository at this point in the history

```
Rather than constructing a local structure instance on the stack, fill
the fields directly on the shared ring, just like other backends do.
Build on the fact that all response structure flavors are actually
identical (the old code did make this assumption too).

This is XSA-216.

Cc: stable@vger.kernel.org

Signed-off-by: Jan Beulich <jbeulich@suse.com>
Reviewed-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
```

* Loading branch information

[![@jbeulich](https://avatars.githubusercontent.com/u/5610135?s=40&v=4)](/jbeulich) [![@konradwilk](https://avatars.githubusercontent.com/u/17299149?s=40&v=4)](/konradwilk)

[jbeulich](/torvalds/linux/commits?author=jbeulich "View all commits by jbeulich")
authored and
[konradwilk](/torvalds/linux/commits?author=konradwilk "View all commits by konradwilk")
committed
Jun 13, 2017

1 parent
[a24fa22](/torvalds/linux/commit/a24fa22ce22ae302b3bf8f7008896d52d5d57b8d)

commit 089bc01

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**17 additions**
and
**31 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* drivers/block/xen-blkback

  + drivers/block/xen-blkback/blkback.c
    [blkback.c](#diff-f5fddb3d87b7045413795b574c6c8d9e8f5c3fd2a7c543b28c15d829a5633131)
  + drivers/block/xen-blkback/common.h
    [common.h](#diff-a2e7d681d411e65c136a772d6b0755ddc5608b5432c13cd0466970c79c48dce2)

## There are no files selected for viewing

23 changes: 12 additions & 11 deletions

23
[drivers/block/xen-blkback/blkback.c](#diff-f5fddb3d87b7045413795b574c6c8d9e8f5c3fd2a7c543b28c15d829a5633131 "drivers/block/xen-blkback/blkback.c")

Show comments

[View file](/torvalds/linux/blob/089bc0143f489bd3a4578bdff5f4ca68fb26f341/drivers/block/xen-blkback/blkback.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1433,34 +1433,35 @@ static int dispatch\_rw\_block\_io(struct xen\_blkif\_ring \*ring, |
|  |  | static void make\_response(struct xen\_blkif\_ring \*ring, u64 id, |
|  |  | unsigned short op, int st) |
|  |  | { |
|  |  | struct blkif\_response  resp; |
|  |  | struct blkif\_response \*resp; |
|  |  | unsigned long flags; |
|  |  | union blkif\_back\_rings \*blk\_rings; |
|  |  | int notify; |
|  |  |  |
|  |  | resp.id = id; |
|  |  | resp.operation = op; |
|  |  | resp.status = st; |
|  |  |  |
|  |  | spin\_lock\_irqsave(&ring->blk\_ring\_lock, flags); |
|  |  | blk\_rings = &ring->blk\_rings; |
|  |  | /\* Place on the response ring for the relevant domain. \*/ |
|  |  | switch (ring->blkif->blk\_protocol) { |
|  |  | case BLKIF\_PROTOCOL\_NATIVE: |
|  |  | memcpy(RING\_GET\_RESPONSE(&blk\_rings->native, blk\_rings->native.rsp\_prod\_pvt), |
|  |  | &resp, sizeof(resp)); |
|  |  | resp = RING\_GET\_RESPONSE(&blk\_rings->native, |
|  |  | blk\_rings->native.rsp\_prod\_pvt); |
|  |  | break; |
|  |  | case BLKIF\_PROTOCOL\_X86\_32: |
|  |  | memcpy(RING\_GET\_RESPONSE(&blk\_rings->x86\_32, blk\_rings->x86\_32.rsp\_prod\_pvt), |
|  |  | &resp, sizeof(resp)); |
|  |  | resp = RING\_GET\_RESPONSE(&blk\_rings->x86\_32, |
|  |  | blk\_rings->x86\_32.rsp\_prod\_pvt); |
|  |  | break; |
|  |  | case BLKIF\_PROTOCOL\_X86\_64: |
|  |  | memcpy(RING\_GET\_RESPONSE(&blk\_rings->x86\_64, blk\_rings->x86\_64.rsp\_prod\_pvt), |
|  |  | &resp, sizeof(resp)); |
|  |  | resp = RING\_GET\_RESPONSE(&blk\_rings->x86\_64, |
|  |  | blk\_rings->x86\_64.rsp\_prod\_pvt); |
|  |  | break; |
|  |  | default: |
|  |  | BUG(); |
|  |  | } |
|  |  |  |
|  |  | resp->id = id; |
|  |  | resp->operation = op; |
|  |  | resp->status = st; |
|  |  |  |
|  |  | blk\_rings->common.rsp\_prod\_pvt++; |
|  |  | RING\_PUSH\_RESPONSES\_AND\_CHECK\_NOTIFY(&blk\_rings->common, notify); |
|  |  | spin\_unlock\_irqrestore(&ring->blk\_ring\_lock, flags); |
| Expand Down | |  |

25 changes: 5 additions & 20 deletions

25
[drivers/block/xen-blkback/common.h](#diff-a2e7d681d411e65c136a772d6b0755ddc5608b5432c13cd0466970c79c48dce2 "drivers/block/xen-blkback/common.h")

Show comments

[View file](/torvalds/linux/blob/089bc0143f489bd3a4578bdff5f4ca68fb26f341/drivers/block/xen-blkback/common.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -75,9 +75,8 @@ extern unsigned int xenblk\_max\_queues; |
|  |  | struct blkif\_common\_request { |
|  |  | char dummy; |
|  |  | }; |
|  |  | struct blkif\_common\_response { |
|  |  | char dummy; |
|  |  | }; |
|  |  |  |
|  |  | /\* i386 protocol version \*/ |
|  |  |  |
|  |  | struct blkif\_x86\_32\_request\_rw { |
|  |  | uint8\_t nr\_segments; /\* number of segments \*/ |
| Expand Down  Expand Up | | @@ -129,14 +128,6 @@ struct blkif\_x86\_32\_request { |
|  |  | } u; |
|  |  | } \_\_attribute\_\_((\_\_packed\_\_)); |
|  |  |  |
|  |  | /\* i386 protocol version \*/ |
|  |  | #pragma pack(push, 4) |
|  |  | struct blkif\_x86\_32\_response { |
|  |  | uint64\_t id; /\* copied from request \*/ |
|  |  | uint8\_t operation; /\* copied from request \*/ |
|  |  | int16\_t status; /\* BLKIF\_RSP\_??? \*/ |
|  |  | }; |
|  |  | #pragma pack(pop) |
|  |  | /\* x86\_64 protocol version \*/ |
|  |  |  |
|  |  | struct blkif\_x86\_64\_request\_rw { |
| Expand Down  Expand Up | | @@ -193,18 +184,12 @@ struct blkif\_x86\_64\_request { |
|  |  | } u; |
|  |  | } \_\_attribute\_\_((\_\_packed\_\_)); |
|  |  |  |
|  |  | struct blkif\_x86\_64\_response { |
|  |  | uint64\_t \_\_attribute\_\_((\_\_aligned\_\_(8))) id; |
|  |  | uint8\_t operation; /\* copied from request \*/ |
|  |  | int16\_t status; /\* BLKIF\_RSP\_??? \*/ |
|  |  | }; |
|  |  |  |
|  |  | DEFINE\_RING\_TYPES(blkif\_common, struct blkif\_common\_request, |
|  |  | struct blkif\_common\_response); |
|  |  | struct blkif\_response); |
|  |  | DEFINE\_RING\_TYPES(blkif\_x86\_32, struct blkif\_x86\_32\_request, |
|  |  | struct blkif\_x86\_32\_response); |
|  |  | struct blkif\_response \_\_packed); |
|  |  | DEFINE\_RING\_TYPES(blkif\_x86\_64, struct blkif\_x86\_64\_request, |
|  |  | struct blkif\_x86\_64\_response); |
|  |  | struct blkif\_response); |
|  |  |  |
|  |  | union blkif\_back\_rings { |
|  |  | struct blkif\_back\_ring native; |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `089bc01`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F089bc0143f489bd3a4578bdff5f4ca68fb26f341) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


