=== Content from seclists.org_3d10dfbe_20250126_001749.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![oss-sec logo](/images/oss-sec-logo.png)](/oss-sec/)
## [oss-sec](/oss-sec/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](442)
[By Date](date.html#443)
[![Next](/images/right-icon-16x16.png)](444)

[![Previous](/images/left-icon-16x16.png)](442)
[By Thread](index.html#443)
[![Next](/images/right-icon-16x16.png)](458)

![](/shared/images/nst-icons.svg#search)

# MySQL - use-after-free after mysql\_stmt\_close()

---

*From*: Pali Rohár <pali.rohar () gmail com>

*Date*: Thu, 8 Jun 2017 23:49:03 +0200

---

```
Hello!

MySQL applications written according to Oracle's MySQL documentation &
examples for mysql_stmt_close() function call are vulnerable to use-
after-free defect.

In mysql_stmt_close() documentation [1] for return value is written:
"Zero for success. Nonzero if an error occurred." And there are defined
two errors: CR_SERVER_GONE_ERROR CR_UNKNOWN_ERROR. From other parts of
documentation can be understood that error messages for statements could
be obtained by mysql_stmt_error() function [2].

Whole example of usage is written in mysql_stmt_execute() function [3].
The relevant part for mysql_stmt_close() is at the end of example:

/* Close the statement */
if (mysql_stmt_close(stmt))
{
  fprintf(stderr, " failed while closing the statement\n");
  fprintf(stderr, " %s\n", mysql_stmt_error(stmt));
  exit(0);
}

And here is a problem, use-after-free defect. Current implementation of
mysql_stmt_close() function unconditionally free passed statement
structure and therefore following mysql_stmt_error() call is defective
to use-after-free.

Relevant part of implementation of mysql_stmt_close() function is:

my_bool mysql_stmt_close(MYSQL_STMT *stmt)
{
  int rc=0;
...
  if ((rc= stmt_command(mysql, COM_STMT_CLOSE, buff, 4, stmt)))
    set_stmt_errmsg(stmt, &mysql->net);
...
  my_free(stmt);
  return rc;
}

As you can see it stores real error message into stmt structure, but at
the end it is freed. Which means error message is no longer available
and caller is not able to read it (even via mysql_stmt_error() call).

As such defective code is in example of the usage, probably couple of
MySQL applications written according to that defective documentations
are affected to this issue.

There is reported real bug for MySQL DBI driver that is affected by this
issue [4]. Reporter probably compiled MySQL library or driver itself
with some compiler options which could detect buffer overflows and
uncovered this issue.

In April 17 I reported this issue to oCERT team and it was forwarded to
MySQL, MariaDB and Percona security teams.

MariaDB team answered that this is problem in Oracle & MySQL and their
documentation as MariaDB do not have such vulnerable example in their
documentation.

Oracle team was unwilling to tell anything, provide any information how
to handle such issue or what to do, therefore with suggestion from oCERT
I decided to make this report public and open public discussion for
other people on oss-security list how to handle this problem.

As Oracle fully ignored this problem and have not stated if problem is
in documentation, implementation or both, I see probably 3 different
solutions:

1) Documentation with examples is correct and this is how it should be
used. What is wrong is implementation.

It would mean that function mysql_stmt_error() and mysql_stmt_errno()
needs to specially handle statement pointers which were already freed by
mysql_stmt_close(). This can be done e.g. by storing hash table of
pointers and assigning for them last received error.

Or clarifying that mysql_stmt_close() does not always free passed
memory. Because from current description in documentation it is not
fully unambiguous what happen if function fails.

In this case implementation of mysql_stmt_close(), mysql_stmt_error()
and mysql_stmt_errno() are vulnerable to use-after-free defect and needs
to be fixed. And it should be assigned CVE for MySQL for this problem.

2) Implementation is correct, documentation is wrong.

Documentation needs to be fixed to properly describe how are those
functions implemented. Important note must be that if function
mysql_stmt_close() fails it is not possible to take error code via
mysql_stmt_error() or mysql_stmt_errno(). Also examples needs to be
fixed.

And then all MySQL applications which were written according to wrong
documentation needs to be fixed and for each one needs to be assigned
CVE. Number of those applications is unknown, to get it first every
application which uses libmysqlclient.so needs to be checked and
verified. What we know now is that MySQL Perl DBI is affected.

3) Documentation is wrong, but implementation of mysql_stmt_close() is
not-so-correct.

Which would mean that return value of mysql_stmt_close() is fully
meaningless as there is no way to recover from bad state. Currently
mysql_stmt_close() unconditionally free memory for statement, so no
recover is possible.

There are two options what can be done:

* Always return value zero which means no error occurred. This basically
mitigate use-after-free vulnerability in Oracle's documentation and also
all applications which were written according to documentation.

* When error occurred, do not free memory of passed structure. This
would mean that following mysql_stmt_error() call would not be affected
by use-after-free anymore.

As Oracle ignored this security related problem (***) I would like to
ask, how to handle this problem? And to which software needs to be
requested for CVE? To MySQL itself (as described in option 1)? Or to
every one software which uses MySQL (as described in option 2)?

I think you understand me, that MySQL DBD driver needs to be fixed,
ideally ASAP. Bug report on github is from April 13 [4]. And as Oracle
is not willing to do anything, I hope that people on public oss-security
list give some advice how to handle this situation.

I'm CCing all relevant security teams, when replaying please do not
forget to include them + me. Thanks!

--

[1] - <https://dev.mysql.com/doc/refman/5.7/en/mysql-stmt-close.html>
[2] - <https://dev.mysql.com/doc/refman/5.7/en/mysql-stmt-error.html>
[3] - <https://dev.mysql.com/doc/refman/5.7/en/mysql-stmt-execute.html>
[4] - <https://github.com/perl5-dbi/DBD-mysql/issues/120>

(***) - This is not a first time! Previous two security issues reported
by me were ignored too. Oracle is the worst company in handling security
issues. It is useless to report them anything. They just start threaten
if you make information about issue public. And they are not competent
to start working on it or fix it in less then 6 months! Really I suggest
to not report any security bug to Oracle, it is just wasting of time.

--
Pali Rohár
pali.rohar () gmail com

```

**Attachment:
[signature.asc](att-443/signature_asc.bin)**

*Description:* This is a digitally signed message part.

---

[![Previous](/images/left-icon-16x16.png)](442)
[By Date](date.html#443)
[![Next](/images/right-icon-16x16.png)](444)

[![Previous](/images/left-icon-16x16.png)](442)
[By Thread](index.html#443)
[![Next](/images/right-icon-16x16.png)](458)

### Current thread:

* **MySQL - use-after-free after mysql\_stmt\_close()** *Pali Rohár (Jun 08)*
  + [Re: MySQL - use-after-free after mysql\_stmt\_close()](458) *Pali Rohár (Jun 12)*
    - [Re: Re: MySQL - use-after-free after mysql\_stmt\_close()](473) *Adam Maris (Jun 15)*
      * [Re: Re: MySQL - use-after-free after mysql\_stmt\_close()](474) *Kurt Seifried (Jun 15)** [Re: Re: MySQL - use-after-free after mysql\_stmt\_close()](476) *Kurt H Maier (Jun 15)** [Re: Re: MySQL - use-after-free after mysql\_stmt\_close()](478) *kseifried () redhat com (Jun 15)** [Re: Re: MySQL - use-after-free after mysql\_stmt\_close()](480) *Seth Arnold (Jun 15)*
        * [Re: Re: MySQL - use-after-free after mysql\_stmt\_close()](477) *Feng Cao (Jun 15)*
        * [Re: Re: MySQL - use-after-free after mysql\_stmt\_close()](482) *Brian May (Jun 15)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")



=== Content from github.com_a49d64a8_20250126_001750.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fperl5-dbi%2FDBD-mysql%2Fissues%2F120)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fperl5-dbi%2FDBD-mysql%2Fissues%2F120)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=perl5-dbi%2FDBD-mysql)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[perl5-dbi](/perl5-dbi)
/
**[DBD-mysql](/perl5-dbi/DBD-mysql)**
Public

* [Notifications](/login?return_to=%2Fperl5-dbi%2FDBD-mysql) You must be signed in to change notification settings
* [Fork
  74](/login?return_to=%2Fperl5-dbi%2FDBD-mysql)
* [Star
   63](/login?return_to=%2Fperl5-dbi%2FDBD-mysql)

* [Code](/perl5-dbi/DBD-mysql)
* [Issues
  69](/perl5-dbi/DBD-mysql/issues)
* [Pull requests
  2](/perl5-dbi/DBD-mysql/pulls)
* [Actions](/perl5-dbi/DBD-mysql/actions)
* [Projects
  0](/perl5-dbi/DBD-mysql/projects)
* [Security](/perl5-dbi/DBD-mysql/security)
* [Insights](/perl5-dbi/DBD-mysql/pulse)

Additional navigation options

* [Code](/perl5-dbi/DBD-mysql)
* [Issues](/perl5-dbi/DBD-mysql/issues)
* [Pull requests](/perl5-dbi/DBD-mysql/pulls)
* [Actions](/perl5-dbi/DBD-mysql/actions)
* [Projects](/perl5-dbi/DBD-mysql/projects)
* [Security](/perl5-dbi/DBD-mysql/security)
* [Insights](/perl5-dbi/DBD-mysql/pulse)

# DBD::mysql::st DESTROY failed on OpenBSD #120

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosed[#142](https://github.com/perl5-dbi/DBD-mysql/pull/142)Closed[DBD::mysql::st DESTROY failed on OpenBSD](#top)#120[#142](https://github.com/perl5-dbi/DBD-mysql/pull/142)Copy link[![@glasswalk3r](https://avatars.githubusercontent.com/u/3854915?u=fefbff11e25b554bc36299d29b6c9e36f87c5842&v=4&size=80)](/glasswalk3r)
## Description

[![@glasswalk3r](https://avatars.githubusercontent.com/u/3854915?u=fefbff11e25b554bc36299d29b6c9e36f87c5842&v=4&size=48)](/glasswalk3r)[glasswalk3r](https://github.com/glasswalk3r)opened [on Apr 13, 2017](https://github.com/perl5-dbi/DBD-mysql/issues/120#issue-221620437)

Some tests from DBD::mysql fail on OpenBSD with different perl versions (5.024001 and 5.020003). Here there are two different reports:

* <http://www.cpantesters.org/cpan/report/53f3da90-17de-11e7-a4a0-8eacd02b4708>
* <http://www.cpantesters.org/cpan/report/26042072-17de-11e7-a4a0-8eacd02b4708>

Both failed with the same errors:

```
DBD::mysql::st DESTROY failed: ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß

```

And this "beta" character goes on in very long lines.

It is important to note that MySQL is not indeed available on **OpenBSD 6.0** by default, but MariaDB is installed instead:

```
# mysql_clientinfo is: 10.0.25-MariaDB
# mysql_clientversion is: 100025
# mysql_serverversion is: 100025
# mysql_hostinfo is: Localhost via UNIX socket
# mysql_serverinfo is: 10.0.25-MariaDB
# mysql_stat is: Uptime: 1806  Threads: 1  Questions: 7763  Slow queries: 0  Opens: 430  Flush tables: 1  Open tables: 62  Queries per second avg: 4.298
# mysql_protoinfo is: 10
# SQL_DBMS_VER is 10.0.25-MariaDB
# Default storage engine is: InnoDB

```

I also have reports from this same CPAN Smoker with PASS and UNKNOWN results, but in both cases the tests were skipped.

## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


