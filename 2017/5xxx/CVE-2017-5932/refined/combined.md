=== Content from lists.gnu.org_a6505bd1_20250124_171201.html ===


| | **bug-bash** | | --- | |
| --- | --- |

[[Top](../)][[All Lists](/archive/html)]

[Advanced](/archive/cgi-bin/namazu.cgi?idxname=bug-bash)

---

[[Date Prev](msg00033.html)][[Date Next](msg00035.html)][[Thread Prev](msg00033.html)][[Thread Next](msg00035.html)][[Date Index](index.html#00034)][[Thread Index](threads.html#00034)]

## Bash-4.4 Official Patch 7

---

| **From**: | Chet Ramey |
| --- | --- |

| **Subject**: | Bash-4.4 Official Patch 7 |
| **Date**: | Fri, 20 Jan 2017 15:17:59 -0500 |

---

```
                             BASH PATCH REPORT
                             =================

Bash-Release:   4.4
Patch-ID:       bash44-007

Bug-Reported-by:        Jens Heyens <jens.heyens@cispa.saarland>
Bug-Reference-ID:
Bug-Reference-URL:      <https://savannah.gnu.org/support/?109224>

Bug-Description:

When performing filename completion, bash dequotes the directory name being
completed, which can result in match failures and potential unwanted
expansion.

Patch (apply with `patch -p0'):

*** ../bash-4.4-patched/bashline.c      2016-08-05 21:44:05.000000000 -0400
--- bashline.c  2017-01-19 13:15:51.000000000 -0500
***************
*** 143,147 ****
  static void restore_directory_hook __P((rl_icppfunc_t));

! static int directory_exists __P((const char *));

  static void cleanup_expansion_error __P((void));
--- 144,148 ----
  static void restore_directory_hook __P((rl_icppfunc_t));

! static int directory_exists __P((const char *, int));

  static void cleanup_expansion_error __P((void));
***************
*** 3103,3111 ****
  }

! /* Check whether not the (dequoted) version of DIRNAME, with any trailing
slash
!    removed, exists. */
  static int
! directory_exists (dirname)
       const char *dirname;
  {
    char *new_dirname;
--- 3107,3116 ----
  }

! /* Check whether not DIRNAME, with any trailing slash removed, exists.  If
!    SHOULD_DEQUOTE is non-zero, we dequote the directory name first. */
  static int
! directory_exists (dirname, should_dequote)
       const char *dirname;
+      int should_dequote;
  {
    char *new_dirname;
***************
*** 3113,3118 ****
    struct stat sb;

!   /* First, dequote the directory name */
!   new_dirname = bash_dequote_filename ((char *)dirname,
rl_completion_quote_character);
    dirlen = STRLEN (new_dirname);
    if (new_dirname[dirlen - 1] == '/')
--- 3118,3124 ----
    struct stat sb;

!   /* We save the string and chop the trailing slash because stat/lstat behave
!      inconsistently if one is present. */
!   new_dirname = should_dequote ? bash_dequote_filename ((char *)dirname,
rl_completion_quote_character) : savestring (dirname);
    dirlen = STRLEN (new_dirname);
    if (new_dirname[dirlen - 1] == '/')
***************
*** 3146,3150 ****
      should_expand_dirname = '`';

!   if (should_expand_dirname && directory_exists (local_dirname))
      should_expand_dirname = 0;

--- 3152,3156 ----
      should_expand_dirname = '`';

!   if (should_expand_dirname && directory_exists (local_dirname, 0))
      should_expand_dirname = 0;

***************
*** 3156,3160 ****
        global_nounset = unbound_vars_is_error;
        unbound_vars_is_error = 0;
!       wl = expand_prompt_string (new_dirname, 0, W_NOCOMSUB|W_COMPLETE);
/* does the right thing */
        unbound_vars_is_error = global_nounset;
        if (wl)
--- 3162,3166 ----
        global_nounset = unbound_vars_is_error;
        unbound_vars_is_error = 0;
!       wl = expand_prompt_string (new_dirname, 0,
W_NOCOMSUB|W_NOPROCSUB|W_COMPLETE);  /* does the right thing */
        unbound_vars_is_error = global_nounset;
        if (wl)
***************
*** 3245,3249 ****
      }

!   if (should_expand_dirname && directory_exists (local_dirname))
      should_expand_dirname = 0;

--- 3262,3266 ----
      }

!   if (should_expand_dirname && directory_exists (local_dirname, 1))
      should_expand_dirname = 0;

***************
*** 3251,3255 ****
      {
        new_dirname = savestring (local_dirname);
!       wl = expand_prompt_string (new_dirname, 0, W_NOCOMSUB|W_COMPLETE);
/* does the right thing */
        if (wl)
        {
--- 3268,3272 ----
      {
        new_dirname = savestring (local_dirname);
!       wl = expand_prompt_string (new_dirname, 0,
W_NOCOMSUB|W_NOPROCSUB|W_COMPLETE);  /* does the right thing */
        if (wl)
        {
*** ../bash-4.4/subst.c 2016-08-30 16:46:38.000000000 -0400
--- subst.c     2017-01-19 07:09:57.000000000 -0500
***************
*** 9459,9462 ****
--- 9459,9466 ----
              if (word->flags & W_COMPLETE)
                tword->flags |= W_COMPLETE;     /* for command substitutions */
+             if (word->flags & W_NOCOMSUB)
+               tword->flags |= W_NOCOMSUB;
+             if (word->flags & W_NOPROCSUB)
+               tword->flags |= W_NOPROCSUB;

              temp = (char *)NULL;
*** ../bash-4.4/patchlevel.h    2016-06-22 14:51:03.000000000 -0400
--- patchlevel.h        2016-10-01 11:01:28.000000000 -0400
***************
*** 26,30 ****
     looks for to find the patch level (for the sccs version string). */

! #define PATCHLEVEL 6

  #endif /* _PATCHLEVEL_H_ */
--- 26,30 ----
     looks for to find the patch level (for the sccs version string). */

! #define PATCHLEVEL 7

  #endif /* _PATCHLEVEL_H_ */

--
``The lyf so short, the craft so long to lerne.'' - Chaucer
                 ``Ars longa, vita brevis'' - Hippocrates
Chet Ramey, UTech, CWRU    chet@case.edu    <http://cnswww.cns.cwru.edu/~chet/>

```

---

reply via email to

---

| [Prev in Thread] | **Current Thread** | [Next in Thread] |
| --- | --- | --- |

* **Bash-4.4 Official Patch 7**,
  *Chet Ramey* **<=**

---

* Prev by Date:
  **[Bash-4.4 Official Patch 6](msg00033.html)**
* Next by Date:
  **[Bash-4.4 Official Patch 8](msg00035.html)**
* Previous by thread:
  **[Bash-4.4 Official Patch 6](msg00033.html)**
* Next by thread:
  **[Bash-4.4 Official Patch 8](msg00035.html)**
* Index(es):
  + [**Date**](index.html#00034)
  + [**Thread**](threads.html#00034)



=== Content from git.savannah.gnu.org_874b16d5_20250124_171200.html ===


| [cgit logo](/cgit/) | [index](/cgit/) : [bash.git](/cgit/bash.git/) | bash-4.3-testing bash-4.4-testing bash-5.0-testing bash-5.1-testing bash-5.2-testing bash-5.3-testing devel direxpand import-tars master |
| --- | --- | --- |
| bash |  |

| [summary](/cgit/bash.git/)[refs](/cgit/bash.git/refs/?id=4f747edc625815f449048579f6e65869914dd715)[log](/cgit/bash.git/log/)[tree](/cgit/bash.git/tree/?id=4f747edc625815f449048579f6e65869914dd715)[commit](/cgit/bash.git/commit/?id=4f747edc625815f449048579f6e65869914dd715)[diff](/cgit/bash.git/diff/?id=4f747edc625815f449048579f6e65869914dd715) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Chet Ramey <chet.ramey@case.edu> | 2017-01-20 11:47:55 -0500 |
| --- | --- | --- |
| committer | Chet Ramey <chet.ramey@case.edu> | 2017-01-20 11:47:55 -0500 |
| commit | [4f747edc625815f449048579f6e65869914dd715](/cgit/bash.git/commit/?id=4f747edc625815f449048579f6e65869914dd715) ([patch](/cgit/bash.git/patch/?id=4f747edc625815f449048579f6e65869914dd715)) | |
| tree | [bff5b781289df51d6a067965abf345aacc352fe4](/cgit/bash.git/tree/?id=4f747edc625815f449048579f6e65869914dd715) | |
| parent | [44bfefc553993613c0aff992bc4f3078d738ee1d](/cgit/bash.git/commit/?id=44bfefc553993613c0aff992bc4f3078d738ee1d) ([diff](/cgit/bash.git/diff/?id=4f747edc625815f449048579f6e65869914dd715&id2=44bfefc553993613c0aff992bc4f3078d738ee1d)) | |
| download | [bash-4f747edc625815f449048579f6e65869914dd715.tar.gz](/cgit/bash.git/snapshot/bash-4f747edc625815f449048579f6e65869914dd715.tar.gz) | |

Bash-4.4 patch 7[Diffstat](/cgit/bash.git/diff/?id=4f747edc625815f449048579f6e65869914dd715)

| -rw-r--r-- | [bashline.c](/cgit/bash.git/diff/bashline.c?id=4f747edc625815f449048579f6e65869914dd715) | 22 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [patchlevel.h](/cgit/bash.git/diff/patchlevel.h?id=4f747edc625815f449048579f6e65869914dd715) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [subst.c](/cgit/bash.git/diff/subst.c?id=4f747edc625815f449048579f6e65869914dd715) | 4 | |  |  |  | | --- | --- | --- | |

3 files changed, 17 insertions, 11 deletions

| diff --git a/bashline.c b/bashline.cindex f4fe9f1b..02758448 100644--- a/[bashline.c](/cgit/bash.git/tree/bashline.c?id=44bfefc553993613c0aff992bc4f3078d738ee1d)+++ b/[bashline.c](/cgit/bash.git/tree/bashline.c?id=4f747edc625815f449048579f6e65869914dd715)@@ -142,7 +142,7 @@ static int executable\_completion \_\_P((const char \*, int)); static rl\_icppfunc\_t \*save\_directory\_hook \_\_P((void)); static void restore\_directory\_hook \_\_P((rl\_icppfunc\_t)); -static int directory\_exists \_\_P((const char \*));+static int directory\_exists \_\_P((const char \*, int));  static void cleanup\_expansion\_error \_\_P((void)); static void maybe\_make\_readline\_line \_\_P((char \*));@@ -3102,18 +3102,20 @@ restore\_directory\_hook (hookf) rl\_directory\_rewrite\_hook = hookf; } -/\* Check whether not the (dequoted) version of DIRNAME, with any trailing slash- removed, exists. \*/+/\* Check whether not DIRNAME, with any trailing slash removed, exists. If+ SHOULD\_DEQUOTE is non-zero, we dequote the directory name first. \*/ static int-directory\_exists (dirname)+directory\_exists (dirname, should\_dequote) const char \*dirname;+ int should\_dequote; { char \*new\_dirname; int dirlen, r; struct stat sb; - /\* First, dequote the directory name \*/- new\_dirname = bash\_dequote\_filename ((char \*)dirname, rl\_completion\_quote\_character);+ /\* We save the string and chop the trailing slash because stat/lstat behave+ inconsistently if one is present. \*/+ new\_dirname = should\_dequote ? bash\_dequote\_filename ((char \*)dirname, rl\_completion\_quote\_character) : savestring (dirname); dirlen = STRLEN (new\_dirname); if (new\_dirname[dirlen - 1] == '/') new\_dirname[dirlen - 1] = '\0';@@ -3145,7 +3147,7 @@ bash\_filename\_stat\_hook (dirname) else if (t = mbschr (local\_dirname, '`')) /\* XXX \*/ should\_expand\_dirname = '`'; - if (should\_expand\_dirname && directory\_exists (local\_dirname))+ if (should\_expand\_dirname && directory\_exists (local\_dirname, 0)) should\_expand\_dirname = 0;  if (should\_expand\_dirname) @@ -3155,7 +3157,7 @@ bash\_filename\_stat\_hook (dirname) have to worry about restoring this setting. \*/ global\_nounset = unbound\_vars\_is\_error; unbound\_vars\_is\_error = 0;- wl = expand\_prompt\_string (new\_dirname, 0, W\_NOCOMSUB|W\_COMPLETE); /\* does the right thing \*/+ wl = expand\_prompt\_string (new\_dirname, 0, W\_NOCOMSUB|W\_NOPROCSUB|W\_COMPLETE); /\* does the right thing \*/ unbound\_vars\_is\_error = global\_nounset; if (wl) {@@ -3244,13 +3246,13 @@ bash\_directory\_completion\_hook (dirname) should\_expand\_dirname = '`'; } - if (should\_expand\_dirname && directory\_exists (local\_dirname))+ if (should\_expand\_dirname && directory\_exists (local\_dirname, 1)) should\_expand\_dirname = 0;  if (should\_expand\_dirname)  { new\_dirname = savestring (local\_dirname);- wl = expand\_prompt\_string (new\_dirname, 0, W\_NOCOMSUB|W\_COMPLETE); /\* does the right thing \*/+ wl = expand\_prompt\_string (new\_dirname, 0, W\_NOCOMSUB|W\_NOPROCSUB|W\_COMPLETE); /\* does the right thing \*/ if (wl) { \*dirname = string\_list (wl);diff --git a/patchlevel.h b/patchlevel.hindex 14bff9fc..deb9c5b7 100644--- a/[patchlevel.h](/cgit/bash.git/tree/patchlevel.h?id=44bfefc553993613c0aff992bc4f3078d738ee1d)+++ b/[patchlevel.h](/cgit/bash.git/tree/patchlevel.h?id=4f747edc625815f449048579f6e65869914dd715)@@ -25,6 +25,6 @@ regexp `^#define[ ]\*PATCHLEVEL', since that's what support/mkversion.sh looks for to find the patch level (for the sccs version string). \*/ -#define PATCHLEVEL 6+#define PATCHLEVEL 7  #endif /\* \_PATCHLEVEL\_H\_ \*/diff --git a/subst.c b/subst.cindex 298187d2..027a13e6 100644--- a/[subst.c](/cgit/bash.git/tree/subst.c?id=44bfefc553993613c0aff992bc4f3078d738ee1d)+++ b/[subst.c](/cgit/bash.git/tree/subst.c?id=4f747edc625815f449048579f6e65869914dd715)@@ -9458,6 +9458,10 @@ add\_twochars: tword->flags |= word->flags & (W\_ASSIGNARG|W\_ASSIGNRHS); /\* affects $@ \*/ if (word->flags & W\_COMPLETE) tword->flags |= W\_COMPLETE; /\* for command substitutions \*/+ if (word->flags & W\_NOCOMSUB)+ tword->flags |= W\_NOCOMSUB;+ if (word->flags & W\_NOPROCSUB)+ tword->flags |= W\_NOPROCSUB;  temp = (char \*)NULL; |
| --- |

generated by [cgit v1.2.3-70-g09d2](https://git.zx2c4.com/cgit/about/) ([git 2.46.0](https://git-scm.com/)) at 2025-01-24 17:12:00 +0000



=== Content from www.openwall.com_18ea7c93_20250124_171201.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](2) [[next>]](4) [[<thread-prev]](../../../2017/02/07/9) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <3cd6d83d8565413891ad2de83f725a6f@imshyb02.MITRE.ORG>
Date: Tue, 7 Feb 2017 20:19:19 -0500
From: <cve-assign@...re.org>
To: <jens.heyens@...pa.saarland>
CC: <cve-assign@...re.org>, <oss-security@...ts.openwall.com>,
	<stock@...uni-saarland.de>
Subject: Re: CVE Request - Code execution vulnerability in GNU/bash v4.4 autocompletion

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

> <https://github.com/jheyens/bash_completion_vuln/raw/master/2017-01-17.bash_completion_report.pdf>
> <http://git.savannah.gnu.org/cgit/bash.git/commit/?id=4f747edc625815f449048579f6e65869914dd715>

Use CVE-2017-5932.

The scope of this CVE is the single vulnerability resulting from the
combination of the "Double dequoting of dirname" issue and the "Flags
not being forwarded in expand_word_internal" issue.

- --
CVE Assignment Team
M/S M300, 202 Burlington Road, Bedford, MA 01730 USA
[ A PGP key is available for encrypted communications at
  <http://cve.mitre.org/cve/request_id.html> ]
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQIcBAEBCAAGBQJYmm+6AAoJEHb/MwWLVhi2m+gP/A9e0TfQWk4soMJkiZCQAOBt
yGI3xQtDUWGqMBvKTajCNufdRRU3mTjWmf5RDZNmF6HRbinwqiMSxUDpWC/+Rofk
CD/8u0VHRVuZ1DLiN1mbhjLlbZxWxzCX4uJgU5fabYTXxvbnIK36mxNS+MSa9dr/
zUBMs7eOM19wcNcbVr53sURjEqroEKB7qX+JxE1kSvh8BxDi/mLDM5AAQk8cOXPh
qK+cPhejya1QMq16iozxZsOdd7gsiPE63TGBYjXeoN40ypmfNDduPe474gnIyChc
kfKpjWT9+8SwyC8MPmteEJkdgTtJymmoxh7u9Z13KPNjZrafvbVH1HokwwGRkzGo
J5rg6wWE0JOF72t3f+v3abZYaoETuGjeSWKU/v0qTdQQnFYOVN7s6VvDTd/Uc0lD
0a/ZZl4QvQ/gl5gczAU8rElVTZcQ/DnEwGy2vkbs9vu1/Baxf+v7Hs6r2oaGLbgN
HixcoyE9P0ftuqXqEjnS6juXGijl7Yrg/lbWKidbuL+G+u09XY6qzI03+2MPNScA
xtDxwQHXY7htROuvWuWW1kSFwAL28hvdA4b0Qi3s7OfgW+X6obaVR5JTeAvPNFQN
2LU3ZS5Qi5yjBX9iB1/nuybLCxN/5JCBQgvAij6dV1PAD2IiO4Kz3wC8uPV5D+eb
NuHugptNphEzgZaSOI5u
=v+0f
-----END PGP SIGNATURE-----

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).


