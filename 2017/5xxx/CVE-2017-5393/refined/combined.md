=== Content from www.mozilla.org_cb308383_20250125_175802.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2017-01

## Security vulnerabilities fixed in Firefox 51

Announced
January 24, 2017
Impact
critical
Products
Firefox
Fixed in

* Firefox 51

#### [#CVE-2017-5375: Excessive JIT code allocation allows bypass of ASLR and DEP](#CVE-2017-5375)

Reporter
Rh0
Impact
critical
##### Description

JIT code allocation can allow for a bypass of ASLR and DEP protections leading to potential memory corruption attacks.

##### References

* [Bug 1325200](https://bugzilla.mozilla.org/show_bug.cgi?id=1325200)

#### [#CVE-2017-5376: Use-after-free in XSL](#CVE-2017-5376)

Reporter
Nicolas Grégoire
Impact
critical
##### Description

Use-after-free while manipulating XSL in XSLT documents

##### References

* [Bug 1311687](https://bugzilla.mozilla.org/show_bug.cgi?id=1311687)

#### [#CVE-2017-5377: Memory corruption with transforms to create gradients in Skia](#CVE-2017-5377)

Reporter
Atte Kettunen
Impact
critical
##### Description

A memory corruption vulnerability in Skia that can occur when using transforms to make gradients, resulting in a potentially exploitable crash.

##### References

* [Bug 1306883](https://bugzilla.mozilla.org/show_bug.cgi?id=1306883)

#### [#CVE-2017-5378: Pointer and frame data leakage of Javascript objects](#CVE-2017-5378)

Reporter
Jann Horn
Impact
high
##### Description

Hashed codes of JavaScript objects are shared between pages. This allows for pointer leaks because an object’s address can be discovered through hash codes, and also allows for data leakage of an object’s content using these hash codes.

##### References

* [Bug 1312001](https://bugzilla.mozilla.org/show_bug.cgi?id=1312001)
* [Bug 1330769](https://bugzilla.mozilla.org/show_bug.cgi?id=1330769)

#### [#CVE-2017-5379: Use-after-free in Web Animations](#CVE-2017-5379)

Reporter
Nils
Impact
high
##### Description

Use-after-free vulnerability in Web Animations when interacting with cycle collection found through fuzzing.

##### References

* [Bug 1309198](https://bugzilla.mozilla.org/show_bug.cgi?id=1309198)

#### [#CVE-2017-5380: Potential use-after-free during DOM manipulations](#CVE-2017-5380)

Reporter
Nils
Impact
high
##### Description

A potential use-after-free found through fuzzing during DOM manipulation of SVG content.

##### References

* [Bug 1322107](https://bugzilla.mozilla.org/show_bug.cgi?id=1322107)

#### [#CVE-2017-5390: Insecure communication methods in Developer Tools JSON viewer](#CVE-2017-5390)

Reporter
Jerri Rice
Impact
high
##### Description

The JSON viewer in the Developer Tools uses insecure methods to create a communication channel for copying and viewing JSON or HTTP headers data, allowing for potential privilege escalation.

##### References

* [Bug 1297361](https://bugzilla.mozilla.org/show_bug.cgi?id=1297361)

#### [#CVE-2017-5389: WebExtensions can install additional add-ons via modified host requests](#CVE-2017-5389)

Reporter
Kris Maglione
Impact
high
##### Description

WebExtensions could use the `mozAddonManager` API by modifying the CSP headers on sites with the appropriate permissions and then using host requests to redirect script loads to a malicious site. This allows a malicious extension to then install additional extensions without explicit user permission.

##### References

* [Bug 1308688](https://bugzilla.mozilla.org/show_bug.cgi?id=1308688)

#### [#CVE-2017-5396: Use-after-free with Media Decoder](#CVE-2017-5396)

Reporter
Filipe Gomes
Impact
high
##### Description

A use-after-free vulnerability in the Media Decoder when working with media files when some events are fired after the media elements are freed from memory.

##### References

* [Bug 1329403](https://bugzilla.mozilla.org/show_bug.cgi?id=1329403)

#### [#CVE-2017-5381: Certificate Viewer exporting can be used to navigate and save to arbitrary filesystem locations](#CVE-2017-5381)

Reporter
Jann Horn
Impact
moderate
##### Description

The "export" function in the Certificate Viewer can force local filesystem navigation when the "common name" in a certificate contains slashes, allowing certificate content to be saved in unsafe locations with an arbitrary filename.

##### References

* [Bug 1017616](https://bugzilla.mozilla.org/show_bug.cgi?id=1017616)

#### [#CVE-2017-5382: Feed preview can expose privileged content errors and exceptions](#CVE-2017-5382)

Reporter
Jerri Rice
Impact
moderate
##### Description

Feed preview for RSS feeds can be used to capture errors and exceptions generated by privileged content, allowing for the exposure of internal information not meant to be seen by web content.

##### References

* [Bug 1295322](https://bugzilla.mozilla.org/show_bug.cgi?id=1295322)

#### [#CVE-2017-5383: Location bar spoofing with unicode characters](#CVE-2017-5383)

Reporter
Armin Ebert
Impact
moderate
##### Description

URLs containing certain unicode glyphs for alternative hyphens and quotes do not properly trigger punycode display, allowing for domain name spoofing attacks in the location bar.

##### References

* [Bug 1323338](https://bugzilla.mozilla.org/show_bug.cgi?id=1323338)
* [Bug 1324716](https://bugzilla.mozilla.org/show_bug.cgi?id=1324716)

#### [#CVE-2017-5384: Information disclosure via Proxy Auto-Config (PAC)](#CVE-2017-5384)

Reporter
Paul Stone, Alex Chapman
Impact
moderate
##### Description

Proxy Auto-Config (PAC) files can specify a JavaScript function called for all URL requests with the full URL path which exposes more information than would be sent to the proxy itself in the case of HTTPS. Normally the Proxy Auto-Config file is specified by the user or machine owner and presumed to be non-malicious, but if a user has enabled Web Proxy Auto Detect (WPAD) this file can be served remotely.

##### References

* [Bug 1255474](https://bugzilla.mozilla.org/show_bug.cgi?id=1255474)
* [Sniffing HTTPS URLS with malicious PAC files](https://www.contextis.com//resources/blog/leaking-https-urls-20-year-old-vulnerability/)

#### [#CVE-2017-5385: Data sent in multipart channels ignores referrer-policy response headers](#CVE-2017-5385)

Reporter
Muneaki Nishimura
Impact
moderate
##### Description

Data sent with in multipart channels, such as the multipart/x-mixed-replace MIME type, will ignore the referrer-policy response header, leading to potential information disclosure for sites using this header.

##### References

* [Bug 1295945](https://bugzilla.mozilla.org/show_bug.cgi?id=1295945)

#### [#CVE-2017-5386: WebExtensions can use data: protocol to affect other extensions](#CVE-2017-5386)

Reporter
Muneaki Nishimura
Impact
moderate
##### Description

WebExtension scripts can use the `data:` protocol to affect pages loaded by other web extensions using this protocol, leading to potential data disclosure or privilege escalation in affected extensions.

##### References

* [Bug 1319070](https://bugzilla.mozilla.org/show_bug.cgi?id=1319070)

#### [#CVE-2017-5394: Android location bar spoofing using fullscreen and JavaScript events](#CVE-2017-5394)

Reporter
Jordi Chancel
Impact
moderate
##### Description

A location bar spoofing attack where the location bar of loaded page will be shown over the content of another tab due to a series of JavaScript events combined with fullscreen mode.
*Note: This issue only affects Firefox for Android. Other operating systems are not affected.*

##### References

* [Bug 1222798](https://bugzilla.mozilla.org/show_bug.cgi?id=1222798)

#### [#CVE-2017-5391: Content about: pages can load privileged about: pages](#CVE-2017-5391)

Reporter
Jerri Rice
Impact
moderate
##### Description

Special `about:` pages used by web content, such as RSS feeds, can load privileged `about:` pages in an iframe. If a content-injection bug were found in one of those pages this could allow for potential privilege escalation.

##### References

* [Bug 1309310](https://bugzilla.mozilla.org/show_bug.cgi?id=1309310)

#### [#CVE-2017-5392: Weak references using multiple threads on weak proxy objects lead to unsafe memory usage](#CVE-2017-5392)

Reporter
Honza Bambas
Impact
moderate
##### Description

Weak proxy objects have weak references on multiple threads when they should only have them on one, resulting in incorrect memory usage and corruption, which leads to potentially exploitable crashes.
*Note: This issue only affects Firefox for Android. Other operating systems are not affected.*

##### References

* [Bug 1293709](https://bugzilla.mozilla.org/show_bug.cgi?id=1293709)

#### [#CVE-2017-5393: Remove addons.mozilla.org CDN from whitelist for mozAddonManager](#CVE-2017-5393)

Reporter
Stuart Colville
Impact
moderate
##### Description

The `mozAddonManager` allows for the installation of extensions from the CDN for addons.mozilla.org, a publicly accessible site. This could allow malicious extensions to install additional extensions from the CDN in combination with an XSS attack on Mozilla AMO sites.

##### References

* [Bug 1309282](https://bugzilla.mozilla.org/show_bug.cgi?id=1309282)

#### [#CVE-2017-5395: Android location bar spoofing during scrolling](#CVE-2017-5395)

Reporter
Jordi Chancel
Impact
low
##### Description

Malicious sites can display a spoofed location bar on a subsequently loaded page when the existing location bar on the new page is scrolled out of view if navigations between pages can be timed correctly.
*Note: This issue only affects Firefox for Android. Other operating systems are not affected.*

##### References

* [Bug 1293463](https://bugzilla.mozilla.org/show_bug.cgi?id=1293463)

#### [#CVE-2017-5387: Disclosure of local file existence through TRACK tag error messages](#CVE-2017-5387)

Reporter
Mustafa Hasan
Impact
low
##### Description

The existence of a specifically requested local file can be found due to the double firing of the `onerror` when the `source` attribute on a `<track>` tag refers to a file that does not exist if the source page is loaded locally.

##### References

* [Bug 1295023](https://bugzilla.mozilla.org/show_bug.cgi?id=1295023)

#### [#CVE-2017-5388: WebRTC can be used to generate a large amount of UDP traffic for DDOS attacks](#CVE-2017-5388)

Reporter
Cullen Jennings
Impact
low
##### Description

A STUN server in conjunction with a large number of `webkitRTCPeerConnection` objects can be used to send large STUN packets in a short period of time due to a lack of rate limiting being applied on e10s systems, allowing for a denial of service attack.

##### References

* [Bug 1281482](https://bugzilla.mozilla.org/show_bug.cgi?id=1281482)

#### [#CVE-2017-5374: Memory safety bugs fixed in Firefox 51](#CVE-2017-5374)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Gary Kwong, Olli Pettay, Tooru Fujisawa, Carsten Book, Andrew McCreight, Chris Pearce, Ronald Crane, Jan de Mooij, Julian Seward, Nicolas Pierron, Randell Jesup, Esther Monchari, Honza Bambas, and Philipp reported memory safety bugs present in Firefox 50.1. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 51](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1325344%2C1317501%2C1311319%2C1329989%2C1300145%2C1322305%2C1288561%2C1295747%2C1318766%2C1297808%2C1321374%2C1324810%2C1313385%2C1319888%2C1302231%2C1307458%2C1293327%2C1315447%2C1319456)

#### [#CVE-2017-5373: Memory safety bugs fixed in Firefox 51 and Firefox ESR 45.7](#CVE-2017-5373)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Christian Holler, Gary Kwong, André Bargull, Jan de Mooij, Tom Schuster, and Oriol reported memory safety bugs present in Firefox 50.1 and Firefox ESR 45.6. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 51 and Firefox ESR 45.7](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1322315%2C1328834%2C1322420%2C1285833%2C1285960%2C1328251%2C1331058%2C1325938%2C1325877)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_650871e5_20250125_175802.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

## Related documentation

* [Creating an account](https://bmo.readthedocs.io/en/latest/myaccount.html)
# Access Denied

| You are not authorized to access bug 1309282. To see this bug, you must first [log in to an account](/show_bug.cgi?id=1309282&GoAheadAndLogIn=1) with the appropriate permissions. |
| --- |

Please press **Back** and try again.



=== Content from bugzilla.mozilla.org_10819095_20250126_104741.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1293709)
* [XML](/show_bug.cgi?ctype=xml&id=1293709)

Closed
[Bug 1293709](/show_bug.cgi?id=1293709)
(CVE-2017-5392)

Opened 8 years ago
Closed 8 years ago

# nsWindow::LayerViewSupport's weak reference used on multiple threads

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

nsWindow::LayerViewSupport's weak reference used on multiple threads

## Categories

### (Core Graveyard :: Widget: Android, defect, P1)

[Product:](/describecomponents.cgi?product=Core%20Graveyard)

Core Graveyard
▾

Core Graveyard
Old, retired Core components
[See Open Bugs in This Product](/buglist.cgi?product=Core%20Graveyard&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core%20Graveyard)
Watch This Product

[Component:](/describecomponents.cgi?product=Core%20Graveyard&component=Widget%3A%20Android#Widget%3A%20Android)

Widget: Android
▾

Core Graveyard :: Widget: Android
Mapping of cross platform widget interfaces to Android platform APIs.
[See Open Bugs in This Component](/buglist.cgi?product=Core%20Graveyard&component=Widget%3A%20Android&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core%20Graveyard&component=Widget%3A%20Android&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core%20Graveyard&component=Widget%3A%20Android)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

Android

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

## Tracking

### (fennec51+, firefox51 fixed)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla51

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| fennec | [51+](/buglist.cgi?f1=cf_blocking_fennec&o1=equals&v1=51%2B) | --- |
| firefox51 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| fennec | 51+ |  |
| firefox51 |  | fixed |

## People

### (Reporter: mayhemer, Assigned: jchen)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/bc062869d013a3c67a222cdf27b430bc?d=mm&size=40)  [jchen](/user_profile?user_id=281508)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](extensions/Gravatar/web/default.jpg)  [mayhemer](/user_profile?user_id=269762)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

---

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[956338](/show_bug.cgi?id=956338 "RESOLVED FIXED - Add checks to WeakPtr and related classes to assert single-thread usage")

Dependency [tree](/showdependencytree.cgi?id=1293709&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1293709)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-race, sec-moderate, Whiteboard: [post-critsmash-triage][adv-main51+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2017-5392

[Keywords:](/describekeywords.cgi)

[csectype-race](/buglist.cgi?keywords=csectype-race&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[post-critsmash-triage][adv-main51+]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [mwobensmith](/user_profile?user_id=452604) | [qe-verify](#a13211987_452604 "8 years ago") | - |
| --- | --- | --- |
| [mwobensmith](/user_profile?user_id=452604) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files, 6 obsolete files)

| [Add NativePtr and WindowPtr smart pointers (v1)](/attachment.cgi?id=8780665)  [8 years ago](#c7)  [(inactive) Jim Chen [:jchen] [:darchons]](/user_profile?user_id=281508)   4.72 KB, patch | snorp : [review+](#a531143_227322 "8 years ago") | [Details](/attachment.cgi?id=8780665&action=edit) | [Diff](/attachment.cgi?id=8780665&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1293709&attachment=8780665) |
| --- | --- | --- |
| [Use NativePtr and WindowPtr for NPZCSupport (v1)](/attachment.cgi?id=8780666)  [8 years ago](#c8)  [(inactive) Jim Chen [:jchen] [:darchons]](/user_profile?user_id=281508)   15.62 KB, patch | snorp : [review+](#a531182_227322 "8 years ago") | [Details](/attachment.cgi?id=8780666&action=edit) | [Diff](/attachment.cgi?id=8780666&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1293709&attachment=8780666) |
| [Use NativePtr and WindowPtr for LayerViewSupport (v1)](/attachment.cgi?id=8780667)  [8 years ago](#c9)  [(inactive) Jim Chen [:jchen] [:darchons]](/user_profile?user_id=281508)   24.41 KB, patch | snorp : [review+](#c10 "8 years ago") | [Details](/attachment.cgi?id=8780667&action=edit) | [Diff](/attachment.cgi?id=8780667&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1293709&attachment=8780667) |
| [Add NativePtr and WindowPtr smart pointers (v1.1)](/attachment.cgi?id=8781651)  [8 years ago](#c12)  [(inactive) Jim Chen [:jchen] [:darchons]](/user_profile?user_id=281508)   4.72 KB, patch | jchen : [review+](#c12 "8 years ago") | [Details](/attachment.cgi?id=8781651&action=edit) | [Diff](/attachment.cgi?id=8781651&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1293709&attachment=8781651) |
| [Use NativePtr and WindowPtr for NPZCSupport (v1.1)](/attachment.cgi?id=8781652)  [8 years ago](#c13)  [(inactive) Jim Chen [:jchen] [:darchons]](/user_profile?user_id=281508)   15.70 KB, patch | jchen : [review+](#c13 "8 years ago") | [Details](/attachment.cgi?id=8781652&action=edit) | [Diff](/attachment.cgi?id=8781652&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1293709&attachment=8781652) |
| [Use NativePtr and WindowPtr for LayerViewSupport (v1.1)](/attachment.cgi?id=8781653)  [8 years ago](#c14)  [(inactive) Jim Chen [:jchen] [:darchons]](/user_profile?user_id=281508)   23.06 KB, patch | jchen : [review+](#c14 "8 years ago") | [Details](/attachment.cgi?id=8781653&action=edit) | [Diff](/attachment.cgi?id=8781653&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1293709&attachment=8781653) |
| [Add NativePtr and WindowPtr smart pointers (v1.2)](/attachment.cgi?id=8782528)  [8 years ago](#c19)  [(inactive) Jim Chen [:jchen] [:darchons]](/user_profile?user_id=281508)   6.28 KB, patch | jchen : [review+](#c19 "8 years ago") | [Details](/attachment.cgi?id=8782528&action=edit) | [Diff](/attachment.cgi?id=8782528&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1293709&attachment=8782528) |
| [Use NativePtr and WindowPtr for NPZCSupport (v1.2)](/attachment.cgi?id=8782529)  [8 years ago](#c20)  [(inactive) Jim Chen [:jchen] [:darchons]](/user_profile?user_id=281508)   18.08 KB, patch | jchen : [review+](#c20 "8 years ago") | [Details](/attachment.cgi?id=8782529&action=edit) | [Diff](/attachment.cgi?id=8782529&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1293709&attachment=8782529) |
| [Use NativePtr and WindowPtr for LayerViewSupport (v1.2)](/attachment.cgi?id=8782530)  [8 years ago](#c21)  [(inactive) Jim Chen [:jchen] [:darchons]](/user_profile?user_id=281508)   27.92 KB, patch | jchen : [review+](#c21 "8 years ago") | [Details](/attachment.cgi?id=8782530&action=edit) | [Diff](/attachment.cgi?id=8782530&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1293709&attachment=8782530) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1293709#c0)• 8 years ago |
|  | |

Based on [bug 956338](/show_bug.cgi?id=956338 "RESOLVED FIXED - Add checks to WeakPtr and related classes to assert single-thread usage"), see <https://treeherder.mozilla.org/#/jobs?repo=try&revision=cfc312760e8c4c6103e05b80db1b192d64fe337b> for android, log: <https://treeherder.mozilla.org/logviewer.html#?job_id=25388610&repo=try#L1704>
Weak references are not thread safe.
09:35:44 INFO - 0 libxul.so!mozilla::detail::WeakReference<nsWindow::GeckoViewSupport>::get [WeakPtr.h:cfc312760e8c : 137 + 0x0]
09:35:44 INFO - r0 = 0x5d7dd7d7 r1 = 0x96b33039 r2 = 0x96b33039 r3 = 0x5df31f08
09:35:44 INFO - r4 = 0x00000000 r5 = 0x61e24b60 r6 = 0x2a2964b0 r7 = 0x62bff498
09:35:44 INFO - r8 = 0x62bff4a8 r9 = 0x5347cedc r10 = 0x2a295de0 r12 = 0x00000003
09:35:44 INFO - fp = 0x62bff4bc sp = 0x62bff430 lr = 0x5cb4c86b pc = 0x5cb4c86a
09:35:44 INFO - Found by: given as instruction pointer in context
09:35:44 INFO - 1 libxul.so!mozilla::jni::detail::NativePtr<nsWindow::LayerViewSupport, true>::Get<mozilla::jni::LocalRef<mozilla::java::LayerView::Compositor> > [WeakPtr.h:cfc312760e8c : 246 + 0x5]
09:35:44 INFO - r4 = 0x4c7a3f78 r5 = 0x2a2964b0 r6 = 0x2a2964b0 r7 = 0x62bff498
09:35:44 INFO - r8 = 0x62bff4a8 r9 = 0x5347cedc r10 = 0x2a295de0 fp = 0x62bff4bc
09:35:44 INFO - sp = 0x62bff448 pc = 0x5cb4f7c3
09:35:44 INFO - Found by: call frame info
09:35:44 INFO - 2 libxul.so!mozilla::jni::detail::ProxyNativeCall<nsWindow::LayerViewSupport, mozilla::java::LayerView::Compositor, false, false>::operator() [Natives.h:cfc312760e8c : 345 + 0x5]
09:35:44 INFO - r3 = 0x0000001a r4 = 0x4c7a3f78 r5 = 0x62bff490 r6 = 0x2a2964b0
09:35:44 INFO - r7 = 0x62bff498 r8 = 0x62bff4a8 r9 = 0x5347cedc r10 = 0x2a295de0
09:35:44 INFO - fp = 0x62bff4bc sp = 0x62bff458 pc = 0x5cb4f805
09:35:44 INFO - Found by: call frame info
09:35:44 INFO - 3 libxul.so!nsWindow::LayerViewSupport::OnNativeCall<mozilla::jni::detail::ProxyNativeCall<nsWindow::LayerViewSupport, mozilla::java::LayerView::Compositor, false, false> > [nsWindow.cpp:cfc312760e8c : 958 + 0x5]
09:35:44 INFO - r4 = 0x4c7a3f78 r5 = 0x62bff490 r6 = 0x00000000 r7 = 0x5347cee4
09:35:44 INFO - r8 = 0x62bff4a8 r9 = 0x5347cedc r10 = 0x2a295de0 fp = 0x62bff4bc
09:35:44 INFO - sp = 0x62bff478 pc = 0x5cb4f88f
09:35:44 INFO - Found by: call frame info
09:35:44 INFO - 4 libxul.so!mozilla::jni::detail::NativeStubImpl<mozilla::java::LayerView::Compositor::SyncInvalidateAndScheduleComposite\_t, nsWindow::LayerViewSupport, mozilla::jni::Args<>, false, true>::Wrap<&nsWindow::LayerViewSupport::SyncInvalidateAndScheduleComposite> [Natives.h:cfc312760e8c : 412 + 0x5]
09:35:44 INFO - r4 = 0x4c7a3f78 r5 = 0x2a295dd0 r6 = 0x00000000 r7 = 0x5347cee4
09:35:44 INFO - r8 = 0x62bff4a8 r9 = 0x5347cedc r10 = 0x2a295de0 fp = 0x62bff4bc
09:35:44 INFO - sp = 0x62bff490 pc = 0x5cb4f979
09:35:44 INFO - Found by: call frame info
stack not copied completely, see the log.

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1293709#a83_269762)• 8 years ago |

Summary: nsWindow::LayerViewSupport's weak reference used on multiple threads → nsWindow::GeckoViewSupport's weak reference used on multiple threads

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1293709#a232_269762)• 8 years ago |

Blocks: [956338](/show_bug.cgi?id=956338 "RESOLVED FIXED - Add checks to WeakPtr and related classes to assert single-thread usage")

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1293709#c1)• 8 years ago |
|  | |

Jim, you originally wrote this class ([bug 1197957](/show_bug.cgi?id=1197957 "RESOLVED FIXED - Let GeckoView control nsWindow creation") and [bug 1227706](/show_bug.cgi?id=1227706 "RESOLVED FIXED - Make each nsWindow/GeckoView manage their own compositor/GLController")).
The checks introduced in [bug 956338](/show_bug.cgi?id=956338 "RESOLVED FIXED - Add checks to WeakPtr and related classes to assert single-thread usage") makes sure that the weak proxy object is always used only on a single thread. It means, (1) taking weak references + (2) dereference of them + (3) destruction of the referee are all made on the same thread.
The crash shows that the weak reference is dereferenced on a different thread than it has been created on. It shows potentially (likely) wrong usage of weak referencing.
The questions are:
- are we dereferencing the weak ref only on a single thread where also the referee can be destroyed?
- can all the (1+2+3) operations mentioned above be protected by some single umbrella mutex?
- can we migrate away from using weak reference here and use a strong ref and some 'release the ref' notification on referrers?
- some other solution?
It's likely this is a highly critical bug.Flags: needinfo?(nchen)Flags: needinfo?(mark.finkle)

|  | [Mark Finkle (:mfinkle) (use needinfo?)](/user_profile?user_id=252194) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1293709#c2)• 8 years ago |
|  | |

Passing to Sebastian. I am no longer working on Firefox.Flags: needinfo?(mark.finkle) → needinfo?(s.kaspari)

|  | [Sebastian Kaspari (:sebastian; :pocmo)](/user_profile?user_id=472516) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1293709#a72701_472516)• 8 years ago |

tracking-fennec: --- → ?OS: Unspecified → AndroidPriority: -- → P1Hardware: Unspecified → All

|  | [(inactive) Jim Chen [:jchen] [:darchons]](/user_profile?user_id=281508)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1293709#c3)• 8 years ago |
|  | |

Everything in GeckoViewSupport happens on the Gecko thread, so it's most likely nsWindow::LayerViewSupport's WeakPtr.
(In reply to Honza Bambas (:mayhemer) from [comment #1](/show_bug.cgi?id=1293709#c1 "RESOLVED FIXED - nsWindow::LayerViewSupport's weak reference used on multiple threads"))
>
> The questions are:
> - are we dereferencing the weak ref only on a single thread where also the
> referee can be destroyed?
Unfortunately no, we have two threads involved here.
> - can all the (1+2+3) operations mentioned above be protected by some single
> umbrella mutex?
Possibly, but seems like that would still violate [bug 956338](/show_bug.cgi?id=956338 "RESOLVED FIXED - Add checks to WeakPtr and related classes to assert single-thread usage") right?
> - can we migrate away from using weak reference here and use a strong ref
> and some 'release the ref' notification on referrers?
I think so. This is probably the better approach.
> - some other solution?
>
> It's likely this is a highly critical bug.
These are long-lived objects (typically close to application lifetime), so I don't think it's quite expoitable, beyond possible startup/shutdown crashes. I do agree we should fix it though.Flags: needinfo?(nchen)Summary: nsWindow::GeckoViewSupport's weak reference used on multiple threads → nsWindow::LayerViewSupport's weak reference used on multiple threads

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1293709#c4)• 8 years ago |
|  | |

(In reply to Jim Chen [:jchen] [:darchons] from [comment #3](/show_bug.cgi?id=1293709#c3 "RESOLVED FIXED - nsWindow::LayerViewSupport's weak reference used on multiple threads"))
> Everything in GeckoViewSupport happens on the Gecko thread, so it's most
> likely nsWindow::LayerViewSupport's WeakPtr.
>
> (In reply to Honza Bambas (:mayhemer) from [comment #1](/show_bug.cgi?id=1293709#c1 "RESOLVED FIXED - nsWindow::LayerViewSupport's weak reference used on multiple threads"))
> >
> > The questions are:
> > - are we dereferencing the weak ref only on a single thread where also the
> > referee can be destroyed?
>
> Unfortunately no, we have two threads involved here.
>
> > - can all the (1+2+3) operations mentioned above be protected by some single
> > umbrella mutex?
>
> Possibly, but seems like that would still violate [bug 956338](/show_bug.cgi?id=956338 "RESOLVED FIXED - Add checks to WeakPtr and related classes to assert single-thread usage") right?
We can try to implement something like ProtectedWeakReference that will keep reference to the mutex and assert it's held during all the operations, if the mutex can live longer than the weakref proxy. Or we can just have an implementation that won't do the checks and just assume the correct usage.
>
> > - can we migrate away from using weak reference here and use a strong ref
> > and some 'release the ref' notification on referrers?
>
> I think so. This is probably the better approach.
Cool, who is going to implement that? I have no idea at all how this works, so I'm just a last resort candidate.
>
> > - some other solution?
> >
> > It's likely this is a highly critical bug.
>
> These are long-lived objects (typically close to application lifetime), so I
> don't think it's quite expoitable, beyond possible startup/shutdown crashes.
> I do agree we should fix it though.
Good to here.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1293709#a173099_406194)• 8 years ago |

Keywords: [csectype-race](/buglist.cgi?keywords=csectype-race&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1293709#a177130_1689)• 8 years ago |

Group: core-security → layout-core-security

|  | [(inactive) Jim Chen [:jchen] [:darchons]](/user_profile?user_id=281508)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1293709#c5)• 8 years ago |
|  | |

I'll work on it.Assignee: nobody → nchenStatus: NEW → ASSIGNED

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1293709#c6)• 8 years ago |
|  | |

(In reply to Jim Chen [:jchen] [:darchons] from [comment #5](/show_bug.cgi?id=1293709#c5 "RESOLVED FIXED - nsWindow::LayerViewSupport's weak reference used on multiple threads"))
> I'll work on it.
Thanks!

|  | [(inactive) Jim Chen [:jchen] [:darchons]](/user_profile?user_id=281508)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1293709#c7)• 8 years ago |
|  | |

Attached patch

[Add NativePtr and WindowPtr smart pointers (v1)](attachment.cgi?id=8780665&action=diff) (obsolete)
— [Details](attachment.cgi?id=8780665&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1293709&attachment=8780665)

Add the NativePtr class for referencing a native object, and the
WindowPtr class for referencing back to the nsWindow inside a native
object class. NativePtr automatically clears its reference when the
native object is destroyed. WindowPtr automatically clears its
reference when its nsWindow is detached from the native object.
[Attachment #8780665](/attachment.cgi?id=8780665&action=edit "Add NativePtr and WindowPtr smart pointers (v1)") -
Flags: review?(snorp)

|  | [(inactive) Jim Chen [:jchen] [:darchons]](/user_profile?user_id=281508)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1293709#c8)• 8 years ago |
|  | |

Attached patch

[Use NativePtr and WindowPtr for NPZCSupport (v1)](attachment.cgi?id=8780666&action=diff) (obsolete)
— [Details](attachment.cgi?id=8780666&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1293709&attachment=8780666)

Use the new NativePtr and WindowPtr classes for NPZCSupport to replace
similar functionality in the exiting class.
[Attachment #8780666](/attachment.cgi?id=8780666&action=edit "Use NativePtr and WindowPtr for NPZCSupport (v1)") -
Flags: review?(snorp)

|  | [(inactive) Jim Chen [:jchen] [:darchons]](/user_profile?user_id=281508)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1293709#c9)• 8 years ago |
|  | |

Attached patch

[Use NativePtr and WindowPtr for LayerViewSupport (v1)](attachment.cgi?id=8780667&action=diff) (obsolete)
— [Details](attachment.cgi?id=8780667&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1293709&attachment=8780667)

Switch LayerViewSupport from using WeakPtr to using NativePtr/WindowPtr
in order to provide better thread safety. Also make some minor
improvements to code in LayerViewSupport.
[Attachment #8780667](/attachment.cgi?id=8780667&action=edit "Use NativePtr and WindowPtr for LayerViewSupport (v1)") -
Flags: review?(snorp)

|  | [Sebastian Kaspari (:sebastian; :pocmo)](/user_profile?user_id=472516) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1293709#a506870_472516)• 8 years ago |

Flags: needinfo?(s.kaspari)

|  | [James Willcox (:snorp) (jwillcox@mozilla.com) (he/him)](/user_profile?user_id=227322) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1293709#a531143_227322)• 8 years ago |

[Attachment #8780665](/attachment.cgi?id=8780665&action=edit "Add NativePtr and WindowPtr smart pointers (v1)") -
Flags: review?(snorp) → review+

|  | [James Willcox (:snorp) (jwillcox@mozilla.com) (he/him)](/user_profile?user_id=227322) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1293709#a531182_227322)• 8 years ago |

[Attachment #8780666](/attachment.cgi?id=8780666&action=edit "Use NativePtr and WindowPtr for NPZCSupport (v1)") -
Flags: review?(snorp) → review+

|  | [James Willcox (:snorp) (jwillcox@mozilla.com) (he/him)](/user_profile?user_id=227322) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1293709#c10)• 8 years ago |
|  | |

Comment on [attachment 8780667](/attachment.cgi?id=8780667 "Use NativePtr and WindowPtr for LayerViewSupport (v1)") [[details]](/attachment.cgi?id=8780667&action=edit "Use NativePtr and WindowPtr for LayerViewSupport (v1)") [[diff]](/attachment.cgi?id=8780667&action=diff "Use NativePtr and WindowPtr for LayerViewSupport (v1)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1293709&attachment=8780667)
Use NativePtr and WindowPtr for LayerViewSupport (v1)
Review of [attachment 8780667](/attachment.cgi?id=8780667 "Use NativePtr and WindowPtr for LayerViewSupport (v1)") [[details]](/attachment.cgi?id=8780667&action=edit "Use NativePtr and WindowPtr for LayerViewSupport (v1)") [[diff]](/attachment.cgi?id=8780667&action=diff "Use NativePtr and WindowPtr for LayerViewSupport (v1)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1293709&attachment=8780667):
-----------------------------------------------------------------
::: widget/android/nsWindow.cpp
@@ +1147,5 @@
> + MOZ\_ASSERT(AndroidBridge::IsJavaUiThread());
> +
> + RefPtr<CompositorBridgeParent> bridge;
> +
> + if (LockedWindowPtr window{mWindow}) {
This syntax is nice but looks so weird.
[Attachment #8780667](/attachment.cgi?id=8780667&action=edit "Use NativePtr and WindowPtr for LayerViewSupport (v1)") -
Flags: review?(snorp) → review+

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1293709#c11)• 8 years ago |
|  | |

(the patches don't apply to today's m-c)

|  | [(inactive) Jim Chen [:jchen] [:darchons]](/user_profile?user_id=281508)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1293709#c12)• 8 years ago |
|  | |

Attached patch

[Add NativePtr and WindowPtr smart pointers (v1.1)](attachment.cgi?id=8781651&action=diff) (obsolete)
— [Details](attachment.cgi?id=8781651&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1293709&attachment=8781651)

Rebased patches.
[Attachment #8781651](/attachment.cgi?id=8781651&action=edit "Add NativePtr and WindowPtr smart pointers (v1.1)") -
Flags: review+

|  | [(inactive) Jim Chen [:jchen] [:darchons]](/user_profile?user_id=281508)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1293709#a608939_281508)• 8 years ago |

[Attachment #8780665](/attachment.cgi?id=8780665&action=edit "Add NativePtr and WindowPtr smart pointers (v1)") -
Attachment is obsolete: true

|  | [(inactive) Jim Chen [:jchen] [:darchons]](/user_profile?user_id=281508)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1293709#c13)• 8 years ago |
|  | |

Attached patch

[Use NativePtr and WindowPtr for NPZCSupport (v1.1)](attachment.cgi?id=8781652&action=diff) (obsolete)
— [Details](attachment.cgi?id=8781652&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1293709&attachment=8781652)

[Attachment #8781652](/attachment.cgi?id=8781652&action=edit "Use NativePtr and WindowPtr for NPZCSupport (v1.1)") -
Flags: review+

|  | [(inactive) Jim Chen [:jchen] [:darchons]](/user_profile?user_id=281508)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1293709#a608953_281508)• 8 years ago |

[Attachment #8780666](/attachment.cgi?id=8780666&action=edit "Use NativePtr and WindowPtr for NPZCSupport (v1)") -
Attachment is obsolete: true

|  | [(inactive) Jim Chen [:jchen] [:darchons]](/user_profile?user_id=281508)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1293709#c14)• 8 years ago |
|  | |

Attached patch

[Use NativePtr and WindowPtr for LayerViewSupport (v1.1)](attachment.cgi?id=8781653&action=diff) (obsolete)
— [Details](attachment.cgi?id=8781653&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1293709&attachment=8781653)

[Attachment #8781653](/attachment.cgi?id=8781653&action=edit "Use NativePtr and WindowPtr for LayerViewSupport (v1.1)") -
Flags: review+

|  | [(inactive) Jim Chen [:jchen] [:darchons]](/user_profile?user_id=281508)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1293709#a608967_281508)• 8 years ago |

[Attachment #8780667](/attachment.cgi?id=8780667&action=edit "Use NativePtr and WindowPtr for LayerViewSupport (v1)") -
Attachment is obsolete: true

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Reporter |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1293709#c15)• 8 years ago |
|  | |

Interestingly, the problem disappeared with some recent changes: <https://treeherder.mozilla.org/#/jobs?repo=try&revision=fc9b997ac90bf87a80c80c9d8290ffb40d718894> (having my weka assertion patch + all other fixes except this bug's patch)
Patches in this big are still worth landing anyway. Thanks for such a quick reaction!

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Reporter |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1293709#c16)• 8 years ago |
|  | |

(In reply to Honza Bambas (:mayhemer) from [comment #15](/show_bug.cgi?id=1293709#c15 "RESOLVED FIXED - nsWindow::LayerViewSupport's weak reference used on multiple threads"))
> Interestingly, the problem disappeared with some recent changes:
> <https://treeherder.mozilla.org/#/>
> jobs?repo=try&revision=fc9b997ac90bf87a80c80c9d8290ffb40d718894 (having my
> weka assertion patch + all other fixes except this bug's patch)
>
> Patches in this big are still worth landing anyway. Thanks for such a quick
> reaction!
Just for curiosity, I rather repushed to try with a slight loose in #ifdefs of the thread checking code (no !MOZ\_PROFILING)
<https://treeherder.mozilla.org/#/jobs?repo=try&revision=11c3b4364874>

|  | [James Willcox (:snorp) (jwillcox@mozilla.com) (he/him)](/user_profile?user_id=227322) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1293709#a765999_227322)• 8 years ago |

tracking-fennec: ? → 51+

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Reporter |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1293709#c17)• 8 years ago |
|  | |

(In reply to Honza Bambas (:mayhemer) from [comment #16](/show_bug.cgi?id=1293709#c16 "RESOLVED FIXED - nsWindow::LayerViewSupport's weak reference used on multiple threads"))
> <https://treeherder.mozilla.org/#/jobs?repo=try&revision=11c3b4364874>
OK, problem detected. Why does the Android 4.3 API15+ opt tests declare MOZ\_PROFILING?

|  | [(inactive) Jim Chen [:jchen] [:darchons]](/user_profile?user_id=281508)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1293709#c18)• 8 years ago |
|  | |

(In reply to Honza Bambas (:mayhemer) from [comment #17](/show_bug.cgi?id=1293709#c17 "RESOLVED FIXED - nsWindow::LayerViewSupport's weak reference used on multiple threads"))
> (In reply to Honza Bambas (:mayhemer) from [comment #16](/show_bug.cgi?id=1293709#c16 "RESOLVED FIXED - nsWindow::LayerViewSupport's weak reference used on multiple threads"))
> > <https://treeherder.mozilla.org/#/jobs?repo=try&revision=11c3b4364874>
>
> OK, problem detected. Why does the Android 4.3 API15+ opt tests declare
> MOZ\_PROFILING?
We enable it in Nightly builds to not strip away debug info, so that profiler unwinding works.

|  | [(inactive) Jim Chen [:jchen] [:darchons]](/user_profile?user_id=281508)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1293709#c19)• 8 years ago |
|  | |

Attached patch

[Add NativePtr and WindowPtr smart pointers (v1.2)](attachment.cgi?id=8782528&action=diff)
— [Details](attachment.cgi?id=8782528&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1293709&attachment=8782528)

Updated patch that adds locking on the nsWindow side.
[Attachment #8782528](/attachment.cgi?id=8782528&action=edit "Add NativePtr and WindowPtr smart pointers (v1.2)") -
Flags: review+

|  | [(inactive) Jim Chen [:jchen] [:darchons]](/user_profile?user_id=281508)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1293709#a775171_281508)• 8 years ago |

[Attachment #8781651](/attachment.cgi?id=8781651&action=edit "Add NativePtr and WindowPtr smart pointers (v1.1)") -
Attachment is obsolete: true

|  | [(inactive) Jim Chen [:jchen] [:darchons]](/user_profile?user_id=281508)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1293709#c20)• 8 years ago |
|  | |

Attached patch

[Use NativePtr and WindowPtr for NPZCSupport (v1.2)](attachment.cgi?id=8782529&action=diff)
— [Details](attachment.cgi?id=8782529&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1293709&attachment=8782529)

Updated patch that fixes a possible crash when reattaching GeckoView.
[Attachment #8782529](/attachment.cgi?id=8782529&action=edit "Use NativePtr and WindowPtr for NPZCSupport (v1.2)") -
Flags: review+

|  | [(inactive) Jim Chen [:jchen] [:darchons]](/user_profile?user_id=281508)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1293709#a775279_281508)• 8 years ago |

[Attachment #8781652](/attachment.cgi?id=8781652&action=edit "Use NativePtr and WindowPtr for NPZCSupport (v1.1)") -
Attachment is obsolete: true

|  | [(inactive) Jim Chen [:jchen] [:darchons]](/user_profile?user_id=281508)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1293709#c21)• 8 years ago |
|  | |

Attached patch

[Use NativePtr and WindowPtr for LayerViewSupport (v1.2)](attachment.cgi?id=8782530&action=diff)
— [Details](attachment.cgi?id=8782530&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1293709&attachment=8782530)

Updated patch that adds more locking when getting a surface or when drawing.
[Attachment #8782530](/attachment.cgi?id=8782530&action=edit "Use NativePtr and WindowPtr for LayerViewSupport (v1.2)") -
Flags: review+

|  | [(inactive) Jim Chen [:jchen] [:darchons]](/user_profile?user_id=281508)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1293709#a775318_281508)• 8 years ago |

[Attachment #8781653](/attachment.cgi?id=8781653&action=edit "Use NativePtr and WindowPtr for LayerViewSupport (v1.1)") -
Attachment is obsolete: true

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Reporter |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1293709#c22)• 8 years ago |
|  | |

(In reply to Jim Chen [:jchen] [:darchons] from [comment #18](/show_bug.cgi?id=1293709#c18 "RESOLVED FIXED - nsWindow::LayerViewSupport's weak reference used on multiple threads"))
> (In reply to Honza Bambas (:mayhemer) from [comment #17](/show_bug.cgi?id=1293709#c17 "RESOLVED FIXED - nsWindow::LayerViewSupport's weak reference used on multiple threads"))
> > (In reply to Honza Bambas (:mayhemer) from [comment #16](/show_bug.cgi?id=1293709#c16 "RESOLVED FIXED - nsWindow::LayerViewSupport's weak reference used on multiple threads"))
> > > <https://treeherder.mozilla.org/#/jobs?repo=try&revision=11c3b4364874>
> >
> > OK, problem detected. Why does the Android 4.3 API15+ opt tests declare
> > MOZ\_PROFILING?
>
> We enable it in Nightly builds to not strip away debug info, so that
> profiler unwinding works.
OK, I can see that "Android 4.3 API15+ debug" suite + all tests is run on inbound, just not on "try -a". That should be sufficient to give the coverage.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1293709#c23)• 8 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/54069ada44c7>Status: ASSIGNED → RESOLVEDClosed: 8 years ago
[status-firefox51](/buglist.cgi?f1=cf_status_firefox51&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla51

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1293709#a1985084_1689)• 8 years ago |

Group: layout-core-security → core-security-release

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1293709#a13211987_452604)• 8 years ago |

Flags: qe-verify-Whiteboard: [post-critsmash-triage]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1293709#a13932820_280903)• 8 years ago |

Whiteboard: [post-critsmash-triage] → [post-critsmash-triage][adv-main51+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1293709#a13939122_280903)• 8 years ago |

Alias: CVE-2017-5392

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1293709#a33188707_1689)• 7 years ago |

Group: core-security-release

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1293709#a165289246_546015)• 3 years ago |

Product: Core → Core Graveyard
You need to [log in](/show_bug.cgi?id=1293709&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [(inactive) Jim Chen [:jchen] [:darchons]](/user_profile?user_id=281508)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


