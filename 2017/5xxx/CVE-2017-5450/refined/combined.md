=== Content from bugzilla.mozilla.org_313434ee_20250126_034646.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1340127)
* [XML](/show_bug.cgi?ctype=xml&id=1340127)

Closed
[Bug 1340127](/show_bug.cgi?id=1340127)
(CVE-2017-5449)

Opened 8 years ago
Closed 8 years ago

# SEGV in ClearBidiControls

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

SEGV in ClearBidiControls

## Categories

### (Core :: Layout: Text and Fonts, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Layout%3A%20Text%20and%20Fonts#Layout%3A%20Text%20and%20Fonts)

Layout: Text and Fonts
▾

Core :: Layout: Text and Fonts

Issues with CSS font selection, font loading, text shaping and glyph selection, breaking, text decorations, bidirectional text processing, and white space processing. For issues with glyph rendering and font format support, see the Graphics: Text component.

Example bugs:

* line-breaking code does not handle supplementary-plane characters properly
* double or wavy decoration lines are not repainted correctly if specified on floating first letter

Specifications covered:

* CSS Fonts
* CSS Size Adjustment
* CSS Text
* CSS Text Decoration

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Layout%3A%20Text%20and%20Fonts&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Layout%3A%20Text%20and%20Fonts&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Layout%3A%20Text%20and%20Fonts)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla54

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr45 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=wontfix) |
| firefox51 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=wontfix) |
| firefox52 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=wontfix) |
| firefox-esr52 | [53+](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=53%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=fixed) |
| firefox53 | [+](/buglist.cgi?f1=cf_tracking_firefox53&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox53&o1=equals&v1=fixed) |
| firefox54 | [+](/buglist.cgi?f1=cf_tracking_firefox54&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox54&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr45 |  | wontfix |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox51 |  | wontfix |
| firefox52 |  | wontfix |
| firefox-esr52 | 53+ | fixed |
| firefox53 | + | fixed |
| firefox-esr115 | --- | --- |
| firefox54 | + | fixed |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: nils, Assigned: dbaron)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/0a32391d55cfa63276f87eb9819dfbd0?d=mm&size=40)  [dbaron](/user_profile?user_id=3881)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/1ac8e01cc88bca015e51fbd49a0b2df5?d=mm&size=40)  [nils](/user_profile?user_id=344130)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/e0f9759e1d7514ae4adfd806869e3c5d?d=mm&size=40)  [jfkthame](/user_profile?user_id=329583)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

18 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [adv-main53+][adv-esr52.1+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2017-5449

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main53+][adv-esr52.1+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a1574240_1689 "8 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [dbaron](/user_profile?user_id=3881) | [in-testsuite](#a1141653_3881 "8 years ago") | ? |
| --- | --- | --- |
| [dbaron](/user_profile?user_id=3881) | in-testsuite | ? |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files)

| [Slightly simplified testcase (CRASH ON LOAD)](/attachment.cgi?id=8839037)  [8 years ago](#c4)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   635 bytes, text/html |  | [Details](/attachment.cgi?id=8839037&action=edit) |
| --- | --- | --- |
| [debug session for the slightly simplified testcase above](/attachment.cgi?id=8839040)  [8 years ago](#c5)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   25.27 KB, text/html |  | [Details](/attachment.cgi?id=8839040&action=edit) |
| [Slightly simplified testcase with no script (CRASH ON LOAD)](/attachment.cgi?id=8841870)  [8 years ago](#c8)  [Xidorn Quan [:xidorn] UTC+10](/user_profile?user_id=373403)   594 bytes, text/html |  | [Details](/attachment.cgi?id=8841870&action=edit) |
| [Consider different bidi control/override values when deciding whether to consider a frame first or last](/attachment.cgi?id=8842268)  [8 years ago](#c11)  [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)   2.85 KB, patch | jfkthame : [review+](#c12 "8 years ago")  gchang : [approval-mozilla-aurora+](#c18 "8 years ago")  jcristau : [approval-mozilla-esr52+](#c22 "8 years ago") | [Details](/attachment.cgi?id=8842268&action=edit) | [Diff](/attachment.cgi?id=8842268&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1340127&attachment=8842268) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Nils](/user_profile?user_id=344130)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1340127#c0)• 8 years ago |
|  | |

The following testcase crashes the latest ASAN build of Firefox. The testcase seems to depend on the browser window size. Try resizing the window if it does not crash on the first attempt.
<script>
function start() {
o22=document.createElement('frame');
o38=document.createElement('frame');
o47=document.createElement('frame');
o65=document.createElement('style');
o22.style.writingMode='sideways-lr';
o74=document.createTextNode('{}:first-line{');
o65.appendChild(o74);
o83=document.createElement('frame');
o47.animate([{unicodeBidi: 'embed',}],100);
o100=document.documentElement;
document.documentElement.prepend(unescape('%u0627'),undefined);
o83.prepend("undefined","undefined",unescape("undefined%u8A08%u7B97%u3057%u30E5%u30FC%u30BF%u30FC%u8A08%u7B97%u3057%u30E5%u30FC%u30BF%u30FC%u8A08%u7B97%u3057%u30E5%u30FC%u30BF%u30FC"));
document.write('<html><body></body></html>');
document.documentElement.appendChild(o22);
o22.appendChild(o38);
o38.appendChild(o47);
document.documentElement.appendChild(o65);
o47.appendChild(o83);
o22.appendChild(o100);
}
</script>
<body onload="start()"></body>
ASAN:DEADLYSIGNAL
=================================================================
==7498==ERROR: AddressSanitizer: SEGV on unknown address 0x7ffe2c663d6c (pc 0x7faa7b918d7a bp 0x7ffc2c663c90 sp 0x7ffc2c6638e0 T0)
#0 0x7faa7b918d79 in ClearBidiControls /home/worker/workspace/build/src/layout/base/nsBidiPresUtils.cpp:313:21
#1 0x7faa7b918d79 in ResolveParagraphWithinBlock /home/worker/workspace/build/src/layout/base/nsBidiPresUtils.cpp:1226
#2 0x7faa7b918d79 in nsBidiPresUtils::TraverseFrames(nsBlockFrame\*, nsBlockInFlowLineIterator\*, nsIFrame\*, BidiParagraphData\*) /home/worker/workspace/build/src/layout/base/nsBidiPresUtils.cpp:1192
#3 0x7faa7b917566 in nsBidiPresUtils::Resolve(nsBlockFrame\*) /home/worker/workspace/build/src/layout/base/nsBidiPresUtils.cpp:697:5
#4 0x7faa7bac2e0b in ResolveBidi /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:7452:10
#5 0x7faa7bac2e0b in nsBlockFrame::GetMinISize(nsRenderingContext\*) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:736
#6 0x7faa7bb3cbd0 in ShrinkWidthToFit /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:5529:22
#7 0x7faa7bb3cbd0 in nsContainerFrame::ComputeAutoSize(nsRenderingContext\*, mozilla::WritingMode, mozilla::LogicalSize const&, int, mozilla::LogicalSize const&, mozilla::LogicalSize const&, mozilla::LogicalSize const&, nsIFrame::ComputeSizeFlags) /home/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:942
#8 0x7faa7bb4408e in nsFrame::ComputeSize(nsRenderingContext\*, mozilla::WritingMode, mozilla::LogicalSize const&, int, mozilla::LogicalSize const&, mozilla::LogicalSize const&, mozilla::LogicalSize const&, nsIFrame::ComputeSizeFlags) /home/worker/workspace/build/src/layout/generic/nsFrame.cpp:4785:24
#9 0x7faa7ba8456e in mozilla::ReflowInput::InitConstraints(nsPresContext\*, mozilla::LogicalSize const&, nsMargin const\*, nsMargin const\*, nsIAtom\*) /home/worker/workspace/build/src/layout/generic/ReflowInput.cpp:2451:9
#10 0x7faa7ba7af04 in mozilla::ReflowInput::Init(nsPresContext\*, mozilla::LogicalSize const\*, nsMargin const\*, nsMargin const\*) /home/worker/workspace/build/src/layout/generic/ReflowInput.cpp:399:3
#11 0x7faa7ba43759 in emplace<nsPresContext \*&, const mozilla::ReflowInput &, nsIFrame \*&, mozilla::LogicalSize &> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/Maybe.h:461:29
#12 0x7faa7ba43759 in nsLineLayout::ReflowFrame(nsIFrame\*, unsigned int&, mozilla::ReflowOutput\*, bool&) /home/worker/workspace/build/src/layout/generic/nsLineLayout.cpp:879
#13 0x7faa7baee855 in nsBlockFrame::ReflowInlineFrame(mozilla::BlockReflowInput&, nsLineLayout&, nsLineList\_iterator, nsIFrame\*, LineReflowStatus\*) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:4151:3
#14 0x7faa7baed528 in nsBlockFrame::DoReflowInlineFrames(mozilla::BlockReflowInput&, nsLineLayout&, nsLineList\_iterator, nsFlowAreaRect&, int&, nsFloatManager::SavedState\*, bool\*, LineReflowStatus\*, bool) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:3952:5
#15 0x7faa7bae3e4c in nsBlockFrame::ReflowInlineFrames(mozilla::BlockReflowInput&, nsLineList\_iterator, bool\*) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:3826:9
#16 0x7faa7bad3223 in ReflowLine /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:2832:5
#17 0x7faa7bad3223 in nsBlockFrame::ReflowDirtyLines(mozilla::BlockReflowInput&) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:2368
#18 0x7faa7bac98e2 in nsBlockFrame::Reflow(nsPresContext\*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, unsigned int&) /home/worker/workspace/build/src/layout/generic/nsBlockFrame.cpp:1237:3
#19 0x7faa7bb2ccc0 in nsContainerFrame::ReflowChild(nsIFrame\*, nsPresContext\*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, mozilla::WritingMode const&, mozilla::LogicalPoint const&, nsSize const&, unsigned int, unsigned int&, nsOverflowContinuationTracker\*) /home/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:1028:3
#20 0x7faa7bb2b6a2 in nsCanvasFrame::Reflow(nsPresContext\*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, unsigned int&) /home/worker/workspace/build/src/layout/generic/nsCanvasFrame.cpp:711:5
#21 0x7faa7bb2ccc0 in nsContainerFrame::ReflowChild(nsIFrame\*, nsPresContext\*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, mozilla::WritingMode const&, mozilla::LogicalPoint const&, nsSize const&, unsigned int, unsigned int&, nsOverflowContinuationTracker\*) /home/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:1028:3
#22 0x7faa7bbd02ea in nsHTMLScrollFrame::ReflowScrolledFrame(mozilla::ScrollReflowInput\*, bool, bool, mozilla::ReflowOutput\*, bool) /home/worker/workspace/build/src/layout/generic/nsGfxScrollFrame.cpp:552:3
#23 0x7faa7bbd1760 in nsHTMLScrollFrame::ReflowContents(mozilla::ScrollReflowInput\*, mozilla::ReflowOutput const&) /home/worker/workspace/build/src/layout/generic/nsGfxScrollFrame.cpp:664:3
#24 0x7faa7bbd4f8b in nsHTMLScrollFrame::Reflow(nsPresContext\*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, unsigned int&) /home/worker/workspace/build/src/layout/generic/nsGfxScrollFrame.cpp:1039:3
#25 0x7faa7bb3d3e2 in nsContainerFrame::ReflowChild(nsIFrame\*, nsPresContext\*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, int, int, unsigned int, unsigned int&, nsOverflowContinuationTracker\*) /home/worker/workspace/build/src/layout/generic/nsContainerFrame.cpp:1072:3
#26 0x7faa7baaf3a9 in mozilla::ViewportFrame::Reflow(nsPresContext\*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, unsigned int&) /home/worker/workspace/build/src/layout/generic/ViewportFrame.cpp:326:7
#27 0x7faa7b8b0c3c in mozilla::PresShell::DoReflow(nsIFrame\*, bool) /home/worker/workspace/build/src/layout/base/PresShell.cpp:9258:3
#28 0x7faa7b8c45c4 in mozilla::PresShell::ProcessReflowCommands(bool) /home/worker/workspace/build/src/layout/base/PresShell.cpp:9431:24
#29 0x7faa7b8c3464 in mozilla::PresShell::FlushPendingNotifications(mozilla::ChangesToFlush) /home/worker/workspace/build/src/layout/base/PresShell.cpp:4233:11
#30 0x7faa7b835144 in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1915:9
#31 0x7faa7b843495 in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:305:7
#32 0x7faa7b843164 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:327:5
#33 0x7faa7b8457d3 in RunRefreshDrivers /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:722:5
#34 0x7faa7b8457d3 in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::TickRefreshDriver(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:631
#35 0x7faa7b8451b4 in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::NotifyVsync(mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:544:9
#36 0x7faa7c0bac14 in mozilla::layout::VsyncChild::RecvNotify(mozilla::TimeStamp const&) /home/worker/workspace/build/src/layout/ipc/VsyncChild.cpp:64:5
#37 0x7faa761e1718 in mozilla::layout::PVsyncChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PVsyncChild.cpp:160:20
#38 0x7faa75e6cba3 in mozilla::ipc::PBackgroundChild::OnMessageReceived(IPC::Message const&) /home/worker/workspace/build/src/obj-firefox/ipc/ipdl/PBackgroundChild.cpp:1425:16
#39 0x7faa75db3bc0 in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1795:14
#40 0x7faa75db00fc in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1730:17
#41 0x7faa75db2734 in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1603:5
#42 0x7faa75db2d7e in mozilla::ipc::MessageChannel::MessageTask::Run() /home/worker/workspace/build/src/ipc/glue/MessageChannel.cpp:1636:5
#43 0x7faa74fa9f59 in nsThread::ProcessNextEvent(bool, bool\*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1264:7
#44 0x7faa74fa6850 in NS\_ProcessNextEvent(nsIThread\*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:389:10
#45 0x7faa75dbbac4 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate\*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:124:5
#46 0x7faa75d2cc38 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message\_loop.cc:238:3
#47 0x7faa75d2cc38 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message\_loop.cc:231
#48 0x7faa75d2cc38 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message\_loop.cc:211
#49 0x7faa7b1644ff in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3
#50 0x7faa7e96a997 in XRE\_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:852:12
#51 0x7faa75d2cc38 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message\_loop.cc:238:3
#52 0x7faa75d2cc38 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message\_loop.cc:231
#53 0x7faa75d2cc38 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message\_loop.cc:211
#54 0x7faa7e96a47c in XRE\_InitChildProcess(int, char\*\*, XREChildData const\*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:684:7
#55 0x4e00c6 in content\_process\_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:19
#56 0x4e00c6 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:284
#57 0x7faa9034c82f in \_\_libc\_start\_main /build/glibc-t3gR2i/glibc-2.23/csu/../csu/libc-start.c:291
#58 0x41c2e8 in \_start (/home/nils/fuzzer3/firefox/firefox+0x41c2e8)
AddressSanitizer can not provide additional info.
SUMMARY: AddressSanitizer: SEGV /home/worker/workspace/build/src/layout/base/nsBidiPresUtils.cpp:313:21 in ClearBidiControls
==7498==ABORTING

|  | [Tyson Smith [:tsmith] (PTO)](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1340127#c1)• 8 years ago |
|  | |

Is a dup of [bug 1337504](/show_bug.cgi?id=1337504 "RESOLVED FIXED - SEGV in ClearBidiControls")?Group: core-security → layout-core-securityFlags: needinfo?(mats)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1340127#c2)• 8 years ago |
|  | |

No, this has a different root cause, although it eventually crashes due to
a call to PopBidiControl with nothing on the mEmbeddingStack, which executes:
mEmbeddingStack.TruncateLength(mEmbeddingStack.Length() - 1)Severity: normal → criticalFlags: needinfo?(mats)Keywords: [crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)OS: Unspecified → AllHardware: Unspecified → All

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1340127#a313969_5168)• 8 years ago |

Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1340127#c3)• 8 years ago |
|  | |

For clarity: the testcase in this bug crashes also with my patches that fix [bug 1337504](/show_bug.cgi?id=1337504 "RESOLVED FIXED - SEGV in ClearBidiControls").

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1340127#c4)• 8 years ago |
|  | |

Attached file
[Slightly simplified testcase (CRASH ON LOAD)](attachment.cgi?id=8839037)
— [Details](attachment.cgi?id=8839037&action=edit)

<style>
#o22:first-line{}
</style>
<body>
<span id="o22" style="writing-mode:sideways-lr">
<span id="o38">
<span id="o47">
xxxxxxxxxx xxxxxxxxxx xxxxxxxxxx xxxxxxxxxx xxxxxxxxxx xxxxxxxxxx xxxxxxxxxx
xxxxxxxxxx xxxxxxxxxx xxxxxxxxxx xxxxxxxxxx xxxxxxxxxx xxxxxxxxxx xxxxxxxxxx
xxxxxxxxxx xxxxxxxxxx xxxxxxxxxx xxxxxxxxxx xxxxxxxxxx xxxxxxxxxx xxxxxxxxxx
xxxxxxxxxx xxxxxxxxxx xxxxxxxxxx xxxxxxxxxx xxxxxxxxxx xxxxxxxxxx xxxxxxxxxx
</span>
</span>
</span>
<script>
document.getElementById("o38").prepend(unescape('%u0627'),undefined);
document.getElementById("o47").animate([{unicodeBidi: 'embed',}],100);
</script>
</body>

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1340127#c5)• 8 years ago |
|  | |

Attached file
[debug session for the slightly simplified testcase above](attachment.cgi?id=8839040)
— [Details](attachment.cgi?id=8839040&action=edit)

It looks like the issue here is that the first-in-flow (red color) has
a different 'unicode-bidi' computed value than the last continuation (blue).
This seems like a bug.
The nsBidiPresUtils code depends on GetBidiControl returning the same
value for all continuations, for Push/PopBidiControl to match:
<http://searchfox.org/mozilla-central/rev/12cf11303392edac9f1da0c02e3d9ad2ecc8f4d3/layout/base/nsBidiPresUtils.cpp#107>

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1340127#c6)• 8 years ago |
|  | |

(Sorry, got the colors wrong in the comment. The first-in-flow is blue, the last-in-flow is red.)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1340127#a317296_5168)• 8 years ago |

Component: Layout → CSS Parsing and Computation

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1340127#a453147_280903)• 8 years ago |

Flags: sec-bounty?

|  | [Jet Villegas (inactive)](/user_profile?user_id=384647) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1340127#a540533_384647)• 8 years ago |

Flags: needinfo?(bugs)

|  | [Xidorn Quan [:xidorn] UTC+10](/user_profile?user_id=373403) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1340127#c7)• 8 years ago |
|  | |

(In reply to Mats Palmgren (:mats) from [comment #4](/show_bug.cgi?id=1340127#c4 "RESOLVED FIXED - SEGV in ClearBidiControls"))
> <span id="o22" style="writing-mode:sideways-lr">
It seems to happen with any vertical writing mode, including {sideways,vertical}-{lr,rl}, but not horizontal-tb.
> document.getElementById("o38").prepend(unescape('%u0627'),undefined);
This line is not related. The only thing this line does is to trigger bidi resolution, which is by default disabled. Adding any element with dir="rtl" would have the same effect.
> document.getElementById("o47").animate([{unicodeBidi: 'embed',}],100);
This seems to be necessary. It doesn't happen when you replace this with something like setTimeout, however, replacing it with a CSS animation would still work. So I guess there is something animation involves.

|  | [Xidorn Quan [:xidorn] UTC+10](/user_profile?user_id=373403) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1340127#c8)• 8 years ago |
|  | |

Attached file
[Slightly simplified testcase with no script (CRASH ON LOAD)](attachment.cgi?id=8841870)
— [Details](attachment.cgi?id=8841870&action=edit)

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1340127#c9)• 8 years ago |
|  | |

This was less reproducable under rr than I would have expected, but I did manage to get a recording of the crash under rr after a few tries.

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1340127#c10)• 8 years ago |
|  | |

So while I don't quite see what Mats saw in [comment 5](/show_bug.cgi?id=1340127#c5 "RESOLVED FIXED - SEGV in ClearBidiControls") (when debugging Xidorn's testcase, which is admittedly different), I think it provides a pretty clear explanation of what happened. While there might be a subtle bug in animations code, the intersection of animations and ::first-line is nontrivial and shouldn't lead to crashes. I think the Bidi code should just check for continuations that have different unicode-bidi style and treat such continuation boundaries as though they're separate elements.

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1340127#c11)• 8 years ago |
|  | |

Attached patch

[Consider different bidi control/override values when deciding whether to consider a frame first or last](attachment.cgi?id=8842268&action=diff)
— [Details](attachment.cgi?id=8842268&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1340127&attachment=8842268)

Assignee: nobody → dbaronStatus: NEW → ASSIGNED
[Attachment #8842268](/attachment.cgi?id=8842268&action=edit "Consider different bidi control/override values when deciding whether to consider a frame first or last") -
Flags: review?(jfkthame)

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1340127#a1087818_3881)• 8 years ago |

Component: CSS Parsing and Computation → Layout: Text

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1340127#c12)• 8 years ago |
|  | |

Comment on [attachment 8842268](/attachment.cgi?id=8842268 "Consider different bidi control/override values when deciding whether to consider a frame first or last") [[details]](/attachment.cgi?id=8842268&action=edit "Consider different bidi control/override values when deciding whether to consider a frame first or last") [[diff]](/attachment.cgi?id=8842268&action=diff "Consider different bidi control/override values when deciding whether to consider a frame first or last") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1340127&attachment=8842268)
Consider different bidi control/override values when deciding whether to consider a frame first or last
Review of [attachment 8842268](/attachment.cgi?id=8842268 "Consider different bidi control/override values when deciding whether to consider a frame first or last") [[details]](/attachment.cgi?id=8842268&action=edit "Consider different bidi control/override values when deciding whether to consider a frame first or last") [[diff]](/attachment.cgi?id=8842268&action=diff "Consider different bidi control/override values when deciding whether to consider a frame first or last") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1340127&attachment=8842268):
-----------------------------------------------------------------
Sounds reasonable to me.
[Attachment #8842268](/attachment.cgi?id=8842268&action=edit "Consider different bidi control/override values when deciding whether to consider a frame first or last") -
Flags: review?(jfkthame) → review+

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1340127#c13)• 8 years ago |
|  | |

I'm going to trust Mats's sec-moderate rating here (from [bug 1337504 comment 8](/show_bug.cgi?id=1337504#c8 "RESOLVED FIXED - SEGV in ClearBidiControls")) and go ahead and land per the policy at <https://wiki.mozilla.org/Security/Bug_Approval_Process> .

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1340127#c14)• 8 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=eeea8d9630eaaf9e819c06e3e900c2d099495913&group_state=expanded>

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1340127#c15)• 8 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/eb6b998cfa79ea7eddbba71ccb3e9c8e327691aa>
[Bug 1340127](/show_bug.cgi?id=1340127 "RESOLVED FIXED - SEGV in ClearBidiControls") - Consider different bidi control/override values when deciding whether to consider a frame first or last. r=jfkthame

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1340127#c16)• 8 years ago |
|  | |

Comment on [attachment 8842268](/attachment.cgi?id=8842268 "Consider different bidi control/override values when deciding whether to consider a frame first or last") [[details]](/attachment.cgi?id=8842268&action=edit "Consider different bidi control/override values when deciding whether to consider a frame first or last") [[diff]](/attachment.cgi?id=8842268&action=diff "Consider different bidi control/override values when deciding whether to consider a frame first or last") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1340127&attachment=8842268)
Consider different bidi control/override values when deciding whether to consider a frame first or last
Approval Request Comment
[Feature/Bug causing the regression]: reasonably old, perhaps CSS Animations (Firefox 5)
[User impact if declined]: crashes
[Is this code covered by automated tests?]: yes
[Has the fix been verified in Nightly?]: no
[Needs manual test from QE? If yes, steps to reproduce]: no
[List of other uplifts needed for the feature/fix]: none
[Is the change risky?]: no
[Why is the change risky/not risky?]: the only cases where it can change behavior are extreme edge cases
[String changes made/needed]: no
[Attachment #8842268](/attachment.cgi?id=8842268&action=edit "Consider different bidi control/override values when deciding whether to consider a frame first or last") -
Flags: approval-mozilla-aurora?

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1340127#a1141653_3881)• 8 years ago |

Flags: in-testsuite?

|  | [Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)](/user_profile?user_id=308534) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1340127#c17)• 8 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/eb6b998cfa79>Status: ASSIGNED → RESOLVEDClosed: 8 years ago
[status-firefox54](/buglist.cgi?f1=cf_status_firefox54&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox54&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox54&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla54

|  | [Gerry Chang [:gchang]](/user_profile?user_id=506302) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1340127#a1198119_506302)• 8 years ago |

[status-firefox53](/buglist.cgi?f1=cf_status_firefox53&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox53&o1=equals&v1=affected)

|  | [Gerry Chang [:gchang]](/user_profile?user_id=506302) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1340127#c18)• 8 years ago |
|  | |

Comment on [attachment 8842268](/attachment.cgi?id=8842268 "Consider different bidi control/override values when deciding whether to consider a frame first or last") [[details]](/attachment.cgi?id=8842268&action=edit "Consider different bidi control/override values when deciding whether to consider a frame first or last") [[diff]](/attachment.cgi?id=8842268&action=diff "Consider different bidi control/override values when deciding whether to consider a frame first or last") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1340127&attachment=8842268)
Consider different bidi control/override values when deciding whether to consider a frame first or last
Fix a crash and security issue. Aurora53+.
[Attachment #8842268](/attachment.cgi?id=8842268&action=edit "Consider different bidi control/override values when deciding whether to consider a frame first or last") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1340127#c19)• 8 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/0da8d305ce00>
[status-firefox51](/buglist.cgi?f1=cf_status_firefox51&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=wontfix)
[status-firefox52](/buglist.cgi?f1=cf_status_firefox52&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=wontfix)
[status-firefox53](/buglist.cgi?f1=cf_status_firefox53&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox53&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox53&o1=equals&v1=fixed)
[status-firefox-esr45](/buglist.cgi?f1=cf_status_firefox_esr45&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=wontfix)
[status-firefox-esr52](/buglist.cgi?f1=cf_status_firefox_esr52&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=affected)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1340127#c20)• 8 years ago |
|  | |

Should we consider this for ESR52 as well? Too late for the initial release next week, but maybe for 52.1?Flags: needinfo?(dbaron)

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1340127#c21)• 8 years ago |
|  | |

Comment on [attachment 8842268](/attachment.cgi?id=8842268 "Consider different bidi control/override values when deciding whether to consider a frame first or last") [[details]](/attachment.cgi?id=8842268&action=edit "Consider different bidi control/override values when deciding whether to consider a frame first or last") [[diff]](/attachment.cgi?id=8842268&action=diff "Consider different bidi control/override values when deciding whether to consider a frame first or last") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1340127&attachment=8842268)
Consider different bidi control/override values when deciding whether to consider a frame first or last
[Approval Request Comment]
If this is not a sec:{high,crit} bug, please state case for ESR consideration: sec-moderate that's a relatively straightforward crash fix, and there could potentially be a more-exploitable bug lurking in the area
User impact if declined: crashes, most likely on fuzzer-generated content, probably not exploitable, but there's a chance there could be a different crash around that is
Fix Landed on Version: 53
Risk to taking this patch (and alternatives if risky): quite low; it should only be changing behavior in a case that misbehaves. (Unless there's a missing null-check or something like that, but I don't think there is.)
String or UUID changes made by this patch: noFlags: needinfo?(dbaron)
[Attachment #8842268](/attachment.cgi?id=8842268&action=edit "Consider different bidi control/override values when deciding whether to consider a frame first or last") -
Flags: approval-mozilla-esr52?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1340127#a1574240_1689)• 8 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1340127#a1939538_1689)• 8 years ago |

Group: layout-core-security → core-security-release

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1340127#c22)• 8 years ago |
|  | |

Comment on [attachment 8842268](/attachment.cgi?id=8842268 "Consider different bidi control/override values when deciding whether to consider a frame first or last") [[details]](/attachment.cgi?id=8842268&action=edit "Consider different bidi control/override values when deciding whether to consider a frame first or last") [[diff]](/attachment.cgi?id=8842268&action=diff "Consider different bidi control/override values when deciding whether to consider a frame first or last") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1340127&attachment=8842268)
Consider different bidi control/override values when deciding whether to consider a frame first or last
ok, let's get this in esr52.1
[Attachment #8842268](/attachment.cgi?id=8842268&action=edit "Consider different bidi control/override values when deciding whether to consider a frame first or last") -
Flags: approval-mozilla-esr52? → approval-mozilla-esr52+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1340127#c23)• 8 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr52/rev/1714eda3de9b>
[status-firefox-esr52](/buglist.cgi?f1=cf_status_firefox_esr52&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1340127#a2425193_75935)• 8 years ago |

[tracking-firefox53](/buglist.cgi?f1=cf_tracking_firefox53&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox53&o1=equals&v1=%3F)
[tracking-firefox54](/buglist.cgi?f1=cf_tracking_firefox54&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox54&o1=equals&v1=%3F)
[tracking-firefox-esr52](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=%3F)

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1340127#a2859193_580382)• 8 years ago |

[tracking-firefox53](/buglist.cgi?f1=cf_tracking_firefox53&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox53&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox53&o1=equals&v1=%2B)
[tracking-firefox54](/buglist.cgi?f1=cf_tracking_firefox54&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox54&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox54&o1=equals&v1=%2B)
[tracking-firefox-esr52](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=%3F) → [53+](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=53%2B)

|  | [Jet Villegas (inactive)](/user_profile?user_id=384647) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1340127#a3042134_384647)• 8 years ago |

Flags: needinfo?(bugs)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1340127#a4144501_280903)• 8 years ago |

Whiteboard: [adv-main53+][adv-esr52.1+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1340127#a4306111_280903)• 8 years ago |

Alias: CVE-2017-5449

|  | [Ciprian Georgiu, Desktop QA](/user_profile?user_id=576182) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1340127#c24)• 8 years ago |
|  | |

I didn't managed to reproduce the crash using an affected build. I tried with both testcases from [comment 4](/show_bug.cgi?id=1340127#c4 "RESOLVED FIXED - SEGV in ClearBidiControls") and [comment 8](/show_bug.cgi?id=1340127#c8 "RESOLVED FIXED - SEGV in ClearBidiControls") on 45.9.0 esr, 51 Nightly ASAN builds. Also, I've tried to resize the window after the testcase was loaded but it did not crashed. (Ubuntu 16.04 x64 LTS)
David, do you have any idea on what I'm missing here, in order to reproduce this?
Thanks!Flags: needinfo?(dbaron)

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1340127#c25)• 8 years ago |
|  | |

The testcase was not particularly easy for me to get to crash, but I did get it to happen at least once.Flags: needinfo?(dbaron)

|  | [Ciprian Georgiu, Desktop QA](/user_profile?user_id=576182) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1340127#c26)• 8 years ago |
|  | |

Nils, can you please confirm if this crash is fixed on esr52 and 53 latest Beta builds since I am not able to reproduce the issue?
Thanks!Flags: needinfo?(nils)

|  | [Nils](/user_profile?user_id=344130)  Reporter |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1340127#c27)• 8 years ago |
|  | |

Ciprian, are there any ESR asan builds available?

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1340127#c28)• 8 years ago |
|  | |

looking at treeherder it looks like there are:
asan debug build: <https://queue.taskcluster.net/v1/task/CfKzbJKtSve0QA8NPGaErw/runs/0/artifacts/public/build/target.tar.bz2>
asan opt build: <https://queue.taskcluster.net/v1/task/AHqkR6xKR3awFYNRfyvO8A/runs/0/artifacts/public/build/target.tar.bz2>

|  | [Nils](/user_profile?user_id=344130)  Reporter |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1340127#c29)• 8 years ago |
|  | |

Thanks Julien!
I can confirm both my testcase and the simplified testcase don't crashes the latest beta build.
My original testcase doesn't work on esr52 because of missing support for animate(), however I can confirm that the simplified testcase does not crash esr52.Flags: needinfo?(nils)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1340127#a21820112_1689)• 7 years ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1340127#a229836336_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1340127&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Mats Palmgren (inactive)](/user_profile?user_id=5168)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from wiki.mozilla.org_73f8d6fa_20250126_034645.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from wiki.mozilla.org_3659d679_20250126_034644.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from bugzilla.mozilla.org_da267992_20250124_215421.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1325955)
* [XML](/show_bug.cgi?ctype=xml&id=1325955)

Closed
[Bug 1325955](/show_bug.cgi?id=1325955)
(CVE-2017-5450)

Opened 8 years ago
Closed 8 years ago

# Address bar spoofing on Android

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Address bar spoofing on Android

## Categories

### (Firefox for Android Graveyard :: General, defect, P1)

[Product:](/describecomponents.cgi?product=Firefox%20for%20Android%20Graveyard)

Firefox for Android Graveyard
▾

Firefox for Android Graveyard
Old, retired Fennec bugs. Fennec is the code name of the effort to build a mobile version of Firefox ([more info](http://wiki.mozilla.org/Mobile/FennecVision))
[See Open Bugs in This Product](/buglist.cgi?product=Firefox%20for%20Android%20Graveyard&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Firefox%20for%20Android%20Graveyard)
Watch This Product

[Component:](/describecomponents.cgi?product=Firefox%20for%20Android%20Graveyard&component=General#General)

General
▾

Firefox for Android Graveyard :: General
For bugs in Fennec which do not fit into other more specific Fennec components.
[See Open Bugs in This Component](/buglist.cgi?product=Firefox%20for%20Android%20Graveyard&component=General&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Firefox%20for%20Android%20Graveyard&component=General&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Firefox%20for%20Android%20Graveyard&component=General)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

50 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

## Tracking

### (fennec+, firefox50 wontfix, firefox51 wontfix, firefox52 wontfix, firefox-esr52 unaffected, firefox53 fixed, firefox54 fixed)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

Firefox 55

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| fennec | [+](/buglist.cgi?f1=cf_blocking_fennec&o1=equals&v1=%2B) | --- |
| firefox50 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=wontfix) |
| firefox51 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=wontfix) |
| firefox52 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=wontfix) |
| firefox-esr52 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=unaffected) |
| firefox53 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox53&o1=equals&v1=fixed) |
| firefox54 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox54&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| fennec | + |  |
| firefox50 |  | wontfix |
| firefox51 |  | wontfix |
| firefox52 |  | wontfix |
| firefox-esr52 |  | unaffected |
| firefox53 |  | fixed |
| firefox54 |  | fixed |

## People

### (Reporter: gnehsoah, Assigned: walkingice)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/26aed0cd42de0d4319c038e52dc80765?d=mm&size=40)  [walkingice](/user_profile?user_id=465405)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/8ccff8eaa2b37f2e78921275952f7d43?d=mm&size=40)  [gnehsoah](/user_profile?user_id=586010)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

---

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

17 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: reporter-external, sec-moderate, Whiteboard: [adv-main53+][post-critsmash-triage])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2017-5450

[Keywords:](/describekeywords.cgi)

[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main53+][post-critsmash-triage]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a8131198_1689 "8 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [mwobensmith](/user_profile?user_id=452604) | [qe-verify](#a9001699_452604 "8 years ago") | - |
| --- | --- | --- |
| [mwobensmith](/user_profile?user_id=452604) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files, 4 obsolete files)

| [Screenshot\_20161227-221200.png](/attachment.cgi?id=8822051)  [8 years ago](#c0)  [gnehsoah](/user_profile?user_id=586010)   114.40 KB, image/png |  | [Details](/attachment.cgi?id=8822051&action=edit) |
| --- | --- | --- |
| [Screenshot\_20161227-221242.png](/attachment.cgi?id=8822052)  [8 years ago](#c1)  [gnehsoah](/user_profile?user_id=586010)   122.75 KB, image/png |  | [Details](/attachment.cgi?id=8822052&action=edit) |
| [testcase](/attachment.cgi?id=8822361)  [8 years ago](#c2)  [gnehsoah](/user_profile?user_id=586010)   86.90 KB, text/html |  | [Details](/attachment.cgi?id=8822361&action=edit) |
| [0001-Bug-1325955-To-use-hostPort-as-default-base-domain.patch](/attachment.cgi?id=8827850)  [8 years ago](#c16)  [Julian Chu [:walkingice]](/user_profile?user_id=465405)   1.84 KB, patch | sebastian : [review+](#c18 "8 years ago")  Gijs : [review-](#c19 "8 years ago") | [Details](/attachment.cgi?id=8827850&action=edit) | [Diff](/attachment.cgi?id=8827850&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1325955&attachment=8827850) |
| [0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-pr.patch](/attachment.cgi?id=8848048)  [8 years ago](#c23)  [Julian Chu [:walkingice]](/user_profile?user_id=465405)   1.92 KB, patch | Gijs : [review-](#c24 "8 years ago") | [Details](/attachment.cgi?id=8848048&action=edit) | [Diff](/attachment.cgi?id=8848048&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1325955&attachment=8848048) |
| [0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch](/attachment.cgi?id=8848488)  [8 years ago](#c25)  [Julian Chu [:walkingice]](/user_profile?user_id=465405)   2.61 KB, patch | Gijs : [review-](#c26 "8 years ago") | [Details](/attachment.cgi?id=8848488&action=edit) | [Diff](/attachment.cgi?id=8848488&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1325955&attachment=8848488) |
| [0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch](/attachment.cgi?id=8849839)  [8 years ago](#c29)  [Julian Chu [:walkingice]](/user_profile?user_id=465405)   2.77 KB, patch | Gijs : [review+](#c30 "8 years ago")  sebastian : [review+](#c31 "8 years ago") | [Details](/attachment.cgi?id=8849839&action=edit) | [Diff](/attachment.cgi?id=8849839&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1325955&attachment=8849839) |
| [0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch](/attachment.cgi?id=8850452)  [8 years ago](#c34)  [Julian Chu [:walkingice]](/user_profile?user_id=465405)   2.76 KB, patch | walkingice : [review+](#c34 "8 years ago")  gchang : [approval-mozilla-aurora+](#c39 "8 years ago")  gchang : [approval-mozilla-beta+](#c39 "8 years ago") | [Details](/attachment.cgi?id=8850452&action=edit) | [Diff](/attachment.cgi?id=8850452&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1325955&attachment=8850452) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [gnehsoah](/user_profile?user_id=586010)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1325955#c0)• 8 years ago |
|  | |

Attached image
[Screenshot\_20161227-221200.png](attachment.cgi?id=8822051)
— [Details](attachment.cgi?id=8822051&action=edit)

User Agent: Mozilla/5.0 (X11; Linux x86\_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36
Steps to reproduce:
User Agent: "Mozilla/5.0 (Android 6.0.1; Mobile; rv:50.1.0) Gecko/50.1.0 Firefox/50.1.0"
POC:
<http://192.243.113.21/spoof/firefox/url1.html>
Actual results:
The fake top level domain has been highlighted and the site attribute is wrong(see screenshot).
Expected results:
The site attribute should display the correct domain.

|  | [gnehsoah](/user_profile?user_id=586010)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1325955#c1)• 8 years ago |
|  | |

Attached image
[Screenshot\_20161227-221242.png](attachment.cgi?id=8822052)
— [Details](attachment.cgi?id=8822052&action=edit)

|  | [gnehsoah](/user_profile?user_id=586010)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1325955#c2)• 8 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=8822361)
— [Details](attachment.cgi?id=8822361&action=edit)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1325955#a184380_280903)• 8 years ago |

Flags: sec-bounty?

|  | [gnehsoah](/user_profile?user_id=586010)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1325955#c3)• 8 years ago |
|  | |

Any follow up on this issue?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1325955#c4)• 8 years ago |
|  | |

Tim: is there anyone on your team who could look into this?
Note: the Desktop UI \_also\_ shows the location as "javascript:mail.google.com//" which is still a bit spoofy but at least isn't highlighted to lend more authenticity to it (see [bug 1228719](/show_bug.cgi?id=1228719 "UNCONFIRMED - Partial URL spoofing using javascript: URI scheme") for example). But on Desktop the permission dialog has the correct domain in the door hanger.
Is it just the doorhanger UI that's wrong (spoof) or will the permission be saved to the wrong domain? On Desktop the permission is saved for the real domain--expected since it's not spoofed. On Fennec the permission is not saved for the real asking domain (which can be checked with the site identity doorhanger), but I'm not easily able to check the spoofed domain. Doesn't seem to be saved for the real mail.google.com, but maybe it's saved internally for the fake "javascript:mail.google.com"Status: UNCONFIRMED → NEWEver confirmed: trueFlags: needinfo?(timdream)

|  | [Tim Guan-tin Chien [:timdream] (please needinfo)](/user_profile?user_id=185001) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1325955#c5)• 8 years ago |
|  | |

Thanks for ni me. Will find someone to address this quickly.
Do we want to do a chemspell release on this?tracking-fennec: --- → +
[status-firefox50](/buglist.cgi?f1=cf_status_firefox50&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=affected)
[status-firefox51](/buglist.cgi?f1=cf_status_firefox51&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=affected)
[status-firefox52](/buglist.cgi?f1=cf_status_firefox52&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=affected)
[status-firefox53](/buglist.cgi?f1=cf_status_firefox53&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox53&o1=equals&v1=affected)
[status-firefox-esr45](/buglist.cgi?f1=cf_status_firefox_esr45&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=%3F)Flags: needinfo?(timdream)

|  | [Tim Guan-tin Chien [:timdream] (please needinfo)](/user_profile?user_id=185001) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1325955#c6)• 8 years ago |
|  | |

(\* chemspill, obviously.)

|  | [Nevin Chen(Not active on Bugzilla)](/user_profile?user_id=582291) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1325955#a1173762_582291)• 8 years ago |

Assignee: nobody → cnevinchen

|  | [Nevin Chen(Not active on Bugzilla)](/user_profile?user_id=582291) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1325955#c7)• 8 years ago |
|  | |

Hi Julian
Could you please help me with this? Thank you!Assignee: cnevinchen → walkingice0204

|  | [Kevin Brosnan [Ex-Mozilla]](/user_profile?user_id=406670) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1325955#c8)• 8 years ago |
|  | |

This is not a chemspill bug. It is a normal security bug and should be handled as described at <https://wiki.mozilla.org/Security/Bug_Approval_Process>

|  | [Julian Chu [:walkingice]](/user_profile?user_id=465405)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1325955#c9)• 8 years ago |
|  | |

So far what I found is here[1], it parses location regardless protocol (in this case, "javascript:"), then provide "gmail.com" as baseDomain to Android Notification. I am still trying to understand how desktop-firefox deal with this situation.
[1] <https://dxr.mozilla.org/mozilla-central/rev/8eaf154b385bbe0ff06155294ccf7962aa2d3324/mobile/android/chrome/content/browser.js#4265>

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1325955#c10)• 8 years ago |
|  | |

(In reply to Julian Chu [:walkingice] from [comment #9](/show_bug.cgi?id=1325955#c9 "VERIFIED FIXED - Address bar spoofing on Android"))
> So far what I found is here[1], it parses location regardless protocol (in
> this case, "javascript:"), then provide "gmail.com" as baseDomain to Android
> Notification. I am still trying to understand how desktop-firefox deal with
> this situation.
>
> [1]
> <https://dxr.mozilla.org/mozilla-central/rev/>
> 8eaf154b385bbe0ff06155294ccf7962aa2d3324/mobile/android/chrome/content/
> browser.js#4265
We parse the URL "properly" using nsIURI, if possible, and if not we don't highlight. See the code in <https://dxr.mozilla.org/mozilla-central/rev/8eaf154b385bbe0ff06155294ccf7962aa2d3324/browser/base/content/urlbarBindings.xml#236> , specifically <https://dxr.mozilla.org/mozilla-central/source/browser/base/content/urlbarBindings.xml#256-270>

|  | [Julian Chu [:walkingice]](/user_profile?user_id=465405)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1325955#c11)• 8 years ago |
|  | |

Gijs, thanks you for reminding me about that. So today I see desktop-firefox use uri[1] to present notification. The uri is assigned from a request[2]. Back to the problem, I think I can use `contentWin.document.documentURIObject.hostPort` as baseDomain if its protocol doesn't match http/https/ftp.
[1] <https://dxr.mozilla.org/mozilla-central/rev/88030580b14bb253a55bc174c987a9fa43c3fb55/toolkit/modules/PopupNotifications.jsm#747>
[2] <https://dxr.mozilla.org/mozilla-central/rev/88030580b14bb253a55bc174c987a9fa43c3fb55/browser/modules/PermissionUI.jsm#342>

|  | [Julian Chu [:walkingice]](/user_profile?user_id=465405)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1325955#c12)• 8 years ago |
|  | |

When I try to access `hostPort` in this way
baseDomain = contentWin.document.documentURIObject.hostPort;
// or
baseDomain = aLocationURI.hostPort;
I got an error
NS\_ERROR\_FAILURE: Component returned failure code: 0x80004005 (NS\_ERROR\_FAILURE) [nsIURI.hostPort]
Jim, do you have any idea for that? Or I did anything wrong?Flags: needinfo?(nchen)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1325955#c13)• 8 years ago |
|  | |

(In reply to Julian Chu [:walkingice] from [comment #11](/show_bug.cgi?id=1325955#c11 "VERIFIED FIXED - Address bar spoofing on Android"))
> Gijs, thanks you for reminding me about that. So today I see desktop-firefox
> use uri[1] to present notification. The uri is assigned from a request[2].
> Back to the problem, I think I can use
> `contentWin.document.documentURIObject.hostPort` as baseDomain if its
> protocol doesn't match http/https/ftp.
>
> [1]
> <https://dxr.mozilla.org/mozilla-central/rev/>
> 88030580b14bb253a55bc174c987a9fa43c3fb55/toolkit/modules/PopupNotifications.
> jsm#747
> [2]
> <https://dxr.mozilla.org/mozilla-central/rev/>
> 88030580b14bb253a55bc174c987a9fa43c3fb55/browser/modules/PermissionUI.jsm#342
Oh, sorry, I didn't realize there were two bugs reported here. My answer was specific to the location bar highlighting. We just shouldn't highlight non-http/https/ftp URLs there.
For the permission prompt, you shouldn't use the documentURIObject's hostPort (which is going to be broken for e.g. data: URIs controlled by some domain), you should use the document's nodePrincipal's URI. Note that the request might come from a (cross-origin) frame, so make sure you use the right window/document, which is not necessarily the toplevel one.

|  | [Julian Chu [:walkingice]](/user_profile?user_id=465405)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1325955#c14)• 8 years ago |
|  | |

I asked Kanru, and he told me that I cannot get hostPort due to the protocol is not recognized. (in this case, "javascript:gmail.google.com"). I need another way to get domain properly but no idea so far.Flags: needinfo?(nchen)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1325955#c15)• 8 years ago |
|  | |

(In reply to Julian Chu [:walkingice] from [comment #14](/show_bug.cgi?id=1325955#c14 "VERIFIED FIXED - Address bar spoofing on Android"))
> I asked Kanru, and he told me that I cannot get hostPort due to the protocol
> is not recognized. (in this case, "javascript:gmail.google.com"). I need
> another way to get domain properly but no idea so far.
Does document.nodePrincipal.URI.hostPort not work?

|  | [Julian Chu [:walkingice]](/user_profile?user_id=465405)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1325955#c16)• 8 years ago |
|  | |

Attached patch

[0001-Bug-1325955-To-use-hostPort-as-default-base-domain.patch](attachment.cgi?id=8827850&action=diff) (obsolete)
— [Details](attachment.cgi?id=8827850&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1325955&attachment=8827850)

[Attachment #8827850](/attachment.cgi?id=8827850&action=edit "0001-Bug-1325955-To-use-hostPort-as-default-base-domain.patch") -
Flags: review?(s.kaspari)

|  | [Julian Chu [:walkingice]](/user_profile?user_id=465405)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1325955#c17)• 8 years ago |
|  | |

Gijs: Yes it works, thanks! then I created a patch base on that value.

|  | [Sebastian Kaspari (:sebastian; :pocmo)](/user_profile?user_id=472516) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1325955#c18)• 8 years ago |
|  | |

Comment on [attachment 8827850](/attachment.cgi?id=8827850 "0001-Bug-1325955-To-use-hostPort-as-default-base-domain.patch") [[details]](/attachment.cgi?id=8827850&action=edit "0001-Bug-1325955-To-use-hostPort-as-default-base-domain.patch") [[diff]](/attachment.cgi?id=8827850&action=diff "0001-Bug-1325955-To-use-hostPort-as-default-base-domain.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1325955&attachment=8827850)
0001-Bug-1325955-To-use-hostPort-as-default-base-domain.patch
Review of [attachment 8827850](/attachment.cgi?id=8827850 "0001-Bug-1325955-To-use-hostPort-as-default-base-domain.patch") [[details]](/attachment.cgi?id=8827850&action=edit "0001-Bug-1325955-To-use-hostPort-as-default-base-domain.patch") [[diff]](/attachment.cgi?id=8827850&action=diff "0001-Bug-1325955-To-use-hostPort-as-default-base-domain.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1325955&attachment=8827850):
-----------------------------------------------------------------
I would have implemented this in ToolbarDisplayLayout where we use the baseDomain:
<https://dxr.mozilla.org/mozilla-central/source/mobile/android/base/java/org/mozilla/gecko/toolbar/ToolbarDisplayLayout.java#295-306>
But not extracting the baseDomain if this is not a http/https URL makes sense too. I case in this case we could remove one of those checks in ToolbarDisplayLayout.
I'll flag Gijs to have another look too.
[Attachment #8827850](/attachment.cgi?id=8827850&action=edit "0001-Bug-1325955-To-use-hostPort-as-default-base-domain.patch") -
Flags: review?(s.kaspari)
[Attachment #8827850](/attachment.cgi?id=8827850&action=edit "0001-Bug-1325955-To-use-hostPort-as-default-base-domain.patch") -
Flags: review?(gijskruitbosch+bugs)
[Attachment #8827850](/attachment.cgi?id=8827850&action=edit "0001-Bug-1325955-To-use-hostPort-as-default-base-domain.patch") -
Flags: review+

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1325955#c19)• 8 years ago |
|  | |

Comment on [attachment 8827850](/attachment.cgi?id=8827850 "0001-Bug-1325955-To-use-hostPort-as-default-base-domain.patch") [[details]](/attachment.cgi?id=8827850&action=edit "0001-Bug-1325955-To-use-hostPort-as-default-base-domain.patch") [[diff]](/attachment.cgi?id=8827850&action=diff "0001-Bug-1325955-To-use-hostPort-as-default-base-domain.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1325955&attachment=8827850)
0001-Bug-1325955-To-use-hostPort-as-default-base-domain.patch
Review of [attachment 8827850](/attachment.cgi?id=8827850 "0001-Bug-1325955-To-use-hostPort-as-default-base-domain.patch") [[details]](/attachment.cgi?id=8827850&action=edit "0001-Bug-1325955-To-use-hostPort-as-default-base-domain.patch") [[diff]](/attachment.cgi?id=8827850&action=diff "0001-Bug-1325955-To-use-hostPort-as-default-base-domain.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1325955&attachment=8827850):
-----------------------------------------------------------------
I don't think this is quite right. The eTLD service turns "mail.google.com" into "google.com", and "foo.gov.uk" into "gov.uk" but "foo.bar.ac.uk" into "bar.ac.uk".
This patch has almost no context (please configure hg/git to use 8 or 10 lines of context...), but as I understand it the baseDomain is used for two things:
- the thing in the permissions popup that indicates who's asking for permission
- the highlighted bit of the URL in the location bar
With this patch, we process the base domain differently in the case of an https URI than in the case of e.g. a data: or javascript: URI that inherits the principal from an http URI. So the permissions popup for either case might show the base domain (without subdomains) for one case, and the full domain for another. That's 1 bug.
Separately, AIUI the code as-is would still let us highlight a domain in a javascript: or data: uri if the domain from the inherited principal's URI occurs as a substring of the javascript or data URI. That also seems wrong, because such a substring has no special meaning in those URI schemes. We just shouldn't be highlighting the domain in the URI at all if we're displaying the full javascript: or data: URI (though it's probably sensible in the <https://dxr.mozilla.org/mozilla-central/source/mobile/android/base/java/org/mozilla/gecko/toolbar/ToolbarDisplayLayout.java#295-306> code for cases where we only show a domain anyway, to still only show a domain in the JS/data: case).
::: mobile/android/chrome/content/browser.js
@@ +4254,5 @@
> // If reader mode, get the base domain for the original url.
> let strippedURI = this.\_stripAboutReaderURL(documentURI);
>
> + // Regular expression is modified from urlbarBindings.xml. To use hostPort as default base-domain,
> + // and to give advance process only if its scheme match http/https/ftp
Can we clarify this comment by writing the comment in the order the code acts, and to use a better phrase than "give advance process"?
@@ +4255,5 @@
> let strippedURI = this.\_stripAboutReaderURL(documentURI);
>
> + // Regular expression is modified from urlbarBindings.xml. To use hostPort as default base-domain,
> + // and to give advance process only if its scheme match http/https/ftp
> + let baseDomain = contentWin.document.nodePrincipal.URI.hostPort || "";
Getting hostPort throws exceptions for non-standard URIs (e.g. null principal URIs or data: codebase URIs or about: URIs), which this code should probably deal with.
[Attachment #8827850](/attachment.cgi?id=8827850&action=edit "0001-Bug-1325955-To-use-hostPort-as-default-base-domain.patch") -
Flags: review?(gijskruitbosch+bugs) → review-

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1325955#c20)• 8 years ago |
|  | |

Comment on [attachment 8827850](/attachment.cgi?id=8827850 "0001-Bug-1325955-To-use-hostPort-as-default-base-domain.patch") [[details]](/attachment.cgi?id=8827850&action=edit "0001-Bug-1325955-To-use-hostPort-as-default-base-domain.patch") [[diff]](/attachment.cgi?id=8827850&action=diff "0001-Bug-1325955-To-use-hostPort-as-default-base-domain.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1325955&attachment=8827850)
0001-Bug-1325955-To-use-hostPort-as-default-base-domain.patch
Review of [attachment 8827850](/attachment.cgi?id=8827850 "0001-Bug-1325955-To-use-hostPort-as-default-base-domain.patch") [[details]](/attachment.cgi?id=8827850&action=edit "0001-Bug-1325955-To-use-hostPort-as-default-base-domain.patch") [[diff]](/attachment.cgi?id=8827850&action=diff "0001-Bug-1325955-To-use-hostPort-as-default-base-domain.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1325955&attachment=8827850):
-----------------------------------------------------------------
::: mobile/android/chrome/content/browser.js
@@ +4256,5 @@
>
> + // Regular expression is modified from urlbarBindings.xml. To use hostPort as default base-domain,
> + // and to give advance process only if its scheme match http/https/ftp
> + let baseDomain = contentWin.document.nodePrincipal.URI.hostPort || "";
> + let matchedURL = strippedURI.match(/^((?:(http|https|ftp):\/\/)(?:[^\/]+@)?)(.+?)(?::\d+)?(?:\/|$)/);
In fact, this also looks wrong because the ?: annotation is outside the grouping which you're trying to not get included as a group... So you're effectively adding a group, for no reason - please include the ?: annotation inside (both) the groups, and revert the change to the array deconstruction lower down, if this code stays the same at all...
Finally, you can write: (http|https|ftp) as (https?|ftp).

|  | [gnehsoah](/user_profile?user_id=586010)  Reporter |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1325955#c21)• 8 years ago |
| off-topic | |

| Comment hidden (off-topic) |  |
| --- | --- |

Any follow-up?

|  | [Nevin Chen(Not active on Bugzilla)](/user_profile?user_id=582291) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1325955#a6111693_582291)• 8 years ago |

Priority: -- → P1

|  | [Julian Chu [:walkingice]](/user_profile?user_id=465405)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1325955#c22)• 8 years ago |
|  | |

Gijs, thanks for your detailed explaining.:)
Yes, as you said, the baseDomain will be used in that 2 things. In the attached test case, we will got "gmail.com" as baseDomain, and it is incorrect. That's the reason I want to modify browser.js, rather than Java file.
So my idea is that, if the protocol is http/https/ftp, then it works like before. Otherwise, use host-port if exists. In desktop, the permission prompt use host-port as title in this test case, and I try to provide same behavior.
Let me update the patch as well as its regular expression.

|  | [Julian Chu [:walkingice]](/user_profile?user_id=465405)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1325955#c23)• 8 years ago |
|  | |

Attached patch

[0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-pr.patch](attachment.cgi?id=8848048&action=diff) (obsolete)
— [Details](attachment.cgi?id=8848048&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1325955&attachment=8848048)

Changed regular expression, comments and add checking for nodePrincipal.URI
[Attachment #8827850](/attachment.cgi?id=8827850&action=edit "0001-Bug-1325955-To-use-hostPort-as-default-base-domain.patch") -
Attachment is obsolete: true
[Attachment #8848048](/attachment.cgi?id=8848048&action=edit "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-pr.patch") -
Flags: review?(gijskruitbosch+bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1325955#c24)• 8 years ago |
|  | |

Comment on [attachment 8848048](/attachment.cgi?id=8848048 "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-pr.patch") [[details]](/attachment.cgi?id=8848048&action=edit "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-pr.patch") [[diff]](/attachment.cgi?id=8848048&action=diff "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-pr.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1325955&attachment=8848048)
0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-pr.patch
Review of [attachment 8848048](/attachment.cgi?id=8848048 "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-pr.patch") [[details]](/attachment.cgi?id=8848048&action=edit "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-pr.patch") [[diff]](/attachment.cgi?id=8848048&action=diff "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-pr.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1325955&attachment=8848048):
-----------------------------------------------------------------
This patch still has almost no context. Please configure hg/git to provide more context.
As noted below, I think we should just get rid of the regexp matching and only use the principal URL.
::: mobile/android/chrome/content/browser.js
@@ +4451,5 @@
>
> // Borrowed from desktop Firefox: <https://hg.mozilla.org/mozilla-central/annotate/72835344333f/browser/base/content/urlbarBindings.xml#l236>
> + // For recognized protocol http/https/ftp, parse base domain from its URI.
> + // If the protocol is not recognized, try to use hostPort to be base domain.
> + let matchedURL = strippedURI.match(/((?:https?|ftp):\/\/(?:[^\/]+@)?)(.+?)(?::\d+)?(?:\/|$)/);
There should be a ^ to ensure this matches at the beginning of the URL, because now this will still do the wrong thing for e.g.:
javascript:/\*[https://google.com/\*/mycodegoeshere](https://google.com/%2A/mycodegoeshere)().
@@ +4466,5 @@
> baseDomain = IDNService.convertACEtoUTF8(baseDomain);
> }
> } catch (e) {}
> + } else {
> + if (contentWin.document.nodePrincipal.URI && contentWin.document.nodePrincipal.URI.hostPort) {
It's good to check for principal.URI being null, but this will still throw sometimes (cf. in the desktop browser console, evaluate: makeURI("about:home").hostPort ), and you're still not getting the base domain for the hostname, as this code is after we call getBaseDomainFromHost. So this isn't right.
I think more generally, we should default to using the base domain off the principal URI if available. In all other cases we should just set it to "". I don't think there are any practical cases where that would produce the wrong result, and it's a lot safer than regexp matching.
[Attachment #8848048](/attachment.cgi?id=8848048&action=edit "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-pr.patch") -
Flags: review?(gijskruitbosch+bugs) → review-

|  | [Julian Chu [:walkingice]](/user_profile?user_id=465405)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1325955#c25)• 8 years ago |
|  | |

Attached patch

[0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch](attachment.cgi?id=8848488&action=diff) (obsolete)
— [Details](attachment.cgi?id=8848488&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1325955&attachment=8848488)

Use URI.host to get base domain, instead of regex. If the URI is not available or the scheme does not match, leave base domain as empty.
[Attachment #8848048](/attachment.cgi?id=8848048&action=edit "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-pr.patch") -
Attachment is obsolete: true
[Attachment #8848488](/attachment.cgi?id=8848488&action=edit "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") -
Flags: review?(gijskruitbosch+bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1325955#c26)• 8 years ago |
|  | |

Comment on [attachment 8848488](/attachment.cgi?id=8848488 "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") [[details]](/attachment.cgi?id=8848488&action=edit "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") [[diff]](/attachment.cgi?id=8848488&action=diff "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1325955&attachment=8848488)
0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch
Review of [attachment 8848488](/attachment.cgi?id=8848488 "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") [[details]](/attachment.cgi?id=8848488&action=edit "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") [[diff]](/attachment.cgi?id=8848488&action=diff "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1325955&attachment=8848488):
-----------------------------------------------------------------
::: mobile/android/chrome/content/browser.js
@@ +4452,3 @@
> let baseDomain = "";
> + // For recognized scheme, parse base domain from host.
> + let recognized = ["http", "https", "ftp"].some(scheme => strippedURI.startsWith(scheme));
Why not use the principal URI for data: and javascript: URIs which have inherited the principal? I don't understand why we're making the scheme determination based on the stripped (document) URI, rather than that of the principal.
Also, to check if an array contains an item, use array.includes().
@@ +4454,5 @@
> + let recognized = ["http", "https", "ftp"].some(scheme => strippedURI.startsWith(scheme));
> + if (recognized
> + && contentWin.document.nodePrincipal.URI
> + && contentWin.document.nodePrincipal.URI.host) {
> + let host = contentWin.document.nodePrincipal.URI.host;
This looks very repetitive, I would use a temp variable, e.g.:
let principalURI = contentWin.document.nodePrincipal.URI;
if (principalURI && ["http", "https", "ftp"].includes(principalURI.scheme) &&
principalURI.host) {
try {
baseDomain = Services.eTLD.getBaseDomainFromHost(principalURI.host);
...
} catch (e) {}
}
[Attachment #8848488](/attachment.cgi?id=8848488&action=edit "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") -
Flags: review?(gijskruitbosch+bugs) → review-

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1325955#c27)• 8 years ago |
|  | |

Also, why the switch from hostPort to host?

|  | [Julian Chu [:walkingice]](/user_profile?user_id=465405)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1325955#c28)• 8 years ago |
|  | |

I use strippedURI because it existed, so I think it should be reliable to check its scheme. As your comment, just get scheme from `nodePrincipal.URI.scheme` would be better then I will do in this way.
Switch from hostPort to host due to I would like to keep original implementation which use `Services.eTLD.getBaseDomainFromHost`

|  | [Julian Chu [:walkingice]](/user_profile?user_id=465405)  Assignee |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1325955#c29)• 8 years ago |
|  | |

Attached patch

[0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch](attachment.cgi?id=8849839&action=diff) (obsolete)
— [Details](attachment.cgi?id=8849839&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1325955&attachment=8849839)

\* Use principal.URI.scheme instead of strippedURI
\* Use array.includes
\* Use temporary variable principalURI
[Attachment #8848488](/attachment.cgi?id=8848488&action=edit "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") -
Attachment is obsolete: true
[Attachment #8849839](/attachment.cgi?id=8849839&action=edit "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") -
Flags: review?(gijskruitbosch+bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1325955#c30)• 8 years ago |
|  | |

Comment on [attachment 8849839](/attachment.cgi?id=8849839 "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") [[details]](/attachment.cgi?id=8849839&action=edit "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") [[diff]](/attachment.cgi?id=8849839&action=diff "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1325955&attachment=8849839)
0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch
Review of [attachment 8849839](/attachment.cgi?id=8849839 "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") [[details]](/attachment.cgi?id=8849839&action=edit "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") [[diff]](/attachment.cgi?id=8849839&action=diff "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1325955&attachment=8849839):
-----------------------------------------------------------------
This looks good to me, but it'd be a good idea for a mobile peer to have a look, too.
[Attachment #8849839](/attachment.cgi?id=8849839&action=edit "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") -
Flags: review?(s.kaspari)
[Attachment #8849839](/attachment.cgi?id=8849839&action=edit "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") -
Flags: review?(gijskruitbosch+bugs)
[Attachment #8849839](/attachment.cgi?id=8849839&action=edit "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") -
Flags: review+

|  | [Sebastian Kaspari (:sebastian; :pocmo)](/user_profile?user_id=472516) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1325955#c31)• 8 years ago |
|  | |

Comment on [attachment 8849839](/attachment.cgi?id=8849839 "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") [[details]](/attachment.cgi?id=8849839&action=edit "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") [[diff]](/attachment.cgi?id=8849839&action=diff "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1325955&attachment=8849839)
0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch
Review of [attachment 8849839](/attachment.cgi?id=8849839 "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") [[details]](/attachment.cgi?id=8849839&action=edit "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") [[diff]](/attachment.cgi?id=8849839&action=diff "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1325955&attachment=8849839):
-----------------------------------------------------------------
LGTM
[Attachment #8849839](/attachment.cgi?id=8849839&action=edit "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") -
Flags: review?(s.kaspari) → review+

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1325955#c32)• 8 years ago |
|  | |

Note that this bug will now need a sec rating and/or sec-approval before landing.

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1325955#a7350130_452604)• 8 years ago |

Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1325955#c33)• 8 years ago |
|  | |

Since this is a sec-moderate rated issue (out of our triage meeting), this no longer needs sec-approval (only high and critical issues or unrated ones do).

|  | [Julian Chu [:walkingice]](/user_profile?user_id=465405)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1325955#c34)• 8 years ago |
|  | |

Attached patch

[0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch](attachment.cgi?id=8850452&action=diff)
— [Details](attachment.cgi?id=8850452&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1325955&attachment=8850452)

Only update comment of the patch
[Attachment #8849839](/attachment.cgi?id=8849839&action=edit "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") -
Attachment is obsolete: true
[Attachment #8850452](/attachment.cgi?id=8850452&action=edit "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") -
Flags: review+

|  | [Julian Chu [:walkingice]](/user_profile?user_id=465405)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1325955#a7408807_465405)• 8 years ago |

Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1325955#c35)• 8 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/969b5b7a564671710a230fa2885024847d45e2f4>Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)](/user_profile?user_id=308534) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1325955#c36)• 8 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/969b5b7a5646>Status: NEW → RESOLVEDClosed: 8 years ago
[status-firefox54](/buglist.cgi?f1=cf_status_firefox54&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox54&o1=equals&v1=affected)
[status-firefox55](/buglist.cgi?f1=cf_status_firefox55&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox55&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → Firefox 55

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1325955#c37)• 8 years ago |
|  | |

Please request Aurora/Beta approval on this when you get a chance.
[status-firefox50](/buglist.cgi?f1=cf_status_firefox50&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=wontfix)
[status-firefox51](/buglist.cgi?f1=cf_status_firefox51&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=wontfix)
[status-firefox52](/buglist.cgi?f1=cf_status_firefox52&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=wontfix)
[status-firefox-esr45](/buglist.cgi?f1=cf_status_firefox_esr45&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=%3F) → ---Flags: needinfo?(walkingice0204)

|  | [Julian Chu [:walkingice]](/user_profile?user_id=465405)  Assignee |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1325955#c38)• 8 years ago |
|  | |

Comment on [attachment 8850452](/attachment.cgi?id=8850452 "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") [[details]](/attachment.cgi?id=8850452&action=edit "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") [[diff]](/attachment.cgi?id=8850452&action=diff "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1325955&attachment=8850452)
0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch
Approval Request Comment
[Feature/Bug causing the regression]:
[User impact if declined]: Notification might display incorrect base-domain in some scheme
[Is this code covered by automated tests?]: No
[Has the fix been verified in Nightly?]: Yes
[Is the change risky?]:Low
[Why is the change not risky?]: It checks NULL and handled exception. In worst case it just assign empty string to base-domain.Flags: needinfo?(walkingice0204)
[Attachment #8850452](/attachment.cgi?id=8850452&action=edit "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") -
Flags: approval-mozilla-beta?
[Attachment #8850452](/attachment.cgi?id=8850452&action=edit "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") -
Flags: approval-mozilla-aurora?

|  | [Gerry Chang [:gchang]](/user_profile?user_id=506302) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1325955#c39)• 8 years ago |
|  | |

Comment on [attachment 8850452](/attachment.cgi?id=8850452 "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") [[details]](/attachment.cgi?id=8850452&action=edit "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") [[diff]](/attachment.cgi?id=8850452&action=diff "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1325955&attachment=8850452)
0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch
Fix a security issue. Aurora54+ & Beta53+.
[Attachment #8850452](/attachment.cgi?id=8850452&action=edit "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") -
Flags: approval-mozilla-beta?
[Attachment #8850452](/attachment.cgi?id=8850452&action=edit "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") -
Flags: approval-mozilla-beta+
[Attachment #8850452](/attachment.cgi?id=8850452&action=edit "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") -
Flags: approval-mozilla-aurora?
[Attachment #8850452](/attachment.cgi?id=8850452&action=edit "0001-Bug-1325955-Prevent-providing-wrong-baseDomain-if-sc.patch") -
Flags: approval-mozilla-aurora+

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1325955#c40)• 8 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/578e94e40a70>
[status-firefox54](/buglist.cgi?f1=cf_status_firefox54&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox54&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox54&o1=equals&v1=fixed)

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1325955#c41)• 8 years ago |
|  | |

has problems to apply to beta:
grafting 407777:578e94e40a70 "[Bug 1325955](/show_bug.cgi?id=1325955 "VERIFIED FIXED - Address bar spoofing on Android") - Prevent providing wrong baseDomain if scheme is not recognized r=sebastian a=gchang"
merging mobile/android/chrome/content/browser.js
warning: conflicts while merging mobile/android/chrome/content/browser.js! (edit, then use 'hg resolve --mark')
abort: unresolved conflicts, can't continue
(use 'hg resolve' and 'hg graft --continue')Flags: needinfo?(walkingice0204)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1325955#c42)• 8 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/a9e49ecff889>
[status-firefox53](/buglist.cgi?f1=cf_status_firefox53&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox53&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox53&o1=equals&v1=fixed)
[status-firefox-esr52](/buglist.cgi?f1=cf_status_firefox_esr52&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=unaffected)Flags: needinfo?(walkingice0204)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1325955#a7913199_1689)• 8 years ago |

Group: firefox-core-security → core-security-release

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1325955#a8131198_1689)• 8 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1325955#a8542147_280903)• 8 years ago |

Whiteboard: [adv-main53+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1325955#a8702979_280903)• 8 years ago |

Alias: CVE-2017-5450

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1325955#c43)• 8 years ago |
|  | |

Hi, gnehsoah, can you verify that this has been fixed?Flags: needinfo?(gnehsoah)

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1325955#a9001699_452604)• 8 years ago |

Flags: qe-verify-Whiteboard: [adv-main53+] → [adv-main53+][post-critsmash-triage]

|  | [gnehsoah](/user_profile?user_id=586010)  Reporter |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1325955#c44)• 8 years ago |
|  | |

Yes, looks like it's fixed.Flags: needinfo?(gnehsoah)

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1325955#c45)• 8 years ago |
|  | |

Thank you very much.Status: RESOLVED → VERIFIED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1325955#a26216984_1689)• 7 years ago |

Group: core-security-release

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1325955#a125722532_1)• 4 years ago |

Product: Firefox for Android → Firefox for Android Graveyard

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1325955#a233561622_1689)• 8 months ago |

[status-firefox55](/buglist.cgi?f1=cf_status_firefox55&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox55&o1=equals&v1=fixed) → ---

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1325955#a234232875_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1325955&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [gnehsoah](/user_profile?user_id=586010)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_0a7448f6_20250124_215422.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2017-10

## Security vulnerabilities fixed in Firefox 53

Announced
April 19, 2017
Impact
critical
Products
Firefox
Fixed in

* Firefox 53

#### [#CVE-2017-5433: Use-after-free in SMIL animation functions](#CVE-2017-5433)

Reporter
Nils
Impact
critical
##### Description

A use-after-free vulnerability in SMIL animation functions occurs when pointers to animation elements in an array are dropped from the animation controller while still in use. This results in a potentially exploitable crash.

##### References

* [Bug 1347168](https://bugzilla.mozilla.org/show_bug.cgi?id=1347168)

#### [#CVE-2017-5435: Use-after-free during transaction processing in the editor](#CVE-2017-5435)

Reporter
Nils
Impact
critical
##### Description

A use-after-free vulnerability occurs during transaction processing in the editor during design mode interactions. This results in a potentially exploitable crash.

##### References

* [Bug 1350683](https://bugzilla.mozilla.org/show_bug.cgi?id=1350683)

#### [#CVE-2017-5436: Out-of-bounds write with malicious font in Graphite 2](#CVE-2017-5436)

Reporter
Holger Fuhrmannek
Impact
critical
##### Description

An out-of-bounds write in the Graphite 2 library triggered with a maliciously crafted Graphite font. This results in a potentially exploitable crash. This issue was fixed in the Graphite 2 library as well as Mozilla products.

##### References

* [Bug 1345461](https://bugzilla.mozilla.org/show_bug.cgi?id=1345461)

#### [#CVE-2017-5461: Out-of-bounds write in Base64 encoding in NSS](#CVE-2017-5461)

Reporter
Ronald Crane
Impact
critical
##### Description

An out-of-bounds write during Base64 decoding operation in the Network Security Services (NSS) library due to insufficient memory being allocated to the buffer. This results in a potentially exploitable crash. The NSS library has been updated to fix this issue to address this issue and Firefox 53 has been updated with NSS version 3.29.5.

##### References

* [Bug 1344380](https://bugzilla.mozilla.org/show_bug.cgi?id=1344380)

#### [#CVE-2017-5459: Buffer overflow in WebGL](#CVE-2017-5459)

Reporter
Atte Kettunen
Impact
critical
##### Description

A buffer overflow in WebGL triggerable by web content, resulting in a potentially exploitable crash.

##### References

* [Bug 1333858](https://bugzilla.mozilla.org/show_bug.cgi?id=1333858)

#### [#CVE-2017-5466: Origin confusion when reloading isolated data:text/html URL](#CVE-2017-5466)

Reporter
Takeshi Terada
Impact
critical
##### Description

If a page is loaded from an original site through a hyperlink and contains a redirect to a `data:text/html` URL, triggering a reload will run the reloaded `data:text/html` page with its origin set incorrectly. This allows for a cross-site scripting (XSS) attack.

##### References

* [Bug 1353975](https://bugzilla.mozilla.org/show_bug.cgi?id=1353975)

#### [#CVE-2017-5434: Use-after-free during focus handling](#CVE-2017-5434)

Reporter
Nils
Impact
high
##### Description

A use-after-free vulnerability occurs when redirecting focus handling which results in a potentially exploitable crash.

##### References

* [Bug 1349946](https://bugzilla.mozilla.org/show_bug.cgi?id=1349946)

#### [#CVE-2017-5432: Use-after-free in text input selection](#CVE-2017-5432)

Reporter
Nils
Impact
high
##### Description

A use-after-free vulnerability occurs during certain text input selection resulting in a potentially exploitable crash.

##### References

* [Bug 1346654](https://bugzilla.mozilla.org/show_bug.cgi?id=1346654)

#### [#CVE-2017-5460: Use-after-free in frame selection](#CVE-2017-5460)

Reporter
Nils
Impact
high
##### Description

A use-after-free vulnerability in frame selection triggered by a combination of malicious script content and key presses by a user. This results in a potentially exploitable crash.

##### References

* [Bug 1343642](https://bugzilla.mozilla.org/show_bug.cgi?id=1343642)

#### [#CVE-2017-5438: Use-after-free in nsAutoPtr during XSLT processing](#CVE-2017-5438)

Reporter
Nicolas Grégoire
Impact
high
##### Description

A use-after-free vulnerability during XSLT processing due to the result handler being held by a freed handler during handling. This results in a potentially exploitable crash.

##### References

* [Bug 1336828](https://bugzilla.mozilla.org/show_bug.cgi?id=1336828)

#### [#CVE-2017-5439: Use-after-free in nsTArray Length() during XSLT processing](#CVE-2017-5439)

Reporter
Nicolas Grégoire
Impact
high
##### Description

A use-after-free vulnerability during XSLT processing due to poor handling of template parameters. This results in a potentially exploitable crash.

##### References

* [Bug 1336830](https://bugzilla.mozilla.org/show_bug.cgi?id=1336830)

#### [#CVE-2017-5440: Use-after-free in txExecutionState destructor during XSLT processing](#CVE-2017-5440)

Reporter
Nicolas Grégoire
Impact
high
##### Description

A use-after-free vulnerability during XSLT processing due to a failure to propagate error conditions during matching while evaluating context, leading to objects being used when they no longer exist. This results in a potentially exploitable crash.

##### References

* [Bug 1336832](https://bugzilla.mozilla.org/show_bug.cgi?id=1336832)

#### [#CVE-2017-5441: Use-after-free with selection during scroll events](#CVE-2017-5441)

Reporter
Nils
Impact
high
##### Description

A use-after-free vulnerability when holding a selection during scroll events. This results in a potentially exploitable crash.

##### References

* [Bug 1343795](https://bugzilla.mozilla.org/show_bug.cgi?id=1343795)

#### [#CVE-2017-5442: Use-after-free during style changes](#CVE-2017-5442)

Reporter
Nils
Impact
high
##### Description

A use-after-free vulnerability during changes in style when manipulating DOM elements. This results in a potentially exploitable crash.

##### References

* [Bug 1347979](https://bugzilla.mozilla.org/show_bug.cgi?id=1347979)

#### [#CVE-2017-5464: Memory corruption with accessibility and DOM manipulation](#CVE-2017-5464)

Reporter
Nils
Impact
high
##### Description

During DOM manipulations of the accessibility tree through script, the DOM tree can become out of sync with the accessibility tree, leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1347075](https://bugzilla.mozilla.org/show_bug.cgi?id=1347075)

#### [#CVE-2017-5443: Out-of-bounds write during BinHex decoding](#CVE-2017-5443)

Reporter
Chamal De Silva
Impact
high
##### Description

An out-of-bounds write vulnerability while decoding improperly formed BinHex format archives.

##### References

* [Bug 1342661](https://bugzilla.mozilla.org/show_bug.cgi?id=1342661)

#### [#CVE-2017-5444: Buffer overflow while parsing application/http-index-format content](#CVE-2017-5444)

Reporter
Chamal De Silva
Impact
high
##### Description

A buffer overflow vulnerability while parsing `application/http-index-format` format content when the header contains improperly formatted data. This allows for an out-of-bounds read of data from memory.

##### References

* [Bug 1344461](https://bugzilla.mozilla.org/show_bug.cgi?id=1344461)

#### [#CVE-2017-5446: Out-of-bounds read when HTTP/2 DATA frames are sent with incorrect data](#CVE-2017-5446)

Reporter
Chun Han Hsiao
Impact
high
##### Description

An out-of-bounds read when an HTTP/2 connection to a servers sends `DATA` frames with incorrect data content. This leads to a potentially exploitable crash.

##### References

* [Bug 1343505](https://bugzilla.mozilla.org/show_bug.cgi?id=1343505)

#### [#CVE-2017-5447: Out-of-bounds read during glyph processing](#CVE-2017-5447)

Reporter
Ivan Fratric of Google Project Zero
Impact
high
##### Description

An out-of-bounds read during the processing of glyph widths during text layout. This results in a potentially exploitable crash and could allow an attacker to read otherwise inaccessible memory.

##### References

* [Bug 1343552](https://bugzilla.mozilla.org/show_bug.cgi?id=1343552)

#### [#CVE-2017-5465: Out-of-bounds read in ConvolvePixel](#CVE-2017-5465)

Reporter
Ivan Fratric of Google Project Zero
Impact
high
##### Description

An out-of-bounds read while processing SVG content in `ConvolvePixel`. This results in a crash and also allows for otherwise inaccessible memory being copied into SVG graphic content, which could then displayed.

##### References

* [Bug 1347617](https://bugzilla.mozilla.org/show_bug.cgi?id=1347617)

#### [#CVE-2017-5448: Out-of-bounds write in ClearKeyDecryptor](#CVE-2017-5448)

Reporter
Anonymous working with Trend Micro's Zero Day Initiative
Impact
high
##### Description

An out-of-bounds write in `ClearKeyDecryptor` while decrypting some Clearkey-encrypted media content. The `ClearKeyDecryptor` code runs within the Gecko Media Plugin (GMP) sandbox. If a second mechanism is found to escape the sandbox, this vulnerability allows for the writing of arbitrary data within memory, resulting in a potentially exploitable crash.

##### References

* [Bug 1346648](https://bugzilla.mozilla.org/show_bug.cgi?id=1346648)

#### [#CVE-2016-10196: Vulnerabilities in Libevent library](#CVE-2016-10196)

Reporter
Huzaifa Sidhpurwala
Impact
high
##### Description

Three vulnerabilities were reported in the Libevent library that allow for out-of-bounds reads and denial of service (DoS) attacks. These were fixed in the Libevent library and these changes were ported to Mozilla code.

##### References

* [Bug 1343453](https://bugzilla.mozilla.org/show_bug.cgi?id=1343453)
* [CVE-2016-10195](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-10195)
* [CVE-2016-10196](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-10196)
* [CVE-2016-10197](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-10197)

#### [#CVE-2017-5454: Sandbox escape allowing file system read access through file picker](#CVE-2017-5454)

Reporter
Haik Aftandilian
Impact
high
##### Description

A mechanism to bypass file system access protections in the sandbox to use the file picker to access different files than those selected in the file picker through the use of relative paths. This allows for read only access to the local file system.

##### References

* [Bug 1349276](https://bugzilla.mozilla.org/show_bug.cgi?id=1349276)

#### [#CVE-2017-5455: Sandbox escape through internal feed reader APIs](#CVE-2017-5455)

Reporter
Paul Theriault
Impact
high
##### Description

The internal feed reader APIs that crossed the sandbox barrier allowed for a sandbox escape and escalation of privilege if combined with another vulnerability that resulted in remote code execution inside the sandboxed process.

##### References

* [Bug 1341191](https://bugzilla.mozilla.org/show_bug.cgi?id=1341191)

#### [#CVE-2017-5456: Sandbox escape allowing local file system access](#CVE-2017-5456)

Reporter
Julian Hector
Impact
high
##### Description

A mechanism to bypass file system access protections in the sandbox using the file system request constructor through an IPC message. This allows for read and write access to the local file system.

##### References

* [Bug 1344415](https://bugzilla.mozilla.org/show_bug.cgi?id=1344415)

#### [#CVE-2017-5469: Potential Buffer overflow in flex-generated code](#CVE-2017-5469)

Reporter
Petr Cerny
Impact
high
##### Description

Fixed potential buffer overflows in generated Firefox code due to [CVE-2016-6354](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-6354) issue in Flex.

##### References

* [Bug 1292534](https://bugzilla.mozilla.org/show_bug.cgi?id=1292534)

#### [#CVE-2017-5445: Uninitialized values used while parsing application/http-index-format content](#CVE-2017-5445)

Reporter
Chamal De Silva
Impact
moderate
##### Description

A vulnerability while parsing `application/http-index-format` format content where uninitialized values are used to create an array. This could allow the reading of uninitialized memory into the arrays affected.

##### References

* [Bug 1344467](https://bugzilla.mozilla.org/show_bug.cgi?id=1344467)

#### [#CVE-2017-5449: Crash during bidirectional unicode manipulation with animation](#CVE-2017-5449)

Reporter
Nils
Impact
moderate
##### Description

A possibly exploitable crash triggered during layout and manipulation of bidirectional unicode text in concert with CSS animations.

##### References

* [Bug 1340127](https://bugzilla.mozilla.org/show_bug.cgi?id=1340127)

#### [#CVE-2017-5450: Addressbar spoofing using javascript: URI on Firefox for Android](#CVE-2017-5450)

Reporter
Haosheng Wang
Impact
moderate
##### Description

A mechanism to spoof the Firefox for Android addressbar using a `javascript:` URI. On Firefox for Android, the base domain is parsed incorrectly, making the resulting location less visibly a spoofed site and showing an incorrect domain in appended notifications.

##### References

* [Bug 1325955](https://bugzilla.mozilla.org/show_bug.cgi?id=1325955)

#### [#CVE-2017-5451: Addressbar spoofing with onblur event](#CVE-2017-5451)

Reporter
Jordi Chancel
Impact
moderate
##### Description

A mechanism to spoof the addressbar through the user interaction on the addressbar and the `onblur` event. The event could be used by script to affect text display to make the loaded site appear to be different from the one actually loaded within the addressbar.

##### References

* [Bug 1273537](https://bugzilla.mozilla.org/show_bug.cgi?id=1273537)

#### [#CVE-2017-5462: DRBG flaw in NSS](#CVE-2017-5462)

Reporter
Vladimir Klebanov, Franziskus Kiefer
Impact
moderate
##### Description

A flaw in DRBG number generation within the Network Security Services (NSS) library where the internal state V does not correctly carry bits over. The NSS library has been updated to fix this issue to address this issue and Firefox 53 has been updated with NSS version 3.29.5.

##### References

* [Bug 1345089](https://bugzilla.mozilla.org/show_bug.cgi?id=1345089)

#### [#CVE-2017-5463: Addressbar spoofing through reader view on Firefox for Android](#CVE-2017-5463)

Reporter
Muneaki Nishimura
Impact
moderate
##### Description

Android intents can be used to launch Firefox for Android in reader mode with a user specified URL. This allows an attacker to spoof the contents of the addressbar as displayed to users.
*Note: This attack only affects Firefox for Android. Other operating systems are not affected.*

##### References

* [Bug 1338867](https://bugzilla.mozilla.org/show_bug.cgi?id=1338867)

#### [#CVE-2017-5467: Memory corruption when drawing Skia content](#CVE-2017-5467)

Reporter
Heather Miller of Google Skia team
Impact
moderate
##### Description

A potential memory corruption and crash when using Skia content when drawing content outside of the bounds of a clipping region.

##### References

* [Bug 1347262](https://bugzilla.mozilla.org/show_bug.cgi?id=1347262)

#### [#CVE-2017-5452: Addressbar spoofing during scrolling with editable content on Firefox for Android](#CVE-2017-5452)

Reporter
Jordi Chancel
Impact
low
##### Description

Malicious sites can display a spoofed addressbar on a page when the existing location bar on the new page is scrolled out of view if an HTML editable page element is user selected.
*Note: This attack only affects Firefox for Android. Other operating systems are not affected.*

##### References

* [Bug 1344517](https://bugzilla.mozilla.org/show_bug.cgi?id=1344517)

#### [#CVE-2017-5453: HTML injection into RSS Reader feed preview page through TITLE element](#CVE-2017-5453)

Reporter
Jose María Acuña
Impact
low
##### Description

A mechanism to inject static HTML into the RSS reader preview page due to a failure to escape characters sent as URL parameters for a feed's `TITLE` element. This vulnerability allows for spoofing but no scripted content can be run.

##### References

* [Bug 1321247](https://bugzilla.mozilla.org/show_bug.cgi?id=1321247)

#### [#CVE-2017-5458: Drag and drop of javascript: URLs can allow for self-XSS](#CVE-2017-5458)

Reporter
Daniel Veditz
Impact
low
##### Description

When a `javascript:` URL is drag and dropped by a user into the addressbar, the URL will be processed and executed. This allows for users to be socially engineered to execute an XSS attack on themselves.

##### References

* [Bug 1229426](https://bugzilla.mozilla.org/show_bug.cgi?id=1229426)

#### [#CVE-2017-5468: Incorrect ownership model for Private Browsing information](#CVE-2017-5468)

Reporter
Anonymous
Impact
low
##### Description

An issue with incorrect ownership model of `privateBrowsing` information exposed through developer tools. This can result in a non-exploitable crash when manually triggered during debugging.

##### References

* [Bug 1329521](https://bugzilla.mozilla.org/show_bug.cgi?id=1329521)

#### [#CVE-2017-5430: Memory safety bugs fixed in Firefox 53 and Firefox ESR 52.1](#CVE-2017-5430)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Christian Holler, Jon Coppeard, Milan Sreckovic, Tyson Smith, Ronald Crane, Randell Jesup, Philipp, Tooru Fujisawa, and Kan-Ru Chen reported memory safety bugs present in Firefox 52 and Firefox ESR 52. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 53 and Firefox ESR 52.1](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1342101%2C1340482%2C1344686%2C1329796%2C1346419%2C1349621%2C1344081%2C1344305%2C1348143%2C1349719%2C1353476%2C1337418%2C1346140%2C1339722)

#### [#CVE-2017-5429: Memory safety bugs fixed in Firefox 53, Firefox ESR 45.9, and Firefox ESR 52.1](#CVE-2017-5429)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Christian Holler, Jon Coppeard, Marcia Knous, David Baron, Mats Palmgren, Ronald Crane, Bob Clary, and Chris Peterson reported memory safety bugs present in Firefox 52, Firefox ESR 45.8, and Firefox ESR 52. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 53, Firefox ESR 45.9, and Firefox ESR 52.1](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1343261%2C1350844%2C1341096%2C1342823%2C1348894%2C1348941%2C1349340%2C1352926%2C1353088%2C)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)


