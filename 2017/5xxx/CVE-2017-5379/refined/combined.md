=== Content from bugzilla.mozilla.org_e5007d0c_20250126_073134.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1330769)
* [XML](/show_bug.cgi?ctype=xml&id=1330769)

Closed
[Bug 1330769](/show_bug.cgi?id=1330769)

Opened 8 years ago
Closed 8 years ago

# ASLR leak via pointer scrambling in ShapeTable

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

ASLR leak via pointer scrambling in ShapeTable

## Categories

### (Core :: JavaScript Engine, defect, P1)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla53

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr45 | [51+](/buglist.cgi?f1=cf_tracking_firefox_esr45&o1=equals&v1=51%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=fixed) |
| firefox50 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=wontfix) |
| firefox51 | [blocking](/buglist.cgi?f1=cf_tracking_firefox51&o1=equals&v1=blocking) | [fixed](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=fixed) |
| firefox52 | [+](/buglist.cgi?f1=cf_tracking_firefox52&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=fixed) |
| firefox53 | [+](/buglist.cgi?f1=cf_tracking_firefox53&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox53&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr45 | 51+ | fixed |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox50 |  | wontfix |
| firefox51 | blocking | fixed |
| firefox52 | + | fixed |
| firefox53 | + | fixed |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: RyanVM, Assigned: jorendorff)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/5a83f46f9f97d184457cb2dedfa19173?d=mm&size=40)  [jorendorff](/user_profile?user_id=281791)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=40)  [RyanVM](/user_profile?user_id=75935)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

15 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[CVE-2017-5378](/show_bug.cgi?id=1312001 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set")

Dependency [tree](/showdependencytree.cgi?id=1330769&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1330769)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-disclosure, csectype-sop, sec-high, Whiteboard: [adv-main51+][adv-esr45.7+] Disclosure date ~Jan 21 2017 (note Fx51 scheduled for Jan 24))

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[csectype-disclosure](/buglist.cgi?keywords=csectype-disclosure&resolution=---),
[csectype-sop](/buglist.cgi?keywords=csectype-sop&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main51+][adv-esr45.7+] Disclosure date ~Jan 21 2017 (note Fx51 scheduled for Jan 24)

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (5 files, 1 obsolete file)

| [ASLR leak via pointer scrambling in ShapeTable](/attachment.cgi?id=8826338)  [8 years ago](#c2)  [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)   10.96 KB, patch | jandem : [review+](#c3 "8 years ago") | [Details](/attachment.cgi?id=8826338&action=edit) | [Diff](/attachment.cgi?id=8826338&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1330769&attachment=8826338) |
| --- | --- | --- |
| [Avoid using Symbol addresses in hash codes](/attachment.cgi?id=8826742)  [8 years ago](#c5)  [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)   12.26 KB, patch | jorendorff : [review+](#c7 "8 years ago")  abillings : [sec-approval+](#a427509_280903 "8 years ago") | [Details](/attachment.cgi?id=8826742&action=edit) | [Diff](/attachment.cgi?id=8826742&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1330769&attachment=8826742) |
| [Avoid using Symbol addresses in hash codes (aurora)](/attachment.cgi?id=8827629)  [8 years ago](#c18)  [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)   12.28 KB, patch | lizzard : [approval-mozilla-aurora+](#a447714_451704 "8 years ago") | [Details](/attachment.cgi?id=8827629&action=edit) | [Diff](/attachment.cgi?id=8827629&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1330769&attachment=8827629) |
| [Avoid using Symbol addresses in hash codes (beta)](/attachment.cgi?id=8827630)  [8 years ago](#c19)  [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)   12.27 KB, patch | lizzard : [approval-mozilla-beta+](#a447827_451704 "8 years ago") | [Details](/attachment.cgi?id=8827630&action=edit) | [Diff](/attachment.cgi?id=8827630&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1330769&attachment=8827630) |
| [Avoid using Symbol addresses in hash codes (release)](/attachment.cgi?id=8827631)  [8 years ago](#c20)  [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)   12.27 KB, patch | lizzard : [approval-mozilla-release+](#c27 "8 years ago") | [Details](/attachment.cgi?id=8827631&action=edit) | [Diff](/attachment.cgi?id=8827631&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1330769&attachment=8827631) |
| [Avoid using Symbol addresses in hash codes (esr45)](/attachment.cgi?id=8827634)  [8 years ago](#c25)  [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)   12.04 KB, patch | lizzard : [approval-mozilla-esr45+](#a447852_451704 "8 years ago") | [Details](/attachment.cgi?id=8827634&action=edit) | [Diff](/attachment.cgi?id=8827634&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1330769&attachment=8827634) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1330769#c0)• 8 years ago |
|  | |

+++ This bug was initially created as a clone of [Bug #1312001](/show_bug.cgi?id=1312001 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set") +++
[Bug 1312001](/show_bug.cgi?id=1312001 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set") fixed many of the ASLR leak issues, but ShapeTable still has similar issues that need fixing.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1330769#a21_75935)• 8 years ago |

Assignee: nobody → jorendorff

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1330769#a384_451704)• 8 years ago |

[tracking-firefox51](/buglist.cgi?f1=cf_tracking_firefox51&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox51&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox51&o1=equals&v1=%2B)
[tracking-firefox52](/buglist.cgi?f1=cf_tracking_firefox52&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox52&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox52&o1=equals&v1=%2B)
[tracking-firefox53](/buglist.cgi?f1=cf_tracking_firefox53&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox53&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox53&o1=equals&v1=%2B)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1330769#c1)• 8 years ago |
|  | |

Marking this blocking 51 release for now, to make sure we follow up -- because we landed a bunch of work for [bug 1312001](/show_bug.cgi?id=1312001 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set") and I'm not sure what we have left still to fix or what the security risks there are.
[tracking-firefox51](/buglist.cgi?f1=cf_tracking_firefox51&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox51&o1=equals&v1=%2B) → [blocking](/buglist.cgi?f1=cf_tracking_firefox51&o1=equals&v1=blocking)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1330769#c2)• 8 years ago |
|  | |

Attached patch

[ASLR leak via pointer scrambling in ShapeTable](attachment.cgi?id=8826338&action=diff) (obsolete)
— [Details](attachment.cgi?id=8826338&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1330769&attachment=8826338)

[Attachment #8826338](/attachment.cgi?id=8826338&action=edit "ASLR leak via pointer scrambling in ShapeTable") -
Flags: review?(jdemooij)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1330769#c3)• 8 years ago |
|  | |

Comment on [attachment 8826338](/attachment.cgi?id=8826338 "ASLR leak via pointer scrambling in ShapeTable") [[details]](/attachment.cgi?id=8826338&action=edit "ASLR leak via pointer scrambling in ShapeTable") [[diff]](/attachment.cgi?id=8826338&action=diff "ASLR leak via pointer scrambling in ShapeTable") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1330769&attachment=8826338)
ASLR leak via pointer scrambling in ShapeTable
Review of [attachment 8826338](/attachment.cgi?id=8826338 "ASLR leak via pointer scrambling in ShapeTable") [[details]](/attachment.cgi?id=8826338&action=edit "ASLR leak via pointer scrambling in ShapeTable") [[diff]](/attachment.cgi?id=8826338&action=diff "ASLR leak via pointer scrambling in ShapeTable") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1330769&attachment=8826338):
-----------------------------------------------------------------
Looks good, but we also have to fix HashId for this to work. Something like:
if (JSID\_IS\_SYMBOL(id))
return JSID\_TO\_SYMBOL(id)->hash();
::: js/src/jscntxt.cpp
@@ +1076,5 @@
> compartment\_->mark();
> }
>
> +HashNumber
> +JSContext::randomHashCode() {
Nit: { on next line
[Attachment #8826338](/attachment.cgi?id=8826338&action=edit "ASLR leak via pointer scrambling in ShapeTable") -
Flags: review?(jdemooij) → review+

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1330769#c4)• 8 years ago |
|  | |

(In reply to Jan de Mooij [:jandem] from [comment #3](/show_bug.cgi?id=1330769#c3 "RESOLVED FIXED - ASLR leak via pointer scrambling in ShapeTable"))
> Looks good, but we also have to fix HashId
While you're there, would you mind adding a brief comment explaining why we do this? I didn't add it initially to avoid drawing attention, but there are similar comments elsewhere now and it's pretty obvious from the patch.

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1330769#c5)• 8 years ago |
|  | |

Attached patch

[Avoid using Symbol addresses in hash codes](attachment.cgi?id=8826742&action=diff)
— [Details](attachment.cgi?id=8826742&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1330769&attachment=8826742)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1330769#a89624_281791)• 8 years ago |

[Attachment #8826338](/attachment.cgi?id=8826338&action=edit "ASLR leak via pointer scrambling in ShapeTable") -
Attachment is obsolete: true

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1330769#c6)• 8 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=ecfa3a8aaaaf>

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1330769#c7)• 8 years ago |
|  | |

Comment on [attachment 8826742](/attachment.cgi?id=8826742 "Avoid using Symbol addresses in hash codes") [[details]](/attachment.cgi?id=8826742&action=edit "Avoid using Symbol addresses in hash codes") [[diff]](/attachment.cgi?id=8826742&action=diff "Avoid using Symbol addresses in hash codes") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1330769&attachment=8826742)
Avoid using Symbol addresses in hash codes
I changed some dumb little details about how this worked:
\* addressed [comment 3](/show_bug.cgi?id=1330769#c3 "RESOLVED FIXED - ASLR leak via pointer scrambling in ShapeTable") and [comment 4](/show_bug.cgi?id=1330769#c4 "RESOLVED FIXED - ASLR leak via pointer scrambling in ShapeTable")
\* fixing HashId to use Symbol::hash() required moving it to another file
\* moved the randomHashCode() method to JSCompartment
\* backtracked on Symbol::new\_() having an extra HashNumber argument;
now it generates a random hash code itself, instead.
This means the well-known symbols no longer get constant hash codes.
Still, the patch is essentially the same, so carrying forward jandem's r+.
[Attachment #8826742](/attachment.cgi?id=8826742&action=edit "Avoid using Symbol addresses in hash codes") -
Flags: review+

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1330769#c8)• 8 years ago |
|  | |

Comment on [attachment 8826742](/attachment.cgi?id=8826742 "Avoid using Symbol addresses in hash codes") [[details]](/attachment.cgi?id=8826742&action=edit "Avoid using Symbol addresses in hash codes") [[diff]](/attachment.cgi?id=8826742&action=diff "Avoid using Symbol addresses in hash codes") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1330769&attachment=8826742)
Avoid using Symbol addresses in hash codes
> [Security approval request comment]
> How easily could an exploit be constructed based on the patch?
Worst-case here would be discovering a Symbol's address, and I think that would be easy for anyone who knew vm/Shape.h well enough.
> Do comments in the patch, the check-in comment, or tests included in the
> patch paint a bulls-eye on the security problem?
Yes.
> Which older supported branches are affected by this flaw?
All. I think this bug existed in hg revision 1.
> Do you have backports for the affected branches? If not, how different,
> hard to create, and risky will they be?
No. Very easy.
> How likely is this patch to cause regressions; how much testing does it
> need?
Very unlikely. Ordinary automated testing is sufficient.
[Attachment #8826742](/attachment.cgi?id=8826742&action=edit "Avoid using Symbol addresses in hash codes") -
Flags: sec-approval?

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1330769#c9)• 8 years ago |
|  | |

> I think this bug existed in hg revision 1.
To clarify: the exact problems in hg revision 1 were already fixed in [bug 1317936](/show_bug.cgi?id=1317936 "RESOLVED FIXED - Fix cross-origin information leak from shared atoms"). Symbols didn't exist back then. But this bug is as old as symbols -- definitely all supported branches are affected.

|  | [Ritu Kothari (:ritu) (Inactive, please n-i to RyanVM, jcristau, or pascal)](/user_profile?user_id=538805) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1330769#c10)• 8 years ago |
|  | |

Hi Al, Dan, do you think we might be able to get this one landed before we gtb RC2 (later this week but as early as tomm)? Thanks!Flags: needinfo?(dveditz)Flags: needinfo?(abillings)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1330769#c11)• 8 years ago |
|  | |

FWIW, looks like this'll need a bit of rebasing for uplifts.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1330769#c12)• 8 years ago |
|  | |

(In reply to Ritu Kothari (:ritu) from [comment #10](/show_bug.cgi?id=1330769#c10 "RESOLVED FIXED - ASLR leak via pointer scrambling in ShapeTable"))
> Hi Al, Dan, do you think we might be able to get this one landed before we
> gtb RC2 (later this week but as early as tomm)? Thanks!
I'm happy to give it sec-approval+ if you want to take it for RC2.Flags: needinfo?(abillings) → needinfo?(rkothari)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1330769#c13)• 8 years ago |
|  | |

Giving sec-approval+ after talking to Liz.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1330769#a427509_280903)• 8 years ago |

[Attachment #8826742](/attachment.cgi?id=8826742&action=edit "Avoid using Symbol addresses in hash codes") -
Flags: sec-approval? → sec-approval+

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1330769#c14)• 8 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/26ed78caca3d0ffa819c31f066cfc5d03dde7a95>
[Bug 1330769](/show_bug.cgi?id=1330769 "RESOLVED FIXED - ASLR leak via pointer scrambling in ShapeTable") - Avoid using Symbol addresses in hash codes. r=jandem.

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1330769#c15)• 8 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=38f32daf0f51>

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1330769#c16)• 8 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=46b1b668dfbf>

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1330769#c17)• 8 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=3a45e844c455>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1330769#a433893_1689)• 8 years ago |

Flags: needinfo?(dveditz)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1330769#c18)• 8 years ago |
|  | |

Attached patch

[Avoid using Symbol addresses in hash codes (aurora)](attachment.cgi?id=8827629&action=diff)
— [Details](attachment.cgi?id=8827629&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1330769&attachment=8827629)

MozReview-Commit-ID: 9kllbUYaXLv

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1330769#c19)• 8 years ago |
|  | |

Attached patch

[Avoid using Symbol addresses in hash codes (beta)](attachment.cgi?id=8827630&action=diff)
— [Details](attachment.cgi?id=8827630&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1330769&attachment=8827630)

MozReview-Commit-ID: 9kllbUYaXLv

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1330769#c20)• 8 years ago |
|  | |

Attached patch

[Avoid using Symbol addresses in hash codes (release)](attachment.cgi?id=8827631&action=diff)
— [Details](attachment.cgi?id=8827631&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1330769&attachment=8827631)

MozReview-Commit-ID: 9kllbUYaXLv

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1330769#c21)• 8 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=7ef4ba6401f9>

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1330769#c22)• 8 years ago |
|  | |

Comment on [attachment 8827629](/attachment.cgi?id=8827629 "Avoid using Symbol addresses in hash codes (aurora)") [[details]](/attachment.cgi?id=8827629&action=edit "Avoid using Symbol addresses in hash codes (aurora)") [[diff]](/attachment.cgi?id=8827629&action=diff "Avoid using Symbol addresses in hash codes (aurora)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1330769&attachment=8827629)
Avoid using Symbol addresses in hash codes (aurora)
Approval Request Comment
[Feature/Bug causing the regression]: [bug 645416](/show_bug.cgi?id=645416 "RESOLVED FIXED - Implement symbols") (but really the underlying issue is ancient)
[User impact if declined]: sec-high risk
[Is this code covered by automated tests?]: yes
[Has the fix been verified in Nightly?]: yes
[Needs manual test from QE? If yes, steps to reproduce]: no
[List of other uplifts needed for the feature/fix]: beta, release, esr45
[Is the change risky?]: no
[Why is the change risky/not risky?]: small, fairly superficial changes to how Symbols are created
[String changes made/needed]: none
[Attachment #8827629](/attachment.cgi?id=8827629&action=edit "Avoid using Symbol addresses in hash codes (aurora)") -
Attachment description: Avoid using Symbol addresses in hash codes → Avoid using Symbol addresses in hash codes (aurora)
[Attachment #8827629](/attachment.cgi?id=8827629&action=edit "Avoid using Symbol addresses in hash codes (aurora)") -
Flags: approval-mozilla-aurora?

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1330769#c23)• 8 years ago |
|  | |

Comment on [attachment 8827630](/attachment.cgi?id=8827630 "Avoid using Symbol addresses in hash codes (beta)") [[details]](/attachment.cgi?id=8827630&action=edit "Avoid using Symbol addresses in hash codes (beta)") [[diff]](/attachment.cgi?id=8827630&action=diff "Avoid using Symbol addresses in hash codes (beta)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1330769&attachment=8827630)
Avoid using Symbol addresses in hash codes (beta)
see [comment 22](/show_bug.cgi?id=1330769#c22 "RESOLVED FIXED - ASLR leak via pointer scrambling in ShapeTable")
[Attachment #8827630](/attachment.cgi?id=8827630&action=edit "Avoid using Symbol addresses in hash codes (beta)") -
Attachment description: Avoid using Symbol addresses in hash codes → Avoid using Symbol addresses in hash codes (beta)
[Attachment #8827630](/attachment.cgi?id=8827630&action=edit "Avoid using Symbol addresses in hash codes (beta)") -
Flags: approval-mozilla-beta?

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1330769#c24)• 8 years ago |
|  | |

Comment on [attachment 8827631](/attachment.cgi?id=8827631 "Avoid using Symbol addresses in hash codes (release)") [[details]](/attachment.cgi?id=8827631&action=edit "Avoid using Symbol addresses in hash codes (release)") [[diff]](/attachment.cgi?id=8827631&action=diff "Avoid using Symbol addresses in hash codes (release)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1330769&attachment=8827631)
Avoid using Symbol addresses in hash codes (release)
see [comment 22](/show_bug.cgi?id=1330769#c22 "RESOLVED FIXED - ASLR leak via pointer scrambling in ShapeTable")
[Attachment #8827631](/attachment.cgi?id=8827631&action=edit "Avoid using Symbol addresses in hash codes (release)") -
Attachment description: Avoid using Symbol addresses in hash codes → Avoid using Symbol addresses in hash codes (release)
[Attachment #8827631](/attachment.cgi?id=8827631&action=edit "Avoid using Symbol addresses in hash codes (release)") -
Flags: approval-mozilla-release?

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1330769#c25)• 8 years ago |
|  | |

Attached patch

[Avoid using Symbol addresses in hash codes (esr45)](attachment.cgi?id=8827634&action=diff)
— [Details](attachment.cgi?id=8827634&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1330769&attachment=8827634)

MozReview-Commit-ID: 9kllbUYaXLv

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1330769#c26)• 8 years ago |
|  | |

Comment on [attachment 8827634](/attachment.cgi?id=8827634 "Avoid using Symbol addresses in hash codes (esr45)") [[details]](/attachment.cgi?id=8827634&action=edit "Avoid using Symbol addresses in hash codes (esr45)") [[diff]](/attachment.cgi?id=8827634&action=diff "Avoid using Symbol addresses in hash codes (esr45)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1330769&attachment=8827634)
Avoid using Symbol addresses in hash codes (esr45)
[Approval Request Comment]
If this is not a sec:{high,crit} bug, please state case for ESR consideration:
it's sec:high
User impact if declined:
sec:high risk
Fix Landed on Version:
ff50 (current m-c)
Risk to taking this patch (and alternatives if risky):
low risk of bugs involving symbols
String or UUID changes made by this patch:
none
[Attachment #8827634](/attachment.cgi?id=8827634&action=edit "Avoid using Symbol addresses in hash codes (esr45)") -
Attachment description: Avoid using Symbol addresses in hash codes → Avoid using Symbol addresses in hash codes (esr45)
[Attachment #8827634](/attachment.cgi?id=8827634&action=edit "Avoid using Symbol addresses in hash codes (esr45)") -
Flags: approval-mozilla-esr45?

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1330769#a447714_451704)• 8 years ago |

[Attachment #8827629](/attachment.cgi?id=8827629&action=edit "Avoid using Symbol addresses in hash codes (aurora)") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1330769#a447827_451704)• 8 years ago |

[Attachment #8827630](/attachment.cgi?id=8827630&action=edit "Avoid using Symbol addresses in hash codes (beta)") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1330769#a447852_451704)• 8 years ago |

[Attachment #8827634](/attachment.cgi?id=8827634&action=edit "Avoid using Symbol addresses in hash codes (esr45)") -
Flags: approval-mozilla-esr45? → approval-mozilla-esr45+

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1330769#c27)• 8 years ago |
|  | |

Comment on [attachment 8827631](/attachment.cgi?id=8827631 "Avoid using Symbol addresses in hash codes (release)") [[details]](/attachment.cgi?id=8827631&action=edit "Avoid using Symbol addresses in hash codes (release)") [[diff]](/attachment.cgi?id=8827631&action=diff "Avoid using Symbol addresses in hash codes (release)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1330769&attachment=8827631)
Avoid using Symbol addresses in hash codes (release)
For the RC2 build.
[Attachment #8827631](/attachment.cgi?id=8827631&action=edit "Avoid using Symbol addresses in hash codes (release)") -
Flags: approval-mozilla-release? → approval-mozilla-release+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935)  Reporter |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1330769#c28)• 8 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/417ac0789e97>
<https://hg.mozilla.org/releases/mozilla-beta/rev/c5b999111882>
<https://hg.mozilla.org/releases/mozilla-release/rev/c5b999111882>
<https://hg.mozilla.org/releases/mozilla-esr45/rev/747085a1cd93>
[status-firefox51](/buglist.cgi?f1=cf_status_firefox51&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=fixed)
[status-firefox52](/buglist.cgi?f1=cf_status_firefox52&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=fixed)
[status-firefox-esr45](/buglist.cgi?f1=cf_status_firefox_esr45&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935)  Reporter |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1330769#c29)• 8 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/26ed78caca3d>Status: NEW → RESOLVEDClosed: 8 years ago
[status-firefox53](/buglist.cgi?f1=cf_status_firefox53&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox53&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox53&o1=equals&v1=fixed)Flags: needinfo?(rkothari)Resolution: --- → FIXEDTarget Milestone: --- → mozilla53

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1330769#a613056_280903)• 8 years ago |

Alias: CVE-2017-5397
[tracking-firefox-esr45](/buglist.cgi?f1=cf_tracking_firefox_esr45&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr45&o1=equals&v1=%3F) → [51+](/buglist.cgi?f1=cf_tracking_firefox_esr45&o1=equals&v1=51%2B)Whiteboard: Disclosure date ~Jan 21 2017 (note Fx51 scheduled for Jan 24) → [adv-main51+][adv-esr45.7+] Disclosure date ~Jan 21 2017 (note Fx51 scheduled for Jan 24)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1330769#a620652_1689)• 8 years ago |

Group: javascript-core-security → core-security-release

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1330769#a702465_280903)• 8 years ago |

Alias: CVE-2017-5397

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1330769#a19698585_1689)• 7 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1330769&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from wiki.mozilla.org_3659d679_20250126_073135.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from wiki.mozilla.org_73f8d6fa_20250126_073135.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from www.mozilla.org_cb308383_20250125_082013.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2017-01

## Security vulnerabilities fixed in Firefox 51

Announced
January 24, 2017
Impact
critical
Products
Firefox
Fixed in

* Firefox 51

#### [#CVE-2017-5375: Excessive JIT code allocation allows bypass of ASLR and DEP](#CVE-2017-5375)

Reporter
Rh0
Impact
critical
##### Description

JIT code allocation can allow for a bypass of ASLR and DEP protections leading to potential memory corruption attacks.

##### References

* [Bug 1325200](https://bugzilla.mozilla.org/show_bug.cgi?id=1325200)

#### [#CVE-2017-5376: Use-after-free in XSL](#CVE-2017-5376)

Reporter
Nicolas Grégoire
Impact
critical
##### Description

Use-after-free while manipulating XSL in XSLT documents

##### References

* [Bug 1311687](https://bugzilla.mozilla.org/show_bug.cgi?id=1311687)

#### [#CVE-2017-5377: Memory corruption with transforms to create gradients in Skia](#CVE-2017-5377)

Reporter
Atte Kettunen
Impact
critical
##### Description

A memory corruption vulnerability in Skia that can occur when using transforms to make gradients, resulting in a potentially exploitable crash.

##### References

* [Bug 1306883](https://bugzilla.mozilla.org/show_bug.cgi?id=1306883)

#### [#CVE-2017-5378: Pointer and frame data leakage of Javascript objects](#CVE-2017-5378)

Reporter
Jann Horn
Impact
high
##### Description

Hashed codes of JavaScript objects are shared between pages. This allows for pointer leaks because an object’s address can be discovered through hash codes, and also allows for data leakage of an object’s content using these hash codes.

##### References

* [Bug 1312001](https://bugzilla.mozilla.org/show_bug.cgi?id=1312001)
* [Bug 1330769](https://bugzilla.mozilla.org/show_bug.cgi?id=1330769)

#### [#CVE-2017-5379: Use-after-free in Web Animations](#CVE-2017-5379)

Reporter
Nils
Impact
high
##### Description

Use-after-free vulnerability in Web Animations when interacting with cycle collection found through fuzzing.

##### References

* [Bug 1309198](https://bugzilla.mozilla.org/show_bug.cgi?id=1309198)

#### [#CVE-2017-5380: Potential use-after-free during DOM manipulations](#CVE-2017-5380)

Reporter
Nils
Impact
high
##### Description

A potential use-after-free found through fuzzing during DOM manipulation of SVG content.

##### References

* [Bug 1322107](https://bugzilla.mozilla.org/show_bug.cgi?id=1322107)

#### [#CVE-2017-5390: Insecure communication methods in Developer Tools JSON viewer](#CVE-2017-5390)

Reporter
Jerri Rice
Impact
high
##### Description

The JSON viewer in the Developer Tools uses insecure methods to create a communication channel for copying and viewing JSON or HTTP headers data, allowing for potential privilege escalation.

##### References

* [Bug 1297361](https://bugzilla.mozilla.org/show_bug.cgi?id=1297361)

#### [#CVE-2017-5389: WebExtensions can install additional add-ons via modified host requests](#CVE-2017-5389)

Reporter
Kris Maglione
Impact
high
##### Description

WebExtensions could use the `mozAddonManager` API by modifying the CSP headers on sites with the appropriate permissions and then using host requests to redirect script loads to a malicious site. This allows a malicious extension to then install additional extensions without explicit user permission.

##### References

* [Bug 1308688](https://bugzilla.mozilla.org/show_bug.cgi?id=1308688)

#### [#CVE-2017-5396: Use-after-free with Media Decoder](#CVE-2017-5396)

Reporter
Filipe Gomes
Impact
high
##### Description

A use-after-free vulnerability in the Media Decoder when working with media files when some events are fired after the media elements are freed from memory.

##### References

* [Bug 1329403](https://bugzilla.mozilla.org/show_bug.cgi?id=1329403)

#### [#CVE-2017-5381: Certificate Viewer exporting can be used to navigate and save to arbitrary filesystem locations](#CVE-2017-5381)

Reporter
Jann Horn
Impact
moderate
##### Description

The "export" function in the Certificate Viewer can force local filesystem navigation when the "common name" in a certificate contains slashes, allowing certificate content to be saved in unsafe locations with an arbitrary filename.

##### References

* [Bug 1017616](https://bugzilla.mozilla.org/show_bug.cgi?id=1017616)

#### [#CVE-2017-5382: Feed preview can expose privileged content errors and exceptions](#CVE-2017-5382)

Reporter
Jerri Rice
Impact
moderate
##### Description

Feed preview for RSS feeds can be used to capture errors and exceptions generated by privileged content, allowing for the exposure of internal information not meant to be seen by web content.

##### References

* [Bug 1295322](https://bugzilla.mozilla.org/show_bug.cgi?id=1295322)

#### [#CVE-2017-5383: Location bar spoofing with unicode characters](#CVE-2017-5383)

Reporter
Armin Ebert
Impact
moderate
##### Description

URLs containing certain unicode glyphs for alternative hyphens and quotes do not properly trigger punycode display, allowing for domain name spoofing attacks in the location bar.

##### References

* [Bug 1323338](https://bugzilla.mozilla.org/show_bug.cgi?id=1323338)
* [Bug 1324716](https://bugzilla.mozilla.org/show_bug.cgi?id=1324716)

#### [#CVE-2017-5384: Information disclosure via Proxy Auto-Config (PAC)](#CVE-2017-5384)

Reporter
Paul Stone, Alex Chapman
Impact
moderate
##### Description

Proxy Auto-Config (PAC) files can specify a JavaScript function called for all URL requests with the full URL path which exposes more information than would be sent to the proxy itself in the case of HTTPS. Normally the Proxy Auto-Config file is specified by the user or machine owner and presumed to be non-malicious, but if a user has enabled Web Proxy Auto Detect (WPAD) this file can be served remotely.

##### References

* [Bug 1255474](https://bugzilla.mozilla.org/show_bug.cgi?id=1255474)
* [Sniffing HTTPS URLS with malicious PAC files](https://www.contextis.com//resources/blog/leaking-https-urls-20-year-old-vulnerability/)

#### [#CVE-2017-5385: Data sent in multipart channels ignores referrer-policy response headers](#CVE-2017-5385)

Reporter
Muneaki Nishimura
Impact
moderate
##### Description

Data sent with in multipart channels, such as the multipart/x-mixed-replace MIME type, will ignore the referrer-policy response header, leading to potential information disclosure for sites using this header.

##### References

* [Bug 1295945](https://bugzilla.mozilla.org/show_bug.cgi?id=1295945)

#### [#CVE-2017-5386: WebExtensions can use data: protocol to affect other extensions](#CVE-2017-5386)

Reporter
Muneaki Nishimura
Impact
moderate
##### Description

WebExtension scripts can use the `data:` protocol to affect pages loaded by other web extensions using this protocol, leading to potential data disclosure or privilege escalation in affected extensions.

##### References

* [Bug 1319070](https://bugzilla.mozilla.org/show_bug.cgi?id=1319070)

#### [#CVE-2017-5394: Android location bar spoofing using fullscreen and JavaScript events](#CVE-2017-5394)

Reporter
Jordi Chancel
Impact
moderate
##### Description

A location bar spoofing attack where the location bar of loaded page will be shown over the content of another tab due to a series of JavaScript events combined with fullscreen mode.
*Note: This issue only affects Firefox for Android. Other operating systems are not affected.*

##### References

* [Bug 1222798](https://bugzilla.mozilla.org/show_bug.cgi?id=1222798)

#### [#CVE-2017-5391: Content about: pages can load privileged about: pages](#CVE-2017-5391)

Reporter
Jerri Rice
Impact
moderate
##### Description

Special `about:` pages used by web content, such as RSS feeds, can load privileged `about:` pages in an iframe. If a content-injection bug were found in one of those pages this could allow for potential privilege escalation.

##### References

* [Bug 1309310](https://bugzilla.mozilla.org/show_bug.cgi?id=1309310)

#### [#CVE-2017-5392: Weak references using multiple threads on weak proxy objects lead to unsafe memory usage](#CVE-2017-5392)

Reporter
Honza Bambas
Impact
moderate
##### Description

Weak proxy objects have weak references on multiple threads when they should only have them on one, resulting in incorrect memory usage and corruption, which leads to potentially exploitable crashes.
*Note: This issue only affects Firefox for Android. Other operating systems are not affected.*

##### References

* [Bug 1293709](https://bugzilla.mozilla.org/show_bug.cgi?id=1293709)

#### [#CVE-2017-5393: Remove addons.mozilla.org CDN from whitelist for mozAddonManager](#CVE-2017-5393)

Reporter
Stuart Colville
Impact
moderate
##### Description

The `mozAddonManager` allows for the installation of extensions from the CDN for addons.mozilla.org, a publicly accessible site. This could allow malicious extensions to install additional extensions from the CDN in combination with an XSS attack on Mozilla AMO sites.

##### References

* [Bug 1309282](https://bugzilla.mozilla.org/show_bug.cgi?id=1309282)

#### [#CVE-2017-5395: Android location bar spoofing during scrolling](#CVE-2017-5395)

Reporter
Jordi Chancel
Impact
low
##### Description

Malicious sites can display a spoofed location bar on a subsequently loaded page when the existing location bar on the new page is scrolled out of view if navigations between pages can be timed correctly.
*Note: This issue only affects Firefox for Android. Other operating systems are not affected.*

##### References

* [Bug 1293463](https://bugzilla.mozilla.org/show_bug.cgi?id=1293463)

#### [#CVE-2017-5387: Disclosure of local file existence through TRACK tag error messages](#CVE-2017-5387)

Reporter
Mustafa Hasan
Impact
low
##### Description

The existence of a specifically requested local file can be found due to the double firing of the `onerror` when the `source` attribute on a `<track>` tag refers to a file that does not exist if the source page is loaded locally.

##### References

* [Bug 1295023](https://bugzilla.mozilla.org/show_bug.cgi?id=1295023)

#### [#CVE-2017-5388: WebRTC can be used to generate a large amount of UDP traffic for DDOS attacks](#CVE-2017-5388)

Reporter
Cullen Jennings
Impact
low
##### Description

A STUN server in conjunction with a large number of `webkitRTCPeerConnection` objects can be used to send large STUN packets in a short period of time due to a lack of rate limiting being applied on e10s systems, allowing for a denial of service attack.

##### References

* [Bug 1281482](https://bugzilla.mozilla.org/show_bug.cgi?id=1281482)

#### [#CVE-2017-5374: Memory safety bugs fixed in Firefox 51](#CVE-2017-5374)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Gary Kwong, Olli Pettay, Tooru Fujisawa, Carsten Book, Andrew McCreight, Chris Pearce, Ronald Crane, Jan de Mooij, Julian Seward, Nicolas Pierron, Randell Jesup, Esther Monchari, Honza Bambas, and Philipp reported memory safety bugs present in Firefox 50.1. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 51](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1325344%2C1317501%2C1311319%2C1329989%2C1300145%2C1322305%2C1288561%2C1295747%2C1318766%2C1297808%2C1321374%2C1324810%2C1313385%2C1319888%2C1302231%2C1307458%2C1293327%2C1315447%2C1319456)

#### [#CVE-2017-5373: Memory safety bugs fixed in Firefox 51 and Firefox ESR 45.7](#CVE-2017-5373)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Christian Holler, Gary Kwong, André Bargull, Jan de Mooij, Tom Schuster, and Oriol reported memory safety bugs present in Firefox 50.1 and Firefox ESR 45.6. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 51 and Firefox ESR 45.7](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1322315%2C1328834%2C1322420%2C1285833%2C1285960%2C1328251%2C1331058%2C1325938%2C1325877)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_c9889f7d_20250125_082013.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1309198)
* [XML](/show_bug.cgi?ctype=xml&id=1309198)

Closed
[Bug 1309198](/show_bug.cgi?id=1309198)
(CVE-2017-5379)

Opened 8 years ago
Closed 8 years ago

# heap-use-after-free in mozilla::dom::Element::GetAnimations

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

heap-use-after-free in mozilla::dom::Element::GetAnimations

## Categories

### (Core :: DOM: Animation, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Animation#DOM%3A%20Animation)

DOM: Animation
▾

Core :: DOM: Animation
This component covers the [Web Animations](https://w3c.github.io/web-animations/) implementation in Gecko.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Animation&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Animation&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Animation)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla52

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox49 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox49&o1=equals&v1=wontfix) |
| firefox-esr45 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=unaffected) |
| firefox50 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=wontfix) |
| firefox51 | [+](/buglist.cgi?f1=cf_tracking_firefox51&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=fixed) |
| firefox52 | [+](/buglist.cgi?f1=cf_tracking_firefox52&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox49 |  | wontfix |
| firefox-esr45 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox50 |  | wontfix |
| firefox51 | + | fixed |
| firefox52 | + | fixed |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: nils, Assigned: hiro)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/9ec516861853d265a973cd0ef66735cf?d=mm&size=40)  [hiro](/user_profile?user_id=131213)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/1ac8e01cc88bca015e51fbd49a0b2df5?d=mm&size=40)  [nils](/user_profile?user_id=344130)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/8a1a07330c4b233b669577673bc47748?d=mm&size=40)  [boris](/user_profile?user_id=500786)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

11 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1212720](/show_bug.cgi?id=1212720 "RESOLVED FIXED - Move getAnimations() from AnimationTimeline to Document")

Dependency [tree](/showdependencytree.cgi?id=1309198&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1309198)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [post-critsmash-triage][adv-main51+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2017-5379

[Keywords:](/describekeywords.cgi)

[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[post-critsmash-triage][adv-main51+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a2358822_1689 "8 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [in-testsuite](#a2358822_1689 "8 years ago") | ? |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | in-testsuite | ? |
| --- | --- | --- |
| [mwobensmith](/user_profile?user_id=452604) | [qe-verify](#a7791516_452604 "8 years ago") | + |
| --- | --- | --- |
| [mwobensmith](/user_profile?user_id=452604) | qe-verify | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files, 2 obsolete files)

| [crash.html minimized testcase: requires Jesse's dom fuzzing addon](/attachment.cgi?id=8799713)  [8 years ago](#c0)  [Nils](/user_profile?user_id=344130)   1.32 KB, text/html |  | [Details](/attachment.cgi?id=8799713&action=edit) |
| --- | --- | --- |
| [Automation test case](/attachment.cgi?id=8800483)  [8 years ago](#c5)  [Hiroyuki Ikezoe (:hiro)](/user_profile?user_id=131213)   2.45 KB, patch |  | [Details](/attachment.cgi?id=8800483&action=edit) | [Diff](/attachment.cgi?id=8800483&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1309198&attachment=8800483) |
| [Hold a strong ref of the element for Element::GetAnimations](/attachment.cgi?id=8801682)  [8 years ago](#c10)  [Hiroyuki Ikezoe (:hiro)](/user_profile?user_id=131213)   1.87 KB, patch | smaug : [review+](#c11 "8 years ago") | [Details](/attachment.cgi?id=8801682&action=edit) | [Diff](/attachment.cgi?id=8801682&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1309198&attachment=8801682) |
| [Hold a strong ref of the element for Element::GetAnimations](/attachment.cgi?id=8801687)  [8 years ago](#c12)  [Hiroyuki Ikezoe (:hiro)](/user_profile?user_id=131213)   1.90 KB, patch | hiro : [review+](#c12 "8 years ago")  gchang : [approval-mozilla-aurora+](#c19 "8 years ago")  abillings : [sec-approval+](#a627964_280903 "8 years ago") | [Details](/attachment.cgi?id=8801687&action=edit) | [Diff](/attachment.cgi?id=8801687&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1309198&attachment=8801687) |
| [A crashtest](/attachment.cgi?id=8818656)  [8 years ago](#c26)  [Hiroyuki Ikezoe (:hiro)](/user_profile?user_id=131213)   2.54 KB, patch | smaug : [review+](#c27 "8 years ago") | [Details](/attachment.cgi?id=8818656&action=edit) | [Diff](/attachment.cgi?id=8818656&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1309198&attachment=8818656) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Nils](/user_profile?user_id=344130)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1309198#c0)• 8 years ago |
|  | |

Attached file
[crash.html minimized testcase: requires Jesse's dom fuzzing addon](attachment.cgi?id=8799713)
— [Details](attachment.cgi?id=8799713&action=edit)

The attached testcases crashes the latest ASAN build of Firefox (BuildID=20161010095556) as follows. It requires Jesse's fuzzPriv extension to reproduce reliably.
ASAN output:
=================================================================
==936==ERROR: AddressSanitizer: heap-use-after-free on address 0x60f0000a6318 at pc 0x7f16979d2e9f bp 0x7ffc3623fcb0 sp 0x7ffc3623fca8
READ of size 4 at 0x60f0000a6318 thread T0 (Web Content)
#0 0x7f16979d2e9e in HasFlag /home/worker/workspace/build/src/dom/base/nsWrapperCache.h:210:15
#1 0x7f16979d2e9e in IsRootOfNativeAnonymousSubtree /home/worker/workspace/build/src/dom/base/nsIContent.h:174
#2 0x7f16979d2e9e in IsGeneratedContentContainerForBefore /home/worker/workspace/build/src/dom/base/nsIContent.h:332
#3 0x7f16979d2e9e in mozilla::dom::Element::GetAnimations(mozilla::dom::AnimationFilter const&, nsTArray<RefPtr<mozilla::dom::Animation> >&) /home/worker/workspace/build/src/dom/base/Element.cpp:3460
#4 0x7f1697bb046b in nsDocument::GetAnimations(nsTArray<RefPtr<mozilla::dom::Animation> >&) /home/worker/workspace/build/src/dom/base/nsDocument.cpp:3032:3
#5 0x7f169956d2c8 in mozilla::dom::DocumentBinding::getAnimations(JSContext\*, JS::Handle<JSObject\*>, nsIDocument\*, JSJitMethodCallArgs const&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/DocumentBinding.cpp:4247:3
#6 0x7f16999f6460 in mozilla::dom::GenericBindingMethod(JSContext\*, unsigned int, JS::Value\*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2825:13
#7 0x7f169fc301a5 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15
#8 0x7f169fc301a5 in js::InternalCallOrConstruct(JSContext\*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:446
#9 0x7f169fc30e52 in js::Call(JSContext\*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:522:10
#10 0x7f169fa519bc in js::Wrapper::call(JSContext\*, JS::Handle<JSObject\*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12
#11 0x7f169f99b92f in js::CrossCompartmentWrapper::call(JSContext\*, JS::Handle<JSObject\*>, JS::CallArgs const&) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:333:14
#12 0x7f169f9a9c6f in js::Proxy::call(JSContext\*, JS::Handle<JSObject\*>, JS::CallArgs const&) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:400:12
#13 0x7f169f9ac62e in js::proxy\_Call(JSContext\*, unsigned int, JS::Value\*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:689:12
#14 0x7f169fc301a5 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15
#15 0x7f169fc301a5 in js::InternalCallOrConstruct(JSContext\*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:446
#16 0x7f169fc10956 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:509:12
#17 0x7f169fc10956 in Interpret(JSContext\*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922
#18 0x7f169fbf5c5b in js::RunScript(JSContext\*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:404:12
#19 0x7f169fc3080f in js::InternalCallOrConstruct(JSContext\*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:476:15
#20 0x7f169fc30e52 in js::Call(JSContext\*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:522:10
#21 0x7f169f7358cd in JS::Call(JSContext\*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2825:12
#22 0x7f1699527852 in mozilla::dom::EventHandlerNonNull::Call(JSContext\*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:259:37
#23 0x7f1699e4ec41 in Call<nsISupports \*> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:361:12
#24 0x7f1699e4ec41 in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent\*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:214
#25 0x7f1699e1af44 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener\*, nsIDOMEvent\*, mozilla::dom::EventTarget\*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1133:16
#26 0x7f1699e1c50f in mozilla::EventListenerManager::HandleEventInternal(nsPresContext\*, mozilla::WidgetEvent\*, nsIDOMEvent\*\*, mozilla::dom::EventTarget\*, nsEventStatus\*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1286:17
#27 0x7f1699e06806 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback\*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:380:5
#28 0x7f1699e0a86d in mozilla::EventDispatcher::Dispatch(nsISupports\*, nsPresContext\*, mozilla::WidgetEvent\*, nsIDOMEvent\*, nsEventStatus\*, mozilla::EventDispatchingCallback\*, nsTArray<mozilla::dom::EventTarget\*>\*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:711:9
#29 0x7f169c080055 in nsDocumentViewer::LoadComplete(nsresult) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:998:7
#30 0x7f169cdfa1de in nsDocShell::EndPageLoad(nsIWebProgress\*, nsIChannel\*, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7615:5
#31 0x7f169cdf5fb4 in nsDocShell::OnStateChange(nsIWebProgress\*, nsIRequest\*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7415:7
#32 0x7f169cdfd57f in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress\*, nsIRequest\*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7312:13
#33 0x7f1696c786a0 in nsDocLoader::DoFireOnStateChange(nsIWebProgress\*, nsIRequest\*, int&, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1255:3
#34 0x7f1696c77668 in nsDocLoader::doStopDocumentLoad(nsIRequest\*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:840:5
#35 0x7f1696c7441c in nsDocLoader::DocLoaderIsEmpty(bool) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:730:9
#36 0x7f1696c764f4 in nsDocLoader::OnStopRequest(nsIRequest\*, nsISupports\*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:612:5
#37 0x7f1696c7707c in non-virtual thunk to nsDocLoader::OnStopRequest(nsIRequest\*, nsISupports\*, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:468:14
#38 0x7f1695012f8b in mozilla::net::nsLoadGroup::RemoveRequest(nsIRequest\*, nsISupports\*, nsresult) /home/worker/workspace/build/src/netwerk/base/nsLoadGroup.cpp:633:18
#39 0x7f1697bf360f in nsDocument::DoUnblockOnload() /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8625:7
#40 0x7f1697ccb9ff in nsUnblockOnloadEvent::Run() /home/worker/workspace/build/src/dom/base/nsDocument.cpp:8578:5
#41 0x7f1694e3939d in nsThread::ProcessNextEvent(bool, bool\*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1082:7
#42 0x7f1694eb8c1c in NS\_ProcessNextEvent(nsIThread\*, bool) /home/worker/workspace/build/src/xpcom/glue/nsThreadUtils.cpp:290:10
#43 0x7f1695c1660f in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate\*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21
#44 0x7f1695b883b8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message\_loop.cc:232:3
#45 0x7f1695b883b8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message\_loop.cc:225
#46 0x7f1695b883b8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message\_loop.cc:205
#47 0x7f169b7aa46f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3
#48 0x7f169d9012c7 in XRE\_RunAppShell /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:869:12
#49 0x7f1695b883b8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message\_loop.cc:232:3
#50 0x7f1695b883b8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message\_loop.cc:225
#51 0x7f1695b883b8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message\_loop.cc:205
#52 0x7f169d900803 in XRE\_InitChildProcess /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:701:7
#53 0x4dfb2b in content\_process\_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:197:19
#54 0x4dfb2b in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:392
#55 0x7f16b05b082f in \_\_libc\_start\_main /build/glibc-GKVZIf/glibc-2.23/csu/../csu/libc-start.c:291
#56 0x41ba08 in \_start (/home/nils/fuzzer3/firefox/firefox+0x41ba08)
0x60f0000a6318 is located 24 bytes inside of 176-byte region [0x60f0000a6300,0x60f0000a63b0)
freed by thread T0 (Web Content) here:
#0 0x4b215b in \_\_interceptor\_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan\_malloc\_linux.cc:38:3
#1 0x7f1694d13574 in SnowWhiteKiller::~SnowWhiteKiller() /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2665:9
#2 0x7f1694d13166 in nsCycleCollector::FreeSnowWhite(bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2840:3
#3 0x7f1694d1985c in nsCycleCollector::BeginCollection(ccType, nsICycleCollectorListener\*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3826:3
#4 0x7f1694d1903c in nsCycleCollector::Collect(ccType, js::SliceBudget&, nsICycleCollectorListener\*, bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3651:9
#5 0x7f1694d1c216 in nsCycleCollector\_collect(nsICycleCollectorListener\*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:4144:3
#6 0x7f1697cda939 in nsJSContext::CycleCollectNow(nsICycleCollectorListener\*, int) /home/worker/workspace/build/src/dom/base/nsJSEnvironment.cpp:1440:3
#7 0x7f169782615d in nsDOMWindowUtils::CycleCollect(nsICycleCollectorListener\*, int) /home/worker/workspace/build/src/dom/base/nsDOMWindowUtils.cpp:1338:3
#8 0x7f1694e5fe36 in NS\_InvokeByIndex /home/worker/workspace/build/src/xpcom/reflect/xptcall/md/unix/xptcinvoke\_x86\_64\_unix.cpp:180:23
#9 0x7f1696840cee in Invoke /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:2064:12
#10 0x7f1696840cee in Call /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1383
#11 0x7f1696840cee in XPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1350
#12 0x7f169684847b in XPC\_WN\_CallMethod(JSContext\*, unsigned int, JS::Value\*) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNativeJSOps.cpp:1143:12
#13 0x7f169fc301a5 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15
#14 0x7f169fc301a5 in js::InternalCallOrConstruct(JSContext\*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:446
#15 0x7f169fc10956 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:509:12
#16 0x7f169fc10956 in Interpret(JSContext\*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922
#17 0x7f169fbf5c5b in js::RunScript(JSContext\*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:404:12
#18 0x7f169fc3080f in js::InternalCallOrConstruct(JSContext\*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:476:15
#19 0x7f169fc30e52 in js::Call(JSContext\*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:522:10
#20 0x7f169f732fdd in JS\_CallFunctionValue(JSContext\*, JS::Handle<JSObject\*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2766:12
#21 0x7f1696779e2f in xpc::FunctionForwarder(JSContext\*, unsigned int, JS::Value\*) /home/worker/workspace/build/src/js/xpconnect/src/ExportHelpers.cpp:353:18
#22 0x7f169fc301a5 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15
#23 0x7f169fc301a5 in js::InternalCallOrConstruct(JSContext\*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:446
#24 0x7f169fc10956 in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:509:12
#25 0x7f169fc10956 in Interpret(JSContext\*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922
#26 0x7f169fbf5c5b in js::RunScript(JSContext\*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:404:12
#27 0x7f169fc3080f in js::InternalCallOrConstruct(JSContext\*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:476:15
#28 0x7f169fc30e52 in js::Call(JSContext\*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:522:10
#29 0x7f169f7358cd in JS::Call(JSContext\*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2825:12
#30 0x7f1699529925 in mozilla::dom::OnErrorEventHandlerNonNull::Call(JSContext\*, JS::Handle<JS::Value>, mozilla::dom::EventOrString const&, mozilla::dom::Optional<nsAString\_internal> const&, mozilla::dom::Optional<unsigned int> const&, mozilla::dom::Optional<unsigned int> const&, mozilla::dom::Optional<JS::Handle<JS::Value> > const&, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:389:37
#31 0x7f1699e4f6a0 in Call<nsISupports \*> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:527:12
#32 0x7f1699e4f6a0 in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent\*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:166
#33 0x7f1699e1af44 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener\*, nsIDOMEvent\*, mozilla::dom::EventTarget\*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1133:16
#34 0x7f1699e1c50f in mozilla::EventListenerManager::HandleEventInternal(nsPresContext\*, mozilla::WidgetEvent\*, nsIDOMEvent\*\*, mozilla::dom::EventTarget\*, nsEventStatus\*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1286:17
#35 0x7f1699e06806 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback\*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:380:5
#36 0x7f1699e0a86d in mozilla::EventDispatcher::Dispatch(nsISupports\*, nsPresContext\*, mozilla::WidgetEvent\*, nsIDOMEvent\*, nsEventStatus\*, mozilla::EventDispatchingCallback\*, nsTArray<mozilla::dom::EventTarget\*>\*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:711:9
previously allocated by thread T0 (Web Content) here:
#0 0x4b247b in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan\_malloc\_linux.cc:52:3
#1 0x4e0d6d in moz\_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17
#2 0x7f169a146183 in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12
#3 0x7f169a146183 in NS\_NewHTMLSharedElement(already\_AddRefed<mozilla::dom::NodeInfo>&&, mozilla::dom::FromParser) /home/worker/workspace/build/src/dom/html/HTMLSharedElement.cpp:23
#4 0x7f169c898598 in NS\_NewHTMLHtmlElement /home/worker/workspace/build/src/dom/html/nsGenericHTMLElement.h:1686:1
#5 0x7f169c898598 in nsContentDLF::CreateBlankDocument(nsILoadGroup\*, nsIPrincipal\*, nsIDocument\*\*) /home/worker/workspace/build/src/layout/build/nsContentDLF.cpp:298
#6 0x7f169ce00306 in nsDocShell::CreateAboutBlankContentViewer(nsIPrincipal\*, nsIURI\*, bool) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:8075:5
#7 0x7f169cd9f9f3 in nsDocShell::EnsureContentViewer() /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7965:17
#8 0x7f169cdd3687 in GetDocument /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:4528:3
#9 0x7f169cdd3687 in non-virtual thunk to nsDocShell::GetDocument() /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:4526
#10 0x7f169786b8ed in MaybeCreateDoc /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:3633:38
#11 0x7f169786b8ed in GetDoc /home/worker/workspace/build/src/obj-firefox/dist/include/nsPIDOMWindow.h:181
#12 0x7f169786b8ed in EnsureInnerWindow /home/worker/workspace/build/src/obj-firefox/dist/include/nsPIDOMWindow.h:849
#13 0x7f169786b8ed in nsOuterWindowProxy::GetSubframeWindow(JSContext\*, JS::Handle<JSObject\*>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>, bool&) const /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:1063
#14 0x7f169786d2bc in nsOuterWindowProxy::get(JSContext\*, JS::Handle<JSObject\*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) const /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:1002:8
#15 0x7f169f9a761e in js::Proxy::get(JSContext\*, JS::Handle<JSObject\*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:309:12
#16 0x7f169fa50d80 in GetProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.h:1497:16
#17 0x7f169fa50d80 in js::Wrapper::get(JSContext\*, JS::Handle<JSObject\*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:143
#18 0x7f169f998f22 in js::CrossCompartmentWrapper::get(JSContext\*, JS::Handle<JSObject\*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:209:14
#19 0x7f169f9a761e in js::Proxy::get(JSContext\*, JS::Handle<JSObject\*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:309:12
#20 0x7f169fca1d76 in GetProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.h:1497:16
#21 0x7f169fca1d76 in js::GetElement(JSContext\*, JS::Handle<JSObject\*>, JS::Handle<JS::Value>, unsigned int, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsobjinlines.h:200
#22 0x7f169fc11ee9 in GetElement /home/worker/workspace/build/src/js/src/jsobjinlines.h:208:12
#23 0x7f169fc11ee9 in GetObjectElementOperation /home/worker/workspace/build/src/js/src/vm/Interpreter-inl.h:436
#24 0x7f169fc11ee9 in GetElementOperation /home/worker/workspace/build/src/js/src/vm/Interpreter-inl.h:563
#25 0x7f169fc11ee9 in Interpret(JSContext\*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2760
#26 0x7f169fbf5c5b in js::RunScript(JSContext\*, js::RunState&) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:404:12
#27 0x7f169fc3080f in js::InternalCallOrConstruct(JSContext\*, JS::CallArgs const&, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:476:15
#28 0x7f169fc30e52 in js::Call(JSContext\*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:522:10
#29 0x7f169f7358cd in JS::Call(JSContext\*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /home/worker/workspace/build/src/js/src/jsapi.cpp:2825:12
#30 0x7f1699527852 in mozilla::dom::EventHandlerNonNull::Call(JSContext\*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) /home/worker/workspace/build/src/obj-firefox/dom/bindings/EventHandlerBinding.cpp:259:37
#31 0x7f1699e4ec41 in Call<nsISupports \*> /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/EventHandlerBinding.h:361:12
#32 0x7f1699e4ec41 in mozilla::JSEventHandler::HandleEvent(nsIDOMEvent\*) /home/worker/workspace/build/src/dom/events/JSEventHandler.cpp:214
#33 0x7f1699e1af44 in mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener\*, nsIDOMEvent\*, mozilla::dom::EventTarget\*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1133:16
#34 0x7f1699e1c50f in mozilla::EventListenerManager::HandleEventInternal(nsPresContext\*, mozilla::WidgetEvent\*, nsIDOMEvent\*\*, mozilla::dom::EventTarget\*, nsEventStatus\*) /home/worker/workspace/build/src/dom/events/EventListenerManager.cpp:1286:17
#35 0x7f1699e06806 in mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback\*, mozilla::ELMCreationDetector&) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:380:5
#36 0x7f1699e0a86d in mozilla::EventDispatcher::Dispatch(nsISupports\*, nsPresContext\*, mozilla::WidgetEvent\*, nsIDOMEvent\*, nsEventStatus\*, mozilla::EventDispatchingCallback\*, nsTArray<mozilla::dom::EventTarget\*>\*) /home/worker/workspace/build/src/dom/events/EventDispatcher.cpp:711:9
#37 0x7f169c080055 in nsDocumentViewer::LoadComplete(nsresult) /home/worker/workspace/build/src/layout/base/nsDocumentViewer.cpp:998:7
#38 0x7f169cdfa1de in nsDocShell::EndPageLoad(nsIWebProgress\*, nsIChannel\*, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7615:5
#39 0x7f169cdf5fb4 in nsDocShell::OnStateChange(nsIWebProgress\*, nsIRequest\*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7415:7
#40 0x7f169cdfd57f in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress\*, nsIRequest\*, unsigned int, nsresult) /home/worker/workspace/build/src/docshell/base/nsDocShell.cpp:7312:13
#41 0x7f1696c786a0 in nsDocLoader::DoFireOnStateChange(nsIWebProgress\*, nsIRequest\*, int&, nsresult) /home/worker/workspace/build/src/uriloader/base/nsDocLoader.cpp:1255:3
SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/dom/base/nsWrapperCache.h:210:15 in HasFlag
Shadow bytes around the buggy address:
0x0c1e8000cc10: 00 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fa
0x0c1e8000cc20: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00
0x0c1e8000cc30: 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fa
0x0c1e8000cc40: fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd
0x0c1e8000cc50: fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa
=>0x0c1e8000cc60: fd fd fd[fd]fd fd fd fd fd fd fd fd fd fd fd fd
0x0c1e8000cc70: fd fd fd fd fd fd fa fa fa fa fa fa fa fa 00 00
0x0c1e8000cc80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x0c1e8000cc90: 00 00 00 fa fa fa fa fa fa fa fa fa 00 00 00 00
0x0c1e8000cca0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x0c1e8000ccb0: 00 fa fa fa fa fa fa fa fa fa 00 00 00 00 00 00
Shadow byte legend (one shadow byte represents 8 application bytes):
Addressable: 00
Partially addressable: 01 02 03 04 05 06 07
Heap left redzone: fa
Heap right redzone: fb
Freed heap region: fd
Stack left redzone: f1
Stack mid redzone: f2
Stack right redzone: f3
Stack partial redzone: f4
Stack after return: f5
Stack use after scope: f8
Global redzone: f9
Global init order: f6
Poisoned by user: f7
Container overflow: fc
Array cookie: ac
Intra object redzone: bb
ASan internal: fe
Left alloca redzone: ca
Right alloca redzone: cb
==936==ABORTING

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1309198#a49748_1689)• 8 years ago |

Group: core-security → dom-core-security

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1309198#a99541_406194)• 8 years ago |

Keywords: [csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1309198#a99558_406194)• 8 years ago |

Keywords: [sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

|  | [Brian Birtles (:birtles)](/user_profile?user_id=165012) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1309198#c1)• 8 years ago |
|  | |

I'm not quite sure that this is an animation bug. Looking at the stack, it would seem like the root element we get back from GetRootElement in nsDocument::GetAnimations has already been freed. Is mCachedRootElement dangling after GC, perhaps?
Hiro, are you interested in having an initial look at this?

|  | [Hiroyuki Ikezoe (:hiro)](/user_profile?user_id=131213)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1309198#c2)• 8 years ago |
|  | |

Sure.
In this test case, it seems that FlushPendingNotifications() at the top of Element:GetAnimations() breaks something (mCachedRootElement?). I confirmed that dropping the FlushPendingNotifications() does not cause any errors. We might need to check before proceeding. I will investigate further.
By the way, apart from this bug, I feel like fuzzing code gets complicated in these days, I think it's a good thing it means that our code is getting robust thanks to fuzzer.Flags: needinfo?(hiikezoe)

|  | [Brian Birtles (:birtles)](/user_profile?user_id=165012) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1309198#c3)• 8 years ago |
|  | |

I wondered about FlushPendingNotifications but I thought the memory was being freed during a GC? Anyway, if it's just FlushPendingNotifications that's triggering it then perhaps all we need is a kungFuDeathGrip on the element. Fortunately getAnimations is not shipping to release channels so this should be limited to aurora/nightly.

|  | [Hiroyuki Ikezoe (:hiro)](/user_profile?user_id=131213)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1309198#c4)• 8 years ago |
|  | |

While processing FlushPendingNotifications(), init function of videocontrols.xml is called, and then addEventLister with mozSystemGroup[1] raises an exception. Because of this error, f0 function in the test case is processed, then the document is replaced with '<html><body></body></html>' and CC is called. As a result of this series of flows, the element (actually it's document) is no longer valid in Element::GetAnimations() after FlushPendingNotifications.
What I don't quite understand is that it is correct behavior that FlushPendingNotifications() invokes callbacks. If it's correct, we need kungFuDeathGrip or need to check that something is not broken whenever we call FlushPendingNotifications().
<http://hg.mozilla.org/mozilla-central/file/22be4ae74653/toolkit/content/widgets/videocontrols.xml#l1580>Flags: needinfo?(hiikezoe)

|  | [Hiroyuki Ikezoe (:hiro)](/user_profile?user_id=131213)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1309198#c5)• 8 years ago |
|  | |

Attached patch

[Automation test case](attachment.cgi?id=8800483&action=diff) (obsolete)
— [Details](attachment.cgi?id=8800483&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1309198&attachment=8800483)

|  | [Hiroyuki Ikezoe (:hiro)](/user_profile?user_id=131213)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1309198#c6)• 8 years ago |
|  | |

(In reply to Hiroyuki Ikezoe (:hiro) from [comment #4](/show_bug.cgi?id=1309198#c4 "VERIFIED FIXED - heap-use-after-free in mozilla::dom::Element::GetAnimations"))
> What I don't quite understand is that it is correct behavior that
> FlushPendingNotifications() invokes callbacks.
There is a possibility that FlushPendingNotifications() invokes callbacks from here;
<http://hg.mozilla.org/mozilla-central/file/9079d1671121/layout/base/nsPresShell.cpp#l4134>
A stack trace;
#20 0x00007fffe0a616a4 in mozilla::dom::OnErrorEventHandlerNonNull::Call<nsISupports\*> (this=<optimized out>, thisVal=<optimized out>, event=..., source=..., lineno=..., column=..., error=..., aRv=...,-
aExecutionReason=<optimized out>, aExceptionHandling=<optimized out>, aCompartment=<optimized out>) at /build/inbound/obj-asan/dist/include/mozilla/dom/EventHandlerBinding.h:527
#21 0x00007fffe0a4d56d in mozilla::JSEventHandler::HandleEvent (this=<optimized out>, aEvent=<optimized out>) at /build/inbound/dom/events/JSEventHandler.cpp:166
#22 0x00007fffe0a1c077 in mozilla::EventListenerManager::HandleEventSubType (this=<optimized out>, aListener=<optimized out>, aDOMEvent=<optimized out>, aCurrentTarget=<optimized out>)
at /build/inbound/dom/events/EventListenerManager.cpp:1133
#23 0x00007fffe0a1d4fa in mozilla::EventListenerManager::HandleEventInternal (this=<optimized out>, aPresContext=<optimized out>, aEvent=<optimized out>, aDOMEvent=<optimized out>,-
aCurrentTarget=<optimized out>, aEventStatus=<optimized out>) at /build/inbound/dom/events/EventListenerManager.cpp:1286
#24 0x00007fffe0a5b4f7 in mozilla::EventTargetChainItem::HandleEvent (this=<optimized out>, aVisitor=..., aCd=...) at /build/inbound/dom/events/EventDispatcher.cpp:275
#25 0x00007fffe0a0c1d7 in mozilla::EventTargetChainItem::HandleEventTargetChain (aChain=..., aVisitor=..., aCallback=<optimized out>, aCd=...) at /build/inbound/dom/events/EventDispatcher.cpp:380
#26 0x00007fffe0a0ecee in mozilla::EventDispatcher::Dispatch (aTarget=<optimized out>, aPresContext=<optimized out>, aEvent=<optimized out>, aDOMEvent=<optimized out>, aEventStatus=0x7fffffff33c0,-
aCallback=<optimized out>, aTargets=<optimized out>) at /build/inbound/dom/events/EventDispatcher.cpp:711
#27 0x00007fffe0a103c0 in mozilla::EventDispatcher::DispatchDOMEvent (aTarget=<optimized out>, aEvent=<optimized out>, aDOMEvent=<optimized out>, aPresContext=<optimized out>,-
aEventStatus=<optimized out>) at /build/inbound/dom/events/EventDispatcher.cpp:777
#28 0x00007fffde914650 in ScriptErrorEvent::Run (this=<optimized out>) at /build/inbound/dom/base/nsJSEnvironment.cpp:470
#29 0x00007fffde3e7d22 in nsContentUtils::AddScriptRunner (aRunnable=...) at /build/inbound/dom/base/nsContentUtils.cpp:5261
#30 0x00007fffde3e5e0b in nsContentUtils::AddScriptRunner (aRunnable=<optimized out>) at /build/inbound/dom/base/nsContentUtils.cpp:5268
#31 0x00007fffde68fee2 in mozilla::dom::AutoJSAPI::ReportException (this=<optimized out>) at /build/inbound/dom/base/ScriptSettings.cpp:594
#32 0x00007fffde68f2cf in mozilla::dom::AutoJSAPI::~AutoJSAPI (this=0x7fffffff3da0) at /build/inbound/dom/base/ScriptSettings.cpp:320
#33 0x00007fffe1f798a6 in nsXBLProtoImplAnonymousMethod::Execute (this=<optimized out>, aBoundElement=<optimized out>, aAddonId=<optimized out>) at /build/inbound/dom/xbl/nsXBLProtoImplMethod.cpp:326
#34 0x00007fffe1f4bb8b in nsBindingManager::ProcessAttachedQueueInternal (this=<optimized out>, aSkipSize=<optimized out>) at /build/inbound/dom/xbl/nsBindingManager.cpp:419
#35 0x00007fffe2c66815 in ProcessAttachedQueue (this=0x61d0005f4504, aSkipSize=0) at /build/inbound/dom/xbl/nsBindingManager.h:105
#36 PresShell::FlushPendingNotifications (this=<optimized out>, aFlush=...) at /build/inbound/layout/base/nsPresShell.cpp:4143
#37 0x00007fffde7de668 in nsDocument::FlushPendingNotifications (this=<optimized out>, aType=<optimized out>) at /build/inbound/dom/base/nsDocument.cpp:7749
#38 0x00007fffde7de4cd in nsDocument::FlushPendingNotifications (this=<optimized out>, aType=<optimized out>) at /build/inbound/dom/base/nsDocument.cpp:7727
#39 0x00007fffde5c1e3d in mozilla::dom::Element::GetAnimations (this=<optimized out>, filter=..., aAnimations=...) at /build/inbound/dom/base/Element.cpp:3453
#40 0x00007fffde7aedc6 in nsDocument::GetAnimations (this=<optimized out>, aAnimations=...) at /build/inbound/dom/base/nsDocument.cpp:3011
#41 0x00007fffe020d747 in mozilla::dom::DocumentBinding::getAnimations (cx=<optimized out>, obj=..., self=0x61d0005f3c80, args=...) at /build/inbound/obj-asan/dom/bindings/DocumentBinding.cpp:4248
I am now convinced we need a kungFuDeathGrip in GetAnimations().

|  | [Brian Birtles (:birtles)](/user_profile?user_id=165012) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1309198#c7)• 8 years ago |
|  | |

Thank you for looking into this! Do you want to take this bug then seeing as you have done all the research for it?Flags: needinfo?(hiikezoe)

|  | [Hiroyuki Ikezoe (:hiro)](/user_profile?user_id=131213)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1309198#c8)• 8 years ago |
|  | |

Sure.
Olli, I want to hear your advice. Do we need to have a strong ref all of the callers of FlushPendingNotifications?
For example here in Element::GetPrimaryFrame(), it seems to me that we need a kungFuDeathGrip as well.
<https://hg.mozilla.org/mozilla-central/file/dfc1afe56b75/dom/base/Element.cpp#l2192>
In nsFocusManager::CheckIfFocusable(), it seems to me that we should hold a strong ref for "nsIContent\* aContent" as well.
<https://hg.mozilla.org/mozilla-central/file/954640930278/dom/base/nsFocusManager.cpp#l1550>
In Event::GetOffsetCoords(), we have already strong ref for nsIContent and nsIPresShell.
<https://hg.mozilla.org/mozilla-central/file/a36f68c2886b/dom/events/Event.cpp#l1025>
etc. etc...
Is there any good idea rather than checking all over the place of the callers?Assignee: nobody → hiikezoeStatus: NEW → ASSIGNEDFlags: needinfo?(hiikezoe) → needinfo?(bugs)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1309198#c9)• 8 years ago |
|  | |

FlushPendingNotifications may run scripts and callers need to keep that in mind.
In this bug it seems like nsDocument::GetAnimations should use strong reference, not raw, since Element::GetAnimations may run scripts.
In practice having kungfuDeathGrip in Element::GetAnimations works too, but that is a tad error prone, since nothing on the caller
side ensures the element stays alive.
The caller of
Element::GetPrimaryFrame(mozFlushType aType) is expected to keep the element alive.
In that nsFocusManager case it is up to the caller of CheckIfFocusable to keep aContent alive (per COM rules).
There isn't really any better way (at least not atm) than go through the callers.Flags: needinfo?(bugs)

|  | [Hiroyuki Ikezoe (:hiro)](/user_profile?user_id=131213)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1309198#c10)• 8 years ago |
|  | |

Attached patch

[Hold a strong ref of the element for Element::GetAnimations](attachment.cgi?id=8801682&action=diff) (obsolete)
— [Details](attachment.cgi?id=8801682&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1309198&attachment=8801682)

Thank you very much for the understandable explanation!
[Attachment #8801682](/attachment.cgi?id=8801682&action=edit "Hold a strong ref of the element for Element::GetAnimations") -
Flags: review?(bugs)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1309198#c11)• 8 years ago |
|  | |

Comment on [attachment 8801682](/attachment.cgi?id=8801682 "Hold a strong ref of the element for Element::GetAnimations") [[details]](/attachment.cgi?id=8801682&action=edit "Hold a strong ref of the element for Element::GetAnimations") [[diff]](/attachment.cgi?id=8801682&action=diff "Hold a strong ref of the element for Element::GetAnimations") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1309198&attachment=8801682)
Hold a strong ref of the element for Element::GetAnimations
># HG changeset patch
># User Hiroyuki Ikezoe <hiikezoe@mozilla-japan.org>
># Parent 0024d1ef6a06cc0f4a65723a961484c67180113e
>[Bug 1309198](/show_bug.cgi?id=1309198 "VERIFIED FIXED - heap-use-after-free in mozilla::dom::Element::GetAnimations") - Hold a strong ref of the element for Element::GetAnimations. r?smaug
>
>diff --git a/dom/base/Element.h b/dom/base/Element.h
>--- a/dom/base/Element.h
>+++ b/dom/base/Element.h
>@@ -893,16 +893,18 @@ public:
> static already\_AddRefed<Animation>
> Animate(const Nullable<ElementOrCSSPseudoElement>& aTarget,
> JSContext\* aContext,
> JS::Handle<JSObject\*> aKeyframes,
> const UnrestrictedDoubleOrKeyframeAnimationOptions& aOptions,
> ErrorResult& aError);
>
> // Note: GetAnimations will flush style while GetAnimationsUnsorted won't.
>+ // Callers must keep this element alive becaue flushing style may destroy
because
[Attachment #8801682](/attachment.cgi?id=8801682&action=edit "Hold a strong ref of the element for Element::GetAnimations") -
Flags: review?(bugs) → review+

|  | [Hiroyuki Ikezoe (:hiro)](/user_profile?user_id=131213)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1309198#c12)• 8 years ago |
|  | |

Attached patch

[Hold a strong ref of the element for Element::GetAnimations](attachment.cgi?id=8801687&action=diff)
— [Details](attachment.cgi?id=8801687&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1309198&attachment=8801687)

[Security approval request comment]
How easily could an exploit be constructed based on the patch?
Not easily. It needs sophisticated code and to kick cycle collector at good timing.
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?
I don't think so.
Which older supported branches are affected by this flaw?
49
If not all supported branches, which bug introduced the flaw?
[Bug 1212720](/show_bug.cgi?id=1212720 "RESOLVED FIXED - Move getAnimations() from AnimationTimeline to Document")
Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?
Yes, I can provide it.
How likely is this patch to cause regressions; how much testing does it need?
Unlikely, this patch just holds a strong reference.
[Attachment #8801682](/attachment.cgi?id=8801682&action=edit "Hold a strong ref of the element for Element::GetAnimations") -
Attachment is obsolete: true
[Attachment #8801687](/attachment.cgi?id=8801687&action=edit "Hold a strong ref of the element for Element::GetAnimations") -
Flags: sec-approval?
[Attachment #8801687](/attachment.cgi?id=8801687&action=edit "Hold a strong ref of the element for Element::GetAnimations") -
Flags: review+

|  | [Hiroyuki Ikezoe (:hiro)](/user_profile?user_id=131213)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1309198#c13)• 8 years ago |
|  | |

The test case in [comment 0](/show_bug.cgi?id=1309198#c0 "VERIFIED FIXED - heap-use-after-free in mozilla::dom::Element::GetAnimations") ([attachment 8799713](/attachment.cgi?id=8799713 "crash.html minimized testcase: requires Jesse's dom fuzzing addon") [[details]](/attachment.cgi?id=8799713&action=edit "crash.html minimized testcase: requires Jesse's dom fuzzing addon")) does not cause heap-use-after-free on Firefox 49, but I am definitely convinced Firefox 49 has also this bug.
[status-firefox49](/buglist.cgi?f1=cf_status_firefox49&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox49&o1=equals&v1=affected)
[status-firefox50](/buglist.cgi?f1=cf_status_firefox50&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=affected)
[status-firefox51](/buglist.cgi?f1=cf_status_firefox51&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=affected)

|  | [Brian Birtles (:birtles)](/user_profile?user_id=165012) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1309198#c14)• 8 years ago |
|  | |

getAnimations is not exposed to Web content in release channels (so only add-ons / chrome code could trigger this bug in 49 / 50). I suggest this should be wontfix for 49 and 50.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1309198#c15)• 8 years ago |
|  | |

sec-approval+ for Trunk. I'd like to see an Aurora patch nominated for going in after trunk lands.
[status-firefox49](/buglist.cgi?f1=cf_status_firefox49&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox49&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox49&o1=equals&v1=wontfix)
[status-firefox50](/buglist.cgi?f1=cf_status_firefox50&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=wontfix)
[tracking-firefox51](/buglist.cgi?f1=cf_tracking_firefox51&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox51&o1=equals&v1=%2B)
[tracking-firefox52](/buglist.cgi?f1=cf_tracking_firefox52&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox52&o1=equals&v1=%2B)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1309198#a627964_280903)• 8 years ago |

[Attachment #8801687](/attachment.cgi?id=8801687&action=edit "Hold a strong ref of the element for Element::GetAnimations") -
Flags: sec-approval? → sec-approval+

|  | [Hiroyuki Ikezoe (:hiro)](/user_profile?user_id=131213)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1309198#c16)• 8 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/dc676b9cc1bf6b2e2090168eaccd9ee25c1e5b86>
[Bug 1309198](/show_bug.cgi?id=1309198 "VERIFIED FIXED - heap-use-after-free in mozilla::dom::Element::GetAnimations") - Hold a strong ref of the element for Element::GetAnimations. r=smaug

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1309198#c17)• 8 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/dc676b9cc1bf>
[status-firefox52](/buglist.cgi?f1=cf_status_firefox52&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=fixed)Target Milestone: --- → mozilla52

|  | [Hiroyuki Ikezoe (:hiro)](/user_profile?user_id=131213)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1309198#c18)• 8 years ago |
|  | |

Comment on [attachment 8801687](/attachment.cgi?id=8801687 "Hold a strong ref of the element for Element::GetAnimations") [[details]](/attachment.cgi?id=8801687&action=edit "Hold a strong ref of the element for Element::GetAnimations") [[diff]](/attachment.cgi?id=8801687&action=diff "Hold a strong ref of the element for Element::GetAnimations") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1309198&attachment=8801687)
Hold a strong ref of the element for Element::GetAnimations
Approval Request Comment
[Feature/regressing bug #]: [bug 1212720](/show_bug.cgi?id=1212720 "RESOLVED FIXED - Move getAnimations() from AnimationTimeline to Document")
[User impact if declined]: A security vulnerability by heap-use-after-free
[Describe test coverage new/current, TreeHerder]: Confirmed the heap-use-after-free has been fixed with the test case in [comment #0](/show_bug.cgi?id=1309198#c0 "VERIFIED FIXED - heap-use-after-free in mozilla::dom::Element::GetAnimations"), and already landed on mozilla-central.
[Risks and why]: Low risk, this patch just holds a strong reference.
[String/UUID change made/needed]: None
[Attachment #8801687](/attachment.cgi?id=8801687&action=edit "Hold a strong ref of the element for Element::GetAnimations") -
Flags: approval-mozilla-aurora?

|  | [Gerry Chang [:gchang]](/user_profile?user_id=506302) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1309198#c19)• 8 years ago |
|  | |

Comment on [attachment 8801687](/attachment.cgi?id=8801687 "Hold a strong ref of the element for Element::GetAnimations") [[details]](/attachment.cgi?id=8801687&action=edit "Hold a strong ref of the element for Element::GetAnimations") [[diff]](/attachment.cgi?id=8801687&action=diff "Hold a strong ref of the element for Element::GetAnimations") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1309198&attachment=8801687)
Hold a strong ref of the element for Element::GetAnimations
Fix a sec-critical issue. Take it in 51 aurora.
[Attachment #8801687](/attachment.cgi?id=8801687&action=edit "Hold a strong ref of the element for Element::GetAnimations") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Hiroyuki Ikezoe (:hiro)](/user_profile?user_id=131213)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1309198#c20)• 8 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/95567c6551ea7dfef517e7b3f50fe0be209a3a2a>

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1309198#c21)• 8 years ago |
|  | |

(In reply to Hiroyuki Ikezoe (:hiro) from [comment #20](/show_bug.cgi?id=1309198#c20 "VERIFIED FIXED - heap-use-after-free in mozilla::dom::Element::GetAnimations"))
> <https://hg.mozilla.org/releases/mozilla-aurora/rev/>
> 95567c6551ea7dfef517e7b3f50fe0be209a3a2a
setting flags
[status-firefox51](/buglist.cgi?f1=cf_status_firefox51&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=fixed)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1309198#c22)• 8 years ago |
|  | |

Marking as fixed, as this has landed on m-c, in [comment 17](/show_bug.cgi?id=1309198#c17 "VERIFIED FIXED - heap-use-after-free in mozilla::dom::Element::GetAnimations").Status: ASSIGNED → RESOLVEDClosed: 8 years agoResolution: --- → FIXED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1309198#a1140948_1689)• 8 years ago |

Group: dom-core-security → core-security-release

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1309198#a1854366_280903)• 8 years ago |

Flags: sec-bounty?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1309198#a2358822_1689)• 8 years ago |

Flags: sec-bounty?Flags: sec-bounty+Flags: in-testsuite?Keywords: [sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---) → [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1309198#a2358863_1689)• 8 years ago |

Blocks: [1212720](/show_bug.cgi?id=1212720 "RESOLVED FIXED - Move getAnimations() from AnimationTimeline to Document")
[status-firefox-esr45](/buglist.cgi?f1=cf_status_firefox_esr45&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=unaffected)Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1309198#a4329026_75935)• 8 years ago |

[status-firefox50](/buglist.cgi?f1=cf_status_firefox50&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=wontfix) → [affected](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=affected)
[tracking-firefox50](/buglist.cgi?f1=cf_tracking_firefox50&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox50&o1=equals&v1=%3F)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1309198#c23)• 8 years ago |
|  | |

Comment on [attachment 8801687](/attachment.cgi?id=8801687 "Hold a strong ref of the element for Element::GetAnimations") [[details]](/attachment.cgi?id=8801687&action=edit "Hold a strong ref of the element for Element::GetAnimations") [[diff]](/attachment.cgi?id=8801687&action=diff "Hold a strong ref of the element for Element::GetAnimations") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1309198&attachment=8801687)
Hold a strong ref of the element for Element::GetAnimations
Well-baked sec-high with a simple patch.
[Attachment #8801687](/attachment.cgi?id=8801687&action=edit "Hold a strong ref of the element for Element::GetAnimations") -
Flags: approval-mozilla-release?

|  | [Brian Birtles (:birtles)](/user_profile?user_id=165012) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1309198#c24)• 8 years ago |
|  | |

(See [comment 14](/show_bug.cgi?id=1309198#c14 "VERIFIED FIXED - heap-use-after-free in mozilla::dom::Element::GetAnimations") -- this feature is preffed off for Web content in beta/release versions)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1309198#c25)• 8 years ago |
|  | |

Sorry, I missed that earlier.
[status-firefox50](/buglist.cgi?f1=cf_status_firefox50&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=wontfix)
[tracking-firefox50](/buglist.cgi?f1=cf_tracking_firefox50&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox50&o1=equals&v1=%3F) → ---

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1309198#a4381500_75935)• 8 years ago |

[Attachment #8801687](/attachment.cgi?id=8801687&action=edit "Hold a strong ref of the element for Element::GetAnimations") -
Flags: approval-mozilla-release?

|  | [Hiroyuki Ikezoe (:hiro)](/user_profile?user_id=131213)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1309198#c26)• 8 years ago |
|  | |

Attached patch

[A crashtest](attachment.cgi?id=8818656&action=diff)
— [Details](attachment.cgi?id=8818656&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1309198&attachment=8818656)

I did forget to send review-request for the test case.
[Attachment #8800483](/attachment.cgi?id=8800483&action=edit "Automation test case") -
Attachment is obsolete: true
[Attachment #8818656](/attachment.cgi?id=8818656&action=edit "A crashtest") -
Flags: review?(bugs)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1309198#c27)• 8 years ago |
|  | |

Comment on [attachment 8818656](/attachment.cgi?id=8818656 "A crashtest") [[details]](/attachment.cgi?id=8818656&action=edit "A crashtest") [[diff]](/attachment.cgi?id=8818656&action=diff "A crashtest") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1309198&attachment=8818656)
A crashtest
rs+
I assume this should land only once 51 has shipped.
[Attachment #8818656](/attachment.cgi?id=8818656&action=edit "A crashtest") -
Flags: review?(bugs) → review+

|  | [Hiroyuki Ikezoe (:hiro)](/user_profile?user_id=131213)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1309198#c28)• 8 years ago |
|  | |

Thanks for the quick review and the attention!

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1309198#a7791516_452604)• 8 years ago |

Flags: qe-verify+Whiteboard: [post-critsmash-triage]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1309198#a8499726_280903)• 8 years ago |

Whiteboard: [post-critsmash-triage] → [post-critsmash-triage][adv-main51+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1309198#a8517220_280903)• 8 years ago |

Alias: CVE-2017-5379

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1309198#c29)• 8 years ago |
|  | |

Hi Nils, can you check to make sure this bug has been fixed on your end? Thank you.Flags: needinfo?(nils)

|  | [Nils](/user_profile?user_id=344130)  Reporter |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1309198#c30)• 8 years ago |
|  | |

Hi Matt, I can confirm that the testcase does not crash anymore on a recent ASAN build.Flags: needinfo?(nils)

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1309198#c31)• 8 years ago |
|  | |

(In reply to Nils from [comment #30](/show_bug.cgi?id=1309198#c30 "VERIFIED FIXED - heap-use-after-free in mozilla::dom::Element::GetAnimations"))
> Hi Matt, I can confirm that the testcase does not crash anymore on a recent
> ASAN build.
Thanks!Status: RESOLVED → VERIFIED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1309198#a27767194_1689)• 7 years ago |

Group: core-security-release

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1309198#c32)• 7 years ago |
|  | |

Pushed by hikezoe@mozilla.com:
<https://hg.mozilla.org/integration/mozilla-inbound/rev/26b8e4fcf999>
Test case that document is discarded while Document.getAnimations(). r=smaug

|  | [Natalia Csoregi [:nataliaCs]](/user_profile?user_id=600555) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1309198#c33)• 7 years ago |
| bugherder | |

<https://hg.mozilla.org/mozilla-central/rev/26b8e4fcf999>

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1309198#a240900701_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1309198&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Nils](/user_profile?user_id=344130)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_0a7fea57_20250126_073132.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1312001)
* [XML](/show_bug.cgi?ctype=xml&id=1312001)

Closed
[Bug 1312001](/show_bug.cgi?id=1312001)
(CVE-2017-5378)

Opened 8 years ago
Closed 8 years ago

# ASLR leak and cross-frame oracle via pointer scrambling in Map/Set

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

ASLR leak and cross-frame oracle via pointer scrambling in Map/Set

## Categories

### (Core :: JavaScript Engine, defect, P1)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla53

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| a11y-review | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr45 | [51+](/buglist.cgi?f1=cf_tracking_firefox_esr45&o1=equals&v1=51%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=fixed) |
| firefox50 | [+](/buglist.cgi?f1=cf_tracking_firefox50&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=wontfix) |
| firefox51 | [+](/buglist.cgi?f1=cf_tracking_firefox51&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=verified) |
| firefox52 | [+](/buglist.cgi?f1=cf_tracking_firefox52&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=fixed) |
| firefox53 | [+](/buglist.cgi?f1=cf_tracking_firefox53&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox53&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr45 | 51+ | fixed |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox50 | + | wontfix |
| firefox51 | + | verified |
| firefox52 | + | fixed |
| firefox53 | + | fixed |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jann+mozilla, Assigned: jorendorff)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/5a83f46f9f97d184457cb2dedfa19173?d=mm&size=40)  [jorendorff](/user_profile?user_id=281791)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

![](https://secure.gravatar.com/avatar/7bb698c4991c5af83adabe3c3b8ee8aa?d=mm&size=40)  [mwobensmith](/user_profile?user_id=452604)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/a76f92f695c9971c81e85a410f0a0916?d=mm&size=40)  [jann+mozilla](/user_profile?user_id=500267)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

15 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[CVE-2016-9904](/show_bug.cgi?id=1317936 "RESOLVED FIXED - Fix cross-origin information leak from shared atoms"), [1330769](/show_bug.cgi?id=1330769 "RESOLVED FIXED - ASLR leak via pointer scrambling in ShapeTable")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=1312001&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1312001)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-disclosure, csectype-sop, sec-high, Whiteboard: [post-critsmash-triage][adv-main51+][adv-esr45.7+] Disclosure date ~Jan 21 2017 (note Fx51 scheduled for Jan 24))

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2017-5378

[Keywords:](/describekeywords.cgi)

[csectype-disclosure](/buglist.cgi?keywords=csectype-disclosure&resolution=---),
[csectype-sop](/buglist.cgi?keywords=csectype-sop&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[post-critsmash-triage][adv-main51+][adv-esr45.7+] Disclosure date ~Jan 21 2017 (note Fx51 scheduled for Jan 24)

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (8 files, 3 obsolete files)

| [firefox-aslr-break.tar](/attachment.cgi?id=8803341)  [8 years ago](#c0)  [Jann Horn](/user_profile?user_id=500267)   30.00 KB, application/x-tar |  | [Details](/attachment.cgi?id=8803341&action=edit) |
| --- | --- | --- |
| [bug1312001-use-unique-id-for-map](/attachment.cgi?id=8807122)  [8 years ago](#c12)  [Jon Coppeard (:jonco) (PTO until 27th Jan)](/user_profile?user_id=443194)   17.79 KB, patch |  | [Details](/attachment.cgi?id=8807122&action=edit) | [Diff](/attachment.cgi?id=8807122&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8807122) |
| [Scramble hash codes securely, to avoid leaking bits of object and string addresses](/attachment.cgi?id=8815939)  [8 years ago](#c22)  [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)   17.82 KB, patch | jandem : [review+](#c30 "8 years ago") | [Details](/attachment.cgi?id=8815939&action=edit) | [Diff](/attachment.cgi?id=8815939&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8815939) |
| [LookupHitTest-speed.png](/attachment.cgi?id=8815942)  [8 years ago](#c24)  [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)   33.94 KB, image/png |  | [Details](/attachment.cgi?id=8815942&action=edit) |
| [LookupMissTest-speed.png](/attachment.cgi?id=8815943)  [8 years ago](#c25)  [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)   34.38 KB, image/png |  | [Details](/attachment.cgi?id=8815943&action=edit) |
| [Scramble hash codes securely, to avoid leaking bits of object and string addresses](/attachment.cgi?id=8817055)  [8 years ago](#c32)  [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)   17.82 KB, patch | jorendorff : [review+](#c33 "8 years ago")  abillings : [sec-approval+](#c35 "8 years ago") | [Details](/attachment.cgi?id=8817055&action=edit) | [Diff](/attachment.cgi?id=8817055&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8817055) |
| [Scramble hash codes securely, to avoid leaking bits of object and symbol addresses](/attachment.cgi?id=8820073)  [8 years ago](#c38)  [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)   26.66 KB, patch | jandem : [review+](#c40 "8 years ago")  abillings : [sec-approval+](#c42 "8 years ago") | [Details](/attachment.cgi?id=8820073&action=edit) | [Diff](/attachment.cgi?id=8820073&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8820073) |
| [(aurora) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses](/attachment.cgi?id=8825939)  [8 years ago](#c52)  [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)   26.29 KB, patch | lizzard : [approval-mozilla-aurora+](#a7193842_451704 "8 years ago") | [Details](/attachment.cgi?id=8825939&action=edit) | [Diff](/attachment.cgi?id=8825939&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8825939) |
| [(beta) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses](/attachment.cgi?id=8825943)  [8 years ago](#c53)  [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)   26.75 KB, patch | lizzard : [approval-mozilla-beta+](#c71 "8 years ago") | [Details](/attachment.cgi?id=8825943&action=edit) | [Diff](/attachment.cgi?id=8825943&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8825943) |
| [(release) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses](/attachment.cgi?id=8825944)  [8 years ago](#c54)  [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)   26.70 KB, patch | jcristau : [approval-mozilla-release-](#c69 "8 years ago") | [Details](/attachment.cgi?id=8825944&action=edit) | [Diff](/attachment.cgi?id=8825944&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8825944) |
| [(esr45) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses](/attachment.cgi?id=8825986)  [8 years ago](#c62)  [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)   26.59 KB, patch | lizzard : [approval-mozilla-esr45+](#a7193897_451704 "8 years ago") | [Details](/attachment.cgi?id=8825986&action=edit) | [Diff](/attachment.cgi?id=8825986&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8825986) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jann Horn](/user_profile?user_id=500267)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1312001#c0)• 8 years ago |
|  | |

Attached file
[firefox-aslr-break.tar](attachment.cgi?id=8803341)
— [Details](attachment.cgi?id=8803341&action=edit)

User Agent: Mozilla/5.0 (X11; Linux x86\_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.143 Safari/537.36
Steps to reproduce:
In Nightly (non-debug build) on x86-64, open the file attack.html from the attached tarball and wait around 15 seconds (depending on your CPU) until the displayed result is green or red.
For the second way to abuse the behavior described here, unpack leak\_interned.html, an attacker, and leak\_interned\_victim.html, a victim page. This attack is less reliable. Open leak\_interned.html in a fresh browser instance, click one of the three name buttons, click the "tell me what I clicked button", and then wait a couple seconds (I think you have to wait for a GC run to happen or so).
Actual results:
In the first PoC, something like this will be shown:
bucket access delay calibration: hit: 0.014999999999993463, miss: 0, limit: 0.0074999999999967315
current char code: 41
number of possible results: 1
result: 0x01f00028
The displayed result (0x01f00028) is the pointer to the atomized string corresponding to '\0', truncated to 32 bits. On Linux, the corresponding mapping is visible in /proc/<plugin-container-pid>/maps:
7f3001400000-7f3002000000 rw-p 00000000 00:00 0
The basic idea here is to perform a hash DoS attack, but with a goal other than Denial of Service. After a single hashtable bucket has been filled with lots of entries, insertions and negative lookups on the hashtable will be much slower for keys that map to the filled hashmap bucket. This means that a timing measurement can be used to determine whether a given key maps to a specific hashtable bucket as follows:
- Fill the hashtable bucket with data.
- Measure the time needed to look up the key in the hashtable.
Filling a specific hashtable bucket with data is easy because:
- int32 numbers are simply mapped with ScrambleHashCode(number),
no unknown values are involved
- the inverse of ScrambleHashCode() is just a modular multiplication with
the multiplicative inverse of the constant scrambling factor, so it is possible
to compute a series of int32 numbers that map to adjacent hash codes.
The reason this can be used to break ASLR is that, for strings and objects, 32-bit truncated pointers are scrambled with ScrambleHashCode() and then used to derive hashmap bucket indexes. Therefore, by measuring lookup times for strings/objects in a hashmap with a known filled bucket, the range of possible pointers can be constrained.
Strings are converted to pointers by atomizing (interning) them, then taking the pointer to the atom. For some strings, atoms are precreated; in particular, atoms exist for single-character strings with charcodes 0-255. Because these are allocated in a loop during runtime initialization (StaticStrings::init()), they form a sequence in memory, so the distance between the atomized strings for String.fromCharCode(i) and String.fromCharCode(i+1) (for i in range(0,255)) is always 0x18.
The algorithm used in the PoC works roughly as follows (this is just the basic idea, the implementation in the exploit is optimized a bit):
find\_bucket\_precise() attempts to find the bucket index at which a given value will be placed in a Set of size 2^22.
This is done as follows:
- Locate the value in a Set with 64 buckets (find\_bucket64()) by testing with 64 different
Set instances that have different filled buckets and checking with which Set the operation is slow
- Repeatedly create new Sets with doubled bucket counts (128, 256, 512, ...) and test
whether the access at the doubled old bucket index is slow. Basically, determine the 22-bit bucket index
bit by bit.
The main code attempts to find a single candidate for the address of the '\0' atom:
- Compute the bucket index of '\0' with find\_bucket\_precise().
- Let candidates\_set be the result of deriving 32-bit truncated pointer candidates
from the bucket index of '\0' using the inverse of ScrambleHashCode().
- For characters '\1', '\2', '\3', ...:
- Compute the character's bucket index with find\_bucket\_precise().
- Derive 32-bit truncated pointer candidates from the character's bucket index.
- Let current\_0candidates be the result of subtracting character\_code\*0x18
from the candidates for the current character.
- Let candidates\_set be the values that are contained in both candidates\_set
and current\_0candidates.
- Assert that candidates\_set contains exactly one value.
- Return the value in candidates\_set.
This is not just usable to break ASLR, as demonstrated by the second PoC. Another issue is that, because atoms are shared across frames, the ability to determine bucket indexes can be used to determine whether another frame is using an atom with specific contents (because an atom can only move in memory if nobody is using it). I'm not entirely sure, but I think string literals are always atomized? So this can e.g. be used to leak information like usernames embedded in JavaScript code across websites. The PoC determines which one out of a set of possible names was selected in the other frame across origins.
Expected results:
Firefox should not leak addresses or information about strings in other frames to JavaScript code.
In V8, these attacks won't work because:
Objects can have private, random 32-bit members ("hash\_code\_symbol") specifying their hashmap buckets. The member is set when the object is used in a hashtable the first time.
Strings are not interned for usage in hashtables; instead, when a string is used in a hashtable for the first time, a hash of its contents is computed and stored in the string by String::ComputeAndSetHash().
It might make sense to copy V8's behavior here.
This bug is subject to a 90 day disclosure deadline. If 90 days elapse without a broadly available patch, I will post it publicly.

|  | [Benjamin Smedberg](/user_profile?user_id=7044) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312001#a983_7044)• 8 years ago |

Group: firefox-core-security → javascript-core-securityComponent: Untriaged → JavaScript EngineProduct: Firefox → Core

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1312001#c1)• 8 years ago |
|  | |

(In reply to Jann Horn from [comment #0](/show_bug.cgi?id=1312001#c0 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set"))
> Objects can have private, random 32-bit members ("hash\_code\_symbol")
> specifying their hashmap buckets. The member is set when the object is used
> in a hashtable the first time.
We do have a mechanism to assign unique IDs to cells (Zone::getUniqueId), we should probably use that here. We should be careful not to regress perf though...Summary: ALSR leak and cross-frame oracle via pointer scrambling in Map/Set → ASLR leak and cross-frame oracle via pointer scrambling in Map/Set

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312001#a3432_375297)• 8 years ago |

Status: UNCONFIRMED → NEW
[status-firefox52](/buglist.cgi?f1=cf_status_firefox52&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=affected)
[tracking-firefox52](/buglist.cgi?f1=cf_tracking_firefox52&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox52&o1=equals&v1=%3F)Ever confirmed: truePriority: -- → P1

|  | [Jon Coppeard (:jonco) (PTO until 27th Jan)](/user_profile?user_id=443194) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1312001#c2)• 8 years ago |
|  | |

(In reply to Jan de Mooij [:jandem] from [comment #1](/show_bug.cgi?id=1312001#c1 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set"))
> We do have a mechanism to assign unique IDs to cells (Zone::getUniqueId), we
> should probably use that here. We should be careful not to regress perf
> though...
I wrote a patch to do this and it was indeed a performance regression, being about twice as slow for adding objects to a map.

|  | [Jann Horn](/user_profile?user_id=500267)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1312001#c3)• 8 years ago |
|  | |

(In reply to Jon Coppeard (:jonco) from [comment #2](/show_bug.cgi?id=1312001#c2 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set"))
> (In reply to Jan de Mooij [:jandem] from [comment #1](/show_bug.cgi?id=1312001#c1 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set"))
> > We do have a mechanism to assign unique IDs to cells (Zone::getUniqueId), we
> > should probably use that here. We should be careful not to regress perf
> > though...
>
> I wrote a patch to do this and it was indeed a performance regression, being
> about twice as slow for adding objects to a map.
Zone::getUniqueId() doesn't look very fast. It uses a hashmap, and it uses js::gc::NextCellUniqueId(), which uses an atomic increment-and-return, which iirc implies a cmpxchg loop on x86, and it does some optimization stuff.
Can't you generate a random number using thread-local randomness state or so and cram it into the object directly?

|  | [Jann Horn](/user_profile?user_id=500267)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1312001#c4)• 8 years ago |
|  | |

s/, and it does some optimization stuff//, I have no idea what I was trying to write there.

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1312001#c5)• 8 years ago |
|  | |

(In reply to Jann Horn from [comment #3](/show_bug.cgi?id=1312001#c3 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set"))
> Can't you generate a random number using thread-local randomness state or so
> and cram it into the object directly?
Unfortunately it's not that easy, object layout is heavily optimized and we have different kinds of objects. We do want something more efficient than that hashtable lookup though. For strings, things are a bit easier because we have a flags word we can steal a number of bits from. I'll think about it more.

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1312001#c6)• 8 years ago |
|  | |

Tracking 52+ because this bug involves leaking addresses or information thru JS.
[tracking-firefox52](/buglist.cgi?f1=cf_tracking_firefox52&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox52&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox52&o1=equals&v1=%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312001#a532860_1689)• 8 years ago |

[status-firefox50](/buglist.cgi?f1=cf_status_firefox50&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=affected)
[status-firefox51](/buglist.cgi?f1=cf_status_firefox51&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=affected)
[tracking-firefox51](/buglist.cgi?f1=cf_tracking_firefox51&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox51&o1=equals&v1=%2B)Whiteboard: Disclosure date ~Jan 21 (note Fx51 scheduled Jan 24), 2017

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1312001#c7)• 8 years ago |
|  | |

[Tracking Requested - why for this release]:
Jan: Can you take this on, or find someone who will?
[tracking-firefox50](/buglist.cgi?f1=cf_tracking_firefox50&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox50&o1=equals&v1=%3F)Flags: needinfo?(jdemooij)Keywords: [csectype-disclosure](/buglist.cgi?keywords=csectype-disclosure&resolution=---),
[csectype-sop](/buglist.cgi?keywords=csectype-sop&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)Whiteboard: Disclosure date ~Jan 21 (note Fx51 scheduled Jan 24), 2017 → Disclosure date ~Jan 21 2017 (note Fx51 scheduled for Jan 24)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1312001#c8)• 8 years ago |
|  | |

I'm not really familiar with the Map/Set code or with HashTable algorithms.
Jason/Jeff, can you take a look at this?Flags: needinfo?(jwalden+bmo)Flags: needinfo?(jorendorff)Flags: needinfo?(jdemooij)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1312001#c9)• 8 years ago |
|  | |

I think we should fix this by making ScrambleHashCode impossible to invert offline. Store a different random integer "key" in each OrderedHashTable; use it as input to a new two-argument SecureScrambleHashCode(key, hash).
Pros:
- only costs 1 word per Map/Set
- relatively uninvasive patch
- dumb (no need to separately produce a secure hash code for each type)
- also prevents HashDoS attacks more generally
Downsides:
- It can't just multiply `key \* hash` -- it'd be too easy to reverse-engineer the key. We need (at most) a secure hashing function that has a key; the one I know about is SipHash.
- Not sure about the speed. SipHash-1-3 is secure enough and should be faster than what [comment 3](/show_bug.cgi?id=1312001#c3 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set") describes, at least. But what the slowdown will be, I don't know.Flags: needinfo?(jorendorff)

|  | [Jann Horn](/user_profile?user_id=500267)  Reporter |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1312001#c10)• 8 years ago |
|  | |

> I think we should fix this by making ScrambleHashCode impossible
to invert offline.
I think that that would almost certainly fix the ASLR leak part. I'm wondering about the remaining impact of being able to measure random collisions though. If an attacker could detect random collisions with buckets of size around 3 to 5 or so, that would probably still be sufficient for executing the attack on interned strings. And with small bucket counts, finding small random collisions shouldn't be too hard - and as soon as you have a small collision, finding more elements mapping into the same bucket is relatively easy.

|  | [Jann Horn](/user_profile?user_id=500267)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1312001#c11)• 8 years ago |
|  | |

(In reply to Jann Horn from [comment #10](/show_bug.cgi?id=1312001#c10 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set"))
> > I think we should fix this by making ScrambleHashCode impossible
> > to invert offline.
>
> I think that that would almost certainly fix the ASLR leak part. I'm
> wondering about the remaining impact of being able to measure random
> collisions though. If an attacker could detect random collisions with
> buckets of size around 3 to 5 or so, that would probably still be sufficient
> for executing the attack on interned strings.
I guess the nicest fix for that would be to have separate sets of interned strings for cross-origin frames, with only the predefined names common to all frames (in case you need them to be common for access to properties that are accessible cross-origin?). Would that work?

|  | [Jon Coppeard (:jonco) (PTO until 27th Jan)](/user_profile?user_id=443194) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1312001#c12)• 8 years ago |
|  | |

Attached patch

[bug1312001-use-unique-id-for-map](attachment.cgi?id=8807122&action=diff)
— [Details](attachment.cgi?id=8807122&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8807122)

FWIW, here's a patch to make Map and Set use unique IDs for GC things stored in the hashtable. This fixes the problem, but is not great for performance.

|  | [Jon Coppeard (:jonco) (PTO until 27th Jan)](/user_profile?user_id=443194) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1312001#c13)• 8 years ago |
|  | |

(In reply to Jon Coppeard (:jonco) from [comment #12](/show_bug.cgi?id=1312001#c12 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set"))
...and thinking about it some more it doesn't fix the problem of string collisions either.
I think we probably want to go with something like Jason suggested above, and use a per-compartment table to intern strings rather than system-wide atomization.

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1312001#c14)• 8 years ago |
|  | |

(In reply to Jann Horn from [comment #10](/show_bug.cgi?id=1312001#c10 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set"))
> > I think we should fix this by making ScrambleHashCode impossible
> > to invert offline.
>
> I think that that would almost certainly fix the ASLR leak part. I'm
> wondering about the remaining impact of being able to measure random
> collisions though. If an attacker could detect random collisions with
> buckets of size around 3 to 5 or so, that would probably still be sufficient
> for executing the attack on interned strings. And with small bucket counts,
> finding small random collisions shouldn't be too hard - and as soon as you
> have a small collision, finding more elements mapping into the same bucket
> is relatively easy.
Yep. You are right about all of this.
(In reply to Jann Horn from [comment #11](/show_bug.cgi?id=1312001#c11 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set"))
> I guess the nicest fix for that would be to have separate sets of interned
> strings for cross-origin frames, with only the predefined names common to
> all frames (in case you need them to be common for access to properties that
> are accessible cross-origin?). Would that work?
Or we can copy V8's behavior and use the same hash code for HashableValue that we use for the atoms table. That's a hash of the characters in the string, not the interned string's address, so it wouldn't change when an atom is GC'd.
But this means either adding a word to JSString; or caching hash codes in the OrderedHashTable, which increases its size by 1/4 \*and\* requires computing the hash code on every string-key lookup, which we currently skip when the key is already atomized. I hate to say it, but maybe Map and Set have to pay this cost. The alternatives seem to be "make the whole system pay".

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1312001#c15)• 8 years ago |
|  | |

(In reply to Jason Orendorff [:jorendorff] from [comment #14](/show_bug.cgi?id=1312001#c14 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set"))
> But this means either adding a word to JSString;
Maybe we only have to add this word to atoms. It's annoying, because we already have a different string size for fat inline strings, but not impossible I think.
Strings have 25 bits available in the flags word, so another option is to store the hash code in there. If that's too small, we could also use these bits to store an index into a Vector<HashNumber>. If we maintain the invariant that there's a 1:1 mapping between JSAtom\* and entry into this Vector, it should be easy to compact this Vector when we GC the atoms zone. When there are more than 2 \*\* 25 atoms (rare), we could use a HashMap<JSAtom\*, HashNumber> for the remaining atoms.

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312001#a2105026_281791)• 8 years ago |

Flags: needinfo?(jwalden+bmo) → needinfo?(jorendorff)

|  | [Ritu Kothari (:ritu) (Inactive, please n-i to RyanVM, jcristau, or pascal)](/user_profile?user_id=538805) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1312001#c16)• 8 years ago |
|  | |

Tracked for 50.1.0
[tracking-firefox50](/buglist.cgi?f1=cf_tracking_firefox50&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox50&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox50&o1=equals&v1=%2B)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1312001#c17)• 8 years ago |
|  | |

(In reply to Jan de Mooij [:jandem] from [comment #15](/show_bug.cgi?id=1312001#c15 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set"))
> (In reply to Jason Orendorff [:jorendorff] from [comment #14](/show_bug.cgi?id=1312001#c14 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set"))
> > But this means either adding a word to JSString;
>
> Maybe we only have to add this word to atoms. It's annoying, because we
> already have a different string size for fat inline strings, but not
> impossible I think.
Great, let's do this one. It's fine for the hash code to be stored differently depending on some other bit -- what are methods for?
> Strings have 25 bits available in the flags word, so another option is to
> store the hash code in there. [...]
Wow, this went downhill fast. :) I like the other idea better.

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1312001#c18)• 8 years ago |
|  | |

OK, the summary so far: We have two bugs.
1. Cross-domain information leak: a page can tell whether or not another page is using an atom, by trying to observe a string's hash code changing. If it changes, that means the atom was GC'd and recreated (at a different address), so no other page in the runtime is using that atom. Possible fixes:
\* Use separate atoms per domain; or
\* Add a hash code field to all atoms and use that for HashableValue (instead of the
pointer-based hash code we're currently using).
I like the latter.
2. Pointer leak: a page can reconstitute the hash code for a key by measuring performance effects of hash code collisions. The hash code of an object is the object's address. Possible fixes:
\* Use a random hash code for objects, storing it either in each object or in a side table; or
\* Do what [comment 9](/show_bug.cgi?id=1312001#c9 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set") says.
I'm not as sure here but let's try the latter and test performance.
Jeff, can you take this?Flags: needinfo?(jorendorff) → needinfo?(jwalden+bmo)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1312001#c19)• 8 years ago |
|  | |

(In reply to Jason Orendorff [:jorendorff] from [comment #18](/show_bug.cgi?id=1312001#c18 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set"))
> \* Add a hash code field to all atoms and use that for HashableValue
> (instead of the
> pointer-based hash code we're currently using).
>
> I like the latter.
I can try to do this part, as I'm probably most familiar with the string representation. It scares me a bit to backport a patch like this, but let's see how it turns out. Spinning this off to a new bug.

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312001#a2230156_375297)• 8 years ago |

Depends on: [CVE-2016-9904](/show_bug.cgi?id=1317936 "RESOLVED FIXED - Fix cross-origin information leak from shared atoms")

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1312001#c20)• 8 years ago |
|  | |

(In reply to Jason Orendorff [:jorendorff] from [comment #9](/show_bug.cgi?id=1312001#c9 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set"))
> I think we should fix this by making ScrambleHashCode impossible to invert
> offline.
We should do something similar for ShapeTable (it doesn't use js::HashMap), as that's another map with {int31, atom, symbol} keys and is probably also vulnerable.

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1312001#c21)• 8 years ago |
|  | |

What's the status here? With Hawaii and the holidays coming up we really don't have a lot of time.

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312001#a3458243_281791)• 8 years ago |

Assignee: nobody → jorendorffFlags: needinfo?(jwalden+bmo)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1312001#c22)• 8 years ago |
|  | |

Attached patch

[Scramble hash codes securely, to avoid leaking bits of object and string addresses](attachment.cgi?id=8815939&action=diff) (obsolete)
— [Details](attachment.cgi?id=8815939&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8815939)

MozReview-Commit-ID: yR1cIjrlPP
[Attachment #8815939](/attachment.cgi?id=8815939&action=edit "Scramble hash codes securely, to avoid leaking bits of object and string addresses") -
Flags: review?(jdemooij)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1312001#c23)• 8 years ago |
|  | |

This patch costs about 15% speed on microbenchmarks that just do Map.prototype.get in a tight loop, and 10% on other stuff like inserts. Jan, if you think we can do better by finding room for a hash code in JSObject, tell me where to look and I'll give it a shot.
Otherwise I'll look at ShapeTable next.

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1312001#c24)• 8 years ago |
|  | |

Attached image
[LookupHitTest-speed.png](attachment.cgi?id=8815942)
— [Details](attachment.cgi?id=8815942&action=edit)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1312001#c25)• 8 years ago |
|  | |

Attached image
[LookupMissTest-speed.png](attachment.cgi?id=8815943)
— [Details](attachment.cgi?id=8815943&action=edit)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1312001#c26)• 8 years ago |
|  | |

Oh, I should try to make up the perf difference by storing hash keys in every table entry. I'll try that first.

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1312001#c27)• 8 years ago |
|  | |

OK, [comment 26](/show_bug.cgi?id=1312001#c26 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set") was a dumb idea. Caching hash codes in the table doesn't eliminate any prepareHash calls. No point doing it (specially since equality testing is so cheap here).

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1312001#c28)• 8 years ago |
|  | |

(In reply to Jason Orendorff [:jorendorff] from [comment #23](/show_bug.cgi?id=1312001#c23 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set"))
> Jan, if you think we can do better by finding room for a hash code in JSObject,
> tell me where to look and I'll give it a shot.
No idea, I think this is really difficult.
> Otherwise I'll look at ShapeTable next.
For ShapeTable, we have jsid (= int/atom/symbol) keys. Int and atom jsids now use deterministic hashing that does not involve any memory addresses, so one option is to do the same for JS::Symbol (it has an unused word for GC alignment reasons that we could use to store a hash code). Fixing it in ShapeTable might be nice anyway to avoid DoS attacks, but adding a stable hash code to JS::Symbol and using it in HashId would be sufficient to stop the ASLR issues. What do you think?

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1312001#c29)• 8 years ago |
|  | |

(In reply to Jan de Mooij [:jandem] from [comment #28](/show_bug.cgi?id=1312001#c28 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set"))
> Fixing it in ShapeTable might be nice anyway to avoid DoS attacks
Nevermind this comment, I just read the comments in the patch and it's not meant to protect against DoS.

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1312001#c30)• 8 years ago |
|  | |

Comment on [attachment 8815939](/attachment.cgi?id=8815939 "Scramble hash codes securely, to avoid leaking bits of object and string addresses") [[details]](/attachment.cgi?id=8815939&action=edit "Scramble hash codes securely, to avoid leaking bits of object and string addresses") [[diff]](/attachment.cgi?id=8815939&action=diff "Scramble hash codes securely, to avoid leaking bits of object and string addresses") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8815939)
Scramble hash codes securely, to avoid leaking bits of object and string addresses
Review of [attachment 8815939](/attachment.cgi?id=8815939 "Scramble hash codes securely, to avoid leaking bits of object and string addresses") [[details]](/attachment.cgi?id=8815939&action=edit "Scramble hash codes securely, to avoid leaking bits of object and string addresses") [[diff]](/attachment.cgi?id=8815939&action=diff "Scramble hash codes securely, to avoid leaking bits of object and string addresses") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8815939):
-----------------------------------------------------------------
Very nice!
::: js/src/jsgc.cpp
@@ +246,5 @@
> using mozilla::ArrayLength;
> using mozilla::Get;
> using mozilla::Maybe;
> using mozilla::Swap;
> +using mozilla::HashCodeScrambler;
Nit: keep this sorted.
::: js/src/vm/Runtime.cpp
@@ +787,5 @@
> + return randomKeyGenerator\_.ref();
> +}
> +
> +mozilla::HashCodeScrambler
> +JSRuntime::randomHashCodeScrambler() {
Nit: { on next line.
::: mfbt/HashFunctions.h
@@ +346,5 @@
> + uint64\_t sipHash(uint64\_t m) {
> + // 2. Compression.
> + v3 ^= m;
> + sipRound();
> + v0 ^= m;
The reference implementation (<https://github.com/veorq/SipHash/blob/master/siphash24.c>) does another sipRound() here, IIUC. Is that not needed because our input length is constant and we don't have any bytes left?
@@ +372,5 @@
> + v1 ^= v2;
> + v2 = RotateLeft(v2, 32);
> + }
> +
> + uint64\_t v0, v1, v2, v3;
Nit: MFBT so should probably use mV0, mV1 etc here, and a\* prefix for arguments...
[Attachment #8815939](/attachment.cgi?id=8815939&action=edit "Scramble hash codes securely, to avoid leaking bits of object and string addresses") -
Flags: review?(jdemooij) → review+

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1312001#c31)• 8 years ago |
|  | |

> The reference implementation
> (<https://github.com/veorq/SipHash/blob/master/siphash24.c>) does another
> sipRound() here, IIUC. Is that not needed because our input length is
> constant and we don't have any bytes left?
The algorithm is designed for a variable number of rounds. SipHash-2-4 has 2 rounds per word of input, and 4 rounds to finish. SipHash-1-3 is considered sufficient for hash tables, according to: <https://github.com/rust-lang/rust/issues/29754>

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1312001#c32)• 8 years ago |
|  | |

Attached patch

[Scramble hash codes securely, to avoid leaking bits of object and string addresses](attachment.cgi?id=8817055&action=diff) (obsolete)
— [Details](attachment.cgi?id=8817055&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8817055)

MozReview-Commit-ID: yR1cIjrlPP

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312001#a4009097_281791)• 8 years ago |

[Attachment #8815939](/attachment.cgi?id=8815939&action=edit "Scramble hash codes securely, to avoid leaking bits of object and string addresses") -
Attachment is obsolete: true

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1312001#c33)• 8 years ago |
|  | |

Comment on [attachment 8817055](/attachment.cgi?id=8817055 "Scramble hash codes securely, to avoid leaking bits of object and string addresses") [[details]](/attachment.cgi?id=8817055&action=edit "Scramble hash codes securely, to avoid leaking bits of object and string addresses") [[diff]](/attachment.cgi?id=8817055&action=diff "Scramble hash codes securely, to avoid leaking bits of object and string addresses") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8817055)
Scramble hash codes securely, to avoid leaking bits of object and string addresses
> [Security approval request comment]
> How easily could an exploit be constructed based on the patch?
Not RCE but quite easy.
> Do comments in the patch, the check-in comment, or tests included in the
> patch paint a bulls-eye on the security problem?
Absolutely, yes.
> Which older supported branches are affected by this flaw?
All.
> Do you have backports for the affected branches? If not, how different,
> hard to create, and risky will they be?
No, but easy. This is medium-low risk.
> How likely is this patch to cause regressions; how much testing does it need?
It needs the usual CI testing. Regressions are possible, since I'm changing the implementation of JS Map and Set, but unlikely. I've run the JS unit tests and everything passes.
[Attachment #8817055](/attachment.cgi?id=8817055&action=edit "Scramble hash codes securely, to avoid leaking bits of object and string addresses") -
Flags: sec-approval?
[Attachment #8817055](/attachment.cgi?id=8817055&action=edit "Scramble hash codes securely, to avoid leaking bits of object and string addresses") -
Flags: review+

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1312001#c34)• 8 years ago |
|  | |

(In reply to Jason Orendorff [:jorendorff] from [comment #23](/show_bug.cgi?id=1312001#c23 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set"))
> This patch costs about 15% speed on microbenchmarks that just do
> Map.prototype.get in a tight loop, and 10% on other stuff like inserts.
I was thinking, as a followup we could maybe do this slower-scrambling only for object/symbol values? All other Values can be hashed without leaking memory addresses.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1312001#c35)• 8 years ago |
|  | |

Comment on [attachment 8817055](/attachment.cgi?id=8817055 "Scramble hash codes securely, to avoid leaking bits of object and string addresses") [[details]](/attachment.cgi?id=8817055&action=edit "Scramble hash codes securely, to avoid leaking bits of object and string addresses") [[diff]](/attachment.cgi?id=8817055&action=diff "Scramble hash codes securely, to avoid leaking bits of object and string addresses") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8817055)
Scramble hash codes securely, to avoid leaking bits of object and string addresses
sec-approval+ for trunk. We'll need this on affected branches (not release) as well.
[Attachment #8817055](/attachment.cgi?id=8817055&action=edit "Scramble hash codes securely, to avoid leaking bits of object and string addresses") -
Flags: sec-approval? → sec-approval+

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1312001#c36)• 8 years ago |
|  | |

> We'll need this on affected branches (not release) as well.
I'm confused -- all branches are affected, including ESR. It's an old bug.

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312001#a4528719_281791)• 8 years ago |

Flags: needinfo?(abillings)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1312001#c37)• 8 years ago |
|  | |

OK, I just need to think a bit more about [comment 28](/show_bug.cgi?id=1312001#c28 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set") before landing. I'll do it tomorrow.
Separately, we need to extend [bug 1317936](/show_bug.cgi?id=1317936 "RESOLVED FIXED - Fix cross-origin information leak from shared atoms")'s if-statement in HashValue() to cover "registry" Symbols (the kind created by Symbol.for(str)). I'll do that in this bug. Second round of sec-approval :-P

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1312001#c38)• 8 years ago |
|  | |

Attached patch

[Scramble hash codes securely, to avoid leaking bits of object and symbol addresses](attachment.cgi?id=8820073&action=diff) (obsolete)
— [Details](attachment.cgi?id=8820073&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8820073)

MozReview-Commit-ID: yR1cIjrlPP
[Attachment #8820073](/attachment.cgi?id=8820073&action=edit "Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Flags: review?(jdemooij)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312001#a5133314_281791)• 8 years ago |

[Attachment #8817055](/attachment.cgi?id=8817055&action=edit "Scramble hash codes securely, to avoid leaking bits of object and string addresses") -
Attachment is obsolete: true

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1312001#c39)• 8 years ago |
|  | |

(In reply to Jason Orendorff [:jorendorff] from [comment #36](/show_bug.cgi?id=1312001#c36 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set"))
> > We'll need this on affected branches (not release) as well.
>
> I'm confused -- all branches are affected, including ESR. It's an old bug.
This means "I want to see a patch made and nominated for Aurora, Beta, and ESR45 after this lands on Trunk. Please make and nominate this patch." Sorry if that wasn't clear.Flags: needinfo?(abillings)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312001#a5212098_280903)• 8 years ago |

Flags: needinfo?(jorendorff)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1312001#c40)• 8 years ago |
|  | |

Comment on [attachment 8820073](/attachment.cgi?id=8820073 "Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[details]](/attachment.cgi?id=8820073&action=edit "Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[diff]](/attachment.cgi?id=8820073&action=diff "Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8820073)
Scramble hash codes securely, to avoid leaking bits of object and symbol addresses
Review of [attachment 8820073](/attachment.cgi?id=8820073 "Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[details]](/attachment.cgi?id=8820073&action=edit "Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[diff]](/attachment.cgi?id=8820073&action=diff "Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8820073):
-----------------------------------------------------------------
::: js/src/builtin/MapObject.cpp
@@ +70,4 @@
> {
> // HashableValue::setValue normalizes values so that the SameValue relation
> // on HashableValues is the same as the == relationship on
> + // value.asRawBits(). So why not just return that? Security.
Thanks. It was on my TODO list to fix this comment later, but with the atom bug already fixed on all branches it seems fine to do this now.
@@ +83,5 @@
> + Symbol\* sym = v.toSymbol();
> + if (sym->isWellKnownSymbol())
> + return HashNumber(sym->code());
> + if (sym->code() == SymbolCode::InSymbolRegistry)
> + return sym->description()->hash();
If we need something similar for HashId, we can factor it out to HashSymbol or Symbol::hash() probably.
@@ +92,1 @@
> return v.asRawBits();
MOZ\_ASSERT(!v.isMarkable()); here to avoid regressing this when a new GC type is added.
::: js/src/jit-test/tests/collections/Map-scale.js
@@ +1,5 @@
> // Maps can hold at least 64K values.
>
> var N = 1 << 16;
> var m = new Map;
> +for (var i = 0; i < N; i++) {
Nit: revert test change.
[Attachment #8820073](/attachment.cgi?id=8820073&action=edit "Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Flags: review?(jdemooij) → review+

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1312001#c41)• 8 years ago |
|  | |

Comment on [attachment 8820073](/attachment.cgi?id=8820073 "Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[details]](/attachment.cgi?id=8820073&action=edit "Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[diff]](/attachment.cgi?id=8820073&action=diff "Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8820073)
Scramble hash codes securely, to avoid leaking bits of object and symbol addresses
NOTE: Same answers as last time (see [comment 33](/show_bug.cgi?id=1312001#c33 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set")) except the last question.
It's a new patch for the same issue.
> [Security approval request comment]
> How easily could an exploit be constructed based on the patch?
Not RCE but quite easy.
> Do comments in the patch, the check-in comment, or tests included in the
> patch paint a bulls-eye on the security problem?
Absolutely, yes.
> Which older supported branches are affected by this flaw?
All.
> Do you have backports for the affected branches? If not, how different,
> hard to create, and risky will they be?
No, but easy. This is medium-low risk.
> How likely is this patch to cause regressions; how much testing does it need?
It needs the usual CI testing. Regressions are possible, since I'm changing the implementation of JS Map and Set. A bit more likely than last time, as the patch is a bit more complex. I've run the JS unit tests and everything passes.Flags: needinfo?(jorendorff)
[Attachment #8820073](/attachment.cgi?id=8820073&action=edit "Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Flags: sec-approval?

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1312001#c42)• 8 years ago |
|  | |

Comment on [attachment 8820073](/attachment.cgi?id=8820073 "Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[details]](/attachment.cgi?id=8820073&action=edit "Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[diff]](/attachment.cgi?id=8820073&action=diff "Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8820073)
Scramble hash codes securely, to avoid leaking bits of object and symbol addresses
sec-approval+ for trunk. We'll want this everywhere affected if we can do it soon.
[Attachment #8820073](/attachment.cgi?id=8820073&action=edit "Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Flags: sec-approval? → sec-approval+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312001#a6420120_280903)• 8 years ago |

[status-firefox50](/buglist.cgi?f1=cf_status_firefox50&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=wontfix)
[status-firefox-esr45](/buglist.cgi?f1=cf_status_firefox_esr45&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=affected)
[tracking-firefox-esr45](/buglist.cgi?f1=cf_tracking_firefox_esr45&o1=isnotempty):
--- → [51+](/buglist.cgi?f1=cf_tracking_firefox_esr45&o1=equals&v1=51%2B)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312001#a6420135_280903)• 8 years ago |

[status-firefox53](/buglist.cgi?f1=cf_status_firefox53&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox53&o1=equals&v1=affected)
[tracking-firefox53](/buglist.cgi?f1=cf_tracking_firefox53&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox53&o1=equals&v1=%2B)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1312001#c43)• 8 years ago |
|  | |

Jann, our release is on January 24. Is there any way to move your disclosure out a week from the January 21 so we can get our release out the door first? We did fix the other related issue in 50.1 in [bug 1317936](/show_bug.cgi?id=1317936 "RESOLVED FIXED - Fix cross-origin information leak from shared atoms") .Flags: needinfo?(jann+mozilla)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1312001#c44)• 8 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/c484c1e7eeb61f4abd6d9e2352eacd52b1a47cbf>
[Bug 1312001](/show_bug.cgi?id=1312001 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set") - Scramble hash codes securely, to avoid leaking bits of object and symbol addresses.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1312001#c45)• 8 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/c484c1e7eeb6>
Please request Aurora/Beta/ESR45 approval (and attached rebased patches if necessary) ASAP.Status: NEW → RESOLVEDClosed: 8 years ago
[status-firefox53](/buglist.cgi?f1=cf_status_firefox53&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox53&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox53&o1=equals&v1=fixed)Flags: needinfo?(jorendorff)Resolution: --- → FIXEDTarget Milestone: --- → mozilla53

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1312001#c46)• 8 years ago |
|  | |

We also still have to fix the ShapeTable thing, right?

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1312001#c47)• 8 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=bb9955655951>

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=1312001#c48)• 8 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=6df545f5d0d1>

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=1312001#c49)• 8 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=a7ab702b2974>

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=1312001#c50)• 8 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=e3ab56005733>

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=1312001#c51)• 8 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=d4cf8a0c64b7>

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312001#a7108143_75935)• 8 years ago |

Status: RESOLVED → REOPENED
[status-firefox53](/buglist.cgi?f1=cf_status_firefox53&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox53&o1=equals&v1=fixed) → [affected](/buglist.cgi?f1=cf_status_firefox53&o1=equals&v1=affected)Resolution: FIXED → ---Target Milestone: mozilla53 → ---

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=1312001#c52)• 8 years ago |
|  | |

Attached patch

[(aurora) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses](attachment.cgi?id=8825939&action=diff)
— [Details](attachment.cgi?id=8825939&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8825939)

MozReview-Commit-ID: yR1cIjrlPP

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312001#a7111608_281791)• 8 years ago |

[Attachment #8820073](/attachment.cgi?id=8820073&action=edit "Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Attachment is obsolete: true

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=1312001#c53)• 8 years ago |
|  | |

Attached patch

[(beta) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses](attachment.cgi?id=8825943&action=diff)
— [Details](attachment.cgi?id=8825943&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8825943)

MozReview-Commit-ID: yR1cIjrlPP

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312001#a7111990_281791)• 8 years ago |

[Attachment #8825939](/attachment.cgi?id=8825939&action=edit "(aurora) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Attachment is obsolete: true

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=1312001#c54)• 8 years ago |
|  | |

Attached patch

[(release) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses](attachment.cgi?id=8825944&action=diff)
— [Details](attachment.cgi?id=8825944&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8825944)

MozReview-Commit-ID: yR1cIjrlPP

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312001#a7112024_281791)• 8 years ago |

[Attachment #8825943](/attachment.cgi?id=8825943&action=edit "(beta) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Attachment is obsolete: true

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=1312001#c55)• 8 years ago |
|  | |

Comment on [attachment 8825939](/attachment.cgi?id=8825939 "(aurora) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[details]](/attachment.cgi?id=8825939&action=edit "(aurora) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[diff]](/attachment.cgi?id=8825939&action=diff "(aurora) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8825939)
(aurora) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses
Requesting approval for aurora. For answers to sec-approval questions, see [comment 41](/show_bug.cgi?id=1312001#c41 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set").
[Attachment #8825939](/attachment.cgi?id=8825939&action=edit "(aurora) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Attachment description: Scramble hash codes securely, to avoid leaking bits of object and symbol addresses → (aurora) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses
[Attachment #8825939](/attachment.cgi?id=8825939&action=edit "(aurora) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Attachment is obsolete: false
[Attachment #8825939](/attachment.cgi?id=8825939&action=edit "(aurora) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Flags: sec-approval?

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=1312001#c56)• 8 years ago |
|  | |

Comment on [attachment 8825943](/attachment.cgi?id=8825943 "(beta) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[details]](/attachment.cgi?id=8825943&action=edit "(beta) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[diff]](/attachment.cgi?id=8825943&action=diff "(beta) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8825943)
(beta) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses
Requesting approval for beta. For answers to sec-approval questions, see [comment 41](/show_bug.cgi?id=1312001#c41 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set").
[Attachment #8825943](/attachment.cgi?id=8825943&action=edit "(beta) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Attachment description: Scramble hash codes securely, to avoid leaking bits of object and symbol addresses → (beta) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses
[Attachment #8825943](/attachment.cgi?id=8825943&action=edit "(beta) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Attachment is obsolete: false
[Attachment #8825943](/attachment.cgi?id=8825943&action=edit "(beta) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Flags: sec-approval?

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=1312001#c57)• 8 years ago |
|  | |

Comment on [attachment 8825944](/attachment.cgi?id=8825944 "(release) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[details]](/attachment.cgi?id=8825944&action=edit "(release) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[diff]](/attachment.cgi?id=8825944&action=diff "(release) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8825944)
(release) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses
Requesting approval for release. For answers to sec-approval questions, see [comment 41](/show_bug.cgi?id=1312001#c41 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set").
[Attachment #8825944](/attachment.cgi?id=8825944&action=edit "(release) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Attachment description: Scramble hash codes securely, to avoid leaking bits of object and symbol addresses → (release) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses
[Attachment #8825944](/attachment.cgi?id=8825944&action=edit "(release) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Flags: sec-approval?

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=1312001#c58)• 8 years ago |
|  | |

Comment on [attachment 8825939](/attachment.cgi?id=8825939 "(aurora) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[details]](/attachment.cgi?id=8825939&action=edit "(aurora) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[diff]](/attachment.cgi?id=8825939&action=diff "(aurora) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8825939)
(aurora) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses
Approval Request Comment
[Feature/Bug causing the regression]: 1312001
[User impact if declined]: sec-high security risk that will be disclosed this month.
[Is this code covered by automated tests?]: Yes.
[Has the fix been verified in Nightly?]: Yes.
[Needs manual test from QE? If yes, steps to reproduce]: Unzip the tar from the original report. Visit the file: URL for the attack.html file. After a second or two, you should see "NO RESULT FOUND (CONTRADICTION)". If you see a hexadecimal number instead, that's bad.
[List of other uplifts needed for the feature/fix]: Everywhere.
[Is the change risky?]: Slightly.
[Why is the change risky/not risky?]: Risky because it's a largeish patch that affects JS Map/Set code; slight because that code is well tested.
[String changes made/needed]: none
[Attachment #8825939](/attachment.cgi?id=8825939&action=edit "(aurora) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Flags: sec-approval? → approval-mozilla-aurora?

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=1312001#c59)• 8 years ago |
|  | |

Comment on [attachment 8825943](/attachment.cgi?id=8825943 "(beta) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[details]](/attachment.cgi?id=8825943&action=edit "(beta) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[diff]](/attachment.cgi?id=8825943&action=diff "(beta) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8825943)
(beta) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses
See [comment 58](/show_bug.cgi?id=1312001#c58 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set").
[Attachment #8825943](/attachment.cgi?id=8825943&action=edit "(beta) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Flags: sec-approval? → approval-mozilla-beta?

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 60](/show_bug.cgi?id=1312001#c60)• 8 years ago |
|  | |

Comment on [attachment 8825944](/attachment.cgi?id=8825944 "(release) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[details]](/attachment.cgi?id=8825944&action=edit "(release) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[diff]](/attachment.cgi?id=8825944&action=diff "(release) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8825944)
(release) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses
See [comment 58](/show_bug.cgi?id=1312001#c58 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set").
[Attachment #8825944](/attachment.cgi?id=8825944&action=edit "(release) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Flags: sec-approval? → approval-mozilla-release?

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 61](/show_bug.cgi?id=1312001#c61)• 8 years ago |
|  | |

This stuff backported pretty cleanly. There was a conflict with rev aeb98c845e96, easily fixed.Flags: needinfo?(jorendorff)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 62](/show_bug.cgi?id=1312001#c62)• 8 years ago |
|  | |

Attached patch

[(esr45) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses](attachment.cgi?id=8825986&action=diff)
— [Details](attachment.cgi?id=8825986&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8825986)

MozReview-Commit-ID: yR1cIjrlPP

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312001#a7120282_281791)• 8 years ago |

[Attachment #8825939](/attachment.cgi?id=8825939&action=edit "(aurora) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Attachment is obsolete: true
[Attachment #8825939](/attachment.cgi?id=8825939&action=edit "(aurora) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Flags: approval-mozilla-aurora?

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312001#a7120284_281791)• 8 years ago |

[Attachment #8825943](/attachment.cgi?id=8825943&action=edit "(beta) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Attachment is obsolete: true
[Attachment #8825943](/attachment.cgi?id=8825943&action=edit "(beta) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Flags: approval-mozilla-beta?

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312001#a7120285_281791)• 8 years ago |

[Attachment #8825944](/attachment.cgi?id=8825944&action=edit "(release) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Attachment is obsolete: true
[Attachment #8825944](/attachment.cgi?id=8825944&action=edit "(release) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Flags: approval-mozilla-release?

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 63](/show_bug.cgi?id=1312001#c63)• 8 years ago |
|  | |

Comment on [attachment 8825939](/attachment.cgi?id=8825939 "(aurora) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[details]](/attachment.cgi?id=8825939&action=edit "(aurora) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[diff]](/attachment.cgi?id=8825939&action=diff "(aurora) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8825939)
(aurora) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses
(Ugh. hg bzexport marked this obsolete for me.)
See [comment 58](/show_bug.cgi?id=1312001#c58 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set").
[Attachment #8825939](/attachment.cgi?id=8825939&action=edit "(aurora) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Attachment is obsolete: false
[Attachment #8825939](/attachment.cgi?id=8825939&action=edit "(aurora) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Flags: approval-mozilla-aurora?

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 64](/show_bug.cgi?id=1312001#c64)• 8 years ago |
|  | |

Comment on [attachment 8825943](/attachment.cgi?id=8825943 "(beta) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[details]](/attachment.cgi?id=8825943&action=edit "(beta) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[diff]](/attachment.cgi?id=8825943&action=diff "(beta) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8825943)
(beta) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses
See [comment 58](/show_bug.cgi?id=1312001#c58 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set").
[Attachment #8825943](/attachment.cgi?id=8825943&action=edit "(beta) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Attachment is obsolete: false
[Attachment #8825943](/attachment.cgi?id=8825943&action=edit "(beta) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Flags: approval-mozilla-beta?

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 65](/show_bug.cgi?id=1312001#c65)• 8 years ago |
|  | |

Comment on [attachment 8825944](/attachment.cgi?id=8825944 "(release) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[details]](/attachment.cgi?id=8825944&action=edit "(release) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[diff]](/attachment.cgi?id=8825944&action=diff "(release) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8825944)
(release) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses
See [comment 58](/show_bug.cgi?id=1312001#c58 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set").
[Attachment #8825944](/attachment.cgi?id=8825944&action=edit "(release) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Attachment is obsolete: false
[Attachment #8825944](/attachment.cgi?id=8825944&action=edit "(release) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Flags: approval-mozilla-release?

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 66](/show_bug.cgi?id=1312001#c66)• 8 years ago |
|  | |

Comment on [attachment 8825986](/attachment.cgi?id=8825986 "(esr45) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[details]](/attachment.cgi?id=8825986&action=edit "(esr45) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[diff]](/attachment.cgi?id=8825986&action=diff "(esr45) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8825986)
(esr45) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses
[Approval Request Comment]
User impact if declined: sec-high security risk
Fix Landed on Version: 50 (current Nightly)
Risk to taking this patch (and alternatives if risky): slight (see [comment 58](/show_bug.cgi?id=1312001#c58 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set"))
String or UUID changes made by this patch: none
[Attachment #8825986](/attachment.cgi?id=8825986&action=edit "(esr45) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Attachment description: Scramble hash codes securely, to avoid leaking bits of object and symbol addresses → (esr45) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses
[Attachment #8825986](/attachment.cgi?id=8825986&action=edit "(esr45) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Flags: approval-mozilla-esr45?

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 67](/show_bug.cgi?id=1312001#c67)• 8 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=8171cab46d7f>

|  | [Jann Horn](/user_profile?user_id=500267)  Reporter |  |
| --- | --- | --- |
| [Comment 68](/show_bug.cgi?id=1312001#c68)• 8 years ago |
|  | |

(In reply to Al Billings [:abillings] from [comment #43](/show_bug.cgi?id=1312001#c43 "VERIFIED FIXED - ASLR leak and cross-frame oracle via pointer scrambling in Map/Set"))
> Jann, our release is on January 24. Is there any way to move your disclosure
> out a week from the January 21 so we can get our release out the door first?
> We did fix the other related issue in 50.1 in [bug 1317936](/show_bug.cgi?id=1317936 "RESOLVED FIXED - Fix cross-origin information leak from shared atoms") .
Sorry about the late reply.
Yes, that's fine with me.Flags: needinfo?(jann+mozilla)

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 69](/show_bug.cgi?id=1312001#c69)• 8 years ago |
|  | |

Comment on [attachment 8825944](/attachment.cgi?id=8825944 "(release) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[details]](/attachment.cgi?id=8825944&action=edit "(release) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[diff]](/attachment.cgi?id=8825944&action=diff "(release) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8825944)
(release) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses
there won't be a 50 dot release for this
[Attachment #8825944](/attachment.cgi?id=8825944&action=edit "(release) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Flags: approval-mozilla-release? → approval-mozilla-release-

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 70](/show_bug.cgi?id=1312001#c70)• 8 years ago |
|  | |

sec-approval+ if that is needed here.

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312001#a7193842_451704)• 8 years ago |

[Attachment #8825939](/attachment.cgi?id=8825939&action=edit "(aurora) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 71](/show_bug.cgi?id=1312001#c71)• 8 years ago |
|  | |

Comment on [attachment 8825943](/attachment.cgi?id=8825943 "(beta) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[details]](/attachment.cgi?id=8825943&action=edit "(beta) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[diff]](/attachment.cgi?id=8825943&action=diff "(beta) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312001&attachment=8825943)
(beta) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses
This should land for today's beta 14 build.
[Attachment #8825943](/attachment.cgi?id=8825943&action=edit "(beta) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312001#a7193897_451704)• 8 years ago |

[Attachment #8825986](/attachment.cgi?id=8825986&action=edit "(esr45) Scramble hash codes securely, to avoid leaking bits of object and symbol addresses") -
Flags: approval-mozilla-esr45? → approval-mozilla-esr45+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 72](/show_bug.cgi?id=1312001#c72)• 8 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/a4996e963d0d>
<https://hg.mozilla.org/releases/mozilla-beta/rev/91be97c8b0ac>
Talked this over with jandem and decided it was better to move the ShapeTable work to a follow-up bug since this one is already getting confusing enough to track.Status: REOPENED → RESOLVEDClosed: 8 years ago → 8 years ago
[status-firefox51](/buglist.cgi?f1=cf_status_firefox51&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=fixed)
[status-firefox52](/buglist.cgi?f1=cf_status_firefox52&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=fixed)
[status-firefox53](/buglist.cgi?f1=cf_status_firefox53&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox53&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox53&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla53

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312001#a7195719_75935)• 8 years ago |

Depends on: [1330769](/show_bug.cgi?id=1330769 "RESOLVED FIXED - ASLR leak via pointer scrambling in ShapeTable")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312001#a7197151_1689)• 8 years ago |

Group: javascript-core-security → core-security-release

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 73](/show_bug.cgi?id=1312001#c73)• 8 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr45/rev/c5e67d41bdd0>
[status-firefox-esr45](/buglist.cgi?f1=cf_status_firefox_esr45&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=fixed)

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312001#a7618346_452604)• 8 years ago |

Flags: qe-verify+QA Contact: mwobensmithWhiteboard: Disclosure date ~Jan 21 2017 (note Fx51 scheduled for Jan 24) → [post-critsmash-triage] Disclosure date ~Jan 21 2017 (note Fx51 scheduled for Jan 24)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312001#a7638262_280903)• 8 years ago |

Whiteboard: [post-critsmash-triage] Disclosure date ~Jan 21 2017 (note Fx51 scheduled for Jan 24) → [post-critsmash-triage][adv-main51+][adv-esr45.7+] Disclosure date ~Jan 21 2017 (note Fx51 scheduled for Jan 24)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312001#a7644263_280903)• 8 years ago |

Alias: CVE-2017-5378

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Comment 74](/show_bug.cgi?id=1312001#c74)• 8 years ago |
|  | |

I was able to see the behavior on Windows and Linux using "attack.html" PoC. The Mac doesn't seem to exhibit the issue using this test case. Also, I was never able to get the other PoC to work on any platform.
Confirmed bug on Fx50 and Fx53, using builds from 2016-11.
Verified fixed on Fx 51.0b14 and Fx 45.7.0 ESR.
Jann, have you tried our latest builds to make sure that we have fixed this issue?Status: RESOLVED → VERIFIED
[status-firefox51](/buglist.cgi?f1=cf_status_firefox51&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=verified)Flags: needinfo?(jann+mozilla)

|  | [Jann Horn](/user_profile?user_id=500267)  Reporter |  |
| --- | --- | --- |
| [Comment 75](/show_bug.cgi?id=1312001#c75)• 8 years ago |
|  | |

Both POCs stopped working for me in Nightly, and the patches look sane to me (but I'm not really familiar with the Firefox codebase).Flags: needinfo?(jann+mozilla)

|  | [Andrei Vaida [:avaida]](/user_profile?user_id=488993) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312001#a12338909_488993)• 8 years ago |

Flags: qe-verify+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312001#a32011161_1689)• 7 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1312001&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jann Horn](/user_profile?user_id=500267)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


