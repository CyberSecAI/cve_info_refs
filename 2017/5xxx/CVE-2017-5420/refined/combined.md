=== Content from wiki.mozilla.org_3659d679_20250126_121456.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from wiki.mozilla.org_73f8d6fa_20250126_121456.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from www.mozilla.org_087ffa14_20250125_215514.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2017-05

## Security vulnerabilities fixed in Firefox 52

Announced
March 7, 2017
Impact
critical
Products
Firefox
Fixed in

* Firefox 52

#### [#CVE-2017-5400: asm.js JIT-spray bypass of ASLR and DEP](#CVE-2017-5400)

Reporter
Rh0
Impact
critical
##### Description

JIT-spray targeting asm.js combined with a heap spray allows for a bypass of ASLR and DEP protections leading to potential memory corruption attacks.

##### References

* [Bug 1334933](https://bugzilla.mozilla.org/show_bug.cgi?id=1334933)

#### [#CVE-2017-5401: Memory Corruption when handling ErrorResult](#CVE-2017-5401)

Reporter
Anton Eliasson
Impact
critical
##### Description

A crash triggerable by web content in which an `ErrorResult` references unassigned memory due to a logic error. The resulting crash may be exploitable.

##### References

* [Bug 1328861](https://bugzilla.mozilla.org/show_bug.cgi?id=1328861)

#### [#CVE-2017-5402: Use-after-free working with events in FontFace objects](#CVE-2017-5402)

Reporter
Nils
Impact
critical
##### Description

A use-after-free can occur when events are fired for a `FontFace` object after the object has been already been destroyed while working with fonts. This results in a potentially exploitable crash.

##### References

* [Bug 1334876](https://bugzilla.mozilla.org/show_bug.cgi?id=1334876)

#### [#CVE-2017-5403: Use-after-free using addRange to add range to an incorrect root object](#CVE-2017-5403)

Reporter
Nils
Impact
critical
##### Description

When adding a range to an object in the DOM, it is possible to use `addRange` to add the range to an incorrect root object. This triggers a use-after-free, resulting in a potentially exploitable crash.

##### References

* [Bug 1340186](https://bugzilla.mozilla.org/show_bug.cgi?id=1340186)

#### [#CVE-2017-5404: Use-after-free working with ranges in selections](#CVE-2017-5404)

Reporter
Ivan Fratric of Google Project Zero
Impact
critical
##### Description

A use-after-free error can occur when manipulating ranges in selections with one node inside a native anonymous tree and one node outside of it. This results in a potentially exploitable crash.

##### References

* [Bug 1340138](https://bugzilla.mozilla.org/show_bug.cgi?id=1340138)

#### [#CVE-2017-5406: Segmentation fault in Skia with canvas operations](#CVE-2017-5406)

Reporter
Atte Kettunen
Impact
high
##### Description

A segmentation fault can occur in the Skia graphics library during some canvas operations due to issues with mask/clip intersection and empty masks.

##### References

* [Bug 1306890](https://bugzilla.mozilla.org/show_bug.cgi?id=1306890)

#### [#CVE-2017-5407: Pixel and history stealing via floating-point timing side channel with SVG filters](#CVE-2017-5407)

Reporter
David Kohlbrenner
Impact
high
##### Description

Using SVG filters that don't use the fixed point math implementation on a target iframe, a malicious page can extract pixel values from a targeted user. This can be used to extract history information and read text values across domains. This violates same-origin policy and leads to information disclosure.

##### References

* [Bug 1336622](https://bugzilla.mozilla.org/show_bug.cgi?id=1336622)

#### [#CVE-2017-5410: Memory corruption during JavaScript garbage collection incremental sweeping](#CVE-2017-5410)

Reporter
Jerri Rice
Impact
high
##### Description

Memory corruption resulting in a potentially exploitable crash during garbage collection of JavaScript due errors in how incremental sweeping is managed for memory cleanup.

##### References

* [Bug 1330687](https://bugzilla.mozilla.org/show_bug.cgi?id=1330687)

#### [#CVE-2017-5411: Use-after-free in Buffer Storage in libGLES](#CVE-2017-5411)

Reporter
Looben Yang
Impact
high
##### Description

A use-after-free can occur during buffer storage operations within the ANGLE graphics library, used for WebGL content. The buffer storage can be freed while still in use in some circumstances, leading to a potentially exploitable crash.
*Note: This issue is in `libGLES`, which is only in use on Windows. Other operating systems are not affected.*

##### References

* [Bug 1325511](https://bugzilla.mozilla.org/show_bug.cgi?id=1325511)

#### [#CVE-2017-5409: File deletion via callback parameter in Mozilla Windows Updater and Maintenance Service](#CVE-2017-5409)

Reporter
Holger Fuhrmannek
Impact
moderate
##### Description

The Mozilla Windows updater can be called by a non-privileged user to delete an arbitrary local file by passing a special path to the callback parameter through the Mozilla Maintenance Service, which has privileged access.
*Note: This attack requires local system access and only affects Windows. Other operating systems are not affected.*

##### References

* [Bug 1321814](https://bugzilla.mozilla.org/show_bug.cgi?id=1321814)

#### [#CVE-2017-5408: Cross-origin reading of video captions in violation of CORS](#CVE-2017-5408)

Reporter
Eric Lawrence of Chrome Security
Impact
moderate
##### Description

Video files loaded video captions cross-origin without checking for the presence of CORS headers permitting such cross-origin use, leading to potential information disclosure for video captions.

##### References

* [Bug 1313711](https://bugzilla.mozilla.org/show_bug.cgi?id=1313711)

#### [#CVE-2017-5412: Buffer overflow read in SVG filters](#CVE-2017-5412)

Reporter
Atte Kettunen
Impact
moderate
##### Description

A buffer overflow read during SVG filter color value operations, resulting in data exposure.

##### References

* [Bug 1328323](https://bugzilla.mozilla.org/show_bug.cgi?id=1328323)

#### [#CVE-2017-5413: Segmentation fault during bidirectional operations](#CVE-2017-5413)

Reporter
Atte Kettunen
Impact
moderate
##### Description

A segmentation fault can occur during some bidirectional layout operations.

##### References

* [Bug 1337504](https://bugzilla.mozilla.org/show_bug.cgi?id=1337504)

#### [#CVE-2017-5414: File picker can choose incorrect default directory](#CVE-2017-5414)

Reporter
Abdulrahman Alqabandi
Impact
moderate
##### Description

The file picker dialog can choose and display the wrong local default directory when instantiated. On some operating systems, this can lead to information disclosure, such as the operating system or the local account name.

##### References

* [Bug 1319370](https://bugzilla.mozilla.org/show_bug.cgi?id=1319370)

#### [#CVE-2017-5415: Addressbar spoofing through blob URL](#CVE-2017-5415)

Reporter
Abdulrahman Alqabandi
Impact
moderate
##### Description

An attack can use a blob URL and script to spoof an arbitrary addressbar URL prefaced by `blob:` as the protocol, leading to user confusion and further spoofing attacks.

##### References

* [Bug 1321719](https://bugzilla.mozilla.org/show_bug.cgi?id=1321719)

#### [#CVE-2017-5416: Null dereference crash in HttpChannel](#CVE-2017-5416)

Reporter
Radek 'sysKin' Czyz
Impact
moderate
##### Description

In certain circumstances a networking event listener can be prematurely released. This appears to result in a null dereference in practice.

##### References

* [Bug 1328121](https://bugzilla.mozilla.org/show_bug.cgi?id=1328121)

#### [#CVE-2017-5417: Addressbar spoofing by draging and dropping URLs](#CVE-2017-5417)

Reporter
Michal Zalewski
Impact
moderate
##### Description

When dragging content from the primary browser pane to the addressbar on a malicious site, it is possible to change the addressbar so that the displayed location following navigation does not match the URL of the newly loaded page. This allows for spoofing attacks.

##### References

* [Bug 791597](https://bugzilla.mozilla.org/show_bug.cgi?id=791597)

#### [#CVE-2017-5425: Overly permissive Gecko Media Plugin sandbox regular expression access](#CVE-2017-5425)

Reporter
Haik Aftandilian
Impact
moderate
##### Description

The Gecko Media Plugin sandbox allows access to local files that match specific regular expressions. On OS OX, this matching allows access to some data in subdirectories of `/private/var` that could expose personal or temporary data. This has been updated to not allow access to `/private/var` and its subdirectories.
*Note: this issue only affects OS X. Other operating systems are not affected.*

##### References

* [Bug 1322716](https://bugzilla.mozilla.org/show_bug.cgi?id=1322716)

#### [#CVE-2017-5426: Gecko Media Plugin sandbox is not started if seccomp-bpf filter is running](#CVE-2017-5426)

Reporter
Jed Davis
Impact
moderate
##### Description

On Linux, if the secure computing mode BPF (seccomp-bpf) filter is running when the Gecko Media Plugin sandbox is started, the sandbox fails to be applied and items that would run within the sandbox are run protected only by the running filter which is typically weak compared to the sandbox.
*Note: this issue only affects Linux. Other operating systems are not affected.*

##### References

* [Bug 1257361](https://bugzilla.mozilla.org/show_bug.cgi?id=1257361)

#### [#CVE-2017-5427: Non-existent chrome.manifest file loaded during startup](#CVE-2017-5427)

Reporter
Mike Kaply
Impact
moderate
##### Description

A non-existent chrome.manifest file will attempt to be loaded during startup from the primary installation directory. If a malicious user with local access puts chrome.manifest and other referenced files in this directory, they will be loaded and activated during startup. This could result in malicious software being added without consent or modification of referenced installed files.

##### References

* [Bug 1295542](https://bugzilla.mozilla.org/show_bug.cgi?id=1295542)

#### [#CVE-2017-5418: Out of bounds read when parsing HTTP digest authorization responses](#CVE-2017-5418)

Reporter
Anonymous
Impact
low
##### Description

An out of bounds read error occurs when parsing some HTTP digest authorization responses, resulting in information leakage through the reading of random memory containing matches to specifically set patterns.

##### References

* [Bug 1338876](https://bugzilla.mozilla.org/show_bug.cgi?id=1338876)

#### [#CVE-2017-5419: Repeated authentication prompts lead to DOS attack](#CVE-2017-5419)

Reporter
Chris Hamono
Impact
low
##### Description

If a malicious site repeatedly triggers a modal authentication prompt, eventually the browser UI will become non-responsive, requiring shutdown through the operating system. This is a denial of service (DOS) attack.

##### References

* [Bug 1312243](https://bugzilla.mozilla.org/show_bug.cgi?id=1312243)

#### [#CVE-2017-5420: Javascript: URLs can obfuscate addressbar location](#CVE-2017-5420)

Reporter
Abdulrahman Alqabandi
Impact
low
##### Description

A `javascript:` url loaded by a malicious page can obfuscate its location by blanking the URL displayed in the addressbar, allowing for an attacker to spoof an existing page without the malicious page's address being displayed correctly.

##### References

* [Bug 1284395](https://bugzilla.mozilla.org/show_bug.cgi?id=1284395)

#### [#CVE-2017-5405: FTP response codes can cause use of uninitialized values for ports](#CVE-2017-5405)

Reporter
Anonymous
Impact
low
##### Description

Certain response codes in FTP connections can result in the use of uninitialized values for ports in FTP operations.

##### References

* [Bug 1336699](https://bugzilla.mozilla.org/show_bug.cgi?id=1336699)

#### [#CVE-2017-5421: Print preview spoofing](#CVE-2017-5421)

Reporter
Abdulrahman Alqabandi
Impact
low
##### Description

A malicious site could spoof the contents of the print preview window if popup windows are enabled, resulting in user confusion of what site is currently loaded.

##### References

* [Bug 1301876](https://bugzilla.mozilla.org/show_bug.cgi?id=1301876)

#### [#CVE-2017-5422: DOS attack by using view-source: protocol repeatedly in one hyperlink](#CVE-2017-5422)

Reporter
Alex Bolton
Impact
low
##### Description

If a malicious site uses the `view-source:` protocol in a series within a single hyperlink, it can trigger a non-exploitable browser crash when the hyperlink is selected. This was fixed by no longer making `view-source:` linkable.

##### References

* [Bug 1295002](https://bugzilla.mozilla.org/show_bug.cgi?id=1295002)

#### [#CVE-2017-5399: Memory safety bugs fixed in Firefox 52](#CVE-2017-5399)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Carsten Book, Calixte Denizet, Christian Holler, Andrew McCreight, David Bolter, David Keeler, Jon Coppeard, Tyson Smith, Ronald Crane, Tooru Fujisawa, Ben Kelly, Bob Owen, Jed Davis, Julian Seward, Julian Hector, Philipp, Markus Stange, and André Bargull reported memory safety bugs present in Firefox 51. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 52](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1332569%2C1315248%2C1261335%2C1321038%2C1331771%2C1339566%2C1339591%2C1240893%2C1341905%2C1323241%2C1336467%2C1270288%2C1295299%2C1296024%2C1304201%2C1306142%2C1307557%2C1308036%2C1334246%2C1334290%2C1317085%2C1339116%2C1324000%2C1323150%2C1332501%2C1320894%2C1333752%2C1303713%2C1321566%2C1264053%2C1343513)

#### [#CVE-2017-5398: Memory safety bugs fixed in Firefox 52 and Firefox ESR 45.8](#CVE-2017-5398)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Boris Zbarsky, Christian Holler, Honza Bambas, Jon Coppeard, Randell Jesup, André Bargull, Kan-Ru Chen, and Nathan Froyd reported memory safety bugs present in Firefox 51 and Firefox ESR 45.7. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 52 and Firefox ESR 45.8](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1332550%2C1332597%2C1338383%2C1321612%2C1322971%2C1333568%2C1333887%2C1335450%2C1325052%2C1324379%2C1336510)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_f9bc164d_20250126_121454.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1312243)
* [XML](/show_bug.cgi?ctype=xml&id=1312243)

Closed
[Bug 1312243](/show_bug.cgi?id=1312243)
(CVE-2017-5419)

Opened 8 years ago
Closed 8 years ago

# Trap site uses repeated http auth prompts to keep the user on the page

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Trap site uses repeated http auth prompts to keep the user on the page

## Categories

### (Core :: Networking: HTTP, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Networking%3A%20HTTP#Networking%3A%20HTTP)

Networking: HTTP
▾

Core :: Networking: HTTP
For bugs in Mozilla's HTTP networking code. This component deals with HTTP specific issues like pipelining, keep-alive, HTTP proxies, 1.1 issues, redirects, authentication (basic), etc.

Examples of appropriate bugs: Problems with proxy authentication; HTTP redirects looping indefinitely, etc.

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Networking%3A%20HTTP&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Networking%3A%20HTTP&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Networking%3A%20HTTP)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

49 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

major

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla53

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox52 | [-](/buglist.cgi?f1=cf_tracking_firefox52&o1=equals&v1=-) | [fixed](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=fixed) |
| firefox53 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox53&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox52 | - | fixed |
| firefox53 |  | fixed |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: firefox-bugzilla, Assigned: mayhemer, NeedInfo)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](extensions/Gravatar/web/default.jpg)  [mayhemer](/user_profile?user_id=269762)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d71f2b093dd79806a524868ff4c9c79d?d=mm&size=40)  [firefox-bugzilla](/user_profile?user_id=202670)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/608e04ebca94be52b05c003d51d43e07?d=mm&size=40)  [kershaw](/user_profile?user_id=505624)

NeedInfo From:

 [firefox-bugzilla](/user_profile?user_id=202670)

[8 years ago](#c0)

[NeedInfo:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#needinfo)

Update

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

20 people

## References

### (Depends on 1 open bug, Blocks 1 open bug)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[1577174](/show_bug.cgi?id=1577174 "RESOLVED INCOMPLETE - authentication_dialog_abuse_limit can cause the browser to freeze/crash")

[1426656](/show_bug.cgi?id=1426656 "NEW - Add \"disable HTTP authentication prompts\" for this site to auth prompt dialog")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1323973](/show_bug.cgi?id=1323973 "RESOLVED FIXED - Write tests for patch from bug 1312243 (auth dialog abuse blocker)")

[eviltraps](/show_bug.cgi?id=432687 "NEW - [meta] Protect users from websites that trap them or destroy their experience")

Dependency [tree](/showdependencytree.cgi?id=1312243&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1312243)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[1312836](/show_bug.cgi?id=1312836 "RESOLVED DUPLICATE - browser takeover/denial of service via data URI and HTTP authentication dialog"), [1321785](/show_bug.cgi?id=1321785 "RESOLVED DUPLICATE - A site can reissue infinite background requests leading to HTTP authentication requests, causing infinite \"Authentication Required\" popups that block the entire browser and make it impossible to close the tab"), [1324226](/show_bug.cgi?id=1324226 "RESOLVED DUPLICATE - Browser Hijack using data URI and lots of http auth prompts")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[613785](/show_bug.cgi?id=613785 "RESOLVED FIXED - Switch to using tab-modal prompt dialogs for HTTP authentication"), [647010](/show_bug.cgi?id=647010 "NEW - Only present HTTP authentication dialogs if it is the top-level document initiating the auth"), [1418644](/show_bug.cgi?id=1418644 "RESOLVED WORKSFORME - Username/password prompt can be used to hijack the browser"), [377496](/show_bug.cgi?id=377496 "VERIFIED FIXED - 'Authentication Required' dialogue being application modal produces a vector for attack")

## Details

### (Keywords: csectype-dos, sec-low, Whiteboard: [necko-active][adv-main52+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2017-5419

[Keywords:](/describekeywords.cgi)

[csectype-dos](/buglist.cgi?keywords=csectype-dos&resolution=---),
[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[necko-active][adv-main52+]

QA Whiteboard:

[qa-triaged]

Has STR:

no

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [jcristau](/user_profile?user_id=580382) | [qe-verify](#c59 "8 years ago") | + |
| --- | --- | --- |
| [jcristau](/user_profile?user_id=580382) | qe-verify | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files, 5 obsolete files)

| [browserhijacking.png](/attachment.cgi?id=8803672)  [8 years ago](#c0)  [Chris](/user_profile?user_id=202670)   226.47 KB, image/png |  | [Details](/attachment.cgi?id=8803672&action=edit) |
| --- | --- | --- |
| [v1 (carry inner window id to httpchannelparent, limit cancled auth dialogs)](/attachment.cgi?id=8807268)  [8 years ago](#c18)  [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)   19.82 KB, patch |  | [Details](/attachment.cgi?id=8807268&action=edit) | [Diff](/attachment.cgi?id=8807268&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312243&attachment=8807268) |
| [v2 (carry inner window id to httpchannelparent, limit cancled auth dialogs)](/attachment.cgi?id=8807535)  [8 years ago](#c22)  [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)   20.12 KB, patch | Dolske : [review-](#c25 "8 years ago") | [Details](/attachment.cgi?id=8807535&action=edit) | [Diff](/attachment.cgi?id=8807535&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312243&attachment=8807535) |
| [v2.1 (carry inner window id to httpchannelparent, limit cancled auth dialogs)](/attachment.cgi?id=8809862)  [8 years ago](#c28)  [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)   21.05 KB, patch | mcmanus : [review+](#c34 "8 years ago") | [Details](/attachment.cgi?id=8809862&action=edit) | [Diff](/attachment.cgi?id=8809862&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312243&attachment=8809862) |
| [v2.2 (carry inner window id to httpchannelparent, limit cancled auth dialogs in pwdmngr)](/attachment.cgi?id=8811336)  [8 years ago](#c39)  [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)   20.10 KB, patch | Gijs : [feedback+](#c42 "8 years ago") | [Details](/attachment.cgi?id=8811336&action=edit) | [Diff](/attachment.cgi?id=8811336&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312243&attachment=8811336) |
| [v2.3 (carry inner window id to httpchannelparent, limit cancled auth dialogs in pwdmngr)](/attachment.cgi?id=8814466)  [8 years ago](#c44)  [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)   20.38 KB, patch | MattN : [review+](#c46 "8 years ago") | [Details](/attachment.cgi?id=8814466&action=edit) | [Diff](/attachment.cgi?id=8814466&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312243&attachment=8814466) |
| [v2.4 (r addressed, no test)](/attachment.cgi?id=8819273)  [8 years ago](#c48)  [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)   20.46 KB, patch | mayhemer : [review+](#c48 "8 years ago")  jcristau : [approval-mozilla-aurora+](#c58 "8 years ago") | [Details](/attachment.cgi?id=8819273&action=edit) | [Diff](/attachment.cgi?id=8819273&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312243&attachment=8819273) |
| [v2.4 for m-a](/attachment.cgi?id=8820302)  [8 years ago](#c61)  [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)   20.21 KB, patch |  | [Details](/attachment.cgi?id=8820302&action=edit) | [Diff](/attachment.cgi?id=8820302&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312243&attachment=8820302) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Chris](/user_profile?user_id=202670)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1312243#c0)• 8 years ago |
|  | |

Attached image
[browserhijacking.png](attachment.cgi?id=8803672)
— [Details](attachment.cgi?id=8803672&action=edit)

User Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:49.0) Gecko/20100101 Firefox/49.0
Build ID: 20161019084923
Steps to reproduce:
went to a website
Actual results:
browser was redirected multiple times. eventually stopping on a "data" url that pretended to be microsoft and claiming my computer was compromised. What was different to other hijacks was this loaded a 403 password modal dialogue and could not be cleared. The only way to close the rogue site was to shut down the browser from task manager.
Expected results:
data urls should not be able to render pages and should not be able to trigger dialogues especially modal dialogue boxes that prevent navigating away from the site

|  | [Chris](/user_profile?user_id=202670)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312243#a57_202670)• 8 years ago |

Severity: normal → major

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1312243#c1)• 8 years ago |
|  | |

This isn't related to the data: URL (you could cause multiple http auth prompts from a 'normal' webpage too), and we would likely not be able to break data: URLs altogether anyway. The problem is the repeated prompts making it impossible to close the site.
Patrick, is there a way we could limit these prompts if making them tab-modal isn't feasible in the near future?Blocks: [eviltraps](/show_bug.cgi?id=432687 "NEW - [meta] Protect users from websites that trap them or destroy their experience")Group: firefox-core-securityComponent: Untriaged → Networking: HTTPFlags: needinfo?(mcmanus)Keywords: [csectype-dos](/buglist.cgi?keywords=csectype-dos&resolution=---),
[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)Product: Firefox → CoreSee Also: → [613785](/show_bug.cgi?id=613785 "RESOLVED FIXED - Switch to using tab-modal prompt dialogs for HTTP authentication")Summary: Browser hijacked using data url → Trap site uses repeated http auth prompts to keep the user on the page

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1312243#c2)• 8 years ago |
|  | |

Is [bug 1312836](/show_bug.cgi?id=1312836 "RESOLVED DUPLICATE - browser takeover/denial of service via data URI and HTTP authentication dialog") related?See Also: → [1312836](/show_bug.cgi?id=1312836 "RESOLVED DUPLICATE - browser takeover/denial of service via data URI and HTTP authentication dialog")

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1312243#c3)• 8 years ago |
|  | |

(In reply to Honza Bambas (:mayhemer) from [comment #2](/show_bug.cgi?id=1312243#c2 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page"))
> Is [bug 1312836](/show_bug.cgi?id=1312836 "RESOLVED DUPLICATE - browser takeover/denial of service via data URI and HTTP authentication dialog") related?
Yeah, that looks like it's the same. I'll dupe. The URL and attached data URIs from [bug 1312836](/show_bug.cgi?id=1312836 "RESOLVED DUPLICATE - browser takeover/denial of service via data URI and HTTP authentication dialog") look quite useful though.Status: UNCONFIRMED → NEWEver confirmed: true

|  | [Patrick McManus [:mcmanus]](/user_profile?user_id=32546) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312243#a303504_32546)• 8 years ago |

Flags: needinfo?(mcmanus)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1312243#c5)• 8 years ago |
|  | |

Apparently [bug 647010](/show_bug.cgi?id=647010 "NEW - Only present HTTP authentication dialogs if it is the top-level document initiating the auth") covers disabling these prompts for non-toplevel loads, which would also help.
Honza, can you think of anything else that would (help)?Flags: needinfo?(honzab.moz)See Also: [1312836](/show_bug.cgi?id=1312836 "RESOLVED DUPLICATE - browser takeover/denial of service via data URI and HTTP authentication dialog") → [647010](/show_bug.cgi?id=647010 "NEW - Only present HTTP authentication dialogs if it is the top-level document initiating the auth")

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1312243#c6)• 8 years ago |
|  | |

(In reply to :Gijs Kruitbosch from [comment #5](/show_bug.cgi?id=1312243#c5 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page"))
> Apparently [bug 647010](/show_bug.cgi?id=647010 "NEW - Only present HTTP authentication dialogs if it is the top-level document initiating the auth") covers disabling these prompts for non-toplevel loads,
> which would also help.
Not sure what the state of that bug is. Dragana? Just quickly - what is status of that bug?
>
> Honza, can you think of anything else that would (help)?
The first idea that popped to my mind was to queue the prompts, but recently I touched that code and thought we were already was doing that. Double checking if that is broken or not would be good (LoginManagerPrompter.js).
Bad thing is that just queuing will not get rid of all the modal dialogs flood. Something like "don't ask me for auth from this page" check box, similar what we have for MsgBox would do (a UI change). Only refresh of the page by the user would allow it again then.
I'll try to find time to think of something simpler tho.Flags: needinfo?(honzab.moz) → needinfo?(dd.mozilla)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312243#a310835_269762)• 8 years ago |

Flags: needinfo?(honzab.moz)

|  | [Vladimir Vukicevic [:vlad] [:vladv] (needinfo me, slow to respond)](/user_profile?user_id=24534) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1312243#c7)• 8 years ago |
|  | |

(In reply to Honza Bambas (:mayhemer) from [comment #6](/show_bug.cgi?id=1312243#c6 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page"))
> I'll try to find time to think of something simpler tho.
Queue the prompts, and have a longer and longer time in between subsequent prompts, ramping up quickly? After some number of queued prompts, just auto-fail auth requests for that page for a while. It's a bit opaque, but maybe we can mitigate it with a doorhanger popup that says "This page has created too many auth prompts in a short period of time, we're going to disable it until you reload"? (i18n impact, but still)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1312243#c8)• 8 years ago |
|  | |

Could we block prompts for domain X immediately if the user clicks cancel (or OK with no username/password) ? Or do these pages use different domains?

|  | [Dragana Damjanovic [:dragana]](/user_profile?user_id=508195) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1312243#c9)• 8 years ago |
|  | |

(In reply to Honza Bambas (:mayhemer) from [comment #6](/show_bug.cgi?id=1312243#c6 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page"))
> (In reply to :Gijs Kruitbosch from [comment #5](/show_bug.cgi?id=1312243#c5 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page"))
> > Apparently [bug 647010](/show_bug.cgi?id=647010 "NEW - Only present HTTP authentication dialogs if it is the top-level document initiating the auth") covers disabling these prompts for non-toplevel loads,
> > which would also help.
>
> Not sure what the state of that bug is. Dragana? Just quickly - what is
> status of that bug?
>
[Bug 647010](/show_bug.cgi?id=647010 "NEW - Only present HTTP authentication dialogs if it is the top-level document initiating the auth") introduced a pref to disable a cross-origin authentication but usage of such is to high to disable it:
<https://telemetry.mozilla.org/new-pipeline/dist.html#!cumulative=0&end_date=2016-10-26&keys=__none__!__none__!__none__&max_channel_version=nightly%252F52&measure=HTTP_AUTH_DIALOG_STATS&min_channel_version=null&product=Firefox&sanitize=1&sort_keys=submissions&start_date=2016-09-19&table=0&trim=1&use_submission_date=0>Flags: needinfo?(dd.mozilla)

|  | [Dragana Damjanovic [:dragana]](/user_profile?user_id=508195) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1312243#c10)• 8 years ago |
|  | |

(In reply to :Gijs Kruitbosch from [comment #8](/show_bug.cgi?id=1312243#c8 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page"))
> Could we block prompts for domain X immediately if the user clicks cancel
> (or OK with no username/password) ? Or do these pages use different domains?
or block it after second or third cancel. In case user make a mistake canceling.

|  | [u408661](/user_profile?user_id=408661) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312243#a390544_408661)• 8 years ago |

Whiteboard: [necko-next]

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1312243#c11)• 8 years ago |
|  | |

(In reply to Dragana Damjanovic [:dragana] from [comment #10](/show_bug.cgi?id=1312243#c10 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page"))
> (In reply to :Gijs Kruitbosch from [comment #8](/show_bug.cgi?id=1312243#c8 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page"))
> > Could we block prompts for domain X immediately if the user clicks cancel
> > (or OK with no username/password) ? Or do these pages use different domains?
>
> or block it after second or third cancel. In case user make a mistake
> canceling.
In a 'normal' case where a website needs resources, cancel (or not providing correct credentials) will break that resource, likely necessitating a reload anyway. I don't think we need to wait for the second/third cancel - if the user makes a mistake, they'll want to reload the page anyway.

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1312243#c12)• 8 years ago |
|  | |

Boris, I'd like to ask for a little help here.
I want to track the number of authentication prompts a page invokes (via a subresource or iframe) and user cancels them as mitigation to the bloat this bug deals with.
In nsLoginManagerPrompter.js (note this is js, so no access to nsPI\* interfaces) I only have access to the outer window (nsDocShell->mScriptGlobal->AsOuter(), which is nsGlobalWindow AFAIK). I'm trying to implement a counter nsLoginManagerPrompter could access and which simply resets when top level navigation happens. Sounds like the point of reset is nsGlobalWindow::SetNewDocument. But here I may need a new property exposed to chrome on global window, not sure it's the way to go.
Other option is this: I can reach the browser's chrome document element and set attributes on it (keep the counter there). But I don't know how to reset this attribute easily on navigation/reload. Apparently, browser doc element is not the one that resets in nsGlobalWindow::SetNewDocument (mDoc).
So, the question is, do you know about something that is reachable in chrome js from the outer window, capable of storing arbitrary data (the counter) and is reset on navigation/reload? :)
Thanks.Assignee: nobody → honzab.mozFlags: needinfo?(honzab.moz) → needinfo?(bzbarsky)Whiteboard: [necko-next] → [necko-active]

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1312243#c13)• 8 years ago |
|  | |

> So, the question is, do you know about something that is reachable in chrome js from the outer window
Is your chrome js running in the content process or the chrome process?
Because window.document seems like a totally reasonable place to store this information. You can ether use an expando (over Xrays) with a suitably chosen symbol name or string name of some sort, or a weakmap with the document as the key. But obviously that's only a good idea in the content process. Of course poking at the docshell in the chrome process is bad too, so I really hope you're in the content process.Flags: needinfo?(bzbarsky)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1312243#c14)• 8 years ago |
|  | |

(In reply to Boris Zbarsky [:bz] (still a bit busy) from [comment #13](/show_bug.cgi?id=1312243#c13 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page"))
> > So, the question is, do you know about something that is reachable in chrome js from the outer window
>
> Is your chrome js running in the content process or the chrome process?
The login manager solely runs in chrome. To be more precise, it's queried at TabParent::GetAuthPrompt <https://dxr.mozilla.org/mozilla-central/rev/3e73fd638e687a4d7f46613586e5156b8e2af846/dom/ipc/TabParent.cpp#2424>
>
> Because window.document seems like a totally reasonable place to store this
> information. You can ether use an expando (over Xrays) with a suitably
> chosen symbol name or string name of some sort, or a weakmap with the
> document as the key. But obviously that's only a good idea in the content
> process. Of course poking at the docshell in the chrome process is bad too,
> so I really hope you're in the content process.
No, I'm not on the content process :( I can access the tab's window.document, tho. Only problem is that it doesn't reset (drop) my added custom attribute when reload/navigation happens in the tab.
Note that the counter must not be accessible to content.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1312243#c15)• 8 years ago |
|  | |

> I can access the tab's window.document, tho
Ok, but then that's a CPOW if the window is the content window, so we don't want to be doing that.
But if you're in TabParent::GetAuthPrompt then none of that is relevant: the "window" variable there is the browser window, not the webpage window, and I expect that's what gets passed to nsLoginManagerPrompter.js. You can double-check what its .document.URL is, but I expect it's chrome://whatever/browser.xul.
So we need to either implement this counter down lower where we still know which exact content window (or I guess toplevel content window is the part we really care about) is doing the prompting or we need to propagate the information about the toplevel content window that's doing the prompting up to nsLoginManagerPrompter.js.

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1312243#c16)• 8 years ago |
|  | |

Thanks Boris, you are right, it's browser.xul. Hence, I don't think this is going to be that easy.
I could store the counter there but I didn't find a spot where I could reset it on reload/navigation. My knowledge of remote browser is thin.Whiteboard: [necko-active] → [necko-next]

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1312243#c17)• 8 years ago |
|  | |

The right answer is to either propagate the inner window id of the toplevel window along with requests (so you can key things off it), or to maintain the counter and its checks in the content process, before you ever get into that code...

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312243#a1007338_269762)• 8 years ago |

Status: NEW → ASSIGNEDWhiteboard: [necko-next] → [necko-active]

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312243#a1010058_269762)• 8 years ago |

Depends on: [1315070](/show_bug.cgi?id=1315070 "RESOLVED INVALID - Assertion failure: mConcurrentCacheAccess, at netwerk/protocol/http/nsHttpChannel.cpp:1230")

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1312243#c18)• 8 years ago |
|  | |

Attached patch

[v1 (carry inner window id to httpchannelparent, limit cancled auth dialogs)](attachment.cgi?id=8807268&action=diff) (obsolete)
— [Details](attachment.cgi?id=8807268&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312243&attachment=8807268)

two parts
http:
- carry top-document inner window id to http channel parent
- it has to be done manually, since for document loads the id is not present on load info (weird or expected?) and when I qi/gi it from the child tab's document (yes, it works!) I don't want to modify the existing load info
- in non-e10s we do this lazily in http channel base
pwd manager:
- pwd manager then tracks the number of auth dialogs canceled in a row withing a single page and when there are 3 auth dialogs canceled by the user, it will block any auth dialog within coming from context of the page (iframes/xhr/resources)
- the counter is stored on the parent browser document (broswer.xul) as an attribute
- the limit is preferable and can be turned off
- works in e10s and non-e10s
Justin, please check the pwd manager parts, Patrick, please check the http/ipc changes.
Boris, thanks for guidance!
<https://treeherder.mozilla.org/#/jobs?repo=try&revision=b088124ee4e813500b7022659be33953a063cddb>
[Attachment #8807268](/attachment.cgi?id=8807268&action=edit "v1 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") -
Flags: review?(mcmanus)
[Attachment #8807268](/attachment.cgi?id=8807268&action=edit "v1 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") -
Flags: review?(dolske)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1312243#c19)• 8 years ago |
|  | |

> the id is not present on load info
That's odd in general, but can probably happen in some cases.
> and when I qi/gi it from the child tab's document
That is ok, but that's not what happens in the non-e10s case in your patch, right? That case won't do the right thing, because it will get different ids for a page and its subframes. So a page can just create multiple iframes to bypass this.
I think you want to get the nsILoadContext, then get its topWindow (this gives you an outer window), then get the current inner's ID from it, or something along those lines.
Also, this bit:
>+ if (document) {
>+ nsPIDOMWindowOuter\* outer = document->GetWindow();
>+ nsCOMPtr<nsIInterfaceRequestor> windowIR = do\_QueryInterface(outer);
>+ if (windowIR) {
>+ nsCOMPtr<nsIDOMWindowUtils> windowUtils = do\_GetInterface(windowIR);
>+ if (windowUtils) {
>+ windowUtils->GetCurrentInnerWindowID(&contentWindowId);
>+ }
>+ }
should instead be:
if (document) {
contentWindowId = document->InnerWindowID();
}

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1312243#c20)• 8 years ago |
|  | |

(In reply to Boris Zbarsky [:bz] (still a bit busy) from [comment #19](/show_bug.cgi?id=1312243#c19 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page"))
> > the id is not present on load info
>
> That's odd in general, but can probably happen in some cases.
>
> > and when I qi/gi it from the child tab's document
>
> That is ok, but that's not what happens in the non-e10s case in your patch,
> right?
I copied the code from somewhere else when looking around how to get the inner window id when having an outer window in hands.
I will update the patch tomorrow according your suggestions, thanks!

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1312243#c21)• 8 years ago |
|  | |

> when looking around how to get the inner window id when having an outer window in hands
Sure, but the point is you want the "top" outer window, not the one the channel is in.

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312243#a1071627_269762)• 8 years ago |

No longer depends on: [1315070](/show_bug.cgi?id=1315070 "RESOLVED INVALID - Assertion failure: mConcurrentCacheAccess, at netwerk/protocol/http/nsHttpChannel.cpp:1230")

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1312243#c22)• 8 years ago |
|  | |

Attached patch

[v2 (carry inner window id to httpchannelparent, limit cancled auth dialogs)](attachment.cgi?id=8807535&action=diff) (obsolete)
— [Details](attachment.cgi?id=8807535&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312243&attachment=8807535)

Updated according Boris' comments (hopefully correctly) + few more fixes. Thanks again, Boris :)
[Attachment #8807268](/attachment.cgi?id=8807268&action=edit "v1 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") -
Attachment is obsolete: true
[Attachment #8807268](/attachment.cgi?id=8807268&action=edit "v1 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") -
Flags: review?(mcmanus)
[Attachment #8807268](/attachment.cgi?id=8807268&action=edit "v1 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") -
Flags: review?(dolske)
[Attachment #8807535](/attachment.cgi?id=8807535&action=edit "v2 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") -
Flags: review?(mcmanus)
[Attachment #8807535](/attachment.cgi?id=8807535&action=edit "v2 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") -
Flags: review?(dolske)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1312243#c23)• 8 years ago |
|  | |

Comment on [attachment 8807535](/attachment.cgi?id=8807535 "v2 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") [[details]](/attachment.cgi?id=8807535&action=edit "v2 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") [[diff]](/attachment.cgi?id=8807535&action=diff "v2 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312243&attachment=8807535)
v2 (carry inner window id to httpchannelparent, limit cancled auth dialogs)
<https://treeherder.mozilla.org/#/jobs?repo=try&revision=a4c6e3c5f356c4d8a8bc7b0d89974db59d303aea>

|  | [Justin Dolske [:Dolske]](/user_profile?user_id=27780) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1312243#c24)• 8 years ago |
|  | |

(In reply to :Gijs Kruitbosch from [comment #5](/show_bug.cgi?id=1312243#c5 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page"))
> Honza, can you think of anything else that would (help)?
Just FTR -- although I don't think it will help greatly -- but [bug 1230462](/show_bug.cgi?id=1230462 "RESOLVED FIXED - Clarify actual origin in prompt for cross-origin subresource HTTP authentication") made cross-origin auth prompts no longer show the Realm info ("The site says: xxx" stuff in [attachment 8803672](/attachment.cgi?id=8803672 "browserhijacking.png") [[details]](/attachment.cgi?id=8803672&action=edit "browserhijacking.png")). Assuming that sticks, it would be interesting to see if we can just remove it from all HTTP auth prompts. This doesn't help directly with trapping, but makes it less useful when the site can't put any text in the dialog. (We removed the site-specified text from onbeforeunload prompts too, for the same reason.)

|  | [Justin Dolske [:Dolske]](/user_profile?user_id=27780) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1312243#c25)• 8 years ago |
|  | |

Comment on [attachment 8807535](/attachment.cgi?id=8807535 "v2 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") [[details]](/attachment.cgi?id=8807535&action=edit "v2 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") [[diff]](/attachment.cgi?id=8807535&action=diff "v2 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312243&attachment=8807535)
v2 (carry inner window id to httpchannelparent, limit cancled auth dialogs)
Review of [attachment 8807535](/attachment.cgi?id=8807535 "v2 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") [[details]](/attachment.cgi?id=8807535&action=edit "v2 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") [[diff]](/attachment.cgi?id=8807535&action=diff "v2 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312243&attachment=8807535):
-----------------------------------------------------------------
r- but on the right track. :)
::: modules/libpref/init/all.js
@@ +5522,5 @@
> +// When a user cancels this number of authentication dialogs coming from
> +// a sigle web page in a row, all following authentication dialogs will
> +// be blocked (automatically canceled) for that page. The counter resets
> +// when the page is reloaded. To turn this feature off, just set the limit to 0.
> +pref("general.authentication-dialog-bloat-limit", 3);
At risk of bikeshedding a little:
1) How about just making this a simple boolean? I think it's pretty unlike that this is something people would ever need to tune. Just give it a reasonable internal default (3), and let people disable it via pref if needed. (I think that's unlikely too, although it's still good to have so we can hotfix disable it if needed.)
2) prompts.block\_abusive\_http\_auth\_requests? ...meh, I don't have a substantially better suggestion.
::: toolkit/components/passwordmgr/nsLoginManagerPrompter.js
@@ +89,5 @@
> +
> + // Allow only limited number of authentication dialogs when they are all
> + // canceled by the user.
> + var cancelationCounter = { count: 0, id: 0 };
> + var chromeDoc = prompter.\_chromeWindow.document.documentElement;
You won't always have a \_chromeWindow available, unfortunately.
But other than needing to deal with this being undefined, I don't think that's a problem... AFAIK this can only happen with extension related code (the comment in init() suggests a JSM or Sandbox), so that's probably ok to not worry about traps occurring in such cases?
MattN, that sound reasonable?
@@ +106,5 @@
> + }
> +
> + var cancelDialogLimit = 0;
> + try {
> + cancelDialogLimit = Services.prefs.getIntPref("general.authentication-dialog-bloat-limit");
This doesn't need to be in a try-catch, since the pref will always exist (since it's in all.js).
@@ +111,5 @@
> + } catch (ex) { }
> +
> + this.log("cancelationCounter = " + JSON.stringify(cancelationCounter));
> + if (cancelDialogLimit && cancelationCounter.count >= cancelDialogLimit) {
> + this.log("Blocking on limit");
"Blocking auth dialog, due to exceeding dialog bloat limit" (or whatever, just want to make this a little more descriptive since it's the first log message about what might be happening.)
@@ +135,5 @@
> + }
> +
> + Services.tm.mainThread.dispatch(cancel, Ci.nsIThread.DISPATCH\_NORMAL);
> + return;
> + }
Instead of duplicating all this code from the existing runnable (a few lines down), I think it would simpler to just set a "shouldLimit" flag when the cancel limit is exceeded, and tweak the existing runnable code to skip showing an actual prompt when that flag was set.
For the master password uiBusy stuff on line 149, you could also add a check for shouldSkip so we don't try to bypass the prompt (since we know we'd just skip it anyway)... Although things would work just fine without doing this, so you don't actually need to do this.
@@ +178,5 @@
>
> + if (ok) {
> + cancelationCounter.count = 0;
> + } else {
> + ++cancelationCounter.count;
Nit: A post-increment is more common style, and slightly clearer.
@@ +180,5 @@
> + cancelationCounter.count = 0;
> + } else {
> + ++cancelationCounter.count;
> + }
> + chromeDoc.setAttribute("canceled-authentication-prompt-counter", JSON.stringify(cancelationCounter));
See above about \_chromeWin.
[Attachment #8807535](/attachment.cgi?id=8807535&action=edit "v2 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") -
Flags: review?(dolske) → review-

|  | [Justin Dolske [:Dolske]](/user_profile?user_id=27780) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1312243#c26)• 8 years ago |
|  | |

MattN: question for in last comment (search for MattN :).Flags: needinfo?(MattN+bmo)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1312243#c27)• 8 years ago |
|  | |

(In reply to Justin Dolske [:Dolske] from [comment #25](/show_bug.cgi?id=1312243#c25 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page"))
> Comment on [attachment 8807535](/attachment.cgi?id=8807535 "v2 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") [[details]](/attachment.cgi?id=8807535&action=edit "v2 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") [[diff]](/attachment.cgi?id=8807535&action=diff "v2 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312243&attachment=8807535)
> v2 (carry inner window id to httpchannelparent, limit cancled auth dialogs)
>
> Review of [attachment 8807535](/attachment.cgi?id=8807535 "v2 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") [[details]](/attachment.cgi?id=8807535&action=edit "v2 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") [[diff]](/attachment.cgi?id=8807535&action=diff "v2 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312243&attachment=8807535):
> -----------------------------------------------------------------
>
> r- but on the right track. :)
Thanks :)
>
> ::: modules/libpref/init/all.js
> @@ +5522,5 @@
> > +// When a user cancels this number of authentication dialogs coming from
> > +// a sigle web page in a row, all following authentication dialogs will
> > +// be blocked (automatically canceled) for that page. The counter resets
> > +// when the page is reloaded. To turn this feature off, just set the limit to 0.
> > +pref("general.authentication-dialog-bloat-limit", 3);
>
> At risk of bikeshedding a little:
>
> 1) How about just making this a simple boolean? I think it's pretty unlike
> that this is something people would ever need to tune. Just give it a
> reasonable internal default (3), and let people disable it via pref if
> needed. (I think that's unlikely too, although it's still good to have so we
> can hotfix disable it if needed.)
>
> 2) prompts.block\_abusive\_http\_auth\_requests? ...meh, I don't have a
> substantially better suggestion.
I suspect we will hit users that may want to cancel 3 dialogs and expect the fourth to give it it's credentials. There are weird server configuration in the wild, also think of multiple auth challenges etc.. Hence, I'd rather keep the counter pref. We can turn it off easily with setting it to 0.
I'll gladly rename it to be closer to your suggestion.

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1312243#c28)• 8 years ago |
|  | |

Attached patch

[v2.1 (carry inner window id to httpchannelparent, limit cancled auth dialogs)](attachment.cgi?id=8809862&action=diff) (obsolete)
— [Details](attachment.cgi?id=8809862&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312243&attachment=8809862)

- nits in the prompter fixed
- preference renamed, but left as a counter
- http parts unchanged
[Attachment #8807535](/attachment.cgi?id=8807535&action=edit "v2 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") -
Attachment is obsolete: true
[Attachment #8807535](/attachment.cgi?id=8807535&action=edit "v2 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") -
Flags: review?(mcmanus)
[Attachment #8809862](/attachment.cgi?id=8809862&action=edit "v2.1 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") -
Flags: review?(mcmanus)
[Attachment #8809862](/attachment.cgi?id=8809862&action=edit "v2.1 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") -
Flags: review?(dolske)

|  | [Matthew N. [:MattN]](/user_profile?user_id=305228) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1312243#c29)• 8 years ago |
|  | |

(In reply to Justin Dolske [:Dolske] from [comment #25](/show_bug.cgi?id=1312243#c25 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page"))
> ::: toolkit/components/passwordmgr/nsLoginManagerPrompter.js
> @@ +89,5 @@
> > +
> > + // Allow only limited number of authentication dialogs when they are all
> > + // canceled by the user.
> > + var cancelationCounter = { count: 0, id: 0 };
> > + var chromeDoc = prompter.\_chromeWindow.document.documentElement;
>
> You won't always have a \_chromeWindow available, unfortunately.
>
> But other than needing to deal with this being undefined, I don't think
> that's a problem... AFAIK this can only happen with extension related code
> (the comment in init() suggests a JSM or Sandbox), so that's probably ok to
> not worry about traps occurring in such cases?
>
> MattN, that sound reasonable?
Right, I think it's fine to not block repeated requests if there is no chromeWindow.
From a quick skim of the bug I'm not sure why the counter is on `prompter.\_chromeWindow.document…` since that is referring to browser.xul. I would have expected that the counter would be on something specific to the tab/contentDocument/contentWindow. Apologies if I'm missing context.Flags: needinfo?(MattN+bmo)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1312243#c30)• 8 years ago |
|  | |

(In reply to Matthew N. [:MattN] (away Nov. 3–7) from [comment #29](/show_bug.cgi?id=1312243#c29 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page"))
> From a quick skim of the bug I'm not sure why the counter is on
> `prompter.\_chromeWindow.document…` since that is referring to browser.xul. I
> would have expected that the counter would be on something specific to the
> tab/contentDocument/contentWindow. Apologies if I'm missing context.
the code is running on parent. don't want to use CPOWs to get to the content. and this is a perfect place. there is just a single attribute per tab (exactly what I want). content window is id'ed only (all the other IPC stuff in the patch)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1312243#c31)• 8 years ago |
|  | |

(In reply to Honza Bambas (:mayhemer) from [comment #30](/show_bug.cgi?id=1312243#c30 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page"))
> (In reply to Matthew N. [:MattN] (away Nov. 3–7) from [comment #29](/show_bug.cgi?id=1312243#c29 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page"))
> > From a quick skim of the bug I'm not sure why the counter is on
> > `prompter.\_chromeWindow.document…` since that is referring to browser.xul. I
> > would have expected that the counter would be on something specific to the
> > tab/contentDocument/contentWindow. Apologies if I'm missing context.
>
> the code is running on parent. don't want to use CPOWs to get to the
> content. and this is a perfect place. there is just a single attribute per
> tab (exactly what I want). content window is id'ed only (all the other IPC
> stuff in the patch)
\_chromeWindow, as Matt already said, is browser.xul. I'm pretty sure that in your code there isn't "a single attribute per tab" - there is one attribute for all the tabs in the window, because (unless Matt and I are both mistaken...) you're setting it on the chrome XUL <window> element. If multiple tabs are navigating they would clobber the value you're storing (because the inner window IDs of the different tabs are different, of course).
At a guess, you may want to store this on the <browser> elements, or you may want to use a Map() from inner window IDs to counts, (which would of course "leak" that data until the chrome window goes away, which may or may not be something we care about).
Either way, I'm not sure why you're using an attribute and JSON serialization - you can just store an expando on the DOM element or the \_chromeWindow (effectively a global var in the chrome window), which makes using a single structure to cover all the tabs in the window more palatable.

|  | [Matthew N. [:MattN]](/user_profile?user_id=305228) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1312243#c32)• 8 years ago |
|  | |

(In reply to Honza Bambas (:mayhemer) from [comment #30](/show_bug.cgi?id=1312243#c30 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page"))
> (In reply to Matthew N. [:MattN] (away Nov. 3–7) from [comment #29](/show_bug.cgi?id=1312243#c29 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page"))
> > From a quick skim of the bug I'm not sure why the counter is on
> > `prompter.\_chromeWindow.document…` since that is referring to browser.xul. I
> > would have expected that the counter would be on something specific to the
> > tab/contentDocument/contentWindow. Apologies if I'm missing context.
>
> the code is running on parent. don't want to use CPOWs to get to the
> content. and this is a perfect place. there is just a single attribute per
> tab (exactly what I want). content window is id'ed only (all the other IPC
> stuff in the patch)
You don't need a CPOW to store per-browser state as you can store it on the <browser> like Gijs said.
Your response isn't convincing me that you're handling multiple tabs properly. There is one browser.xul per visible window. I agree with everything Gijs says.

|  | [Matthew N. [:MattN]](/user_profile?user_id=305228) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1312243#c33)• 8 years ago |
|  | |

Side note: In code related to content which deals with ChromeWindow's I always like the variable names to be explicit about content vs. chrome and my insistence on renaming this variable lately (IIRC) is why I easily caught this bug.

|  | [Patrick McManus [:mcmanus]](/user_profile?user_id=32546) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1312243#c34)• 8 years ago |
|  | |

Comment on [attachment 8809862](/attachment.cgi?id=8809862 "v2.1 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") [[details]](/attachment.cgi?id=8809862&action=edit "v2.1 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") [[diff]](/attachment.cgi?id=8809862&action=diff "v2.1 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312243&attachment=8809862)
v2.1 (carry inner window id to httpchannelparent, limit cancled auth dialogs)
Review of [attachment 8809862](/attachment.cgi?id=8809862 "v2.1 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") [[details]](/attachment.cgi?id=8809862&action=edit "v2.1 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") [[diff]](/attachment.cgi?id=8809862&action=diff "v2.1 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312243&attachment=8809862):
-----------------------------------------------------------------
I'm ok with the changes to the necko data structures, but I'm not really the right reviewer for the correct use of those windowID calls. But when dolske has r+'d it that would seem right.
[Attachment #8809862](/attachment.cgi?id=8809862&action=edit "v2.1 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") -
Flags: review?(mcmanus) → review+

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1312243#c35)• 8 years ago |
|  | |

Matt, Gijs, you are right.
I did a simple test: a top level page (no authentication) referring an iframe which requires auth. The top level page refreshes the iframe (location.reload()) every 4 seconds. If I open just one tab, the patch works. If I open two tabs, the attribute apparently refers to the \_windows\_ browser.xul\_ and not to the tab's entity (if there is such), since the id is apparently always different.
(In reply to :Gijs Kruitbosch (PTO Nov. 17-20 inclusive) from [comment #31](/show_bug.cgi?id=1312243#c31 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page"))
> At a guess, you may want to store this on the <browser> elements,
How do I reach it? I never worked with this before, sorry.
And expando is better, right. I somehow was convinced only acceptable value to setAttribute was a string.

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1312243#c36)• 8 years ago |
|  | |

(In reply to Honza Bambas (:mayhemer) from [comment #35](/show_bug.cgi?id=1312243#c35 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page"))
> (In reply to :Gijs Kruitbosch (PTO Nov. 17-20 inclusive) from [comment #31](/show_bug.cgi?id=1312243#c31 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page"))
> > At a guess, you may want to store this on the <browser> elements,
>
> How do I reach it? I never worked with this before, sorry.
From a quick look at the code, I think prompter.\_browser refers to the correct browser element, though it does look like that might be relying on CPOWs... Matt would be able to confirm whether this works correctly.
> And expando is better, right. I somehow was convinced only acceptable value
> to setAttribute was a string.
setAttribute \*does\* only take strings, so you're right about that. What I meant is just setting
\_browser.\_someProp = someObject
which should work.

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1312243#c37)• 8 years ago |
|  | |

(In reply to :Gijs Kruitbosch (PTO Nov. 17-20 inclusive) from [comment #36](/show_bug.cgi?id=1312243#c36 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page"))
> From a quick look at the code, I think prompter.\_browser refers to the
Yes, it works. I can't confirm if it is or is not CPOWs, tho.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1312243#c38)• 8 years ago |
|  | |

> I can't confirm if it is or is not CPOWs, tho.
It's not.

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1312243#c39)• 8 years ago |
|  | |

Attached patch

[v2.2 (carry inner window id to httpchannelparent, limit cancled auth dialogs in pwdmngr)](attachment.cgi?id=8811336&action=diff) (obsolete)
— [Details](attachment.cgi?id=8811336&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312243&attachment=8811336)

- using prompter.\_browser.canceledAuthenticationPromptCounter expando
- otherwise the same except some small cleanup
<https://treeherder.mozilla.org/#/jobs?repo=try&revision=a0025e49664d8414ab713915cde8a7c3394fbc70>
[Attachment #8811336](/attachment.cgi?id=8811336&action=edit "v2.2 (carry inner window id to httpchannelparent, limit cancled auth dialogs in pwdmngr)") -
Flags: review?(dolske)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1312243#c40)• 8 years ago |
|  | |

Comment on [attachment 8809862](/attachment.cgi?id=8809862 "v2.1 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") [[details]](/attachment.cgi?id=8809862&action=edit "v2.1 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") [[diff]](/attachment.cgi?id=8809862&action=diff "v2.1 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312243&attachment=8809862)
v2.1 (carry inner window id to httpchannelparent, limit cancled auth dialogs)
Sorry, forgot to obsolete this.
[Attachment #8809862](/attachment.cgi?id=8809862&action=edit "v2.1 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") -
Attachment is obsolete: true
[Attachment #8809862](/attachment.cgi?id=8809862&action=edit "v2.1 (carry inner window id to httpchannelparent, limit cancled auth dialogs)") -
Flags: review?(dolske)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1312243#c41)• 8 years ago |
|  | |

Comment on [attachment 8811336](/attachment.cgi?id=8811336 "v2.2 (carry inner window id to httpchannelparent, limit cancled auth dialogs in pwdmngr)") [[details]](/attachment.cgi?id=8811336&action=edit "v2.2 (carry inner window id to httpchannelparent, limit cancled auth dialogs in pwdmngr)") [[diff]](/attachment.cgi?id=8811336&action=diff "v2.2 (carry inner window id to httpchannelparent, limit cancled auth dialogs in pwdmngr)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312243&attachment=8811336)
v2.2 (carry inner window id to httpchannelparent, limit cancled auth dialogs in pwdmngr)
No response from Justin for 10 days. Gijs, can you take a look please? Feel free to bounce or suggest someone else. I wanted to get this to 52 ASAP (esr). Thanks.
[Attachment #8811336](/attachment.cgi?id=8811336&action=edit "v2.2 (carry inner window id to httpchannelparent, limit cancled auth dialogs in pwdmngr)") -
Flags: review?(dolske) → review?(gijskruitbosch+bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1312243#c42)• 8 years ago |
|  | |

Comment on [attachment 8811336](/attachment.cgi?id=8811336 "v2.2 (carry inner window id to httpchannelparent, limit cancled auth dialogs in pwdmngr)") [[details]](/attachment.cgi?id=8811336&action=edit "v2.2 (carry inner window id to httpchannelparent, limit cancled auth dialogs in pwdmngr)") [[diff]](/attachment.cgi?id=8811336&action=diff "v2.2 (carry inner window id to httpchannelparent, limit cancled auth dialogs in pwdmngr)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312243&attachment=8811336)
v2.2 (carry inner window id to httpchannelparent, limit cancled auth dialogs in pwdmngr)
Review of [attachment 8811336](/attachment.cgi?id=8811336 "v2.2 (carry inner window id to httpchannelparent, limit cancled auth dialogs in pwdmngr)") [[details]](/attachment.cgi?id=8811336&action=edit "v2.2 (carry inner window id to httpchannelparent, limit cancled auth dialogs in pwdmngr)") [[diff]](/attachment.cgi?id=8811336&action=diff "v2.2 (carry inner window id to httpchannelparent, limit cancled auth dialogs in pwdmngr)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312243&attachment=8811336):
-----------------------------------------------------------------
I don't have a lot of time right now. I might have more time on Monday, but I would suggest that Matt would be a better reviewer than me, if dolske is too busy. I've offered a few suggestions below, though...
::: toolkit/components/passwordmgr/nsLoginManagerPrompter.js
@@ +96,5 @@
> this.log("\_doAsyncPrompt:run bypassed, master password UI busy");
> return;
> }
>
> + // Allow only limited number of authentication dialogs when they are all
Nit: Allow only \*a\* limited number of ...
@@ +103,5 @@
> + if (prompt.channel) {
> + var httpchannel = prompt.channel.QueryInterface(Ci.nsIHttpChannel);
> + if (httpchannel) {
> + var windowId = httpchannel.contentWindowId;
> + if (windowId != cancelationCounter.id) {
From a quick look, I was confused by this. Can we make sure that the property on the http channel is explicitly called \*toplevel\* content window ID? Because AIUI that's what it reflects, not the content window ID of the individual frame that might be causing the auth prompt.
@@ +104,5 @@
> + var httpchannel = prompt.channel.QueryInterface(Ci.nsIHttpChannel);
> + if (httpchannel) {
> + var windowId = httpchannel.contentWindowId;
> + if (windowId != cancelationCounter.id) {
> + // window content have been reloaded or navigated, reset the counter
nit: window has been reloaded or navigated, reset the counter
@@ +172,5 @@
> + if (cancelDialogLimit && cancelationCounter.count >= cancelDialogLimit) {
> + this.log("Blocking auth dialog, due to exceeding dialog bloat limit");
> + delete this.\_asyncPrompts[hashKey];
> + prompt.inProgress = false;
> + this.\_asyncPromptInProgress = false;
Do we actually need to set these to false? How would they have been set to true before now?
@@ +181,5 @@
> + return;
> + }
> +
> + this.\_asyncPromptInProgress = true;
> + prompt.inProgress = true;
Feels like it'd be a little simpler (and keep the .log) to put this in an else, and kill the early return, letting us fall through rather than duplicating the runnable dispatch.
[Attachment #8811336](/attachment.cgi?id=8811336&action=edit "v2.2 (carry inner window id to httpchannelparent, limit cancled auth dialogs in pwdmngr)") -
Flags: review?(gijskruitbosch+bugs) → feedback+

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1312243#c43)• 8 years ago |
|  | |

Thanks for such a quick feedback! I'll update and ask Matt.

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1312243#c44)• 8 years ago |
|  | |

Attached patch

[v2.3 (carry inner window id to httpchannelparent, limit cancled auth dialogs in pwdmngr)](attachment.cgi?id=8814466&action=diff) (obsolete)
— [Details](attachment.cgi?id=8814466&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312243&attachment=8814466)

Updated according [comment 42](/show_bug.cgi?id=1312243#c42 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page").
BTW, there is still one way to perform the attack. When a page has an iframe asking for auth and the top level page reloads itself constantly, we are in the same situation again.
[Attachment #8811336](/attachment.cgi?id=8811336&action=edit "v2.2 (carry inner window id to httpchannelparent, limit cancled auth dialogs in pwdmngr)") -
Attachment is obsolete: true
[Attachment #8814466](/attachment.cgi?id=8814466&action=edit "v2.3 (carry inner window id to httpchannelparent, limit cancled auth dialogs in pwdmngr)") -
Flags: review?(MattN+bmo)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1312243#c45)• 8 years ago |
|  | |

Matt, ping on review.

|  | [Matthew N. [:MattN]](/user_profile?user_id=305228) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1312243#c46)• 8 years ago |
|  | |

Comment on [attachment 8814466](/attachment.cgi?id=8814466 "v2.3 (carry inner window id to httpchannelparent, limit cancled auth dialogs in pwdmngr)") [[details]](/attachment.cgi?id=8814466&action=edit "v2.3 (carry inner window id to httpchannelparent, limit cancled auth dialogs in pwdmngr)") [[diff]](/attachment.cgi?id=8814466&action=diff "v2.3 (carry inner window id to httpchannelparent, limit cancled auth dialogs in pwdmngr)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312243&attachment=8814466)
v2.3 (carry inner window id to httpchannelparent, limit cancled auth dialogs in pwdmngr)
Review of [attachment 8814466](/attachment.cgi?id=8814466 "v2.3 (carry inner window id to httpchannelparent, limit cancled auth dialogs in pwdmngr)") [[details]](/attachment.cgi?id=8814466&action=edit "v2.3 (carry inner window id to httpchannelparent, limit cancled auth dialogs in pwdmngr)") [[diff]](/attachment.cgi?id=8814466&action=diff "v2.3 (carry inner window id to httpchannelparent, limit cancled auth dialogs in pwdmngr)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312243&attachment=8814466):
-----------------------------------------------------------------
r=me but this (like any security/abuse prevention bug) really deserves a test (especially when we have existing ones to base it on). See toolkit/components/passwordmgr/test/mochitest/test\_prompt\_http.html for one example. I think the `handlePrompt` test helper should make this not very painful.
::: modules/libpref/init/all.js
@@ +5534,5 @@
> pref("dom.storageManager.enabled", false);
> #endif
>
> +// When a user cancels this number of authentication dialogs coming from
> +// a sigle web page in a row, all following authentication dialogs will
Nit: "sigle"
@@ +5537,5 @@
> +// When a user cancels this number of authentication dialogs coming from
> +// a sigle web page in a row, all following authentication dialogs will
> +// be blocked (automatically canceled) for that page. The counter resets
> +// when the page is reloaded. To turn this feature off, just set the limit to 0.
> +pref("prompt.authentication\_dialog\_abuse\_limit", 3);
Nit: We have another pref that starts with "prompts." (plural) so it would be good to make this plural too.
::: toolkit/components/passwordmgr/nsLoginManagerPrompter.js
@@ +101,5 @@
> + // canceled by the user.
> + var cancelationCounter = (prompter.\_browser && prompter.\_browser.canceledAuthenticationPromptCounter) || { count: 0, id: 0 };
> + if (prompt.channel) {
> + var httpchannel = prompt.channel.QueryInterface(Ci.nsIHttpChannel);
> + if (httpchannel) {
Nit: Use camelCase e.g. `httpChannel`
@@ +167,5 @@
> };
>
> + var cancelDialogLimit = Services.prefs.getIntPref("prompt.authentication\_dialog\_abuse\_limit");
> +
> + this.log("cancelationCounter = " + JSON.stringify(cancelationCounter));
Nit: You should't need the JSON.stringify if you pass the object as the 2nd argument IIRC. Without it you will get an inspectable object in the DevTools and a different color-coding (which helps it stand out).
`this.log("cancelationCounter =", cancelationCounter);`
[Attachment #8814466](/attachment.cgi?id=8814466&action=edit "v2.3 (carry inner window id to httpchannelparent, limit cancled auth dialogs in pwdmngr)") -
Flags: review?(MattN+bmo) → review+

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=1312243#c48)• 8 years ago |
|  | |

Attached patch

[v2.4 (r addressed, no test)](attachment.cgi?id=8819273&action=diff)
— [Details](attachment.cgi?id=8819273&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312243&attachment=8819273)

I'm going to land this now w/o a test and ask for a+ on m-a as I want this be in 52 (ESR). I'll write the test later in a different bug and ask a+ to m-a for it too. Sorry, I'm in a time press now and the test is not that easy to write as you may think.
[Attachment #8814466](/attachment.cgi?id=8814466&action=edit "v2.3 (carry inner window id to httpchannelparent, limit cancled auth dialogs in pwdmngr)") -
Attachment is obsolete: true
[Attachment #8819273](/attachment.cgi?id=8819273&action=edit "v2.4 (r addressed, no test)") -
Flags: review+

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312243#a4696852_269762)• 8 years ago |

Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312243#a4699245_269762)• 8 years ago |

Blocks: [1323973](/show_bug.cgi?id=1323973 "RESOLVED FIXED - Write tests for patch from bug 1312243 (auth dialog abuse blocker)")

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=1312243#c49)• 8 years ago |
|  | |

Pushed by cbook@mozilla.com:
<https://hg.mozilla.org/integration/mozilla-inbound/rev/e077cda0a979>
Block authentication dialog pop-ups by cancling 3 of them in a row, r=Dolske+mcmanusKeywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Matthew N. [:MattN]](/user_profile?user_id=305228) |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=1312243#c50)• 8 years ago |
|  | |

(In reply to Pulsebot from [comment #49](/show_bug.cgi?id=1312243#c49 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page"))
> r=Dolske+mcmanus
The reviewer list was stale

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=1312243#c51)• 8 years ago |
|  | |

(In reply to Matthew N. [:MattN] (PM me if requests are blocking you) from [comment #50](/show_bug.cgi?id=1312243#c50 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page"))
> (In reply to Pulsebot from [comment #49](/show_bug.cgi?id=1312243#c49 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page"))
> > r=Dolske+mcmanus
>
> The reviewer list was stale
Sorry, thanks!

|  | [Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)](/user_profile?user_id=308534) |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=1312243#c52)• 8 years ago |
| bugherder | |

<https://hg.mozilla.org/mozilla-central/rev/e077cda0a979>Status: ASSIGNED → RESOLVEDClosed: 8 years ago
[status-firefox53](/buglist.cgi?f1=cf_status_firefox53&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox53&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla53

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=1312243#c54)• 8 years ago |
|  | |

[Tracking Requested - why for this release]:
This affects our users in the wild. While it's probably too late in the game for 51, we should try to take this for 52 if we can.
[status-firefox52](/buglist.cgi?f1=cf_status_firefox52&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=affected)
[tracking-firefox52](/buglist.cgi?f1=cf_tracking_firefox52&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox52&o1=equals&v1=%3F)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=1312243#c55)• 8 years ago |
|  | |

Comment on [attachment 8819273](/attachment.cgi?id=8819273 "v2.4 (r addressed, no test)") [[details]](/attachment.cgi?id=8819273&action=edit "v2.4 (r addressed, no test)") [[diff]](/attachment.cgi?id=8819273&action=diff "v2.4 (r addressed, no test)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312243&attachment=8819273)
v2.4 (r addressed, no test)
Approval Request Comment
[Feature/Bug causing the regression]: since ever
[User impact if declined]: complete blockade of UI through a number of modal auth dialogs
[Is this code covered by automated tests?]: somewhat, we have tests for these parts of code, but not for this particular issue (filed a followup [bug 1323973](/show_bug.cgi?id=1323973 "RESOLVED FIXED - Write tests for patch from bug 1312243 (auth dialog abuse blocker)"))
[Has the fix been verified in Nightly?]: locally, yes
[Needs manual test from QE? If yes, steps to reproduce]: before [bug 1323973](/show_bug.cgi?id=1323973 "RESOLVED FIXED - Write tests for patch from bug 1312243 (auth dialog abuse blocker)") lands (not sooner than Jan 2017), maybe
[List of other uplifts needed for the feature/fix]: none
[Is the change risky?]: I think not
[Why is the change risky/not risky?]: reload of a page discards any auth dialog limits this patch introduces, it can also be turned off by a preference
[String changes made/needed]: none
[Attachment #8819273](/attachment.cgi?id=8819273&action=edit "v2.4 (r addressed, no test)") -
Flags: approval-mozilla-aurora?

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=1312243#c56)• 8 years ago |
|  | |

Is there a test URL that QE could use for verification?Flags: needinfo?(honzab.moz)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=1312243#c57)• 8 years ago |
|  | |

(In reply to Julien Cristau [:jcristau] from [comment #56](/show_bug.cgi?id=1312243#c56 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page"))
> Is there a test URL that QE could use for verification?
I think here are some URLs to test with: [https://bugzilla.mozilla.org/show\_bug.cgi?id=1324226#c1](/show_bug.cgi?id=1324226#c1 "RESOLVED DUPLICATE - Browser Hijack using data URI and lots of http auth prompts")Flags: needinfo?(honzab.moz)

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=1312243#c58)• 8 years ago |
|  | |

Comment on [attachment 8819273](/attachment.cgi?id=8819273 "v2.4 (r addressed, no test)") [[details]](/attachment.cgi?id=8819273&action=edit "v2.4 (r addressed, no test)") [[diff]](/attachment.cgi?id=8819273&action=diff "v2.4 (r addressed, no test)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1312243&attachment=8819273)
v2.4 (r addressed, no test)
limit the number of auth pop-ups shown for a page to block abuse, take in aurora52
[Attachment #8819273](/attachment.cgi?id=8819273&action=edit "v2.4 (r addressed, no test)") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=1312243#c59)• 8 years ago |
|  | |

Hopefully [comment 57](/show_bug.cgi?id=1312243#c57 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page") can help with verification, though it looks like the URLs mentioned there no longer exist.Flags: qe-verify+

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293) |  |
| --- | --- | --- |
| [Comment 60](/show_bug.cgi?id=1312243#c60)• 8 years ago |
|  | |

need rebasingFlags: needinfo?(honzab.moz)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 61](/show_bug.cgi?id=1312243#c61)• 8 years ago |
|  | |

Attached patch

[v2.4 for m-a](attachment.cgi?id=8820302&action=diff)
— [Details](attachment.cgi?id=8820302&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1312243&attachment=8820302)

Here it is (build checked locally, debug only)Flags: needinfo?(honzab.moz)

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312243#a5123168_580382)• 8 years ago |

[tracking-firefox52](/buglist.cgi?f1=cf_tracking_firefox52&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox52&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox52&o1=equals&v1=-)

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293) |  |
| --- | --- | --- |
| [Comment 62](/show_bug.cgi?id=1312243#c62)• 8 years ago |
| bugherder uplift | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/fec44289a5e2>
[status-firefox52](/buglist.cgi?f1=cf_status_firefox52&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=fixed)

|  | [Bogdan Maris, Desktop Test Engineering](/user_profile?user_id=458188) |  |
| --- | --- | --- |
| [Comment 63](/show_bug.cgi?id=1312243#c63)• 8 years ago |
|  | |

The links from [comment 57](/show_bug.cgi?id=1312243#c57 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page") does not work anymore so I had a look at the duplicate bugs here but was unable to find some link or a testcase in order to reproduce/verify this bug.
I used the data URI attached in [bug 1312836 comment 1](/show_bug.cgi?id=1312836#c1 "RESOLVED DUPLICATE - browser takeover/denial of service via data URI and HTTP authentication dialog") but under Windows 7 and macOS 10.12.3 I see the same behavior on Fx 49.0 (which should be not fixed) as on Fx 52 beta 8 (which should be fixed), with every click on that webpage Fx will open window after window.
Chris, I know it's been a long time but could you reliable reproduce this? If yes can you make public the website you used?
If anyone else knows how I can reproduce (in order to verify) this please let me know, it will be much appreciated.Flags: needinfo?(firefox-bugzilla)

|  | [Chris](/user_profile?user_id=202670)  Reporter |  |
| --- | --- | --- |
| [Comment 64](/show_bug.cgi?id=1312243#c64)• 8 years ago |
|  | |

Sorry The site appears to be assist.support-care-uk.in (from the image I posted) but it no longer exists.
Because of the nature of the exploit I was not able to copy the data URL.
I have searched through my history and have a gap around the time of the incident. Which would be because I had to kill the browser so its recent history was not flushed to disk.
The only places in my history I visited around that time and date were netflix and google. I do not recall what the original site was but I was pulled into a rapid circle jerk which finished at the data URL. I could not reproduce it if I tried.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312243#a11050766_280903)• 8 years ago |

Whiteboard: [necko-active] → [necko-active][adv-main52+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312243#a11208252_280903)• 8 years ago |

Alias: CVE-2017-5419

|  | [Iulia Cristescu, QA [:JuliaC] (away, please needinfo? cornel.ionce@softvision.ro)](/user_profile?user_id=565219) |  |
| --- | --- | --- |
| [Comment 65](/show_bug.cgi?id=1312243#c65)• 8 years ago |
|  | |

As the links from [comment 57](/show_bug.cgi?id=1312243#c57 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page") and from the duplicate bugs don't work anymore, I tried to find another valid links that can trigger this issue, but with no luck.
With <https://bug1312836.bmoattachments.org/attachment.cgi?id=8804398>, I noticed the same behavior on Windows 10 x64, using 52.0a1 (2016-10-22), 53.0b1 build1 (20170307064827) and 52.0 build2 (20170302120751) (like Bogdan did - see [comment 63](/show_bug.cgi?id=1312243#c63 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page")) - with every click on that webpage, Firefox will open window after window (about:blank).
Chris, Honza, any thoughts about this behavior? Also, any chance to find a valid link for reproducing / verifying this issue?Flags: needinfo?(honzab.moz)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 66](/show_bug.cgi?id=1312243#c66)• 8 years ago |
|  | |

Note that this fixes only a case when a page contains an iframe that 1) asks for auth 2) is reloaded by the top level page on and on. If such the page would reload itself (not just the iframe), the patch would not help.
On Nightly and Beta I \_can't\_ repro with <https://bug1312836.bmoattachments.org/attachment.cgi?id=8804398>Flags: needinfo?(honzab.moz)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 67](/show_bug.cgi?id=1312243#c67)• 8 years ago |
|  | |

And another note that this only protects against abuse auth prompts, nothing else.

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312243#a34174134_269762)• 7 years ago |

See Also: → [1418644](/show_bug.cgi?id=1418644 "RESOLVED WORKSFORME - Username/password prompt can be used to hijack the browser")

|  | [ga48](/user_profile?user_id=586223) |  |
| --- | --- | --- |
| [Comment 68](/show_bug.cgi?id=1312243#c68)• 7 years ago |
|  | |

(In reply to Iulia Cristescu, QA [:JuliaC] from [comment #65](/show_bug.cgi?id=1312243#c65 "RESOLVED FIXED - Trap site uses repeated http auth prompts to keep the user on the page"))
> Also, any chance to find a valid link for reproducing / verifying this issue?
[https://bugzilla.mozilla.org/show\_bug.cgi?id=1439157](/show_bug.cgi?id=1439157 "RESOLVED DUPLICATE - Web site login feature permits un-closeable pop-up windows [spam exploit]")

|  | [Matthew N. [:MattN]](/user_profile?user_id=305228) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312243#a50510560_305228)• 7 years ago |

Depends on: [1426656](/show_bug.cgi?id=1426656 "NEW - Add \"disable HTTP authentication prompts\" for this site to auth prompt dialog")

|  | [Johann Hofmann [:johannh]](/user_profile?user_id=522029) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312243#a71618201_522029)• 6 years ago |

See Also: → [377496](/show_bug.cgi?id=377496 "VERIFIED FIXED - 'Authentication Required' dialogue being application modal produces a vector for attack")

|  | [ovidiu boca[:Ovidiu]](/user_profile?user_id=551038) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312243#a73284970_551038)• 6 years ago |

Whiteboard: [necko-active][adv-main52+] → [necko-active][adv-main52+][qa-triaged]

|  | [Andrei Vaida [:avaida]](/user_profile?user_id=488993) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312243#a74510807_488993)• 6 years ago |

QA Whiteboard: [qa-triaged]Whiteboard: [necko-active][adv-main52+][qa-triaged] → [necko-active][adv-main52+]

|  | [Daniel Bodea [:danibodea]](/user_profile?user_id=616104) |  |
| --- | --- | --- |
| [Comment 69](/show_bug.cgi?id=1312243#c69)• 6 years ago |
|  | |

Some steps to reproduce are still required in order to correctly verify this bug. Honza, Do you think this can still be verified at this point or should we ignore it in the future?

Has STR: --- → noFlags: needinfo?(honzab.moz)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 70](/show_bug.cgi?id=1312243#c70)• 6 years ago |
|  | |

Is your request to me to provide the STR? This is hard to test in an automated fashion, yes, so a static web page for testing would be good to have, right?

Flags: needinfo?(honzab.moz) → needinfo?(daniel.bodea)

|  | [Daniel Bodea [:danibodea]](/user_profile?user_id=616104) |  |
| --- | --- | --- |
| [Comment 71](/show_bug.cgi?id=1312243#c71)• 6 years ago |
|  | |

Yes, please. That would be very helpful. Thank you.

Flags: needinfo?(daniel.bodea) → needinfo?(honzab.moz)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 72](/show_bug.cgi?id=1312243#c72)• 6 years ago |
|  | |

Deadline?

Flags: needinfo?(daniel.bodea)

|  | [Daniel Bodea [:danibodea]](/user_profile?user_id=616104) |  |
| --- | --- | --- |
| [Comment 73](/show_bug.cgi?id=1312243#c73)• 6 years ago |
|  | |

Considering the fact that this "qe-verify+" tag was set about 3 years ago, I don't think there's any hurry to it... :)

Flags: needinfo?(daniel.bodea)

|  | [Daniel Bodea [:danibodea]](/user_profile?user_id=616104) |  |
| --- | --- | --- |
| [Comment 74](/show_bug.cgi?id=1312243#c74)• 6 years ago |
|  | |

Just a reminder for Honza :)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 75](/show_bug.cgi?id=1312243#c75)• 5 years ago |
|  | |

Is the test in [bug 377496](/show_bug.cgi?id=377496 "VERIFIED FIXED - 'Authentication Required' dialogue being application modal produces a vector for attack") enough?

Flags: needinfo?(honzab.moz) → needinfo?(daniel.bodea)

|  | [Daniel Bodea [:danibodea]](/user_profile?user_id=616104) |  |
| --- | --- | --- |
| [Comment 76](/show_bug.cgi?id=1312243#c76)• 5 years ago |
|  | |

In [bug 377496](/show_bug.cgi?id=377496 "VERIFIED FIXED - 'Authentication Required' dialogue being application modal produces a vector for attack"), there are 2 test cases:

1. A test case in the description: opening a page (<http://gobase.org/studying/articles/mioch/7/index.html>) and the authentification prompt would appear by default. The authentification prompt does not appear anymore.
2. Another test case in the comment section (<https://bugzilla.mozilla.org/show_bug.cgi?id=377496#c36>): which has a test page (<http://www.httpwatch.com/httpgallery/authentication/#showExample10>). Clickin the "DISPLAY IMAGE" button will trigger an authentification prompt. In this case, the prompt is displayed, and the page is still somewhat unusable (only scrolling it is possible while the prompt is not dismissed).

* Clicking the prompt's OK button two times in a row will dismiss the prompt and the page becomes usable.
* Clicking the prompt's "Cancel" or "X" buttons will instantly dismiss the authentification prompt and leave the page usable.

I don't know what this bug fixed/what are the previous expected results and the newly expected results. How exactly is this supposed to work?

Flags: needinfo?(daniel.bodea) → needinfo?(honzab.moz)

|  | [Matthew N. [:MattN]](/user_profile?user_id=305228) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1312243#a109868931_305228)• 5 years ago |

Depends on: [1577174](/show_bug.cgi?id=1577174 "RESOLVED INCOMPLETE - authentication_dialog_abuse_limit can cause the browser to freeze/crash")

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 77](/show_bug.cgi?id=1312243#c77)• 5 years ago |
|  | |

As there is some work happening in [bug 613785](/show_bug.cgi?id=613785 "RESOLVED FIXED - Switch to using tab-modal prompt dialogs for HTTP authentication"), this is no longer serious enough to spend time verifying. [Bug 613785](/show_bug.cgi?id=613785 "RESOLVED FIXED - Switch to using tab-modal prompt dialogs for HTTP authentication") will actually nullify this issue completely.

Flags: needinfo?(honzab.moz)
You need to [log in](/show_bug.cgi?id=1312243&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Chris](/user_profile?user_id=202670)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_b3050622_20250125_215513.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1284395)
* [XML](/show_bug.cgi?ctype=xml&id=1284395)

Closed
[Bug 1284395](/show_bug.cgi?id=1284395)
(CVE-2017-5420)

Opened 9 years ago
Closed 8 years ago

# Show about:blank (placeholder "Search or enter address" in the URL bar) (spoof)

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Show about:blank (placeholder "Search or enter address" in the URL bar) (spoof)

## Categories

### (Firefox :: General, defect)

[Product:](/describecomponents.cgi?product=Firefox)

Firefox
▾

Firefox
For bugs in Firefox Desktop, the Mozilla Foundation's web browser. For Firefox user interface issues in menus, bookmarks, location bar, and preferences. Many Firefox bugs will either be filed here or in the [Core](https://bugzilla.mozilla.org/describecomponents.cgi?product=Core) product. Bugs for developer tools (F12) should be filed in the [DevTools](https://bugzilla.mozilla.org/describecomponents.cgi?product=DevTools) product. ([more info](https://wiki.mozilla.org/Modules/All#Firefox))
[See Open Bugs in This Product](/buglist.cgi?product=Firefox&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Firefox)
Watch This Product

[Component:](/describecomponents.cgi?product=Firefox&component=General#General)

General
▾

Firefox :: General
For bugs in Firefox which do not fit into other more specific Firefox components
[See Open Bugs in This Component](/buglist.cgi?product=Firefox&component=General&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Firefox&component=General&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Firefox&component=General)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

50 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

Firefox 52

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| a11y-review | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox52 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| firefox52 |  | fixed |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: qab, Assigned: Gijs)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=40)  [Gijs](/user_profile?user_id=159069)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/1cea46da7dbb1ab6b82e8c1421e4ee70?d=mm&size=40)  [qab](/user_profile?user_id=550582)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4b4985a7acf7db49dfddd7815b55a043?d=mm&size=40)  [mconley](/user_profile?user_id=403756)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

17 people

## References

### (Depends on 1 open bug)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[1315553](/show_bug.cgi?id=1315553 "NEW - Opening an about:blank tab with an explicit NullPrincipal breaks the document"), [1304492](/show_bug.cgi?id=1304492 "RESOLVED FIXED - remote-browser's contentPrincipal initially lies about originAttributes"), [1366203](/show_bug.cgi?id=1366203 "VERIFIED FIXED - Changing URL locations while a page is loading temporarily reverts the URL")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=1284395&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1284395)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1354796](/show_bug.cgi?id=1354796 "VERIFIED FIXED - Right-click new tab loses URL information if site is down")

## Details

### (Keywords: csectype-spoof, sec-low, Whiteboard: [post-critsmash-triage][adv-main52+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2017-5420

[Keywords:](/describekeywords.cgi)

[csectype-spoof](/buglist.cgi?keywords=csectype-spoof&resolution=---),
[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[post-critsmash-triage][adv-main52+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [kjozwiak](/user_profile?user_id=455785) | [qe-verify](#a20446492_455785 "8 years ago") | - |
| --- | --- | --- |
| [kjozwiak](/user_profile?user_id=455785) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | blocking-fx-sync1.7 | ? |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files, 3 obsolete files)

| [PoC.html](/attachment.cgi?id=8767847)  [9 years ago](#c0)  [Abdulrahman Alqabandi](/user_profile?user_id=550582)   443 bytes, text/html |  | [Details](/attachment.cgi?id=8767847&action=edit) |
| --- | --- | --- |
| [New and improved PoC](/attachment.cgi?id=8767853)  [9 years ago](#c2)  [Abdulrahman Alqabandi](/user_profile?user_id=550582)   455 bytes, text/html |  | [Details](/attachment.cgi?id=8767853&action=edit) |
| [screenshot.png](/attachment.cgi?id=8768275)  [9 years ago](#c11)  [Abdulrahman Alqabandi](/user_profile?user_id=550582)   144.03 KB, image/png |  | [Details](/attachment.cgi?id=8768275&action=edit) |
| [Patch v0.1](/attachment.cgi?id=8788460)  [8 years ago](#c23)  [:Gijs (he/him)](/user_profile?user_id=159069)   19.98 KB, patch | mconley : [review+](#c27 "8 years ago")  bzbarsky : [review+](#c25 "8 years ago") | [Details](/attachment.cgi?id=8788460&action=edit) | [Diff](/attachment.cgi?id=8788460&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8788460) |
| [Patch v0.2](/attachment.cgi?id=8791412)  [8 years ago](#c33)  [:Gijs (he/him)](/user_profile?user_id=159069)   23.18 KB, patch | mconley : [review+](#c34 "8 years ago") | [Details](/attachment.cgi?id=8791412&action=edit) | [Diff](/attachment.cgi?id=8791412&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8791412) |
| [Patch v0.3](/attachment.cgi?id=8792848)  [8 years ago](#c43)  [:Gijs (he/him)](/user_profile?user_id=159069)   24.79 KB, patch | baku : [review+](#c44 "8 years ago") | [Details](/attachment.cgi?id=8792848&action=edit) | [Diff](/attachment.cgi?id=8792848&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8792848) |
| [Patch v0.4](/attachment.cgi?id=8793491)  [8 years ago](#c45)  [:Gijs (he/him)](/user_profile?user_id=159069)   26.21 KB, patch | baku : [review+](#c47 "8 years ago")  mconley : [review+](#c50 "8 years ago") | [Details](/attachment.cgi?id=8793491&action=edit) | [Diff](/attachment.cgi?id=8793491&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8793491) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1284395#c0)• 9 years ago |
|  | |

Attached file
[PoC.html](attachment.cgi?id=8767847)
— [Details](attachment.cgi?id=8767847&action=edit)

User Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.103 Safari/537.36
Steps to reproduce:
Open PoC.html and follow instructions
Actual results:
Ended up with completely empty address bar
Expected results:
Main problem I think is the ability to be able to navigate to 'about:home'
So my initial expectation is that about: pages which are
a) Openable by content
b) Have an empty address bar by default
Should not be openable by content.
(So far im only aware of about:home that does this, 'about:newtab' does not meet requirement [a])
Note:
As far as I can tell, this is not a dupe of [Bug 1247968](/show_bug.cgi?id=1247968 "VERIFIED FIXED - Full URL spoof using javascript URI scheme") (not fixed) or [Bug 1228754](/show_bug.cgi?id=1228754 "VERIFIED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) using javascript URI scheme (spoof)") (fixed) but its worth making sure it isn't

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1284395#c1)• 9 years ago |
|  | |

Works on latest nightly and latest stable

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1284395#c2)• 9 years ago |
|  | |

Attached file
[New and improved PoC](attachment.cgi?id=8767853)
— [Details](attachment.cgi?id=8767853&action=edit)

It does not seem like about:home is needed at all.. So that's not the culprit
This PoC does not need you to manually hit back

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1284395#c3)• 9 years ago |
|  | |

So the way this works is, AFAICT:
a) javascript: URL gets opened in a new tab. At this stage, document.location and document.documentURI both reflect the JS URI;
b) the JS URI returns a string of HTML containing a <script> that calls location.reload(). The reload gets triggered and runs the same JS URI again. When the same JS runs after that happens, both |location| and |documentURI are now about:blank (???). Note that this doesn't happen if the JS URI calls location.reload() directly. The indirection via the "return value" of the JS URI is somehow important.
c) the JS URI goes forward to a data: URI and then back from there.
d) now the location bar displays about:blank. That is also the principal of the page. Also, the tab spinner is permanently in the 'busy' state.
FWIW, I get the same results without steps (c) and (d), so a simpler testcase looks something like this:
data:text/html,<a href="javascript:if(history.length==0){'<script>location.reload()</script>'}else{document.write('<b>Spoof</b>');}">Please-open-in-new-tab.</a>
I think this is basically an issue in DOM/docshell-land. bz and smaug are both out.
There's a number of strange things here:
1) I'd expect the initial JS URI to load against a page that's inherited the principal of the page from which we clicked the link. That might be something that we need to fix in frontend (for dealing with non-left-content-clicks) if it is fixable at all. Not entirely sure how. Mike, I don't suppose you have any ideas?
2) The location.reload() from the 'response of the js URI seems to be running against an "about:blank" document. I've tried reading the spec, but "Setting the document's address" ( <https://html.spec.whatwg.org/multipage/browsers.html#set-the-document%27s-address> ) has no internal references and so I don't understand at what point that's supposed to apply to the Document we create to process the HTML 'response' from the JS URI. I would argue it should be before script runs on the document, or any other requests to external resources are made... and that doesn't seem like it's happening. Anne, can you elucidate what the spec says we should be doing here?
3) we show a placeholder for about:blank in the location bar. A short-term mitigation would be to just stop doing that for about:blank, but I don't know that the severity of this bug warrants doing that, nor do I think it's really meaningful for users in the first place... Marco, thoughts?Group: firefox-core-security → core-securityComponent: Untriaged → Document NavigationFlags: needinfo?(mconley)Flags: needinfo?(mak77)Flags: needinfo?(annevk)Product: Firefox → Core

|  | [Anne (:annevk)](/user_profile?user_id=102998) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1284395#c4)• 9 years ago |
|  | |

Few things:
1. javascript URLs are defined inline in the navigation algorithm.
2. javascript URLs generate a response and set an override URL for that response. The override URL is that of the browsing context (the one being navigated) its active document.
3. Reload just navigates to the same URL.
So given that, ending up with no URL seems like a bug.Flags: needinfo?(annevk)

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1284395#c5)• 9 years ago |
|  | |

If we do this:
data:text/html,<a href="javascript:if(history.length==0){'<script>location.reload()</script>'}else{if(history.length==2){alert(location)}else{location=`<https://www.facebook.com/favicon.ico>`}}">Please-open-in-new-tab.</a>
It almost looks like we got the content from facebook, but I can't seem to find any way to read any of it, it looks all frozen. Is there potential in this?
Also, if we do a window.stop() we can fix the infinite loading + some other things and we get a rough PoC of social engineering. (note that in this case the bug where favicon is not refreshed helps a lot to sell it)
data:text/html,<a href="javascript:if(history.length==0){'<script>location.reload()</script>'}else{if(history.length==2){document.write(`<b>Password:</b><input/type=text>`);window.stop();document.title=`Facebook Login`}else{alert(`Navigate back if its not found`);location=`<https://www.facebook.com/temp.ico>`}}">Please-open-in-new-tab.</a>
Also side note, sometimes nightly freezes on me when testing this area. Not sure if related, cant repro.

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1284395#c6)• 9 years ago |
|  | |

Note: in the above PoC you need to manually navigate back to see full effect.

|  | [Marco Bonardo [:mak]](/user_profile?user_id=240353) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1284395#c7)• 9 years ago |
|  | |

(In reply to :Gijs Kruitbosch from [comment #3](/show_bug.cgi?id=1284395#c3 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)"))
> 3) we show a placeholder for about:blank in the location bar. A short-term
> mitigation would be to just stop doing that for about:blank, but I don't
> know that the severity of this bug warrants doing that, nor do I think it's
> really meaningful for users in the first place... Marco, thoughts?
From an UX point of view, it seems important to me that we give hints to the user about what he can do on a completely empty page. Honestly I'm not the best person to sign-off on removing the placeholder from about:blank, off-hand I'd say we should not remove it.
Here the problem is that this is not a really empty page, we seem to keep hitting this problem where about:blank is not really about:blank, but I don't know well enough the platform code handling this to be able to tell if there's an easy way to distinguish those cases. I was hoping [bug 1228754](/show_bug.cgi?id=1228754 "VERIFIED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) using javascript URI scheme (spoof)") had helped with that.Flags: needinfo?(mak77)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1284395#c8)• 9 years ago |
|  | |

(In reply to Abdulrahman Alqabandi[test] from [comment #6](/show_bug.cgi?id=1284395#c6 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)"))
> Note: in the above PoC you need to manually navigate back to see full effect.
All of these still show an empty location bar for me, not one with fb.com in it, when the attacker-controlled page is displayed (rather than facebook.com's actual icon or whatever). Am I misunderstanding how this is supposed to work?Flags: needinfo?(qab)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1284395#c9)• 9 years ago |
|  | |

(In reply to Marco Bonardo [::mak] from [comment #7](/show_bug.cgi?id=1284395#c7 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)"))
> Here the problem is that this is not a really empty page, we seem to keep
> hitting this problem where about:blank is not really about:blank, but I
> don't know well enough the platform code handling this to be able to tell if
> there's an easy way to distinguish those cases. I was hoping [bug 1228754](/show_bug.cgi?id=1228754 "VERIFIED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) using javascript URI scheme (spoof)") had
> helped with that.
I think it did help, just with different cases. :-)
AIUI per [comment #4](/show_bug.cgi?id=1284395#c4 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)") this is just a platform bug. We shouldn't end up with a document that has an about:blank URI and principal.

|  | [Mike Conley (:mconley) (:⚙️)](/user_profile?user_id=403756) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1284395#c10)• 9 years ago |
|  | |

I'm afraid I'm not likely to be of much use here in the short term. If bz is unavailable, I could go deeper, but he's probably the shortest path to an answer.Flags: needinfo?(mconley)

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1284395#c11)• 9 years ago |
|  | |

Attached image
[screenshot.png](attachment.cgi?id=8768275)
— [Details](attachment.cgi?id=8768275&action=edit)

(In reply to :Gijs Kruitbosch from [comment #8](/show_bug.cgi?id=1284395#c8 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)"))
> (In reply to Abdulrahman Alqabandi[test] from [comment #6](/show_bug.cgi?id=1284395#c6 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)"))
> > Note: in the above PoC you need to manually navigate back to see full effect.
>
> All of these still show an empty location bar for me, not one with fb.com in
> it, when the attacker-controlled page is displayed (rather than
> facebook.com's actual icon or whatever). Am I misunderstanding how this is
> supposed to work?
Location bar is still empty but (to me at least) it looks like a frozen copy of the content still exists, including the title.Flags: needinfo?(qab)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1284395#c12)• 9 years ago |
|  | |

Boris, any idea what's going on here?Flags: needinfo?(bzbarsky)

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1284395#c13)• 9 years ago |
|  | |

Reading through the last bug with the same results, is it the case that if about:blank has an opener then it will display 'about:blank' visibly? But using the middle mouse button, there is no opener thus the about:blank we end up in is hidden.
I also mentioned that about:blank should always reflect a blank document, and if it has an opener then the location should change from about:blank to the openers url. If no opener exists then you should not be able to perform document.write(). Not sure if that will break anything though.

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1284395#c14)• 9 years ago |
|  | |

(In reply to Abdulrahman Alqabandi[test] from [comment #13](/show_bug.cgi?id=1284395#c13 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)"))
> Reading through the last bug with the same results, is it the case that if
> about:blank has an opener then it will display 'about:blank' visibly? But
> using the middle mouse button, there is no opener thus the about:blank we
> end up in is hidden.
Yes, this is (1) in [comment #3](/show_bug.cgi?id=1284395#c3 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)"), kind of (ie we should have an opener / inherited principal for the middle/modifier+left mouse click).
But we shouldn't end up in an about:blank in the first place, we should keep the JS URI around, per [comment #4](/show_bug.cgi?id=1284395#c4 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)") / item (2) in [comment #3](/show_bug.cgi?id=1284395#c3 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)").
> I also mentioned that about:blank should always reflect a blank document,
> and if it has an opener then the location should change from about:blank to
> the openers url.
We could consider doing this, but it'd probably require some consensus with other browser makers and would provide "interesting" user behaviour as well (e.g. what if they go to the URL in the URL bar and hit enter? Do we load the opener or the current page? It's kind of bizarre to have a page that doesn't correspond to the URL we show in a direct sense.
> If no opener exists then you should not be able to perform
> document.write(). Not sure if that will break anything though.
I don't know that we have a way of freezing the DOM. In any case, I would expect that to break the web, just because the web is crazy. Not super-clear how this would work anyway - what happens to data: and javascript: URIs and assigning those to document.location? Well, you say, those aren't about:blank - and now we're back on the initial point: I don't think we should have a document here with an about:blank-only principal that's controlled by the JS URI.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1284395#a214254_1689)• 9 years ago |

Keywords: [csectype-spoof](/buglist.cgi?keywords=csectype-spoof&resolution=---),
[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1284395#c15)• 9 years ago |
|  | |

Shouldn't this be sec-moderate since [Bug 1228754](/show_bug.cgi?id=1228754 "VERIFIED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) using javascript URI scheme (spoof)") was also?Flags: needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1284395#a319260_1689)• 9 years ago |

Group: core-security → core-security-releaseFlags: needinfo?(dveditz)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1284395#c16)• 9 years ago |
|  | |

In terms of the [comment 3](/show_bug.cgi?id=1284395#c3 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)") behavior, here's what's going on.
1) The javascript: URL gets opened in a new tab. Arguably this is already a bug; note that there is no "open in new tab" context menu item for javascript: links, and I don't think we should open them in new tab for modifier-click either. Anyway, we start loading the javascript: URI via nsDocShell::LoadURIWithOptions. This does not pass in an "owner" and doesn't say an explicit owner is required, so in the nsIDocShellLoadInfo version of nsDocShell::LoadURI we do:
inheritOwner = nsContentUtils::LegacyIsCallerChromeOrNativeCode();
In this case that sets inheritOwner to true. This is a javascript: URI, so does in fact want an inherited principal in general, so we call nsDocShell::GetInheritedPrincipal. This returns the principal of the document in the newly created tab where we're doing the load, which is a codebase principal for "about:blank". We go ahead and run the script against the about:blank document in the new tab and it produces a document in the form of a string return value.
2) When a javascript: URL produces a document, we give it a URL that is the javascript: URL involved. This is actually NOT what the HTML spec says to do; it says to give it a URL that is the URL of the document the javascript: is running against, iirc.
3) Anyway, now the script does a location.reload() (though I'm not sure \_why\_ history.length == 0 at this point!). This performs a history navigation to a javascript: URI. we have a special case in our history navigation code: when the navigation is to a javascript: URI we will create an about:blank document to run it against. The reason for that is as follows. Say I load site A, which loads a javascript: URI which produces a document which then links to site B which is known to do a history.back(). When the history.back() happens, we do NOT want to run the javascript: script against site B! So in practice we throw our hands up in the air and CreateAboutBlankContentViewer to run the javascript: against. Note that if we followed the HTML spec here that would amount to throwing our hands up in the air in a different way; we'd simply load the document the javascript: URL had run against and not run the javascript: at all.
4) Anyway, the javascript: runs a second time but this time history.length == 1, so it doesn't return a string. Instead it navigates to a data: URL and then goes back and runs yet another branch that does a document.write. As [comment 3](/show_bug.cgi?id=1284395#c3 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)") points out this part isn't really that relevant. It's just ending up at about:blank, then doing a document.write. The spinner is going because we did document.write on an already-loaded document and then didn't document.close().
Anyway, from Gecko's point of view none of this is fundamentally different from this testcase:
data:text/html,<div onclick="var w = window.open('about:blank'); w.setTimeout('document.write(&quot;<b>Is this a spoof?</b>&quot;)', 1000);">Click me</div>
This testcase shows "about:blank" in the URL bar, though... Why doesn't the other?
Responding to the list of "strange things" in [comment 3](/show_bug.cgi?id=1284395#c3 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)"):
> I'd expect the initial JS URI to load against a page that's
> inherited the principal of the page from which we clicked the link.
Gecko isn't being told anything about any of that. It's just being told to run a javascript: URL against the newly create tab, which just has an about:blank inside it so far.
> The location.reload() from the 'response of the js URI seems to be running against an "about:blank" document.
So is the original execution, of course. Anyway, see above for why this is happening, along with the differences between what we do and what the spec says to do. In any case, per spec all the reload() would do is load about:blank and not run any more code.Flags: needinfo?(bzbarsky)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1284395#c17)• 9 years ago |
|  | |

Oh, and note that the javascript: URL in question \_sometimes\_ creates a new document (by returning a string) and sometimes does \_NOT\_. Which is why the URL is sometimes "javascript:stuff" and sometimes "about:blank": the latter is when the script execution did not create a new document.

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1284395#c18)• 9 years ago |
|  | |

(In reply to Boris Zbarsky [:bz] from [comment #16](/show_bug.cgi?id=1284395#c16 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)"))
> In terms of the [comment 3](/show_bug.cgi?id=1284395#c3 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)") behavior, here's what's going on.
>
> 1) The javascript: URL gets opened in a new tab. Arguably this is already a
> bug; note that there is no "open in new tab" context menu item for
> javascript: links, and I don't think we should open them in new tab for
> modifier-click either.
I expect we do this because having literally nothing happen when you middle/alt/cmd-click a link is counterintuitive, as is having something happen in the current tab (if you were trying to make sure that didn't happen). It's hard to be consistent with user expectations for js links.
The other thing I noticed is that the context menu determination is made in <http://searchfox.org/mozilla-central/rev/c44d0b1673fef5e0e2e19fa82d6780a74c186151/browser/base/content/nsContextMenu.js#942-951> .
It doesn't include data: URIs which I imagine would have the same problem (but maybe not because they can't not "return" a document in the same way js URIs can?).
> Anyway, we start loading the javascript: URI via
> nsDocShell::LoadURIWithOptions. This does not pass in an "owner" and
> doesn't say an explicit owner is required, so in the nsIDocShellLoadInfo
> version of nsDocShell::LoadURI we do:
>
> inheritOwner = nsContentUtils::LegacyIsCallerChromeOrNativeCode();
>
> In this case that sets inheritOwner to true.
This seems wrong. We should make sure that our chrome-js-based thing that deals with loading web content in tabs/windows based on clicks doesn't trigger 'caller is chrome'... :-\
Is there a "manual" way to avoid doing this?
> This is a javascript: URI, so
> does in fact want an inherited principal in general, so we call
> nsDocShell::GetInheritedPrincipal. This returns the principal of the
> document in the newly created tab where we're doing the load, which is a
> codebase principal for "about:blank". We go ahead and run the script
> against the about:blank document in the new tab and it produces a document
> in the form of a string return value.
Is there something chrome JS (which is what's handling the click) can do here to make it inherit the principal of the linking page instead? Pass a principal to loadURI or whatever? Should we manually call createAboutBlankContentViewer (yay xpcom) on the docshell (with the originating page's principal as the argument) and then load the js/data URI? Feels like there should be a better way...
> 2) When a javascript: URL produces a document, we give it a URL that is the
> javascript: URL involved. This is actually NOT what the HTML spec says to
> do; it says to give it a URL that is the URL of the document the javascript:
> is running against, iirc.
>
> 3) Anyway, now the script does a location.reload() (though I'm not sure
> \_why\_ history.length == 0 at this point!).
Yeah, this might be a separate bug. I'd like to sort out the spoof / security stuff first though - you could accomplish the same branching in other ways, I expect.
> This performs a history
> navigation to a javascript: URI. we have a special case in our history
> navigation code: when the navigation is to a javascript: URI we will create
> an about:blank document to run it against. The reason for that is as
> follows. Say I load site A, which loads a javascript: URI which produces a
> document which then links to site B which is known to do a history.back().
> When the history.back() happens, we do NOT want to run the javascript:
> script against site B! So in practice we throw our hands up in the air and
> CreateAboutBlankContentViewer to run the javascript: against. Note that if
> we followed the HTML spec here that would amount to throwing our hands up in
> the air in a different way; we'd simply load the document the javascript:
> URL had run against and not run the javascript: at all.
Where does this live, and can we make it just create the about:blank viewer and then do nothing? Feels like that wouldn't break anything we care about, I hope... (maybe vainly... the web is weird?)
> Anyway, from Gecko's point of view none of this is fundamentally different
> from this testcase:
>
> data:text/html,<div onclick="var w = window.open('about:blank');
> w.setTimeout('document.write(&quot;<b>Is this a spoof?</b>&quot;)',
> 1000);">Click me</div>
>
> This testcase shows "about:blank" in the URL bar, though... Why doesn't the
> other?
This testcase will have browser.hasContentOpener be true (ie window.opener is non-null), in which case we show about:blank:
<http://searchfox.org/mozilla-central/rev/c44d0b1673fef5e0e2e19fa82d6780a74c186151/browser/base/content/browser.js#6451>
The one from [comment #0](/show_bug.cgi?id=1284395#c0 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)") / this bug doesn't because the new window is not generated by web content / window.open, but by the browser "manually" opening a new tab/window/whatever and loading the URL in there.
> > The location.reload() from the 'response of the js URI seems to be running against an "about:blank" document.
>
> So is the original execution, of course. Anyway, see above for why this is
> happening, along with the differences between what we do and what the spec
> says to do. In any case, per spec all the reload() would do is load
> about:blank and not run any more code.
Right. I think this is identical to what I asked earlier. Is this difficult to do?
Feels like the following could be improved:
1) make browser code tell gecko something that'd set up the right principal to begin with
2) make browser code tell gecko something that'd pass the original tab as 'owner' - maybe? What does that do, and do we want it? (e.g. don't want opening link from mozilla.org to google.com in a new tab give google.com a ref to mozilla.org as 'opener' so it can navigate that tab - maybe it should only happen for inherit\_principal URIs, and only if not opening in a different container / private browsing context ?)
3) browser code loading links from the web in tabs shouldn't trigger 'is chrome' caller checks... I think? Maybe I'm being too paranoid?
4) reloading js URIs should just load about:blank
5) can browser code tell gecko something that'd make inherit\_principal URIs have a window.opener when opened in a new tab/window that isn't in a different container / pb context?
Because of private browsing / containers, I think (2) and (5) might not necessarily be sufficient/helpful. I'm not sure (3) even makes sense. So I \*think\* doing both (1) and (4) is our best chance for fixing the spoofing in that we should be able to tell we can't show a clear location bar where remote web content controls the page (and perhaps, in the future, we can show an origin'd thing instead of the string "about:blank"). We need (1) because otherwise, AIUI, we might still not show the right thing if there aren't any location.reload()s or whatever. We need (4) because otherwise the location.reload does something wonky. Is that right? Am I missing something or is my reasoning broken in places (probably!)?Flags: needinfo?(bzbarsky)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1284395#c19)• 9 years ago |
|  | |

> It doesn't include data: URIs which I imagine would have the same problem
Not entirely, because they just produce a document and don't involve interacting with another one to do so, unlike javascript:. There are literally zero use cases I can think of for taking a javascript: link in a page and running it against a new about:blank tab....
> We should make sure that our chrome-js-based thing that deals with loading
> web content in tabs/windows based on clicks doesn't trigger 'caller is chrome'
That's a bit tough. Also, why would you want that?
Anyway, in this case the only practical impact would be to not inherit the owner, so you can just pass LOAD\_FLAGS\_DISALLOW\_INHERIT\_OWNER to accomplish that in this case, I would think.
> Is there something chrome JS (which is what's handling the click)
> can do here to make it inherit the principal of the linking page instead?
Looks like right now the answer is "no" for the load directly, because nsIDocShell::loadURI is noscript. We could add another scriptable API on nsIDocShell or nsIWebNavigation that allowed one to do this.
However note that in this case what that would simply make the javascript: not run because its principal would not match that of the about:blank involved so Gecko would disallow its execution. Maybe that's fine, though. Again, the use cases for modifier-click on a javascript: URL seem pretty slim to me.
> Should we manually call createAboutBlankContentViewer (yay xpcom) on
> the docshell (with the originating page's principal as the argument)
That would work, yes. I agree it's a bit action-at-a-distance.
> Where does this live, and can we make it just create the about:blank viewer and then do nothing?
Where does which live? The history traversal to javascript: hack? That's at <http://searchfox.org/mozilla-central/rev/c44d0b1673fef5e0e2e19fa82d6780a74c186151/docshell/base/nsDocShell.cpp#12314>
> maybe vainly... the web is weird?
Indeed. If we're going to change anything about this stuff, I'd rather we just aligned the URI of the document for the result string of javascript: with the spec and other browsers.
> This testcase will have browser.hasContentOpener be true (ie window.opener is non-null)
Should that be true for things resulting from modifier-click too?
> Is this difficult to do?
I assume you mean aligning with the spec in terms of the URL that the javascript: result document has. Apart from some thinking about security and auditing all our code for places where we check for "javascript" as a URL, probably not that hard, really. We'd basically have to treat it more as an internal redirect or something in the jschannel (i.e. actually send redirect notifications). That might have problems; not sure.
> What does that do, and do we want it?
It [the owner] sets the principal to use for things that inherit principal (javascript: and data:, mostly). It doesn't involve having a window.opener backref.
> 4) reloading js URIs should just load about:blank
Again, the right thing here is to never have js URIs as a thing you can "reload".
> can browser code tell gecko something that'd make inherit\_principal URIs
> have a window.opener when opened in a new tab/window
So basically treat modifier-click as more like "the link had target=\_blank"?Flags: needinfo?(bzbarsky)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1284395#c20)• 9 years ago |
|  | |

Preamble in case this is helpful: here are the parameters with which I'm trying to work:
A) user manually typing about:blank in the location bar (proxy for: setting about:blank as their new tab page) should result in an empty location bar
B) any web-controlled about:blank page should not result in an empty location bar
I'm bearing in mind that:
- window.open(...) is one of the cases where web content can control about:blank, but AIUI even besides this bug there are other such cases. That is, it is possible for web content to have a content-controlled toplevel about:blank document without that document having an opener (am I wrong in the latter respect?)
- window.opener can be used for evil, there are non-trivial rules governing when it's set, and per the previous point, it's unreliable as an indicator of whether about:blank is controlled by content (see also [bug 1228754](/show_bug.cgi?id=1228754 "VERIFIED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) using javascript URI scheme (spoof)")) so it's not sufficient for determining that such a document exists.
AIUI the problem in this case is that browser code is treating the testcase as (A) when it should be treating it as (B).
The reason for this is that the document principal of the loaded document after the js-triggered location.reload() has the URI of about:blank, the document has no opener, and the document URI (docshell.currentURI / content.document.documentURI) is also about:blank. We need to make sure that one of these things happens:
1) we don't let you open the js URL this way
2) the principal's URI and the document URI should not both be about:blank - both before and after the reload()
3) the principal's URI and the document URI should not both be about:blank before the reload and (i) the reload is disallowed or a no-op; or (ii) the reload results in a non-web-controlled about:blank loading.
1) is hard from my perspective because it's a behaviour change that has UX implications, and not one I feel I could just make unilaterally (whatever we do - Safari does nothing, and Chrome opens about:blank, haven't checked IE/Edge). We'd need to consult UX about what to do and that's a whole general debate about what to do with the js URL, which is ancient ([bug 138198](/show_bug.cgi?id=138198 "REOPENED - \"open link in new tab\" (middle or ctrl click) doesn't work for javascript links")), and I'm worried we'll get stuck in weeds trying to just get anything that's better than the current solution while people try and get The Perfect Thing (whatever that is). So I'd prefer a more short-term fix, but if we think that just removing support is easier I can file a public bug and try to poke UX folks.
I don't know which is easier between 2 and 3 and/or if I'm misunderstanding the problem completely.
(In reply to Boris Zbarsky [:bz] from [comment #19](/show_bug.cgi?id=1284395#c19 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)"))
> > Is there something chrome JS (which is what's handling the click)
> > can do here to make it inherit the principal of the linking page instead?
>
> Looks like right now the answer is "no" for the load directly, because
> nsIDocShell::loadURI is noscript. We could add another scriptable API on
> nsIDocShell or nsIWebNavigation that allowed one to do this.
>
> However note that in this case what that would simply make the javascript:
> not run because its principal would not match that of the about:blank
> involved so Gecko would disallow its execution. Maybe that's fine, though.
> Again, the use cases for modifier-click on a javascript: URL seem pretty
> slim to me.
My suggestion was that the about:blank should have the linking page's principal, and that the JS should inherit principal from that about:blank-with-linking-page's-principal. In which case I'd expect it to "work". Am I missing something?
And I agree the usecases are slim. If this is a giant engineering project we should come up with a simpler solution. If it's a few lines of code and it fixes this bug, good enough for me.
> Indeed. If we're going to change anything about this stuff, I'd rather we
> just aligned the URI of the document for the result string of javascript:
> with the spec and other browsers.
So, to be clear, this is saying the URI of the document of the `<script>location.reload()</script>` and the result of the reload should all be the javascript: URI?
> > This testcase will have browser.hasContentOpener be true (ie window.opener is non-null)
>
> Should that be true for things resulting from modifier-click too?
"It depends". Likely not for e.g. noreferrer/noopener and maybe others. I don't think we can rely on it exclusively. :-(
> > Is this difficult to do?
>
> I assume you mean aligning with the spec in terms of the URL that the
> javascript: result document has. Apart from some thinking about security
> and auditing all our code for places where we check for "javascript" as a
> URL, probably not that hard, really. We'd basically have to treat it more
> as an internal redirect or something in the jschannel (i.e. actually send
> redirect notifications). That might have problems; not sure.
So I'm confused. Looking at clicking the link in:
data:text/html,<a href="javascript:if(true){'<p>Hi</p>'}">click</a>
the document.documentURI of the resulting tab is already javascript:... (and so the location bar shows the js URI rather than about:blank, as the document's principal is about:blank but the document's URI isn't)
That seems correct per what you're saying / the spec. Right? So do we "just" need to make reload() not work / produce a 'plain' non-web-controlled about:blank / produce a document with a JS URI too? Am I still missing the point?
> > 4) reloading js URIs should just load about:blank
>
> Again, the right thing here is to never have js URIs as a thing you can
> "reload".
What happens in this case, then? location.reload throws an exception? Or something else?
> > can browser code tell gecko something that'd make inherit\_principal URIs
> > have a window.opener when opened in a new tab/window
>
> So basically treat modifier-click as more like "the link had target=\_blank"?
Well, it'd only work for new tab/window with the same container / private browsing, and I'd probably want to limit it to inherit\_principal URIs. With those caveats, yes. Because of the caveats, not sure that fixes the issue fully.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1284395#c21)• 9 years ago |
|  | |

> it is possible for web content to have a content-controlled toplevel
> about:blank document without that document having an opener
Sure. Consider a page A that window.opens page B (same-origin with A). Then B does opener.location.href = "about:blank".
I was going to suggest that we simply check whether the principal URI is "about:blank". But of course the whole point of this bug is that this is exactly the situation we end up in, because we execute a web-provided javascript: URI against a browser-created about:blank document.
> 2) the principal's URI and the document URI should not both be about:blank -
> both before and after the reload()
The reload() call preserves the principal's URI. So if it's not about:blank before the reload(), it won't be after either.
> I don't know which is easier between 2 and 3 and/or if I'm misunderstanding the
> problem completely.
I think your understanding of the problem is correct.
Right now, the principal's URI and document URI can both be trivially about:blank before the reload, or indeed without any reload. Just do this:
data:text/html,<a href="javascript:document.write('spoof'); void(0);">Middle-click me</a>
Given that, we can aim to fix the pre-reload state principal or the pre-reload state URL. The reload preserves the former and would preserve the latter if it were not "javascript:". In the short term, I expect simply using a non-about:blank principal for the pre-reload state is the simplest thing, but that would need to be done in the frontend... Longer term... well, longer-term once we changed to follow the spec for URLs resulting from javascript: evaluation the URL will be that of the document the evaluation happened in, so it would be about:blank. So the principal change is the only one that fixes things here.
> My suggestion was that the about:blank should have the linking page's principal
That should work, yes.
> So, to be clear, this is saying the URI of the document of the
> `<script>location.reload()</script>` and the result of the reload should all be
> the javascript: URI?
No, they should all be "about:blank" per spec. The only thing it would fix is that the reload() would actually load about:blank and not run any script on it. But as my example above shows, we don't even need the reload().
> data:text/html,<a href="javascript:if(true){'<p>Hi</p>'}">click</a>
> the document.documentURI of the resulting tab is already javascript:
Per spec it shouldn't be.
> What happens in this case, then?
The spec has no concept of a document with a "javascript:" URI. There is simply no such thing. A "javascript:" URI, in the spec, is just something that gets handled in a special hack in the navigation code, and produces a document with some other URI, if it produces a document at all.

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1284395#c22)• 9 years ago |
|  | |

(In reply to Boris Zbarsky [:bz] from [comment #21](/show_bug.cgi?id=1284395#c21 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)"))
> Given that, we can aim to fix the pre-reload state principal or the
> pre-reload state URL. The reload preserves the former and would preserve
> the latter if it were not "javascript:". In the short term, I expect simply
> using a non-about:blank principal for the pre-reload state is the simplest
> thing, but that would need to be done in the frontend...
I'll try and look at this in the near-ish future, then. Thanks!Assignee: nobody → gijskruitbosch+bugsStatus: UNCONFIRMED → ASSIGNEDComponent: Document Navigation → GeneralEver confirmed: trueProduct: Core → Firefox

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1284395#c23)• 8 years ago |
|  | |

Attached patch

[Patch v0.1](attachment.cgi?id=8788460&action=diff) (obsolete)
— [Details](attachment.cgi?id=8788460&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8788460)

I believe this works.
The gist of it is that for content clicks and context menu opening of links, we pass the principal of the page with the link to openLinkIn, and then all the way down into addTab code, and then we use that code to inherit the principal of the linking page into the about:blank viewer we create.
The net result is that we display "about:blank" in the URL bar for the testcase on this bug, when we previously cleared the URL bar.
[bug 1297008](/show_bug.cgi?id=1297008 "ASSIGNED") would independently change what we do in these cases to display a/the URI associated with the principal that controls the about:blank viewer, but is orthogonal to this patch.
I'm also not trying to address issues with the 'spinner' in the tab, which I suspect could be dealt with in a non-sec-sensitive bug with non-"malicious"-JS.
I'm not very happy with the complexity the patch adds, but I suspect we might be wanting the principal stuff anyway for things like [bug 1289097](/show_bug.cgi?id=1289097 "NEW - Investigate TriggeringPrincipal for toplevel docshell loads where URL is typed into address bar"). I'd be curious if this looks right to you both, Boris and Mike.
NB: in case it wasn't obvious from the patch: the window opening (rather than tab) path ends up calling loadURI to call openLinkIn to open a link in the current tab, and to avoid always creating a new about:blank viewer in that tab, I'm specialcasing the case where this is triggered through window opening to create said new content viewer. I hope this makes sense.
[Attachment #8788460](/attachment.cgi?id=8788460&action=edit "Patch v0.1") -
Flags: review?(mconley)
[Attachment #8788460](/attachment.cgi?id=8788460&action=edit "Patch v0.1") -
Flags: review?(bzbarsky)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1284395#c24)• 8 years ago |
|  | |

Orthogonal: the context menu options to open links in a new tab/window/whatever is not available for javascript: links.
Perhaps a simpler solution would be to make middle/modifier-clicks on such links no-op? Though that feels like it has a UX impact, and could potentially break actual usecases (though they'd be a little byzantine).

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1284395#c25)• 8 years ago |
|  | |

Comment on [attachment 8788460](/attachment.cgi?id=8788460 "Patch v0.1") [[details]](/attachment.cgi?id=8788460&action=edit "Patch v0.1") [[diff]](/attachment.cgi?id=8788460&action=diff "Patch v0.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8788460)
Patch v0.1
>+ json.originPrincipal = ownerDoc.nodePrincipal;
How is that supposed to work? Is the thing being sent not really json?
Modulo that, r=me on the general idea, but I don't know enough about the details of these codepaths to say something intelligent.
[Attachment #8788460](/attachment.cgi?id=8788460&action=edit "Patch v0.1") -
Flags: review?(bzbarsky) → review+

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1284395#c26)• 8 years ago |
|  | |

Comment on [attachment 8788460](/attachment.cgi?id=8788460 "Patch v0.1") [[details]](/attachment.cgi?id=8788460&action=edit "Patch v0.1") [[diff]](/attachment.cgi?id=8788460&action=diff "Patch v0.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8788460)
Patch v0.1
Review of [attachment 8788460](/attachment.cgi?id=8788460 "Patch v0.1") [[details]](/attachment.cgi?id=8788460&action=edit "Patch v0.1") [[diff]](/attachment.cgi?id=8788460&action=diff "Patch v0.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8788460):
-----------------------------------------------------------------
::: browser/base/content/content.js
@@ +502,5 @@
> sm.checkSameOriginURI(docshell.mixedContentChannel.URI, targetURI, false);
> json.allowMixedContent = true;
> } catch (e) {}
> }
> + json.originPrincipal = ownerDoc.nodePrincipal;
AIUI this is all structured clone stuff for e10s, which should be able to deal with serializing and deserializing nsIURI and nsIPrincipal objects... mconley should be able to confirm?
Separately, I think this assignment might need to be outside (before) this particular if block to cover the 'middle click as paste to navigate' case as well.

|  | [Mike Conley (:mconley) (:⚙️)](/user_profile?user_id=403756) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1284395#c27)• 8 years ago |
|  | |

Comment on [attachment 8788460](/attachment.cgi?id=8788460 "Patch v0.1") [[details]](/attachment.cgi?id=8788460&action=edit "Patch v0.1") [[diff]](/attachment.cgi?id=8788460&action=diff "Patch v0.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8788460)
Patch v0.1
Review of [attachment 8788460](/attachment.cgi?id=8788460 "Patch v0.1") [[details]](/attachment.cgi?id=8788460&action=edit "Patch v0.1") [[diff]](/attachment.cgi?id=8788460&action=diff "Patch v0.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8788460):
-----------------------------------------------------------------
Thanks Gijs. Would it be possible to add a regression test?
(In reply to :Gijs Kruitbosch from [comment #26](/show_bug.cgi?id=1284395#c26 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)"))
> Comment on [attachment 8788460](/attachment.cgi?id=8788460 "Patch v0.1") [[details]](/attachment.cgi?id=8788460&action=edit "Patch v0.1") [[diff]](/attachment.cgi?id=8788460&action=diff "Patch v0.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8788460)
> Patch v0.1
>
> Review of [attachment 8788460](/attachment.cgi?id=8788460 "Patch v0.1") [[details]](/attachment.cgi?id=8788460&action=edit "Patch v0.1") [[diff]](/attachment.cgi?id=8788460&action=diff "Patch v0.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8788460):
> -----------------------------------------------------------------
>
> ::: browser/base/content/content.js
> @@ +502,5 @@
> > sm.checkSameOriginURI(docshell.mixedContentChannel.URI, targetURI, false);
> > json.allowMixedContent = true;
> > } catch (e) {}
> > }
> > + json.originPrincipal = ownerDoc.nodePrincipal;
>
> AIUI this is all structured clone stuff for e10s, which should be able to
> deal with serializing and deserializing nsIURI and nsIPrincipal objects...
> mconley should be able to confirm?
Yep - billm added this capability in [bug 1032592](/show_bug.cgi?id=1032592 "RESOLVED FIXED - Allow principals to be sent with the message manager").
::: browser/base/content/tabbrowser.xml
@@ +2081,5 @@
> var evt = new CustomEvent("TabOpen", { bubbles: true, detail });
> t.dispatchEvent(evt);
>
> + if (!usingPreloadedContent && aOriginPrincipal) {
> + b.createAboutBlankContentViewer(aOriginPrincipal);
Hrm. Hopefully this new work doesn't burn us on some of our talos tests...
::: toolkit/content/widgets/browser.xml
@@ +1043,5 @@
> + <method name="createAboutBlankContentViewer">
> + <parameter name="aPrincipal"/>
> + <body>
> + <![CDATA[
> + this.docShell.createAboutBlankContentViewer(aPrincipal);
We could alternatively use the shared browser-content.js so that both remote and non-remote browsers share the same codepath for this. I don't mind either way, tbh.
[Attachment #8788460](/attachment.cgi?id=8788460&action=edit "Patch v0.1") -
Flags: review?(mconley) → review+

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1284395#c28)• 8 years ago |
|  | |

(In reply to Mike Conley (:mconley) - (Digging through needinfos and reviews) from [comment #27](/show_bug.cgi?id=1284395#c27 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)"))
> Comment on [attachment 8788460](/attachment.cgi?id=8788460 "Patch v0.1") [[details]](/attachment.cgi?id=8788460&action=edit "Patch v0.1") [[diff]](/attachment.cgi?id=8788460&action=diff "Patch v0.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8788460)
> Patch v0.1
>
> Review of [attachment 8788460](/attachment.cgi?id=8788460 "Patch v0.1") [[details]](/attachment.cgi?id=8788460&action=edit "Patch v0.1") [[diff]](/attachment.cgi?id=8788460&action=diff "Patch v0.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8788460):
> -----------------------------------------------------------------
>
> Thanks Gijs. Would it be possible to add a regression test?
Maybe. I'll have a look.
> (In reply to :Gijs Kruitbosch from [comment #26](/show_bug.cgi?id=1284395#c26 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)"))
> ::: browser/base/content/tabbrowser.xml
> @@ +2081,5 @@
> > var evt = new CustomEvent("TabOpen", { bubbles: true, detail });
> > t.dispatchEvent(evt);
> >
> > + if (!usingPreloadedContent && aOriginPrincipal) {
> > + b.createAboutBlankContentViewer(aOriginPrincipal);
>
> Hrm. Hopefully this new work doesn't burn us on some of our talos tests...
I would assume they don't go through the tab opening code path via content clicks.
Of course, where it does impact perf in those cases, this would still be a concern even if talos didn't measure it.
Boris, would it be safe to restrict this "create our own viewer" malarkey to cases where we know the URL is going to inherit, and if so, what's the correct way to determine that?Flags: needinfo?(bzbarsky)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1284395#c29)• 8 years ago |
|  | |

You can determine that by checking for the URI\_INHERITS\_SECURITY\_CONTEXT flag. Though there's some weirdness around about:blank, which does not have that flag but \_can\_ inherit...
For whether it's safe... I'm not sure what problem the createAboutBlankContentViewer() call is trying to solve, so can't tell you for sure.Flags: needinfo?(bzbarsky)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1284395#c30)• 8 years ago |
|  | |

(In reply to Boris Zbarsky [:bz] from [comment #29](/show_bug.cgi?id=1284395#c29 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)"))
> You can determine that by checking for the URI\_INHERITS\_SECURITY\_CONTEXT
> flag. Though there's some weirdness around about:blank, which does not have
> that flag but \_can\_ inherit...
Good to know.
> For whether it's safe... I'm not sure what problem the
> createAboutBlankContentViewer() call is trying to solve, so can't tell you
> for sure.
Well, this:
(In reply to :Gijs Kruitbosch from [comment #22](/show_bug.cgi?id=1284395#c22 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)"))
> (In reply to Boris Zbarsky [:bz] from [comment #21](/show_bug.cgi?id=1284395#c21 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)"))
> > Given that, we can aim to fix the pre-reload state principal or the
> > pre-reload state URL. The reload preserves the former and would preserve
> > the latter if it were not "javascript:". In the short term, I expect simply
> > using a non-about:blank principal for the pre-reload state is the simplest
> > thing, but that would need to be done in the frontend...
>
> I'll try and look at this in the near-ish future, then. Thanks!
In order to get a non-about:blank principal (for the javascript:foo URI we're loading in the new tab), I'm making the about:blank window (content viewer) inherit the principal of the page on which the user clicks the js:foo link. Does that make sense? The case we're trying to avoid is where js: or data: URIs inherit the principal of the new about:blank tab/window in which they're being opened, AIUI. Is there a better way to accomplish this? (ni for this)
But really, maybe it's worth doing some more digging here. In particular, I suspect (but haven't tested) that one can't currently do the same thing with a data: URI as the testcase here does, given sufficient messings-about (e.g. having the data URI set location.href to a javascript: URI which then does whatever it's doing here, etc.). There are some... odd... specialcases in the JS code here for javascript: URIs going through openLinkIn, which I suspect are from [bug 1018154](/show_bug.cgi?id=1018154 "VERIFIED FIXED - Strip \"javascript:\" on paste instead of disallowing javascript: URLs entered into the location bar from inheriting the current page's principal"). I'll have to dig into it more next week. :-\Flags: needinfo?(bzbarsky)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1284395#c31)• 8 years ago |
|  | |

OK. So this is specific to the case when we have just opened a new tab, right?
In an ideal world, what we would do is just tell it what principal to use for its about:blank when we create the docshell. But in practice, the createAboutBlankContentViewer call you have may well be fine, if it happens before we create the initial about:blank. It's extra work if we do it \_after\_ that, but it's not really that much work compared to the general work to set up a new docshell... and if we do care to optimize it we can add some way to hand the principal to the docshell before the initial about:blank is created.Flags: needinfo?(bzbarsky)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1284395#c32)• 8 years ago |
|  | |

(In reply to Boris Zbarsky [:bz] from [comment #31](/show_bug.cgi?id=1284395#c31 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)"))
> OK. So this is specific to the case when we have just opened a new tab,
> right?
Well, or a new (private/non-private) window. But more or less "yes", especially to "have just created / are just creating a new content docshell".
> In an ideal world, what we would do is just tell it what principal to use
> for its about:blank when we create the docshell. But in practice, the
> createAboutBlankContentViewer call you have may well be fine, if it happens
> before we create the initial about:blank.
I... doubt it's before that, but OK.
> It's extra work if we do it
> \_after\_ that, but it's not really that much work compared to the general
> work to set up a new docshell... and if we do care to optimize it we can
> add some way to hand the principal to the docshell before the initial
> about:blank is created.
Fair. Let's just try how this goes and we can see if anybody (esp. perf test infra) notices anything.
I still need to write a regression test per [comment #27](/show_bug.cgi?id=1284395#c27 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)").

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1284395#c33)• 8 years ago |
|  | |

Attached patch

[Patch v0.2](attachment.cgi?id=8791412&action=diff) (obsolete)
— [Details](attachment.cgi?id=8791412&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8791412)

Now with test. I also had to declare a variable in tabbrowser.xml that I missed (oops).
[Attachment #8788460](/attachment.cgi?id=8788460&action=edit "Patch v0.1") -
Attachment is obsolete: true
[Attachment #8791412](/attachment.cgi?id=8791412&action=edit "Patch v0.2") -
Flags: review?(mconley)

|  | [Mike Conley (:mconley) (:⚙️)](/user_profile?user_id=403756) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1284395#c34)• 8 years ago |
|  | |

Comment on [attachment 8791412](/attachment.cgi?id=8791412 "Patch v0.2") [[details]](/attachment.cgi?id=8791412&action=edit "Patch v0.2") [[diff]](/attachment.cgi?id=8791412&action=diff "Patch v0.2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8791412)
Patch v0.2
Review of [attachment 8791412](/attachment.cgi?id=8791412 "Patch v0.2") [[details]](/attachment.cgi?id=8791412&action=edit "Patch v0.2") [[diff]](/attachment.cgi?id=8791412&action=diff "Patch v0.2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8791412):
-----------------------------------------------------------------
This looks okay to me. And I definitely think it makes sense to be passing the principal around like this anyways - I'm actually surprised we weren't doing that before.
::: browser/base/content/tabbrowser.xml
@@ +2098,5 @@
> var evt = new CustomEvent("TabOpen", { bubbles: true, detail });
> t.dispatchEvent(evt);
>
> + if (!usingPreloadedContent && aOriginPrincipal) {
> + b.createAboutBlankContentViewer(aOriginPrincipal);
I wonder if this is going to cause any Talos regressions...
::: browser/base/content/test/general/browser\_modifiedclick\_inherit\_principal.js
@@ +3,5 @@
> +const kURL =
> + "<http://example.com/browser/browser/base/content/test/general/dummy_page.html>";
> + "data:text/html,<a href=''>Middle-click me</a>";
> +
> +add\_task(function\* () {
Please add a comment at the top here about what exactly is being tested.
@@ +17,5 @@
> + yield BrowserTestUtils.synthesizeMouseAtCenter("a", {button: 1}, browser);
> + let newTab = yield newTabPromise;
> + is(newTab.linkedBrowser.contentPrincipal.origin, "<http://example.com>",
> + "Principal should be for example.com");
> + yield BrowserTestUtils.removeTab(newTab);
Should we be testing the URL bar here as well?
[Attachment #8791412](/attachment.cgi?id=8791412&action=edit "Patch v0.2") -
Flags: review?(mconley) → review+

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1284395#c35)• 8 years ago |
|  | |

(In reply to Mike Conley (:mconley) - (needinfo me!) from [comment #34](/show_bug.cgi?id=1284395#c34 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)"))
> Comment on [attachment 8791412](/attachment.cgi?id=8791412 "Patch v0.2") [[details]](/attachment.cgi?id=8791412&action=edit "Patch v0.2") [[diff]](/attachment.cgi?id=8791412&action=diff "Patch v0.2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8791412)
> Patch v0.2
>
> Review of [attachment 8791412](/attachment.cgi?id=8791412 "Patch v0.2") [[details]](/attachment.cgi?id=8791412&action=edit "Patch v0.2") [[diff]](/attachment.cgi?id=8791412&action=diff "Patch v0.2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8791412):
> -----------------------------------------------------------------
>
> This looks okay to me. And I definitely think it makes sense to be passing
> the principal around like this anyways - I'm actually surprised we weren't
> doing that before.
>
> ::: browser/base/content/tabbrowser.xml
> @@ +2098,5 @@
> > var evt = new CustomEvent("TabOpen", { bubbles: true, detail });
> > t.dispatchEvent(evt);
> >
> > + if (!usingPreloadedContent && aOriginPrincipal) {
> > + b.createAboutBlankContentViewer(aOriginPrincipal);
>
> I wonder if this is going to cause any Talos regressions...
I don't think so, because all of this is about what happens if code from the Firefox UI opens stuff. It doesn't happen for window.open and so on. So I don't think we'll hit this on Talos. I also don't think the hit will be serious enough to worry about.
remote: <https://hg.mozilla.org/integration/mozilla-inbound/rev/6036b8acdab5>
I'll CC jmaher in case we do see a talos hit on central and this patch is to blame. There are options to reduce the impact (like only doing this for URIs that inherit the principal (see [comment #30](/show_bug.cgi?id=1284395#c30 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)"))) but that might be tricky to get completely right when it comes to think like URI fixup and so on... so if we can avoid it, I would like not to bother. :-)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1284395#c36)• 8 years ago |
|  | |

So this is getting backed out because of the containers code which means we can't change origin attributes after the docshell has been created.
I'm not so interested in the origin attributes, I'm interested in the principal.
How do I get the same principal with origin attributes that make this code happy?Flags: needinfo?(amarchesini)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1284395#c37)• 8 years ago |
|  | |

(In reply to :Gijs Kruitbosch from [comment #36](/show_bug.cgi?id=1284395#c36 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)"))
> So this is getting backed out because of the containers code which means we
> can't change origin attributes after the docshell has been created.
>
> I'm not so interested in the origin attributes, I'm interested in the
> principal.
>
> How do I get the same principal with origin attributes that make this code
> happy?
Failures:
<https://treeherder.mozilla.org/logviewer.html#?job_id=36082765&repo=mozilla-inbound#L3461>
to be very specific: given principal X and principal Y, I want a principal X' that has the same origin usercontextid as Y and is otherwise identical to X.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1284395#c38)• 8 years ago |
|  | |

Is the setup that we have a link in a docshell with user context id A and then we "open link in new tab" it? Ad the origin principal has user context id A?
If that's the situation, where is another user context id coming from? Are we creating the new tab with a different user context id than A?

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1284395#c39)• 8 years ago |
|  | |

(In reply to Boris Zbarsky [:bz] (TPAC) from [comment #38](/show_bug.cgi?id=1284395#c38 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)"))
> Is the setup that we have a link in a docshell with user context id A and
> then we "open link in new tab" it? Ad the origin principal has user context
> id A?
>
> If that's the situation, where is another user context id coming from? Are
> we creating the new tab with a different user context id than A?
The latter. Nightly has context menus with "open in a new container tab", and so that produces a tab with a different user context id (or should, anyway).

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1284395#c40)• 8 years ago |
|  | |

Backout: <https://hg.mozilla.org/integration/mozilla-inbound/rev/97d4dcf688a0>

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1284395#c41)• 8 years ago |
|  | |

Ah, I see.
So for codebase principals , you can do nsIScriptSecurityManager.createCodebasePrincipal. For a nullprincipal you can nsIScriptSecurityManager.nsIScriptSecurityManager. For system principals, you're out of luck because those have no originattributes anyway. Expanded principals should never be an origin principal here...

|  | [Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)](/user_profile?user_id=308534) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1284395#c42)• 8 years ago |
|  | |

Merged backout: <https://hg.mozilla.org/mozilla-central/rev/6036b8acdab5>
Not sure what that means for status flags in this bug.Flags: needinfo?(gijskruitbosch+bugs)

|  | [Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)](/user_profile?user_id=308534) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1284395#a6628785_308534)• 8 years ago |

Flags: needinfo?(gijskruitbosch+bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1284395#a6662812_159069)• 8 years ago |

Flags: needinfo?(amarchesini)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1284395#c43)• 8 years ago |
|  | |

Attached patch

[Patch v0.3](attachment.cgi?id=8792848&action=diff) (obsolete)
— [Details](attachment.cgi?id=8792848&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8792848)

I verified this avoids a crash. baku, can you sanity-check the utility function in utilityOverlay.js?
(I realize that this means that if you have a null-principal'd origin and you change the usercontextid when opening the link in a new tab, the link will no longer be same-origin. I believe that that would be the case as a result of the different usercontextid already, so I think that's OK.)
Trypush:
remote: <https://treeherder.mozilla.org/#/jobs?repo=try&revision=a6de29bafe59>
[Attachment #8791412](/attachment.cgi?id=8791412&action=edit "Patch v0.2") -
Attachment is obsolete: true
[Attachment #8792848](/attachment.cgi?id=8792848&action=edit "Patch v0.3") -
Flags: review?(amarchesini)

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1284395#c44)• 8 years ago |
|  | |

Comment on [attachment 8792848](/attachment.cgi?id=8792848 "Patch v0.3") [[details]](/attachment.cgi?id=8792848&action=edit "Patch v0.3") [[diff]](/attachment.cgi?id=8792848&action=diff "Patch v0.3") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8792848)
Patch v0.3
Review of [attachment 8792848](/attachment.cgi?id=8792848 "Patch v0.3") [[details]](/attachment.cgi?id=8792848&action=edit "Patch v0.3") [[diff]](/attachment.cgi?id=8792848&action=diff "Patch v0.3") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8792848):
-----------------------------------------------------------------
Sorry for the delay. looks good to me.
[Attachment #8792848](/attachment.cgi?id=8792848&action=edit "Patch v0.3") -
Flags: review?(amarchesini) → review+

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1284395#a6788449_159069)• 8 years ago |

Depends on: [1304492](/show_bug.cgi?id=1304492 "RESOLVED FIXED - remote-browser's contentPrincipal initially lies about originAttributes")

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1284395#c45)• 8 years ago |
|  | |

Attached patch

[Patch v0.4](attachment.cgi?id=8793491&action=diff)
— [Details](attachment.cgi?id=8793491&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8793491)

try is still orange, because it doesn't like opening private browsing windows with links, which have non-0 privateBrowsingIds and so assigning a 0 there makes it... unhappy.
So really, we should copy all the originAttributes from the initial about:blank, I think. That is slightly problematic with the approach in the previous patch which did this in the parent on e10s, which doesn't work because of [bug 1304492](/show_bug.cgi?id=1304492 "RESOLVED FIXED - remote-browser's contentPrincipal initially lies about originAttributes").
Really, if createAboutBlankContentViewer called with the 'wrong' principal is always wrong, it seems there's little point in calling it with such principals, so I've pushed the responsibility for changing those down into the browser implementations with the utility function moving to BrowserUtils and taking a full-on second principal. Principal rather than just the OA so we can easily ask for originSuffix and determine if we need to actually bother to create a second principal.
(We should still fix [bug 1304492](/show_bug.cgi?id=1304492 "RESOLVED FIXED - remote-browser's contentPrincipal initially lies about originAttributes"), but that might get hairy and I would prefer not to hold up this change for its sake.)
[Attachment #8792848](/attachment.cgi?id=8792848&action=edit "Patch v0.3") -
Attachment is obsolete: true
[Attachment #8793491](/attachment.cgi?id=8793491&action=edit "Patch v0.4") -
Flags: review?(mconley)
[Attachment #8793491](/attachment.cgi?id=8793491&action=edit "Patch v0.4") -
Flags: review?(amarchesini)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1284395#c46)• 8 years ago |
|  | |

remote: <https://treeherder.mozilla.org/#/jobs?repo=try&revision=2dca3eb50711>

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1284395#c47)• 8 years ago |
|  | |

Comment on [attachment 8793491](/attachment.cgi?id=8793491 "Patch v0.4") [[details]](/attachment.cgi?id=8793491&action=edit "Patch v0.4") [[diff]](/attachment.cgi?id=8793491&action=diff "Patch v0.4") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8793491)
Patch v0.4
Review of [attachment 8793491](/attachment.cgi?id=8793491 "Patch v0.4") [[details]](/attachment.cgi?id=8793491&action=edit "Patch v0.4") [[diff]](/attachment.cgi?id=8793491&action=diff "Patch v0.4") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8793491):
-----------------------------------------------------------------
::: toolkit/modules/BrowserUtils.jsm
@@ +88,5 @@
> + return principal;
> + }
> +
> + // If they're the same, just return the principal as-is.
> + if (existingPrincipal.originSuffix == principal.originSuffix) {
existingPrincipal.equals(principal)
[Attachment #8793491](/attachment.cgi?id=8793491&action=edit "Patch v0.4") -
Flags: review?(amarchesini) → review+

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=1284395#c48)• 8 years ago |
|  | |

(In reply to Andrea Marchesini [:baku] from [comment #47](/show_bug.cgi?id=1284395#c47 "RESOLVED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)"))
> Comment on [attachment 8793491](/attachment.cgi?id=8793491 "Patch v0.4") [[details]](/attachment.cgi?id=8793491&action=edit "Patch v0.4") [[diff]](/attachment.cgi?id=8793491&action=diff "Patch v0.4") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8793491)
> Patch v0.4
>
> Review of [attachment 8793491](/attachment.cgi?id=8793491 "Patch v0.4") [[details]](/attachment.cgi?id=8793491&action=edit "Patch v0.4") [[diff]](/attachment.cgi?id=8793491&action=diff "Patch v0.4") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8793491):
> -----------------------------------------------------------------
>
> ::: toolkit/modules/BrowserUtils.jsm
> @@ +88,5 @@
> > + return principal;
> > + }
> > +
> > + // If they're the same, just return the principal as-is.
> > + if (existingPrincipal.originSuffix == principal.originSuffix) {
>
> existingPrincipal.equals(principal)
This wouldn't be the case because their codebases will be different, no? In particular, the "whole point" of this patch is to get the new about:blank viewer that we're creating the inherited principal from example.com, and the existing principal is likely either for null or moz-safe-about:blank or whatever. The check here is if the \*origin attributes\* are the same - hence checking originSuffix, which AIUI is basically a serialization of the OA.Flags: needinfo?(amarchesini)

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257) |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=1284395#c49)• 8 years ago |
|  | |

> > existingPrincipal.equals(principal)
You are right. We must check only the originSuffix. I was confused by 'if they are the same'.Flags: needinfo?(amarchesini)

|  | [Mike Conley (:mconley) (:⚙️)](/user_profile?user_id=403756) |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=1284395#c50)• 8 years ago |
|  | |

Comment on [attachment 8793491](/attachment.cgi?id=8793491 "Patch v0.4") [[details]](/attachment.cgi?id=8793491&action=edit "Patch v0.4") [[diff]](/attachment.cgi?id=8793491&action=diff "Patch v0.4") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8793491)
Patch v0.4
Review of [attachment 8793491](/attachment.cgi?id=8793491 "Patch v0.4") [[details]](/attachment.cgi?id=8793491&action=edit "Patch v0.4") [[diff]](/attachment.cgi?id=8793491&action=diff "Patch v0.4") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8793491):
-----------------------------------------------------------------
With baku's issue fixed and my docstring fixed, I think we're good to go here. Thanks Gijs!
::: toolkit/modules/BrowserUtils.jsm
@@ +81,5 @@
> throw "Load of " + aURL + principalStr + " denied.";
> }
> },
>
> + principalWithMatchingOA(principal, existingPrincipal) {
Please add a docstring.
[Attachment #8793491](/attachment.cgi?id=8793491&action=edit "Patch v0.4") -
Flags: review?(mconley) → review+

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=1284395#c51)• 8 years ago |
|  | |

remote: <https://hg.mozilla.org/integration/mozilla-inbound/rev/a45cfe898352>

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293) |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=1284395#c52)• 8 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/a45cfe898352>Status: ASSIGNED → RESOLVEDClosed: 8 years ago
[status-firefox52](/buglist.cgi?f1=cf_status_firefox52&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → Firefox 52

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1284395#a11442838_159069)• 8 years ago |

Depends on: [1315553](/show_bug.cgi?id=1315553 "NEW - Opening an about:blank tab with an explicit NullPrincipal breaks the document")

|  | [Kamil Jozwiak [:kjozwiak]](/user_profile?user_id=455785) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1284395#a20446492_455785)• 8 years ago |

Flags: qe-verify-Whiteboard: [post-critsmash-triage]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1284395#a20630235_280903)• 8 years ago |

Whiteboard: [post-critsmash-triage] → [post-critsmash-triage][adv-main52+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1284395#a20702469_280903)• 8 years ago |

Alias: CVE-2017-5420

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1284395#a24134556_159069)• 8 years ago |

Depends on: [1354796](/show_bug.cgi?id=1354796 "VERIFIED FIXED - Right-click new tab loses URL information if site is down")

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1284395#a24224161_159069)• 8 years ago |

No longer depends on: [1354796](/show_bug.cgi?id=1354796 "VERIFIED FIXED - Right-click new tab loses URL information if site is down")

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1284395#a24224162_159069)• 8 years ago |

See Also: → [1354796](/show_bug.cgi?id=1354796 "VERIFIED FIXED - Right-click new tab loses URL information if site is down")

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=1284395#c53)• 8 years ago |
|  | |

Can this be opened up, given it's sec-low and fixed in 52esr?Flags: needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1284395#a27512242_1689)• 8 years ago |

Group: core-security-releaseFlags: needinfo?(dveditz)

|  | [Dão Gottwald [:dao]](/user_profile?user_id=219124) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1284395#a28097055_219124)• 8 years ago |

Depends on: [1366203](/show_bug.cgi?id=1366203 "VERIFIED FIXED - Changing URL locations while a page is loading temporarily reverts the URL")
You need to [log in](/show_bug.cgi?id=1284395&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Abdulrahman Alqabandi](/user_profile?user_id=550582)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


