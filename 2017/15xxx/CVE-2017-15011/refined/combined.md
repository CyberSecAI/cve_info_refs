=== Content from www.youtube.com_2acffb2e_20250125_011547.html ===
[00:09] good morning Paris no it's not no it's
[00:12] not morning when we are nothing
[00:15] to say that my name is Gil and I'm the
[00:20] CTO of comms a global and complex is an
[00:23] Israeli company the most veteran and the
[00:25] most the biggest company is Israel of
[00:27] information security I started my career
[00:31] as a military hacker and ster first I
[00:34] was a programmer a.net developer and
[00:37] then I became a military hacker in the
[00:39] IDF I cannot tell you where because then
[00:42] I have to kill you and your lots of
[00:44] people and I cannot cope with each and
[00:45] every one of you but so I'll just
[00:48] spare the details so I've been a hacker
[00:52] for 12 years now I started my career as
[00:54] a application and pin penetration tester
[00:58] now I any hack pretty much everything or
[01:00] most of the things and I'm the lead
[01:04] hacker as the chief technology officer
[01:05] of complex and we have we are a medium
[01:10] company where 150 consultants 600
[01:12] clients in 22 countries and we do a lot
[01:16] of interesting stuff and second we do a
[01:24] lot of interesting stuff is such as the
[01:28] penetration test security development
[01:30] lifecycle in compliance either a PCI DSS
[01:35] and also some advanced services such as
[01:38] red teaming and ethical hacking and we
[01:43] have some guys from a concert here raise
[01:45] your hand so if you want to ask them
[01:47] questions later on please do and among
[01:52] the other things that we do we do
[01:53] occasionally we come up with something
[01:57] interesting and we move on with research
[01:59] and this was the case with the next
[02:02] presentation I'm going to show you about
[02:03] Windows named fight so this is something
[02:06] that we came up with in one of our
[02:10] clients and when you furthering that
[02:12] investigated it we saw that nobody is
[02:15] aware that there is such an interfacing
[02:18] this is why I called this presentation
[02:20] but forgotten in the face and nobody
[02:22] knows that it actually exists and now
[02:25] I'm going to tell you about
[02:27] so let's start with so some key term
[02:31] inter-process communication this is a
[02:36] process or interface that allows you
[02:38] allows the multiple processes to
[02:41] communicate you can do it in multiple
[02:43] ways you can do it using sockets playing
[02:45] an IPM port you can do it with files
[02:49] databases and you can also do it with
[02:51] interest process communication
[02:53] interfaces and inter process
[02:57] communication and it categorizes
[03:00] different users to clients and servers
[03:03] but most of the times they are both so a
[03:06] process can do can be both an IPC client
[03:10] and an IPC server that serves
[03:12] information to other processes and one
[03:15] IPC inter-process communication
[03:18] implementation is called Windows named
[03:21] pipe who is familiar with Windows Mail
[03:23] pipe raise your hand not many this is
[03:28] exactly what I witnessed when I started
[03:30] this research and even if you know
[03:32] windows made pipes you won't know what
[03:36] I'm going to show you later on
[03:37] so nine types is an interface that
[03:40] allows a processes to communicate it can
[03:43] be one-way or duplex half a half duplex
[03:46] or full duplex and it utilizes a unique
[03:49] file system that is called a NTFS name
[03:53] type file system and it allows in the
[03:56] default configuration of it it is that
[03:58] is that any process can access any name
[04:01] pipe this is the default configuration
[04:04] and all instances of the name pipe share
[04:09] the same pipe name each process has a
[04:12] pipe and if this is the pipe server and
[04:15] multiple other processes can connect to
[04:18] it just like socket and this is called
[04:21] the pipe instance and they all share the
[04:23] same name similar to socket
[04:27] and so you have half duplex or full
[04:30] duplex you have byte-oriented or packet
[04:32] oriented local or network windows night
[04:38] pipes is accessible through network with
[04:40] some preconditions and this is something
[04:45] that almost nobody knows when I first
[04:48] started this research I found that some
[04:52] people know what name pipes are but they
[04:54] also think that inter process
[04:56] communication is local only and I found
[04:59] out that this is not the case you can
[05:02] actually access link pipes remotely how
[05:06] using a one of these two services SMB
[05:09] port number four four five or our PC
[05:12] port 135 RPC if you don't know what it
[05:19] is is a remote procedure call this is
[05:21] the standard protocol or in Windows that
[05:23] allows a one program to invoke a service
[05:25] in another program and it utilizes the
[05:28] port number 135 TCP or UDP and DC RPC
[05:33] this is a variant of RPC distributed
[05:36] computing in a computing environment
[05:38] remote possible call and this is
[05:40] actually let the programmer think that
[05:42] the procedure or the service is local
[05:45] when it actually it is a remote service
[05:49] so this is just a variant of RPC SMB
[05:54] server method block
[05:56] probably most of you know it with file
[06:00] shares you can see the different file
[06:02] shares so if you have any open SMB port
[06:06] or a file share and like--see dollar for
[06:10] example then theoretically you can use
[06:13] it also to connect to name pipe so there
[06:21] are actually two types of name pipes one
[06:24] is named pipes that has specific names
[06:26] the other is unnamed or anonymous pipes
[06:29] not the anonymous with this small icon
[06:32] there but just general allowing spikes
[06:34] and this is actually nine types that are
[06:38] unnamed
[06:39] and when you open it you doesn't assign
[06:41] you don't assign the name to it and it
[06:44] closes one once the process is over and
[06:49] but it's actually it is implemented
[06:51] using random names we always kill
[07:02] message in the potatoes exclusion
[07:05] shocked by download own assistance
[07:07] georgian choppa Britney I'm okay so
[07:12] there are two types main types and are
[07:14] main types that I'm going to focus now
[07:16] only on the name pipes because this is
[07:18] what we find interesting the unning
[07:20] pipes the anonymous pipes cannot be you
[07:24] cannot communicate with it remotely only
[07:26] locally and we is research then a
[07:29] regular name type the one that has name
[07:32] because you can connect it you can
[07:34] connect remotely to it so how can you
[07:39] connect to an empty pipe let's see some
[07:41] interesting utilities first you use NPS
[07:44] s95 file system and you cannot mount it
[07:48] using a regular SMB connection you can
[07:51] just write down / / IP address / pipe
[07:55] and pipe name this is the way you
[07:56] connect to a pipe but you cannot do it
[07:58] in your Windows run in your regular use
[08:02] via Windows command or mount you need to
[08:06] do it using an either programmatically
[08:08] or dedicated tools that allows you to
[08:11] talk to name pipes and I'm going to show
[08:14] you a very nice one and this is the tool
[08:19] that we were using this is called IO
[08:21] ninja input/output ninja this is the
[08:25] Swiss Army knife for communication of
[08:28] all kind you can also use it socket
[08:31] communication tool just a plain socket
[08:34] or file but the thing that really makes
[08:38] this tool very unique and strong is its
[08:40] ability to communicate to 9/5 and also
[08:43] to sniff named pipes content so this is
[08:47] how it looks like
[08:50] and this is how a communication to name
[08:55] pipes look like you can see that it is
[08:57] unencrypted obviously SMB an RPC are
[09:00] unencrypted so you can see that the name
[09:03] time communication looks like SMB when
[09:05] you look at it at Wireshark but what are
[09:11] the restrictions of names live
[09:13] communication so there are two main
[09:17] restrictions one is ACLs just regular
[09:22] access control is like you using files
[09:26] this is the reason that it uses this ACL
[09:29] is that it actually uses the same
[09:31] security descriptors in Windows and you
[09:35] can assign a specific ACLs for specific
[09:38] users to a specific name pipe but again
[09:43] the default configuration of an
[09:44] eight-five is that if you are if you
[09:46] don't decide a default ACL a specific
[09:49] ACL for specific user anyone can connect
[09:55] and anonymously very nice for hackers
[10:00] and if you want to enumerate the
[10:03] specific name pipe ACL this is how it
[10:06] looks like you can see that in this
[10:08] specific name pipe in it shut down it's
[10:11] called this is a Windows name pipe you
[10:13] can see that everyone can connect
[10:15] anonymously there are other tools as
[10:21] well third-party tools this is the
[10:24] obsolete in abundant utility that is
[10:27] called beyond Security pipe security
[10:30] editor it used to work in Windows XP but
[10:34] it's not relevant anymore unless you use
[10:35] Windows XP and then it's not good for
[10:38] you and another limitation of main pipes
[10:43] unlike sockets and any other interface
[10:47] you are familiar with is maximum
[10:49] instances each connection to an end pipe
[10:51] is called a named pipe instance and when
[10:54] a client connects to a named pipe it
[10:56] actually increases a counter that can
[10:59] limit the number of maximum instances
[11:02] so here you can see the different name
[11:04] pipes on the left and on the right you
[11:07] can see the maximum number of entities -
[11:10] one means no limitation but if there is
[11:12] a limitation then once the number of
[11:17] instances in which it reaches the number
[11:20] of instances it won't let you connect to
[11:23] this name pipe so this is something
[11:24] unique to name pipes in connection
[11:27] limitations or instances limitations so
[11:31] how can you enumerate and name pipe
[11:34] there are several tools most of them by
[11:37] the way are these internal utilities so
[11:40] here you can see this is the the most
[11:43] cute tool in for name pipes
[11:46] this is called a pipe list and you can
[11:48] see that this utility just enumerate the
[11:51] different name pipes there are instances
[11:53] and max instances so the Princeton I was
[11:57] showing you was actually the output of
[12:00] this utility pipe list another useful
[12:03] utility is called pipe ACL this is also
[12:06] from this internal and this shows you
[12:08] the permission so the the permissions I
[12:12] showed you earlier this is actually this
[12:14] utilities output and there are other
[12:21] utilities as well in Metasploit when we
[12:25] first started research we searched for
[12:27] information about named pipes and we
[12:29] found almost nothing except for a small
[12:33] plug in in Metasploit that is called
[12:37] pipe auditor there are actually two
[12:39] plugins pipe auditor and pipe DC RPC
[12:43] auditor the SMB version is pipe auditor
[12:45] and the RPC version in the other one
[12:47] that allows you to remotely enumerate
[12:51] for nine pipes but it is largely unused
[12:54] and not that familiar it's pretty small
[12:59] utility that I never heard of and we use
[13:03] Metasploit in context obviously but
[13:05] people don't know that the name pot
[13:07] exists and they don't know that it can
[13:09] be connected remotely and enumerated so
[13:12] obviously then no-one searches for this
[13:14] tool but we find it
[13:16] pretty pretty useful so how can you
[13:21] sniff name type content yet again I Oh
[13:24] ninja iron engine and they have a pretty
[13:27] new module that allows you to actually
[13:31] activate it like Wireshark for nine
[13:34] types so you activate my own ninja as an
[13:38] administrator and then you start it you
[13:41] can see that I assign the star filter
[13:45] which means just get everything for all
[13:48] of the name types that you can read and
[13:49] then I immediately start to see some
[13:52] information about these named pipes
[13:56] request and response and and here is
[14:03] another bigger example you can see the
[14:06] actual content which is obviously not
[14:09] encrypted and once you we have this nice
[14:16] interface that no one is aware of the
[14:19] logical thing to do and what we started
[14:21] to do in our research is to fuzz it and
[14:24] if you don't know what was in it fuzzing
[14:26] is fuzzing is fast testing this is an
[14:29] automated software testing technique
[14:31] that involves providing invalid
[14:32] unexpected or random data to input to
[14:35] computer programs it sounds a little bit
[14:37] like you a but it's actually doing is
[14:41] doing some different tests and different
[14:44] techniques that allows you to find
[14:46] vulnerabilities in bugs that cannot be
[14:49] found in other ways so usually you
[14:52] perform a fighting with fibers which is
[14:56] automatic cutting tools and if you have
[14:58] an iPhone for example in if you
[15:00] jailbroken it most chances are that the
[15:03] bug and the viability that allowed
[15:05] jailbreaking it was found using faulty
[15:08] utilities and there are two types of
[15:13] fuzzing dump or blackbox fading when you
[15:17] just bombard the interface without
[15:19] knowing almost anything about this
[15:22] interface just send random strings and
[15:25] random numbers and bytes etc and smart
[15:29] fuzz in which we actually
[15:30] understand the expected input and the
[15:33] purpose of each field and you start to
[15:36] analyze it during our research we only
[15:40] performed on fuzzing and we were able to
[15:42] find very nice them I'm going to show
[15:44] you in a short while using only dump
[15:48] files so imagine what you could do with
[15:51] smart fighting and especially if you
[15:53] connect it to a word well-known files in
[15:55] frameworks like peach this is something
[15:58] we haven't done yet so what what we the
[16:03] utility that we used is just a small
[16:05] photo tool that we found this is the
[16:07] tool it it is written more than 10 years
[16:10] ago and a programmer actually wrote it
[16:14] as a local father only because he also
[16:17] didn't know that it is it is possible to
[16:22] connect to a named pipe remotely so we
[16:25] slightly modified it and we start
[16:27] fasting using this nice utility and soon
[16:30] after just a few days after we found
[16:32] this one and one ability that I'm going
[16:34] to show you in delight it so what is the
[16:40] actually the the actual impact of this
[16:43] interface so many pieces of software
[16:48] work with hidden on ardan documented API
[16:50] and named pipes is one of them and the
[16:54] forgotten nature of named pipes when I
[16:56] asked you you who knows the name types
[16:58] just few I saw just a few hands going
[17:01] and going up so obviously this is a
[17:03] forgotten interface it gives you an
[17:06] uncharted territory of socket like
[17:08] interface that can contain
[17:10] vulnerabilities any vulnerability that
[17:12] can be found in a socket remote code
[17:15] execution buffer overflow the amount of
[17:18] service or injections even can be found
[17:21] in any pipes as well because you can do
[17:23] pretty much whatever you want in an end
[17:25] pipe you can for example create a XML
[17:29] like a web service like name pipe and
[17:31] then any application a regular
[17:34] application vulnerability can be
[17:35] relevant to name pipe as well but the
[17:39] most common more common our severe one
[17:42] is buffer overflow denial
[17:43] service and in some cases remote code
[17:45] execution so if a named pipe allows
[17:50] remote access you can have a remote in a
[17:53] lot of service or remote code execution
[17:54] and if this is not a well-known or there
[17:58] is no patch you can have zero data stone
[18:00] abilities have you heard of the recent
[18:03] one cry just a month ago so imagine that
[18:06] someone would find a vulnerability in a
[18:09] Windows 9 pipe that would allow anyone
[18:11] to remotely execute commands in Windows
[18:15] so you would have a 1 Cry 2 version that
[18:20] utilizes name pipes or nobility game
[18:26] over remote code execution or remote DOS
[18:33] so let's see a case study of two small
[18:38] utilities that we found vulnerable to
[18:41] the remote remote denial of service and
[18:45] even remote command injection using name
[18:48] pipes so we found the two programs were
[18:53] vulnerable one is Q bittern it is a
[18:56] cross-platform client for a BitTorrent
[18:58] protocol it's open source and written in
[19:00] C++ which hackers like because there is
[19:03] buffer overflow in C++ and the other one
[19:05] is sugarsync this is a cloud service
[19:08] that allows the synchronizing files and
[19:11] this is the client of this cloud service
[19:14] used for backups cetera there are many
[19:17] similar services as well and this is
[19:21] cross-platform but we only focus on the
[19:23] Windows version because obviously
[19:25] Windows named pipes exists only on
[19:28] Windows so both applications uses
[19:33] something that is called Qt framework
[19:35] and this form this is a cross-platform
[19:38] framework for developers and it is
[19:42] embedded in many applications including
[19:44] mobiles and Windows applications and we
[19:48] found that both application uses
[19:50] something that is killed is called QT
[19:52] single app that this is probably for
[19:55] making sure that there is only one
[19:57] instance
[19:58] of this application running and we fast
[20:01] it using the script I was showing you
[20:03] and then we managed to remotely crush
[20:06] the program and in Cuba torrent there is
[20:09] also a possibility of remote command
[20:11] injection so let's see a live demo I'm
[20:18] now silently praying to the Democrats so
[20:28] so this is my virtual machine you can
[20:33] see that this is my IP address and now
[20:38] I'm going to activate Cuba torrent and
[20:49] after activating Cuba torrent you can
[20:52] see that I have this name 5qt single app
[20:57] qubit oh and some something that looks
[21:01] like a random number so this is the name
[21:05] type that I'm going to remotely connect
[21:07] to and I'm going to to do it using io
[21:13] ninja so here I will create a file
[21:17] stream that allows you to connect to
[21:21] name pipes the name is a little bit a
[21:23] little bit a little bit confusing but
[21:25] this is actually used for name pipes so
[21:28] here you can see that I put putting the
[21:32] IP address of the machine and a pipe
[21:35] slash pipe name and this specific name
[21:38] pipe you need the general domain
[21:41] permission so you need to be a member of
[21:43] the domain but this is pretty much it if
[21:45] you have domain permissions you can
[21:47] connect to it and you can see that once
[21:49] I connect to it if I just send a single
[21:54] character when I get back to the machine
[21:58] the program is not responding
[22:05] and thank the same thing goes for sugar
[22:09] same sink let's do it once again this
[22:15] time I'm going to show it to show you
[22:17] how this can be done using fading
[22:35] you need internet connection for this
[22:39] obviously a cloud service okay
[22:50] demo code almost had me so here is named
[22:56] pipes of sugar sink and now I'm going to
[23:02] activate this advanced utility just a
[23:06] second
[23:27] so I'm putting the same IP address slash
[23:30] pipe slash this time the SugarSync pipe
[23:34] and you can see that only after two
[23:37] iterations two iterations only and
[23:40] program is crushed and the last
[23:48] interesting thing that we found is that
[23:51] we can actually try to inject commands
[23:55] to the BitTorrent named pipes directly
[23:58] connect to it once again but instead of
[24:00] a single character now I'm going to put
[24:06] ego hacking Paris 17 two words / space
[24:12] and I'm going to send it torrent file
[24:19] hacking Paris 17 does not exist so
[24:22] actually you can you can see that my
[24:25] input is processed and in this example
[24:29] you can see that I can try to remotely
[24:33] inject the download command to this
[24:36] queue a cute BitTorrent client I can
[24:39] tell him which turned to go and download
[24:42] so this is becoming even more
[24:44] interesting
[24:56] so let's move on to the mitigation and
[25:00] defenses so the developers point of view
[25:04] just know the risk if you use open
[25:07] source frameworks or like Qt framework
[25:10] or others if you use name pipes in your
[25:15] application windows application just
[25:17] know that name pipes can become
[25:19] connected remotely and don't treat it as
[25:22] an internal only interface and neglect
[25:25] security always follow the lead
[25:28] privilege approach and assign
[25:29] appropriate ACLs
[25:31] never just open the name pipe
[25:33] anonymously and to everyone to connect
[25:36] to and possibly if possible just limit
[25:39] the maximum number of instances as well
[25:41] if you only need one instance for
[25:44] example you need one process of your
[25:46] application to connect to another
[25:47] process just put one maximum instance
[25:51] the users or third-party software
[25:53] clients point of view also know the risk
[25:56] block all unnecessary SMB and RPC
[25:59] services if you don't need it just block
[26:02] it segment your network so at least if
[26:05] you cannot connect to each and every
[26:07] station in your network and try to
[26:10] exploit vulnerabilities in 9/5 and
[26:13] always install latest software security
[26:15] updates the hackers point of view will
[26:20] hack have fun this is something that is
[26:24] largely unexplored so try to perform
[26:28] remote code execution in denial of
[26:30] service in multiple interfaces so to sum
[26:35] up my presentation Windows named pipes
[26:37] are forgotten remotely accessible
[26:39] sockets like in the face a whole new Lee
[26:42] rediscovered potential world of local
[26:45] and remote vulnerabilities because no
[26:47] one just knows that there exists and if
[26:49] you do know it you don't care because
[26:51] you thought that is local only so don't
[26:53] ignore name pipes in your Windows
[26:55] desktop application and stay safe you
[26:59] have any questions
[27:03] you
