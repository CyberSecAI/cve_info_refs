=== Content from security.gentoo.org_7d20cfa3_20250124_221438.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# MariaDB, MySQL: Root privilege escalation — GLSA **201711-04**

A vulnerability was discovered in MariaDB and MySQL which may allow
local users to gain root privileges.

### Affected packages

| Package | **dev-db/mariadb** on all architectures |
| --- | --- |
| Affected versions | < **10.0.30-r1** |
| Unaffected versions | >= **10.0.30-r1** |

| Package | **dev-db/mysql** on all architectures |
| --- | --- |
| Affected versions | < **5.6.36-r1** |
| Unaffected versions | >= **5.6.36-r1** |

### Background

MySQL is a popular multi-threaded, multi-user SQL server. MariaDB is an
enhanced, drop-in replacement for MySQL.

### Description

The Gentoo installation scripts before 2017-09-29 have chown calls for
user-writable directory trees, which allows local users to gain
privileges by leveraging access to the mysql account for creation of a
link.

### Impact

A local attacker could escalate privileges to root.

### Workaround

There is no known workaround at this time.

### Resolution

All MariaDB users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=dev-db/mariadb-10.0.30-r1"

```

All MySQL users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=dev-db/mysql-5.6.36-r1"

```
### References

* [CVE-2017-15945](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2017-15945)

**Release date**

November 10, 2017

**Latest revision**

November 10, 2017: 1

**Severity**

normal

**Exploitable**

remote

**Bugzilla entries**

* [635704](https://bugs.gentoo.org/show_bug.cgi?id=635704)
* [635706](https://bugs.gentoo.org/show_bug.cgi?id=635706)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from bugs.gentoo.org_44159a4f_20250124_221438.html ===

[![Gentoo Websites Logo](extensions/Gentoo/web/gentoo_org.png)](/ "Go to the Gentoo Bugzilla homepage")
Go to:
[Gentoo Home](https://www.gentoo.org/)
[Documentation](https://www.gentoo.org/support/documentation/)
[Forums](https://forums.gentoo.org/)
[Lists](https://www.gentoo.org/get-involved/mailing-lists/)
[Bugs](/)
[Planet](https://planet.gentoo.org/)
[Store](https://www.gentoo.org/inside-gentoo/stores/)
[Wiki](https://wiki.gentoo.org/)
**[Get Gentoo!](https://www.gentoo.org/downloads/)**

Gentoo's Bugzilla – Bug 630822
dev-db/{mysql-cluster,mariadb,mysql,percona-server,mariadb-galera}: root privilege escalation via "chown"
Last modified: 2021-08-11 19:59:53 UTC node [vulture]

* [Home](./)
* | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=630822&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=630822&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 630822**](show_bug.cgi?id=630822)
(CVE-2017-15945)
- dev-db/{mysql-cluster,mariadb,mysql,percona-server,mariadb-galera}: root privilege escalation via "chown"

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
dev-db/{mysql-cluster,mariadb,mysql,percona-server,mariadb-galera}: root priv...

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2017-15945 | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | Gentoo Security | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=Gentoo Security "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Auditing ([show other bugs](buglist.cgi?component=Auditing&product=Gentoo%20Security&bug_status=__open__)) | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All Linux | |  | | | [Importance](page.cgi?id=fields.html#importance): | Normal normal | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Gentoo Security Audit Team | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [635702](show_bug.cgi?id=635702 "RESOLVED FIXED - <dev-db/percona-server-5.6.37.82.2-r1: root privilege escalation via \"chown\"") [635704](show_bug.cgi?id=635704 "RESOLVED FIXED - <dev-db/mariadb-{10.0.30-r1,10.0.32-r1,10.1.24-r1,10.1.26-r1,10.2.9}: root privilege escalation via \"chown\"") [635706](show_bug.cgi?id=635706 "RESOLVED FIXED - <dev-db/mysql-{5.6.36-r1,5.6.37-r1,5.6.38}: root privilege escalation via \"chown\"") [635708](show_bug.cgi?id=635708 "RESOLVED FIXED - <dev-db/mysql-cluster-{7.2.22-r1,7.3.11-r1}: root privilege escalation via \"chown\"") [635710](show_bug.cgi?id=635710 "RESOLVED FIXED - <dev-db/mariadb-galera-10.0.32: root privilege escalation via \"chown\"") | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | Show dependency [tree](showdependencytree.cgi?id=630822&hide_resolved=1) | |  | | Reported: | 2017-09-12 16:57 UTC by Michael Orlitzky | | --- | --- | | Modified: | 2021-08-11 19:59 UTC ([History](show_activity.cgi?id=630822)) | | CC List: | 5 users (show)  grknight jmbsvicetto mgorny robbat2 whissi | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Package list:](page.cgi?id=fields.html#cf_stabilisation_atoms "Contains a list of packages (and optionally, architectures) to keyword or stabilize. One fully qualified package per line, optionally followed by a space-delimited list of architectures for that package.") |  | | [Runtime testing required:](page.cgi?id=fields.html#cf_runtime_testing_required "Indicate what level of testing is required. For manual testing following instructions in the bug, choose \"Manual\". For only compile-testing, choose \"No\". For where tests must pass, choose \"Yes\".") | --- | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [**bug-630822.patch**](attachment.cgi?id=494538 "View the content of the attachment") (bug-630822.patch,1.46 KB, text/x-diff)  [2017-09-14 17:35 UTC](#attach_494538 "Go to the comment associated with the attachment"), Brian Evans (RETIRED) | [Details](attachment.cgi?id=494538&action=edit) | | [View All](attachment.cgi?bugid=630822&action=viewall)  [Add an attachment](attachment.cgi?bugid=630822&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=630822&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](#c0)  Michael Orlitzky   gentoo-dev  2017-09-12 16:57:22 UTC  ``` The latest two ebuilds for mariadb (10.2.7-r2 and 10.2.8) call "chown" on the live root filesystem in pkg_postinst, in more than one place. For example,    pkg_postinst() {       # Make sure the vars are correctly initialized       mysql_init_vars        # Check FEATURES="collision-protect" before removing this       [[ -d "${ROOT}${MY_LOGDIR}" ]] || \           install -d -m0750 -o mysql -g mysql "${ROOT}${MY_LOGDIR}"        # Secure the logfiles       touch "${ROOT}${MY_LOGDIR}"/mysql.{log,err}       chown mysql:mysql "${ROOT}${MY_LOGDIR}"/mysql*       ...  This is exploitable by the "mysql" user to gain root. The non-recursive calls to "chown" are vulnerable to having their targets replaced by symlinks, and the recursive calls are vulnerable to the same trick with hard links. For example,    1. emerge mariadb-10.2.8   2. sudo su -s /bin/sh -c 'ln -sf /etc/passwd /var/log/mysql/mysql.log' mysql   3. emerge mariadb-10.2.8   4. The "mysql" user now owns /etc/passwd.  I haven't verified the exploit with "chown -R" because I don't want to spend another half hour on the build, but anywhere you call "chown -R" on the same directory more than once is going to be exploitable. ```  [Comment 1](#c1)  Brian Evans (RETIRED)   gentoo-dev  2017-09-12 17:48:12 UTC  ``` This is more than mariadb.  This code has existed for years and years in mysql.eclass (Overlay only now), mysql-v2.eclass, mysql-multilib*.eclass and now finally in the dev-db/mariadb ebuilds.  All versions of dev-db/{mysql,mariadb,percona-server,mysql-cluster,mariadb-galera} are included.  As well as past versions of dev-db/mysql-community.  I'm testing a patch for existence of non files so they can be removed at the log locations.  Any further suggestions are welcome. ```  [Comment 2](#c2)  Michael Orlitzky   gentoo-dev  2017-09-12 17:55:00 UTC  ``` (In reply to Brian Evans from [comment #1](show_bug.cgi?id=630822#c1)) >  > Any further suggestions are welcome.  If the code has been around for that long, consider the possibility that your predecessors were wacko =)  The only person who can change ownership of a file is root, so if any of the log files have the wrong ownership, it's because root went in there and did it. So long as /var/log/mysql is writable by the "mysql" user, the logs will get created as mysql:mysql and everything will be fine.  Symlinks are easy to detect, but hard links are a lot, uh, harder -- and they have the same problem. ```  [Comment 3](#c3)  Brian Evans (RETIRED)   gentoo-dev  2017-09-12 18:21:16 UTC  ``` (In reply to Michael Orlitzky from [comment #2](show_bug.cgi?id=630822#c2)) > (In reply to Brian Evans from [comment #1](show_bug.cgi?id=630822#c1)) > >  > > Any further suggestions are welcome. >  > If the code has been around for that long, consider the possibility that > your predecessors were wacko =) >  > The only person who can change ownership of a file is root, so if any of the > log files have the wrong ownership, it's because root went in there and did > it. So long as /var/log/mysql is writable by the "mysql" user, the logs will > get created as mysql:mysql and everything will be fine. >  > Symlinks are easy to detect, but hard links are a lot, uh, harder -- and > they have the same problem.  OK.  I have removed the "# Secure the logfiles" block an just kept the install above it.  This does not affect the server since it creates mysqld.err and other files without our help.  Let me know when this is OK to push. ```  [Comment 4](#c4)  Michael Orlitzky   gentoo-dev  2017-09-12 19:43:25 UTC  ``` (In reply to Brian Evans from [comment #3](show_bug.cgi?id=630822#c3)) >  > OK.  I have removed the "# Secure the logfiles" block an just kept the > install above it.  This does not affect the server since it creates > mysqld.err and other files without our help. >   I suspect this one is vulnerable too (the others should be OK because they operate on $D and not $ROOT):    chown -R mysql:mysql "${ROOT}/${MY_DATADIR}" 2>/dev/null  I think the same reasoning applies -- everything in there should have the correct ownership already -- but I'm no expert.  If you feel like waiting for me to re-emerge mariadb one more time, I'll see if I can exploit that line above. ```  [Comment 5](#c5)  Brian Evans (RETIRED)   gentoo-dev  2017-09-12 20:01:49 UTC  ``` (In reply to Michael Orlitzky from [comment #4](show_bug.cgi?id=630822#c4)) > (In reply to Brian Evans from [comment #3](show_bug.cgi?id=630822#c3)) > >  > > OK.  I have removed the "# Secure the logfiles" block an just kept the > > install above it.  This does not affect the server since it creates > > mysqld.err and other files without our help. > >  >  > I suspect this one is vulnerable too (the others should be OK because they > operate on $D and not $ROOT): >  >   chown -R mysql:mysql "${ROOT}/${MY_DATADIR}" 2>/dev/null >  > I think the same reasoning applies -- everything in there should have the > correct ownership already -- but I'm no expert. >  > If you feel like waiting for me to re-emerge mariadb one more time, I'll see > if I can exploit that line above.  While possible, this is unlikely as an attacker would have to expect that an admin is going to install a database and run 'emerge --config' and therefore create the directory in ${MY_DATADIR} which defaults to /var/lib/mysql but can be overridden in the environment by the admin at build time. ```  [Comment 6](#c6)  Brian Evans (RETIRED)   gentoo-dev  2017-09-12 20:24:47 UTC  ``` Hmm.. or otherwise remove the database directory entirely, which an admin will certainly notice, place an exploit and expect 'emerge --config' again.  A good admin should spot such trouble and prepare a new directory, but I understand this is not always the case. ```  [Comment 7](#c7)  Michael Orlitzky   gentoo-dev  2017-09-12 21:15:34 UTC  ``` Well, pkg_config won't run if /var/lib/mysql already exists, so that eliminates the easy exploit where I just stick a hard link in there whenever I feel like it and later run emerge --config.  There's still a race condition I think, but that's much less serious:    1. local cmd=( "${EROOT}usr/share/mariadb/scripts/mysql_install_db" )   2. [[ -f "${cmd}" ]] || cmd=( "${EROOT}usr/bin/mysql_install_db" )   ...   5. "${cmd[@]}" >"${TMPDIR}"/mysql_install_db.log 2>&1   ...   12. chown -R mysql:mysql "${ROOT}/${MY_DATADIR}" 2>/dev/null  I've probably miscounted those, but between lines 5 and 12, the "mysql" user can stick a hard link in MY_DATADIR. He could maybe clue himself into that by watching $TMPDIR for the creation of a file named mysql_install_db.log, but this is all pretty far-fetched.  Is the "chown -R" doing anything at all? If under normal circumstances, everything in that directory has the correct owner anyway, then I would say it's worthwhile to remove it just in case. ```  [Comment 8](#c8)  Michael Orlitzky   gentoo-dev  2017-09-12 21:23:20 UTC  ``` Aw shit... so, the race condition is actually stupid easy to take advantage of. Run this in a shell as the "mysql" user:    while true ; do     ln /etc/passwd /var/lib/mysql/x   done  As soon as you run emerge --config, even with a brand new MY_DATADIR, the "mysql" user will take ownership of /etc/passwd. ```  [Comment 9](#c9)  Brian Evans (RETIRED)   gentoo-dev  2017-09-13 13:52:43 UTC  ``` (In reply to Michael Orlitzky from [comment #7](show_bug.cgi?id=630822#c7)) > Well, pkg_config won't run if /var/lib/mysql already exists, so that > eliminates the easy exploit where I just stick a hard link in there whenever > I feel like it and later run emerge --config. >  > There's still a race condition I think, but that's much less serious: >  >   1. local cmd=( "${EROOT}usr/share/mariadb/scripts/mysql_install_db" ) >   2. [[ -f "${cmd}" ]] || cmd=( "${EROOT}usr/bin/mysql_install_db" ) >   ... >   5. "${cmd[@]}" >"${TMPDIR}"/mysql_install_db.log 2>&1 >   ... >   12. chown -R mysql:mysql "${ROOT}/${MY_DATADIR}" 2>/dev/null >  > I've probably miscounted those, but between lines 5 and 12, the "mysql" user > can stick a hard link in MY_DATADIR. He could maybe clue himself into that > by watching $TMPDIR for the creation of a file named mysql_install_db.log, > but this is all pretty far-fetched. >  > Is the "chown -R" doing anything at all? If under normal circumstances, > everything in that directory has the correct owner anyway, then I would say > it's worthwhile to remove it just in case.  The mysql_install_db script is run as root and the data files created get a group of root so is this line acceptable to replace line 12 above?  chgrp mysql "${ROOT}/${MY_DATADIR}"/{mysql,test} 2>/dev/null ```  [Comment 10](#c10)  Michael Orlitzky   gentoo-dev  2017-09-13 14:07:22 UTC  ``` (In reply to Brian Evans from [comment #9](show_bug.cgi?id=630822#c9)) >  > The mysql_install_db script is run as root and the data files created get a > group of root so is this line acceptable to replace line 12 above? >  > chgrp mysql "${ROOT}/${MY_DATADIR}"/{mysql,test} 2>/dev/null  What's the owner/group on $MY_DATADIR at that point? The chgrp will also affect the target of sym/hard links, so it's important that the mysql user not be able to stick a link in place of those two arguments via the same race condition. If MY_DATADIR is root:root, it should be safe.  Another thing that might work is to "su mysql ..." instead of passing --user to mysql_install_db. ```  [Comment 11](#c11)  Brian Evans (RETIRED)   gentoo-dev  2017-09-13 14:15:27 UTC  ``` (In reply to Michael Orlitzky from [comment #10](show_bug.cgi?id=630822#c10)) > (In reply to Brian Evans from [comment #9](show_bug.cgi?id=630822#c9)) > >  > > The mysql_install_db script is run as root and the data files created get a > > group of root so is this line acceptable to replace line 12 above? > >  > > chgrp mysql "${ROOT}/${MY_DATADIR}"/{mysql,test} 2>/dev/null >  > What's the owner/group on $MY_DATADIR at that point? The chgrp will also > affect the target of sym/hard links, so it's important that the mysql user > not be able to stick a link in place of those two arguments via the same > race condition. If MY_DATADIR is root:root, it should be safe. >  > Another thing that might work is to "su mysql ..." instead of passing --user > to mysql_install_db.  The end result of pkg_config() without the chown -R is that the mysql and test directories have a mysql:root with 0700 permissions.  I simply wanted to keep those directories as they should be. ```  [Comment 12](#c12)  Brian Evans (RETIRED)   gentoo-dev  2017-09-13 14:50:47 UTC  ``` (In reply to Michael Orlitzky from [comment #10](show_bug.cgi?id=630822#c10)) > Another thing that might work is to "su mysql ..." instead of passing --user > to mysql_install_db.  "su mysql ..." is not an option as the user does not have a shell and the command fails. ```  [Comment 13](#c13)  Michael Orlitzky   gentoo-dev  2017-09-13 15:56:54 UTC  ``` (In reply to Brian Evans from [comment #12](show_bug.cgi?id=630822#c12)) >  > "su mysql ..." is not an option as the user does not have a shell and the > command fails.  You should be able to override that with --shell. ```  [Comment 14](#c14)  Brian Evans (RETIRED)   gentoo-dev  2017-09-14 17:35:47 UTC  ``` Created [attachment 494538](attachment.cgi?id=494538 "bug-630822.patch") [[details](attachment.cgi?id=494538&action=edit "bug-630822.patch")] bug-630822.patch  Proposed patch for 10.2.8 and similar in eclasses.  I was not able to use su effectively and break out the array.  This still does the same job and only does chgrp on special directories. ```  [Comment 15](#c15)  Michael Orlitzky   gentoo-dev  2017-09-29 21:43:18 UTC  ``` Brian fixed this last night:  <https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=5a4dfd9b7b9e8e8d23315dfd3afb4bbfc56b9de8>  <https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=40984ffe654ae90069740e76c6406ec5f8d3ed9f>  <https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=b19f6190519f94450e4aa23cde091b8fd24d763d>  Can we make this public so that I can reference it in the CVE request? ```  [Comment 16](#c16)  Michael Orlitzky   gentoo-dev  2017-10-24 21:15:35 UTC  ``` (In reply to Michael Orlitzky from [comment #15](show_bug.cgi?id=630822#c15)) >  > Can we make this public so that I can reference it in the CVE request?  Ping =) ```  [Comment 17](#c17)  Thomas Deutschmann (RETIRED)   gentoo-dev  2017-10-25 23:03:54 UTC  ``` Thank you Michael for the report and thank you Brian for the fix.  Like said in [comment #15](show_bug.cgi?id=630822#c15), everything is done. No bumps or user action required. Vulnerability only existed while emerging one of the affected ebuilds/ebuilds using affected eclasses. ```  [Comment 18](#c18)  Michael Orlitzky   gentoo-dev  2017-10-25 23:54:40 UTC  ``` (In reply to Thomas Deutschmann from [comment #17](show_bug.cgi?id=630822#c17)) > Thank you Michael for the report and thank you Brian for the fix. >  > Like said in [comment #15](show_bug.cgi?id=630822#c15), everything is done. No bumps or user action > required. Vulnerability only existed while emerging one of the affected > ebuilds/ebuilds using affected eclasses.  That's not *entirely* true.. the pkg_config phase had a similar problem, so if you installed a vulnerable version last month and waited until today to set it up, then you might want to upgrade first.  That scenario is a bit outlandish, though, because someone needs to gain access to the "mysql" user in order to do anything. If the database was never configured, that's next to impossible. The only plausible scenario is a pre-existing, exploited mysql installation that has had its databases wiped (and now needs them re-created). I won't be offended if you decide not to spend your time warning people about that. ```  [Comment 19](#c19)  Thomas Deutschmann (RETIRED)   gentoo-dev  2017-10-26 00:06:56 UTC  ``` Re-opened to evaluate which packages need a rev bump.  Thanks, Michael. ```  [Comment 20](#c20)  Michael Orlitzky   gentoo-dev  2017-10-26 00:47:12 UTC  ``` (In reply to Thomas Deutschmann from [comment #19](show_bug.cgi?id=630822#c19)) > Re-opened to evaluate which packages need a rev bump. >  > Thanks, Michael.  What will portage do if you try to `emerge --config` a version that no longer exists? If it uses a newer version's pkg_config, or if it forces you to upgrade first -- then there's actually no need for a new revision: users need only sync their trees to remove the vulnerable code. ```  [Comment 21](#c21)  Thomas Deutschmann (RETIRED)   gentoo-dev  2017-10-27 12:42:51 UTC  ``` (In reply to Michael Orlitzky from [comment #20](show_bug.cgi?id=630822#c20)) > What will portage do if you try to `emerge --config` a version that no > longer exists? If it uses a newer version's pkg_config, or if it forces you > to upgrade first -- then there's actually no need for a new revision: users > need only sync their trees to remove the vulnerable code.  When you emerge an ebuild, everything, including used eclasses, will be cached in the package db. This allows the user to run "emerge --config" at anytime to get the expected results even if we have removed the code from the eclass in the meantime.  However, if there was a problem in the ebuild/eclass, the user has to re-emerge the ebuild to get the fix.  That's the problem in this case.  dev-db/mariadb:   - Affected by pkg_postinst:     Fixed in >=mariadb-10.2.9.    Affected mariadb-10.2.x ebuilds are removed.     => pkg_postinst vulnerability is fixed!   - Affected by eclass:     Fixed eclasses available since 2017-09-28 22:30:51 -0400.    However, users with       - mariadb-10.0.30      - mariadb-10.0.32      - mariadb-10.1.24      - mariadb-10.1.26     installed are probably affected if they have emerged the package before the    date mentioned above.   dev-db/mysql:   - Affected by pkg_postinst: -   - Affected by eclass:     Fixed eclasses available since 2017-09-28 22:30:51 -0400.    However, users with       - mysql-5.6.36      - mysql-5.6.37     installed are probably affected if they have emerged the package before the    date mentioned above.   dev-db/percona-server:   - Affected by pkg_postinst: -   - Affected by eclass:     Fixed eclasses available since 2017-09-28 22:30:51 -0400.    However, users with       - percona-server-5.6.37.82.2     installed are probably affected if they have emerged the package before the    date mentioned above.   dev-db/mysql-cluster:   - Affected by pkg_postinst: -   - Affected by eclass:     Fixed eclasses available since 2017-09-28 22:30:51 -0400.    However, users with       - mysql-cluster-7.2.22      - mysql-cluster-7.3.11     installed are probably affected if they have emerged the package before the    date mentioned above.   dev-db/mariadb-galera:   - Affected by pkg_postinst: -   - Affected by eclass: - (only available ebuild in repository was bumped after eclasses were fixed) ```  [Comment 22](#c22)  Michael Orlitzky   gentoo-dev  2017-10-27 21:14:26 UTC  ``` (In reply to Thomas Deutschmann from [comment #21](show_bug.cgi?id=630822#c21)) >  > When you emerge an ebuild, everything, including used eclasses, will be > cached in the package db. This allows the user to run "emerge --config" at > anytime to get the expected results even if we have removed the code from > the eclass in the meantime. >  > However, if there was a problem in the ebuild/eclass, the user has to > re-emerge the ebuild to get the fix.  Thanks, that's important to know. I see now that portage is saving the ebuilds, but are the eclasses kept somewhere too? The PMS doesn't say what goes on in the VDB, so regardless, I think we should tell everyone to update or reinstall, just to keep things simple.  I requested a CVE for this (CVE-2017-15945), and my suggested fix is the following:    1. Update your ::gentoo tree.    2. Upgrade the affected packages to the latest version that your package      manager suggests.    3. If an affected package was not upgraded in the previous step (for      example, if no new version was available), then reinstall that package      manually.  That should cover everyone, I think? ```  [Comment 23](#c23)  Thomas Deutschmann (RETIRED)   gentoo-dev  2017-10-27 22:31:16 UTC  ``` (In reply to Michael Orlitzky from [comment #22](show_bug.cgi?id=630822#c22)) > I see now that portage is saving the ebuilds, but are the eclasses > kept somewhere too?  The used eclasses are cached in "environment.bz2".   >   3. If an affected package was not upgraded in the previous step (for >      example, if no new version was available), then reinstall that package >      manually. I will file vulnerability bugs for each affected package to track the bumping. Everything else is not an option. Think about binary package users. ```  [Comment 24](#c24)  Michael Orlitzky   gentoo-dev  2017-10-27 23:21:34 UTC  ``` (In reply to Thomas Deutschmann from [comment #23](show_bug.cgi?id=630822#c23)) >  > The used eclasses are cached in "environment.bz2".  Aha!   > I will file vulnerability bugs for each affected package to track the > bumping. Everything else is not an option. Think about binary package users.  In hindsight, that is the simplest thing to do, and it makes the advice for end users easier to understand. I can update the CVE page afterwards. Thanks again. ```  [Comment 25](#c25)  Michael Orlitzky   gentoo-dev  2017-11-06 16:41:34 UTC  ``` I updated the CVE with the full list of affected packages, and the new mitigation instructions ("just upgrade"). ```  [Comment 26](#c26)  D'juan McDonald (domhnall)    2019-07-17 02:32:58 UTC  ``` All good here? <https://security.gentoo.org/glsa/201711-04> ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=630822)
* - [XML](show_bug.cgi?ctype=xml&id=630822)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=630822)
* - [Clone In The Same
  Product](enter_bug.cgi?cloned_bug_id=630822&product=Gentoo%20Security)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=630822&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=630822&GoAheadAndLogIn=1#forgot)
    Login:

    [x]



=== Content from bugs.gentoo.org_0a0abf2a_20250126_040116.html ===

[![Gentoo Websites Logo](extensions/Gentoo/web/gentoo_org.png)](/ "Go to the Gentoo Bugzilla homepage")
Go to:
[Gentoo Home](https://www.gentoo.org/)
[Documentation](https://www.gentoo.org/support/documentation/)
[Forums](https://forums.gentoo.org/)
[Lists](https://www.gentoo.org/get-involved/mailing-lists/)
[Bugs](/)
[Planet](https://planet.gentoo.org/)
[Store](https://www.gentoo.org/inside-gentoo/stores/)
[Wiki](https://wiki.gentoo.org/)
**[Get Gentoo!](https://www.gentoo.org/downloads/)**

Gentoo's Bugzilla – Search by bug number

* [Home](./)
* | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?GoAheadAndLogIn=1#forgot)
  Login:

  [x]

You may find a single bug by entering its bug id here:

* + [Home](./)
  + | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?GoAheadAndLogIn=1#forgot)
    Login:

    [x]


