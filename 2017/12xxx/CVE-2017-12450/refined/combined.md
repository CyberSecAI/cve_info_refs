=== Content from sourceware.org_ca33a91e_20250125_213242.html ===


Sourceware Bugzilla – Bug 21813
Additional undefined behavior and crashes
Last modified: 2021-10-24 11:36:27 UTC

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=21813&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=21813&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 21813**](show_bug.cgi?id=21813)
- Additional undefined behavior and crashes

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
Additional undefined behavior and crashes

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | binutils | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=binutils "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | binutils ([show other bugs](buglist.cgi?component=binutils&product=binutils&bug_status=__open__)) | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | 2.30 | |  | | | [Importance](page.cgi?id=fields.html#importance): | P2 normal | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Not yet assigned to anyone | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2017-07-21 17:32 UTC by Ned Williamson | | --- | --- | | Modified: | 2021-10-24 11:36 UTC ([History](show_activity.cgi?id=21813)) | | CC List: | 2 users (show)  nickc yzhan219 | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Host:](page.cgi?id=fields.html#cf_gcchost "A custom Free Text field in this installation of Bugzilla.") |  | | [Target:](page.cgi?id=fields.html#cf_gcctarget "A custom Free Text field in this installation of Bugzilla.") |  | | [Build:](page.cgi?id=fields.html#cf_gccbuild "A custom Free Text field in this installation of Bugzilla.") |  | | [Last reconfirmed:](page.cgi?id=fields.html#cf_reconfirmed_on "A custom Date/Time field in this installation of Bugzilla.") |  | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [**5 testcases with asan output**](attachment.cgi?id=10281 "View the content of the attachment") (2.81 KB, application/x-xz)  [2017-07-21 17:32 UTC](#attach_10281 "Go to the comment associated with the attachment"), Ned Williamson | [Details](attachment.cgi?id=10281&action=edit) | | [View All](attachment.cgi?bugid=21813&action=viewall)  [Add an attachment](attachment.cgi?bugid=21813&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=21813&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=21813#c0)  Ned Williamson    2017-07-21 17:32:47 UTC  ``` Created [attachment 10281](attachment.cgi?id=10281 "5 testcases with asan output") [[details]](attachment.cgi?id=10281&action=edit "5 testcases with asan output") 5 testcases with asan output  I've found 5 more bugs in objdump master branch.  These bugs repro for me when building for all targets with a recent version of clang and AddressSanitizer and running them with `./objdump -xg testcase` (one crash requires debug output).  If any don't reproduce, let me know and I can try to identify another testcase or help identify the root cause. I've included `asan_output` with my stacktrace for each test.  I have investigated alpha-heap-overflow, and there the fix is to check that `PRIV (recrd.rec_size) > test_len` before reading the remaining record.  Cheers, Ned ```  [Comment 1](show_bug.cgi?id=21813#c1)  Sourceware Commits    2017-07-24 12:50:54 UTC  ``` The master branch has been updated by Nick Clifton <nickc@sourceware.org>:  <https://sourceware.org/git/gitweb.cgi?p=binutils-gdb.git;h=ca4cf9b9c622a5695e01f7f5815a7382a31fcf51>  commit ca4cf9b9c622a5695e01f7f5815a7382a31fcf51 Author: Nick Clifton <nickc@redhat.com> Date:   Mon Jul 24 13:49:22 2017 +0100      Fix address violation errors parsing corrupt binary files.          	[PR 21813](show_bug.cgi?id=21813 "RESOLVED FIXED - Additional undefined behavior and crashes")     binutils* rddbg.c (read_symbol_stabs_debugging_info): Check for an empty     	string whilst concatenating symbol names.          bfd	* mach-o.c (bfd_mach_o_canonicalize_relocs): Pass the base address     	of the relocs to the canonicalize_one_reloc routine.     	* mach-o.h (struct bfd_mach_o_backend_data): Update the prototype     	for the _bfd_mach_o_canonicalize_one_reloc field.     	* mach-o-arm.c (bfd_mach_o_arm_canonicalize_one_reloc): Add     	res_base parameter.  Use to check for corrupt pair relocs.     	* mach-o-aarch64.c (bfd_mach_o_arm64_canonicalize_one_reloc):     	Likewise.     	* mach-o-i386.c (bfd_mach_o_i386_canonicalize_one_reloc):     	Likewise.     	* mach-o-x86-64.c (bfd_mach_o_x86_64_canonicalize_one_reloc):     	Likewise.          	* vms-alpha.c (_bfd_vms_slurp_eihd): Make sure that there is     	enough data in the record before attempting to parse it.     	(_bfd_vms_slurp_eeom): Likewise.          	(_bfd_vms_slurp_egsd): Check for an invalid section index.     	(image_set_ptr): Likewise.     	(alpha_vms_slurp_relocs): Likewise. ```  [Comment 2](show_bug.cgi?id=21813#c2)  Sourceware Commits    2017-07-24 13:05:21 UTC  ``` The master branch has been updated by Nick Clifton <nickc@sourceware.org>:  <https://sourceware.org/git/gitweb.cgi?p=binutils-gdb.git;h=8a2df5e2df374289e00ecd8f099eb46d76ef982e>  commit 8a2df5e2df374289e00ecd8f099eb46d76ef982e Author: Nick Clifton <nickc@redhat.com> Date:   Mon Jul 24 14:04:04 2017 +0100      Fix another memory access error triggered by attempting to parse a corrupt binary.          	[PR 21813](show_bug.cgi?id=21813 "RESOLVED FIXED - Additional undefined behavior and crashes")     	(alpha_vms_object_p): Check for a truncated record. ```  [Comment 3](show_bug.cgi?id=21813#c3)  Nick Clifton    2017-07-24 13:07:31 UTC  ``` Hi Ned,    Thanks for the bug report.  I have checked in a couple of patches to    address the issues you reported.  (I had trouble reproducing the alpha-   heap-overflow issue, which is why the patch for that test was checked   in separately.  Your analysis of the bug was correct, although the   correct thing to do was to jump to the error_ret label if the input    buffer was too small.  Cheers   Nick ```  [Comment 4](show_bug.cgi?id=21813#c4)  Sourceware Commits    2017-09-04 15:33:25 UTC  ``` The binutils-2_29-branch branch has been updated by Nick Clifton <nickc@sourceware.org>:  <https://sourceware.org/git/gitweb.cgi?p=binutils-gdb.git;h=deeb3d27c254ad8bf8c3877fa6b61817f56191f5>  commit deeb3d27c254ad8bf8c3877fa6b61817f56191f5 Author: Nick Clifton <nickc@redhat.com> Date:   Mon Sep 4 16:31:12 2017 +0100      Import patch from mainline to fix address violation errors when parsing corrupt VMS and MACHO binaries.          	[PR 21813](show_bug.cgi?id=21813 "RESOLVED FIXED - Additional undefined behavior and crashes")     	* mach-o.c (bfd_mach_o_canonicalize_relocs): Pass the base address     	of the relocs to the canonicalize_one_reloc routine.     	* mach-o.h (struct bfd_mach_o_backend_data): Update the prototype     	for the _bfd_mach_o_canonicalize_one_reloc field.     	* mach-o-arm.c (bfd_mach_o_arm_canonicalize_one_reloc): Add     	res_base parameter.  Use to check for corrupt pair relocs.     	* mach-o-aarch64.c (bfd_mach_o_arm64_canonicalize_one_reloc):     	Likewise.     	* mach-o-i386.c (bfd_mach_o_i386_canonicalize_one_reloc):     	Likewise.     	* mach-o-x86-64.c (bfd_mach_o_x86_64_canonicalize_one_reloc):     	Likewise.     	* vms-alpha.c (_bfd_vms_slurp_eihd): Make sure that there is     	enough data in the record before attempting to parse it.     	(_bfd_vms_slurp_eeom): Likewise.     	(_bfd_vms_slurp_egsd): Check for an invalid section index.     	(image_set_ptr): Likewise.     	(alpha_vms_slurp_relocs): Likewise.     	(alpha_vms_object_p): Check for a truncated record. ```  [Comment 5](show_bug.cgi?id=21813#c5)  Sourceware Commits    2017-09-05 14:33:26 UTC  ``` The binutils-2_29-branch branch has been updated by Nick Clifton <nickc@sourceware.org>:  <https://sourceware.org/git/gitweb.cgi?p=binutils-gdb.git;h=64aa1246572306b72dc479b46d13ff749b0c3236>  commit 64aa1246572306b72dc479b46d13ff749b0c3236 Author: Nick Clifton <nickc@redhat.com> Date:   Tue Sep 5 15:32:04 2017 +0100      Import patches from mainline to fix minor binutils bugs:          	[PR 21861](show_bug.cgi?id=21861 "RESOLVED FIXED - mingw-w64 binutils built on x86_64-musl segfaults when compiling zlib.")     	* winduni.c (codepages): Use cp1252 for codepage 0.          	[PR 21813](show_bug.cgi?id=21813 "RESOLVED FIXED - Additional undefined behavior and crashes")     	* rddbg.c (read_symbol_stabs_debugging_info): Check for an empty     	string whilst concatenating symbol names.          	[PR 21909](show_bug.cgi?id=21909 "RESOLVED FIXED - Stack buffer overflow in pr_int_type - prdbg.c:586")     	* prdbg.c (pr_int_type): Increase size of local string buffer.     	(pr_float_type): Likewise.     	(pr_bool_type): Likewise.          	[PR 21820](show_bug.cgi?id=21820 "RESOLVED FIXED - [2.29 Regression] readelf now exits with error reading an empty section")     	* readelf.c (dump_section_as_strings): Do not fail if the section     	was empty.     	(dump_section_as_bytes): Likewise.          	[PR 21990](show_bug.cgi?id=21990 "RESOLVED FIXED - Integer overflow in process_version_sections (readelf.c)")     	* readelf.c (process_version_sections <SHT_GNU_verneed>): Check     	for invalid vn_next field before adding to idx.  Use unsigned     	long for index vars.  Move index checks.     	<SHT_GNU_verdef>: Likewise for vd_next.          	[PR 21994](show_bug.cgi?id=21994 "RESOLVED FIXED - Hang in process_version_sections with ent.vd_next = 0 and aux.vda_next = 0")     	* readelf.c (process_version_sections <SHT_GNU_verdef>): Check     	vd_aux and vda_next for sanity.  Delete "end".  Correct overflow     	checks.     	(process_version_sections <SHT_GNU_verneed>): Correct overflow     	check.  Don't report invalid vna_next on overflow.  Do report     	invalid vna_next on size less than aux info. ```  [Comment 6](show_bug.cgi?id=21813#c6)  yzhan219    2021-07-02 15:27:54 UTC  ``` (In reply to Ned Williamson from [comment #0](show_bug.cgi?id=21813#c0)) > Created [attachment 10281](attachment.cgi?id=10281 "5 testcases with asan output") [[details]](attachment.cgi?id=10281&action=edit "5 testcases with asan output") > 5 testcases with asan output >  > I've found 5 more bugs in objdump master branch. >  > These bugs repro for me when building for all targets with a recent version > of clang and AddressSanitizer and running them with `./objdump -xg testcase` > (one crash requires debug output). >  > If any don't reproduce, let me know and I can try to identify another > testcase or help identify the root cause. I've included `asan_output` with > my stacktrace for each test. >  > I have investigated alpha-heap-overflow, and there the fix is to check that > `PRIV (recrd.rec_size) > test_len` before reading the remaining record. >  > Cheers, > Ned  Hi Ned,  I tried to reproduce the crashed by using the test cases you provide. But none of them works, objdump says "objdump: debug_oob_read: File format not recognized". Could you please check if you have other test cases? Thank you so much.  Dennis ```  [Comment 7](show_bug.cgi?id=21813#c7)  Sourceware Commits    2021-10-24 11:36:27 UTC  ``` The master branch has been updated by Alan Modra <amodra@sourceware.org>:  <https://sourceware.org/git/gitweb.cgi?p=binutils-gdb.git;h=e02812494254b70fec6fa432f7f668956711133b>  commit e02812494254b70fec6fa432f7f668956711133b Author: Alan Modra <amodra@gmail.com> Date:   Sun Oct 24 18:36:03 2021 +1030      asan: arm-darwin: buffer overflow                  [PR 21813](show_bug.cgi?id=21813 "RESOLVED FIXED - Additional undefined behavior and crashes")             * mach-o-arm.c (bfd_mach_o_arm_canonicalize_one_reloc): Sanity             check PAIR reloc in other branch of condition as was done for             [PR21813](show_bug.cgi?id=21813 "RESOLVED FIXED - Additional undefined behavior and crashes").  Formatting.  Delete debug printf. ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=21813)
* - [XML](show_bug.cgi?ctype=xml&id=21813)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=21813)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=21813&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=21813&GoAheadAndLogIn=1#forgot)
    Login:

    [x]


