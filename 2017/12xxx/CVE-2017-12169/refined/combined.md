=== Content from bugzilla.redhat.com_4fe6632f_20250126_121758.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1487697)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1487697)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1487697)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1487697

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1487697**](show_bug.cgi?id=1487697)
(CVE-2017-12169)
- [CVE-2017-12169](https://access.redhat.com/security/cve/CVE-2017-12169) ipa: Password hash disclosure via 'System: Read Stage Users' permission

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2017-12169 ipa: Password hash disclosure via 'System: Read Stage Users' p...

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2017-12169 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | low | | [Severity:](page.cgi?id=fields.html#bug_severity) | low | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [1549946](show_bug.cgi?id=1549946) | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1487698](show_bug.cgi?id=1487698) | | TreeView+ | [depends on](buglist.cgi?bug_id=1487697&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1487697&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2017-09-01 16:02 UTC by Adam Mariš | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2021-10-21 11:56 UTC ([History](show_activity.cgi?id=1487697)) | | [CC List:](page.cgi?id=fields.html#cclist) | 13 users (show)  abokovoy carnil huzaifas ipa-maint jhrozek mkosek pvoborni rcritten security-response-team slaznick ssorce tbordaz tscherf | | Fixed In Version: |  | | | Doc Type: | If docs needed, set a value | | | Doc Text: | It was found that IPA could disclose password hashes to users having the 'System: Read Stage Users' permission. A remote, authenticated attacker could potentially use this flaw to disclose the password hashes belonging to Stage Users. This security issue does not result in disclosure of password hashes belonging to active standard users. | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2021-10-21 11:56:49 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | | [**Final fix**](attachment.cgi?id=1331008 "View the content of the attachment") (6.38 KB, patch)  [2017-09-26 11:43 UTC](#attach_1331008 "Go to the comment associated with the attachment"), thierry bordaz | rcritten: review- | [Details](attachment.cgi?id=1331008&action=edit) | [Diff](attachment.cgi?id=1331008&action=diff) | | [View All](attachment.cgi?bugid=1487697&action=viewall) | | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1487697#c0)  Adam Mariš    2017-09-01 16:02:07 UTC  ``` An information disclosure vulnerability has been found in ipa allowing attacker to retrieve user password hash when utilizing 'System: Read Stage Users' permission.   ```  [Comment 1](show_bug.cgi?id=1487697#c1)  Dhiru Kholia    2017-09-15 08:58:14 UTC  ``` Acknowledgments:  Name: Rob Crittenden (Red Hat)   ```  [Comment 2](show_bug.cgi?id=1487697#c2)  thierry bordaz    2017-09-22 16:24:18 UTC  ``` I reproduced the problem and indeed it is a pb of badly (not strict enough) ACIs in stage user container.  I identified a fix but have not yet prepare a fix for it. The fix is simple and should be ready early next week.   ```  [Comment 4](show_bug.cgi?id=1487697#c4)  thierry bordaz    2017-09-26 11:43:08 UTC  ``` Created [attachment 1331008](attachment.cgi?id=1331008&action=diff "Final fix") [[details]](attachment.cgi?id=1331008&action=edit "Final fix") Final fix  The Tentative fix was missing a 'add' directive in 30-provisioning.update   ```  [Comment 5](show_bug.cgi?id=1487697#c5)  Rob Crittenden    2017-09-26 15:46:41 UTC  ``` Comment on [attachment 1331008](attachment.cgi?id=1331008&action=diff "Final fix") [[details]](attachment.cgi?id=1331008&action=edit "Final fix") Final fix  NACK, doesn't handle upgrades properly:  1. This doesn't replace any existing ACIs. You can fix part of that with something like:  +# Update existing ACI that granted too broad permissions for reading +# staged-users attributes +replace:aci: (targetattr="userPassword || krbPrincipalKey")(version 3 .0; acl "Search existence of password and kerberos keys"; allow(read, search) us erdn = "ldap:///uid=admin,cn=users,cn=accounts,$SUFFIX";)::(targetattr="userPass word || krbPrincipalKey")(version 3.0; acl "Search existence of password and ker beros keys"; allow(search) groupdn = "ldap:///cn=System: Read Stage Users,cn=per missions,cn=pbac,$SUFFIX";)  2. The system permission isn't being updated properly for some reason:  $ ipa permission-show "System: Read Stage Users"   Permission name: System: Read Stage Users   Granted rights: search, compare, read   Effective attributes: *, cn, createtimestamp, description, displayname,                         entryusn, gecos, gidnumber, givenname, homedirectory,                         initials, ipantsecurityidentifier, loginshell, manager,                         modifytimestamp, objectclass, sn, title, uid, uidnumber   Default attributes: *, gidnumber, displayname, entryusn, objectclass,                       uidnumber, modifytimestamp, givenname, initials, title,                       gecos, description, ipantsecurityidentifier, loginshell,                       createtimestamp, sn, uid, homedirectory, manager, cn   Bind rule type: permission   Subtree: cn=staged users,cn=accounts,cn=provisioning,dc=greyoak,dc=com   Extra target filter: (objectclass=*)   Target DN: uid=*,cn=staged users,cn=accounts,cn=provisioning,dc=greyoak,dc=com   Permission flags: SYSTEM, V2, MANAGED   Granted to Privilege: Stage User Administrators   Indirect Member of roles: User Administrator  * is still in the attributes list.  The other changed ACI does seem to properly handle not disclosing keys.   ```  [Comment 6](show_bug.cgi?id=1487697#c6)  Martin Kosek    2017-10-04 08:56:50 UTC  ``` (In reply to Adam Mariš from [comment #0](show_bug.cgi?id=1487697#c0)) > An information disclosure vulnerability has been found in ipa allowing > attacker to retrieve user password hash when utilizing 'System: Read Stage > Users' permission.  Thierry CCed me on this CVE. I am not convinced that this is a valid CVE.  As you can see in the FreeIPA User Life-Cycle feature design, the Stage User password is treated in a special way: <http://www.freeipa.org/page/V4/User_Life-Cycle_Management#Staging_entry> When the Staged User is being Activated, the entry is actually deleted and added again to an active IdM container, which means that the Stage User Administrator performing the Activation must have access also to userPassword attribute. Otherwise, the activated user would not have the provisioned password set properly.  See following section for details: <http://www.freeipa.org/page/V4/User_Life-Cycle_Management#MODRDN_vs._ADD-DEL>  A change in the way how user is Activated would require a (too) costly architectural change, given this is an escalated privilege that needs to be explicitly (and wisely) assigned first, before it can show this password.   ```  [Comment 7](show_bug.cgi?id=1487697#c7)  Rob Crittenden    2017-10-04 12:32:34 UTC  ``` I strongly disagree. Password hashes should never be visible. That is one of the key features of IPA.  Just because this may be hard to fix doesn't mean it shouldn't be done.   ```  [Comment 8](show_bug.cgi?id=1487697#c8)  Martin Kosek    2017-10-04 13:00:34 UTC  ``` Password hashes are indeed not visible for active standard users - we are in agreement there.  The reported behavior, however, only affects provisioned inactive users (a.k.a. Stage User) and only exposes the password to an established Stage User Administrator, not to random authenticated user. The actual exploitability of the exposed password to Stage User Administrator is questionable, because Stage User Administrator would typically already be quite powerful and have permissions to create a Staged User and Activating it (thus creating normal user account). Also note that the exposed password that is provisioned for the Staged User should be expired during Activation (IIRC), which means that the active user will be forced to change on the first login.  So considering above, the feature is now behaving according to an approved upstream design, released in FreIPA 4.2.0: <http://www.freeipa.org/page/Releases/4.2.0> If you want to change it, it would require re-design and new architecture to fix this exposure.  So given unknown exploitability of this behavior and high cost for fixing it, I would consider it rather as "low" priority, "low" severity CVE (if not closing it as NOTABUG, which would be my preference).   ```  [Comment 9](show_bug.cgi?id=1487697#c9)  Rob Crittenden    2017-10-04 19:36:06 UTC  ``` Conversely an IPA administrator can see none of the keys of a typical IPA user.  I agree the password being reset upon moving to Staging is a mitigating factor. Thierry can you confirm this?   ```  [Comment 10](show_bug.cgi?id=1487697#c10)  Simo Sorce    2017-10-04 20:10:10 UTC  ``` Martin the problem is password hash disclosure in itself. There is no other "exploitation factor" except that an admin can take those hashes and do offline bruteforce attacks on them. If the user used a "valuable" password used elsewhere then those creds are at risk. It is a low security issue, but it is an issue that we should address. Our policy is that hashes are not visible to users, so we either remove the hashes when a user is moved to staging or we make it impossible for admin users to see them.   ```  [Comment 11](show_bug.cgi?id=1487697#c11)  thierry bordaz    2017-10-05 07:09:27 UTC  ``` My understanding is that access (read) to stage user password is a security issue (even from an admin: stage user admin). user password hash could be hidden from IPA CLI, but it will remain readable from a ldapsearch so changing the CLI to hide the password looks not enough.  If we prevent the read access to the user password hash, the password is reset.  I can think to those options, but likely there are others:  - Disallow password setting for Stage user  - Use MODRDN to activate a stage user than ADD_DEL   The drawback for MODRDN was the complexity to make sure that the activated stage user is fully matching freeipa rules for regular user.   <https://www.freeipa.org/page/V4/User_Life-Cycle_Management#MODRDN_vs._ADD-DEL>   ```  [Comment 14](show_bug.cgi?id=1487697#c14)  Salvatore Bonaccorso    2018-04-16 18:41:15 UTC  ``` Was there any decision if the CVE is valid?  Given different opinions, was there any progress to address the issues raised?   ```  [Comment 15](show_bug.cgi?id=1487697#c15)  Huzaifa S. Sidhpurwala    2018-04-17 10:43:36 UTC  ``` (In reply to Salvatore Bonaccorso from [comment #14](show_bug.cgi?id=1487697#c14)) > Was there any decision if the CVE is valid? > Yes, we decided that the CVE is valid (though its a low impact security flaw)   > Given different opinions, was there any progress to address the issues > raised?  Seems like a patch is available at: <https://bugzilla.redhat.com/attachment.cgi?id=1331008>   ```  [Comment 16](show_bug.cgi?id=1487697#c16)  Salvatore Bonaccorso    2018-04-17 18:52:48 UTC  ``` Huzaifa, thanks for the clarification.   ```  [Comment 17](show_bug.cgi?id=1487697#c17)  Martin Kosek    2018-08-03 08:01:13 UTC  ``` (In reply to Huzaifa S. Sidhpurwala from [comment #15](show_bug.cgi?id=1487697#c15)) ... > Seems like a patch is available at: > <https://bugzilla.redhat.com/attachment.cgi?id=1331008>  I doubt this patch is valid, it was not reviewed. Based on discussion in the team, fixing this CVE would need a significant rewrite of staging feature in FreeIPA.   ```  [Comment 18](show_bug.cgi?id=1487697#c18)  thierry bordaz    2018-08-03 08:20:00 UTC  ``` I agree, this patch is not valid. It was attached before than some discussion about side effects of hiding the userpasswd. A summary of the discussion was [https://bugzilla.redhat.com/show_bug.cgi?id=1487697#c11](show_bug.cgi?id=1487697#c11 "CLOSED ERRATA - CVE-2017-12169 ipa: Password hash disclosure via 'System: Read Stage Users' permission").   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1487697&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from access.redhat.com_47916f4e_20250126_121759.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from bugzilla.redhat.com_674f603e_20250125_220445.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1487697)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1487697)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1487697)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1487697

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1487697**](show_bug.cgi?id=1487697)
(CVE-2017-12169)
- [CVE-2017-12169](https://access.redhat.com/security/cve/CVE-2017-12169) ipa: Password hash disclosure via 'System: Read Stage Users' permission

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2017-12169 ipa: Password hash disclosure via 'System: Read Stage Users' p...

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2017-12169 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | low | | [Severity:](page.cgi?id=fields.html#bug_severity) | low | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [1549946](show_bug.cgi?id=1549946) | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1487698](show_bug.cgi?id=1487698) | | TreeView+ | [depends on](buglist.cgi?bug_id=1487697&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1487697&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2017-09-01 16:02 UTC by Adam Mariš | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2021-10-21 11:56 UTC ([History](show_activity.cgi?id=1487697)) | | [CC List:](page.cgi?id=fields.html#cclist) | 13 users (show)  abokovoy carnil huzaifas ipa-maint jhrozek mkosek pvoborni rcritten security-response-team slaznick ssorce tbordaz tscherf | | Fixed In Version: |  | | | Doc Type: | If docs needed, set a value | | | Doc Text: | It was found that IPA could disclose password hashes to users having the 'System: Read Stage Users' permission. A remote, authenticated attacker could potentially use this flaw to disclose the password hashes belonging to Stage Users. This security issue does not result in disclosure of password hashes belonging to active standard users. | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2021-10-21 11:56:49 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | | [**Final fix**](attachment.cgi?id=1331008 "View the content of the attachment") (6.38 KB, patch)  [2017-09-26 11:43 UTC](#attach_1331008 "Go to the comment associated with the attachment"), thierry bordaz | rcritten: review- | [Details](attachment.cgi?id=1331008&action=edit) | [Diff](attachment.cgi?id=1331008&action=diff) | | [View All](attachment.cgi?bugid=1487697&action=viewall) | | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1487697#c0)  Adam Mariš    2017-09-01 16:02:07 UTC  ``` An information disclosure vulnerability has been found in ipa allowing attacker to retrieve user password hash when utilizing 'System: Read Stage Users' permission.   ```  [Comment 1](show_bug.cgi?id=1487697#c1)  Dhiru Kholia    2017-09-15 08:58:14 UTC  ``` Acknowledgments:  Name: Rob Crittenden (Red Hat)   ```  [Comment 2](show_bug.cgi?id=1487697#c2)  thierry bordaz    2017-09-22 16:24:18 UTC  ``` I reproduced the problem and indeed it is a pb of badly (not strict enough) ACIs in stage user container.  I identified a fix but have not yet prepare a fix for it. The fix is simple and should be ready early next week.   ```  [Comment 4](show_bug.cgi?id=1487697#c4)  thierry bordaz    2017-09-26 11:43:08 UTC  ``` Created [attachment 1331008](attachment.cgi?id=1331008&action=diff "Final fix") [[details]](attachment.cgi?id=1331008&action=edit "Final fix") Final fix  The Tentative fix was missing a 'add' directive in 30-provisioning.update   ```  [Comment 5](show_bug.cgi?id=1487697#c5)  Rob Crittenden    2017-09-26 15:46:41 UTC  ``` Comment on [attachment 1331008](attachment.cgi?id=1331008&action=diff "Final fix") [[details]](attachment.cgi?id=1331008&action=edit "Final fix") Final fix  NACK, doesn't handle upgrades properly:  1. This doesn't replace any existing ACIs. You can fix part of that with something like:  +# Update existing ACI that granted too broad permissions for reading +# staged-users attributes +replace:aci: (targetattr="userPassword || krbPrincipalKey")(version 3 .0; acl "Search existence of password and kerberos keys"; allow(read, search) us erdn = "ldap:///uid=admin,cn=users,cn=accounts,$SUFFIX";)::(targetattr="userPass word || krbPrincipalKey")(version 3.0; acl "Search existence of password and ker beros keys"; allow(search) groupdn = "ldap:///cn=System: Read Stage Users,cn=per missions,cn=pbac,$SUFFIX";)  2. The system permission isn't being updated properly for some reason:  $ ipa permission-show "System: Read Stage Users"   Permission name: System: Read Stage Users   Granted rights: search, compare, read   Effective attributes: *, cn, createtimestamp, description, displayname,                         entryusn, gecos, gidnumber, givenname, homedirectory,                         initials, ipantsecurityidentifier, loginshell, manager,                         modifytimestamp, objectclass, sn, title, uid, uidnumber   Default attributes: *, gidnumber, displayname, entryusn, objectclass,                       uidnumber, modifytimestamp, givenname, initials, title,                       gecos, description, ipantsecurityidentifier, loginshell,                       createtimestamp, sn, uid, homedirectory, manager, cn   Bind rule type: permission   Subtree: cn=staged users,cn=accounts,cn=provisioning,dc=greyoak,dc=com   Extra target filter: (objectclass=*)   Target DN: uid=*,cn=staged users,cn=accounts,cn=provisioning,dc=greyoak,dc=com   Permission flags: SYSTEM, V2, MANAGED   Granted to Privilege: Stage User Administrators   Indirect Member of roles: User Administrator  * is still in the attributes list.  The other changed ACI does seem to properly handle not disclosing keys.   ```  [Comment 6](show_bug.cgi?id=1487697#c6)  Martin Kosek    2017-10-04 08:56:50 UTC  ``` (In reply to Adam Mariš from [comment #0](show_bug.cgi?id=1487697#c0)) > An information disclosure vulnerability has been found in ipa allowing > attacker to retrieve user password hash when utilizing 'System: Read Stage > Users' permission.  Thierry CCed me on this CVE. I am not convinced that this is a valid CVE.  As you can see in the FreeIPA User Life-Cycle feature design, the Stage User password is treated in a special way: <http://www.freeipa.org/page/V4/User_Life-Cycle_Management#Staging_entry> When the Staged User is being Activated, the entry is actually deleted and added again to an active IdM container, which means that the Stage User Administrator performing the Activation must have access also to userPassword attribute. Otherwise, the activated user would not have the provisioned password set properly.  See following section for details: <http://www.freeipa.org/page/V4/User_Life-Cycle_Management#MODRDN_vs._ADD-DEL>  A change in the way how user is Activated would require a (too) costly architectural change, given this is an escalated privilege that needs to be explicitly (and wisely) assigned first, before it can show this password.   ```  [Comment 7](show_bug.cgi?id=1487697#c7)  Rob Crittenden    2017-10-04 12:32:34 UTC  ``` I strongly disagree. Password hashes should never be visible. That is one of the key features of IPA.  Just because this may be hard to fix doesn't mean it shouldn't be done.   ```  [Comment 8](show_bug.cgi?id=1487697#c8)  Martin Kosek    2017-10-04 13:00:34 UTC  ``` Password hashes are indeed not visible for active standard users - we are in agreement there.  The reported behavior, however, only affects provisioned inactive users (a.k.a. Stage User) and only exposes the password to an established Stage User Administrator, not to random authenticated user. The actual exploitability of the exposed password to Stage User Administrator is questionable, because Stage User Administrator would typically already be quite powerful and have permissions to create a Staged User and Activating it (thus creating normal user account). Also note that the exposed password that is provisioned for the Staged User should be expired during Activation (IIRC), which means that the active user will be forced to change on the first login.  So considering above, the feature is now behaving according to an approved upstream design, released in FreIPA 4.2.0: <http://www.freeipa.org/page/Releases/4.2.0> If you want to change it, it would require re-design and new architecture to fix this exposure.  So given unknown exploitability of this behavior and high cost for fixing it, I would consider it rather as "low" priority, "low" severity CVE (if not closing it as NOTABUG, which would be my preference).   ```  [Comment 9](show_bug.cgi?id=1487697#c9)  Rob Crittenden    2017-10-04 19:36:06 UTC  ``` Conversely an IPA administrator can see none of the keys of a typical IPA user.  I agree the password being reset upon moving to Staging is a mitigating factor. Thierry can you confirm this?   ```  [Comment 10](show_bug.cgi?id=1487697#c10)  Simo Sorce    2017-10-04 20:10:10 UTC  ``` Martin the problem is password hash disclosure in itself. There is no other "exploitation factor" except that an admin can take those hashes and do offline bruteforce attacks on them. If the user used a "valuable" password used elsewhere then those creds are at risk. It is a low security issue, but it is an issue that we should address. Our policy is that hashes are not visible to users, so we either remove the hashes when a user is moved to staging or we make it impossible for admin users to see them.   ```  [Comment 11](show_bug.cgi?id=1487697#c11)  thierry bordaz    2017-10-05 07:09:27 UTC  ``` My understanding is that access (read) to stage user password is a security issue (even from an admin: stage user admin). user password hash could be hidden from IPA CLI, but it will remain readable from a ldapsearch so changing the CLI to hide the password looks not enough.  If we prevent the read access to the user password hash, the password is reset.  I can think to those options, but likely there are others:  - Disallow password setting for Stage user  - Use MODRDN to activate a stage user than ADD_DEL   The drawback for MODRDN was the complexity to make sure that the activated stage user is fully matching freeipa rules for regular user.   <https://www.freeipa.org/page/V4/User_Life-Cycle_Management#MODRDN_vs._ADD-DEL>   ```  [Comment 14](show_bug.cgi?id=1487697#c14)  Salvatore Bonaccorso    2018-04-16 18:41:15 UTC  ``` Was there any decision if the CVE is valid?  Given different opinions, was there any progress to address the issues raised?   ```  [Comment 15](show_bug.cgi?id=1487697#c15)  Huzaifa S. Sidhpurwala    2018-04-17 10:43:36 UTC  ``` (In reply to Salvatore Bonaccorso from [comment #14](show_bug.cgi?id=1487697#c14)) > Was there any decision if the CVE is valid? > Yes, we decided that the CVE is valid (though its a low impact security flaw)   > Given different opinions, was there any progress to address the issues > raised?  Seems like a patch is available at: <https://bugzilla.redhat.com/attachment.cgi?id=1331008>   ```  [Comment 16](show_bug.cgi?id=1487697#c16)  Salvatore Bonaccorso    2018-04-17 18:52:48 UTC  ``` Huzaifa, thanks for the clarification.   ```  [Comment 17](show_bug.cgi?id=1487697#c17)  Martin Kosek    2018-08-03 08:01:13 UTC  ``` (In reply to Huzaifa S. Sidhpurwala from [comment #15](show_bug.cgi?id=1487697#c15)) ... > Seems like a patch is available at: > <https://bugzilla.redhat.com/attachment.cgi?id=1331008>  I doubt this patch is valid, it was not reviewed. Based on discussion in the team, fixing this CVE would need a significant rewrite of staging feature in FreeIPA.   ```  [Comment 18](show_bug.cgi?id=1487697#c18)  thierry bordaz    2018-08-03 08:20:00 UTC  ``` I agree, this patch is not valid. It was attached before than some discussion about side effects of hiding the userpasswd. A summary of the discussion was [https://bugzilla.redhat.com/show_bug.cgi?id=1487697#c11](show_bug.cgi?id=1487697#c11 "CLOSED ERRATA - CVE-2017-12169 ipa: Password hash disclosure via 'System: Read Stage Users' permission").   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1487697&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)


