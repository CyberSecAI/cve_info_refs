The provided content relates to CVE-2017-12663.

**Root cause of vulnerability:**
The vulnerability is a memory leak in the `WriteMAPImage` function within the `map.c` file of ImageMagick. Specifically, the allocated memory for `colormap` is not always released when a memory allocation fails.

**Weaknesses/vulnerabilities present:**
- Memory leak: The code allocates memory for `colormap` but doesn't release it properly when allocation for pixels fails.

**Impact of exploitation:**
- Memory exhaustion: Repeated triggering of the vulnerability can lead to memory exhaustion, causing the application to crash or become unresponsive.

**Attack vectors:**
- The attack vector is through the conversion of a crafted image to the MAP format, specifically when the memory allocation for pixels fails within the `WriteMAPImage` function.

**Required attacker capabilities/position:**
- The attacker needs to be able to supply a specially crafted image to ImageMagick.
- No specific position/capabilities are required other than the ability to trigger the conversion process with a malicious input.

**Additional details:**
- The provided code diff shows the fix for the memory leak by adding a release of the allocated `colormap` memory if it was allocated and the `pixels` allocation fails within the function `WriteMAPImage`.
- The issue was reported by ADLab of Venustech.
- The vulnerability was present in ImageMagick version 7.0.6-2 Q16 x86_64.