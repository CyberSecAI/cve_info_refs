=== Content from lists.debian.org_fcd57896_20250125_092015.html ===


---

[[Date Prev](msg00019.html)][[Date Next](msg00021.html)]
[[Thread Prev](msg00019.html)][[Thread Next](msg00021.html)]
[[Date Index](maillist.html#00020)]
[[Thread Index](threads.html#00020)]

# [SECURITY] [DLA 3058-1] libsndfile security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 3058-1] libsndfile security update
* *From*: Thorsten Alteholz <debian@alteholz.de>
* *Date*: Tue, 28 Jun 2022 19:51:24 +0000 (UTC)
* *Message-id*: <[[üîé]](/msgid-search/alpine.DEB.2.21.2206281950520.29186%40postfach.intern.alteholz.me)¬†[alpine.DEB.2.21.2206281950520.29186@postfach.intern.alteholz.me](msg00020.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian LTS Advisory DLA-3058-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                    Thorsten Alteholz
June 26, 2022                                 <https://wiki.debian.org/LTS>
- -------------------------------------------------------------------------

Package        : libsndfile
Version        : 1.0.27-3+deb9u3
CVE ID         : CVE-2017-12562 CVE-2021-4156

Two issues have been found in libsndfile, a library for reading/writing
audio files.

CVE-2017-12562

   Due to a possible heap buffer overflow attack in an attacker could
   cause a remote denial of service attack by tricking the function into
   outputting a largeamount of data.

CVE-2021-4156

   Using a crafted FLAC file, an attacker could trigger an out-of-bounds
   read that would most likely cause a crash but could potentially leak
   memory information.

For Debian 9 stretch, these problems have been fixed in version
1.0.27-3+deb9u3.

We recommend that you upgrade your libsndfile packages.

For the detailed security status of libsndfile please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/libsndfile>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

-----BEGIN PGP SIGNATURE-----

iQKTBAEBCgB9FiEEYgH7/9u94Hgi6ruWlvysDTh7WEcFAmK7W7xfFIAAAAAALgAo
aXNzdWVyLWZwckBub3RhdGlvbnMub3BlbnBncC5maWZ0aGhvcnNlbWFuLm5ldDYy
MDFGQkZGREJCREUwNzgyMkVBQkI5Njk2RkNBQzBEMzg3QjU4NDcACgkQlvysDTh7
WEeC0xAAtkLIBSzpZUxr6ZyRmQqRqRlofjjYLQWgR+P/MVoY2FqT0Wgu9m1QKUi9
2X/UK4NMLVLfskdTsqqXHv1nrUj5e/lDlGCLYjeVvdAWTbALTndsr0e7Z75ojaLU
YJ/5ecRn0I/GTU/N+HCQk09oxu/F1/9fK6I6jQnRQQrb1oOtUl84zuudKR0NHsHT
J4WeBqZbhcIXdAyyuZ94xPF/K97O+Aokqoth+ycp7CjZvS9mQSsSpnqDMrW77xnE
nv4DoPK80L/Oe6B0++xiZxUcq9DDxJ8zeTqUvwktKdzxH9qvKcrh7mVgYMOiBKTF
YHtXiqbMsyz83A6nj5SFTZX5E/piQYocTPPMeuK2jA0cPE7MzLhxTVvYfmbk8LtY
59CQbPBHbr7bYzm1q1Qgwl0HleMeHkmzz65y02x4TCVnMLukQZrrBmF4iAAtmT3+
f/IDPg+nidzNFsD1BSRg/vYxAK5RxJeMsrkroEBY7pNO4GYAaRWF7DV33wwLhBwV
4GD9LsbVSVMO5CwItRfhkAv2TER0X2JmKQ/LYdUXACYDtvCoRDUgQDdnauf9y8M/
okb+syuIek+z2klRWnTIJZhWAcbw5PPLUNG5OG3AkFoUsgU1A10za30LJd4ch8e6
egIsuneiprCztxRQL8CEgWqCCwgbWfGeDJm9utDACQBfDsIkDtw=
=NXPH
-----END PGP SIGNATURE-----

```

---



=== Content from security.gentoo.org_499e1f43_20250125_092015.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# libsndfile: Multiple vulnerabilities ‚Äî GLSA **201811-23**

Multiple vulnerabilities have been found in libsndfile, the worst
of which might allow remote attackers to cause a Denial of Service
condition.

### Affected packages

| Package | **media-libs/libsndfile** on all architectures |
| --- | --- |
| Affected versions | < **1.0.28-r4** |
| Unaffected versions | >= **1.0.28-r4** |

### Background

libsndfile is a C library for reading and writing files containing
sampled sound.

### Description

Multiple vulnerabilities have been discovered in libsndfile. Please
review the CVE identifiers referenced below for details.

### Impact

A remote attacker, by enticing a user to open a specially crafted file,
could cause a Denial of Service condition or have other unspecified
impacts.

### Workaround

There is no known workaround at this time.

### Resolution

All libsndfile users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=media-libs/libsndfile-1.0.28-r4"

```
### References

* [CVE-2017-12562](https://nvd.nist.gov/vuln/detail/CVE-2017-12562)
* [CVE-2017-14634](https://nvd.nist.gov/vuln/detail/CVE-2017-14634)
* [CVE-2017-6892](https://nvd.nist.gov/vuln/detail/CVE-2017-6892)
* [CVE-2017-8361](https://nvd.nist.gov/vuln/detail/CVE-2017-8361)
* [CVE-2017-8362](https://nvd.nist.gov/vuln/detail/CVE-2017-8362)
* [CVE-2017-8363](https://nvd.nist.gov/vuln/detail/CVE-2017-8363)
* [CVE-2017-8365](https://nvd.nist.gov/vuln/detail/CVE-2017-8365)
* [CVE-2018-13139](https://nvd.nist.gov/vuln/detail/CVE-2018-13139)

**Release date**

November 30, 2018

**Latest revision**

November 30, 2018: 1

**Severity**

normal

**Exploitable**

remote

**Bugzilla entries**

* [618016](https://bugs.gentoo.org/show_bug.cgi?id=618016)
* [624814](https://bugs.gentoo.org/show_bug.cgi?id=624814)
* [627152](https://bugs.gentoo.org/show_bug.cgi?id=627152)
* [631634](https://bugs.gentoo.org/show_bug.cgi?id=631634)
* [660452](https://bugs.gentoo.org/show_bug.cgi?id=660452)

### Questions or comments?

Please feel free to contact us.

**¬© 2001‚Äì2020 Gentoo Foundation, Inc.**



=== Content from wiki.debian.org_8d48714b_20250126_074522.html ===

[![Debian](https://www.debian.org/Pics/openlogo-50.png)](https://www.debian.org "Debian Homepage")

[Wiki](/FrontPage "Debian Wiki Homepage")

[Login](/LTS?action=login)

* [FrontPage](/FrontPage)
* [RecentChanges](/RecentChanges)
* [FindPage](/FindPage)
* [HelpContents](/HelpContents)
* [LTS](/LTS)

Search:

[![Debian](https://www.debian.org/Pics/openlogo-50.png)](https://www.debian.org "Debian Homepage")
[Wiki](/FrontPage "Debian Wiki Homepage")/

* [Login](/LTS?action=login)
* Comments
* [Info](/LTS?action=info)
* [Attachments](/LTS?action=AttachFile)
* More Actions:
  Raw Text
  Print View
  Render as Docbook
  Delete Cache
  ------------------------
  Check Spelling
  Like Pages
  Local Site Map
  ------------------------
  Rename Page
  Delete Page
  ------------------------
  Subscribe User
  ------------------------
  Remove Spam
  Revert to this revision
  Package Pages
  ------------------------
  Load
  Save
  SlideShow

# * [LTS](/LTS)

[Translation(s)](/DebianWiki/EditorGuide#translation): [English](/LTS) - [Deutsch](/de/LTS) - [Espa√±ol](/es/LTS) - [Fran√ßais](/fr/LTS) - [Italiano](/it/LTS) - [ÌïúÍµ≠Ïñ¥](/ko/LTS) - [Portugu√™s](/pt/LTS) - [Portugu√™s (Brasil)](/pt_BR/LTS) - [–†—É—Å—Å–∫–∏–π](/ru/LTS)

# Debian Long Term Support

Debian Long Term Support (LTS) is a project to extend the lifetime of all Debian stable releases to (at least) 5 years. Debian LTS is not handled by the Debian Security and Release teams, but by a separate group of volunteers and companies interested in making it a success.

Thus the Debian LTS team takes over security maintenance of the various releases once the Debian Security team stops its work.

![/!\](/htdocs/debwiki/img/alert.png "/!\")

LTS ([last modified 2024-08-15 02:46:47](/LTS?action=info))

* Debian [privacy policy](https://www.debian.org/legal/privacy), Wiki [team](/Teams/DebianWiki), [bugs](https://bugs.debian.org/wiki.debian.org) and [config](https://salsa.debian.org/debian/wiki.debian.org).
* Powered by [MoinMoin](https://moinmo.in/ "This site uses the MoinMoin Wiki software.") and [Python](https://moinmo.in/Python "MoinMoin is written in Python."), with hosting provided by [Metropolitan Area Network Darmstadt](https://www.man-da.de/).



=== Content from github.com_58adefc5_20250125_092015.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibsndfile%2Flibsndfile%2Fissues%2F292)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibsndfile%2Flibsndfile%2Fissues%2F292)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=libsndfile%2Flibsndfile)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[libsndfile](/libsndfile)
/
**[libsndfile](/libsndfile/libsndfile)**
Public

* [Notifications](/login?return_to=%2Flibsndfile%2Flibsndfile) You must be signed in to change notification settings
* [Fork
  399](/login?return_to=%2Flibsndfile%2Flibsndfile)
* [Star
   1.5k](/login?return_to=%2Flibsndfile%2Flibsndfile)

* [Code](/libsndfile/libsndfile)
* [Issues
  146](/libsndfile/libsndfile/issues)
* [Pull requests
  27](/libsndfile/libsndfile/pulls)
* [Discussions](/libsndfile/libsndfile/discussions)
* [Actions](/libsndfile/libsndfile/actions)
* [Projects
  0](/libsndfile/libsndfile/projects)
* [Security](/libsndfile/libsndfile/security)
* [Insights](/libsndfile/libsndfile/pulse)

Additional navigation options

* [Code](/libsndfile/libsndfile)
* [Issues](/libsndfile/libsndfile/issues)
* [Pull requests](/libsndfile/libsndfile/pulls)
* [Discussions](/libsndfile/libsndfile/discussions)
* [Actions](/libsndfile/libsndfile/actions)
* [Projects](/libsndfile/libsndfile/projects)
* [Security](/libsndfile/libsndfile/security)
* [Insights](/libsndfile/libsndfile/pulse)

# Heap buffer overflows in `psf_binheader_writef` in 1.0.28 and later¬†#292

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[Heap buffer overflows in `psf_binheader_writef` in 1.0.28 and later](#top)#292Copy link[![@manxorist](https://avatars.githubusercontent.com/u/6185338?u=9de2041a93d8a42659f4aa1b1d084bfb55e29a40&v=4&size=80)](/manxorist)
## Description

[![@manxorist](https://avatars.githubusercontent.com/u/6185338?u=9de2041a93d8a42659f4aa1b1d084bfb55e29a40&v=4&size=48)](/manxorist)[manxorist](https://github.com/manxorist)opened [on Jun 14, 2017](https://github.com/libsndfile/libsndfile/issues/292#issue-235832452)

1. Case `'s'` only enlarges the buffer by `16` bytes instead of `size` bytes.

   This issue had originally reported by funute against openmpt123 (see <https://bugs.openmpt.org/view.php?id=974> ). openmpt123 uses libsndfile to write WAV files and can output large amounts of string data in the `SF_STR_COMMENT` metadata field.

   Valgrind stacktrace (libsndfile 1.0.28):

```
manx@sagnix:~/projects/openmpt/trunk$ valgrind bin/openmpt123 --quiet test2.it --force -o test.wav
==23301== Memcheck, a memory error detector
==23301== Copyright (C) 2002-2015, and GNU GPL'd, by Julian Seward et al.
==23301== Using Valgrind-3.11.0 and LibVEX; rerun with -h for copyright info
==23301== Command: bin/openmpt123 --quiet test2.it --force -o test.wav
==23301==
==23301== Invalid write of size 1
==23301==    at 0x4031F43: memcpy (in /usr/lib/valgrind/vgpreload_memcheck-x86-linux.so)
==23301==    by 0x4527B6E: memcpy (string3.h:53)
==23301==    by 0x4527B6E: psf_binheader_writef (common.c:687)
==23301==    by 0x450BC61: wavlike_write_strings (wavlike.c:1123)
==23301==    by 0x450C91C: wav_write_header (wav.c:1062)
==23301==    by 0x44EFCEC: sf_writef_float (sndfile.c:2451)
==23301==    by 0x805ACC4: openmpt123::sndfile_stream_raii::write(std::vector<float*, std::allocator<float*> >, unsigned int) (in /home/manx/projects/openmpt/trunk/bin/openmpt123)
[...]

```

Test case in bug1.c (tested on Ubuntu 14.04 x86-64 with libsndfile 1.0.28):

```
/* gcc -std=c99 -O2 -g -Wall -Wextra bug1.c -lsndfile && valgrind ./a.out */

#include <stdint.h>
#include <stdlib.h>
#include <string.h>
#include <sndfile.h>

#define LENGTH_FRAMES 10

static int16_t buffer[LENGTH_FRAMES*2];

void add_string( SNDFILE * sf, int str_type, size_t len ) {

	char * str = NULL;

	str = calloc( len + 1, 1 );
	if ( !str ) {
		fprintf( stderr, "%s\n", "error" );
		exit( 1 );
	}
	memset( str, 'x', len );
	sf_set_string( sf, str_type, str );
	free( str );
	str = NULL;

}

void test( int format, size_t first, size_t second, size_t third ) {

	SNDFILE * sf = NULL;
	SF_INFO info;
	memset( &info, 0, sizeof( SF_INFO ) );

	fprintf( stderr, "%zd %zd %zd\n", first, second, third );

	info.samplerate = 44100;
	info.channels = 2;
	info.format = format | SF_FORMAT_PCM_16;
	sf = sf_open( "dummy", SFM_WRITE, &info );
	if ( !sf ) {
		fprintf( stderr, "%s\n", "error" );
		exit( 1 );
	}

	add_string( sf, SF_STR_TITLE, first );
	add_string( sf, SF_STR_ARTIST, second );
	add_string( sf, SF_STR_COMMENT, third );

	sf_writef_short( sf, buffer, LENGTH_FRAMES );

	sf_close( sf );
	sf = NULL;

}

int main() {

	test( SF_FORMAT_WAV, 456, 190, 0 );

	/*
	for ( size_t a = 440; a <= 460; a++ ) {
		for ( size_t b = 190; b <= 210; b++ ) {
			for ( size_t c = 0; c <= 0; c++ ) {
				test( SF_FORMAT_WAV, a, b, c );
			}
		}
	}
	*/

	return 0;

}

```

```
manx@idefix ~/test $ gcc -std=c99 -O2 -g -Wall -Wextra bug1.c -lsndfile && valgrind ./a.out
==14278== Memcheck, a memory error detector
==14278== Copyright (C) 2002-2013, and GNU GPL'd, by Julian Seward et al.
==14278== Using Valgrind-3.10.1 and LibVEX; rerun with -h for copyright info
==14278== Command: ./a.out
==14278==
456 190 0
==14278== Invalid write of size 2
==14278==    at 0x4C2F7E3: memcpy@@GLIBC_2.14 (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==14278==    by 0x4E6DD8F: memcpy (string3.h:51)
==14278==    by 0x4E6DD8F: psf_binheader_writef (common.c:687)
==14278==    by 0x4E56250: wavlike_write_strings (wavlike.c:1095)
==14278==    by 0x4E57001: wav_write_header (wav.c:1062)
==14278==    by 0x4E3F92D: sf_writef_short (sndfile.c:2223)
==14278==    by 0x400AFB: test (bug1.c:50)
==14278==    by 0x4008B9: main (bug1.c:59)
==14278==  Address 0x57791e0 is 0 bytes after a block of size 512 alloc'd
==14278==    at 0x4C2CE8E: realloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==14278==    by 0x4E6D923: psf_bump_header_allocation (common.c:68)
==14278==    by 0x4E6E8BC: psf_binheader_writef (common.c:680)
==14278==    by 0x4E56250: wavlike_write_strings (wavlike.c:1095)
==14278==    by 0x4E57001: wav_write_header (wav.c:1062)
==14278==    by 0x4E3F92D: sf_writef_short (sndfile.c:2223)
==14278==    by 0x400AFB: test (bug1.c:50)
==14278==    by 0x4008B9: main (bug1.c:59)
==14278==
==14278== Invalid write of size 1
==14278==    at 0x4E6DDA8: psf_binheader_writef (common.c:689)
==14278==    by 0x4E56250: wavlike_write_strings (wavlike.c:1095)
==14278==    by 0x4E57001: wav_write_header (wav.c:1062)
==14278==    by 0x4E3F92D: sf_writef_short (sndfile.c:2223)
==14278==    by 0x400AFB: test (bug1.c:50)
==14278==    by 0x4008B9: main (bug1.c:59)
==14278==  Address 0x57791e1 is 1 bytes after a block of size 512 alloc'd
==14278==    at 0x4C2CE8E: realloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==14278==    by 0x4E6D923: psf_bump_header_allocation (common.c:68)
==14278==    by 0x4E6E8BC: psf_binheader_writef (common.c:680)
==14278==    by 0x4E56250: wavlike_write_strings (wavlike.c:1095)
==14278==    by 0x4E57001: wav_write_header (wav.c:1062)
==14278==    by 0x4E3F92D: sf_writef_short (sndfile.c:2223)
==14278==    by 0x400AFB: test (bug1.c:50)
==14278==    by 0x4008B9: main (bug1.c:59)
==14278==
==14278== Syscall param write(buf) points to uninitialised byte(s)
==14278==    at 0x5195F80: __write_nocancel (syscall-template.S:81)
==14278==    by 0x4E712C9: psf_fwrite (file_io.c:377)
==14278==    by 0x4E56C3E: wav_write_header (wav.c:1120)
==14278==    by 0x4E3F92D: sf_writef_short (sndfile.c:2223)
==14278==    by 0x400AFB: test (bug1.c:50)
==14278==    by 0x4008B9: main (bug1.c:59)
==14278==  Address 0x5779420 is 512 bytes inside a block of size 1,024 alloc'd
==14278==    at 0x4C2CE8E: realloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==14278==    by 0x4E6D923: psf_bump_header_allocation (common.c:68)
==14278==    by 0x4E6E63C: psf_binheader_writef (common.c:563)
==14278==    by 0x4E561C0: wavlike_write_strings (wavlike.c:1103)
==14278==    by 0x4E57001: wav_write_header (wav.c:1062)
==14278==    by 0x4E3F92D: sf_writef_short (sndfile.c:2223)
==14278==    by 0x400AFB: test (bug1.c:50)
==14278==    by 0x4008B9: main (bug1.c:59)
==14278==
==14278==
==14278== HEAP SUMMARY:
==14278==     in use at exit: 0 bytes in 0 blocks
==14278==   total heap usage: 10 allocs, 10 frees, 17,271 bytes allocated
==14278==
==14278== All heap blocks were freed -- no leaks are possible
==14278==
==14278== For counts of detected and suppressed errors, rerun with: -v
==14278== Use --track-origins=yes to see where uninitialised values come from
==14278== ERROR SUMMARY: 4 errors from 3 contexts (suppressed: 0 from 0)

```

2. `psf_binheader_writef` in `src/common.c` enlarges the header buffer (if needed) prior to the big switch statement by an amount (16 bytes) which is enough for all cases where only a single value gets added. Cases `'s'`, `'S'`, `'p'` however additionally write an arbitrary length block of data and again enlarge the buffer to the required amount. However, the required space calculation does not take into account the size of the length field which gets output before the data.

   Test case bug2.c (tested on Ubuntu 14.04 x86-64 with libsndfile 1.0.28 with `16` replaced by `size` in the buffer size calculation):

```
/* gcc -std=c99 -O2 -g -Wall -Wextra bug2.c -lsndfile && valgrind ./a.out */

#include <stdint.h>
#include <stdlib.h>
#include <string.h>
#include <sndfile.h>

#define LENGTH_FRAMES 10

static int16_t buffer[LENGTH_FRAMES*2];

void add_string( SNDFILE * sf, int str_type, size_t len ) {

	char * str = NULL;

	str = calloc( len + 1, 1 );
	if ( !str ) {
		fprintf( stderr, "%s\n", "error" );
		exit( 1 );
	}
	memset( str, 'x', len );
	sf_set_string( sf, str_type, str );
	free( str );
	str = NULL;

}

void test( int format, size_t first, size_t second, size_t third ) {

	SNDFILE * sf = NULL;
	SF_INFO info;
	memset( &info, 0, sizeof( SF_INFO ) );

	fprintf( stderr, "%zd %zd %zd\n", first, second, third );

	info.samplerate = 44100;
	info.channels = 2;
	info.format = format | SF_FORMAT_PCM_16;
	sf = sf_open( "dummy", SFM_WRITE, &info );
	if ( !sf ) {
		fprintf( stderr, "%s\n", "error" );
		exit( 1 );
	}

	add_string( sf, SF_STR_TITLE, first );
	add_string( sf, SF_STR_ARTIST, second );
	add_string( sf, SF_STR_COMMENT, third );

	sf_writef_short( sf, buffer, LENGTH_FRAMES );

	sf_close( sf );
	sf = NULL;

}

int main() {

	test( SF_FORMAT_WAV, 0, 200, 0 );

	/*
	for ( size_t a = 0; a <= 20; a++ ) {
		for ( size_t b = 190; b <= 210; b++ ) {
			for ( size_t c = 0; c <= 0; c++ ) {
				test( SF_FORMAT_WAV, a, b, c );
			}
		}
	}
	*/

	return 0;

}

```

```
manx@idefix ~/test $ gcc -std=c99 -O2 -g -Wall -Wextra bug2.c -lsndfile && valgrind ./a.out
==15481== Memcheck, a memory error detector
==15481== Copyright (C) 2002-2013, and GNU GPL'd, by Julian Seward et al.
==15481== Using Valgrind-3.10.1 and LibVEX; rerun with -h for copyright info
==15481== Command: ./a.out
==15481==
0 200 0
==15481== Invalid write of size 2
==15481==    at 0x4C2F7E3: memcpy@@GLIBC_2.14 (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==15481==    by 0x4E6DD8F: memcpy (string3.h:51)
==15481==    by 0x4E6DD8F: psf_binheader_writef (common.c:687)
==15481==    by 0x4E561C0: wavlike_write_strings (wavlike.c:1103)
==15481==    by 0x4E57001: wav_write_header (wav.c:1062)
==15481==    by 0x4E3F92D: sf_writef_short (sndfile.c:2223)
==15481==    by 0x400AFB: test (bug2.c:50)
==15481==    by 0x4008B6: main (bug2.c:59)
==15481==  Address 0x5778340 is 0 bytes after a block of size 256 alloc'd
==15481==    at 0x4C2CC70: calloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==15481==    by 0x4E6CBF6: psf_allocate (common.c:46)
==15481==    by 0x4E41437: sf_open (sndfile.c:330)
==15481==    by 0x400AB1: test (bug2.c:40)
==15481==    by 0x4008B6: main (bug2.c:59)
==15481==
==15481== Invalid write of size 1
==15481==    at 0x4E6DDA8: psf_binheader_writef (common.c:689)
==15481==    by 0x4E561C0: wavlike_write_strings (wavlike.c:1103)
==15481==    by 0x4E57001: wav_write_header (wav.c:1062)
==15481==    by 0x4E3F92D: sf_writef_short (sndfile.c:2223)
==15481==    by 0x400AFB: test (bug2.c:50)
==15481==    by 0x4008B6: main (bug2.c:59)
==15481==  Address 0x5778341 is 1 bytes after a block of size 256 alloc'd
==15481==    at 0x4C2CC70: calloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==15481==    by 0x4E6CBF6: psf_allocate (common.c:46)
==15481==    by 0x4E41437: sf_open (sndfile.c:330)
==15481==    by 0x400AB1: test (bug2.c:40)
==15481==    by 0x4008B6: main (bug2.c:59)
==15481==
==15481== Syscall param write(buf) points to uninitialised byte(s)
==15481==    at 0x5195F80: __write_nocancel (syscall-template.S:81)
==15481==    by 0x4E712B9: psf_fwrite (file_io.c:377)
==15481==    by 0x4E56C3E: wav_write_header (wav.c:1120)
==15481==    by 0x4E3F92D: sf_writef_short (sndfile.c:2223)
==15481==    by 0x400AFB: test (bug2.c:50)
==15481==    by 0x4008B6: main (bug2.c:59)
==15481==  Address 0x57789c0 is 256 bytes inside a block of size 512 alloc'd
==15481==    at 0x4C2CE8E: realloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==15481==    by 0x4E6D923: psf_bump_header_allocation (common.c:68)
==15481==    by 0x4E6E63C: psf_binheader_writef (common.c:563)
==15481==    by 0x4E56C23: wav_write_header (wav.c:1119)
==15481==    by 0x4E3F92D: sf_writef_short (sndfile.c:2223)
==15481==    by 0x400AFB: test (bug2.c:50)
==15481==    by 0x4008B6: main (bug2.c:59)
==15481==
==15481==
==15481== HEAP SUMMARY:
==15481==     in use at exit: 0 bytes in 0 blocks
==15481==   total heap usage: 8 allocs, 8 frees, 14,491 bytes allocated
==15481==
==15481== All heap blocks were freed -- no leaks are possible
==15481==
==15481== For counts of detected and suppressed errors, rerun with: -v
==15481== Use --track-origins=yes to see where uninitialised values come from
==15481== ERROR SUMMARY: 3 errors from 3 contexts (suppressed: 0 from 0)
manx@idefix ~/test $

```

3. Buffer size requirement calculation in case `'S'` does not account for the padding byte (`size += (size & 1) ;` happens after the calculation which uses `size`).
4. Case `'S'` can overrun the header buffer by 1 byte when no padding is involved (`memcpy (&(psf->header.ptr [psf->header.indx]), strptr, size + 1) ;` while the buffer is only guaranteed to have `size` space available).
5. `psf->header.ptr [psf->header.indx] = 0 ;` in case `'S'` always writes 1 byte beyond the space which is guaranteed to be allocated in the header buffer.
6. Case `'s'` can overrun the provided source string by 1 byte if padding is involved (`memcpy (&(psf->header.ptr [psf->header.indx]), strptr, size) ;` where `size` is `strlen (strptr) + 1` (which includes the 0 terminator, plus optionally another `1` which is padding and not guaranteed to be readable via the source string pointer).

I have not yet invested the time to provide reproducable tests for 3, 4, 5, 6:

* 3 to 5 require hitting the header buffer end exactly which might not even be possible with 2 byte alignment and the buffer enlargment being also 2 byte aligned (I did not investigate this further, triggering might require an odd `INITAL_HEADER_SIZE` constant and/or a growing factor other than `2`). I would consider the current code to at least be fragile nonetheless.
* 6 is difficult to even catch with valgrind or similar tools because the source strings are layed out in one big buffer contiguously (`psf->strings.storage`) which makes it impossible for memory checkers to detect buffer overruns inside that buffer.

Pull request with fixes will follow.

## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.


