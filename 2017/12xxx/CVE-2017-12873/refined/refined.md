Based on the provided documents, here's the breakdown of the vulnerability described by CVE-2017-12873:

**Root cause of vulnerability:**

- The vulnerability arises from an incorrect persistent NameID generation in SimpleSAMLphp when the Identity Provider (IdP) is misconfigured. Specifically, if the `UserID` is missing from the state array, a `null` value is used as the source for generating the NameID. This happens when no `saml:PersistentNameID` authentication processing filter is configured and no `simplesaml.nameidattribute` configuration option is set and either `userid.attribute` is not set or is set to a missing or empty attribute.

**Weaknesses/vulnerabilities present:**

- **Misconfiguration:** The vulnerability is triggered by a misconfiguration of the IdP, specifically around handling of persistent NameIDs.
- **Inadequate error handling:** When the `UserID` is missing in the state array, the code logs an error but continues processing using a `null` value instead of aborting the NameID generation.
- **Lack of unique user identifier:** If a unique user identifier is not properly set during initial authentication, the system defaults to using a `null` value, leading to the generation of the same NameID for different users.

**Impact of exploitation:**

- **Identifier clash:**  When an IdP is misconfigured different users can receive the same persistent `NameID`.
- **Unauthorized access:** Service Providers might use the NameID to identify users across sessions. Due to the clash in IDs, different users could be associated with the same user account at the service provider, potentially leading to unauthorized access and information disclosure.
- **Impersonation:** Users can effectively impersonate other users on the service provider side.

**Attack vectors:**

- **Misconfigured IdP:** An attacker doesn't directly exploit this vulnerability. Instead, the vulnerability is exposed when the administrator of the Identity Provider (IdP) misconfigures the service. The attack is then performed by users authenticating through the misconfigured IdP, potentially leading to unintended sharing of accounts at the Service Provider (SP).
- This is more an issue with the SAML setup rather than a direct exploit that an attacker can use to break into a system.

**Required attacker capabilities/position:**

- No direct attacker capabilities are needed. The attacker is simply a user who authenticates through a misconfigured IdP.
- The vulnerability is triggered by a misconfiguration in the IdP. The attacker exploits the misconfiguration when authenticating.

**Additional Notes:**

- The issue primarily affects SimpleSAMLphp Identity Providers.
- The issue was present in all versions between 1.7.0 and 1.14.10, inclusive.
- The resolution involves upgrading to the latest version and configuring a `saml:PersistentNameID` authentication processing filter using an attribute that is unique per user and does not change.
- The patch addresses this by checking the UserID before generating a persistent NameID and returning null if it is not set.