Based on the provided commit diff, here's a breakdown of the vulnerability:

**Root Cause of Vulnerability:**

The vulnerability stems from insufficient filtering of user-supplied data when updating a user's profile. Specifically, when a non-admin user attempts to modify their profile, the application wasn't properly filtering out certain fields, like 'role'. This allowed a malicious user to potentially modify restricted user profile fields.

**Weaknesses/Vulnerabilities Present:**

*   **Insufficient Input Filtering:** The primary weakness is the lack of proper sanitization and filtering of input data in `UserModificationController.php`. The code was not explicitly excluding restricted fields for non-admin users.
*   **Inadequate Authorization Enforcement:** The code relies on `! $this->userSession->isAdmin()` to determine if the current user is an administrator or not. However, it then attempts to filter out user roles only if the user is not an admin. This allows any user to potentially change or send arbitrary data values and have them get set into the database.

**Impact of Exploitation:**

*   **Privilege Escalation (Potential):** While the provided code diff specifically addresses the 'role' field, the lack of proper filtering on other fields before this commit might have allowed non-admin users to potentially modify other sensitive user attributes. The 'role' field is a privilege-related attribute which if changed, can lead to a user gaining admin or higher privileges.
*   **Data Corruption:** By modifying user profile data, an attacker could alter user information, potentially leading to data inconsistencies.

**Attack Vectors:**

*   **Web Interface:** The vulnerability is exploitable via the application's web interface by crafting a malicious POST request to the user profile update functionality.

**Required Attacker Capabilities/Position:**

*   **Authenticated User:** The attacker must be an authenticated user of the application.
*   **Basic Web Skills:** The attacker requires the ability to craft and send HTTP requests (e.g. via the developer console or a tool like curl).

**Technical Details**

*   **Vulnerable File:** `app/Controller/UserModificationController.php`
*   **Vulnerable Code (Before Patch):**
    ```php
    if (! $this->userSession->isAdmin()) {
        if (isset($values['role'])) {
            unset($values['role']);
        }
        $values = array(
            'id' => $this->userSession->getId(),
            'username' => isset($values['username']) ? $values['username'] : '',
            'name' => isset($values['name']) ? $values['name'] : '',
            'email' => isset($values['email']) ? $values['email'] : '',
            'timezone' => isset($values['timezone']) ? $values['timezone'] : '',
            'language' => isset($values['language']) ? $values['language'] : '',
        );
    }
    ```
*   **Patch:**
    The patch was to filter out the `role` field and other non-user updatable fields as well, ensuring non-admin users could not modify fields they should not have access to.

**Additional Notes:**

*   The commit message "Filter variables when updating user profile" gives a clear indication about the nature of the change being introduced and the associated security implications
*   The commit also shows changes to `UserCredentialController.php` which now also filters the values if the user is not an administrator. This controller manages password changes.

This commit addresses the vulnerability by explicitly filtering and setting values for non-admin users when modifying profile data and password changes.