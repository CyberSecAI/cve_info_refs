=== Content from bridge.grumpy-troll.org_8fb34f58_20250124_164848.html ===

[Blog](/)
[2017](/2017/)
[Golang SSH Security](/2017/04/golang-ssh-security/)

# [The Grumpy Troll](https://bridge.grumpy-troll.org/ "Homepage")

## Ramblings of a grumpy troll.

# Golang SSH Security

April 2, 2017

This is a tale of two attitudes.

Working on a project for a client recently, I needed to speak the SSH protocol
in [Golang](https://golang.org/ "The Go Programming Language") code. So I started with the [x/crypto/ssh](https://godoc.org/golang.org/x/crypto/ssh "package ssh") package, part of
the suite of libraries from the Golang developers which is not part of the
standard library and not part of their usual compatibility guarantees, but
more along the lines of “useful stuff which might graduate to the standard
library”.

There I am, happy with a great API with clean representations of the
underlying concepts and generally clean use, until I get to “okay, we need to
verify the remote server’s hostkey … how do I do that?” and I quickly
realized that this seemed to involve some grotty work at a lower level of
abstraction than the rest of the API seemed to require of the programmer.

Rather than reinvent the wheel, I turned to my favorite search engine to see
how other projects managed this and started reading the results. Then
panicking a little and searching other projects. I then turned to the
projects of a well-known vendor of Golang-based tooling in the DevOps space
and checked them, and panicked a little more.

I’ve yet to find a project which actually bothered implementing hostkey
verification in SSH client code. None.

I sent off two bug-reports. Both PGP encrypted messages, one to the vendor of
the tooling whose products were dangerously buggy and one to the Golang
maintainers.

### The Tooling Vendor

The tooling vendor decided that this is **Not A Bug**. They’re updating their
documentation to reflect this:

> To clarify this for our users, we will be updating our documentation to
> reflect our recommendations to securely operate our tools, as well as
> explicitly highlighting that we do not support SSH Host Key checking at
> this time.

Other responses included that they got into console parsing (to extract
host-keys from those printed by `cloud-init` at startup) with a previous
product and it was too hard, so they don’t want to ever do it again, and that
the benefits of TOFU (Trust On First Use) for them are minimal. Also that the
exploitability of the trust paths is low.

To me, this is deeply concerning. They’re saying that people should securely
operate their tools, at the same time as making it hard to securely operate
their tools. They’re not warning people to not invoke the tools talking
across the open Internet. They’ve shown that they’re unaware of tools such as
`mitmproxy` which perform *exactly* this sort of attack, while purveying tools
designed to improve security and, oh yes, manage SSH keys on hosts too.

The only way to securely use such tools is to absolutely trust the network
between the machine invoking the tool and the resources being talked to. At
which point, why bother with cryptography at all?

Sure, TOFU doesn’t help if you *never* cache the results, so that *every*
use is effectively “*first*” use.
That’s not TOFU, that’s trust on every use. Unverified.
Further, when their tooling is creating resources and seeing them soon after
boot, they’re in a good position to see logged hostkeys. They can be
compatible-by-default with the most common tooling and decline to work without
override if people try to work without making those keys available for
verification.

The parsing is pretty easy to do with systems such as AWSÂ EC2, I’ve done it:
use `ec2:GetConsoleOutput`, look for the markers, extract the hostkeys between
them. This can be written in such a way as to be extensible to other output
formats. But it’s incredibly immature to decide “it’s too hard and too much
work, so we won’t bother and we’ll leave people vulnerable and tell them it’s
their fault if they use our tool in the way that most guides and documentation
suggests”.

So they could verify hostkey identity absolutely; with less work, they could
just get the usual TOFU semantics by caching the observed SSH hostkeys.
Instead, they have no verification and the tools are thus unfit to use when
they connect via SSH across the public Internet.

I used to respect this vendor and recommend their tools to others. I am
having to rethink this a lot. I am no longer happy to recommend Hashicorp
products to others.

### The Language Maintainers

I am bemused by an approach to accepting security reports which is to go
through the motions of having PGP public keys available for people to use to
report issues but upon receiving such a request ask for it to be submitted
without PGP because digging out the keys is too much of a hassle.

Mind, we are overdue for some nice convenient tooling to have a
PGP-decrypting-and-reencrypt-to-subscribers mailing-list software tool for use
for such public contact points. I can see the point, even as I face-palm at
the attitude and the cargo-cult approach to public contact points for security
reports.

(Thus last week was a little depressing for looking at the state of the
industry).

But things got much better after that.

[Golang issue 19767](https://golang.org/issue/19767 "x/crypto/ssh: make ClientConfig HostKeyCallback non-permissive by default") was filed; the Golang maintainers decided to go public
immediately. They decided to make a breaking change to their API, as they
allow themselves to do for packages in the `golang.org/x/` namespace.

They quickly fixed the library such that leaving the `HostKeyCallback` field
of client configs unset would result in all calls failing. They provided a
`InsecureIgnoreHostKey` function which could be explicitly assigned to get the
old behavior and `FixedHostKey` to verify against one key, then provided an
example function which comes closer to classic SSH behavior by providing a
simplistic parse of the `known_hosts` file (first match only, ignoring
algorithm in selection, etc) – it works.

Despite breaking changes being *allowed* here, they’re still discouraged and
fairly rare. They did take the opportunity to be very explicit in the package
documentation, adding:

> This package does not fall under the stability promise of the Go language
> itself, so its API may be changed when pressing needs arise.

### The Future

Every software package using [x/crypto/ssh](https://godoc.org/golang.org/x/crypto/ssh "package ssh") for implementing an SSH client
which is not already doing hostkey verification will need to be updated to
handle this.

Anyone who complains and says “this is why we need to vendor library
dependencies” should need to explain why it would be better for their product
to keep a security flaw in it and not be pressed to update. A bunch of Google
engineers recently volunteered a large amount of time and work to fixing a
similar issue which turned out to be vendored deeply into the Java ecosystem,
in the âMadÂ Gadgetâ vulnerability fix. Vendoring protects engineering time at
the expense of embedding vulnerabilities deeper and making it harder to fix
them all.

Anyone using SSH as a client in Golang who wants to keep being insecure will
need to explicitly mark it as such in their codebase and face public ridicule.

[`CVE-2017-3204`](http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-3204)

---

PS: I ran a Twitter poll about what most vendors would do, poll lasting one
week:

[![Poll results](/postimage/2017/twitter-golang-ssh-pollresults.png)](https://twitter.com/philpennock/status/849420403508432902)

Across 185 votes, only 27% felt that software vendors would actually fix the
security problems in their software.

Whether this cynicism is undue, or merely resigned realism, I leave to your
analysis. Fortunately, time will give us real answers: we can revisit this a
year from now and see what has changed.

---

PPS: [Follow-up post: Golang SSH Redux](/2017/04/golang-ssh-redux/)

Categories:
golang ssh identity CVE

[Â« Docking Compute](/2017/03/docking-compute/ "Previous post")
[Golang SSH Redux Â»](/2017/04/golang-ssh-redux/ "Next post")

#### Recent Posts

* [(Go)Hugo Generated Text File](/2024/02/hugo-generated-text-file/)
* [Configuration Objects](/2024/01/configuration-objects/)
* [Tailscale and Docker Remote](/2024/01/tailscale-docker-remote/)
* [Small Mailserver Best Current Practices](/2020/07/small-mailserver-bcp/)
* [Shell Locality](/2020/07/shell-locality/)

[![GitHub](/images/GitHub-Mark-32px.png "GitHub: philpennock")](https://github.com/philpennock)
[![Mastodon](/images/mastodon-32px.png "Mastodon: @philpennock@infosec.exchange")](https://infosec.exchange/%40philpennock)
[![LinkedIn](/images/InBug-30px-R.png "LinkedIn: philpennock")](https://www.linkedin.com/in/philpennock/)
[](https://people.spodhuis.org/phil.pennock/)

#### About

We're more than any labels, or our jobs, or our passions, but I offer
some labels which provide a glimpse.

British-American Unix systems programmer, system administrator,
Site Reliability Engineer, whatever the current in vogue term is.
Think of the stereotype and you have a decent first approximation,
beard (normally) and all.

ISP background, RFC-reading, protocol-loving but committees-loathing guy.
Security sometimes a bit of a strength, more often than it's a weakness.

PGP Key:
[`0x1DA3E68F41CEECAC`](https://www.security.spodhuis.org/PGP/keys/key2020-cv25519.asc)

I do have a sense of humor. It's often dry or quirky. Various expeditions
have so far failed to prove the existence of this alleged sense of humor,
but equally, they haven't *disproven* its existence, so I'm still in
the game.

#### Employer Disclaimer

This is my personal blog. The views expressed on these pages are mine alone
and I am not speaking on behalf of any employer, past or present. It is not
safe to infer that any such employer either agrees or disagrees with me. When
self-employed, I still don't agree with me.

[2024](#history-year-2024)
[Archives for 2024](/2024/)

* 2024-02:
  + [(Go)Hugo Generated Text File](/2024/02/hugo-generated-text-file/)
* 2024-01:
  + [Configuration Objects](/2024/01/configuration-objects/)
  + [Tailscale and Docker Remote](/2024/01/tailscale-docker-remote/)

[2020](#history-year-2020)
[Archives for 2020](/2020/)

* 2020-07:
  + [Small Mailserver Best Current Practices](/2020/07/small-mailserver-bcp/)
  + [Shell Locality](/2020/07/shell-locality/)

[2019](#history-year-2019)
[Archives for 2019](/2019/)

* 2019-12:
  + [Slack Tax](/2019/12/slack-tax/)

[2018](#history-year-2018)
[Archives for 2018](/2018/)

* 2018-07:
  + [Git Aliases & Shell](/2018/07/git-aliases-shell/)
* 2018-03:
  + [Alpine Linux on ARM (Turris Router)](/2018/03/alpine-arm/)

[2017](#history-year-2017)
[Archives for 2017](/2017/)

* 2017-11:
  + [boot2docker xhyve DNS](/2017/11/boot2docker-xhyve-dns/)
* 2017-04:
  + [Golang SSH Redux](/2017/04/golang-ssh-redux/)
  + [Golang SSH Security](/2017/04/golang-ssh-security/)
* 2017-03:
  + [Docking Compute](/2017/03/docking-compute/)
  + [OCSP Oops!](/2017/03/ocsp-oops/)
* 2017-02:
  + [Jitsi & Certificates](/2017/02/jitsi-certificates/)
  + [I'm Back](/2017/02/im-back/)

[All History](#history-all-link)
[All History](/history/)
[Visit Archives Page](/history/)

Page latest change ref: 3768d8a 2017-04-25
Copyright © 2010-2024 Phil Pennock. All Rights Reserved.



=== Content from godoc.org_e89137bf_20250124_164853.html ===


[![Go](/static/shared/logo/go-white.svg)](https://go.dev/)
 [Skip to Main Content](#main-content)

![](/static/shared/icon/search_gm_grey_24dp.svg)

![](/static/shared/icon/search_gm_grey_24dp.svg)

* Why Go
  ![submenu dropdown icon](/static/shared/icon/arrow_drop_down_gm_grey_24dp.svg)
  + [Case Studies](https://go.dev/solutions#case-studies)

    Common problems companies solve with Go
  + [Use Cases](https://go.dev/solutions#use-cases)

    Stories about how and why companies use Go
  + [Security Policy](https://go.dev/security/policy/)

    How Go can help keep you secure by default
* [Learn](https://go.dev/learn/)
* Docs
  ![submenu dropdown icon](/static/shared/icon/arrow_drop_down_gm_grey_24dp.svg)
  + [Effective Go](https://go.dev/doc/effective_go)

    Tips for writing clear, performant, and idiomatic Go code
  + [Go User Manual](https://go.dev/doc/)

    A complete introduction to building software with Go
  + [Standard library](https://pkg.go.dev/std)

    Reference documentation for Go's standard library
  + [Release Notes](https://go.dev/doc/devel/release)

    Learn what's new in each Go release
* [Packages](/)
* Community
  ![submenu dropdown icon](/static/shared/icon/arrow_drop_down_gm_grey_24dp.svg)
  + [Recorded Talks](https://go.dev/talks/)

    Videos from prior events
  + [Meetups
    *![](/static/shared/icon/launch_gm_grey_24dp.svg)*](https://www.meetup.com/pro/go)

    Meet other local Go developers
  + [Conferences
    *![](/static/shared/icon/launch_gm_grey_24dp.svg)*](https://github.com/golang/go/wiki/Conferences)

    Learn and network with Go developers from around the world
  + [Go blog](https://go.dev/blog)

    The Go project's official blog.
  + [Go project](https://go.dev/help)

    Get help and stay informed from Go
  + Get connected
    [![](/static/shared/logo/social/google-groups.svg)](https://groups.google.com/g/golang-nuts "Get connected with google-groups (Opens in new window)")
    [![](/static/shared/logo/social/github.svg)](https://github.com/golang "Get connected with github (Opens in new window)")
    [![](/static/shared/logo/social/twitter.svg)](https://twitter.com/golang "Get connected with twitter (Opens in new window)")
    [![](/static/shared/logo/social/reddit.svg)](https://www.reddit.com/r/golang/ "Get connected with reddit (Opens in new window)")
    [![](/static/shared/logo/social/slack.svg)](https://invite.slack.golangbridge.org/ "Get connected with slack (Opens in new window)")
    [![](/static/shared/logo/social/stack-overflow.svg)](https://stackoverflow.com/collectives/go)

[![Go.](/static/shared/logo/go-blue.svg)](https://go.dev/)

* Why Go
  *![](/static/shared/icon/navigate_next_gm_grey_24dp.svg)*
  *![](/static/shared/icon/navigate_before_gm_grey_24dp.svg)*
  Why Go
  + [Case Studies](https://go.dev/solutions#case-studies)
  + [Use Cases](https://go.dev/solutions#use-cases)
  + [Security Policy](https://go.dev/security/policy/)
* [Learn](https://go.dev/learn/)
* Docs
  *![](/static/shared/icon/navigate_next_gm_grey_24dp.svg)*
  *![](/static/shared/icon/navigate_before_gm_grey_24dp.svg)*
  Docs
  + [Effective Go](https://go.dev/doc/effective_go)
  + [Go User Manual](https://go.dev/doc/)
  + [Standard library](https://pkg.go.dev/std)
  + [Release Notes](https://go.dev/doc/devel/release)
* [Packages](/)
* Community
  *![](/static/shared/icon/navigate_next_gm_grey_24dp.svg)*
  *![](/static/shared/icon/navigate_before_gm_grey_24dp.svg)*
  Community
  + [Recorded Talks](https://go.dev/talks/)
  + [Meetups
    *![](/static/shared/icon/launch_gm_grey_24dp.svg)*](https://www.meetup.com/pro/go)
  + [Conferences
    *![](/static/shared/icon/launch_gm_grey_24dp.svg)*](https://github.com/golang/go/wiki/Conferences)
  + [Go blog](https://go.dev/blog)
  + [Go project](https://go.dev/help)
  + Get connected
    [![](/static/shared/logo/social/google-groups.svg)](https://groups.google.com/g/golang-nuts)
    [![](/static/shared/logo/social/github.svg)](https://github.com/golang)
    [![](/static/shared/logo/social/twitter.svg)](https://twitter.com/golang)
    [![](/static/shared/logo/social/reddit.svg)](https://www.reddit.com/r/golang/)
    [![](/static/shared/logo/social/slack.svg)](https://invite.slack.golangbridge.org/)
    [![](/static/shared/logo/social/stack-overflow.svg)](https://stackoverflow.com/collectives/go)

1. [Discover Packages](/)
2. [golang.org/x/crypto](/golang.org/x/crypto)
3. [ssh](/golang.org/x/crypto%40v0.32.0/ssh)
   ![](/static/shared/icon/content_copy_gm_grey_24dp.svg)

[![Go](/static/shared/logo/go-blue.svg)](https://go.dev/)
# ssh

package
![](/static/shared/icon/content_copy_gm_grey_24dp.svg)

[Version:
v0.32.0](?tab=versions)
Opens a new window with list of versions in this module.

Latest
Latest
![Warning](/static/shared/icon/alert_gm_grey_24dp.svg)

This package is not in the latest version of its module.

[Go to latest](/golang.org/x/crypto/ssh)

Published: Jan 6, 2025

License: [BSD-3-Clause](/golang.org/x/crypto/ssh?tab=licenses)

Opens a new window with license information.

[Imports: 47](/golang.org/x/crypto/ssh?tab=imports)

Opens a new window with list of imports.

[Imported by: 19,648](/golang.org/x/crypto/ssh?tab=importedby)

Opens a new window with list of known importers.

Main
Versions

Licenses

Imports

Imported By

## Details

* ![checked](/static/shared/icon/check_circle_gm_grey_24dp.svg)
  Valid [go.mod](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3A/go.mod) file
  ![](/static/shared/icon/help_gm_grey_24dp.svg)

  The Go module system was introduced in Go 1.11 and is the official dependency management
  solution for Go.
* ![checked](/static/shared/icon/check_circle_gm_grey_24dp.svg)
  Redistributable license
  ![](/static/shared/icon/help_gm_grey_24dp.svg)

  Redistributable licenses place minimal restrictions on how software can be used,
  modified, and redistributed.
* ![checked](/static/shared/icon/check_circle_gm_grey_24dp.svg)
  Tagged version
  ![](/static/shared/icon/help_gm_grey_24dp.svg)

  Modules with tagged versions give importers more predictable builds.
* ![unchecked](/static/shared/icon/cancel_gm_grey_24dp.svg)
  Stable version
  ![](/static/shared/icon/help_gm_grey_24dp.svg)

  When a project reaches major version v1 it is considered stable.
* [Learn more about best practices](/about#best-practices)

## Repository

[cs.opensource.google/go/x/crypto](https://cs.opensource.google/go/x/crypto "https://cs.opensource.google/go/x/crypto")
## Links

* [![](/static/shared/icon/security_grey_24dp.svg)
  Report a Vulnerability](https://go.dev/security/policy "Report security issues in the Go standard library and sub-repositories")
* [![Open Source Insights Logo](/static/shared/icon/depsdev-logo.svg)](https://deps.dev/go/golang.org/x/crypto/v0.32.0 "View this module on Open Source Insights")

Jump to ...

* [Documentation](#section-documentation)
  + [Overview](#pkg-overview)
  + [Index](#pkg-index)
    - [Examples](#pkg-examples)
  + [Constants](#pkg-constants)
  + [Variables](#pkg-variables)
  + [Functions](#pkg-functions)
    - [DiscardRequests(in)](#DiscardRequests "DiscardRequests(in)")
    - [FingerprintLegacyMD5(pubKey)](#FingerprintLegacyMD5 "FingerprintLegacyMD5(pubKey)")
    - [FingerprintSHA256(pubKey)](#FingerprintSHA256 "FingerprintSHA256(pubKey)")
    - [Marshal(msg)](#Marshal "Marshal(msg)")
    - [MarshalAuthorizedKey(key)](#MarshalAuthorizedKey "MarshalAuthorizedKey(key)")
    - [MarshalPrivateKey(key, comment)](#MarshalPrivateKey "MarshalPrivateKey(key, comment)")
    - [MarshalPrivateKeyWithPassphrase(key, comment, passphrase)](#MarshalPrivateKeyWithPassphrase "MarshalPrivateKeyWithPassphrase(key, comment, passphrase)")
    - [ParseDSAPrivateKey(der)](#ParseDSAPrivateKey "ParseDSAPrivateKey(der)")
    - [ParseRawPrivateKey(pemBytes)](#ParseRawPrivateKey "ParseRawPrivateKey(pemBytes)")
    - [ParseRawPrivateKeyWithPassphrase(pemBytes, passphrase)](#ParseRawPrivateKeyWithPassphrase "ParseRawPrivateKeyWithPassphrase(pemBytes, passphrase)")
    - [Unmarshal(data, out)](#Unmarshal "Unmarshal(data, out)")
  + [Types](#pkg-types)
    - [type AlgorithmSigner](#AlgorithmSigner "type AlgorithmSigner")
    - [type AuthMethod](#AuthMethod "type AuthMethod")
      * [GSSAPIWithMICAuthMethod(gssAPIClient, target)](#GSSAPIWithMICAuthMethod "GSSAPIWithMICAuthMethod(gssAPIClient, target)")
      * [KeyboardInteractive(challenge)](#KeyboardInteractive "KeyboardInteractive(challenge)")
      * [Password(secret)](#Password "Password(secret)")
      * [PasswordCallback(prompt)](#PasswordCallback "PasswordCallback(prompt)")
      * [PublicKeys(signers)](#PublicKeys "PublicKeys(signers)")
      * [PublicKeysCallback(getSigners)](#PublicKeysCallback "PublicKeysCallback(getSigners)")
      * [RetryableAuthMethod(auth, maxTries)](#RetryableAuthMethod "RetryableAuthMethod(auth, maxTries)")
    - [type BannerCallback](#BannerCallback "type BannerCallback")
      * [BannerDisplayStderr()](#BannerDisplayStderr "BannerDisplayStderr()")
    - [type BannerError](#BannerError "type BannerError")
      * [(b) Error()](#BannerError.Error "(b) Error()")
      * [(b) Unwrap()](#BannerError.Unwrap "(b) Unwrap()")
    - [type CertChecker](#CertChecker "type CertChecker")
      * [(c) Authenticate(conn, pubKey)](#CertChecker.Authenticate "(c) Authenticate(conn, pubKey)")
      * [(c) CheckCert(principal, cert)](#CertChecker.CheckCert "(c) CheckCert(principal, cert)")
      * [(c) CheckHostKey(addr, remote, key)](#CertChecker.CheckHostKey "(c) CheckHostKey(addr, remote, key)")
    - [type Certificate](#Certificate "type Certificate")
      * [(c) Marshal()](#Certificate.Marshal "(c) Marshal()")
      * [(c) SignCert(rand, authority)](#Certificate.SignCert "(c) SignCert(rand, authority)")
      * [(c) Type()](#Certificate.Type "(c) Type()")
      * [(c) Verify(data, sig)](#Certificate.Verify "(c) Verify(data, sig)")
    - [type Channel](#Channel "type Channel")
    - [type Client](#Client "type Client")
      * [Dial(network, addr, config)](#Dial "Dial(network, addr, config)")
      * [NewClient(c, chans, reqs)](#NewClient "NewClient(c, chans, reqs)")
      * [(c) Dial(n, addr)](#Client.Dial "(c) Dial(n, addr)")
      * [(c) DialContext(ctx, n, addr)](#Client.DialContext "(c) DialContext(ctx, n, addr)")
      * [(c) DialTCP(n, laddr, raddr)](#Client.DialTCP "(c) DialTCP(n, laddr, raddr)")
      * [(c) HandleChannelOpen(channelType)](#Client.HandleChannelOpen "(c) HandleChannelOpen(channelType)")
      * [(c) Listen(n, addr)](#Client.Listen "(c) Listen(n, addr)")
      * [(c) ListenTCP(laddr)](#Client.ListenTCP "(c) ListenTCP(laddr)")
      * [(c) ListenUnix(socketPath)](#Client.ListenUnix "(c) ListenUnix(socketPath)")
      * [(c) NewSession()](#Client.NewSession "(c) NewSession()")
    - [type ClientConfig](#ClientConfig "type ClientConfig")
    - [type Config](#Config "type Config")
      * [(c) SetDefaults()](#Config.SetDefaults "(c) SetDefaults()")
    - [type Conn](#Conn "type Conn")
      * [NewClientConn(c, addr, config)](#NewClientConn "NewClientConn(c, addr, config)")
    - [type ConnMetadata](#ConnMetadata "type ConnMetadata")
    - [type CryptoPublicKey](#CryptoPublicKey "type CryptoPublicKey")
    - [type ExitError](#ExitError "type ExitError")
      * [(e) Error()](#ExitError.Error "(e) Error()")
    - [type ExitMissingError](#ExitMissingError "type ExitMissingError")
      * [(e) Error()](#ExitMissingError.Error "(e) Error()")
    - [type GSSAPIClient](#GSSAPIClient "type GSSAPIClient")
    - [type GSSAPIServer](#GSSAPIServer "type GSSAPIServer")
    - [type GSSAPIWithMICConfig](#GSSAPIWithMICConfig "type GSSAPIWithMICConfig")
    - [type HostKeyCallback](#HostKeyCallback "type HostKeyCallback")
      * [FixedHostKey(key)](#FixedHostKey "FixedHostKey(key)")
      * [InsecureIgnoreHostKey()](#InsecureIgnoreHostKey "InsecureIgnoreHostKey()")
    - [type KeyboardInteractiveChallenge](#KeyboardInteractiveChallenge "type KeyboardInteractiveChallenge")
    - [type MultiAlgorithmSigner](#MultiAlgorithmSigner "type MultiAlgorithmSigner")
      * [NewSignerWithAlgorithms(signer, algorithms)](#NewSignerWithAlgorithms "NewSignerWithAlgorithms(signer, algorithms)")
    - [type NewChannel](#NewChannel "type NewChannel")
    - [type OpenChannelError](#OpenChannelError "type OpenChannelError")
      * [(e) Error()](#OpenChannelError.Error "(e) Error()")
    - [type PartialSuccessError](#PartialSuccessError "type PartialSuccessError")
      * [(p) Error()](#PartialSuccessError.Error "(p) Error()")
    - [type PassphraseMissingError](#PassphraseMissingError "type PassphraseMissingError")
      * [Error()](#PassphraseMissingError.Error "Error()")
    - [type Permissions](#Permissions "type Permissions")
    - [type PublicKey](#PublicKey "type PublicKey")
      * [NewPublicKey(key)](#NewPublicKey "NewPublicKey(key)")
      * [ParseAuthorizedKey(in)](#ParseAuthorizedKey "ParseAuthorizedKey(in)")
      * [ParseKnownHosts(in)](#ParseKnownHosts "ParseKnownHosts(in)")
      * [ParsePublicKey(in)](#ParsePublicKey "ParsePublicKey(in)")
    - [type RejectionReason](#RejectionReason "type RejectionReason")
      * [(r) String()](#RejectionReason.String "(r) String()")
    - [type Request](#Request "type Request")
      * [(r) Reply(ok, payload)](#Request.Reply "(r) Reply(ok, payload)")
    - [type ServerAuthCallbacks](#ServerAuthCallbacks "type ServerAuthCallbacks")
    - [type ServerAuthError](#ServerAuthError "type ServerAuthError")
      * [(l) Error()](#ServerAuthError.Error "(l) Error()")
    - [type ServerConfig](#ServerConfig "type ServerConfig")
      * [(s) AddHostKey(key)](#ServerConfig.AddHostKey "(s) AddHostKey(key)")
    - [type ServerConn](#ServerConn "type ServerConn")
      * [NewServerConn(c, config)](#NewServerConn "NewServerConn(c, config)")
    - [type Session](#Session "type Session")
      * [(s) Close()](#Session.Close "(s) Close()")
      * [(s) CombinedOutput(cmd)](#Session.CombinedOutput "(s) CombinedOutput(cmd)")
      * [(s) Output(cmd)](#Session.Output "(s) Output(cmd)")
      * [(s) RequestPty(term, h, w, termmodes)](#Session.RequestPty "(s) RequestPty(term, h, w, termmodes)")
      * [(s) RequestSubsystem(subsystem)](#Session.RequestSubsystem "(s) RequestSubsystem(subsystem)")
      * [(s) Run(cmd)](#Session.Run "(s) Run(cmd)")
      * [(s) SendRequest(name, wantReply, payload)](#Session.SendRequest "(s) SendRequest(name, wantReply, payload)")
      * [(s) Setenv(name, value)](#Session.Setenv "(s) Setenv(name, value)")
      * [(s) Shell()](#Session.Shell "(s) Shell()")
      * [(s) Signal(sig)](#Session.Signal "(s) Signal(sig)")
      * [(s) Start(cmd)](#Session.Start "(s) Start(cmd)")
      * [(s) StderrPipe()](#Session.StderrPipe "(s) StderrPipe()")
      * [(s) StdinPipe()](#Session.StdinPipe "(s) StdinPipe()")
      * [(s) StdoutPipe()](#Session.StdoutPipe "(s) StdoutPipe()")
      * [(s) Wait()](#Session.Wait "(s) Wait()")
      * [(s) WindowChange(h, w)](#Session.WindowChange "(s) WindowChange(h, w)")
    - [type Signal](#Signal "type Signal")
    - [type Signature](#Signature "type Signature")
    - [type Signer](#Signer "type Signer")
      * [NewCertSigner(cert, signer)](#NewCertSigner "NewCertSigner(cert, signer)")
      * [NewSignerFromKey(key)](#NewSignerFromKey "NewSignerFromKey(key)")
      * [NewSignerFromSigner(signer)](#NewSignerFromSigner "NewSignerFromSigner(signer)")
      * [ParsePrivateKey(pemBytes)](#ParsePrivateKey "ParsePrivateKey(pemBytes)")
      * [ParsePrivateKeyWithPassphrase(pemBytes, passphrase)](#ParsePrivateKeyWithPassphrase "ParsePrivateKeyWithPassphrase(pemBytes, passphrase)")
    - [type TerminalModes](#TerminalModes "type TerminalModes")
    - [type Waitmsg](#Waitmsg "type Waitmsg")
      * [(w) ExitStatus()](#Waitmsg.ExitStatus "(w) ExitStatus()")
      * [(w) Lang()](#Waitmsg.Lang "(w) Lang()")
      * [(w) Msg()](#Waitmsg.Msg "(w) Msg()")
      * [(w) Signal()](#Waitmsg.Signal "(w) Signal()")
      * [(w) String()](#Waitmsg.String "(w) String()")
* [Source Files](#section-sourcefiles)
* [Directories](#section-directories)

Documentation

## Documentation [¶](#section-documentation "Go to Documentation")

### Overview [¶](#pkg-overview "Go to Overview")

Package ssh implements an SSH client and server.

SSH is a transport security protocol, an authentication protocol and a
family of application protocols. The most typical application level
protocol is a remote shell and this is specifically implemented. However,
the multiplexed nature of SSH is exposed to users that wish to support
others.

References:

```
[PROTOCOL]: https://cvsweb.openbsd.org/cgi-bin/cvsweb/src/usr.bin/ssh/PROTOCOL?rev=HEAD
[PROTOCOL.certkeys]: http://cvsweb.openbsd.org/cgi-bin/cvsweb/src/usr.bin/ssh/PROTOCOL.certkeys?rev=HEAD
[SSH-PARAMETERS]:    http://www.iana.org/assignments/ssh-parameters/ssh-parameters.xml#ssh-parameters-1

```

This package does not fall under the stability promise of the Go language itself,
so its API may be changed when pressing needs arise.

### Index [¶](#pkg-index "Go to Index")

* [Constants](#pkg-constants)
* [Variables](#pkg-variables)
* [func DiscardRequests(in <-chan \*Request)](#DiscardRequests)
* [func FingerprintLegacyMD5(pubKey PublicKey) string](#FingerprintLegacyMD5)
* [func FingerprintSHA256(pubKey PublicKey) string](#FingerprintSHA256)
* [func Marshal(msg interface{}) []byte](#Marshal)
* [func MarshalAuthorizedKey(key PublicKey) []byte](#MarshalAuthorizedKey)
* [func MarshalPrivateKey(key crypto.PrivateKey, comment string) (\*pem.Block, error)](#MarshalPrivateKey)
* [func MarshalPrivateKeyWithPassphrase(key crypto.PrivateKey, comment string, passphrase []byte) (\*pem.Block, error)](#MarshalPrivateKeyWithPassphrase)
* [func ParseDSAPrivateKey(der []byte) (\*dsa.PrivateKey, error)](#ParseDSAPrivateKey)
* [func ParseRawPrivateKey(pemBytes []byte) (interface{}, error)](#ParseRawPrivateKey)
* [func ParseRawPrivateKeyWithPassphrase(pemBytes, passphrase []byte) (interface{}, error)](#ParseRawPrivateKeyWithPassphrase)
* [func Unmarshal(data []byte, out interface{}) error](#Unmarshal)
* [type AlgorithmSigner](#AlgorithmSigner)
* [type AuthMethod](#AuthMethod)
* + [func GSSAPIWithMICAuthMethod(gssAPIClient GSSAPIClient, target string) AuthMethod](#GSSAPIWithMICAuthMethod)
  + [func KeyboardInteractive(challenge KeyboardInteractiveChallenge) AuthMethod](#KeyboardInteractive)
  + [func Password(secret string) AuthMethod](#Password)
  + [func PasswordCallback(prompt func() (secret string, err error)) AuthMethod](#PasswordCallback)
  + [func PublicKeys(signers ...Signer) AuthMethod](#PublicKeys)
  + [func PublicKeysCallback(getSigners func() (signers []Signer, err error)) AuthMethod](#PublicKeysCallback)
  + [func RetryableAuthMethod(auth AuthMethod, maxTries int) AuthMethod](#RetryableAuthMethod)
* [type BannerCallback](#BannerCallback)
* + [func BannerDisplayStderr() BannerCallback](#BannerDisplayStderr)
* [type BannerError](#BannerError)
* + [func (b \*BannerError) Error() string](#BannerError.Error)
  + [func (b \*BannerError) Unwrap() error](#BannerError.Unwrap)
* [type CertChecker](#CertChecker)
* + [func (c \*CertChecker) Authenticate(conn ConnMetadata, pubKey PublicKey) (\*Permissions, error)](#CertChecker.Authenticate)
  + [func (c \*CertChecker) CheckCert(principal string, cert \*Certificate) error](#CertChecker.CheckCert)
  + [func (c \*CertChecker) CheckHostKey(addr string, remote net.Addr, key PublicKey) error](#CertChecker.CheckHostKey)
* [type Certificate](#Certificate)
* + [func (c \*Certificate) Marshal() []byte](#Certificate.Marshal)
  + [func (c \*Certificate) SignCert(rand io.Reader, authority Signer) error](#Certificate.SignCert)
  + [func (c \*Certificate) Type() string](#Certificate.Type)
  + [func (c \*Certificate) Verify(data []byte, sig \*Signature) error](#Certificate.Verify)
* [type Channel](#Channel)
* [type Client](#Client)
* + [func Dial(network, addr string, config \*ClientConfig) (\*Client, error)](#Dial)
  + [func NewClient(c Conn, chans <-chan NewChannel, reqs <-chan \*Request) \*Client](#NewClient)
* + [func (c \*Client) Dial(n, addr string) (net.Conn, error)](#Client.Dial)
  + [func (c \*Client) DialContext(ctx context.Context, n, addr string) (net.Conn, error)](#Client.DialContext)
  + [func (c \*Client) DialTCP(n string, laddr, raddr \*net.TCPAddr) (net.Conn, error)](#Client.DialTCP)
  + [func (c \*Client) HandleChannelOpen(channelType string) <-chan NewChannel](#Client.HandleChannelOpen)
  + [func (c \*Client) Listen(n, addr string) (net.Listener, error)](#Client.Listen)
  + [func (c \*Client) ListenTCP(laddr \*net.TCPAddr) (net.Listener, error)](#Client.ListenTCP)
  + [func (c \*Client) ListenUnix(socketPath string) (net.Listener, error)](#Client.ListenUnix)
  + [func (c \*Client) NewSession() (\*Session, error)](#Client.NewSession)
* [type ClientConfig](#ClientConfig)
* [type Config](#Config)
* + [func (c \*Config) SetDefaults()](#Config.SetDefaults)
* [type Conn](#Conn)
* + [func NewClientConn(c net.Conn, addr string, config \*ClientConfig) (Conn, <-chan NewChannel, <-chan \*Request, error)](#NewClientConn)
* [type ConnMetadata](#ConnMetadata)
* [type CryptoPublicKey](#CryptoPublicKey)
* [type ExitError](#ExitError)
* + [func (e \*ExitError) Error() string](#ExitError.Error)
* [type ExitMissingError](#ExitMissingError)
* + [func (e \*ExitMissingError) Error() string](#ExitMissingError.Error)
* [type GSSAPIClient](#GSSAPIClient)
* [type GSSAPIServer](#GSSAPIServer)
* [type GSSAPIWithMICConfig](#GSSAPIWithMICConfig)
* [type HostKeyCallback](#HostKeyCallback)
* + [func FixedHostKey(key PublicKey) HostKeyCallback](#FixedHostKey)
  + [func InsecureIgnoreHostKey() HostKeyCallback](#InsecureIgnoreHostKey)
* [type KeyboardInteractiveChallenge](#KeyboardInteractiveChallenge)
* [type MultiAlgorithmSigner](#MultiAlgorithmSigner)
* + [func NewSignerWithAlgorithms(signer AlgorithmSigner, algorithms []string) (MultiAlgorithmSigner, error)](#NewSignerWithAlgorithms)
* [type NewChannel](#NewChannel)
* [type OpenChannelError](#OpenChannelError)
* + [func (e \*OpenChannelError) Error() string](#OpenChannelError.Error)
* [type PartialSuccessError](#PartialSuccessError)
* + [func (p \*PartialSuccessError) Error() string](#PartialSuccessError.Error)
* [type PassphraseMissingError](#PassphraseMissingError)
* + [func (\*PassphraseMissingError) Error() string](#PassphraseMissingError.Error)
* [type Permissions](#Permissions)
* [type PublicKey](#PublicKey)
* + [func NewPublicKey(key interface{}) (PublicKey, error)](#NewPublicKey)
  + [func ParseAuthorizedKey(in []byte) (out PublicKey, comment string, options []string, rest []byte, err error)](#ParseAuthorizedKey)
  + [func ParseKnownHosts(in []byte) (marker string, hosts []string, pubKey PublicKey, comment string, rest []byte, ...)](#ParseKnownHosts)
  + [func ParsePublicKey(in []byte) (out PublicKey, err error)](#ParsePublicKey)
* [type RejectionReason](#RejectionReason)
* + [func (r RejectionReason) String() string](#RejectionReason.String)
* [type Request](#Request)
* + [func (r \*Request) Reply(ok bool, payload []byte) error](#Request.Reply)
* [type ServerAuthCallbacks](#ServerAuthCallbacks)
* [type ServerAuthError](#ServerAuthError)
* + [func (l ServerAuthError) Error() string](#ServerAuthError.Error)
* [type ServerConfig](#ServerConfig)
* + [func (s \*ServerConfig) AddHostKey(key Signer)](#ServerConfig.AddHostKey)
* [type ServerConn](#ServerConn)
* + [func NewServerConn(c net.Conn, config \*ServerConfig) (\*ServerConn, <-chan NewChannel, <-chan \*Request, error)](#NewServerConn)
* [type Session](#Session)
* + [func (s \*Session) Close() error](#Session.Close)
  + [func (s \*Session) CombinedOutput(cmd string) ([]byte, error)](#Session.CombinedOutput)
  + [func (s \*Session) Output(cmd string) ([]byte, error)](#Session.Output)
  + [func (s \*Session) RequestPty(term string, h, w int, termmodes TerminalModes) error](#Session.RequestPty)
  + [func (s \*Session) RequestSubsystem(subsystem string) error](#Session.RequestSubsystem)
  + [func (s \*Session) Run(cmd string) error](#Session.Run)
  + [func (s \*Session) SendRequest(name string, wantReply bool, payload []byte) (bool, error)](#Session.SendRequest)
  + [func (s \*Session) Setenv(name, value string) error](#Session.Setenv)
  + [func (s \*Session) Shell() error](#Session.Shell)
  + [func (s \*Session) Signal(sig Signal) error](#Session.Signal)
  + [func (s \*Session) Start(cmd string) error](#Session.Start)
  + [func (s \*Session) StderrPipe() (io.Reader, error)](#Session.StderrPipe)
  + [func (s \*Session) StdinPipe() (io.WriteCloser, error)](#Session.StdinPipe)
  + [func (s \*Session) StdoutPipe() (io.Reader, error)](#Session.StdoutPipe)
  + [func (s \*Session) Wait() error](#Session.Wait)
  + [func (s \*Session) WindowChange(h, w int) error](#Session.WindowChange)
* [type Signal](#Signal)
* [type Signature](#Signature)
* [type Signer](#Signer)
* + [func NewCertSigner(cert \*Certificate, signer Signer) (Signer, error)](#NewCertSigner)
  + [func NewSignerFromKey(key interface{}) (Signer, error)](#NewSignerFromKey)
  + [func NewSignerFromSigner(signer crypto.Signer) (Signer, error)](#NewSignerFromSigner)
  + [func ParsePrivateKey(pemBytes []byte) (Signer, error)](#ParsePrivateKey)
  + [func ParsePrivateKeyWithPassphrase(pemBytes, passphrase []byte) (Signer, error)](#ParsePrivateKeyWithPassphrase)
* [type TerminalModes](#TerminalModes)
* [type Waitmsg](#Waitmsg)
* + [func (w Waitmsg) ExitStatus() int](#Waitmsg.ExitStatus)
  + [func (w Waitmsg) Lang() string](#Waitmsg.Lang)
  + [func (w Waitmsg) Msg() string](#Waitmsg.Msg)
  + [func (w Waitmsg) Signal() string](#Waitmsg.Signal)
  + [func (w Waitmsg) String() string](#Waitmsg.String)
#### Examples [¶](#pkg-examples "Go to Examples")

* [Certificate.SignCert](#example-Certificate.SignCert)
* [Client.Listen](#example-Client.Listen)
* [Dial](#example-Dial)
* [NewServerConn](#example-NewServerConn)
* [PublicKeys](#example-PublicKeys)
* [RetryableAuthMethod](#example-RetryableAuthMethod)
* [ServerConfig.AddHostKey](#example-ServerConfig.AddHostKey)
* [Session.RequestPty](#example-Session.RequestPty)
### Constants [¶](#pkg-constants "Go to Constants")

[View Source](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/certs.go;l=22)
```
const (
	CertAlgoRSAv01        = "ssh-rsa-cert-v01@openssh.com"
	CertAlgoDSAv01        = "ssh-dss-cert-v01@openssh.com"
	CertAlgoECDSA256v01   = "ecdsa-sha2-nistp256-cert-v01@openssh.com"
	CertAlgoECDSA384v01   = "ecdsa-sha2-nistp384-cert-v01@openssh.com"
	CertAlgoECDSA521v01   = "ecdsa-sha2-nistp521-cert-v01@openssh.com"
	CertAlgoSKECDSA256v01 = "sk-ecdsa-sha2-nistp256-cert-v01@openssh.com"
	CertAlgoED25519v01    = "ssh-ed25519-cert-v01@openssh.com"
	CertAlgoSKED25519v01  = "sk-ssh-ed25519-cert-v01@openssh.com"

	// CertAlgoRSASHA256v01 and CertAlgoRSASHA512v01 can't appear as a
	// Certificate.Type (or PublicKey.Type), but only in
	// ClientConfig.HostKeyAlgorithms.
	CertAlgoRSASHA256v01 = "rsa-sha2-256-cert-v01@openssh.com"
	CertAlgoRSASHA512v01 = "rsa-sha2-512-cert-v01@openssh.com"
)
```

Certificate algorithm names from [PROTOCOL.certkeys]. These values can appear
in Certificate.Type, PublicKey.Type, and ClientConfig.HostKeyAlgorithms.
Unlike key algorithm names, these are not passed to AlgorithmSigner nor
returned by MultiAlgorithmSigner and don't appear in the Signature.Format
field.

[View Source](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/certs.go;l=39)
```
const (
	// Deprecated: use CertAlgoRSAv01.
	CertSigAlgoRSAv01 = [CertAlgoRSAv01](#CertAlgoRSAv01)
	// Deprecated: use CertAlgoRSASHA256v01.
	CertSigAlgoRSASHA2256v01 = [CertAlgoRSASHA256v01](#CertAlgoRSASHA256v01)
	// Deprecated: use CertAlgoRSASHA512v01.
	CertSigAlgoRSASHA2512v01 = [CertAlgoRSASHA512v01](#CertAlgoRSASHA512v01)
)
```

[View Source](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/certs.go;l=51)
```
const (
	UserCert = 1
	HostCert = 2
)
```

Certificate types distinguish between host and user
certificates. The values can be set in the CertType field of
Certificate.

[View Source](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/keys.go;l=38)
```
const (
	KeyAlgoRSA        = "ssh-rsa"
	KeyAlgoDSA        = "ssh-dss"
	KeyAlgoECDSA256   = "ecdsa-sha2-nistp256"
	KeyAlgoSKECDSA256 = "sk-ecdsa-sha2-nistp256@openssh.com"
	KeyAlgoECDSA384   = "ecdsa-sha2-nistp384"
	KeyAlgoECDSA521   = "ecdsa-sha2-nistp521"
	KeyAlgoED25519    = "ssh-ed25519"
	KeyAlgoSKED25519  = "sk-ssh-ed25519@openssh.com"

	// KeyAlgoRSASHA256 and KeyAlgoRSASHA512 are only public key algorithms, not
	// public key formats, so they can't appear as a PublicKey.Type. The
	// corresponding PublicKey.Type is KeyAlgoRSA. See [RFC 8332, Section 2](https://rfc-editor.org/rfc/rfc8332.html#section-2).
	KeyAlgoRSASHA256 = "rsa-sha2-256"
	KeyAlgoRSASHA512 = "rsa-sha2-512"
)
```

Public key algorithms names. These values can appear in PublicKey.Type,
ClientConfig.HostKeyAlgorithms, Signature.Format, or as AlgorithmSigner
arguments.

[View Source](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/keys.go;l=55)
```
const (
	// Deprecated: use KeyAlgoRSA.
	SigAlgoRSA = [KeyAlgoRSA](#KeyAlgoRSA)
	// Deprecated: use KeyAlgoRSASHA256.
	SigAlgoRSASHA2256 = [KeyAlgoRSASHA256](#KeyAlgoRSASHA256)
	// Deprecated: use KeyAlgoRSASHA512.
	SigAlgoRSASHA2512 = [KeyAlgoRSASHA512](#KeyAlgoRSASHA512)
)
```

[View Source](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=55)
```
const (
	VINTR         = 1
	VQUIT         = 2
	VERASE        = 3
	VKILL         = 4
	VEOF          = 5
	VEOL          = 6
	VEOL2         = 7
	VSTART        = 8
	VSTOP         = 9
	VSUSP         = 10
	VDSUSP        = 11
	VREPRINT      = 12
	VWERASE       = 13
	VLNEXT        = 14
	VFLUSH        = 15
	VSWTCH        = 16
	VSTATUS       = 17
	VDISCARD      = 18
	IGNPAR        = 30
	PARMRK        = 31
	INPCK         = 32
	ISTRIP        = 33
	INLCR         = 34
	IGNCR         = 35
	ICRNL         = 36
	IUCLC         = 37
	IXON          = 38
	IXANY         = 39
	IXOFF         = 40
	IMAXBEL       = 41
	IUTF8         = 42 // [RFC 8160](https://rfc-editor.org/rfc/rfc8160.html)
	ISIG          = 50
	ICANON        = 51
	XCASE         = 52
	ECHO          = 53
	ECHOE         = 54
	ECHOK         = 55
	ECHONL        = 56
	NOFLSH        = 57
	TOSTOP        = 58
	IEXTEN        = 59
	ECHOCTL       = 60
	ECHOKE        = 61
	PENDIN        = 62
	OPOST         = 70
	OLCUC         = 71
	ONLCR         = 72
	OCRNL         = 73
	ONOCR         = 74
	ONLRET        = 75
	CS7           = 90
	CS8           = 91
	PARENB        = 92
	PARODD        = 93
	TTY_OP_ISPEED = 128
	TTY_OP_OSPEED = 129
)
```

POSIX terminal mode flags as listed in [RFC 4254 Section 8](https://rfc-editor.org/rfc/rfc4254.html#section-8).

[View Source](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/certs.go;l=65)
```
const CertTimeInfinity = 1<<64 - 1
```

CertTimeInfinity can be used for OpenSSHCertV01.ValidBefore to indicate that
a certificate does not expire.

### Variables [¶](#pkg-variables "Go to Variables")

[View Source](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/server.go;l=470)
```
var ErrNoAuth = [errors](/errors).[New](/errors#New)("ssh: no auth passed yet")
```

ErrNoAuth is the error value returned if no
authentication method has been passed yet. This happens as a normal
part of the authentication loop, since the client first tries
'none' authentication to discover available methods.
It is returned in ServerAuthError.Errors from NewServerConn.

### Functions [¶](#pkg-functions "Go to Functions")

#### func [DiscardRequests](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/connection.go;l=79) [¶](#DiscardRequests "Go to DiscardRequests")

```
func DiscardRequests(in <-chan *[Request](#Request))
```

DiscardRequests consumes and rejects all requests from the
passed-in channel.

#### func [FingerprintLegacyMD5](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/keys.go;l=1760) [¶](#FingerprintLegacyMD5 "Go to FingerprintLegacyMD5")

```
func FingerprintLegacyMD5(pubKey [PublicKey](#PublicKey)) [string](/builtin#string)
```

FingerprintLegacyMD5 returns the user presentation of the key's
fingerprint as described by [RFC 4716 section 4](https://rfc-editor.org/rfc/rfc4716.html#section-4).

#### func [FingerprintSHA256](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/keys.go;l=1774) [¶](#FingerprintSHA256 "Go to FingerprintSHA256")

```
func FingerprintSHA256(pubKey [PublicKey](#PublicKey)) [string](/builtin#string)
```

FingerprintSHA256 returns the user presentation of the key's
fingerprint as unpadded base64 encoded sha256 hash.
This format was introduced from OpenSSH 6.8.
<https://www.openssh.com/txt/release-6.8>
<https://tools.ietf.org/html/rfc4648#section-3.2> (unpadded base64 encoding)

#### func [Marshal](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/messages.go;l=519) [¶](#Marshal "Go to Marshal")

```
func Marshal(msg interface{}) [][byte](/builtin#byte)
```

Marshal serializes the message in msg to SSH wire format. The msg
argument should be a struct or pointer to struct. If the first
member has the "sshtype" tag set to a number in decimal, that
number is prepended to the result. If the last of member has the
"ssh" tag set to "rest", its contents are appended to the output.

#### func [MarshalAuthorizedKey](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/keys.go;l=289) [¶](#MarshalAuthorizedKey "Go to MarshalAuthorizedKey")

```
func MarshalAuthorizedKey(key [PublicKey](#PublicKey)) [][byte](/builtin#byte)
```

MarshalAuthorizedKey serializes key for inclusion in an OpenSSH
authorized\_keys file. The return value ends with newline.

#### func [MarshalPrivateKey](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/keys.go;l=302) [¶](#MarshalPrivateKey "Go to MarshalPrivateKey") added in v0.14.0

```
func MarshalPrivateKey(key [crypto](/crypto).[PrivateKey](/crypto#PrivateKey), comment [string](/builtin#string)) (*[pem](/encoding/pem).[Block](/encoding/pem#Block), [error](/builtin#error))
```

MarshalPrivateKey returns a PEM block with the private key serialized in the
OpenSSH format.

#### func [MarshalPrivateKeyWithPassphrase](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/keys.go;l=308) [¶](#MarshalPrivateKeyWithPassphrase "Go to MarshalPrivateKeyWithPassphrase") added in v0.14.0

```
func MarshalPrivateKeyWithPassphrase(key [crypto](/crypto).[PrivateKey](/crypto#PrivateKey), comment [string](/builtin#string), passphrase [][byte](/builtin#byte)) (*[pem](/encoding/pem).[Block](/encoding/pem#Block), [error](/builtin#error))
```

MarshalPrivateKeyWithPassphrase returns a PEM block holding the encrypted
private key serialized in the OpenSSH format.

#### func [ParseDSAPrivateKey](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/keys.go;l=1310) [¶](#ParseDSAPrivateKey "Go to ParseDSAPrivateKey")

```
func ParseDSAPrivateKey(der [][byte](/builtin#byte)) (*[dsa](/crypto/dsa).[PrivateKey](/crypto/dsa#PrivateKey), [error](/builtin#error))
```

ParseDSAPrivateKey returns a DSA private key from its ASN.1 DER encoding, as
specified by the OpenSSL DSA man page.

#### func [ParseRawPrivateKey](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/keys.go;l=1233) [¶](#ParseRawPrivateKey "Go to ParseRawPrivateKey")

```
func ParseRawPrivateKey(pemBytes [][byte](/builtin#byte)) (interface{}, [error](/builtin#error))
```

ParseRawPrivateKey returns a private key from a PEM encoded private key. It supports
RSA, DSA, ECDSA, and Ed25519 private keys in PKCS#1, PKCS#8, OpenSSL, and OpenSSH
formats. If the private key is encrypted, it will return a PassphraseMissingError.

#### func [ParseRawPrivateKeyWithPassphrase](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/keys.go;l=1263) [¶](#ParseRawPrivateKeyWithPassphrase "Go to ParseRawPrivateKeyWithPassphrase")

```
func ParseRawPrivateKeyWithPassphrase(pemBytes, passphrase [][byte](/builtin#byte)) (interface{}, [error](/builtin#error))
```

ParseRawPrivateKeyWithPassphrase returns a private key decrypted with
passphrase from a PEM encoded private key. If the passphrase is wrong, it
will return x509.IncorrectPasswordError.

#### func [Unmarshal](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/messages.go;l=396) [¶](#Unmarshal "Go to Unmarshal")

```
func Unmarshal(data [][byte](/builtin#byte), out interface{}) [error](/builtin#error)
```

Unmarshal parses data in SSH wire format into a structure. The out
argument should be a pointer to struct. If the first member of the
struct has the "sshtype" tag set to a '|'-separated set of numbers
in decimal, the packet must start with one of those numbers. In
case of error, Unmarshal returns a ParseError or
UnexpectedMessageError.

### Types [¶](#pkg-types "Go to Types")

#### type [AlgorithmSigner](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/keys.go;l=356) [¶](#AlgorithmSigner "Go to AlgorithmSigner")

```
type AlgorithmSigner interface {
	[Signer](#Signer)

	// SignWithAlgorithm is like Signer.Sign, but allows specifying a desired
	// signing algorithm. Callers may pass an empty string for the algorithm in
	// which case the AlgorithmSigner will use a default algorithm. This default
	// doesn't currently control any behavior in this package.
	SignWithAlgorithm(rand [io](/io).[Reader](/io#Reader), data [][byte](/builtin#byte), algorithm [string](/builtin#string)) (*[Signature](#Signature), [error](/builtin#error))
}
```

An AlgorithmSigner is a Signer that also supports specifying an algorithm to
use for signing.

An AlgorithmSigner can't advertise the algorithms it supports, unless it also
implements MultiAlgorithmSigner, so it should be prepared to be invoked with
every algorithm supported by the public key format.

#### type [AuthMethod](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/client_auth.go;l=130) [¶](#AuthMethod "Go to AuthMethod")

```
type AuthMethod interface {
	// contains filtered or unexported methods
}
```

An AuthMethod represents an instance of an [RFC 4252](https://rfc-editor.org/rfc/rfc4252.html) authentication method.

#### func [GSSAPIWithMICAuthMethod](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/client_auth.go;l=688) [¶](#GSSAPIWithMICAuthMethod "Go to GSSAPIWithMICAuthMethod")

```
func GSSAPIWithMICAuthMethod(gssAPIClient [GSSAPIClient](#GSSAPIClient), target [string](/builtin#string)) [AuthMethod](#AuthMethod)
```

GSSAPIWithMICAuthMethod is an AuthMethod with "gssapi-with-mic" authentication.
See [RFC 4462 section 3](https://rfc-editor.org/rfc/rfc4462.html#section-3)
gssAPIClient is implementation of the GSSAPIClient interface, see the definition of the interface for details.
target is the server host you want to log in to.

#### func [KeyboardInteractive](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/client_auth.go;l=532) [¶](#KeyboardInteractive "Go to KeyboardInteractive")

```
func KeyboardInteractive(challenge [KeyboardInteractiveChallenge](#KeyboardInteractiveChallenge)) [AuthMethod](#AuthMethod)
```

KeyboardInteractive returns an AuthMethod using a prompt/response
sequence controlled by the server.

#### func [Password](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/client_auth.go;l=200) [¶](#Password "Go to Password")

```
func Password(secret [string](/builtin#string)) [AuthMethod](#AuthMethod)
```

Password returns an AuthMethod using the given password.

#### func [PasswordCallback](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/client_auth.go;l=206) [¶](#PasswordCallback "Go to PasswordCallback")

```
func PasswordCallback(prompt func() (secret [string](/builtin#string), err [error](/builtin#error))) [AuthMethod](#AuthMethod)
```

PasswordCallback returns an AuthMethod that uses a callback for
fetching a password.

#### func [PublicKeys](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/client_auth.go;l=454) [¶](#PublicKeys "Go to PublicKeys")

```
func PublicKeys(signers ...[Signer](#Signer)) [AuthMethod](#AuthMethod)
```

PublicKeys returns an AuthMethod that uses the given key
pairs.

Example [¶](#example-PublicKeys "Go to Example")
```

package main

import (
	"log"
	"os"

	"golang.org/x/crypto/ssh"
)

func main() {
	var hostKey ssh.PublicKey
	// A public key may be used to authenticate against the remote
	// server by using an unencrypted PEM-encoded private key file.
	//
	// If you have an encrypted private key, the crypto/x509 package
	// can be used to decrypt it.
	key, err := os.ReadFile("/home/user/.ssh/id_rsa")
	if err != nil {
		log.Fatalf("unable to read private key: %v", err)
	}

	// Create the Signer for this private key.
	signer, err := ssh.ParsePrivateKey(key)
	if err != nil {
		log.Fatalf("unable to parse private key: %v", err)
	}

	config := &ssh.ClientConfig{
		User: "user",
		Auth: []ssh.AuthMethod{
			// Use the PublicKeys method for remote authentication.
			ssh.PublicKeys(signer),
		},
		HostKeyCallback: ssh.FixedHostKey(hostKey),
	}

	// Connect to the remote server and perform the SSH handshake.
	client, err := ssh.Dial("tcp", "host.com:22", config)
	if err != nil {
		log.Fatalf("unable to connect: %v", err)
	}
	defer client.Close()
}

```
```
Output:

```

Share
Format
Run

#### func [PublicKeysCallback](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/client_auth.go;l=460) [¶](#PublicKeysCallback "Go to PublicKeysCallback")

```
func PublicKeysCallback(getSigners func() (signers [][Signer](#Signer), err [error](/builtin#error))) [AuthMethod](#AuthMethod)
```

PublicKeysCallback returns an AuthMethod that runs the given
function to obtain a list of key pairs.

#### func [RetryableAuthMethod](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/client_auth.go;l=680) [¶](#RetryableAuthMethod "Go to RetryableAuthMethod")

```
func RetryableAuthMethod(auth [AuthMethod](#AuthMethod), maxTries [int](/builtin#int)) [AuthMethod](#AuthMethod)
```

RetryableAuthMethod is a decorator for other auth methods enabling them to
be retried up to maxTries before considering that AuthMethod itself failed.
If maxTries is <= 0, will retry indefinitely

This is useful for interactive clients using challenge/response type
authentication (e.g. Keyboard-Interactive, Password, etc) where the user
could mistype their response resulting in the server issuing a
SSH\_MSG\_USERAUTH\_FAILURE (rfc4252 #8 [password] and rfc4256 #3.4
[keyboard-interactive]); Without this decorator, the non-retryable
AuthMethod would be removed from future consideration, and never tried again
(and so the user would never be able to retry their entry).

Example [¶](#example-RetryableAuthMethod "Go to Example")
```

user := "testuser"
NumberOfPrompts := 3

// Normally this would be a callback that prompts the user to answer the
// provided questions
Cb := func(user, instruction string, questions []string, echos []bool) (answers []string, err error) {
	return []string{"answer1", "answer2"}, nil
}

config := &ClientConfig{
	HostKeyCallback: InsecureIgnoreHostKey(),
	User:            user,
	Auth: []AuthMethod{
		RetryableAuthMethod(KeyboardInteractiveChallenge(Cb), NumberOfPrompts),
	},
}

host := "mysshserver"
netConn, err := net.Dial("tcp", host)
if err != nil {
	log.Fatal(err)
}

sshConn, _, _, err := NewClientConn(netConn, host, config)
if err != nil {
	log.Fatal(err)
}
_ = sshConn

```
```
Output:

```

#### type [BannerCallback](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/client.go;l=197) [¶](#BannerCallback "Go to BannerCallback")

```
type BannerCallback func(message [string](/builtin#string)) [error](/builtin#error)
```

BannerCallback is the function type used for treat the banner sent by
the server. A BannerCallback receives the message sent by the remote server.

#### func [BannerDisplayStderr](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/client.go;l=276) [¶](#BannerDisplayStderr "Go to BannerDisplayStderr")

```
func BannerDisplayStderr() [BannerCallback](#BannerCallback)
```

BannerDisplayStderr returns a function that can be used for
ClientConfig.BannerCallback to display banners on os.Stderr.

#### type [BannerError](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/server.go;l=474) [¶](#BannerError "Go to BannerError") added in v0.24.0

```
type BannerError struct {
	Err     [error](/builtin#error)
	Message [string](/builtin#string)
}
```

BannerError is an error that can be returned by authentication handlers in
ServerConfig to send a banner message to the client.

#### func (\*BannerError) [Error](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/server.go;l=483) [¶](#BannerError.Error "Go to BannerError.Error") added in v0.24.0

```
func (b *[BannerError](#BannerError)) Error() [string](/builtin#string)
```

#### func (\*BannerError) [Unwrap](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/server.go;l=479) [¶](#BannerError.Unwrap "Go to BannerError.Unwrap") added in v0.24.0

```
func (b *[BannerError](#BannerError)) Unwrap() [error](/builtin#error)
```

#### type [CertChecker](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/certs.go;l=292) [¶](#CertChecker "Go to CertChecker")

```
type CertChecker struct {
	// SupportedCriticalOptions lists the CriticalOptions that the
	// server application layer understands. These are only used
	// for user certificates.
	SupportedCriticalOptions [][string](/builtin#string)

	// IsUserAuthority should return true if the key is recognized as an
	// authority for the given user certificate. This allows for
	// certificates to be signed by other certificates. This must be set
	// if this CertChecker will be checking user certificates.
	IsUserAuthority func(auth [PublicKey](#PublicKey)) [bool](/builtin#bool)

	// IsHostAuthority should report whether the key is recognized as
	// an authority for this host. This allows for certificates to be
	// signed by other keys, and for those other keys to only be valid
	// signers for particular hostnames. This must be set if this
	// CertChecker will be checking host certificates.
	IsHostAuthority func(auth [PublicKey](#PublicKey), address [string](/builtin#string)) [bool](/builtin#bool)

	// Clock is used for verifying time stamps. If nil, time.Now
	// is used.
	Clock func() [time](/time).[Time](/time#Time)

	// UserKeyFallback is called when CertChecker.Authenticate encounters a
	// public key that is not a certificate. It must implement validation
	// of user keys or else, if nil, all such keys are rejected.
	UserKeyFallback func(conn [ConnMetadata](#ConnMetadata), key [PublicKey](#PublicKey)) (*[Permissions](#Permissions), [error](/builtin#error))

	// HostKeyFallback is called when CertChecker.CheckHostKey encounters a
	// public key that is not a certificate. It must implement host key
	// validation or else, if nil, all such keys are rejected.
	HostKeyFallback [HostKeyCallback](#HostKeyCallback)

	// IsRevoked is called for each certificate so that revocation checking
	// can be implemented. It should return true if the given certificate
	// is revoked and false otherwise. If nil, no certificates are
	// considered to have been revoked.
	IsRevoked func(cert *[Certificate](#Certificate)) [bool](/builtin#bool)
}
```

CertChecker does the work of verifying a certificate. Its methods
can be plugged into ClientConfig.HostKeyCallback and
ServerConfig.PublicKeyCallback. For the CertChecker to work,
minimally, the IsAuthority callback should be set.

#### func (\*CertChecker) [Authenticate](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/certs.go;l=360) [¶](#CertChecker.Authenticate "Go to CertChecker.Authenticate")

```
func (c *[CertChecker](#CertChecker)) Authenticate(conn [ConnMetadata](#ConnMetadata), pubKey [PublicKey](#PublicKey)) (*[Permissions](#Permissions), [error](/builtin#error))
```

Authenticate checks a user certificate. Authenticate can be used as
a value for ServerConfig.PublicKeyCallback.

#### func (\*CertChecker) [CheckCert](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/certs.go;l=385) [¶](#CertChecker.CheckCert "Go to CertChecker.CheckCert")

```
func (c *[CertChecker](#CertChecker)) CheckCert(principal [string](/builtin#string), cert *[Certificate](#Certificate)) [error](/builtin#error)
```

CheckCert checks CriticalOptions, ValidPrincipals, revocation, timestamp and
the signature of the certificate.

#### func (\*CertChecker) [CheckHostKey](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/certs.go;l=334) [¶](#CertChecker.CheckHostKey "Go to CertChecker.CheckHostKey")

```
func (c *[CertChecker](#CertChecker)) CheckHostKey(addr [string](/builtin#string), remote [net](/net).[Addr](/net#Addr), key [PublicKey](#PublicKey)) [error](/builtin#error)
```

CheckHostKey checks a host key certificate. This method can be
plugged into ClientConfig.HostKeyCallback.

#### type [Certificate](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/certs.go;l=71) [¶](#Certificate "Go to Certificate")

```
type Certificate struct {
	Nonce           [][byte](/builtin#byte)
	Key             [PublicKey](#PublicKey)
	Serial          [uint64](/builtin#uint64)
	CertType        [uint32](/builtin#uint32)
	KeyId           [string](/builtin#string)
	ValidPrincipals [][string](/builtin#string)
	ValidAfter      [uint64](/builtin#uint64)
	ValidBefore     [uint64](/builtin#uint64)
	[Permissions](#Permissions)
	Reserved     [][byte](/builtin#byte)
	SignatureKey [PublicKey](#PublicKey)
	Signature    *[Signature](#Signature)
}
```

An Certificate represents an OpenSSH certificate as defined in
[PROTOCOL.certkeys]?rev=1.8. The Certificate type implements the
PublicKey interface, so it can be unmarshaled using
ParsePublicKey.

#### func (\*Certificate) [Marshal](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/certs.go;l=531) [¶](#Certificate.Marshal "Go to Certificate.Marshal")

```
func (c *[Certificate](#Certificate)) Marshal() [][byte](/builtin#byte)
```

Marshal serializes c into OpenSSH's wire format. It is part of the
PublicKey interface.

#### func (\*Certificate) [SignCert](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/certs.go;l=446) [¶](#Certificate.SignCert "Go to Certificate.SignCert")

```
func (c *[Certificate](#Certificate)) SignCert(rand [io](/io).[Reader](/io#Reader), authority [Signer](#Signer)) [error](/builtin#error)
```

SignCert signs the certificate with an authority, setting the Nonce,
SignatureKey, and Signature fields. If the authority implements the
MultiAlgorithmSigner interface the first algorithm in the list is used. This
is useful if you want to sign with a specific algorithm.

Example [¶](#example-Certificate.SignCert "Go to Example")
```

package main

import (
	"crypto/rand"
	"crypto/rsa"
	"fmt"
	"log"

	"golang.org/x/crypto/ssh"
)

func main() {
	// Sign a certificate with a specific algorithm.
	privateKey, err := rsa.GenerateKey(rand.Reader, 3072)
	if err != nil {
		log.Fatal("unable to generate RSA key: ", err)
	}
	publicKey, err := ssh.NewPublicKey(&privateKey.PublicKey)
	if err != nil {
		log.Fatal("unable to get RSA public key: ", err)
	}
	caKey, err := rsa.GenerateKey(rand.Reader, 3072)
	if err != nil {
		log.Fatal("unable to generate CA key: ", err)
	}
	signer, err := ssh.NewSignerFromKey(caKey)
	if err != nil {
		log.Fatal("unable to generate signer from key: ", err)
	}
	mas, err := ssh.NewSignerWithAlgorithms(signer.(ssh.AlgorithmSigner), []string{ssh.KeyAlgoRSASHA256})
	if err != nil {
		log.Fatal("unable to create signer with algorithms: ", err)
	}
	certificate := ssh.Certificate{
		Key:      publicKey,
		CertType: ssh.UserCert,
	}
	if err := certificate.SignCert(rand.Reader, mas); err != nil {
		log.Fatal("unable to sign certificate: ", err)
	}
	// Save the public key to a file and check that rsa-sha-256 is used for
	// signing:
	// ssh-keygen -L -f <path to the file>
	fmt.Println(string(ssh.MarshalAuthorizedKey(&certificate)))
}

```
```
Output:

```

Share
Format
Run

#### func (\*Certificate) [Type](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/certs.go;l=563) [¶](#Certificate.Type "Go to Certificate.Type")

```
func (c *[Certificate](#Certificate)) Type() [string](/builtin#string)
```

Type returns the certificate algorithm name. It is part of the PublicKey interface.

#### func (\*Certificate) [Verify](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/certs.go;l=573) [¶](#Certificate.Verify "Go to Certificate.Verify")

```
func (c *[Certificate](#Certificate)) Verify(data [][byte](/builtin#byte), sig *[Signature](#Signature)) [error](/builtin#error)
```

Verify verifies a signature against the certificate's public
key. It is part of the PublicKey interface.

#### type [Channel](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/channel.go;l=49) [¶](#Channel "Go to Channel")

```
type Channel interface {
	// Read reads up to len(data) bytes from the channel.
	Read(data [][byte](/builtin#byte)) ([int](/builtin#int), [error](/builtin#error))

	// Write writes len(data) bytes to the channel.
	Write(data [][byte](/builtin#byte)) ([int](/builtin#int), [error](/builtin#error))

	// Close signals end of channel use. No data may be sent after this
	// call.
	Close() [error](/builtin#error)

	// CloseWrite signals the end of sending in-band
	// data. Requests may still be sent, and the other side may
	// still send data
	CloseWrite() [error](/builtin#error)

	// SendRequest sends a channel request.  If wantReply is true,
	// it will wait for a reply and return the result as a
	// boolean, otherwise the return value will be false. Channel
	// requests are out-of-band messages so they may be sent even
	// if the data stream is closed or blocked by flow control.
	// If the channel is closed before a reply is returned, io.EOF
	// is returned.
	SendRequest(name [string](/builtin#string), wantReply [bool](/builtin#bool), payload [][byte](/builtin#byte)) ([bool](/builtin#bool), [error](/builtin#error))

	// Stderr returns an io.ReadWriter that writes to this channel
	// with the extended data type set to stderr. Stderr may
	// safely be read and written from a different goroutine than
	// Read and Write respectively.
	Stderr() [io](/io).[ReadWriter](/io#ReadWriter)
}
```

A Channel is an ordered, reliable, flow-controlled, duplex stream
that is multiplexed over an SSH connection.

#### type [Client](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/client.go;l=19) [¶](#Client "Go to Client")

```
type Client struct {
	[Conn](#Conn)
	// contains filtered or unexported fields
}
```

Client implements a traditional SSH client that supports shells,
subprocesses, TCP port/streamlocal forwarding and tunneled dialing.

#### func [Dial](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/client.go;l=176) [¶](#Dial "Go to Dial")

```
func Dial(network, addr [string](/builtin#string), config *[ClientConfig](#ClientConfig)) (*[Client](#Client), [error](/builtin#error))
```

Dial starts a client connection to the given SSH server. It is a
convenience function that connects to the given network address,
initiates the SSH handshake, and then sets up a Client. For access
to incoming channels and requests, use net.Dial with NewClientConn
instead.

Example [¶](#example-Dial "Go to Example")
```

package main

import (
	"bytes"
	"fmt"
	"log"

	"golang.org/x/crypto/ssh"
)

func main() {
	var hostKey ssh.PublicKey
	// An SSH client is represented with a ClientConn.
	//
	// To authenticate with the remote server you must pass at least one
	// implementation of AuthMethod via the Auth field in ClientConfig,
	// and provide a HostKeyCallback.
	config := &ssh.ClientConfig{
		User: "username",
		Auth: []ssh.AuthMethod{
			ssh.Password("yourpassword"),
		},
		HostKeyCallback: ssh.FixedHostKey(hostKey),
	}
	client, err := ssh.Dial("tcp", "yourserver.com:22", config)
	if err != nil {
		log.Fatal("Failed to dial: ", err)
	}
	defer client.Close()

	// Each ClientConn can support multiple interactive sessions,
	// represented by a Session.
	session, err := client.NewSession()
	if err != nil {
		log.Fatal("Failed to create session: ", err)
	}
	defer session.Close()

	// Once a Session is created, you can execute a single command on
	// the remote side using the Run method.
	var b bytes.Buffer
	session.Stdout = &b
	if err := session.Run("/usr/bin/whoami"); err != nil {
		log.Fatal("Failed to run: " + err.Error())
	}
	fmt.Println(b.String())
}

```
```
Output:

```

Share
Format
Run

#### func [NewClient](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/client.go;l=53) [¶](#NewClient "Go to NewClient")

```
func NewClient(c [Conn](#Conn), chans <-chan [NewChannel](#NewChannel), reqs <-chan *[Request](#Request)) *[Client](#Client)
```

NewClient creates a Client on top of the given connection.

#### func (\*Client) [Dial](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/tcpip.go;l=372) [¶](#Client.Dial "Go to Client.Dial")

```
func (c *[Client](#Client)) Dial(n, addr [string](/builtin#string)) ([net](/net).[Conn](/net#Conn), [error](/builtin#error))
```

Dial initiates a connection to the addr from the remote host.
The resulting connection has a zero LocalAddr() and RemoteAddr().

#### func (\*Client) [DialContext](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/tcpip.go;l=343) [¶](#Client.DialContext "Go to Client.DialContext") added in v0.16.0

```
func (c *[Client](#Client)) DialContext(ctx [context](/context).[Context](/context#Context), n, addr [string](/builtin#string)) ([net](/net).[Conn](/net#Conn), [error](/builtin#error))
```

DialContext initiates a connection to the addr from the remote host.

The provided Context must be non-nil. If the context expires before the
connection is complete, an error is returned. Once successfully connected,
any expiration of the context will not affect the connection.

See func Dial for additional information.

#### func (\*Client) [DialTCP](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/tcpip.go;l=424) [¶](#Client.DialTCP "Go to Client.DialTCP")

```
func (c *[Client](#Client)) DialTCP(n [string](/builtin#string), laddr, raddr *[net](/net).[TCPAddr](/net#TCPAddr)) ([net](/net).[Conn](/net#Conn), [error](/builtin#error))
```

DialTCP connects to the remote address raddr on the network net,
which must be "tcp", "tcp4", or "tcp6". If laddr is not nil, it is used
as the local address for the connection.

#### func (\*Client) [HandleChannelOpen](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/client.go;l=32) [¶](#Client.HandleChannelOpen "Go to Client.HandleChannelOpen")

```
func (c *[Client](#Client)) HandleChannelOpen(channelType [string](/builtin#string)) <-chan [NewChannel](#NewChannel)
```

HandleChannelOpen returns a channel on which NewChannel requests
for the given type are sent. If the type already is being handled,
nil is returned. The channel is closed when the connection is closed.

#### func (\*Client) [Listen](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/tcpip.go;l=25) [¶](#Client.Listen "Go to Client.Listen")

```
func (c *[Client](#Client)) Listen(n, addr [string](/builtin#string)) ([net](/net).[Listener](/net#Listener), [error](/builtin#error))
```

Listen requests the remote peer open a listening socket on
addr. Incoming connections will be available by calling Accept on
the returned net.Listener. The listener must be serviced, or the
SSH connection may hang.
N must be "tcp", "tcp4", "tcp6", or "unix".

Example [¶](#example-Client.Listen "Go to Example")
```

package main

import (
	"fmt"
	"log"
	"net/http"

	"golang.org/x/crypto/ssh"
)

func main() {
	var hostKey ssh.PublicKey
	config := &ssh.ClientConfig{
		User: "username",
		Auth: []ssh.AuthMethod{
			ssh.Password("password"),
		},
		HostKeyCallback: ssh.FixedHostKey(hostKey),
	}
	// Dial your ssh server.
	conn, err := ssh.Dial("tcp", "localhost:22", config)
	if err != nil {
		log.Fatal("unable to connect: ", err)
	}
	defer conn.Close()

	// Request the remote side to open port 8080 on all interfaces.
	l, err := conn.Listen("tcp", "0.0.0.0:8080")
	if err != nil {
		log.Fatal("unable to register tcp forward: ", err)
	}
	defer l.Close()

	// Serve HTTP with your SSH server acting as a reverse proxy.
	http.Serve(l, http.HandlerFunc(func(resp http.ResponseWriter, req *http.Request) {
		fmt.Fprintf(resp, "Hello world!\n")
	}))
}

```
```
Output:

```

Share
Format
Run

#### func (\*Client) [ListenTCP](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/tcpip.go;l=105) [¶](#Client.ListenTCP "Go to Client.ListenTCP")

```
func (c *[Client](#Client)) ListenTCP(laddr *[net](/net).[TCPAddr](/net#TCPAddr)) ([net](/net).[Listener](/net#Listener), [error](/builtin#error))
```

ListenTCP requests the remote peer open a listening socket
on laddr. Incoming connections will be available by calling
Accept on the returned net.Listener.

#### func (\*Client) [ListenUnix](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/streamlocal.go;l=34) [¶](#Client.ListenUnix "Go to Client.ListenUnix")

```
func (c *[Client](#Client)) ListenUnix(socketPath [string](/builtin#string)) ([net](/net).[Listener](/net#Listener), [error](/builtin#error))
```

ListenUnix is similar to ListenTCP but uses a Unix domain socket.

#### func (\*Client) [NewSession](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/client.go;l=133) [¶](#Client.NewSession "Go to Client.NewSession")

```
func (c *[Client](#Client)) NewSession() (*[Session](#Session), [error](/builtin#error))
```

NewSession opens a new Session for this client. (A session is a remote
execution of a program.)

#### type [ClientConfig](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/client.go;l=201) [¶](#ClientConfig "Go to ClientConfig")

```
type ClientConfig struct {
	// Config contains configuration that is shared between clients and
	// servers.
	[Config](#Config)

	// User contains the username to authenticate as.
	User [string](/builtin#string)

	// Auth contains possible authentication methods to use with the
	// server. Only the first instance of a particular [RFC 4252](https://rfc-editor.org/rfc/rfc4252.html) method will
	// be used during authentication.
	Auth [][AuthMethod](#AuthMethod)

	// HostKeyCallback is called during the cryptographic
	// handshake to validate the server's host key. The client
	// configuration must supply this callback for the connection
	// to succeed. The functions InsecureIgnoreHostKey or
	// FixedHostKey can be used for simplistic host key checks.
	HostKeyCallback [HostKeyCallback](#HostKeyCallback)

	// BannerCallback is called during the SSH dance to display a custom
	// server's message. The client configuration can supply this callback to
	// handle it as wished. The function BannerDisplayStderr can be used for
	// simplistic display on Stderr.
	BannerCallback [BannerCallback](#BannerCallback)

	// ClientVersion contains the version identification string that will
	// be used for the connection. If empty, a reasonable default is used.
	ClientVersion [string](/builtin#string)

	// HostKeyAlgorithms lists the public key algorithms that the client will
	// accept from the server for host key authentication, in order of
	// preference. If empty, a reasonable default is used. Any
	// string returned from a PublicKey.Type method may be used, or
	// any of the CertAlgo and KeyAlgo constants.
	HostKeyAlgorithms [][string](/builtin#string)

	// Timeout is the maximum amount of time for the TCP connection to establish.
	//
	// A Timeout of zero means no timeout.
	Timeout [time](/time).[Duration](/time#Duration)
}
```

A ClientConfig structure is used to configure a Client. It must not be
modified after having been passed to an SSH function.

#### type [Config](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/common.go;l=268) [¶](#Config "Go to Config")

```
type Config struct {
	// Rand provides the source of entropy for cryptographic
	// primitives. If Rand is nil, the cryptographic random reader
	// in package crypto/rand will be used.
	Rand [io](/io).[Reader](/io#Reader)

	// The maximum number of bytes sent or received after which a
	// new key is negotiated. It must be at least 256. If
	// unspecified, a size suitable for the chosen cipher is used.
	RekeyThreshold [uint64](/builtin#uint64)

	// The allowed key exchanges algorithms. If unspecified then a default set
	// of algorithms is used. Unsupported values are silently ignored.
	KeyExchanges [][string](/builtin#string)

	// The allowed cipher algorithms. If unspecified then a sensible default is
	// used. Unsupported values are silently ignored.
	Ciphers [][string](/builtin#string)

	// The allowed MAC algorithms. If unspecified then a sensible default is
	// used. Unsupported values are silently ignored.
	MACs [][string](/builtin#string)
}
```

Config contains configuration data common to both ServerConfig and
ClientConfig.

#### func (\*Config) [SetDefaults](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/common.go;l=295) [¶](#Config.SetDefaults "Go to Config.SetDefaults")

```
func (c *[Config](#Config)) SetDefaults()
```

SetDefaults sets sensible values for unset fields in config. This is
exported for testing: Configs passed to SSH functions are copied and have
default values set automatically.

#### type [Conn](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/connection.go;l=50) [¶](#Conn "Go to Conn")

```
type Conn interface {
	[ConnMetadata](#ConnMetadata)

	// SendRequest sends a global request, and returns the
	// reply. If wantReply is true, it returns the response status
	// and payload. See also [RFC 4254, section 4](https://rfc-editor.org/rfc/rfc4254.html#section-4).
	SendRequest(name [string](/builtin#string), wantReply [bool](/builtin#bool), payload [][byte](/builtin#byte)) ([bool](/builtin#bool), [][byte](/builtin#byte), [error](/builtin#error))

	// OpenChannel tries to open an channel. If the request is
	// rejected, it returns *OpenChannelError. On success it returns
	// the SSH Channel and a Go channel for incoming, out-of-band
	// requests. The Go channel must be serviced, or the
	// connection will hang.
	OpenChannel(name [string](/builtin#string), data [][byte](/builtin#byte)) ([Channel](#Channel), <-chan *[Request](#Request), [error](/builtin#error))

	// Close closes the underlying network connection
	Close() [error](/builtin#error)

	// Wait blocks until the connection has shut down, and returns the
	// error causing the shutdown.
	Wait() [error](/builtin#error)
}
```

Conn represents an SSH connection for both server and client roles.
Conn is the basis for implementing an application layer, such
as ClientConn, which implements the traditional shell access for
clients.

#### func [NewClientConn](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/client.go;l=71) [¶](#NewClientConn "Go to NewClientConn")

```
func NewClientConn(c [net](/net).[Conn](/net#Conn), addr [string](/builtin#string), config *[ClientConfig](#ClientConfig)) ([Conn](#Conn), <-chan [NewChannel](#NewChannel), <-chan *[Request](#Request), [error](/builtin#error))
```

NewClientConn establishes an authenticated SSH connection using c
as the underlying transport. The Request and NewChannel channels
must be serviced or the connection will hang.

#### type [ConnMetadata](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/connection.go;l=24) [¶](#ConnMetadata "Go to ConnMetadata")

```
type ConnMetadata interface {
	// User returns the user ID for this connection.
	User() [string](/builtin#string)

	// SessionID returns the session hash, also denoted by H.
	SessionID() [][byte](/builtin#byte)

	// ClientVersion returns the client's version string as hashed
	// into the session ID.
	ClientVersion() [][byte](/builtin#byte)

	// ServerVersion returns the server's version string as hashed
	// into the session ID.
	ServerVersion() [][byte](/builtin#byte)

	// RemoteAddr returns the remote address for this connection.
	RemoteAddr() [net](/net).[Addr](/net#Addr)

	// LocalAddr returns the local address for this connection.
	LocalAddr() [net](/net).[Addr](/net#Addr)
}
```

ConnMetadata holds metadata for the connection.

#### type [CryptoPublicKey](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/keys.go;l=332) [¶](#CryptoPublicKey "Go to CryptoPublicKey")

```
type CryptoPublicKey interface {
	CryptoPublicKey() [crypto](/crypto).[PublicKey](/crypto#PublicKey)
}
```

CryptoPublicKey, if implemented by a PublicKey,
returns the underlying crypto.PublicKey form of the key.

#### type [ExitError](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=600) [¶](#ExitError "Go to ExitError")

```
type ExitError struct {
	[Waitmsg](#Waitmsg)
}
```

An ExitError reports unsuccessful completion of a remote command.

#### func (\*ExitError) [Error](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=604) [¶](#ExitError.Error "Go to ExitError.Error")

```
func (e *[ExitError](#ExitError)) Error() [string](/builtin#string)
```

#### type [ExitMissingError](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=473) [¶](#ExitMissingError "Go to ExitMissingError")

```
type ExitMissingError struct{}
```

ExitMissingError is returned if a session is torn down cleanly, but
the server sends no confirmation of the exit status.

#### func (\*ExitMissingError) [Error](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=475) [¶](#ExitMissingError.Error "Go to ExitMissingError.Error")

```
func (e *[ExitMissingError](#ExitMissingError)) Error() [string](/builtin#string)
```

#### type [GSSAPIClient](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/ssh_gss.go;l=19) [¶](#GSSAPIClient "Go to GSSAPIClient")

```
type GSSAPIClient interface {
	// InitSecContext initiates the establishment of a security context for GSS-API between the
	// ssh client and ssh server. Initially the token parameter should be specified as nil.
	// The routine may return a outputToken which should be transferred to
	// the ssh server, where the ssh server will present it to
	// AcceptSecContext. If no token need be sent, InitSecContext will indicate this by setting
	// needContinue to false. To complete the context
	// establishment, one or more reply tokens may be required from the ssh
	// server;if so, InitSecContext will return a needContinue which is true.
	// In this case, InitSecContext should be called again when the
	// reply token is received from the ssh server, passing the reply
	// token to InitSecContext via the token parameters.
	// See [RFC 2743 section 2.2.1](https://rfc-editor.org/rfc/rfc2743.html#section-2.2.1) and [RFC 4462 section 3.4](https://rfc-editor.org/rfc/rfc4462.html#section-3.4).
	InitSecContext(target [string](/builtin#string), token [][byte](/builtin#byte), isGSSDelegCreds [bool](/builtin#bool)) (outputToken [][byte](/builtin#byte), needContinue [bool](/builtin#bool), err [error](/builtin#error))
	// GetMIC generates a cryptographic MIC for the SSH2 message, and places
	// the MIC in a token for transfer to the ssh server.
	// The contents of the MIC field are obtained by calling GSS_GetMIC()
	// over the following, using the GSS-API context that was just
	// established:
	//  string    session identifier
	//  byte      SSH_MSG_USERAUTH_REQUEST
	//  string    user name
	//  string    service
	//  string    "gssapi-with-mic"
	// See [RFC 2743 section 2.3.1](https://rfc-editor.org/rfc/rfc2743.html#section-2.3.1) and [RFC 4462](https://rfc-editor.org/rfc/rfc4462.html) 3.5.
	GetMIC(micFiled [][byte](/builtin#byte)) ([][byte](/builtin#byte), [error](/builtin#error))
	// Whenever possible, it should be possible for
	// DeleteSecContext() calls to be successfully processed even
	// if other calls cannot succeed, thereby enabling context-related
	// resources to be released.
	// In addition to deleting established security contexts,
	// gss_delete_sec_context must also be able to delete "half-built"
	// security contexts resulting from an incomplete sequence of
	// InitSecContext()/AcceptSecContext() calls.
	// See [RFC 2743 section 2.2.3](https://rfc-editor.org/rfc/rfc2743.html#section-2.2.3).
	DeleteSecContext() [error](/builtin#error)
}
```

GSSAPIClient provides the API to plug-in GSSAPI authentication for client logins.

#### type [GSSAPIServer](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/ssh_gss.go;l=58) [¶](#GSSAPIServer "Go to GSSAPIServer")

```
type GSSAPIServer interface {
	// AcceptSecContext allows a remotely initiated security context between the application
	// and a remote peer to be established by the ssh client. The routine may return a
	// outputToken which should be transferred to the ssh client,
	// where the ssh client will present it to InitSecContext.
	// If no token need be sent, AcceptSecContext will indicate this
	// by setting the needContinue to false. To
	// complete the context establishment, one or more reply tokens may be
	// required from the ssh client. if so, AcceptSecContext
	// will return a needContinue which is true, in which case it
	// should be called again when the reply token is received from the ssh
	// client, passing the token to AcceptSecContext via the
	// token parameters.
	// The srcName return value is the authenticated username.
	// See [RFC 2743 section 2.2.2](https://rfc-editor.org/rfc/rfc2743.html#section-2.2.2) and [RFC 4462 section 3.4](https://rfc-editor.org/rfc/rfc4462.html#section-3.4).
	AcceptSecContext(token [][byte](/builtin#byte)) (outputToken [][byte](/builtin#byte), srcName [string](/builtin#string), needContinue [bool](/builtin#bool), err [error](/builtin#error))
	// VerifyMIC verifies that a cryptographic MIC, contained in the token parameter,
	// fits the supplied message is received from the ssh client.
	// See [RFC 2743 section 2.3.2](https://rfc-editor.org/rfc/rfc2743.html#section-2.3.2).
	VerifyMIC(micField [][byte](/builtin#byte), micToken [][byte](/builtin#byte)) [error](/builtin#error)
	// Whenever possible, it should be possible for
	// DeleteSecContext() calls to be successfully processed even
	// if other calls cannot succeed, thereby enabling context-related
	// resources to be released.
	// In addition to deleting established security contexts,
	// gss_delete_sec_context must also be able to delete "half-built"
	// security contexts resulting from an incomplete sequence of
	// InitSecContext()/AcceptSecContext() calls.
	// See [RFC 2743 section 2.2.3](https://rfc-editor.org/rfc/rfc2743.html#section-2.2.3).
	DeleteSecContext() [error](/builtin#error)
}
```

GSSAPIServer provides the API to plug in GSSAPI authentication for server logins.

#### type [GSSAPIWithMICConfig](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/server.go;l=48) [¶](#GSSAPIWithMICConfig "Go to GSSAPIWithMICConfig")

```
type GSSAPIWithMICConfig struct {
	// AllowLogin, must be set, is called when gssapi-with-mic
	// authentication is selected ([RFC 4462 section 3](https://rfc-editor.org/rfc/rfc4462.html#section-3)). The srcName is from the
	// results of the GSS-API authentication. The format is username@DOMAIN.
	// GSSAPI just guarantees to the server who the user is, but not if they can log in, and with what permissions.
	// This callback is called after the user identity is established with GSSAPI to decide if the user can login with
	// which permissions. If the user is allowed to login, it should return a nil error.
	AllowLogin func(conn [ConnMetadata](#ConnMetadata), srcName [string](/builtin#string)) (*[Permissions](#Permissions), [error](/builtin#error))

	// Server must be set. It's the implementation
	// of the GSSAPIServer interface. See GSSAPIServer interface for details.
	Server [GSSAPIServer](#GSSAPIServer)
}
```

#### type [HostKeyCallback](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/client.go;l=193) [¶](#HostKeyCallback "Go to HostKeyCallback")

```
type HostKeyCallback func(hostname [string](/builtin#string), remote [net](/net).[Addr](/net#Addr), key [PublicKey](#PublicKey)) [error](/builtin#error)
```

HostKeyCallback is the function type used for verifying server
keys. A HostKeyCallback must return nil if the host key is OK, or
an error to reject it. It receives the hostname as passed to Dial
or NewClientConn. The remote address is the RemoteAddr of the
net.Conn underlying the SSH connection.

#### func [FixedHostKey](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/client.go;l=269) [¶](#FixedHostKey "Go to FixedHostKey")

```
func FixedHostKey(key [PublicKey](#PublicKey)) [HostKeyCallback](#HostKeyCallback)
```

FixedHostKey returns a function for use in
ClientConfig.HostKeyCallback to accept only a specific host key.

#### func [InsecureIgnoreHostKey](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/client.go;l=247) [¶](#InsecureIgnoreHostKey "Go to InsecureIgnoreHostKey")

```
func InsecureIgnoreHostKey() [HostKeyCallback](#HostKeyCallback)
```

InsecureIgnoreHostKey returns a function that can be used for
ClientConfig.HostKeyCallback to accept any host key. It should
not be used for production code.

#### type [KeyboardInteractiveChallenge](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/client_auth.go;l=528) [¶](#KeyboardInteractiveChallenge "Go to KeyboardInteractiveChallenge")

```
type KeyboardInteractiveChallenge func(name, instruction [string](/builtin#string), questions [][string](/builtin#string), echos [][bool](/builtin#bool)) (answers [][string](/builtin#string), err [error](/builtin#error))
```

KeyboardInteractiveChallenge should print questions, optionally
disabling echoing (e.g. for passwords), and return all the answers.
Challenge may be called multiple times in a single session. After
successful authentication, the server may send a challenge with no
questions, for which the name and instruction messages should be
printed. [RFC 4256 section 3.3](https://rfc-editor.org/rfc/rfc4256.html#section-3.3) details how the UI should behave for
both CLI and GUI environments.

#### type [MultiAlgorithmSigner](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/keys.go;l=368) [¶](#MultiAlgorithmSigner "Go to MultiAlgorithmSigner") added in v0.14.0

```
type MultiAlgorithmSigner interface {
	[AlgorithmSigner](#AlgorithmSigner)

	// Algorithms returns the available algorithms in preference order. The list
	// must not be empty, and it must not include certificate types.
	Algorithms() [][string](/builtin#string)
}
```

MultiAlgorithmSigner is an AlgorithmSigner that also reports the algorithms
supported by that signer.

#### func [NewSignerWithAlgorithms](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/keys.go;l=380) [¶](#NewSignerWithAlgorithms "Go to NewSignerWithAlgorithms") added in v0.14.0

```
func NewSignerWithAlgorithms(signer [AlgorithmSigner](#AlgorithmSigner), algorithms [][string](/builtin#string)) ([MultiAlgorithmSigner](#MultiAlgorithmSigner), [error](/builtin#error))
```

NewSignerWithAlgorithms returns a signer restricted to the specified
algorithms. The algorithms must be set in preference order. The list must not
be empty, and it must not include certificate types. An error is returned if
the specified algorithms are incompatible with the public key type.

#### type [NewChannel](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/channel.go;l=28) [¶](#NewChannel "Go to NewChannel")

```
type NewChannel interface {
	// Accept accepts the channel creation request. It returns the Channel
	// and a Go channel containing SSH requests. The Go channel must be
	// serviced otherwise the Channel will hang.
	Accept() ([Channel](#Channel), <-chan *[Request](#Request), [error](/builtin#error))

	// Reject rejects the channel creation request. After calling
	// this, no other methods on the Channel may be called.
	Reject(reason [RejectionReason](#RejectionReason), message [string](/builtin#string)) [error](/builtin#error)

	// ChannelType returns the type of the channel, as supplied by the
	// client.
	ChannelType() [string](/builtin#string)

	// ExtraData returns the arbitrary payload for this channel, as supplied
	// by the client. This data is specific to the channel type.
	ExtraData() [][byte](/builtin#byte)
}
```

NewChannel represents an incoming request to a channel. It must either be
accepted for use by calling Accept, or rejected by calling Reject.

#### type [OpenChannelError](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/connection.go;l=14) [¶](#OpenChannelError "Go to OpenChannelError")

```
type OpenChannelError struct {
	Reason  [RejectionReason](#RejectionReason)
	Message [string](/builtin#string)
}
```

OpenChannelError is returned if the other side rejects an
OpenChannel request.

#### func (\*OpenChannelError) [Error](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/connection.go;l=19) [¶](#OpenChannelError.Error "Go to OpenChannelError.Error")

```
func (e *[OpenChannelError](#OpenChannelError)) Error() [string](/builtin#string)
```

#### type [PartialSuccessError](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/server.go;l=454) [¶](#PartialSuccessError "Go to PartialSuccessError") added in v0.22.0

```
type PartialSuccessError struct {
	// Next defines the authentication callbacks to apply to further steps. The
	// available methods communicated to the client are based on the non-nil
	// ServerAuthCallbacks fields.
	Next [ServerAuthCallbacks](#ServerAuthCallbacks)
}
```

PartialSuccessError can be returned by any of the [ServerConfig](#ServerConfig)
authentication callbacks to indicate to the client that authentication has
partially succeeded, but further steps are required.

#### func (\*PartialSuccessError) [Error](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/server.go;l=461) [¶](#PartialSuccessError.Error "Go to PartialSuccessError.Error") added in v0.22.0

```
func (p *[PartialSuccessError](#PartialSuccessError)) Error() [string](/builtin#string)
```

#### type [PassphraseMissingError](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/keys.go;l=1220) [¶](#PassphraseMissingError "Go to PassphraseMissingError")

```
type PassphraseMissingError struct {
	// PublicKey will be set if the private key format includes an unencrypted
	// public key along with the encrypted private key.
	PublicKey [PublicKey](#PublicKey)
}
```

A PassphraseMissingError indicates that parsing this private key requires a
passphrase. Use ParsePrivateKeyWithPassphrase.

#### func (\*PassphraseMissingError) [Error](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/keys.go;l=1226) [¶](#PassphraseMissingError.Error "Go to PassphraseMissingError.Error")

```
func (*[PassphraseMissingError](#PassphraseMissingError)) Error() [string](/builtin#string)
```

#### type [Permissions](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/server.go;l=21) [¶](#Permissions "Go to Permissions")

```
type Permissions struct {
	// CriticalOptions indicate restrictions to the default
	// permissions, and are typically used in conjunction with
	// user certificates. The standard for SSH certificates
	// defines "force-command" (only allow the given command to
	// execute) and "source-address" (only allow connections from
	// the given address). The SSH package currently only enforces
	// the "source-address" critical option. It is up to server
	// implementations to enforce other critical options, such as
	// "force-command", by checking them after the SSH handshake
	// is successful. In general, SSH servers should reject
	// connections that specify critical options that are unknown
	// or not supported.
	CriticalOptions map[[string](/builtin#string)][string](/builtin#string)

	// Extensions are extra functionality that the server may
	// offer on authenticated connections. Lack of support for an
	// extension does not preclude authenticating a user. Common
	// extensions are "permit-agent-forwarding",
	// "permit-X11-forwarding". The Go SSH library currently does
	// not act on any extension, and it is up to server
	// implementations to honor them. Extensions can be used to
	// pass data from the authentication callbacks to the server
	// application layer.
	Extensions map[[string](/builtin#string)][string](/builtin#string)
}
```

The Permissions type holds fine-grained permissions that are
specific to a user or a specific authentication method for a user.
The Permissions value for a successful authentication attempt is
available in ServerConn, so it can be used to pass information from
the user-authentication phase to the application layer.

#### type [PublicKey](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/keys.go;l=315) [¶](#PublicKey "Go to PublicKey")

```
type PublicKey interface {
	// Type returns the key format name, e.g. "ssh-rsa".
	Type() [string](/builtin#string)

	// Marshal returns the serialized key data in SSH wire format, with the name
	// prefix. To unmarshal the returned data, use the ParsePublicKey function.
	Marshal() [][byte](/builtin#byte)

	// Verify that sig is a signature on the given data using this key. This
	// method will hash the data appropriately first. sig.Format is allowed to
	// be any signature algorithm compatible with the key type, the caller
	// should check if it has more stringent requirements.
	Verify(data [][byte](/builtin#byte), sig *[Signature](#Signature)) [error](/builtin#error)
}
```

PublicKey represents a public key using an unspecified algorithm.

Some PublicKeys provided by this package also implement CryptoPublicKey.

#### func [NewPublicKey](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/keys.go;l=1165) [¶](#NewPublicKey "Go to NewPublicKey")

```
func NewPublicKey(key interface{}) ([PublicKey](#PublicKey), [error](/builtin#error))
```

NewPublicKey takes an \*rsa.PublicKey, \*dsa.PublicKey, \*ecdsa.PublicKey,
or ed25519.PublicKey returns a corresponding PublicKey instance.
ECDSA keys must use P-256, P-384 or P-521.

#### func [ParseAuthorizedKey](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/keys.go;l=191) [¶](#ParseAuthorizedKey "Go to ParseAuthorizedKey")

```
func ParseAuthorizedKey(in [][byte](/builtin#byte)) (out [PublicKey](#PublicKey), comment [string](/builtin#string), options [][string](/builtin#string), rest [][byte](/builtin#byte), err [error](/builtin#error))
```

ParseAuthorizedKey parses a public key from an authorized\_keys
file used in OpenSSH according to the sshd(8) manual page.

#### func [ParseKnownHosts](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/keys.go;l=131) [¶](#ParseKnownHosts "Go to ParseKnownHosts")

```
func ParseKnownHosts(in [][byte](/builtin#byte)) (marker [string](/builtin#string), hosts [][string](/builtin#string), pubKey [PublicKey](#PublicKey), comment [string](/builtin#string), rest [][byte](/builtin#byte), err [error](/builtin#error))
```

ParseKnownHosts parses an entry in the format of the known\_hosts file.

The known\_hosts format is documented in the sshd(8) manual page. This
function will parse a single entry from in. On successful return, marker
will contain the optional marker value (i.e. "cert-authority" or "revoked")
or else be empty, hosts will contain the hosts that this entry matches,
pubKey will contain the public key and comment will contain any trailing
comment at the end of the line. See the sshd(8) manual page for the various
forms that a host string can take.

The unparsed remainder of the input will be returned in rest. This function
can be called repeatedly to parse multiple entries.

If no entries were found in the input then err will be io.EOF. Otherwise a
non-nil err value indicates a parse error.

#### func [ParsePublicKey](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/keys.go;l=273) [¶](#ParsePublicKey "Go to ParsePublicKey")

```
func ParsePublicKey(in [][byte](/builtin#byte)) (out [PublicKey](#PublicKey), err [error](/builtin#error))
```

ParsePublicKey parses an SSH public key formatted for use in
the SSH wire protocol according to [RFC 4253, section 6.6](https://rfc-editor.org/rfc/rfc4253.html#section-6.6).

#### type [RejectionReason](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/channel.go;l=110) [¶](#RejectionReason "Go to RejectionReason")

```
type RejectionReason [uint32](/builtin#uint32)
```

RejectionReason is an enumeration used when rejecting channel creation
requests. See [RFC 4254, section 5.1](https://rfc-editor.org/rfc/rfc4254.html#section-5.1).

```
const (
	Prohibited [RejectionReason](#RejectionReason) = [iota](/builtin#iota) + 1
	ConnectionFailed
	UnknownChannelType
	ResourceShortage
)
```

#### func (RejectionReason) [String](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/channel.go;l=120) [¶](#RejectionReason.String "Go to RejectionReason.String")

```
func (r [RejectionReason](#RejectionReason)) String() [string](/builtin#string)
```

String converts the rejection reason to human readable form.

#### type [Request](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/channel.go;l=84) [¶](#Request "Go to Request")

```
type Request struct {
	Type      [string](/builtin#string)
	WantReply [bool](/builtin#bool)
	Payload   [][byte](/builtin#byte)
	// contains filtered or unexported fields
}
```

Request is a request sent outside of the normal stream of
data. Requests can either be specific to an SSH channel, or they
can be global.

#### func (\*Request) [Reply](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/channel.go;l=96) [¶](#Request.Reply "Go to Request.Reply")

```
func (r *[Request](#Request)) Reply(ok [bool](/builtin#bool), payload [][byte](/builtin#byte)) [error](/builtin#error)
```

Reply sends a response to a request. It must be called for all requests
where WantReply is true and is a no-op otherwise. The payload argument is
ignored for replies to channel-specific requests.

#### type [ServerAuthCallbacks](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/server.go;l=437) [¶](#ServerAuthCallbacks "Go to ServerAuthCallbacks") added in v0.22.0

```
type ServerAuthCallbacks struct {
	// PasswordCallback behaves like [ServerConfig.PasswordCallback].
	PasswordCallback func(conn [ConnMetadata](#ConnMetadata), password [][byte](/builtin#byte)) (*[Permissions](#Permissions), [error](/builtin#error))

	// PublicKeyCallback behaves like [ServerConfig.PublicKeyCallback].
	PublicKeyCallback func(conn [ConnMetadata](#ConnMetadata), key [PublicKey](#PublicKey)) (*[Permissions](#Permissions), [error](/builtin#error))

	// KeyboardInteractiveCallback behaves like [ServerConfig.KeyboardInteractiveCallback].
	KeyboardInteractiveCallback func(conn [ConnMetadata](#ConnMetadata), client [KeyboardInteractiveChallenge](#KeyboardInteractiveChallenge)) (*[Permissions](#Permissions), [error](/builtin#error))

	// GSSAPIWithMICConfig behaves like [ServerConfig.GSSAPIWithMICConfig].
	GSSAPIWithMICConfig *[GSSAPIWithMICConfig](#GSSAPIWithMICConfig)
}
```

ServerAuthCallbacks defines server-side authentication callbacks.

#### type [ServerAuthError](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/server.go;l=422) [¶](#ServerAuthError "Go to ServerAuthError")

```
type ServerAuthError struct {
	// Errors contains authentication errors returned by the authentication
	// callback methods. The first entry is typically ErrNoAuth.
	Errors [][error](/builtin#error)
}
```

ServerAuthError represents server authentication errors and is
sometimes returned by NewServerConn. It appends any authentication
errors that may occur, and is returned if all of the authentication
methods provided by the user failed to authenticate.

#### func (ServerAuthError) [Error](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/server.go;l=428) [¶](#ServerAuthError.Error "Go to ServerAuthError.Error")

```
func (l [ServerAuthError](#ServerAuthError)) Error() [string](/builtin#string)
```

#### type [ServerConfig](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/server.go;l=63) [¶](#ServerConfig "Go to ServerConfig")

```
type ServerConfig struct {
	// Config contains configuration shared between client and server.
	[Config](#Config)

	// PublicKeyAuthAlgorithms specifies the supported client public key
	// authentication algorithms. Note that this should not include certificate
	// types since those use the underlying algorithm. This list is sent to the
	// client if it supports the server-sig-algs extension. Order is irrelevant.
	// If unspecified then a default set of algorithms is used.
	PublicKeyAuthAlgorithms [][string](/builtin#string)

	// NoClientAuth is true if clients are allowed to connect without
	// authenticating.
	// To determine NoClientAuth at runtime, set NoClientAuth to true
	// and the optional NoClientAuthCallback to a non-nil value.
	NoClientAuth [bool](/builtin#bool)

	// NoClientAuthCallback, if non-nil, is called when a user
	// attempts to authenticate with auth method "none".
	// NoClientAuth must also be set to true for this be used, or
	// this func is unused.
	NoClientAuthCallback func([ConnMetadata](#ConnMetadata)) (*[Permissions](#Permissions), [error](/builtin#error))

	// MaxAuthTries specifies the maximum number of authentication attempts
	// permitted per connection. If set to a negative number, the number of
	// attempts are unlimited. If set to zero, the number of attempts are limited
	// to 6.
	MaxAuthTries [int](/builtin#int)

	// PasswordCallback, if non-nil, is called when a user
	// attempts to authenticate using a password.
	PasswordCallback func(conn [ConnMetadata](#ConnMetadata), password [][byte](/builtin#byte)) (*[Permissions](#Permissions), [error](/builtin#error))

	// PublicKeyCallback, if non-nil, is called when a client
	// offers a public key for authentication. It must return a nil error
	// if the given public key can be used to authenticate the
	// given user. For example, see CertChecker.Authenticate. A
	// call to this function does not guarantee that the key
	// offered is in fact used to authenticate. To record any data
	// depending on the public key, store it inside a
	// Permissions.Extensions entry.
	PublicKeyCallback func(conn [ConnMetadata](#ConnMetadata), key [PublicKey](#PublicKey)) (*[Permissions](#Permissions), [error](/builtin#error))

	// KeyboardInteractiveCallback, if non-nil, is called when
	// keyboard-interactive authentication is selected (RFC
	// 4256). The client object's Challenge function should be
	// used to query the user. The callback may offer multiple
	// Challenge rounds. To avoid information leaks, the client
	// should be presented a challenge even if the user is
	// unknown.
	KeyboardInteractiveCallback func(conn [ConnMetadata](#ConnMetadata), client [KeyboardInteractiveChallenge](#KeyboardInteractiveChallenge)) (*[Permissions](#Permissions), [error](/builtin#error))

	// AuthLogCallback, if non-nil, is called to log all authentication
	// attempts.
	AuthLogCallback func(conn [ConnMetadata](#ConnMetadata), method [string](/builtin#string), err [error](/builtin#error))

	// ServerVersion is the version identification string to announce in
	// the public handshake.
	// If empty, a reasonable default is used.
	// Note that [RFC 4253 section 4.2](https://rfc-editor.org/rfc/rfc4253.html#section-4.2) requires that this string start with
	// "SSH-2.0-".
	ServerVersion [string](/builtin#string)

	// BannerCallback, if present, is called and the return string is sent to
	// the client after key exchange completed but before authentication.
	BannerCallback func(conn [ConnMetadata](#ConnMetadata)) [string](/builtin#string)

	// GSSAPIWithMICConfig includes gssapi server and callback, which if both non-nil, is used
	// when gssapi-with-mic authentication is selected ([RFC 4462 section 3](https://rfc-editor.org/rfc/rfc4462.html#section-3)).
	GSSAPIWithMICConfig *[GSSAPIWithMICConfig](#GSSAPIWithMICConfig)
	// contains filtered or unexported fields
}
```

ServerConfig holds server specific configuration data.

#### func (\*ServerConfig) [AddHostKey](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/server.go;l=140) [¶](#ServerConfig.AddHostKey "Go to ServerConfig.AddHostKey")

```
func (s *[ServerConfig](#ServerConfig)) AddHostKey(key [Signer](#Signer))
```

AddHostKey adds a private key as a host key. If an existing host
key exists with the same public key format, it is replaced. Each server
config must have at least one host key.

Example [¶](#example-ServerConfig.AddHostKey "Go to Example")
```

package main

import (
	"fmt"
	"log"
	"os"

	"golang.org/x/crypto/ssh"
)

func main() {
	// Minimal ServerConfig supporting only password authentication.
	config := &ssh.ServerConfig{
		PasswordCallback: func(c ssh.ConnMetadata, pass []byte) (*ssh.Permissions, error) {
			// Should use constant-time compare (or better, salt+hash) in
			// a production setting.
			if c.User() == "testuser" && string(pass) == "tiger" {
				return nil, nil
			}
			return nil, fmt.Errorf("password rejected for %q", c.User())
		},
	}

	privateBytes, err := os.ReadFile("id_rsa")
	if err != nil {
		log.Fatal("Failed to load private key: ", err)
	}

	private, err := ssh.ParsePrivateKey(privateBytes)
	if err != nil {
		log.Fatal("Failed to parse private key: ", err)
	}
	// Restrict host key algorithms to disable ssh-rsa.
	signer, err := ssh.NewSignerWithAlgorithms(private.(ssh.AlgorithmSigner), []string{ssh.KeyAlgoRSASHA256, ssh.KeyAlgoRSASHA512})
	if err != nil {
		log.Fatal("Failed to create private key with restricted algorithms: ", err)
	}
	config.AddHostKey(signer)
}

```
```
Output:

```

Share
Format
Run

#### type [ServerConn](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/server.go;l=196) [¶](#ServerConn "Go to ServerConn")

```
type ServerConn struct {
	[Conn](#Conn)

	// If the succeeding authentication callback returned a
	// non-nil Permissions pointer, it is stored here.
	Permissions *[Permissions](#Permissions)
}
```

ServerConn is an authenticated SSH connection, as seen from the
server

#### func [NewServerConn](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/server.go;l=212) [¶](#NewServerConn "Go to NewServerConn")

```
func NewServerConn(c [net](/net).[Conn](/net#Conn), config *[ServerConfig](#ServerConfig)) (*[ServerConn](#ServerConn), <-chan [NewChannel](#NewChannel), <-chan *[Request](#Request), [error](/builtin#error))
```

NewServerConn starts a new SSH server with c as the underlying
transport. It starts with a handshake and, if the handshake is
unsuccessful, it closes the connection and returns an error. The
Request and NewChannel channels must be serviced, or the connection
will hang.

The returned error may be of type \*ServerAuthError for
authentication errors.

Example [¶](#example-NewServerConn "Go to Example")
```

package main

import (
	"fmt"
	"log"
	"net"
	"os"
	"sync"

	"golang.org/x/crypto/ssh"
	"golang.org/x/crypto/ssh/terminal"
)

func main() {
	// Public key authentication is done by comparing
	// the public key of a received connection
	// with the entries in the authorized_keys file.
	authorizedKeysBytes, err := os.ReadFile("authorized_keys")
	if err != nil {
		log.Fatalf("Failed to load authorized_keys, err: %v", err)
	}

	authorizedKeysMap := map[string]bool{}
	for len(authorizedKeysBytes) > 0 {
		pubKey, _, _, rest, err := ssh.ParseAuthorizedKey(authorizedKeysBytes)
		if err != nil {
			log.Fatal(err)
		}

		authorizedKeysMap[string(pubKey.Marshal())] = true
		authorizedKeysBytes = rest
	}

	// An SSH server is represented by a ServerConfig, which holds
	// certificate details and handles authentication of ServerConns.
	config := &ssh.ServerConfig{
		// Remove to disable password auth.
		PasswordCallback: func(c ssh.ConnMetadata, pass []byte) (*ssh.Permissions, error) {
			// Should use constant-time compare (or better, salt+hash) in
			// a production setting.
			if c.User() == "testuser" && string(pass) == "tiger" {
				return nil, nil
			}
			return nil, fmt.Errorf("password rejected for %q", c.User())
		},

		// Remove to disable public key auth.
		PublicKeyCallback: func(c ssh.ConnMetadata, pubKey ssh.PublicKey) (*ssh.Permissions, error) {
			if authorizedKeysMap[string(pubKey.Marshal())] {
				return &ssh.Permissions{
					// Record the public key used for authentication.
					Extensions: map[string]string{
						"pubkey-fp": ssh.FingerprintSHA256(pubKey),
					},
				}, nil
			}
			return nil, fmt.Errorf("unknown public key for %q", c.User())
		},
	}

	privateBytes, err := os.ReadFile("id_rsa")
	if err != nil {
		log.Fatal("Failed to load private key: ", err)
	}

	private, err := ssh.ParsePrivateKey(privateBytes)
	if err != nil {
		log.Fatal("Failed to parse private key: ", err)
	}
	config.AddHostKey(private)

	// Once a ServerConfig has been configured, connections can be
	// accepted.
	listener, err := net.Listen("tcp", "0.0.0.0:2022")
	if err != nil {
		log.Fatal("failed to listen for connection: ", err)
	}
	nConn, err := listener.Accept()
	if err != nil {
		log.Fatal("failed to accept incoming connection: ", err)
	}

	// Before use, a handshake must be performed on the incoming
	// net.Conn.
	conn, chans, reqs, err := ssh.NewServerConn(nConn, config)
	if err != nil {
		log.Fatal("failed to handshake: ", err)
	}
	log.Printf("logged in with key %s", conn.Permissions.Extensions["pubkey-fp"])

	var wg sync.WaitGroup
	defer wg.Wait()

	// The incoming Request channel must be serviced.
	wg.Add(1)
	go func() {
		ssh.DiscardRequests(reqs)
		wg.Done()
	}()

	// Service the incoming Channel channel.
	for newChannel := range chans {
		// Channels have a type, depending on the application level
		// protocol intended. In the case of a shell, the type is
		// "session" and ServerShell may be used to present a simple
		// terminal interface.
		if newChannel.ChannelType() != "session" {
			newChannel.Reject(ssh.UnknownChannelType, "unknown channel type")
			continue
		}
		channel, requests, err := newChannel.Accept()
		if err != nil {
			log.Fatalf("Could not accept channel: %v", err)
		}

		// Sessions have out-of-band requests such as "shell",
		// "pty-req" and "env".  Here we handle only the
		// "shell" request.
		wg.Add(1)
		go func(in <-chan *ssh.Request) {
			for req := range in {
				req.Reply(req.Type == "shell", nil)
			}
			wg.Done()
		}(requests)

		term := terminal.NewTerminal(channel, "> ")

		wg.Add(1)
		go func() {
			defer func() {
				channel.Close()
				wg.Done()
			}()
			for {
				line, err := term.ReadLine()
				if err != nil {
					break
				}
				fmt.Println(line)
			}
		}()
	}
}

```
```
Output:

```

Share
Format
Run

#### type [Session](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=116) [¶](#Session "Go to Session")

```
type Session struct {
	// Stdin specifies the remote process's standard input.
	// If Stdin is nil, the remote process reads from an empty
	// bytes.Buffer.
	Stdin [io](/io).[Reader](/io#Reader)

	// Stdout and Stderr specify the remote process's standard
	// output and error.
	//
	// If either is nil, Run connects the corresponding file
	// descriptor to an instance of io.Discard. There is a
	// fixed amount of buffering that is shared for the two streams.
	// If either blocks it may eventually cause the remote
	// command to block.
	Stdout [io](/io).[Writer](/io#Writer)
	Stderr [io](/io).[Writer](/io#Writer)
	// contains filtered or unexported fields
}
```

A Session represents a connection to a remote command or shell.

#### func (\*Session) [Close](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=155) [¶](#Session.Close "Go to Session.Close")

```
func (s *[Session](#Session)) Close() [error](/builtin#error)
```

#### func (\*Session) [CombinedOutput](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=341) [¶](#Session.CombinedOutput "Go to Session.CombinedOutput")

```
func (s *[Session](#Session)) CombinedOutput(cmd [string](/builtin#string)) ([][byte](/builtin#byte), [error](/builtin#error))
```

CombinedOutput runs cmd on the remote host and returns its combined
standard output and standard error.

#### func (\*Session) [Output](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=318) [¶](#Session.Output "Go to Session.Output")

```
func (s *[Session](#Session)) Output(cmd [string](/builtin#string)) ([][byte](/builtin#byte), [error](/builtin#error))
```

Output runs cmd on the remote host and returns its standard output.

#### func (\*Session) [RequestPty](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=190) [¶](#Session.RequestPty "Go to Session.RequestPty")

```
func (s *[Session](#Session)) RequestPty(term [string](/builtin#string), h, w [int](/builtin#int), termmodes [TerminalModes](#TerminalModes)) [error](/builtin#error)
```

RequestPty requests the association of a pty with the session on the remote host.

Example [¶](#example-Session.RequestPty "Go to Example")
```

package main

import (
	"log"

	"golang.org/x/crypto/ssh"
)

func main() {
	var hostKey ssh.PublicKey
	// Create client config
	config := &ssh.ClientConfig{
		User: "username",
		Auth: []ssh.AuthMethod{
			ssh.Password("password"),
		},
		HostKeyCallback: ssh.FixedHostKey(hostKey),
	}
	// Connect to ssh server
	conn, err := ssh.Dial("tcp", "localhost:22", config)
	if err != nil {
		log.Fatal("unable to connect: ", err)
	}
	defer conn.Close()
	// Create a session
	session, err := conn.NewSession()
	if err != nil {
		log.Fatal("unable to create session: ", err)
	}
	defer session.Close()
	// Set up terminal modes
	modes := ssh.TerminalModes{
		ssh.ECHO:          0,     // disable echoing
		ssh.TTY_OP_ISPEED: 14400, // input speed = 14.4kbaud
		ssh.TTY_OP_OSPEED: 14400, // output speed = 14.4kbaud
	}
	// Request pseudo terminal
	if err := session.RequestPty("xterm", 40, 80, modes); err != nil {
		log.Fatal("request for pseudo terminal failed: ", err)
	}
	// Start remote shell
	if err := session.Shell(); err != nil {
		log.Fatal("failed to start shell: ", err)
	}
}

```
```
Output:

```

Share
Format
Run

#### func (\*Session) [RequestSubsystem](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=223) [¶](#Session.RequestSubsystem "Go to Session.RequestSubsystem")

```
func (s *[Session](#Session)) RequestSubsystem(subsystem [string](/builtin#string)) [error](/builtin#error)
```

RequestSubsystem requests the association of a subsystem with the session on the remote host.
A subsystem is a predefined command that runs in the background when the ssh session is initiated

#### func (\*Session) [Run](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=309) [¶](#Session.Run "Go to Session.Run")

```
func (s *[Session](#Session)) Run(cmd [string](/builtin#string)) [error](/builtin#error)
```

Run runs cmd on the remote host. Typically, the remote
server passes cmd to the shell for interpretation.
A Session only accepts one call to Run, Start, Shell, Output,
or CombinedOutput.

The returned error is nil if the command runs, has no problems
copying stdin, stdout, and stderr, and exits with a zero exit
status.

If the remote server does not send an exit status, an error of type
\*ExitMissingError is returned. If the command completes
unsuccessfully or is interrupted by a signal, the error is of type
\*ExitError. Other error types may be returned for I/O problems.

#### func (\*Session) [SendRequest](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=151) [¶](#Session.SendRequest "Go to Session.SendRequest")

```
func (s *[Session](#Session)) SendRequest(name [string](/builtin#string), wantReply [bool](/builtin#bool), payload [][byte](/builtin#byte)) ([bool](/builtin#bool), [error](/builtin#error))
```

SendRequest sends an out-of-band channel request on the SSH channel
underlying the session.

#### func (\*Session) [Setenv](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=167) [¶](#Session.Setenv "Go to Session.Setenv")

```
func (s *[Session](#Session)) Setenv(name, value [string](/builtin#string)) [error](/builtin#error)
```

Setenv sets an environment variable that will be applied to any
command executed by Shell or Run.

#### func (\*Session) [Shell](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=357) [¶](#Session.Shell "Go to Session.Shell")

```
func (s *[Session](#Session)) Shell() [error](/builtin#error)
```

Shell starts a login shell on the remote host. A Session only
accepts one call to Run, Start, Shell, Output, or CombinedOutput.

#### func (\*Session) [Signal](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=261) [¶](#Session.Signal "Go to Session.Signal")

```
func (s *[Session](#Session)) Signal(sig [Signal](#Signal)) [error](/builtin#error)
```

Signal sends the given signal to the remote process.
sig is one of the SIG\* constants.

#### func (\*Session) [Start](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=278) [¶](#Session.Start "Go to Session.Start")

```
func (s *[Session](#Session)) Start(cmd [string](/builtin#string)) [error](/builtin#error)
```

Start runs cmd on the remote host. Typically, the remote
server passes cmd to the shell for interpretation.
A Session only accepts one call to Run, Start or Shell.

#### func (\*Session) [StderrPipe](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=575) [¶](#Session.StderrPipe "Go to Session.StderrPipe")

```
func (s *[Session](#Session)) StderrPipe() ([io](/io).[Reader](/io#Reader), [error](/builtin#error))
```

StderrPipe returns a pipe that will be connected to the
remote command's standard error when the command starts.
There is a fixed amount of buffering that is shared between
stdout and stderr streams. If the StderrPipe reader is
not serviced fast enough it may eventually cause the
remote command to block.

#### func (\*Session) [StdinPipe](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=541) [¶](#Session.StdinPipe "Go to Session.StdinPipe")

```
func (s *[Session](#Session)) StdinPipe() ([io](/io).[WriteCloser](/io#WriteCloser), [error](/builtin#error))
```

StdinPipe returns a pipe that will be connected to the
remote command's standard input when the command starts.

#### func (\*Session) [StdoutPipe](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=558) [¶](#Session.StdoutPipe "Go to Session.StdoutPipe")

```
func (s *[Session](#Session)) StdoutPipe() ([io](/io).[Reader](/io#Reader), [error](/builtin#error))
```

StdoutPipe returns a pipe that will be connected to the
remote command's standard output when the command starts.
There is a fixed amount of buffering that is shared between
stdout and stderr streams. If the StdoutPipe reader is
not serviced fast enough it may eventually cause the
remote command to block.

#### func (\*Session) [Wait](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=399) [¶](#Session.Wait "Go to Session.Wait")

```
func (s *[Session](#Session)) Wait() [error](/builtin#error)
```

Wait waits for the remote command to exit.

The returned error is nil if the command runs, has no problems
copying stdin, stdout, and stderr, and exits with a zero exit
status.

If the remote server does not send an exit status, an error of type
\*ExitMissingError is returned. If the command completes
unsuccessfully or is interrupted by a signal, the error is of type
\*ExitError. Other error types may be returned for I/O problems.

#### func (\*Session) [WindowChange](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=243) [¶](#Session.WindowChange "Go to Session.WindowChange")

```
func (s *[Session](#Session)) WindowChange(h, w [int](/builtin#int)) [error](/builtin#error)
```

WindowChange informs the remote host about a terminal window dimension change to h rows and w columns.

#### type [Signal](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=19) [¶](#Signal "Go to Signal")

```
type Signal [string](/builtin#string)
```

```
const (
	SIGABRT [Signal](#Signal) = "ABRT"
	SIGALRM [Signal](#Signal) = "ALRM"
	SIGFPE  [Signal](#Signal) = "FPE"
	SIGHUP  [Signal](#Signal) = "HUP"
	SIGILL  [Signal](#Signal) = "ILL"
	SIGINT  [Signal](#Signal) = "INT"
	SIGKILL [Signal](#Signal) = "KILL"
	SIGPIPE [Signal](#Signal) = "PIPE"
	SIGQUIT [Signal](#Signal) = "QUIT"
	SIGSEGV [Signal](#Signal) = "SEGV"
	SIGTERM [Signal](#Signal) = "TERM"
	SIGUSR1 [Signal](#Signal) = "USR1"
	SIGUSR2 [Signal](#Signal) = "USR2"
)
```

POSIX signals as listed in [RFC 4254 Section 6.10](https://rfc-editor.org/rfc/rfc4254.html#section-6.10).

#### type [Signature](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/certs.go;l=57) [¶](#Signature "Go to Signature")

```
type Signature struct {
	Format [string](/builtin#string)
	Blob   [][byte](/builtin#byte)
	Rest   [][byte](/builtin#byte) `ssh:"rest"`
}
```

Signature represents a cryptographic signature.

#### type [Signer](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/keys.go;l=339) [¶](#Signer "Go to Signer")

```
type Signer interface {
	// PublicKey returns the associated PublicKey.
	PublicKey() [PublicKey](#PublicKey)

	// Sign returns a signature for the given data. This method will hash the
	// data appropriately first. The signature algorithm is expected to match
	// the key format returned by the PublicKey.Type method (and not to be any
	// alternative algorithm supported by the key format).
	Sign(rand [io](/io).[Reader](/io#Reader), data [][byte](/builtin#byte)) (*[Signature](#Signature), [error](/builtin#error))
}
```

A Signer can create signatures that verify against a public key.

Some Signers provided by this package also implement MultiAlgorithmSigner.

#### func [NewCertSigner](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/certs.go;l=254) [¶](#NewCertSigner "Go to NewCertSigner")

```
func NewCertSigner(cert *[Certificate](#Certificate), signer [Signer](#Signer)) ([Signer](#Signer), [error](/builtin#error))
```

NewCertSigner returns a Signer that signs with the given Certificate, whose
private key is held by signer. It returns an error if the public key in cert
doesn't match the key used by signer.

#### func [NewSignerFromKey](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/keys.go;l=1057) [¶](#NewSignerFromKey "Go to NewSignerFromKey")

```
func NewSignerFromKey(key interface{}) ([Signer](#Signer), [error](/builtin#error))
```

NewSignerFromKey takes an \*rsa.PrivateKey, \*dsa.PrivateKey,
\*ecdsa.PrivateKey or any other crypto.Signer and returns a
corresponding Signer instance. ECDSA keys must use P-256, P-384 or
P-521. DSA keys must use parameter size L1024N160.

#### func [NewSignerFromSigner](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/keys.go;l=1084) [¶](#NewSignerFromSigner "Go to NewSignerFromSigner")

```
func NewSignerFromSigner(signer [crypto](/crypto).[Signer](/crypto#Signer)) ([Signer](#Signer), [error](/builtin#error))
```

NewSignerFromSigner takes any crypto.Signer implementation and
returns a corresponding Signer interface. This can be used, for
example, with keys kept in hardware modules.

#### func [ParsePrivateKey](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/keys.go;l=1189) [¶](#ParsePrivateKey "Go to ParsePrivateKey")

```
func ParsePrivateKey(pemBytes [][byte](/builtin#byte)) ([Signer](#Signer), [error](/builtin#error))
```

ParsePrivateKey returns a Signer from a PEM encoded private key. It supports
the same keys as ParseRawPrivateKey. If the private key is encrypted, it
will return a PassphraseMissingError.

#### func [ParsePrivateKeyWithPassphrase](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/keys.go;l=1201) [¶](#ParsePrivateKeyWithPassphrase "Go to ParsePrivateKeyWithPassphrase")

```
func ParsePrivateKeyWithPassphrase(pemBytes, passphrase [][byte](/builtin#byte)) ([Signer](#Signer), [error](/builtin#error))
```

ParsePrivateKeyWithPassphrase returns a Signer from a PEM encoded private
key and passphrase. It supports the same keys as
ParseRawPrivateKeyWithPassphrase.

#### type [TerminalModes](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=52) [¶](#TerminalModes "Go to TerminalModes")

```
type TerminalModes map[[uint8](/builtin#uint8)][uint32](/builtin#uint32)
```

#### type [Waitmsg](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=610) [¶](#Waitmsg "Go to Waitmsg")

```
type Waitmsg struct {
	// contains filtered or unexported fields
}
```

Waitmsg stores the information about an exited remote command
as reported by Wait.

#### func (Waitmsg) [ExitStatus](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=618) [¶](#Waitmsg.ExitStatus "Go to Waitmsg.ExitStatus")

```
func (w [Waitmsg](#Waitmsg)) ExitStatus() [int](/builtin#int)
```

ExitStatus returns the exit status of the remote command.

#### func (Waitmsg) [Lang](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=634) [¶](#Waitmsg.Lang "Go to Waitmsg.Lang")

```
func (w [Waitmsg](#Waitmsg)) Lang() [string](/builtin#string)
```

Lang returns the language tag. See [RFC 3066](https://rfc-editor.org/rfc/rfc3066.html)

#### func (Waitmsg) [Msg](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=629) [¶](#Waitmsg.Msg "Go to Waitmsg.Msg")

```
func (w [Waitmsg](#Waitmsg)) Msg() [string](/builtin#string)
```

Msg returns the exit message given by the remote command

#### func (Waitmsg) [Signal](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=624) [¶](#Waitmsg.Signal "Go to Waitmsg.Signal")

```
func (w [Waitmsg](#Waitmsg)) Signal() [string](/builtin#string)
```

Signal returns the exit signal of the remote command if
it was terminated violently.

#### func (Waitmsg) [String](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go;l=638) [¶](#Waitmsg.String "Go to Waitmsg.String")

```
func (w [Waitmsg](#Waitmsg)) String() [string](/builtin#string)
```

## Source Files [¶](#section-sourcefiles "Go to Source Files")

[View all Source files](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh)

* [buffer.go](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/buffer.go "buffer.go")
* [certs.go](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/certs.go "certs.go")
* [channel.go](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/channel.go "channel.go")
* [cipher.go](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/cipher.go "cipher.go")
* [client.go](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/client.go "client.go")
* [client\_auth.go](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/client_auth.go "client_auth.go")
* [common.go](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/common.go "common.go")
* [connection.go](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/connection.go "connection.go")
* [doc.go](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/doc.go "doc.go")
* [handshake.go](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/handshake.go "handshake.go")
* [kex.go](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/kex.go "kex.go")
* [keys.go](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/keys.go "keys.go")
* [mac.go](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/mac.go "mac.go")
* [messages.go](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/messages.go "messages.go")
* [mux.go](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/mux.go "mux.go")
* [server.go](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/server.go "server.go")
* [session.go](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/session.go "session.go")
* [ssh\_gss.go](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/ssh_gss.go "ssh_gss.go")
* [streamlocal.go](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/streamlocal.go "streamlocal.go")
* [tcpip.go](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/tcpip.go "tcpip.go")
* [transport.go](https://cs.opensource.google/go/x/crypto/%2B/v0.32.0%3Assh/transport.go "transport.go")

## Directories [¶](#section-directories "Go to Directories")

Show internal

Expand all

| Path | Synopsis |
| --- | --- |
| [agent](/golang.org/x/crypto%40v0.32.0/ssh/agent)  Package agent implements the ssh-agent protocol, and provides both a client and a server. | Package agent implements the ssh-agent protocol, and provides both a client and a server. |
| internal |  |
| [bcrypt\_pbkdf](/golang.org/x/crypto%40v0.32.0/ssh/internal/bcrypt_pbkdf)  Package bcrypt\_pbkdf implements bcrypt\_pbkdf(3) from OpenBSD. | Package bcrypt\_pbkdf implements bcrypt\_pbkdf(3) from OpenBSD. |
| [knownhosts](/golang.org/x/crypto%40v0.32.0/ssh/knownhosts)  Package knownhosts implements a parser for the OpenSSH known\_hosts host key database, and provides utility functions for writing OpenSSH compliant known\_hosts files. | Package knownhosts implements a parser for the OpenSSH known\_hosts host key database, and provides utility functions for writing OpenSSH compliant known\_hosts files. |
| [terminal](/golang.org/x/crypto%40v0.32.0/ssh/terminal)  Package terminal provides support functions for dealing with terminals, as commonly found on UNIX systems. | Package terminal provides support functions for dealing with terminals, as commonly found on UNIX systems. |
| [test](/golang.org/x/crypto%40v0.32.0/ssh/test)  Package test contains integration tests for the golang.org/x/crypto/ssh package. | Package test contains integration tests for the golang.org/x/crypto/ssh package. |

 Click to show internal directories.
 Click to hide internal directories.

[Why Go](https://go.dev/solutions)
[Use Cases](https://go.dev/solutions#use-cases)
[Case Studies](https://go.dev/solutions#case-studies)

[Get Started](https://learn.go.dev/)
[Playground](https://play.golang.org)
[Tour](https://tour.golang.org)
[Stack Overflow](https://stackoverflow.com/questions/tagged/go?tab=Newest)
[Help](https://go.dev/help)

[Packages](https://pkg.go.dev)
[Standard Library](/std)
[Sub-repositories](/golang.org/x)
[About Go Packages](https://pkg.go.dev/about)

[About](https://go.dev/project)
[Download](https://go.dev/dl/)
[Blog](https://go.dev/blog)
[Issue Tracker](https://github.com/golang/go/issues)
[Release Notes](https://go.dev/doc/devel/release.html)
[Brand Guidelines](https://blog.golang.org/go-brand)
[Code of Conduct](https://go.dev/conduct)

[Connect](https://www.twitter.com/golang)
[Twitter](https://www.twitter.com/golang)
[GitHub](https://github.com/golang)
[Slack](https://invite.slack.golangbridge.org/)
[r/golang](https://reddit.com/r/golang)
[Meetup](https://www.meetup.com/pro/go)
[Golang Weekly](https://golangweekly.com/)

![Gopher in flight goggles](/static/shared/gopher/pilot-bust-1431x901.svg)

* [Copyright](https://go.dev/copyright)
* [Terms of Service](https://go.dev/tos)
* [Privacy Policy](http://www.google.com/intl/en/policies/privacy/)
* [Report an Issue](https://go.dev/s/pkgsite-feedback)
* ![System theme](/static/shared/icon/brightness_6_gm_grey_24dp.svg)
  ![Dark theme](/static/shared/icon/brightness_2_gm_grey_24dp.svg)
  ![Light theme](/static/shared/icon/light_mode_gm_grey_24dp.svg)

  Theme Toggle
* ![](/static/shared/icon/keyboard_grey_24dp.svg)

  Shortcuts Modal

[![Google logo](/static/shared/logo/google-white.svg)](https://google.com)

## Jump to

![](/static/shared/icon/close_gm_grey_24dp.svg)

Close

## Keyboard shortcuts

![](/static/shared/icon/close_gm_grey_24dp.svg)

| **?** | : This menu |
| --- | --- |
| **/** | : Search site |
| **f** or **F** | : Jump to |
| **y** or **Y** | : Canonical URL |

Close

go.dev uses cookies from Google to deliver and enhance the quality of its services and to
analyze traffic. [Learn more.](https://policies.google.com/technologies/cookies)
Okay



=== Content from github.com_2bdf074b_20250124_164850.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgolang%2Fcrypto%2Fcommit%2Fe4e2799dd7aab89f583e1d898300d96367750991)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgolang%2Fcrypto%2Fcommit%2Fe4e2799dd7aab89f583e1d898300d96367750991)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=golang%2Fcrypto)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[golang](/golang)
/
**[crypto](/golang/crypto)**
Public

* [Notifications](/login?return_to=%2Fgolang%2Fcrypto) You must be signed in to change notification settings
* [Fork
  2k](/login?return_to=%2Fgolang%2Fcrypto)
* [Star
   3.1k](/login?return_to=%2Fgolang%2Fcrypto)

* [Code](/golang/crypto)
* [Pull requests
  78](/golang/crypto/pulls)
* [Actions](/golang/crypto/actions)
* [Projects
  0](/golang/crypto/projects)
* [Security](/golang/crypto/security)
* [Insights](/golang/crypto/pulse)

Additional navigation options

* [Code](/golang/crypto)
* [Pull requests](/golang/crypto/pulls)
* [Actions](/golang/crypto/actions)
* [Projects](/golang/crypto/projects)
* [Security](/golang/crypto/security)
* [Insights](/golang/crypto/pulse)

## Commit

[Permalink](/golang/crypto/commit/e4e2799dd7aab89f583e1d898300d96367750991)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

ssh: require host key checking in the ClientConfig

[Browse files](/golang/crypto/tree/e4e2799dd7aab89f583e1d898300d96367750991)
Browse the repository at this point in the history

```
This change breaks existing behavior.

Before, a missing ClientConfig.HostKeyCallback would cause host key
checking to be disabled. In this configuration, establishing a
connection to any host just works, so today, most SSH client code in
the wild does not perform any host key checks.

This makes it easy to perform a MITM attack:

* SSH installations that use keyboard-interactive or password
authentication can be attacked with MITM, thereby stealing
passwords.

* Clients that use public-key authentication with agent forwarding are
also vulnerable: the MITM server could allow the login to succeed, and
then immediately ask the agent to authenticate the login to the real
server.

* Clients that use public-key authentication without agent forwarding
are harder to attack unnoticedly: an attacker cannot authenticate the
login to the real server, so it cannot in general present a convincing
server to the victim.

Now, a missing HostKeyCallback will cause the handshake to fail. This
change also provides InsecureIgnoreHostKey() and FixedHostKey(key) as
ready made host checkers.

A simplistic parser for OpenSSH's known_hosts file is given as an
example.  This change does not provide a full-fledged parser, as it
has complexity (wildcards, revocation, hashed addresses) that will
need further consideration.

When introduced, the host checking feature maintained backward
compatibility at the expense of security. We have decided this is not
the right tradeoff for the SSH library.

Fixes [golang/go#19767](https://github.com/golang/go/issues/19767)

Change-Id: I45fc7ba9bd1ea29c31ec23f115cdbab99913e814
Reviewed-on: <https://go-review.googlesource.com/38701>
Run-TryBot: Han-Wen Nienhuys <hanwen@google.com>
TryBot-Result: Gobot Gobot <gobot@golang.org>
Reviewed-by: Brad Fitzpatrick <bradfitz@golang.org>
```

* Loading branch information

[![@hanwen](https://avatars.githubusercontent.com/u/31547?s=40&v=4)](/hanwen)

[hanwen](/golang/crypto/commits?author=hanwen "View all commits by hanwen")
committed
Mar 30, 2017

1 parent
[459e265](/golang/crypto/commit/459e26527287adbc2adcc5d0d49abff9a5f315a7)

commit e4e2799

 Show file tree

 Hide file tree

Showing
**13 changed files**
with
**193 additions**
and
**30 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* ssh

  + agent

    - ssh/agent/client\_test.go
      [client\_test.go](#diff-32c81fd650dc8dcba7e1339361b96df1148887464e57dee866a7213dc28ea541)
    - ssh/agent/example\_test.go
      [example\_test.go](#diff-35dfcdfcd3074f25d0a76e4279a635da339e4a26608e87469ec1ad2eab35c69f)
    - ssh/agent/server\_test.go
      [server\_test.go](#diff-05d0ad59d55df3a49033b6d35cb77b943bbf6fbcc9c44d9da5c585af7f672097)
  + ssh/certs.go
    [certs.go](#diff-7c5f72478ecab8b13677295f77397e87ee0a4ea93c491acfd418b0f752351b2d)
  + ssh/client.go
    [client.go](#diff-78a1a9143f83ec84b28473c351ec706312eb1658ea50216c9fa285494bb502f6)
  + ssh/client\_auth\_test.go
    [client\_auth\_test.go](#diff-06d319e2c3d0d15068a9db5b65f01b02a1c6511f79ce666d0df4b2b12a8a5d17)
  + ssh/client\_test.go
    [client\_test.go](#diff-6fa789ad4d8af51c7173162b4a4cab13fbd2f2311d4eef653bc74c42709fc8f3)
  + ssh/doc.go
    [doc.go](#diff-2ac118c6ff9a3c378ad26039e351541624b30bad7295285d333f947302eb9a8e)
  + ssh/example\_test.go
    [example\_test.go](#diff-cd5a844cdf73dec86d13d7f3cb7b9e955a6b7b701a2bfee7d9005e40ef7fadc8)
  + ssh/handshake.go
    [handshake.go](#diff-5d70d3dfd7a5a1e978a852be04260c37b5aa12e44492bd54f470846f2278f07e)
  + ssh/handshake\_test.go
    [handshake\_test.go](#diff-ed8c5bc68b0cda2dfa64b9c9fcb5817dd8c5f87eb96532e516d9f40b91f2f60d)
  + ssh/session\_test.go
    [session\_test.go](#diff-f260a82142ae649ef4cda9d18a2578b13fac68392e689a90166e3d78924c384c)
  + test

    - ssh/test/cert\_test.go
      [cert\_test.go](#diff-e54b27c3724413eabcd24b7c10fb405096058c15753d122902e0c8e87966ac17)

## There are no files selected for viewing

4 changes: 3 additions & 1 deletion

4
[ssh/agent/client\_test.go](#diff-32c81fd650dc8dcba7e1339361b96df1148887464e57dee866a7213dc28ea541 "ssh/agent/client_test.go")

Show comments

[View file](/golang/crypto/blob/e4e2799dd7aab89f583e1d898300d96367750991/ssh/agent/client_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -233,7 +233,9 @@ func TestAuth(t \*testing.T) { |
|  |  | conn.Close() |
|  |  | }() |
|  |  |  |
|  |  | conf := ssh.ClientConfig{} |
|  |  | conf := ssh.ClientConfig{ |
|  |  | HostKeyCallback: ssh.InsecureIgnoreHostKey(), |
|  |  | } |
|  |  | conf.Auth = append(conf.Auth, ssh.PublicKeysCallback(agent.Signers)) |
|  |  | conn, \_, \_, err := ssh.NewClientConn(b, "", &conf) |
|  |  | if err != nil { |
| Expand Down | |  |

15 changes: 8 additions & 7 deletions

15
[ssh/agent/example\_test.go](#diff-35dfcdfcd3074f25d0a76e4279a635da339e4a26608e87469ec1ad2eab35c69f "ssh/agent/example_test.go")

Show comments

[View file](/golang/crypto/blob/e4e2799dd7aab89f583e1d898300d96367750991/ssh/agent/example_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -6,20 +6,20 @@ package agent\_test |
|  |  |  |
|  |  | import ( |
|  |  | "log" |
|  |  | "os" |
|  |  | "net" |
|  |  | "os" |
|  |  |  |
|  |  | "golang.org/x/crypto/ssh" |
|  |  | "golang.org/x/crypto/ssh/agent" |
|  |  | "golang.org/x/crypto/ssh" |
|  |  | "golang.org/x/crypto/ssh/agent" |
|  |  | ) |
|  |  |  |
|  |  | func ExampleClientAgent() { |
|  |  | // ssh-agent has a UNIX socket under $SSH\_AUTH\_SOCK |
|  |  | socket := os.Getenv("SSH\_AUTH\_SOCK") |
|  |  | conn, err := net.Dial("unix", socket) |
|  |  | if err != nil { |
|  |  | log.Fatalf("net.Dial: %v", err) |
|  |  | } |
|  |  | conn, err := net.Dial("unix", socket) |
|  |  | if err != nil { |
|  |  | log.Fatalf("net.Dial: %v", err) |
|  |  | } |
|  |  | agentClient := agent.NewClient(conn) |
|  |  | config := &ssh.ClientConfig{ |
|  |  | User: "username", |
| Expand All | | @@ -29,6 +29,7 @@ func ExampleClientAgent() { |
|  |  | // wants it. |
|  |  | ssh.PublicKeysCallback(agentClient.Signers), |
|  |  | }, |
|  |  | HostKeyCallback: ssh.InsecureIgnoreHostKey(), |
|  |  | } |
|  |  |  |
|  |  | sshc, err := ssh.Dial("tcp", "localhost:22", config) |
| Expand Down | |  |

4 changes: 3 additions & 1 deletion

4
[ssh/agent/server\_test.go](#diff-05d0ad59d55df3a49033b6d35cb77b943bbf6fbcc9c44d9da5c585af7f672097 "ssh/agent/server_test.go")

Show comments

[View file](/golang/crypto/blob/e4e2799dd7aab89f583e1d898300d96367750991/ssh/agent/server_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -56,7 +56,9 @@ func TestSetupForwardAgent(t \*testing.T) { |
|  |  | incoming <- conn |
|  |  | }() |
|  |  |  |
|  |  | conf := ssh.ClientConfig{} |
|  |  | conf := ssh.ClientConfig{ |
|  |  | HostKeyCallback: ssh.InsecureIgnoreHostKey(), |
|  |  | } |
|  |  | conn, chans, reqs, err := ssh.NewClientConn(b, "", &conf) |
|  |  | if err != nil { |
|  |  | t.Fatalf("NewClientConn: %v", err) |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[ssh/certs.go](#diff-7c5f72478ecab8b13677295f77397e87ee0a4ea93c491acfd418b0f752351b2d "ssh/certs.go")

Show comments

[View file](/golang/crypto/blob/e4e2799dd7aab89f583e1d898300d96367750991/ssh/certs.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -268,7 +268,7 @@ type CertChecker struct { |
|  |  | // HostKeyFallback is called when CertChecker.CheckHostKey encounters a |
|  |  | // public key that is not a certificate. It must implement host key |
|  |  | // validation or else, if nil, all such keys are rejected. |
|  |  | HostKeyFallback func(addr string, remote net.Addr, key PublicKey) error |
|  |  | HostKeyFallback HostKeyCallback |
|  |  |  |
|  |  | // IsRevoked is called for each certificate so that revocation checking |
|  |  | // can be implemented. It should return true if the given certificate |
| Expand Down | |  |

53 changes: 49 additions & 4 deletions

53
[ssh/client.go](#diff-78a1a9143f83ec84b28473c351ec706312eb1658ea50216c9fa285494bb502f6 "ssh/client.go")

Show comments

[View file](/golang/crypto/blob/e4e2799dd7aab89f583e1d898300d96367750991/ssh/client.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -5,6 +5,7 @@ |
|  |  | package ssh |
|  |  |  |
|  |  | import ( |
|  |  | "bytes" |
|  |  | "errors" |
|  |  | "fmt" |
|  |  | "net" |
| Expand Down  Expand Up | | @@ -68,6 +69,11 @@ func NewClient(c Conn, chans <-chan NewChannel, reqs <-chan \*Request) \*Client { |
|  |  | func NewClientConn(c net.Conn, addr string, config \*ClientConfig) (Conn, <-chan NewChannel, <-chan \*Request, error) { |
|  |  | fullConf := \*config |
|  |  | fullConf.SetDefaults() |
|  |  | if fullConf.HostKeyCallback == nil { |
|  |  | c.Close() |
|  |  | return nil, nil, nil, errors.New("ssh: must specify HostKeyCallback") |
|  |  | } |
|  |  |  |
|  |  | conn := &connection{ |
|  |  | sshConn: sshConn{conn: c}, |
|  |  | } |
| Expand Down  Expand Up | | @@ -173,6 +179,13 @@ func Dial(network, addr string, config \*ClientConfig) (\*Client, error) { |
|  |  | return NewClient(c, chans, reqs), nil |
|  |  | } |
|  |  |  |
|  |  | // HostKeyCallback is the function type used for verifying server |
|  |  | // keys. A HostKeyCallback must return nil if the host key is OK, or |
|  |  | // an error to reject it. It receives the hostname as passed to Dial |
|  |  | // or NewClientConn. The remote address is the RemoteAddr of the |
|  |  | // net.Conn underlying the the SSH connection. |
|  |  | type HostKeyCallback func(hostname string, remote net.Addr, key PublicKey) error |
|  |  |  |
|  |  | // A ClientConfig structure is used to configure a Client. It must not be |
|  |  | // modified after having been passed to an SSH function. |
|  |  | type ClientConfig struct { |
| Expand All | | @@ -188,10 +201,12 @@ type ClientConfig struct { |
|  |  | // be used during authentication. |
|  |  | Auth []AuthMethod |
|  |  |  |
|  |  | // HostKeyCallback, if not nil, is called during the cryptographic |
|  |  | // handshake to validate the server's host key. A nil HostKeyCallback |
|  |  | // implies that all host keys are accepted. |
|  |  | HostKeyCallback func(hostname string, remote net.Addr, key PublicKey) error |
|  |  | // HostKeyCallback is called during the cryptographic |
|  |  | // handshake to validate the server's host key. The client |
|  |  | // configuration must supply this callback for the connection |
|  |  | // to succeed. The functions InsecureIgnoreHostKey or |
|  |  | // FixedHostKey can be used for simplistic host key checks. |
|  |  | HostKeyCallback HostKeyCallback |
|  |  |  |
|  |  | // ClientVersion contains the version identification string that will |
|  |  | // be used for the connection. If empty, a reasonable default is used. |
| Expand All | | @@ -209,3 +224,33 @@ type ClientConfig struct { |
|  |  | // A Timeout of zero means no timeout. |
|  |  | Timeout time.Duration |
|  |  | } |
|  |  |  |
|  |  | // InsecureIgnoreHostKey returns a function that can be used for |
|  |  | // ClientConfig.HostKeyCallback to accept any host key. It should |
|  |  | // not be used for production code. |
|  |  | func InsecureIgnoreHostKey() HostKeyCallback { |
|  |  | return func(hostname string, remote net.Addr, key PublicKey) error { |
|  |  | return nil |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | type fixedHostKey struct { |
|  |  | key PublicKey |
|  |  | } |
|  |  |  |
|  |  | func (f \*fixedHostKey) check(hostname string, remote net.Addr, key PublicKey) error { |
|  |  | if f.key == nil { |
|  |  | return fmt.Errorf("ssh: required host key was nil") |
|  |  | } |
|  |  | if !bytes.Equal(key.Marshal(), f.key.Marshal()) { |
|  |  | return fmt.Errorf("ssh: host key mismatch") |
|  |  | } |
|  |  | return nil |
|  |  | } |
|  |  |  |
|  |  | // FixedHostKey returns a function for use in |
|  |  | // ClientConfig.HostKeyCallback to accept only a specific host key. |
|  |  | func FixedHostKey(key PublicKey) HostKeyCallback { |
|  |  | hk := &fixedHostKey{key} |
|  |  | return hk.check |
|  |  | } |

19 changes: 16 additions & 3 deletions

19
[ssh/client\_auth\_test.go](#diff-06d319e2c3d0d15068a9db5b65f01b02a1c6511f79ce666d0df4b2b12a8a5d17 "ssh/client_auth_test.go")

Show comments

[View file](/golang/crypto/blob/e4e2799dd7aab89f583e1d898300d96367750991/ssh/client_auth_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -92,6 +92,7 @@ func TestClientAuthPublicKey(t \*testing.T) { |
|  |  | Auth: []AuthMethod{ |
|  |  | PublicKeys(testSigners["rsa"]), |
|  |  | }, |
|  |  | HostKeyCallback: InsecureIgnoreHostKey(), |
|  |  | } |
|  |  | if err := tryAuth(t, config); err != nil { |
|  |  | t.Fatalf("unable to dial remote side: %s", err) |
| Expand All | | @@ -104,6 +105,7 @@ func TestAuthMethodPassword(t \*testing.T) { |
|  |  | Auth: []AuthMethod{ |
|  |  | Password(clientPassword), |
|  |  | }, |
|  |  | HostKeyCallback: InsecureIgnoreHostKey(), |
|  |  | } |
|  |  |  |
|  |  | if err := tryAuth(t, config); err != nil { |
| Expand All | | @@ -123,6 +125,7 @@ func TestAuthMethodFallback(t \*testing.T) { |
|  |  | return "WRONG", nil |
|  |  | }), |
|  |  | }, |
|  |  | HostKeyCallback: InsecureIgnoreHostKey(), |
|  |  | } |
|  |  |  |
|  |  | if err := tryAuth(t, config); err != nil { |
| Expand All | | @@ -141,6 +144,7 @@ func TestAuthMethodWrongPassword(t \*testing.T) { |
|  |  | Password("wrong"), |
|  |  | PublicKeys(testSigners["rsa"]), |
|  |  | }, |
|  |  | HostKeyCallback: InsecureIgnoreHostKey(), |
|  |  | } |
|  |  |  |
|  |  | if err := tryAuth(t, config); err != nil { |
| Expand All | | @@ -158,6 +162,7 @@ func TestAuthMethodKeyboardInteractive(t \*testing.T) { |
|  |  | Auth: []AuthMethod{ |
|  |  | KeyboardInteractive(answers.Challenge), |
|  |  | }, |
|  |  | HostKeyCallback: InsecureIgnoreHostKey(), |
|  |  | } |
|  |  |  |
|  |  | if err := tryAuth(t, config); err != nil { |
| Expand Down  Expand Up | | @@ -203,6 +208,7 @@ func TestAuthMethodRSAandDSA(t \*testing.T) { |
|  |  | Auth: []AuthMethod{ |
|  |  | PublicKeys(testSigners["dsa"], testSigners["rsa"]), |
|  |  | }, |
|  |  | HostKeyCallback: InsecureIgnoreHostKey(), |
|  |  | } |
|  |  | if err := tryAuth(t, config); err != nil { |
|  |  | t.Fatalf("client could not authenticate with rsa key: %v", err) |
| Expand All | | @@ -219,6 +225,7 @@ func TestClientHMAC(t \*testing.T) { |
|  |  | Config: Config{ |
|  |  | MACs: []string{mac}, |
|  |  | }, |
|  |  | HostKeyCallback: InsecureIgnoreHostKey(), |
|  |  | } |
|  |  | if err := tryAuth(t, config); err != nil { |
|  |  | t.Fatalf("client could not authenticate with mac algo %s: %v", mac, err) |
| Expand Down  Expand Up | | @@ -254,6 +261,7 @@ func TestClientUnsupportedKex(t \*testing.T) { |
|  |  | Config: Config{ |
|  |  | KeyExchanges: []string{"diffie-hellman-group-exchange-sha256"}, // not currently supported |
|  |  | }, |
|  |  | HostKeyCallback: InsecureIgnoreHostKey(), |
|  |  | } |
|  |  | if err := tryAuth(t, config); err == nil || !strings.Contains(err.Error(), "common algorithm") { |
|  |  | t.Errorf("got %v, expected 'common algorithm'", err) |
| Expand All | | @@ -273,7 +281,8 @@ func TestClientLoginCert(t \*testing.T) { |
|  |  | } |
|  |  |  |
|  |  | clientConfig := &ClientConfig{ |
|  |  | User: "user", |
|  |  | User: "user", |
|  |  | HostKeyCallback: InsecureIgnoreHostKey(), |
|  |  | } |
|  |  | clientConfig.Auth = append(clientConfig.Auth, PublicKeys(certSigner)) |
|  |  |  |
| Expand Down  Expand Up | | @@ -363,6 +372,7 @@ func testPermissionsPassing(withPermissions bool, t \*testing.T) { |
|  |  | Auth: []AuthMethod{ |
|  |  | PublicKeys(testSigners["rsa"]), |
|  |  | }, |
|  |  | HostKeyCallback: InsecureIgnoreHostKey(), |
|  |  | } |
|  |  | if withPermissions { |
|  |  | clientConfig.User = "permissions" |
| Expand Down  Expand Up | | @@ -409,6 +419,7 @@ func TestRetryableAuth(t \*testing.T) { |
|  |  | }), 2), |
|  |  | PublicKeys(testSigners["rsa"]), |
|  |  | }, |
|  |  | HostKeyCallback: InsecureIgnoreHostKey(), |
|  |  | } |
|  |  |  |
|  |  | if err := tryAuth(t, config); err != nil { |
| Expand All | | @@ -430,7 +441,8 @@ func ExampleRetryableAuthMethod(t \*testing.T) { |
|  |  | } |
|  |  |  |
|  |  | config := &ClientConfig{ |
|  |  | User: user, |
|  |  | HostKeyCallback: InsecureIgnoreHostKey(), |
|  |  | User: user, |
|  |  | Auth: []AuthMethod{ |
|  |  | RetryableAuthMethod(KeyboardInteractiveChallenge(Cb), NumberOfPrompts), |
|  |  | }, |
| Expand All | | @@ -450,7 +462,8 @@ func TestClientAuthNone(t \*testing.T) { |
|  |  | serverConfig.AddHostKey(testSigners["rsa"]) |
|  |  |  |
|  |  | clientConfig := &ClientConfig{ |
|  |  | User: user, |
|  |  | User: user, |
|  |  | HostKeyCallback: InsecureIgnoreHostKey(), |
|  |  | } |
|  |  |  |
|  |  | c1, c2, err := netPipe() |
| Expand Down | |  |

42 changes: 42 additions & 0 deletions

42
[ssh/client\_test.go](#diff-6fa789ad4d8af51c7173162b4a4cab13fbd2f2311d4eef653bc74c42709fc8f3 "ssh/client_test.go")

Show comments

[View file](/golang/crypto/blob/e4e2799dd7aab89f583e1d898300d96367750991/ssh/client_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -6,13 +6,15 @@ package ssh |
|  |  |  |
|  |  | import ( |
|  |  | "net" |
|  |  | "strings" |
|  |  | "testing" |
|  |  | ) |
|  |  |  |
|  |  | func testClientVersion(t \*testing.T, config \*ClientConfig, expected string) { |
|  |  | clientConn, serverConn := net.Pipe() |
|  |  | defer clientConn.Close() |
|  |  | receivedVersion := make(chan string, 1) |
|  |  | config.HostKeyCallback = InsecureIgnoreHostKey() |
|  |  | go func() { |
|  |  | version, err := readVersion(serverConn) |
|  |  | if err != nil { |
| Expand All | | @@ -37,3 +39,43 @@ func TestCustomClientVersion(t \*testing.T) { |
|  |  | func TestDefaultClientVersion(t \*testing.T) { |
|  |  | testClientVersion(t, &ClientConfig{}, packageVersion) |
|  |  | } |
|  |  |  |
|  |  | func TestHostKeyCheck(t \*testing.T) { |
|  |  | for \_, tt := range []struct { |
|  |  | name string |
|  |  | wantError string |
|  |  | key PublicKey |
|  |  | }{ |
|  |  | {"no callback", "must specify HostKeyCallback", nil}, |
|  |  | {"correct key", "", testSigners["rsa"].PublicKey()}, |
|  |  | {"mismatch", "mismatch", testSigners["ecdsa"].PublicKey()}, |
|  |  | } { |
|  |  | c1, c2, err := netPipe() |
|  |  | if err != nil { |
|  |  | t.Fatalf("netPipe: %v", err) |
|  |  | } |
|  |  | defer c1.Close() |
|  |  | defer c2.Close() |
|  |  | serverConf := &ServerConfig{ |
|  |  | NoClientAuth: true, |
|  |  | } |
|  |  | serverConf.AddHostKey(testSigners["rsa"]) |
|  |  |  |
|  |  | go NewServerConn(c1, serverConf) |
|  |  | clientConf := ClientConfig{ |
|  |  | User: "user", |
|  |  | } |
|  |  | if tt.key != nil { |
|  |  | clientConf.HostKeyCallback = FixedHostKey(tt.key) |
|  |  | } |
|  |  |  |
|  |  | \_, \_, \_, err = NewClientConn(c2, "", &clientConf) |
|  |  | if err != nil { |
|  |  | if tt.wantError == "" || !strings.Contains(err.Error(), tt.wantError) { |
|  |  | t.Errorf("%s: got error %q, missing %q", err.Error(), tt.wantError) |
|  |  | } |
|  |  | } else if tt.wantError != "" { |
|  |  | t.Errorf("%s: succeeded, but want error string %q", tt.name, tt.wantError) |
|  |  | } |
|  |  | } |
|  |  | } |

3 changes: 3 additions & 0 deletions

3
[ssh/doc.go](#diff-2ac118c6ff9a3c378ad26039e351541624b30bad7295285d333f947302eb9a8e "ssh/doc.go")

Show comments

[View file](/golang/crypto/blob/e4e2799dd7aab89f583e1d898300d96367750991/ssh/doc.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -14,5 +14,8 @@ others. |
|  |  | References: |
|  |  | [PROTOCOL.certkeys]: http://cvsweb.openbsd.org/cgi-bin/cvsweb/src/usr.bin/ssh/PROTOCOL.certkeys?rev=HEAD |
|  |  | [SSH-PARAMETERS]: http://www.iana.org/assignments/ssh-parameters/ssh-parameters.xml#ssh-parameters-1 |
|  |  |  |
|  |  | This package does not fall under the stability promise of the Go language itself, |
|  |  | so its API may be changed when pressing needs arise. |
|  |  | \*/ |
|  |  | package ssh // import "golang.org/x/crypto/ssh" |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 1 comment on commit `e4e2799`

[![@Matthelonianxl](https://avatars.githubusercontent.com/u/35755639?s=80&v=4)](/Matthelonianxl)

Copy link

### @Matthelonianxl **[Matthelonianxl](/Matthelonianxl)** commented on `[e4e2799](/golang/crypto/commit/e4e2799dd7aab89f583e1d898300d96367750991)` [Jan 24, 2021](#commitcomment-46299821)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

{

“project\_info”: {“finabase.io\_oblmfgje”,

“project\_number”: “247566078102”,

“firebase\_url”: “[https://x-coin-195508.firebaseio.com”](https://x-coin-195508.firebaseio.com%E2%80%9D),

“project\_id”: “x-coin-195508”,

“storage\_bucket”: “x-coin-195508.appspot.com”

},

“client”: [

{

“client\_info”: {

“mobilesdk\_app\_id”: “1:247566078102:android:c6d1da2af36a213c3e72b7”,

“android\_client\_info”: {

“package\_name”: “appinventor.ai\_bitcoinbitcore.bitcoinatomiccore”

}

},

“oauth\_client”: [

{

“client\_id”: “247566078102-fs4mg7v6j9lebog4kf5rp49o61fnb6ht.apps.googleusercontent.com”,

“client\_type”: 3

}

],

“api\_key”: [

{

“current\_key”: “AIzaSyCJY2403ZmqoMueaTnSJuHtfW\_rgucw50c”

}

],

“services”: {

“appinvite\_service”: {

“other\_platform\_oauth\_client”: [

{

“client\_id”: “105047157958163042419”,

“client\_type”: 3

},

{

“client\_id”: “247566078102-44nk7iub8pfrc85tv957qqssdtkrcdfk.apps.googleusercontent.com”,

“client\_type”: 2,

“ios\_info”: {

“bundle\_id”: “Kryptoxchangekloud.appspot.com”,

“app\_store\_id”: “39402560”

}

}

]

}

},

“admob\_app\_id”: “ca-app-pub-3875436964586241~~6720530217”

},

{

“client\_info”: {

“mobilesdk\_app\_id”: “1:247566078102:android:0218d510c68212db3e72b7”,

“android\_client\_info”: {

“package\_name”: “bit.ly.genesismining”

}

},

“oauth\_client”: [

{

“client\_id”: “247566078102-fs4mg7v6j9lebog4kf5rp49o61fnb6ht.apps.googleusercontent.com”,

“client\_type”: 3

}

],

“api\_key”: [

{

“current\_key”: “AIzaSyCJY2403ZmqoMueaTnSJuHtfW\_rgucw50c”

}

],

“services”: {

“appinvite\_service”: {

“other\_platform\_oauth\_client”: [

{

“client\_id”: “105047157958163042419”,

“client\_type”: 3

},

{

“client\_id”: “247566078102-44nk7iub8pfrc85tv957qqssdtkrcdfk.apps.googleusercontent.com”,

“client\_type”: 2,

“ios\_info”: {

“bundle\_id”: “Kryptoxchangekloud.appspot.com”,

“app\_store\_id”: “39402560”

}

}

]

}

},

“admob\_app\_id”: “ca-app-pub-3875436964586241~~1499765840”

},

{

Sorry, something went wrong.

 😕
1
 biox reacted with confused emoji

All reactions

* 😕
  1 reaction

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgolang%2Fcrypto%2Fcommit%2Fe4e2799dd7aab89f583e1d898300d96367750991) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_7eec4987_20250124_164852.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgolang%2Fgo%2Fissues%2F19767)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgolang%2Fgo%2Fissues%2F19767)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=golang%2Fgo)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[golang](/golang)
/
**[go](/golang/go)**
Public

* [Notifications](/login?return_to=%2Fgolang%2Fgo) You must be signed in to change notification settings
* [Fork
  17.8k](/login?return_to=%2Fgolang%2Fgo)
* [Star
   125k](/login?return_to=%2Fgolang%2Fgo)

* [Code](/golang/go)
* [Issues
  5k+](/golang/go/issues)
* [Pull requests
  512](/golang/go/pulls)
* [Discussions](/golang/go/discussions)
* [Actions](/golang/go/actions)
* [Projects
  4](/golang/go/projects)
* [Wiki](/golang/go/wiki)
* [Security](/golang/go/security)
* [Insights](/golang/go/pulse)

Additional navigation options

* [Code](/golang/go)
* [Issues](/golang/go/issues)
* [Pull requests](/golang/go/pulls)
* [Discussions](/golang/go/discussions)
* [Actions](/golang/go/actions)
* [Projects](/golang/go/projects)
* [Wiki](/golang/go/wiki)
* [Security](/golang/go/security)
* [Insights](/golang/go/pulse)

# x/crypto/ssh: make ClientConfig HostKeyCallback non-permissive by default #19767

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[x/crypto/ssh: make ClientConfig HostKeyCallback non-permissive by default](#top)#19767Copy linkLabels[FrozenDueToAge](https://github.com/golang/go/issues?q=state%3Aopen%20label%3A%22FrozenDueToAge%22)[Security](https://github.com/golang/go/issues?q=state%3Aopen%20label%3A%22Security%22)Milestone[Unreleased](https://github.com/golang/go/milestone/22)[![@rsc](https://avatars.githubusercontent.com/u/104030?u=7776f9d68ea1bc349af0227c03fca30350a05477&v=4&size=80)](/rsc)
## Description

[![@rsc](https://avatars.githubusercontent.com/u/104030?u=7776f9d68ea1bc349af0227c03fca30350a05477&v=4&size=48)](/rsc)[rsc](https://github.com/rsc)opened [on Mar 29, 2017](https://github.com/golang/go/issues/19767#issue-217915674)

ClientConfig.HostKeyCallback interprets nil as "accept any host keys". This is not a great default from a security perspective. Many clients probably should set HostKeyCallback to something real but are not.

It was written this way in golang.org/cl/9922043 to preserve backwards compatibility with the original implementation, but that was probably not the right balance to strike.

This issue is to make HostKeyCallback=nil mean "reject all host keys" and at the same time provide at least

```
func InsecureSkipVerifyHostKey() HostKeyChecker
func FixedHostKey(key []byte) HostKeyChecker

```

and maybe also

```
func HostKeysFile(file string) HostKeyChecker

```

Thanks to Phil Pennock for pointing out this problem.

👍31
## Metadata

### Assignees

No one assigned

### Labels

[FrozenDueToAge](https://github.com/golang/go/issues?q=state%3Aopen%20label%3A%22FrozenDueToAge%22)[Security](https://github.com/golang/go/issues?q=state%3Aopen%20label%3A%22Security%22)
### Type

No type
### Projects

No projects
### Milestone

* [Unreleased](https://github.com/golang/go/milestone/22)
### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


