=== Content from bugs.chromium.org_ce3b18d3_20250125_005903.html ===



=== Content from github.com_646b0976_20250125_005905.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Faawc%2Funrar%2Fcommit%2F0ff832d31470471803b175cfff4e40c1b08ee779)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Faawc%2Funrar%2Fcommit%2F0ff832d31470471803b175cfff4e40c1b08ee779)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=aawc%2Funrar)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[aawc](/aawc)
/
**[unrar](/aawc/unrar)**
Public

* [Notifications](/login?return_to=%2Faawc%2Funrar) You must be signed in to change notification settings
* [Fork
  29](/login?return_to=%2Faawc%2Funrar)
* [Star
   52](/login?return_to=%2Faawc%2Funrar)

* [Code](/aawc/unrar)
* [Issues
  0](/aawc/unrar/issues)
* [Pull requests
  1](/aawc/unrar/pulls)
* [Actions](/aawc/unrar/actions)
* [Projects
  0](/aawc/unrar/projects)
* [Security](/aawc/unrar/security)
* [Insights](/aawc/unrar/pulse)

Additional navigation options

* [Code](/aawc/unrar)
* [Issues](/aawc/unrar/issues)
* [Pull requests](/aawc/unrar/pulls)
* [Actions](/aawc/unrar/actions)
* [Projects](/aawc/unrar/projects)
* [Security](/aawc/unrar/security)
* [Insights](/aawc/unrar/pulse)

## Commit

[Permalink](/aawc/unrar/commit/0ff832d31470471803b175cfff4e40c1b08ee779)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

5.6.1.4: Use in-memory archive instead of file IO

[Browse files](/aawc/unrar/tree/0ff832d31470471803b175cfff4e40c1b08ee779)
Browse the repository at this point in the history

* Loading branch information

[![@aawc](https://avatars.githubusercontent.com/u/423205?s=40&v=4)](/aawc)

Varun Khaneja
authored and
[aawc](/aawc/unrar/commits?author=aawc "View all commits by aawc")
committed
Jan 4, 2018

1 parent
[637fc84](/aawc/unrar/commit/637fc8446edb8444c7a66918f109f2fa552ff987)

commit 0ff832d

 Show file tree

 Hide file tree

Showing
**22 changed files**
with
**233 additions**
and
**31 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* arccmt.cpp
  [arccmt.cpp](#diff-3f8eaf630f899b946146b42fffd05ecaa00c15493465b91d381930695d2f5c70)
* archive.cpp
  [archive.cpp](#diff-e1f7135c9eaa0f1bd7d99702ddf20dab4455bc80b54be2e9de1dec902b06ce38)
* archive.hpp
  [archive.hpp](#diff-2f7bf23a2e11d356bdd6935faf9dea4f421edac4618f8a20b39cef04f64225d6)
* arcmem.cpp
  [arcmem.cpp](#diff-450ec0edbc88aecfc2252b5ffa7991415edfccd057a6b5abf1dc0772a6c42228)
* arcmem.hpp
  [arcmem.hpp](#diff-2aabcd96d47f9d46a4caeee14fbd665045a1c8564ce9dbeaecb510f06ccbb0c3)
* arcread.cpp
  [arcread.cpp](#diff-05a9576de717d25ed013741b39fc97989f4ae8d329ee97411431ea667297ff63)
* cmddata.cpp
  [cmddata.cpp](#diff-2eb7bf8c2bb415129a9fc0c08b826865e6e5f586f949e9a57bb11b0bb539ed0b)
* compress.hpp
  [compress.hpp](#diff-c72719fac4c1e14b7a30bf02904564aa23573d8506ae858ccfcc18b86ab8f2d8)
* file.hpp
  [file.hpp](#diff-a8847a021dfe0da8d4edf0e63a4f908aae4bf91ae7db3752a46c288afe39eded)
* makefile
  [makefile](#diff-beda42571c095172ab63437d050612a571d0d9ddd3ad4f2aecbce907a9b7e3d0)
* options.hpp
  [options.hpp](#diff-acd0fcd5a9c688fcfa427ab4e3c4e85623d44d344ee9a15bca3dfbc94481bba5)
* qopen.cpp
  [qopen.cpp](#diff-ff7e8f95053ed8c02e4e8385d9b2567014ee09220fd5af5f01b1a5af7af01022)
* rar.cpp
  [rar.cpp](#diff-76aae3cd95dc84ea5f4ecbfceec45d22204753a68370ddeef8e70430a1bf1718)
* rar.hpp
  [rar.hpp](#diff-47ff0131ad7b2348cd593a1ffa31e199735cbcdc0e792cf5457a93141abf8f19)
* rardefs.hpp
  [rardefs.hpp](#diff-ff1b2b73a10f503e517ad2b5220104c80e08141eb71b3f3a2f2e958d00d005eb)
* recvol5.cpp
  [recvol5.cpp](#diff-0344a685399df7d06d85195ca399a8b35edfb8493aee83fa136aa388a1574f54)
* unicode.cpp
  [unicode.cpp](#diff-70eb27fba52eb29d31f61ec3d85c7864431a2f512d9d9a5a95021e7c679affb1)
* unpack.hpp
  [unpack.hpp](#diff-d0f3acd649ec32b3404dc17c02423a59b604f8ce2d4a2636b1ce09849747f61a)
* unpack30.cpp
  [unpack30.cpp](#diff-c78fa18570975878bdc32c4ba4a22682638f26320310be79e8ef042bb0a70763)
* unpack50.cpp
  [unpack50.cpp](#diff-17db259411c1e369a46fe0c8a1006502863e437b99c8d186993d2a3289cf1b96)
* unpack50mt.cpp
  [unpack50mt.cpp](#diff-f63aa9c0dbad93633e841bd188d6abdb888b819e543e719b5e15949980f6fcd5)
* unpackinline.cpp
  [unpackinline.cpp](#diff-a8836ce98e6e1741187d7edf94d051b9114460e3f698c2225a1e849901200c06)

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[arccmt.cpp](#diff-3f8eaf630f899b946146b42fffd05ecaa00c15493465b91d381930695d2f5c70 "arccmt.cpp")

Show comments

[View file](/aawc/unrar/blob/0ff832d31470471803b175cfff4e40c1b08ee779/arccmt.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -120,7 +120,7 @@ bool Archive::GetComment(Array<wchar> \*CmtData) |
|  |  | // 4x memory for OEM to UTF-8 output here. |
|  |  | OemToCharA((char \*)&CmtRaw[0],(char \*)&CmtRaw[0]); |
|  |  | #endif |
|  |  | CharToWide((char \*)&CmtRaw[0],CmtData->Addr(0),CmtLength); |
|  |  | CharToWide((char \*)&CmtRaw[0],CmtData->Addr(0),CmtData->Size()); |
|  |  | CmtData->Alloc(wcslen(CmtData->Addr(0))); |
|  |  | } |
|  |  | #endif |
| Expand Down | |  |

75 changes: 68 additions & 7 deletions

75
[archive.cpp](#diff-e1f7135c9eaa0f1bd7d99702ddf20dab4455bc80b54be2e9de1dec902b06ce38 "archive.cpp")

Show comments

[View file](/aawc/unrar/blob/0ff832d31470471803b175cfff4e40c1b08ee779/archive.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -3,6 +3,10 @@ |
|  |  | #include "arccmt.cpp" |
|  |  |  |
|  |  |  |
|  |  | #ifdef USE\_ARCMEM |
|  |  | #include "arcmem.cpp" |
|  |  | #endif |
|  |  |  |
|  |  | Archive::Archive(RAROptions \*InitCmd) |
|  |  | { |
|  |  | Cmd=NULL; // Just in case we'll have an exception in 'new' below. |
| Expand Down  Expand Up | | @@ -48,6 +52,10 @@ Archive::Archive(RAROptions \*InitCmd) |
|  |  |  |
|  |  | SilentOpen=false; |
|  |  |  |
|  |  | #ifdef USE\_QOPEN |
|  |  | ProhibitQOpen=false; |
|  |  | #endif |
|  |  |  |
|  |  | } |
|  |  |  |
|  |  |  |
| Expand Down  Expand Up | | @@ -294,39 +302,92 @@ uint Archive::FullHeaderSize(size\_t Size) |
|  |  |  |
|  |  |  |
|  |  |  |
|  |  | #ifdef USE\_QOPEN |
|  |  | bool Archive::Open(const wchar \*Name,uint Mode) |
|  |  | { |
|  |  | #ifdef USE\_QOPEN |
|  |  | // Important if we reuse Archive object and it has virtual QOpen |
|  |  | // file position not matching real. For example, for 'l -v volname'. |
|  |  | QOpen.Unload(); |
|  |  | #endif |
|  |  |  |
|  |  | #ifdef USE\_ARCMEM |
|  |  | if (Cmd->ArcInMem) |
|  |  | { |
|  |  | wcsncpyz(FileName,Name,ASIZE(FileName)); |
|  |  | ArcMem.Load(Cmd->ArcMemData,Cmd->ArcMemSize); |
|  |  | Cmd->SetArcInMem(NULL,0); // Return in memory data for first volume only, not for next volumes. |
|  |  | return true; |
|  |  | } |
|  |  | #endif |
|  |  |  |
|  |  | return File::Open(Name,Mode); |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  |  |
|  |  | bool Archive::Close() |
|  |  | { |
|  |  | #ifdef USE\_ARCMEM |
|  |  | if (ArcMem.Unload()) |
|  |  | return true; |
|  |  | #endif |
|  |  | return File::Close(); |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  |  |
|  |  | int Archive::Read(void \*Data,size\_t Size) |
|  |  | { |
|  |  | size\_t Result; |
|  |  | if (QOpen.Read(Data,Size,Result)) |
|  |  | return (int)Result; |
|  |  | #ifdef USE\_QOPEN |
|  |  | size\_t QResult; |
|  |  | if (QOpen.Read(Data,Size,QResult)) |
|  |  | return (int)QResult; |
|  |  | #endif |
|  |  | #ifdef USE\_ARCMEM |
|  |  | size\_t AResult; |
|  |  | if (ArcMem.Read(Data,Size,AResult)) |
|  |  | return (int)AResult; |
|  |  | #endif |
|  |  | return File::Read(Data,Size); |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | void Archive::Seek(int64 Offset,int Method) |
|  |  | { |
|  |  | if (!QOpen.Seek(Offset,Method)) |
|  |  | File::Seek(Offset,Method); |
|  |  | #ifdef USE\_QOPEN |
|  |  | if (QOpen.Seek(Offset,Method)) |
|  |  | return; |
|  |  | #endif |
|  |  | #ifdef USE\_ARCMEM |
|  |  | if (ArcMem.Seek(Offset,Method)) |
|  |  | return; |
|  |  | #endif |
|  |  | File::Seek(Offset,Method); |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | int64 Archive::Tell() |
|  |  | { |
|  |  | #ifdef USE\_QOPEN |
|  |  | int64 QPos; |
|  |  | if (QOpen.Tell(&QPos)) |
|  |  | return QPos; |
|  |  | #endif |
|  |  | #ifdef USE\_ARCMEM |
|  |  | int64 APos; |
|  |  | if (ArcMem.Tell(&APos)) |
|  |  | return APos; |
|  |  | #endif |
|  |  | return File::Tell(); |
|  |  | } |
|  |  | #endif |
|  |  |  |
|  |  |  |
|  |  |  |
|  |  | bool Archive::IsOpened() |
|  |  | { |
|  |  | #ifdef USE\_ARCMEM |
|  |  | if (ArcMem.IsLoaded()) |
|  |  | return true; |
|  |  | #endif |
|  |  | return File::IsOpened(); |
|  |  | }; |

9 changes: 8 additions & 1 deletion

9
[archive.hpp](#diff-2f7bf23a2e11d356bdd6935faf9dea4f421edac4618f8a20b39cef04f64225d6 "archive.hpp")

Show comments

[View file](/aawc/unrar/blob/0ff832d31470471803b175cfff4e40c1b08ee779/archive.hpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -55,6 +55,10 @@ class Archive:public File |
|  |  | bool SilentOpen; |
|  |  | #ifdef USE\_QOPEN |
|  |  | QuickOpen QOpen; |
|  |  | bool ProhibitQOpen; |
|  |  | #endif |
|  |  | #ifdef USE\_ARCMEM |
|  |  | ArcMemory ArcMem; |
|  |  | #endif |
|  |  | public: |
|  |  | Archive(RAROptions \*InitCmd=NULL); |
| Expand Down  Expand Up | | @@ -89,12 +93,15 @@ class Archive:public File |
|  |  | #if 0 |
|  |  | void GetRecoveryInfo(bool Required,int64 \*Size,int \*Percent); |
|  |  | #endif |
|  |  | #ifdef USE\_QOPEN |
|  |  | bool Open(const wchar \*Name,uint Mode=FMF\_READ); |
|  |  | bool Close(); |
|  |  | int Read(void \*Data,size\_t Size); |
|  |  | void Seek(int64 Offset,int Method); |
|  |  | int64 Tell(); |
|  |  | bool IsOpened(); |
|  |  | #ifdef USE\_QOPEN |
|  |  | void QOpenUnload() {QOpen.Unload();} |
|  |  | void SetProhibitQOpen(bool Mode) {ProhibitQOpen=Mode;} |
|  |  | #endif |
|  |  |  |
|  |  | BaseBlock ShortBlock; |
| Expand Down | |  |

62 changes: 62 additions & 0 deletions

62
[arcmem.cpp](#diff-450ec0edbc88aecfc2252b5ffa7991415edfccd057a6b5abf1dc0772a6c42228 "arcmem.cpp")

Show comments

[View file](/aawc/unrar/blob/0ff832d31470471803b175cfff4e40c1b08ee779/arcmem.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,62 @@ |
|  |  | ArcMemory::ArcMemory() |
|  |  | { |
|  |  | Loaded=false; |
|  |  | SeekPos=0; |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | void ArcMemory::Load(const byte \*Data,size\_t Size) |
|  |  | { |
|  |  | ArcData.Alloc(Size); |
|  |  | memcpy(&ArcData[0],Data,Size); |
|  |  | Loaded=true; |
|  |  | SeekPos=0; |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | bool ArcMemory::Unload() |
|  |  | { |
|  |  | if (!Loaded) |
|  |  | return false; |
|  |  | Loaded=false; |
|  |  | return true; |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | bool ArcMemory::Read(void \*Data,size\_t Size,size\_t &Result) |
|  |  | { |
|  |  | if (!Loaded) |
|  |  | return false; |
|  |  | Result=(size\_t)Min(Size,ArcData.Size()-SeekPos); |
|  |  | memcpy(Data,&ArcData[(size\_t)SeekPos],Result); |
|  |  | SeekPos+=Result; |
|  |  | return true; |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | bool ArcMemory::Seek(int64 Offset,int Method) |
|  |  | { |
|  |  | if (!Loaded) |
|  |  | return false; |
|  |  | if (Method==SEEK\_SET) |
|  |  | SeekPos=Min(Offset,ArcData.Size()); |
|  |  | else |
|  |  | if (Method==SEEK\_CUR || Method==SEEK\_END) |
|  |  | { |
|  |  | if (Method==SEEK\_END) |
|  |  | SeekPos=ArcData.Size(); |
|  |  | SeekPos+=(uint64)Offset; |
|  |  | if (SeekPos>ArcData.Size()) |
|  |  | SeekPos=Offset<0 ? 0 : ArcData.Size(); |
|  |  | } |
|  |  | return true; |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | bool ArcMemory::Tell(int64 \*Pos) |
|  |  | { |
|  |  | if (!Loaded) |
|  |  | return false; |
|  |  | \*Pos=SeekPos; |
|  |  | return true; |
|  |  | } |

22 changes: 22 additions & 0 deletions

22
[arcmem.hpp](#diff-2aabcd96d47f9d46a4caeee14fbd665045a1c8564ce9dbeaecb510f06ccbb0c3 "arcmem.hpp")

Show comments

[View file](/aawc/unrar/blob/0ff832d31470471803b175cfff4e40c1b08ee779/arcmem.hpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,22 @@ |
|  |  | #ifndef \_RAR\_ARCMEM\_ |
|  |  | #define \_RAR\_ARCMEM\_ |
|  |  |  |
|  |  | // Memory interface for software fuzzers. |
|  |  |  |
|  |  | class ArcMemory |
|  |  | { |
|  |  | private: |
|  |  | bool Loaded; |
|  |  | Array<byte> ArcData; |
|  |  | uint64 SeekPos; |
|  |  | public: |
|  |  | ArcMemory(); |
|  |  | void Load(const byte \*Data,size\_t Size); |
|  |  | bool Unload(); |
|  |  | bool IsLoaded() {return Loaded;} |
|  |  | bool Read(void \*Data,size\_t Size,size\_t &Result); |
|  |  | bool Seek(int64 Offset,int Method); |
|  |  | bool Tell(int64 \*Pos); |
|  |  | }; |
|  |  |  |
|  |  | #endif |

4 changes: 2 additions & 2 deletions

4
[arcread.cpp](#diff-05a9576de717d25ed013741b39fc97989f4ae8d329ee97411431ea667297ff63 "arcread.cpp")

Show comments

[View file](/aawc/unrar/blob/0ff832d31470471803b175cfff4e40c1b08ee779/arcread.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -757,7 +757,7 @@ size\_t Archive::ReadHeader50() |
|  |  | ProcessExtra50(&Raw,(size\_t)ExtraSize,&MainHead); |
|  |  |  |
|  |  | #ifdef USE\_QOPEN |
|  |  | if (MainHead.Locator && MainHead.QOpenOffset>0 && Cmd->QOpenMode!=QOPEN\_NONE) |
|  |  | if (!ProhibitQOpen && MainHead.Locator && MainHead.QOpenOffset>0 && Cmd->QOpenMode!=QOPEN\_NONE) |
|  |  | { |
|  |  | // We seek to QO block in the end of archive when processing |
|  |  | // QOpen.Load, so we need to preserve current block positions |
| Expand Down  Expand Up | | @@ -1091,7 +1091,7 @@ void Archive::ProcessExtra50(RawRead \*Raw,size\_t ExtraSize,BaseBlock \*bb) |
|  |  |  |
|  |  | wchar VerText[20]; |
|  |  | swprintf(VerText,ASIZE(VerText),L";%u",Version); |
|  |  | wcsncatz(FileHead.FileName,VerText,ASIZE(FileHead.FileName)); |
|  |  | wcsncatz(hd->FileName,VerText,ASIZE(hd->FileName)); |
|  |  | } |
|  |  | } |
|  |  | break; |
| Expand Down | |  |

8 changes: 4 additions & 4 deletions

8
[cmddata.cpp](#diff-2eb7bf8c2bb415129a9fc0c08b826865e6e5f586f949e9a57bb11b0bb539ed0b "cmddata.cpp")

Show comments

[View file](/aawc/unrar/blob/0ff832d31470471803b175cfff4e40c1b08ee779/cmddata.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -97,7 +97,7 @@ void CommandData::ParseArg(wchar \*Arg) |
|  |  | else |
|  |  | if (\*Command==0) |
|  |  | { |
|  |  | wcsncpy(Command,Arg,ASIZE(Command)); |
|  |  | wcsncpyz(Command,Arg,ASIZE(Command)); |
|  |  |  |
|  |  |  |
|  |  | \*Command=toupperw(\*Command); |
| Expand Down  Expand Up | | @@ -1194,8 +1194,8 @@ int CommandData::IsProcessFile(FileHeader &FileHead,bool \*ExactMatch,int MatchTy |
|  |  | { |
|  |  | if (MatchedArg!=NULL && MatchedArgSize>0) |
|  |  | \*MatchedArg=0; |
|  |  | if (wcslen(FileHead.FileName)>=NM) |
|  |  | return 0; |
|  |  | // if (wcslen(FileHead.FileName)>=NM) |
|  |  | // return 0; |
|  |  | bool Dir=FileHead.Dir; |
|  |  | if (ExclCheck(FileHead.FileName,Dir,false,true)) |
|  |  | return 0; |
| Expand Down  Expand Up | | @@ -1249,7 +1249,7 @@ void CommandData::ProcessCommand() |
|  |  | wcsncpyz(ArcName,Name,ASIZE(ArcName)); |
|  |  | } |
|  |  |  |
|  |  | if (wcschr(L"AFUMD",\*Command)==NULL) |
|  |  | if (wcschr(L"AFUMD",\*Command)==NULL && !ArcInMem) |
|  |  | { |
|  |  | if (GenerateArcName) |
|  |  | GenerateArchiveName(ArcName,ASIZE(ArcName),GenerateMask,false); |
| Expand Down | |  |

9 changes: 9 additions & 0 deletions

9
[compress.hpp](#diff-c72719fac4c1e14b7a30bf02904564aa23573d8506ae858ccfcc18b86ab8f2d8 "compress.hpp")

Show comments

[View file](/aawc/unrar/blob/0ff832d31470471803b175cfff4e40c1b08ee779/compress.hpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -6,7 +6,16 @@ |
|  |  | class PackDef |
|  |  | { |
|  |  | public: |
|  |  | // Maximum LZ match length we can encode even for short distances. |
|  |  | static const uint MAX\_LZ\_MATCH = 0x1001; |
|  |  |  |
|  |  | // We increment LZ match length for longer distances, because shortest |
|  |  | // matches are not allowed for them. Maximum length increment is 3 |
|  |  | // for distances larger than 256KB (0x40000). Here we define the maximum |
|  |  | // incremented LZ match. Normally packer does not use it, but we must be |
|  |  | // ready to process it in corrupt archives. |
|  |  | static const uint MAX\_INC\_LZ\_MATCH = MAX\_LZ\_MATCH + 3; |
|  |  |  |
|  |  | static const uint MAX3\_LZ\_MATCH = 0x101; // Maximum match length for RAR v3. |
|  |  | static const uint LOW\_DIST\_REP\_COUNT = 16; |
|  |  |  |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[file.hpp](#diff-a8847a021dfe0da8d4edf0e63a4f908aae4bf91ae7db3752a46c288afe39eded "file.hpp")

Show comments

[View file](/aawc/unrar/blob/0ff832d31470471803b175cfff4e40c1b08ee779/file.hpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -78,7 +78,7 @@ class File |
|  |  | bool Create(const wchar \*Name,uint Mode=FMF\_UPDATE|FMF\_SHAREREAD); |
|  |  | void TCreate(const wchar \*Name,uint Mode=FMF\_UPDATE|FMF\_SHAREREAD); |
|  |  | bool WCreate(const wchar \*Name,uint Mode=FMF\_UPDATE|FMF\_SHAREREAD); |
|  |  | bool Close(); |
|  |  | virtual bool Close(); |
|  |  | bool Delete(); |
|  |  | bool Rename(const wchar \*NewName); |
|  |  | bool Write(const void \*Data,size\_t Size); |
| Expand All | | @@ -96,7 +96,7 @@ class File |
|  |  | void SetCloseFileTime(RarTime \*ftm,RarTime \*fta=NULL); |
|  |  | static void SetCloseFileTimeByName(const wchar \*Name,RarTime \*ftm,RarTime \*fta); |
|  |  | void GetOpenFileTime(RarTime \*ft); |
|  |  | bool IsOpened() {return hFile!=FILE\_BAD\_HANDLE;}; |
|  |  | virtual bool IsOpened() {return hFile!=FILE\_BAD\_HANDLE;}; |
|  |  | int64 FileLength(); |
|  |  | void SetHandleType(FILE\_HANDLETYPE Type) {HandleType=Type;} |
|  |  | FILE\_HANDLETYPE GetHandleType() {return HandleType;} |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[makefile](#diff-beda42571c095172ab63437d050612a571d0d9ddd3ad4f2aecbce907a9b7e3d0 "makefile")

Show comments

[View file](/aawc/unrar/blob/0ff832d31470471803b175cfff4e40c1b08ee779/makefile)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -3,7 +3,7 @@ |
|  |  |  |
|  |  | # Linux using GCC |
|  |  | CXX=c++ |
|  |  | CXXFLAGS=-O2 |
|  |  | CXXFLAGS=-O2 -Wno-logical-op-parentheses -Wno-switch -Wno-dangling-else |
|  |  | LIBFLAGS=-fPIC |
|  |  | DEFINES=-D\_FILE\_OFFSET\_BITS=64 -D\_LARGEFILE\_SOURCE -DRAR\_SMP |
|  |  | STRIP=strip |
| Expand Down | |  |

16 changes: 15 additions & 1 deletion

16
[options.hpp](#diff-acd0fcd5a9c688fcfa427ab4e3c4e85623d44d344ee9a15bca3dfbc94481bba5 "options.hpp")

Show comments

[View file](/aawc/unrar/blob/0ff832d31470471803b175cfff4e40c1b08ee779/options.hpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -89,10 +89,24 @@ class RAROptions |
|  |  | bool InclAttrSet; |
|  |  | size\_t WinSize; |
|  |  | wchar TempPath[NM]; |
|  |  | #ifdef USE\_QOPEN |
|  |  | wchar SFXModule[NM]; |
|  |  |  |
|  |  | #ifdef USE\_QOPEN |
|  |  | QOPEN\_MODE QOpenMode; |
|  |  | #endif |
|  |  |  |
|  |  | bool ArcInMem; |
|  |  | #ifdef USE\_ARCMEM |
|  |  | void SetArcInMem(byte \*Data,size\_t Size) |
|  |  | { |
|  |  | ArcMemData=Data; |
|  |  | ArcMemSize=Size; |
|  |  | ArcInMem=Data!=NULL && Size>0; |
|  |  | } |
|  |  | byte \*ArcMemData; |
|  |  | size\_t ArcMemSize; |
|  |  | #endif |
|  |  |  |
|  |  | bool ConfigDisabled; // Switch -cfg-. |
|  |  | wchar ExtrPath[NM]; |
|  |  | wchar CommentFile[NM]; |
| Expand Down | |  |

17 changes: 15 additions & 2 deletions

17
[qopen.cpp](#diff-ff7e8f95053ed8c02e4e8385d9b2567014ee09220fd5af5f01b1a5af7af01022 "qopen.cpp")

Show comments

[View file](/aawc/unrar/blob/0ff832d31470471803b175cfff4e40c1b08ee779/qopen.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -61,14 +61,27 @@ void QuickOpen::Close() |
|  |  |  |
|  |  | void QuickOpen::Load(uint64 BlockPos) |
|  |  | { |
|  |  | if (!Loaded) // If loading the first time, perform additional intialization. |
|  |  | if (!Loaded) |
|  |  | { |
|  |  | // If loading for the first time, perform additional intialization. |
|  |  | SeekPos=Arc->Tell(); |
|  |  | UnsyncSeekPos=false; |
|  |  |  |
|  |  | SaveFilePos SavePos(\*Arc); |
|  |  | Arc->Seek(BlockPos,SEEK\_SET); |
|  |  | if (Arc->ReadHeader()==0 || Arc->GetHeaderType()!=HEAD\_SERVICE || |
|  |  |  |
|  |  | // If BlockPos points to original main header, we'll have the infinite |
|  |  | // recursion, because ReadHeader() for main header will attempt to load |
|  |  | // QOpen and call QuickOpen::Load again. If BlockPos points to long chain |
|  |  | // of other main headers, we'll have multiple recursive calls of this |
|  |  | // function wasting resources. So we prohibit QOpen temporarily to |
|  |  | // prevent this. ReadHeader() calls QOpen.Init and sets MainHead Locator |
|  |  | // and QOpenOffset fields, so we cannot use them to prohibit QOpen. |
|  |  | Arc->SetProhibitQOpen(true); |
|  |  | size\_t ReadSize=Arc->ReadHeader(); |
|  |  | Arc->SetProhibitQOpen(false); |
|  |  |  |
|  |  | if (ReadSize==0 || Arc->GetHeaderType()!=HEAD\_SERVICE || |
|  |  | !Arc->SubHead.CmpName(SUBHEAD\_TYPE\_QOPEN)) |
|  |  | return; |
|  |  | QLHeaderPos=Arc->CurBlockPos; |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `0ff832d`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Faawc%2Funrar%2Fcommit%2F0ff832d31470471803b175cfff4e40c1b08ee779) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_6f6804e4_20250125_005906.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoogle%2Foss-fuzz-vulns%2Fblob%2Fmain%2Fvulns%2Funrar%2FOSV-2017-104.yaml)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoogle%2Foss-fuzz-vulns%2Fblob%2Fmain%2Fvulns%2Funrar%2FOSV-2017-104.yaml)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=google%2Foss-fuzz-vulns)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[google](/google)
/
**[oss-fuzz-vulns](/google/oss-fuzz-vulns)**
Public

* [Notifications](/login?return_to=%2Fgoogle%2Foss-fuzz-vulns) You must be signed in to change notification settings
* [Fork
  39](/login?return_to=%2Fgoogle%2Foss-fuzz-vulns)
* [Star
   144](/login?return_to=%2Fgoogle%2Foss-fuzz-vulns)

* [Code](/google/oss-fuzz-vulns)
* [Issues
  1](/google/oss-fuzz-vulns/issues)
* [Pull requests
  1](/google/oss-fuzz-vulns/pulls)
* [Actions](/google/oss-fuzz-vulns/actions)
* [Projects
  0](/google/oss-fuzz-vulns/projects)
* [Security](/google/oss-fuzz-vulns/security)
* [Insights](/google/oss-fuzz-vulns/pulse)

Additional navigation options

* [Code](/google/oss-fuzz-vulns)
* [Issues](/google/oss-fuzz-vulns/issues)
* [Pull requests](/google/oss-fuzz-vulns/pulls)
* [Actions](/google/oss-fuzz-vulns/actions)
* [Projects](/google/oss-fuzz-vulns/projects)
* [Security](/google/oss-fuzz-vulns/security)
* [Insights](/google/oss-fuzz-vulns/pulse)

## Files

 main
## Breadcrumbs

1. [oss-fuzz-vulns](/google/oss-fuzz-vulns/tree/main)
2. /[vulns](/google/oss-fuzz-vulns/tree/main/vulns)
3. /[unrar](/google/oss-fuzz-vulns/tree/main/vulns/unrar)
/
# OSV-2017-104.yaml

Copy path Blame  Blame
## Latest commit

## History

[History](/google/oss-fuzz-vulns/commits/main/vulns/unrar/OSV-2017-104.yaml)33 lines (32 loc) · 910 Bytes main
## Breadcrumbs

1. [oss-fuzz-vulns](/google/oss-fuzz-vulns/tree/main)
2. /[vulns](/google/oss-fuzz-vulns/tree/main/vulns)
3. /[unrar](/google/oss-fuzz-vulns/tree/main/vulns/unrar)
/
# OSV-2017-104.yaml

Top
## File metadata and controls

* Code
* Blame

33 lines (32 loc) · 910 Bytes[Raw](https://github.com/google/oss-fuzz-vulns/raw/refs/heads/main/vulns/unrar/OSV-2017-104.yaml)123456789101112131415161718192021222324252627282930313233id: OSV-2017-104summary: Heap-buffer-overflow in Unpack::CopyStringdetails: | OSS-Fuzz report: https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=4373
 ``` Crash type: Heap-buffer-overflow WRITE 1 Crash state: Unpack::CopyString Unpack::Unpack5 CmdExtract::ExtractCurrentFile ```modified: '2022-04-13T03:04:35.305586Z'published: '2021-01-13T21:57:43.088460Z'references:- type: REPORT url: https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=4373affected:- package: name: unrar ecosystem: OSS-Fuzz ranges: - type: GIT repo: https://github.com/aawc/unrar.git events: - introduced: d2e5341ebf6f34c9bd5939c3ac812cb2cd983081 - fixed: 0ff832d31470471803b175cfff4e40c1b08ee779 versions: - 5.6.1.2 - 5.6.1.3 ecosystem\_specific: introduced\_range: 2a079823c708a637bc36e888180ebb96fdfba526:1d8ea7923dae7c8f136912b6bdca95dcb52e80bc severity: HIGH

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


