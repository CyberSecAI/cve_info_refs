=== Content from sourceware.org_bb07dfd1_20250125_012610.html ===


Sourceware Bugzilla – Bug 21600
Fail to detect invalid FDE header, can exhaust gdb process's virtual memory and terminate debug session
Last modified: 2019-04-25 14:36:45 UTC

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=21600&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=21600&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 21600**](show_bug.cgi?id=21600)
- Fail to detect invalid FDE header, can exhaust gdb process's virtual memory and terminate debug session

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
Fail to detect invalid FDE header, can exhaust gdb process's virtual memory a...

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | gdb | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=gdb "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | backtrace ([show other bugs](buglist.cgi?component=backtrace&product=gdb&bug_status=__open__)) | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | HEAD | |  | | | [Importance](page.cgi?id=fields.html#importance): | P2 normal | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Not yet assigned to anyone | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2017-06-15 02:22 UTC by Kang | | --- | --- | | Modified: | 2019-04-25 14:36 UTC ([History](show_activity.cgi?id=21600)) | | CC List: | 2 users (show)  sergiodj simark | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Host:](page.cgi?id=fields.html#cf_gcchost "A custom Free Text field in this installation of Bugzilla.") |  | | [Target:](page.cgi?id=fields.html#cf_gcctarget "A custom Free Text field in this installation of Bugzilla.") |  | | [Build:](page.cgi?id=fields.html#cf_gccbuild "A custom Free Text field in this installation of Bugzilla.") |  | | [Last reconfirmed:](page.cgi?id=fields.html#cf_reconfirmed_on "A custom Date/Time field in this installation of Bugzilla.") |  | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [**malformed core file**](attachment.cgi?id=10141 "View the content of the attachment") (10.71 KB, application/x-core)  [2017-06-15 02:23 UTC](#attach_10141 "Go to the comment associated with the attachment"), Kang | [Details](attachment.cgi?id=10141&action=edit) | | [**a regular ELF file (cb), used to load with the core file**](attachment.cgi?id=10142 "View the content of the attachment") (290.12 KB, application/x-executable)  [2017-06-15 02:24 UTC](#attach_10142 "Go to the comment associated with the attachment"), Kang | [Details](attachment.cgi?id=10142&action=edit) | | [**a malformed ELF file**](attachment.cgi?id=10143 "View the content of the attachment") (1.57 KB, application/x-executable)  [2017-06-15 02:26 UTC](#attach_10143 "Go to the comment associated with the attachment"), Kang | [Details](attachment.cgi?id=10143&action=edit) | | [**sample patch file**](attachment.cgi?id=10144 "View the content of the attachment") (242 bytes, patch)  [2017-06-15 02:28 UTC](#attach_10144 "Go to the comment associated with the attachment"), Kang | [Details](attachment.cgi?id=10144&action=edit) | [Diff](attachment.cgi?id=10144&action=diff) | | [**screenshot or gdb failure when open core file**](attachment.cgi?id=10145 "View the content of the attachment") (482.91 KB, image/png)  [2017-06-15 02:29 UTC](#attach_10145 "Go to the comment associated with the attachment"), Kang | [Details](attachment.cgi?id=10145&action=edit) | | [**screenshot when gdb fails during debugging**](attachment.cgi?id=10146 "View the content of the attachment") (367.24 KB, image/png)  [2017-06-15 02:30 UTC](#attach_10146 "Go to the comment associated with the attachment"), Kang | [Details](attachment.cgi?id=10146&action=edit) | | [**attachment-95212-0.html**](attachment.cgi?id=10148 "View the content of the attachment") (487 bytes, text/html)  [2017-06-15 20:02 UTC](#attach_10148 "Go to the comment associated with the attachment"), Kang | [Details](attachment.cgi?id=10148&action=edit) | | [View All](attachment.cgi?bugid=21600&action=viewall)  [Add an attachment](attachment.cgi?bugid=21600&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=21600&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=21600#c0)  Kang    2017-06-15 02:22:13 UTC  ``` GDB fails to catch an invalid length informaiton in dwarf debug frame FDE headers. A carefully created ELF file or core file can cause gdb to terminate the debug session due to memory exhausted error.  This bug was found by Kang Li <kanglictf@gmail.com> and Yue Yin <yinyueacm@gmail.com>.  We also thank Guodong Zhu for help troubleshooting.  This bug was found and verified on 32-bit Ubuntu 14.04 LTS (and tested on Ubuntu 12.04.5 as well)  The software was checkout from git://sourceware.org/git/binutils-gdb.git  on 2017/06/14 and the latest commit f7e16c2a9cc405707e646e951397938d2b4eea48  The package was built with gcc 4.8.3 .   * Two ways to reproduce the error    Method A:    1. Use gdb to open a malformed core file (file cb and core are in attachment)   $ gdb cb core 	   2. after sometime, gdb will show virtual memory exhausted error.      Method B:    1. Use gdb to load a malformed ELF binary (file trouble_bin is in attachment)   $ gdb trouble_bin 	   2. Set a breakpoint. It does not matter where as long as it will be hit at run time.      In this example, we put a breakpoint at the start of .init section.    (gdb) br *0x80482b0		     3. run and gdb will show virtual memory exhausted error after it hit a breakpoint. ```  [Comment 1](show_bug.cgi?id=21600#c1)  Kang    2017-06-15 02:23:46 UTC  ``` Created [attachment 10141](attachment.cgi?id=10141 "malformed core file") [[details]](attachment.cgi?id=10141&action=edit "malformed core file") malformed core file  gdb runs into error when open this file along with the normal binary (the attachment called cb) ```  [Comment 2](show_bug.cgi?id=21600#c2)  Kang    2017-06-15 02:24:51 UTC  ``` Created [attachment 10142](attachment.cgi?id=10142 "a regular ELF file (cb), used to load with the core file") [[details]](attachment.cgi?id=10142&action=edit "a regular ELF file (cb), used to load with the core file") a regular ELF file (cb), used to load with the core file  use gdb to load this ELF and the core file together. ```  [Comment 3](show_bug.cgi?id=21600#c3)  Kang    2017-06-15 02:26:32 UTC  ``` Created [attachment 10143](attachment.cgi?id=10143 "a malformed ELF file") [[details]](attachment.cgi?id=10143&action=edit "a malformed ELF file") a malformed ELF file  gdb shows error message after run this with a breakpoint. ```  [Comment 4](show_bug.cgi?id=21600#c4)  Kang    2017-06-15 02:28:22 UTC  ``` Created [attachment 10144](attachment.cgi?id=10144&action=diff "sample patch file") [[details]](attachment.cgi?id=10144&action=edit "sample patch file") sample patch file ```  [Comment 5](show_bug.cgi?id=21600#c5)  Kang    2017-06-15 02:29:54 UTC  ``` Created [attachment 10145](attachment.cgi?id=10145 "screenshot or gdb failure when open core file") [[details]](attachment.cgi?id=10145&action=edit "screenshot or gdb failure when open core file") screenshot or gdb failure when open core file ```  [Comment 6](show_bug.cgi?id=21600#c6)  Kang    2017-06-15 02:30:32 UTC  ``` Created [attachment 10146](attachment.cgi?id=10146 "screenshot when gdb fails during debugging") [[details]](attachment.cgi?id=10146&action=edit "screenshot when gdb fails during debugging") screenshot when gdb fails during debugging ```  [Comment 7](show_bug.cgi?id=21600#c7)  Sergio Durigan Junior    2017-06-15 16:58:22 UTC  ``` Thanks for the bug report.  I see you have a possible patch to fix this issue, and it is rather trivial (in the sense that it just modifies a few lines of code).  In this case, I would suggest you to submit the patch, along with a description of what it does, to gdb-patches@sourceware.org.  We have a wiki page which contains a contribution checklist: <https://sourceware.org/gdb/wiki/ContributionChecklist>.  Thanks. ```  [Comment 8](show_bug.cgi?id=21600#c8)  Sergio Durigan Junior    2017-06-15 19:51:45 UTC  ``` BTW, bug is confirmed on i686 targets. ```  [Comment 9](show_bug.cgi?id=21600#c9)  Kang    2017-06-15 20:02:05 UTC  ``` Created [attachment 10148](attachment.cgi?id=10148 "attachment-95212-0.html") [[details]](attachment.cgi?id=10148&action=edit "attachment-95212-0.html") attachment-95212-0.html  Got it!   Will check how to fix this.  On Thu, Jun 15, 2017 at 3:51 PM, sergiodj at redhat dot com < sourceware-bugzilla@sourceware.org> wrote:  > [https://sourceware.org/bugzilla/show_bug.cgi?id=21600](show_bug.cgi?id=21600 "RESOLVED FIXED - Fail to detect invalid FDE header, can exhaust gdb process's virtual memory and terminate debug session") > > --- [Comment #8](show_bug.cgi?id=21600#c8) from Sergio Durigan Junior <sergiodj at redhat dot com> --- > BTW, bug is confirmed on i686 targets. > > -- > You are receiving this mail because: > You reported the bug. > ```  [Comment 10](show_bug.cgi?id=21600#c10)  Kang    2017-06-15 20:09:37 UTC  ``` BTW, we just tested on earlier version of gdb (7.4 & 7.7).  The bug affects earlier versions of gdb as well,  i.e. malformed/malicious ELF binaries can prevent gdb from debugging by forcing session termination.  We will work on a new patch. ```  [Comment 11](show_bug.cgi?id=21600#c11)  Sourceware Commits    2019-04-25 14:33:51 UTC  ``` The master branch has been updated by Sandra Loosemore <sandra@sourceware.org>:  <https://sourceware.org/git/gitweb.cgi?p=binutils-gdb.git;h=723adb650a31859d7cc45832cb8adca0206455ed>  commit 723adb650a31859d7cc45832cb8adca0206455ed Author: Sandra Loosemore <sandra@codesourcery.com> Date:   Thu Apr 25 07:27:02 2019 -0700      Detect invalid length field in debug frame FDE header.          GDB was failing to catch cases where a corrupt ELF or core file     contained an invalid length value in a Dwarf debug frame FDE header.     It was checking for buffer overflow but not cases where the length was     negative or caused pointer wrap-around.          In addition to the additional validity check, this patch cleans up the     multiple signed/unsigned conversions on the length field so that an     unsigned representation is used consistently throughout.          This patch fixes CVE-2017-9778 and [PR gdb/21600](show_bug.cgi?id=21600 "RESOLVED FIXED - Fail to detect invalid FDE header, can exhaust gdb process's virtual memory and terminate debug session").          2019-04-25  Sandra Loosemore  <sandra@codesourcery.com>     	    Kang Li <kanglictf@gmail.com>          	[PR gdb/21600](show_bug.cgi?id=21600 "RESOLVED FIXED - Fail to detect invalid FDE header, can exhaust gdb process's virtual memory and terminate debug session")          	* dwarf2-frame.c (read_initial_length): Be consistent about using     	unsigned representation of length.     	(decode_frame_entry_1): Likewise.  Check for wraparound of     	end pointer as well as buffer overflow. ```  [Comment 12](show_bug.cgi?id=21600#c12)  Simon Marchi    2019-04-25 14:36:45 UTC  ``` Should be fixed by commit mentioned above. ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=21600)
* - [XML](show_bug.cgi?ctype=xml&id=21600)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=21600)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=21600&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=21600&GoAheadAndLogIn=1#forgot)
    Login:

    [x]


