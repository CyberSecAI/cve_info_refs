=== Content from github.com_560e246f_20250124_215440.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F6aeb75e6adfaed16e58780309613a578fe1ee90b)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F6aeb75e6adfaed16e58780309613a578fe1ee90b)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.9k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  437](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/6aeb75e6adfaed16e58780309613a578fe1ee90b)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

USB: serial: io\_ti: fix div-by-zero in set\_termios

[Browse files](/torvalds/linux/tree/6aeb75e6adfaed16e58780309613a578fe1ee90b)
Browse the repository at this point in the history

```
Fix a division-by-zero in set_termios when debugging is enabled and a
high-enough speed has been requested so that the divisor value becomes
zero.

Instead of just fixing the offending debug statement, cap the baud rate
at the base as a zero divisor value also appears to crash the firmware.

Fixes: [1da177e](https://github.com/torvalds/linux/commit/1da177e4c3f41524e886b7f1b8a0c1fc7321cac2) ("Linux-2.6.12-rc2")
Cc: stable <stable@vger.kernel.org>     # 2.6.12
Reviewed-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Johan Hovold <johan@kernel.org>
```

* Loading branch information

[![@jhovold](https://avatars.githubusercontent.com/u/601896?s=40&v=4)](/jhovold)

[jhovold](/torvalds/linux/commits?author=jhovold "View all commits by jhovold")
committed
May 15, 2017

1 parent
[26cede3](/torvalds/linux/commit/26cede343656c0bc2c33cdc783771282405c7fb2)

commit 6aeb75e

Showing
**1 changed file**
with
**4 additions**
and
**1 deletion**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

5 changes: 4 additions & 1 deletion

5
[drivers/usb/serial/io\_ti.c](#diff-b920568c8fc0dccfaa3fb5c61543013b5ea98f2c730264b92586d76488a9794c "drivers/usb/serial/io_ti.c")

Show comments

[View file](/torvalds/linux/blob/6aeb75e6adfaed16e58780309613a578fe1ee90b/drivers/usb/serial/io_ti.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2336,8 +2336,11 @@ static void change\_port\_settings(struct tty\_struct \*tty, |
|  |  | if (!baud) { |
|  |  | /\* pick a default, any default... \*/ |
|  |  | baud = 9600; |
|  |  | } else |
|  |  | } else { |
|  |  | /\* Avoid a zero divisor. \*/ |
|  |  | baud = min(baud, 461550); |
|  |  | tty\_encode\_baud\_rate(tty, baud, baud); |
|  |  | } |
|  |  |  |
|  |  | edge\_port->baud\_rate = baud; |
|  |  | config->wBaudRate = (\_\_u16)((461550L + baud/2) / baud); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `6aeb75e`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F6aeb75e6adfaed16e58780309613a578fe1ee90b) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from usn.ubuntu.com_cb4398a8_20250124_215441.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-3933-1: Linux kernel vulnerabilities

2 April 2019

Several security issues were fixed in the Linux kernel.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 14.04 ESM](/security/notices?release=trusty)

## Packages

* [linux](/security/cves?package=linux) - Linux kernel

## Details

It was discovered that an information leak vulnerability existed in the

Bluetooth implementation of the Linux kernel. An attacker within Bluetooth

range could possibly expose sensitive information (kernel memory).

([CVE-2017-1000410](/security/CVE-2017-1000410))

It was discovered that the USB serial device driver in the Linux kernel did

not properly validate baud rate settings when debugging is enabled. A local

attacker could use this to cause a denial of service (system crash).

([CVE-2017-18360](/security/CVE-2017-18360))

Mathias Payer and Hui Peng discovered a use-after-free vulnerability in the

Advanced Linux Sound Architecture (ALSA) subsystem. A physically proximate

attacker could use this to cause a denial of service (system crash).

([CVE-2018-19824](/security/CVE-2018-19824))

Shlomi Oberman, Yuli Shapiro, and Ran Menscher discovered an information

leak in the Bluetooth implementation of the Linux kernel. An attacker

within Bluetooth range could use this to expose sensitive information

(kernel memory). ([CVE-2019-3459](/security/CVE-2019-3459), [CVE-2019-3460](/security/CVE-2019-3460))

Jann Horn discovered that the KVM implementation in the Linux kernel

contained a use-after-free vulnerability. An attacker in a guest VM with

access to /dev/kvm could use this to cause a denial of service (guest VM

crash). ([CVE-2019-6974](/security/CVE-2019-6974))

Felix Wilhelm discovered that an information leak vulnerability existed in

the KVM subsystem of the Linux kernel, when nested virtualization is used.

A local attacker could use this to expose sensitive information (host

system memory to a guest VM). ([CVE-2019-7222](/security/CVE-2019-7222))

Jann Horn discovered that the mmap implementation in the Linux kernel did

not properly check for the mmap minimum address in some situations. A local

attacker could use this to assist exploiting a kernel NULL pointer

dereference vulnerability. ([CVE-2019-9213](/security/CVE-2019-9213))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 14.04

* [linux-image-3.13.0-168-generic](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.13.0-168.218](https://launchpad.net/ubuntu/%2Bsource/linux/3.13.0-168.218)
* [linux-image-3.13.0-168-generic-lpae](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.13.0-168.218](https://launchpad.net/ubuntu/%2Bsource/linux/3.13.0-168.218)
* [linux-image-3.13.0-168-lowlatency](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.13.0-168.218](https://launchpad.net/ubuntu/%2Bsource/linux/3.13.0-168.218)
* [linux-image-3.13.0-168-powerpc-e500](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.13.0-168.218](https://launchpad.net/ubuntu/%2Bsource/linux/3.13.0-168.218)
* [linux-image-3.13.0-168-powerpc-e500mc](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.13.0-168.218](https://launchpad.net/ubuntu/%2Bsource/linux/3.13.0-168.218)
* [linux-image-3.13.0-168-powerpc-smp](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.13.0-168.218](https://launchpad.net/ubuntu/%2Bsource/linux/3.13.0-168.218)
* [linux-image-3.13.0-168-powerpc64-emb](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.13.0-168.218](https://launchpad.net/ubuntu/%2Bsource/linux/3.13.0-168.218)
* [linux-image-3.13.0-168-powerpc64-smp](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.13.0-168.218](https://launchpad.net/ubuntu/%2Bsource/linux/3.13.0-168.218)
* [linux-image-generic](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.13.0.168.179](https://launchpad.net/ubuntu/%2Bsource/linux/3.13.0-168.218)
* [linux-image-generic-lpae](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.13.0.168.179](https://launchpad.net/ubuntu/%2Bsource/linux/3.13.0-168.218)
* [linux-image-lowlatency](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.13.0.168.179](https://launchpad.net/ubuntu/%2Bsource/linux/3.13.0-168.218)
* [linux-image-powerpc-e500](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.13.0.168.179](https://launchpad.net/ubuntu/%2Bsource/linux/3.13.0-168.218)
* [linux-image-powerpc-e500mc](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.13.0.168.179](https://launchpad.net/ubuntu/%2Bsource/linux/3.13.0-168.218)
* [linux-image-powerpc-smp](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.13.0.168.179](https://launchpad.net/ubuntu/%2Bsource/linux/3.13.0-168.218)
* [linux-image-powerpc64-emb](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.13.0.168.179](https://launchpad.net/ubuntu/%2Bsource/linux/3.13.0-168.218)
* [linux-image-powerpc64-smp](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.13.0.168.179](https://launchpad.net/ubuntu/%2Bsource/linux/3.13.0-168.218)
* [linux-image-virtual](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.13.0.168.179](https://launchpad.net/ubuntu/%2Bsource/linux/3.13.0-168.218)

After a standard system update you need to reboot your computer to make

all the necessary changes.

ATTENTION: Due to an unavoidable ABI change the kernel updates have

been given a new version number, which requires you to recompile and

reinstall all third party kernel modules you might have installed.

Unless you manually uninstalled the standard kernel metapackages

(e.g. linux-generic, linux-generic-lts-RELEASE, linux-virtual,

linux-powerpc), a standard system upgrade will automatically perform

this as well.

## References

* [CVE-2017-1000410](/security/CVE-2017-1000410)
* [CVE-2017-18360](/security/CVE-2017-18360)
* [CVE-2018-19824](/security/CVE-2018-19824)
* [CVE-2019-3459](/security/CVE-2019-3459)
* [CVE-2019-3460](/security/CVE-2019-3460)
* [CVE-2019-6974](/security/CVE-2019-6974)
* [CVE-2019-7222](/security/CVE-2019-7222)
* [CVE-2019-9213](/security/CVE-2019-9213)

## Related notices

* [USN-3933-2](/security/notices/USN-3933-2)
* [USN-3930-2](/security/notices/USN-3930-2)
* [USN-3879-1](/security/notices/USN-3879-1)
* [USN-3879-2](/security/notices/USN-3879-2)
* [USN-3930-1](/security/notices/USN-3930-1)
* [USN-3931-2](/security/notices/USN-3931-2)
* [USN-3931-1](/security/notices/USN-3931-1)
* [USN-3932-1](/security/notices/USN-3932-1)
* [USN-3932-2](/security/notices/USN-3932-2)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from usn.ubuntu.com_c8da14f5_20250124_215442.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-3933-2: Linux kernel (Trusty HWE) vulnerabilities

2 April 2019

Several security issues were fixed in the Linux kernel.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 12.04](/security/notices?release=precise)

## Packages

* [linux-lts-trusty](/security/cves?package=linux-lts-trusty) - Linux hardware enablement kernel from Trusty for Precise ESM

## Details

USN-3933-1 fixed vulnerabilities in the Linux kernel for Ubuntu 14.04

LTS. This update provides the corresponding updates for the Linux

Hardware Enablement (HWE) kernel from Ubuntu 14.04 LTS for Ubuntu

12.04 ESM.

It was discovered that an information leak vulnerability existed in the

Bluetooth implementation of the Linux kernel. An attacker within Bluetooth

range could possibly expose sensitive information (kernel memory).

([CVE-2017-1000410](/security/CVE-2017-1000410))

It was discovered that the USB serial device driver in the Linux kernel did

not properly validate baud rate settings when debugging is enabled. A local

attacker could use this to cause a denial of service (system crash).

([CVE-2017-18360](/security/CVE-2017-18360))

Mathias Payer and Hui Peng discovered a use-after-free vulnerability in the

Advanced Linux Sound Architecture (ALSA) subsystem. A physically proximate

attacker could use this to cause a denial of service (system crash).

([CVE-2018-19824](/security/CVE-2018-19824))

Shlomi Oberman, Yuli Shapiro, and Ran Menscher discovered an information

leak in the Bluetooth implementation of the Linux kernel. An attacker

within Bluetooth range could use this to expose sensitive information

(kernel memory). ([CVE-2019-3459](/security/CVE-2019-3459), [CVE-2019-3460](/security/CVE-2019-3460))

Jann Horn discovered that the KVM implementation in the Linux kernel

contained a use-after-free vulnerability. An attacker in a guest VM with

access to /dev/kvm could use this to cause a denial of service (guest VM

crash). ([CVE-2019-6974](/security/CVE-2019-6974))

Felix Wilhelm discovered that an information leak vulnerability existed in

the KVM subsystem of the Linux kernel, when nested virtualization is used.

A local attacker could use this to expose sensitive information (host

system memory to a guest VM). ([CVE-2019-7222](/security/CVE-2019-7222))

Jann Horn discovered that the mmap implementation in the Linux kernel did

not properly check for the mmap minimum address in some situations. A local

attacker could use this to assist exploiting a kernel NULL pointer

dereference vulnerability. ([CVE-2019-9213](/security/CVE-2019-9213))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 12.04

* [linux-image-generic-lpae-lts-trusty](https://launchpad.net/ubuntu/%2Bsource/linux-lts-trusty)
  -
  [3.13.0.168.157](https://launchpad.net/ubuntu/%2Bsource/linux-lts-trusty/3.13.0-168.218~precise1)
* [linux-image-3.13.0-168-generic](https://launchpad.net/ubuntu/%2Bsource/linux-lts-trusty)
  -
  [3.13.0-168.218~precise1](https://launchpad.net/ubuntu/%2Bsource/linux-lts-trusty/3.13.0-168.218~precise1)
* [linux-image-3.13.0-168-lowlatency](https://launchpad.net/ubuntu/%2Bsource/linux-lts-trusty)
  -
  [3.13.0-168.218~precise1](https://launchpad.net/ubuntu/%2Bsource/linux-lts-trusty/3.13.0-168.218~precise1)
* [linux-image-generic-lts-trusty](https://launchpad.net/ubuntu/%2Bsource/linux-lts-trusty)
  -
  [3.13.0.168.157](https://launchpad.net/ubuntu/%2Bsource/linux-lts-trusty/3.13.0-168.218~precise1)
* [linux-image-3.13.0-168-generic-lpae](https://launchpad.net/ubuntu/%2Bsource/linux-lts-trusty)
  -
  [3.13.0-168.218~precise1](https://launchpad.net/ubuntu/%2Bsource/linux-lts-trusty/3.13.0-168.218~precise1)

After a standard system update you need to reboot your computer to make

all the necessary changes.

ATTENTION: Due to an unavoidable ABI change the kernel updates have

been given a new version number, which requires you to recompile and

reinstall all third party kernel modules you might have installed.

Unless you manually uninstalled the standard kernel metapackages

(e.g. linux-generic, linux-generic-lts-RELEASE, linux-virtual,

linux-powerpc), a standard system upgrade will automatically perform

this as well.

## References

* [CVE-2017-1000410](/security/CVE-2017-1000410)
* [CVE-2017-18360](/security/CVE-2017-18360)
* [CVE-2018-19824](/security/CVE-2018-19824)
* [CVE-2019-3459](/security/CVE-2019-3459)
* [CVE-2019-3460](/security/CVE-2019-3460)
* [CVE-2019-6974](/security/CVE-2019-6974)
* [CVE-2019-7222](/security/CVE-2019-7222)
* [CVE-2019-9213](/security/CVE-2019-9213)

## Related notices

* [USN-3933-1](/security/notices/USN-3933-1)
* [USN-3930-2](/security/notices/USN-3930-2)
* [USN-3879-1](/security/notices/USN-3879-1)
* [USN-3879-2](/security/notices/USN-3879-2)
* [USN-3930-1](/security/notices/USN-3930-1)
* [USN-3931-2](/security/notices/USN-3931-2)
* [USN-3931-1](/security/notices/USN-3931-1)
* [USN-3932-1](/security/notices/USN-3932-1)
* [USN-3932-2](/security/notices/USN-3932-2)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from git.kernel.org_158e6746_20250124_215427.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=6aeb75e6adfaed16e58780309613a578fe1ee90b)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=6aeb75e6adfaed16e58780309613a578fe1ee90b)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=6aeb75e6adfaed16e58780309613a578fe1ee90b)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=6aeb75e6adfaed16e58780309613a578fe1ee90b)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johan Hovold <johan@kernel.org> | 2017-05-11 11:41:21 +0200 |
| --- | --- | --- |
| committer | Johan Hovold <johan@kernel.org> | 2017-05-15 11:52:04 +0200 |
| commit | [6aeb75e6adfaed16e58780309613a578fe1ee90b](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=6aeb75e6adfaed16e58780309613a578fe1ee90b) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=6aeb75e6adfaed16e58780309613a578fe1ee90b)) | |
| tree | [4dfbc9180a80ceffbcf043c58f2fd82cd754138b](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=6aeb75e6adfaed16e58780309613a578fe1ee90b) | |
| parent | [26cede343656c0bc2c33cdc783771282405c7fb2](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=26cede343656c0bc2c33cdc783771282405c7fb2) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=6aeb75e6adfaed16e58780309613a578fe1ee90b&id2=26cede343656c0bc2c33cdc783771282405c7fb2)) | |
| download | [linux-6aeb75e6adfaed16e58780309613a578fe1ee90b.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-6aeb75e6adfaed16e58780309613a578fe1ee90b.tar.gz) | |

USB: serial: io\_ti: fix div-by-zero in set\_termiosFix a division-by-zero in set\_termios when debugging is enabled and a
high-enough speed has been requested so that the divisor value becomes
zero.
Instead of just fixing the offending debug statement, cap the baud rate
at the base as a zero divisor value also appears to crash the firmware.
Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
Cc: stable <stable@vger.kernel.org> # 2.6.12
Reviewed-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Johan Hovold <johan@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=6aeb75e6adfaed16e58780309613a578fe1ee90b)

| -rw-r--r-- | [drivers/usb/serial/io\_ti.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/drivers/usb/serial/io_ti.c?id=6aeb75e6adfaed16e58780309613a578fe1ee90b) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 1 deletions

| diff --git a/drivers/usb/serial/io\_ti.c b/drivers/usb/serial/io\_ti.cindex 87798e625d6c82..6cefb9cb133d7b 100644--- a/[drivers/usb/serial/io\_ti.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/usb/serial/io_ti.c?id=26cede343656c0bc2c33cdc783771282405c7fb2)+++ b/[drivers/usb/serial/io\_ti.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/usb/serial/io_ti.c?id=6aeb75e6adfaed16e58780309613a578fe1ee90b)@@ -2336,8 +2336,11 @@ static void change\_port\_settings(struct tty\_struct \*tty, if (!baud) { /\* pick a default, any default... \*/ baud = 9600;- } else+ } else {+ /\* Avoid a zero divisor. \*/+ baud = min(baud, 461550); tty\_encode\_baud\_rate(tty, baud, baud);+ }  edge\_port->baud\_rate = baud; config->wBaudRate = (\_\_u16)((461550L + baud/2) / baud); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-24 21:53:04 +0000



=== Content from cdn.kernel.org_24bf1997_20250124_215439.html ===
commit b43ae25b7026ac4c7a0d96cf073e700fbc43c3ce
Author: Greg Kroah-Hartman
Date: Thu May 25 15:46:45 2017 +0200
Linux 4.11.3
commit 8d6d97abb875d320debfabc55b32bca1166b3386
Author: Tadeusz Struk
Date: Mon Mar 20 17:25:35 2017 -0700
IB/hfi1: Protect the global dev\_cntr\_names and port\_cntr\_names
commit 62eed66e98b4c2286fef2ce5911d8d75b7515f7b upstream.
Protect the global dev\_cntr\_names and port\_cntr\_names with the global
mutex as they are allocated and freed in a function called per device.
Otherwise there is a danger of double free and memory leaks.
Fixes: Commit b7481944b06e ("IB/hfi1: Show statistics counters under IB stats interface")
Reviewed-by: Dennis Dalessandro
Reviewed-by: Easwar Hariharan
Signed-off-by: Tadeusz Struk
Signed-off-by: Dennis Dalessandro
Signed-off-by: Mike Marciniszyn
Signed-off-by: Doug Ledford
Signed-off-by: Greg Kroah-Hartman
commit b7705859189a225120e7b26cd475ccb770917893
Author: Chris Wilson
Date: Wed Nov 9 10:39:05 2016 +0000
drm/i915/gvt: Disable access to stolen memory as a guest
commit 04a68a35ce6d7b54749989f943993020f48fed62 upstream.
Explicitly disable stolen memory when running as a guest in a virtual
machine, since the memory is not mediated between clients and reserved
entirely for the host. The actual size should be reported as zero, but
like every other quirk we want to tell the user what is happening.
Bugzilla: https://bugs.freedesktop.org/show\_bug.cgi?id=99028
Signed-off-by: Chris Wilson
Cc: Zhenyu Wang
Cc: Joonas Lahtinen
Link: http://patchwork.freedesktop.org/patch/msgid/20161109103905.17860-1-chris@chris-wilson.co.uk
Reviewed-by: Zhenyu Wang
Signed-off-by: Greg Kroah-Hartman
commit 846d6e12d0a07725298fcb4e2c403e2ead75d278
Author: Julius Werner
Date: Fri May 12 14:42:58 2017 -0700
drivers: char: mem: Check for address space wraparound with mmap()
commit b299cde245b0b76c977f4291162cf668e087b408 upstream.
/dev/mem currently allows mmap() mappings that wrap around the end of
the physical address space, which should probably be illegal. It
circumvents the existing STRICT\_DEVMEM permission check because the loop
immediately terminates (as the start address is already higher than the
end address). On the x86\_64 architecture it will then cause a panic
(from the BUG(start >= end) in arch/x86/mm/pat.c:reserve\_memtype()).
This patch adds an explicit check to make sure offset + size will not
wrap around in the physical address type.
Signed-off-by: Julius Werner
Signed-off-by: Greg Kroah-Hartman
commit 326842c0197ff146be6000e74d45b1c60b3faf5e
Author: Trond Myklebust
Date: Tue May 9 16:24:59 2017 -0400
nfsd: Fix up the "supattr\_exclcreat" attributes
commit b26b78cb726007533d81fdf90a62e915002ef5c8 upstream.
If an NFSv4 client asks us for the supattr\_exclcreat, then we must
not return attributes that are unsupported by this minor version.
Signed-off-by: Trond Myklebust
Fixes: 75976de6556f ("NFSD: Return word2 bitmask if setting security..,")
Signed-off-by: J. Bruce Fields
Signed-off-by: Greg Kroah-Hartman
commit 9a4723626e1e83b107216b2f0bb4454c52a8de57
Author: J. Bruce Fields
Date: Fri May 5 16:17:57 2017 -0400
nfsd: encoders mustn't use unitialized values in error cases
commit f961e3f2acae94b727380c0b74e2d3954d0edf79 upstream.
In error cases, lgp->lg\_layout\_type may be out of bounds; so we
shouldn't be using it until after the check of nfserr.
This was seen to crash nfsd threads when the server receives a LAYOUTGET
request with a large layout type.
GETDEVICEINFO has the same problem.
Reported-by: Ari Kauppi
Reviewed-by: Christoph Hellwig
Signed-off-by: J. Bruce Fields
Signed-off-by: Greg Kroah-Hartman
commit 06cc61e8f9edb5d50156622c0940b32e8cca0f3a
Author: Ari Kauppi
Date: Fri May 5 16:07:55 2017 -0400
nfsd: fix undefined behavior in nfsd4\_layout\_verify
commit b550a32e60a4941994b437a8d662432a486235a5 upstream.
UBSAN: Undefined behaviour in fs/nfsd/nfs4proc.c:1262:34
shift exponent 128 is too large for 32-bit type 'int'
Depending on compiler+architecture, this may cause the check for
layout\_type to succeed for overly large values (which seems to be the
case with amd64). The large value will be later used in de-referencing
nfsd4\_layout\_ops for function pointers.
Reported-by: Jani Tuovila
Signed-off-by: Ari Kauppi
[colin.king@canonical.com: use LAYOUT\_TYPE\_MAX instead of 32]
Reviewed-by: Dan Carpenter
Reviewed-by: Christoph Hellwig
Signed-off-by: J. Bruce Fields
Signed-off-by: Greg Kroah-Hartman
commit af069f63c5614452625536c54bae3168f12b9e41
Author: Trond Myklebust
Date: Fri May 5 13:02:42 2017 -0400
NFSv4: Fix an rcu lock leak
commit 2e84611b3f4fa50e1f4c12f2966fcc7fb955d944 upstream.
The intention in the original patch was to release the lock when
we put the inode, however something got screwed up.
Reported-by: Jason Yan
Fixes: 7b410d9ce460f ("pNFS: Delay getting the layout header in..")
Signed-off-by: Trond Myklebust
Signed-off-by: Greg Kroah-Hartman
commit 89207ffd222e860464804e90e325bbfdd92d0202
Author: Trond Myklebust
Date: Thu Apr 20 14:33:06 2017 -0400
pNFS/flexfiles: Check the result of nfs4\_pnfs\_ds\_connect
commit 260f32adb88dadfaac29f47f761a088238ca164c upstream.
The check in nfs4\_ff\_layout\_prepare\_ds() seems to be missing.
Signed-off-by: Trond Myklebust
Fixes: a33e4b036d461 ("pNFS: return status from nfs4\_pnfs\_ds\_connect")
Cc: Weston Andros Adamson
Signed-off-by: Greg Kroah-Hartman
commit bc38735f21cb9f6facd379931a29d33781fead4e
Author: Benjamin Coddington
Date: Wed Apr 19 10:11:33 2017 -0400
NFS: Use GFP\_NOIO for two allocations in writeback
commit ae97aa524ef495b6276fd26f5d5449fb22975d7c upstream.
Prevent a deadlock that can occur if we wait on allocations
that try to write back our pages.
Signed-off-by: Benjamin Coddington
Fixes: 00bfa30abe869 ("NFS: Create a common pgio\_alloc and pgio\_release...")
Signed-off-by: Trond Myklebust
Signed-off-by: Greg Kroah-Hartman
commit 2aa6b5f2ac0f07da8ae8ddb556b3793cd3e7d419
Author: Fred Isaman
Date: Fri Apr 14 14:24:28 2017 -0400
NFS: Fix use after free in write error path
commit 1f84ccdf37d0db3a70714d02d51b0b6d45887fb8 upstream.
Signed-off-by: Fred Isaman
Fixes: 0bcbf039f6b2b ("nfs: handle request add failure properly")
Signed-off-by: Trond Myklebust
Signed-off-by: Greg Kroah-Hartman
commit e7ec98b137517bd95ff3a556f822236fde5dd6eb
Author: Trond Myklebust
Date: Sat Apr 15 19:20:01 2017 -0400
NFSv4: Fix a hang in OPEN related to server reboot
commit 56e0d71ef12f026d96213e45a662bde6bbff4676 upstream.
If the server fails to return the attributes as part of an OPEN
reply, and then reboots, we can end up hanging. The reason is that
the client attempts to send a GETATTR in order to pick up the
missing OPEN call, but fails to release the slot first, causing
reboot recovery to deadlock.
Signed-off-by: Trond Myklebust
Fixes: 2e80dbe7ac51a ("NFSv4.1: Close callback races for OPEN, LAYOUTGET...")
Signed-off-by: Greg Kroah-Hartman
commit acef1b812507e6eae0ddf4137ee44ddf6d7ffc39
Author: Mario Kleiner
Date: Fri Apr 21 17:05:08 2017 +0200
drm/edid: Add 10 bpc quirk for LGD 764 panel in HP zBook 17 G2
commit e345da82bd6bdfa8492f80b3ce4370acfd868d95 upstream.
The builtin eDP panel in the HP zBook 17 G2 supports 10 bpc,
as advertised by the Laptops product specs and verified via
injecting a fixed edid + photometer measurements, but edid
reports unknown depth, so drivers fall back to 6 bpc.
Add a quirk to get the full 10 bpc.
Signed-off-by: Mario Kleiner
Acked-by: Harry Wentland
Signed-off-by: Daniel Vetter
Link: http://patchwork.freedesktop.org/patch/msgid/1492787108-23959-1-git-send-email-mario.kleiner.de@gmail.com
Signed-off-by: Greg Kroah-Hartman
commit 9c92bffbd8eba7dce1d30734ce02bac8bf7357b0
Author: Alexander Couzens
Date: Tue May 2 12:19:00 2017 +0200
mtd: nand: add ooblayout for old hamming layout
commit 6a623e07694437ad09f382a13f76cffc32239a7f upstream.
The old 1-bit hamming layout requires ECC data to be placed at a
fixed offset, and not necessarily at the end of the OOB area.
Add this old layout back in order to fix legacy setups.
Fixes: 41b207a70d3a ("mtd: nand: implement the default mtd\_ooblayout\_ops")
Signed-off-by: Alexander Couzens
Acked-by: Boris Brezillon
Signed-off-by: Brian Norris
Signed-off-by: Greg Kroah-Hartman
commit 2d3e8503734ac2d7ed780b250d86d046d9459659
Author: Roger Quadros
Date: Thu Mar 30 10:37:50 2017 +0300
mtd: nand: omap2: Fix partition creation via cmdline mtdparts
commit 2d283ede59869159f4bb84ae689258c5caffce54 upstream.
commit c9711ec5250b ("mtd: nand: omap: Clean up device tree support")
caused the parent device name to be changed from "omap2-nand.0"
to ".nand" (e.g. 30000000.nand on omap3 platforms).
This caused mtd->name to be changed as well. This breaks partition
creation via mtdparts passed by u-boot as it uses "omap2-nand.0"
for the mtd-id.
Fix this by explicitly setting the mtd->name to "omap2-nand."
if it isn't already set by nand\_set\_flash\_node(). CS number is the
NAND controller instance ID.
Fixes: c9711ec5250b ("mtd: nand: omap: Clean up device tree support")
Reported-by: Leto Enrico
Reported-by: Adam Ford
Suggested-by: Boris Brezillon
Tested-by: Adam Ford
Signed-off-by: Roger Quadros
Signed-off-by: Boris Brezillon
Signed-off-by: Greg Kroah-Hartman
commit 750d21357e36df3cff1b0419a432c084d13e6ff3
Author: Simon Baatz
Date: Mon Mar 27 20:02:07 2017 +0200
mtd: nand: orion: fix clk handling
commit 675b11d94ce9baa5eb365a51b35d2793f77c8ab8 upstream.
The clk handling in orion\_nand.c had two problems:
- In the probe function, clk\_put() was called for an enabled clock,
which violates the API (see documentation for clk\_put() in
include/linux/clk.h)
- In the error path of the probe function, clk\_put() could be called
twice for the same clock.
In order to clean this up, use the managed function devm\_clk\_get() and
store the pointer to the clk in the driver data.
Fixes: baffab28b13120694fa3ebab08d3e99667a851d2 ('ARM: Orion: fix driver probe error handling with respect to clk')
Signed-off-by: Simon Baatz
Signed-off-by: Boris Brezillon
Signed-off-by: Greg Kroah-Hartman
commit 6003ac5842145bf865d4adc781a3fe25cb0d4640
Author: Lukas Wunner
Date: Tue Apr 18 20:44:30 2017 +0200
PCI: Freeze PME scan before suspending devices
commit ea00353f36b64375518662a8ad15e39218a1f324 upstream.
Laurent Pinchart reported that the Renesas R-Car H2 Lager board (r8a7790)
crashes during suspend tests. Geert Uytterhoeven managed to reproduce the
issue on an M2-W Koelsch board (r8a7791):
It occurs when the PME scan runs, once per second. During PME scan, the
PCI host bridge (rcar-pci) registers are accessed while its module clock
has already been disabled, leading to the crash.
One reproducer is to configure s2ram to use "s2idle" instead of "deep"
suspend:
# echo 0 > /sys/module/printk/parameters/console\_suspend
# echo s2idle > /sys/power/mem\_sleep
# echo mem > /sys/power/state
Another reproducer is to write either "platform" or "processors" to
/sys/power/pm\_test. It does not (or is less likely) to happen during full
system suspend ("core" or "none") because system suspend also disables
timers, and thus the workqueue handling PME scans no longer runs. Geert
believes the issue may still happen in the small window between disabling
module clocks and disabling timers:
# echo 0 > /sys/module/printk/parameters/console\_suspend
# echo platform > /sys/power/pm\_test # Or "processors"
# echo mem > /sys/power/state
(Make sure CONFIG\_PCI\_RCAR\_GEN2 and CONFIG\_USB\_OHCI\_HCD\_PCI are enabled.)
Rafael Wysocki agrees that PME scans should be suspended before the host
bridge registers become inaccessible. To that end, queue the task on a
workqueue that gets frozen before devices suspend.
Rafael notes however that as a result, some wakeup events may be missed if
they are delivered via PME from a device without working IRQ (which hence
must be polled) and occur after the workqueue has been frozen. If that
turns out to be an issue in practice, it may be possible to solve it by
calling pci\_pme\_list\_scan() once directly from one of the host bridge's
pm\_ops callbacks.
Stacktrace for posterity:
PM: Syncing filesystems ... [ 38.566237] done.
PM: Preparing system for sleep (mem)
Freezing user space processes ... [ 38.579813] (elapsed 0.001 seconds) done.
Freezing remaining freezable tasks ... (elapsed 0.001 seconds) done.
PM: Suspending system (mem)
PM: suspend of devices complete after 152.456 msecs
PM: late suspend of devices complete after 2.809 msecs
PM: noirq suspend of devices complete after 29.863 msecs
suspend debug: Waiting for 5 second(s).
Unhandled fault: asynchronous external abort (0x1211) at 0x00000000
pgd = c0003000
[00000000] \*pgd=80000040004003, \*pmd=00000000
Internal error: : 1211 [#1] SMP ARM
Modules linked in:
CPU: 1 PID: 20 Comm: kworker/1:1 Not tainted
4.9.0-rc1-koelsch-00011-g68db9bc814362e7f #3383
Hardware name: Generic R8A7791 (Flattened Device Tree)
Workqueue: events pci\_pme\_list\_scan
task: eb56e140 task.stack: eb58e000
PC is at pci\_generic\_config\_read+0x64/0x6c
LR is at rcar\_pci\_cfg\_base+0x64/0x84
pc : [] lr : [] psr: 600d0093
sp : eb58fe98 ip : c041d750 fp : 00000008
r10: c0e2283c r9 : 00000000 r8 : 600d0013
r7 : 00000008 r6 : eb58fed6 r5 : 00000002 r4 : eb58feb4
r3 : 00000000 r2 : 00000044 r1 : 00000008 r0 : 00000000
Flags: nZCv IRQs off FIQs on Mode SVC\_32 ISA ARM Segment user
Control: 30c5387d Table: 6a9f6c80 DAC: 55555555
Process kworker/1:1 (pid: 20, stack limit = 0xeb58e210)
Stack: (0xeb58fe98 to 0xeb590000)
fe80: 00000002 00000044
fea0: eb6f5800 c041d9b0 eb58feb4 00000008 00000044 00000000 eb78a000 eb78a000
fec0: 00000044 00000000 eb9aff00 c0424bf0 eb78a000 00000000 eb78a000 c0e22830
fee0: ea8a6fc0 c0424c5c eaae79c0 c0424ce0 eb55f380 c0e22838 eb9a9800 c0235fbc
ff00: eb55f380 c0e22838 eb55f380 eb9a9800 eb9a9800 eb58e000 eb9a9824 c0e02100
ff20: eb55f398 c02366c4 eb56e140 eb5631c0 00000000 eb55f380 c023641c 00000000
ff40: 00000000 00000000 00000000 c023a928 cd105598 00000000 40506a34 eb55f380
ff60: 00000000 00000000 dead4ead ffffffff ffffffff eb58ff74 eb58ff74 00000000
ff80: 00000000 dead4ead ffffffff ffffffff eb58ff90 eb58ff90 eb58ffac eb5631c0
ffa0: c023a844 00000000 00000000 c0206d68 00000000 00000000 00000000 00000000
ffc0: 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
ffe0: 00000000 00000000 00000000 00000000 00000013 00000000 3a81336c 10ccd1dd
[] (pci\_generic\_config\_read) from []
(pci\_bus\_read\_config\_word+0x58/0x80)
[] (pci\_bus\_read\_config\_word) from []
(pci\_check\_pme\_status+0x34/0x78)
[] (pci\_check\_pme\_status) from [] (pci\_pme\_wakeup+0x28/0x54)
[] (pci\_pme\_wakeup) from [] (pci\_pme\_list\_scan+0x58/0xb4)
[] (pci\_pme\_list\_scan) from []
(process\_one\_work+0x1bc/0x308)
[] (process\_one\_work) from [] (worker\_thread+0x2a8/0x3e0)
[] (worker\_thread) from [] (kthread+0xe4/0xfc)
[] (kthread) from [] (ret\_from\_fork+0x14/0x2c)
Code: ea000000 e5903000 f57ff04f e3a00000 (e5843000)
---[ end trace 667d43ba3aa9e589 ]---
Fixes: df17e62e5bff ("PCI: Add support for polling PME state on suspended legacy PCI devices")
Reported-and-tested-by: Laurent Pinchart
Reported-and-tested-by: Geert Uytterhoeven
Signed-off-by: Lukas Wunner
Signed-off-by: Bjorn Helgaas
Reviewed-by: Laurent Pinchart
Acked-by: Rafael J. Wysocki
Cc: Mika Westerberg
Cc: Niklas Söderlund
Cc: Simon Horman
Cc: Yinghai Lu
Cc: Matthew Garrett
Signed-off-by: Greg Kroah-Hartman
commit f21143a53ff89444e761508c76e71fa1f3c6890a
Author: David Woodhouse
Date: Wed Apr 12 13:25:52 2017 +0100
PCI: Only allow WC mmap on prefetchable resources
commit cef4d02305a06be581bb7f4353446717a1b319ec upstream.
The /proc/bus/pci mmap interface allows the user to specify whether they
want WC or not. Don't let them do so on non-prefetchable BARs.
Signed-off-by: David Woodhouse
Signed-off-by: Bjorn Helgaas
Signed-off-by: Greg Kroah-Hartman
commit bee38f0f378d5d1a687afcf311515e3adedd2340
Author: David Woodhouse
Date: Wed Apr 12 13:25:51 2017 +0100
PCI: Fix another sanity check bug in /proc/pci mmap
commit 17caf56731311c9596e7d38a70c88fcb6afa6a1b upstream.
Don't match MMIO maps with I/O BARs and vice versa.
Signed-off-by: David Woodhouse
Signed-off-by: Bjorn Helgaas
Signed-off-by: Greg Kroah-Hartman
commit b87e133e3d71065f37884af40613730810dbb526
Author: David Woodhouse
Date: Wed Apr 12 13:25:50 2017 +0100
PCI: Fix pci\_mmap\_fits() for HAVE\_PCI\_RESOURCE\_TO\_USER platforms
commit 6bccc7f426abd640f08d8c75fb22f99483f201b4 upstream.
In the PCI\_MMAP\_PROCFS case when the address being passed by the user is a
'user visible' resource address based on the bus window, and not the actual
contents of the resource, that's what we need to be checking it against.
Signed-off-by: David Woodhouse
Signed-off-by: Bjorn Helgaas
Signed-off-by: Greg Kroah-Hartman
commit 3537380a05bb9e35c9ababf66126c56af277e219
Author: K. Y. Srinivasan
Date: Fri Mar 24 11:07:21 2017 -0700
PCI: hv: Specify CPU\_AFFINITY\_ALL for MSI affinity when >= 32 CPUs
commit 433fcf6b7b31f1f233dd50aeb9d066a0f6ed4b9d upstream.
When we have 32 or more CPUs in the affinity mask, we should use a special
constant to specify that to the host. Fix this issue.
Signed-off-by: K. Y. Srinivasan
Signed-off-by: Bjorn Helgaas
Reviewed-by: Long Li
Signed-off-by: Greg Kroah-Hartman
commit 9dc0babcd208d1e68ba692f28c50b5f78f1f0798
Author: K. Y. Srinivasan
Date: Fri Mar 24 11:07:22 2017 -0700
PCI: hv: Allocate interrupt descriptors with GFP\_ATOMIC
commit 59c58ceeea9cdc6144d7b0303753e6bd26d87455 upstream.
The memory allocation here needs to be non-blocking. Fix the issue.
Signed-off-by: K. Y. Srinivasan
Signed-off-by: Bjorn Helgaas
Reviewed-by: Long Li
Signed-off-by: Greg Kroah-Hartman
commit 569ed828defa070c4b38aca1986d460577e375d5
Author: Tomasz Nowicki
Date: Wed Mar 29 14:16:13 2017 +0200
PCI/ACPI: Add ThunderX pass2.x 2nd node MCFG quirk
commit cd183740480f045600aa1fa38fe70809b5498f05 upstream.
Currently SoCs pass2.x do not emulate EA headers for ACPI boot method at
all. However, for pass2.x some devices (like EDAC) advertise incorrect
base addresses in their BARs which results in driver probe failure during
resource request. Since all problematic blocks are on 2nd NUMA node under
domain 10 add necessary quirk entry to obtain BAR addresses correction
using EA header emulation.
Fixes: 44f22bd91e88 ("PCI: Add MCFG quirks for Cavium ThunderX pass2.x host controller")
Signed-off-by: Tomasz Nowicki
Signed-off-by: Bjorn Helgaas
Acked-by: Robert Richter
Signed-off-by: Greg Kroah-Hartman
commit b4447dbb5cd1116b738f026b582ae93ab0490169
Author: Bjorn Helgaas
Date: Fri Apr 21 11:42:54 2017 -0500
PCI/ACPI: Tidy up MCFG quirk whitespace
commit ced414a14f709fc0af60bd381ba8a566dc566869 upstream.
With no blank lines, it's not obvious where the macro definitions end and
the uses begin. Add some blank lines and reorder the ThunderX definitions.
No functional change intended.
Signed-off-by: Bjorn Helgaas
Signed-off-by: Greg Kroah-Hartman
commit d76f9188598f847c290ab073c9b9e2bff16ae097
Author: Dawei Chien
Date: Tue Feb 21 20:26:52 2017 +0800
thermal: mt8173: minor mtk\_thermal.c cleanups
commit 05d7839aa290901429d8edcd8f7974c9df2bcaa5 upstream.
If thermal bank with 4 sensors, thermal driver should read TEMP\_MSR3.
However, currently thermal driver would not read TEMP\_MSR3 since mt8173
thermal driver only use 3 sensors on each thermal bank at the same time,
so this patch would not effect temperature.
Only if mt mt8173 thermal driver use 4 sensors on any thermal bank, would
read third sensor two times, and lose fourth sensor of vale.
Fixes: b7cf0053738c ("thermal: Add Mediatek thermal driver for mt2701.")
Reviewed-by: Matthias Brugger
Signed-off-by: Dawei Chien
Signed-off-by: Eduardo Valentin
Signed-off-by: Greg Kroah-Hartman
commit 63ab09e39dd24438ec7908b3d8417219b0a75c7d
Author: Thomas Gleixner
Date: Wed May 17 10:19:49 2017 +0200
tracing/kprobes: Enforce kprobes teardown after testing
commit 30e7d894c1478c88d50ce94ddcdbd7f9763d9cdd upstream.
Enabling the tracer selftest triggers occasionally the warning in
text\_poke(), which warns when the to be modified page is not marked
reserved.
The reason is that the tracer selftest installs kprobes on functions marked
\_\_init for testing. These probes are removed after the tests, but that
removal schedules the delayed kprobes\_optimizer work, which will do the
actual text poke. If the work is executed after the init text is freed,
then the warning triggers. The bug can be reproduced reliably when the work
delay is increased.
Flush the optimizer work and wait for the optimizing/unoptimizing lists to
become empty before returning from the kprobes tracer selftest. That
ensures that all operations which were queued due to the probes removal
have completed.
Link: http://lkml.kernel.org/r/20170516094802.76a468bb@gandalf.local.home
Signed-off-by: Thomas Gleixner
Acked-by: Masami Hiramatsu
Fixes: 6274de498 ("kprobes: Support delayed unoptimizing")
Signed-off-by: Steven Rostedt (VMware)
Signed-off-by: Greg Kroah-Hartman
commit 18b4b0ab6577a2b23545dbe3d6ffa4181362d550
Author: Arnd Bergmann
Date: Wed Jan 11 12:53:05 2017 +0100
firmware: ti\_sci: fix strncat length check
commit 76cefef8e838304a71725a0b5007c375619d78fb upstream.
gcc-7 notices that the length we pass to strncat is wrong:
drivers/firmware/ti\_sci.c: In function 'ti\_sci\_probe':
drivers/firmware/ti\_sci.c:204:32: error: specified bound 50 equals the size of the destination [-Werror=stringop-overflow=]
Instead of the total length, we must pass the length of the
remaining space here.
Fixes: aa276781a64a ("firmware: Add basic support for TI System Control Interface (TI-SCI) protocol")
Acked-by: Nishanth Menon
Acked-by: Santosh Shilimkar
Signed-off-by: Arnd Bergmann
Signed-off-by: Greg Kroah-Hartman
commit e57f049b09ee5f3d0df898e941a8823a895f22c7
Author: Masami Hiramatsu
Date: Thu Apr 27 12:15:10 2017 +0900
um: Fix to call read\_initrd after init\_bootmem
commit 5b4236e17cc1bd9fa14b2b0c7a4ae632d41f2e20 upstream.
Since read\_initrd() invokes alloc\_bootmem() for allocating
memory to load initrd image, it must be called after init\_bootmem.
This makes read\_initrd() called directly from setup\_arch()
after init\_bootmem() and mem\_total\_pages().
Fixes: b63236972e1 ("um: Setup physical memory in setup\_arch()")
Signed-off-by: Masami Hiramatsu
Signed-off-by: Richard Weinberger
Signed-off-by: Greg Kroah-Hartman
commit ece6ff2261337579b682dad3d93b0265eb744ab7
Author: Lars Ellenberg
Date: Thu May 11 10:21:46 2017 +0200
drbd: fix request leak introduced by locking/atomic, kref: Kill kref\_sub()
commit a00ebd1cf12c378a1d4f7a1d6daf1d76c1eaad82 upstream.
When killing kref\_sub(), the unconditional additional kref\_get()
was not properly paired with the necessary kref\_put(), causing
a leak of struct drbd\_requests (~ 224 Bytes) per submitted bio,
and breaking DRBD in general, as the destructor of those "drbd\_requests"
does more than just the mempoll\_free().
Fixes: bdfafc4ffdd2 ("locking/atomic, kref: Kill kref\_sub()")
Signed-off-by: Lars Ellenberg
Signed-off-by: Jens Axboe
Signed-off-by: Greg Kroah-Hartman
commit 78111082778af2dd4391df547f2bb18f06236090
Author: Al Viro
Date: Sun May 14 21:47:25 2017 -0400
osf\_wait4(): fix infoleak
commit a8c39544a6eb2093c04afd5005b6192bd0e880c6 upstream.
failing sys\_wait4() won't fill struct rusage...
Signed-off-by: Al Viro
Signed-off-by: Greg Kroah-Hartman
commit 90c676ffabd45acaa931b36415cb600e90054ae1
Author: Suzuki K Poulose
Date: Tue May 16 10:34:54 2017 +0100
kvm: arm/arm64: Force reading uncached stage2 PGD
commit 2952a6070e07ebdd5896f1f5b861acad677caded upstream.
Make sure we don't use a cached value of the KVM stage2 PGD while
resetting the PGD.
Cc: Marc Zyngier
Signed-off-by: Suzuki K Poulose
Reviewed-by: Christoffer Dall
Signed-off-by: Christoffer Dall
Signed-off-by: Greg Kroah-Hartman
commit 59e1faddb3d256dbc12b0a7fe9b0ee7adebeec10
Author: Suzuki K Poulose
Date: Tue May 16 10:34:55 2017 +0100
kvm: arm/arm64: Fix use after free of stage2 page table
commit 0c428a6a9256fcd66817e12db32a50b405ed2e5c upstream.
We yield the kvm->mmu\_lock occassionaly while performing an operation
(e.g, unmap or permission changes) on a large area of stage2 mappings.
However this could possibly cause another thread to clear and free up
the stage2 page tables while we were waiting for regaining the lock and
thus the original thread could end up in accessing memory that was
freed. This patch fixes the problem by making sure that the stage2
pagetable is still valid after we regain the lock. The fact that
mmu\_notifer->release() could be called twice (via \_\_mmu\_notifier\_release
and mmu\_notifier\_unregsister) enhances the possibility of hitting
this race where there are two threads trying to unmap the entire guest
shadow pages.
While at it, cleanup the redudant checks around cond\_resched\_lock in
stage2\_wp\_range(), as cond\_resched\_lock already does the same checks.
Cc: Mark Rutland
Cc: Radim Krčmář
Cc: andreyknvl@google.com
Cc: Paolo Bonzini
Acked-by: Marc Zyngier
Signed-off-by: Suzuki K Poulose
Reviewed-by: Christoffer Dall
Signed-off-by: Christoffer Dall
Signed-off-by: Greg Kroah-Hartman
commit 3bbe9f26a00eb01a5bea6a3e1dd22533d6e31a7b
Author: Suzuki K Poulose
Date: Wed May 3 15:17:51 2017 +0100
kvm: arm/arm64: Fix race in resetting stage2 PGD
commit 6c0d706b563af732adb094c5bf807437e8963e84 upstream.
In kvm\_free\_stage2\_pgd() we check the stage2 PGD before holding
the lock and proceed to take the lock if it is valid. And we unmap
the page tables, followed by releasing the lock. We reset the PGD
only after dropping this lock, which could cause a race condition
where another thread waiting on or even holding the lock, could
potentially see that the PGD is still valid and proceed to perform
a stage2 operation and later encounter a NULL PGD.
[223090.242280] Unable to handle kernel NULL pointer dereference at
virtual address 00000040
[223090.262330] PC is at unmap\_stage2\_range+0x8c/0x428
[223090.262332] LR is at kvm\_unmap\_hva\_handler+0x2c/0x3c
[223090.262531] Call trace:
[223090.262533] [] unmap\_stage2\_range+0x8c/0x428
[223090.262535] [] kvm\_unmap\_hva\_handler+0x2c/0x3c
[223090.262537] [] handle\_hva\_to\_gpa+0xb0/0x104
[223090.262539] [] kvm\_unmap\_hva+0x5c/0xbc
[223090.262543] []
kvm\_mmu\_notifier\_invalidate\_page+0x50/0x8c
[223090.262547] []
\_\_mmu\_notifier\_invalidate\_page+0x5c/0x84
[223090.262551] [] try\_to\_unmap\_one+0x1d0/0x4a0
[223090.262553] [] rmap\_walk+0x1cc/0x2e0
[223090.262555] [] try\_to\_unmap+0x74/0xa4
[223090.262557] [] migrate\_pages+0x31c/0x5ac
[223090.262561] [] compact\_zone+0x3fc/0x7ac
[223090.262563] [] compact\_zone\_order+0x94/0xb0
[223090.262564] [] try\_to\_compact\_pages+0x108/0x290
[223090.262569] [] \_\_alloc\_pages\_direct\_compact+0x70/0x1ac
[223090.262571] [] \_\_alloc\_pages\_nodemask+0x434/0x9f4
[223090.262572] [] alloc\_pages\_vma+0x230/0x254
[223090.262574] [] do\_huge\_pmd\_anonymous\_page+0x114/0x538
[223090.262576] [] handle\_mm\_fault+0xd40/0x17a4
[223090.262577] [] \_\_get\_user\_pages+0x12c/0x36c
[223090.262578] [] get\_user\_pages\_unlocked+0xa4/0x1b8
[223090.262579] [] \_\_gfn\_to\_pfn\_memslot+0x280/0x31c
[223090.262580] [] gfn\_to\_pfn\_prot+0x4c/0x5c
[223090.262582] [] kvm\_handle\_guest\_abort+0x240/0x774
[223090.262584] [] handle\_exit+0x11c/0x1ac
[223090.262586] [] kvm\_arch\_vcpu\_ioctl\_run+0x31c/0x648
[223090.262587] [] kvm\_vcpu\_ioctl+0x378/0x768
[223090.262590] [] do\_vfs\_ioctl+0x324/0x5a4
[223090.262591] [] SyS\_ioctl+0x90/0xa4
[223090.262595] [] el0\_svc\_naked+0x38/0x3c
This patch moves the stage2 PGD manipulation under the lock.
Reported-by: Alexander Graf
Cc: Mark Rutland
Cc: Marc Zyngier
Cc: Paolo Bonzini
Cc: Radim Krčmář
Reviewed-by: Christoffer Dall
Reviewed-by: Marc Zyngier
Signed-off-by: Suzuki K Poulose
Signed-off-by: Christoffer Dall
Signed-off-by: Greg Kroah-Hartman
commit a24a206192803ddd1e0c5d6128a6eef9b07a21bd
Author: Huacai Chen
Date: Thu Mar 16 21:00:28 2017 +0800
MIPS: Loongson-3: Select MIPS\_L1\_CACHE\_SHIFT\_6
commit 17c99d9421695a0e0de18bf1e7091d859e20ec1d upstream.
Some newer Loongson-3 have 64 bytes cache lines, so select
MIPS\_L1\_CACHE\_SHIFT\_6.
Signed-off-by: Huacai Chen
Cc: John Crispin
Cc: Steven J . Hill
Cc: Fuxin Zhang
Cc: Zhangjin Wu
Cc: linux-mips@linux-mips.org
Patchwork: https://patchwork.linux-mips.org/patch/15755/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 7ce12d8b97d80a898b307902f9045f1b3fc9ae85
Author: Jon Derrick
Date: Fri May 5 14:52:06 2017 -0600
nvme: unmap CMB and remove sysfs file in reset path
commit f63572dff1421b6ca6abce71d46e03411e605c94 upstream.
CMB doesn't get unmapped until removal while getting remapped on every
reset. Add the unmapping and sysfs file removal to the reset path in
nvme\_pci\_disable to match the mapping path in nvme\_pci\_enable.
Fixes: 202021c1a ("nvme : Add sysfs entry for NVMe CMBs when appropriate")
Signed-off-by: Jon Derrick
Acked-by: Keith Busch
Reviewed-By: Stephen Bates
Signed-off-by: Christoph Hellwig
Signed-off-by: Jens Axboe
Signed-off-by: Greg Kroah-Hartman
commit ef1f1648fe3f59b5af28a5f301668fb1ee08ee47
Author: Thomas Gleixner
Date: Thu May 11 13:54:11 2017 +0200
genirq: Fix chained interrupt data ordering
commit 2c4569ca26986d18243f282dd727da27e9adae4c upstream.
irq\_set\_chained\_handler\_and\_data() sets up the chained interrupt and then
stores the handler data.
That's racy against an immediate interrupt which gets handled before the
store of the handler data happened. The handler will dereference a NULL
pointer and crash.
Cure it by storing handler data before installing the chained handler.
Reported-by: Borislav Petkov
Signed-off-by: Thomas Gleixner
Signed-off-by: Greg Kroah-Hartman
commit 3a97bedaa3896e6f51be81ac2917e4394c00a9d7
Author: Johan Hovold
Date: Fri May 12 12:06:32 2017 +0200
uwb: fix device quirk on big-endian hosts
commit 41318a2b82f5d5fe1fb408f6d6e0b22aa557111d upstream.
Add missing endianness conversion when using the USB device-descriptor
idProduct field to apply a hardware quirk.
Fixes: 1ba47da52712 ("uwb: add the i1480 DFU driver")
Signed-off-by: Johan Hovold
Signed-off-by: Greg Kroah-Hartman
commit 4c44438b566bcb0143c05be3edc83bfa95995047
Author: Daniel Micay
Date: Thu May 4 09:32:09 2017 -0400
stackprotector: Increase the per-task stack canary's random range from 32 bits to 64 bits on 64-bit platforms
commit 5ea30e4e58040cfd6434c2f33dc3ea76e2c15b05 upstream.
The stack canary is an 'unsigned long' and should be fully initialized to
random data rather than only 32 bits of random data.
Signed-off-by: Daniel Micay
Acked-by: Arjan van de Ven
Acked-by: Rik van Riel
Acked-by: Kees Cook
Cc: Arjan van Ven
Cc: Linus Torvalds
Cc: Peter Zijlstra
Cc: Thomas Gleixner
Cc: kernel-hardening@lists.openwall.com
Link: http://lkml.kernel.org/r/20170504133209.3053-1-danielmicay@gmail.com
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit 88f7b253a92141dc65a48718000355810b665680
Author: James Hogan
Date: Tue May 2 19:41:06 2017 +0100
metag/uaccess: Check access\_ok in strncpy\_from\_user
commit 3a158a62da0673db918b53ac1440845a5b64fd90 upstream.
The metag implementation of strncpy\_from\_user() doesn't validate the src
pointer, which could allow reading of arbitrary kernel memory. Add a
short access\_ok() check to prevent that.
Its still possible for it to read across the user/kernel boundary, but
it will invariably reach a NUL character after only 9 bytes, leaking
only a static kernel address being loaded into D0Re0 at the beginning of
\_\_start, which is acceptable for the immediate fix.
Reported-by: Al Viro
Signed-off-by: James Hogan
Cc: linux-metag@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 160f7df55ba99818bd903af21cafdb5758bbb356
Author: James Hogan
Date: Fri Apr 28 10:50:26 2017 +0100
metag/uaccess: Fix access\_ok()
commit 8a8b56638bcac4e64cccc88bf95a0f9f4b19a2fb upstream.
The \_\_user\_bad() macro used by access\_ok() has a few corner cases
noticed by Al Viro where it doesn't behave correctly:
- The kernel range check has off by 1 errors which permit access to the
first and last byte of the kernel mapped range.
- The kernel range check ends at LINCORE\_BASE rather than
META\_MEMORY\_LIMIT, which is ineffective when the kernel is in global
space (an extremely uncommon configuration).
There are a couple of other shortcomings here too:
- Access to the whole of the other address space is permitted (i.e. the
global half of the address space when the kernel is in local space).
This isn't ideal as it could theoretically still contain privileged
mappings set up by the bootloader.
- The size argument is unused, permitting user copies which start on
valid pages at the end of the user address range and cross the
boundary into the kernel address space (e.g. addr = 0x3ffffff0, size
> 0x10).
It isn't very convenient to add size checks when disallowing certain
regions, and it seems far safer to be sure and explicit about what
userland is able to access, so invert the logic to allow certain regions
instead, and fix the off by 1 errors and missing size checks. This also
allows the get\_fs() == KERNEL\_DS check to be more easily optimised into
the user address range case.
We now have 3 such allowed regions:
- The user address range (incorporating the get\_fs() == KERNEL\_DS
check).
- NULL (some kernel code expects this to work, and we'll always catch
the fault anyway).
- The core code memory region.
Fixes: 373cd784d0fc ("metag: Memory handling")
Reported-by: Al Viro
Signed-off-by: James Hogan
Cc: linux-metag@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 4b701379312181d0339aca37646c341cd80636b2
Author: Li, Fei
Date: Thu Apr 27 01:47:25 2017 +0000
cpuidle: check dev before usage in cpuidle\_use\_deepest\_state()
commit 41dc750ea67f317c0deedde713d1728425524ef2 upstream.
In case of there is no cpuidle devices registered, dev will be null, and
panic will be triggered like below;
In this patch, add checking of dev before usage, like that done in
cpuidle\_idle\_call.
Panic without fix:
[ 184.961328] BUG: unable to handle kernel NULL pointer dereference at
(null)
[ 184.961328] IP: cpuidle\_use\_deepest\_state+0x30/0x60
...
[ 184.961328] play\_idle+0x8d/0x210
[ 184.961328] ? \_\_schedule+0x359/0x8e0
[ 184.961328] ? \_raw\_spin\_unlock\_irqrestore+0x28/0x50
[ 184.961328] ? kthread\_queue\_delayed\_work+0x41/0x80
[ 184.961328] clamp\_idle\_injection\_func+0x64/0x1e0
Fixes: bb8313b603eb8 (cpuidle: Allow enforcing deepest idle state selection)
Signed-off-by: Li, Fei
Tested-by: Shi, Feng
Reviewed-by: Andy Shevchenko
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit 4fd7fd47a04195d4d74fa1283cd6e6d600e92929
Author: KarimAllah Ahmed
Date: Fri May 5 11:39:59 2017 -0700
iommu/vt-d: Flush the IOTLB to get rid of the initial kdump mappings
commit f73a7eee900e95404b61408a23a1df5c5811704c upstream.
Ever since commit 091d42e43d ("iommu/vt-d: Copy translation tables from
old kernel") the kdump kernel copies the IOMMU context tables from the
previous kernel. Each device mappings will be destroyed once the driver
for the respective device takes over.
This unfortunately breaks the workflow of mapping and unmapping a new
context to the IOMMU. The mapping function assumes that either:
1) Unmapping did the proper IOMMU flushing and it only ever flush if the
IOMMU unit supports caching invalid entries.
2) The system just booted and the initialization code took care of
flushing all IOMMU caches.
This assumption is not true for the kdump kernel since the context
tables have been copied from the previous kernel and translations could
have been cached ever since. So make sure to flush the IOTLB as well
when we destroy these old copied mappings.
Cc: Joerg Roedel
Cc: David Woodhouse
Cc: David Woodhouse
Cc: Anthony Liguori
Signed-off-by: KarimAllah Ahmed
Acked-by: David Woodhouse
Fixes: 091d42e43d ("iommu/vt-d: Copy translation tables from old kernel")
Signed-off-by: Joerg Roedel
Signed-off-by: Greg Kroah-Hartman
commit 1cfc2a16c55aaf5001e16a1bc213dbad2f03d1ea
Author: Malcolm Priestley
Date: Thu May 11 18:57:46 2017 +0100
staging: rtl8192e: GetTs Fix invalid TID 7 warning.
commit 95d93e271d920dfda369d4740b1cc1061d41fe7f upstream.
TID 7 is a valid value for QoS IEEE 802.11e.
The switch statement that follows states 7 is valid.
Remove function IsACValid and use the default case to filter
invalid TIDs.
Signed-off-by: Malcolm Priestley
Signed-off-by: Greg Kroah-Hartman
commit 7369a3b5ecdaa2dd9e96d3cc94a9b1048af7c623
Author: Malcolm Priestley
Date: Thu May 11 18:57:45 2017 +0100
staging: rtl8192e: rtl92e\_get\_eeprom\_size Fix read size of EPROM\_CMD.
commit 90be652c9f157d44b9c2803f902a8839796c090d upstream.
EPROM\_CMD is 2 byte aligned on PCI map so calling with rtl92e\_readl
will return invalid data so use rtl92e\_readw.
The device is unable to select the right eeprom type.
Signed-off-by: Malcolm Priestley
Signed-off-by: Greg Kroah-Hartman
commit 3e57290a19ce998bda124eab7b65472f547aa860
Author: Malcolm Priestley
Date: Thu May 11 18:57:44 2017 +0100
staging: rtl8192e: fix 2 byte alignment of register BSSIDR.
commit 867510bde14e7b7fc6dd0f50b48f6753cfbd227a upstream.
BSSIDR has two byte alignment on PCI ioremap correct the write
by swapping to 16 bits first.
This fixes a problem that the device associates fail because
the filter is not set correctly.
Signed-off-by: Malcolm Priestley
Signed-off-by: Greg Kroah-Hartman
commit d92507d9e5b03f3e12c38108015d80f9cd5ff447
Author: Malcolm Priestley
Date: Thu May 11 18:57:43 2017 +0100
staging: rtl8192e: rtl92e\_fill\_tx\_desc fix write to mapped out memory.
commit baabd567f87be05330faa5140f72a91960e7405a upstream.
The driver attempts to alter memory that is mapped to PCI device.
This is because tx\_fwinfo\_8190pci points to skb->data
Move the pci\_map\_single to when completed buffer is ready to be mapped with
psdec is empty to drop on mapping error.
Signed-off-by: Malcolm Priestley
Signed-off-by: Greg Kroah-Hartman
commit e478ae4e63abfbf1c4cd6face4aef44c823fd016
Author: Phil Elwell
Date: Thu May 4 10:58:20 2017 +0100
staging: vc04\_services: Fix bulk cache maintenance
commit ff92b9e3c9f85fa442c430d70bf075499e1193b7 upstream.
vchiq\_arm supports transfers less than one page and at arbitrary
alignment, using the dma-mapping API to perform its cache maintenance
(even though the VPU drives the DMA hardware). Read (DMA\_FROM\_DEVICE)
operations use cache invalidation for speed, falling back to
clean+invalidate on partial cache lines, with writes (DMA\_TO\_DEVICE)
using flushes.
If a read transfer has ends which aren't page-aligned, performing cache
maintenance as if they were whole pages can lead to memory corruption
since the partial cache lines at the ends (and any cache lines before or
after the transfer area) will be invalidated. This bug was masked until
the disabling of the cache flush in flush\_dcache\_page().
Honouring the requested transfer start- and end-points prevents the
corruption.
Fixes: cf9caf192988 ("staging: vc04\_services: Replace dmac\_map\_area with dmac\_map\_sg")
Signed-off-by: Phil Elwell
Reported-by: Stefan Wahren
Tested-by: Stefan Wahren
Signed-off-by: Greg Kroah-Hartman
commit e3b8dd546d247c28f6b82b2d002e0a0d37b151f9
Author: Kristina Martsenko
Date: Wed May 3 16:37:48 2017 +0100
arm64: documentation: document tagged pointer stack constraints
commit f0e421b1bf7af97f026e1bb8bfe4c5a7a8c08f42 upstream.
Some kernel features don't currently work if a task puts a non-zero
address tag in its stack pointer, frame pointer, or frame record entries
(FP, LR).
For example, with a tagged stack pointer, the kernel can't deliver
signals to the process, and the task is killed instead. As another
example, with a tagged frame pointer or frame records, perf fails to
generate call graphs or resolve symbols.
For now, just document these limitations, instead of finding and fixing
everything that doesn't work, as it's not known if anyone needs to use
tags in these places anyway.
In addition, as requested by Dave Martin, generalize the limitations
into a general kernel address tag policy, and refactor
tagged-pointers.txt to include it.
Fixes: d50240a5f6ce ("arm64: mm: permit use of tagged pointers at EL0")
Reviewed-by: Dave Martin
Acked-by: Will Deacon
Signed-off-by: Kristina Martsenko
Signed-off-by: Catalin Marinas
Signed-off-by: Greg Kroah-Hartman
commit 45b1f35406bd02b6f58f635ba7c43cc552c3e6d8
Author: Kristina Martsenko
Date: Wed May 3 16:37:47 2017 +0100
arm64: entry: improve data abort handling of tagged pointers
commit 276e93279a630657fff4b086ba14c95955912dfa upstream.
When handling a data abort from EL0, we currently zero the top byte of
the faulting address, as we assume the address is a TTBR0 address, which
may contain a non-zero address tag. However, the address may be a TTBR1
address, in which case we should not zero the top byte. This patch fixes
that. The effect is that the full TTBR1 address is passed to the task's
signal handler (or printed out in the kernel log).
When handling a data abort from EL1, we leave the faulting address
intact, as we assume it's either a TTBR1 address or a TTBR0 address with
tag 0x00. This is true as far as I'm aware, we don't seem to access a
tagged TTBR0 address anywhere in the kernel. Regardless, it's easy to
forget about address tags, and code added in the future may not always
remember to remove tags from addresses before accessing them. So add tag
handling to the EL1 data abort handler as well. This also makes it
consistent with the EL0 data abort handler.
Fixes: d50240a5f6ce ("arm64: mm: permit use of tagged pointers at EL0")
Reviewed-by: Dave Martin
Acked-by: Will Deacon
Signed-off-by: Kristina Martsenko
Signed-off-by: Catalin Marinas
Signed-off-by: Greg Kroah-Hartman
commit 684f9dee46e39d1ebfb28271d79027b85471f57c
Author: Kristina Martsenko
Date: Wed May 3 16:37:46 2017 +0100
arm64: hw\_breakpoint: fix watchpoint matching for tagged pointers
commit 7dcd9dd8cebe9fa626af7e2358d03a37041a70fb upstream.
When we take a watchpoint exception, the address that triggered the
watchpoint is found in FAR\_EL1. We compare it to the address of each
configured watchpoint to see which one was hit.
The configured watchpoint addresses are untagged, while the address in
FAR\_EL1 will have an address tag if the data access was done using a
tagged address. The tag needs to be removed to compare the address to
the watchpoints.
Currently we don't remove it, and as a result can report the wrong
watchpoint as being hit (specifically, always either the highest TTBR0
watchpoint or lowest TTBR1 watchpoint). This patch removes the tag.
Fixes: d50240a5f6ce ("arm64: mm: permit use of tagged pointers at EL0")
Acked-by: Mark Rutland
Acked-by: Will Deacon
Signed-off-by: Kristina Martsenko
Signed-off-by: Catalin Marinas
Signed-off-by: Greg Kroah-Hartman
commit 5de6ca05b64fff78d1e37e140e7b5bb17592fc4a
Author: Kristina Martsenko
Date: Wed May 3 16:37:45 2017 +0100
arm64: traps: fix userspace cache maintenance emulation on a tagged pointer
commit 81cddd65b5c82758ea5571a25e31ff6f1f89ff02 upstream.
When we emulate userspace cache maintenance in the kernel, we can
currently send the task a SIGSEGV even though the maintenance was done
on a valid address. This happens if the address has a non-zero address
tag, and happens to not be mapped in.
When we get the address from a user register, we don't currently remove
the address tag before performing cache maintenance on it. If the
maintenance faults, we end up in either \_\_do\_page\_fault, where find\_vma
can't find the VMA if the address has a tag, or in do\_translation\_fault,
where the tagged address will appear to be above TASK\_SIZE. In both
cases, the address is not mapped in, and the task is sent a SIGSEGV.
This patch removes the tag from the address before using it. With this
patch, the fault is handled correctly, the address gets mapped in, and
the cache maintenance succeeds.
As a second bug, if cache maintenance (correctly) fails on an invalid
tagged address, the address gets passed into arm64\_notify\_segfault,
where find\_vma fails to find the VMA due to the tag, and the wrong
si\_code may be sent as part of the siginfo\_t of the segfault. With this
patch, the correct si\_code is sent.
Fixes: 7dd01aef0557 ("arm64: trap userspace "dc cvau" cache operation on errata-affected core")
Acked-by: Will Deacon
Signed-off-by: Kristina Martsenko
Signed-off-by: Catalin Marinas
Signed-off-by: Greg Kroah-Hartman
commit 87e2b8c096aa949bac679e870f873587576fabd7
Author: Mark Rutland
Date: Wed May 3 16:09:35 2017 +0100
arm64: uaccess: ensure extension of access\_ok() addr
commit a06040d7a791a9177581dcf7293941bd92400856 upstream.
Our access\_ok() simply hands its arguments over to \_\_range\_ok(), which
implicitly assummes that the addr parameter is 64 bits wide. This isn't
necessarily true for compat code, which might pass down a 32-bit address
parameter.
In these cases, we don't have a guarantee that the address has been zero
extended to 64 bits, and the upper bits of the register may contain
unknown values, potentially resulting in a suprious failure.
Avoid this by explicitly casting the addr parameter to an unsigned long
(as is done on other architectures), ensuring that the parameter is
widened appropriately.
Fixes: 0aea86a2176c ("arm64: User access library functions")
Acked-by: Will Deacon
Signed-off-by: Mark Rutland
Signed-off-by: Catalin Marinas
Signed-off-by: Greg Kroah-Hartman
commit 1f13dc4c221c0927ebfbe320ed20c372cda1ab42
Author: Mark Rutland
Date: Wed May 3 16:09:36 2017 +0100
arm64: armv8\_deprecated: ensure extension of addr
commit 55de49f9aa17b0b2b144dd2af587177b9aadf429 upstream.
Our compat swp emulation holds the compat user address in an unsigned
int, which it passes to \_\_user\_swpX\_asm(). When a 32-bit value is passed
in a register, the upper 32 bits of the register are unknown, and we
must extend the value to 64 bits before we can use it as a base address.
This patch casts the address to unsigned long to ensure it has been
suitably extended, avoiding the potential issue, and silencing a related
warning from clang.
Fixes: bd35a4adc413 ("arm64: Port SWP/SWPB emulation support from arm")
Acked-by: Will Deacon
Signed-off-by: Mark Rutland
Signed-off-by: Catalin Marinas
Signed-off-by: Greg Kroah-Hartman
commit 2339f63ef9ed6deb3312eddc9ea40e444b9da4ef
Author: Mark Rutland
Date: Wed May 3 16:09:34 2017 +0100
arm64: ensure extension of smp\_store\_release value
commit 994870bead4ab19087a79492400a5478e2906196 upstream.
When an inline assembly operand's type is narrower than the register it
is allocated to, the least significant bits of the register (up to the
operand type's width) are valid, and any other bits are permitted to
contain any arbitrary value. This aligns with the AAPCS64 parameter
passing rules.
Our \_\_smp\_store\_release() implementation does not account for this, and
implicitly assumes that operands have been zero-extended to the width of
the type being stored to. Thus, we may store unknown values to memory
when the value type is narrower than the pointer type (e.g. when storing
a char to a long).
This patch fixes the issue by casting the value operand to the same
width as the pointer operand in all cases, which ensures that the value
is zero-extended as we expect. We use the same union trickery as
\_\_smp\_load\_acquire and {READ,WRITE}\_ONCE() to avoid GCC complaining that
pointers are potentially cast to narrower width integers in unreachable
paths.
A whitespace issue at the top of \_\_smp\_store\_release() is also
corrected.
No changes are necessary for \_\_smp\_load\_acquire(). Load instructions
implicitly clear any upper bits of the register, and the compiler will
only consider the least significant bits of the register as valid
regardless.
Fixes: 47933ad41a86 ("arch: Introduce smp\_load\_acquire(), smp\_store\_release()")
Fixes: 878a84d5a8a1 ("arm64: add missing data types in smp\_load\_acquire/smp\_store\_release")
Acked-by: Will Deacon
Signed-off-by: Mark Rutland
Cc: Matthias Kaehlcke
Signed-off-by: Catalin Marinas
Signed-off-by: Greg Kroah-Hartman
commit b55563999fa951d705149a43be3e6a30325417d6
Author: Mark Rutland
Date: Wed May 3 16:09:33 2017 +0100
arm64: xchg: hazard against entire exchange variable
commit fee960bed5e857eb126c4e56dd9ff85938356579 upstream.
The inline assembly in \_\_XCHG\_CASE() uses a +Q constraint to hazard
against other accesses to the memory location being exchanged. However,
the pointer passed to the constraint is a u8 pointer, and thus the
hazard only applies to the first byte of the location.
GCC can take advantage of this, assuming that other portions of the
location are unchanged, as demonstrated with the following test case:
union u {
unsigned long l;
unsigned int i[2];
};
unsigned long update\_char\_hazard(union u \*u)
{
unsigned int a, b;
a = u->i[1];
asm ("str %1, %0" : "+Q" (\*(char \*)&u->l) : "r" (0UL));
b = u->i[1];
return a ^ b;
}
unsigned long update\_long\_hazard(union u \*u)
{
unsigned int a, b;
a = u->i[1];
asm ("str %1, %0" : "+Q" (\*(long \*)&u->l) : "r" (0UL));
b = u->i[1];
return a ^ b;
}
The linaro 15.08 GCC 5.1.1 toolchain compiles the above as follows when
using -O2 or above:
0000000000000000 :
0: d2800001 mov x1, #0x0 // #0
4: f9000001 str x1, [x0]
8: d2800000 mov x0, #0x0 // #0
c: d65f03c0 ret
0000000000000010 :
10: b9400401 ldr w1, [x0,#4]
14: d2800002 mov x2, #0x0 // #0
18: f9000002 str x2, [x0]
1c: b9400400 ldr w0, [x0,#4]
20: 4a000020 eor w0, w1, w0
24: d65f03c0 ret
This patch fixes the issue by passing an unsigned long pointer into the
+Q constraint, as we do for our cmpxchg code. This may hazard against
more than is necessary, but this is better than missing a necessary
hazard.
Fixes: 305d454aaa29 ("arm64: atomics: implement native {relaxed, acquire, release} atomics")
Acked-by: Will Deacon
Signed-off-by: Mark Rutland
Signed-off-by: Catalin Marinas
Signed-off-by: Greg Kroah-Hartman
commit ee6dfbff78289b671c9dce9c141d68d86fd617fe
Author: Daniel Lezcano
Date: Thu Mar 16 15:03:24 2017 +0100
arm64: dts: hi6220: Reset the mmc hosts
commit 0fbdf9953b41c28845fe8d05007ff09634ee3000 upstream.
The MMC hosts could be left in an unconsistent or uninitialized state from
the firmware. Instead of assuming, the firmware did the right things, let's
reset the host controllers.
This change fixes a bug when the mmc2/sdio is initialized leading to a hung
task:
[ 242.704294] INFO: task kworker/7:1:675 blocked for more than 120 seconds.
[ 242.711129] Not tainted 4.9.0-rc8-00017-gcf0251f #3
[ 242.716571] "echo 0 > /proc/sys/kernel/hung\_task\_timeout\_secs" disables this message.
[ 242.724435] kworker/7:1 D 0 675 2 0x00000000
[ 242.729973] Workqueue: events\_freezable mmc\_rescan
[ 242.734796] Call trace:
[ 242.737269] [] \_\_switch\_to+0xa8/0xb4
[ 242.742437] [] \_\_schedule+0x1c0/0x67c
[ 242.747689] [] schedule+0x40/0xa0
[ 242.752594] [] schedule\_timeout+0x1c4/0x35c
[ 242.758366] [] wait\_for\_common+0xd0/0x15c
[ 242.763964] [] wait\_for\_completion+0x28/0x34
[ 242.769825] [] mmc\_wait\_for\_req\_done+0x40/0x124
[ 242.775949] [] mmc\_wait\_for\_req+0xc0/0xf8
[ 242.781549] [] mmc\_wait\_for\_cmd+0x6c/0x84
[ 242.787149] [] mmc\_io\_rw\_direct\_host+0x9c/0x114
[ 242.793270] [] sdio\_reset+0x34/0x7c
[ 242.798347] [] mmc\_rescan+0x2fc/0x360
[ ... ]
Signed-off-by: Daniel Lezcano
Signed-off-by: Wei Xu
Signed-off-by: Greg Kroah-Hartman
commit 1116274777424b1a8905c015e427843b0ee4a3a7
Author: Leonard Crestez
Date: Fri May 5 14:00:17 2017 +0300
ARM: dts: imx6sx-sdb: Remove OPP override
commit d8581c7c8be172dac156a19d261f988a72ce596f upstream.
The board file for imx6sx-sdb overrides cpufreq operating points to use
higher voltages. This is done because the board has a shared rail for
VDD\_ARM\_IN and VDD\_SOC\_IN and when using LDO bypass the shared voltage
needs to be a value suitable for both ARM and SOC.
This only applies to LDO bypass mode, a feature not present in upstream.
When LDOs are enabled the effect is to use higher voltages than necessary
for no good reason.
Setting these higher voltages can make some boards fail to boot with ugly
semi-random crashes reminiscent of memory corruption. These failures only
happen on board rev. C, rev. B is reported to still work.
Signed-off-by: Leonard Crestez
Fixes: 54183bd7f766 ("ARM: imx6sx-sdb: add revb board and make it default")
Signed-off-by: Shawn Guo
Signed-off-by: Greg Kroah-Hartman
commit 8539c6b56ac5ea132146466c9774b13be64dcd12
Author: Ludovic Desroches
Date: Mon Apr 10 10:25:17 2017 +0200
ARM: dts: at91: sama5d3\_xplained: not all ADC channels are available
commit d3df1ec06353e51fc44563d2e7e18d42811af290 upstream.
Remove ADC channels that are not available by default on the sama5d3\_xplained
board (resistor not populated) in order to not create confusion.
Signed-off-by: Ludovic Desroches
Acked-by: Nicolas Ferre
Signed-off-by: Alexandre Belloni
Signed-off-by: Greg Kroah-Hartman
commit 87cb676e83f8025e00c2bace1acfee21317fbc83
Author: Ludovic Desroches
Date: Mon Apr 10 10:25:16 2017 +0200
ARM: dts: at91: sama5d3\_xplained: fix ADC vref
commit 9cdd31e5913c1f86dce7e201b086155b3f24896b upstream.
The voltage reference for the ADC is not 3V but 3.3V since it is connected to
VDDANA.
Signed-off-by: Ludovic Desroches
Acked-by: Nicolas Ferre
Signed-off-by: Alexandre Belloni
Signed-off-by: Greg Kroah-Hartman
commit 6b9e12331a32b8d2ad48aad699ac62df7dfe478d
Author: Vladimir Murzin
Date: Mon Apr 24 10:40:48 2017 +0100
ARM: 8670/1: V7M: Do not corrupt vector table around v7m\_invalidate\_l1 call
commit 6d80594936914e798b1b54b3bfe4bd68d8418966 upstream.
We save/restore registers around v7m\_invalidate\_l1 to address pointed
by r12, which is vector table, so the first eight entries are
overwritten with a garbage. We already have stack setup at that stage,
so use it to save/restore register.
Fixes: 6a8146f420be ("ARM: 8609/1: V7M: Add support for the Cortex-M7 processor")
Signed-off-by: Vladimir Murzin
Signed-off-by: Russell King
Signed-off-by: Greg Kroah-Hartman
commit 3e9570206d629e334314e273bb36cb33b9f8e061
Author: Jon Medhurst
Date: Mon Apr 10 11:13:59 2017 +0100
ARM: 8667/3: Fix memory attribute inconsistencies when using fixmap
commit b089c31c519c3906c14801b6ec483e18a5152a50 upstream.
To cope with the variety in ARM architectures and configurations, the
pagetable attributes for kernel memory are generated at runtime to match
the system the kernel finds itself on. This calculated value is stored
in pgprot\_kernel.
However, when early fixmap support was added for ARM (commit
a5f4c561b3b1) the attributes used for mappings were hard coded because
pgprot\_kernel is not set up early enough. Unfortunately, when fixmap is
used after early boot this means the memory being mapped can have
different attributes to existing mappings, potentially leading to
unpredictable behaviour. A specific problem also exists due to the hard
coded values not include the 'shareable' attribute which means on
systems where this matters (e.g. those with multiple CPU clusters) the
cache contents for a memory location can become inconsistent between
CPUs.
To resolve these issues we change fixmap to use the same memory
attributes (from pgprot\_kernel) that the rest of the kernel uses. To
enable this we need to refactor the initialisation code so
build\_mem\_type\_table() is called early enough. Note, that relies on early
param parsing for memory type overrides passed via the kernel command
line, so we need to make sure this call is still after
parse\_early\_params().
[ardb: keep early\_fixmap\_init() before param parsing, for earlycon]
Fixes: a5f4c561b3b1 ("ARM: 8415/1: early fixmap support for earlycon")
Tested-by: afzal mohammed
Signed-off-by: Jon Medhurst
Signed-off-by: Ard Biesheuvel
Signed-off-by: Russell King
Signed-off-by: Greg Kroah-Hartman
commit 7e2aa72f117e10fd37716ef951f56b28f6d4d32d
Author: Ard Biesheuvel
Date: Wed Feb 22 19:40:12 2017 +0100
ARM: 8662/1: module: split core and init PLT sections
commit b7ede5a1f5905ac394cc8e61712a13e3c5cb7b8f upstream.
Since commit 35fa91eed817 ("ARM: kernel: merge core and init PLTs"),
the ARM module PLT code allocates all PLT entries in a single core
section, since the overhead of having a separate init PLT section is
not justified by the small number of PLT entries usually required for
init code.
However, the core and init module regions are allocated independently,
and there is a corner case where the core region may be allocated from
the VMALLOC region if the dedicated module region is exhausted, but the
init region, being much smaller, can still be allocated from the module
region. This puts the PLT entries out of reach of the relocated branch
instructions, defeating the whole purpose of PLTs.
So split the core and init PLT regions, and name the latter ".init.plt"
so it gets allocated along with (and sufficiently close to) the .init
sections that it serves. Also, given that init PLT entries may need to
be emitted for branches that target the core module, modify the logic
that disregards defined symbols to only disregard symbols that are
defined in the same section.
Fixes: 35fa91eed817 ("ARM: kernel: merge core and init PLTs")
Reported-by: Angus Clark
Tested-by: Angus Clark
Signed-off-by: Ard Biesheuvel
Signed-off-by: Russell King
Signed-off-by: Greg Kroah-Hartman
commit ae9bd04a13e3548e5f0541f51e0469932f08aad9
Author: Zhichao Huang
Date: Thu May 11 13:46:11 2017 +0100
KVM: arm: plug potential guest hardware debug leakage
commit 661e6b02b5aa82db31897f36e96324b77450fd7a upstream.
Hardware debugging in guests is not intercepted currently, it means
that a malicious guest can bring down the entire machine by writing
to the debug registers.
This patch enable trapping of all debug registers, preventing the
guests to access the debug registers. This includes access to the
debug mode(DBGDSCR) in the guest world all the time which could
otherwise mess with the host state. Reads return 0 and writes are
ignored (RAZ\_WI).
The result is the guest cannot detect any working hardware based debug
support. As debug exceptions are still routed to the guest normal
debug using software based breakpoints still works.
To support debugging using hardware registers we need to implement a
debug register aware world switch as well as special trapping for
registers that may affect the host state.
Signed-off-by: Zhichao Huang
Signed-off-by: Alex Bennée
Reviewed-by: Christoffer Dall
Signed-off-by: Christoffer Dall
Signed-off-by: Greg Kroah-Hartman
commit c870815609d305603eb9e6bf1b75c6073020c12e
Author: Marc Zyngier
Date: Tue May 2 14:30:40 2017 +0100
KVM: arm/arm64: vgic-v3: Do not use Active+Pending state for a HW interrupt
commit 3d6e77ad1489650afa20da92bb589c8778baa8da upstream.
When an interrupt is injected with the HW bit set (indicating that
deactivation should be propagated to the physical distributor),
special care must be taken so that we never mark the corresponding
LR with the Active+Pending state (as the pending state is kept in
the physycal distributor).
Fixes: 59529f69f504 ("KVM: arm/arm64: vgic-new: Add GICv3 world switch backend")
Signed-off-by: Marc Zyngier
Reviewed-by: Christoffer Dall
Signed-off-by: Christoffer Dall
Signed-off-by: Greg Kroah-Hartman
commit 181339b5409a45e01b8f95043e433cff853981d0
Author: Marc Zyngier
Date: Tue May 2 14:30:39 2017 +0100
KVM: arm/arm64: vgic-v2: Do not use Active+Pending state for a HW interrupt
commit ddf42d068f8802de122bb7efdfcb3179336053f1 upstream.
When an interrupt is injected with the HW bit set (indicating that
deactivation should be propagated to the physical distributor),
special care must be taken so that we never mark the corresponding
LR with the Active+Pending state (as the pending state is kept in
the physycal distributor).
Fixes: 140b086dd197 ("KVM: arm/arm64: vgic-new: Add GICv2 world switch backend")
Signed-off-by: Marc Zyngier
Reviewed-by: Christoffer Dall
Signed-off-by: Christoffer Dall
Signed-off-by: Greg Kroah-Hartman
commit 50f665c39d6cfceee2c87ec7f5320ab7f3ca45dd
Author: Marc Zyngier
Date: Tue May 2 14:30:38 2017 +0100
arm: KVM: Do not use stack-protector to compile HYP code
commit 501ad27c67ed0b90df465f23d33e9aed64058a47 upstream.
We like living dangerously. Nothing explicitely forbids stack-protector
to be used in the HYP code, while distributions routinely compile their
kernel with it. We're just lucky that no code actually triggers the
instrumentation.
Let's not try our luck for much longer, and disable stack-protector
for code living at HYP.
Signed-off-by: Marc Zyngier
Acked-by: Christoffer Dall
Signed-off-by: Christoffer Dall
Signed-off-by: Greg Kroah-Hartman
commit c735d4e3c2d378574f335f3b2c3f8eb80b2ee0a8
Author: Marc Zyngier
Date: Tue May 2 14:30:37 2017 +0100
arm64: KVM: Do not use stack-protector to compile EL2 code
commit cde13b5dad60471886a3bccb4f4134c647c4a9dc upstream.
We like living dangerously. Nothing explicitely forbids stack-protector
to be used in the EL2 code, while distributions routinely compile their
kernel with it. We're just lucky that no code actually triggers the
instrumentation.
Let's not try our luck for much longer, and disable stack-protector
for code living at EL2.
Signed-off-by: Marc Zyngier
Acked-by: Christoffer Dall
Signed-off-by: Christoffer Dall
Signed-off-by: Greg Kroah-Hartman
commit 75295195f763672a48d8097a8f45c295e6fdd3bc
Author: Michael Neuling
Date: Mon May 8 17:16:26 2017 +1000
powerpc/tm: Fix FP and VMX register corruption
commit f48e91e87e67b56bef63393d1a02c6e22c1d7078 upstream.
In commit dc3106690b20 ("powerpc: tm: Always use fp\_state and vr\_state
to store live registers"), a section of code was removed that copied
the current state to checkpointed state. That code should not have been
removed.
When an FP (Floating Point) unavailable is taken inside a transaction,
we need to abort the transaction. This is because at the time of the
tbegin, the FP state is bogus so the state stored in the checkpointed
registers is incorrect. To fix this, we treclaim (to get the
checkpointed GPRs) and then copy the thread\_struct FP live state into
the checkpointed state. We then trecheckpoint so that the FP state is
correctly restored into the CPU.
The copying of the FP registers from live to checkpointed is what was
missing.
This simplifies the logic slightly from the original patch.
tm\_reclaim\_thread() will now always write the checkpointed FP
state. Either the checkpointed FP state will be written as part of
the actual treclaim (in tm.S), or it'll be a copy of the live
state. Which one we use is based on MSR[FP] from userspace.
Similarly for VMX.
Fixes: dc3106690b20 ("powerpc: tm: Always use fp\_state and vr\_state to store live registers")
Signed-off-by: Michael Neuling
Reviewed-by: cyrilbur@gmail.com
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit f9fde78726f859f1d314407ab39104de5d3048f2
Author: Michael Ellerman
Date: Tue May 16 20:42:53 2017 +1000
powerpc/mm: Fix crash in page table dump with huge pages
commit bfb9956ab4d8242f4594b5f4bee534b935384fd9 upstream.
The page table dump code doesn't know about huge pages, so currently
it crashes (or walks random memory, usually leading to a crash), if it
finds a huge page. On Book3S we only see huge pages in the Linux page
tables when we're using the P9 Radix MMU.
Teaching the code to properly handle huge pages is a bit more involved,
so for now just prevent the crash.
Fixes: 8eb07b187000 ("powerpc/mm: Dump linux pagetables")
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit 1d19e3f139f5716ef85a580683f70b1572b8c7f3
Author: LiuHailong
Date: Tue Feb 7 10:35:52 2017 +0800
powerpc/64e: Fix hang when debugging programs with relocated kernel
commit fd615f69a18a9d4aa5ef02a1dc83f319f75da8e7 upstream.
Debug interrupts can be taken during interrupt entry, since interrupt
entry does not automatically turn them off. The kernel will check
whether the faulting instruction is between [interrupt\_base\_book3e,
\_\_end\_interrupts], and if so clear MSR[DE] and return.
However, when the kernel is built with CONFIG\_RELOCATABLE, it can't use
LOAD\_REG\_IMMEDIATE(r14,interrupt\_base\_book3e) and
LOAD\_REG\_IMMEDIATE(r15,\_\_end\_interrupts), as they ignore relocation.
Thus, if the kernel is actually running at a different address than it
was built at, the address comparison will fail, and the exception entry
code will hang at kernel\_dbg\_exc.
r2(toc) is also not usable here, as r2 still holds data from the
interrupted context, so LOAD\_REG\_ADDR() doesn't work either. So we use
the \*name@got\* to get the EV of two labels directly.
Test programs test.c shows as follows:
int main(int argc, char \*argv[])
{
if (access("/proc/sys/kernel/perf\_event\_paranoid", F\_OK) == -1)
printf("Kernel doesn't have perf\_event support\n");
}
Steps to reproduce the bug, for example:
1) ./gdb ./test
2) (gdb) b access
3) (gdb) r
4) (gdb) s
Signed-off-by: Liu Hailong
Signed-off-by: Jiang Xuexin
Reviewed-by: Jiang Biao
Reviewed-by: Liu Song
Reviewed-by: Huang Jian
[scottwood: cleaned up commit message, and specified bad behavior
as a hang rather than an oops to correspond to mainline kernel behavior]
Fixes: 1cb6e0649248 ("powerpc/book3e: support CONFIG\_RELOCATABLE")
Signed-off-by: Scott Wood
Signed-off-by: Greg Kroah-Hartman
commit 31f96d860ef7115d4a24d0abf9e8f7afe62b4f71
Author: Alistair Popple
Date: Wed May 3 13:24:08 2017 +1000
powerpc/powernv: Fix TCE kill on NVLink2
commit 6b3d12a948d27977816a15eb48409a298902a548 upstream.
Commit 616badd2fb49 ("powerpc/powernv: Use OPAL call for TCE kill on
NVLink2") forced all TCE kills to go via the OPAL call for
NVLink2. However the PHB3 implementation of TCE kill was still being
called directly from some functions which in some circumstances caused
a machine check.
This patch adds an equivalent IODA2 version of the function which uses
the correct invalidation method depending on PHB model and changes all
external callers to use it instead.
Fixes: 616badd2fb49 ("powerpc/powernv: Use OPAL call for TCE kill on NVLink2")
Signed-off-by: Alistair Popple
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit 8781143e13ea386c9d199117f7da09477b6f22b4
Author: Alexey Kardashevskiy
Date: Tue Apr 11 17:54:57 2017 +1000
powerpc/iommu: Do not call PageTransHuge() on tail pages
commit e889e96e98e8da97bd39e46b7253615eabe14397 upstream.
The CMA pages migration code does not support compound pages at
the moment so it performs few tests before proceeding to actual page
migration.
One of the tests - PageTransHuge() - has VM\_BUG\_ON\_PAGE(PageTail()) as
it is designed to be called on head pages only. Since we also test for
PageCompound(), and it contains PageTail() and PageHead(), we can
simplify the check by leaving just PageCompound() and therefore avoid
possible VM\_BUG\_ON\_PAGE.
Fixes: 2e5bbb5461f1 ("KVM: PPC: Book3S HV: Migrate pinned pages out of CMA")
Signed-off-by: Alexey Kardashevskiy
Acked-by: Balbir Singh
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit eb0807b288ac5b75d80553148616160ebb4cb51f
Author: Tyrel Datwyler
Date: Mon Apr 17 20:24:39 2017 -0400
powerpc/sysfs: Fix reference leak of cpu device\_nodes present at boot
commit e76ca27790a514590af782f83f6eae49e0ccf8c9 upstream.
For CPUs present at boot each logical CPU acquires a reference to the
associated device node of the core. This happens in register\_cpu() which
is called by topology\_init(). The result of this is that we end up with
a reference held by each thread of the core. However, these references
are never freed if the CPU core is DLPAR removed.
This patch fixes the reference leaks by acquiring and releasing the references
in the CPU hotplug callbacks un/register\_cpu\_online(). With this patch symmetric
reference counting is observed with both CPUs present at boot, and those DLPAR
added after boot.
Fixes: f86e4718f24b ("driver/core: cpu: initialize of\_node in cpu's device struture")
Signed-off-by: Tyrel Datwyler
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit d731227327be584369ec370f5527a8d0fea7a792
Author: Tyrel Datwyler
Date: Mon Apr 17 20:21:40 2017 -0400
powerpc/pseries: Fix of\_node\_put() underflow during DLPAR remove
commit 68baf692c435339e6295cb470ea5545cbc28160e upstream.
Historically struct device\_node references were tracked using a kref embedded as
a struct field. Commit 75b57ecf9d1d ("of: Make device nodes kobjects so they
show up in sysfs") (Mar 2014) refactored device\_nodes to be kobjects such that
the device tree could by more simply exposed to userspace using sysfs.
Commit 0829f6d1f69e ("of: device\_node kobject lifecycle fixes") (Mar 2014)
followed up these changes to better control the kobject lifecycle and in
particular the referecne counting via of\_node\_get(), of\_node\_put(), and
of\_node\_init().
A result of this second commit was that it introduced an of\_node\_put() call when
a dynamic node is detached, in of\_node\_remove(), that removes the initial kobj
reference created by of\_node\_init().
Traditionally as the original dynamic device node user the pseries code had
assumed responsibilty for releasing this final reference in its platform
specific DLPAR detach code.
This patch fixes a refcount underflow introduced by commit 0829f6d1f6, and
recently exposed by the upstreaming of the recount API.
Messages like the following are no longer seen in the kernel log with this
patch following DLPAR remove operations of cpus and pci devices.
rpadlpar\_io: slot PHB 72 removed
refcount\_t: underflow; use-after-free.
------------[ cut here ]------------
WARNING: CPU: 5 PID: 3335 at lib/refcount.c:128 refcount\_sub\_and\_test+0xf4/0x110
Fixes: 0829f6d1f69e ("of: device\_node kobject lifecycle fixes")
Signed-off-by: Tyrel Datwyler
[mpe: Make change log commit references more verbose]
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit 11e382b3b8520bb9a4577e3a4995f09c0e5dbb5c
Author: Mahesh Salgaonkar
Date: Tue Apr 18 22:08:17 2017 +0530
powerpc/book3s/mce: Move add\_taint() later in virtual mode
commit d93b0ac01a9ce276ec39644be47001873d3d183c upstream.
machine\_check\_early() gets called in real mode. The very first time when
add\_taint() is called, it prints a warning which ends up calling opal
call (that uses OPAL\_CALL wrapper) for writing it to console. If we get a
very first machine check while we are in opal we are doomed. OPAL\_CALL
overwrites the PACASAVEDMSR in r13 and in this case when we are done with
MCE handling the original opal call will use this new MSR on it's way
back to opal\_return. This usually leads to unexpected behaviour or the
kernel to panic. Instead move the add\_taint() call later in the virtual
mode where it is safe to call.
This is broken with current FW level. We got lucky so far for not getting
very first MCE hit while in OPAL. But easily reproducible on Mambo.
Fixes: 27ea2c420cad ("powerpc: Set the correct kernel taint on machine check errors.")
Signed-off-by: Mahesh Salgaonkar
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit e548d552c01e9666b7316054964b4696e4a71072
Author: Russell Currey
Date: Wed Apr 19 17:39:26 2017 +1000
powerpc/eeh: Avoid use after free in eeh\_handle\_special\_event()
commit daeba2956f32f91f3493788ff6ee02fb1b2f02fa upstream.
eeh\_handle\_special\_event() is called when an EEH event is detected but
can't be narrowed down to a specific PE. This function looks through
every PE to find one in an erroneous state, then calls the regular event
handler eeh\_handle\_normal\_event() once it knows which PE has an error.
However, if eeh\_handle\_normal\_event() found that the PE cannot possibly
be recovered, it will free it, rendering the passed PE stale.
This leads to a use after free in eeh\_handle\_special\_event() as it attempts to
clear the "recovering" state on the PE after eeh\_handle\_normal\_event() returns.
Thus, make sure the PE is valid when attempting to clear state in
eeh\_handle\_special\_event().
Fixes: 8a6b1bc70dbb ("powerpc/eeh: EEH core to handle special event")
Reported-by: Alexey Kardashevskiy
Signed-off-by: Russell Currey
Reviewed-by: Gavin Shan
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit 63f44c113b22452921d41b5314f9781c5bf709b3
Author: David Gibson
Date: Wed Apr 19 16:38:26 2017 +1000
powerpc/mm: Ensure IRQs are off in switch\_mm()
commit 9765ad134a00a01cbcc69c78ff6defbfad209bc5 upstream.
powerpc expects IRQs to already be (soft) disabled when switch\_mm() is
called, as made clear in the commit message of 9c1e105238c4 ("powerpc: Allow
perf\_counters to access user memory at interrupt time").
Aside from any race conditions that might exist between switch\_mm() and an IRQ,
there is also an unconditional hard\_irq\_disable() in switch\_slb(). If that isn't
followed at some point by an IRQ enable then interrupts will remain disabled
until we return to userspace.
It is true that when switch\_mm() is called from the scheduler IRQs are off, but
not when it's called by use\_mm(). Looking closer we see that last year in commit
f98db6013c55 ("sched/core: Add switch\_mm\_irqs\_off() and use it in the scheduler")
this was made more explicit by the addition of switch\_mm\_irqs\_off() which is now
called by the scheduler, vs switch\_mm() which is used by use\_mm().
Arguably it is a bug in use\_mm() to call switch\_mm() in a different context than
it expects, but fixing that will take time.
This was discovered recently when vhost started throwing warnings such as:
BUG: sleeping function called from invalid context at kernel/mutex.c:578
in\_atomic(): 0, irqs\_disabled(): 1, pid: 10768, name: vhost-10760
no locks held by vhost-10760/10768.
irq event stamp: 10
hardirqs last enabled at (9): \_raw\_spin\_unlock\_irq+0x40/0x80
hardirqs last disabled at (10): switch\_slb+0x2e4/0x490
softirqs last enabled at (0): copy\_process+0x5e8/0x1260
softirqs last disabled at (0): (null)
Call Trace:
show\_stack+0x88/0x390 (unreliable)
dump\_stack+0x30/0x44
\_\_might\_sleep+0x1c4/0x2d0
mutex\_lock\_nested+0x74/0x5c0
cgroup\_attach\_task\_all+0x5c/0x180
vhost\_attach\_cgroups\_work+0x58/0x80 [vhost]
vhost\_worker+0x24c/0x3d0 [vhost]
kthread+0xec/0x100
ret\_from\_kernel\_thread+0x5c/0xd4
Prior to commit 04b96e5528ca ("vhost: lockless enqueuing") (Aug 2016) the
vhost\_worker() would do a spin\_unlock\_irq() not long after calling use\_mm(),
which had the effect of reenabling IRQs. Since that commit removed the locking
in vhost\_worker() the body of the vhost\_worker() loop now runs with interrupts
off causing the warnings.
This patch addresses the problem by making the powerpc code mirror the x86 code,
ie. we disable interrupts in switch\_mm(), and optimise the scheduler case by
defining switch\_mm\_irqs\_off().
Signed-off-by: David Gibson
[mpe: Flesh out/rewrite change log, add stable]
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit 5617775ed133092e521a617f45c9b6beb7e77e74
Author: Johan Hovold
Date: Mon Mar 13 09:53:56 2017 -0300
cx231xx-cards: fix NULL-deref at probe
commit 0cd273bb5e4d1828efaaa8dfd11b7928131ed149 upstream.
Make sure to check the number of endpoints to avoid dereferencing a
NULL-pointer or accessing memory beyond the endpoint array should a
malicious device lack the expected endpoints.
Fixes: e0d3bafd0258 ("V4L/DVB (10954): Add cx231xx USB driver")
Cc: Sri Deevi
Signed-off-by: Johan Hovold
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 6f623a34905f5723d514c89495401a1bdda9cd5d
Author: Johan Hovold
Date: Mon Mar 13 09:53:58 2017 -0300
cx231xx-audio: fix NULL-deref at probe
commit 65f921647f4c89a2068478c89691f39b309b58f7 upstream.
Make sure to check the number of endpoints to avoid dereferencing a
NULL-pointer or accessing memory beyond the endpoint array should a
malicious device lack the expected endpoints.
Fixes: e0d3bafd0258 ("V4L/DVB (10954): Add cx231xx USB driver")
Cc: Sri Deevi
Signed-off-by: Johan Hovold
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 8bb9fa63d0295cd03ad090c68a8a69b0eb98863b
Author: Johan Hovold
Date: Mon Mar 13 09:53:57 2017 -0300
cx231xx-audio: fix init error path
commit fff1abc4d54e469140a699612b4db8d6397bfcba upstream.
Make sure to release the snd\_card also on a late allocation error.
Fixes: e0d3bafd0258 ("V4L/DVB (10954): Add cx231xx USB driver")
Cc: Sri Deevi
Signed-off-by: Johan Hovold
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit a28e1f13a6e35a4ca078711f4383a9f3d209f15c
Author: Alyssa Milburn
Date: Sat Apr 1 14:34:49 2017 -0300
dw2102: limit messages to buffer size
commit 950e252cb469f323740d78e4907843acef89eedb upstream.
Otherwise the i2c transfer functions can read or write beyond the end of
stack or heap buffers.
Signed-off-by: Alyssa Milburn
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit f953d6b03a2fc2837ef6c2aee66cdf55ee95e28a
Author: Alyssa Milburn
Date: Sat Apr 1 14:33:42 2017 -0300
digitv: limit messages to buffer size
commit 821117dc21083a99dd99174c10848d70ff43de29 upstream.
Return an error rather than memcpy()ing beyond the end of the buffer.
Internal callers use appropriate sizes, but digitv\_i2c\_xfer may not.
Signed-off-by: Alyssa Milburn
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 9e074c588db15a80c936d432015e8416a35d4956
Author: Daniel Scheller
Date: Sun Mar 19 12:26:39 2017 -0300
dvb-frontends/cxd2841er: define symbol\_rate\_min/max in T/C fe-ops
commit 158f0328af86a99d64073851967a02694bff987d upstream.
Fixes "w\_scan -f c" complaining with
This dvb driver is \*buggy\*: the symbol rate limits are undefined - please
report to linuxtv.org)
Signed-off-by: Daniel Scheller
Acked-by: Abylay Ospan
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit ac6dedddbadc66774a7249904c6a562f236fd8ef
Author: Alyssa Milburn
Date: Sat Apr 1 14:34:08 2017 -0300
zr364xx: enforce minimum size when reading header
commit ee0fe833d96793853335844b6d99fb76bd12cbeb upstream.
This code copies actual\_length-128 bytes from the header, which will
underflow if the received buffer is too small.
Signed-off-by: Alyssa Milburn
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 20c98053a259118ec89c91af73630e2a21583815
Author: Johan Hovold
Date: Mon Mar 13 09:53:54 2017 -0300
dib0700: fix NULL-deref at probe
commit d5823511c0f8719a39e72ede1bce65411ac653b7 upstream.
Make sure to check the number of endpoints to avoid dereferencing a
NULL-pointer should a malicious device lack endpoints.
Fixes: c4018fa2e4c0 ("[media] dib0700: fix RC support on Hauppauge
Nova-TD")
Cc: Mauro Carvalho Chehab
Signed-off-by: Johan Hovold
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 6af3917b8dddc42e2bfc84fb89d1e186281f1ffb
Author: Marek Szyprowski
Date: Wed Mar 22 04:53:57 2017 -0300
s5p-mfc: Fix unbalanced call to clock management
commit a5cb00eb4223458250b55daf03ac7ea5f424d601 upstream.
Clock should be turned off after calling s5p\_mfc\_init\_hw() from the
watchdog worker, like it is already done in the s5p\_mfc\_open() which also
calls this function.
Fixes: af93574678108 ("[media] MFC: Add MFC 5.1 V4L2 driver")
Signed-off-by: Marek Szyprowski
Signed-off-by: Sylwester Nawrocki
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 4f220307a8b232b3b1ddc1de3cc3c17a80ae3a01
Author: Johan Hovold
Date: Mon Mar 13 09:53:59 2017 -0300
gspca: konica: add missing endpoint sanity check
commit aa58fedb8c7b6cf2f05941d238495f9e2f29655c upstream.
Make sure to check the number of endpoints to avoid accessing memory
beyond the endpoint array should a device lack the expected endpoints.
Note that, as far as I can tell, the gspca framework has already made
sure there is at least one endpoint in the current alternate setting so
there should be no risk for a NULL-pointer dereference here.
Fixes: b517af722860 ("V4L/DVB: gspca\_konica: New gspca subdriver for
konica chipset using cams")
Cc: Hans de Goede
Signed-off-by: Johan Hovold
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit d926ceaa72c89eb928f02b19ac602db6884dc0f3
Author: Marek Szyprowski
Date: Thu Feb 23 08:43:27 2017 -0300
s5p-mfc: Fix race between interrupt routine and device functions
commit 0c32b8ec02832df167e16ad659cb11dc148f2ddf upstream.
Interrupt routine must wake process waiting for given interrupt AFTER
updating driver's internal structures and contexts. Doing it in-between
is a serious bug. This patch moves all calls to the wake() function to
the end of the interrupt processing block to avoid potential and real
races, especially on multi-core platforms. This also fixes following issue
reported from clock core (clocks were disabled in interrupt after being
unprepared from the other place in the driver, the stack trace however
points to the different place than s5p\_mfc driver because of the race):
WARNING: CPU: 1 PID: 18 at drivers/clk/clk.c:544 clk\_core\_unprepare+0xc8/0x108
Modules linked in:
CPU: 1 PID: 18 Comm: kworker/1:0 Not tainted 4.10.0-next-20170223-00070-g04e18bc99ab9-dirty #2154
Hardware name: SAMSUNG EXYNOS (Flattened Device Tree)
Workqueue: pm pm\_runtime\_work
[] (unwind\_backtrace) from [] (show\_stack+0x10/0x14)
[] (show\_stack) from [] (dump\_stack+0x74/0x94)
[] (dump\_stack) from [] (\_\_warn+0xd4/0x100)
[] (\_\_warn) from [] (warn\_slowpath\_null+0x20/0x28)
[] (warn\_slowpath\_null) from [] (clk\_core\_unprepare+0xc8/0x108)
[] (clk\_core\_unprepare) from [] (clk\_unprepare+0x24/0x2c)
[] (clk\_unprepare) from [] (exynos\_sysmmu\_suspend+0x48/0x60)
[] (exynos\_sysmmu\_suspend) from [] (pm\_generic\_runtime\_suspend+0x2c/0x38)
[] (pm\_generic\_runtime\_suspend) from [] (genpd\_runtime\_suspend+0x94/0x220)
[] (genpd\_runtime\_suspend) from [] (\_\_rpm\_callback+0x134/0x208)
[] (\_\_rpm\_callback) from [] (rpm\_callback+0x20/0x80)
[] (rpm\_callback) from [] (rpm\_suspend+0xdc/0x458)
[] (rpm\_suspend) from [] (pm\_runtime\_work+0x80/0x90)
[] (pm\_runtime\_work) from [] (process\_one\_work+0x120/0x318)
[] (process\_one\_work) from [] (worker\_thread+0x2c/0x4ac)
[] (worker\_thread) from [] (kthread+0xfc/0x134)
[] (kthread) from [] (ret\_from\_fork+0x14/0x3c)
---[ end trace 1ead49a7bb83f0d8 ]---
Fixes: af93574678108 ("[media] MFC: Add MFC 5.1 V4L2 driver")
Signed-off-by: Marek Szyprowski
Reviewed-by: Javier Martinez Canillas
Signed-off-by: Sylwester Nawrocki
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 776a591f7546796baf0629b6cd34c0abd30fc903
Author: Lee Jones
Date: Tue Apr 4 09:32:19 2017 -0300
cec: Fix runtime BUG when (CONFIG\_RC\_CORE && !CEC\_CAP\_RC)
commit 43c0c03961d0b19bd225a336897606b46e0021a6 upstream.
Currently when the RC Core is enabled (reachable) core code located
in cec\_register\_adapter() attempts to populate the RC structure with
a pointer to the 'parent' passed in by the caller.
Unfortunately if the caller did not specify RC capability when calling
cec\_allocate\_adapter(), then there will be no RC structure to populate.
This causes a "NULL pointer dereference" error.
Fixes: f51e80804f0 ("[media] cec: pass parent device in register(), not allocate()")
Signed-off-by: Lee Jones
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 0d1015c0e923178c938cd578001bf583f6c9bacc
Author: Srinivas Pandruvada
Date: Fri Apr 7 17:13:17 2017 -0700
iio: hid-sensor: Store restore poll and hysteresis on S3
commit 5d9854eaea776441b38a9a45b4e6879524c4f48c upstream.
This change undo the change done by 'commit 3bec24747446
("iio: hid-sensor-trigger: Change get poll value function order to avoid
sensor properties losing after resume from S3")' as this breaks some
USB/i2c sensor hubs.
Instead of relying on HW for restoring poll and hysteresis, driver stores
and restores on resume (S3). In this way user space modified settings are
not lost for any kind of sensor hub behavior.
In this change, whenever user space modifies sampling frequency or
hysteresis driver will get the feature value from the hub and store in the
per device hid\_sensor\_common data structure. On resume callback from S3,
system will set the feature to sensor hub, if user space ever modified the
feature value.
Fixes: 3bec24747446 ("iio: hid-sensor-trigger: Change get poll value function order to avoid sensor properties losing after resume from S3")
Reported-by: Ritesh Raj Sarraf
Tested-by: Ritesh Raj Sarraf
Tested-by: Song, Hongyan
Signed-off-by: Srinivas Pandruvada
Signed-off-by: Jonathan Cameron
Signed-off-by: Greg Kroah-Hartman
commit 03652e488454744b00d57fd2f257c401773bbbf9
Author: Matt Ranostay
Date: Thu Apr 13 23:21:56 2017 -0700
iio: proximity: as3935: fix as3935\_write
commit 84ca8e364acb26aba3292bc113ca8ed4335380fd upstream.
AS3935\_WRITE\_DATA macro bit is incorrect and the actual write
sequence is two leading zeros.
Cc: George McCollister
Signed-off-by: Matt Ranostay
Signed-off-by: Jonathan Cameron
Signed-off-by: Greg Kroah-Hartman
commit b13b3f39851681b3e7f0f4ea2fcea4a0e47f4f0a
Author: Dan Carpenter
Date: Tue May 2 13:58:53 2017 +0300
ipx: call ipxitf\_put() in ioctl error path
commit ee0d8d8482345ff97a75a7d747efc309f13b0d80 upstream.
We should call ipxitf\_put() if the copy\_to\_user() fails.
Reported-by: 李强
Signed-off-by: Dan Carpenter
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 1e2a08069dea9ac4365c32bec88b2df2f10cd3b7
Author: Johan Hovold
Date: Wed May 10 18:18:28 2017 +0200
USB: hub: fix non-SS hub-descriptor handling
commit bec444cd1c94c48df409a35ad4e5b143c245c3f7 upstream.
Add missing sanity check on the non-SuperSpeed hub-descriptor length in
order to avoid parsing and leaking two bytes of uninitialised slab data
through sysfs removable-attributes (or a compound-device debug
statement).
Note that we only make sure that the DeviceRemovable field is always
present (and specifically ignore the unused PortPwrCtrlMask field) in
order to continue support any hubs with non-compliant descriptors. As a
further safeguard, the descriptor buffer is also cleared.
Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
Signed-off-by: Johan Hovold
Acked-by: Alan Stern
Signed-off-by: Greg Kroah-Hartman
commit 345477ed11af2884b086ecefbcc4ce2716b7acab
Author: Johan Hovold
Date: Wed May 10 18:18:27 2017 +0200
USB: hub: fix SS hub-descriptor handling
commit 2c25a2c818023df64463aac3288a9f969491e507 upstream.
A SuperSpeed hub descriptor does not have any variable-length fields so
bail out when reading a short descriptor.
This avoids parsing and leaking two bytes of uninitialised slab data
through sysfs removable-attributes.
Fixes: dbe79bbe9dcb ("USB 3.0 Hub Changes")
Cc: John Youn
Acked-by: Alan Stern
Signed-off-by: Johan Hovold
Signed-off-by: Greg Kroah-Hartman
commit 3a82455292c2b817031db57f6954f8b7e7b1dd38
Author: Johan Hovold
Date: Thu May 11 11:41:21 2017 +0200
USB: serial: io\_ti: fix div-by-zero in set\_termios
commit 6aeb75e6adfaed16e58780309613a578fe1ee90b upstream.
Fix a division-by-zero in set\_termios when debugging is enabled and a
high-enough speed has been requested so that the divisor value becomes
zero.
Instead of just fixing the offending debug statement, cap the baud rate
at the base as a zero divisor value also appears to crash the firmware.
Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
Reviewed-by: Greg Kroah-Hartman
Signed-off-by: Johan Hovold
Signed-off-by: Greg Kroah-Hartman
commit e4d3ae36fcb248aa1538bc654bd871f39f27b725
Author: Johan Hovold
Date: Thu May 11 11:41:20 2017 +0200
USB: serial: mct\_u232: fix big-endian baud-rate handling
commit 26cede343656c0bc2c33cdc783771282405c7fb2 upstream.
Drop erroneous cpu\_to\_le32 when setting the baud rate, something which
corrupted the divisor on big-endian hosts.
Found using sparse:
warning: incorrect type in argument 1 (different base types)
expected unsigned int [unsigned] [usertype] val
got restricted \_\_le32 [usertype]
Fixes: af2ac1a091bc ("USB: serial mct\_usb232: move DMA buffers to heap")
Reviewed-by: Greg Kroah-Hartman
Acked-By: Pete Zaitcev
Signed-off-by: Johan Hovold
Signed-off-by: Greg Kroah-Hartman
commit 07cf1f9d0150e66c2219dd96952ae6a3a8b69bfe
Author: Bjørn Mork
Date: Wed May 17 16:30:50 2017 +0200
USB: serial: qcserial: add more Lenovo EM74xx device IDs
commit 8d7a10dd323993cc40bd37bce8bc570133b0c396 upstream.
In their infinite wisdom, and never ending quest for end user frustration,
Lenovo has decided to use new USB device IDs for the wwan modules in
their 2017 laptops. The actual hardware is still the Sierra Wireless
EM7455 or EM7430, depending on region.
Signed-off-by: Bjørn Mork
Signed-off-by: Johan Hovold
Signed-off-by: Greg Kroah-Hartman
commit d986525b7dfcfc6edc57a060c382aecf34019f62
Author: Daniele Palmas
Date: Wed May 3 10:28:54 2017 +0200
usb: serial: option: add Telit ME910 support
commit 40dd46048c155b8f0683f468c950a1c107f77a7c upstream.
This patch adds support for Telit ME910 PID 0x1100.
Signed-off-by: Daniele Palmas
Signed-off-by: Johan Hovold
Signed-off-by: Greg Kroah-Hartman
commit b58d7087ce99016ed0d8739933f813e03e0f28eb
Author: Johan Hovold
Date: Thu May 11 11:36:02 2017 +0200
USB: iowarrior: fix info ioctl on big-endian hosts
commit dd5ca753fa92fb736b1395db892bd29f78e6d408 upstream.
Drop erroneous le16\_to\_cpu when returning the USB device speed which is
already in host byte order.
Found using sparse:
warning: cast to restricted \_\_le16
Fixes: 946b960d13c1 ("USB: add driver for iowarrior devices.")
Signed-off-by: Johan Hovold
Signed-off-by: Greg Kroah-Hartman
commit d69737cb64abae66b8d80ee977612a52e9f2d0d8
Author: Tony Lindgren
Date: Wed May 17 11:23:10 2017 -0500
usb: musb: Fix trying to suspend while active for OTG configurations
commit 3c50ffef25855a9d9e4b07b02d756a8cdd653069 upstream.
Commit d8e5f0eca1e8 ("usb: musb: Fix hardirq-safe hardirq-unsafe
lock order error") caused a regression where musb keeps trying to
enable host mode with no cable connected. This seems to be caused
by the fact that now phy is enabled earlier, and we are wrongly
trying to force USB host mode on an OTG port. The errors we are
getting are "trying to suspend as a\_idle while active".
For ports configured as OTG, we should not need to do anything
to try to force USB host mode on it's OTG port. Trying to force host
mode in this case just seems to completely confuse the musb state
machine.
Let's fix the issue by making musb\_host\_setup() attempt to force the
mode only if port\_mode is configured for host mode.
Fixes: d8e5f0eca1e8 ("usb: musb: Fix hardirq-safe hardirq-unsafe lock order error")
Cc: Johan Hovold
Reported-by: Laurent Pinchart
Reported-by: Peter Ujfalusi
Tested-by: Peter Ujfalusi
Signed-off-by: Tony Lindgren
Signed-off-by: Bin Liu
Signed-off-by: Greg Kroah-Hartman
commit 925f7f9244b2d166efab7c2f92ab7b5d8c2f7717
Author: Peter Ujfalusi
Date: Wed May 17 11:23:11 2017 -0500
usb: musb: tusb6010\_omap: Do not reset the other direction's packet size
commit 6df2b42f7c040d57d9ecb67244e04e905ab87ac6 upstream.
We have one register for each EP to set the maximum packet size for both
TX and RX.
If for example an RX programming would happen before the previous TX
transfer finishes we would reset the TX packet side.
To fix this issue, only modify the TX or RX part of the register.
Fixes: 550a7375fe72 ("USB: Add MUSB and TUSB support")
Signed-off-by: Peter Ujfalusi
Tested-by: Tony Lindgren
Signed-off-by: Bin Liu
Signed-off-by: Greg Kroah-Hartman
commit 33c19ef5e24a2fa281e13af657c5714bc8da6f17
Author: Thinh Nguyen
Date: Thu May 11 17:26:47 2017 -0700
usb: dwc3: gadget: Prevent losing events in event cache
commit d325a1de49d61ee11aca58a529571c91ecea7879 upstream.
The dwc3 driver can overwite its previous events if its top-half IRQ
handler (TH) gets invoked again before processing the events in the
cache. We see this as a hang in the file transfer and the host will
attempt to reset the device. TH gets the event count and deasserts the
interrupt line by writing DWC3\_GEVNTSIZ\_INTMASK to DWC3\_GEVNTSIZ. If
there's a new event coming between reading the event count and interrupt
deassertion, dwc3 will lose previous pending events. More generally, we
will see 0 event count, which should not affect anything.
This shouldn't be possible in the current dwc3 implementation. However,
through testing and reading the PCIe trace, the TH occasionally still
gets invoked one more time after HW interrupt deassertion. (With PCIe
legacy interrupts, TH is called repeatedly as long as the interrupt line
is asserted). We suspect that there is a small detection delay in the
SW.
To avoid this issue, Check DWC3\_EVENT\_PENDING flag to determine if the
events are processed in the bottom-half IRQ handler. If not, return
IRQ\_HANDLED and don't process new event.
Signed-off-by: Thinh Nguyen
Signed-off-by: Felipe Balbi
Signed-off-by: Greg Kroah-Hartman
commit 79312c5d61429a32761412be85ad7a84bfaa3b5c
Author: Ben Hutchings
Date: Fri Feb 17 22:30:51 2017 -0200
dvb-usb-dibusb-mc-common: Add MODULE\_LICENSE
commit bf05b65a9fe5f6a6dd3e72cab2aacd8b5b96e41d upstream.
dvb-usb-dibusb-mc-common is licensed under GPLv2, and if we don't say
so then it won't even load since it needs a GPL-only symbol.
Fixes: e91455a1495a ("[media] dvb-usb: split out common parts of dibusb")
Reported-by: Dominique Dumont
Signed-off-by: Ben Hutchings
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 8d730619ae01ebb8049f3ab292e262048ab0f3ca
Author: Alyssa Milburn
Date: Sat Apr 1 14:34:32 2017 -0300
ttusb2: limit messages to buffer size
commit a12b8ab8c5ff7ccd7b107a564743507c850a441d upstream.
Otherwise ttusb2\_i2c\_xfer can read or write beyond the end of static and
heap buffers.
Signed-off-by: Alyssa Milburn
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit f2b30b2f19a9cc013fbb04144cea3896df2eabb1
Author: Johan Hovold
Date: Tue Mar 7 15:14:13 2017 -0300
mceusb: fix NULL-deref at probe
commit 03eb2a557ed552e920a0942b774aaf931596eec1 upstream.
Make sure to check for the required out endpoint to avoid dereferencing
a NULL-pointer in mce\_request\_packet should a malicious device lack such
an endpoint. Note that this path is hit during probe.
Fixes: 66e89522aff7 ("V4L/DVB: IR: add mceusb IR receiver driver")
Signed-off-by: Johan Hovold
Signed-off-by: Sean Young
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 03a7e78a25f6b4694220f30bb9e6d78ad86efaca
Author: Johan Hovold
Date: Mon Mar 13 09:53:55 2017 -0300
usbvision: fix NULL-deref at probe
commit eacb975b48272f54532b62f515a3cf7eefa35123 upstream.
Make sure to check the number of endpoints to avoid dereferencing a
NULL-pointer or accessing memory beyond the endpoint array should a
malicious device lack the expected endpoints.
Fixes: 2a9f8b5d25be ("V4L/DVB (5206): Usbvision: set alternate interface
modification")
Cc: Thierry MERLE
Signed-off-by: Johan Hovold
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 3aade67b765fd28f5332335f59cb3300f2b4c3f9
Author: Johan Hovold
Date: Fri May 12 12:11:13 2017 +0200
net: irda: irda-usb: fix firmware name on big-endian hosts
commit 75cf067953d5ee543b3bda90bbfcbee5e1f94ae8 upstream.
Add missing endianness conversion when using the USB device-descriptor
bcdDevice field to construct a firmware file name.
Fixes: 8ef80aef118e ("[IRDA]: irda-usb.c: STIR421x cleanups")
Cc: Nick Fedchik
Signed-off-by: Johan Hovold
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 0cc9aa4c4bd4876eaeb2f5511ea306512855eef5
Author: Peter Chen
Date: Wed May 17 18:32:01 2017 +0300
usb: host: xhci-mem: allocate zeroed Scratchpad Buffer
commit 7480d912d549f414e0ce39331870899e89a5598c upstream.
According to xHCI ch4.20 Scratchpad Buffers, the Scratchpad
Buffer needs to be zeroed.
...
The following operations take place to allocate
Scratchpad Buffers to the xHC:
...
b. Software clears the Scratchpad Buffer to '0'
Signed-off-by: Peter Chen
Signed-off-by: Mathias Nyman
Signed-off-by: Greg Kroah-Hartman
commit 966e88d54088007cbacedcbe3d2a76812f03dc0f
Author: Mathias Nyman
Date: Wed May 17 18:32:00 2017 +0300
xhci: apply PME\_STUCK\_QUIRK and MISSING\_CAS quirk for Denverton
commit a0c16630d35a874e82bdf2088f58ecaca1024315 upstream.
Intel Denverton microserver is Atom based and need the PME and CAS quirks
as well.
Signed-off-by: Mathias Nyman
Signed-off-by: Greg Kroah-Hartman
commit 5077513b4e8c0ab4d314b68d73f23e78bacf7a44
Author: Alan Stern
Date: Wed May 17 18:32:03 2017 +0300
USB: xhci: fix lock-inversion problem
commit 63aea0dbab90a2461faaae357cbc8cfd6c8de9fe upstream.
With threaded interrupts, bottom-half handlers are called with
interrupts enabled. Therefore they can't safely use spin\_lock(); they
have to use spin\_lock\_irqsave(). Lockdep warns about a violation
occurring in xhci\_irq():
=========================================================
[ INFO: possible irq lock inversion dependency detected ]
4.11.0-rc8-dbg+ #1 Not tainted
---------------------------------------------------------
swapper/7/0 just changed the state of lock:
(&(&ehci->lock)->rlock){-.-...}, at: []
ehci\_hrtimer\_func+0x29/0xc0 [ehci\_hcd]
but this lock took another, HARDIRQ-unsafe lock in the past:
(hcd\_urb\_list\_lock){+.....}
and interrupts could create inverse lock ordering between them.
other info that might help us debug this:
Possible interrupt unsafe locking scenario:
CPU0 CPU1
---- ----
lock(hcd\_urb\_list\_lock);
local\_irq\_disable();
lock(&(&ehci->lock)->rlock);
lock(hcd\_urb\_list\_lock);
lock(&(&ehci->lock)->rlock);
\*\*\* DEADLOCK \*\*\*
no locks held by swapper/7/0.
the shortest dependencies between 2nd lock and 1st lock:
-> (hcd\_urb\_list\_lock){+.....} ops: 252 {
HARDIRQ-ON-W at:
\_\_lock\_acquire+0x602/0x1280
lock\_acquire+0xd5/0x1c0
\_raw\_spin\_lock+0x2f/0x40
usb\_hcd\_unlink\_urb\_from\_ep+0x1b/0x60 [usbcore]
xhci\_giveback\_urb\_in\_irq.isra.45+0x70/0x1b0 [xhci\_hcd]
finish\_td.constprop.60+0x1d8/0x2e0 [xhci\_hcd]
xhci\_irq+0xdd6/0x1fa0 [xhci\_hcd]
usb\_hcd\_irq+0x26/0x40 [usbcore]
irq\_forced\_thread\_fn+0x2f/0x70
irq\_thread+0x149/0x1d0
kthread+0x113/0x150
ret\_from\_fork+0x2e/0x40
This patch fixes the problem.
Signed-off-by: Alan Stern
Reported-and-tested-by: Bart Van Assche
Signed-off-by: Mathias Nyman
Signed-off-by: Greg Kroah-Hartman
commit 354c85b7adb91c3e99efd7d3f0e8307062341e2a
Author: Thomas Petazzoni
Date: Wed May 17 18:32:06 2017 +0300
usb: host: xhci-plat: propagate return value of platform\_get\_irq()
commit 4b148d5144d64ee135b8924350cb0b3a7fd21150 upstream.
platform\_get\_irq() returns an error code, but the xhci-plat driver
ignores it and always returns -ENODEV. This is not correct, and
prevents -EPROBE\_DEFER from being propagated properly.
Signed-off-by: Thomas Petazzoni
Signed-off-by: Mathias Nyman
Signed-off-by: Greg Kroah-Hartman
commit c3dc5f5ae54c9a2697f91144da6a72a24ed22055
Author: Matthias Lange
Date: Wed May 17 18:32:04 2017 +0300
xhci: remove GFP\_DMA flag from allocation
commit 5db851cf20857c5504b146046e97cb7781f2a743 upstream.
There is no reason to restrict allocations to the first 16MB ISA DMA
addresses.
It is causing problems in a virtualization setup with enabled IOMMU
(x86\_64). The result is that USB is not working in the VM.
Signed-off-by: Matthias Lange
Signed-off-by: Mathias Nyman
Signed-off-by: Greg Kroah-Hartman
commit d0c8639797278a78df3fd3a49b10ce3e7ca3d503
Author: Mathias Nyman
Date: Wed May 17 18:32:05 2017 +0300
xhci: Fix command ring stop regression in 4.11
commit 604d02a2a66ab7f93fd3b2bde3698c29ef057b65 upstream.
In 4.11 TRB completion codes were renamed to match spec.
Completion codes for command ring stopped and endpoint stopped
were mixed, leading to failures while handling a stopped command ring.
Use the correct completion code for command ring stopped events.
Fixes: 0b7c105a04ca ("usb: host: xhci: rename completion codes to match spec")
Signed-off-by: Mathias Nyman
Signed-off-by: Greg Kroah-Hartman
commit 1b8de0a2bb88636afcd1e48c8d20bf9d14eca27d
Author: Yazen Ghannam
Date: Thu Apr 27 12:11:54 2017 -0500
EDAC, amd64: Fix reporting of Chip Select sizes on Fam17h
commit eb77e6b80f3bed262c7773236f0fb84649fd3091 upstream.
The wrong index into the csbases/csmasks arrays was being passed to
the function to compute the chip select sizes, which resulted in the
wrong size being computed. Address that so that the correct values are
computed and printed.
Also, redo how we calculate the number of pages in a CS row.
Reported-by: Benjamin Bennett
Signed-off-by: Yazen Ghannam
Cc: linux-edac
Link: http://lkml.kernel.org/r/1493313114-11260-1-git-send-email-Yazen.Ghannam@amd.com
[ Remove unneeded integer math comment, minor cleanups. ]
Signed-off-by: Borislav Petkov
Signed-off-by: Greg Kroah-Hartman
commit 0a4115da6135293f0568c85a9c621190e1695333
Author: Jan Kara
Date: Fri May 12 15:46:57 2017 -0700
dax: fix data corruption when fault races with write
commit 13e451fdc1af05568ea379d71c02a126295d2244 upstream.
Currently DAX read fault can race with write(2) in the following way:
CPU1 - write(2) CPU2 - read fault
dax\_iomap\_pte\_fault()
->iomap\_begin() - sees hole
dax\_iomap\_rw()
iomap\_apply()
->iomap\_begin - allocates blocks
dax\_iomap\_actor()
invalidate\_inode\_pages2\_range()
- there's nothing to invalidate
grab\_mapping\_entry()
- we add zero page in the radix tree
and map it to page tables
The result is that hole page is mapped into page tables (and thus zeros
are seen in mmap) while file has data written in that place.
Fix the problem by locking exception entry before mapping blocks for the
fault. That way we are sure invalidate\_inode\_pages2\_range() call for
racing write will either block on entry lock waiting for the fault to
finish (and unmap stale page tables after that) or read fault will see
already allocated blocks by write(2).
Fixes: 9f141d6ef6258a3a37a045842d9ba7e68f368956
Link: http://lkml.kernel.org/r/20170510085419.27601-5-jack@suse.cz
Signed-off-by: Jan Kara
Signed-off-by: Ross Zwisler
Reviewed-by: Ross Zwisler
Cc: Dan Williams
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 3ef206af544316fc4674f461c4caa287221a8875
Author: Toshi Kani
Date: Thu Apr 27 16:57:05 2017 -0600
libnvdimm: fix clear length of nvdimm\_forget\_poison()
commit 8d13c0290655b883df9083a2a0af0d782bc38aef upstream.
ND\_CMD\_CLEAR\_ERROR command returns 'clear\_err.cleared', the length
of error actually cleared, which may be smaller than its requested
'len'.
Change nvdimm\_clear\_poison() to call nvdimm\_forget\_poison() with
'clear\_err.cleared' when this value is valid.
Fixes: e046114af5fc ("libnvdimm: clear the internal poison\_list when clearing badblocks")
Cc: Dave Jiang
Cc: Vishal Verma
Signed-off-by: Toshi Kani
Signed-off-by: Dan Williams
Signed-off-by: Greg Kroah-Hartman
commit 7868d9ff2ef1dfdf1c256d12d947685fa7a5090e
Author: David Howells
Date: Thu May 4 23:30:16 2017 +0100
Make stat/lstat/fstatat pass AT\_NO\_AUTOMOUNT to vfs\_statx()
commit deccf497d804a4c5fca2dbfad2f104675a6f9102 upstream.
stat/lstat/fstatat need to pass AT\_NO\_AUTOMOUNT to vfs\_statx() as the
pre-statx code didn't set LOOKUP\_AUTOMOUNT, even though fstatat() accepted
the AT\_NO\_AUTOMOUNT flag.
Fixes: a528d35e8bfc ("statx: Add a system call to make enhanced file info available")
Reported-by: Ian Kent
Signed-off-by: David Howells
Tested-by: Ian Kent
Signed-off-by: Al Viro
Signed-off-by: Greg Kroah-Hartman
commit d08975541f4d6a8d25213415fe4d574aec123b16
Author: Johan Hovold
Date: Thu May 11 11:36:01 2017 +0200
USB: chaoskey: fix Alea quirk on big-endian hosts
commit 63afd5cc78775018ea2dec4004428dafa5283e93 upstream.
Add missing endianness conversion when applying the Alea timeout quirk.
Found using sparse:
warning: restricted \_\_le16 degrades to integer
Fixes: e4a886e811cd ("hwrng: chaoskey - Fix URB warning due to timeout on Alea")
Cc: Bob Ham
Cc: Herbert Xu
Cc: Keith Packard
Signed-off-by: Johan Hovold
Signed-off-by: Greg Kroah-Hartman
commit 7ed35d6ca7f7d4289bccf9b7fe43b1cdd9f2ce72
Author: Andrey Korolyov
Date: Tue May 16 23:54:41 2017 +0300
USB: serial: ftdi\_sio: add Olimex ARM-USB-TINY(H) PIDs
commit 5f63424ab7daac840df2b12dd5bcc5b38d50f779 upstream.
This patch adds support for recognition of ARM-USB-TINY(H) devices which
are almost identical to ARM-USB-OCD(H) but lacking separate barrel jack
and serial console.
By suggestion from Johan Hovold it is possible to replace
ftdi\_jtag\_quirk with a bit more generic construction. Since all
Olimex-ARM debuggers has exactly two ports, we could safely always use
only second port within the debugger family.
Signed-off-by: Andrey Korolyov
Signed-off-by: Johan Hovold
Signed-off-by: Greg Kroah-Hartman
commit 14bd189bef6597d2e29d1a18085637e4ae9ec67d
Author: Anthony Mallet
Date: Fri May 5 17:30:16 2017 +0200
USB: serial: ftdi\_sio: fix setting latency for unprivileged users
commit bb246681b3ed0967489a7401ad528c1aaa1a4c2e upstream.
Commit 557aaa7ffab6 ("ft232: support the ASYNC\_LOW\_LATENCY
flag") enables unprivileged users to set the FTDI latency timer,
but there was a logic flaw that skipped sending the corresponding
USB control message to the device.
Specifically, the device latency timer would not be updated until next
open, something which was later also inadvertently broken by commit
c19db4c9e49a ("USB: ftdi\_sio: set device latency timeout at port
probe").
A recent commit c6dce2626606 ("USB: serial: ftdi\_sio: fix extreme
low-latency setting") disabled the low-latency mode by default so we now
need this fix to allow unprivileged users to again enable it.
Signed-off-by: Anthony Mallet
[johan: amend commit message]
Fixes: 557aaa7ffab6 ("ft232: support the ASYNC\_LOW\_LATENCY flag")
Fixes: c19db4c9e49a ("USB: ftdi\_sio: set device latency timeout at port probe").
Signed-off-by: Johan Hovold
Signed-off-by: Greg Kroah-Hartman
commit 15e4ed2a46587a8e3085299ae443c96459ce8856
Author: Kirill Tkhai
Date: Fri May 12 19:11:31 2017 +0300
pid\_ns: Fix race between setns'ed fork() and zap\_pid\_ns\_processes()
commit 3fd37226216620c1a468afa999739d5016fbc349 upstream.
Imagine we have a pid namespace and a task from its parent's pid\_ns,
which made setns() to the pid namespace. The task is doing fork(),
while the pid namespace's child reaper is dying. We have the race
between them:
Task from parent pid\_ns Child reaper
copy\_process() ..
alloc\_pid() ..
.. zap\_pid\_ns\_processes()
.. disable\_pid\_allocation()
.. read\_lock(&tasklist\_lock)
.. iterate over pids in pid\_ns
.. kill tasks linked to pids
.. read\_unlock(&tasklist\_lock)
write\_lock\_irq(&tasklist\_lock); ..
attach\_pid(p, PIDTYPE\_PID); ..
.. ..
So, just created task p won't receive SIGKILL signal,
and the pid namespace will be in contradictory state.
Only manual kill will help there, but does the userspace
care about this? I suppose, the most users just inject
a task into a pid namespace and wait a SIGCHLD from it.
The patch fixes the problem. It simply checks for
(pid\_ns->nr\_hashed & PIDNS\_HASH\_ADDING) in copy\_process().
We do it under the tasklist\_lock, and can't skip
PIDNS\_HASH\_ADDING as noted by Oleg:
"zap\_pid\_ns\_processes() does disable\_pid\_allocation()
and then takes tasklist\_lock to kill the whole namespace.
Given that copy\_process() checks PIDNS\_HASH\_ADDING
under write\_lock(tasklist) they can't race;
if copy\_process() takes this lock first, the new child will
be killed, otherwise copy\_process() can't miss
the change in ->nr\_hashed."
If allocation is disabled, we just return -ENOMEM
like it's made for such cases in alloc\_pid().
v2: Do not move disable\_pid\_allocation(), do not
introduce a new variable in copy\_process() and simplify
the patch as suggested by Oleg Nesterov.
Account the problem with double irq enabling
found by Eric W. Biederman.
Fixes: c876ad768215 ("pidns: Stop pid allocation when init dies")
Signed-off-by: Kirill Tkhai
CC: Andrew Morton
CC: Ingo Molnar
CC: Peter Zijlstra
CC: Oleg Nesterov
CC: Mike Rapoport
CC: Michal Hocko
CC: Andy Lutomirski
CC: "Eric W. Biederman"
CC: Andrei Vagin
CC: Cyrill Gorcunov
CC: Serge Hallyn
Acked-by: Oleg Nesterov
Signed-off-by: Eric W. Biederman
Signed-off-by: Greg Kroah-Hartman
commit 9fbdfb7af4db0a3ca01d19cd2d0a83f6e5443cf1
Author: Eric W. Biederman
Date: Thu May 11 18:21:01 2017 -0500
pid\_ns: Sleep in TASK\_INTERRUPTIBLE in zap\_pid\_ns\_processes
commit b9a985db98961ae1ba0be169f19df1c567e4ffe0 upstream.
The code can potentially sleep for an indefinite amount of time in
zap\_pid\_ns\_processes triggering the hung task timeout, and increasing
the system average. This is undesirable. Sleep with a task state of
TASK\_INTERRUPTIBLE instead of TASK\_UNINTERRUPTIBLE to remove these
undesirable side effects.
Apparently under heavy load this has been allowing Chrome to trigger
the hung time task timeout error and cause ChromeOS to reboot.
Reported-by: Vovo Yang
Reported-by: Guenter Roeck
Tested-by: Guenter Roeck
Fixes: 6347e9009104 ("pidns: guarantee that the pidns init will be the last pidns process reaped")
Signed-off-by: "Eric W. Biederman"
Signed-off-by: Greg Kroah-Hartman
commit 4cbd5018c4d2d2afa24625a93189b58314999352
Author: Michael J. Ruhl
Date: Thu May 4 05:14:34 2017 -0700
IB/hfi1: Fix a subcontext memory leak
commit 224d71f910102c966cdcd782c97e096d5e26e4da upstream.
The only context that frees user\_exp\_rcv data structures is the last
context closed (from a sub-context set). This leaks the allocations
from the other sub-contexts. Separate the common frees from the
specific frees and call them at the appropriate time.
Using KEDR to check for memory leaks we get:
Before test:
[leak\_check] Possible leaks: 25
After test:
[leak\_check] Possible leaks: 31 (6 leaked data structures)
After patch applied (before and after test have the same value)
[leak\_check] Possible leaks: 25
Each leak is 192 + 13440 + 6720 = 20352 bytes per sub-context.
Reviewed-by: Mike Marciniszyn
Signed-off-by: Michael J. Ruhl
Signed-off-by: Dennis Dalessandro
Signed-off-by: Doug Ledford
Signed-off-by: Greg Kroah-Hartman
commit d971ab21c98607b819377785268f90138f12ddd6
Author: Michael J. Ruhl
Date: Thu May 4 05:14:28 2017 -0700
IB/hfi1: Return an error on memory allocation failure
commit 94679061dcdddbafcf24e3bfb526e54dedcc2f2f upstream.
If the eager buffer allocation fails, it is necessary to return
an error code.
Reviewed-by: Mike Marciniszyn
Signed-off-by: Michael J. Ruhl
Signed-off-by: Dennis Dalessandro
Signed-off-by: Doug Ledford
Signed-off-by: Greg Kroah-Hartman
commit c07927502b49f3335f565da8d790eaeb54f1aace
Author: Fabrice Gasnier
Date: Fri Apr 7 13:53:46 2017 +0200
iio: stm32 trigger: fix sampling\_frequency read
commit 77a9febfd81f9e8550d09dc76e8e9c06307b7aca upstream.
When prescaler (PSC) is 0, it means div factor is 1: counter clock
frequency is equal to input clk / (PSC + 1).
When reload value is 8 for example, counter counts 9 cycles, from 0 to 8.
This is handled in frequency write routine, by writing respectively:
- prescaler - 1 to PSC
- reload value - 1 to ARR
This fix does the opposite when reading the frequency from PSC and ARR:
- prescaler is PSC + 1
- reload value is ARR + 1
Thus, PSC may be 0, depending on requested sampling frequency (div 1).
In this case, reading freq wrongly reports 0, instead of computing and
reporting correct value.
Remove test on !psc and !arr.
Small test on stm32f4 (example on tim1\_trgo), before this fix:
$ cd /sys/bus/iio/devices/triggerX
$ echo 10000 > sampling\_frequency
$ cat sampling\_frequency
0
After this fix:
$ echo 10000 > sampling\_frequency
$ cat sampling\_frequency
10000
Signed-off-by: Fabrice Gasnier
Signed-off-by: Jonathan Cameron
Signed-off-by: Greg Kroah-Hartman
commit 705fa4038f549b342854818483a88b7e126e43c5
Author: Andreas Klinger
Date: Mon Apr 10 19:00:01 2017 +0200
IIO: bmp280-core.c: fix error in humidity calculation
commit ed3730c435f1a9f9559ed7762035d22d8a95adfe upstream.
While calculating the compensation of the humidity there are negative values
interpreted as unsigned because of unsigned variables used. These values as
well as the constants need to be casted to signed as indicated by the
documentation of the sensor.
Signed-off-by: Andreas Klinger
Acked-by: Linus Walleij
Reviewed-by: Matt Ranostay
Signed-off-by: Jonathan Cameron
Signed-off-by: Greg Kroah-Hartman
commit 327f5da04e62124e5a79d050f084f1cec7af85e2
Author: Pavel Roskin
Date: Thu Apr 13 14:54:23 2017 -0700
iio: dac: ad7303: fix channel description
commit ce420fd4251809b4c3119b3b20c8b13bd8eba150 upstream.
realbits, storagebits and shift should be numbers, not ASCII characters.
Signed-off-by: Pavel Roskin
Reviewed-by: Lars-Peter Clausen
Signed-off-by: Jonathan Cameron
Signed-off-by: Greg Kroah-Hartman
commit 6567967aad735de020bbcdee28e60c090f24bd95
Author: James Smart
Date: Thu Apr 27 15:08:26 2017 -0700
scsi: lpfc: Fix panic on BFS configuration
commit 4492b739c9ccfaf828bd7c02dc779ec2a5e55ff4 upstream.
To select the appropriate shost template, the driver is issuing a
mailbox command to retrieve the wwn. Turns out the sending of the
command precedes the reset of the function. On SLI-4 adapters, this is
inconsequential as the mailbox command location is specified by dma via
the BMBX register. However, on SLI-3 adapters, the location of the
mailbox command submission area changes. When the function is first
powered on or reset, the cmd is submitted via PCI bar memory. Later the
driver changes the function config to use host memory and DMA. The
request to start a mailbox command is the same, a simple doorbell write,
regardless of submission area. So.. if there has not been a boot driver
run against the adapter, the mailbox command works as defaults are
ok. But, if the boot driver has configured the card and, and if no
platform pci function/slot reset occurs as the os starts, the mailbox
command will fail. The SLI-3 device will use the stale boot driver dma
location. This can cause PCI eeh errors.
Fix is to reset the sli-3 function before sending the mailbox command,
thus synchronizing the function/driver on mailbox location.
Note: The fix uses routines that are typically invoked later in the call
flow to reset the sli-3 device. The issue in using those routines is
that the normal (non-fix) flow does additional initialization, namely
the allocation of the pport structure. So, rather than significantly
reworking the initialization flow so that the pport is alloc'd first,
pointer checks are added to work around it. Checks are limited to the
routines invoked by a sli-3 adapter (s3 routines) as this fix/early call
is only invoked on a sli3 adapter. Nothing changes post the
fix. Subsequent initialization, and another adapter reset, still occur -
both on sli-3 and sli-4 adapters.
Signed-off-by: Dick Kennedy
Signed-off-by: James Smart
Fixes: 96418b5e2c88 ("scsi: lpfc: Fix eh\_deadline setting for sli3 adapters.")
Reviewed-by: Ewan D. Milne
Reviewed-by: Johannes Thumshirn
Signed-off-by: Martin K. Petersen
Signed-off-by: Greg Kroah-Hartman
commit 5d6d5f07f8be73bd752e47169fe2e17096d7ae10
Author: Bryant G. Ly
Date: Fri May 5 14:17:15 2017 -0500
ibmvscsis: Do not send aborted task response
commit 25e78531268e9240fc594ce76587601b873d37c9 upstream.
The driver is sending a response to the actual scsi op that was
aborted by an abort task TM, while LIO is sending a response to
the abort task TM.
ibmvscsis\_tgt does not send the response to the client until
release\_cmd time. The reason for this was because if we did it
at queue\_status time, then the client would be free to reuse the
tag for that command, but we're still using the tag until the
command is released at release\_cmd time, so we chose to delay
sending the response until then. That then caused this issue, because
release\_cmd is always called, even if queue\_status is not.
SCSI spec says that the initiator that sends the abort task
TM NEVER gets a response to the aborted op and with the current
code it will send a response. Thus this fix will remove that response
if the CMD\_T\_ABORTED && !CMD\_T\_TAS.
Another case with a small timing window is the case where if LIO sends a
TMR\_DOES\_NOT\_EXIST, and the release\_cmd callback is called for the TMR Abort
cmd before the release\_cmd for the (attemped) aborted cmd, then we need to
ensure that we send the response for the (attempted) abort cmd to the client
before we send the response for the TMR Abort cmd.
Signed-off-by: Bryant G. Ly
Signed-off-by: Michael Cyr
Signed-off-by: Nicholas Bellinger
Signed-off-by: Greg Kroah-Hartman
commit c3f0eff47d38a9acfeed4e927cf4ab88ddeab766
Author: Johan Hovold
Date: Wed May 17 17:29:09 2017 +0200
of: fdt: add missing allocation-failure check
commit 49e67dd17649b60b4d54966e18ec9c80198227f0 upstream.
The memory allocator passed to \_\_unflatten\_device\_tree() (e.g. a wrapped
kzalloc) can fail so add the missing sanity check to avoid dereferencing
a NULL pointer.
Fixes: fe14042358fa ("of/flattree: Refactor unflatten\_device\_tree and add fdt\_unflatten\_tree")
Signed-off-by: Johan Hovold
Signed-off-by: Rob Herring
Signed-off-by: Greg Kroah-Hartman
commit 5bc2cfba8984b3757a479818ca5ce50b5c613007
Author: Tyrel Datwyler
Date: Mon Apr 17 20:29:17 2017 -0400
of: fix "/cpus" reference leak in of\_numa\_parse\_cpu\_nodes()
commit b8475cbee5ab2eac05f9cd5dbcc94c453d3cbf10 upstream.
The call to of\_find\_node\_by\_path("/cpus") returns the cpus device\_node
with its reference count incremented. There is no matching of\_node\_put()
call in of\_numa\_parse\_cpu\_nodes() which results in a leaked reference
to the "/cpus" node.
This patch adds an of\_node\_put() to release the reference.
fixes: 298535c00a2c ("of, numa: Add NUMA of binding implementation.")
Signed-off-by: Tyrel Datwyler
Acked-by: David Daney
Signed-off-by: Rob Herring
Signed-off-by: Greg Kroah-Hartman
commit 854d0231ef1baa5294a86d62c43d4376b057b33b
Author: Rob Herring
Date: Thu May 4 12:34:30 2017 -0500
of: fix sparse warning in of\_pci\_range\_parser\_one
commit eb3100365791b06242b8bb5c3c2854ba41dabfbc upstream.
sparse gives the following warning for 'pci\_space':
../drivers/of/address.c:266:26: warning: incorrect type in assignment (different base types)
../drivers/of/address.c:266:26: expected unsigned int [unsigned] [usertype] pci\_space
../drivers/of/address.c:266:26: got restricted \_\_be32 const [usertype]
It appears that pci\_space is only ever accessed on powerpc, so the endian
swap is often not needed.
Signed-off-by: Rob Herring
Signed-off-by: Greg Kroah-Hartman
commit d5331e619aa3787ea7d55923a94c82abb409527f
Author: Takashi Iwai
Date: Fri Apr 28 15:00:15 2017 +0200
proc: Fix unbalanced hard link numbers
commit d66bb1607e2d8d384e53f3d93db5c18483c8c4f7 upstream.
proc\_create\_mount\_point() forgot to increase the parent's nlink, and
it resulted in unbalanced hard link numbers, e.g. /proc/fs shows one
less than expected.
Fixes: eb6d38d5427b ("proc: Allow creating permanently empty directories...")
Reported-by: Tristan Ye
Signed-off-by: Takashi Iwai
Signed-off-by: Eric W. Biederman
Signed-off-by: Greg Kroah-Hartman
commit 525d5ef5ae91f4114a819b3e6a27e6e040328e29
Author: Vaibhav Jain
Date: Thu Apr 27 10:58:22 2017 +0530
cxl: Route eeh events to all drivers in cxl\_pci\_error\_detected()
commit 4f58f0bf155e87dda31a3088b1e107fa9dd79f0e upstream.
Fix a boundary condition where in some cases an eeh event that results
in card reset isn't passed on to a driver attached to the virtual PCI
device associated with a slice. This will happen in case when a slice
attached device driver returns a value other than
PCI\_ERS\_RESULT\_NEED\_RESET from the eeh error\_detected() callback. This
would result in an early return from cxl\_pci\_error\_detected() and
other drivers attached to other AFUs on the card wont be notified.
The patch fixes this by making sure that all slice attached
device-drivers are notified and the return values from
error\_detected() callback are aggregated in a scheme where request for
'disconnect' trumps all and 'none' trumps 'need\_reset'.
Fixes: 9e8df8a21963 ("cxl: EEH support")
Signed-off-by: Vaibhav Jain
Reviewed-by: Andrew Donnellan
Acked-by: Frederic Barrat
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit 4a0e8757ad3e47c797a2cd12c71e6c81e6130134
Author: Vaibhav Jain
Date: Thu Apr 27 10:53:25 2017 +0530
cxl: Force context lock during EEH flow
commit ea9a26d117cf0637c71d3e0076f4a124bf5859df upstream.
During an eeh event when the cxl card is fenced and card sysfs attr
perst\_reloads\_same\_image is set following warning message is seen in the
kernel logs:
Adapter context unlocked with 0 active contexts
------------[ cut here ]------------
WARNING: CPU: 12 PID: 627 at
../drivers/misc/cxl/main.c:325 cxl\_adapter\_context\_unlock+0x60/0x80 [cxl]
Even though this warning is harmless, it clutters the kernel log
during an eeh event. This warning is triggered as the EEH callback
cxl\_pci\_error\_detected doesn't obtain a context-lock before forcibly
detaching all active context and when context-lock is released during
call to cxl\_configure\_adapter from cxl\_pci\_slot\_reset, a warning in
cxl\_adapter\_context\_unlock is triggered.
To fix this warning, we acquire the adapter context-lock via
cxl\_adapter\_context\_lock() in the eeh callback
cxl\_pci\_error\_detected() once all the virtual AFU PHBs are notified
and their contexts detached. The context-lock is released in
cxl\_pci\_slot\_reset() after the adapter is successfully reconfigured
and before the we call the slot\_reset callback on slice attached
device-drivers.
Fixes: 70b565bbdb91 ("cxl: Prevent adapter reset if an active context exists")
Reported-by: Andrew Donnellan
Signed-off-by: Vaibhav Jain
Acked-by: Frederic Barrat
Reviewed-by: Matthew R. Ochs
Tested-by: Uma Krishnan
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit 6c58e144d57d16d320d571007eaaccf83f35efce
Author: Gerd Hoffmann
Date: Mon Mar 20 09:11:49 2017 +0100
ohci-pci: add qemu quirk
commit 21a60f6e65181cad64fd66ccc8080d413721ba27 upstream.
On a loaded virtualization host (dozen guests booting at the same time)
it may happen that the ohci controller emulation doesn't manage to do
timely frame processing, with the result that the io watchdog fires and
considers the controller being dead, even though it's only the emulation
being unusual slow due to the load peak.
So, add a quirk for qemu and don't use the watchdog in case we figure we
are running on emulated ohci. The virtual ohci controller masquerades
as apple ohci controller, but we can identify it by subsystem id.
Signed-off-by: Gerd Hoffmann
Signed-off-by: Alan Stern
Signed-off-by: Greg Kroah-Hartman
commit a83f3099d0d2ef692200fd790d547356c0059709
Author: Tobias Herzog
Date: Thu Mar 30 22:15:10 2017 +0200
cdc-acm: fix possible invalid access when processing notification
commit 1bb9914e1730417d530de9ed37e59efdc647146b upstream.
Notifications may only be 8 bytes long. Accessing the 9th and
10th byte of unimplemented/unknown notifications may be insecure.
Also check the length of known notifications before accessing anything
behind the 8th byte.
Signed-off-by: Tobias Herzog
Acked-by: Oliver Neukum
Signed-off-by: Greg Kroah-Hartman
commit 9541621a12a6a9b33c8341046fafd148de88cabd
Author: David Rivshin
Date: Mon Apr 24 18:56:50 2017 -0400
gpio: omap: return error if requested debounce time is not possible
commit 83977443938122baeed28dc9f078db3da9855f7c upstream.
omap\_gpio\_debounce() does not validate that the requested debounce
is within a range it can handle. Instead it lets the register value
wrap silently, and always returns success.
This can lead to all sorts of unexpected behavior, such as gpio\_keys
asking for a too-long debounce, but getting a very short debounce in
practice.
Fix this by returning -EINVAL if the requested value does not fit into
the register field. If there is no debounce clock available at all,
return -ENOTSUPP.
Fixes: e85ec6c3047b ("gpio: omap: fix omap2\_set\_gpio\_debounce")
Signed-off-by: David Rivshin
Acked-by: Grygorii Strashko
Signed-off-by: Linus Walleij
Signed-off-by: Greg Kroah-Hartman
commit 33f379db4711fe71b9a107256fd07ffd040b9735
Author: Ben Skeggs
Date: Thu May 11 17:19:48 2017 +1000
drm/nouveau/tmr: handle races with hw when updating the next alarm time
commit 1b0f84380b10ee97f7d2dd191294de9017e94d1d upstream.
If the time to the next alarm is short enough, we could race with HW and
end up with an ~4 second delay until it triggers.
Fix this by checking again after we update HW.
Signed-off-by: Ben Skeggs
Signed-off-by: Greg Kroah-Hartman
commit 53b8e320383bf7b4311be9ab188515538e712a18
Author: Ben Skeggs
Date: Thu May 11 17:13:29 2017 +1000
drm/nouveau/tmr: avoid processing completed alarms when adding a new one
commit 330bdf62fe6a6c5b99a647f7bf7157107c9348b3 upstream.
The idea here was to avoid having to "manually" program the HW if there's
a new earliest alarm. This was lazy and bad, as it leads to loads of fun
races between inter-related callers (ie. therm).
Turns out, it's not so difficult after all. Go figure ;)
Signed-off-by: Ben Skeggs
Signed-off-by: Greg Kroah-Hartman
commit 952030b868e98659836dac836648ca815c1631ce
Author: Ben Skeggs
Date: Thu May 11 17:03:05 2017 +1000
drm/nouveau/tmr: fix corruption of the pending list when rescheduling an alarm
commit 9fc64667ee48c9a25e7dca1a6bcb6906fec5bcc5 upstream.
At least therm/fantog "attempts" to work around this issue, which could
lead to corruption of the pending alarm list.
Fix it properly by not updating the timestamp without the lock held, or
trying to add an already pending alarm to the pending alarm list....
Signed-off-by: Ben Skeggs
Signed-off-by: Greg Kroah-Hartman
commit 4c168033dd9a0ef770095461a664cbc860c625b7
Author: Ben Skeggs
Date: Thu May 11 16:53:42 2017 +1000
drm/nouveau/tmr: ack interrupt before processing alarms
commit 3733bd8b407211739e72d051e5f30ad82a52c4bc upstream.
Fixes a race where we can miss an alarm that triggers while we're already
processing previous alarms.
Signed-off-by: Ben Skeggs
Signed-off-by: Greg Kroah-Hartman
commit a5e41c9e5a245fd4cd08012831c68e28ec9402cb
Author: Ben Skeggs
Date: Mon May 1 16:53:40 2017 +1000
drm/nouveau/kms/nv50: skip core channel cursor update on position-only changes
commit e6db95799b1b870aae15682a6d0898df9e9dfb38 upstream.
The DRM core used to only call prepare\_fb/cleanup\_fb() when a plane's
framebuffer changed, which achieved the desired effect.
It's apparently now up to the driver to decide on its own.
Signed-off-by: Ben Skeggs
Signed-off-by: Greg Kroah-Hartman
commit 4aecf3a73bf0991366e8efb9c8ab4799c327ade0
Author: Ben Skeggs
Date: Mon May 1 16:52:03 2017 +1000
drm/nouveau/kms/nv50: fix source-rect-only plane updates
commit 36601c2b36e27435d9be33cfa092120ff69914eb upstream.
This "optimisation" (which was originally meant to skip updating cursor
settings in the core channel on position-only updates) turned out to be
pointless in the final design of the code before it was merged.
Remove it completely, as it breaks other cases.
Signed-off-by: Ben Skeggs
Signed-off-by: Greg Kroah-Hartman
commit 2138faf017517acf837816101f778d5c9cda37ef
Author: Ben Skeggs
Date: Thu May 11 17:33:39 2017 +1000
drm/nouveau/therm: remove ineffective workarounds for alarm bugs
commit e4311ee51d1e2676001b2d8fcefd92bdd79aad85 upstream.
These were ineffective due to touching the list without the alarm lock,
but should no longer be required.
Signed-off-by: Ben Skeggs
Signed-off-by: Greg Kroah-Hartman
commit 21d3947bf73b5e2cbb5e8dbbc74f76925ab8be9b
Author: Mario Kleiner
Date: Mon Apr 24 01:02:46 2017 +0200
drm/amdgpu: Add missing lb\_vblank\_lead\_lines setup to DCE-6 path.
commit effaf848b957fbf72a3b6a1ad87f5e031eda0b75 upstream.
This apparently got lost when implementing the new DCE-6 support
and would cause failures in pageflip scheduling and timestamping.
Signed-off-by: Mario Kleiner
Cc: Alex Deucher
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit 3f0db81c7d2f499320a358da0ae052edcc3baad9
Author: Mario Kleiner
Date: Wed Mar 29 22:09:12 2017 +0200
drm/amdgpu: Avoid overflows/divide-by-zero in latency\_watermark calculations.
commit e190ed1ea7458e446230de4113cc5d53b8dc4ec8 upstream.
At dot clocks > approx. 250 Mhz, some of these calcs will overflow and
cause miscalculation of latency watermarks, and for some overflows also
divide-by-zero driver crash ("divide error: 0000 [#1] PREEMPT SMP" in
"dce\_v10\_0\_latency\_watermark+0x12d/0x190").
This zero-divide happened, e.g., on AMD Tonga Pro under DCE-10,
on a Displayport panel when trying to set a video mode of 2560x1440
at 165 Hz vrefresh with a dot clock of 635.540 Mhz.
Refine calculations to avoid the overflows.
Tested for DCE-10 with R9 380 Tonga + ASUS ROG PG279 panel.
Reviewed-by: Alex Deucher
Signed-off-by: Mario Kleiner
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit de2fa45aa9581905632bdd6af7941d100d134af7
Author: Mario Kleiner
Date: Wed Mar 29 22:09:11 2017 +0200
drm/amdgpu: Make display watermark calculations more accurate
commit d63c277dc672e0c568481af043359420fa9d4736 upstream.
Avoid big roundoff errors in scanline/hactive durations for
high pixel clocks, especially for >= 500 Mhz, and thereby
program more accurate display fifo watermarks.
Implemented here for DCE 6,8,10,11.
Successfully tested on DCE 10 with AMD R9 380 Tonga.
Reviewed-by: Alex Deucher
Signed-off-by: Mario Kleiner
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit fab4402325ee8fa32805d4b1601b3ceef6575bed
Author: Johan Hovold
Date: Mon Mar 13 13:44:20 2017 +0100
ath9k\_htc: fix NULL-deref at probe
commit ebeb36670ecac36c179b5fb5d5c88ff03ba191ec upstream.
Make sure to check the number of endpoints to avoid dereferencing a
NULL-pointer or accessing memory beyond the endpoint array should a
malicious device lack the expected endpoints.
Fixes: 36bcce430657 ("ath9k\_htc: Handle storage devices")
Signed-off-by: Johan Hovold
Signed-off-by: Kalle Valo
Signed-off-by: Greg Kroah-Hartman
commit 43068b4585721924f83b93f3ea2986b4b3dfb896
Author: Dmitry Tunin
Date: Wed Mar 8 13:52:07 2017 +0200
ath9k\_htc: Add support of AirTies 1eda:2315 AR9271 device
commit 16ff1fb0e32f76a5d285a6f23b82d21aa52813c6 upstream.
T: Bus=01 Lev=02 Prnt=02 Port=02 Cnt=01 Dev#= 7 Spd=480 MxCh= 0
D: Ver= 2.00 Cls=ff(vend.) Sub=ff Prot=ff MxPS=64 #Cfgs= 1
P: Vendor=1eda ProdID=2315 Rev=01.08
S: Manufacturer=ATHEROS
S: Product=USB2.0 WLAN
S: SerialNumber=12345
C: #Ifs= 1 Cfg#= 1 Atr=80 MxPwr=500mA
I: If#= 0 Alt= 0 #EPs= 6 Cls=ff(vend.) Sub=00 Prot=00 Driver=(none)
Signed-off-by: Dmitry Tunin
Signed-off-by: Kalle Valo
Signed-off-by: Greg Kroah-Hartman
commit 82e31de01826459a8ea0829f3f520c95d3fe2b5e
Author: Martin Schwidefsky
Date: Tue May 2 13:36:00 2017 +0200
s390/cputime: fix incorrect system time
commit 07a63cbe8bcb6ba72fb989dcab1ec55ec6c36c7e upstream.
git commit c5328901aa1db134 "[S390] entry[64].S improvements" removed
the update of the exit\_timer lowcore field from the critical section
cleanup of the .Lsysc\_restore/.Lsysc\_done and .Lio\_restore/.Lio\_done
blocks. If the PSW is updated by the critical section cleanup to point to
user space again, the interrupt entry code will do a vtime calculation
after the cleanup completed with an exit\_timer value which has \*not\* been
updated. Due to this incorrect system time deltas are calculated.
If an interrupt occured with an old PSW between .Lsysc\_restore/.Lsysc\_done
or .Lio\_restore/.Lio\_done update \_\_LC\_EXIT\_TIMER with the system entry
time of the interrupt.
Tested-by: Christian Borntraeger
Signed-off-by: Martin Schwidefsky
Signed-off-by: Greg Kroah-Hartman
commit 5d1adbaf362a5fe1eabde24229076b2c168809b0
Author: Michael Holzheu
Date: Thu Mar 23 21:02:54 2017 +0100
s390/kdump: Add final note
commit dcc00b79fc3d076832f7240de8870f492629b171 upstream.
Since linux v3.14 with commit 38dfac843cb6d7be1 ("vmcore: prevent PT\_NOTE
p\_memsz overflow during header update") on s390 we get the following
message in the kdump kernel:
Warning: Exceeded p\_memsz, dropping PT\_NOTE entry n\_namesz=0x6b6b6b6b,
n\_descsz=0x6b6b6b6b
The reason for this is that we don't create a final zero note in
the ELF header which the proc/vmcore code uses to find out the end
of the notes section (see also kernel/kexec\_core.c:final\_note()).
It still worked on s390 by chance because we (most of the time?) have the
byte pattern 0x6b6b6b6b after the notes section which also makes the notes
parsing code stop in update\_note\_header\_size\_elf64() because 0x6b6b6b6b is
interpreded as note size:
if ((real\_sz + sz) > max\_sz) {
pr\_warn("Warning: Exceeded p\_memsz, dropping P ...);
break;
}
So fix this and add the missing final note to the ELF header.
We don't have to adjust the memory size for ELF header ("alloc\_size")
because the new ELF note still fits into the 0x1000 base memory.
Signed-off-by: Michael Holzheu
Signed-off-by: Martin Schwidefsky
Signed-off-by: Greg Kroah-Hartman
commit d2cc3a8cb9e2a1b84aaa4c1a68273e3d24677e06
Author: Richard Cochran
Date: Mon Apr 17 10:23:36 2017 +0200
regulator: tps65023: Fix inverted core enable logic.
commit c90722b54a4f5e21ac59301ed9a6dbaa439bdb16 upstream.
Commit 43530b69d758328d3ffe6ab98fd640463e8e3667 ("regulator: Use
regmap\_read/write(), regmap\_update\_bits functions directly") intended
to replace working inline helper functions with standard regmap
calls. However, it also inverted the set/clear logic of the "CORE ADJ
Allowed" bit. That patch was clearly never tested, since without that
bit cleared, the core VDCDC1 voltage output does not react to I2C
configuration changes.
This patch fixes the issue by clearing the bit as in the original,
correct implementation. Note for stable back porting that, due to
subsequent driver churn, this patch will not apply on every kernel
version.
Fixes: 43530b69d758 ("regulator: Use regmap\_read/write(), regmap\_update\_bits functions directly")
Signed-off-by: Richard Cochran
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit fde4f79074beee51ee0f73d73a8e7c8502a7c039
Author: Wadim Egorov
Date: Wed Mar 22 16:50:50 2017 +0100
regulator: rk808: Fix RK818 LDO2
commit 75f88115391156b3f0fecbbae76bf870c89bcab8 upstream.
Set the correct voltage select register for LDO2.
Signed-off-by: Wadim Egorov
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit efb209c87ab2033e7575d29294711a53650a99d2
Author: Linus Torvalds
Date: Sun May 21 18:26:54 2017 -0700
x86: fix 32-bit case of \_\_get\_user\_asm\_u64()
commit 33c9e9729033387ef0521324c62e7eba529294af upstream.
The code to fetch a 64-bit value from user space was entirely buggered,
and has been since the code was merged in early 2016 in commit
b2f680380ddf ("x86/mm/32: Add support for 64-bit \_\_get\_user() on 32-bit
kernels").
Happily the buggered routine is almost certainly entirely unused, since
the normal way to access user space memory is just with the non-inlined
"get\_user()", and the inlined version didn't even historically exist.
The normal "get\_user()" case is handled by external hand-written asm in
arch/x86/lib/getuser.S that doesn't have either of these issues.
There were two independent bugs in \_\_get\_user\_asm\_u64():
- it still did the STAC/CLAC user space access marking, even though
that is now done by the wrapper macros, see commit 11f1a4b9755f
("x86: reorganize SMAP handling in user space accesses").
This didn't result in a semantic error, it just means that the
inlined optimized version was hugely less efficient than the
allegedly slower standard version, since the CLAC/STAC overhead is
quite high on modern Intel CPU's.
- the double register %eax/%edx was marked as an output, but the %eax
part of it was touched early in the asm, and could thus clobber other
inputs to the asm that gcc didn't expect it to touch.
In particular, that meant that the generated code could look like
this:
mov (%eax),%eax
mov 0x4(%eax),%edx
where the load of %edx obviously was \_supposed\_ to be from the 32-bit
word that followed the source of %eax, but because %eax was
overwritten by the first instruction, the source of %edx was
basically random garbage.
The fixes are trivial: remove the extraneous STAC/CLAC entries, and mark
the 64-bit output as early-clobber to let gcc know that no inputs should
alias with the output register.
Cc: Al Viro
Cc: Benjamin LaHaise
Cc: Ingo Molnar
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 5bbaf88d7953bd0845f54e834b330d4af30aecf9
Author: Wanpeng Li
Date: Fri May 19 02:46:56 2017 -0700
KVM: X86: Fix read out-of-bounds vulnerability in kvm pio emulation
commit cbfc6c9184ce71b52df4b1d82af5afc81a709178 upstream.
Huawei folks reported a read out-of-bounds vulnerability in kvm pio emulation.
- "inb" instruction to access PIT Mod/Command register (ioport 0x43, write only,
a read should be ignored) in guest can get a random number.
- "rep insb" instruction to access PIT register port 0x43 can control memcpy()
in emulator\_pio\_in\_emulated() to copy max 0x400 bytes but only read 1 bytes,
which will disclose the unimportant kernel memory in host but no crash.
The similar test program below can reproduce the read out-of-bounds vulnerability:
void hexdump(void \*mem, unsigned int len)
{
unsigned int i, j;
for(i = 0; i < len + ((len % HEXDUMP\_COLS) ? (HEXDUMP\_COLS - len % HEXDUMP\_COLS) : 0); i++)
{
/\* print offset \*/
if(i % HEXDUMP\_COLS == 0)
{
printf("0x%06x: ", i);
}
/\* print hex data \*/
if(i < len)
{
printf("%02x ", 0xFF & ((char\*)mem)[i]);
}
else /\* end of block, just aligning for ASCII dump \*/
{
printf(" ");
}
/\* print ASCII dump \*/
if(i % HEXDUMP\_COLS == (HEXDUMP\_COLS - 1))
{
for(j = i - (HEXDUMP\_COLS - 1); j <= i; j++)
{
if(j >= len) /\* end of block, not really printing \*/
{
putchar(' ');
}
else if(isprint(((char\*)mem)[j])) /\* printable char \*/
{
putchar(0xFF & ((char\*)mem)[j]);
}
else /\* other char \*/
{
putchar('.');
}
}
putchar('\n');
}
}
}
int main(void)
{
int i;
if (iopl(3))
{
err(1, "set iopl unsuccessfully\n");
return -1;
}
static char buf[0x40];
/\* test ioport 0x40,0x41,0x42,0x43,0x44,0x45 \*/
memset(buf, 0xab, sizeof(buf));
asm volatile("push %rdi;");
asm volatile("mov %0, %%rdi;"::"q"(buf));
asm volatile ("mov $0x40, %rdx;");
asm volatile ("in %dx,%al;");
asm volatile ("stosb;");
asm volatile ("mov $0x41, %rdx;");
asm volatile ("in %dx,%al;");
asm volatile ("stosb;");
asm volatile ("mov $0x42, %rdx;");
asm volatile ("in %dx,%al;");
asm volatile ("stosb;");
asm volatile ("mov $0x43, %rdx;");
asm volatile ("in %dx,%al;");
asm volatile ("stosb;");
asm volatile ("mov $0x44, %rdx;");
asm volatile ("in %dx,%al;");
asm volatile ("stosb;");
asm volatile ("mov $0x45, %rdx;");
asm volatile ("in %dx,%al;");
asm volatile ("stosb;");
asm volatile ("pop %rdi;");
hexdump(buf, 0x40);
printf("\n");
/\* ins port 0x40 \*/
memset(buf, 0xab, sizeof(buf));
asm volatile("push %rdi;");
asm volatile("mov %0, %%rdi;"::"q"(buf));
asm volatile ("mov $0x20, %rcx;");
asm volatile ("mov $0x40, %rdx;");
asm volatile ("rep insb;");
asm volatile ("pop %rdi;");
hexdump(buf, 0x40);
printf("\n");
/\* ins port 0x43 \*/
memset(buf, 0xab, sizeof(buf));
asm volatile("push %rdi;");
asm volatile("mov %0, %%rdi;"::"q"(buf));
asm volatile ("mov $0x20, %rcx;");
asm volatile ("mov $0x43, %rdx;");
asm volatile ("rep insb;");
asm volatile ("pop %rdi;");
hexdump(buf, 0x40);
printf("\n");
return 0;
}
The vcpu->arch.pio\_data buffer is used by both in/out instrutions emulation
w/o clear after using which results in some random datas are left over in
the buffer. Guest reads port 0x43 will be ignored since it is write only,
however, the function kernel\_pio() can't distigush this ignore from successfully
reads data from device's ioport. There is no new data fill the buffer from
port 0x43, however, emulator\_pio\_in\_emulated() will copy the stale data in
the buffer to the guest unconditionally. This patch fixes it by clearing the
buffer before in instruction emulation to avoid to grant guest the stale data
in the buffer.
In addition, string I/O is not supported for in kernel device. So there is no
iteration to read ioport %RCX times for string I/O. The function kernel\_pio()
just reads one round, and then copy the io size \* %RCX to the guest unconditionally,
actually it copies the one round ioport data w/ other random datas which are left
over in the vcpu->arch.pio\_data buffer to the guest. This patch fixes it by
introducing the string I/O support for in kernel device in order to grant the right
ioport datas to the guest.
Before the patch:
0x000000: fe 38 93 93 ff ff ab ab .8......
0x000008: ab ab ab ab ab ab ab ab ........
0x000010: ab ab ab ab ab ab ab ab ........
0x000018: ab ab ab ab ab ab ab ab ........
0x000020: ab ab ab ab ab ab ab ab ........
0x000028: ab ab ab ab ab ab ab ab ........
0x000030: ab ab ab ab ab ab ab ab ........
0x000038: ab ab ab ab ab ab ab ab ........
0x000000: f6 00 00 00 00 00 00 00 ........
0x000008: 00 00 00 00 00 00 00 00 ........
0x000010: 00 00 00 00 4d 51 30 30 ....MQ00
0x000018: 30 30 20 33 20 20 20 20 00 3
0x000020: ab ab ab ab ab ab ab ab ........
0x000028: ab ab ab ab ab ab ab ab ........
0x000030: ab ab ab ab ab ab ab ab ........
0x000038: ab ab ab ab ab ab ab ab ........
0x000000: f6 00 00 00 00 00 00 00 ........
0x000008: 00 00 00 00 00 00 00 00 ........
0x000010: 00 00 00 00 4d 51 30 30 ....MQ00
0x000018: 30 30 20 33 20 20 20 20 00 3
0x000020: ab ab ab ab ab ab ab ab ........
0x000028: ab ab ab ab ab ab ab ab ........
0x000030: ab ab ab ab ab ab ab ab ........
0x000038: ab ab ab ab ab ab ab ab ........
After the patch:
0x000000: 1e 02 f8 00 ff ff ab ab ........
0x000008: ab ab ab ab ab ab ab ab ........
0x000010: ab ab ab ab ab ab ab ab ........
0x000018: ab ab ab ab ab ab ab ab ........
0x000020: ab ab ab ab ab ab ab ab ........
0x000028: ab ab ab ab ab ab ab ab ........
0x000030: ab ab ab ab ab ab ab ab ........
0x000038: ab ab ab ab ab ab ab ab ........
0x000000: d2 e2 d2 df d2 db d2 d7 ........
0x000008: d2 d3 d2 cf d2 cb d2 c7 ........
0x000010: d2 c4 d2 c0 d2 bc d2 b8 ........
0x000018: d2 b4 d2 b0 d2 ac d2 a8 ........
0x000020: ab ab ab ab ab ab ab ab ........
0x000028: ab ab ab ab ab ab ab ab ........
0x000030: ab ab ab ab ab ab ab ab ........
0x000038: ab ab ab ab ab ab ab ab ........
0x000000: 00 00 00 00 00 00 00 00 ........
0x000008: 00 00 00 00 00 00 00 00 ........
0x000010: 00 00 00 00 00 00 00 00 ........
0x000018: 00 00 00 00 00 00 00 00 ........
0x000020: ab ab ab ab ab ab ab ab ........
0x000028: ab ab ab ab ab ab ab ab ........
0x000030: ab ab ab ab ab ab ab ab ........
0x000038: ab ab ab ab ab ab ab ab ........
Reported-by: Moguofang
Cc: Paolo Bonzini
Cc: Radim Krčmář
Cc: Moguofang
Signed-off-by: Wanpeng Li
Signed-off-by: Radim Krčmář
Signed-off-by: Greg Kroah-Hartman
commit b67dcf8cf82c05e352321d5d60c9b8ef8acee93c
Author: Wanpeng Li
Date: Thu May 11 18:12:05 2017 -0700
KVM: x86: Fix potential preemption when get the current kvmclock timestamp
commit e2c2206a18993bc9f62393d49c7b2066c3845b25 upstream.
BUG: using \_\_this\_cpu\_read() in preemptible [00000000] code: qemu-system-x86/2809
caller is \_\_this\_cpu\_preempt\_check+0x13/0x20
CPU: 2 PID: 2809 Comm: qemu-system-x86 Not tainted 4.11.0+ #13
Call Trace:
dump\_stack+0x99/0xce
check\_preemption\_disabled+0xf5/0x100
\_\_this\_cpu\_preempt\_check+0x13/0x20
get\_kvmclock\_ns+0x6f/0x110 [kvm]
get\_time\_ref\_counter+0x5d/0x80 [kvm]
kvm\_hv\_process\_stimers+0x2a1/0x8a0 [kvm]
? kvm\_hv\_process\_stimers+0x2a1/0x8a0 [kvm]
? kvm\_arch\_vcpu\_ioctl\_run+0xac9/0x1ce0 [kvm]
kvm\_arch\_vcpu\_ioctl\_run+0x5bf/0x1ce0 [kvm]
kvm\_vcpu\_ioctl+0x384/0x7b0 [kvm]
? kvm\_vcpu\_ioctl+0x384/0x7b0 [kvm]
? \_\_fget+0xf3/0x210
do\_vfs\_ioctl+0xa4/0x700
? \_\_fget+0x114/0x210
SyS\_ioctl+0x79/0x90
entry\_SYSCALL\_64\_fastpath+0x23/0xc2
RIP: 0033:0x7f9d164ed357
? \_\_this\_cpu\_preempt\_check+0x13/0x20
This can be reproduced by run kvm-unit-tests/hyperv\_stimer.flat w/
CONFIG\_PREEMPT and CONFIG\_DEBUG\_PREEMPT enabled.
Safe access to per-CPU data requires a couple of constraints, though: the
thread working with the data cannot be preempted and it cannot be migrated
while it manipulates per-CPU variables. If the thread is preempted, the
thread that replaces it could try to work with the same variables; migration
to another CPU could also cause confusion. However there is no preemption
disable when reads host per-CPU tsc rate to calculate the current kvmclock
timestamp.
This patch fixes it by utilizing get\_cpu/put\_cpu pair to guarantee both
\_\_this\_cpu\_read() and rdtsc() are not preempted.
Cc: Paolo Bonzini
Cc: Radim Krčmář
Signed-off-by: Wanpeng Li
Reviewed-by: Paolo Bonzini
Signed-off-by: Radim Krčmář
Signed-off-by: Greg Kroah-Hartman
commit 8223e8f994d2a06418eff5349c9532aa53ca4cb0
Author: Wanpeng Li
Date: Thu May 11 02:58:55 2017 -0700
KVM: x86: Fix load damaged SSEx MXCSR register
commit a575813bfe4bc15aba511a5e91e61d242bff8b9d upstream.
Reported by syzkaller:
BUG: unable to handle kernel paging request at ffffffffc07f6a2e
IP: report\_bug+0x94/0x120
PGD 348e12067
P4D 348e12067
PUD 348e14067
PMD 3cbd84067
PTE 80000003f7e87161
Oops: 0003 [#1] SMP
CPU: 2 PID: 7091 Comm: kvm\_load\_guest\_ Tainted: G OE 4.11.0+ #8
task: ffff92fdfb525400 task.stack: ffffbda6c3d04000
RIP: 0010:report\_bug+0x94/0x120
RSP: 0018:ffffbda6c3d07b20 EFLAGS: 00010202
do\_trap+0x156/0x170
do\_error\_trap+0xa3/0x170
? kvm\_load\_guest\_fpu.part.175+0x12a/0x170 [kvm]
? mark\_held\_locks+0x79/0xa0
? retint\_kernel+0x10/0x10
? trace\_hardirqs\_off\_thunk+0x1a/0x1c
do\_invalid\_op+0x20/0x30
invalid\_op+0x1e/0x30
RIP: 0010:kvm\_load\_guest\_fpu.part.175+0x12a/0x170 [kvm]
? kvm\_load\_guest\_fpu.part.175+0x1c/0x170 [kvm]
kvm\_arch\_vcpu\_ioctl\_run+0xed6/0x1b70 [kvm]
kvm\_vcpu\_ioctl+0x384/0x780 [kvm]
? kvm\_vcpu\_ioctl+0x384/0x780 [kvm]
? sched\_clock+0x13/0x20
? \_\_do\_page\_fault+0x2a0/0x550
do\_vfs\_ioctl+0xa4/0x700
? up\_read+0x1f/0x40
? \_\_do\_page\_fault+0x2a0/0x550
SyS\_ioctl+0x79/0x90
entry\_SYSCALL\_64\_fastpath+0x23/0xc2
SDM mentioned that "The MXCSR has several reserved bits, and attempting to write
a 1 to any of these bits will cause a general-protection exception(#GP) to be
generated". The syzkaller forks' testcase overrides xsave area w/ random values
and steps on the reserved bits of MXCSR register. The damaged MXCSR register
values of guest will be restored to SSEx MXCSR register before vmentry. This
patch fixes it by catching userspace override MXCSR register reserved bits w/
random values and bails out immediately.
Reported-by: Andrey Konovalov
Reviewed-by: Paolo Bonzini
Cc: Paolo Bonzini
Cc: Radim Krčmář
Signed-off-by: Wanpeng Li
Signed-off-by: Radim Krčmář
Signed-off-by: Greg Kroah-Hartman
commit efa8cd1e2f0ba01ae9477ccf4abe9fd9f7f1d0a7
Author: Daniel Glöckner
Date: Fri Feb 24 15:05:14 2017 +0100
ima: accept previously set IMA\_NEW\_FILE
commit 1ac202e978e18f045006d75bd549612620c6ec3a upstream.
Modifying the attributes of a file makes ima\_inode\_post\_setattr reset
the IMA cache flags. So if the file, which has just been created,
is opened a second time before the first file descriptor is closed,
verification fails since the security.ima xattr has not been written
yet. We therefore have to look at the IMA\_NEW\_FILE even if the file
already existed.
With this patch there should no longer be an error when cat tries to
open testfile:
$ rm -f testfile
$ ( echo test >&3 ; touch testfile ; cat testfile ) 3>testfile
A file being new is no reason to accept that it is missing a digital
signature demanded by the policy.
Signed-off-by: Daniel Glöckner
Signed-off-by: Mimi Zohar
Signed-off-by: Greg Kroah-Hartman
commit d5811285b5a8d43bbf677931667f2c505b96fa1b
Author: Brian Norris
Date: Fri Apr 14 14:51:17 2017 -0700
mwifiex: pcie: fix cmd\_buf use-after-free in remove/reset
commit 3c8cb9ad032d737b874e402c59eb51e3c991a144 upstream.
Command buffers (skb's) are allocated by the main driver, and freed upon
the last use. That last use is often in mwifiex\_free\_cmd\_buffer(). In
the meantime, if the command buffer gets used by the PCI driver, we map
it as DMA-able, and store the mapping information in the 'cb' memory.
However, if a command was in-flight when resetting the device (and
therefore was still mapped), we don't get a chance to unmap this memory
until after the core has cleaned up its command handling.
Let's keep a refcount within the PCI driver, so we ensure the memory
only gets freed after we've finished unmapping it.
Noticed by KASAN when forcing a reset via:
echo 1 > /sys/bus/pci/.../reset
The same code path can presumably be exercised in remove() and
shutdown().
[ 205.390377] mwifiex\_pcie 0000:01:00.0: info: shutdown mwifiex...
[ 205.400393] ==================================================================
[ 205.407719] BUG: KASAN: use-after-free in mwifiex\_unmap\_pci\_memory.isra.14+0x4c/0x100 [mwifiex\_pcie] at addr ffffffc0ad471b28
[ 205.419040] Read of size 16 by task bash/1913
[ 205.423421] =============================================================================
[ 205.431625] BUG skbuff\_head\_cache (Tainted: G B ): kasan: bad access detected
[ 205.439815] -----------------------------------------------------------------------------
[ 205.439815]
[ 205.449534] INFO: Allocated in \_\_build\_skb+0x48/0x114 age=1311 cpu=4 pid=1913
[ 205.456709] alloc\_debug\_processing+0x124/0x178
[ 205.461282] \_\_\_slab\_alloc.constprop.58+0x528/0x608
[ 205.466196] \_\_slab\_alloc.isra.54.constprop.57+0x44/0x54
[ 205.471542] kmem\_cache\_alloc+0xcc/0x278
[ 205.475497] \_\_build\_skb+0x48/0x114
[ 205.479019] \_\_netdev\_alloc\_skb+0xe0/0x170
[ 205.483244] mwifiex\_alloc\_cmd\_buffer+0x68/0xdc [mwifiex]
[ 205.488759] mwifiex\_init\_fw+0x40/0x6cc [mwifiex]
[ 205.493584] \_mwifiex\_fw\_dpc+0x158/0x520 [mwifiex]
[ 205.498491] mwifiex\_reinit\_sw+0x2c4/0x398 [mwifiex]
[ 205.503510] mwifiex\_pcie\_reset\_notify+0x114/0x15c [mwifiex\_pcie]
[ 205.509643] pci\_reset\_notify+0x5c/0x6c
[ 205.513519] pci\_reset\_function+0x6c/0x7c
[ 205.517567] reset\_store+0x68/0x98
[ 205.521003] dev\_attr\_store+0x54/0x60
[ 205.524705] sysfs\_kf\_write+0x9c/0xb0
[ 205.528413] INFO: Freed in \_\_kfree\_skb+0xb0/0xbc age=131 cpu=4 pid=1913
[ 205.535064] free\_debug\_processing+0x264/0x370
[ 205.539550] \_\_slab\_free+0x84/0x40c
[ 205.543075] kmem\_cache\_free+0x1c8/0x2a0
[ 205.547030] \_\_kfree\_skb+0xb0/0xbc
[ 205.550465] consume\_skb+0x164/0x178
[ 205.554079] \_\_dev\_kfree\_skb\_any+0x58/0x64
[ 205.558304] mwifiex\_free\_cmd\_buffer+0xa0/0x158 [mwifiex]
[ 205.563817] mwifiex\_shutdown\_drv+0x578/0x5c4 [mwifiex]
[ 205.569164] mwifiex\_shutdown\_sw+0x178/0x310 [mwifiex]
[ 205.574353] mwifiex\_pcie\_reset\_notify+0xd4/0x15c [mwifiex\_pcie]
[ 205.580398] pci\_reset\_notify+0x5c/0x6c
[ 205.584274] pci\_dev\_save\_and\_disable+0x24/0x6c
[ 205.588837] pci\_reset\_function+0x30/0x7c
[ 205.592885] reset\_store+0x68/0x98
[ 205.596324] dev\_attr\_store+0x54/0x60
[ 205.600017] sysfs\_kf\_write+0x9c/0xb0
...
[ 205.800488] Call trace:
[ 205.802980] [] dump\_backtrace+0x0/0x190
[ 205.808415] [] show\_stack+0x20/0x28
[ 205.813506] [] dump\_stack+0xa4/0xcc
[ 205.818598] [] print\_trailer+0x158/0x168
[ 205.824120] [] object\_err+0x4c/0x5c
[ 205.829210] [] kasan\_report+0x334/0x500
[ 205.834641] [] check\_memory\_region+0x20/0x14c
[ 205.840593] [] \_\_asan\_loadN+0x14/0x1c
[ 205.845879] [] mwifiex\_unmap\_pci\_memory.isra.14+0x4c/0x100 [mwifiex\_pcie]
[ 205.854282] [] mwifiex\_pcie\_delete\_cmdrsp\_buf+0x94/0xa8 [mwifiex\_pcie]
[ 205.862421] [] mwifiex\_pcie\_free\_buffers+0x11c/0x158 [mwifiex\_pcie]
[ 205.870302] [] mwifiex\_pcie\_down\_dev+0x70/0x80 [mwifiex\_pcie]
[ 205.877736] [] mwifiex\_shutdown\_sw+0x190/0x310 [mwifiex]
[ 205.884658] [] mwifiex\_pcie\_reset\_notify+0xd4/0x15c [mwifiex\_pcie]
[ 205.892446] [] pci\_reset\_notify+0x5c/0x6c
[ 205.898048] [] pci\_dev\_save\_and\_disable+0x24/0x6c
[ 205.904350] [] pci\_reset\_function+0x30/0x7c
[ 205.910134] [] reset\_store+0x68/0x98
[ 205.915312] [] dev\_attr\_store+0x54/0x60
[ 205.920750] [] sysfs\_kf\_write+0x9c/0xb0
[ 205.926182] [] kernfs\_fop\_write+0x184/0x1f8
[ 205.931963] [] \_\_vfs\_write+0x6c/0x17c
[ 205.937221] [] vfs\_write+0xf0/0x1c4
[ 205.942310] [] SyS\_write+0x78/0xd8
[ 205.947312] [] el0\_svc\_naked+0x24/0x28
...
[ 205.998268] ==================================================================
This bug has been around in different forms for a while. It was sort of
noticed in commit 955ab095c51a ("mwifiex: Do not kfree cmd buf while
unregistering PCIe"), but it just fixed the double-free, without
acknowledging the potential for use-after-free.
Fixes: fc3314609047 ("mwifiex: use pci\_alloc/free\_consistent APIs for PCIe")
Signed-off-by: Brian Norris
Signed-off-by: Kalle Valo
Signed-off-by: Greg Kroah-Hartman
commit a32a0c8285a44a9d3ec94ee40a943c6506ac657e
Author: Brian Norris
Date: Wed Apr 5 15:26:40 2017 -0700
mwifiex: MAC randomization should not be persistent
commit 7e2f18f06408ff56d7f75e68de8064777137b319 upstream.
nl80211 provides the NL80211\_SCAN\_FLAG\_RANDOM\_ADDR for every scan
request that should be randomized; the absence of such a flag means we
should not randomize. However, mwifiex was stashing the latest
randomization request and \*always\* using it for future scans, even those
that didn't set the flag.
Let's zero out the randomization info whenever we get a scan request
without NL80211\_SCAN\_FLAG\_RANDOM\_ADDR. I'd prefer to remove
priv->random\_mac entirely (and plumb the randomization MAC properly
through the call sequence), but the spaghetti is a little difficult to
unravel here for me.
Fixes: c2a8f0ff9c6c ("mwifiex: support random MAC address for scanning")
Signed-off-by: Brian Norris
Signed-off-by: Kalle Valo
Signed-off-by: Greg Kroah-Hartman
commit cf6df2bcd4521b728044356dea246967dc1cf0a3
Author: Larry Finger
Date: Sun Apr 16 19:32:07 2017 -0500
rtlwifi: rtl8821ae: setup 8812ae RFE according to device type
commit 46cfa2148e7371c537efff1a1c693e58f523089d upstream.
Current channel switch implementation sets 8812ae RFE reg value assuming
that device always has type 2.
Extend possible RFE types set and write corresponding reg values.
Source for new code is
http://dlcdnet.asus.com/pub/ASUS/wireless/PCE-AC51/DR\_PCE\_AC51\_20232801152016.zip
Signed-off-by: Maxim Samoylov
Signed-off-by: Larry Finger
Cc: Yan-Hsuan Chuang
Cc: Pkshih
Cc: Birming Chiu
Cc: Shaofu
Cc: Steven Ting
Signed-off-by: Kalle Valo
Signed-off-by: Greg Kroah-Hartman
commit 699ae096347fb79420e12f0f82b14fa3a68e42f3
Author: NeilBrown
Date: Thu Apr 6 11:16:33 2017 +0800
md: MD\_CLOSING needs to be cleared after called md\_set\_readonly or do\_md\_stop
commit 065e519e71b2c1f41936cce75b46b5ab34adb588 upstream.
if called md\_set\_readonly and set MD\_CLOSING bit, the mddev cannot
be opened any more due to the MD\_CLOING bit wasn't cleared. Thus it
needs to be cleared in md\_ioctl after any call to md\_set\_readonly()
or do\_md\_stop().
Signed-off-by: NeilBrown
Fixes: af8d8e6f0315 ("md: changes for MD\_STILL\_CLOSED flag")
Signed-off-by: Zhilong Liu
Signed-off-by: Shaohua Li
Signed-off-by: Greg Kroah-Hartman
commit 1800fde3093e035ab37a68597b850c23437ae964
Author: Dennis Yang
Date: Wed Mar 29 15:46:13 2017 +0800
md: update slab\_cache before releasing new stripes when stripes resizing
commit 583da48e388f472e8818d9bb60ef6a1d40ee9f9d upstream.
When growing raid5 device on machine with small memory, there is chance that
mdadm will be killed and the following bug report can be observed. The same
bug could also be reproduced in linux-4.10.6.
[57600.075774] BUG: unable to handle kernel NULL pointer dereference at (null)
[57600.083796] IP: [] \_raw\_spin\_lock+0x7/0x20
[57600.110378] PGD 421cf067 PUD 4442d067 PMD 0
[57600.114678] Oops: 0002 [#1] SMP
[57600.180799] CPU: 1 PID: 25990 Comm: mdadm Tainted: P O 4.2.8 #1
[57600.187849] Hardware name: To be filled by O.E.M. To be filled by O.E.M./MAHOBAY, BIOS QV05AR66 03/06/2013
[57600.197490] task: ffff880044e47240 ti: ffff880043070000 task.ti: ffff880043070000
[57600.204963] RIP: 0010:[] [] \_raw\_spin\_lock+0x7/0x20
[57600.213057] RSP: 0018:ffff880043073810 EFLAGS: 00010046
[57600.218359] RAX: 0000000000000000 RBX: 000000000000000c RCX: ffff88011e296dd0
[57600.225486] RDX: 0000000000000001 RSI: ffffe8ffffcb46c0 RDI: 0000000000000000
[57600.232613] RBP: ffff880043073878 R08: ffff88011e5f8170 R09: 0000000000000282
[57600.239739] R10: 0000000000000005 R11: 28f5c28f5c28f5c3 R12: ffff880043073838
[57600.246872] R13: ffffe8ffffcb46c0 R14: 0000000000000000 R15: ffff8800b9706a00
[57600.253999] FS: 00007f576106c700(0000) GS:ffff88011e280000(0000) knlGS:0000000000000000
[57600.262078] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[57600.267817] CR2: 0000000000000000 CR3: 00000000428fe000 CR4: 00000000001406e0
[57600.274942] Stack:
[57600.276949] ffffffff8114ee35 ffff880043073868 0000000000000282 000000000000eb3f
[57600.284383] ffffffff81119043 ffff880043073838 ffff880043073838 ffff88003e197b98
[57600.291820] ffffe8ffffcb46c0 ffff88003e197360 0000000000000286 ffff880043073968
[57600.299254] Call Trace:
[57600.301698] [] ? cache\_flusharray+0x35/0xe0
[57600.307523] [] ? \_\_page\_cache\_release+0x23/0x110
[57600.313779] [] kmem\_cache\_free+0x63/0xc0
[57600.319344] [] drop\_one\_stripe+0x62/0x90
[57600.324915] [] raid5\_cache\_scan+0x8b/0xb0
[57600.330563] [] shrink\_slab.part.36+0x19a/0x250
[57600.336650] [] shrink\_zone+0x23c/0x250
[57600.342039] [] do\_try\_to\_free\_pages+0x153/0x420
[57600.348210] [] try\_to\_free\_pages+0x91/0xa0
[57600.353959] [] \_\_alloc\_pages\_nodemask+0x4d1/0x8b0
[57600.360303] [] check\_reshape+0x62b/0x770
[57600.365866] [] raid5\_check\_reshape+0x55/0xa0
[57600.371778] [] update\_raid\_disks+0xc7/0x110
[57600.377604] [] md\_ioctl+0xd83/0x1b10
[57600.382827] [] blkdev\_ioctl+0x170/0x690
[57600.388307] [] block\_ioctl+0x38/0x40
[57600.393525] [] do\_vfs\_ioctl+0x2b5/0x480
[57600.399010] [] ? vfs\_write+0x14b/0x1f0
[57600.404400] [] SyS\_ioctl+0x3c/0x70
[57600.409447] [] entry\_SYSCALL\_64\_fastpath+0x12/0x6a
[57600.415875] Code: 00 00 00 00 55 48 89 e5 8b 07 85 c0 74 04 31 c0 5d c3 ba 01 00 00 00 f0 0f b1 17 85 c0 75 ef b0 01 5d c3 90 31 c0 ba 01 00 00 00  0f b1 17 85 c0 75 01 c3 55 89 c6 48 89 e5 e8 85 d1 63 ff 5d
[57600.435460] RIP [] \_raw\_spin\_lock+0x7/0x20
[57600.441208] RSP
[57600.444690] CR2: 0000000000000000
[57600.448000] ---[ end trace cbc6b5cc4bf9831d ]---
The problem is that resize\_stripes() releases new stripe\_heads before assigning new
slab cache to conf->slab\_cache. If the shrinker function raid5\_cache\_scan() gets called
after resize\_stripes() starting releasing new stripes but right before new slab cache
being assigned, it is possible that these new stripe\_heads will be freed with the old
slab\_cache which was already been destoryed and that triggers this bug.
Signed-off-by: Dennis Yang
Fixes: edbe83ab4c27 ("md/raid5: allow the stripe\_cache to grow and shrink.")
Reviewed-by: NeilBrown
Signed-off-by: Shaohua Li
Signed-off-by: Greg Kroah-Hartman
commit d7252903e28c7ff86dd752f48641c594b6fbb149
Author: Joe Thornber
Date: Mon May 15 09:45:40 2017 -0400
dm space map disk: fix some book keeping in the disk space map
commit 0377a07c7a035e0d033cd8b29f0cb15244c0916a upstream.
When decrementing the reference count for a block, the free count wasn't
being updated if the reference count went to zero.
Signed-off-by: Joe Thornber
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit f568a10289c8596b60ed40d423e12b1121f5739a
Author: Joe Thornber
Date: Mon May 15 09:43:05 2017 -0400
dm thin metadata: call precommit before saving the roots
commit 91bcdb92d39711d1adb40c26b653b7978d93eb98 upstream.
These calls were the wrong way round in \_\_write\_initial\_superblock.
Signed-off-by: Joe Thornber
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit 17cedf3ba1e34cac1ca6b6dd8c7fb40c015729e4
Author: Mikulas Patocka
Date: Sun Apr 30 17:32:28 2017 -0400
dm bufio: make the parameter "retain\_bytes" unsigned long
commit 13840d38016203f0095cd547b90352812d24b787 upstream.
Change the type of the parameter "retain\_bytes" from unsigned to
unsigned long, so that on 64-bit machines the user can set more than
4GiB of data to be retained.
Also, change the type of the variable "count" in the function
"\_\_evict\_old\_buffers" to unsigned long. The assignment
"count = c->n\_buffers[LIST\_CLEAN] + c->n\_buffers[LIST\_DIRTY];"
could result in unsigned long to unsigned overflow and that could result
in buffers not being freed when they should.
While at it, avoid division in get\_retain\_buffers(). Division is slow,
we can change it to shift because we have precalculated the log2 of
block size.
Signed-off-by: Mikulas Patocka
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit 2e80638cee4fb7d423e3c9285f0353d9a9d51a20
Author: Mike Snitzer
Date: Fri May 5 14:40:13 2017 -0400
dm cache metadata: fail operations if fail\_io mode has been established
commit 10add84e276432d9dd8044679a1028dd4084117e upstream.
Otherwise it is possible to trigger crashes due to the metadata being
inaccessible yet these methods don't safely account for that possibility
without these checks.
Reported-by: Mikulas Patocka
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit a5b9afd690029f7d730b3b79ddba2c4858005f12
Author: Bart Van Assche
Date: Thu Apr 27 10:11:16 2017 -0700
dm mpath: delay requeuing while path initialization is in progress
commit c1d7ecf7ca11d0edd3085262c8597203440d056c upstream.
Requeuing a request immediately while path initialization is ongoing
causes high CPU usage, something that is undesired. Hence delay
requeuing while path initialization is in progress.
Signed-off-by: Bart Van Assche
Reviewed-by: Hannes Reinecke
Cc: Christoph Hellwig
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit 5087ded2bbd48bf84a5840624bfc901f4bd75613
Author: Bart Van Assche
Date: Thu Apr 27 10:11:15 2017 -0700
dm mpath: avoid that path removal can trigger an infinite loop
commit 7083abbbfc4fa706ff72d27d33a5214881979336 upstream.
If blk\_get\_request() fails, check whether the failure is due to a path
being removed. If that is the case, fail the path by triggering a call
to fail\_path(). This avoids that the following scenario can be
encountered while removing paths:
\* CPU usage of a kworker thread jumps to 100%.
\* Removing the DM device becomes impossible.
Delay requeueing if blk\_get\_request() returns -EBUSY or -EWOULDBLOCK,
and the queue is not dying, because in these cases immediate requeuing
is inappropriate.
Signed-off-by: Bart Van Assche
Cc: Hannes Reinecke
Cc: Christoph Hellwig
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit 5a09414335f06d28002d43c7e0a3e29ea9ebd54c
Author: Bart Van Assche
Date: Thu Apr 27 10:11:14 2017 -0700
dm mpath: split and rename activate\_path() to prepare for its expanded use
commit 89bfce763e43fa4897e0d3af6b29ed909df64cfd upstream.
activate\_path() is renamed to activate\_path\_work() which now calls
activate\_or\_offline\_path(). activate\_or\_offline\_path() will be used
by the next commit.
Signed-off-by: Bart Van Assche
Cc: Hannes Reinecke
Cc: Christoph Hellwig
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit 4ff00db718af4b4571f236668488bffcd67c5418
Author: Bart Van Assche
Date: Fri Apr 7 16:50:44 2017 -0700
dm mpath: requeue after a small delay if blk\_get\_request() fails
commit 06eb061f48594aa369f6e852b352410298b317a8 upstream.
If blk\_get\_request() returns ENODEV then multipath\_clone\_and\_map()
causes a request to be requeued immediately. This can cause a kworker
thread to spend 100% of the CPU time of a single core in
\_\_blk\_mq\_run\_hw\_queue() and also can cause device removal to never
finish.
Avoid this by only requeuing after a delay if blk\_get\_request() fails.
Additionally, reduce the requeue delay.
Signed-off-by: Bart Van Assche
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit 7d67cd026df1d5a5c6b260af3f6bc23924464426
Author: Mikulas Patocka
Date: Sun Apr 30 17:34:53 2017 -0400
dm bufio: check new buffer allocation watermark every 30 seconds
commit 390020ad2af9ca04844c4f3b1f299ad8746d84c8 upstream.
dm-bufio checks a watermark when it allocates a new buffer in
\_\_bufio\_new(). However, it doesn't check the watermark when the user
changes /sys/module/dm\_bufio/parameters/max\_cache\_size\_bytes.
This may result in a problem - if the watermark is high enough so that
all possible buffers are allocated and if the user lowers the value of
"max\_cache\_size\_bytes", the watermark will never be checked against the
new value because no new buffer would be allocated.
To fix this, change \_\_evict\_old\_buffers() so that it checks the
watermark. \_\_evict\_old\_buffers() is called every 30 seconds, so if the
user reduces "max\_cache\_size\_bytes", dm-bufio will react to this change
within 30 seconds and decrease memory consumption.
Depends-on: 1b0fb5a5b2 ("dm bufio: avoid a possible ABBA deadlock")
Signed-off-by: Mikulas Patocka
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit 2aac21e0014d00a2d821581cc65f0e8354c7abec
Author: Mikulas Patocka
Date: Sun Apr 30 17:33:26 2017 -0400
dm bufio: avoid a possible ABBA deadlock
commit 1b0fb5a5b2dc0dddcfa575060441a7176ba7ac37 upstream.
\_\_get\_memory\_limit() tests if dm\_bufio\_cache\_size changed and calls
\_\_cache\_size\_refresh() if it did. It takes dm\_bufio\_clients\_lock while
it already holds the client lock. However, lock ordering is violated
because in cleanup\_old\_buffers() dm\_bufio\_clients\_lock is taken before
the client lock.
This results in a possible deadlock and lockdep engine warning.
Fix this deadlock by changing mutex\_lock() to mutex\_trylock(). If the
lock can't be taken, it will be re-checked next time when a new buffer
is allocated.
Also add "unlikely" to the if condition, so that the optimizer assumes
that the condition is false.
Signed-off-by: Mikulas Patocka
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit 539ee786497fc7529a895954ccac220f8f10b42d
Author: Mikulas Patocka
Date: Tue Mar 28 12:53:39 2017 -0400
dm raid: select the Kconfig option CONFIG\_MD\_RAID0
commit 7b81ef8b14f80033e4a4168d199a0f5fd79b9426 upstream.
Since the commit 0cf4503174c1 ("dm raid: add support for the MD RAID0
personality"), the dm-raid subsystem can activate a RAID-0 array.
Therefore, add MD\_RAID0 to the dependencies of DM\_RAID, so that MD\_RAID0
will be selected when DM\_RAID is selected.
Fixes: 0cf4503174c1 ("dm raid: add support for the MD RAID0 personality")
Signed-off-by: Mikulas Patocka
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit 11dfdb1a46b4fe98559ff8799256eef1ffebd09e
Author: Vinothkumar Raja
Date: Thu Apr 6 22:09:38 2017 -0400
dm btree: fix for dm\_btree\_find\_lowest\_key()
commit 7d1fedb6e96a960aa91e4ff70714c3fb09195a5a upstream.
dm\_btree\_find\_lowest\_key() is giving incorrect results. find\_key()
traverses the btree correctly for finding the highest key, but there is
an error in the way it traverses the btree for retrieving the lowest
key. dm\_btree\_find\_lowest\_key() fetches the first key of the rightmost
block of the btree instead of fetching the first key from the leftmost
block.
Fix this by conditionally passing the correct parameter to value64()
based on the @find\_highest flag.
Signed-off-by: Erez Zadok
Signed-off-by: Vinothkumar Raja
Signed-off-by: Nidhi Panpalia
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit cd21f4af214fca46b8346bca8adcef5224b2a126
Author: Paolo Abeni
Date: Fri Apr 28 11:20:01 2017 +0200
infiniband: call ipv6 route lookup via the stub interface
commit eea40b8f624f25cbc02d55f2d93203f60cee9341 upstream.
The infiniband address handle can be triggered to resolve an ipv6
address in response to MAD packets, regardless of the ipv6
module being disabled via the kernel command line argument.
That will cause a call into the ipv6 routing code, which is not
initialized, and a conseguent oops.
This commit addresses the above issue replacing the direct lookup
call with an indirect one via the ipv6 stub, which is properly
initialized according to the ipv6 status (e.g. if ipv6 is
disabled, the routing lookup fails gracefully)
Signed-off-by: Paolo Abeni
Signed-off-by: Doug Ledford
Signed-off-by: Greg Kroah-Hartman
commit 3992c93b742c67dc11bcc47753a9f13fc3f4e6df
Author: Sagi Grimberg
Date: Sun Apr 23 14:31:42 2017 +0300
mlx5: Fix mlx5\_ib\_map\_mr\_sg mr length
commit 0a49f2c31c3efbeb0de3e4b5598764887f629be2 upstream.
In case we got an initial sg\_offset, we need to
account for it in the mr length.
Fixes: ff2ba9936591 ("IB/core: Add passing an offset into the SG to ib\_map\_mr\_sg")
Signed-off-by: Sagi Grimberg
Tested-by: Israel Rukshin
Signed-off-by: Doug Ledford
Signed-off-by: Greg Kroah-Hartman
commit cca9c04ad435bca5637d4b19c5378792d079e9bd
Author: Alexander Sverdlin
Date: Sat Apr 29 12:19:33 2017 +0200
ASoC: cs4271: configure reset GPIO as output
commit 49b2e27ab9f66b0a22c21980ad8118a4038324ae upstream.
During reset "refactoring" the output configuration was lost.
This commit repairs sound on EDB93XX boards.
Fixes: 9a397f4 ("ASoC: cs4271: add regulator consumer support")
Signed-off-by: Alexander Sverdlin
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit a7caccf886ea8db59eccbda342ad65ec2f6b4ea1
Author: Petr Vandrovec
Date: Wed Mar 29 00:43:30 2017 -0700
tpm: fix handling of the TPM 2.0 event logs
commit fd5c78694f3f1c875e293de7a641ba8a3d60d00d upstream.
When TPM2 log has entries with more than 3 digests, or with digests
not listed in the log header, log gets misparsed, eventually
leading to kernel complaint that code tried to vmalloc 512MB of
memory (I have no idea what would happen on bigger system).
So code should not parse only first 3 digests: both event header
and event itself are already in memory, so we can parse any number
of digests, as long as we do not try to parse whole memory when
given count of 0xFFFFFFFF.
So this change:
\* Rejects event entry with more digests than log header describes.
Digest types should be unique, and all should be described in
log header, so there cannot be more digests in the event than in
the header.
\* Reject event entry with digest that is not described in the
log header. In theory code could hardcode information about
digest IDs already assigned by TCG, but if firmware authors
cannot get event log format right, why should anyone believe
that they got event log content right.
Fixes: 4d23cc323cdb ("tpm: add securityfs support for TPM 2.0 firmware event log")
Signed-off-by: Petr Vandrovec
Reviewed-by: Jarkko Sakkinen
Signed-off-by: Jarkko Sakkinen
Signed-off-by: Greg Kroah-Hartman
commit 455edd3ceb773ee8d2c1f7f396eb190d934ab648
Author: Hon Ching \(Vicky) Lo
Date: Wed Mar 15 01:28:07 2017 -0400
vTPM: Fix missing NULL check
commit 31574d321c70f6d3b40fe98f9b2eafd9a903fef9 upstream.
The current code passes the address of tpm\_chip as the argument to
dev\_get\_drvdata() without prior NULL check in
tpm\_ibmvtpm\_get\_desired\_dma. This resulted an oops during kernel
boot when vTPM is enabled in Power partition configured in active
memory sharing mode.
The vio\_driver's get\_desired\_dma() is called before the probe(), which
for vtpm is tpm\_ibmvtpm\_probe, and it's this latter function that
initializes the driver and set data. Attempting to get data before
the probe() caused the problem.
This patch adds a NULL check to the tpm\_ibmvtpm\_get\_desired\_dma.
fixes: 9e0d39d8a6a0 ("tpm: Remove useless priv field in struct tpm\_vendor\_specific")
Signed-off-by: Hon Ching(Vicky) Lo
Reviewed-by: Jarkko Sakkine
Signed-off-by: Jarkko Sakkinen
Signed-off-by: Greg Kroah-Hartman
commit b06ad9f0bf81139d2b29493792a10ecf7ed19ad9
Author: Jerry Snitselaar
Date: Fri Mar 10 17:46:04 2017 -0700
tpm\_crb: check for bad response size
commit 8569defde8057258835c51ce01a33de82e14b148 upstream.
Make sure size of response buffer is at least 6 bytes, or
we will underflow and pass large size\_t to memcpy\_fromio().
This was encountered while testing earlier version of
locality patchset.
Fixes: 30fc8d138e912 ("tpm: TPM 2.0 CRB Interface")
Signed-off-by: Jerry Snitselaar
Reviewed-by: Jarkko Sakkinen
Signed-off-by: Jarkko Sakkinen
Signed-off-by: Greg Kroah-Hartman
commit 7cb54bfbd52c35ce1fc1480099e90ffc28d2d94d
Author: Nayna Jain
Date: Fri Mar 10 13:45:54 2017 -0500
tpm: add sleep only for retry in i2c\_nuvoton\_write\_status()
commit 0afb7118ae021e80ecf70f5a3336e0935505518a upstream.
Currently, there is an unnecessary 1 msec delay added in
i2c\_nuvoton\_write\_status() for the successful case. This
function is called multiple times during send() and recv(),
which implies adding multiple extra delays for every TPM
operation.
This patch calls usleep\_range() only if retry is to be done.
Signed-off-by: Nayna Jain
Reviewed-by: Mimi Zohar
Reviewed-by: Jarkko Sakkinen
Signed-off-by: Jarkko Sakkinen
Signed-off-by: Greg Kroah-Hartman
commit 6705f253bc2b6c51a1642f75a789ccb153a25cdb
Author: Nayna Jain
Date: Fri Mar 10 13:45:53 2017 -0500
tpm: msleep() delays - replace with usleep\_range() in i2c nuvoton driver
commit a233a0289cf9a96ef9b42c730a7621ccbf9a6f98 upstream.
Commit 500462a9de65 "timers: Switch to a non-cascading wheel" replaced
the 'classic' timer wheel, which aimed for near 'exact' expiry of the
timers. Their analysis was that the vast majority of timeout timers
are used as safeguards, not as real timers, and are cancelled or
rearmed before expiration. The only exception noted to this were
networking timers with a small expiry time.
Not included in the analysis was the TPM polling timer, which resulted
in a longer normal delay and, every so often, a very long delay. The
non-cascading wheel delay is based on CONFIG\_HZ. For a description of
the different rings and their delays, refer to the comments in
kernel/time/timer.c.
Below are the delays given for rings 0 - 2, which explains the longer
"normal" delays and the very, long delays as seen on systems with
CONFIG\_HZ 250.
\* HZ 1000 steps
\* Level Offset Granularity Range
\* 0 0 1 ms 0 ms - 63 ms
\* 1 64 8 ms 64 ms - 511 ms
\* 2 128 64 ms 512 ms - 4095 ms (512ms - ~4s)
\* HZ 250
\* Level Offset Granularity Range
\* 0 0 4 ms 0 ms - 255 ms
\* 1 64 32 ms 256 ms - 2047 ms (256ms - ~2s)
\* 2 128 256 ms 2048 ms - 16383 ms (~2s - ~16s)
Below is a comparison of extending the TPM with 1000 measurements,
using msleep() vs. usleep\_delay() when configured for 1000 hz vs. 250
hz, before and after commit 500462a9de65.
linux-4.7 | msleep() usleep\_range()
1000 hz: 0m44.628s | 1m34.497s 29.243s
250 hz: 1m28.510s | 4m49.269s 32.386s
linux-4.7 | min-max (msleep) min-max (usleep\_range)
1000 hz: 0:017 - 2:760s | 0:015 - 3:967s 0:014 - 0:418s
250 hz: 0:028 - 1:954s | 0:040 - 4:096s 0:016 - 0:816s
This patch replaces the msleep() with usleep\_range() calls in the
i2c nuvoton driver with a consistent max range value.
Signed-of-by: Mimi Zohar
Signed-off-by: Nayna Jain
Reviewed-by: Jarkko Sakkinen
Signed-off-by: Jarkko Sakkinen
Signed-off-by: Greg Kroah-Hartman
commit 84eef50e8233f03dca895cc12f4295cf15bca40a
Author: Peter Huewe
Date: Thu Mar 2 13:03:15 2017 +0000
tpm\_tis\_spi: Add small delay after last transfer
commit 5cc0101d1f88500f8901d01b035af743215d4c3a upstream.
Testing the implementation with a Raspberry Pi 2 showed that under some
circumstances its SPI master erroneously releases the CS line before the
transfer is complete, i.e. before the end of the last clock. In this case
the TPM ignores the transfer and misses for example the GO command. The
driver is unable to detect this communication problem and will wait for a
command response that is never going to arrive, timing out eventually.
As a workaround, the small delay ensures that the CS line is held long
enough, even with a faulty SPI master. Other SPI masters are not affected,
except for a negligible performance penalty.
Fixes: 0edbfea537d1 ("tpm/tpm\_tis\_spi: Add support for spi phy")
Signed-off-by: Alexander Steffen
Signed-off-by: Peter Huewe
Reviewed-by: Jarkko Sakkinen
Tested-by: Benoit Houyere
Signed-off-by: Jarkko Sakkinen
Signed-off-by: Greg Kroah-Hartman
commit 32a6b61947548bb1f2666171c5adc10cfd841ae7
Author: Peter Huewe
Date: Thu Mar 2 13:03:14 2017 +0000
tpm\_tis\_spi: Remove limitation of transfers to MAX\_SPI\_FRAMESIZE bytes
commit 591e48c26ced7c455751eef27fb5963e902c2137 upstream.
Limiting transfers to MAX\_SPI\_FRAMESIZE was not expected by the upper
layers, as tpm\_tis has no such limitation. Add a loop to hide that
limitation.
v2: Moved scope of spi\_message to the top as requested by Jarkko
Fixes: 0edbfea537d1 ("tpm/tpm\_tis\_spi: Add support for spi phy")
Signed-off-by: Alexander Steffen
Signed-off-by: Peter Huewe
Reviewed-by: Jarkko Sakkinen
Tested-by: Benoit Houyere
Signed-off-by: Jarkko Sakkinen
Signed-off-by: Greg Kroah-Hartman
commit e2fbfd47e366d309ed94949fabf040a2765419e7
Author: Peter Huewe
Date: Thu Mar 2 13:03:13 2017 +0000
tpm\_tis\_spi: Check correct byte for wait state indicator
commit e110cc69dc2ad679d6d478df636b99b14e6fbbc9 upstream.
Wait states are signaled in the last byte received from the TPM in
response to the header, not the first byte. Check rx\_buf[3] instead of
rx\_buf[0].
Fixes: 0edbfea537d1 ("tpm/tpm\_tis\_spi: Add support for spi phy")
Signed-off-by: Alexander Steffen
Signed-off-by: Peter Huewe
Reviewed-by: Jarkko Sakkinen
Tested-by: Benoit Houyere
Signed-off-by: Jarkko Sakkinen
Signed-off-by: Greg Kroah-Hartman
commit 6b2a246ad05f22d07d197a0fb67e7f55820c1efb
Author: Peter Huewe
Date: Thu Mar 2 13:03:12 2017 +0000
tpm\_tis\_spi: Abort transfer when too many wait states are signaled
commit 975094ddc369a32f27210248bdd9bbd153061b00 upstream.
Abort the transfer with ETIMEDOUT when the TPM signals more than
TPM\_RETRY wait states. Continuing with the transfer in this state
will only lead to arbitrary failures in other parts of the code.
Fixes: 0edbfea537d1 ("tpm/tpm\_tis\_spi: Add support for spi phy")
Signed-off-by: Alexander Steffen
Signed-off-by: Peter Huewe
Reviewed-by: Jarkko Sakkinen
Tested-by: Benoit Houyere
Signed-off-by: Jarkko Sakkinen
Signed-off-by: Greg Kroah-Hartman
commit b0e2a93c289b416077dd15b0e448a82eb95b341e
Author: Peter Huewe
Date: Thu Mar 2 13:03:11 2017 +0000
tpm\_tis\_spi: Use single function to transfer data
commit f848f2143ae42dc0918400039257a893835254d1 upstream.
The algorithm for sending data to the TPM is mostly identical to the
algorithm for receiving data from the TPM, so a single function is
sufficient to handle both cases.
This is a prequisite for all the other fixes, so we don't have to fix
everything twice (send/receive)
v2: u16 instead of u8 for the length.
Fixes: 0edbfea537d1 ("tpm/tpm\_tis\_spi: Add support for spi phy")
Signed-off-by: Alexander Steffen
Signed-off-by: Peter Huewe
Reviewed-by: Jarkko Sakkinen
Tested-by: Benoit Houyere
Signed-off-by: Jarkko Sakkinen
Signed-off-by: Greg Kroah-Hartman
commit 580c656a955cb604aa3a02ffb8563dfbdd0214c7
Author: Amir Goldstein
Date: Tue Apr 25 14:29:35 2017 +0300
fanotify: don't expose EOPENSTALE to userspace
commit 4ff33aafd32e084f5ee7faa54ba06e95f8b1b8af upstream.
When delivering an event to userspace for a file on an NFS share,
if the file is deleted on server side before user reads the event,
user will not get the event.
If the event queue contained several events, the stale event is
quietly dropped and read() returns to user with events read so far
in the buffer.
If the event queue contains a single stale event or if the stale
event is a permission event, read() returns to user with the kernel
internal error code 518 (EOPENSTALE), which is not a POSIX error code.
Check the internal return value -EOPENSTALE in fanotify\_read(), just
the same as it is checked in path\_openat() and drop the event in the
cases that it is not already dropped.
This is a reproducer from Marko Rauhamaa:
Just take the example program listed under "man fanotify" ("fantest")
and follow these steps:
==============================================================
NFS Server NFS Client(1) NFS Client(2)
==============================================================
# echo foo >/nfsshare/bar.txt
# cat /nfsshare/bar.txt
foo
# ./fantest /nfsshare
Press enter key to terminate.
Listening for events.
# rm -f /nfsshare/bar.txt
# cat /nfsshare/bar.txt
read: Unknown error 518
cat: /nfsshare/bar.txt: Operation not permitted
==============================================================
where NFS Client (1) and (2) are two terminal sessions on a single NFS
Client machine.
Reported-by: Marko Rauhamaa
Tested-by: Marko Rauhamaa
Cc:
Signed-off-by: Amir Goldstein
Signed-off-by: Jan Kara
Signed-off-by: Greg Kroah-Hartman
commit 826ca313fd1068d4128f97ac6893156b5e303e9c
Author: Jeeja KP
Date: Wed May 10 11:51:58 2017 +0530
ALSA: hda: Fix cpu lockup when stopping the cmd dmas
commit 960013762df0a214b57f2fce655422fb52bdfd2c upstream.
Using jiffies in hdac\_wait\_for\_cmd\_dmas() to determine when to time out
when interrupts are off (snd\_hdac\_bus\_stop\_cmd\_io()/spin\_lock\_irq())
causes hard lockup so unlock while waiting using jiffies.
---<-snip->---
<0>[ 1211.603046] NMI watchdog: Watchdog detected hard LOCKUP on cpu 3
<4>[ 1211.603047] Modules linked in: snd\_hda\_intel i915 vgem
<4>[ 1211.603053] irq event stamp: 13366
<4>[ 1211.603053] hardirqs last enabled at (13365):
...
<4>[ 1211.603059] Call Trace:
<4>[ 1211.603059] ? delay\_tsc+0x3d/0xc0
<4>[ 1211.603059] \_\_delay+0xa/0x10
<4>[ 1211.603060] \_\_const\_udelay+0x31/0x40
<4>[ 1211.603060] snd\_hdac\_bus\_stop\_cmd\_io+0x96/0xe0 [snd\_hda\_core]
<4>[ 1211.603060] ? azx\_dev\_disconnect+0x20/0x20 [snd\_hda\_intel]
<4>[ 1211.603061] snd\_hdac\_bus\_stop\_chip+0xb1/0x100 [snd\_hda\_core]
<4>[ 1211.603061] azx\_stop\_chip+0x9/0x10 [snd\_hda\_codec]
<4>[ 1211.603061] azx\_suspend+0x72/0x220 [snd\_hda\_intel]
<4>[ 1211.603061] pci\_pm\_suspend+0x71/0x140
<4>[ 1211.603062] dpm\_run\_callback+0x6f/0x330
<4>[ 1211.603062] ? pci\_pm\_freeze+0xe0/0xe0
<4>[ 1211.603062] \_\_device\_suspend+0xf9/0x370
<4>[ 1211.603062] ? dpm\_watchdog\_set+0x60/0x60
<4>[ 1211.603063] async\_suspend+0x1a/0x90
<4>[ 1211.603063] async\_run\_entry\_fn+0x34/0x160
<4>[ 1211.603063] process\_one\_work+0x1f4/0x6d0
<4>[ 1211.603063] ? process\_one\_work+0x16e/0x6d0
<4>[ 1211.603064] worker\_thread+0x49/0x4a0
<4>[ 1211.603064] kthread+0x107/0x140
<4>[ 1211.603064] ? process\_one\_work+0x6d0/0x6d0
<4>[ 1211.603065] ? kthread\_create\_on\_node+0x40/0x40
<4>[ 1211.603065] ret\_from\_fork+0x2e/0x40
Bugzilla: https://bugs.freedesktop.org/show\_bug.cgi?id=100419
Fixes: 38b19ed7f81ec ("ALSA: hda: fix to wait for RIRB & CORB DMA to set")
Reported-by: Marta Lofstedt
Suggested-by: Takashi Iwai
Signed-off-by: Jeeja KP
Acked-by: Vinod Koul
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit d2b8a861a6437e31a874e277422338097455a718
Author: Alexander Steffen
Date: Thu Feb 16 15:33:36 2017 +0000
tpm\_tis\_core: Choose appropriate timeout for reading burstcount
commit 302a6ad7fc77146191126a1f3e2c5d724fd72416 upstream.
TIS v1.3 for TPM 1.2 and PTP for TPM 2.0 disagree about which timeout
value applies to reading a valid burstcount. It is TIMEOUT\_D according to
TIS, but TIMEOUT\_A according to PTP, so choose the appropriate value
depending on whether we deal with a TPM 1.2 or a TPM 2.0.
This is important since according to the PTP TIMEOUT\_D is much smaller
than TIMEOUT\_A. So the previous implementation could run into timeouts
with a TPM 2.0, even though the TPM was behaving perfectly fine.
During tpm2\_probe TIMEOUT\_D will be used even with a TPM 2.0, because
TPM\_CHIP\_FLAG\_TPM2 is not yet set. This is fine, since the timeout values
will only be changed afterwards by tpm\_get\_timeouts. Until then
TIS\_TIMEOUT\_D\_MAX applies, which is large enough.
Fixes: aec04cbdf723 ("tpm: TPM 2.0 FIFO Interface")
Signed-off-by: Alexander Steffen
Signed-off-by: Peter Huewe
Reviewed-by: Jarkko Sakkinen
Signed-off-by: Jarkko Sakkinen
Signed-off-by: Greg Kroah-Hartman
commit b3bf0bbc1eda78d086b905c3eab7f814b32c3a7d
Author: Vamsi Krishna Samavedam
Date: Tue May 16 14:38:08 2017 +0200
USB: core: replace %p with %pK
commit 2f964780c03b73de269b08d12aff96a9618d13f3 upstream.
Format specifier %p can leak kernel addresses while not valuing the
kptr\_restrict system settings. When kptr\_restrict is set to (1), kernel
pointers printed using the %pK format specifier will be replaced with
Zeros. Debugging Note : &pK prints only Zeros as address. If you need
actual address information, write 0 to kptr\_restrict.
echo 0 > /proc/sys/kernel/kptr\_restrict
[Found by poking around in a random vendor kernel tree, it would be nice
if someone would actually send these types of patches upstream - gkh]
Signed-off-by: Vamsi Krishna Samavedam
Signed-off-by: Greg Kroah-Hartman
commit 28c7411cdbc41396dceff7e1b37dbb659f7bdfb2
Author: Willy Tarreau
Date: Tue May 16 19:18:55 2017 +0200
char: lp: fix possible integer overflow in lp\_setup()
commit 3e21f4af170bebf47c187c1ff8bf155583c9f3b1 upstream.
The lp\_setup() code doesn't apply any bounds checking when passing
"lp=none", and only in this case, resulting in an overflow of the
parport\_nr[] array. All versions in Git history are affected.
Reported-By: Roee Hay
Cc: Ben Hutchings
Signed-off-by: Willy Tarreau
Signed-off-by: Greg Kroah-Hartman
commit 37f84f8b993036014c6d682fa9144b9cc337a7ab
Author: Johan Hovold
Date: Mon Mar 13 13:49:45 2017 +0100
watchdog: pcwd\_usb: fix NULL-deref at probe
commit 46c319b848268dab3f0e7c4a5b6e9146d3bca8a4 upstream.
Make sure to check the number of endpoints to avoid dereferencing a
NULL-pointer should a malicious device lack endpoints.
Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
Signed-off-by: Johan Hovold
Reviewed-by: Guenter Roeck
Signed-off-by: Guenter Roeck
Signed-off-by: Wim Van Sebroeck
Signed-off-by: Greg Kroah-Hartman
commit a646b2974afc2033684d75257679a544aa4cdf65
Author: Alan Stern
Date: Tue May 16 11:47:29 2017 -0400
USB: ene\_usb6250: fix DMA to the stack
commit 628c2893d44876ddd11602400c70606ade62e129 upstream.
The ene\_usb6250 sub-driver in usb-storage does USB I/O to buffers on
the stack, which doesn't work with vmapped stacks. This patch fixes
the problem by allocating a separate 512-byte buffer at probe time and
using it for all of the offending I/O operations.
Signed-off-by: Alan Stern
Reported-and-tested-by: Andreas Hartmann
Signed-off-by: Greg Kroah-Hartman
commit dff0ad3b9ce6c3a6832d9dc2c4f5e7892de35722
Author: Maksim Salau
Date: Sat May 13 23:49:26 2017 +0300
usb: misc: legousbtower: Fix memory leak
commit 0bd193d62b4270a2a7a09da43ad1034c7ca5b3d3 upstream.
get\_version\_reply is not freed if function returns with success.
Fixes: 942a48730faf ("usb: misc: legousbtower: Fix buffers on stack")
Reported-by: Heikki Krogerus
Signed-off-by: Maksim Salau
Signed-off-by: Greg Kroah-Hartman
commit cfd3c22c36127ed6a8f8a5272e69a25c907159de
Author: Maksim Salau
Date: Tue Apr 25 22:49:21 2017 +0300
usb: misc: legousbtower: Fix buffers on stack
commit 942a48730faf149ccbf3e12ac718aee120bb3529 upstream.
Allocate buffers on HEAP instead of STACK for local structures
that are to be received using usb\_control\_msg().
Signed-off-by: Maksim Salau
Tested-by: Alfredo Rafael Vicente Boix
Signed-off-by: Greg Kroah-Hartman


=== Content from idp-portal.suse.com_6b95d262_20250126_034644.html ===

## UCS

# Welcome to Univention Corporate Server

## JavaScript required

A browser with JavaScript enabled is required in order to use this service.

When using Internet Explorer, please check your security settings and add this address to your trusted sites.



=== Content from bugzilla.suse.com_d527f730_20250124_215428.html ===


| Bugzilla – Bug 1123706 | VUL-0: CVE-2017-18360: kernel: user space can oops the kernel by going to extreme baud rates | Last modified: 2022-02-13 11:42:02 UTC |
| --- | --- | --- |

|  |
| --- |

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [IDP Log In](/saml2_login.cgi?idp=IDP&target=show_bug.cgi%3Fid%3D1123706)
* |
  [Forgot Password](https://idp-portal.suse.com/univention/self-service/#page=passwordreset)

[**Bug 1123706**](show_bug.cgi?id=1123706)
(CVE-2017-18360)
- VUL-0: CVE-2017-18360: kernel: user space can oops the kernel by going to extreme baud rates

[Summary:](page.cgi?id=glossary.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
VUL-0: CVE-2017-18360: kernel: user space can oops the kernel by going to ext...

| | [Status](page.cgi?id=status_resolution_matrix.html): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=glossary.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2017-18360 | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | SUSE Security Incidents | | [Classification:](page.cgi?id=glossary.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Novell Products | | [Component:](describecomponents.cgi?product=SUSE Security Incidents "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Incidents ([show other bugs](buglist.cgi?component=Incidents&product=SUSE%20Security%20Incidents&bug_status=__open__)) | | [Version:](page.cgi?id=glossary.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=glossary.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Other Other | |  | | | [Priority](page.cgi?id=glossary.html#priority): | P3 - Medium **Severity**: Normal | | [Target Milestone:](page.cgi?id=glossary.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=glossary.html#assigned_to "The person in charge of resolving the bug.") | Security Team bot | | [QA Contact:](page.cgi?id=glossary.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | Security Team bot | |  | | | [URL:](page.cgi?id=glossary.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") | <https://smash.suse.de/issue/224015/> | | [Whiteboard:](page.cgi?id=glossary.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") | CVSSv3:SUSE:CVE-2017-18360:5.5:(AV:L/... | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=glossary.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=glossary.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2019-01-30 15:34 UTC by Oliver Neukum | | --- | --- | | Modified: | 2022-02-13 11:42 UTC ([History](show_activity.cgi?id=1123706)) | | CC List: | 2 users (show)  meissner tiwai | |  | | | [See Also:](page.cgi?id=glossary.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Found By:](page.cgi?id=glossary.html#cf_foundby "A custom Drop Down field in this installation of Bugzilla.") | --- | | [Services Priority:](page.cgi?id=glossary.html#cf_nts_priority "A custom Free Text field in this installation of Bugzilla.") |  | | [Business Priority:](page.cgi?id=glossary.html#cf_biz_priority "A custom Free Text field in this installation of Bugzilla.") |  | | [Blocker:](page.cgi?id=glossary.html#cf_blocker "A custom Drop Down field in this installation of Bugzilla.") | --- | | [Marketing QA Status:](page.cgi?id=glossary.html#cf_marketing_qa_status "A custom Drop Down field in this installation of Bugzilla.") | --- | | [IT Deployment:](page.cgi?id=glossary.html#cf_it_deployment "A custom Drop Down field in this installation of Bugzilla.") | --- | |  | |  * [Clone This Bug](enter_bug.cgi?cloned_bug_id=1123706) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [Add an attachment](attachment.cgi?bugid=1123706&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=1123706&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1123706#c0)  Oliver Neukum   2019-01-30 15:34:14 UTC  ``` Upstream has this fix and this looks like exploitable without root priviledges, hence worth a CVE  commit 6aeb75e6adfaed16e58780309613a578fe1ee90b Author: Johan Hovold <johan@kernel.org> Date:   Thu May 11 11:41:21 2017 +0200      USB: serial: io_ti: fix div-by-zero in set_termios          Fix a division-by-zero in set_termios when debugging is enabled and a     high-enough speed has been requested so that the divisor value becomes     zero.          Instead of just fixing the offending debug statement, cap the baud rate     at the base as a zero divisor value also appears to crash the firmware.          Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")     Cc: stable <stable@vger.kernel.org>     # 2.6.12     Reviewed-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>     Signed-off-by: Johan Hovold <johan@kernel.org> ``` [Comment 1](show_bug.cgi?id=1123706#c1)  Marcus Meissner   2019-01-31 07:51:17 UTC  ``` cve requested ``` [Comment 2](show_bug.cgi?id=1123706#c2)  Marcus Meissner   2019-01-31 07:52:47 UTC  ``` patches.kernel.org/patch-4.4.69-70  so SLES 12 Sp2 and newer should be fixed already ``` [Comment 3](show_bug.cgi?id=1123706#c3)  Marcus Meissner   2019-01-31 09:25:30 UTC  ``` CVE-2017-18360 ``` [Comment 4](show_bug.cgi?id=1123706#c4)  Oliver Neukum   2019-02-06 15:12:36 UTC  ``` Fix submitted to SLE11-SP4 tree ``` [Comment 5](show_bug.cgi?id=1123706#c5)  Swamp Workflow Management   2019-03-19 10:22:41 UTC  ``` SUSE-SU-2019:13979-1: An update that solves 8 vulnerabilities and has 73 fixes is now available.  Category: security (important) Bug References: 1012382,1031572,1068032,1086695,1087081,1094244,1098658,1104098,1104367,1104684,1104818,1105536,1106105,1106886,1107371,1109330,1109806,1110006,1112963,1113667,1114440,1114672,1114920,1115007,1115038,1115827,1115828,1115829,1115830,1115831,1115832,1115833,1115834,1115835,1115836,1115837,1115838,1115839,1115840,1115841,1115842,1115843,1115844,1116841,1117796,1117802,1117805,1117806,1117943,1118152,1118319,1118760,1119255,1119714,1120056,1120077,1120086,1120093,1120094,1120105,1120107,1120109,1120217,1120223,1120226,1120336,1120347,1120743,1120950,1121872,1121997,1122874,1123505,1123702,1123706,1124010,1124735,1125931,931850,969471,969473 CVE References: CVE-2016-10741,CVE-2017-18360,CVE-2018-19407,CVE-2018-19824,CVE-2018-19985,CVE-2018-20169,CVE-2018-9568,CVE-2019-7222 Sources used: SUSE Linux Enterprise Software Development Kit 11-SP4 (src):    kernel-docs-3.0.101-108.87.1 SUSE Linux Enterprise Server 11-SP4 (src):    kernel-bigmem-3.0.101-108.87.1, kernel-default-3.0.101-108.87.1, kernel-ec2-3.0.101-108.87.1, kernel-pae-3.0.101-108.87.1, kernel-ppc64-3.0.101-108.87.1, kernel-source-3.0.101-108.87.1, kernel-syms-3.0.101-108.87.1, kernel-trace-3.0.101-108.87.1, kernel-xen-3.0.101-108.87.1 SUSE Linux Enterprise Server 11-EXTRA (src):    kernel-default-3.0.101-108.87.1, kernel-pae-3.0.101-108.87.1, kernel-ppc64-3.0.101-108.87.1, kernel-trace-3.0.101-108.87.1, kernel-xen-3.0.101-108.87.1 SUSE Linux Enterprise Real Time Extension 11-SP4 (src):    ocfs2-1.6-0.28.7.1 SUSE Linux Enterprise High Availability Extension 11-SP4 (src):    ocfs2-1.6-0.28.7.1 SUSE Linux Enterprise Debuginfo 11-SP4 (src):    kernel-bigmem-3.0.101-108.87.1, kernel-default-3.0.101-108.87.1, kernel-ec2-3.0.101-108.87.1, kernel-pae-3.0.101-108.87.1, kernel-ppc64-3.0.101-108.87.1, kernel-trace-3.0.101-108.87.1, kernel-xen-3.0.101-108.87.1 ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=1123706)
* - [XML](show_bug.cgi?ctype=xml&id=1123706)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=1123706)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [IDP Log In](/saml2_login.cgi?idp=IDP&target=show_bug.cgi%3Fid%3D1123706)
  + |
    [Forgot Password](https://idp-portal.suse.com/univention/self-service/#page=passwordreset)

+ Legal:
+ [openSUSE](http://en.opensuse.org/Terms_of_site)
+ [SUSE](https://www.suse.com/company/legal/)


