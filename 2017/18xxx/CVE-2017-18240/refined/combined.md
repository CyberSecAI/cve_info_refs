=== Content from bugs.gentoo.org_deccdc35_20250126_055226.html ===

[![Gentoo Websites Logo](extensions/Gentoo/web/gentoo_org.png)](/ "Go to the Gentoo Bugzilla homepage")
Go to:
[Gentoo Home](https://www.gentoo.org/)
[Documentation](https://www.gentoo.org/support/documentation/)
[Forums](https://forums.gentoo.org/)
[Lists](https://www.gentoo.org/get-involved/mailing-lists/)
[Bugs](/)
[Planet](https://planet.gentoo.org/)
[Store](https://www.gentoo.org/inside-gentoo/stores/)
[Wiki](https://wiki.gentoo.org/)
**[Get Gentoo!](https://www.gentoo.org/downloads/)**

Gentoo's Bugzilla – Search by bug number

* [Home](./)
* | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?keywords=i&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?keywords=i&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

You may find a single bug by entering its bug id here:

* + [Home](./)
  + | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?keywords=i&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?keywords=i&GoAheadAndLogIn=1#forgot)
    Login:

    [x]



=== Content from security.gentoo.org_fa927ebc_20250125_041311.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# collectd: Multiple vulnerabilities — GLSA **201803-10**

Gentoo's collectd package contains multiple vulnerabilities, the
worst of which may allow local attackers to escalate privileges.

### Affected packages

| Package | **app-admin/collectd** on all architectures |
| --- | --- |
| Affected versions | < **5.7.2-r1** |
| Unaffected versions | >= **5.7.2-r1** |

### Background

collectd is a daemon which collects system and application performance
metrics periodically and provides mechanisms to store the values in a
variety of ways, for example in RRD files.

### Description

Multiple vulnerabilities have been found in Gentoo’s collectd package.
Please review the referenced CVE identifiers and bug entries for details.

### Impact

A local attacker, who either is already collectd’s system user or
belongs to collectd’s group, could potentially gain root privileges and
cause a Denial of Service condition.

Remote attackers could cause a Denial of Service condition via specially
crafted SNMP responses.

### Workaround

There is no known workaround at this time.

### Resolution

All collectd users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=app-admin/collectd-5.7.2-r1"

```
### References

* [CVE-2017-16820](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2017-16820)
* [CVE-2017-18240](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2017-18240)

**Release date**

March 22, 2018

**Latest revision**

March 22, 2018: 1

**Severity**

high

**Exploitable**

local, remote

**Bugzilla entries**

* [628540](https://bugs.gentoo.org/show_bug.cgi?id=628540)
* [637538](https://bugs.gentoo.org/show_bug.cgi?id=637538)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from bugs.gentoo.org_7e8ef10c_20250125_041310.html ===

[![Gentoo Websites Logo](extensions/Gentoo/web/gentoo_org.png)](/ "Go to the Gentoo Bugzilla homepage")
Go to:
[Gentoo Home](https://www.gentoo.org/)
[Documentation](https://www.gentoo.org/support/documentation/)
[Forums](https://forums.gentoo.org/)
[Lists](https://www.gentoo.org/get-involved/mailing-lists/)
[Bugs](/)
[Planet](https://planet.gentoo.org/)
[Store](https://www.gentoo.org/inside-gentoo/stores/)
[Wiki](https://wiki.gentoo.org/)
**[Get Gentoo!](https://www.gentoo.org/downloads/)**

Gentoo's Bugzilla – Bug 628540
<app-admin/collectd-5.7.2-r1: privilege escalation via PID file manipulation
Last modified: 2018-03-22 00:21:49 UTC node [vulture]

* [Home](./)
* | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=628540&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=628540&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 628540**](show_bug.cgi?id=628540)
(CVE-2017-18240)
- <app-admin/collectd-5.7.2-r1: privilege escalation via PID file manipulation

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
<app-admin/collectd-5.7.2-r1: privilege escalation via PID file manipulation

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2017-18240 | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | Gentoo Security | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=Gentoo Security "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Vulnerabilities ([show other bugs](buglist.cgi?component=Vulnerabilities&product=Gentoo%20Security&bug_status=__open__)) | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All Linux | |  | | | [Importance](page.cgi?id=fields.html#importance): | Normal major | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Gentoo Security | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") | B1 [glsa+ cve] | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [CVE-2017-16820](show_bug.cgi?id=637538 "RESOLVED FIXED - <app-admin/collectd-5.7.2-r1: double free in csnmp_read_table function in snmp.c (CVE-2017-16820)") | |  | Show dependency [tree](showdependencytree.cgi?id=628540&hide_resolved=1) | |  | | Reported: | 2017-08-21 18:10 UTC by Michael Orlitzky | | --- | --- | | Modified: | 2018-03-22 00:21 UTC ([History](show_activity.cgi?id=628540)) | | CC List: | 1 user (show)  whissi | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Package list:](page.cgi?id=fields.html#cf_stabilisation_atoms "Contains a list of packages (and optionally, architectures) to keyword or stabilize. One fully qualified package per line, optionally followed by a space-delimited list of architectures for that package.") | app-admin/collectd-5.7.2-r1 | | [Runtime testing required:](page.cgi?id=fields.html#cf_runtime_testing_required "Indicate what level of testing is required. For manual testing following instructions in the bug, choose \"Manual\". For only compile-testing, choose \"No\". For where tests must pass, choose \"Yes\".") | --- | |  | | | Flags: | stable-bot: sanity-check+ | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | | --- | --- | --- | | [Add an attachment](attachment.cgi?bugid=628540&action=enter) (proposed patch, testcase, etc.) | | |   | Note You need to [log in](show_bug.cgi?id=628540&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](#c0)  Michael Orlitzky   gentoo-dev  2017-08-21 18:10:59 UTC  ``` The init script for collectd gives ownership of the PID file directory to the same user that the daemon runs as:    checkpath --directory             --mode 0770             --owner ${COLLECTD_USER}:${COLLECTD_GROUP}             "$(dirname "${COLLECTD_PIDFILE}")"  As a result, the $COLLECTD_USER can write whatever he wants into the PID file. Later, that may be exploitable: when the service is stopped, root will call "kill" on the contents of that file.  The init script is doing that because start-stop-daemon starts collectd as the ${COLLECTD_USER} user. Thus the PID file created by the daemon is created by the ${COLLECTD_USER} user, who needs permission to write it. The usual way that this problem is avoided is that the daemon itself drops privileges, rather than start-stop-daemon doing the work. However, collectd doesn't have any such user/group options.  Fortunately, collectd *does* have the ability to run in the foreground. As a workaround, you can pass the "-f" flag to collectd to run it in the foreground. Then command_background=true can be used to tell start-stop-daemon that it should both force the process into the background, and manage the PID file itself. That will require no special privileges on the PID directory, thus avoiding the vulnerability.  To summarize the changes that I would make:    1. add "-f" to command_args, and drop -P "${COLLECTD_PIDFILE}" from it.   2. set command_background=true   3. use /run/collectd.pid (writable only by root) as the COLLECTD_PIDFILE.   4. eliminate the (now redundant) stop_post function   5. utilize command_user to set the user/group, rather than start_stop_daemon_args ```  [Comment 1](#c1)  Thomas Deutschmann (RETIRED)   gentoo-dev  2017-08-21 20:38:27 UTC  ``` (In reply to Michael Orlitzky from [comment #0](show_bug.cgi?id=628540#c0)) > The init script for collectd gives ownership of the PID file directory to > the same user that the daemon runs as: >  >   checkpath --directory >             --mode 0770 >             --owner ${COLLECTD_USER}:${COLLECTD_GROUP} >             "$(dirname "${COLLECTD_PIDFILE}")" >  > As a result, the $COLLECTD_USER can write whatever he wants into the PID > file. Later, that may be exploitable: when the service is stopped, root will > call "kill" on the contents of that file.  I maybe miss a thing but collectd uses OpenRC's default stop function:  > ssd_stop() > { >         local _progress= >         local startcommand="$(service_get_value "command")" >         local startchroot="$(service_get_value "chroot")" >         local startpidfile="$(service_get_value "pidfile")" >         local startprocname="$(service_get_value "procname")" >         command="${startcommand:-$command}" >         chroot="${startchroot:-$chroot}" >         pidfile="${startpidfile:-$pidfile}" >         procname="${startprocname:-$procname}" >         [ -n "$command" -o -n "$procname" -o -n "$pidfile" ] || return 0 >         yesno "${command_progress}" && _progress=--progress >         ebegin "Stopping ${name:-$RC_SVCNAME}" >         start-stop-daemon --stop \ >                 ${retry:+--retry} $retry \ >                 ${command:+--exec} $command \ >                 ${procname:+--name} $procname \ >                 ${pidfile:+--pidfile} $chroot$pidfile \ >                 ${stopsig:+--signal} $stopsig \ >                 ${_progress} >  >         eend $? "Failed to stop ${name:-$RC_SVCNAME}" > }  (<https://github.com/OpenRC/openrc/blob/master/sh/start-stop-daemon.sh>)  And the runscript defines "command":  > command="/usr/sbin/collectd"  (<https://gitweb.gentoo.org/repo/gentoo.git/tree/app-admin/collectd/files/collectd.initd-r1#n14>)  ...so I don't understand how a user able to control the content of "/run/collectd/collectd.pid" (and you are right, per default, the collectd user is able to control this file) could abuse this file to escalate privileges: Start-stop-daemon should detect that the PID doesn't match the command. ```  [Comment 2](#c2)  Michael Orlitzky   gentoo-dev  2017-08-21 22:45:24 UTC  ``` (In reply to Thomas Deutschmann from [comment #1](show_bug.cgi?id=628540#c1)) > Start-stop-daemon should detect that the PID doesn't match the > command.  A reasonable assumption that turns out to be wrong if you try it =) ```  [Comment 3](#c3)  Michael Orlitzky   gentoo-dev  2017-08-21 23:01:49 UTC  ``` It would be nice if we could fix issues like these wholesale, but it's not so clear-cut; e.g.    <https://github.com/OpenRC/openrc/pull/156>  In the meantime, it's still a good idea to update the init scripts because people copy around stop() and reload() functions without any regard for what they're doing. Even if OpenRC was able to check the command name against the PID, there are plenty of copy/pasted stop() functions that don't pass the command name to s-s-d. Having bulletproof examples in the tree provides another layer of defense against the issue. ```  [Comment 4](#c4)  Larry the Git Cow   gentoo-dev  2018-01-25 22:34:43 UTC  ``` The bug has been referenced in the following commit(s):  <https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=9a70b58bd58ff19395c55abbf0a2e620a5a56f3a>  commit 9a70b58bd58ff19395c55abbf0a2e620a5a56f3a Author:     Thomas Deutschmann <whissi@gentoo.org> AuthorDate: 2018-01-25 22:34:18 +0000 Commit:     Thomas Deutschmann <whissi@gentoo.org> CommitDate: 2018-01-25 22:34:34 +0000      app-admin/collectd: bump, fixes CVE-2017-16820 & #628540          Ebuild changes:     ===============     - To address [bug 628540](show_bug.cgi?id=628540 "RESOLVED FIXED - <app-admin/collectd-5.7.2-r1: privilege escalation via PID file manipulation"), we no longer run collectd in       daemon mode, instead we will run collectd everywhere       in foreground and let the init system handle the PID       file.          - /run/collectd/ (default location for collectd's UNIX socket)       is now maintained using tmpfiles service.          Bug: <https://bugs.gentoo.org/628540>     Bug: <https://bugs.gentoo.org/637538>     Package-Manager: Portage-2.3.20, Repoman-2.3.6   app-admin/collectd/collectd-5.7.2-r1.ebuild        | 541 +++++++++++++++++++++  .../files/collectd-5.7.2-CVE-2017-16820.patch      |  39 ++  app-admin/collectd/files/collectd.confd-r2         |  49 ++  app-admin/collectd/files/collectd.initd-r2         |  70 +++  app-admin/collectd/files/collectd.tmpfile          |   1 +  5 files changed, 700 insertions(+)} ```  [Comment 5](#c5)  Thomas Deutschmann (RETIRED)   gentoo-dev  2018-01-25 22:37:25 UTC  ``` @ Michael: Could you please review my changes if they address all the problems? ```  [Comment 6](#c6)  Michael Orlitzky   gentoo-dev  2018-01-27 00:31:12 UTC  ``` Looks good, thanks! ```  [Comment 7](#c7)  Thomas Deutschmann (RETIRED)   gentoo-dev  2018-01-27 00:33:00 UTC  ``` Thanks for the review and the report :)  @ Arches,  please test and mark stable: =app-admin/collectd-5.7.2-r1 ```  [Comment 8](#c8)  Thomas Deutschmann (RETIRED)   gentoo-dev  2018-01-28 16:37:25 UTC  ``` x86 stable ```  [Comment 9](#c9)  Agostino Sarubbo   gentoo-dev  2018-01-31 07:59:29 UTC  ``` amd64 stable ```  [Comment 10](#c10)  Markus Meier   gentoo-dev  2018-02-05 21:18:42 UTC  ``` arm stable, all arches done. ```  [Comment 11](#c11)  Larry the Git Cow   gentoo-dev  2018-03-03 16:43:58 UTC  ``` The bug has been referenced in the following commit(s):  <https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=c148c069385caf68d0bc5609ce13db4ba9e71415>  commit c148c069385caf68d0bc5609ce13db4ba9e71415 Author:     Thomas Deutschmann <whissi@gentoo.org> AuthorDate: 2018-03-03 16:41:59 +0000 Commit:     Thomas Deutschmann <whissi@gentoo.org> CommitDate: 2018-03-03 16:43:51 +0000      app-admin/collectd: Security cleanup          Bug: <https://bugs.gentoo.org/628540>     Package-Manager: Portage-2.3.24, Repoman-2.3.6   app-admin/collectd/Manifest                        |   2 -  app-admin/collectd/collectd-5.6.2-r4.ebuild        | 532 --------------------  app-admin/collectd/collectd-5.7.1.ebuild           | 537 ---------------------  app-admin/collectd/collectd-5.7.2.ebuild           | 536 --------------------  .../files/collectd-5.6.2-CVE-2017-7401.patch       |  56 ---  .../collectd/files/collectd-5.6.2-issue2303.patch  |  44 --  app-admin/collectd/files/collectd.confd-r1         |  45 --  app-admin/collectd/files/collectd.initd-r1         |  78 ---  8 files changed, 1830 deletions(-)} ```  [Comment 12](#c12)  Thomas Deutschmann (RETIRED)   gentoo-dev  2018-03-03 16:44:43 UTC  ``` New GLSA request filed. ```  [Comment 13](#c13)  Christopher Díaz Riveros (RETIRED)   gentoo-dev Security  2018-03-19 02:10:38 UTC  ``` CVE-2017-18240 Assigned. ```  [Comment 14](#c14)  GLSAMaker/CVETool Bot   gentoo-dev  2018-03-22 00:21:49 UTC  ``` This issue was resolved and addressed in  GLSA 201803-10 at <https://security.gentoo.org/glsa/201803-10> by GLSA coordinator Christopher Diaz Riveros (chrisadr). ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=628540)
* - [XML](show_bug.cgi?ctype=xml&id=628540)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=628540)
* - [Clone In The Same
  Product](enter_bug.cgi?cloned_bug_id=628540&product=Gentoo%20Security)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=628540&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=628540&GoAheadAndLogIn=1#forgot)
    Login:

    [x]


