=== Content from cgit.freedesktop.org_49035c62_20250124_172759.html ===


| [cgit logo](/) | [index](/) : [exempi](/exempi/) | adobe-sdk ci-test exempi-2.0-branch exempi-2.2-branch exempi-2.3-branch exempi-2.4-branch exempi-2.5-branch master |
| --- | --- | --- |
| Exempi 2.0. XMP metadata handling library based on Adobe XMP reference implementation. (mirrored from https://gitlab.freedesktop.org/libopenraw/exempi) | hub |

| [summary](/exempi/)[refs](/exempi/refs/?id=f19d0107fbae1fb41836cd110d4425e407e64048)[log](/exempi/log/)[tree](/exempi/tree/?id=f19d0107fbae1fb41836cd110d4425e407e64048)[commit](/exempi/commit/?id=f19d0107fbae1fb41836cd110d4425e407e64048)[diff](/exempi/diff/?id=f19d0107fbae1fb41836cd110d4425e407e64048) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Hubert Figuière <hub@figuiere.net> | 2017-08-03 21:53:04 -0400 |
| --- | --- | --- |
| committer | Hubert Figuière <hub@figuiere.net> | 2017-08-03 21:53:04 -0400 |
| commit | [f19d0107fbae1fb41836cd110d4425e407e64048](/exempi/commit/?id=f19d0107fbae1fb41836cd110d4425e407e64048) ([patch](/exempi/patch/?id=f19d0107fbae1fb41836cd110d4425e407e64048)) | |
| tree | [9e7e81d6dc1165b3495daed741025a21d7d9081f](/exempi/tree/?id=f19d0107fbae1fb41836cd110d4425e407e64048) | |
| parent | [9e76a7782a54a242f18d609e7ba32bf1c430a5e4](/exempi/commit/?id=9e76a7782a54a242f18d609e7ba32bf1c430a5e4) ([diff](/exempi/diff/?id=f19d0107fbae1fb41836cd110d4425e407e64048&id2=9e76a7782a54a242f18d609e7ba32bf1c430a5e4)) | |

Bug 101914 - Fix crash on corrupt file- Don't go past the end iterator
- Don't subcript an empty string
[Diffstat](/exempi/diff/?id=f19d0107fbae1fb41836cd110d4425e407e64048)

| -rw-r--r-- | [XMPFiles/source/FormatSupport/PostScript\_Support.cpp](/exempi/diff/XMPFiles/source/FormatSupport/PostScript_Support.cpp?id=f19d0107fbae1fb41836cd110d4425e407e64048) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 2 deletions

| diff --git a/XMPFiles/source/FormatSupport/PostScript\_Support.cpp b/XMPFiles/source/FormatSupport/PostScript\_Support.cppindex fec55fb..029ff0c 100644--- a/[XMPFiles/source/FormatSupport/PostScript\_Support.cpp](/exempi/tree/XMPFiles/source/FormatSupport/PostScript_Support.cpp?id=9e76a7782a54a242f18d609e7ba32bf1c430a5e4)+++ b/[XMPFiles/source/FormatSupport/PostScript\_Support.cpp](/exempi/tree/XMPFiles/source/FormatSupport/PostScript_Support.cpp?id=f19d0107fbae1fb41836cd110d4425e407e64048)@@ -814,7 +814,8 @@ std::string PostScript\_Support::ConvertToDate(const char\* inString) std::vector<PostScript\_Support::DateTimeTokens>:: const\_iterator itr=tokenzs.begin(); for(;itr!=tokenzs.end();itr++) {- if(itr->token[0]=='+' ||itr->token[0]=='-')+ // token[0] is invalid on an empty string. -- Hub+ if(!itr->token.empty() && (itr->token[0]=='+' ||itr->token[0]=='-')) { const char \*str=itr->token.c\_str(); date.offsetSign=\*(str++);@@ -1013,7 +1014,14 @@ std::string PostScript\_Support::ConvertToDate(const char\* inString) if(itr!=tokenzs.end()) { ++itr;- if (itr!=tokenzs.end()&&itr->noOfDelimiter==0 && IsNumeric(itr->token[0]) )+ if (itr == tokenzs.end())+ {+ // bug 101914 - corrupt file make us+ // reach the end. -- Hub+ // https://bugs.freedesktop.org/show\_bug.cgi?id=101914+ break;+ }+ if (itr->noOfDelimiter==0 && IsNumeric(itr->token[0]) ) { const char \* str=itr->token.c\_str(); short day= GetNumber(&str); |
| --- |

generated by [cgit v1.2.3](https://git.zx2c4.com/cgit/about/) ([git 2.39.1](https://git-scm.com/)) at 2025-01-24 17:27:59 +0000



=== Content from bugs.freedesktop.org_1d7d6ee2_20250124_172758.html ===


Bugzilla – Bug 101914
segfault in PostScript\_Support::ConvertToDate()
Last modified: 2017-08-04 02:24:58 UTC

* [Home](./)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

[**Bug 101914**](show_bug.cgi?id=101914)
- segfault in PostScript\_Support::ConvertToDate()

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
segfault in PostScript\_Support::ConvertToDate()

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | exempi | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=exempi "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Problems ([show other bugs](buglist.cgi?component=Problems&product=exempi&bug_status=__open__)) | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Other All | |  | | | [Importance](page.cgi?id=fields.html#importance): | medium normal | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Hubert Figuiere | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | Hubert Figuiere | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") | [release:2.4.3] | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2017-07-25 10:18 UTC by Jakub Wilk | | --- | --- | | Modified: | 2017-08-04 02:24 UTC ([History](show_activity.cgi?id=101914)) | | CC List: | 0 users | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [i915 platform:](page.cgi?id=fields.html#cf_i915_platform "Intel platforms affected by the bug") |  | | [i915 features:](page.cgi?id=fields.html#cf_i915_features "Features of the i915 driver affected by the bug.") |  | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [**reproducer**](attachment.cgi?id=132950 "View the content of the attachment") (33 bytes, application/postscript)  [2017-07-25 10:18 UTC](#attach_132950 "Go to the comment associated with the attachment"), Jakub Wilk | [Details](attachment.cgi?id=132950&action=edit) | | [View All](attachment.cgi?bugid=101914&action=viewall) | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=101914#c0)  Jakub Wilk    2017-07-25 10:18:03 UTC  ``` Created [attachment 132950](attachment.cgi?id=132950 "reproducer") [[details]](attachment.cgi?id=132950&action=edit "reproducer") reproducer  Exempi crashes on the attached PostScript file:  > $ exempi -x convertodate.ps > processing file convertodate.ps > dump_xmp for file convertodate.ps > Segmentation fault  GDB says it's trying to dereference an invalid pointer:  > Program received signal SIGSEGV, Segmentation fault. > PostScript_Support::ConvertToDate (inString=0x805a84c "deC") at PostScript_Support.cpp:817 > 817                     if(itr->token[0]=='+' ||itr->token[0]=='-') > (gdb) print itr > $1 = {token = <error reading variable: Cannot access memory at address 0xfffffff4>, noOfDelimiter = 1, delimiter = 0 '\000'} > (gdb) bt > #0  PostScript_Support::ConvertToDate (inString=0x805a84c "deC") at PostScript_Support.cpp:817 > #1  0xb7ecfc84 in PostScript_MetaHandler::ReconcileXMP (this=0x805a8d0, xmpStr="", outStr=0x805a8f8) at PostScript_Handler.cpp:1106 > #2  0xb7ed006a in PostScript_MetaHandler::ProcessXMP (this=0x805a8d0) at PostScript_Handler.cpp:1219 > #3  0xb7e9d793 in XMPFiles::GetXMP (this=0x805a720, xmpObj=0xbffff448, xmpPacket=0xbffff440, xmpPacketLen=0xbffff444, packetInfo=0x0) at XMPFiles.cpp:1471 > #4  0xb7e99d4b in WXMPFiles_GetXMP_1 (xmpObjRef=0x805a720, xmpRef=0x805ac40, clientPacket=0x0, packetInfo=0x0, SetClientString=0xb7e577ec <TXMPFiles<std::string>::SetClientString(void*, char const*, unsigned int)>, wResult=0xbffff494) at WXMPFiles.cpp:331 > #5  0xb7e5dd83 in TXMPFiles<std::string>::GetXMP (this=0x8057cf8, xmpObj=0x805a858, xmpPacket=0x0, packetInfo=0x0) at ../public/include/client-glue/TXMPFiles.incl_cpp:382 > #6  0xb7e5598b in xmp_files_get_new_xmp (xf=0x8057cf8) at exempi.cpp:330 > #7  0x0804936c in get_xmp_from_file (filename=filename@entry=0xbffff812 "convertodate.ps", no_reconcile=no_reconcile@entry=false, is_an_xmp=is_an_xmp@entry=false) at main.cpp:237 > #8  0x080493e5 in dump_xmp (filename=filename@entry=0xbffff812 "convertodate.ps", no_reconcile=no_reconcile@entry=false, is_an_xmp=is_an_xmp@entry=false, outio=0xb7c0dd60 <_IO_2_1_stdout_>) at main.cpp:250 > #9  0x080499aa in process_file (filename=0xbffff812 "convertodate.ps", no_reconcile=<optimized out>, is_an_xmp=<optimized out>, write_in_place=false, dump_xml=true, action=0, value_name="", prop_value="", output="") at main.cpp:340 > #10 0x08049d66 in main (argc=<optimized out>, argv=<optimized out>) at main.cpp:187  Tested with git master (0320c32a388964498911d7ebdec6561687d2f6c6).  Found using American Fuzzy Lop: <http://lcamtuf.coredump.cx/afl/> ```  [Comment 1](show_bug.cgi?id=101914#c1)  Hubert Figuiere    2017-08-03 03:38:00 UTC  ``` libasan catches this  ==7296==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x604000007ea0 at pc 0x7f40d17ccb26 bp 0x7ffeee318110 sp 0x7ffeee318100 ```  [Comment 2](show_bug.cgi?id=101914#c2)  Hubert Figuiere    2017-08-04 01:58:50 UTC  ``` Fixed in the 2.4 branch f19d0107fbae1fb41836cd110d4425e407e64048 ```  [Comment 3](show_bug.cgi?id=101914#c3)  Hubert Figuiere    2017-08-04 02:15:29 UTC  ``` and in master ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=101914)
* - Top of page

* + [Home](./)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

Use of freedesktop.org services, including Bugzilla, is subject to our [Code of Conduct](https://www.freedesktop.org/wiki/CodeOfConduct/). How we collect and use information is described in our [Privacy Policy](https://www.freedesktop.org/wiki/PrivacyPolicy).


