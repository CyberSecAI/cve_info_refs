=== Content from lists.debian.org_3697b977_20250124_122102.html ===


---

[[Date Prev](msg00029.html)][Date Next]
[[Thread Prev](msg00029.html)][Thread Next]
[[Date Index](maillist.html#00030)]
[[Thread Index](threads.html#00030)]

# [SECURITY] [DLA 1653-1] postgis security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 1653-1] postgis security update
* *From*: Emilio Pozuelo Monfort <pochu@debian.org>
* *Date*: Thu, 31 Jan 2019 19:40:39 +0100
* *Message-id*: <[[🔎]](/msgid-search/ec830f7d-18d9-19e3-6c18-09c130bb1b3a%40debian.org) [ec830f7d-18d9-19e3-6c18-09c130bb1b3a@debian.org](msg00030.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

Package        : postgis
Version        : 2.1.4+dfsg-3+deb8u1
CVE ID         : CVE-2017-18359

It was found that the function ST_AsX3D in PostGIS, a module that
adds spatial objects to the PostgreSQL object-relational database, did
not handle empty values properly, allowing malicious users to cause
denial of service or possibly other unspecified behaviour.

For Debian 8 "Jessie", this problem has been fixed in version
2.1.4+dfsg-3+deb8u1.

We recommend that you upgrade your postgis packages.

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCAAdFiEEcJymx+vmJZxd92Q+nUbEiOQ2gwIFAlxTQScACgkQnUbEiOQ2
gwJzcxAAnMS9Lq/M2vU3GfSO0WPqLZayL5A/772xLDdUKRHGBeMnkt/ZArS5keK+
AGok/rrhlEQBQLCgWsYFpdL/dQoPbYiNBrxKGSnDpw5oBkL5hUHyMQxZWc9JFFA5
o3qypOEzKOYgWmYmwT9be4MraAYQ+q9/UhHlTpTOqx2GPEEVnuAZ+80ImsyJ8To2
kuATuPowTSmE+MDdIlkR7xV89KkA7NY9ZAZ3JBboESiLYg3o8bXVQNtPrlBogGB7
AyUukdx7PPN8XPvRPvFwKr9+uQr4vDJRusLDyK8C60mvt8ONXx0TVIOeHXBfijqR
6kf38a6LAffMtEYJFztnoZL/xemUjTNFSUgy6I40DD1MC7MYEXJzF5XUk80v73R1
YxmJdht0W3bDbRy7KsUVtYWKExL+2GCPapbZZ3iMOmCma1Q9jvOqdTV1BOHfoINy
AUIEG+jPGhyDaTAETkcUAVKPZr6BrIm9ifplxJ4RVpQLLCnwr5Zrrt8H93bk9o/h
X1F0YP3wkb51Kbo1/CPKhuWxSgR90hEyxRisajshFbcvVy1E3NYThpiU5QNQyFiM
jQCn/tX0ezK+ZF/GsH3jR3EyYMcNeVpYSt/YedAp0QzSzAP1tYXuJsG8K/AEunhp
EmX8NwraNI5kIoVuVM1EZg3Gk7Hv2xXKal5ROdZU6OPrZXiA3HQ=
=LiQQ
-----END PGP SIGNATURE-----

```

---



=== Content from trac.osgeo.org_a668bca8_20250124_122103.html ===


[![](/postgis/chrome/site/trac_logo.png)](http://trac.osgeo.org/postgis/)

Search:

* [Login](/postgis/login)
* [Help/Guide](/postgis/wiki/TracGuide)
* [About Trac](/postgis/about)
* [Preferences](/postgis/prefs)

* [Wiki](/postgis/wiki)
* [Timeline](/postgis/timeline)
* [Roadmap](/postgis/roadmap)
* [Browse Source](/postgis/browser)
* [View Tickets](/postgis/report)
* [Search](/postgis/search)

## Context Navigation

* ← [Previous Changeset](/postgis/changeset/15444 "Changeset 15444")
* [Next Changeset](/postgis/changeset/15446 "Changeset 15446") →

---

# Changeset 15445

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
06/22/17 23:15:04
([8 years](/postgis/timeline?from=2017-06-22T23%3A15%3A04-07%3A00&precision=second "See timeline at 06/22/17 23:15:04") ago)
Author:
robe
Message:

ST\_AsX3D handle empty geometries

Closes [#3704](/postgis/ticket/3704 "#3704: defect: ST_AsX3D returns random data / crashes client (closed: fixed)") for PostGIS 2.3.3

Location:
[branches/2.3](/postgis/browser/branches/2.3?rev=15445)
Files:

4 edited

* [NEWS](/postgis/browser/branches/2.3/NEWS?rev=15445 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))
* [liblwgeom/lwout\_x3d.c](/postgis/browser/branches/2.3/liblwgeom/lwout_x3d.c?rev=15445 "Show entry in browser")
  (modified)
  ([7 diffs](#file1 "Show differences"))
* [regress/tickets.sql](/postgis/browser/branches/2.3/regress/tickets.sql?rev=15445 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [regress/tickets\_expected](/postgis/browser/branches/2.3/regress/tickets_expected?rev=15445 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [branches/2.3/NEWS](/postgis/changeset/15445/branches/2.3/NEWS "Show the changeset 15445 restricted to branches/2.3/NEWS")

  | [r15442](/postgis/browser/branches/2.3/NEWS?rev=15442#L16 "Show revision 15442 of this file in browser") | [r15445](/postgis/browser/branches/2.3/NEWS?rev=15445#L16 "Show revision 15445 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | - #3682, Strange fieldlength in result of pgsql2shp |
  | 17 | 17 | - #3701, Escape double quotes issue in pgsql2shp |
  |  | 18 | - #3704, ST\_AsX3D crashes on empty geometry |
  | 18 | 19 |  |
  | 19 | 20 |  |
* ## [branches/2.3/liblwgeom/lwout\_x3d.c](/postgis/changeset/15445/branches/2.3/liblwgeom/lwout_x3d.c "Show the changeset 15445 restricted to branches/2.3/liblwgeom/lwout_x3d.c")

  | [r14869](/postgis/browser/trunk/liblwgeom/lwout_x3d.c?rev=14869#L62 "Show revision 14869 of this file in browser") | [r15445](/postgis/browser/branches/2.3/liblwgeom/lwout_x3d.c?rev=15445#L62 "Show revision 15445 of this file in browser") |  |
  | --- | --- | --- |
  | 62 | 62 | int type = geom->type; |
  | 63 | 63 |  |
  |  | 64 | /\* Empty string for empties \*/ |
  |  | 65 | if( lwgeom\_is\_empty(geom) ) |
  |  | 66 | { |
  |  | 67 | char \*ret = NULL; |
  |  | 68 | ret = lwalloc(1); |
  |  | 69 | ret[0] = '\0'; |
  |  | 70 | return ret; |
  |  | 71 | } |
  |  | 72 |  |
  | 64 | 73 | switch (type) |
  | 65 | 74 | { |
  | […](/postgis/browser/trunk/liblwgeom/lwout_x3d.c?rev=14869#L157) | […](/postgis/browser/branches/2.3/liblwgeom/lwout_x3d.c?rev=15445#L166) |  |
  | 157 | 166 |  |
  | 158 | 167 | size = pointArray\_X3Dsize(line->points, precision)\*2; |
  | 159 |  |  |
  |  | 168 |  |
  | 160 | 169 | if ( X3D\_USE\_GEOCOORDS(opts) ) { |
  | 161 | 170 | size += ( |
  | […](/postgis/browser/trunk/liblwgeom/lwout_x3d.c?rev=14869#L395) | […](/postgis/browser/branches/2.3/liblwgeom/lwout_x3d.c?rev=15445#L404) |  |
  | 395 | 404 | else |
  | 396 | 405 | size = sizeof("<PointSet><Coordinate point='' /></PointSet>") + defidlen; |
  | 397 |  |  |
  |  | 406 |  |
  | 398 | 407 |  |
  | 399 | 408 | /\* if ( srs ) size += strlen(srs) + sizeof(" srsName=.."); \*/ |
  | […](/postgis/browser/trunk/liblwgeom/lwout_x3d.c?rev=14869#L526) | […](/postgis/browser/branches/2.3/liblwgeom/lwout_x3d.c?rev=15445#L535) |  |
  | 526 | 535 | if ( X3D\_USE\_GEOCOORDS(opts) ) size = sizeof("<IndexedFaceSet convex='false' coordIndex=''><GeoCoordinate geoSystem='\"GD\" \"WE\" \"longitude\_first\"' point='' />") + defidlen; |
  | 527 | 536 | else size = sizeof("<IndexedFaceSet convex='false' coordIndex=''><Coordinate point='' />") + defidlen; |
  | 528 |  |  |
  |  | 537 |  |
  | 529 | 538 |  |
  | 530 | 539 | for (i=0; i<psur->ngeoms; i++) |
  | […](/postgis/browser/trunk/liblwgeom/lwout_x3d.c?rev=14869#L659) | […](/postgis/browser/branches/2.3/liblwgeom/lwout_x3d.c?rev=15445#L668) |  |
  | 659 | 668 | if ( X3D\_USE\_GEOCOORDS(opts) ) ptr += sprintf(ptr, "'><GeoCoordinate geoSystem='\"GD\" \"WE\" \"%s\"' point='", ( (opts & LW\_X3D\_FLIP\_XY) ? "latitude\_first" : "longitude\_first") ); |
  | 660 | 669 | else ptr += sprintf(ptr, "'><Coordinate point='"); |
  | 661 |  |  |
  |  | 670 |  |
  | 662 | 671 | for (i=0; i<tin->ngeoms; i++) |
  | 663 | 672 | { |
  | […](/postgis/browser/trunk/liblwgeom/lwout_x3d.c?rev=14869#L782) | […](/postgis/browser/branches/2.3/liblwgeom/lwout_x3d.c?rev=15445#L791) |  |
  | 782 | 791 | { |
  | 783 | 792 | ptr += asx3d3\_tin\_buf((LWTIN\*)subgeom, srs, ptr, precision, opts,  defid); |
  | 784 |  |  |
  |  | 793 |  |
  | 785 | 794 | } |
  | 786 | 795 | else if ( subgeom->type == POLYHEDRALSURFACETYPE ) |
  | 787 | 796 | { |
  | 788 | 797 | ptr += asx3d3\_psurface\_buf((LWPSURFACE\*)subgeom, srs, ptr, precision, opts,  defid); |
  | 789 |  |  |
  |  | 798 |  |
  | 790 | 799 | } |
  | 791 | 800 | else if ( lwgeom\_is\_collection(subgeom) ) |
  | […](/postgis/browser/trunk/liblwgeom/lwout_x3d.c?rev=14869#L863) | […](/postgis/browser/branches/2.3/liblwgeom/lwout_x3d.c?rev=15445#L872) |  |
  | 863 | 872 | if ( i ) |
  | 864 | 873 | ptr += sprintf(ptr, " "); |
  | 865 |  |  |
  |  | 874 |  |
  | 866 | 875 | if ( ( opts & LW\_X3D\_FLIP\_XY) ) |
  | 867 | 876 | ptr += sprintf(ptr, "%s %s", y, x); |
* ## [branches/2.3/regress/tickets.sql](/postgis/changeset/15445/branches/2.3/regress/tickets.sql "Show the changeset 15445 restricted to branches/2.3/regress/tickets.sql")

  | [r15138](/postgis/browser/trunk/regress/tickets.sql?rev=15138#L1013 "Show revision 15138 of this file in browser") | [r15445](/postgis/browser/branches/2.3/regress/tickets.sql?rev=15445#L1013 "Show revision 15445 of this file in browser") |  |
  | --- | --- | --- |
  | 1013 | 1013 | SELECT '#3627b', ST\_Equals(geom, ST\_LineFromEncodedPolyline(ST\_AsEncodedPolyline(geom, 7), 7)) FROM (VALUES ('SRID=4326;LINESTRING (0 0, 1 1)')) AS v (geom); |
  | 1014 | 1014 |  |
  |  | 1015 | -- #3704 |
  |  | 1016 | SELECT '#3704', ST\_AsX3D('LINESTRING EMPTY') = ''; |
  |  | 1017 |  |
  | 1015 | 1018 | -- Clean up |
  | 1016 | 1019 | DELETE FROM spatial\_ref\_sys; |
* ## [branches/2.3/regress/tickets\_expected](/postgis/changeset/15445/branches/2.3/regress/tickets_expected "Show the changeset 15445 restricted to branches/2.3/regress/tickets_expected")

  | [r15138](/postgis/browser/trunk/regress/tickets_expected?rev=15138#L302 "Show revision 15138 of this file in browser") | [r15445](/postgis/browser/branches/2.3/regress/tickets_expected?rev=15445#L302 "Show revision 15445 of this file in browser") |  |
  | --- | --- | --- |
  | 302 | 302 | #3627a|o}~~|AdshNoSsBgd@eGoBlm@wKhj@~@? |
  | 303 | 303 | #3627b|t |
  |  | 304 | #3704|t |
**Note:**
See [TracChangeset](/postgis/wiki/TracChangeset)
for help on using the changeset viewer.

### Download in other formats:

* [Unified Diff](?format=diff&new=15445)
* [Zip Archive](?format=zip&new=15445)

---

[![Trac Powered](https://trac.osgeo.org/common-assets/trac_logo_mini.png)](https://trac.edgewall.org/)

Powered by [**Trac 1.6**](/postgis/about)

By [Edgewall Software](http://www.edgewall.org/)
.

Visit the Trac open source project at
<http://trac.edgewall.org/>



=== Content from lists.debian.org_c9956e8d_20250124_122102.html ===


---

[[Date Prev](msg00019.html)][[Date Next](msg00021.html)]
[[Thread Prev](msg00019.html)][[Thread Next](msg00021.html)]
[[Date Index](maillist.html#00020)]
[[Thread Index](threads.html#00020)]

# [SECURITY] [DLA 2857-1] postgis security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 2857-1] postgis security update
* *From*: Adrian Bunk <bunk@debian.org>
* *Date*: Tue, 28 Dec 2021 00:05:38 +0200
* *Message-id*: <[[🔎]](/msgid-search/20211227220538.GA3798%40localhost) [20211227220538.GA3798@localhost](msg00020.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian LTS Advisory DLA-2857-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                          Adrian Bunk
December 28, 2021                             <https://wiki.debian.org/LTS>
- -------------------------------------------------------------------------

Package        : postgis
Version        : 2.3.1+dfsg-2+deb9u1
CVE ID         : CVE-2017-18359

In PostGIS, which adds support for geographic objects to the PostgreSQL
database, denial of service via crafted ST_AsX3D function input was
fixed.

For Debian 9 stretch, this problem has been fixed in version
2.3.1+dfsg-2+deb9u1.

We recommend that you upgrade your postgis packages.

For the detailed security status of postgis please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/postgis>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCgAdFiEEOvp1f6xuoR0v9F3wiNJCh6LYmLEFAmHKOLIACgkQiNJCh6LY
mLGyFQ/9Hn/I6qKpYOawYcBOTyypvRvXfQbqBvfTqReteexTNcQIsfWYUiIVK2nD
Dl7N4v2pbARUb83C/q7uR0AcRj43QMTEUPJBhPTianvcTqFt5QYNhLRqNm9n2LVw
VYDU5z9r8pDV+8T7jI7NrSBBfnXBcWWl2ApTUCCWWeyqfh1Zh46JiZSFiFUtlvhr
gjC8WmEriBt8pD/nCGvt/XjE6k5KO6aKxY/Wnr+kisy9ACWep8HJXGFDorN/br/R
LIMn/yTbpInDLOb2uvYJrsZ/fuLbegxq4h93ZhzW7j+w4Ktx9Ct7LqH+DTPscwG4
USFsWHW1xyrwn1TXsnJTH5FjrR63ow0d9mclzT7aop4h4qzj7rklOTtUS5t3b4kC
aI2DrPM1vsabeNER2M2AlGvivy9i+60XbANZTswYAYppyxGjfHqfW3UABupTOW2Q
zsaf619/UG1hu1XTP6lZSxQuhr+l4RrrwKeZdj0PDEWn5q9+QhGpttoScZ4vE2sa
NtsQfkDHAIe2ePJMPQaNeMQDnehLEdboMVH0i8D5kpv9gHB2CGvDzSgeOAhxlVoX
KEB9dTaFqhtpI6BzHY1PDnxBerhjMpFgkkI3RcOYbXdlf+ghxxyjOYzg4RJM5f0T
Dql9VYQ/bdN6hY81YV9HMUzrOSOAK7BrJDzdZfRp6ZeR6yIn3as=
=8wL9
-----END PGP SIGNATURE-----

```

---



=== Content from trac.osgeo.org_ab97b764_20250124_122104.html ===


[![](/postgis/chrome/site/trac_logo.png)](http://trac.osgeo.org/postgis/)

Search:

* [Login](/postgis/login)
* [Help/Guide](/postgis/wiki/TracGuide)
* [About Trac](/postgis/about)
* [Preferences](/postgis/prefs)

* [Wiki](/postgis/wiki)
* [Timeline](/postgis/timeline)
* [Roadmap](/postgis/roadmap)
* [Browse Source](/postgis/browser)
* [View Tickets](/postgis/report)
* [Search](/postgis/search)

## Context Navigation

* ← [Previous Ticket](/postgis/ticket/3703 "Ticket #3703")
* [Next Ticket](/postgis/ticket/3705 "Ticket #3705") →

---

Opened [8 years ago](/postgis/timeline?from=2017-02-09T20%3A35%3A11-08%3A00&precision=second "See timeline at 02/09/17 20:35:11")

Closed [8 years ago](/postgis/timeline?from=2017-06-22T23%3A15%3A05-07%3A00&precision=second "See timeline at 06/22/17 23:15:05")

Last modified [8 years ago](/postgis/timeline?from=2017-06-23T21%3A02%3A27-07%3A00&precision=second "See timeline at 06/23/17 21:02:27")

## [#3704](/postgis/ticket/3704) [closed](/postgis/query?status=closed) [defect](/postgis/query?status=!closed&type=defect) ([fixed](/postgis/query?resolution=fixed&status=closed))

# ST\_AsX3D returns random data / crashes client

| Reported by: | [mwtoews](/postgis/query?reporter=mwtoews&status=!closed) | Owned by: | [robe](/postgis/query?owner=robe&status=!closed) |
| --- | --- | --- | --- |
| Priority: | [critical](/postgis/query?priority=critical&status=!closed) | Milestone: | [PostGIS 2.3.3](/postgis/milestone/PostGIS%202.3.3 "Completed 8 years ago (07/01/17 15:38:55)") |
| Component: | [postgis](/postgis/query?component=postgis&status=!closed) | Version: | [2.3.x](/postgis/query?status=!closed&version=2.3.x "Released 09/26/16 22:09:36") |
| Keywords: |  | Cc: |  |

## Description

Testing ST\_AsX3D on various geometries gives varied and interesting results with PostGIS 2.3 on Windows. I think these are critical bugs, because they return random data or crash the client.

`SELECT ST_AsX3D('POINT EMPTY');`has unexpected behavior, often returning a zero-length string, or random junk like `@` or `2.3.dll`, but sometimes raising:
> ERROR: invalid byte sequence for encoding "UTF8": 0xec 0xa3

`SELECT ST_AsX3D('LINESTRING EMPTY');`kills the client:
> server closed the connection unexpectedly
>
> > This probably means the server terminated abnormally
> > before or while processing the request.
>
> The connection to the server was lost. Attempting reset: Failed.
> !>

Non-critical bugs with other geometry types will be filed in the next bug report…

Oldest first

Newest first

Threaded

Show comments

Show property changes

### Change History (5)

### [comment:1](#comment:1) by robe, [8 years ago](/postgis/timeline?from=2017-02-11T21%3A54%3A36-08%3A00&precision=second "See timeline at 02/11/17 21:54:36")

| Owner: | changed from pramsey to robe |
| --- | --- |

### [comment:2](#comment:2) by robe, [8 years ago](/postgis/timeline?from=2017-06-06T07%3A30%3A48-07%3A00&precision=second "See timeline at 06/06/17 07:30:48")

ah indeed. More concerning is why my garden test didn't pick this up as this would be one that should have been tested.

### [comment:3](#comment:3) by robe, [8 years ago](/postgis/timeline?from=2017-06-22T23%3A01%3A00-07%3A00&precision=second "See timeline at 06/22/17 23:01:00")

In [15444](/postgis/changeset/15444 "ST_AsX3D handle empty geometries
References #3704 for PostGIS 2.4 (trunk)"):

ST\_AsX3D handle empty geometries

References [#3704](/postgis/ticket/3704 "#3704: defect: ST_AsX3D returns random data / crashes client (closed: fixed)") for PostGIS 2.4 (trunk)

### [comment:4](#comment:4) by robe, [8 years ago](/postgis/timeline?from=2017-06-22T23%3A15%3A05-07%3A00&precision=second "See timeline at 06/22/17 23:15:05")

| Resolution: | → fixed |
| --- | --- |
| Status: | new → closed |

In [15445](/postgis/changeset/15445 "ST_AsX3D handle empty geometries
Closes #3704 for PostGIS 2.3.3"):

ST\_AsX3D handle empty geometries

Closes [#3704](/postgis/ticket/3704 "#3704: defect: ST_AsX3D returns random data / crashes client (closed: fixed)") for PostGIS 2.3.3

### [comment:5](#comment:5) by robe, [8 years ago](/postgis/timeline?from=2017-06-23T21%3A02%3A27-07%3A00&precision=second "See timeline at 06/23/17 21:02:27")

okay figured out why garden test didn't pick this up.
It was testing this:

```
SELECT ST_AsX3D(foo1.the_geom, 3, 5)  As result
							FROM ((SELECT ST_GeomFromText('POINT EMPTY',4326) As the_geom
			UNION ALL SELECT ST_GeomFromText('MULTIPOINT EMPTY',4326) As the_geom
			UNION ALL SELECT ST_GeomFromText('MULTIPOLYGON EMPTY',4326) As the_geom
			UNION ALL SELECT ST_GeomFromText('LINESTRING EMPTY',4326) As the_geom
			UNION ALL SELECT ST_GeomFromText('MULTILINESTRING EMPTY',4326) As the_geom ) ) As foo1 LIMIT 3;

```

Which because of the limit never got to testing LINESTRING EMPTY. Guess I got to increase the limit on this so covers the number of empties.

**Note:**
See [TracTickets](/postgis/wiki/TracTickets)
for help on using tickets.

### Download in other formats:

* [RSS Feed](/postgis/ticket/3704?format=rss)
* [Comma-delimited Text](/postgis/ticket/3704?format=csv)
* [Tab-delimited Text](/postgis/ticket/3704?format=tab)

---

[![Trac Powered](https://trac.osgeo.org/common-assets/trac_logo_mini.png)](https://trac.edgewall.org/)

Powered by [**Trac 1.6**](/postgis/about)

By [Edgewall Software](http://www.edgewall.org/)
.

Visit the Trac open source project at
<http://trac.edgewall.org/>



=== Content from trac.osgeo.org_0114daba_20250124_122103.html ===


[![](/postgis/chrome/site/trac_logo.png)](http://trac.osgeo.org/postgis/)

Search:

* [Login](/postgis/login)
* [Help/Guide](/postgis/wiki/TracGuide)
* [About Trac](/postgis/about)
* [Preferences](/postgis/prefs)

* [Wiki](/postgis/wiki)
* [Timeline](/postgis/timeline)
* [Roadmap](/postgis/roadmap)
* [Browse Source](/postgis/browser)
* [View Tickets](/postgis/report)
* [Search](/postgis/search)

## Context Navigation

* ← [Previous Changeset](/postgis/changeset/15443 "Changeset 15443")
* [Next Changeset](/postgis/changeset/15445 "Changeset 15445") →

---

# Changeset 15444

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
06/22/17 23:00:59
([8 years](/postgis/timeline?from=2017-06-22T23%3A00%3A59-07%3A00&precision=second "See timeline at 06/22/17 23:00:59") ago)
Author:
robe
Message:

ST\_AsX3D handle empty geometries

References [#3704](/postgis/ticket/3704 "#3704: defect: ST_AsX3D returns random data / crashes client (closed: fixed)") for PostGIS 2.4 (trunk)

Location:
[trunk](/postgis/browser/trunk?rev=15444)
Files:

3 edited

* [liblwgeom/lwout\_x3d.c](/postgis/browser/trunk/liblwgeom/lwout_x3d.c?rev=15444 "Show entry in browser")
  (modified)
  ([7 diffs](#file0 "Show differences"))
* [regress/tickets.sql](/postgis/browser/trunk/regress/tickets.sql?rev=15444 "Show entry in browser")
  (modified)
  ([3 diffs](#file1 "Show differences"))
* [regress/tickets\_expected](/postgis/browser/trunk/regress/tickets_expected?rev=15444 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [trunk/liblwgeom/lwout\_x3d.c](/postgis/changeset/15444/trunk/liblwgeom/lwout_x3d.c "Show the changeset 15444 restricted to trunk/liblwgeom/lwout_x3d.c")

  | [r14869](/postgis/browser/trunk/liblwgeom/lwout_x3d.c?rev=14869#L62 "Show revision 14869 of this file in browser") | [r15444](/postgis/browser/trunk/liblwgeom/lwout_x3d.c?rev=15444#L62 "Show revision 15444 of this file in browser") |  |
  | --- | --- | --- |
  | 62 | 62 | int type = geom->type; |
  | 63 | 63 |  |
  |  | 64 | /\* Empty string for empties \*/ |
  |  | 65 | if( lwgeom\_is\_empty(geom) ) |
  |  | 66 | { |
  |  | 67 | char \*ret = NULL; |
  |  | 68 | ret = lwalloc(1); |
  |  | 69 | ret[0] = '\0'; |
  |  | 70 | return ret; |
  |  | 71 | } |
  |  | 72 |  |
  | 64 | 73 | switch (type) |
  | 65 | 74 | { |
  | […](/postgis/browser/trunk/liblwgeom/lwout_x3d.c?rev=14869#L157) | […](/postgis/browser/trunk/liblwgeom/lwout_x3d.c?rev=15444#L166) |  |
  | 157 | 166 |  |
  | 158 | 167 | size = pointArray\_X3Dsize(line->points, precision)\*2; |
  | 159 |  |  |
  |  | 168 |  |
  | 160 | 169 | if ( X3D\_USE\_GEOCOORDS(opts) ) { |
  | 161 | 170 | size += ( |
  | […](/postgis/browser/trunk/liblwgeom/lwout_x3d.c?rev=14869#L395) | […](/postgis/browser/trunk/liblwgeom/lwout_x3d.c?rev=15444#L404) |  |
  | 395 | 404 | else |
  | 396 | 405 | size = sizeof("<PointSet><Coordinate point='' /></PointSet>") + defidlen; |
  | 397 |  |  |
  |  | 406 |  |
  | 398 | 407 |  |
  | 399 | 408 | /\* if ( srs ) size += strlen(srs) + sizeof(" srsName=.."); \*/ |
  | […](/postgis/browser/trunk/liblwgeom/lwout_x3d.c?rev=14869#L526) | […](/postgis/browser/trunk/liblwgeom/lwout_x3d.c?rev=15444#L535) |  |
  | 526 | 535 | if ( X3D\_USE\_GEOCOORDS(opts) ) size = sizeof("<IndexedFaceSet convex='false' coordIndex=''><GeoCoordinate geoSystem='\"GD\" \"WE\" \"longitude\_first\"' point='' />") + defidlen; |
  | 527 | 536 | else size = sizeof("<IndexedFaceSet convex='false' coordIndex=''><Coordinate point='' />") + defidlen; |
  | 528 |  |  |
  |  | 537 |  |
  | 529 | 538 |  |
  | 530 | 539 | for (i=0; i<psur->ngeoms; i++) |
  | […](/postgis/browser/trunk/liblwgeom/lwout_x3d.c?rev=14869#L659) | […](/postgis/browser/trunk/liblwgeom/lwout_x3d.c?rev=15444#L668) |  |
  | 659 | 668 | if ( X3D\_USE\_GEOCOORDS(opts) ) ptr += sprintf(ptr, "'><GeoCoordinate geoSystem='\"GD\" \"WE\" \"%s\"' point='", ( (opts & LW\_X3D\_FLIP\_XY) ? "latitude\_first" : "longitude\_first") ); |
  | 660 | 669 | else ptr += sprintf(ptr, "'><Coordinate point='"); |
  | 661 |  |  |
  |  | 670 |  |
  | 662 | 671 | for (i=0; i<tin->ngeoms; i++) |
  | 663 | 672 | { |
  | […](/postgis/browser/trunk/liblwgeom/lwout_x3d.c?rev=14869#L782) | […](/postgis/browser/trunk/liblwgeom/lwout_x3d.c?rev=15444#L791) |  |
  | 782 | 791 | { |
  | 783 | 792 | ptr += asx3d3\_tin\_buf((LWTIN\*)subgeom, srs, ptr, precision, opts,  defid); |
  | 784 |  |  |
  |  | 793 |  |
  | 785 | 794 | } |
  | 786 | 795 | else if ( subgeom->type == POLYHEDRALSURFACETYPE ) |
  | 787 | 796 | { |
  | 788 | 797 | ptr += asx3d3\_psurface\_buf((LWPSURFACE\*)subgeom, srs, ptr, precision, opts,  defid); |
  | 789 |  |  |
  |  | 798 |  |
  | 790 | 799 | } |
  | 791 | 800 | else if ( lwgeom\_is\_collection(subgeom) ) |
  | […](/postgis/browser/trunk/liblwgeom/lwout_x3d.c?rev=14869#L863) | […](/postgis/browser/trunk/liblwgeom/lwout_x3d.c?rev=15444#L872) |  |
  | 863 | 872 | if ( i ) |
  | 864 | 873 | ptr += sprintf(ptr, " "); |
  | 865 |  |  |
  |  | 874 |  |
  | 866 | 875 | if ( ( opts & LW\_X3D\_FLIP\_XY) ) |
  | 867 | 876 | ptr += sprintf(ptr, "%s %s", y, x); |
* ## [trunk/regress/tickets.sql](/postgis/changeset/15444/trunk/regress/tickets.sql "Show the changeset 15444 restricted to trunk/regress/tickets.sql")

  | [r15138](/postgis/browser/trunk/regress/tickets.sql?rev=15138#L28 "Show revision 15138 of this file in browser") | [r15444](/postgis/browser/trunk/regress/tickets.sql?rev=15444#L28 "Show revision 15444 of this file in browser") |  |
  | --- | --- | --- |
  | 28 | 28 | FROM (SELECT '01020000000200000050E8303FC2E85141B017CFC05A825541000000E0C0E85141000000205C825541'::geometry AS g) a, |
  | 29 | 29 | (SELECT 'LINESTRING(4694792.35840419 5638508.89950758,4694793.20840419 5638506.34950758)'::geometry AS g) b; |
  | 30 |  |  |
  |  | 30 |  |
  | 31 | 31 | -- #21 -- |
  | 32 | 32 | SELECT '#21', ST\_AsEWKT(ST\_Locate\_Along\_Measure(g, 4566)) FROM |
  | […](/postgis/browser/trunk/regress/tickets.sql?rev=15138#L206) | […](/postgis/browser/trunk/regress/tickets.sql?rev=15444#L206) |  |
  | 206 | 206 | ST\_Covers(geometry(geography(poly.the\_geom)), |
  | 207 | 207 | geometry(geography(pt.the\_geom))) As gm\_to\_gg\_gm\_pca |
  | 208 |  |  |
  |  | 208 |  |
  | 209 | 209 | FROM (SELECT ST\_GeomFromEWKT('SRID=4326;POLYGON((-119.5434 34.9438,-119.5437 34.9445,-119.5452 34.9442,-119.5434 34.9438))') As the\_geom) |
  | 210 | 210 | As poly |
  | […](/postgis/browser/trunk/regress/tickets.sql?rev=15138#L1013) | […](/postgis/browser/trunk/regress/tickets.sql?rev=15444#L1013) |  |
  | 1013 | 1013 | SELECT '#3627b', ST\_Equals(geom, ST\_LineFromEncodedPolyline(ST\_AsEncodedPolyline(geom, 7), 7)) FROM (VALUES ('SRID=4326;LINESTRING (0 0, 1 1)')) AS v (geom); |
  | 1014 | 1014 |  |
  |  | 1015 | -- #3704 |
  |  | 1016 | SELECT '#3704', ST\_AsX3D('LINESTRING EMPTY') = ''; |
  |  | 1017 |  |
  | 1015 | 1018 | -- Clean up |
  | 1016 | 1019 | DELETE FROM spatial\_ref\_sys; |
* ## [trunk/regress/tickets\_expected](/postgis/changeset/15444/trunk/regress/tickets_expected "Show the changeset 15444 restricted to trunk/regress/tickets_expected")

  | [r15138](/postgis/browser/trunk/regress/tickets_expected?rev=15138#L302 "Show revision 15138 of this file in browser") | [r15444](/postgis/browser/trunk/regress/tickets_expected?rev=15444#L302 "Show revision 15444 of this file in browser") |  |
  | --- | --- | --- |
  | 302 | 302 | #3627a|o}~~|AdshNoSsBgd@eGoBlm@wKhj@~@? |
  | 303 | 303 | #3627b|t |
  |  | 304 | #3704|t |
**Note:**
See [TracChangeset](/postgis/wiki/TracChangeset)
for help on using the changeset viewer.

### Download in other formats:

* [Unified Diff](?format=diff&new=15444)
* [Zip Archive](?format=zip&new=15444)

---

[![Trac Powered](https://trac.osgeo.org/common-assets/trac_logo_mini.png)](https://trac.edgewall.org/)

Powered by [**Trac 1.6**](/postgis/about)

By [Edgewall Software](http://www.edgewall.org/)
.

Visit the Trac open source project at
<http://trac.edgewall.org/>



=== Content from wiki.debian.org_8d48714b_20250126_010512.html ===

[![Debian](https://www.debian.org/Pics/openlogo-50.png)](https://www.debian.org "Debian Homepage")

[Wiki](/FrontPage "Debian Wiki Homepage")

[Login](/LTS?action=login)

* [FrontPage](/FrontPage)
* [RecentChanges](/RecentChanges)
* [FindPage](/FindPage)
* [HelpContents](/HelpContents)
* [LTS](/LTS)

Search:

[![Debian](https://www.debian.org/Pics/openlogo-50.png)](https://www.debian.org "Debian Homepage")
[Wiki](/FrontPage "Debian Wiki Homepage")/

* [Login](/LTS?action=login)
* Comments
* [Info](/LTS?action=info)
* [Attachments](/LTS?action=AttachFile)
* More Actions:
  Raw Text
  Print View
  Render as Docbook
  Delete Cache
  ------------------------
  Check Spelling
  Like Pages
  Local Site Map
  ------------------------
  Rename Page
  Delete Page
  ------------------------
  Subscribe User
  ------------------------
  Remove Spam
  Revert to this revision
  Package Pages
  ------------------------
  Load
  Save
  SlideShow

# * [LTS](/LTS)

[Translation(s)](/DebianWiki/EditorGuide#translation): [English](/LTS) - [Deutsch](/de/LTS) - [Español](/es/LTS) - [Français](/fr/LTS) - [Italiano](/it/LTS) - [한국어](/ko/LTS) - [Português](/pt/LTS) - [Português (Brasil)](/pt_BR/LTS) - [Русский](/ru/LTS)

# Debian Long Term Support

Debian Long Term Support (LTS) is a project to extend the lifetime of all Debian stable releases to (at least) 5 years. Debian LTS is not handled by the Debian Security and Release teams, but by a separate group of volunteers and companies interested in making it a success.

Thus the Debian LTS team takes over security maintenance of the various releases once the Debian Security team stops its work.

![/!\](/htdocs/debwiki/img/alert.png "/!\")

LTS ([last modified 2024-08-15 02:46:47](/LTS?action=info))

* Debian [privacy policy](https://www.debian.org/legal/privacy), Wiki [team](/Teams/DebianWiki), [bugs](https://bugs.debian.org/wiki.debian.org) and [config](https://salsa.debian.org/debian/wiki.debian.org).
* Powered by [MoinMoin](https://moinmo.in/ "This site uses the MoinMoin Wiki software.") and [Python](https://moinmo.in/Python "MoinMoin is written in Python."), with hosting provided by [Metropolitan Area Network Darmstadt](https://www.man-da.de/).


