=== Content from www.directadmin.com_e37e10b0_20250125_165323.html ===

[![Directadmin Docs](/img/da-symbol.svg)Directadmin Docs](/) [Forums open in new window](https://forum.directadmin.com) [Versions open in new window](https://www.directadmin.com/versions.php) [Contact Us open in new window](https://tickets.directadmin.com)SectionsSections

* [Changelog](/changelog/version-1.673.html)
* [CustomBuild 2.0](/custombuild/custombuild-overview.html)
* [Developer](/developer/api/)
* [DirectAdmin](/directadmin/backup-restore-migration/backups.html)
* [Getting Started](/getting-started/first-steps/overview.html)
* [Operation system level](/operation-system-level/os-general/general.html)
* [Other hosting services](/other-hosting-services/dns/general.html)
* [Web Servers](/webservices/apache/general.html)
 [Forums open in new window](https://forum.directadmin.com) [Versions open in new window](https://www.directadmin.com/versions.php) [Contact Us open in new window](https://tickets.directadmin.com)SectionsSections

* [Changelog](/changelog/version-1.673.html)
* [CustomBuild 2.0](/custombuild/custombuild-overview.html)
* [Developer](/developer/api/)
* [DirectAdmin](/directadmin/backup-restore-migration/backups.html)
* [Getting Started](/getting-started/first-steps/overview.html)
* [Operation system level](/operation-system-level/os-general/general.html)
* [Other hosting services](/other-hosting-services/dns/general.html)
* [Web Servers](/webservices/apache/general.html)

* [Version 1.674](/changelog/version-1.674.html)
* [Version 1.673](/changelog/version-1.673.html)
* [Version 1.672](/changelog/version-1.672.html)
* [Version 1.671](/changelog/version-1.671.html)
* [Version 1.670](/changelog/version-1.670.html)
* [Version 1.669](/changelog/version-1.669.html)
* [Version 1.668](/changelog/version-1.668.html)
* [Version 1.667](/changelog/version-1.667.html)
* [Version 1.666](/changelog/version-1.666.html)
* [Version 1.665](/changelog/version-1.665.html)
* [Version 1.664](/changelog/version-1.664.html)
* [Version 1.663](/changelog/version-1.663.html)
* [Version 1.662](/changelog/version-1.662.html)
* [Version 1.661](/changelog/version-1.661.html)
* [Version 1.660](/changelog/version-1.660.html)
* [Version 1.659](/changelog/version-1.659.html)
* [Version 1.658](/changelog/version-1.658.html)
* [Version 1.657](/changelog/version-1.657.html)
* [Version 1.656](/changelog/version-1.656.html)
* [Version 1.655](/changelog/version-1.655.html)
* [Version 1.654](/changelog/version-1.654.html)
* [Version 1.653](/changelog/version-1.653.html)
* [Version 1.652](/changelog/version-1.652.html)
* [Version 1.651](/changelog/version-1.651.html)
* [Version 1.650](/changelog/version-1.650.html)
* [Version 1.649](/changelog/version-1.649.html)
* [Version 1.648](/changelog/version-1.648.html)
* [Version 1.647](/changelog/version-1.647.html)
* [Version 1.646](/changelog/version-1.646.html)
* [Version 1.645](/changelog/version-1.645.html)
* [Version 1.644](/changelog/version-1.644.html)
* [Version 1.643](/changelog/version-1.643.html)
* [Version 1.642](/changelog/version-1.642.html)
* [Version 1.641](/changelog/version-1.641.html)
* [Version 1.640](/changelog/version-1.640.html)
* [Version 1.63.9](/changelog/version-1.63.9.html)
* [Version 1.63.8](/changelog/version-1.63.8.html)
* [Version 1.63.7](/changelog/version-1.63.7.html)
* [Version 1.63.6](/changelog/version-1.63.6.html)
* [Version 1.63.5](/changelog/version-1.63.5.html)
* [Version 1.63.4](/changelog/version-1.63.4.html)
* [Version 1.63.3](/changelog/version-1.63.3.html)
* [Version 1.63.2](/changelog/version-1.63.2.html)
* [Version 1.63.1](/changelog/version-1.63.1.html)
* [Version 1.63.0](/changelog/version-1.63.0.html)
* [Version 1.62.9](/changelog/version-1.62.9.html)
* [Version 1.62.8](/changelog/version-1.62.8.html)
* [Version 1.62.7](/changelog/version-1.62.7.html)
* [Version 1.62.6](/changelog/version-1.62.6.html)
* [Version 1.62.5](/changelog/version-1.62.5.html)
* [Version 1.62.4](/changelog/version-1.62.4.html)
* [Version 1.62.3](/changelog/version-1.62.3.html)
* [Version 1.62.2](/changelog/version-1.62.2.html)
* [Version 1.62.1](/changelog/version-1.62.1.html)
* [Version 1.62.0](/changelog/version-1.62.0.html)
* [Version 1.61.5](/changelog/version-1.61.5.html)
* [Version 1.61.4](/changelog/version-1.61.4.html)
* [Version 1.61.3](/changelog/version-1.61.3.html)
* [Version 1.61.2](/changelog/version-1.61.2.html)
* [Version 1.61.1](/changelog/version-1.61.1.html)
* [Version 1.61.0](/changelog/version-1.61.0.html)
* [Version 1.60.4](/changelog/version-1.60.4.html)
* [Version 1.60.3](/changelog/version-1.60.3.html)
* [Version 1.60.2](/changelog/version-1.60.2.html)
* [Version 1.60.1](/changelog/version-1.60.1.html)
* [Version 1.60.0](/changelog/version-1.60.0.html)
* [Version 1.59.5](/changelog/version-1.59.5.html)
* [Version 1.59.4](/changelog/version-1.59.4.html)
* [Version 1.59.3](/changelog/version-1.59.3.html)
* [Version 1.59.2](/changelog/version-1.59.2.html)
* [Version 1.59.1](/changelog/version-1.59.1.html)
* [Version 1.59.0](/changelog/version-1.59.0.html)
* [Version 1.58.2](/changelog/version-1.58.2.html)
* [Version 1.58.0](/changelog/version-1.58.0.html)
* [Version 1.58.1](/changelog/version-1.58.1.html)
* [Version 1.57.5](/changelog/version-1.57.5.html)
* [Version 1.57.4](/changelog/version-1.57.4.html)
* [Version 1.57.3](/changelog/version-1.57.3.html)
* [Version 1.57.2](/changelog/version-1.57.2.html)
* [Version 1.57.1](/changelog/version-1.57.1.html)
* [Version 1.57.0](/changelog/version-1.57.0.html)
* [Version 1.56.4](/changelog/version-1.56.4.html)
* [Version 1.56.3](/changelog/version-1.56.3.html)
* [Version 1.56.2](/changelog/version-1.56.2.html)
* [Version 1.56.1](/changelog/version-1.56.1.html)
* [Version 1.56.0](/changelog/version-1.56.0.html)
* [Version 1.55.0](/changelog/version-1.55.0.html)
* [Version 1.54.1](/changelog/version-1.54.1.html)
* [Version 1.54.0](/changelog/version-1.54.0.html)
* [Version 1.53.3](/changelog/version-1.53.3.html)
* [Version 1.53.4](/changelog/version-1.53.4.html)
* [Version 1.53.2](/changelog/version-1.53.2.html)
* [Version 1.53.1](/changelog/version-1.53.1.html)
* [Version 1.53.0](/changelog/version-1.53.0.html)
* [Version 1.52.1](/changelog/version-1.52.1.html)
* [Version 1.52.0](/changelog/version-1.52.0.html)
* [Version 1.51.4](/changelog/version-1.51.4.html)
* [Version 1.51.3](/changelog/version-1.51.3.html)
* [Version 1.51.2](/changelog/version-1.51.2.html)
* [Version 1.51.1](/changelog/version-1.51.1.html)
* [Version 1.51.0](/changelog/version-1.51.0.html)
* [Version 1.50.1](/changelog/version-1.50.1.html)
* [Version 1.50.0](/changelog/version-1.50.0.html)
* [Version 1.49.1](/changelog/version-1.49.1.html)
* [Version 1.49.0](/changelog/version-1.49.0.html)
* [Version 1.48.3](/changelog/version-1.48.3.html)
* [Version 1.48.2](/changelog/version-1.48.2.html)
* [Version 1.48.1](/changelog/version-1.48.1.html)
* [Version 1.48.0](/changelog/version-1.48.0.html)
* [Version 1.47.0](/changelog/version-1.47.0.html)
* [Version 1.46.3](/changelog/version-1.46.3.html)
* [Version 1.46.2](/changelog/version-1.46.2.html)
* [Version 1.46.1](/changelog/version-1.46.1.html)
* [Version 1.46.0](/changelog/version-1.46.0.html)
* [Version 1.45.4](/changelog/version-1.45.4.html)
* [Version 1.45.3](/changelog/version-1.45.3.html)
* [Version 1.45.2](/changelog/version-1.45.2.html)
* [Version 1.45.1](/changelog/version-1.45.1.html)
* [Version 1.45.0](/changelog/version-1.45.0.html)
* [Version 1.44.2](/changelog/version-1.44.2.html)
* [Version 1.44.3](/changelog/version-1.44.3.html)
* [Version 1.44.1](/changelog/version-1.44.1.html)
* [Version 1.44.0](/changelog/version-1.44.0.html)
* [Version 1.43.2](/changelog/version-1.43.2.html)
* [Version 1.43.3](/changelog/version-1.43.3.html)
* [Version 1.43.1](/changelog/version-1.43.1.html)
* [Version 1.43.0](/changelog/version-1.43.0.html)
* [Version 1.42.1](/changelog/version-1.42.1.html)
* [Version 1.42.0](/changelog/version-1.42.0.html)
* [Version 1.41.1](/changelog/version-1.41.1.html)
* [Version 1.41.0](/changelog/version-1.41.0.html)
* [Version 1.40.2](/changelog/version-1.40.2.html)
* [Version 1.40.3](/changelog/version-1.40.3.html)
* [Version 1.40.1](/changelog/version-1.40.1.html)
* [Version 1.40.0](/changelog/version-1.40.0.html)
* [Version 1.39.3](/changelog/version-1.39.3.html)
* [Version 1.39.2](/changelog/version-1.39.2.html)
* [Version 1.39.1](/changelog/version-1.39.1.html)
* [Version 1.39.0](/changelog/version-1.39.0.html)
* [Version 1.38.4](/changelog/version-1.38.4.html)
* [Version 1.38.3](/changelog/version-1.38.3.html)
* [Version 1.38.2](/changelog/version-1.38.2.html)
* [Version 1.38.1](/changelog/version-1.38.1.html)
* [Version 1.38.0](/changelog/version-1.38.0.html)
* [Version 1.37.0](/changelog/version-1.37.0.html)
* [Version 1.36.2](/changelog/version-1.36.2.html)
* [Version 1.36.1](/changelog/version-1.36.1.html)
* [Version 1.36.0](/changelog/version-1.36.0.html)
* [Version 1.35.1](/changelog/version-1.35.1.html)
* [Version 1.35.0](/changelog/version-1.35.0.html)
* [Version 1.34.5](/changelog/version-1.34.5.html)
* [Version 1.34.4](/changelog/version-1.34.4.html)
* [Version 1.34.3](/changelog/version-1.34.3.html)
* [Version 1.34.2](/changelog/version-1.34.2.html)
* [Version 1.34.1](/changelog/version-1.34.1.html)
* [Version 1.34.0](/changelog/version-1.34.0.html)
* [Version 1.33.7](/changelog/version-1.33.7.html)
* [Version 1.33.6](/changelog/version-1.33.6.html)
* [Version 1.33.5](/changelog/version-1.33.5.html)
* [Version 1.33.4](/changelog/version-1.33.4.html)
* [Version 1.33.3](/changelog/version-1.33.3.html)
* [Version 1.33.2](/changelog/version-1.33.2.html)
* [Version 1.33.1](/changelog/version-1.33.1.html)
* [Version 1.33.0](/changelog/version-1.33.0.html)
* [Version 1.32.3](/changelog/version-1.32.3.html)
* [Version 1.32.2](/changelog/version-1.32.2.html)
* [Version 1.32.1](/changelog/version-1.32.1.html)
* [Version 1.32.0](/changelog/version-1.32.0.html)
* [Version 1.31.5](/changelog/version-1.31.5.html)
* [Version 1.31.4](/changelog/version-1.31.4.html)
* [Version 1.31.3](/changelog/version-1.31.3.html)
* [Version 1.31.2](/changelog/version-1.31.2.html)
* [Version 1.31.1](/changelog/version-1.31.1.html)
* [Version 1.31.0](/changelog/version-1.31.0.html)
* [Version 1.30.2](/changelog/version-1.30.2.html)
* [Version 1.30.0](/changelog/version-1.30.0.html)
* [Version 1.30.1](/changelog/version-1.30.1.html)
* [Version 1.29.7](/changelog/version-1.29.7.html)
* [Version 1.29.6](/changelog/version-1.29.6.html)
* [Version 1.29.5](/changelog/version-1.29.5.html)
* [Version 1.29.4](/changelog/version-1.29.4.html)
* [Version 1.29.3](/changelog/version-1.29.3.html)
* [Version 1.29.2](/changelog/version-1.29.2.html)
* [Version 1.29.1](/changelog/version-1.29.1.html)
* [Version 1.29.0](/changelog/version-1.29.0.html)
* [Version 1.28.6](/changelog/version-1.28.6.html)
* [Version 1.28.5](/changelog/version-1.28.5.html)
* [Version 1.28.2](/changelog/version-1.28.2.html)
* [Version 1.28.1](/changelog/version-1.28.1.html)
* [Version 1.28.0](/changelog/version-1.28.0.html)
* [Version 1.27.5](/changelog/version-1.27.5.html)
* [Version 1.27.4](/changelog/version-1.27.4.html)
* [Version 1.27.3](/changelog/version-1.27.3.html)
* [Version 1.27.2](/changelog/version-1.27.2.html)
* [Version 1.27.1](/changelog/version-1.27.1.html)
* [Version 1.27.0](/changelog/version-1.27.0.html)
* [Version 1.26.6](/changelog/version-1.26.6.html)
* [Version 1.26.5](/changelog/version-1.26.5.html)
* [Version 1.26.4](/changelog/version-1.26.4.html)
* [Version 1.26.3](/changelog/version-1.26.3.html)
* [Version 1.26.2](/changelog/version-1.26.2.html)
* [Version 1.26.1](/changelog/version-1.26.1.html)
* [Version 1.26.0](/changelog/version-1.26.0.html)
* [Version 1.25.5](/changelog/version-1.25.5.html)
* [Version 1.25.3](/changelog/version-1.25.3.html)
* [Version 1.25.4](/changelog/version-1.25.4.html)
* [Version 1.25.2](/changelog/version-1.25.2.html)
* [Version 1.25.1](/changelog/version-1.25.1.html)
* [Version 1.25.0](/changelog/version-1.25.0.html)
* [Version 1.24.4](/changelog/version-1.24.4.html)
* [Version 1.24.3](/changelog/version-1.24.3.html)
* [Version 1.24.2](/changelog/version-1.24.2.html)
* [Version 1.24.1](/changelog/version-1.24.1.html)
* [Version 1.24.0](/changelog/version-1.24.0.html)
* [Version 1.23.5](/changelog/version-1.23.5.html)
* [Version 1.23.4](/changelog/version-1.23.4.html)
* [Version 1.23.3](/changelog/version-1.23.3.html)
* [Version 1.23.2](/changelog/version-1.23.2.html)
* [Version 1.23.1](/changelog/version-1.23.1.html)
* [Version 1.23.0](/changelog/version-1.23.0.html)
* [Version 1.22.6](/changelog/version-1.22.6.html)
* [Version 1.22.5](/changelog/version-1.22.5.html)
* [Version 1.22.4](/changelog/version-1.22.4.html)
* [Version 1.22.3](/changelog/version-1.22.3.html)
* [Version 1.22.2](/changelog/version-1.22.2.html)
* [Version 1.22.1](/changelog/version-1.22.1.html)
* [Version 1.22.0](/changelog/version-1.22.0.html)
* [Version 1.21.3](/changelog/version-1.21.3.html)
* [Version 1.21.2](/changelog/version-1.21.2.html)
* [Version 1.21.1](/changelog/version-1.21.1.html)
* [Version 1.21.0](/changelog/version-1.21.0.html)
* [Version 1.20.7](/changelog/version-1.20.7.html)
* [Version 1.20.6](/changelog/version-1.20.6.html)
* [Version 1.20.5](/changelog/version-1.20.5.html)
* [Version 1.20.4](/changelog/version-1.20.4.html)
* [Version 1.20.3](/changelog/version-1.20.3.html)
* [Version 1.20.2](/changelog/version-1.20.2.html)
* [Version 1.20.1](/changelog/version-1.20.1.html)
* [Version 1.20.0](/changelog/version-1.20.0.html)
* [Version 1.19.6](/changelog/version-1.19.6.html)
* [Version 1.19.5](/changelog/version-1.19.5.html)
* [Version 1.19.4](/changelog/version-1.19.4.html)
* [Version 1.19.3](/changelog/version-1.19.3.html)
* [Version 1.19.2](/changelog/version-1.19.2.html)
* [Version 1.19.1](/changelog/version-1.19.1.html)
* [Version 1.19.0](/changelog/version-1.19.0.html)
* [Version 1.18.1](/changelog/version-1.18.1.html)
* [Version 1.18.0](/changelog/version-1.18.0.html)
* [Version 1.17.4](/changelog/version-1.17.4.html)
* [Version 1.17.3](/changelog/version-1.17.3.html)
* [Version 1.17.1](/changelog/version-1.17.1.html)
* [Version 1.17.2](/changelog/version-1.17.2.html)
* [Version 1.17.0](/changelog/version-1.17.0.html)
* [Version 1.16.1](/changelog/version-1.16.1.html)
* [Version 1.15.2](/changelog/version-1.15.2.html)
* [Version 1.16.0](/changelog/version-1.16.0.html)
* [Version 1.15.0](/changelog/version-1.15.0.html)
* [Version 1.15.1](/changelog/version-1.15.1.html)
* [Version 1.14.0](/changelog/version-1.14.0.html)
* [Version 1.13.0](/changelog/version-1.13.0.html)
* [Version 1.12.1](/changelog/version-1.12.1.html)
* [Version 1.12.0](/changelog/version-1.12.0.html)
* [Version 1.11.1](/changelog/version-1.11.1.html)
* [Version 1.11.0](/changelog/version-1.11.0.html)
* [Version 1.10.0](/changelog/version-1.10.0.html)
* [Version 1.09.0](/changelog/version-1.09.0.html)
* [Version 1.08.0](/changelog/version-1.08.0.html)
* [Version 1.08.1](/changelog/version-1.08.1.html)
* [Version 1.07.0](/changelog/version-1.07.0.html)
* [Version 1.06.0](/changelog/version-1.06.0.html)
* [Version 1.05.0](/changelog/version-1.05.0.html)
* [Version 1.04.0](/changelog/version-1.04.0.html)
* [Version 1.03.0](/changelog/version-1.03.0.html)
* [Version 1.02.0](/changelog/version-1.02.0.html)
* [Version 1.01.0](/changelog/version-1.01.0.html)
* [CustomBuild revisions](/changelog/custombuild.html)

# [#](#version-1-52-0) Version 1.52.0

Released: 2017-10-03

* [http2 new](/changelog/version-1.52.0.html#http2)
* [CMD\_PLUGINS ability to skip user.conf write new](/changelog/version-1.52.0.html#cmd-plugins-ability-to-skip-user-conf-write)
* [Ability to message Users from task.queue new](/changelog/version-1.52.0.html#ability-to-message-users-from-task-queue)
* [json for CMD\_FTP new](/changelog/version-1.52.0.html#json-for-cmd-ftp)
* [Ability to tokenize CSS\_\* files. new](/changelog/version-1.52.0.html#ability-to-tokenize-css-files)
* [Ability to include custom other disk usage for a User (LANG) new](/changelog/version-1.52.0.html#ability-to-include-custom-other-disk-usage-for-a-user-lang)
* [JSON for CMD\_SECURITY\_QUESTIONS new](/changelog/version-1.52.0.html#json-for-cmd-security-questions)
* [brute\_filter.list supports count\_multiplier option new](/changelog/version-1.52.0.html#brute-filter-list-supports-count-multiplier-option)
* [skin.conf 404 override new](/changelog/version-1.52.0.html#skin-conf-404-override)
* [Referer check override files (PLUGINS) new](/changelog/version-1.52.0.html#referer-check-override-files-plugins)
* [ACCESS\_LEVEL token on all CMD\_ pages new](/changelog/version-1.52.0.html#access-level-token-on-all-cmd-pages)
* [CMD\_JSON\_LANG .po files for languages, and locales new](/changelog/version-1.52.0.html#cmd-json-lang-po-files-for-languages-and-locales)
* [JSON for CMD\_LOGOUT and CMD\_LOGIN new](/changelog/version-1.52.0.html#json-for-cmd-logout-and-cmd-login)
* [http2=1 enabled by default for supported OSs new](/changelog/version-1.52.0.html#http2-1-enabled-by-default-for-supported-oss)
* [Custom Package Items skin up to 8 items (SKINS) new](/changelog/version-1.52.0.html#custom-package-items-skin-up-to-8-items-skins)
* [CMD\_CHANGE\_INFO can set temporary language in session new](/changelog/version-1.52.0.html#cmd-change-info-can-set-temporary-language-in-session)
* [Skins can provide their own login.html page or images (SKINS) new](/changelog/version-1.52.0.html#skins-can-provide-their-own-login-html-page-or-images-skins)
* [JSON for CMD\_ALL\_USER\_SHOW, CMD\_RESELLER\_SHOW, and CMD\_ADMIN\_SHOW new](/changelog/version-1.52.0.html#json-for-cmd-all-user-show-cmd-reseller-show-and-cmd-admin-show)
* [JSON for CMD\_EMAIL\_POP new](/changelog/version-1.52.0.html#json-for-cmd-email-pop)
* [session\_destroy\_pre.sh and login\_key in session new](/changelog/version-1.52.0.html#session-destroy-pre-sh-and-login-key-in-session)
* [json for CMD\_USER\_HISTORY & CMD\_BANDWIDTH\_BREAKDOWN new](/changelog/version-1.52.0.html#json-for-cmd-user-history-cmd-bandwidth-breakdown)
* [JSON: large list of added commands new](/changelog/version-1.52.0.html#json-large-list-of-added-commands)
* [Etag and custom cache time new](/changelog/version-1.52.0.html#etag-and-custom-cache-time)
* [mail\_sni for dovecot and exim sni certificates new](/changelog/version-1.52.0.html#mail-sni-for-dovecot-and-exim-sni-certificates)
* [Ability to always load all php-fpm settings into User nginx.conf: nginx\_fpm\_always\_set=1 new](/changelog/version-1.52.0.html#ability-to-always-load-all-php-fpm-settings-into-user-nginx-conf-nginx-fpm-always-set-1)
* [http2 for nginx: new token |SPACE\_HTTP2| (TEMPLATES) new](/changelog/version-1.52.0.html#http2-for-nginx-new-token-space-http2-templates)
* [login\_pre.sh login\_post.sh session\_create\_pre.sh to add $user\_agent header new](/changelog/version-1.52.0.html#login-pre-sh-login-post-sh-session-create-pre-sh-to-add-user-agent-header)
* [private\_html to public\_html link by default (DEFAULT CHANGE) new](/changelog/version-1.52.0.html#private-html-to-public-html-link-by-default-default-change)
* [option: spam\_inbox\_prefix\_name=INBOX.spam new](/changelog/version-1.52.0.html#option-spam-inbox-prefix-name-inbox-spam)
* [UserDir for nginx in shared IPs (TEMPLATES) new](/changelog/version-1.52.0.html#userdir-for-nginx-in-shared-ips-templates)
* [https for redirect domain pointers (TEMPLATES) new](/changelog/version-1.52.0.html#https-for-redirect-domain-pointers-templates)
* [Ability to change pm.max\_children in php-fpm.conf (TEMPLATE) new](/changelog/version-1.52.0.html#ability-to-change-pm-max-children-in-php-fpm-conf-template)
* [Fill checkboxes in LetsEncrypt based on existing certificate new](/changelog/version-1.52.0.html#fill-checkboxes-in-letsencrypt-based-on-existing-certificate)
* [named-checkzone to be more strict with -k fail new](/changelog/version-1.52.0.html#named-checkzone-to-be-more-strict-with-k-fail)
* [plugin\_max\_hooks to allow more plugins new](/changelog/version-1.52.0.html#plugin-max-hooks-to-allow-more-plugins)
* [Ability to disable forwarder pipes new](/changelog/version-1.52.0.html#ability-to-disable-forwarder-pipes)
* [Periodically check to ensure versions.txt is being updated new](/changelog/version-1.52.0.html#periodically-check-to-ensure-versions-txt-is-being-updated)
* [MySQL 5.7.6+ dropped mysql.user password column fixed](/changelog/version-1.52.0.html#mysql-5-7-6-dropped-mysql-user-password-column)
* [Backup dns: don't remove sole record if it's a linked IP fixed](/changelog/version-1.52.0.html#backup-dns-don-t-remove-sole-record-if-it-s-a-linked-ip)
* [More plugin hooks (SKINS) fixed](/changelog/version-1.52.0.html#more-plugin-hooks-skins)
* [Set language in dataskq for backup/restore messages fixed](/changelog/version-1.52.0.html#set-language-in-dataskq-for-backup-restore-messages)
* [Don't count hard-links multiple times fixed](/changelog/version-1.52.0.html#don-t-count-hard-links-multiple-times)
* [Removing additional IP from User that was in use by a domain causes wrong IP in config fixed](/changelog/version-1.52.0.html#removing-additional-ip-from-user-that-was-in-use-by-a-domain-causes-wrong-ip-in-config)
* [swap gethostbyname with getaddrinfo fixed](/changelog/version-1.52.0.html#swap-gethostbyname-with-getaddrinfo)
* [LetsEncrypt: remove deleted domains/subdomains from san\_config before renewal fixed](/changelog/version-1.52.0.html#letsencrypt-remove-deleted-domains-subdomains-from-san-config-before-renewal)
* [Deleting a User with php-fpm while a php script is running throws error fixed](/changelog/version-1.52.0.html#deleting-a-user-with-php-fpm-while-a-php-script-is-running-throws-error)
* [CMD\_SYSTEM\_INFO not showing nginx for nginx\_proxy fixed](/changelog/version-1.52.0.html#cmd-system-info-not-showing-nginx-for-nginx-proxy)
* [Double mysql\_close call causes segfault fixed](/changelog/version-1.52.0.html#double-mysql-close-call-causes-segfault)
* [FreeBSD: apache\_public\_html not setting apache group fixed](/changelog/version-1.52.0.html#freebsd-apache-public-html-not-setting-apache-group)
* [FileManager Edit: write to temp first fixed](/changelog/version-1.52.0.html#filemanager-edit-write-to-temp-first)
* [Debian 7 cast bug for php-fpm versions fixed](/changelog/version-1.52.0.html#debian-7-cast-bug-for-php-fpm-versions)
* [segfault (SECURITY) CVE-2017-18045 fixed](/changelog/version-1.52.0.html#segfault-security-cve-2017-18045)
## [#](#http2) http2 new

Support for http2 in the templates.

Requires:

```
http2=1

```

in the directadmin.conf.

Uses:

```
|LINKEDIP|

|LINKEDIPSSL|

```

In the custombuild apache/nginx configure templates;

```
configure/nginx/conf/nginx-vhosts.conf:|LINKEDIPSSL|
configure/nginx_reverse/conf/nginx-vhosts.conf:|LINKEDIPSSL|
configure/ap2/conf/extra/httpd-vhosts.conf:<VirtualHost |IP|:|PORT_443||LINKEDIPSSL|>

```

---

Note, CustomBuild 2.0 rev 1600+ can setup http2 for you for Apache, but it doesn't install openssl with ALPN for you.

This is related:

http://forum.directadmin.com/posts/269958

So with CB2 now, you'd do:

1. Add a non-standard instance of apache/nghttp2 to use:

```
wget ftp://ftp.openssl.org/source/openssl-1.0.2k.tar.gz
tar xzf openssl-1.0.2k.tar.gz
cd openssl-1.0.2k
./config --prefix=/usr/local/lib_http2 no-ssl2 no-ssl3 zlib-dynamic -fPIC
make depend
make install

```

DO NOT USE 1.0.2h or newer, as they've dropped older SSL functions that apache 2.4.26 does not know about .. so you'll get compile errors if you use anything newer thatn 1.0.2k.

2. Set:

```
http2=1

```

in the directadmin.conf, eg:

https://help.directadmin.com/item.php?id=641&in1=http2&in2=1

3. Let CB2 do the rest:

```
cd /usr/local/directadmin/custombuild
./build update
./build nghttp2
./build apache
./build rewrite_confs

```

---

For Chrome, you'd need the SPDY extension to access HTTP/2 sites.

## [#](#cmd-plugins-ability-to-skip-user-conf-write) CMD\_PLUGINS ability to skip user.conf write new

A plugin may need to make an API call to change a user.conf setting for the current User.

This is a race condition, since the CMD\_PLUGINS call to that plugin, follows up with a check on the user.conf timestamp (and related files),

and if DA notices the timestamp changed, it will decide to overwrite it and log something like:

2017:06:11-01:05:53: ConfigFile::writeFile(./data/users/fred/user.conf) : Timestamp from when it was read is different, overwriting anyway

The solution is to tell DA not to write to disk when you know you'll need to be doing that.

To accomplish this, pass a GET request:

```
user_conf_write=no

```

eg:

```
http://1.2.3.4:2222/CMD_PLUGINS/hello_world?user_conf_write=no
http://1.2.3.4:2222/CMD_PLUGINS/hello_world/index.html?user_conf_write=no

```

and this will stop the user.conf write for that call to CMD\_PLUGINS.

You'll then be able to make an API call within the plugin code, to alter the user.conf, without racing to write first.

## [#](#ability-to-message-users-from-task-queue) Ability to message Users from task.queue new

Related to this guide:

[Ability to script/send your own custom notifications to the Admin Message System](/changelog/version-1.50.0.html#ability-to-script-send-your-own-custom-notifications-to-the-admin-message-system)

you can now message a specific account, list of accounts, or all accounts (Admins+Resellers+Users) with the task.queue

Format is as follows:

```
action=notify
value=users
users=all|select1=fred&select2=george&select5=gary
subject=Your Subject
message=Content of your Message

```

where the "users" variable can be "all", meaning DA will message all accounts on the server,

or can be a list of accounts, url encoded with select1, select2,

For a single account, just use:

```
users=select1=gary

```

Note.. the = and & characters in the users list must be url encoded with hex (%3D and %26, respectively)

Also, if you want to include a newline in the message, use %0A instead.

A sample echo command is:

echo 'action=notify&value=users&subject=Hello World&message=Hello,%0A%0A This is a message.&users=select1%3Dadmin%26select2%3Dgary' >> /usr/local/directadmin/data/task.queue

## [#](#json-for-cmd-ftp) json for CMD\_FTP new

Support for json on all CMD\_FTP commands:

* CMD\_FTP
* CMD\_FTP\_SETTINGS
* CMD\_FTP\_SHOW

The json output uses the API functionality, so use the above commands, but use the CMD\_API versions of those commands for info on how to use them:

[Api for ftp : CMD\_API\_FTP](/changelog/version-1.21.3.html#api-for-ftp-cmd-api-ftp)

## [#](#ability-to-tokenize-css-files) Ability to tokenize CSS\_\* files. new

By default CSS\_ files are sent as raw file for quickest performance.

This change allows you to add this get request, eg:

```
CSS_STYLE?v=|VERSION|&tokenize_css=yes

```

where adding tokenize=yes to the CSS will force DA to tokenize it with all global tokens.

You can also set variables, and do standard if-then-else structures, etc, like like HTM requests.

This change was added for the custom color feature, so a signle token can be set anywhere in the skin and CSS files.

[CMD\_SKINS custom skin colors json/api (SKINS)(LANG)](/changelog/version-1.63.3.html#cmd-skins-custom-skin-colors-json-api-skins-lang)

## [#](#ability-to-include-custom-other-disk-usage-for-a-user-lang) Ability to include custom other disk usage for a User (LANG) new

If you have data that should be counted in the total disk usage for a User, but does not fall under the standard usage areas (eg: data on a remote server),

then you can use this option to create a hook, which lets you add extra bytes into the disk usage under "Other Usage"

Set the following in the directadmin.conf:

```
count_other_disk_usage=1

```

and create a script:

/usr/local/directadmin/scripts/custom/other\_disk\_usage.sh

the script must exit with code 0.

If a non-zero code is exited, the output is logged to the errortaskq.log.

The output on exit 0 must be a URL encoded.. and for now, it will basically just be:

other\_quota=12345

where 12345 bytes will be added to the user.usage file.

In the future, we might add more, like

```
other_quota=12345&something_else=56789

```

but for now, it's just "other\_quota".

The value must be a positive integer.

---

ENVIRONMENTAL VALUES PASSED TO SCRIPT

username=fred

type=user|reseller|admin

runs as root.

## [#](#json-for-cmd-security-questions) JSON for CMD\_SECURITY\_QUESTIONS new

If you call CMD\_SECURITY\_QUESTIONS with GET option:

json=yes

you'll get the output in json.

See the contents of enhanced/user/security\_questions.html for the usage of the tokens.

=========================

num\_questions=22

---

Most variables should all be self-explanatory, but the "num\_questions=22" will be confusing by design.

The security\_questions.txt file starts at 1, but index 1 must contain the last index number.

By at the time of this writing, it's:

1=22

where the last entry is 22, eg:

22=What is the name of a college you applied to but didn't attend?

Also, because 1 is taken, the first question starts at index 2.

The json variable "questions" is standard table output, with the json[questions][info] showing info on columns, sorting, etc.

When posting data, just like the API methods, include json=yes (GET or POST) and the dynamic output should be json-ified.

##### [#](#security-questions-disabled) SECURITY\_QUESTIONS\_DISABLED

this value will be set to:

```
SECURITY_QUESTIONS_DISABLED=disabled

```

if the number of questions is 0.

If this is set, then the checkboxes for:

* security\_questions

should be disabled, because you cannot turn on the feature, with 0 questions available for DA to ask the client.

## [#](#brute-filter-list-supports-count-multiplier-option) brute\_filter.list supports count\_multiplier option new

A new option has been added to the lines in the file:

/usr/local/directadmin/data/templates/brute\_filter.list

specifically for the wordpress3 entry, eg:

wordpress3=ip\_after=&ip\_until= -&text=] "POST /&text2=/wp-login.php&text3=" 302%20&count\_multiplier=4

What this does, is after all log parsing is done, the Brute Force Monitor will count how many entries were triggered for that item (eg: wordpress3) for that given IP.

Say there were 20 triggers. The multiplier means that instead of having a limit of 100, that item needs 400.

The actual logic in DA is actually backwards, as the total count uses other items, so we actually divide the number of wordpress3 counts by 4.

So instead of 20 hits, the count only see 5 towards the total.

This also means that is there are only 3 hits, then 3/4 = 0, so no count would be triggered for that IP.

The entries will still show up in the log list, but count for that given IP (top table) would be lower.

The whole purpose for this is that the entry:

```
POST /wp-login.php HTTP/1.1" 302

```

could represent an attack, but could also just be a normal redirection.

So we do want to count it, but it should be of lower significance.

---

SKIN:

There are no html changes required.

However, we have changed the |LOGINFAILURES| table token value.

The wordpress3 attempts, which are usually 1, will now be displayed as a float / multiplier.

So for this case, each wordpress3 attempt count will show 0.25.

There is also a title= hover-over popup to provide info about what that's about.

## [#](#skin-conf-404-override) skin.conf 404 override new

You can now add a new variable, eg:

```
404_override=user/404.html

```

to the skin.conf file.

This setting allows you to control the output of the 404 pages by instead, sending a specific page, with the data set in the desired file (eg: user/404.html, can be changed).

This file is tokenized similar to an HTM\_ file.

Note, the FileManager is chrooted, so if you trigger a 404 for a file that does not exist, you'll still get the old format because the 404\_override file is loaded after the chroot has already happened.

---

Also new optional file in the skin document root:

routes.conf

which will list valid paths that will return 200 instead of 404 for the 404\_override file.

Intended purpose is for vue-router / JS framework to redirect things like:

domain.com:222/app/ftp/create

to valid places via JS using the 404\_override file.

The same file is sent regardless of the routes.conf list, but the list simply controls if it's a http 200 or 404 response code.

The routes.conf supports wildcards, similar to the shell (cannot cross / character)

So:

/app/test/\*

will mach:

/app/test/bob

but will not match:

/app/test/ftp/bob

## [#](#referer-check-override-files-plugins) Referer check override files (PLUGINS) new

New optional file can be created:

/usr/local/directadmin/data/templates/custom/referer\_check.allow

or per-plugin:

/usr/local/directadmin/plugins/PLUGINNAME/referer\_check.allow

where the referer\_check.allow files can contain a list of URLs, eg:

http://somehost.com

https://otherhost.com

https://otherhost.com:8080

etc..which will be used as a backup list of allowed referers, in addition to the host value set in the session file.

This is used for cases where a remote site needs to use the current User's session file, via a form on that remote site.

As this is bypassing a security step, be sure you fully trust the list of referers added to your lists.

As you may have noticed, you can either manage your own global list,

but each plugin can also have it's own list as well, in case the plugin needs to make a call out, then back in again.

## [#](#access-level-token-on-all-cmd-pages) ACCESS\_LEVEL token on all CMD\_ pages new

A new global token:

```
ACCESS_LEVEL=admin|reseller|user

```

is available on all CMD\_ pages.

The values is based on which class list of functions it's allowed in.

HTM\_, CSS\_ files, etc.. will not get this token, but could be figured out by coding into the given skin.

eg, if you know the user/passwd.html is a User page, you'd just add:

```
|?ACCESS_LEVEL=user|

```

to the top of the user/passwd.html file.

## [#](#cmd-json-lang-po-files-for-languages-and-locales) ~~CMD\_JSON\_LANG .po files for languages, and locales~~ new

Extension for the CMD\_JSON\_LANG tool:

1. If no options are returns, a json output will show something like:

```
{
    "default":
    {
        "id": "en"
    },
    "languages":
    {
        "en": "English",
        "fr": "FranÃÂ§ais",
    }
}

```

depending on the languages available for this skin (we only include "en" by default)

The "en" can be any valid language, and the rules have been related to allow proper locale naming, like en\_US. Each value for that local on the right will be in that native language, not English. So for fr, it will show FranÃÂ§ais, and not "French".

The actual locales.po file should exist the skins document root, eg:

/usr/local/directadmin/data/skins/SKINNAME/locales.po

If if it doesn't exist, DA will fall-back to use the "internal\_lang" directadmin.conf, variable, but access the po file using the .. method eg:

/usr/local/directadmin/data/skins/enhanced/lang/../locales.po

allowing the fallback to be used, even if the client has some other skin set, for the event where the other skin does not have locales.po file.

TODO: Fill with all languages/locales.

2. WIth a lang value, eg:

CMD\_JSON\_LANG?lang=en

it will dump json for the given .po file.

A language po file can exist either at:

/usr/local/directadmin/data/skins/SKINNAME/lang/LANG/lang.po

where "lang.po" is the literal filename for the current LANG...

OR

/usr/local/directadmin/data/skins/SKINNAME/lang/LANG.po

where LANG.po could be any valid lower-case language or local name (instead of a directory), eg:

/usr/local/directadmin/data/skins/SKINNAME/lang/fr.po

3. With everything:

CMD\_JSON\_LANG?default\_data=yes

will include the array from #1, but will also have:

default[data]

containtaining the entire json array for the whole defautl language po file, eg:

```
{
    "default":
    {
        "data":
        {
            #whole json output for "en" becaue id=en.
        }
        "id": "en"
    },
    "languages":
    {
        "en": "English",
        "fr": "FranÃÂ§ais",
    }
}

```

Removed in [DirectAdmin 1.673](/changelog/version-1.673.html#removed-cmd-json-lang-endpoint).

## [#](#json-for-cmd-logout-and-cmd-login) JSON for CMD\_LOGOUT and CMD\_LOGIN new

If you include GET:

json=yes

you'll get json output.

CMD\_LOGOUT?json=yes

returns:

```
{
    "result": "success",
    "success": "logout"
}

```

if you were "logged in as" the User, and end up as the creator, you'll get:

```
{
    "current_user": "admin",
    "result": "success",
    "success": "creator_logout"
}

```

where "admin" is the creator.

If a LOGOUT\_URL was specified at login time, a value:

"LOGOUT\_URL":"http://logout.com",

will also be present at logout.

##### [#](#cmd-login) CMD\_LOGIN:

POST:

json=yes

note that is is a POST, not a GET for the login. GET will not be seen.

During login, if json=yes is included with the POST, you'll get output like:

```
{
    "json": "yes",
    "referer": "/",
    "success": "yes",
    "username": "admin"
}

```

If FAIL\_URL was specfiied at login time, you'll get it in the output, eg

"FAIL\_URL": "http://failure.com",

"LOGOUT\_URL": "http://logout.com",

the LOGOUT\_URL will also be shown if passed, but not likely you'll be using it.

## [#](#http2-1-enabled-by-default-for-supported-oss) http2=1 enabled by default for supported OSs new

Debian 9 has ALPN compiled into openssl by default.

DirectAdmin will use an #ifdef to control the default state of the http2= setting in internal directadmin.conf settings.

The actual directadmin.conf will still override it.

So the short version of this is, Debian 9 will have http2 enabled by default.

CustomBuild 2 will read the DA setting and adjust the httpd.conf accordingly.

Note that mod\_php won't work, since http2 won't support prefork anymore.. so we may set Debian 9 to use php-fpm by default.

http://www.apache.org/dist/httpd/CHANGES\_2.4.27

## [#](#custom-package-items-skin-up-to-8-items-skins) Custom Package Items skin up to 8 items (SKINS) new

The internal custom package item limit is 99.

However, the skins only had a set number of tokens filled in, previously 5.

This change increases that to 8 in the enhanced skin.

```
admin/
    create_customized_reseller.html
    modify_reseller.html
    show_reseller_package.html
reseller/
    create_customized_user.html
    modify_user.html
    show_user_package.html

```
## [#](#cmd-change-info-can-set-temporary-language-in-session) CMD\_CHANGE\_INFO can set temporary language in session new

Relating to the usual way User would change their language:

[CMD\_API\_CHANGE\_INFO](/changelog/version-1.28.1.html#cmd-api-change-info)

this adds an extra option:

```
session=yes

```

such that it will save the language into the session file instead of the user.conf.

Then any future pages loaded, the language set in the session file will override the user.conf language.

This is useful if you have multiple people using different languages, logged into the same account at the same time.

POST:

```
CMD_CHANGE_INFO
language=<any text>
lvalue=en
session=yes

```

This will also affect the global |USERLANG| token.

## [#](#skins-can-provide-their-own-login-html-page-or-images-skins) Skins can provide their own login.html page or images (SKINS) new

If a skin creates the file:

login.html

in it's top level directory, eg:

/usr/local/directadmin/data/skins/enhanced/login.html

then whatever skin is set in the directadmin.conf for:

docsroot=./data/skins/enhanced

will be search for that login.html, and used if it exists.

The priority order is:

1. /usr/local/directadmin/data/templates/custom/login.html
2. /usr/local/directadmin/data/templates/login.html
3. ${docsroot}/login.html
4. internal login page

======

Similarly, you can now create your own skin's "login\_images" path, eg:

/usr/local/directadmin/data/skins/enhanced/login\_images/logo.png

## [#](#json-for-cmd-all-user-show-cmd-reseller-show-and-cmd-admin-show) JSON for CMD\_ALL\_USER\_SHOW, CMD\_RESELLER\_SHOW, and CMD\_ADMIN\_SHOW new

JSON support has been added for the commands:

```
CMD_ALL_USER_SHOW
CMD_USER_SHOW
CMD_RESELLER_SHOW
CMD_ADMIN_SHOW

```

where you simply add the GET request (not POST)

json=yes

and JSON is output.

The format for all 3 is similar, the existing table tokens are simply converted into json, so that we can maintain the searching, sorting and filtering features of the table class.

Like other json table output, the format is a list of numbers, representing the row index displayed.

Also an index called "info" is shown, to give info about the table:

```
"info":
{
    "columns":
    {
        "username": "1",
        "creator": "2",
        "bandwidth": "3",
        "quota": "4",
        "vdomains": "5",
        "suspended": "6",
        "ip": "7",
        "domains": "8",
        "sent_emails": "9"
    },
    "current_page": "2",
    "ipp": "50",
    "rows": "69",
    "total_pages": "2"
},

```

which is the "info" index for the CMD\_ALL\_USER\_SHOW table.

The other 2 (Reseller and Admin lists) look like:

```
"info":
{
    "columns":
    {
        "username": "1",
        "bandwidth": "2",
        "quota": "3",
        "nusers": "4",
        "vdomains": "5",
        "suspended": "6"
    },
    "current_page": "1",
    "ipp": "50",
    "rows": "5",
    "total_pages": "1"
},

```

where the "columns" sub-index represents the values shown in the table rows.

=================================

A sample CMD\_ALL\_USER\_SHOW row would be:

```
"3":
{
    "username": "admin:not_user",
    "creator": "root",
    "bandwidth": "2.76 / unlimited",
    "quota": "18839.4 / unlimited",
    "vdomains": "6 / unlimited",
    "suspended": "no:",
    "ip": "1.2.3.4:1.2.3.5:",
    "domains": "domain.com:pointer_domain.com=pointer.com|pointer2.com|:domain2.com:pointer_domain2.com=domain2-alias.com|:domain3.com:",
    "sent_emails": "2:1"
},

```

where:

* the username will contain the username, followed by a colon. After that, if it's a user, it will show "user". If it's not a user (admin or reseller), it will show not\_user.

This is used to link to CMD\_SHOW\_USER or CMD\_SHOW\_RESELLER (even admin's go to their Reseller info page)

* vdomains is the number of domains on the account, followed by a space, forward slash, space, then the limited (number in meg, or unlimited)
* the suspend item is similar, where after the colon will be the suspended reason, if set. Can be blank. Example: "yes:inactive", where the reason is from the "reasons" list (see below)
* ip list is colon separated.
* domains are also colon separated BUT any domain that starts with "pointer\_" is a list of domain pointers, for the domain name contained in the string after pointer\_. The pointer list starts after the = character, and is pipe | separated.
* sent\_emails contains the total number of sent emails this month, and after the colon, it's the number sent today. Sometimes there will be no colon or trailing value, eg, "0"

The method is also adds an exrtra index, the other 2 don't have:

add\_leave\_dns

will be set to yes or no, to let you know if the "Leave Dns" checkbox should be shown (is controlled by the Multi-Server Setup clustering being turned on)

=================================

CMD\_USER\_SHOW

is very close to CMD\_ALL\_USER\_SHOW, but without some of the columns:

```
"0":
{
    "username": "testuser",
    "bandwidth": "0.0000 / unlimited",
    "quota": "11.0 / unlimited",
    "vdomains": "1 / unlimited",
    "suspended": "no:",
    "ip": "1.2.3.4:",
    "domains": "domain.com:"
},

```

it also does not have the "add\_leave\_dns" index, as it's not relevant for Resellers.

=================================

A sample CMD\_ADMIN\_SHOW or CMD\_RESELLER\_SHOW would be:

```
"0":
{
    "username": "admin",
    "bandwidth": "1.0217 / unlimited",
    "quota": "19391 / unlimited",
    "nusers": "45",
    "vdomains": "67 / unlimited",
    "suspended": "no:"
},

```

where the info is pretty much the same, but:

* username does not need to be colon split, it's only the username, since the list is exactly the type you requested.
* nusers is the number of User accounts created under this Admin or Reseller

=============

Reasons:

all 3 methods will also get a "reasons" index for the selectbox shown at the bottom of the GUI tables.

```
"reasons":
{
    "0":
    {
        "selected ": "yes",
        "text": "-- Reason:",
        "value": "none"
    },
    "1":
    {
        "text": "Abuse",
        "value": "abuse"
    },

```

etc..

Where the "text" will be from the data/templates/suspension\_reason.txt file, so may not be correctly translated (.po lookup?)

## [#](#json-for-cmd-email-pop) JSON for CMD\_EMAIL\_POP new

This change allows the ability to use CMD\_EMAIL\_POP?domain=domain.com&json=yes to get JSON output.

The output will vary quite a bit depending on several conditions, so be sure to test all conditions, as each DA box might give different output.

Top level variables:

"count\_pop\_usage": set to 1 if enabled: [option to disable quota counting for pop accounts page](/changelog/version-1.27.0.html#option-to-disable-quota-counting-for-pop-accounts-page)

"EMAIL\_MESSAGE": this will usually be an empty string "" but if it isn't, it should be a general info string, shown to the User, eg:

"Until the cache is created, the values may not be correct. Refresh the page in 1 minute."

"pop\_disk\_usage\_cache": set to 1 if enabled: [email disk usage cache to speed up the pop page](/changelog/version-1.27.0.html#email-disk-usage-cache-to-speed-up-the-pop-page)

"pop\_disk\_usage\_true\_bytes": set to 1 if enabled: [Email Disk Usage opion to show true bytes rather than block usage](/changelog/version-1.48.0.html#email-disk-usage-opion-to-show-true-bytes-rather-than-block-usage)

If enabled, then you'll need to show apparent\_usage instead of usage (see below)

"user\_can\_set\_email\_limit": set to 1 if enabled: [Per-Email send limit (SKINS)](/changelog/version-1.42.0.html#per-email-send-limit-skins)

"block\_cracking\_unblock": set to 0, 1 or 2, depending on: [BlockCracking notices and unblocking (TEMPLATES) (SKINS)](/changelog/version-1.47.0.html#blockcracking-notices-and-unblocking-templates-skins)

"hide\_outlook": usually 0, but if 1, don't show the outlook column with a url like:

CMD\_EMAIL\_REG/${domain}/${usernmae}/${login}/outlook\_admin.reg

"purge\_select": select box data for the account purge tool.

"when\_select": "select box data for the "when" portion of the purge (eg: all or messages older than x days, etc..)

"emails": main data for all email account, including system account. This returns a "table" version of the json, so has the standard "info" sub-array giving info about rows, column names, etc..

Because it's a standard table, you can search, sort and filter, like a normal table.

===========

A sample row from emails might look like:

```
"4":
{
    "account": "user@domain.com",
    "login": "user@domain.com",
    "usage":
    {
        "apparent_usage": "12.023",
        "imap_bytes": "25047040",
        "quota": "30",
        "usage": "23.886",
        "webmail_bytes": "0.000000"
    },
    "sent":
    {
        "send_limit": "42",
        "sent": "1"
    },
    "suspended": "no:blockcracking:change_pass"
},

```

where this data can vary a lot depending on the values of the global settings above.

"login": this is straightforward, but will be just "user" for the syseem account.

"usage": This is dependant on "count\_pop\_usage", and if count\_pop\_usage=0, then only "quota" is shown, or nothing at all for system account.

"sent": if user\_can\_set\_email\_limit=0, this will not appear.

"suspended": usually "yes" or "no", but can be "no:blockcracking:change\_pass" or "no:blockcracking:no\_unblock", where it means the account is blocked via BlockCracking. If change\_pass, then you can offer info that it can be unblocked by changing the password for this account, but no\_unblock cannot be unblocked.

unblocking info: [BlockCracking notices and unblocking (TEMPLATES) (SKINS)](/changelog/version-1.47.0.html#blockcracking-notices-and-unblocking-templates-skins)

Manually blocking a User can be done by adding them to /var/spool/exim/blocked\_authenticated\_users in the format:

user@domain.com:1501988529

where the right part is the timestamp when they got blocked.

##### [#](#important) IMPORTANT:

when coding with this json output be sure to test all of the directadmin.conf settings, off/on etc, and scenarios to ensure you're handling all cases.

Different servers will have different settings, thus different output.

## [#](#session-destroy-pre-sh-and-login-key-in-session) session\_destroy\_pre.sh and login\_key in session new

If a session is to be destroyed due to old age, or due to logout, you can now create:

/usr/local/directadmin/scripts/custom/session\_destroy\_pre.sh

which will be called just before the session file at:

/usr/local/directadmin/data/sessions/sess\_XXX is removed.

Environmental values passed will be the entire contents of the session file, plus:

file=/usr/local/directadmin/data/sessions/sess\_XXX #path to the current session file.

Contents of a session file might look like this, but can vary:

```
home_memory=3
host=2.3.4.5
ip=1.2.3.4
key=SEbYTmsYQ7kccy0OhWenhidoEs6POWfqiEO2yHgPMQzyOxM3TAp9rfv5V2UtW7hE
login_key=keyname
passwd=base64encodedpasswd
selected_domain=domain.com
username=admin

```

Also changed, if a Login Key is used to login to DA, the login\_key=keyname is added to the session file.

You can then get info on that login key with path:

```
/usr/local/directadmin/data/users/$username/login_keys/${login_key}/*

```

Note that this does not account for the "login-as" method which might set the username to be:

```
username=admin|fred

```

so be sure to check for that in the $username variable before using it, eg:

REALUSER=`echo "$username" | cut -d\| -f1

In the above example, the login\_key and key pass would be from User "admin" and not "fred".

and use $REALUSER everywhere, instead of $username.

##### [#](#exit-code) EXIT CODE

unlike other pre.sh script, the exit code of your script will not abort the deletion process, as we should never block the removal of a session.

That being said, I still recommend you use exit 0; at the end of your script, in case this policy does change later on.

## [#](#json-for-cmd-user-history-cmd-bandwidth-breakdown) json for CMD\_USER\_HISTORY & CMD\_BANDWIDTH\_BREAKDOWN new

CMD\_USER\_HISTORY?domain=domain.com&json=yes

will now give json output.

Also:

CMD\_BANDWIDTH\_BREAKDOWN?json=yes

OR

CMD\_BANDWIDTH\_BREAKDOWN?year=2017&month=7&json=yes

can be used.

## [#](#json-large-list-of-added-commands) JSON: large list of added commands new

Implementations for more JSON output.

Add json=yes for GET to show info.

---

User Level:

```
CMD_USER_STATS
CMD_USER_HISTORY
CMD_STYSTEM_INFO
CMD_DB
CMD_DB_CREATE
CMD_DB_VIEW
CMD_DB_USER_CREATE
CMD_DB_USER_PRIVS

CMD_EMAIL_FORWARDER
CMD_EMAIL_VACATION_CREATE
CMD_EMAIL_VACATION_MODIFY
CMD_EMAIL_VACATION

CMD_EMAIL_AUTORESPONDER_MODIFY
CMD_EMAIL_AUTORESPONDER_CREATE
CMD_EMAIL_AUTORESPONDER

CMD_EMAIL_FILTER
CMD_EMAIL_LIST
CMD_SPAMASSASSIN
CMD_CHANGE_INFO

CMD_SUBDOMAIN (same as CMD_SHOW_DOMAIN for main list)
CMD_DOMAIN_POINTER
CMD_REDIRECT
CMD_LOGIN_KEYS

CMD_PERL_MODULES
CMD_LOGIN_HISTORY
CMD_HANDLERS
CMD_MIME_TYPES
CMD_SITE_BACKUP
CMD_CRON_JOBS
CMD_PROTECTED_DIRECTORIES

CMD_FILE_MANAGER/path?action=protect&json=yes

```

Other CMD\_FILE\_MANAGER json actions here: [CMD\_FILE\_MANAGER action=json\_dirs action=json\_files action=json\_all](/changelog/version-1.51.0.html#cmd-file-manager-action=json-dirs-action=json-files-action=json-all)

---

CMD\_EMAIL\_USAGE?domain=domain.com&which=both&json=yes

Be sure to check for "sending\_php\_scripts" and:

```
"block_cracking_paths": "yes",
"block_cracking_paths_table":

```

which only show up if many sends have taken place, hitting some limit.

---

Reseller Level:

```
CMD_RESELLER_STATS
CMD_RESELLER_HISTORY
CMD_IP_CONFIG
CMD_NAME_SERVER
CMD_SHOW_USER
CMD_COMMENTS
CMD_SHOW_USER_PACKAGE
CMD_ACCOUNT_USER
CMD_EDIT_USER_MESSAGE
CMD_RESEND_EMAIL
CMD_MODIFY_USER
CMD_MANAGE_USER_PACKAGES

```

---

Admin Level:

```
CMD_SHOW_SERVICES
CMD_SERVICE
CMD_SHOW_RESELLER
CMD_ACCOUNT_ADMIN
CMD_ACCOUNT_RESELLER
CMD_EDIT_ADMIN_MESSAGE
CMD_EDIT_RESELLER_MESSAGE
CMD_MAIL_QUEUE
CMD_ADMIN_STATS
CMD_ADMIN_HISTORY
CMD_MODIFY_RESELLER
CMD_SHOW_RESELLER_PACKAGE
CMD_MANAGE_RESELLER_PACKAGES
CMD_ADMIN_BACKUP

```
## [#](#etag-and-custom-cache-time) Etag and custom cache time new

Previously, static static files, images, css files, js, files, etc... all used a default cache time of 65536. (18 hours)

Now, DA supports Etags, so the browser can ask DA if any file has changed, and DA will respond accordingly if it has or has not.

Also, those static files will still have a default cache time, but is now lowered to be 3600 seconds (1 hour) AND you can change this value in the directadmin.conf.

The internal default is:

```
cache_time=3600

```

so override that if you want it to last longer/shorter, which can be handy if you're developing a new skin, and don't want to hard refresh everything all the time.

## [#](#mail-sni-for-dovecot-and-exim-sni-certificates) mail\_sni for dovecot and exim sni certificates new

This will replace both dovecot\_sni and exim\_sni, even though the functionality is roughly the same.

The dovecot\_sni and exim\_sni options will be deprecated from the directadmin.conf, and replaced with a single option:

mail\_sni=0

which is the internal default.

To enable it, set:

```
mail_sni=1

```

and any certificate that is saved, either by pasting it through the SSL page, or created/renewed via LetsEncrypt, will trigger a write.

The /etc/virtual/snidomains file should already be setup and used as the "valid cert index", and will be used to setup the dovecot domain sni config.

Can also set:

mail\_sni=OFF

in the domain.com.conf to override domains that should not have it enabled.

Related: [Ability to shut off dovecot\_sni per-domain in the domains/domain.com.conf](/changelog/version-1.51.4.html#ability-to-shut-off-dovecot-sni-per-domain-in-the-domains-domain-com-conf)

When a signed cert and cacert are found, the domain.com.cert.combined file is created (similar to with nginx), and then all records in the cert are added to:

/etc/virtual/snidomains - for exim to use as a lookup - if a subdomain exists in some other domain, but is also in this cert, the last one added has priority (would be a newer, valid cert anyway)

/etc/dovecot/conf/sni/domain.com.conf - with each record in there, pointing to the correct cert.

##### [#](#requirements) REQUIREMENTS

1. OpenSSL and exim supporting SNI, usually CentOS 6 and higher.
2. Recent dovecot and ./build dovecot\_conf, for support of:

/etc/dovecot/conf.d/95-sni.conf

/etc/dovecot/conf/sni/\*

3. CustomBuild 2.0 to install the exim and dovecot configs.
4. secure\_access\_group=access should be enabled in the directadmin.conf, so that the certificates are chmod to 640 with group "access", so "mail" (within the access group) can read them.

##### [#](#install) INSTALL

```
cd /usr/local/directadmin
echo mail_sni=1 >> conf/directadmin.conf
service directadmin restart
cd custombuild
./build update
./build set eximconf yes
./build set eximconf_release 4.5
./build set dovecot_conf yes
./build exim_conf
./build dovecot_conf

```
##### [#](#important-1) IMPORTANT:

DirectAdmin will only accept valid signed certificates. If you use a self-signed certificate, or your own domain does not exist in the certificate, then DA will refuse to accept it, and won't add the values to:

/etc/virtual/snidomains

and will not create the dovecot sni file at:

/etc/dovecot/conf/sni/domain.com.conf

If you rename your domain to domain2.com, for example, the old values are removed from snidomains, and conf/sni/domain.com, and are only re-added if the above checks are still true.

Currently a certificate is only considered signed using the quick check where the Issuer and Subject values in the certificate must be different.

If you have a signed certificate which DA isn't accepting, please let us know, and include the certificate and ca bundle/chain so that we can check it out.

##### [#](#task-queue) TASK QUEUE

To generate snidomains file:

```
echo "action=rewrite&value=snidomains" >> /usr/local/directadmin/data/task.queue

```

If you want to tell all live SSL domains to have their dovecot configs written, type;

echo "action=rewrite&value=mail\_sni" >> /usr/local/directadmin/data/task.queue

echo "action=rewrite&value=mail\_sni&domain=domain.com" >> /usr/local/directadmin/data/task.queue

this will recreate the sni/domain.com.conf for each SSL domain, plus one for the system hostname.

It will use the /etc/virtual/domainowners, to go through each domain, each cert, and remove any existing \*:user:domain.com entries from snidomains, and re-add whatever is present.

## [#](#ability-to-always-load-all-php-fpm-settings-into-user-nginx-conf-nginx-fpm-always-set-1) Ability to always load all php-fpm settings into User nginx.conf: nginx\_fpm\_always\_set=1 new

New directadmin.conf option:

```
nginx_fpm_always_set=0

```

where 0 is the internal default, which can be set to 1:

```
nginx_fpm_always_set=1

```

and restart DA, to prevent the server{} entries from using:

include /usr/local/directadmin/data/users/username/nginx\_php.conf;

and instead force the loading of the php-fpm settings right inside the nginx.conf for each domain.

This is already done in cases where Users have swapped php versions but this adds the option to do it all the time for other scenarios where you might need control tokens from the nginx\_php.conf on a per-domain basis.

The nginx\_php.conf is a per-User file, thus times where php is not swapped, but you need per-domain control, set this option to 1.

##### [#](#tokens) TOKENS

A change to how tokens are given to the php-fpm.conf template in per-domain mode (php versions swappped or nginx\_fpm\_always\_set=1)

in that the previous tokens, although loaded in, where not sub-sorted.

For example, if you set:

```
|?USER=fred|

```

in the |CUSTOM| token at Custom Httpd Config -> domain.com, the CUSTOM token is available to it, but the php-fpm.conf doesn't have it set anywhere, so the sub-tokenization never happened.

I've added a pre-tokenizer on all values to set:

```
USER=fred

```

for all tokens given to the php-fpm.conf

Note, a new token container is created for the php-fpm.conf template, so if you set something right inside the php-fpm.conf, it will not carry up and on to other templates for the domain (eg: nginx\_server\_sub.conf), but the CUSTOM tokens set in the GUI will, as they always have.

This was done to isolate these changes, as we don't want the sub-tokenization to happen too soon, as the order of tokens (eg: CUSTOM) is important, if a value is set there, vs CUSTOM1 before it.. the (eg: the USER should only be set once |CUSTOM| is called, so fred shouldn't be set until that point)

## [#](#http2-for-nginx-new-token-space-http2-templates) http2 for nginx: new token |SPACE\_HTTP2| (TEMPLATES) new

If http2=1 is set in the directadmin.conf, a token will be present:

```
SPACE_HTTP2= http2

```

where the value is " http2" or "".

Note that there is a space before the http2 value, so that we don't end up with a space in the template if http2 is turned off.

TEMPLATES:

nginx\_ips.conf

nginx\_server\_secure.conf

nginx\_server\_secure\_sub.conf

added |SPACE\_HTTP2| after ssl, before the semicolon:

```
listen |IP|:|PORT_443| ssl|SPACE_HTTP2|;

```

If you're already using custom templates, this won't affect anything.

Note, that the |MULTI\_IP| token will now automatically insert http2 if http2=1 is enabled.

per-User template changes for http2 are not required for apache, it's enabled in a global config.

## [#](#login-pre-sh-login-post-sh-session-create-pre-sh-to-add-user-agent-header) login\_pre.sh login\_post.sh session\_create\_pre.sh to add $user\_agent header new

If you're using the login\_pre.sh, login\_post.sh, or session\_create\_pre.sh, you can now access the environmental variable:

user\_agent

which is the User-Agent header passed to DA in the request, should you need to check that to validation, eg:

```
user_agent=Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.113 Safari/537.36

```
## [#](#private-html-to-public-html-link-by-default-default-change) private\_html to public\_html link by default (DEFAULT CHANGE) new

New directadmin.conf option, where the internal default is:

default\_private\_html\_link=0

such that existing installs will not have any behavior change.

New installs have:

default\_private\_html\_link=1

in the template:

/usr/local/directadmin/data/templates/directadmin.conf

so NEW INSTALLS will have this feature enabled by default.

Old/existing installs are unaffected.

When you add:

```
default_private_html_link=1

```

any domain created with SSL enabled will have a private\_html -> public\_html link, instead of a private\_html folder.

This should save some confusion, as the internet is slowing moving towards 100% https, so there is less need for split folders.

Of course, you can still set the private\_html to be a folder or link via:

User Level -> Domain Setup -> domain.com -> private\_html setup for domain.com

##### [#](#restores) RESTORES

There are several different scenarios to take into consideration.

We'll assume default\_private\_html\_link=1 for all of these scenarios (default\_private\_html\_link=0 is the old behavior)

A) Merge method:

* Empty User and domain are created normally first, then restore in a 2nd step.
* or User already exists, then restore to merge from backup

For a merge, if private\_html->public\_html already exists, but the backup has a private\_html folder, the private\_html folder has priority.

The link is removed before the tar extraction, and the data is extracted normally.

If private\_html is a folder, and the backup has a link, again, the backup has priority.

This case means if you had any data in your private\_html folder, *it will be deleted*, and replaced with the link from the backup.

OLD DATA WILL BE LOST if you had any data in the private\_html before the restore.

Either way, backups have priority.

After a backup has been extracted, if there is no private\_html at all in the backup (no link, no folder), then then original private\_html, and old value it pointed to, will be restored (in case it was pointing elsewhere).

BUT if the file in the backup file: backup/domain.com/domain.conf has private\_html\_link=1, this causes an extra step to wipe the old private\_html and replace it with a link (again, backup has priority, even if there was no link in the file).

So if you're doing something creative, where you don't want the domains/domiain.com/private\_html in the backup at all, ensure private\_html\_link=0 is in the domain.conf file.

This probably doesn't apply to anyone.. as if it is set to 1, then the link would exist.. so might be a moot point.

B) restore creation

If the User does not exist prior to restore, then the User/domain will be created by DA at restore time.

With this case, the public\_html/private\_templates are not used, and backup has priority.

Related change: [Skip all templates in ~/domains/domain.com upon restore creation](/changelog/version-1.49.0.html#skip-all-templates-in-domains-domain-com-upon-restore-creation)

## [#](#option-spam-inbox-prefix-name-inbox-spam) option: spam\_inbox\_prefix\_name=INBOX.spam new

You can now set a new value for INBOX.spam in the directadmin.conf.

This is the internal default:

spam\_inbox\_prefix\_name=INBOX.spam

to add that to the directadmin.conf and adjust as needed, if you wish to use a different value.

It's only used when spam\_inbox\_prefix=1 is set, which is when INBOX.spam applied.

Simply swaps all INBOX.spam strings with the new value.

The leading dot is added internally, where applicable (eg, Maildir paths), so don't add a leading dot, else you'll get 2.

## [#](#userdir-for-nginx-in-shared-ips-templates) UserDir for nginx in shared IPs (TEMPLATES) new

Previously, only the server IP could use /~username access with nginx.

This change lets you use the shared IPs for /~username access.

Affects:

/etc/nginx/directadmin-ips.conf

Also, this is controlled by the CustomBuild 2.0 option for:

```
userdir_access=yes|no

```

but if DA can't figure it out (eg: it's not visibly set to no), it defaults to "yes".

Also make the apache UserDir settings enable/disable as well in the file:

/etc/httpd/conf/ips.conf

based on the options.conf userdir\_access setting.

If you don't need it on, we do recommend shutting it off, eg:

./build set userdir\_access no

./build rewrite\_confs

##### [#](#templates) TEMPLATES

nginx\_ips.conf - Added just below the index line:

```
|*if HAVE_USERDIR_ACCESS="1"|
include /etc/nginx/nginx-userdir.conf;
|*endif|

```

ips\_virtual\_host.conf - Added the if settings (was always present before)

```
|*if HAVE_USERDIR_ACCESS="1"|
UserDir public_html
|*endif|

```
## [#](#https-for-redirect-domain-pointers-templates) https for redirect domain pointers (TEMPLATES) new

Added the 443 code for VirtualHost/servers in the templates:

redirect\_virtual\_host.conf

nginx\_server\_redirect.conf

added only if the current domain has SSL enabled.

Requires the User's httpd.conf or nginx.conf to be rewritten.

If you want this feature (After updating DA), you can do it for the whole server with:

```
cd /usr/local/directadmin/custombuild
./build update
./build rewrite_confs

```

Note, SSL certificates used in the VirtualHost/server will be the ones from the master domain the pointer is created under.

To avoid SSL Certificate errors, you'll need to ensure that the pointer is also in the master domains certificate.

LetsEncrypt can do this for you, just an extra checkbox from the list.

## [#](#ability-to-change-pm-max-children-in-php-fpm-conf-template) Ability to change pm.max\_children in php-fpm.conf (TEMPLATE) new

Template change.

Added:

```
|?MAX_CHILDREN=50|

```

to the top of the template (before |CUSTOM1|) and change the line:

```
pm.max_children = 50

```

to be:

```
pm.max_children = |MAX_CHILDREN|

```

this will not allow you to go to (for example)

```
/CMD_CUSTOM_HTTPD?user=fred&php-fpm=5.6

```

to add:

```
|?MAX_CHILDREN=100|

```

or any number you need, into the |CUSTOM1| token to increase the pm.max\_children value.

## [#](#fill-checkboxes-in-letsencrypt-based-on-existing-certificate) Fill checkboxes in LetsEncrypt based on existing certificate new

If you make a change to a LetsEncrypt certificate by requesting a new one, this feature will select all checkboxes based on the values in the current LE certificate, saving the need to re-check values that are already in the old certificate.

## [#](#named-checkzone-to-be-more-strict-with-k-fail) named-checkzone to be more strict with -k fail new

New internal default directadmin.conf option:

```
named_checkzone_level=fail

```

Where this setting is used with the named-checkzone query -k option.

The default used before (via absence of -k option) was warn.

It was found that some warnings returned by named-checkzone would actually cause a full failure in named, so the strictness level of this call had to be increased.

Valid options for named\_checkzone\_level are:

* fail
* warn
* ignore

If you find this to be too strict, set it back to level "warn" by adding:

```
named_checkzone_level=warn

```

to the directadmin.conf.

## [#](#plugin-max-hooks-to-allow-more-plugins) plugin\_max\_hooks to allow more plugins new

New internal directadmin.conf setting:

plugin\_max\_hooks=16

which replaces a hardcoded internal default.

Note that this never restricted the upper limit of plugins used, it did prevent the auto-filling of the blank plugin token values..

So if you had 20 tokens, and 8 plugins, the last 4 wouldn't be filled with "", and would end up showing "none".

So this variable simply sets the number of default plugin tokens to "".

## [#](#ability-to-disable-forwarder-pipes) Ability to disable forwarder pipes new

Ability to prevent processing email through email pipes.

Internal default is:

```
allow_forwarder_pipe=1

```

To disable it, add:

```
allow_forwarder_pipe=0

```

to your directadmin.conf file.

## [#](#periodically-check-to-ensure-versions-txt-is-being-updated) Periodically check to ensure versions.txt is being updated new

It's important to keep your server up to date. CustomBuild will help you update all of your services to their latest versions and config files.

You can either do this manually or have it check via cron, but in the event that perhaps you've forgotten to update it, or perhaps the update isn't working (say a files server has a stale copy),

this new feature will check to ensure that your file:

/usr/local/directadmin/custombuild/versions.txt

is no more than 30 days old.

It does this two ways:

* login time, after a successful login to DA by any account, there is a 10% chance the check will trigger.
* monthly reset will trigger the check each time.

New internal value:

cb\_version\_check\_odds\_percent=10

where it's the percentage chance for any login to trigger the check.

If you change this check to 0, then the check will never run for either the post-login trigger nor the reset.

## [#](#mysql-5-7-6-dropped-mysql-user-password-column) MySQL 5.7.6+ dropped mysql.user password column fixed

BETA

Although CustomBuild didn't get the MySQL 5.7 version added (because it had some conversion issues to MariaDB), we've also learnt that it dropped the password column completely:

http://dev.mysql.com/doc/relnotes/mysql/5.7/en/news-5-7-6.html

basically replacing it with a column called "authentication\_string", but also means there are other required syntax changes that DA will need to do if MySQL 5.7 would be supported in DA.

To support the 5.7.6 changes, add

```
mysql_milestone_16=1

```

to your directadmin.conf, and restart directadmin.

Update: April 2018: CustomBuild DOES currently support MySQL 5.7, so setting the variable in the directadmin.conf should happen automatically.

More info:

https://www.mysql.com/why-mysql/white-papers/whats-new-mysql-5-7/

## [#](#backup-dns-don-t-remove-sole-record-if-it-s-a-linked-ip) Backup dns: don't remove sole record if it's a linked IP fixed

Say you have a domain on 1.2.3.4, and you have 1.2.3.5 linked to it for dns, DA will duplicate all A/AAAA records accordingly.

So you'd have:

```
www A 1.2.3.4
www A 1.2.3.5

```

however, some people might manually change the ns1/ns2 records to look like this:

```
ns1 A 1.2.3.4
ns2 A 1.2.3.5

```

while the other records are doubled up.

When DA creates the backup, it will remove the linkeds IPs from the zone, leaving just:

```
www A 1.2.3.4
ns1 A 1.2.3.4

```

where this would actually cause the write to fail the zone write check, since if this was present:

```
domain.com.  NS ns2

```

the ns2 A record is now missing.

This change is to check how many total A+AAAA records there are for that given name, and if there is only 1, then the value is not removed.

This can span AAAA records too, eg:

```
ns1 A 1.2.3.4
ns2 AAAA :::1:2:3:5

```

and DA will ensure if there is only 1 of either A or AAAA, that last value is not removed, even if it's only on the linked IP.

This will allow it to pass the zone check.

Backups will now also include the domains/domain.com.ip\_list, so that DA can eventually be coded to know that the 1.2.3.5 value is an additional value, and should be swapped if the new server is using a different IP.

As this change currently sits, when you restore the zone, if you were to set the User/Domain to use 4.3.2.1, it would end up like:

```
www A 4.3.2.1
ns1 A 4.3.2.1
ns2 A 1.2.3.5

```

Since 1.2.3.5 is considered a "custom" IP at this point, since DA does not yet check that it's a linked IP (as the backup system only currently supports a single IP to restore to)

If you're restoring to the same IPs, then it should be fine, it just gets a bit messy if you're restore to a different IP, then 1.2.3.5 would need to be swapped accordingly after the restore.

## [#](#more-plugin-hooks-skins) More plugin hooks (SKINS) fixed

Added 4 more tokens for Admin, Reseller and User Levels, supporting up to 14 plugins.

admin/content\_main.html

reseller/content\_main.html

user/show\_domain.html

## [#](#set-language-in-dataskq-for-backup-restore-messages) Set language in dataskq for backup/restore messages fixed

When doing language translations, there is an area of code called the "InternalText" class. This is used to translated texts set within the DA binaries, and not part of the html skin code.

When browsing in DA through port 2222, the language set set from the user.conf files, so DA knows which internal texts to use.

However, for dataskq task.queue commands, there is no login, so the language is not set, so some background messages might be in English, this is the bug.

Solution for the backup/restore is to set the docsroot and lang settings from the user.conf as needed, based on who called the backup/restore.

## [#](#don-t-count-hard-links-multiple-times) Don't count hard-links multiple times fixed

For the "Email Disk Usage" count, DA includes various areas, including:

/home/user/imap

/home/user/Maildir

which are files managed by Dovecot.

Dovecot often uses hard-links when copying messages around to save space, but when DA previously counted the disk usage, the same file might get counted many times.

This changes is to still count the same file multiple times, but if it's owned by the User and has multiple hard links, divide that file's current size by the number of hard links.

So if a file has 2 links, DA counts 1/2 the size twice, giving a more accurate result.

Note that this will not affect the total disk usage, which relies on the System Quotas, a completely different system.

This change will just make the results closer to the "du" output, which handles multiple hard-links in a different way (likely tracking all of their IDs in a hash)

but should arrive at the same result as long as the files are under the same path (which is why this is only done for specific dovecot paths)

This will also *not* affect the File Manager directory usage output for the above folders, so for example, the results you'll see for /home/user/imap will probably be different than the total that DA gets during the tally.

## [#](#removing-additional-ip-from-user-that-was-in-use-by-a-domain-causes-wrong-ip-in-config) Removing additional IP from User that was in use by a domain causes wrong IP in config fixed

Duplicate:

1. User + domain assigned to server IP .1
2. Add an additional IP .2 to the User.
3. Login as the User, add .2 to the domain.
4. Remove .1 from the domain.
5. logout, back to creator, edit user and delete .2 from User.

Expected result would be everything, dns, all configs, revert back to .1.

What was happening, was close, but the domain.com.conf file did not get the last .1 user IP.

Previous check was checking if the domain.com.conf's IP was not in the domain.com.ip\_list file, and use index[0] for the .conf ip,

but the domain.com.ip\_list was actually empty at that point, so the conf overwrite did nothing, and left the previous .2 IP.

New check to ensure the "backup" IP used is not NULL, and if it is, use the user.conf ip.

## [#](#swap-gethostbyname-with-getaddrinfo) swap gethostbyname with getaddrinfo fixed

When DA used to do lookups, it would use the older gethostbyname, which still worked fine.

However, to better support IPv6, I've switched over to getaddrinfo (which is newer anyway)

So any lookups that DA does, will now support IPv6.

However, DA still favors IPv4, so the hint will start with AF\_INET, and only move to AF\_INET6 if there are no IPv4s.

## [#](#letsencrypt-remove-deleted-domains-subdomains-from-san-config-before-renewal) LetsEncrypt: remove deleted domains/subdomains from san\_config before renewal fixed

If you've got subdomains, create a multi-domain LetsEncrypt certificate to include those subdomains, and then delete the subdomain, the renewal would fail, because the san\_config still has the subdomain listed.

Before any renewal call to letsencrypt.sh, DA will scan the list of subjectAltName=DNS entries, to ensure that:

* they're a domain on the sysetm
* or a subdomain of a domain on the system
* or resolve to any IP that exists on the system (data/admin/ips/ip.list)

If not, it's removed from the domain.com.san\_config, prior to the renewal via letsencrypt.sh.

## [#](#deleting-a-user-with-php-fpm-while-a-php-script-is-running-throws-error) Deleting a User with php-fpm while a php script is running throws error fixed

If you run php-fpm and the User's website is active when you delete it, this error may appear:

Unable to remove Unix User. Continuing with the other files.

userdel: user testuser is currently used by process 123456

DirectAdmin does scan for, and kill all Users processes before running the userdel command, however php-fpm is quick to spawn a new process for the User.

The solution is to delete the file:

/usr/local/directadmin/data/users/testuser/php/\*

and quickly triggering a graceful reload of php-fpm before running userdel.

Currently, this is triggered multiple times if multiple Users are deleted, so we may need to change it.

Predicting the full list of Users is possible, but more difficult due to the recursive nature of Reseller, so for now the graceful trigger is done per-User being deleted.

As "graceful" restarts don't affect live requests, in theory, this should't hurt other Users, except those being removed.

Note, by "graceful", it will be whatever is the correct term for your OS, as it has several variables.

If "php\_fpm\_restarts=1" set, the "restart" is used.

if systemd, then reload is used,

else graceful is used.

## [#](#cmd-system-info-not-showing-nginx-for-nginx-proxy) CMD\_SYSTEM\_INFO not showing nginx for nginx\_proxy fixed

Fixed a few things in the CMD\_SYSTEM\_INFO area, mainly the missing nginx entry when the nginx\_proxy is in use (both nginx apache are running)

Also enabled json=yes.

## [#](#double-mysql-close-call-causes-segfault) Double mysql\_close call causes segfault fixed

Bug that has oddly only showed up on Debian 9, caused by 2 calls to mysql\_close on the same pointer during a restore.

Main surprise is that other systems did not trigger a segfault. Found/fixed either way.

## [#](#freebsd-apache-public-html-not-setting-apache-group) FreeBSD: apache\_public\_html not setting apache group fixed

The older apache\_public\_html=1 setting (Which is redudnant with secure\_access\_group, not no longer enabled by default) was not correctly setting the public\_html folder to apache.

Linux is not affected, as the process group is applied to the folder, but apparently not with FreeBSD.

## [#](#filemanager-edit-write-to-temp-first) FileManager Edit: write to temp first fixed

When saving an edit file, changed to save to a mkstemp file first, before renaming the successfully saved file to the original name.

This prevents files becoming 0 bytes if you save an edit to a full disk or full quota.

However, this also means that symbolic links will no longer be followed, if you editing a file through a link.

So if you were, be sure to edit the destination file, instead of the link.

## [#](#debian-7-cast-bug-for-php-fpm-versions) Debian 7 cast bug for php-fpm versions fixed

Likely an old compiler bug or something similar, where a double value of 71.0 cast to to (int) gives 70 (via options.conf php2\_release=7.1, x10)

Solution (not great) is to add 0.00001 to account for the floating point rounding error, where the int always rounds down, so it will then end up with the correct 71.

Other OS versions don't seem to run into this rounding error.

Related to php-fpm config files, with Custom Httpd Config, eg:

/usr/local/directadmin/data/users/username/php/php-fpm70.conf.custom1

vs

/usr/local/directadmin/data/users/username/php/php-fpm71.conf.custom1

it was writing to the fpm70 file, when it should have been fpm71.

## [#](#segfault-security-cve-2017-18045) segfault (SECURITY) CVE-2017-18045 fixed

Important security fix where a segfault from a specific request could allow a remote attacker unauthorized access.

For anyone who cannot update to this version of DirectAdmin (eg: end-of-life OS), please add:

email\_ftp\_password\_change=0

to your directadmin.conf and restart DirectAdmin.

We won't be immediately commenting on the details of the bug to allow everyone time to update.

Update:

As some client have disabled their auto-update or have still not updated yet, to help get the message out more quickly, we've requested a CVE ID number:

CVE-2017-18045

http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-18045

##### [#](#related-messages) Related messages:

RoundCube:

"Could not save new password. The password changing feature has been disabled"

Last Updated:

 [Version 1.52.1](/changelog/version-1.52.1.html)  [Version 1.51.4](/changelog/version-1.51.4.html)


