=== Content from bugs.launchpad.net_a115326d_20250124_131646.html ===

[Log in / Register](https://bugs.launchpad.net/ubuntu/%2Bsource/lxc/%2Bbug/1661447/%2Blogin)

[![](https://launchpadlibrarian.net/606381979/CoF%2064px.png)](https://launchpad.net/ubuntu)

## [Ubuntu](https://launchpad.net/ubuntu)[lxc package](https://launchpad.net/ubuntu/%2Bsource/lxc)

* [Overview](https://launchpad.net/ubuntu/%2Bsource/lxc)
* [Code](https://code.launchpad.net/ubuntu/%2Bsource/lxc)
* [Bugs](https://bugs.launchpad.net/ubuntu/%2Bsource/lxc)
* Blueprints
* [Translations](https://translations.launchpad.net/ubuntu/%2Bsource/lxc)
* [Answers](https://answers.launchpad.net/ubuntu/%2Bsource/lxc)

# Arbitrary code execution in centos template

Bug #1661447 reported by
[Gianni Tedesco](https://launchpad.net/~scara)
on 2017-02-03

[260](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [lxc (Ubuntu)](https://bugs.launchpad.net/ubuntu/%2Bsource/lxc "Latest release: 1:6.0.3-1, uploaded to main on 2024-12-20 04:41:45.351873+00:00 by pkg-lxc (pkg-lxc-devel), maintained by pkg-lxc (pkg-lxc-devel)") | Fix Released | Undecided | Unassigned |  |

### Bug Description

All the RPM's which get installed in an lxc-centos container are downloaded insecurely over http and then installed with yum --nogpgcheck. A man in the middle attacker, web proxy admin, or whoever can use this to install arbitrary code in to the container which will then get executed as root.

The GPG keys should probably be shipped as part of the package where they are covered by the root of trust for the host distro. Or at the very least, https should be used to fetch the RPMs.

## CVE References

* [2017-18641](/bugs/cve/2017-18641 "In LXC 2.0, many template scripts dow...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Seth Arnold (seth-arnold)](https://launchpad.net/~seth-arnold) wrote on 2017-02-03: |  |  | [#1](/ubuntu/%2Bsource/lxc/%2Bbug/1661447/comments/1) |
| --- | --- | --- | --- |

Thanks for the report Gianni, I subscribed the LXC team for their feedback.

Thanks for the report Gianni, I subscribed the LXC team for their feedback.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Stéphane Graber (stgraber)](https://launchpad.net/~stgraber) wrote on 2017-02-03: |  |  | [#2](/ubuntu/%2Bsource/lxc/%2Bbug/1661447/comments/2) |
| --- | --- | --- | --- |

Yeah, looks like a bunch of our template authors didn't exactly have MITM attacks in mind when they wrote their template scripts...

The current list of templates is:

lxc-alpine.in => Okay, contains hashes of the APK keys

lxc-altlinux.in => Okay, seems to rely on apt-get for the first level of bootstrapping

lxc-archlinux.in => Calls pacstrap from the distro which seems to be doing

lxc-busybox.in => Copies local files from the distro

lxc-centos.in => Bad, runs yum with --nogpgcheck

lxc-cirros.in => Bad, downloads over plain http without any check

lxc-debian.in => Okay, uses GPG validation with keyring downloaded over https if missing

lxc-download.in => Okay, uses both https and gpg

lxc-fedora.in => Bad, downloads a base system over plain rsync and then uses yum from it with gpg validation turned off

lxc-gentoo.in => Bad, downloads over plain http with no gpg or checksum checks anywhere

lxc-openmandriva.in => Bad, uses --no-verify-rpm which I can only assume turns of gpg validation

lxc-opensuse.in => Okay, uses the distro zypper command which seems to be keeping a keyring

lxc-oracle.in => Bad, runs yum with --nogpgcheck

lxc-plamo.in => Bad, unless DLSCHEME is modified, downloads over http with no gpg check

lxc-pld.in => Okay, seems to bootstrap using "poldek" from the distro with no flag suggesting package validation is disabled

lxc-slackware.in => Okay, seems to bootstrap using "slackpkg" from the distro with gpg turned on in configuration

lxc-sparclinux.in => Bad, runs yum with --nogpgcheck

lxc-sshd.in => Okay, uses local distro binaries

lxc-ubuntu-cloud.in => Okay, uses ubuntu-cloudimg-query which handles gpg

lxc-ubuntu.in => Okay, uses the distro debootstrap which uses the distro keyring

lxc-voidlinux.in => Bad, no clear indication that xbps does gpg in any way and it's not using an https mirror

Yeah, looks like a bunch of our template authors didn't exactly have MITM attacks in mind when they wrote their template scripts...
The current list of templates is:
lxc-alpine.in => Okay, contains hashes of the APK keys
lxc-altlinux.in => Okay, seems to rely on apt-get for the first level of bootstrapping
lxc-archlinux.in => Calls pacstrap from the distro which seems to be doing
lxc-busybox.in => Copies local files from the distro
lxc-centos.in => Bad, runs yum with --nogpgcheck
lxc-cirros.in => Bad, downloads over plain http without any check
lxc-debian.in => Okay, uses GPG validation with keyring downloaded over https if missing
lxc-download.in => Okay, uses both https and gpg
lxc-fedora.in => Bad, downloads a base system over plain rsync and then uses yum from it with gpg validation turned off
lxc-gentoo.in => Bad, downloads over plain http with no gpg or checksum checks anywhere
lxc-openmandriva.in => Bad, uses --no-verify-rpm which I can only assume turns of gpg validation
lxc-opensuse.in => Okay, uses the distro zypper command which seems to be keeping a keyring
lxc-oracle.in => Bad, runs yum with --nogpgcheck
lxc-plamo.in => Bad, unless DLSCHEME is modified, downloads over http with no gpg check
lxc-pld.in => Okay, seems to bootstrap using "poldek" from the distro with no flag suggesting package validation is disabled
lxc-slackware.in => Okay, seems to bootstrap using "slackpkg" from the distro with gpg turned on in configuration
lxc-sparclinux.in => Bad, runs yum with --nogpgcheck
lxc-sshd.in => Okay, uses local distro binaries
lxc-ubuntu-cloud.in => Okay, uses ubuntu-cloudimg-query which handles gpg
lxc-ubuntu.in => Okay, uses the distro debootstrap which uses the distro keyring
lxc-voidlinux.in => Bad, no clear indication that xbps does gpg in any way and it's not using an https mirror

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Stéphane Graber (stgraber)](https://launchpad.net/~stgraber) wrote on 2017-02-03: |  |  | [#3](/ubuntu/%2Bsource/lxc/%2Bbug/1661447/comments/3) |
| --- | --- | --- | --- |

So that's not so great, looks like we'd need fixes from template maintainers for:

 - centos

 - cirros

 - fedora (a new template is being worked on, will have to check if also affected)

 - gentoo

 - openmandriva

 - oracle

 - plamo

 - sparclinux

 - voidlinux

Some of those look trivial to fix, some of the others, no so much. Unfortunately those template scripts are community contributed and the LXC core team only actively maintains:

 - download

 - ubuntu

 - ubuntu-cloud

A few of the templates above can be trivially fixed and I'll be preparing patches for those, for the others we'll need to reach out to the various maintainers and start piling up patches for this.

So that's not so great, looks like we'd need fixes from template maintainers for:
- centos
- cirros
- fedora (a new template is being worked on, will have to check if also affected)
- gentoo
- openmandriva
- oracle
- plamo
- sparclinux
- voidlinux
Some of those look trivial to fix, some of the others, no so much. Unfortunately those template scripts are community contributed and the LXC core team only actively maintains:
- download
- ubuntu
- ubuntu-cloud
A few of the templates above can be trivially fixed and I'll be preparing patches for those, for the others we'll need to reach out to the various maintainers and start piling up patches for this.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Stéphane Graber (stgraber)](https://launchpad.net/~stgraber) wrote on 2017-02-03: |  |  | [#4](/ubuntu/%2Bsource/lxc/%2Bbug/1661447/comments/4) |
| --- | --- | --- | --- |

Commented in the pull request of the new fedora template, to make sure we don't merge a new template that suffers from this: <https://github.com/lxc/lxc/pull/1371>

Commented in the pull request of the new fedora template, to make sure we don't merge a new template that suffers from this: https://github.com/lxc/lxc/pull/1371

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Stéphane Graber (stgraber)](https://launchpad.net/~stgraber) wrote on 2017-02-03: |  |  | [#5](/ubuntu/%2Bsource/lxc/%2Bbug/1661447/comments/5) |
| --- | --- | --- | --- |

* [Patch for voidlinux](https://bugs.launchpad.net/ubuntu/%2Bsource/lxc/%2Bbug/1661447/%2Battachment/4812458/%2Bfiles/0001-voidlinux-Use-an-https-mirror.patch)
  [Edit](/ubuntu/%2Bsource/lxc/%2Bbug/1661447/%2Battachment/4812458)
  (1.5 KiB,
  text/plain)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Stéphane Graber (stgraber)](https://launchpad.net/~stgraber) wrote on 2017-02-03: |  |  | [#6](/ubuntu/%2Bsource/lxc/%2Bbug/1661447/comments/6) |
| --- | --- | --- | --- |

Subscribed Scott Moser as he's behind Cirros and the lxc-cirros template.

Scott: Any chance you can have https turned on for <http://download.cirros-cloud.net/> ?

Looks like this is hosted by Dreamhost and they apparently offer let's encrypt for free SSL, so it may be just a knob to turn on somewhere, at which point we can just have the template use that.

If that's not an option, then we'd need to ship with the GPG key in the template and use simplestreams with gpg validation which would make the template a fair bit more complex.

Subscribed Scott Moser as he's behind Cirros and the lxc-cirros template.
Scott: Any chance you can have https turned on for http://download.cirros-cloud.net/ ?
Looks like this is hosted by Dreamhost and they apparently offer let's encrypt for free SSL, so it may be just a knob to turn on somewhere, at which point we can just have the template use that.
If that's not an option, then we'd need to ship with the GPG key in the template and use simplestreams with gpg validation which would make the template a fair bit more complex.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Stéphane Graber (stgraber)](https://launchpad.net/~stgraber) wrote on 2017-02-08: |  |  | [#7](/ubuntu/%2Bsource/lxc/%2Bbug/1661447/comments/7) |
| --- | --- | --- | --- |

download.cirros-cloud.net is now https enabled, will provide a patch to make use of that

download.cirros-cloud.net is now https enabled, will provide a patch to make use of that

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Stéphane Graber (stgraber)](https://launchpad.net/~stgraber) wrote on 2017-02-08: |  |  | [#8](/ubuntu/%2Bsource/lxc/%2Bbug/1661447/comments/8) |
| --- | --- | --- | --- |

* [0001-cirros-Use-https-for-image-download.patch](https://bugs.launchpad.net/ubuntu/%2Bsource/lxc/%2Bbug/1661447/%2Battachment/4815624/%2Bfiles/0001-cirros-Use-https-for-image-download.patch)
  [Edit](/ubuntu/%2Bsource/lxc/%2Bbug/1661447/%2Battachment/4815624)
  (859 bytes,
  text/plain)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Gianni Tedesco (scara)](https://launchpad.net/~scara) wrote on 2020-02-05: |  |  | [#9](/ubuntu/%2Bsource/lxc/%2Bbug/1661447/comments/9) |
| --- | --- | --- | --- |

Are we ready to make this public?

I'd like to make some public mention of the issue in a blog post about container security.

Are we ready to make this public?
I'd like to make some public mention of the issue in a blog post about container security.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Stéphane Graber (stgraber)](https://launchpad.net/~stgraber) wrote on 2020-02-05: |  |  | [#10](/ubuntu/%2Bsource/lxc/%2Bbug/1661447/comments/10) |
| --- | --- | --- | --- |

Yeah, we were originally considering fixing all of the individual templates but frankly it was just too much of a mess of bad patterns from a variety of different authors with no real consistency.

Instead what we came up with is distrobuilder (<https://github.com/lxc/distrobuilder>) which has now taken over image building duties for all the images we produce (<https://images.linuxcontainers.org>) and does have proper https and gpg support from the start.

All images we produce are built using public YAML definitions that can be found in <https://github.com/lxc/lxc-ci> and all of those either rely on https for the download of the base tarball (which then contains what's needed for the package manager to safely fetch packages) or directly contain a custom GPG keyring that's exposed to the image build.

The rest of the story is effectively the same as before, all builds happen on our infrastructure (<https://jenkins.linuxcontainers.org>), images are then pulled, validated and signed by a separate system which then pushes them to the image server. All artifacts are available through both valid https and gpg signed using the key that's baked into the lxc-download script.

Back in LXC 3.0 we moved the legacy template scripts to their own repository at <https://github.com/lxc/lxc-templates> and they are now community maintained without security/lts commitments on them on our side. Ubuntu still ships lxc-templates but it does so in universe rather than main, matching the upstream commitment.

Yeah, we were originally considering fixing all of the individual templates but frankly it was just too much of a mess of bad patterns from a variety of different authors with no real consistency.
Instead what we came up with is distrobuilder (https://github.com/lxc/distrobuilder) which has now taken over image building duties for all the images we produce (https://images.linuxcontainers.org) and does have proper https and gpg support from the start.
All images we produce are built using public YAML definitions that can be found in https://github.com/lxc/lxc-ci and all of those either rely on https for the download of the base tarball (which then contains what's needed for the package manager to safely fetch packages) or directly contain a custom GPG keyring that's exposed to the image build.
The rest of the story is effectively the same as before, all builds happen on our infrastructure (https://jenkins.linuxcontainers.org), images are then pulled, validated and signed by a separate system which then pushes them to the image server. All artifacts are available through both valid https and gpg signed using the key that's baked into the lxc-download script.
Back in LXC 3.0 we moved the legacy template scripts to their own repository at https://github.com/lxc/lxc-templates and they are now community maintained without security/lts commitments on them on our side. Ubuntu still ships lxc-templates but it does so in universe rather than main, matching the upstream commitment.

| Changed in lxc (Ubuntu): | |
| --- | --- |
| **status**: | New → Fix Released |
| **information type**: | Private Security → Public Security |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Stéphane Graber (stgraber)](https://launchpad.net/~stgraber) wrote on 2020-02-05: |  |  | [#11](/ubuntu/%2Bsource/lxc/%2Bbug/1661447/comments/11) |
| --- | --- | --- | --- |

We're marking this issue as "Fix Released" for LXC due to the removal of all those scripts from the standard LXC distribution, instead relying on distrobuilder for our users to generate custom LXC images (which can then be consumed by the lxc-local template).

We're marking this issue as "Fix Released" for LXC due to the removal of all those scripts from the standard LXC distribution, instead relying on distrobuilder for our users to generate custom LXC images (which can then be consumed by the lxc-local template).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Gianni Tedesco (scara)](https://launchpad.net/~scara) wrote on 2020-02-06: |  |  | [#12](/ubuntu/%2Bsource/lxc/%2Bbug/1661447/comments/12) |
| --- | --- | --- | --- |

Great, thanks again for all the hard work!

Great, thanks again for all the hard work!

[See full activity log](https://bugs.launchpad.net/ubuntu/%2Bsource/lxc/%2Bbug/1661447/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/ubuntu/%2Bsource/lxc/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/ubuntu/%2Bsource/lxc/%2Bbug/1661447/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/ubuntu/%2Bsource/lxc/%2Bbug/1661447/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/ubuntu/%2Bsource/lxc/%2Bbug/1661447/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [Patch for voidlinux](https://bugs.launchpad.net/ubuntu/%2Bsource/lxc/%2Bbug/1661447/%2Battachment/4812458/%2Bfiles/0001-voidlinux-Use-an-https-mirror.patch)
  [Edit](/ubuntu/%2Bsource/lxc/%2Bbug/1661447/%2Battachment/4812458 "Change patch details")
* [0001-cirros-Use-https-for-image-download.patch](https://bugs.launchpad.net/ubuntu/%2Bsource/lxc/%2Bbug/1661447/%2Battachment/4815624/%2Bfiles/0001-cirros-Use-https-for-image-download.patch)
  [Edit](/ubuntu/%2Bsource/lxc/%2Bbug/1661447/%2Battachment/4815624 "Change patch details")

* [Add patch](/ubuntu/%2Bsource/lxc/%2Bbug/1661447/%2Baddcomment?field.patch=on)

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))


