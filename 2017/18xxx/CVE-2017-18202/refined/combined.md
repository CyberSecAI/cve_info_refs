=== Content from access.redhat.com_f3632052_20250126_045733.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)

  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Product Documentation](https://access.redhat.com/documentation)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)

  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform)
  [All Product Docs](//docs.redhat.com/en/products/)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)

  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Classifications](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Severety Ratings](https://access.redhat.com/security/security-updates/#/cve)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)

  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

 Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

# Severity ratings

## Understanding Red Hat security ratings

Red Hat Product Security rates the severity of security issues found
in Red Hat products using a four-point scale (Low, Moderate,
Important, and Critical), as well as including a separate Common
Vulnerability Scoring System (CVSS) base score. These scoring systems
provide a prioritized risk assessment to help you understand and
schedule upgrades to your systems, enabling informed decisions on the
risk each issue places on your unique environment.

The four-point scale tells you how serious Red Hat considers an issue
to be, helping you judge the severity and determine the most important
updates. The scale takes into account the potential risk based on a technical analysis of the exact flaw and its type. The risk level of a flaw does not change if an exploit or worm is later released for a flaw, or if one is available before the release of a fix. A flaw will only be re-evaluated if new technical details emerge.

The following table provides severity ratings for Red Hat products and systems. For flaws specific to AI models, see [Red Hat security ratings for AI models](https://access.redhat.com/security/ai).

| **Severity ratings** | **Security flaw description** |
| --- | --- |
| **Critical impact** | This rating is given to flaws that could be easily exploited by a remote unauthenticated attacker and lead to system compromise (arbitrary code execution) without requiring user interaction, or easily cause system compromise via inference end points on AI systems. Flaws that require authentication, local or physical access to a system, or an unlikely configuration are not classified as Critical impact. These are the types of vulnerabilities that can be exploited by worms. |
| **Important impact** | This rating is given to flaws that can easily compromise the confidentiality, integrity or availability of resources. These are the types of vulnerabilities that allow local or authenticated users to gain additional privileges, allow unauthenticated remote users to view resources that should otherwise be protected by authentication or other controls, allow authenticated remote users to execute arbitrary code, allow remote users to cause a denial of service, or can cause system compromise via inference end points on AI systems. |
| **Moderate impact** | This rating is given to flaws that may be more difficult to exploit but could still lead to some compromise of the confidentiality, integrity or availability of resources under certain circumstances. It is also given to flaws that could be exploited to cause denial of service-like conditions on AI systems via an inference end point, or allow attackers to steal other users’ data from the AI system without authorization. These are the types of vulnerabilities that could have had a Critical or Important impact but are less easily exploited based on a technical evaluation of the flaw and/or affect unlikely configurations. || **Low impact** | This rating is given to all other issues that may have a security impact. These are the types of vulnerabilities that are believed to require unlikely circumstances to be able to be exploited, or where a successful exploit would give minimal consequences. This includes flaws that are present in a program’s source code but to which no current or theoretically possible, but unproven, exploitation vectors exist or were found during the technical analysis of the flaw. |

A Red Hat security advisory can contain fixes for more than one
vulnerability and for packages for more than one product (such as both
Red Hat Enterprise Linux 7 and 8). Each issue in an advisory has a
severity rating for each product. The overall severity of an advisory
is the highest severity out of all the individual issues, across all
the products the advisory targets. For simplicity, advisories only
show the overall severity. The advisories contain links to the
relevant entries in Red Hat's bug-tracking system, where you can
examine individual severity ratings and additional commentary, as well
as links to the relevant pages in Red Hat’s CVE database.

When a technology—enabled and most likely used by default—completely
blocks the exploitation of a particular vulnerability across all
architectures, we will adjust the severity level. When a technology
reduces the risk of a vulnerability, we may adjust the severity level
and give an explanation of the decision in the bug-tracking  and CVE
database entries.

## Common Vulnerability Scoring System (CVSS)

Common Vulnerability Scoring System (CVSS) base scores provide
additional guidance about a vulnerability, giving a detailed severity
rating by scoring the constant aspects of a vulnerability: Attack
Vector, Attack Complexity, User Interaction, Privileges Required,
Scope, Confidentiality, Integrity, and Availability.

CVSS version 2 base metrics are available for all vulnerabilities from
2009-2016, as well as selected earlier vulnerabilities. In 2016, Red
Hat adopted the CVSS v3 standard, and all vulnerabilities going
forward will use version 3.1 for scoring. These scores are found on
the
[CVE pages](https://access.redhat.com/security/security-updates/#/cve)
(linked from the References section of each Red Hat Security Advisory).

Red Hat does not solely use the CVSS rating to determine the priority
with which flaws are fixed, or to determine the severity rating of the
vulnerability. It is used as a guideline to identify and describe key
metrics of a flaw, however the priority for which flaws are fixed is
determined by the overall severity of the flaw using the
aforementioned four-point scale.  CVSS is meant to help customers
prioritize the order in which they remediate flaws.

### CVSS v3 Base Metrics

The CVSS v3 base metrics group covers the constant aspects of a
vulnerability:

* Attack Vector (AV) - Expresses the "remoteness" of the attack and
  how the vulnerability is exploited.
* Attack Complexity (AC) - Speaks to the difficulty of executing an
  attack and what factors are needed for it to be successful. (Along
  with User Interaction, Attack Complexity was formerly part of the
  Access Complexity metric.).
* User Interaction (UI) - Determines whether the attack requires an
  active human to participate or if the attack can be automated.
* Privileges Required (PR) - Documents the level of user
  authentication required for the attack to be successful. (This
  replaces the former Authentication metric.).
* Scope (S) - Determines whether an attacker can impact a component
  beyond its security scope/authority.
* Confidentiality (C) - Determines whether unauthorized parties can
  access data and to what extent.
* Integrity (I) - Measures the impact to the trustworthiness and
  veracity of data.
* Availability (A) - Refers to the impact to accessibility of data or
  services for authorized users.

A formula translates these measurements into a single, numerical base
score, ranging from 0.0 (no risk) to 10.0 (highest risk). Refer to
[Common Vulnerability Scoring System v3.1: User Guide](https://www.first.org/cvss/user-guide)
for detailed descriptions of the base metrics. It is important to note
that the CVSS base metrics were designed to be used with the other
CVSS metric groups, notably the Temporal and Environmental metrics, to
provide an accurate representation of risk in customer environments.
Alone, the Base metrics offer a shallow view of the vulnerability
itself without accounting for deployment or the environment.

### How Red Hat Uses CVSS v3 Base Metrics

We aim to comply with the CVSS v3 standard when assigning base scores,
and Red Hat uses base metrics that reflect how a vulnerability affects
our products specifically.  In addition, we do not use the Qualitative
Severity Rating Scale in the CVSS v3.1 User Guide to rate severity,
and our severity ratings are always based on the aforementioned
four-point scale.  In some circumstances, it may not be obvious why a
flaw received a particular score. The following are some common
vulnerability types with our interpretation and typical scoring:

#### Libraries

It is not always possible to know how third-party applications use
libraries, making it difficult to give accurate CVSS v3 base metrics
for flaws in system libraries. When rating these flaws, we take into
account the way the library is used by applications that we ship, and
also look at other popular software that may use the library in a way
that would cause an issue to be of higher severity, and adjust the
score appropriately.

#### Other Common Scores

Flaws where a local, unprivileged user can cause a kernel to crash
(denial of service) typically score 5.5 (for example,
[CVE-2019-9213](https://access.redhat.com/security/cve/CVE-2019-9213)).

Flaws that allow a local, unprivileged user to escalate their
privileges to root typically score 7.8 (for example,
[CVE-2019-18634](https://access.redhat.com/security/cve/CVE-2019-18634)).

Cross-site scripting flaws are generally scored as having Low impact
to Integrity and/or Confidentiality, with no impact to Availability,
in line with scoring from other vendors and NVD. A typical score for
these flaws is 6.1 (for example,
[CVE-2020-11023](https://access.redhat.com/security/cve/CVE-2020-11023)).

### Base Score Variations Across Products

It is common for a given CVE-named vulnerability to have several
different CVSS base metrics, depending on the product, version, and
architecture. Examples of this include:

* A vulnerability that only affected some architectures. For example,
  [CVE-2019-15031](https://access.redhat.com/security/cve/CVE-2019-15031)
  only affected PowerPC.
* A vulnerability that is mitigated by source code protection
  mechanisms on some platforms. For example,
  [CVE-2018-1125](https://access.redhat.com/security/cve/CVE-2018-1125)
  could have led to arbitrary code execution on Red Hat Enterprise
  Linux, but it is only a denial of service because it was compiled
  with FORTIFY protections.
* A vulnerability that affected more than one product.  For example,
  [CVE-2020-14060](https://access.redhat.com/security/cve/CVE-2020-14060)
  affected a component in both OpenShift and OpenStack.  The severity
  to OpenStack was lower (Low) as compared to OpenShift (Moderate)
  based on its usage; the overall vulnerability itself was rated
  Important.

If CVSS v3 base scores are significantly different across products, we
note that separately wherever possible. If we do not split the score,
we report the metric that gives the highest CVSS v3 base score (the
worst-case outcome).

### Differences Between NVD and Red Hat Scores

For open source software shipped by multiple vendors, the CVSS base
scores may vary for each vendor's version, depending on the version
they ship, how they ship it, the platform, and even how the software
is compiled. This makes scoring vulnerabilities difficult for
third-party vulnerability databases, such as NVD, who can give only a
single CVSS base score to each vulnerability, or when comparing to
other vendors who score based on the characteristics of use in their
own products. See the
[National Vulnerability Database](https://nvd.nist.gov/vuln-metrics/cvss)
for more information regarding NVD security ratings.

These differences can cause the scores to vary widely. Other reasons
may include how the source code was compiled with certain compiler
flags or hardening technologies that reduce or eliminate the security
severity of a flaw, or how the software is used within the product.
Software running standalone may suffer from a flaw, but its use within
a product may preclude the vulnerable code from ever being used in a
way that could be exploited.

For example, NVD may rate a flaw in a particular service as having
High Impact on the CVSS CIA Triad (Confidentiality, Integrity,
Availability) where the service in question is typically run as the
root user with full privileges on a system. However, in a Red Hat
product, the service may be specifically configured to run as a
dedicated non-privileged user running entirely in a SELinux sandbox,
greatly reducing the immediate impact from compromise, resulting in
Low impact.

For these reasons, we recommend that, whenever possible, you use a
CVSS base score provided by Red Hat in preference to a score from a
third party. Please
[let us know](https://access.redhat.com/site/security/team/contact/)
if you believe we have given an incorrect CVSS v3 base score for a
particular vulnerability. We are happy to discuss and update if
needed.

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com)

### Help

* [Contact Customer Portal](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Systems Status

### About

* [Red Hat Subscription Value](https://access.redhat.com/subscription-value)
* [About Red Hat](https://www.redhat.com/about/)
* [Red Hat Jobs](http://jobs.redhat.com)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

Copyright © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)

×
### Formatting Tips

Here are the common uses of Markdown.

Code blocks
```
~~~
Code surrounded in tildes is easier to read
~~~
```

Links/URLs`[Red Hat Customer Portal](https://access.redhat.com)`

[Learn more](/help/markdown)
Close



=== Content from www.redhat.com_b139e314_20250126_045732.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from git.kernel.org_4b9448dd_20250125_010537.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=687cb0884a714ff484d038e9190edc874edcf146)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=687cb0884a714ff484d038e9190edc874edcf146)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=687cb0884a714ff484d038e9190edc874edcf146)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=687cb0884a714ff484d038e9190edc874edcf146)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Wang Nan <wangnan0@huawei.com> | 2017-11-29 16:09:58 -0800 |
| --- | --- | --- |
| committer | Linus Torvalds <torvalds@linux-foundation.org> | 2017-11-29 18:40:42 -0800 |
| commit | [687cb0884a714ff484d038e9190edc874edcf146](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=687cb0884a714ff484d038e9190edc874edcf146) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=687cb0884a714ff484d038e9190edc874edcf146)) | |
| tree | [2f0ec6e18e1a95836be2e618bba7d8911c9c07c5](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=687cb0884a714ff484d038e9190edc874edcf146) | |
| parent | [4b81cb2ff69c8a8e297a147d2eb4d9b5e8d7c435](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=4b81cb2ff69c8a8e297a147d2eb4d9b5e8d7c435) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=687cb0884a714ff484d038e9190edc874edcf146&id2=4b81cb2ff69c8a8e297a147d2eb4d9b5e8d7c435)) | |
| download | [linux-687cb0884a714ff484d038e9190edc874edcf146.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-687cb0884a714ff484d038e9190edc874edcf146.tar.gz) | |

mm, oom\_reaper: gather each vma to prevent leaking TLB entrytlb\_gather\_mmu(&tlb, mm, 0, -1) means gathering the whole virtual memory
space. In this case, tlb->fullmm is true. Some archs like arm64
doesn't flush TLB when tlb->fullmm is true:
commit 5a7862e83000 ("arm64: tlbflush: avoid flushing when fullmm == 1").
Which causes leaking of tlb entries.
Will clarifies his patch:
"Basically, we tag each address space with an ASID (PCID on x86) which
is resident in the TLB. This means we can elide TLB invalidation when
pulling down a full mm because we won't ever assign that ASID to
another mm without doing TLB invalidation elsewhere (which actually
just nukes the whole TLB).
I think that means that we could potentially not fault on a kernel
uaccess, because we could hit in the TLB"
There could be a window between complete\_signal() sending IPI to other
cores and all threads sharing this mm are really kicked off from cores.
In this window, the oom reaper may calls tlb\_flush\_mmu\_tlbonly() to
flush TLB then frees pages. However, due to the above problem, the TLB
entries are not really flushed on arm64. Other threads are possible to
access these pages through TLB entries. Moreover, a copy\_to\_user() can
also write to these pages without generating page fault, causes
use-after-free bugs.
This patch gathers each vma instead of gathering full vm space. In this
case tlb->fullmm is not true. The behavior of oom reaper become similar
to munmapping before do\_exit, which should be safe for all archs.
Link: [http://lkml.kernel.org/r/20171107095453.179940-1-wangnan0@huawei.com](http://lkml.kernel.org/r/20171107095453.179940-1-wangnan0%40huawei.com)
Fixes: aac453635549 ("mm, oom: introduce oom reaper")
Signed-off-by: Wang Nan <wangnan0@huawei.com>
Acked-by: Michal Hocko <mhocko@suse.com>
Acked-by: David Rientjes <rientjes@google.com>
Cc: Minchan Kim <minchan@kernel.org>
Cc: Will Deacon <will.deacon@arm.com>
Cc: Bob Liu <liubo95@huawei.com>
Cc: Ingo Molnar <mingo@kernel.org>
Cc: Roman Gushchin <guro@fb.com>
Cc: Konstantin Khlebnikov <khlebnikov@yandex-team.ru>
Cc: Andrea Arcangeli <aarcange@redhat.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=687cb0884a714ff484d038e9190edc874edcf146)

| -rw-r--r-- | [mm/oom\_kill.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/mm/oom_kill.c?id=687cb0884a714ff484d038e9190edc874edcf146) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 3 deletions

| diff --git a/mm/oom\_kill.c b/mm/oom\_kill.cindex c86fbd1b590ecd..c957be32b27a9e 100644--- a/[mm/oom\_kill.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/oom_kill.c?id=4b81cb2ff69c8a8e297a147d2eb4d9b5e8d7c435)+++ b/[mm/oom\_kill.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/oom_kill.c?id=687cb0884a714ff484d038e9190edc874edcf146)@@ -550,7 +550,6 @@ static bool \_\_oom\_reap\_task\_mm(struct task\_struct \*tsk, struct mm\_struct \*mm) \*/ set\_bit(MMF\_UNSTABLE, &mm->flags); - tlb\_gather\_mmu(&tlb, mm, 0, -1); for (vma = mm->mmap ; vma; vma = vma->vm\_next) { if (!can\_madv\_dontneed\_vma(vma)) continue;@@ -565,11 +564,13 @@ static bool \_\_oom\_reap\_task\_mm(struct task\_struct \*tsk, struct mm\_struct \*mm) \* we do not want to block exit\_mmap by keeping mm ref \* count elevated without a good reason. \*/- if (vma\_is\_anonymous(vma) || !(vma->vm\_flags & VM\_SHARED))+ if (vma\_is\_anonymous(vma) || !(vma->vm\_flags & VM\_SHARED)) {+ tlb\_gather\_mmu(&tlb, mm, vma->vm\_start, vma->vm\_end); unmap\_page\_range(&tlb, vma, vma->vm\_start, vma->vm\_end, NULL);+ tlb\_finish\_mmu(&tlb, vma->vm\_start, vma->vm\_end);+ } }- tlb\_finish\_mmu(&tlb, 0, -1); pr\_info("oom\_reaper: reaped process %d (%s), now anon-rss:%lukB, file-rss:%lukB, shmem-rss:%lukB\n", task\_pid\_nr(tsk), tsk->comm, K(get\_mm\_counter(mm, MM\_ANONPAGES)), |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-25 01:04:14 +0000



=== Content from access.redhat.com_b0b71310_20250126_045731.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from access.redhat.com_5505109f_20250125_010537.html ===

Note: Our personalized web services require that your browser be enabled for JavaScript and cookies

[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

[Red Hat Product Errata](/errata)
RHSA-2018:2772 - Security Advisory

Issued:
2018-09-25
Updated:
2018-09-25
# RHSA-2018:2772 - Security Advisory

* [Overview](#overview)
* [Updated Packages](#packages)

## Synopsis

Important: kernel-alt security and bug fix update

## Type/Severity

Security Advisory: Important

## Red Hat Insights patch analysis

Identify and remediate systems affected by this advisory.

[View affected systems](https://console.redhat.com/insights/patch/advisories/RHSA-2018%3A2772)

## Topic

An update for kernel-alt is now available for Red Hat Enterprise Linux 7.

Red Hat Product Security has rated this update as having a security impact of Important. A Common Vulnerability Scoring System (CVSS) base score, which gives a detailed severity rating, is available for each vulnerability from the CVE link(s) in the References section.

## Description

The kernel-alt packages provide the Linux kernel version 4.x.

Security Fix(es):

* kernel: Infoleak/use-after-free in \_\_oom\_reap\_task\_mm function in mm/oom\_kill.c (CVE-2017-18202)

For more details about the security issue(s), including the impact, a CVSS score, and other related information, refer to the CVE page(s) listed in the References section.

Bug Fix(es):

* Previously, on certain little-endian variants of IBM Power Systems, there was no “sysfs spec\_store\_bypass” file. As a consequence, there was no way to indicate the Speculative Store Bypass Disable (SSBD) mitigation status. This update adds infrastructure code into the kernel to create the /sys/devices/system/cpu/vulnerabilities/\* files. As a result, sysfs spec\_store\_bypass shows whether the SSBD mitigation is disabled or enabled. (BZ#1602340)
* Previously, the kernel architectures for IBM z Systems were missing support to display the status of the Spectre v2 mitigations. As a consequence, the /sys/devices/system/cpu/vulnerabilities/spectre\_v2 file did not exist. With this update, the kernel now shows the status in the above mentioned file and as a result, the file now reports either "Vulnerable" or "Mitigation: execute trampolines" message. (BZ#1619667)

## Solution

For details on how to apply this update, which includes the changes described in this advisory, refer to:

<https://access.redhat.com/articles/11258>

The system must be rebooted for this update to take effect.

## Affected Products

* Red Hat Enterprise Linux for ARM 64 7 aarch64
* Red Hat Enterprise Linux for Power 9 7 ppc64le
* Red Hat Enterprise Linux for IBM System z (Structure A) 7 s390x

## Fixes

* [BZ - 1549621](https://bugzilla.redhat.com/show_bug.cgi?id=1549621)
  - CVE-2017-18202 kernel: Infoleak/use-after-free in \_\_oom\_reap\_task\_mm function in mm/oom\_kill.c

## CVEs

* [CVE-2017-18202](https://www.redhat.com/security/data/cve/CVE-2017-18202.html)

## References

* <https://access.redhat.com/security/updates/classification/#important>
* <https://access.redhat.com/security/cve/CVE-2017-18202>

**Note:**
More recent versions of these packages may be available.
Click a package name for more details.
## Red Hat Enterprise Linux for ARM 64 7

| SRPM | |
| --- | --- |
| kernel-alt-4.14.0-49.13.1.el7a.src.rpm | SHA-256: b396be3722377668c5a1864c65caa4802a1999aff43b4991dc520d9b2e7b5ae3 |
| aarch64 | |
| kernel-4.14.0-49.13.1.el7a.aarch64.rpm | SHA-256: 678036eef8118d3eb12280785a871ba1f9368e69e531ab6a2841149b85a81a3a |
| kernel-abi-whitelists-4.14.0-49.13.1.el7a.noarch.rpm | SHA-256: f4629f6e98d7aa6f5e2a8dd4feea236b9aca2f127e90265299e7063c229e0190 |
| kernel-debug-4.14.0-49.13.1.el7a.aarch64.rpm | SHA-256: 17f25803fe245df3bff7652508e6110b8c9aa4cb1342fb0f09b8dd1d9f78738f |
| kernel-debug-debuginfo-4.14.0-49.13.1.el7a.aarch64.rpm | SHA-256: b594ce3b43fad67f4ccd282e87393665a9acedc2d78d4b5b25a3518cc0f55a5e |
| kernel-debug-debuginfo-4.14.0-49.13.1.el7a.aarch64.rpm | SHA-256: b594ce3b43fad67f4ccd282e87393665a9acedc2d78d4b5b25a3518cc0f55a5e |
| kernel-debug-devel-4.14.0-49.13.1.el7a.aarch64.rpm | SHA-256: eda9d9965b5368d5419a0e7590315f0290513fddc1431b7a4807d9d3c1cf34f0 |
| kernel-debuginfo-4.14.0-49.13.1.el7a.aarch64.rpm | SHA-256: 234e39494b0037b7f962a3df199e4f467d92088685be92f97a161d04c65cedcf |
| kernel-debuginfo-4.14.0-49.13.1.el7a.aarch64.rpm | SHA-256: 234e39494b0037b7f962a3df199e4f467d92088685be92f97a161d04c65cedcf |
| kernel-debuginfo-common-aarch64-4.14.0-49.13.1.el7a.aarch64.rpm | SHA-256: bf9e89e5b0c05ebdb4c54e229169a7ee8e70682449b0b57dd1d7bb6dfa822684 |
| kernel-debuginfo-common-aarch64-4.14.0-49.13.1.el7a.aarch64.rpm | SHA-256: bf9e89e5b0c05ebdb4c54e229169a7ee8e70682449b0b57dd1d7bb6dfa822684 |
| kernel-devel-4.14.0-49.13.1.el7a.aarch64.rpm | SHA-256: 0c37b6bf4a37a672af1c32f3332e4c966d76b0699b04fb66ff9d7ac7170890ef |
| kernel-doc-4.14.0-49.13.1.el7a.noarch.rpm | SHA-256: 2a8cdd106fdd01ef3cee9da289f1f17bd87b87dbbc9bd331c0d7dbb42469f387 |
| kernel-headers-4.14.0-49.13.1.el7a.aarch64.rpm | SHA-256: cf641f422af563b4245587d1e04da67a891d36e7c0c67d19e7977634d31b4055 |
| kernel-tools-4.14.0-49.13.1.el7a.aarch64.rpm | SHA-256: d557fe4657a594f48dd103defa48b6737284c947bb0fba4e30c11c640e924296 |
| kernel-tools-debuginfo-4.14.0-49.13.1.el7a.aarch64.rpm | SHA-256: 889c9a0e4961dbe8734098ab8d82822282387b53351155ed5aad45027e712d3e |
| kernel-tools-debuginfo-4.14.0-49.13.1.el7a.aarch64.rpm | SHA-256: 889c9a0e4961dbe8734098ab8d82822282387b53351155ed5aad45027e712d3e |
| kernel-tools-libs-4.14.0-49.13.1.el7a.aarch64.rpm | SHA-256: 2714d8c059dc606a0e4a6dee924b8a17bef662da3247da85c115be3ca3f49aa4 |
| kernel-tools-libs-devel-4.14.0-49.13.1.el7a.aarch64.rpm | SHA-256: d43216bf8d0bd5cb27100ffda9030c277638b772b8f841ade6d6fdad5245e22c |
| perf-4.14.0-49.13.1.el7a.aarch64.rpm | SHA-256: 3d09ed98e7591dfd752d50ec72fad9b8a5db881e297b734c1d9f018ca23dd5bf |
| perf-debuginfo-4.14.0-49.13.1.el7a.aarch64.rpm | SHA-256: 2ef792da4028718cc825e5d2b82b2e0c58f618d7d66ff7bafe6c3318334bc3e4 |
| perf-debuginfo-4.14.0-49.13.1.el7a.aarch64.rpm | SHA-256: 2ef792da4028718cc825e5d2b82b2e0c58f618d7d66ff7bafe6c3318334bc3e4 |
| python-perf-4.14.0-49.13.1.el7a.aarch64.rpm | SHA-256: ccdcf24dc8e00acfe517cb055452c87740429188b1b9d83211112b0da005debd |
| python-perf-debuginfo-4.14.0-49.13.1.el7a.aarch64.rpm | SHA-256: 9d6ce19795f7533fed5e79f904aae3153109d5c1583fe512d5987a91f472bf44 |
| python-perf-debuginfo-4.14.0-49.13.1.el7a.aarch64.rpm | SHA-256: 9d6ce19795f7533fed5e79f904aae3153109d5c1583fe512d5987a91f472bf44 |

## Red Hat Enterprise Linux for Power 9 7

| SRPM | |
| --- | --- |
| kernel-alt-4.14.0-49.13.1.el7a.src.rpm | SHA-256: b396be3722377668c5a1864c65caa4802a1999aff43b4991dc520d9b2e7b5ae3 |
| ppc64le | |
| kernel-4.14.0-49.13.1.el7a.ppc64le.rpm | SHA-256: 188a50c704595f10bb999d3a1bd6e583d887ee3258dd38afcfa43a1adbdb8183 |
| kernel-abi-whitelists-4.14.0-49.13.1.el7a.noarch.rpm | SHA-256: f4629f6e98d7aa6f5e2a8dd4feea236b9aca2f127e90265299e7063c229e0190 |
| kernel-bootwrapper-4.14.0-49.13.1.el7a.ppc64le.rpm | SHA-256: c252863c89592df023c0c7b65729c2b676f5aa06cfbeb804d57b34c0ab17e1dc |
| kernel-debug-4.14.0-49.13.1.el7a.ppc64le.rpm | SHA-256: 4868e1788f206319e4c6800574f3a7dfd734b16929d4456159cf6fee4ca02bbf |
| kernel-debug-debuginfo-4.14.0-49.13.1.el7a.ppc64le.rpm | SHA-256: 96c409249c3a0457e21b574dd56ee1541e1eec060c3756837b38121ba971d970 |
| kernel-debug-debuginfo-4.14.0-49.13.1.el7a.ppc64le.rpm | SHA-256: 96c409249c3a0457e21b574dd56ee1541e1eec060c3756837b38121ba971d970 |
| kernel-debug-devel-4.14.0-49.13.1.el7a.ppc64le.rpm | SHA-256: c8eb9006e1825589d75fe6a73c2fd8c3afe7a67f94e2cbae09a7dc250c7f1222 |
| kernel-debuginfo-4.14.0-49.13.1.el7a.ppc64le.rpm | SHA-256: f0b8f2955ae97ece173591061dec6e1205a8af43baafa77c540bff5092a5cfb0 |
| kernel-debuginfo-4.14.0-49.13.1.el7a.ppc64le.rpm | SHA-256: f0b8f2955ae97ece173591061dec6e1205a8af43baafa77c540bff5092a5cfb0 |
| kernel-debuginfo-common-ppc64le-4.14.0-49.13.1.el7a.ppc64le.rpm | SHA-256: f15c52322d1e4e3b79da5a13b619be6e3fbf7444c9c75e53a8c4cf6d4dd595ee |
| kernel-debuginfo-common-ppc64le-4.14.0-49.13.1.el7a.ppc64le.rpm | SHA-256: f15c52322d1e4e3b79da5a13b619be6e3fbf7444c9c75e53a8c4cf6d4dd595ee |
| kernel-devel-4.14.0-49.13.1.el7a.ppc64le.rpm | SHA-256: bbce28c4fe2bad8b573bba06aafe43ca9f8ccf5e429f27b9841eae8bf5f6257c |
| kernel-doc-4.14.0-49.13.1.el7a.noarch.rpm | SHA-256: 2a8cdd106fdd01ef3cee9da289f1f17bd87b87dbbc9bd331c0d7dbb42469f387 |
| kernel-headers-4.14.0-49.13.1.el7a.ppc64le.rpm | SHA-256: e0d450b8652eb17cf8a482d6ea12af34b9b8949f521a8f958e8d07b4530b8cbe |
| kernel-tools-4.14.0-49.13.1.el7a.ppc64le.rpm | SHA-256: d28c99b8fae01fe92a2b70cf3b15ba26c4ec87e194115ebfe8878b4a310134fa |
| kernel-tools-debuginfo-4.14.0-49.13.1.el7a.ppc64le.rpm | SHA-256: 1bb16c4da1a3e56e1962da466b8dbddfbe02372640d0f33f97a97378987eb738 |
| kernel-tools-debuginfo-4.14.0-49.13.1.el7a.ppc64le.rpm | SHA-256: 1bb16c4da1a3e56e1962da466b8dbddfbe02372640d0f33f97a97378987eb738 |
| kernel-tools-libs-4.14.0-49.13.1.el7a.ppc64le.rpm | SHA-256: e377df4f87d72d59f4d98e8a736d53b016d97b3b064b5351f4861cf342c4150e |
| kernel-tools-libs-devel-4.14.0-49.13.1.el7a.ppc64le.rpm | SHA-256: e0eceecf8721d872cb5d06e8cf8e79c2e93d0ad60f82837edb8ca6b555bbdd0d |
| perf-4.14.0-49.13.1.el7a.ppc64le.rpm | SHA-256: 05c5366a0709f2797fd9ada0793fd670ac5454daead906ad1396224709805acc |
| perf-debuginfo-4.14.0-49.13.1.el7a.ppc64le.rpm | SHA-256: d868376cfda3a005a8be85f5b8bb8bb8f11bcc1158f2f750020217647ebe5def |
| perf-debuginfo-4.14.0-49.13.1.el7a.ppc64le.rpm | SHA-256: d868376cfda3a005a8be85f5b8bb8bb8f11bcc1158f2f750020217647ebe5def |
| python-perf-4.14.0-49.13.1.el7a.ppc64le.rpm | SHA-256: 1040ad15f0dc2bc608ba5f17969d64844b720dd724edc8534624d406b2cc1024 |
| python-perf-debuginfo-4.14.0-49.13.1.el7a.ppc64le.rpm | SHA-256: 546e54b352e712a19381231ad1f49282d841acd3cf260f2564182c83754cfdef |
| python-perf-debuginfo-4.14.0-49.13.1.el7a.ppc64le.rpm | SHA-256: 546e54b352e712a19381231ad1f49282d841acd3cf260f2564182c83754cfdef |

## Red Hat Enterprise Linux for IBM System z (Structure A) 7

| SRPM | |
| --- | --- |
| kernel-alt-4.14.0-49.13.1.el7a.src.rpm | SHA-256: b396be3722377668c5a1864c65caa4802a1999aff43b4991dc520d9b2e7b5ae3 |
| s390x | |
| kernel-4.14.0-49.13.1.el7a.s390x.rpm | SHA-256: f1d3dc9060a5b48f5a11c8162853c7e99dda2f95f92e4a012245952f00b81830 |
| kernel-abi-whitelists-4.14.0-49.13.1.el7a.noarch.rpm | SHA-256: f4629f6e98d7aa6f5e2a8dd4feea236b9aca2f127e90265299e7063c229e0190 |
| kernel-debug-4.14.0-49.13.1.el7a.s390x.rpm | SHA-256: 6e2d1d724f39b9d4feafb9f9350acaf04360a3af34f2d740b507a398e73aa52f |
| kernel-debug-debuginfo-4.14.0-49.13.1.el7a.s390x.rpm | SHA-256: ee674a91d246adba6a43f14020368ed373fc09105af4428dc4fd0c934f83b2c6 |
| kernel-debug-devel-4.14.0-49.13.1.el7a.s390x.rpm | SHA-256: baf5fc2f6667e8962ef105c4a99be23f6013941c72b883650ea3e28ebf0c55bc |
| kernel-debuginfo-4.14.0-49.13.1.el7a.s390x.rpm | SHA-256: 5e3cbfc0ee47c9ac91b80fbca79ffd5700f05156bb20e0febcbfa420c17506cf |
| kernel-debuginfo-common-s390x-4.14.0-49.13.1.el7a.s390x.rpm | SHA-256: 37131d4aa13419d94bda9b71c8db874f5fcbfc5198f462722a8090312bd828b0 |
| kernel-devel-4.14.0-49.13.1.el7a.s390x.rpm | SHA-256: 2c3475b9b7a02232f90c857dc65f423155c4eb2af71d4b440822ce3f2ead18bd |
| kernel-doc-4.14.0-49.13.1.el7a.noarch.rpm | SHA-256: 2a8cdd106fdd01ef3cee9da289f1f17bd87b87dbbc9bd331c0d7dbb42469f387 |
| kernel-headers-4.14.0-49.13.1.el7a.s390x.rpm | SHA-256: fa0f1237b17737c5a32f5cf025ee40fb47092ebd74a4910b9d14c42865099d0b |
| kernel-kdump-4.14.0-49.13.1.el7a.s390x.rpm | SHA-256: 192a2a12a108c690c16a7c383b508b81a3b6b6ad967ea334b5671b0d08e95889 |
| kernel-kdump-debuginfo-4.14.0-49.13.1.el7a.s390x.rpm | SHA-256: a847655a0d384edd7b12144b6bc0fd1ab331dd8c0ba1fa1728243d9fb120ce6f |
| kernel-kdump-devel-4.14.0-49.13.1.el7a.s390x.rpm | SHA-256: cfc3cc2574a0338e95fcafbb6fca6cbc6d25f80cee7ca1423708ddae67d52920 |
| perf-4.14.0-49.13.1.el7a.s390x.rpm | SHA-256: a4bc85813c07aae33e09a41245b0d19c5fbca6c54e1ebff94f407a93185d73b5 |
| perf-debuginfo-4.14.0-49.13.1.el7a.s390x.rpm | SHA-256: 7353081ccfbc4427dcdb23fa887b243c6c4502cc6290eddcbacb3c12dd854102 |
| python-perf-4.14.0-49.13.1.el7a.s390x.rpm | SHA-256: 2b7518c6dfd77bcb36059a5d0a8781e2d93b65139b9a94e507b6d0cec6cdd0dc |
| python-perf-debuginfo-4.14.0-49.13.1.el7a.s390x.rpm | SHA-256: 667c67f67ed101132e75d5d2fe184153021e98db311e64c9b8d50a8efb7c58c1 |

The Red Hat security contact is secalert@redhat.com.
More contact details at <https://access.redhat.com/security/team/contact/>.

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from bugzilla.redhat.com_762bc7e3_20250126_045732.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1549621)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1549621)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1549621)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1549621

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1549621**](show_bug.cgi?id=1549621)
(CVE-2017-18202)
- [CVE-2017-18202](https://access.redhat.com/security/cve/CVE-2017-18202) kernel: Infoleak/use-after-free in \_\_oom\_reap\_task\_mm function in mm/oom\_kill.c

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2017-18202 kernel: Infoleak/use-after-free in \_\_oom\_reap\_task\_mm function...

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2017-18202 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | high | | [Severity:](page.cgi?id=fields.html#bug_severity) | high | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [1549622](show_bug.cgi?id=1549622 "CLOSED ERRATA - CVE-2017-18202 kernel: Infoleak/User-after-free in __oom_reap_task_mm function in mm/oom_kill.c [fedora-all]") [1554355](show_bug.cgi?id=1554355) [1554356](show_bug.cgi?id=1554356) | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1549624](show_bug.cgi?id=1549624) | | TreeView+ | [depends on](buglist.cgi?bug_id=1549621&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1549621&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2018-02-27 14:02 UTC by Pedro Sampaio | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2024-12-20 18:44 UTC ([History](show_activity.cgi?id=1549621)) | | [CC List:](page.cgi?id=fields.html#cclist) | 44 users (show)  airlied ajax aquini bhu blc bskeggs dhoward ewk fhrbata hdegoede hkrzesin hwkernel-mgr iboverma ichavero itamar jarodwilson jforbes jglisse jkacur john.j5live jonathan josef jross jwboyer kernel-maint kernel-mgr labbott lgoncalv linville matt mchehab mcressma mjg59 mlangsdo nmurray plougher pmatouse rt-maint rvrbovsk skozina steved vdronov williams yozone | | Fixed In Version: | Linux 4.14.4 | | | Doc Type: | If docs needed, set a value | | | Doc Text: | The \_\_oom\_reap\_task\_mm function in mm/oom\_kill.c in the Linux kernel, before 4.14.4, mishandles gather operations. This allows attackers to cause a denial of service (TLB entry leak or use-after-free) or possibly have unspecified other impact by triggering a copy\_to\_user call within a certain time window. | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2019-06-08 03:41:35 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Red Hat Product Errata | [RHSA-2018:2772](https://access.redhat.com/errata/RHSA-2018%3A2772) | 0 | None | None | None | 2018-09-25 17:54:54 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1549621#c0)  Pedro Sampaio    2018-02-27 14:02:22 UTC  ``` The __oom_reap_task_mm function in mm/oom_kill.c in the Linux kernel before 4.14.4 mishandles gather operations, which allows attackers to cause a denial of service (TLB entry leak or use-after-free) or possibly have unspecified other impact by triggering a copy_to_user call within a certain time window.  References:  <https://marc.info/?t=151004877700005&r=1&w=2>  An upsteam patch:  <https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=687cb0884a714ff484d038e9190edc874edcf146>   ```  [Comment 1](show_bug.cgi?id=1549621#c1)  Pedro Sampaio    2018-02-27 14:02:51 UTC  ``` Created kernel tracking bugs for this issue:  Affects: fedora-all [[bug 1549622](show_bug.cgi?id=1549622 "CLOSED ERRATA - CVE-2017-18202 kernel: Infoleak/User-after-free in __oom_reap_task_mm function in mm/oom_kill.c [fedora-all]")]   ```  [Comment 2](show_bug.cgi?id=1549621#c2)  Justin M. Forbes    2018-02-27 15:27:13 UTC  ``` This was fixed for fedora with the 4.14.4 stable updates.   ```  [Comment 7](show_bug.cgi?id=1549621#c7)  errata-xmlrpc    2018-09-25 17:54:32 UTC  ``` This issue has been addressed in the following products:    Red Hat Enterprise Linux 7  Via RHSA-2018:2772 [https://access.redhat.com/errata/RHSA-2018:2772](https://access.redhat.com/errata/RHSA-2018%3A2772)   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1549621&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from www.kernel.org_5cbaf851_20250125_010540.html ===
commit 51a2a68fde2035887c0d74aee1c9569c691dfd61
Author: Greg Kroah-Hartman
Date: Tue Dec 5 11:26:38 2017 +0100
Linux 4.14.4
commit e49d722f26b904015077655bff47cdbde049226a
Author: Greg Kroah-Hartman
Date: Mon Dec 4 12:59:57 2017 +0100
Revert "x86/entry/64: Add missing irqflags tracing to native\_load\_gs\_index()"
This reverts commit f9a64e23a9da528e7d8aa1bd2c7bb92be4ebb724 which is
commit 0d794d0d018f23fb09c50f6ae26868bd6ae343d6 upstream.
Andy writes:
I think the thing to do is to revert the patch from -stable.
The bug it fixes is very minor, and the regression is that it
made a pre-existing bug in some nearly-undebuggable core resume
code much easier to hit. I don't feel comfortable with a
backport of the latter fix until it has a good long soak in
Linus' tree.
Reported-by: Andy Lutomirski
Cc: Borislav Petkov
Cc: Brian Gerst
Cc: Dave Hansen
Cc: Josh Poimboeuf
Cc: Linus Torvalds
Cc: Peter Zijlstra
Cc: Thomas Gleixner
Cc: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit 88e1bb2a24125747d48b5e2d60bccdb247b86eb9
Author: Ville Syrjälä
Date: Thu Nov 23 21:41:57 2017 +0200
drm/i915: Prevent zero length "index" write
commit 56350fb8978bbf4aafe08f21234e161dd128b417 upstream.
The hardware always writes one or two bytes in the index portion of
an indexed transfer. Make sure the message we send as the index
doesn't have a zero length.
Cc: Daniel Kurtz
Cc: Chris Wilson
Cc: Daniel Vetter
Cc: Sean Paul
Fixes: 56f9eac05489 ("drm/i915/intel\_i2c: use INDEX cycles for i2c read transactions")
Signed-off-by: Ville Syrjälä
Link: https://patchwork.freedesktop.org/patch/msgid/20171123194157.25367-3-ville.syrjala@linux.intel.com
Reviewed-by: Chris Wilson
(cherry picked from commit bb9e0d4bca50f429152e74a459160b41f3d60fb2)
Signed-off-by: Joonas Lahtinen
Signed-off-by: Greg Kroah-Hartman
commit e522b9247ce931a7319f1d7e9d0bdfa5817b9a4e
Author: Ville Syrjälä
Date: Thu Nov 23 21:41:56 2017 +0200
drm/i915: Don't try indexed reads to alternate slave addresses
commit ae5c631e605a452a5a0e73205a92810c01ed954b upstream.
We can only specify the one slave address to indexed reads/writes.
Make sure the messages we check are destined to the same slave
address before deciding to do an indexed transfer.
Cc: Daniel Kurtz
Cc: Chris Wilson
Cc: Daniel Vetter
Cc: Sean Paul
Fixes: 56f9eac05489 ("drm/i915/intel\_i2c: use INDEX cycles for i2c read transactions")
Signed-off-by: Ville Syrjälä
Link: https://patchwork.freedesktop.org/patch/msgid/20171123194157.25367-2-ville.syrjala@linux.intel.com
Reviewed-by: Chris Wilson
(cherry picked from commit c4deb62d7821672265b87952bcd1c808f3bf3e8f)
Signed-off-by: Joonas Lahtinen
Signed-off-by: Greg Kroah-Hartman
commit 6c0d3d1d5908f5cd5c838c99663238cac201953b
Author: Xiong Zhang
Date: Tue Nov 28 07:29:54 2017 +0800
drm/i915/gvt: Correct ADDR\_4K/2M/1G\_MASK definition
commit b721b65af4eb46df6a1d9e34b14003225e403565 upstream.
For ADDR\_4K\_MASK, bit[45..12] should be 1, all other bits
should be 0. The current definition wrongly set bit[46] as 1
also. This path fixes this.
v2: Add commit message, fixes and cc stable.(Zhenyu)
Fixes: 2707e4446688("drm/i915/gvt: vGPU graphics memory virtualization")
Signed-off-by: Xiong Zhang
Signed-off-by: Zhenyu Wang
Signed-off-by: Greg Kroah-Hartman
commit 7042c2b9a19e74972f5783ab3b7ef98ebdee293f
Author: Chris Wilson
Date: Sat Nov 25 19:41:55 2017 +0000
drm/i915/fbdev: Serialise early hotplug events with async fbdev config
commit a45b30a6c5db631e2ba680304bd5edd0cd1f9643 upstream.
As both the hotplug event and fbdev configuration run asynchronously, it
is possible for them to run concurrently. If configuration fails, we were
freeing the fbdev causing a use-after-free in the hotplug event.
<7>[ 3069.935211] [drm:intel\_fb\_initial\_config [i915]] Not using firmware configuration
<7>[ 3069.935225] [drm:drm\_setup\_crtcs] looking for cmdline mode on connector 77
<7>[ 3069.935229] [drm:drm\_setup\_crtcs] looking for preferred mode on connector 77 0
<7>[ 3069.935233] [drm:drm\_setup\_crtcs] found mode 3200x1800
<7>[ 3069.935236] [drm:drm\_setup\_crtcs] picking CRTCs for 8192x8192 config
<7>[ 3069.935253] [drm:drm\_setup\_crtcs] desired mode 3200x1800 set on crtc 43 (0,0)
<7>[ 3069.935323] [drm:intelfb\_create [i915]] no BIOS fb, allocating a new one
<4>[ 3069.967737] general protection fault: 0000 [#1] PREEMPT SMP
<0>[ 3069.977453] ---------------------------------
<4>[ 3069.977457] Modules linked in: i915(+) vgem snd\_hda\_codec\_hdmi snd\_hda\_codec\_realtek snd\_hda\_codec\_generic x86\_pkg\_temp\_thermal intel\_powerclamp coretemp crct10dif\_pclmul crc32\_pclmul ghash\_clmulni\_intel snd\_hda\_codec snd\_hwdep snd\_hda\_core snd\_pcm r8169 mei\_me mii prime\_numbers mei i2c\_hid pinctrl\_geminilake pinctrl\_intel [last unloaded: i915]
<4>[ 3069.977492] CPU: 1 PID: 15414 Comm: kworker/1:0 Tainted: G U 4.14.0-CI-CI\_DRM\_3388+ #1
<4>[ 3069.977497] Hardware name: Intel Corp. Geminilake/GLK RVP1 DDR4 (05), BIOS GELKRVPA.X64.0062.B30.1708222146 08/22/2017
<4>[ 3069.977508] Workqueue: events output\_poll\_execute
<4>[ 3069.977512] task: ffff880177734e40 task.stack: ffffc90001fe4000
<4>[ 3069.977519] RIP: 0010:\_\_lock\_acquire+0x109/0x1b60
<4>[ 3069.977523] RSP: 0018:ffffc90001fe7bb0 EFLAGS: 00010002
<4>[ 3069.977526] RAX: 6b6b6b6b6b6b6b6b RBX: 0000000000000282 RCX: 0000000000000000
<4>[ 3069.977530] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff880170d4efd0
<4>[ 3069.977534] RBP: ffffc90001fe7c70 R08: 0000000000000001 R09: 0000000000000000
<4>[ 3069.977538] R10: 0000000000000000 R11: ffffffff81899609 R12: ffff880170d4efd0
<4>[ 3069.977542] R13: ffff880177734e40 R14: 0000000000000001 R15: 0000000000000000
<4>[ 3069.977547] FS: 0000000000000000(0000) GS:ffff88017fc80000(0000) knlGS:0000000000000000
<4>[ 3069.977551] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
<4>[ 3069.977555] CR2: 00007f7e8b7bcf04 CR3: 0000000003e0f000 CR4: 00000000003406e0
<4>[ 3069.977559] Call Trace:
<4>[ 3069.977565] ? mark\_held\_locks+0x64/0x90
<4>[ 3069.977571] ? \_raw\_spin\_unlock\_irq+0x24/0x50
<4>[ 3069.977575] ? \_raw\_spin\_unlock\_irq+0x24/0x50
<4>[ 3069.977579] ? trace\_hardirqs\_on\_caller+0xde/0x1c0
<4>[ 3069.977583] ? \_raw\_spin\_unlock\_irq+0x2f/0x50
<4>[ 3069.977588] ? finish\_task\_switch+0xa5/0x210
<4>[ 3069.977592] ? lock\_acquire+0xaf/0x200
<4>[ 3069.977596] lock\_acquire+0xaf/0x200
<4>[ 3069.977600] ? \_\_mutex\_lock+0x5e9/0x9b0
<4>[ 3069.977604] \_raw\_spin\_lock+0x2a/0x40
<4>[ 3069.977608] ? \_\_mutex\_lock+0x5e9/0x9b0
<4>[ 3069.977612] \_\_mutex\_lock+0x5e9/0x9b0
<4>[ 3069.977616] ? drm\_fb\_helper\_hotplug\_event.part.19+0x16/0xa0
<4>[ 3069.977621] ? drm\_fb\_helper\_hotplug\_event.part.19+0x16/0xa0
<4>[ 3069.977625] drm\_fb\_helper\_hotplug\_event.part.19+0x16/0xa0
<4>[ 3069.977630] output\_poll\_execute+0x8d/0x180
<4>[ 3069.977635] process\_one\_work+0x22e/0x660
<4>[ 3069.977640] worker\_thread+0x48/0x3a0
<4>[ 3069.977644] ? \_raw\_spin\_unlock\_irqrestore+0x4c/0x60
<4>[ 3069.977649] kthread+0x102/0x140
<4>[ 3069.977653] ? process\_one\_work+0x660/0x660
<4>[ 3069.977657] ? kthread\_create\_on\_node+0x40/0x40
<4>[ 3069.977662] ret\_from\_fork+0x27/0x40
<4>[ 3069.977666] Code: 8d 62 f8 c3 49 81 3c 24 e0 fa 3c 82 41 be 00 00 00 00 45 0f 45 f0 83 fe 01 77 86 89 f0 49 8b 44 c4 08 48 85 c0 0f 84 76 ff ff ff  ff 80 38 01 00 00 8b 1d 62 f9 e8 01 45 8b 85 b8 08 00 00 85
<1>[ 3069.977707] RIP: \_\_lock\_acquire+0x109/0x1b60 RSP: ffffc90001fe7bb0
<4>[ 3069.977712] ---[ end trace 4ad012eb3af62df7 ]---
In order to keep the dev\_priv->ifbdev alive after failure, we have to
avoid the free and leave it empty until we unload the module (which is
less than ideal, but a necessary evil for simplicity). Then we can use
intel\_fbdev\_sync() to serialise the hotplug event with the configuration.
The serialisation between the two was removed in commit 934458c2c95d
("Revert "drm/i915: Fix races on fbdev""), but the use after free is much
older, commit 366e39b4d2c5 ("drm/i915: Tear down fbdev if initialization
fails")
Fixes: 366e39b4d2c5 ("drm/i915: Tear down fbdev if initialization fails")
Fixes: 934458c2c95d ("Revert "drm/i915: Fix races on fbdev"")
Signed-off-by: Chris Wilson
Cc: Lukas Wunner
Cc: Joonas Lahtinen
Cc: Daniel Vetter
Reviewed-by: Lukas Wunner
Link: https://patchwork.freedesktop.org/patch/msgid/20171125194155.355-1-chris@chris-wilson.co.uk
(cherry picked from commit ad88d7fc6c032ddfb32b8d496a070ab71de3a64f)
Signed-off-by: Joonas Lahtinen
Signed-off-by: Greg Kroah-Hartman
commit 569e3d1de49f0896733de8e709fc1fd28034d7dc
Author: Hans de Goede
Date: Tue Nov 14 14:55:17 2017 +0100
drm/i915: Re-register PMIC bus access notifier on runtime resume
commit 294cf1af8cf2eb0d1eced377fdfb9a2d3f0e8b42 upstream.
intel\_uncore\_suspend() unregisters the uncore code's PMIC bus access
notifier and gets called on both normal and runtime suspend.
intel\_uncore\_resume\_early() re-registers the notifier, but only on
normal resume. Add a new intel\_uncore\_runtime\_resume() function which
only re-registers the notifier and call that on runtime resume.
Reported-by: Imre Deak
Reviewed-by: Imre Deak
Signed-off-by: Hans de Goede
Link: https://patchwork.freedesktop.org/patch/msgid/20171114135518.15981-2-hdegoede@redhat.com
(cherry picked from commit bedf4d79c3654921839b62246b0965ddb308b201)
Signed-off-by: Jani Nikula
Signed-off-by: Greg Kroah-Hartman
commit 6613dc721fc232698aafd0f6e214137cfda61e35
Author: Hans de Goede
Date: Fri Nov 10 16:03:01 2017 +0100
drm/i915: Fix false-positive assert\_rpm\_wakelock\_held in i915\_pmic\_bus\_access\_notifier v2
commit f4359cedfb43b934f38c50d1604db21333abe57b upstream.
assert\_rpm\_wakelock\_held is triggered from i915\_pmic\_bus\_access\_notifier
even though it gets unregistered on (runtime) suspend, this is caused
by a race happening under the following circumstances:
intel\_runtime\_pm\_put does:
atomic\_dec(&dev\_priv->pm.wakeref\_count);
pm\_runtime\_mark\_last\_busy(kdev);
pm\_runtime\_put\_autosuspend(kdev);
And pm\_runtime\_put\_autosuspend calls intel\_runtime\_suspend from
a workqueue, so there is ample of time between the atomic\_dec() and
intel\_runtime\_suspend() unregistering the notifier. If the notifier
gets called in this windowd assert\_rpm\_wakelock\_held falsely triggers
(at this point we're not runtime-suspended yet).
This commit adds disable\_rpm\_wakeref\_asserts and
enable\_rpm\_wakeref\_asserts calls around the
intel\_uncore\_forcewake\_get(FORCEWAKE\_ALL) call in
i915\_pmic\_bus\_access\_notifier fixing the false-positive WARN\_ON.
Changes in v2:
-Reword comment explaining why disabling the wakeref asserts is
ok and necessary
Reported-by: FKr
Reviewed-by: Imre Deak
Signed-off-by: Hans de Goede
Link: https://patchwork.freedesktop.org/patch/msgid/20171110150301.9601-2-hdegoede@redhat.com
(cherry picked from commit ce30560c80dead91e98a03d90fb8791e57a9b69d)
Signed-off-by: Jani Nikula
Signed-off-by: Greg Kroah-Hartman
commit a67936842ba66eb229e6322856fefd2310e0b3fb
Author: NeilBrown
Date: Tue Oct 17 14:24:09 2017 +1100
md: forbid a RAID5 from having both a bitmap and a journal.
commit 230b55fa8d64007339319539f8f8e68114d08529 upstream.
Having both a bitmap and a journal is pointless.
Attempting to do so can corrupt the bitmap if the journal
replay happens before the bitmap is initialized.
Rather than try to avoid this corruption, simply
refuse to allow arrays with both a bitmap and a journal.
So:
- if raid5\_run sees both are present, fail.
- if adding a bitmap finds a journal is present, fail
- if adding a journal finds a bitmap is present, fail.
Signed-off-by: NeilBrown
Tested-by: Joshua Kinard
Acked-by: Joshua Kinard
Signed-off-by: Shaohua Li
Signed-off-by: Greg Kroah-Hartman
commit 635526b896ca34fff5487d3ac00d04afbee7e1e4
Author: Sasha Neftin
Date: Mon Nov 6 08:31:59 2017 +0200
e1000e: fix the use of magic numbers for buffer overrun issue
commit c0f4b163a03e73055dd734eaca64b9580e72e7fb upstream.
This is a follow on to commit b10effb92e27 ("fix buffer overrun while the
I219 is processing DMA transactions") to address David Laights concerns
about the use of "magic" numbers. So define masks as well as add
additional code comments to give a better understanding of what needs to
be done to avoid a buffer overrun.
Signed-off-by: Sasha Neftin
Reviewed-by: Alexander H Duyck
Reviewed-by: Dima Ruinskiy
Reviewed-by: Raanan Avargil
Tested-by: Aaron Brown
Signed-off-by: Jeff Kirsher
Signed-off-by: Greg Kroah-Hartman
commit c48f3c04984557e34cf2b7194eb4d7947edccc5e
Author: Don Hiatt
Date: Mon Oct 2 11:04:55 2017 -0700
IB/hfi1: Do not warn on lid conversions for OPA
commit 4988be5813ff2afdc0d8bfa315ef34a577d3efbf upstream.
On OPA devices opa\_local\_smp\_check will receive 32Bit LIDs when the LID
is Extended. In such cases, it is okay to lose the upper 16 bits of the
LID as this information is obtained elsewhere. Do not issue a warning
when calling ib\_lid\_cpu16() in this case by masking out the upper 16Bits.
[75920.148985] ------------[ cut here ]------------
[75920.154651] WARNING: CPU: 0 PID: 1718 at ./include/rdma/ib\_verbs.h:3788 hfi1\_process\_mad+0x1c1f/0x1c80 [hfi1]
[75920.166192] Modules linked in: ib\_ipoib hfi1(E) rdmavt(E) rdma\_ucm(E) ib\_ucm(E) rdma\_cm(E) ib\_cm(E) iw\_cm(E) ib\_umad(E) ib\_uverbs(E) ib\_core(E) libiscsi scsi\_transport\_iscsi dm\_mirror dm\_region\_hash dm\_log dm\_mod dax x86\_pkg\_temp\_thermal intel\_powerclamp coretemp kvm irqbypass crct10dif\_pclmul crc32\_pclmul ghash\_clmulni\_intel pcbc aesni\_intel mei\_me ipmi\_si iTCO\_wdt iTCO\_vendor\_support crypto\_simd ipmi\_devintf pcspkr mei sg i2c\_i801 glue\_helper lpc\_ich shpchp ioatdma mfd\_core wmi ipmi\_msghandler cryptd acpi\_power\_meter acpi\_pad nfsd auth\_rpcgss nfs\_acl lockd grace sunrpc ip\_tables xfs libcrc32c sd\_mod mgag200 drm\_kms\_helper syscopyarea sysfillrect sysimgblt fb\_sys\_fops ttm drm igb ptp ahci libahci pps\_core crc32c\_intel libata dca i2c\_algo\_bit i2c\_core [last unloaded: ib\_core]
[75920.246331] CPU: 0 PID: 1718 Comm: kworker/0:1H Tainted: G W I E 4.13.0-rc7+ #1
[75920.255907] Hardware name: Intel Corporation S2600WT2/S2600WT2, BIOS SE5C610.86B.01.01.0008.021120151325 02/11/2015
[75920.268158] Workqueue: ib-comp-wq ib\_cq\_poll\_work [ib\_core]
[75920.274934] task: ffff88084a718000 task.stack: ffffc9000a424000
[75920.282123] RIP: 0010:hfi1\_process\_mad+0x1c1f/0x1c80 [hfi1]
[75920.288881] RSP: 0018:ffffc9000a427c38 EFLAGS: 00010206
[75920.295265] RAX: 0000000000010001 RBX: ffff8808361420e8 RCX: ffff880837811d80
[75920.303784] RDX: 0000000000000002 RSI: 0000000000007fff RDI: ffff880837811d80
[75920.312302] RBP: ffffc9000a427d38 R08: 0000000000000000 R09: ffff8808361420e8
[75920.320819] R10: ffff88083841f0e8 R11: ffffc9000a427da8 R12: 0000000000000001
[75920.329335] R13: ffff880837810000 R14: 0000000000000000 R15: ffff88084f1a4800
[75920.337849] FS: 0000000000000000(0000) GS:ffff88085f400000(0000) knlGS:0000000000000000
[75920.347450] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[75920.354405] CR2: 00007f9e4b3d9000 CR3: 0000000001c09000 CR4: 00000000001406f0
[75920.362947] Call Trace:
[75920.366257] ? ib\_mad\_recv\_done+0x258/0x9b0 [ib\_core]
[75920.372457] ? ib\_mad\_recv\_done+0x258/0x9b0 [ib\_core]
[75920.378652] ? \_\_kmalloc+0x1df/0x210
[75920.383229] ib\_mad\_recv\_done+0x305/0x9b0 [ib\_core]
[75920.389270] \_\_ib\_process\_cq+0x5d/0xb0 [ib\_core]
[75920.395032] ib\_cq\_poll\_work+0x20/0x60 [ib\_core]
[75920.400777] process\_one\_work+0x149/0x360
[75920.405836] worker\_thread+0x4d/0x3c0
[75920.410505] kthread+0x109/0x140
[75920.414681] ? rescuer\_thread+0x380/0x380
[75920.419731] ? kthread\_park+0x60/0x60
[75920.424406] ret\_from\_fork+0x25/0x30
[75920.428972] Code: 4c 89 9d 58 ff ff ff 49 89 45 00 66 b8 00 02 49 89 45 08 e8 44 27 89 e0 4c 8b 9d 58 ff ff ff e9 d8 f6 ff ff 0f ff e9 55 e7 ff ff <0f> ff e9 3b e5 ff ff 0f ff 0f 1f 84 00 00 00 00 00 e9 4b e9 ff
[75921.451269] ---[ end trace cf26df27c9597265 ]---
Fixes: 62ede7779904 ("Add OPA extended LID support")
Reviewed-by: Mike Marciniszyn
Signed-off-by: Don Hiatt
Signed-off-by: Dennis Dalessandro
Reviewed-by: Leon Romanovsky
Signed-off-by: Doug Ledford
Signed-off-by: Greg Kroah-Hartman
commit 2b24fdca153f0fd6c2d0f1f60c7606a53b6db575
Author: Don Hiatt
Date: Mon Oct 2 11:04:48 2017 -0700
IB/core: Do not warn on lid conversions for OPA
commit 6588e412fe872ed81f3fb8d9b4561a66ecb763d0 upstream.
On OPA devices the user\_mad recv\_handler can receive 32Bit LIDs
(e.g. OPA\_PERMISSIVE\_LID) and it is okay to lose the upper 16 bits
of the LID as this information is obtained elsewhere. Do not issue
a warning when calling ib\_lid\_be16() in this case by masking out
the upper 16Bits.
[75667.310846] ------------[ cut here ]------------
[75667.316447] WARNING: CPU: 0 PID: 1718 at ./include/rdma/ib\_verbs.h:3799 recv\_handler+0x15a/0x170 [ib\_umad]
[75667.327640] Modules linked in: ib\_ipoib hfi1(E) rdmavt(E) rdma\_ucm(E) ib\_ucm(E) rdma\_cm(E) ib\_cm(E) iw\_cm(E) ib\_umad(E) ib\_uverbs(E) ib\_core(E) libiscsi scsi\_transport\_iscsi dm\_mirror dm\_region\_hash dm\_log dm\_mod dax x86\_pkg\_temp\_thermal intel\_powerclamp coretemp kvm irqbypass crct10dif\_pclmul crc32\_pclmul ghash\_clmulni\_intel pcbc aesni\_intel mei\_me ipmi\_si iTCO\_wdt iTCO\_vendor\_support crypto\_simd ipmi\_devintf pcspkr mei sg i2c\_i801 glue\_helper lpc\_ich shpchp ioatdma mfd\_core wmi ipmi\_msghandler cryptd acpi\_power\_meter acpi\_pad nfsd auth\_rpcgss nfs\_acl lockd grace sunrpc ip\_tables xfs libcrc32c sd\_mod mgag200 drm\_kms\_helper syscopyarea sysfillrect sysimgblt fb\_sys\_fops ttm drm igb ptp ahci libahci pps\_core crc32c\_intel libata dca i2c\_algo\_bit i2c\_core [last unloaded: ib\_core]
[75667.407704] CPU: 0 PID: 1718 Comm: kworker/0:1H Tainted: G W I E 4.13.0-rc7+ #1
[75667.417310] Hardware name: Intel Corporation S2600WT2/S2600WT2, BIOS SE5C610.86B.01.01.0008.021120151325 02/11/2015
[75667.429555] Workqueue: ib-comp-wq ib\_cq\_poll\_work [ib\_core]
[75667.436360] task: ffff88084a718000 task.stack: ffffc9000a424000
[75667.443549] RIP: 0010:recv\_handler+0x15a/0x170 [ib\_umad]
[75667.450090] RSP: 0018:ffffc9000a427ce8 EFLAGS: 00010286
[75667.456508] RAX: 00000000ffffffff RBX: ffff88085159ce80 RCX: 0000000000000000
[75667.465094] RDX: ffff88085a47b068 RSI: 0000000000000000 RDI: ffff88085159cf00
[75667.473668] RBP: ffffc9000a427d38 R08: 000000000001efc0 R09: ffff88085159ce80
[75667.482228] R10: ffff88085f007480 R11: ffff88084acf20e8 R12: ffff88085a47b020
[75667.490824] R13: ffff881056842e10 R14: ffff881056840200 R15: ffff88104c8d0800
[75667.499390] FS: 0000000000000000(0000) GS:ffff88085f400000(0000) knlGS:0000000000000000
[75667.509028] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[75667.516080] CR2: 00007f9e4b3d9000 CR3: 0000000001c09000 CR4: 00000000001406f0
[75667.524664] Call Trace:
[75667.528044] ? find\_mad\_agent+0x7c/0x1b0 [ib\_core]
[75667.534031] ? ib\_mark\_mad\_done+0x73/0xa0 [ib\_core]
[75667.540142] ib\_mad\_recv\_done+0x423/0x9b0 [ib\_core]
[75667.546215] \_\_ib\_process\_cq+0x5d/0xb0 [ib\_core]
[75667.552007] ib\_cq\_poll\_work+0x20/0x60 [ib\_core]
[75667.557766] process\_one\_work+0x149/0x360
[75667.562844] worker\_thread+0x4d/0x3c0
[75667.567529] kthread+0x109/0x140
[75667.571713] ? rescuer\_thread+0x380/0x380
[75667.576775] ? kthread\_park+0x60/0x60
[75667.581447] ret\_from\_fork+0x25/0x30
[75667.586014] Code: 43 4a 0f b6 45 c6 88 43 4b 48 8b 45 b0 48 89 43 4c 48 8b 45 b8 48 89 43 54 8b 45 c0 0f c8 89 43 5c e9 79 ff ff ff e8 16 4e fa e0 <0f> ff e9 42 ff ff ff 66 66 66 66 66 66 2e 0f 1f 84 00 00 00 00
[75667.608323] ---[ end trace cf26df27c9597264 ]---
Fixes: 62ede7779904 ("Add OPA extended LID support")
Reviewed-by: Mike Marciniszyn
Signed-off-by: Don Hiatt
Signed-off-by: Dennis Dalessandro
Reviewed-by: Leon Romanovsky
Signed-off-by: Doug Ledford
Signed-off-by: Greg Kroah-Hartman
commit 75e63076249aedd3a7a3c38677d135cc146f1f4b
Author: Sandipan Das
Date: Fri Nov 17 15:27:28 2017 -0800
include/linux/compiler-clang.h: handle randomizable anonymous structs
commit 4ca59b14e588f873795a11cdc77a25c686a29d23 upstream.
The GCC randomize layout plugin can randomize the member offsets of
sensitive kernel data structures. To use this feature, certain
annotations and members are added to the structures which affect the
member offsets even if this plugin is not used.
All of these structures are completely randomized, except for task\_struct
which leaves out some of its members. All the other members are wrapped
within an anonymous struct with the \_\_randomize\_layout attribute. This is
done using the randomized\_struct\_fields\_start and
randomized\_struct\_fields\_end defines.
When the plugin is disabled, the behaviour of this attribute can vary
based on the GCC version. For GCC 5.1+, this attribute maps to
\_\_designated\_init otherwise it is just an empty define but the anonymous
structure is still present. For other compilers, both
randomized\_struct\_fields\_start and randomized\_struct\_fields\_end default
to empty defines meaning the anonymous structure is not introduced at
all.
So, if a module compiled with Clang, such as a BPF program, needs to
access task\_struct fields such as pid and comm, the offsets of these
members as recognized by Clang are different from those recognized by
modules compiled with GCC. If GCC 4.6+ is used to build the kernel,
this can be solved by introducing appropriate defines for Clang so that
the anonymous structure is seen when determining the offsets for the
members.
Link: http://lkml.kernel.org/r/20171109064645.25581-1-sandipan@linux.vnet.ibm.com
Signed-off-by: Sandipan Das
Cc: David Rientjes
Cc: Greg Kroah-Hartman
Cc: Kate Stewart
Cc: Thomas Gleixner
Cc: Naveen N. Rao
Cc: Alexei Starovoitov
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 248b0ec5ad2501a35f2603384f1c7c7cee79eb02
Author: Michel Dänzer
Date: Wed Nov 22 15:55:21 2017 +0100
drm/amdgpu: Set adev->vcn.irq.num\_types for VCN
commit 89ce6e0afee8eafa679093207dabd717af9d09c5 upstream.
We were setting adev->uvd.irq.num\_types instead.
Fixes: 9b257116e784 ("drm/amdgpu: add vcn enc irq support")
Reviewed-by: Alex Deucher
Reviewed-by: Christian König
Signed-off-by: Michel Dänzer
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit 802328da073a0ba36a1cde899c48a5f07732d4aa
Author: Leo Liu
Date: Tue Nov 21 09:08:07 2017 -0500
drm/amdgpu: move UVD/VCE and VCN structure out from union
commit b43aaee69d4327d05e7624d9471c17d015b4d67d upstream.
With the enablement of VCN Dec and Enc from user space, User space queries
kernel for the IP information, if HW has UVD/VCE, the info comes from these
IP blocks, but this could end up mis-interpret for VCN when they are in the
union, the other way same when HW with VCN block.
Signed-off-by: Leo Liu
Acked-by: Alex Deucher
Reviewed-by: Christian König
Signed-off-by: Alex Deucher
Fixes: 95d0906f8506 ("drm/amdgpu: add initial vcn support and decode tests")
Reviewed-and-Tested-by: Michel Dänzer
Signed-off-by: Greg Kroah-Hartman
commit d8f74d70634aa0dfe063d0e445f683b0545fa5b8
Author: Ville Syrjälä
Date: Wed Nov 8 17:25:04 2017 +0200
drm/edid: Don't send non-zero YQ in AVI infoframe for HDMI 1.x sinks
commit 9271c0ca573e02a360b636ecd8cb408852f4e9f6 upstream.
Apparently some sinks look at the YQ bits even when receiving RGB,
and they get somehow confused when they see a non-zero YQ value.
So we can't just blindly follow CEA-861-F and set YQ to match the
RGB range.
Unfortunately there is no good way to tell whether the sink
designer claims to have read CEA-861-F. The CEA extension block
revision number has generally been stuck at 3 since forever,
and even a very recently manufactured sink might be based on
an old design so the manufacturing date doesn't seem like
something we can use. In lieu of better information let's
follow CEA-861-F only for HDMI 2.0 sinks, since HDMI 2.0 is
based on CEA-861-F. For HDMI 1.x sinks we'll always set YQ=0.
The alternative would of course be to always set YQ=0. And if
we ever encounter a HDMI 2.0+ sink with this bug that's what
we'll probably have to do.
Cc: Jani Nikula
Cc: Eric Anholt
Cc: Neil Kownacki
Reported-by: Neil Kownacki
Tested-by: Neil Kownacki
Fixes: fcc8a22cc905 ("drm/edid: Set YQ bits in the AVI infoframe according to CEA-861-F")
Bugzilla: https://bugs.freedesktop.org/show\_bug.cgi?id=101639
Signed-off-by: Ville Syrjälä
Link: https://patchwork.freedesktop.org/patch/msgid/20171108152504.12596-1-ville.syrjala@linux.intel.com
Acked-by: Eric Anholt
Signed-off-by: Greg Kroah-Hartman
commit e685410c5f30a19c54d652e033942ed270d31b61
Author: Laurent Pinchart
Date: Fri Nov 10 17:38:34 2017 +0100
drm/fsl-dcu: Don't set connector DPMS property
commit daee54263c1202cbdab85c5e15ae30b417602efb upstream.
Since commit 4a97a3da420b ("drm: Don't update property values for atomic
drivers") atomic drivers must not update property values as properties
are read from the state instead. To catch remaining users, the
drm\_object\_property\_set\_value() function now throws a warning when
called by atomic drivers on non-immutable properties, and we hit that
warning when creating connectors.
The easy fix is to just remove the drm\_object\_property\_set\_value() as it
is used here to set the initial value of the connector's DPMS property
to OFF. The DPMS property applies on top of the connector's state crtc
pointer (initialized to NULL) that is the main connector on/off control,
and should thus default to ON.
Fixes: 4a97a3da420b ("drm: Don't update property values for atomic drivers")
Signed-off-by: Laurent Pinchart
Signed-off-by: Stefan Agner
Signed-off-by: Greg Kroah-Hartman
commit dde499d3cf6edea946ff59cb5d72e4f9ef21f3fd
Author: Maarten Lankhorst
Date: Tue Nov 28 12:16:03 2017 +0100
drm/fb\_helper: Disable all crtc's when initial setup fails.
commit 52dd06506e9bbc2a37b352df7dfc5468f8da21fd upstream.
Some drivers like i915 start with crtc's enabled, but with deferred
fbcon setup they were no longer disabled as part of fbdev setup.
Headless units could no longer enter pc3 state because the crtc was
still enabled.
Fix this by calling restore\_fbdev\_mode when we would have called
it otherwise once during initial fbdev setup.
Signed-off-by: Maarten Lankhorst
Fixes: ca91a2758fce ("drm/fb-helper: Support deferred setup")
Reported-by: Thomas Voegtle
Tested-by: Thomas Voegtle
Reviewed-by: Daniel Vetter
Link: https://patchwork.freedesktop.org/patch/msgid/20171128111603.62757-1-maarten.lankhorst@linux.intel.com
Signed-off-by: Greg Kroah-Hartman
commit e4c84b504e02f6f7103cdc67b1adbe304910c104
Author: Rex Zhu
Date: Fri Nov 17 16:41:16 2017 +0800
drm/amd/pp: fix typecast error in powerplay.
commit 8d8258bdab735d9f3c4b78e091ecfbb2b2b1f2ca upstream.
resulted in unexpected data truncation
Reviewed-by: Alex Deucher
Signed-off-by: Rex Zhu
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit 78f4bb6e965ddd9f60f607dfaf6e20109da84f6d
Author: Christian König
Date: Mon Oct 30 14:57:43 2017 +0100
drm/ttm: once more fix ttm\_buffer\_object\_transfer
commit 4d98e5ee6084f6d7bc578c5d5f86de7156aaa4cb upstream.
When the mutex is locked just in the moment we copy it we end up with a
warning that we release a locked mutex.
Fix this by properly reinitializing the mutex.
Signed-off-by: Christian König
Reviewed-by: Alex Deucher
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit f5e69000aa80880491ca4a613679bd21c60b048b
Author: Peter Griffin
Date: Tue Aug 15 15:14:25 2017 +0100
drm/hisilicon: Ensure LDI regs are properly configured.
commit a2f042430784d86eb2b7a6d2a869f552da30edba upstream.
This patch fixes the following soft lockup:
BUG: soft lockup - CPU#0 stuck for 23s! [weston:307]
On weston idle-timeout the IP is powered down and reset
asserted. On weston resume we get a massive vblank
IRQ storm due to the LDI registers having lost some state.
This state loss is caused by ade\_crtc\_atomic\_begin() not
calling ade\_ldi\_set\_mode(). With this patch applied
resuming from Weston idle-timeout works well.
Signed-off-by: Peter Griffin
Tested-by: John Stultz
Reviewed-by: Xinliang Liu
Signed-off-by: Xinliang Liu
Signed-off-by: Greg Kroah-Hartman
commit 87139913c0e2d0a7270868a7a36d549dfd3fad5d
Author: Jonathan Liu
Date: Mon Aug 7 21:55:45 2017 +1000
drm/panel: simple: Add missing panel\_simple\_unprepare() calls
commit f3621a8eb59a913612c8e6e37d81f16b649f8b6c upstream.
During panel removal or system shutdown panel\_simple\_disable() is called
which disables the panel backlight but the panel is still powered due to
missing calls to panel\_simple\_unprepare().
Fixes: d02fd93e2cd8 ("drm/panel: simple - Disable panel on shutdown")
Signed-off-by: Jonathan Liu
Signed-off-by: Thierry Reding
Link: https://patchwork.freedesktop.org/patch/msgid/20170807115545.27747-1-net147@gmail.com
Signed-off-by: Greg Kroah-Hartman
commit 8153a0fc1212157a4bf8b303cbf51993ff87aa7c
Author: Roman Kapl
Date: Mon Oct 30 11:56:13 2017 +0100
drm/radeon: fix atombios on big endian
commit 4f626a4ac8f57ddabf06d03870adab91e463217f upstream.
The function for byteswapping the data send to/from atombios was buggy for
num\_bytes not divisible by four. The function must be aware of the fact
that after byte-swapping the u32 units, valid bytes might end up after the
num\_bytes boundary.
This patch was tested on kernel 3.12 and allowed us to sucesfully use
DisplayPort on and Radeon SI card. Namely it fixed the link training and
EDID readout.
The function is patched both in radeon and amd drivers, since the functions
and the fixes are identical.
Signed-off-by: Roman Kapl
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit e3c5870862d95ff198a1902c3d7bd2a548b89ea7
Author: Jyri Sarha
Date: Thu Oct 12 12:19:46 2017 +0300
drm/tilcdc: Precalculate total frametime in tilcdc\_crtc\_set\_mode()
commit ce99f7206c9105851d97202ed08c058af6f11ac4 upstream.
We need the total frame refresh time to check if we are too close to
vertical sync when updating the two framebuffer DMA registers and risk
a collision. This new method is more accurate that the previous that
based on mode's vrefresh value, which itself is inaccurate or may not
even be initialized.
Reported-by: Kevin Hao
Fixes: 11abbc9f39e0 ("drm/tilcdc: Set framebuffer DMA address to HW only if CRTC is enabled")
Signed-off-by: Jyri Sarha
Reviewed-by: Tomi Valkeinen
Signed-off-by: Greg Kroah-Hartman
commit a5851fdb17dda5f0854417f15a0c9c833a92dcc6
Author: Ville Syrjälä
Date: Mon Oct 23 18:25:40 2017 +0300
drm/vblank: Tune drm\_crtc\_accurate\_vblank\_count() WARN down to a debug
commit a111fbc4c44d2981f1a8fef64418685be5e30280 upstream.
Since commit 632c6e4edef1 ("drm/vblank: Fix flip event vblank count")
even drivers that don't implement accurate vblank timestamps will end
up using drm\_crtc\_accurate\_vblank\_count(). That leads to a WARN every
time drm\_crtc\_arm\_vblank\_event() gets called. The could be as often
as every frame for each active crtc.
Considering drm\_crtc\_accurate\_vblank\_count() is never any worse than
the drm\_vblank\_count() we used previously, let's just skip the WARN
unless DRM\_UT\_VBL is enabled. That way people won't be bothered by
this unless they're debugging vblank code. And let's also change it
to WARN\_ONCE() so that even when you're debugging vblank code you
won't get drowned by constant WARNs.
Cc: Daniel Vetter
Cc: "Szyprowski, Marek"
Cc: Andrzej Hajda
Reported-by: Andrzej Hajda
Fixes: 632c6e4edef1 ("drm/vblank: Fix flip event vblank count")
Signed-off-by: Ville Syrjälä
Link: https://patchwork.freedesktop.org/patch/msgid/20171023152540.15364-1-ville.syrjala@linux.intel.com
Acked-by: Benjamin Gaignard
Reviewed-by: Daniel Vetter
Signed-off-by: Greg Kroah-Hartman
commit 7c33c32d39b9d11338624d4a7bad4e75bf64fbf8
Author: Ville Syrjälä
Date: Tue Oct 10 16:33:22 2017 +0300
drm/vblank: Fix flip event vblank count
commit 632c6e4edef17c40bba3be67c980d959790d142f upstream.
On machines where the vblank interrupt fires some time after the start
of vblank (or we just manage to race with the vblank interrupt handler)
we will currently stuff a stale vblank counter value into the flip event,
and thus we'll prematurely complete the flip.
Switch over to drm\_crtc\_accurate\_vblank\_count() to make sure we have an
up to date counter value, crucially also remember to add the +1 so that
the delayed vblank interrupt won't complete the flip prematurely.
Cc: Daniel Vetter
Suggested-by: Daniel Vetter
Signed-off-by: Ville Syrjälä
Link: https://patchwork.freedesktop.org/patch/msgid/20171010133322.24029-1-ville.syrjala@linux.intel.com
Reviewed-by: Daniel Vetter  #irc
Signed-off-by: Greg Kroah-Hartman
commit 6cd3e4a3e697cca84f27a0af68ba59a6ab00892f
Author: Michel Dänzer
Date: Fri Nov 3 16:00:35 2017 +0100
drm/ttm: Always and only destroy bo->ttm\_resv in ttm\_bo\_release\_list
commit e1fc12c5d9ad06a2a74e97a91f1b0c5f4c723b50 upstream.
Fixes a use-after-free due to a race condition in
ttm\_bo\_cleanup\_refs\_and\_unlock, which allows one task to reserve a BO
and destroy its ttm\_resv while another task is waiting for it to signal
in reservation\_object\_wait\_timeout\_rcu.
v2:
\* Always initialize bo->ttm\_resv in ttm\_bo\_init\_reserved
(Christian König)
Fixes: 0d2bd2ae045d "drm/ttm: fix memory leak while individualizing BOs"
Reviewed-by: Chunming Zhou  # v1
Reviewed-by: Christian König
Signed-off-by: Michel Dänzer
Signed-off-by: Alex Deucher
Signed-off-by: Lyude Paul
Signed-off-by: Greg Kroah-Hartman
commit 99b0ea0391d1b49ed4a944a07ad57ee448b0541c
Author: Christian König
Date: Fri Oct 13 17:24:31 2017 +0200
drm/amdgpu: reserve root PD while releasing it
commit 2642cf110d08a403f585a051e4cbf45a90b3adea upstream.
Otherwise somebody could try to evict it at the same time and try to use
half torn down structures.
Signed-off-by: Christian König
Reviewed-and-Tested-by: Michel Dänzer
Reviewed-by: Alex Deucher
Signed-off-by: Alex Deucher
Signed-off-by: Lyude Paul
Signed-off-by: Greg Kroah-Hartman
commit 509536b227fb35ed34d144ff4280aa78605ab85e
Author: Christian König
Date: Mon Sep 4 21:02:45 2017 +0200
dma-buf: make reservation\_object\_copy\_fences rcu save
commit 39e16ba16c147e662bf9fbcee9a99d70d420382f upstream.
Stop requiring that the src reservation object is locked for this operation.
Acked-by: Chunming Zhou
Signed-off-by: Christian König
Signed-off-by: Alex Deucher
Link: https://patchwork.freedesktop.org/patch/msgid/1504551766-5093-1-git-send-email-deathsimple@vodafone.de
Signed-off-by: Lyude Paul
Signed-off-by: Greg Kroah-Hartman
commit 45d1765032b645a2e86a606f7d173d4bf97a9810
Author: Christian König
Date: Mon Sep 4 20:58:45 2017 +0200
drm/ttm: fix ttm\_bo\_cleanup\_refs\_or\_queue once more
commit 378e2d5b504fe0231c557751e58b80fcf717cc20 upstream.
With shared reservation objects \_\_ttm\_bo\_reserve() can easily fail even on
destroyed BOs. This prevents correct handling when we need to individualize
the reservation object.
Fix this by individualizing the object before even trying to reserve it.
Signed-off-by: Christian König
Acked-by: Chunming Zhou
Signed-off-by: Alex Deucher
Signed-off-by: Lyude Paul
Signed-off-by: Greg Kroah-Hartman
commit d48221f3399764748f706cc1126b5d6465e27d87
Author: Ken Wang
Date: Wed Nov 8 14:48:50 2017 +0800
drm/amdgpu: Remove check which is not valid for certain VBIOS
commit ab6613b7eaefe85dadfc86025e901c55d71c0379 upstream.
Fixes vbios fetching on certain headless boards.
Signed-off-by: Ken Wang
Acked-by: Alex Deucher
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit ecd08e684cd1d138bf894e632e0d141f5e7c4140
Author: ozeng
Date: Tue Jun 6 10:53:28 2017 -0500
drm/amdgpu: Properly allocate VM invalidate eng v2
commit c5066129af4436ab0da8eefe4289774a5409706d upstream.
v1: Properly allocate TLB invalidation engine to avoid conflict.
v2: Added comments to codes
Signed-off-by: Oak Zeng
Reviewed-by: Alex Deucher
Acked-by: Christian Konig
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit a00b7ea3df52da50097d22c9eb3b0eba3e504838
Author: Christian König
Date: Tue Oct 31 09:36:13 2017 +0100
drm/amdgpu: fix error handling in amdgpu\_bo\_do\_create
commit a695e43712242c354748e9bae5d137d4337a7694 upstream.
The bo structure is freed up in case of an error, so we can't do any
accounting if that happens.
Signed-off-by: Christian König
Reviewed-by: Michel Dänzer
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit 402b1de75ce06404c96cf803e1fe0b5c685f7797
Author: Ken Wang
Date: Fri Sep 29 15:41:43 2017 +0800
drm/amdgpu: correct reference clock value on vega10
commit 76d6172b6fab16455af4b67bb18a3f66011592f8 upstream.
Old value from bringup was wrong.
Signed-off-by: Ken Wang
Reviewed-by: Alex Deucher
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit f182df2eacbe52100b82e193a7917fdbb4312dd1
Author: Dan Carpenter
Date: Sat Sep 30 11:14:13 2017 +0300
drm/amdgpu: Potential uninitialized variable in amdgpu\_vm\_update\_directories()
commit 78aa02c713fcf19e9bc8511ab61a5fd6c877cc01 upstream.
After commit ea09729c9302 ("drm/amdgpu: rework page directory filling
v2") then it becomes a lot harder to verify that "r" is initialized. My
static checker complains and so I've reviewed the code. It does look
like it might be buggy... Anyway, it doesn't hurt to set "r" to zero
at the start.
Reviewed-by: Christian König
Signed-off-by: Dan Carpenter
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit 2d8b3a9b7853dbbf12c853674ef4403481ab1513
Author: Dan Carpenter
Date: Sat Sep 30 11:13:28 2017 +0300
drm/amdgpu: potential uninitialized variable in amdgpu\_vce\_ring\_parse\_cs()
commit 40a9960b046290939b56ce8e51f365258f27f264 upstream.
We shifted some code around in commit 9cca0b8e5df0 ("drm/amdgpu: move
amdgpu\_cs\_sysvm\_access\_required into find\_mapping") and now my static
checker complains that "r" might not be initialized at the end of the
function. I've reviewed the code, and that seems possible, but it's
also possible I may have missed something.
Reviewed-by: Christian König
Signed-off-by: Dan Carpenter
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit 23506bc7fdb2313c63d8811967fcf82d5764b973
Author: Alex Deucher
Date: Tue Nov 14 17:19:29 2017 -0500
Revert "drm/radeon: dont switch vt on suspend"
commit 18c437caa5b18a235dd65cec224eab54bebcee65 upstream.
Fixes distorted colors on some cards on resume from suspend.
This reverts commit b9729b17a414f99c61f4db9ac9f9ed987fa0cbfe.
Bug: https://bugs.freedesktop.org/show\_bug.cgi?id=98832
Bug: https://bugs.freedesktop.org/show\_bug.cgi?id=99163
Bug: https://bugzilla.kernel.org/show\_bug.cgi?id=107001
Reviewed-by: Michel Dänzer
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit 5e19169a88be15d6c845e93d62e448ee06a14b2f
Author: Jeff Lien
Date: Tue Nov 21 10:44:37 2017 -0600
nvme-pci: add quirk for delay before CHK RDY for WDC SN200
commit 8c97eeccf0ad8783c057830119467b877bdfced7 upstream.
And increase the existing delay to cover this device as well.
Signed-off-by: Jeff Lien
Signed-off-by: Christoph Hellwig
Signed-off-by: Greg Kroah-Hartman
commit de120fc9624162a3507091d6b92dd9037440c9d8
Author: Peter Rosin
Date: Mon Nov 27 17:31:00 2017 +0100
hwmon: (jc42) optionally try to disable the SMBUS timeout
commit 68615eb01f82256c19e41967bfb3eef902f77033 upstream.
With a nxp,se97 chip on an atmel sama5d31 board, the I2C adapter driver
is not always capable of avoiding the 25-35 ms timeout as specified by
the SMBUS protocol. This may cause silent corruption of the last bit of
any transfer, e.g. a one is read instead of a zero if the sensor chip
times out. This also affects the eeprom half of the nxp-se97 chip, where
this silent corruption was originally noticed. Other I2C adapters probably
suffer similar issues, e.g. bit-banging comes to mind as risky...
The SMBUS register in the nxp chip is not a standard Jedec register, but
it is not special to the nxp chips either, at least the atmel chips
have the same mechanism. Therefore, do not special case this on the
manufacturer, it is opt-in via the device property anyway.
Signed-off-by: Peter Rosin
Acked-by: Rob Herring
Signed-off-by: Guenter Roeck
Signed-off-by: Greg Kroah-Hartman
commit 1cafc451a955c44ec7eba47bae340d9ca5ccb483
Author: Rui Hua
Date: Fri Nov 24 15:14:26 2017 -0800
bcache: recover data from backing when data is clean
commit e393aa2446150536929140739f09c6ecbcbea7f0 upstream.
When we send a read request and hit the clean data in cache device, there
is a situation called cache read race in bcache(see the commit in the tail
of cache\_look\_up(), the following explaination just copy from there):
The bucket we're reading from might be reused while our bio is in flight,
and we could then end up reading the wrong data. We guard against this
by checking (in bch\_cache\_read\_endio()) if the pointer is stale again;
if so, we treat it as an error (s->iop.error = -EINTR) and reread from
the backing device (but we don't pass that error up anywhere)
It should be noted that cache read race happened under normal
circumstances, not the circumstance when SSD failed, it was counted
and shown in /sys/fs/bcache/XXX/internal/cache\_read\_races.
Without this patch, when we use writeback mode, we will never reread from
the backing device when cache read race happened, until the whole cache
device is clean, because the condition
(s->recoverable && (dc && !atomic\_read(&dc->has\_dirty))) is false in
cached\_dev\_read\_error(). In this situation, the s->iop.error(= -EINTR)
will be passed up, at last, user will receive -EINTR when it's bio end,
this is not suitable, and wield to up-application.
In this patch, we use s->read\_dirty\_data to judge whether the read
request hit dirty data in cache device, it is safe to reread data from
the backing device when the read request hit clean data. This can not
only handle cache read race, but also recover data when failed read
request from cache device.
[edited by mlyle to fix up whitespace, commit log title, comment
spelling]
Fixes: d59b23795933 ("bcache: only permit to recovery read error when cache device is clean")
Signed-off-by: Hua Rui
Reviewed-by: Michael Lyle
Reviewed-by: Coly Li
Signed-off-by: Michael Lyle
Signed-off-by: Jens Axboe
Signed-off-by: Greg Kroah-Hartman
commit 260c6625c85e7e1a5db0b5ece9944a4010c9bade
Author: Coly Li
Date: Mon Oct 30 14:46:31 2017 -0700
bcache: only permit to recovery read error when cache device is clean
commit d59b23795933678c9638fd20c942d2b4f3cd6185 upstream.
When bcache does read I/Os, for example in writeback or writethrough mode,
if a read request on cache device is failed, bcache will try to recovery
the request by reading from cached device. If the data on cached device is
not synced with cache device, then requester will get a stale data.
For critical storage system like database, providing stale data from
recovery may result an application level data corruption, which is
unacceptible.
With this patch, for a failed read request in writeback or writethrough
mode, recovery a recoverable read request only happens when cache device
is clean. That is to say, all data on cached device is up to update.
For other cache modes in bcache, read request will never hit
cached\_dev\_read\_error(), they don't need this patch.
Please note, because cache mode can be switched arbitrarily in run time, a
writethrough mode might be switched from a writeback mode. Therefore
checking dc->has\_data in writethrough mode still makes sense.
Changelog:
V4: Fix parens error pointed by Michael Lyle.
v3: By response from Kent Oversteet, he thinks recovering stale data is a
bug to fix, and option to permit it is unnecessary. So this version
the sysfs file is removed.
v2: rename sysfs entry from allow\_stale\_data\_on\_failure to
allow\_stale\_data\_on\_failure, and fix the confusing commit log.
v1: initial patch posted.
[small change to patch comment spelling by mlyle]
Signed-off-by: Coly Li
Signed-off-by: Michael Lyle
Reported-by: Arne Wolf
Reviewed-by: Michael Lyle
Cc: Kent Overstreet
Cc: Nix
Cc: Kai Krakow
Cc: Eric Wheeler
Cc: Junhui Tang
Signed-off-by: Jens Axboe
Signed-off-by: Greg Kroah-Hartman
commit f5b41b366273ff51c7a62643f8667784eb349fba
Author: Huacai Chen
Date: Fri Nov 24 15:14:25 2017 -0800
bcache: Fix building error on MIPS
commit cf33c1ee5254c6a430bc1538232b49c3ea13e613 upstream.
This patch try to fix the building error on MIPS. The reason is MIPS
has already defined the PTR macro, which conflicts with the PTR macro
in include/uapi/linux/bcache.h.
[fixed by mlyle: corrected a line-length issue]
Signed-off-by: Huacai Chen
Reviewed-by: Michael Lyle
Signed-off-by: Michael Lyle
Signed-off-by: Jens Axboe
Signed-off-by: Greg Kroah-Hartman
commit 6e8aca2095790b90217b759a0d5e2ec5138bbfd2
Author: Vaibhav Jain
Date: Thu Nov 23 09:08:57 2017 +0530
cxl: Check if vphb exists before iterating over AFU devices
commit 12841f87b7a8ceb3d54f171660f72a86941bfcb3 upstream.
During an eeh a kernel-oops is reported if no vPHB is allocated to the
AFU. This happens as during AFU init, an error in creation of vPHB is
a non-fatal error. Hence afu->phb should always be checked for NULL
before iterating over it for the virtual AFU pci devices.
This patch fixes the kenel-oops by adding a NULL pointer check for
afu->phb before it is dereferenced.
Fixes: 9e8df8a21963 ("cxl: EEH support")
Signed-off-by: Vaibhav Jain
Acked-by: Andrew Donnellan
Acked-by: Frederic Barrat
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit 9c71f896bb8f3b7bb228ece70341b26b2ff32ae9
Author: Hans de Goede
Date: Wed Nov 22 12:28:17 2017 +0100
i2c: i801: Fix Failed to allocate irq -2147483648 error
commit 6e0c9507bf51e1517a80ad0ac171e5402528fcef upstream.
On Apollo Lake devices the BIOS does not set up IRQ routing for the i801
SMBUS controller IRQ, so we end up with dev->irq set to IRQ\_NOTCONNECTED.
Detect this and do not try to use the irq in this case silencing:
i801\_smbus 0000:00:1f.1: Failed to allocate irq -2147483648: -107
BugLink: https://communities.intel.com/thread/114759
Signed-off-by: Hans de Goede
Reviewed-by: Jean Delvare
Signed-off-by: Wolfram Sang
Signed-off-by: Greg Kroah-Hartman
commit 52d9bb958f080f0a548139676dbf6a87a40af2a0
Author: Heiner Kallweit
Date: Fri Nov 24 07:47:50 2017 +0100
eeprom: at24: check at24\_read/write arguments
commit d9bcd462daf34aebb8de9ad7f76de0198bb5a0f0 upstream.
So far we completely rely on the caller to provide valid arguments.
To be on the safe side perform an own sanity check.
Signed-off-by: Heiner Kallweit
Signed-off-by: Bartosz Golaszewski
Signed-off-by: Greg Kroah-Hartman
commit 656155d07658e84ac6ab6f6eceac67b807d6fedb
Author: Bartosz Golaszewski
Date: Mon Nov 27 22:06:13 2017 +0100
eeprom: at24: correctly set the size for at24mac402
commit 5478e478eee3b096b8d998d4ed445da30da2dfbc upstream.
There's an ilog2() expansion in AT24\_DEVICE\_MAGIC() which rounds down
the actual size of EUI-48 byte array in at24mac402 eeproms to 4 from 6,
making it impossible to read it all.
Fix it by manually adjusting the value in probe().
This patch contains a temporary fix that is suitable for stable
branches. Eventually we'll probably remove the call to ilog2() while
converting the magic values to actual structs.
Fixes: 0b813658c115 ("eeprom: at24: add support for at24mac series")
Signed-off-by: Bartosz Golaszewski
Reviewed-by: Andy Shevchenko
Signed-off-by: Greg Kroah-Hartman
commit 1ad53c57966a1a295c0ea5a8a7d6e85d3d75253a
Author: Heiner Kallweit
Date: Mon Nov 27 20:46:22 2017 +0100
eeprom: at24: fix reading from 24MAC402/24MAC602
commit 644a1f19c6c8393d0c4168a5adf79056da6822eb upstream.
Chip datasheet mentions that word addresses other than the actual
start position of the MAC delivers undefined results. So fix this.
Current implementation doesn't work due to this wrong offset.
Fixes: 0b813658c115 ("eeprom: at24: add support for at24mac series")
Signed-off-by: Heiner Kallweit
Signed-off-by: Bartosz Golaszewski
Signed-off-by: Greg Kroah-Hartman
commit 450d75882552d59bb03b1ccb0999e98f5b227532
Author: Lv Zheng
Date: Tue Sep 26 16:54:09 2017 +0800
ACPI / EC: Fix regression related to PM ops support in ECDT device
commit a64a62ce9a380213dc9e192f762266d70c9b40ec upstream.
On platforms (ASUS X550ZE and possibly all ASUS X series) with valid ECDT
EC but invalid DSDT EC, EC PM ops won't be invoked as ECDT EC is not an
ACPI device. Thus the following commit actually removed post-resume
acpi\_ec\_enable\_event() invocation for such platforms, and triggered a
regression on them that after being resumed, EC (actually should be ECDT)
driver stops handling EC events:
Commit: c2b46d679b30c5c0d7eb47a21085943242bdd8dc
Subject: ACPI / EC: Add PM operations to improve event handling for resume process
Notice that the root cause actually is "ECDT is not an ACPI device" rather
than "the timing of acpi\_ec\_enable\_event() invocation", this patch fixes
this issue by enumerating ECDT EC as an ACPI device. Due to the existence
of the noirq stage, the ability of tuning the timing of
acpi\_ec\_enable\_event() invocation is still meaningful.
This patch is a little bit different from the posted fix by moving
acpi\_config\_boot\_ec() from acpi\_ec\_ecdt\_start() to acpi\_ec\_add() to make
sure that EC event handling won't be stopped as long as the ACPI EC driver
is bound. Thus the following sequence shouldn't disable EC event handling:
unbind,suspend,resume,bind.
Fixes: c2b46d679b30 (ACPI / EC: Add PM operations to improve event handling for resume process)
Link: https://bugzilla.kernel.org/show\_bug.cgi?id=196847
Reported-by: Luya Tshimbalanga
Tested-by: Luya Tshimbalanga
Signed-off-by: Lv Zheng
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit 1ef1173c4864c06b6104f386c2694aa740cf02ee
Author: Bastian Stender
Date: Tue Nov 28 09:24:07 2017 +0100
mmc: core: prepend 0x to OCR entry in sysfs
commit c892b0d81705c566f575e489efc3c50762db1bde upstream.
The sysfs entry "ocr" was missing the 0x prefix to identify it as hex
formatted.
Fixes: 5fb06af7a33b ("mmc: core: Extend sysfs with OCR register")
Signed-off-by: Bastian Stender
[Ulf: Amended change to also cover SD-cards]
Signed-off-by: Ulf Hansson
Signed-off-by: Greg Kroah-Hartman
commit e6aa6389263d0db52ea674ed45eb591d21585eca
Author: Bastian Stender
Date: Tue Nov 28 09:24:06 2017 +0100
mmc: core: prepend 0x to pre\_eol\_info entry in sysfs
commit 80a780a167d9267c72867b806142bd6ec69ba123 upstream.
The sysfs entry "pre\_eol\_info" was missing the 0x prefix to identify it
as hex formatted.
Fixes: 46bc5c408e4e ("mmc: core: Export device lifetime information through sysfs")
Signed-off-by: Bastian Stender
Signed-off-by: Ulf Hansson
Signed-off-by: Greg Kroah-Hartman
commit 64d1df6f018e728774bdf5d1aeb576d1c8d1872d
Author: Adrian Hunter
Date: Tue Nov 21 15:42:30 2017 +0200
mmc: block: Ensure that debugfs files are removed
commit f9f0da98819503b06b35e61869d18cf3a8cd3323 upstream.
The card is not necessarily being removed, but the debugfs files must be
removed when the driver is removed, otherwise they will continue to exist
after unbinding the card from the driver. e.g.
# echo "mmc1:0001" > /sys/bus/mmc/drivers/mmcblk/unbind
# cat /sys/kernel/debug/mmc1/mmc1\:0001/ext\_csd
[ 173.634584] BUG: unable to handle kernel NULL pointer dereference at 0000000000000050
[ 173.643356] IP: mmc\_ext\_csd\_open+0x5e/0x170
A complication is that the debugfs\_root may have already been removed, so
check for that too.
Fixes: 627c3ccfb46a ("mmc: debugfs: Move block debugfs into block module")
Signed-off-by: Adrian Hunter
Reviewed-by: Linus Walleij
Signed-off-by: Ulf Hansson
Signed-off-by: Greg Kroah-Hartman
commit 94497458fbb519dbc230e5156f58d4b3a49ba0c1
Author: Adrian Hunter
Date: Tue Nov 21 15:42:29 2017 +0200
mmc: core: Do not leave the block driver in a suspended state
commit ebe7dd45cf49e3b49cacbaace17f9f878f21fbea upstream.
The block driver must be resumed if the mmc bus fails to suspend the card.
Signed-off-by: Adrian Hunter
Reviewed-by: Linus Walleij
Signed-off-by: Ulf Hansson
Signed-off-by: Greg Kroah-Hartman
commit 957c27d45611ad4ef924840346bc338b8f3c870b
Author: Adrian Hunter
Date: Tue Nov 21 15:42:28 2017 +0200
mmc: block: Check return value of blk\_get\_request()
commit fb8e456e547ed2c699f64665bd8a3b9bde7b9728 upstream.
blk\_get\_request() can fail, always check the return value.
Fixes: 0493f6fe5bde ("mmc: block: Move boot partition locking into a driver op")
Fixes: 3ecd8cf23f88 ("mmc: block: move multi-ioctl() to use block layer")
Fixes: 614f0388f580 ("mmc: block: move single ioctl() commands to block requests")
Fixes: 627c3ccfb46a ("mmc: debugfs: Move block debugfs into block module")
Signed-off-by: Adrian Hunter
Reviewed-by: Linus Walleij
Signed-off-by: Ulf Hansson
Signed-off-by: Greg Kroah-Hartman
commit 0d8d2b6373c19f85bab6af1702563b50e17b2cf6
Author: Adrian Hunter
Date: Tue Nov 21 15:42:27 2017 +0200
mmc: block: Fix missing blk\_put\_request()
commit 34c089e806793a66e450b11bd167db6047399fcd upstream.
Ensure blk\_get\_request() is paired with blk\_put\_request().
Fixes: 0493f6fe5bde ("mmc: block: Move boot partition locking into a driver op")
Fixes: 627c3ccfb46a ("mmc: debugfs: Move block debugfs into block module")
Signed-off-by: Adrian Hunter
Reviewed-by: Linus Walleij
Signed-off-by: Ulf Hansson
Signed-off-by: Greg Kroah-Hartman
commit 4162b2973c1c6e49d7b193e572dec691233115c3
Author: Ulf Hansson
Date: Mon Nov 27 11:28:50 2017 +0100
mmc: sdhci: Avoid swiotlb buffer being full
commit 250dcd11466e06df64b92520e2c56bdae453581b upstream.
The commit de3ee99b097d ("mmc: Delete bounce buffer handling") deletes the
bounce buffer handling, but also causes the max\_req\_size for sdhci to be
increased, in case when max\_segs == 1. This causes errors for sdhci-pci
Ricoh variant, about the swiotlb buffer to become full.
Fix the issue, by taking IO\_TLB\_SEGSIZE and IO\_TLB\_SHIFT into account when
deciding the max\_req\_size for sdhci.
Reported-by: Jiri Slaby
Fixes: de3ee99b097d ("mmc: Delete bounce buffer handling")
Signed-off-by: Ulf Hansson
Tested-by: Jiri Slaby
Acked-by: Adrian Hunter
Signed-off-by: Greg Kroah-Hartman
commit 81b3019c35d650e7570ff016ba0732ba6d62c466
Author: Dr. David Alan Gilbert
Date: Fri Nov 17 11:52:50 2017 +0000
KVM: lapic: Fixup LDR on load in x2apic
commit 12806ba937382fdfdbad62a399aa2dce65c10fcd upstream.
In x2apic mode the LDR is fixed based on the ID rather
than separately loadable like it was before x2.
When kvm\_apic\_set\_state is called, the base is set, and if
it has the X2APIC\_ENABLE flag set then the LDR is calculated;
however that value gets overwritten by the memcpy a few lines
below overwriting it with the value that came from userland.
The symptom is a lack of EOI after loading the state
(e.g. after a QEMU migration) and is due to the EOI bitmap
being wrong due to the incorrect LDR. This was seen with
a Win2016 guest under Qemu with irqchip=split whose USB mouse
didn't work after a VM migration.
This corresponds to RH bug:
https://bugzilla.redhat.com/show\_bug.cgi?id=1502591
Reported-by: Yiqian Wei
Signed-off-by: Dr. David Alan Gilbert
[Applied fixup from Liran Alon. - Paolo]
Signed-off-by: Paolo Bonzini
Signed-off-by: Greg Kroah-Hartman
commit 47b35d190b4676953a5ce25572e031d842264194
Author: Dr. David Alan Gilbert
Date: Fri Nov 17 11:52:49 2017 +0000
KVM: lapic: Split out x2apic ldr calculation
commit e872fa94662d0644057c7c80b3071bdb9249e5ab upstream.
Split out the ldr calculation from kvm\_apic\_set\_x2apic\_id
since we're about to reuse it in the following patch.
Signed-off-by: Dr. David Alan Gilbert
Signed-off-by: Paolo Bonzini
Signed-off-by: Greg Kroah-Hartman
commit bb98bd9733b5b54b0de67e171b0057dcc6fb98de
Author: Paolo Bonzini
Date: Fri Nov 10 10:49:38 2017 +0100
KVM: x86: inject exceptions produced by x86\_decode\_insn
commit 6ea6e84309ca7e0e850b3083e6b09344ee15c290 upstream.
Sometimes, a processor might execute an instruction while another
processor is updating the page tables for that instruction's code page,
but before the TLB shootdown completes. The interesting case happens
if the page is in the TLB.
In general, the processor will succeed in executing the instruction and
nothing bad happens. However, what if the instruction is an MMIO access?
If \*that\* happens, KVM invokes the emulator, and the emulator gets the
updated page tables. If the update side had marked the code page as non
present, the page table walk then will fail and so will x86\_decode\_insn.
Unfortunately, even though kvm\_fetch\_guest\_virt is correctly returning
X86EMUL\_PROPAGATE\_FAULT, x86\_decode\_insn's caller treats the failure as
a fatal error if the instruction cannot simply be reexecuted (as is the
case for MMIO). And this in fact happened sometimes when rebooting
Windows 2012r2 guests. Just checking ctxt->have\_exception and injecting
the exception if true is enough to fix the case.
Thanks to Eduardo Habkost for helping in the debugging of this issue.
Reported-by: Yanan Fu
Cc: Eduardo Habkost
Signed-off-by: Paolo Bonzini
Signed-off-by: Radim Krčmář
Signed-off-by: Greg Kroah-Hartman
commit 15cc35bc76f95d22d1e3e42617f6103568f19931
Author: Liran Alon
Date: Sun Nov 5 16:56:32 2017 +0200
KVM: x86: Exit to user-mode on #UD intercept when emulator requires
commit 61cb57c9ed631c95b54f8e9090c89d18b3695b3c upstream.
Instruction emulation after trapping a #UD exception can result in an
MMIO access, for example when emulating a MOVBE on a processor that
doesn't support the instruction. In this case, the #UD vmexit handler
must exit to user mode, but there wasn't any code to do so. Add it for
both VMX and SVM.
Signed-off-by: Liran Alon
Reviewed-by: Nikita Leshenko
Reviewed-by: Konrad Rzeszutek Wilk
Signed-off-by: Konrad Rzeszutek Wilk
Reviewed-by: Wanpeng Li
Reviewed-by: Paolo Bonzini
Signed-off-by: Radim Krčmář
Signed-off-by: Greg Kroah-Hartman
commit 6c4eaffbad3701f037f1d60ca892dcbe7641ff74
Author: Liran Alon
Date: Sun Nov 5 16:11:30 2017 +0200
KVM: x86: pvclock: Handle first-time write to pvclock-page contains random junk
commit 51c4b8bba674cfd2260d173602c4dac08e4c3a99 upstream.
When guest passes KVM it's pvclock-page GPA via WRMSR to
MSR\_KVM\_SYSTEM\_TIME / MSR\_KVM\_SYSTEM\_TIME\_NEW, KVM don't initialize
pvclock-page to some start-values. It just requests a clock-update which
will happen before entering to guest.
The clock-update logic will call kvm\_setup\_pvclock\_page() to update the
pvclock-page with info. However, kvm\_setup\_pvclock\_page() \*wrongly\*
assumes that the version-field is initialized to an even number. This is
wrong because at first-time write, field could be any-value.
Fix simply makes sure that if first-time version-field is odd, increment
it once more to make it even and only then start standard logic.
This follows same logic as done in other pvclock shared-pages (See
kvm\_write\_wall\_clock() and record\_steal\_time()).
Signed-off-by: Liran Alon
Reviewed-by: Nikita Leshenko
Reviewed-by: Konrad Rzeszutek Wilk
Signed-off-by: Konrad Rzeszutek Wilk
Reviewed-by: Paolo Bonzini
Signed-off-by: Radim Krčmář
Signed-off-by: Greg Kroah-Hartman
commit c12e358867d2656b10ccccc36240d6ce93e0e497
Author: Michael Ellerman
Date: Fri Nov 24 14:51:02 2017 +1100
powerpc/kexec: Fix kexec/kdump in P9 guest kernels
commit 2621e945fbf1d6df5f3f0ba7be5bae3d2cf9b6a5 upstream.
The code that cleans up the IAMR/AMOR before kexec'ing failed to
remember that when we're running as a guest AMOR is not writable, it's
hypervisor privileged.
They symptom is that the kexec stops before entering purgatory and
nothing else is seen on the console. If you examine the state of the
system all threads will be in the 0x700 program check handler.
Fix it by making the write to AMOR dependent on HV mode.
Fixes: 1e2a516e89fc ("powerpc/kexec: Fix radix to hash kexec due to IAMR/AMOR")
Reported-by: Yilin Zhang
Debugged-by: David Gibson
Signed-off-by: Michael Ellerman
Acked-by: Balbir Singh
Reviewed-by: David Gibson
Tested-by: David Gibson
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit 3bfbf2b1bc18f76dc88064b4d6354b2e4424478c
Author: Mahesh Salgaonkar
Date: Wed Nov 22 23:02:07 2017 +0530
powerpc/powernv: Fix kexec crashes caused by tlbie tracing
commit a3961f824cdbe7eb431254dc7d8f6f6767f474aa upstream.
Rebooting into a new kernel with kexec fails in trace\_tlbie() which is
called from native\_hpte\_clear(). This happens if the running kernel
has CONFIG\_LOCKDEP enabled. With lockdep enabled, the tracepoints
always execute few RCU checks regardless of whether tracing is on or
off. We are already in the last phase of kexec sequence in real mode
with HILE\_BE set. At this point the RCU check ends up in
RCU\_LOCKDEP\_WARN and causes kexec to fail.
Fix this by not calling trace\_tlbie() from native\_hpte\_clear().
mpe: It's not safe to call trace points at this point in the kexec
path, even if we could avoid the RCU checks/warnings. The only
solution is to not call them.
Fixes: 0428491cba92 ("powerpc/mm: Trace tlbie(l) instructions")
Signed-off-by: Mahesh Salgaonkar
Reported-by: Aneesh Kumar K.V
Suggested-by: Michael Ellerman
Acked-by: Naveen N. Rao
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit e9b2a6680fb6173819598cba411522d37cb4585a
Author: Ard Biesheuvel
Date: Mon Nov 20 17:41:30 2017 +0000
arm64: ftrace: emit ftrace-mod.o contents through code
commit be0f272bfc83797f70d44faca86954df62e2bbc0 upstream.
When building the arm64 kernel with both CONFIG\_ARM64\_MODULE\_PLTS and
CONFIG\_DYNAMIC\_FTRACE enabled, the ftrace-mod.o object file is built
with the kernel and contains a trampoline that is linked into each
module, so that modules can be loaded far away from the kernel and
still reach the ftrace entry point in the core kernel with an ordinary
relative branch, as is emitted by the compiler instrumentation code
dynamic ftrace relies on.
In order to be able to build out of tree modules, this object file
needs to be included into the linux-headers or linux-devel packages,
which is undesirable, as it makes arm64 a special case (although a
precedent does exist for 32-bit PPC).
Given that the trampoline essentially consists of a PLT entry, let's
not bother with a source or object file for it, and simply patch it
in whenever the trampoline is being populated, using the existing
PLT support routines.
Signed-off-by: Ard Biesheuvel
Signed-off-by: Will Deacon
Signed-off-by: Greg Kroah-Hartman
commit e1b4e001b22a12b67c890f4611bcf55285fd0fc5
Author: Ard Biesheuvel
Date: Mon Nov 20 17:41:29 2017 +0000
arm64: module-plts: factor out PLT generation code for ftrace
commit 7e8b9c1d2e2f5f45db7d40b50d14f606097c25de upstream.
To allow the ftrace trampoline code to reuse the PLT entry routines,
factor it out and move it into asm/module.h.
Signed-off-by: Ard Biesheuvel
Signed-off-by: Will Deacon
Signed-off-by: Greg Kroah-Hartman
commit 69af22696bc737dfe3444d2ece5db000fbff5c35
Author: John Johansen
Date: Wed Nov 22 07:33:38 2017 -0800
apparmor: fix oops in audit\_signal\_cb hook
commit b12cbb21586277f72533769832c24cc6c1d60ab3 upstream.
The apparmor\_audit\_data struct ordering got messed up during a merge
conflict, resulting in the signal integer and peer pointer being in
a union instead of a struct.
For most of the 4.13 and 4.14 life cycle, this was hidden by
commit 651e28c5537a ("apparmor: add base infastructure for socket
mediation") which fixed the apparmor\_audit\_data struct when its data
was added. When that commit was reverted in -rc7 the signal audit bug
was exposed, and unfortunately it never showed up in any of the
testing until after 4.14 was released. Shaun Khan, Zephaniah
E. Loss-Cutler-Hull filed nearly simultaneous bug reports (with
different oopes, the smaller of which is included below).
Full credit goes to Tetsuo Handa for jumping on this as well and
noticing the audit data struct problem and reporting it.
[ 76.178568] BUG: unable to handle kernel paging request at
ffffffff0eee3bc0
[ 76.178579] IP: audit\_signal\_cb+0x6c/0xe0
[ 76.178581] PGD 1a640a067 P4D 1a640a067 PUD 0
[ 76.178586] Oops: 0000 [#1] PREEMPT SMP
[ 76.178589] Modules linked in: fuse rfcomm bnep usblp uvcvideo btusb
btrtl btbcm btintel bluetooth ecdh\_generic ip6table\_filter ip6\_tables
xt\_tcpudp nf\_conntrack\_ipv4 nf\_defrag\_ipv4 xt\_conntrack nf\_conntrack
iptable\_filter ip\_tables x\_tables intel\_rapl joydev wmi\_bmof serio\_raw
iwldvm iwlwifi shpchp kvm\_intel kvm irqbypass autofs4 algif\_skcipher
nls\_iso8859\_1 nls\_cp437 crc32\_pclmul ghash\_clmulni\_intel
[ 76.178620] CPU: 0 PID: 10675 Comm: pidgin Not tainted
4.14.0-f1-dirty #135
[ 76.178623] Hardware name: Hewlett-Packard HP EliteBook Folio
9470m/18DF, BIOS 68IBD Ver. F.62 10/22/2015
[ 76.178625] task: ffff9c7a94c31dc0 task.stack: ffffa09b02a4c000
[ 76.178628] RIP: 0010:audit\_signal\_cb+0x6c/0xe0
[ 76.178631] RSP: 0018:ffffa09b02a4fc08 EFLAGS: 00010292
[ 76.178634] RAX: ffffa09b02a4fd60 RBX: ffff9c7aee0741f8 RCX:
0000000000000000
[ 76.178636] RDX: ffffffffee012290 RSI: 0000000000000006 RDI:
ffff9c7a9493d800
[ 76.178638] RBP: ffffa09b02a4fd40 R08: 000000000000004d R09:
ffffa09b02a4fc46
[ 76.178641] R10: ffffa09b02a4fcb8 R11: ffff9c7ab44f5072 R12:
ffffa09b02a4fd40
[ 76.178643] R13: ffffffff9e447be0 R14: ffff9c7a94c31dc0 R15:
0000000000000001
[ 76.178646] FS: 00007f8b11ba2a80(0000) GS:ffff9c7afea00000(0000)
knlGS:0000000000000000
[ 76.178648] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 76.178650] CR2: ffffffff0eee3bc0 CR3: 00000003d5209002 CR4:
00000000001606f0
[ 76.178652] Call Trace:
[ 76.178660] common\_lsm\_audit+0x1da/0x780
[ 76.178665] ? d\_absolute\_path+0x60/0x90
[ 76.178669] ? aa\_check\_perms+0xcd/0xe0
[ 76.178672] aa\_check\_perms+0xcd/0xe0
[ 76.178675] profile\_signal\_perm.part.0+0x90/0xa0
[ 76.178679] aa\_may\_signal+0x16e/0x1b0
[ 76.178686] apparmor\_task\_kill+0x51/0x120
[ 76.178690] security\_task\_kill+0x44/0x60
[ 76.178695] group\_send\_sig\_info+0x25/0x60
[ 76.178699] kill\_pid\_info+0x36/0x60
[ 76.178703] SYSC\_kill+0xdb/0x180
[ 76.178707] ? preempt\_count\_sub+0x92/0xd0
[ 76.178712] ? \_raw\_write\_unlock\_irq+0x13/0x30
[ 76.178716] ? task\_work\_run+0x6a/0x90
[ 76.178720] ? exit\_to\_usermode\_loop+0x80/0xa0
[ 76.178723] entry\_SYSCALL\_64\_fastpath+0x13/0x94
[ 76.178727] RIP: 0033:0x7f8b0e58b767
[ 76.178729] RSP: 002b:00007fff19efd4d8 EFLAGS: 00000206 ORIG\_RAX:
000000000000003e
[ 76.178732] RAX: ffffffffffffffda RBX: 0000557f3e3c2050 RCX:
00007f8b0e58b767
[ 76.178735] RDX: 0000000000000000 RSI: 0000000000000000 RDI:
000000000000263b
[ 76.178737] RBP: 0000000000000000 R08: 0000557f3e3c2270 R09:
0000000000000001
[ 76.178739] R10: 000000000000022d R11: 0000000000000206 R12:
0000000000000000
[ 76.178741] R13: 0000000000000001 R14: 0000557f3e3c13c0 R15:
0000000000000000
[ 76.178745] Code: 48 8b 55 18 48 89 df 41 b8 20 00 08 01 5b 5d 48 8b
42 10 48 8b 52 30 48 63 48 4c 48 8b 44 c8 48 31 c9 48 8b 70 38 e9 f4 fd
00 00 <48> 8b 14 d5 40 27 e5 9e 48 c7 c6 7d 07 19 9f 48 89 df e8 fd 35
[ 76.178794] RIP: audit\_signal\_cb+0x6c/0xe0 RSP: ffffa09b02a4fc08
[ 76.178796] CR2: ffffffff0eee3bc0
[ 76.178799] ---[ end trace 514af9529297f1a3 ]---
Fixes: cd1dbf76b23d ("apparmor: add the ability to mediate signals")
Reported-by: Zephaniah E. Loss-Cutler-Hull
Reported-by: Shuah Khan
Suggested-by: Tetsuo Handa
Tested-by: Ivan Kozik
Tested-by: Zephaniah E. Loss-Cutler-Hull
Tested-by: Christian Boltz
Tested-by: Shuah Khan
Signed-off-by: John Johansen
Signed-off-by: Greg Kroah-Hartman
commit a3ed24cd28f2db6f6f5b2009565a2463c0df4af0
Author: Peter Ujfalusi
Date: Mon Nov 20 11:51:40 2017 +0200
omapdrm: hdmi4: Correct the SoC revision matching
commit 23970e150a0a49f9a966c46e5d22fed06226098f upstream.
I believe the intention of the commit 2c9fc9bf45f8
("drm: omapdrm: Move FEAT\_HDMI\_\* features to hdmi4 driver")
was to identify omap4430 ES1.x, omap4430 ES2.x and other OMAP4 revisions,
like omap4460.
By using family=OMAP4 in the match the code will treat omap4460 ES1.x in a
same way as it would treat omap4430 ES1.x
This breaks HDMI audio on OMAP4460 devices (PandaES for example).
Correct the match rule so we are not going to get false positive match.
Fixes: 2c9fc9bf45f8 ("drm: omapdrm: Move FEAT\_HDMI\_\* features to hdmi4 driver")
Signed-off-by: Peter Ujfalusi
Reviewed-by: Laurent Pinchart
Signed-off-by: Tomi Valkeinen
Signed-off-by: Greg Kroah-Hartman
commit 4479ade38b14f53673b0843308fe24344b37cba5
Author: Laurent Pinchart
Date: Thu Nov 16 09:50:19 2017 +0100
drm: omapdrm: Fix DPI on platforms using the DSI VDDS
commit bf25dac38f71d392a31ec074f55cbc941f1eaf1d upstream.
Commit d178e034d565 ("drm: omapdrm: Move FEAT\_DPI\_USES\_VDDS\_DSI feature
to dpi code") replaced usage of platform data version with SoC matching
to configure DPI VDDS. The SoC match entries were incorrect, they should
have matched on the machine name instead of the SoC family. Fix it.
The result was observed on OpenPandora with OMAP3530 where the panel only
had the Blue channel and Red&Green were missing. It was not observed on
GTA04 with DM3730.
Fixes: d178e034d565 ("drm: omapdrm: Move FEAT\_DPI\_USES\_VDDS\_DSI feature to dpi code")
Signed-off-by: Laurent Pinchart
Reported-by: H. Nikolaus Schaller
Tested-by: H. Nikolaus Schaller
Signed-off-by: Tomi Valkeinen
Signed-off-by: Greg Kroah-Hartman
commit b367ea94535dbdede5e00110339b3e4c9bdc617d
Author: Martin Schwidefsky
Date: Fri Nov 24 16:23:15 2017 +0100
s390: revert ELF\_ET\_DYN\_BASE base changes
commit 345f8f34bb473241d62803951c18a844dd705f8d upstream.
This reverts commit a73dc5370e153ac63718d850bddf0c9aa9d871e6.
Reducing the base address for 31-bit PIE executables from
(STACK\_TOP/3)\*2 to 4MB broke several compat programs which
use -fpie to move the executable out of the lower 16MB.
Signed-off-by: Martin Schwidefsky
Signed-off-by: Greg Kroah-Hartman
commit 84779085fa10014b9e8208d7e71b54bced73075c
Author: Vasily Averin
Date: Thu Nov 2 13:03:42 2017 +0300
lockd: lost rollback of set\_grace\_period() in lockd\_down\_net()
commit 3a2b19d1ee5633f76ae8a88da7bc039a5d1732aa upstream.
Commit efda760fe95ea ("lockd: fix lockd shutdown race") is incorrect,
it removes lockd\_manager and disarm grace\_period\_end for init\_net only.
If nfsd was started from another net namespace lockd\_up\_net() calls
set\_grace\_period() that adds lockd\_manager into per-netns list
and queues grace\_period\_end delayed work.
These action should be reverted in lockd\_down\_net().
Otherwise it can lead to double list\_add on after restart nfsd in netns,
and to use-after-free if non-disarmed delayed work will be executed after netns destroy.
Fixes: efda760fe95e ("lockd: fix lockd shutdown race")
Signed-off-by: Vasily Averin
Signed-off-by: J. Bruce Fields
Signed-off-by: Greg Kroah-Hartman
commit 861eae231b0437427676a4ed323d31097002d5a2
Author: Ondrej Mosnáček
Date: Thu Nov 23 13:49:06 2017 +0100
crypto: skcipher - Fix skcipher\_walk\_aead\_common
commit c14ca8386539a298c1c19b003fe55e37d0f0e89c upstream.
The skcipher\_walk\_aead\_common function calls scatterwalk\_copychunks on
the input and output walks to skip the associated data. If the AD end
at an SG list entry boundary, then after these calls the walks will
still be pointing to the end of the skipped region.
These offsets are later checked for alignment in skcipher\_walk\_next,
so the skcipher\_walk may detect the alignment incorrectly.
This patch fixes it by calling scatterwalk\_done after the copychunks
calls to ensure that the offsets refer to the right SG list entry.
Fixes: b286d8b1a690 ("crypto: skcipher - Add skcipher walk interface")
Signed-off-by: Ondrej Mosnacek
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit 7f21961a2d7bfe45f734eab5b0ce6a40ee128b17
Author: Stephan Mueller
Date: Fri Nov 10 13:20:55 2017 +0100
crypto: af\_alg - remove locking in async callback
commit 7d2c3f54e6f646887d019faa45f35d6fe9fe82ce upstream.
The code paths protected by the socket-lock do not use or modify the
socket in a non-atomic fashion. The actions pertaining the socket do not
even need to be handled as an atomic operation. Thus, the socket-lock
can be safely ignored.
This fixes a bug regarding scheduling in atomic as the callback function
may be invoked in interrupt context.
In addition, the sock\_hold is moved before the AIO encrypt/decrypt
operation to ensure that the socket is always present. This avoids a
tiny race window where the socket is unprotected and yet used by the AIO
operation.
Finally, the release of resources for a crypto operation is moved into a
common function of af\_alg\_free\_resources.
Fixes: e870456d8e7c8 ("crypto: algif\_skcipher - overhaul memory management")
Fixes: d887c52d6ae43 ("crypto: algif\_aead - overhaul memory management")
Reported-by: Romain Izard
Signed-off-by: Stephan Mueller
Tested-by: Romain Izard
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit 721872a1997c4b8aae80ed2e6ef9dc05c53383f6
Author: Stephan Mueller
Date: Fri Nov 10 11:04:52 2017 +0100
crypto: algif\_aead - skip SGL entries with NULL page
commit 8e1fa89aa8bc2870009b4486644e4a58f2e2a4f5 upstream.
The TX SGL may contain SGL entries that are assigned a NULL page. This
may happen if a multi-stage AIO operation is performed where the data
for each stage is pointed to by one SGL entry. Upon completion of that
stage, af\_alg\_pull\_tsgl will assign NULL to the SGL entry.
The NULL cipher used to copy the AAD from TX SGL to the destination
buffer, however, cannot handle the case where the SGL starts with an SGL
entry having a NULL page. Thus, the code needs to advance the start
pointer into the SGL to the first non-NULL entry.
This fixes a crash visible on Intel x86 32 bit using the libkcapi test
suite.
Fixes: 72548b093ee38 ("crypto: algif\_aead - copy AAD from src to dst")
Signed-off-by: Stephan Mueller
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit b78da96d2882bea2ec7184dc1eba3e07e829364d
Author: Naofumi Honda
Date: Thu Nov 9 10:57:16 2017 -0500
nfsd: fix panic in posix\_unblock\_lock called from nfs4\_laundromat
commit 64ebe12494fd5d193f014ce38e1fd83cc57883c8 upstream.
From kernel 4.9, my two nfsv4 servers sometimes suffer from
"panic: unable to handle kernel page request"
in posix\_unblock\_lock() called from nfs4\_laundromat().
These panics diseappear if we revert the commit "nfsd: add a LRU list
for blocked locks".
The cause appears to be a typo in nfs4\_laundromat(), which is also
present in nfs4\_state\_shutdown\_net().
Fixes: 7919d0a27f1e "nfsd: add a LRU list for blocked locks"
Cc: jlayton@redhat.com
Reveiwed-by: Jeff Layton
Signed-off-by: J. Bruce Fields
Signed-off-by: Greg Kroah-Hartman
commit 73cfeab6755ccd442b689ea15769b7e9342c471e
Author: Trond Myklebust
Date: Fri Nov 3 08:00:11 2017 -0400
nfsd: Fix another OPEN stateid race
commit d8a1a000555ecd1b824ac1ed6df8fe364dfbbbb0 upstream.
If nfsd4\_process\_open2() is initialising a new stateid, and yet the
call to nfs4\_get\_vfs\_file() fails for some reason, then we must
declare the stateid closed, and unhash it before dropping the mutex.
Right now, we unhash the stateid after dropping the mutex, and without
changing the stateid type, meaning that another OPEN could theoretically
look it up and attempt to use it.
Reported-by: Andrew W Elble
Signed-off-by: Trond Myklebust
Signed-off-by: J. Bruce Fields
Signed-off-by: Greg Kroah-Hartman
commit db77ab54a5e2f740d1ae39326f90c06d5c5a26d4
Author: Trond Myklebust
Date: Fri Nov 3 08:00:10 2017 -0400
nfsd: Fix stateid races between OPEN and CLOSE
commit 15ca08d3299682dc49bad73251677b2c5017ef08 upstream.
Open file stateids can linger on the nfs4\_file list of stateids even
after they have been closed. In order to avoid reusing such a
stateid, and confusing the client, we need to recheck the
nfs4\_stid's type after taking the mutex.
Otherwise, we risk reusing an old stateid that was already closed,
which will confuse clients that expect new stateids to conform to
RFC7530 Sections 9.1.4.2 and 16.2.5 or RFC5661 Sections 8.2.2 and 18.2.4.
Signed-off-by: Trond Myklebust
Signed-off-by: J. Bruce Fields
Signed-off-by: Greg Kroah-Hartman
commit 28580e75734b8bfc10d0c23ba026737c71c551c8
Author: Josef Bacik
Date: Fri Nov 17 14:50:46 2017 -0500
btrfs: clear space cache inode generation always
commit 8e138e0d92c6c9d3d481674fb14e3439b495be37 upstream.
We discovered a box that had double allocations, and suspected the space
cache may be to blame. While auditing the write out path I noticed that
if we've already setup the space cache we will just carry on. This
means that any error we hit after cache\_save\_setup before we go to
actually write the cache out we won't reset the inode generation, so
whatever was already written will be considered correct, except it'll be
stale. Fix this by \_always\_ resetting the generation on the block group
inode, this way we only ever have valid or invalid cache.
With this patch I was no longer able to reproduce cache corruption with
dm-log-writes and my bpf error injection tool.
Signed-off-by: Josef Bacik
Signed-off-by: David Sterba
Signed-off-by: Greg Kroah-Hartman
commit be75ad849b9f3b0512e976a81e31a0beea1419ab
Author: Kirill A. Shutemov
Date: Wed Nov 29 16:11:30 2017 -0800
mm/hugetlb: fix NULL-pointer dereference on 5-level paging machine
commit f4f0a3d85b50a65a348e2b8635041d6b30f01deb upstream.
I made a mistake during converting hugetlb code to 5-level paging: in
huge\_pte\_alloc() we have to use p4d\_alloc(), not p4d\_offset().
Otherwise it leads to crash -- NULL-pointer dereference in pud\_alloc()
if p4d table is not yet allocated.
It only can happen in 5-level paging mode. In 4-level paging mode
p4d\_offset() always returns pgd, so we are fine.
Link: http://lkml.kernel.org/r/20171122121921.64822-1-kirill.shutemov@linux.intel.com
Fixes: c2febafc6773 ("mm: convert generic code to 5-level paging")
Signed-off-by: Kirill A. Shutemov
Acked-by: Vlastimil Babka
Acked-by: Michal Hocko
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit f354f4ffe6a371a4ae27a682cea56a7e4e1d74d9
Author: Ian Kent
Date: Wed Nov 29 16:11:26 2017 -0800
autofs: revert "autofs: fix AT\_NO\_AUTOMOUNT not being honored"
commit 5d38f049cee1e1c4a7ac55aa79d37d01ddcc3860 upstream.
Commit 42f461482178 ("autofs: fix AT\_NO\_AUTOMOUNT not being honored")
allowed the fstatat(2) system call to properly honor the AT\_NO\_AUTOMOUNT
flag but introduced a semantic change.
In order to honor AT\_NO\_AUTOMOUNT a semantic change was made to the
negative dentry case for stat family system calls in follow\_automount().
This changed the unconditional triggering of an automount in this case
to no longer be done and an error returned instead.
This has caused more problems than I expected so reverting the change is
needed.
In a discussion with Neil Brown it was concluded that the automount(8)
daemon can implement this change without kernel modifications. So that
will be done instead and the autofs module documentation updated with a
description of the problem and what needs to be done by module users for
this specific case.
Link: http://lkml.kernel.org/r/151174730120.6162.3848002191530283984.stgit@pluto.themaw.net
Fixes: 42f4614821 ("autofs: fix AT\_NO\_AUTOMOUNT not being honored")
Signed-off-by: Ian Kent
Cc: Neil Brown
Cc: Al Viro
Cc: David Howells
Cc: Colin Walters
Cc: Ondrej Holy
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 793a07bef9eb557ebad28cdf9ca30ba41d082c9f
Author: Ian Kent
Date: Wed Nov 29 16:11:23 2017 -0800
autofs: revert "autofs: take more care to not update last\_used on path walk"
commit 43694d4bf843ddd34519e8e9de983deefeada699 upstream.
While commit 092a53452bb7 ("autofs: take more care to not update
last\_used on path walk") helped (partially) resolve a problem where
automounts were not expiring due to aggressive accesses from user space
it has a side effect for very large environments.
This change helps with the expire problem by making the expire more
aggressive but, for very large environments, that means more mount
requests from clients. When there are a lot of clients that can mean
fairly significant server load increases.
It turns out I put the last\_used in this position to solve this very
problem and failed to update my own thinking of the autofs expire
policy. So the patch being reverted introduces a regression which
should be fixed.
Link: http://lkml.kernel.org/r/151174729420.6162.1832622523537052460.stgit@pluto.themaw.net
Fixes: 092a53452b ("autofs: take more care to not update last\_used on path walk")
Signed-off-by: Ian Kent
Reviewed-by: NeilBrown
Cc: Al Viro
Cc: Colin Walters
Cc: David Howells
Cc: Ondrej Holy
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit fa2a9894733bdeaa93c750735b7fdc581ef10024
Author: OGAWA Hirofumi
Date: Wed Nov 29 16:11:19 2017 -0800
fs/fat/inode.c: fix sb\_rdonly() change
commit b6e8e12c0aeb5fbf1bf46c84d58cc93aedede385 upstream.
Commit bc98a42c1f7d ("VFS: Convert sb->s\_flags & MS\_RDONLY to
sb\_rdonly(sb)") converted fat\_remount():new\_rdonly from a bool to an
int.
However fat\_remount() depends upon the compiler's conversion of a
non-zero integer into boolean `true'.
Fix it by switching `new\_rdonly' back into a bool.
Link: http://lkml.kernel.org/r/87mv3d5x51.fsf@mail.parknet.co.jp
Fixes: bc98a42c1f7d0f8 ("VFS: Convert sb->s\_flags & MS\_RDONLY to sb\_rdonly(sb)")
Signed-off-by: OGAWA Hirofumi
Cc: Joe Perches
Cc: David Howells
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit d983b6251c5535b5c5eb02ce48bf8eeb7417ef65
Author: Shakeel Butt
Date: Wed Nov 29 16:11:15 2017 -0800
mm, memcg: fix mem\_cgroup\_swapout() for THPs
commit d08afa149acfd00871484ada6dabc3880524cd1c upstream.
Commit d6810d730022 ("memcg, THP, swap: make mem\_cgroup\_swapout()
support THP") changed mem\_cgroup\_swapout() to support transparent huge
page (THP).
However the patch missed one location which should be changed for
correctly handling THPs. The resulting bug will cause the memory
cgroups whose THPs were swapped out to become zombies on deletion.
Link: http://lkml.kernel.org/r/20171128161941.20931-1-shakeelb@google.com
Fixes: d6810d730022 ("memcg, THP, swap: make mem\_cgroup\_swapout() support THP")
Signed-off-by: Shakeel Butt
Acked-by: Johannes Weiner
Acked-by: Michal Hocko
Cc: Huang Ying
Cc: Vladimir Davydov
Cc: Greg Thelen
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
commit 13167cf417ddf105d2822eebe775547ed35d1a08
Author: Zi Yan
Date: Wed Nov 29 16:11:12 2017 -0800
mm: migrate: fix an incorrect call of prep\_transhuge\_page()
commit 40a899ed16486455f964e46d1af31fd4fded21c1 upstream.
In https://lkml.org/lkml/2017/11/20/411, Andrea reported that during
memory hotplug/hot remove prep\_transhuge\_page() is called incorrectly on
non-THP pages for migration, when THP is on but THP migration is not
enabled. This leads to a bad state of target pages for migration.
By inspecting the code, if called on a non-THP, prep\_transhuge\_page()
will
1) change the value of the mapping of (page + 2), since it is used for
THP deferred list;
2) change the lru value of (page + 1), since it is used for THP's dtor.
Both can lead to data corruption of these two pages.
Andrea said:
"Pragmatically and from the point of view of the memory\_hotplug subsys,
the effect is a kernel crash when pages are being migrated during a
memory hot remove offline and migration target pages are found in a
bad state"
This patch fixes it by only calling prep\_transhuge\_page() when we are
certain that the target page is THP.
Link: http://lkml.kernel.org/r/20171121021855.50525-1-zi.yan@sent.com
Fixes: 8135d8926c08 ("mm: memory\_hotplug: memory hotremove supports thp migration")
Signed-off-by: Zi Yan
Reported-by: Andrea Reale
Cc: Naoya Horiguchi
Cc: Michal Hocko
Cc: "Jérôme Glisse"
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 8a0bb9ebaa8b8faee61f095757662fe5d7fd8da6
Author: chenjie
Date: Wed Nov 29 16:10:54 2017 -0800
mm/madvise.c: fix madvise() infinite loop under special circumstances
commit 6ea8d958a2c95a1d514015d4e29ba21a8c0a1a91 upstream.
MADVISE\_WILLNEED has always been a noop for DAX (formerly XIP) mappings.
Unfortunately madvise\_willneed() doesn't communicate this information
properly to the generic madvise syscall implementation. The calling
convention is quite subtle there. madvise\_vma() is supposed to either
return an error or update &prev otherwise the main loop will never
advance to the next vma and it will keep looping for ever without a way
to get out of the kernel.
It seems this has been broken since introduction. Nobody has noticed
because nobody seems to be using MADVISE\_WILLNEED on these DAX mappings.
[mhocko@suse.com: rewrite changelog]
Link: http://lkml.kernel.org/r/20171127115318.911-1-guoxuenan@huawei.com
Fixes: fe77ba6f4f97 ("[PATCH] xip: madvice/fadvice: execute in place")
Signed-off-by: chenjie
Signed-off-by: guoxuenan
Acked-by: Michal Hocko
Cc: Minchan Kim
Cc: zhangyi (F)
Cc: Miao Xie
Cc: Mike Rapoport
Cc: Shaohua Li
Cc: Andrea Arcangeli
Cc: Mel Gorman
Cc: Kirill A. Shutemov
Cc: David Rientjes
Cc: Anshuman Khandual
Cc: Rik van Riel
Cc: Carsten Otte
Cc: Dan Williams
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit c16a65582a72d3adea145b9b0a737c6c35ce89fc
Author: Kees Cook
Date: Wed Nov 29 16:10:51 2017 -0800
exec: avoid RLIMIT\_STACK races with prlimit()
commit 04e35f4495dd560db30c25efca4eecae8ec8c375 upstream.
While the defense-in-depth RLIMIT\_STACK limit on setuid processes was
protected against races from other threads calling setrlimit(), I missed
protecting it against races from external processes calling prlimit().
This adds locking around the change and makes sure that rlim\_max is set
too.
Link: http://lkml.kernel.org/r/20171127193457.GA11348@beast
Fixes: 64701dee4178e ("exec: Use sane stack rlimit under secureexec")
Signed-off-by: Kees Cook
Reported-by: Ben Hutchings
Reported-by: Brad Spengler
Acked-by: Serge Hallyn
Cc: James Morris
Cc: Andy Lutomirski
Cc: Oleg Nesterov
Cc: Jiri Slaby
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit aab681eb8f3bfe2950c8493f39cef6ae34b731b3
Author: Dan Williams
Date: Wed Nov 29 16:10:47 2017 -0800
IB/core: disable memory registration of filesystem-dax vmas
commit 5f1d43de54164dcfb9bfa542fcc92c1e1a1b6c1d upstream.
Until there is a solution to the dma-to-dax vs truncate problem it is
not safe to allow RDMA to create long standing memory registrations
against filesytem-dax vmas.
Link: http://lkml.kernel.org/r/151068941011.7446.7766030590347262502.stgit@dwillia2-desk3.amr.corp.intel.com
Fixes: 3565fce3a659 ("mm, x86: get\_user\_pages() for dax mappings")
Signed-off-by: Dan Williams
Reported-by: Christoph Hellwig
Reviewed-by: Christoph Hellwig
Acked-by: Jason Gunthorpe
Acked-by: Doug Ledford
Cc: Sean Hefty
Cc: Hal Rosenstock
Cc: Jeff Moyer
Cc: Ross Zwisler
Cc: Inki Dae
Cc: Jan Kara
Cc: Joonyoung Shim
Cc: Kyungmin Park
Cc: Mauro Carvalho Chehab
Cc: Mel Gorman
Cc: Seung-Woo Kim
Cc: Vlastimil Babka
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit e13ee3368ee1cbf4d2a9a70af20cdf519fd8bb3c
Author: Dan Williams
Date: Wed Nov 29 16:10:43 2017 -0800
v4l2: disable filesystem-dax mapping support
commit b70131de648c2b997d22f4653934438013f407a1 upstream.
V4L2 memory registrations are incompatible with filesystem-dax that
needs the ability to revoke dma access to a mapping at will, or
otherwise allow the kernel to wait for completion of DMA. The
filesystem-dax implementation breaks the traditional solution of
truncate of active file backed mappings since there is no page-cache
page we can orphan to sustain ongoing DMA.
If v4l2 wants to support long lived DMA mappings it needs to arrange to
hold a file lease or use some other mechanism so that the kernel can
coordinate revoking DMA access when the filesystem needs to truncate
mappings.
Link: http://lkml.kernel.org/r/151068940499.7446.12846708245365671207.stgit@dwillia2-desk3.amr.corp.intel.com
Fixes: 3565fce3a659 ("mm, x86: get\_user\_pages() for dax mappings")
Signed-off-by: Dan Williams
Reported-by: Jan Kara
Reviewed-by: Jan Kara
Cc: Mauro Carvalho Chehab
Cc: Christoph Hellwig
Cc: Doug Ledford
Cc: Hal Rosenstock
Cc: Inki Dae
Cc: Jason Gunthorpe
Cc: Jeff Moyer
Cc: Joonyoung Shim
Cc: Kyungmin Park
Cc: Mel Gorman
Cc: Ross Zwisler
Cc: Sean Hefty
Cc: Seung-Woo Kim
Cc: Vlastimil Babka
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit daac045736edf0e4ec21d7b39b3633537246f9c8
Author: Dan Williams
Date: Wed Nov 29 16:10:39 2017 -0800
mm: fail get\_vaddr\_frames() for filesystem-dax mappings
commit b7f0554a56f21fb3e636a627450a9add030889be upstream.
Until there is a solution to the dma-to-dax vs truncate problem it is
not safe to allow V4L2, Exynos, and other frame vector users to create
long standing / irrevocable memory registrations against filesytem-dax
vmas.
[dan.j.williams@intel.com: add comment for vma\_is\_fsdax() check in get\_vaddr\_frames(), per Jan]
Link: http://lkml.kernel.org/r/151197874035.26211.4061781453123083667.stgit@dwillia2-desk3.amr.corp.intel.com
Link: http://lkml.kernel.org/r/151068939985.7446.15684639617389154187.stgit@dwillia2-desk3.amr.corp.intel.com
Fixes: 3565fce3a659 ("mm, x86: get\_user\_pages() for dax mappings")
Signed-off-by: Dan Williams
Reviewed-by: Jan Kara
Cc: Inki Dae
Cc: Seung-Woo Kim
Cc: Joonyoung Shim
Cc: Kyungmin Park
Cc: Mauro Carvalho Chehab
Cc: Mel Gorman
Cc: Vlastimil Babka
Cc: Christoph Hellwig
Cc: Doug Ledford
Cc: Hal Rosenstock
Cc: Jason Gunthorpe
Cc: Jeff Moyer
Cc: Ross Zwisler
Cc: Sean Hefty
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 40aa9d2998ca55d9011e75a0fa526ed52e0a4bce
Author: Dan Williams
Date: Wed Nov 29 16:10:35 2017 -0800
mm: introduce get\_user\_pages\_longterm
commit 2bb6d2837083de722bfdc369cb0d76ce188dd9b4 upstream.
Patch series "introduce get\_user\_pages\_longterm()", v2.
Here is a new get\_user\_pages api for cases where a driver intends to
keep an elevated page count indefinitely. This is distinct from usages
like iov\_iter\_get\_pages where the elevated page counts are transient.
The iov\_iter\_get\_pages cases immediately turn around and submit the
pages to a device driver which will put\_page when the i/o operation
completes (under kernel control).
In the longterm case userspace is responsible for dropping the page
reference at some undefined point in the future. This is untenable for
filesystem-dax case where the filesystem is in control of the lifetime
of the block / page and needs reasonable limits on how long it can wait
for pages in a mapping to become idle.
Fixing filesystems to actually wait for dax pages to be idle before
blocks from a truncate/hole-punch operation are repurposed is saved for
a later patch series.
Also, allowing longterm registration of dax mappings is a future patch
series that introduces a "map with lease" semantic where the kernel can
revoke a lease and force userspace to drop its page references.
I have also tagged these for -stable to purposely break cases that might
assume that longterm memory registrations for filesystem-dax mappings
were supported by the kernel. The behavior regression this policy
change implies is one of the reasons we maintain the "dax enabled.
Warning: EXPERIMENTAL, use at your own risk" notification when mounting
a filesystem in dax mode.
It is worth noting the device-dax interface does not suffer the same
constraints since it does not support file space management operations
like hole-punch.
This patch (of 4):
Until there is a solution to the dma-to-dax vs truncate problem it is
not safe to allow long standing memory registrations against
filesytem-dax vmas. Device-dax vmas do not have this problem and are
explicitly allowed.
This is temporary until a "memory registration with layout-lease"
mechanism can be implemented for the affected sub-systems (RDMA and
V4L2).
[akpm@linux-foundation.org: use kcalloc()]
Link: http://lkml.kernel.org/r/151068939435.7446.13560129395419350737.stgit@dwillia2-desk3.amr.corp.intel.com
Fixes: 3565fce3a659 ("mm, x86: get\_user\_pages() for dax mappings")
Signed-off-by: Dan Williams
Suggested-by: Christoph Hellwig
Cc: Doug Ledford
Cc: Hal Rosenstock
Cc: Inki Dae
Cc: Jan Kara
Cc: Jason Gunthorpe
Cc: Jeff Moyer
Cc: Joonyoung Shim
Cc: Kyungmin Park
Cc: Mauro Carvalho Chehab
Cc: Mel Gorman
Cc: Ross Zwisler
Cc: Sean Hefty
Cc: Seung-Woo Kim
Cc: Vlastimil Babka
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 61586a2286140935fe711b3410c53ee1141633b2
Author: Dan Williams
Date: Wed Nov 29 16:10:32 2017 -0800
device-dax: implement ->split() to catch invalid munmap attempts
commit 9702cffdbf2129516db679e4467db81e1cd287da upstream.
Similar to how device-dax enforces that the 'address', 'offset', and
'len' parameters to mmap() be aligned to the device's fundamental
alignment, the same constraints apply to munmap(). Implement ->split()
to fail munmap calls that violate the alignment constraint.
Otherwise, we later fail VM\_BUG\_ON checks in the unmap\_page\_range() path
with crash signatures of the form:
vma ffff8800b60c8a88 start 00007f88c0000000 end 00007f88c0e00000
next (null) prev (null) mm ffff8800b61150c0
prot 8000000000000027 anon\_vma (null) vm\_ops ffffffffa0091240
pgoff 0 file ffff8800b638ef80 private\_data (null)
flags: 0x380000fb(read|write|shared|mayread|maywrite|mayexec|mayshare|softdirty|mixedmap|hugepage)
------------[ cut here ]------------
kernel BUG at mm/huge\_memory.c:2014!
[..]
RIP: 0010:\_\_split\_huge\_pud+0x12a/0x180
[..]
Call Trace:
unmap\_page\_range+0x245/0xa40
? \_\_vma\_adjust+0x301/0x990
unmap\_vmas+0x4c/0xa0
unmap\_region+0xae/0x120
? \_\_vma\_rb\_erase+0x11a/0x230
do\_munmap+0x276/0x410
vm\_munmap+0x6a/0xa0
SyS\_munmap+0x1d/0x30
Link: http://lkml.kernel.org/r/151130418681.4029.7118245855057952010.stgit@dwillia2-desk3.amr.corp.intel.com
Fixes: dee410792419 ("/dev/dax, core: file operations and dax-mmap")
Signed-off-by: Dan Williams
Reported-by: Jeff Moyer
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit c6c78a1d4561880c744d3ec932264b264a879e7c
Author: Dan Williams
Date: Wed Nov 29 16:10:28 2017 -0800
mm, hugetlbfs: introduce ->split() to vm\_operations\_struct
commit 31383c6865a578834dd953d9dbc88e6b19fe3997 upstream.
Patch series "device-dax: fix unaligned munmap handling"
When device-dax is operating in huge-page mode we want it to behave like
hugetlbfs and fail attempts to split vmas into unaligned ranges. It
would be messy to teach the munmap path about device-dax alignment
constraints in the same (hstate) way that hugetlbfs communicates this
constraint. Instead, these patches introduce a new ->split() vm
operation.
This patch (of 2):
The device-dax interface has similar constraints as hugetlbfs in that it
requires the munmap path to unmap in huge page aligned units. Rather
than add more custom vma handling code in \_\_split\_vma() introduce a new
vm operation to perform this vma specific check.
Link: http://lkml.kernel.org/r/151130418135.4029.6783191281930729710.stgit@dwillia2-desk3.amr.corp.intel.com
Fixes: dee410792419 ("/dev/dax, core: file operations and dax-mmap")
Signed-off-by: Dan Williams
Cc: Jeff Moyer
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit bf55918cb4fb374000ad1d063b207a17a93e8726
Author: Dan Williams
Date: Wed Nov 29 16:10:06 2017 -0800
mm: fix device-dax pud write-faults triggered by get\_user\_pages()
commit 1501899a898dfb5477c55534bdfd734c046da06d upstream.
Currently only get\_user\_pages\_fast() can safely handle the writable gup
case due to its use of pud\_access\_permitted() to check whether the pud
entry is writable. In the gup slow path pud\_write() is used instead of
pud\_access\_permitted() and to date it has been unimplemented, just calls
BUG\_ON().
kernel BUG at ./include/linux/hugetlb.h:244!
[..]
RIP: 0010:follow\_devmap\_pud+0x482/0x490
[..]
Call Trace:
follow\_page\_mask+0x28c/0x6e0
\_\_get\_user\_pages+0xe4/0x6c0
get\_user\_pages\_unlocked+0x130/0x1b0
get\_user\_pages\_fast+0x89/0xb0
iov\_iter\_get\_pages\_alloc+0x114/0x4a0
nfs\_direct\_read\_schedule\_iovec+0xd2/0x350
? nfs\_start\_io\_direct+0x63/0x70
nfs\_file\_direct\_read+0x1e0/0x250
nfs\_file\_read+0x90/0xc0
For now this just implements a simple check for the \_PAGE\_RW bit similar
to pmd\_write. However, this implies that the gup-slow-path check is
missing the extra checks that the gup-fast-path performs with
pud\_access\_permitted. Later patches will align all checks to use the
'access\_permitted' helper if the architecture provides it.
Note that the generic 'access\_permitted' helper fallback is the simple
\_PAGE\_RW check on architectures that do not define the
'access\_permitted' helper(s).
[dan.j.williams@intel.com: fix powerpc compile error]
Link: http://lkml.kernel.org/r/151129126165.37405.16031785266675461397.stgit@dwillia2-desk3.amr.corp.intel.com
Link: http://lkml.kernel.org/r/151043109938.2842.14834662818213616199.stgit@dwillia2-desk3.amr.corp.intel.com
Fixes: a00cc7d9dd93 ("mm, x86: add support for PUD-sized transparent hugepages")
Signed-off-by: Dan Williams
Reported-by: Stephen Rothwell
Acked-by: Thomas Gleixner  [x86]
Cc: Kirill A. Shutemov
Cc: Catalin Marinas
Cc: "David S. Miller"
Cc: Dave Hansen
Cc: Will Deacon
Cc: "H. Peter Anvin"
Cc: Ingo Molnar
Cc: Arnd Bergmann
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit b4c8fce668423c0dde23fe57682e5bd8df5bbeb9
Author: Mike Kravetz
Date: Wed Nov 29 16:10:01 2017 -0800
mm/cma: fix alloc\_contig\_range ret code/potential leak
commit 63cd448908b5eb51d84c52f02b31b9b4ccd1cb5a upstream.
If the call \_\_alloc\_contig\_migrate\_range() in alloc\_contig\_range returns
-EBUSY, processing continues so that test\_pages\_isolated() is called
where there is a tracepoint to identify the busy pages. However, it is
possible for busy pages to become available between the calls to these
two routines. In this case, the range of pages may be allocated.
Unfortunately, the original return code (ret == -EBUSY) is still set and
returned to the caller. Therefore, the caller believes the pages were
not allocated and they are leaked.
Update the comment to indicate that allocation is still possible even if
\_\_alloc\_contig\_migrate\_range returns -EBUSY. Also, clear return code in
this case so that it is not accidentally used or returned to caller.
Link: http://lkml.kernel.org/r/20171122185214.25285-1-mike.kravetz@oracle.com
Fixes: 8ef5849fa8a2 ("mm/cma: always check which page caused allocation failure")
Signed-off-by: Mike Kravetz
Acked-by: Vlastimil Babka
Acked-by: Michal Hocko
Acked-by: Johannes Weiner
Acked-by: Joonsoo Kim
Cc: Michal Nazarewicz
Cc: Laura Abbott
Cc: Michal Hocko
Cc: Mel Gorman
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 01ca9727457a167463a47e35b6fe5a5173b4e341
Author: Kirill A. Shutemov
Date: Mon Nov 27 06:21:25 2017 +0300
mm, thp: Do not make page table dirty unconditionally in touch\_p[mu]d()
commit a8f97366452ed491d13cf1e44241bc0b5740b1f0 upstream.
Currently, we unconditionally make page table dirty in touch\_pmd().
It may result in false-positive can\_follow\_write\_pmd().
We may avoid the situation, if we would only make the page table entry
dirty if caller asks for write access -- FOLL\_WRITE.
The patch also changes touch\_pud() in the same way.
Signed-off-by: Kirill A. Shutemov
Cc: Michal Hocko
Cc: Hugh Dickins
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 786b924d39bad16ff99aacdb4076df027cc2f8b8
Author: Wang Nan
Date: Wed Nov 29 16:09:58 2017 -0800
mm, oom\_reaper: gather each vma to prevent leaking TLB entry
commit 687cb0884a714ff484d038e9190edc874edcf146 upstream.
tlb\_gather\_mmu(&tlb, mm, 0, -1) means gathering the whole virtual memory
space. In this case, tlb->fullmm is true. Some archs like arm64
doesn't flush TLB when tlb->fullmm is true:
commit 5a7862e83000 ("arm64: tlbflush: avoid flushing when fullmm == 1").
Which causes leaking of tlb entries.
Will clarifies his patch:
"Basically, we tag each address space with an ASID (PCID on x86) which
is resident in the TLB. This means we can elide TLB invalidation when
pulling down a full mm because we won't ever assign that ASID to
another mm without doing TLB invalidation elsewhere (which actually
just nukes the whole TLB).
I think that means that we could potentially not fault on a kernel
uaccess, because we could hit in the TLB"
There could be a window between complete\_signal() sending IPI to other
cores and all threads sharing this mm are really kicked off from cores.
In this window, the oom reaper may calls tlb\_flush\_mmu\_tlbonly() to
flush TLB then frees pages. However, due to the above problem, the TLB
entries are not really flushed on arm64. Other threads are possible to
access these pages through TLB entries. Moreover, a copy\_to\_user() can
also write to these pages without generating page fault, causes
use-after-free bugs.
This patch gathers each vma instead of gathering full vm space. In this
case tlb->fullmm is not true. The behavior of oom reaper become similar
to munmapping before do\_exit, which should be safe for all archs.
Link: http://lkml.kernel.org/r/20171107095453.179940-1-wangnan0@huawei.com
Fixes: aac453635549 ("mm, oom: introduce oom reaper")
Signed-off-by: Wang Nan
Acked-by: Michal Hocko
Acked-by: David Rientjes
Cc: Minchan Kim
Cc: Will Deacon
Cc: Bob Liu
Cc: Ingo Molnar
Cc: Roman Gushchin
Cc: Konstantin Khlebnikov
Cc: Andrea Arcangeli
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit b8d0c953d928fbdc3207f741a2b77055d34fd0b9
Author: Michal Hocko
Date: Wed Nov 29 16:09:54 2017 -0800
mm, memory\_hotplug: do not back off draining pcp free pages from kworker context
commit 4b81cb2ff69c8a8e297a147d2eb4d9b5e8d7c435 upstream.
drain\_all\_pages backs off when called from a kworker context since
commit 0ccce3b92421 ("mm, page\_alloc: drain per-cpu pages from workqueue
context") because the original IPI based pcp draining has been replaced
by a WQ based one and the check wanted to prevent from recursion and
inter workers dependencies. This has made some sense at the time
because the system WQ has been used and one worker holding the lock
could be blocked while waiting for new workers to emerge which can be a
problem under OOM conditions.
Since then commit ce612879ddc7 ("mm: move pcp and lru-pcp draining into
single wq") has moved draining to a dedicated (mm\_percpu\_wq) WQ with a
rescuer so we shouldn't depend on any other WQ activity to make a
forward progress so calling drain\_all\_pages from a worker context is
safe as long as this doesn't happen from mm\_percpu\_wq itself which is
not the case because all workers are required to \_not\_ depend on any MM
locks.
Why is this a problem in the first place? ACPI driven memory hot-remove
(acpi\_device\_hotplug) is executed from the worker context. We end up
calling \_\_offline\_pages to free all the pages and that requires both
lru\_add\_drain\_all\_cpuslocked and drain\_all\_pages to do their job
otherwise we can have dangling pages on pcp lists and fail the offline
operation (\_\_test\_page\_isolated\_in\_pageblock would see a page with 0 ref
count but without PageBuddy set).
Fix the issue by removing the worker check in drain\_all\_pages.
lru\_add\_drain\_all\_cpuslocked doesn't have this restriction so it works
as expected.
Link: http://lkml.kernel.org/r/20170828093341.26341-1-mhocko@kernel.org
Fixes: 0ccce3b924212 ("mm, page\_alloc: drain per-cpu pages from workqueue context")
Signed-off-by: Michal Hocko
Cc: Mel Gorman
Cc: Tejun Heo
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 2cbd866dd858ceebe2b735e3d8cd8eb702ca1f88
Author: Stefan Brüns
Date: Fri Nov 3 03:01:53 2017 +0100
platform/x86: hp-wmi: Fix tablet mode detection for convertibles
commit 9968e12a291e639dd51d1218b694d440b22a917f upstream.
Commit f9cf3b2880cc ("platform/x86: hp-wmi: Refactor dock and tablet
state fetchers") consolidated the methods for docking and laptop mode
detection, but omitted to apply the correct mask for the laptop mode
(it always uses the constant for docking).
Fixes: f9cf3b2880cc ("platform/x86: hp-wmi: Refactor dock and tablet state fetchers")
Signed-off-by: Stefan Brüns
Cc: Michel Dänzer
Signed-off-by: Andy Shevchenko
Signed-off-by: Greg Kroah-Hartman


=== Content from access.redhat.com_f7fa5d5f_20250126_045730.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from github.com_be6cc9df_20250125_010538.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F687cb0884a714ff484d038e9190edc874edcf146)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F687cb0884a714ff484d038e9190edc874edcf146)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.9k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  437](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/687cb0884a714ff484d038e9190edc874edcf146)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

mm, oom\_reaper: gather each vma to prevent leaking TLB entry

[Browse files](/torvalds/linux/tree/687cb0884a714ff484d038e9190edc874edcf146)
Browse the repository at this point in the history

```
tlb_gather_mmu(&tlb, mm, 0, -1) means gathering the whole virtual memory
space.  In this case, tlb->fullmm is true.  Some archs like arm64
doesn't flush TLB when tlb->fullmm is true:

  commit [5a7862e](https://github.com/torvalds/linux/commit/5a7862e83000ccfd36db927c6f060458fe271157) ("arm64: tlbflush: avoid flushing when fullmm == 1").

Which causes leaking of tlb entries.

Will clarifies his patch:
 "Basically, we tag each address space with an ASID (PCID on x86) which
  is resident in the TLB. This means we can elide TLB invalidation when
  pulling down a full mm because we won't ever assign that ASID to
  another mm without doing TLB invalidation elsewhere (which actually
  just nukes the whole TLB).

  I think that means that we could potentially not fault on a kernel
  uaccess, because we could hit in the TLB"

There could be a window between complete_signal() sending IPI to other
cores and all threads sharing this mm are really kicked off from cores.
In this window, the oom reaper may calls tlb_flush_mmu_tlbonly() to
flush TLB then frees pages.  However, due to the above problem, the TLB
entries are not really flushed on arm64.  Other threads are possible to
access these pages through TLB entries.  Moreover, a copy_to_user() can
also write to these pages without generating page fault, causes
use-after-free bugs.

This patch gathers each vma instead of gathering full vm space.  In this
case tlb->fullmm is not true.  The behavior of oom reaper become similar
to munmapping before do_exit, which should be safe for all archs.

Link: [http://lkml.kernel.org/r/20171107095453.179940-1-wangnan0@huawei.com](http://lkml.kernel.org/r/20171107095453.179940-1-wangnan0%40huawei.com)
Fixes: [aac4536](https://github.com/torvalds/linux/commit/aac453635549699c13a84ea1456d5b0e574ef855) ("mm, oom: introduce oom reaper")
Signed-off-by: Wang Nan <wangnan0@huawei.com>
Acked-by: Michal Hocko <mhocko@suse.com>
Acked-by: David Rientjes <rientjes@google.com>
Cc: Minchan Kim <minchan@kernel.org>
Cc: Will Deacon <will.deacon@arm.com>
Cc: Bob Liu <liubo95@huawei.com>
Cc: Ingo Molnar <mingo@kernel.org>
Cc: Roman Gushchin <guro@fb.com>
Cc: Konstantin Khlebnikov <khlebnikov@yandex-team.ru>
Cc: Andrea Arcangeli <aarcange@redhat.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
```

* Loading branch information

[![@WangNan0](https://avatars.githubusercontent.com/u/13254615?s=40&v=4)](/WangNan0) [![@torvalds](https://avatars.githubusercontent.com/u/1024025?s=40&v=4)](/torvalds)

[WangNan0](/torvalds/linux/commits?author=WangNan0 "View all commits by WangNan0")
authored and
[torvalds](/torvalds/linux/commits?author=torvalds "View all commits by torvalds")
committed
Nov 30, 2017

1 parent
[4b81cb2](/torvalds/linux/commit/4b81cb2ff69c8a8e297a147d2eb4d9b5e8d7c435)

commit 687cb08

Showing
**1 changed file**
with
**4 additions**
and
**3 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

7 changes: 4 additions & 3 deletions

7
[mm/oom\_kill.c](#diff-268fe084429e2dda106503d80d590ac28f341bcf5969eaed6c09891eea0ca466 "mm/oom_kill.c")

Show comments

[View file](/torvalds/linux/blob/687cb0884a714ff484d038e9190edc874edcf146/mm/oom_kill.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -550,7 +550,6 @@ static bool \_\_oom\_reap\_task\_mm(struct task\_struct \*tsk, struct mm\_struct \*mm) |
|  |  | \*/ |
|  |  | set\_bit(MMF\_UNSTABLE, &mm->flags); |
|  |  |  |
|  |  | tlb\_gather\_mmu(&tlb, mm, 0, -1); |
|  |  | for (vma = mm->mmap ; vma; vma = vma->vm\_next) { |
|  |  | if (!can\_madv\_dontneed\_vma(vma)) |
|  |  | continue; |
| Expand All | | @@ -565,11 +564,13 @@ static bool \_\_oom\_reap\_task\_mm(struct task\_struct \*tsk, struct mm\_struct \*mm) |
|  |  | \* we do not want to block exit\_mmap by keeping mm ref |
|  |  | \* count elevated without a good reason. |
|  |  | \*/ |
|  |  | if (vma\_is\_anonymous(vma) || !(vma->vm\_flags & VM\_SHARED)) |
|  |  | if (vma\_is\_anonymous(vma) || !(vma->vm\_flags & VM\_SHARED)) { |
|  |  | tlb\_gather\_mmu(&tlb, mm, vma->vm\_start, vma->vm\_end); |
|  |  | unmap\_page\_range(&tlb, vma, vma->vm\_start, vma->vm\_end, |
|  |  | NULL); |
|  |  | tlb\_finish\_mmu(&tlb, vma->vm\_start, vma->vm\_end); |
|  |  | } |
|  |  | } |
|  |  | tlb\_finish\_mmu(&tlb, 0, -1); |
|  |  | pr\_info("oom\_reaper: reaped process %d (%s), now anon-rss:%lukB, file-rss:%lukB, shmem-rss:%lukB\n", |
|  |  | task\_pid\_nr(tsk), tsk->comm, |
|  |  | K(get\_mm\_counter(mm, MM\_ANONPAGES)), |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `687cb08`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F687cb0884a714ff484d038e9190edc874edcf146) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


