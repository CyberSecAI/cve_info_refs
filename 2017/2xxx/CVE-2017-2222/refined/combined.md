=== Content from plugins.trac.wordpress.org_493272d0_20250125_212651.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F1667369)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Changeset](/changeset/1667368 "Changeset 1667368")
* [Next Changeset](/changeset/1667370 "Changeset 1667370") →

---

# Changeset 1667369

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
05/31/2017 12:05:17 AM
([8 years](/timeline?from=2017-05-31T00%3A05%3A17Z&precision=second "See timeline at 05/31/2017 12:05:17 AM") ago)

Author:
cbutlerjr
Message:

3.1.8 release

Location:
[wp-members/trunk](/browser/wp-members/trunk?rev=1667369)
Files:

33 edited

* [admin/admin.php](/browser/wp-members/trunk/admin/admin.php?rev=1667369 "Show entry in browser")
  (modified)
  ([3 diffs](#file0 "Show differences"))
* [admin/css/admin.css](/browser/wp-members/trunk/admin/css/admin.css?rev=1667369 "Show entry in browser")
  (modified)
  ([3 diffs](#file1 "Show differences"))
* [admin/includes/api.php](/browser/wp-members/trunk/admin/includes/api.php?rev=1667369 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [admin/includes/class-wp-members-admin-api.php](/browser/wp-members/trunk/admin/includes/class-wp-members-admin-api.php?rev=1667369 "Show entry in browser")
  (modified)
  ([4 diffs](#file3 "Show differences"))
* [admin/js/admin.js](/browser/wp-members/trunk/admin/js/admin.js?rev=1667369 "Show entry in browser")
  (modified)
  ([3 diffs](#file4 "Show differences"))
* [admin/js/shortcodes\_tinymce\_4.js](/browser/wp-members/trunk/admin/js/shortcodes_tinymce_4.js?rev=1667369 "Show entry in browser")
  (modified)
  ([5 diffs](#file5 "Show differences"))
* [admin/tab-captcha.php](/browser/wp-members/trunk/admin/tab-captcha.php?rev=1667369 "Show entry in browser")
  (modified)
  ([1 diff](#file6 "Show differences"))
* [admin/tab-dialogs.php](/browser/wp-members/trunk/admin/tab-dialogs.php?rev=1667369 "Show entry in browser")
  (modified)
  ([1 diff](#file7 "Show differences"))
* [admin/tab-emails.php](/browser/wp-members/trunk/admin/tab-emails.php?rev=1667369 "Show entry in browser")
  (modified)
  ([1 diff](#file8 "Show differences"))
* [admin/tab-fields.php](/browser/wp-members/trunk/admin/tab-fields.php?rev=1667369 "Show entry in browser")
  (modified)
  ([4 diffs](#file9 "Show differences"))
* [admin/tab-options.php](/browser/wp-members/trunk/admin/tab-options.php?rev=1667369 "Show entry in browser")
  (modified)
  ([2 diffs](#file10 "Show differences"))
* [admin/user-profile.php](/browser/wp-members/trunk/admin/user-profile.php?rev=1667369 "Show entry in browser")
  (modified)
  ([3 diffs](#file11 "Show differences"))
* [admin/users.php](/browser/wp-members/trunk/admin/users.php?rev=1667369 "Show entry in browser")
  (modified)
  ([1 diff](#file12 "Show differences"))
* [changelog.txt](/browser/wp-members/trunk/changelog.txt?rev=1667369 "Show entry in browser")
  (modified)
  ([1 diff](#file13 "Show differences"))
* [css/generic-no-float.css](/browser/wp-members/trunk/css/generic-no-float.css?rev=1667369 "Show entry in browser")
  (modified)
  ([3 diffs](#file14 "Show differences"))
* [css/wp-members-2014-no-float.css](/browser/wp-members/trunk/css/wp-members-2014-no-float.css?rev=1667369 "Show entry in browser")
  (modified)
  ([1 diff](#file15 "Show differences"))
* [css/wp-members-2015-no-float.css](/browser/wp-members/trunk/css/wp-members-2015-no-float.css?rev=1667369 "Show entry in browser")
  (modified)
  ([1 diff](#file16 "Show differences"))
* [css/wp-members-2016-no-float.css](/browser/wp-members/trunk/css/wp-members-2016-no-float.css?rev=1667369 "Show entry in browser")
  (modified)
  ([1 diff](#file17 "Show differences"))
* [inc/api.php](/browser/wp-members/trunk/inc/api.php?rev=1667369 "Show entry in browser")
  (modified)
  ([2 diffs](#file18 "Show differences"))
* [inc/class-wp-members-api.php](/browser/wp-members/trunk/inc/class-wp-members-api.php?rev=1667369 "Show entry in browser")
  (modified)
  ([1 diff](#file19 "Show differences"))
* [inc/class-wp-members-forms.php](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1667369 "Show entry in browser")
  (modified)
  ([17 diffs](#file20 "Show differences"))
* [inc/class-wp-members-user.php](/browser/wp-members/trunk/inc/class-wp-members-user.php?rev=1667369 "Show entry in browser")
  (modified)
  ([2 diffs](#file21 "Show differences"))
* [inc/class-wp-members.php](/browser/wp-members/trunk/inc/class-wp-members.php?rev=1667369 "Show entry in browser")
  (modified)
  ([3 diffs](#file22 "Show differences"))
* [inc/core.php](/browser/wp-members/trunk/inc/core.php?rev=1667369 "Show entry in browser")
  (modified)
  ([2 diffs](#file23 "Show differences"))
* [inc/deprecated.php](/browser/wp-members/trunk/inc/deprecated.php?rev=1667369 "Show entry in browser")
  (modified)
  ([1 diff](#file24 "Show differences"))
* [inc/dialogs.php](/browser/wp-members/trunk/inc/dialogs.php?rev=1667369 "Show entry in browser")
  (modified)
  ([1 diff](#file25 "Show differences"))
* [inc/forms.php](/browser/wp-members/trunk/inc/forms.php?rev=1667369 "Show entry in browser")
  (modified)
  ([1 diff](#file26 "Show differences"))
* [inc/register.php](/browser/wp-members/trunk/inc/register.php?rev=1667369 "Show entry in browser")
  (modified)
  ([2 diffs](#file27 "Show differences"))
* [inc/shortcodes.php](/browser/wp-members/trunk/inc/shortcodes.php?rev=1667369 "Show entry in browser")
  (modified)
  ([10 diffs](#file28 "Show differences"))
* [inc/users.php](/browser/wp-members/trunk/inc/users.php?rev=1667369 "Show entry in browser")
  (modified)
  ([3 diffs](#file29 "Show differences"))
* [inc/wp-registration.php](/browser/wp-members/trunk/inc/wp-registration.php?rev=1667369 "Show entry in browser")
  (modified)
  ([2 diffs](#file30 "Show differences"))
* [readme.txt](/browser/wp-members/trunk/readme.txt?rev=1667369 "Show entry in browser")
  (modified)
  ([4 diffs](#file31 "Show differences"))
* [wp-members.php](/browser/wp-members/trunk/wp-members.php?rev=1667369 "Show entry in browser")
  (modified)
  ([2 diffs](#file32 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [wp-members/trunk/admin/admin.php](/changeset/1667369/wp-members/trunk/admin/admin.php "Show the changeset 1667369 restricted to wp-members/trunk/admin/admin.php")

  | [r1628757](/browser/wp-members/trunk/admin/admin.php?rev=1628757#L26 "Show revision 1628757 of this file in browser") | [r1667369](/browser/wp-members/trunk/admin/admin.php?rev=1667369#L26 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 26 | 26 | \* - wpmem\_admin\_enqueue\_scripts |
  | 27 | 27 | \*/ |
  | 28 |  |  |
  | 29 |  | ~~/\*\*~~ |
  | 30 |  | ~~\* Calls the function to reorder fields.~~ |
  | 31 |  | ~~\*~~ |
  | 32 |  | ~~\* @since 2.8.0~~ |
  | 33 |  | ~~\*/~~ |
  | 34 |  | ~~function wpmem\_a\_do\_field\_reorder() {~~ |
  | 35 |  | ~~// Reorder registration fields.~~ |
  | 36 |  | ~~wpmem\_a\_field\_reorder();~~ |
  | 37 |  | ~~}~~ |
  | 38 | 28 |  |
  | 39 | 29 |  |
  | […](/browser/wp-members/trunk/admin/admin.php?rev=1628757#L158) | […](/browser/wp-members/trunk/admin/admin.php?rev=1667369#L148) |  |
  | 158 | 148 | wpmem\_a\_build\_options(); |
  | 159 | 149 | break; |
  | 160 |  | ~~case 'fields' :~~ |
  | 161 |  | ~~wpmem\_a\_build\_fields();~~ |
  | 162 |  | ~~break;~~ |
  | 163 | 150 | case 'dialogs' : |
  | 164 | 151 | wpmem\_a\_build\_dialogs(); |
  | […](/browser/wp-members/trunk/admin/admin.php?rev=1628757#L205) | […](/browser/wp-members/trunk/admin/admin.php?rev=1667369#L192) |  |
  | 205 | 192 | case 'update\_cpts': |
  | 206 | 193 | $did\_update = ( 'update\_cpts' == $action ) ? wpmem\_update\_cpts() : wpmem\_update\_options(); |
  | 207 |  | ~~break;~~ |
  | 208 |  |  |
  | 209 |  | ~~case 'update\_fields':~~ |
  | 210 |  | ~~case 'add\_field':~~ |
  | 211 |  | ~~case 'edit\_field':~~ |
  | 212 |  | ~~$did\_update = wpmem\_update\_fields( $action );~~ |
  | 213 | 194 | break; |
  | 214 | 195 |  |
* ## [wp-members/trunk/admin/css/admin.css](/changeset/1667369/wp-members/trunk/admin/css/admin.css "Show the changeset 1667369 restricted to wp-members/trunk/admin/css/admin.css")

  | [r1531322](/browser/wp-members/trunk/admin/css/admin.css?rev=1531322#L6 "Show revision 1531322 of this file in browser") | [r1667369](/browser/wp-members/trunk/admin/css/admin.css?rev=1667369#L6 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | \* This file is part of the WP-Members plugin by Chad Butler |
  | 7 | 7 | \* You can find out more about this plugin at http://rocketgeek.com |
  | 8 |  | \* Copyright (c) 2006-201~~5~~ Chad Butler |
  |  | 8 | \* Copyright (c) 2006-2017 Chad Butler |
  | 9 | 9 | \* WP-Members(tm) is a trademark of butlerblog.com |
  | 10 | 10 | \* |
  | […](/browser/wp-members/trunk/admin/css/admin.css?rev=1531322#L12) | […](/browser/wp-members/trunk/admin/css/admin.css?rev=1667369#L12) |  |
  | 12 | 12 | \* @subpackage WP-Members |
  | 13 | 13 | \* @author Chad Butler |
  | 14 |  | \* @copyright 2006-201~~5~~ |
  |  | 14 | \* @copyright 2006-2017 |
  | 15 | 15 | \*/ |
  | 16 | 16 |  |
  | […](/browser/wp-members/trunk/admin/css/admin.css?rev=1531322#L52) | […](/browser/wp-members/trunk/admin/css/admin.css?rev=1667369#L52) |  |
  | 52 | 52 | color: #f00; |
  | 53 | 53 | } |
  |  | 54 |  |
  |  | 55 | #the-list { |
  |  | 56 | cursor: move; |
  |  | 57 | } |
  |  | 58 | #sort { |
  |  | 59 | width: 24px; |
  |  | 60 | } |
* ## [wp-members/trunk/admin/includes/api.php](/changeset/1667369/wp-members/trunk/admin/includes/api.php "Show the changeset 1667369 restricted to wp-members/trunk/admin/includes/api.php")

  | [r1628757](/browser/wp-members/trunk/admin/includes/api.php?rev=1628757#L84 "Show revision 1628757 of this file in browser") | [r1667369](/browser/wp-members/trunk/admin/includes/api.php?rev=1667369#L84 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 84 | 84 | return add\_query\_arg( 'user\_id', $user\_id, admin\_url( 'user-edit.php' ) ); |
  | 85 | 85 | } |
  |  | 86 |  |
  |  | 87 | /\*\* |
  |  | 88 | \* Wrapper for form\_post\_url(). |
  |  | 89 | \* |
  |  | 90 | \* @since 3.1.8 |
  |  | 91 | \* |
  |  | 92 | \* @global object $wpmem The WP\_Members Object. |
  |  | 93 | \* @param  string $tab   The plugin tab being displayed. |
  |  | 94 | \* @param  mixed  $args  Array of additional arguments|boolean. Default: false. |
  |  | 95 | \* @return string $url |
  |  | 96 | \*/ |
  |  | 97 | function wpmem\_admin\_form\_post\_url( $args = false ) { |
  |  | 98 | global $wpmem; |
  |  | 99 | return $wpmem->admin->form\_post\_url( $args ); |
  |  | 100 | } |
* ## [wp-members/trunk/admin/includes/class-wp-members-admin-api.php](/changeset/1667369/wp-members/trunk/admin/includes/class-wp-members-admin-api.php "Show the changeset 1667369 restricted to wp-members/trunk/admin/includes/class-wp-members-admin-api.php")

  | [r1628757](/browser/wp-members/trunk/admin/includes/class-wp-members-admin-api.php?rev=1628757#L68 "Show revision 1628757 of this file in browser") | [r1667369](/browser/wp-members/trunk/admin/includes/class-wp-members-admin-api.php?rev=1667369#L68 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 68 | 68 | \*/ |
  | 69 | 69 | function load\_dependencies() { |
  | 70 |  | if ( is\_multisite() && current\_user\_can( 'edit\_theme\_options' ) ) { |
  |  | 70 |  |
  |  | 71 | // Default permissions for loading admin dependencies. |
  |  | 72 | $defaults = array( |
  |  | 73 | 'main'    => 'edit\_theme\_options', |
  |  | 74 | 'users'   => 'list\_users', |
  |  | 75 | 'options' => 'manage\_options', |
  |  | 76 | 'posts'   => 'edit\_posts', |
  |  | 77 | ); |
  |  | 78 | /\*\* |
  |  | 79 | \* Filter permission defaults. |
  |  | 80 | \* |
  |  | 81 | \* @since 3.1.8 |
  |  | 82 | \* |
  |  | 83 | \* @param  array $defaults |
  |  | 84 | \* |
  |  | 85 | \* @todo Still needs final evaluation. |
  |  | 86 | \*/ |
  |  | 87 | $permissions = apply\_filters( 'wpmem\_load\_admin\_permissions', $defaults ); |
  |  | 88 |  |
  |  | 89 | if ( current\_user\_can( $permissions['main'] ) ) { |
  | 71 | 90 | require\_once(  WPMEM\_PATH . 'admin/admin.php' ); |
  | 72 | 91 | } |
  | 73 |  | if ( current\_user\_can( ~~'edit\_users'~~ ) ) { |
  | 74 |  | require\_once( WPMEM\_PATH . 'admin/~~admin~~.php' ); |
  |  | 92 | if ( current\_user\_can( $permissions['users'] ) ) { |
  |  | 93 | require\_once( WPMEM\_PATH . 'admin/users.php' ); |
  | 75 | 94 | require\_once( WPMEM\_PATH . 'admin/user-profile.php' ); |
  | 76 | 95 | } |
  | 77 |  | if ( current\_user\_can( ~~'manage\_options'~~ ) ) { |
  |  | 96 | if ( current\_user\_can( $permissions['options'] ) ) { |
  | 78 | 97 | require\_once( WPMEM\_PATH . 'admin/tab-options.php' ); |
  | 79 | 98 | require\_once( WPMEM\_PATH . 'admin/tab-fields.php' ); |
  | […](/browser/wp-members/trunk/admin/includes/class-wp-members-admin-api.php?rev=1628757#L81) | […](/browser/wp-members/trunk/admin/includes/class-wp-members-admin-api.php?rev=1667369#L100) |  |
  | 81 | 100 | require\_once( WPMEM\_PATH . 'admin/tab-captcha.php' ); |
  | 82 | 101 | require\_once( WPMEM\_PATH . 'admin/tab-about.php' ); |
  |  | 102 | require\_once( WPMEM\_PATH . 'admin/tab-dialogs.php' ); |
  | 83 | 103 | require\_once( WPMEM\_PATH . 'admin/dialogs.php' ); |
  | 84 | 104 | } |
  | 85 |  | if ( current\_user\_can( ~~'edit\_posts'~~ ) ) { |
  |  | 105 | if ( current\_user\_can( $permissions['posts'] ) ) { |
  | 86 | 106 | require\_once( WPMEM\_PATH . 'admin/post.php' ); |
  | 87 | 107 | } |
  | 88 |  | ~~require\_once( WPMEM\_PATH . 'admin/tab-dialogs.php' );~~ |
  | 89 |  | ~~require\_once( WPMEM\_PATH . 'inc/users.php' );~~ |
  | 90 |  | ~~require\_once( WPMEM\_PATH . 'admin/users.php' );~~ |
  | 91 | 108 | require\_once( WPMEM\_PATH . 'admin/includes/api.php' ); |
  | 92 | 109 | include\_once( WPMEM\_PATH . 'inc/wp-registration.php' ); |
  | […](/browser/wp-members/trunk/admin/includes/class-wp-members-admin-api.php?rev=1628757#L110) | […](/browser/wp-members/trunk/admin/includes/class-wp-members-admin-api.php?rev=1667369#L127) |  |
  | 110 | 127 |  |
  | 111 | 128 | // If user has a role that cannot edit users, set profile actions for non-admins. |
  | 112 |  | if ( ! current\_user\_can( 'edit\_users' ) ) { |
  |  | 129 | if ( ! current\_user\_can( 'edit\_users' ) ) { |
  | 113 | 130 | // User actions and filters. |
  |  | 131 | add\_action( 'user\_edit\_form\_tag',         'wpmem\_user\_profile\_multipart' ); |
  | 114 | 132 | add\_action( 'show\_user\_profile',          'wpmem\_user\_profile'   ); |
  | 115 | 133 | add\_action( 'edit\_user\_profile',          'wpmem\_user\_profile'   ); |
  | 116 | 134 | add\_action( 'profile\_update',             'wpmem\_profile\_update' ); |
  | 117 | 135 | } else { |
  |  | 136 | add\_action( 'user\_edit\_form\_tag',         'wpmem\_user\_profile\_multipart' ); |
  | 118 | 137 | add\_action( 'show\_user\_profile',          'wpmem\_admin\_fields' ); |
  | 119 | 138 | add\_action( 'edit\_user\_profile',          'wpmem\_admin\_fields' ); |
  | […](/browser/wp-members/trunk/admin/includes/class-wp-members-admin-api.php?rev=1628757#L463) | […](/browser/wp-members/trunk/admin/includes/class-wp-members-admin-api.php?rev=1667369#L482) |  |
  | 463 | 482 | } |
  | 464 | 483 |  |
  |  | 484 | /\*\* |
  |  | 485 | \* Build admin panel form action url. |
  |  | 486 | \* |
  |  | 487 | \* @since 3.1.8 |
  |  | 488 | \* |
  |  | 489 | \* @global string $pagenow |
  |  | 490 | \* @global string $plugin\_page |
  |  | 491 | \* @global object $wpmem         The WP\_Members Object. |
  |  | 492 | \* @param  mixed  $args          Array of additional arguments|boolean. Default: false. |
  |  | 493 | \* @return string $url |
  |  | 494 | \*/ |
  |  | 495 | function form\_post\_url( $args = false ) { |
  |  | 496 | global $pagenow, $plugin\_page, $wpmem; |
  |  | 497 | $tab = wpmem\_get( 'tab', false, 'get' ); |
  |  | 498 | $params = array( 'page' => $plugin\_page ); |
  |  | 499 | if ( $tab ) { |
  |  | 500 | $params['tab'] = $tab; |
  |  | 501 | } |
  |  | 502 | if ( $args ) { |
  |  | 503 | foreach( $args as $key => $val ) { |
  |  | 504 | $params[ $key ] = $val; |
  |  | 505 | } |
  |  | 506 | } |
  |  | 507 | $url = add\_query\_arg( $params, admin\_url( $pagenow ) ); |
  |  | 508 | return $url; |
  |  | 509 | } |
  |  | 510 |  |
  | 465 | 511 | } // End of WP\_Members\_Admin\_API class. |
  | 466 | 512 |  |
* ## [wp-members/trunk/admin/js/admin.js](/changeset/1667369/wp-members/trunk/admin/js/admin.js "Show the changeset 1667369 restricted to wp-members/trunk/admin/js/admin.js")

  | [r1531322](/browser/wp-members/trunk/admin/js/admin.js?rev=1531322#L6 "Show revision 1531322 of this file in browser") | [r1667369](/browser/wp-members/trunk/admin/js/admin.js?rev=1667369#L6 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | \* This file is part of the WP-Members plugin by Chad Butler |
  | 7 | 7 | \* You can find out more about this plugin at http://rocketgeek.com |
  | 8 |  | \* Copyright (c) 2006-201~~5~~  Chad Butler |
  |  | 8 | \* Copyright (c) 2006-2017  Chad Butler |
  | 9 | 9 | \* WP-Members(tm) is a trademark of butlerblog.com |
  | 10 | 10 | \* |
  | 11 |  | \* TableDnD plugin for jQuery : |
  | 12 |  | \* Copyright (c) Denis Howlett <denish@isocra.com> |
  | 13 |  | \* Licensed like jQuery, see http://docs.jquery.com/License. |
  | 14 |  | \* |
  | 15 |  | \* table.add.row plugin for jQuery : |
  | 16 |  | \* Copyright (c) C.F.Wong <cloudgen@ymail.com> |
  | 17 |  | \* Licensed under the MIT License: http://www.opensource.org/licenses/mit-license.php |
  | 18 |  | \* |
  | 19 |  | \* @package WordPress |
  | 20 |  | \* @subpackage WP-Members |
  |  | 11 | \* @package WP-Members |
  | 21 | 12 | \* @author Chad Butler |
  | 22 |  | \* @copyright 2006-201~~5~~ |
  |  | 13 | \* @copyright 2006-2017 |
  | 23 | 14 | \*/ |
  | 24 |  |  |
  | 25 |  |  |
  | 26 |  | /\*\* |
  | 27 |  | \* JS for field table DnD |
  | 28 |  | \* |
  | 29 |  | \* @since 2.6 |
  | 30 |  | \*/ |
  | 31 |  | (function($) { |
  | 32 |  | $(document).ready(function() { |
  | 33 |  |  |
  | 34 |  | $("#wpmem-fields").tableDnD({ |
  | 35 |  | onDragClass: "wpmem\_tbl\_drag", |
  | 36 |  |  |
  | 37 |  | onDrop: function(table, row) { |
  | 38 |  | var data = { |
  | 39 |  | action: 'wpmem\_a\_field\_reorder', |
  | 40 |  | orderstring: $.tableDnD.serialize() |
  | 41 |  | } |
  | 42 |  |  |
  | 43 |  | $.post( ajaxurl, data, function(response) { |
  | 44 |  | // alert(response); |
  | 45 |  | }) |
  | 46 |  | } |
  | 47 |  | }); |
  | 48 |  | }); |
  | 49 |  | })(jQuery); |
  | 50 |  |  |
  | 51 |  |  |
  | 52 |  | /\*\* |
  | 53 |  | \* TableDnD plug-in for JQuery, allows you to drag and drop table rows |
  | 54 |  | \* You can set up various options to control how the system will work |
  | 55 |  | \* Copyright (c) Denis Howlett <denish@isocra.com> |
  | 56 |  | \* Licensed like jQuery, see http://docs.jquery.com/License. |
  | 57 |  | \*/ |
  | 58 |  | jQuery.tableDnD = { |
  | 59 |  | /\*\* Keep hold of the current table being dragged \*/ |
  | 60 |  | currentTable : null, |
  | 61 |  | /\*\* Keep hold of the current drag object if any \*/ |
  | 62 |  | dragObject: null, |
  | 63 |  | /\*\* The current mouse offset \*/ |
  | 64 |  | mouseOffset: null, |
  | 65 |  | /\*\* Remember the old value of Y so that we don't do too much processing \*/ |
  | 66 |  | oldY: 0, |
  | 67 |  |  |
  | 68 |  | /\*\* Actually build the structure \*/ |
  | 69 |  | build: function(options) { |
  | 70 |  | // Set up the defaults if any |
  | 71 |  |  |
  | 72 |  | this.each(function() { |
  | 73 |  | // This is bound to each matching table, set up the defaults and override with user options |
  | 74 |  | this.tableDnDConfig = jQuery.extend({ |
  | 75 |  | onDragStyle: null, |
  | 76 |  | onDropStyle: null, |
  | 77 |  | // Add in the default class for whileDragging |
  | 78 |  | onDragClass: "tDnD\_whileDrag", |
  | 79 |  | onDrop: null, |
  | 80 |  | onDragStart: null, |
  | 81 |  | scrollAmount: 5, |
  | 82 |  | serializeRegexp: /[^\-]\*$/, // The regular expression to use to trim row IDs |
  | 83 |  | serializeParamName: null, // If you want to specify another parameter name instead of the table ID |
  | 84 |  | dragHandle: null // If you give the name of a class here, then only Cells with this class will be draggable |
  | 85 |  | }, options || {}); |
  | 86 |  | // Now make the rows draggable |
  | 87 |  | jQuery.tableDnD.makeDraggable(this); |
  | 88 |  | }); |
  | 89 |  |  |
  | 90 |  | // Now we need to capture the mouse up and mouse move event |
  | 91 |  | // We can use bind so that we don't interfere with other event handlers |
  | 92 |  | jQuery(document) |
  | 93 |  | .bind('mousemove', jQuery.tableDnD.mousemove) |
  | 94 |  | .bind('mouseup', jQuery.tableDnD.mouseup); |
  | 95 |  |  |
  | 96 |  | // Don't break the chain |
  | 97 |  | return this; |
  | 98 |  | }, |
  | 99 |  |  |
  | 100 |  | /\*\* This function makes all the rows on the table draggable apart from those marked as "NoDrag" \*/ |
  | 101 |  | makeDraggable: function(table) { |
  | 102 |  | var config = table.tableDnDConfig; |
  | 103 |  | if (table.tableDnDConfig.dragHandle) { |
  | 104 |  | // We only need to add the event to the specified cells |
  | 105 |  | var cells = jQuery("td."+table.tableDnDConfig.dragHandle, table); |
  | 106 |  | cells.each(function() { |
  | 107 |  | // The cell is bound to "this" |
  | 108 |  | jQuery(this).mousedown(function(ev) { |
  | 109 |  | jQuery.tableDnD.dragObject = this.parentNode; |
  | 110 |  | jQuery.tableDnD.currentTable = table; |
  | 111 |  | jQuery.tableDnD.mouseOffset = jQuery.tableDnD.getMouseOffset(this, ev); |
  | 112 |  | if (config.onDragStart) { |
  | 113 |  | // Call the onDrop method if there is one |
  | 114 |  | config.onDragStart(table, this); |
  | 115 |  | } |
  | 116 |  | return false; |
  | 117 |  | }); |
  | 118 |  | }) |
  | 119 |  | } else { |
  | 120 |  | // For backwards compatibility, we add the event to the whole row |
  | 121 |  | var rows = jQuery("tr", table); // get all the rows as a wrapped set |
  | 122 |  | rows.each(function() { |
  | 123 |  | // Iterate through each row, the row is bound to "this" |
  | 124 |  | var row = jQuery(this); |
  | 125 |  | if (! row.hasClass("nodrag")) { |
  | 126 |  | row.mousedown(function(ev) { |
  | 127 |  | if (ev.target.tagName == "TD") { |
  | 128 |  | jQuery.tableDnD.dragObject = this; |
  | 129 |  | jQuery.tableDnD.currentTable = table; |
  | 130 |  | jQuery.tableDnD.mouseOffset = jQuery.tableDnD.getMouseOffset(this, ev); |
  | 131 |  | if (config.onDragStart) { |
  | 132 |  | // Call the onDrop method if there is one |
  | 133 |  | config.onDragStart(table, this); |
  | 134 |  | } |
  | 135 |  | return false; |
  | 136 |  | } |
  | 137 |  | }).css("cursor", "move"); // Store the tableDnD object |
  | 138 |  | } |
  |  | 15 |  |
  |  | 16 |  |
  |  | 17 | /\*\* |
  |  | 18 | \* JS for forms field table drag-and-drop. |
  |  | 19 | \* |
  |  | 20 | \* @since 3.1.2 |
  |  | 21 | \*/ |
  |  | 22 | jQuery(document).ready(function($) { |
  |  | 23 | $("#the-list").sortable({ |
  |  | 24 | items: '.list\_item', |
  |  | 25 | opacity: 0.6, |
  |  | 26 | cursor: 'move', |
  |  | 27 | axis: 'y', |
  |  | 28 | update: function() { |
  |  | 29 | var order = $(this).sortable('serialize') + '&action=wpmem\_a\_field\_reorder'; |
  |  | 30 | $.post(ajaxurl, order, function(response) { |
  |  | 31 | alert(response); |
  |  | 32 | }); |
  |  | 33 | $('.list\_item').each(function(i) { |
  |  | 34 | $(this).data('id', i + 1); // updates the data object |
  |  | 35 | $(this).attr('list\_item', i + 1); // updates the attribute |
  | 139 | 36 | }); |
  | 140 | 37 | } |
  | 141 |  | }, |
  | 142 |  |  |
  | 143 |  | updateTables: function() { |
  | 144 |  | this.each(function() { |
  | 145 |  | // this is now bound to each matching table |
  | 146 |  | if (this.tableDnDConfig) { |
  | 147 |  | jQuery.tableDnD.makeDraggable(this); |
  | 148 |  | } |
  | 149 |  | }) |
  | 150 |  | }, |
  | 151 |  |  |
  | 152 |  | /\*\* Get the mouse coordinates from the event (allowing for browser differences) \*/ |
  | 153 |  | mouseCoords: function(ev){ |
  | 154 |  | if(ev.pageX || ev.pageY){ |
  | 155 |  | return {x:ev.pageX, y:ev.pageY}; |
  | 156 |  | } |
  | 157 |  | return { |
  | 158 |  | x:ev.clientX + document.body.scrollLeft - document.body.clientLeft, |
  | 159 |  | y:ev.clientY + document.body.scrollTop  - document.body.clientTop |
  | 160 |  | }; |
  | 161 |  | }, |
  | 162 |  |  |
  | 163 |  | /\*\* Given a target element and a mouse event, get the mouse offset from that element. |
  | 164 |  | To do this we need the element's position and the mouse position \*/ |
  | 165 |  | getMouseOffset: function(target, ev) { |
  | 166 |  | ev = ev || window.event; |
  | 167 |  |  |
  | 168 |  | var docPos    = this.getPosition(target); |
  | 169 |  | var mousePos  = this.mouseCoords(ev); |
  | 170 |  | return {x:mousePos.x - docPos.x, y:mousePos.y - docPos.y}; |
  | 171 |  | }, |
  | 172 |  |  |
  | 173 |  | /\*\* Get the position of an element by going up the DOM tree and adding up all the offsets \*/ |
  | 174 |  | getPosition: function(e){ |
  | 175 |  | var left = 0; |
  | 176 |  | var top  = 0; |
  | 177 |  | /\*\* Safari fix -- thanks to Luis Chato for this! \*/ |
  | 178 |  | if (e.offsetHeight == 0) { |
  | 179 |  | /\*\* Safari 2 doesn't correctly grab the offsetTop of a table row |
  | 180 |  | this is detailed here: |
  | 181 |  | http://jacob.peargrove.com/blog/2006/technical/table-row-offsettop-bug-in-safari/ |
  | 182 |  | the solution is likewise noted there, grab the offset of a table cell in the row - the firstChild. |
  | 183 |  | note that firefox will return a text node as a first child, so designing a more thorough |
  | 184 |  | solution may need to take that into account, for now this seems to work in firefox, safari, ie \*/ |
  | 185 |  | e = e.firstChild; // a table cell |
  | 186 |  | } |
  | 187 |  |  |
  | 188 |  | while (e.offsetParent){ |
  | 189 |  | left += e.offsetLeft; |
  | 190 |  | top  += e.offsetTop; |
  | 191 |  | e     = e.offsetParent; |
  | 192 |  | } |
  | 193 |  |  |
  | 194 |  | left += e.offsetLeft; |
  | 195 |  | top  += e.offsetTop; |
  | 196 |  |  |
  | 197 |  | return {x:left, y:top}; |
  | 198 |  | }, |
  | 199 |  |  |
  | 200 |  | mousemove: function(ev) { |
  | 201 |  | if (jQuery.tableDnD.dragObject == null) { |
  | 202 |  | return; |
  | 203 |  | } |
  | 204 |  |  |
  | 205 |  | var dragObj = jQuery(jQuery.tableDnD.dragObject); |
  | 206 |  | var config = jQuery.tableDnD.currentTable.tableDnDConfig; |
  | 207 |  | var mousePos = jQuery.tableDnD.mouseCoords(ev); |
  | 208 |  | var y = mousePos.y - jQuery.tableDnD.mouseOffset.y; |
  | 209 |  | //auto scroll the window |
  | 210 |  | var yOffset = window.pageYOffset; |
  | 211 |  | if (document.all) { |
  | 212 |  | // Windows version |
  | 213 |  | //yOffset=document.body.scrollTop; |
  | 214 |  | if (typeof document.compatMode != 'undefined' && |
  | 215 |  | document.compatMode != 'BackCompat') { |
  | 216 |  | yOffset = document.documentElement.scrollTop; |
  | 217 |  | } |
  | 218 |  | else if (typeof document.body != 'undefined') { |
  | 219 |  | yOffset=document.body.scrollTop; |
  | 220 |  | } |
  | 221 |  |  |
  | 222 |  | } |
  | 223 |  |  |
  | 224 |  | if (mousePos.y-yOffset < config.scrollAmount) { |
  | 225 |  | window.scrollBy(0, -config.scrollAmount); |
  | 226 |  | } else { |
  | 227 |  | var windowHeight = window.innerHeight ? window.innerHeight |
  | 228 |  | : document.documentElement.clientHeight ? document.documentElement.clientHeight : document.body.clientHeight; |
  | 229 |  | if (windowHeight-(mousePos.y-yOffset) < config.scrollAmount) { |
  | 230 |  | window.scrollBy(0, config.scrollAmount); |
  | 231 |  | } |
  | 232 |  | } |
  | 233 |  |  |
  | 234 |  |  |
  | 235 |  | if (y != jQuery.tableDnD.oldY) { |
  | 236 |  | // work out if we're going up or down... |
  | 237 |  | var movingDown = y > jQuery.tableDnD.oldY; |
  | 238 |  | // update the old value |
  | 239 |  | jQuery.tableDnD.oldY = y; |
  | 240 |  | // update the style to show we're dragging |
  | 241 |  | if (config.onDragClass) { |
  | 242 |  | dragObj.addClass(config.onDragClass); |
  | 243 |  | } else { |
  | 244 |  | dragObj.css(config.onDragStyle); |
  | 245 |  | } |
  | 246 |  | // If we're over a row then move the dragged row to there so that the user sees the |
  | 247 |  | // effect dynamically |
  | 248 |  | var currentRow = jQuery.tableDnD.findDropTargetRow(dragObj, y); |
  | 249 |  | if (currentRow) { |
  | 250 |  | // TODO worry about what happens when there are multiple TBODIES |
  | 251 |  | if (movingDown && jQuery.tableDnD.dragObject != currentRow) { |
  | 252 |  | jQuery.tableDnD.dragObject.parentNode.insertBefore(jQuery.tableDnD.dragObject, currentRow.nextSibling); |
  | 253 |  | } else if (! movingDown && jQuery.tableDnD.dragObject != currentRow) { |
  | 254 |  | jQuery.tableDnD.dragObject.parentNode.insertBefore(jQuery.tableDnD.dragObject, currentRow); |
  | 255 |  | } |
  | 256 |  | } |
  | 257 |  | } |
  | 258 |  |  |
  | 259 |  | return false; |
  | 260 |  | }, |
  | 261 |  |  |
  | 262 |  | /\*\* We're only worried about the y position really, because we can only move rows up and down \*/ |
  | 263 |  | findDropTargetRow: function(draggedRow, y) { |
  | 264 |  | var rows = jQuery.tableDnD.currentTable.rows; |
  | 265 |  | for (var i=0; i<rows.length; i++) { |
  | 266 |  | var row = rows[i]; |
  | 267 |  | var rowY    = this.getPosition(row).y; |
  | 268 |  | var rowHeight = parseInt(row.offsetHeight)/2; |
  | 269 |  | if (row.offsetHeight == 0) { |
  | 270 |  | rowY = this.getPosition(row.firstChild).y; |
  | 271 |  | rowHeight = parseInt(row.firstChild.offsetHeight)/2; |
  | 272 |  | } |
  | 273 |  | // Because we always have to insert before, we need to offset the height a bit |
  | 274 |  | if ((y > rowY - rowHeight) && (y < (rowY + rowHeight))) { |
  | 275 |  | // that's the row we're over |
  | 276 |  | // If it's the same as the current row, ignore it |
  | 277 |  | if (row == draggedRow) {return null;} |
  | 278 |  | var config = jQuery.tableDnD.currentTable.tableDnDConfig; |
  | 279 |  | if (config.onAllowDrop) { |
  | 280 |  | if (config.onAllowDrop(draggedRow, row)) { |
  | 281 |  | return row; |
  | 282 |  | } else { |
  | 283 |  | return null; |
  | 284 |  | } |
  | 285 |  | } else { |
  | 286 |  | // If a row has nodrop class, then don't allow dropping (inspired by John Tarr and Famic) |
  | 287 |  | var nodrop = jQuery(row).hasClass("nodrop"); |
  | 288 |  | if (! nodrop) { |
  | 289 |  | return row; |
  | 290 |  | } else { |
  | 291 |  | return null; |
  | 292 |  | } |
  | 293 |  | } |
  | 294 |  | return row; |
  | 295 |  | } |
  | 296 |  | } |
  | 297 |  | return null; |
  | 298 |  | }, |
  | 299 |  |  |
  | 300 |  | mouseup: function(e) { |
  | 301 |  | if (jQuery.tableDnD.currentTable && jQuery.tableDnD.dragObject) { |
  | 302 |  | var droppedRow = jQuery.tableDnD.dragObject; |
  | 303 |  | var config = jQuery.tableDnD.currentTable.tableDnDConfig; |
  | 304 |  | // If we have a dragObject, then we need to release it, |
  | 305 |  | // The row will already have been moved to the right place so we just reset stuff |
  | 306 |  | if (config.onDragClass) { |
  | 307 |  | jQuery(droppedRow).removeClass(config.onDragClass); |
  | 308 |  | } else { |
  | 309 |  | jQuery(droppedRow).css(config.onDropStyle); |
  | 310 |  | } |
  | 311 |  | jQuery.tableDnD.dragObject   = null; |
  | 312 |  | if (config.onDrop) { |
  | 313 |  | // Call the onDrop method if there is one |
  | 314 |  | config.onDrop(jQuery.tableDnD.currentTable, droppedRow); |
  | 315 |  | } |
  | 316 |  | jQuery.tableDnD.currentTable = null; // let go of the table too |
  | 317 |  | } |
  | 318 |  | }, |
  | 319 |  |  |
  | 320 |  | serialize: function() { |
  | 321 |  | if (jQuery.tableDnD.currentTable) { |
  | 322 |  | return jQuery.tableDnD.serializeTable(jQuery.tableDnD.currentTable); |
  | 323 |  | } else { |
  | 324 |  | return "Error: No Table id set, you need to set an id on your table and every row"; |
  | 325 |  | } |
  | 326 |  | }, |
  | 327 |  |  |
  | 328 |  | serializeTable: function(table) { |
  | 329 |  | var result = ""; |
  | 330 |  | var tableId = table.id; |
  | 331 |  | var rows = table.rows; |
  | 332 |  | for (var i=0; i<rows.length; i++) { |
  | 333 |  | if (result.length > 0) result += "&"; |
  | 334 |  | var rowId = rows[i].id; |
  | 335 |  | if (rowId && rowId && table.tableDnDConfig && table.tableDnDConfig.serializeRegexp) { |
  | 336 |  | rowId = rowId.match(table.tableDnDConfig.serializeRegexp)[0]; |
  | 337 |  | } |
  | 338 |  |  |
  | 339 |  | result += tableId + '[]=' + rowId; |
  | 340 |  | } |
  | 341 |  | return result; |
  | 342 |  | }, |
  | 343 |  |  |
  | 344 |  | serializeTables: function() { |
  | 345 |  | var result = ""; |
  | 346 |  | this.each(function() { |
  | 347 |  | // this is now bound to each matching table |
  | 348 |  | result += jQuery.tableDnD.serializeTable(this); |
  | 349 |  | }); |
  | 350 |  | return result; |
  | 351 |  | } |
  | 352 |  |  |
  | 353 |  | } |
  | 354 |  |  |
  | 355 |  | jQuery.fn.extend( |
  | 356 |  | { |
  | 357 |  | tableDnD : jQuery.tableDnD.build, |
  | 358 |  | tableDnDUpdate : jQuery.tableDnD.updateTables, |
  | 359 |  | tableDnDSerialize: jQuery.tableDnD.serializeTables |
  | 360 |  | } |
  | 361 |  | ); |
  | 362 |  |  |
  | 363 |  | /\*\* END TableDnD plugin \*/ |
  |  | 38 | }); |
  |  | 39 | }); |
  | 364 | 40 |  |
  | 365 | 41 |  |
  | 366 | 42 | /\*\* |
  | 367 | 43 | \* JS for displaying custom url for: |
  | 368 |  | \* ~~\*~~ Profile page |
  | 369 |  | \* ~~\*~~ Register page |
  | 370 |  | \* ~~\*~~ Custom stylesheet |
  |  | 44 | \* - Profile page |
  |  | 45 | \* - Register page |
  |  | 46 | \* - Custom stylesheet |
  | 371 | 47 | \* |
  | 372 | 48 | \* @since 2.9.6 |
  | […](/browser/wp-members/trunk/admin/js/admin.js?rev=1531322#L425) | […](/browser/wp-members/trunk/admin/js/admin.js?rev=1667369#L101) |  |
  | 425 | 101 | (function($) { |
  | 426 | 102 | $(document).ready(function() { |
  |  | 103 | $("#wpmem\_allowhtml").hide(); |
  |  | 104 | $("#wpmem\_min\_max").hide(); |
  | 427 | 105 | $("#wpmem\_checkbox\_info").hide(); |
  | 428 | 106 | $("#wpmem\_dropdown\_info").hide(); |
  | […](/browser/wp-members/trunk/admin/js/admin.js?rev=1531322#L433) | […](/browser/wp-members/trunk/admin/js/admin.js?rev=1667369#L111) |  |
  | 433 | 111 | $(document).ready(function() { |
  | 434 | 112 | $("#wpmem\_field\_type\_select").change(function() { |
  |  | 113 | if ($("#wpmem\_field\_type\_select").val() == 'text' |
  |  | 114 | || $("#wpmem\_field\_type\_select").val() == 'password' |
  |  | 115 | || $("#wpmem\_field\_type\_select").val() == 'email' |
  |  | 116 | || $("#wpmem\_field\_type\_select").val() == 'url' |
  |  | 117 | || $("#wpmem\_field\_type\_select").val() == 'number' |
  |  | 118 | || $("#wpmem\_field\_type\_select").val() == 'date' |
  |  | 119 | || $("#wpmem\_field\_type\_select").val() == 'textarea' ) |
  |  | 120 | $("#wpmem\_placeholder").show(); |
  |  | 121 | else |
  |  | 122 | $("#wpmem\_placeholder").hide(); |
  |  | 123 | if ($("#wpmem\_field\_type\_select").val() == 'text' |
  |  | 124 | || $("#wpmem\_field\_type\_select").val() == 'password' |
  |  | 125 | || $("#wpmem\_field\_type\_select").val() == 'email' |
  |  | 126 | || $("#wpmem\_field\_type\_select").val() == 'url' |
  |  | 127 | || $("#wpmem\_field\_type\_select").val() == 'number' |
  |  | 128 | || $("#wpmem\_field\_type\_select").val() == 'date' ) { |
  |  | 129 | $("#wpmem\_pattern").show(); |
  |  | 130 | $("#wpmem\_title").show(); |
  |  | 131 | } else { |
  |  | 132 | $("#wpmem\_pattern").hide(); |
  |  | 133 | $("#wpmem\_title").hide(); |
  |  | 134 | } |
  |  | 135 | if ($("#wpmem\_field\_type\_select").val() == 'textarea' ) |
  |  | 136 | $("#wpmem\_allowhtml").show(); |
  |  | 137 | else |
  |  | 138 | $("#wpmem\_allowhtml").hide(); |
  |  | 139 | if ($("#wpmem\_field\_type\_select").val() == 'number' || $("#wpmem\_field\_type\_select").val() == 'date' ) |
  |  | 140 | $("#wpmem\_min\_max").show(); |
  |  | 141 | else |
  |  | 142 | $("#wpmem\_min\_max").hide(); |
  | 435 | 143 | if ($("#wpmem\_field\_type\_select").val() == 'checkbox') |
  | 436 | 144 | $("#wpmem\_checkbox\_info").show(); |
* ## [wp-members/trunk/admin/js/shortcodes\_tinymce\_4.js](/changeset/1667369/wp-members/trunk/admin/js/shortcodes_tinymce_4.js "Show the changeset 1667369 restricted to wp-members/trunk/admin/js/shortcodes_tinymce_4.js")

  | [r1498490](/browser/wp-members/trunk/admin/js/shortcodes_tinymce_4.js?rev=1498490#L55 "Show revision 1498490 of this file in browser") | [r1667369](/browser/wp-members/trunk/admin/js/shortcodes_tinymce_4.js?rev=1667369#L55 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 55 | 55 | } |
  | 56 | 56 | }, |
  | 57 |  | ~~/\*~~{ |
  |  | 57 | { |
  | 58 | 58 | text: "registration + redirect", |
  | 59 | 59 | onclick: function(){ |
  | 60 | 60 | editor.insertContent('[wpmem\_form register redirect\_to="http://mysite.com/my-page/"]'); |
  | 61 | 61 | } |
  | 62 |  | },~~\*/~~ |
  |  | 62 | }, |
  | 63 | 63 | { |
  | 64 | 64 | text: "registration + logged in content", |
  | […](/browser/wp-members/trunk/admin/js/shortcodes_tinymce_4.js?rev=1498490#L67) | […](/browser/wp-members/trunk/admin/js/shortcodes_tinymce_4.js?rev=1667369#L67) |  |
  | 67 | 67 | } |
  | 68 | 68 | }, |
  | 69 |  | ~~/\*~~{ |
  |  | 69 | { |
  | 70 | 70 | text: "registration + redirect + content", |
  | 71 | 71 | onclick: function(){ |
  | 72 | 72 | editor.insertContent('[wpmem\_form register redirect\_to="http://mysite.com/my-page/"]<br />This displays when logged in<br />[/wpmem\_form]'); |
  | 73 | 73 | } |
  | 74 |  | },~~\*/~~ |
  | 75 |  | ] |
  | 76 |  | }, |
  | 77 |  | { |
  | 78 |  | text: '~~Other Forms~~', |
  |  | 74 | }, |
  |  | 75 | ] |
  |  | 76 | }, |
  |  | 77 | { |
  |  | 78 | text: 'User Profile', |
  | 79 | 79 | menu: [ |
  | 80 | 80 | { |
  | […](/browser/wp-members/trunk/admin/js/shortcodes_tinymce_4.js?rev=1498490#L134) | […](/browser/wp-members/trunk/admin/js/shortcodes_tinymce_4.js?rev=1667369#L134) |  |
  | 134 | 134 | }, |
  | 135 | 135 | { |
  | 136 |  | text: 'L~~ogin / Logout L~~inks', |
  |  | 136 | text: 'Links', |
  | 137 | 137 | menu: [ |
  | 138 | 138 | { |
  | […](/browser/wp-members/trunk/admin/js/shortcodes_tinymce_4.js?rev=1498490#L154) | […](/browser/wp-members/trunk/admin/js/shortcodes_tinymce_4.js?rev=1667369#L154) |  |
  | 154 | 154 | } |
  | 155 | 155 | }, |
  |  | 156 | { |
  |  | 157 | text: "log in link", |
  |  | 158 | onclick: function(){ |
  |  | 159 | editor.insertContent('[wpmem\_login\_link]'); |
  |  | 160 | } |
  |  | 161 | }, |
  |  | 162 | { |
  |  | 163 | text: "log in link + custom link text", |
  |  | 164 | onclick: function(){ |
  |  | 165 | editor.insertContent('[wpmem\_login\_link]Link Text[/wpmem\_login\_link]'); |
  |  | 166 | } |
  |  | 167 | }, |
  |  | 168 | { |
  |  | 169 | text: "register link", |
  |  | 170 | onclick: function(){ |
  |  | 171 | editor.insertContent('[wpmem\_reg\_link]'); |
  |  | 172 | } |
  |  | 173 | }, |
  |  | 174 | { |
  |  | 175 | text: "register link + custom link text", |
  |  | 176 | onclick: function(){ |
  |  | 177 | editor.insertContent('[wpmem\_reg\_link]Link Text[/wpmem\_reg\_link]'); |
  |  | 178 | } |
  |  | 179 | } |
  | 156 | 180 | ] |
  | 157 | 181 | }, |
  | […](/browser/wp-members/trunk/admin/js/shortcodes_tinymce_4.js?rev=1498490#L166) | […](/browser/wp-members/trunk/admin/js/shortcodes_tinymce_4.js?rev=1667369#L190) |  |
  | 166 | 190 | onclick: function(){ |
  | 167 | 191 | editor.insertContent('[wpmem\_show\_count label="Active Users: " key=active value=1]'); |
  |  | 192 | } |
  |  | 193 | }, |
  |  | 194 | { |
  |  | 195 | text: 'User Avatar', |
  |  | 196 | onclick: function(){ |
  |  | 197 | editor.insertContent('[wpmem\_avatar]'); |
  | 168 | 198 | } |
  | 169 | 199 | }, |
* ## [wp-members/trunk/admin/tab-captcha.php](/changeset/1667369/wp-members/trunk/admin/tab-captcha.php "Show the changeset 1667369 restricted to wp-members/trunk/admin/tab-captcha.php")

  | [r1628757](/browser/wp-members/trunk/admin/tab-captcha.php?rev=1628757#L53 "Show revision 1628757 of this file in browser") | [r1667369](/browser/wp-members/trunk/admin/tab-captcha.php?rev=1667369#L53 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 53 | 53 | <h3><?php \_e( 'Manage reCAPTCHA Options', 'wp-members' ); ?></h3> |
  | 54 | 54 | <div class="inside"> |
  | 55 |  | <form name="updatecaptchaform" id="updatecaptchaform" method="post" action="<?php echo ~~$\_SERVER['REQUEST\_URI']~~?>"> |
  |  | 55 | <form name="updatecaptchaform" id="updatecaptchaform" method="post" action="<?php echo wpmem\_admin\_form\_post\_url(); ?>"> |
  | 56 | 56 | <?php wp\_nonce\_field( 'wpmem-update-captcha' ); ?> |
  | 57 | 57 | <table class="form-table"> |
* ## [wp-members/trunk/admin/tab-dialogs.php](/changeset/1667369/wp-members/trunk/admin/tab-dialogs.php "Show the changeset 1667369 restricted to wp-members/trunk/admin/tab-dialogs.php")

  | [r1628757](/browser/wp-members/trunk/admin/tab-dialogs.php?rev=1628757#L47 "Show revision 1628757 of this file in browser") | [r1667369](/browser/wp-members/trunk/admin/tab-dialogs.php?rev=1667369#L47 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 47 | 47 | <div class="inside"> |
  | 48 | 48 | <p><?php printf( \_\_( 'You can customize the text for dialogs and error messages. Simple HTML is allowed %s etc.', 'wp-members' ), '- &lt;p&gt;, &lt;b&gt;, &lt;i&gt;,' ); ?></p> |
  | 49 |  | <form name="updatedialogform" id="updatedialogform" method="post" action="<?php echo ~~$\_SERVER['REQUEST\_URI']~~?>"> |
  |  | 49 | <form name="updatedialogform" id="updatedialogform" method="post" action="<?php echo wpmem\_admin\_form\_post\_url(); ?>"> |
  | 50 | 50 | <?php wp\_nonce\_field( 'wpmem-update-dialogs' ); ?> |
  | 51 | 51 | <table class="form-table"> |
* ## [wp-members/trunk/admin/tab-emails.php](/changeset/1667369/wp-members/trunk/admin/tab-emails.php "Show the changeset 1667369 restricted to wp-members/trunk/admin/tab-emails.php")

  | [r1628757](/browser/wp-members/trunk/admin/tab-emails.php?rev=1628757#L43 "Show revision 1628757 of this file in browser") | [r1667369](/browser/wp-members/trunk/admin/tab-emails.php?rev=1667369#L43 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 43 | 43 | </p> |
  | 44 | 44 | <hr /> |
  | 45 |  | <form name="updateemailform" id="updateemailform" method="post" action="<?php echo ~~$\_SERVER['REQUEST\_URI']~~; ?>"> |
  |  | 45 | <form name="updateemailform" id="updateemailform" method="post" action="<?php echo wpmem\_admin\_form\_post\_url(); ?>"> |
  | 46 | 46 | <?php wp\_nonce\_field( 'wpmem-update-emails' ); ?> |
  | 47 | 47 | <table class="form-table"> |
* ## [wp-members/trunk/admin/tab-fields.php](/changeset/1667369/wp-members/trunk/admin/tab-fields.php "Show the changeset 1667369 restricted to wp-members/trunk/admin/tab-fields.php")

  | [r1628757](/browser/wp-members/trunk/admin/tab-fields.php?rev=1628757#L15 "Show revision 1628757 of this file in browser") | [r1667369](/browser/wp-members/trunk/admin/tab-fields.php?rev=1667369#L15 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 15 | 15 | \*/ |
  | 16 | 16 |  |
  | 17 |  |  |
  | 18 |  | /\*\* |
  | 19 |  | \* Builds the fields panel. |
  | 20 |  | \* |
  | 21 |  | \* @since 2.2.2 |
  | 22 |  | \* |
  | 23 |  | \* @param  string $wpmem\_fields deprecated in 2.8.0 |
  | 24 |  | \* @global string $add\_field\_err\_msg The fields error message |
  | 25 |  | \*/ |
  | 26 |  | function wpmem\_a\_build\_fields() { |
  | 27 |  |  |
  | 28 |  | global $wpmem, $add\_field\_err\_msg; |
  | 29 |  | $add\_toggle = ( isset( $\_GET['edit'] ) ) ? $\_GET['edit'] : false; |
  | 30 |  | $wpmem\_fields = wpmem\_fields(); |
  | 31 |  | ?> |
  | 32 |  | <div class="metabox-holder"> |
  | 33 |  |  |
  | 34 |  | <div id="post-body"> |
  | 35 |  | <div id="post-body-content"> |
  | 36 |  | <?php if ( $add\_toggle && ( isset( $\_POST['wpmem\_admin\_a'] ) != 'edit\_field' ) ) { |
  | 37 |  | wpmem\_a\_field\_edit( 'edit', $wpmem\_fields, $add\_toggle ); |
  | 38 |  | } else { |
  | 39 |  | if ( ! $add\_field\_err\_msg ) { |
  | 40 |  | wpmem\_a\_field\_table( $wpmem\_fields ); |
  |  | 17 | /\*\* |
  |  | 18 | \* Load WP\_Members\_Fields\_Table object |
  |  | 19 | \*/ |
  |  | 20 | if( ! class\_exists( 'WP\_List\_Table' ) ) { |
  |  | 21 | require\_once( ABSPATH . 'wp-admin/includes/class-wp-list-table.php' ); |
  |  | 22 | } |
  |  | 23 |  |
  |  | 24 | /\*\* |
  |  | 25 | \* Filters and Actions. |
  |  | 26 | \*/ |
  |  | 27 | add\_action( 'wpmem\_admin\_do\_tab',            'wpmem\_a\_fields\_tab', 99, 1  ); |
  |  | 28 | add\_action( 'wpmem\_after\_admin\_init',        'wpmem\_admin\_fields\_update'  ); |
  |  | 29 | add\_action( 'admin\_print\_styles',            'wpmem\_a\_fields\_tab\_scripts' ); |
  |  | 30 | add\_action( 'wp\_ajax\_wpmem\_a\_field\_reorder', 'wpmem\_a\_do\_field\_reorder'  ); |
  |  | 31 |  |
  |  | 32 | /\*\* |
  |  | 33 | \* Calls the function to reorder fields. |
  |  | 34 | \* |
  |  | 35 | \* @since 2.8.0 |
  |  | 36 | \*/ |
  |  | 37 | function wpmem\_a\_do\_field\_reorder() { |
  |  | 38 | // Reorder registration fields. |
  |  | 39 | wpmem\_a\_field\_reorder(); |
  |  | 40 | } |
  |  | 41 |  |
  |  | 42 | /\*\* |
  |  | 43 | \* Creates the fields tab. |
  |  | 44 | \* |
  |  | 45 | \* @since 3.0.1 |
  |  | 46 | \* |
  |  | 47 | \* @param  string      $tab The admin tab being displayed. |
  |  | 48 | \* @return string|bool      The fields tab, otherwise false. |
  |  | 49 | \*/ |
  |  | 50 | function wpmem\_a\_fields\_tab( $tab ) { |
  |  | 51 | if ( $tab == 'fields' ) { |
  |  | 52 | // Render the fields tab. |
  |  | 53 | wpmem\_a\_render\_fields\_tab(); |
  |  | 54 | return; |
  |  | 55 | } |
  |  | 56 | } |
  |  | 57 |  |
  |  | 58 | /\*\* |
  |  | 59 | \* Scripts needed for the fields tab. |
  |  | 60 | \* |
  |  | 61 | \* @since 3.1.8 |
  |  | 62 | \*/ |
  |  | 63 | function wpmem\_a\_fields\_tab\_scripts() { |
  |  | 64 | wp\_enqueue\_script( 'jquery-ui-sortable' ); |
  |  | 65 | } |
  |  | 66 |  |
  |  | 67 | /\*\* |
  |  | 68 | \* Function to write the field edit link. |
  |  | 69 | \* |
  |  | 70 | \* @since 2.8 |
  |  | 71 | \* |
  |  | 72 | \* @param string $field\_id The option name of the field to be edited |
  |  | 73 | \*/ |
  |  | 74 | function wpmem\_fields\_edit\_link( $field\_id ) { |
  |  | 75 | $link\_args = array( |
  |  | 76 | 'page'  => 'wpmem-settings', |
  |  | 77 | 'tab'   => 'fields', |
  |  | 78 | 'mode'  => 'edit', |
  |  | 79 | 'edit'  => 'field', |
  |  | 80 | 'field' => $field\_id, |
  |  | 81 | ); |
  |  | 82 | $link = add\_query\_arg( $link\_args, admin\_url( 'options-general.php' ) ); |
  |  | 83 | return '<a href="' . $link . '">' . \_\_( 'Edit' ) . '</a>'; |
  |  | 84 | } |
  |  | 85 |  |
  |  | 86 | /\*\* |
  |  | 87 | \* Renders the content of the fields tab. |
  |  | 88 | \* |
  |  | 89 | \* @since 3.1.8 |
  |  | 90 | \* |
  |  | 91 | \* @global object $wpmem         The WP\_Members Object. |
  |  | 92 | \* @global string $did\_update |
  |  | 93 | \* @global string $delete\_action |
  |  | 94 | \*/ |
  |  | 95 | function wpmem\_a\_render\_fields\_tab() { |
  |  | 96 |  |
  |  | 97 | global $wpmem, $did\_update, $delete\_action; |
  |  | 98 | $wpmem\_fields  = wpmem\_fields(); |
  |  | 99 | $edit\_meta     = wpmem\_get( 'field', false, 'get' ); |
  |  | 100 | $add\_meta      = wpmem\_get( 'add\_field', false ); |
  |  | 101 |  |
  |  | 102 | if ( 'delete' == $delete\_action ) { |
  |  | 103 | $delete\_fields = wpmem\_get( 'delete' ); ?> |
  |  | 104 |  |
  |  | 105 | <p><?php \_e( 'Are you sure you want to delete the following fields?', 'wp-members' ); ?></p> |
  |  | 106 |  |
  |  | 107 | <?php foreach ( $delete\_fields as $meta ) { |
  |  | 108 | echo $wpmem->fields[ $meta ]['label'] . ' (meta key: ' . $meta . ')<br />'; |
  |  | 109 | } ?> |
  |  | 110 | <form name="<?php echo $delete\_action; ?>" id="<?php echo $delete\_action; ?>" method="post" action="<?php echo wpmem\_admin\_form\_post\_url(); ?>"> |
  |  | 111 | <?php // wp\_nonce\_field( 'wpmem-delete-fields' ); ?> |
  |  | 112 | <input type="hidden" name="delete\_fields" value="<?php echo implode( ",", $delete\_fields ); ?>" /> |
  |  | 113 | <input type="hidden" name="dodelete" value="delete\_confirmed" /> |
  |  | 114 | <?php submit\_button( 'Delete Fields' ); ?> |
  |  | 115 | </form><?php |
  |  | 116 |  |
  |  | 117 | } else { |
  |  | 118 |  |
  |  | 119 | if ( 'delete\_confirmed' == wpmem\_get( 'dodelete' ) ) { |
  |  | 120 | // validate wpmem-delete-fields nonce |
  |  | 121 |  |
  |  | 122 | $delete\_fields = explode( ",", wpmem\_get( 'delete\_fields', array() ) ); |
  |  | 123 | $wpmem\_new\_fields = array(); |
  |  | 124 | foreach ( $wpmem\_fields as $field ) { |
  |  | 125 | if ( ! in\_array( $field[2], $delete\_fields ) ) { |
  |  | 126 | $wpmem\_new\_fields[] = $field; |
  | 41 | 127 | } |
  | 42 |  | wpmem\_a\_field\_edit( 'add' ); |
  |  | 128 | } |
  |  | 129 | update\_option( 'wpmembers\_fields', $wpmem\_new\_fields ); |
  |  | 130 | $did\_update = \_\_( 'Fields deleted', 'wp-members' ); |
  |  | 131 | } |
  |  | 132 |  |
  |  | 133 | if ( $did\_update ) { ?> |
  |  | 134 | <div id="message" class="updated fade"><p><strong><?php echo $did\_update; ?></strong></p></div> |
  |  | 135 | <?php } |
  |  | 136 | if ( $edit\_meta || $add\_meta ) { |
  |  | 137 | $mode = ( $edit\_meta ) ? wpmem\_get( 'mode', false, 'get' ) : 'add'; |
  |  | 138 | wpmem\_a\_render\_fields\_tab\_field\_edit( $mode, $wpmem\_fields, $edit\_meta ); |
  |  | 139 | } else { |
  |  | 140 | wpmem\_a\_render\_fields\_tab\_field\_table(); |
  |  | 141 | } ?> |
  |  | 142 | <h3><span><?php \_e( 'Need help?', 'wp-members' ); ?></span></h3> |
  |  | 143 | <div class="inside"> |
  |  | 144 | <strong><i><a href="http://rocketgeek.com/plugins/wp-members/docs/plugin-settings/fields/" target="\_blank"><?php \_e( 'Field Manager Documentation', 'wp-members' ); ?></a></i></strong> |
  |  | 145 | </div> |
  |  | 146 | <?php |
  |  | 147 | } |
  |  | 148 | } |
  |  | 149 |  |
  |  | 150 | /\*\* |
  |  | 151 | \* Function to dispay the add/edit field form. |
  |  | 152 | \* |
  |  | 153 | \* @since 2.8 |
  |  | 154 | \* @since 3.1.8 Changed name from wpmem\_a\_field\_edit(). |
  |  | 155 | \* |
  |  | 156 | \* @global object      $wpmem        The WP\_Members Object. |
  |  | 157 | \* @param  string      $mode         The mode for the function (edit|add) |
  |  | 158 | \* @param  array|null  $wpmem\_fields The array of fields |
  |  | 159 | \* @param  string|null $field        The field being edited |
  |  | 160 | \*/ |
  |  | 161 | function wpmem\_a\_render\_fields\_tab\_field\_edit( $mode, $wpmem\_fields, $meta\_key ) { |
  |  | 162 | global $wpmem; |
  |  | 163 | $fields = wpmem\_fields(); |
  |  | 164 | if ( $mode == 'edit' ) { |
  |  | 165 | $field = $fields[ $meta\_key ]; |
  |  | 166 | } |
  |  | 167 | $form\_action = ( $mode == 'edit' ) ? 'editfieldform' : 'addfieldform'; |
  |  | 168 | $span\_optional = '<span class="description">' . \_\_( '(optional)', 'wp-members' ) . '</span>'; |
  |  | 169 | $span\_required = '<span class="req">' . \_\_( '(required)', 'wp-members' ) . '</span>'; |
  |  | 170 | $form\_submit = array( 'mode' => $mode ); |
  |  | 171 | if ( isset( $\_GET['field'] ) ) { |
  |  | 172 | $form\_submit['field'] = $meta\_key; |
  |  | 173 | } ?> |
  |  | 174 | <h3 class="title"><?php ( $mode == 'edit' ) ? \_e( 'Edit Field', 'wp-members' ) : \_e( 'Add a Field', 'wp-members' ); ?></h3> |
  |  | 175 | <form name="<?php echo $form\_action; ?>" id="<?php echo $form\_action; ?>" method="post" action="<?php echo wpmem\_admin\_form\_post\_url( $form\_submit ); ?>"> |
  |  | 176 | <?php wp\_nonce\_field( 'wpmem-add-fields' ); ?> |
  |  | 177 | <ul> |
  |  | 178 | <li> |
  |  | 179 | <label><?php \_e( 'Field Label', 'wp-members' ); ?> <?php echo $span\_required; ?></label> |
  |  | 180 | <input type="text" name="add\_name" value="<?php echo ( $mode == 'edit' ) ? $field['label'] : false; ?>" /> |
  |  | 181 | <?php \_e( 'The name of the field as it will be displayed to the user.', 'wp-members' ); ?> |
  |  | 182 | </li> |
  |  | 183 | <li> |
  |  | 184 | <label><?php \_e( 'Meta Key', 'wp-members' ); ?> <?php echo $span\_required; ?></label> |
  |  | 185 | <?php if ( $mode == 'edit' ) { |
  |  | 186 | echo "<span>$meta\_key</span>"; ?> |
  |  | 187 | <input type="hidden" name="add\_option" value="<?php echo $meta\_key; ?>" /> |
  |  | 188 | <?php } else { ?> |
  |  | 189 | <input type="text" name="add\_option" value="" /> |
  |  | 190 | <?php \_e( 'The database meta value for the field. It must be unique and contain no spaces (underscores are ok).', 'wp-members' ); ?> |
  |  | 191 | <?php } ?> |
  |  | 192 | </li> |
  |  | 193 | <li> |
  |  | 194 | <label><?php \_e( 'Field Type', 'wp-members' ); ?></label> |
  |  | 195 | <?php if ( $mode == 'edit' ) { |
  |  | 196 | echo '<span>' . $field['type'] . '</span>'; ?> |
  |  | 197 | <input type="hidden" name="add\_type" value="<?php echo $field['type']; ?>" /> |
  |  | 198 | <?php } else { ?> |
  |  | 199 | <select name="add\_type" id="wpmem\_field\_type\_select"> |
  |  | 200 | <option value="text"><?php          \_e( 'text',              'wp-members' ); ?></option> |
  |  | 201 | <option value="email"><?php         \_e( 'email',             'wp-members' ); ?></option> |
  |  | 202 | <option value="textarea"><?php      \_e( 'textarea',          'wp-members' ); ?></option> |
  |  | 203 | <option value="checkbox"><?php      \_e( 'checkbox',          'wp-members' ); ?></option> |
  |  | 204 | <option value="multicheckbox"><?php \_e( 'multiple checkbox', 'wp-members' ); ?></option> |
  |  | 205 | <option value="select"><?php        \_e( 'select (dropdown)', 'wp-members' ); ?></option> |
  |  | 206 | <option value="multiselect"><?php   \_e( 'multiple select',   'wp-members' ); ?></option> |
  |  | 207 | <option value="radio"><?php         \_e( 'radio group',       'wp-members' ); ?></option> |
  |  | 208 | <option value="password"><?php      \_e( 'password',          'wp-members' ); ?></option> |
  |  | 209 | <option value="image"><?php         \_e( 'image',             'wp-members' ); ?></option> |
  |  | 210 | <option value="file"><?php          \_e( 'file',              'wp-members' ); ?></option> |
  |  | 211 | <option value="url"><?php           \_e( 'url',               'wp-members' ); ?></option> |
  |  | 212 | <option value="number"><?php        \_e( 'number',            'wp-members' ); ?></option> |
  |  | 213 | <option value="date"><?php          \_e( 'date',              'wp-members' ); ?></option> |
  |  | 214 | <option value="hidden"><?php        \_e( 'hidden',            'wp-members' ); ?></option> |
  |  | 215 | </select> |
  |  | 216 | <?php } ?> |
  |  | 217 | </li> |
  |  | 218 | <li> |
  |  | 219 | <label><?php \_e( 'Display?', 'wp-members' ); ?></label> |
  |  | 220 | <input type="checkbox" name="add\_display" value="y" <?php echo ( $mode == 'edit' ) ? checked( true, $field['register'] ) : false; ?> /> |
  |  | 221 | </li> |
  |  | 222 | <li> |
  |  | 223 | <label><?php \_e( 'Required?', 'wp-members' ); ?></label> |
  |  | 224 | <input type="checkbox" name="add\_required" value="y" <?php echo ( $mode == 'edit' ) ? checked( true, $field['required'] ) : false; ?> /> |
  |  | 225 | </li> |
  |  | 226 | <!--<div id="wpmem\_allowhtml"> |
  |  | 227 | <li> |
  |  | 228 | <label><?php \_e( 'Allow HTML?', 'wp-members' ); ?></label> |
  |  | 229 | <input type="checkbox" name="add\_html" value="y" <?php echo ( $mode == 'edit' ) ? checked( true, $field['html'] ) : false; ?> /> |
  |  | 230 | </li> |
  |  | 231 | </div>--> |
  |  | 232 | <?php if ( $mode == 'add' || ( $mode == 'edit' && ( in\_array( $field['type'], array( 'text', 'password', 'email', 'url', 'number', 'date', 'textarea' ) ) ) ) ) { ?> |
  |  | 233 | <?php echo ( $mode == 'add' ) ? '<div id="wpmem\_placeholder">' : ''; ?> |
  |  | 234 | <li> |
  |  | 235 | <label><?php \_e( 'Placeholder', 'wp-members' ); ?></label> |
  |  | 236 | <input type="text" name="add\_placeholder" value="<?php echo ( $mode == 'edit' ) ? ( isset( $field['placeholder'] ) ? $field['placeholder'] : false ) : false; ?>" /> <?php echo $span\_optional; ?> |
  |  | 237 | </li> |
  |  | 238 | <?php echo ( $mode == 'add' ) ? '</div>' : ''; ?> |
  |  | 239 | <?php } ?> |
  |  | 240 | <?php if ( $mode == 'add' || ( $mode == 'edit' && ( in\_array( $field['type'], array( 'text', 'password', 'email', 'url', 'number', 'date' ) ) ) ) ) { ?> |
  |  | 241 | <?php echo ( $mode == 'add' ) ? '<div id="wpmem\_pattern">' : ''; ?> |
  |  | 242 | <li> |
  |  | 243 | <label><?php \_e( 'Pattern', 'wp-members' ); ?></label> |
  |  | 244 | <input type="text" name="add\_pattern" value="<?php echo ( $mode == 'edit' ) ? ( isset( $field['pattern'] ) ? $field['pattern'] : false ) : false; ?>" /> <?php echo $span\_optional; ?> |
  |  | 245 | </li> |
  |  | 246 | <?php echo ( $mode == 'add' ) ? '</div>' : ''; ?> |
  |  | 247 | <?php echo ( $mode == 'add' ) ? '<div id="wpmem\_title">' : ''; ?> |
  |  | 248 | <li> |
  |  | 249 | <label><?php \_e( 'Title', 'wp-members' ); ?></label> |
  |  | 250 | <input type="text" name="add\_title" value="<?php echo ( $mode == 'edit' ) ? ( isset( $field['title'] ) ? $field['title'] : false ) : false; ?>" /> <?php echo $span\_optional; ?> |
  |  | 251 | </li> |
  |  | 252 | <?php echo ( $mode == 'add' ) ? '</div>' : ''; ?> |
  |  | 253 | <?php } ?> |
  |  | 254 |  |
  |  | 255 | <?php if ( $mode == 'add' || ( $mode == 'edit' && ( in\_array( $field['type'], array( 'number', 'date' ) ) ) ) ) { ?> |
  |  | 256 | <?php echo ( $mode == 'add' ) ? '<div id="wpmem\_min\_max">' : ''; ?> |
  |  | 257 | <li> |
  |  | 258 | <label><?php \_e( 'Minimum Value', 'wp-members' ); ?></label> |
  |  | 259 | <input type="text" name="add\_min" value="<?php echo ( $mode == 'edit' ) ? ( isset( $field['min'] ) ? $field['min'] : false ) : false; ?>" /> <?php echo $span\_optional; ?> |
  |  | 260 | </li> |
  |  | 261 | <li> |
  |  | 262 | <label><?php \_e( 'Maximum Value', 'wp-members' ); ?></label> |
  |  | 263 | <input type="text" name="add\_max" value="<?php echo ( $mode == 'edit' ) ? ( isset( $field['max'] ) ? $field['max'] : false ) : false; ?>" /> <?php echo $span\_optional; ?> |
  |  | 264 | </li> |
  |  | 265 | <?php echo ( $mode == 'add' ) ? '</div>' : ''; ?> |
  |  | 266 | <?php } ?> |
  |  | 267 | <?php if ( $mode == 'add' || ( $mode == 'edit' && ( $field['type'] == 'file' || $field['type'] == 'image' ) ) ) { ?> |
  |  | 268 | <?php echo ( $mode == 'add' ) ? '<div id="wpmem\_file\_info">' : ''; ?> |
  |  | 269 | <li> |
  |  | 270 | <label><?php \_e( 'Accepted file types:', 'wp-members' ); ?></label> |
  |  | 271 | <input type="text" name="add\_file\_value" value="<?php echo ( $mode == 'edit' && ( $field['type'] == 'file' || $field['type'] == 'image' ) ) ? $field['file\_types'] : false; ?>" /> |
  |  | 272 | </li> |
  |  | 273 | <li> |
  |  | 274 | <label>&nbsp;</label> |
  |  | 275 | <span class="description"><?php \_e( 'Accepted file types should be set like this: jpg|jpeg|png|gif', 'wp-members' ); ?></span> |
  |  | 276 | </li> |
  |  | 277 | <?php echo ( $mode == 'add' ) ? '</div>' : ''; ?> |
  |  | 278 | <?php } ?> |
  |  | 279 | <?php if ( $mode == 'add' || ( $mode == 'edit' && $field['type'] == 'checkbox' ) ) { ?> |
  |  | 280 | <?php echo ( $mode == 'add' ) ? '<div id="wpmem\_checkbox\_info">' : ''; ?> |
  |  | 281 | <li> |
  |  | 282 | <label><?php \_e( 'Checked by default?', 'wp-members' ); ?></label> |
  |  | 283 | <input type="checkbox" name="add\_checked\_default" value="y" <?php echo ( $mode == 'edit' && $field['type'] == 'checkbox' ) ? checked( true, $field['checked\_default'] ) : false; ?> /> |
  |  | 284 | </li> |
  |  | 285 | <li> |
  |  | 286 | <label><?php \_e( 'Stored value if checked:', 'wp-members' ); ?> <span class="req"><?php \_e( '(required)', 'wp-members' ); ?></span></label> |
  |  | 287 | <input type="text" name="add\_checked\_value" value="<?php echo ( $mode == 'edit' && $field['type'] == 'checkbox' ) ? $field['checked\_value'] : false; ?>" class="small-text" /> |
  |  | 288 | </li> |
  |  | 289 | <?php echo ( $mode == 'add' ) ? '</div>' : ''; ?> |
  |  | 290 | <?php } |
  |  | 291 |  |
  |  | 292 | if ( isset( $field['type'] ) ) { |
  |  | 293 | $additional\_settings = ( $field['type'] == 'select' || $field['type'] == 'multiselect' || $field['type'] == 'multicheckbox' || $field['type'] == 'radio' ) ? true : false; |
  |  | 294 | $delimiter\_settings  = ( $field['type'] == 'multiselect' || $field['type'] == 'multicheckbox' ) ? true : false; |
  |  | 295 | } |
  |  | 296 | if ( $mode == 'add' || ( $mode == 'edit' && $additional\_settings ) ) { ?> |
  |  | 297 | <?php echo ( $mode == 'add' ) ? '<div id="wpmem\_dropdown\_info">' : ''; ?> |
  |  | 298 | <?php if ( $mode == 'add' || ( $mode == 'edit' && $delimiter\_settings ) ) { |
  |  | 299 | echo ( $mode == 'add' ) ? '<div id="wpmem\_delimiter\_info">' : ''; |
  |  | 300 | if ( isset( $field['delimiter'] ) && ( "|" == $field['delimiter'] || "," == $field['delimiter'] ) ) { |
  |  | 301 | $delimiter = $field['delimiter']; |
  |  | 302 | } else { |
  |  | 303 | $delimiter = "|"; |
  |  | 304 | } |
  |  | 305 | ?> |
  |  | 306 | <li> |
  |  | 307 | <label><?php \_e( 'Stored values delimiter:', 'wp-members' ); ?></label> |
  |  | 308 | <select name = "add\_delimiter\_value"> |
  |  | 309 | <option value="|" <?php selected( '|', $delimiter ); ?>>pipe "|"</option> |
  |  | 310 | <option value="," <?php selected( ',', $delimiter ); ?>>comma ","</option> |
  |  | 311 | </select> |
  |  | 312 | </li> |
  |  | 313 | <?php echo ( $mode == 'add' ) ? '</div>' : ''; |
  | 43 | 314 | } ?> |
  | 44 |  |  |
  | 45 |  | <div class="postbox"> |
  | 46 |  | <h3><span><?php \_e( 'Need help?', 'wp-members' ); ?></span></h3> |
  | 47 |  | <div class="inside"> |
  | 48 |  | <strong><i>See the <a href="http://rocketgeek.com/plugins/wp-members/users-guide/plugin-settings/fields/" target="\_blank">Users Guide on the field manager</a>.</i></strong> |
  | 49 |  | </div> |
  | 50 |  | </div> |
  | 51 |  | </div><!-- #post-body-content --> |
  | 52 |  | </div><!-- #post-body --> |
  | 53 |  |  |
  | 54 |  | </div><!-- .metabox-holder --> |
  | 55 |  | <?php |
  | 56 |  | } |
  | 57 |  |  |
  | 58 |  |  |
  | 59 |  | /\*\* |
  | 60 |  | \* reorders the fields on DnD |
  | 61 |  | \* |
  | 62 |  | \* @since 2.5.1 |
  | 63 |  | \*/ |
  | 64 |  | function wpmem\_a\_field\_reorder() { |
  | 65 |  |  |
  | 66 |  | // Start fresh. |
  | 67 |  | $new\_order = $wpmem\_old\_fields = $wpmem\_new\_fields = $key = $row = ''; |
  | 68 |  |  |
  | 69 |  | $new\_order = $\_REQUEST['orderstring']; |
  | 70 |  | $new\_order = explode( "&", $new\_order ); |
  | 71 |  |  |
  | 72 |  | // Loop through $new\_order to create new field array. |
  | 73 |  | $wpmem\_old\_fields = get\_option( 'wpmembers\_fields' ); |
  | 74 |  | for ( $row = 0; $row < count( $new\_order ); $row++ )  { |
  | 75 |  | if ( $row > 0 ) { |
  | 76 |  | $key = $new\_order[ $row ]; |
  | 77 |  | $key = substr( $key, 15 ); |
  | 78 |  | if ( $key ) { |
  | 79 |  | for ( $x = 0; $x < count( $wpmem\_old\_fields ); $x++ ) { |
  | 80 |  | if ( $wpmem\_old\_fields[ $x ][2] == $key ) { |
  | 81 |  | $wpmem\_new\_fields[ $row - 1 ] = $wpmem\_old\_fields[ $x ]; |
  | 82 |  | } |
  | 83 |  | } |
  | 84 |  | } |
  | 85 |  | } |
  | 86 |  | } |
  | 87 |  |  |
  | 88 |  | update\_option( 'wpmembers\_fields', $wpmem\_new\_fields ); |
  | 89 |  |  |
  | 90 |  | die(); // This is required to return a proper result. |
  | 91 |  |  |
  | 92 |  | } |
  | 93 |  |  |
  | 94 |  |  |
  | 95 |  | /\*\* |
  | 96 |  | \* Updates fields. |
  | 97 |  | \* |
  | 98 |  | \* @since 2.8 |
  | 99 |  | \* |
  | 100 |  | \* @param  string $action The field update action (update\_fields|add|edit) |
  | 101 |  | \* @global string $add\_field\_err\_msg The add field error message |
  | 102 |  | \* @return string $did\_update The fields update message |
  | 103 |  | \* |
  | 104 |  | \* @todo   apply some additional form validation to the add/update process |
  | 105 |  | \*/ |
  | 106 |  | function wpmem\_update\_fields( $action ) { |
  | 107 |  |  |
  | 108 |  | // Get the current fields. |
  | 109 |  | $wpmem\_fields    = get\_option( 'wpmembers\_fields' ); |
  | 110 |  | $wpmem\_ut\_fields = get\_option( 'wpmembers\_utfields' ); |
  | 111 |  |  |
  | 112 |  | if ( $action == 'update\_fields' ) { |
  | 113 |  |  |
  | 114 |  | // Check nonce. |
  | 115 |  | check\_admin\_referer( 'wpmem-update-fields' ); |
  | 116 |  |  |
  | 117 |  | // @todo - need some additional form validation here |
  | 118 |  |  |
  | 119 |  | // Update user table fields. |
  | 120 |  | $arr = ( isset( $\_POST['ut\_fields'] ) ) ? $\_POST['ut\_fields'] : ''; |
  | 121 |  | update\_option( 'wpmembers\_utfields', $arr ); |
  | 122 |  |  |
  | 123 |  | // Rebuild the array, don't touch user\_email - it's always mandatory. |
  | 124 |  | $nrow = 0; |
  | 125 |  | foreach ( $wpmem\_fields as $field ) { |
  | 126 |  |  |
  | 127 |  | $meta\_key = $field[2]; |
  | 128 |  |  |
  | 129 |  | // Check to see if the field is checked for deletion, and if not, add it to the new array. |
  | 130 |  | $delete\_field = "del\_" . $meta\_key; |
  | 131 |  | $delete\_field = ( isset( $\_POST[ $delete\_field ] ) ) ? $\_POST[ $delete\_field ] : false; |
  | 132 |  | if ( $delete\_field != "delete" ) { |
  | 133 |  |  |
  | 134 |  | for ( $i = 0; $i < 4; $i++ ) { |
  | 135 |  | $wpmem\_newfields[ $nrow ][ $i ] = $field[ $i ]; |
  | 136 |  | } |
  | 137 |  |  |
  | 138 |  | $wpmem\_newfields[ $nrow ][0] = $nrow + 1; |
  | 139 |  |  |
  | 140 |  | $display\_field = $meta\_key . "\_display"; |
  | 141 |  | $require\_field = $meta\_key . "\_required"; |
  | 142 |  | $checked\_field = $meta\_key . "\_checked"; |
  | 143 |  |  |
  | 144 |  | if ( $field[2] != 'user\_email' ){ |
  | 145 |  | $wpmem\_newfields[ $nrow ][4] = ( isset( $\_POST[ $display\_field ] ) ) ? 'y' : ''; |
  | 146 |  | $wpmem\_newfields[ $nrow ][5] = ( isset( $\_POST[ $require\_field ] ) ) ? 'y' : ''; |
  | 147 |  | } else { |
  | 148 |  | $wpmem\_newfields[ $nrow ][4] = 'y'; |
  | 149 |  | $wpmem\_newfields[ $nrow ][5] = 'y'; |
  | 150 |  | } |
  | 151 |  |  |
  | 152 |  | $wpmem\_newfields[ $nrow ][6] = $field[6]; |
  | 153 |  | $wpmem\_newfields[ $nrow ][7] = ( isset( $field[7] ) ) ? $field[7] : ''; |
  | 154 |  | if ( $field[3] == 'checkbox' ) { |
  | 155 |  | if ( isset( $\_POST[ $checked\_field ] ) && $\_POST[ $checked\_field ] == 'y' ) { |
  | 156 |  | $wpmem\_newfields[ $nrow ][8] = 'y'; |
  | 157 |  | } else { |
  | 158 |  | $wpmem\_newfields[ $nrow ][8] = 'n'; |
  | 159 |  | } |
  | 160 |  | } |
  | 161 |  |  |
  | 162 |  | $nrow = $nrow + 1; |
  | 163 |  | } |
  | 164 |  |  |
  | 165 |  | } |
  | 166 |  |  |
  | 167 |  | update\_option( 'wpmembers\_fields', $wpmem\_newfields ); |
  | 168 |  | $did\_update = \_\_( 'WP-Members fields were updated', 'wp-members' ); |
  | 169 |  |  |
  | 170 |  | } elseif ( $action == 'add\_field' || 'edit\_field' ) { |
  | 171 |  |  |
  | 172 |  | // Check nonce. |
  | 173 |  | check\_admin\_referer( 'wpmem-add-fields' ); |
  | 174 |  |  |
  | 175 |  | global $add\_field\_err\_msg; |
  | 176 |  |  |
  | 177 |  | $add\_field\_err\_msg = false; |
  | 178 |  |  |
  | 179 |  | // Error check that field label and option name are included and unique. |
  | 180 |  | $add\_field\_err\_msg = ( $\_POST['add\_name']   == '' ) ? \_\_( 'Field Label is required for adding a new field. Nothing was updated.', 'wp-members' ) : $add\_field\_err\_msg; |
  | 181 |  | $add\_field\_err\_msg = ( $\_POST['add\_option'] == '' ) ? \_\_( 'Option Name is required for adding a new field. Nothing was updated.', 'wp-members' ) : $add\_field\_err\_msg; |
  | 182 |  |  |
  | 183 |  | $add\_field\_err\_msg = ( !preg\_match("/^[A-Za-z0-9\_]\*$/", $\_POST['add\_option'] ) ) ? \_\_( 'Option Name must contain only letters, numbers, and underscores', 'wp-members' ) : $add\_field\_err\_msg; |
  | 184 |  |  |
  | 185 |  | // Check for duplicate field names. |
  | 186 |  | $chk\_fields = array(); |
  | 187 |  | foreach ( $wpmem\_fields as $field ) { |
  | 188 |  | $chk\_fields[] = $field[2]; |
  | 189 |  | } |
  | 190 |  | $add\_field\_err\_msg = ( in\_array( $\_POST['add\_option'], $chk\_fields ) ) ? \_\_( 'A field with that option name already exists', 'wp-members' ) : $add\_field\_err\_msg; |
  | 191 |  |  |
  | 192 |  | // Error check for reserved terms. |
  | 193 |  | $reserved\_terms = wpmem\_wp\_reserved\_terms(); |
  | 194 |  | $submitted\_meta = $\_POST['add\_option']; |
  | 195 |  | if ( in\_array( strtolower( $submitted\_meta ), $reserved\_terms ) ) { |
  | 196 |  | $add\_field\_err\_msg = sprintf( \_\_( 'Sorry, "%s" is a <a href="https://codex.wordpress.org/Function\_Reference/register\_taxonomy#Reserved\_Terms" target="\_blank">reserved term</a>. Field was not added.', 'wp-members' ), $submitted\_term ); |
  | 197 |  | } |
  | 198 |  |  |
  | 199 |  | // Error check option name for spaces and replace with underscores. |
  | 200 |  | $us\_option = preg\_replace( "/ /", '\_', $submitted\_meta ); |
  | 201 |  |  |
  | 202 |  | $arr = array(); |
  | 203 |  |  |
  | 204 |  | $type = $\_POST['add\_type']; |
  | 205 |  |  |
  | 206 |  | $arr[0] = ( $action == 'add\_field' ) ? ( count( $wpmem\_fields ) ) + 2 : false; |
  | 207 |  | $arr[1] = stripslashes( $\_POST['add\_name'] ); |
  | 208 |  | $arr[2] = $us\_option; |
  | 209 |  | $arr[3] = $type; |
  | 210 |  | $arr[4] = ( isset( $\_POST['add\_display'] ) )  ? $\_POST['add\_display']  : 'n'; |
  | 211 |  | $arr[5] = ( isset( $\_POST['add\_required'] ) ) ? $\_POST['add\_required'] : 'n'; |
  | 212 |  | $arr[6] = ( $us\_option == 'user\_nicename' || $us\_option == 'display\_name' || $us\_option == 'nickname' ) ? 'y' : 'n'; |
  | 213 |  |  |
  | 214 |  | if ( $type == 'checkbox' ) { |
  | 215 |  | $add\_field\_err\_msg = ( ! $\_POST['add\_checked\_value'] ) ? \_\_( 'Checked value is required for checkboxes. Nothing was updated.', 'wp-members' ) : $add\_field\_err\_msg; |
  | 216 |  | $arr[7] = ( isset( $\_POST['add\_checked\_value'] ) )   ? $\_POST['add\_checked\_value']   : false; |
  | 217 |  | $arr[8] = ( isset( $\_POST['add\_checked\_default'] ) ) ? $\_POST['add\_checked\_default'] : 'n'; |
  | 218 |  | } |
  | 219 |  |  |
  | 220 |  | if (   $type == 'select' |
  | 221 |  | || $type == 'multiselect' |
  | 222 |  | || $type == 'radio' |
  | 223 |  | || $type == 'multicheckbox' |
  | 224 |  | ) { |
  | 225 |  | // Get the values. |
  | 226 |  | $str = stripslashes( $\_POST['add\_dropdown\_value'] ); |
  | 227 |  | // Remove linebreaks. |
  | 228 |  | $str = trim( str\_replace( array("\r", "\r\n", "\n"), '', $str ) ); |
  | 229 |  | // Create array. |
  | 230 |  | if ( ! function\_exists( 'str\_getcsv' ) ) { |
  | 231 |  | $arr[7] = explode( ',', $str ); |
  | 232 |  | } else { |
  | 233 |  | $arr[7] = str\_getcsv( $str, ',', '"' ); |
  | 234 |  | } |
  | 235 |  | // If multiselect or multicheckbox, set delimiter. |
  | 236 |  | if ( 'multiselect' == $type || 'multicheckbox' == $type ) { |
  | 237 |  | $arr[8] = ( isset( $\_POST['add\_delimiter\_value'] ) ) ? $\_POST['add\_delimiter\_value'] : '|'; |
  | 238 |  | } |
  | 239 |  | } |
  | 240 |  |  |
  | 241 |  | if ( $type == 'file' || $type == 'image' ) { |
  | 242 |  | $arr[7] = stripslashes( $\_POST['add\_file\_value'] ); |
  | 243 |  | } |
  | 244 |  |  |
  | 245 |  | if ( $\_POST['add\_type'] == 'hidden' ) { |
  | 246 |  | $add\_field\_err\_msg = ( ! $\_POST['add\_hidden\_value'] ) ? \_\_( 'A value is required for hidden fields. Nothing was updated.', 'wp-members' ) : $add\_field\_err\_msg; |
  | 247 |  | $arr[7] = ( isset( $\_POST['add\_hidden\_value'] ) )   ? stripslashes( $\_POST['add\_hidden\_value'] ) : ''; |
  | 248 |  | } |
  | 249 |  |  |
  | 250 |  | if ( $action == 'add\_field' ) { |
  | 251 |  | if ( ! $add\_field\_err\_msg ) { |
  | 252 |  | array\_push( $wpmem\_fields, $arr ); |
  | 253 |  | update\_option( 'wpmembers\_fields', $wpmem\_fields ); |
  | 254 |  | $did\_update = $\_POST['add\_name'] . ' ' . \_\_( 'field was added', 'wp-members' ); |
  | 255 |  | } else { |
  | 256 |  | $did\_update = $add\_field\_err\_msg; |
  | 257 |  | } |
  | 258 |  | } else { |
  | 259 |  |  |
  | 260 |  | for ( $row = 0; $row < count( $wpmem\_fields ); $row++ ) { |
  | 261 |  | if ( $wpmem\_fields[ $row ][2] == $\_GET['edit'] ) { |
  | 262 |  | $arr[0] = $wpmem\_fields[ $row ][0]; |
  | 263 |  | //$x = ( $arr[3] == 'checkbox' ) ? 8 : ( ( $arr[3] == 'select' || $arr[3] == 'file' ) ? 7 : 6 ); |
  | 264 |  | for ( $r = 0; $r < count( $arr ); $r++ ) { |
  | 265 |  | $wpmem\_fields[ $row ][ $r ] = $arr[ $r ]; |
  | 266 |  | } |
  | 267 |  | } |
  | 268 |  | } |
  | 269 |  |  |
  | 270 |  | update\_option( 'wpmembers\_fields', $wpmem\_fields ); |
  | 271 |  |  |
  | 272 |  | $did\_update = $\_POST['add\_name'] . ' ' . \_\_( 'field was updated', 'wp-members' ); |
  | 273 |  |  |
  | 274 |  | } |
  | 275 |  | } |
  | 276 |  |  |
  | 277 |  | if ( WPMEM\_DEBUG == true && isset( $arr ) ) { echo "<pre>"; print\_r($arr); echo "</pre>"; } |
  | 278 |  |  |
  | 279 |  | global $wpmem; |
  | 280 |  | $wpmem->load\_fields(); |
  | 281 |  |  |
  | 282 |  | return $did\_update; |
  | 283 |  | } |
  | 284 |  |  |
  | 285 |  |  |
  | 286 |  | /\*\* |
  | 287 |  | \* Function to write the field edit link. |
  | 288 |  | \* |
  | 289 |  | \* @since 2.8 |
  | 290 |  | \* |
  | 291 |  | \* @param string $field\_id The option name of the field to be edited |
  | 292 |  | \*/ |
  | 293 |  | function wpmem\_fields\_edit\_link( $field\_id ) { |
  | 294 |  | return '<a href="' . add\_query\_arg( array( 'page' => 'wpmem-settings', 'tab' => 'fields', 'edit' => $field\_id ), get\_admin\_url() . 'options-general.php' ) . '">' . \_\_( 'Edit' ) . '</a>'; |
  | 295 |  | } |
  | 296 |  |  |
  | 297 |  |  |
  | 298 |  | /\*\* |
  | 299 |  | \* Function to dispay the add/edit field form. |
  | 300 |  | \* |
  | 301 |  | \* @since 2.8 |
  | 302 |  | \* |
  | 303 |  | \* @param string      $mode The mode for the function (edit|add) |
  | 304 |  | \* @param array|null  $wpmem\_fields the array of fields |
  | 305 |  | \* @param string|null $field the field being edited |
  | 306 |  | \*/ |
  | 307 |  | function wpmem\_a\_field\_edit( $mode, $wpmem\_fields = null, $meta\_key = null ) { |
  | 308 |  |  |
  | 309 |  | global $wpmem; |
  | 310 |  |  |
  | 311 |  | if ( $mode == 'edit' ) { |
  | 312 |  | $fields = wpmem\_fields(); |
  | 313 |  | $field  = $fields[ $meta\_key ]; |
  | 314 |  | } |
  | 315 |  |  |
  | 316 |  | $form\_action = ( $mode == 'edit' ) ? 'editfieldform' : 'addfieldform'; |
  | 317 |  |  |
  | 318 |  | ?> |
  | 319 |  | <div class="postbox"> |
  | 320 |  | <h3 class="title"><?php ( $mode == 'edit' ) ? \_e( 'Edit Field', 'wp-members' ) : \_e( 'Add a Field', 'wp-members' ); ?></h3> |
  | 321 |  | <div class="inside"> |
  | 322 |  | <form name="<?php echo $form\_action; ?>" id="<?php echo $form\_action; ?>" method="post" action="<?php echo $\_SERVER['REQUEST\_URI']?>"> |
  | 323 |  | <?php wp\_nonce\_field( 'wpmem-add-fields' ); ?> |
  | 324 |  | <ul> |
  | 325 |  | <li> |
  | 326 |  | <label><?php \_e( 'Field Label', 'wp-members' ); ?> <span class="req"><?php \_e( '(required)', 'wp-members' ); ?></span></label> |
  | 327 |  | <input type="text" name="add\_name" value="<?php echo ( $mode == 'edit' ) ? $field['label'] : false; ?>" /> |
  | 328 |  | <?php \_e( 'The name of the field as it will be displayed to the user.', 'wp-members' ); ?> |
  | 329 |  | </li> |
  | 330 |  | <li> |
  | 331 |  | <label><?php \_e( 'Meta Key', 'wp-members' ); ?> <span class="req"><?php \_e( '(required)', 'wp-members' ); ?></span></label> |
  | 332 |  | <?php if ( $mode == 'edit' ) { |
  | 333 |  | echo $meta\_key; ?> |
  | 334 |  | <input type="hidden" name="add\_option" value="<?php echo $meta\_key; ?>" /> |
  | 335 |  | <?php } else { ?> |
  | 336 |  | <input type="text" name="add\_option" value="" /> |
  | 337 |  | <?php \_e( 'The database meta value for the field. It must be unique and contain no spaces (underscores are ok).', 'wp-members' ); ?> |
  | 338 |  | <?php } ?> |
  | 339 |  | </li> |
  | 340 |  | <li> |
  | 341 |  | <label><?php \_e( 'Field Type', 'wp-members' ); ?></label> |
  | 342 |  | <?php if ( $mode == 'edit' ) { |
  | 343 |  | echo $field['type']; ?> |
  | 344 |  | <input type="hidden" name="add\_type" value="<?php echo $field['type']; ?>" /> |
  | 345 |  | <?php } else { ?> |
  | 346 |  | <select name="add\_type" id="wpmem\_field\_type\_select"> |
  | 347 |  | <option value="text"><?php     \_e( 'text',        'wp-members' ); ?></option> |
  | 348 |  | <option value="email"><?php    \_e( 'email',       'wp-members' ); ?></option> |
  | 349 |  | <option value="textarea"><?php \_e( 'textarea',    'wp-members' ); ?></option> |
  | 350 |  | <option value="checkbox"><?php \_e( 'checkbox',    'wp-members' ); ?></option> |
  | 351 |  | <option value="multicheckbox"><?php \_e( 'multiple checkbox', 'wp-members' ); ?></option> |
  | 352 |  | <option value="select"><?php   \_e( 'select (dropdown)',    'wp-members' ); ?></option> |
  | 353 |  | <option value="multiselect"><?php   \_e( 'multiple select', 'wp-members' ); ?></option> |
  | 354 |  | <option value="radio"><?php    \_e( 'radio group', 'wp-members' ); ?></option> |
  | 355 |  | <option value="password"><?php \_e( 'password',    'wp-members' ); ?></option> |
  | 356 |  | <option value="image"><?php    \_e( 'image',       'wp-members' ); ?></option> |
  | 357 |  | <option value="file"><?php     \_e( 'file',        'wp-members' ); ?></option> |
  | 358 |  | <option value="url"><?php      \_e( 'url',         'wp-members' ); ?></option> |
  | 359 |  | <option value="hidden"><?php   \_e( 'hidden',      'wp-members' ); ?></option> |
  | 360 |  | </select> |
  | 361 |  | <?php } ?> |
  | 362 |  | </li> |
  | 363 |  | <li> |
  | 364 |  | <label><?php \_e( 'Display?', 'wp-members' ); ?></label> |
  | 365 |  | <input type="checkbox" name="add\_display" value="y" <?php echo ( $mode == 'edit' ) ? checked( true, $field['register'] ) : false; ?> /> |
  | 366 |  | </li> |
  | 367 |  | <li> |
  | 368 |  | <label><?php \_e( 'Required?', 'wp-members' ); ?></label> |
  | 369 |  | <input type="checkbox" name="add\_required" value="y" <?php echo ( $mode == 'edit' ) ? checked( true, $field['required'] ) : false; ?> /> |
  | 370 |  | </li> |
  | 371 |  | <?php if ( $mode == 'add' || ( $mode == 'edit' && ( $field['type'] == 'file' || $field['type'] == 'image' ) ) ) { ?> |
  | 372 |  | <?php echo ( $mode == 'add' ) ? '<div id="wpmem\_file\_info">' : ''; ?> |
  | 373 |  | <li> |
  | 374 |  | <strong><?php \_e( 'Additional information for field upload fields', 'wp-members' ); ?></strong> |
  | 375 |  | </li> |
  | 376 |  | <li> |
  | 377 |  | <label><?php \_e( 'Accepted file types:', 'wp-members' ); ?></label> |
  | 378 |  | <input type="text" name="add\_file\_value" value="<?php echo ( $mode == 'edit' && ( $field['type'] == 'file' || $field['type'] == 'image' ) ) ? $field['file\_types'] : false; ?>" /> |
  | 379 |  | </li> |
  | 380 |  | <li> |
  | 381 |  | <label>&nbsp;</label> |
  | 382 |  | <span class="description"><?php \_e( 'Accepted file types should be set like this: jpg|jpeg|png|gif', 'wp-members' ); ?></span> |
  | 383 |  | </li> |
  | 384 |  | <?php echo ( $mode == 'add' ) ? '</div>' : ''; ?> |
  | 385 |  | <?php } ?> |
  | 386 |  | <?php if ( $mode == 'add' || ( $mode == 'edit' && $field['type'] == 'checkbox' ) ) { ?> |
  | 387 |  | <?php echo ( $mode == 'add' ) ? '<div id="wpmem\_checkbox\_info">' : ''; ?> |
  | 388 |  | <li> |
  | 389 |  | <label><?php \_e( 'Checked by default?', 'wp-members' ); ?></label> |
  | 390 |  | <input type="checkbox" name="add\_checked\_default" value="y" <?php echo ( $mode == 'edit' && $field['type'] == 'checkbox' ) ? checked( true, $field['checked\_default'] ) : false; ?> /> |
  | 391 |  | </li> |
  | 392 |  | <li> |
  | 393 |  | <label><?php \_e( 'Stored value if checked:', 'wp-members' ); ?> <span class="req"><?php \_e( '(required)', 'wp-members' ); ?></span></label> |
  | 394 |  | <input type="text" name="add\_checked\_value" value="<?php echo ( $mode == 'edit' && $field['type'] == 'checkbox' ) ? $field['checked\_value'] : false; ?>" class="small-text" /> |
  | 395 |  | </li> |
  | 396 |  | <?php echo ( $mode == 'add' ) ? '</div>' : ''; ?> |
  | 397 |  | <?php } |
  | 398 |  |  |
  | 399 |  | if ( isset( $field['type'] ) ) { |
  | 400 |  | $additional\_settings = ( $field['type'] == 'select' || $field['type'] == 'multiselect' || $field['type'] == 'multicheckbox' || $field['type'] == 'radio' ) ? true : false; |
  | 401 |  | $delimiter\_settings  = ( $field['type'] == 'multiselect' || $field['type'] == 'multicheckbox' ) ? true : false; |
  | 402 |  | } |
  | 403 |  | if ( $mode == 'add' || ( $mode == 'edit' && $additional\_settings ) ) { ?> |
  | 404 |  | <?php echo ( $mode == 'add' ) ? '<div id="wpmem\_dropdown\_info">' : ''; ?> |
  | 405 |  | <?php if ( $mode == 'add' || ( $mode == 'edit' && $delimiter\_settings ) ) { |
  | 406 |  | echo ( $mode == 'add' ) ? '<div id="wpmem\_delimiter\_info">' : ''; |
  | 407 |  | if ( isset( $field['delimiter'] ) && ( "|" == $field['delimiter'] || "," == $field['delimiter'] ) ) { |
  | 408 |  | $delimiter = $field['delimiter']; |
  | 409 |  | } else { |
  | 410 |  | $delimiter = "|"; |
  | 411 |  | } |
  | 412 |  | ?> |
  | 413 |  | <li> |
  | 414 |  | <label><?php \_e( 'Stored values delimiter:', 'wp-members' ); ?></label> |
  | 415 |  | <select name = "add\_delimiter\_value"> |
  | 416 |  | <option value="|" <?php selected( '|', $delimiter ); ?>>pipe "|"</option> |
  | 417 |  | <option value="," <?php selected( ',', $delimiter ); ?>>comma ","</option> |
  | 418 |  | </select> |
  | 419 |  | </li> |
  | 420 |  | <?php echo ( $mode == 'add' ) ? '</div>' : ''; |
  | 421 |  | } ?> |
  | 422 |  | <li> |
  | 423 |  | <label style="vertical-align:top"><?php \_e( 'Values (Displayed|Stored):', 'wp-members' ); ?> <span class="req"><?php \_e( '(required)', 'wp-members' ); ?></span></label> |
  | 424 |  | <textarea name="add\_dropdown\_value" rows="5" cols="40"><?php |
  |  | 315 | <li> |
  |  | 316 | <label style="vertical-align:top"><?php \_e( 'Values (Displayed|Stored):', 'wp-members' ); ?> <?php echo $span\_required; ?></label> |
  |  | 317 | <textarea name="add\_dropdown\_value" rows="5" cols="40"><?php |
  | 425 | 318 | // Accomodate editing the current dropdown values or create dropdown value example. |
  | 426 | 319 | if ( $mode == 'edit' ) { |
  | […](/browser/wp-members/trunk/admin/tab-fields.php?rev=1628757#L432) | […](/browser/wp-members/trunk/admin/tab-fields.php?rev=1667369#L325) |  |
  | 432 | 325 | echo $field['values'][ $row ]; echo ( $row == count( $field['values'] )- 1  ) ? "" : ",\n"; |
  | 433 | 326 | } } |
  | 434 |  | } else { |
  | 435 |  | if (version\_compare(PHP\_VERSION, '5.3.0') >= 0) { ?> |
  |  | 327 | } else { |
  |  | 328 | if (version\_compare(PHP\_VERSION, '5.3.0') >= 0) { ?> |
  | 436 | 329 | <---- Select One ---->|, |
  | 437 | 330 | Choice One|choice\_one, |
  | […](/browser/wp-members/trunk/admin/tab-fields.php?rev=1628757#L443) | […](/browser/wp-members/trunk/admin/tab-fields.php?rev=1667369#L336) |  |
  | 443 | 336 | Choice 2|choice\_two, |
  | 444 | 337 | Last Row|last\_row<?php } } ?></textarea> |
  | 445 |  | </li> |
  | 446 |  | <li> |
  | 447 |  | <label>&nbsp;</label> |
  | 448 |  | <span class="description"><?php \_e( 'Options should be Option Name|option\_value,', 'wp-members' ); ?></span> |
  | 449 |  | </li> |
  | 450 |  | <li> |
  | 451 |  | <label>&nbsp;</label> |
  | 452 |  | <span class="description"><a href="http://rocketgeek.com/plugins/wp-members/users-guide/registration/choosing-fields/" target="\_blank"><?php \_e( 'Visit plugin site for more information', 'wp-members' ); ?></a></span> |
  | 453 |  | </li> |
  | 454 |  | <?php echo ( $mode == 'add' ) ? '</div>' : ''; ?> |
  | 455 |  | <?php } ?> |
  | 456 |  | <?php if ( $mode == 'add' || ( $mode == 'edit' && $field['type'] == 'hidden' ) ) { ?> |
  | 457 |  | <?php echo ( $mode == 'add' ) ? '<div id="wpmem\_hidden\_info">' : ''; ?> |
  | 458 |  | <li> |
  | 459 |  | <label><?php \_e( 'Value', 'wp-members' ); ?> <span class="req"><?php \_e( '(required)', 'wp-members' ); ?></span></label> |
  | 460 |  | <input type="text" name="add\_hidden\_value" value="<?php echo ( $mode == 'edit' && $field['type'] == 'hidden' ) ? $field['value'] : ''; ?>" /> |
  | 461 |  | </li> |
  | 462 |  | <?php echo ( $mode == 'add' ) ? '</div>' : ''; ?> |
  | 463 |  | <?php } ?> |
  | 464 |  | </ul><br /> |
  | 465 |  | <?php if ( $mode == 'edit' ) { ?><input type="hidden" name="field\_arr" value="<?php echo $meta\_key; ?>" /><?php } ?> |
  | 466 |  | <input type="hidden" name="wpmem\_admin\_a" value="<?php echo ( $mode == 'edit' ) ? 'edit\_field' : 'add\_field'; ?>" /> |
  | 467 |  | <?php $text = ( $mode == 'edit' ) ? \_\_( 'Edit Field', 'wp-members' ) : \_\_( 'Add Field', 'wp-members' ); ?> |
  | 468 |  | <?php submit\_button( $text ); ?> |
  | 469 |  | </form> |
  | 470 |  | </div> |
  | 471 |  | </div> |
  | 472 |  | <?php |
  | 473 |  | } |
  | 474 |  |  |
  | 475 |  |  |
  |  | 338 | </li> |
  |  | 339 | <li> |
  |  | 340 | <label>&nbsp;</label> |
  |  | 341 | <span class="description"><?php \_e( 'Options should be Option Name|option\_value,', 'wp-members' ); ?></span> |
  |  | 342 | </li> |
  |  | 343 | <li> |
  |  | 344 | <label>&nbsp;</label> |
  |  | 345 | <span class="description"><a href="http://rocketgeek.com/plugins/wp-members/users-guide/registration/choosing-fields/" target="\_blank"><?php \_e( 'Visit plugin site for more information', 'wp-members' ); ?></a></span> |
  |  | 346 | </li> |
  |  | 347 | <?php echo ( $mode == 'add' ) ? '</div>' : ''; ?> |
  |  | 348 | <?php } ?> |
  |  | 349 | <?php if ( $mode == 'add' || ( $mode == 'edit' && $field['type'] == 'hidden' ) ) { ?> |
  |  | 350 | <?php echo ( $mode == 'add' ) ? '<div id="wpmem\_hidden\_info">' : ''; ?> |
  |  | 351 | <li> |
  |  | 352 | <label><?php \_e( 'Value', 'wp-members' ); ?> <?php echo $span\_required; ?></label> |
  |  | 353 | <input type="text" name="add\_hidden\_value" value="<?php echo ( $mode == 'edit' && $field['type'] == 'hidden' ) ? $field['value'] : ''; ?>" /> |
  |  | 354 | </li> |
  |  | 355 | <?php echo ( $mode == 'add' ) ? '</div>' : ''; ?> |
  |  | 356 | <?php } ?> |
  |  | 357 | </ul><br /> |
  |  | 358 | <?php if ( $mode == 'edit' ) { ?><input type="hidden" name="field\_arr" value="<?php echo $meta\_key; ?>" /><?php } ?> |
  |  | 359 | <?php if ( 'add' == $mode ) { |
  |  | 360 | $ids = array(); |
  |  | 361 | foreach ( $fields as $f ) { |
  |  | 362 | $ids[] = $f[0]; |
  |  | 363 | } |
  |  | 364 | sort( $ids ); |
  |  | 365 | $field\_order\_id = end( $ids ) + 1; |
  |  | 366 | } else { |
  |  | 367 | $field\_order\_id = $field[0]; |
  |  | 368 | } ?> |
  |  | 369 | <input type="hidden" name="add\_order\_id" value="<?php echo $field\_order\_id; ?>" /> |
  |  | 370 | <input type="hidden" name="wpmem\_admin\_a" value="<?php echo ( $mode == 'edit' ) ? 'edit\_field' : 'add\_field'; ?>" /> |
  |  | 371 | <?php $text = ( $mode == 'edit' ) ? \_\_( 'Edit Field', 'wp-members' ) : \_\_( 'Add Field', 'wp-members' ); ?> |
  |  | 372 | <?php submit\_button( $text ); ?> |
  |  | 373 | <p><a href="<?php echo add\_query\_arg( array( 'page' => 'wpmem-settings', 'tab' => 'fields' ), get\_admin\_url() . 'options-general.php' ); ?>">&laquo; <?php \_e( 'Return to Fields Table', 'wp-members' ); ?></a></p> |
  |  | 374 | </form><?php |
  |  | 375 | } |
  | 476 | 376 |  |
  | 477 | 377 | /\*\* |
  | […](/browser/wp-members/trunk/admin/tab-fields.php?rev=1628757#L479) | […](/browser/wp-members/trunk/admin/tab-fields.php?rev=1667369#L379) |  |
  | 479 | 379 | \* |
  | 480 | 380 | \* @since 2.8.0 |
  |  | 381 | \* @since 3.1.8 Changed name from wpmem\_a\_field\_table(). |
  | 481 | 382 | \* |
  | 482 | 383 | \* @global object $wpmem |
  | 483 |  | \* @param  array  $wpmem\_fields The array of fields. |
  | 484 |  | \*/ |
  | 485 |  | function wpmem\_a\_field\_table( $wpmem\_fields ) { |
  | 486 |  |  |
  | 487 |  | global $wpmem; ?> |
  | 488 |  | <div class="postbox"> |
  | 489 |  | <h3 class="title"><?php \_e( 'Manage Fields', 'wp-members' ); ?></h3> |
  | 490 |  | <div class="inside"> |
  | 491 |  | <p><?php \_e( 'Determine which fields will display and which are required.  This includes all fields, both native WP fields and WP-Members custom fields.', 'wp-members' ); ?> |
  | 492 |  | <br /><strong><?php \_e( '(Note: Email is always mandatory and cannot be changed.)', 'wp-members' ); ?></strong></p> |
  | 493 |  | <form name="updatefieldform" id="updatefieldform" method="post" action="<?php echo $\_SERVER['REQUEST\_URI']?>"> |
  | 494 |  | <?php wp\_nonce\_field( 'wpmem-update-fields' ); ?> |
  | 495 |  | <table class="widefat" id="wpmem-fields"> |
  | 496 |  | <thead><tr class="head"> |
  | 497 |  | <th scope="col"><?php \_e( 'Add/Delete',   'wp-members' ); ?></th> |
  | 498 |  | <th scope="col"><?php \_e( 'Field Label',  'wp-members' ); ?></th> |
  | 499 |  | <th scope="col"><?php \_e( 'Meta Key',     'wp-members' ); ?></th> |
  | 500 |  | <th scope="col"><?php \_e( 'Field Type',   'wp-members' ); ?></th> |
  | 501 |  | <th scope="col"><?php \_e( 'Display?',     'wp-members' ); ?></th> |
  | 502 |  | <th scope="col"><?php \_e( 'Required?',    'wp-members' ); ?></th> |
  | 503 |  | <th scope="col"><?php \_e( 'Checked?',     'wp-members' ); ?></th> |
  | 504 |  | <th scope="col"><?php \_e( 'Edit'                       ); ?></th> |
  | 505 |  | <th scope="col"><?php \_e( 'Users Screen', 'wp-members' ); ?></th> |
  | 506 |  | </tr></thead> |
  | 507 |  | <?php |
  | 508 |  | // Get the user table fields array. |
  | 509 |  | $wpmem\_ut\_fields = get\_option( 'wpmembers\_utfields' ); |
  | 510 |  | // Order, label, optionname, input type, display, required, native. |
  | 511 |  | $class = ''; |
  | 512 |  | // for ( $row = 0; $row < count($wpmem\_fields); $row++ ) { |
  | 513 |  | $row = 0; |
  | 514 |  | foreach ( $wpmem\_fields as $meta\_key => $field ) { |
  | 515 |  | $class = ( $class == 'alternate' ) ? '' : 'alternate'; ?> |
  | 516 |  | <tr class="<?php echo $class; ?>" valign="top" id="<?php echo $meta\_key;?>"> |
  | 517 |  | <td width="10%"><?php |
  | 518 |  | $can\_delete = ( $meta\_key == 'user\_nicename' || $meta\_key == 'display\_name' || $meta\_key == 'nickname' ) ? true : false; |
  | 519 |  | if ( ( $can\_delete ) || ! $field['native'] ) {  ?><input type="checkbox" name="<?php echo "del\_" . $meta\_key; ?>" value="delete" /> <?php \_e( 'Delete', 'wp-members' ); } ?></td> |
  | 520 |  | <td width="15%"><?php |
  | 521 |  | \_e( $field['label'], 'wp-members' ); |
  | 522 |  | echo ( $field['required'] ) ? '<span class="req">\*</span>' : ''; ?> |
  | 523 |  | </td> |
  | 524 |  | <td width="15%"><?php echo $meta\_key; ?></td> |
  | 525 |  | <td width="10%"><?php echo $field['type']; ?></td> |
  | 526 |  | <?php if ( $meta\_key != 'user\_email' ) { ?> |
  | 527 |  | <td width="10%"><?php echo wpmem\_create\_formfield( $meta\_key . "\_display",  'checkbox', true, $field['register'] ); ?></td> |
  | 528 |  | <td width="10%"><?php echo wpmem\_create\_formfield( $meta\_key . "\_required", 'checkbox', true, $field['required'] ); ?></td> |
  | 529 |  | <?php } else { ?> |
  | 530 |  | <td colspan="2" width="20%"><small><i><?php \_e( '(Email cannot be removed)', 'wp-members' ); ?></i></small></td> |
  | 531 |  | <?php } ?> |
  | 532 |  | <td align="center" width="10%"><?php if ( $field['type'] == 'checkbox' ) { |
  | 533 |  | echo wpmem\_create\_formfield( $meta\_key . "\_checked", 'checkbox', true, $field['checked\_default'] ); } ?> |
  | 534 |  | </td> |
  | 535 |  | <td width="10%"><?php echo ( $field['native'] ) ? 'native' : wpmem\_fields\_edit\_link( $meta\_key ); ?></td> |
  | 536 |  |  |
  | 537 |  | <td align="center" width="10%"> |
  | 538 |  | <?php |
  | 539 |  | $wpmem\_ut\_fields\_skip = array( 'user\_email', 'confirm\_email', 'password', 'confirm\_password' ); |
  | 540 |  | if ( ! in\_array( $meta\_key, $wpmem\_ut\_fields\_skip ) ) { ?> |
  | 541 |  | <input type="checkbox" name="ut\_fields[<?php echo $meta\_key; ?>]" |
  | 542 |  | value="<?php echo $field['label']; ?>" |
  | 543 |  | <?php echo ( ( $wpmem\_ut\_fields ) && ( in\_array( $field['label'], $wpmem\_ut\_fields ) ) ) ? 'checked' : false; ?> /> |
  | 544 |  | <?php } ?> |
  | 545 |  | </td> |
  | 546 |  | </tr><?php |
  | 547 |  | } ?> |
  | 548 |  | <tr class="nodrag nodrop"> |
  | 549 |  | <td>&nbsp;</td> |
  | 550 |  | <td><i><?php \_e( 'Registration Date', 'wp-members' ); ?></i></td> |
  | 551 |  | <td><i>user\_registered</i></td> |
  | 552 |  | <td colspan="4">&nbsp;</td> |
  | 553 |  | <td><?php \_e( 'native', 'wp-members' ); ?></td> |
  | 554 |  | <td align="center"> |
  | 555 |  | <input type="checkbox" name="ut\_fields[user\_registered]" |
  | 556 |  | value="Registration Date" |
  | 557 |  | <?php echo ( ( $wpmem\_ut\_fields ) && ( in\_array( 'Registration Date', $wpmem\_ut\_fields ) ) ) ? 'checked' : false; ?> /> |
  | 558 |  | </td> |
  | 559 |  | </tr> |
  | 560 |  | <?php if ( $wpmem->mod\_reg == 1 ) { ?> |
  | 561 |  | <tr class="nodrag nodrop"> |
  | 562 |  | <td>&nbsp;</td> |
  | 563 |  | <td><i><?php \_e( 'Active', 'wp-members' ); ?></i></td> |
  | 564 |  | <td><i>active</i></td> |
  | 565 |  | <td colspan="5">&nbsp;</td> |
  | 566 |  | <td align="center"> |
  | 567 |  | <input type="checkbox" name="ut\_fields[active]" |
  | 568 |  | value="Active" |
  | 569 |  | <?php echo ( ( $wpmem\_ut\_fields ) && ( in\_array( 'Active', $wpmem\_ut\_fields ) ) ) ? 'checked' : false; ?> /> |
  | 570 |  | </td> |
  | 571 |  | </tr> |
  | 572 |  | <?php } ?> |
  | 573 |  | <tr class="nodrag nodrop"> |
  | 574 |  | <td>&nbsp;</td> |
  | 575 |  | <td><i><?php \_e( 'Registration IP', 'wp-members' ); ?></i></td> |
  | 576 |  | <td><i>wpmem\_reg\_ip</i></td> |
  | 577 |  | <td colspan="5">&nbsp;</td> |
  | 578 |  | <td align="center"> |
  | 579 |  | <input type="checkbox" name="ut\_fields[wpmem\_reg\_ip]" |
  | 580 |  | value="Registration IP" |
  | 581 |  | <?php echo ( ( $wpmem\_ut\_fields ) && ( in\_array( 'Registration IP', $wpmem\_ut\_fields ) ) ) ? 'checked' : false; ?> /> |
  | 582 |  | </td> |
  | 583 |  | </tr> |
  | 584 |  | <?php if ( defined( 'WPMEM\_EXP\_MODULE' ) && $wpmem->use\_exp == 1 ) { ?> |
  | 585 |  | <tr class="nodrag nodrop"> |
  | 586 |  | <td>&nbsp;</td> |
  | 587 |  | <td><i>Subscription Type</i></td> |
  | 588 |  | <td><i>exp\_type</i></td> |
  | 589 |  | <td colspan="5">&nbsp;</td> |
  | 590 |  | <td align="center"> |
  | 591 |  | <input type="checkbox" name="ut\_fields[exp\_type]" |
  | 592 |  | value="Subscription Type" |
  | 593 |  | <?php echo ( ( $wpmem\_ut\_fields ) && ( in\_array( 'Subscription Type', $wpmem\_ut\_fields ) ) ) ? 'checked' : false; ?> /> |
  | 594 |  | </td> |
  | 595 |  | </tr> |
  | 596 |  | <tr class="nodrag nodrop"> |
  | 597 |  | <td>&nbsp;</td> |
  | 598 |  | <td><i>Expires</i></td> |
  | 599 |  | <td><i>expires</i></td> |
  | 600 |  | <td colspan="5">&nbsp;</td> |
  | 601 |  | <td align="center"> |
  | 602 |  | <input type="checkbox" name="ut\_fields[expires]" |
  | 603 |  | value="Expires" |
  | 604 |  | <?php echo ( ( $wpmem\_ut\_fields ) && ( in\_array( 'Expires', $wpmem\_ut\_fields ) ) ) ? 'checked' : false; ?> /> |
  | 605 |  | </td> |
  | 606 |  | </tr> |
  | 607 |  | <?php } ?> |
  | 608 |  | </table><br /> |
  | 609 |  | <input type="hidden" name="wpmem\_admin\_a" value="update\_fields" /> |
  | 610 |  | <?php submit\_button( \_\_( 'Update Fields', 'wp-members' ) ); ?> |
  | 611 |  | </form> |
  | 612 |  | </div><!-- .inside --> |
  | 613 |  | </div> |
  | 614 |  | <?php |
  |  | 384 | \*/ |
  |  | 385 | function wpmem\_a\_render\_fields\_tab\_field\_table() { |
  |  | 386 | global $wpmem; |
  |  | 387 |  |
  |  | 388 | $wpmem\_ut\_fields\_skip = array( 'user\_email', 'confirm\_email', 'password', 'confirm\_password' ); |
  |  | 389 | $wpmem\_ut\_fields = get\_option( 'wpmembers\_utfields' ); |
  |  | 390 |  |
  |  | 391 | $wpmem\_fields = get\_option( 'wpmembers\_fields', array() ); |
  |  | 392 | foreach ( $wpmem\_fields as $key => $field ) { |
  |  | 393 |  |
  |  | 394 | // @todo - transitional until new array keys |
  |  | 395 | if ( is\_numeric( $key ) ) { |
  |  | 396 |  |
  |  | 397 | $meta = $field[2]; |
  |  | 398 |  |
  |  | 399 | $ut\_checked = ( ( $wpmem\_ut\_fields ) && ( in\_array( $field[1], $wpmem\_ut\_fields ) ) ) ? $field[1] : ''; |
  |  | 400 | $field\_items[] = array( |
  |  | 401 | 'order'    => $field[0], |
  |  | 402 | 'label'    => $field[1], |
  |  | 403 | 'meta'     => $meta, |
  |  | 404 | 'type'     => $field[3], |
  |  | 405 | 'display'  => ( $meta != 'user\_email' ) ? wpmem\_create\_formfield( $meta . "\_display",  'checkbox', 'y', $field[4] ) : '', |
  |  | 406 | 'req'      => ( $meta != 'user\_email' ) ? wpmem\_create\_formfield( $meta . "\_required", 'checkbox', 'y', $field[5] ) : '', |
  |  | 407 | //'profile'  => ( $meta != 'user\_email' ) ? wpmem\_create\_formfield( $meta . "\_profile",  'checkbox', true, $field[6] ) : '', |
  |  | 408 | 'edit'     => wpmem\_fields\_edit\_link( $meta ), |
  |  | 409 | 'userscrn' => ( ! in\_array( $meta, $wpmem\_ut\_fields\_skip ) ) ? wpmem\_create\_formfield( 'ut\_fields[' . $meta . ']', 'checkbox', $field[1], $ut\_checked ) : '', |
  |  | 410 | 'sort'     => '<span class="ui-icon ui-icon-grip-dotted-horizontal" title="' . \_\_( 'Drag and drop to reorder fields', 'wp-members' ) . '"></span>', |
  |  | 411 | ); |
  |  | 412 | } |
  |  | 413 | } |
  |  | 414 |  |
  |  | 415 | $extra\_user\_screen\_items = array( |
  |  | 416 | 'user\_registered' => 'Registration Date', |
  |  | 417 | 'active' => 'Active', |
  |  | 418 | 'wpmem\_reg\_ip' => 'Registration IP', |
  |  | 419 | 'exp\_type' => 'Subscription Type', |
  |  | 420 | 'expires' => 'Expires', |
  |  | 421 | ); |
  |  | 422 |  |
  |  | 423 | foreach ( $extra\_user\_screen\_items as $key => $item ) { |
  |  | 424 | $ut\_checked = ( ( $wpmem\_ut\_fields ) && ( in\_array( $item, $wpmem\_ut\_fields ) ) ) ? $item : ''; |
  |  | 425 | if ( 'user\_registered' == $key || ( 'active' == $key && 1 == $wpmem->mod\_reg ) || 'wpmem\_reg\_ip' == $key || defined( 'WPMEM\_EXP\_MODULE' ) && $wpmem->use\_exp == 1 && ( 'exp\_type' == $key || 'expires' == $key ) ) { |
  |  | 426 | $user\_screen\_items[ $key ] = array( 'label' => \_\_( $item, 'wp-members' ), 'meta' => $key, |
  |  | 427 | 'userscrn' => wpmem\_create\_formfield( "ut\_fields[{$key}]", 'checkbox', $item, $ut\_checked ), |
  |  | 428 | ); |
  |  | 429 | } |
  |  | 430 | } |
  |  | 431 |  |
  |  | 432 | foreach ( $user\_screen\_items as $screen\_item ) { |
  |  | 433 | $field\_items[] = array( |
  |  | 434 | 'label' => $screen\_item['label'], |
  |  | 435 | 'meta'  => $screen\_item['meta'], |
  |  | 436 | 'type'  => '', |
  |  | 437 | 'display' => '', |
  |  | 438 | 'req' => '', |
  |  | 439 | 'profile' => '', |
  |  | 440 | 'edit' => '', |
  |  | 441 | 'userscrn' => $screen\_item['userscrn'], |
  |  | 442 | 'sort' => '', |
  |  | 443 | ); |
  |  | 444 | } |
  |  | 445 |  |
  |  | 446 | $table = new WP\_Members\_Fields\_Table(); |
  |  | 447 |  |
  |  | 448 | $heading     = \_\_( 'Manage Fields', 'wp-members' ); |
  |  | 449 | //$description = \_\_( 'Displaying fields for:', 'wp-members' ); |
  |  | 450 | //$which\_form  = $wpmem->form\_tags[ $wpmem->admin->current\_form ]; |
  |  | 451 |  |
  |  | 452 | echo '<div class="wrap">'; |
  |  | 453 | printf( '<h3 class="title">%s</h3>', $heading ); |
  |  | 454 | //printf( '<p>%s <strong>%s</strong></p>', $description, $which\_form ); |
  |  | 455 | printf( '<form name="updatefieldform" id="updatefieldform" method="post" action="%s">', wpmem\_admin\_form\_post\_url() ); |
  |  | 456 |  |
  |  | 457 | $table->items = $field\_items; |
  |  | 458 | $table->prepare\_items(); |
  |  | 459 | $table->display(); |
  |  | 460 | echo '</form>'; |
  |  | 461 | echo '</div>'; |
  |  | 462 | } |
  |  | 463 |  |
  |  | 464 | /\*\* |
  |  | 465 | \* Extends the WP\_List\_Table to create a table of form fields. |
  |  | 466 | \* |
  |  | 467 | \* @since 3.1.8 |
  |  | 468 | \*/ |
  |  | 469 | class WP\_Members\_Fields\_Table extends WP\_List\_Table { |
  |  | 470 |  |
  |  | 471 | private $excludes = array( 'user\_registered', 'active', 'wpmem\_reg\_ip', 'exp\_type', 'expires' ); |
  |  | 472 |  |
  |  | 473 | private $no\_delete = array( 'user\_email', 'first\_name', 'last\_name', 'user\_url' ); |
  |  | 474 |  |
  |  | 475 | /\*\* |
  |  | 476 | \* Checkbox at start of row. |
  |  | 477 | \* |
  |  | 478 | \* @since 3.1.8 |
  |  | 479 | \* |
  |  | 480 | \* @param $item |
  |  | 481 | \* @return string The checkbox. |
  |  | 482 | \*/ |
  |  | 483 | function column\_cb( $item ) { |
  |  | 484 | if ( in\_array( $item['meta'], $this->no\_delete ) || in\_array( $item['meta'], $this->excludes ) ) { |
  |  | 485 | return; |
  |  | 486 | } else { |
  |  | 487 | return sprintf( '<input type="checkbox" name="delete[]" value="%s" title="%s" />', $item['meta'], \_\_( 'delete', 'wp-members' ) ); |
  |  | 488 | } |
  |  | 489 | } |
  |  | 490 |  |
  |  | 491 | /\*\* |
  |  | 492 | \* Returns table columns. |
  |  | 493 | \* |
  |  | 494 | \* @since 3.1.8 |
  |  | 495 | \* |
  |  | 496 | \* @return array |
  |  | 497 | \*/ |
  |  | 498 | function get\_columns() { |
  |  | 499 | return array( |
  |  | 500 | 'cb'   =>  '<input type="checkbox" />', |
  |  | 501 | 'label'    => \_\_( 'Display Label', 'wp-members' ), |
  |  | 502 | 'meta'     => \_\_( 'Meta Key',      'wp-members' ), |
  |  | 503 | 'type'     => \_\_( 'Field Type',    'wp-members' ), |
  |  | 504 | 'display'  => \_\_( 'Display?',      'wp-members' ), |
  |  | 505 | 'req'      => \_\_( 'Required?',     'wp-members' ), |
  |  | 506 | //'profile'  => \_\_( 'Profile Only',  'wp-members' ), |
  |  | 507 | 'edit'     => \_\_( 'Edit',          'wp-members' ), |
  |  | 508 | 'userscrn' => \_\_( 'Users Screen',  'wp-members' ), |
  |  | 509 | 'sort'     => '', |
  |  | 510 | ); |
  |  | 511 | } |
  |  | 512 |  |
  |  | 513 | /\*\* |
  |  | 514 | \* Set up table columns. |
  |  | 515 | \* |
  |  | 516 | \* @since 3.1.8 |
  |  | 517 | \*/ |
  |  | 518 | function prepare\_items() { |
  |  | 519 | $columns  = $this->get\_columns(); |
  |  | 520 | $hidden   = array(); |
  |  | 521 | $sortable = array(); |
  |  | 522 | $this->\_column\_headers = array( $columns, $hidden, $sortable ); |
  |  | 523 | } |
  |  | 524 |  |
  |  | 525 | /\*\* |
  |  | 526 | \* Iterates through the columns |
  |  | 527 | \* |
  |  | 528 | \* @since 3.1.8 |
  |  | 529 | \* |
  |  | 530 | \* @param  array  $item |
  |  | 531 | \* @param  string $column\_name |
  |  | 532 | \* @return string $item[ $column\_name ] |
  |  | 533 | \*/ |
  |  | 534 | function column\_default( $item, $column\_name ) { |
  |  | 535 | switch( $column\_name ) { |
  |  | 536 | default: |
  |  | 537 | return $item[ $column\_name ]; |
  |  | 538 | } |
  |  | 539 | } |
  |  | 540 |  |
  |  | 541 | /\*\* |
  |  | 542 | \* Sets actions in the bulk menu. |
  |  | 543 | \* |
  |  | 544 | \* @since 3.1.8 |
  |  | 545 | \* |
  |  | 546 | \* @return array $actions |
  |  | 547 | \*/ |
  |  | 548 | function get\_bulk\_actions() { |
  |  | 549 | $actions = array( |
  |  | 550 | 'delete' => \_\_( 'Delete Selected', 'wp-members' ), |
  |  | 551 | 'save'   => \_\_( 'Save Settings', 'wp-members' ), |
  |  | 552 | ); |
  |  | 553 | return $actions; |
  |  | 554 | } |
  |  | 555 |  |
  |  | 556 | /\*\* |
  |  | 557 | \* Handles "delete" column - checkbox |
  |  | 558 | \* |
  |  | 559 | \* @since 3.1.8 |
  |  | 560 | \* |
  |  | 561 | \* @param  array  $item |
  |  | 562 | \* @return string |
  |  | 563 | \*/ |
  |  | 564 | function column\_delete( $item ) { |
  |  | 565 | $can\_delete = ( $item['meta\_key'] == 'user\_nicename' || $item['meta\_key'] == 'display\_name' || $item['meta\_key'] == 'nickname' ) ? true : false; |
  |  | 566 | return ( ( $can\_delete ) || $item['native'] != true ) ? sprintf( '<input type="checkbox" name="field[%s]" value="delete" />', $item['meta'] ) : ''; |
  |  | 567 | } |
  |  | 568 |  |
  |  | 569 | /\*\* |
  |  | 570 | \* Sets rows so that they have field IDs in the id. |
  |  | 571 | \* |
  |  | 572 | \* @since 3.1.8 |
  |  | 573 | \* |
  |  | 574 | \* @global wpmem |
  |  | 575 | \* @param  array $columns |
  |  | 576 | \*/ |
  |  | 577 | function single\_row( $columns ) { |
  |  | 578 | if ( in\_array( $columns['meta'], $this->excludes ) ) { |
  |  | 579 | echo '<tr id="' . $columns['meta'] . '" class="nodrag nodrop">'; |
  |  | 580 | echo $this->single\_row\_columns( $columns ); |
  |  | 581 | echo "</tr>\n"; |
  |  | 582 | } else { |
  |  | 583 | echo '<tr id="list\_items\_' . $columns['order'] . '" class="list\_item" list\_item="' . $columns['order'] . '">'; |
  |  | 584 | echo $this->single\_row\_columns( $columns ); |
  |  | 585 | echo "</tr>\n"; |
  |  | 586 | } |
  |  | 587 | } |
  |  | 588 |  |
  |  | 589 | public function process\_bulk\_action() { |
  |  | 590 |  |
  |  | 591 | //nonce validations,etc |
  |  | 592 |  |
  |  | 593 | $action = $this->current\_action(); |
  |  | 594 |  |
  |  | 595 | switch ( $action ) { |
  |  | 596 |  |
  |  | 597 | case 'delete': |
  |  | 598 |  |
  |  | 599 | // Do whatever you want |
  |  | 600 | wp\_redirect( esc\_url( add\_query\_arg() ) ); |
  |  | 601 | break; |
  |  | 602 |  |
  |  | 603 | default: |
  |  | 604 | // do nothing or something else |
  |  | 605 | return; |
  |  | 606 | break; |
  |  | 607 | } |
  |  | 608 | return; |
  |  | 609 | } |
  |  | 610 |  |
  |  | 611 | } |
  |  | 612 |  |
  |  | 613 | /\*\* |
  |  | 614 | \* Javascript to ID the fields table and add curser style to rows. |
  |  | 615 | \* |
  |  | 616 | \* @since 3.1.8 |
  |  | 617 | \*/ |
  |  | 618 | add\_action( 'admin\_footer', 'wpmem\_bulk\_fields\_action'   ); |
  |  | 619 | function wpmem\_bulk\_fields\_action() { |
  |  | 620 | // if ( isset( $\_GET['tab'] ) && $\_GET['tab'] == 'fields' ) { |
  |  | 621 | if ( isset( $\_GET['tab'] ) && $\_GET['tab'] == 'fields' ) { |
  |  | 622 | ?><script type="text/javascript"> |
  |  | 623 | (function($) { |
  |  | 624 | $(document).ready(function() { |
  |  | 625 | $("table").attr("id", "wpmem-fields"); |
  |  | 626 | /\*\*$("tr").attr('style', 'cursor:move;');\*\*/ |
  |  | 627 | }); |
  |  | 628 | })(jQuery); |
  |  | 629 | jQuery('<input id="add\_field" name="add\_field" class="button action" type="submit" value="<?php \_e( 'Add Field', 'wp-members' ); ?>" />').appendTo(".top .bulkactions"); |
  |  | 630 | jQuery('<input id="add\_field" name="add\_field" class="button action" type="submit" value="<?php \_e( 'Add Field', 'wp-members' ); ?>" />').appendTo(".bottom .bulkactions"); |
  |  | 631 | </script><?php |
  |  | 632 | } |
  |  | 633 | } |
  |  | 634 |  |
  |  | 635 | /\*\* |
  |  | 636 | \* Updates fields. |
  |  | 637 | \* |
  |  | 638 | \* Derived from wpmem\_update\_fields() |
  |  | 639 | \* |
  |  | 640 | \* @since 3.1.8 |
  |  | 641 | \* |
  |  | 642 | \* @global object $wpmem |
  |  | 643 | \* @global string $did\_update |
  |  | 644 | \* @global string $add\_field\_err\_msg  The add field error message |
  |  | 645 | \*/ |
  |  | 646 | function wpmem\_admin\_fields\_update() { |
  |  | 647 |  |
  |  | 648 | global $wpmem, $did\_update, $delete\_action; |
  |  | 649 |  |
  |  | 650 | if ( isset( $\_GET['tab'] ) && $\_GET['tab'] == 'fields' ) { |
  |  | 651 | // Get the current fields. |
  |  | 652 | $wpmem\_fields    = get\_option( 'wpmembers\_fields' ); |
  |  | 653 |  |
  |  | 654 | $action = wpmem\_get( 'action', false ); |
  |  | 655 | $action = ( -1 == $action ) ? wpmem\_get( 'action2' ) : $action; |
  |  | 656 |  |
  |  | 657 | $delete\_action = false; |
  |  | 658 |  |
  |  | 659 | if ( 'save' == $action ) { |
  |  | 660 |  |
  |  | 661 | // Check nonce. |
  |  | 662 | //check\_admin\_referer( 'wpmem-update-fields' ); |
  |  | 663 |  |
  |  | 664 | // Update user table fields. |
  |  | 665 | $arr = ( isset( $\_POST['ut\_fields'] ) ) ? $\_POST['ut\_fields'] : ''; |
  |  | 666 | update\_option( 'wpmembers\_utfields', $arr ); |
  |  | 667 |  |
  |  | 668 | // Update display/required settings |
  |  | 669 | foreach ( $wpmem\_fields as $key => $field ) { |
  |  | 670 | $meta\_key = $field[2]; |
  |  | 671 | if ( 'user\_email' == $meta\_key ) { |
  |  | 672 | $wpmem\_fields[ $key ][4] = 'y'; |
  |  | 673 | $wpmem\_fields[ $key ][5] = 'y'; |
  |  | 674 | } else { |
  |  | 675 | $wpmem\_fields[ $key ][4] = ( wpmem\_get( $meta\_key . "\_display"  ) ) ? 'y' : ''; |
  |  | 676 | $wpmem\_fields[ $key ][5] = ( wpmem\_get( $meta\_key . "\_required" ) ) ? 'y' : ''; |
  |  | 677 | } |
  |  | 678 | } |
  |  | 679 | update\_option( 'wpmembers\_fields', $wpmem\_fields ); |
  |  | 680 | $wpmem->load\_fields(); |
  |  | 681 | $did\_update = \_\_( 'WP-Members fields were updated', 'wp-members' ); |
  |  | 682 | return $did\_update; |
  |  | 683 |  |
  |  | 684 | } elseif ( 'delete' == $action ) { |
  |  | 685 |  |
  |  | 686 | $delete\_action = 'delete'; |
  |  | 687 |  |
  |  | 688 | } elseif ( 'add\_field' == wpmem\_get( 'wpmem\_admin\_a' ) || 'edit\_field' == wpmem\_get( 'wpmem\_admin\_a' ) ) { |
  |  | 689 |  |
  |  | 690 | // Set action. |
  |  | 691 | $action = wpmem\_get( 'wpmem\_admin\_a' ); |
  |  | 692 |  |
  |  | 693 | // Check nonce. |
  |  | 694 | //check\_admin\_referer( 'wpmem-add-fields' ); |
  |  | 695 |  |
  |  | 696 | global $add\_field\_err\_msg; |
  |  | 697 |  |
  |  | 698 | $add\_field\_err\_msg = false; |
  |  | 699 | $add\_name = wpmem\_get( 'add\_name' ); |
  |  | 700 | $add\_option = wpmem\_get( 'add\_option' ); |
  |  | 701 |  |
  |  | 702 | // Error check that field label and option name are included and unique. |
  |  | 703 | $add\_field\_err\_msg = ( ! $add\_name   ) ? \_\_( 'Field Label is required. Nothing was updated.', 'wp-members' ) : $add\_field\_err\_msg; |
  |  | 704 | $add\_field\_err\_msg = ( ! $add\_option ) ? \_\_( 'Meta Key is required. Nothing was updated.',    'wp-members' ) : $add\_field\_err\_msg; |
  |  | 705 |  |
  |  | 706 | $add\_field\_err\_msg = ( ! preg\_match("/^[A-Za-z0-9\_]\*$/", $add\_option ) ) ? \_\_( 'Meta Key must contain only letters, numbers, and underscores', 'wp-members' ) : $add\_field\_err\_msg; |
  |  | 707 |  |
  |  | 708 | // Check for duplicate field names. |
  |  | 709 | $chk\_fields = array(); |
  |  | 710 | foreach ( $wpmem\_fields as $field ) { |
  |  | 711 | $chk\_fields[] = $field[2]; |
  |  | 712 | } |
  |  | 713 | $add\_field\_err\_msg = ( in\_array( $add\_option, $chk\_fields ) ) ? \_\_( 'A field with that meta key already exists', 'wp-members' ) : $add\_field\_err\_msg; |
  |  | 714 |  |
  |  | 715 | // Error check for reserved terms. |
  |  | 716 | $reserved\_terms = wpmem\_wp\_reserved\_terms(); |
  |  | 717 | if ( in\_array( strtolower( $add\_option ), $reserved\_terms ) ) { |
  |  | 718 | $add\_field\_err\_msg = sprintf( \_\_( 'Sorry, "%s" is a <a href="https://codex.wordpress.org/Function\_Reference/register\_taxonomy#Reserved\_Terms" target="\_blank">reserved term</a>. Field was not added.', 'wp-members' ), $submitted\_term ); |
  |  | 719 | } |
  |  | 720 |  |
  |  | 721 | // Error check option name for spaces and replace with underscores. |
  |  | 722 | $us\_option = preg\_replace( "/ /", '\_', $add\_option ); |
  |  | 723 |  |
  |  | 724 | $arr = array(); |
  |  | 725 |  |
  |  | 726 | $type =  wpmem\_get( 'add\_type' ); |
  |  | 727 |  |
  |  | 728 | $arr[0] = wpmem\_get( 'add\_order\_id' ); |
  |  | 729 | $arr[1] = stripslashes( wpmem\_get( 'add\_name' ) ); |
  |  | 730 | $arr[2] = $us\_option; |
  |  | 731 | $arr[3] = $type; |
  |  | 732 | $arr[4] = wpmem\_get( 'add\_display', 'n' ); |
  |  | 733 | $arr[5] = wpmem\_get( 'add\_required', 'n' ); |
  |  | 734 | $arr[6] = ( $us\_option == 'user\_nicename' || $us\_option == 'display\_name' || $us\_option == 'nickname' ) ? 'y' : 'n'; |
  |  | 735 |  |
  |  | 736 | if ( 'text' == $type || 'email' == $type || 'textarea' == $type || 'password' == $type || 'url' == $type || 'number' == $type || 'date' == $type ) { |
  |  | 737 | $arr['placeholder'] = wpmem\_get( 'add\_placeholder' ); |
  |  | 738 | } |
  |  | 739 |  |
  |  | 740 | if ( 'text' == $type || 'email' == $type || 'password' == $type || 'url' == $type || 'number' == $type || 'date' == $type ) { |
  |  | 741 | $arr['pattern'] = wpmem\_get( 'add\_pattern' ); |
  |  | 742 | $arr['title']   = wpmem\_get( 'add\_title' ); |
  |  | 743 | } |
  |  | 744 |  |
  |  | 745 | if ( 'number' == $type || 'date' == $type ) { |
  |  | 746 | $arr['min'] = wpmem\_get( 'add\_min' ); |
  |  | 747 | $arr['max'] = wpmem\_get( 'add\_max' ); |
  |  | 748 | } |
  |  | 749 |  |
  |  | 750 | if ( $type == 'checkbox' ) { |
  |  | 751 | $add\_field\_err\_msg = ( ! $\_POST['add\_checked\_value'] ) ? \_\_( 'Checked value is required for checkboxes. Nothing was updated.', 'wp-members' ) : $add\_field\_err\_msg; |
  |  | 752 | $arr[7] = wpmem\_get( 'add\_checked\_value', false ); |
  |  | 753 | $arr[8] = wpmem\_get( 'add\_checked\_default', 'n' ); |
  |  | 754 | } |
  |  | 755 |  |
  |  | 756 | if (   $type == 'select' |
  |  | 757 | || $type == 'multiselect' |
  |  | 758 | || $type == 'radio' |
  |  | 759 | || $type == 'multicheckbox' |
  |  | 760 | ) { |
  |  | 761 | // Get the values. |
  |  | 762 | $str = stripslashes( $\_POST['add\_dropdown\_value'] ); |
  |  | 763 | // Remove linebreaks. |
  |  | 764 | $str = trim( str\_replace( array("\r", "\r\n", "\n"), '', $str ) ); |
  |  | 765 | // Create array. |
  |  | 766 | if ( ! function\_exists( 'str\_getcsv' ) ) { |
  |  | 767 | $arr[7] = explode( ',', $str ); |
  |  | 768 | } else { |
  |  | 769 | $arr[7] = str\_getcsv( $str, ',', '"' ); |
  |  | 770 | } |
  |  | 771 | // If multiselect or multicheckbox, set delimiter. |
  |  | 772 | if ( 'multiselect' == $type || 'multicheckbox' == $type ) { |
  |  | 773 | $arr[8] = ( isset( $\_POST['add\_delimiter\_value'] ) ) ? $\_POST['add\_delimiter\_value'] : '|'; |
  |  | 774 | } |
  |  | 775 | } |
  |  | 776 |  |
  |  | 777 | if ( $type == 'file' || $type == 'image' ) { |
  |  | 778 | $arr[7] = stripslashes( $\_POST['add\_file\_value'] ); |
  |  | 779 | } |
  |  | 780 |  |
  |  | 781 | if ( wpmem\_get( 'add\_type' ) == 'hidden' ) { |
  |  | 782 | $add\_field\_err\_msg = ( ! $\_POST['add\_hidden\_value'] ) ? \_\_( 'A value is required for hidden fields. Nothing was updated.', 'wp-members' ) : $add\_field\_err\_msg; |
  |  | 783 | $arr[7] = ( isset( $\_POST['add\_hidden\_value'] ) )   ? stripslashes( $\_POST['add\_hidden\_value'] ) : ''; |
  |  | 784 | } |
  |  | 785 |  |
  |  | 786 | if ( $action == 'add\_field' ) { |
  |  | 787 | if ( ! $add\_field\_err\_msg ) { |
  |  | 788 | array\_push( $wpmem\_fields, $arr ); |
  |  | 789 | $did\_update = sprintf( \_\_( '%s was added', 'wp-members' ), $\_POST['add\_name'] ); |
  |  | 790 | } else { |
  |  | 791 | $did\_update = $add\_field\_err\_msg; |
  |  | 792 | } |
  |  | 793 | } else { |
  |  | 794 | for ( $row = 0; $row < count( $wpmem\_fields ); $row++ ) { |
  |  | 795 | if ( $wpmem\_fields[ $row ][2] == wpmem\_get( 'field', false, 'get' ) ) { |
  |  | 796 | $arr[0] = $wpmem\_fields[ $row ][0]; |
  |  | 797 | foreach ( $arr as $key => $value ) { |
  |  | 798 | $wpmem\_fields[ $row ][ $key ] = $arr[ $key ]; |
  |  | 799 | } |
  |  | 800 | } |
  |  | 801 | } |
  |  | 802 | $did\_update =  sprintf( \_\_( '%s was updated', 'wp-members' ), $add\_name ); |
  |  | 803 | $did\_update.= '<p><a href="' . add\_query\_arg( array( 'page' => 'wpmem-settings', 'tab' => 'fields' ), get\_admin\_url() . 'options-general.php' ) . '">&laquo; ' . \_\_( 'Return to Fields Table', 'wp-members' ) . '</a></p>'; |
  |  | 804 | } |
  |  | 805 |  |
  |  | 806 | $wpmem\_newfields = $wpmem\_fields; |
  |  | 807 |  |
  |  | 808 | update\_option( 'wpmembers\_fields', $wpmem\_newfields ); |
  |  | 809 | $wpmem->load\_fields(); |
  |  | 810 | return $did\_update; |
  |  | 811 | } |
  |  | 812 | } |
  |  | 813 | } |
  |  | 814 |  |
  |  | 815 | /\*\* |
  |  | 816 | \* Reorders form fields. |
  |  | 817 | \* |
  |  | 818 | \* @since 2.5.1 |
  |  | 819 | \* @since 3.1.8 Rebuilt for new List Table. |
  |  | 820 | \*/ |
  |  | 821 | function wpmem\_a\_field\_reorder() { |
  |  | 822 |  |
  |  | 823 | // Start fresh. |
  |  | 824 | $new\_order = $wpmem\_fields = $field = $key = $wpmem\_new\_fields = $id = $k = ''; |
  |  | 825 | $wpmem\_fields = get\_option( 'wpmembers\_fields' ); |
  |  | 826 |  |
  |  | 827 | // Get the list items |
  |  | 828 | $new\_order = $\_POST; |
  |  | 829 |  |
  |  | 830 | // Put fields in the proper order for the current form. |
  |  | 831 | $wpmem\_new\_fields = array(); |
  |  | 832 | foreach ( $new\_order['list\_items'] as $id ) { |
  |  | 833 | foreach( $wpmem\_fields as $val ) { |
  |  | 834 | if ( $val[0] == $id ) { |
  |  | 835 | $wpmem\_new\_fields[] = $val; |
  |  | 836 | } |
  |  | 837 | } |
  |  | 838 | } |
  |  | 839 |  |
  |  | 840 | // Save fields array with new current form field order. |
  |  | 841 | update\_option( 'wpmembers\_fields', $wpmem\_new\_fields ); |
  |  | 842 |  |
  |  | 843 | // Indicate successful transaction. |
  |  | 844 | \_e( 'Form field order updated.', 'wp-members' ); |
  |  | 845 |  |
  |  | 846 | die(); // This is required to return a proper result. |
  |  | 847 |  |
  | 615 | 848 | } |
  | 616 | 849 |  |
* ## [wp-members/trunk/admin/tab-options.php](/changeset/1667369/wp-members/trunk/admin/tab-options.php "Show the changeset 1667369 restricted to wp-members/trunk/admin/tab-options.php")

  | [r1628757](/browser/wp-members/trunk/admin/tab-options.php?rev=1628757#L71 "Show revision 1628757 of this file in browser") | [r1667369](/browser/wp-members/trunk/admin/tab-options.php?rev=1667369#L71 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 71 | 71 | <h3><span><?php \_e( 'Manage Options', 'wp-members' ); ?></span></h3> |
  | 72 | 72 | <div class="inside"> |
  | 73 |  | <form name="updatesettings" id="updatesettings" method="post" action="<?php echo ~~$\_SERVER['REQUEST\_URI']~~?>"> |
  |  | 73 | <form name="updatesettings" id="updatesettings" method="post" action="<?php echo wpmem\_admin\_form\_post\_url(); ?>"> |
  | 74 | 74 | <?php wp\_nonce\_field( 'wpmem-update-settings' ); ?> |
  | 75 | 75 | <h3><?php \_e( 'Content', 'wp-members' ); ?></h3> |
  | […](/browser/wp-members/trunk/admin/tab-options.php?rev=1628757#L247) | […](/browser/wp-members/trunk/admin/tab-options.php?rev=1667369#L247) |  |
  | 247 | 247 | <h3><span><?php \_e( 'Custom Post Types', 'wp-members' ); ?></span></h3> |
  | 248 | 248 | <div class="inside"> |
  | 249 |  | <form name="updatecpts" id="updatecpts" method="post" action="<?php echo ~~$\_SERVER['REQUEST\_URI']~~?>"> |
  |  | 249 | <form name="updatecpts" id="updatecpts" method="post" action="<?php echo wpmem\_admin\_form\_post\_url(); ?>"> |
  | 250 | 250 | <?php wp\_nonce\_field( 'wpmem-update-cpts' ); ?> |
  | 251 | 251 | <table class="form-table"> |
* ## [wp-members/trunk/admin/user-profile.php](/changeset/1667369/wp-members/trunk/admin/user-profile.php "Show the changeset 1667369 restricted to wp-members/trunk/admin/user-profile.php")

  | [r1628757](/browser/wp-members/trunk/admin/user-profile.php?rev=1628757#L94 "Show revision 1628757 of this file in browser") | [r1667369](/browser/wp-members/trunk/admin/user-profile.php?rev=1667369#L94 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 94 | 94 | $input = ( $attachment\_url ) ? '<img src="' . $attachment\_url . '">' : $empty\_file; |
  | 95 | 95 | } |
  | 96 |  | // @todo - come up with a way to handle file updates - user profile form does not support multitype |
  | 97 |  | //$show\_field.= ' <span class="description">' . \_\_( 'Update this file:' ) . '</span><br />'; |
  | 98 |  | //$show\_field.= wpmem\_create\_formfield( $meta[2] . '\_update\_file', $meta[3], $val, $valtochk ); |
  |  | 96 | $input.= '<br />' . $wpmem->get\_text( 'profile\_upload' ) . '<br />'; |
  |  | 97 | $input.= wpmem\_form\_field( array( |
  |  | 98 | 'name'    => $meta, |
  |  | 99 | 'type'    => $field['type'], |
  |  | 100 | 'value'   => $val, |
  |  | 101 | 'compare' => $valtochk, |
  |  | 102 | ) ); |
  | 99 | 103 | } else { |
  | 100 | 104 | if ( 'select' == $field['type'] || 'radio' == $field['type'] ) { |
  | […](/browser/wp-members/trunk/admin/user-profile.php?rev=1628757#L237) | […](/browser/wp-members/trunk/admin/user-profile.php?rev=1667369#L241) |  |
  | 237 | 241 | } |
  | 238 | 242 | } |
  | 239 |  |  |
  |  | 243 |  |
  | 240 | 244 | /\*\* |
  | 241 | 245 | \* Filter the submitted field values for backend profile update. |
  | […](/browser/wp-members/trunk/admin/user-profile.php?rev=1628757#L255) | […](/browser/wp-members/trunk/admin/user-profile.php?rev=1667369#L259) |  |
  | 255 | 259 | } |
  | 256 | 260 | } |
  |  | 261 |  |
  |  | 262 | if ( ! empty( $\_FILES ) ) { |
  |  | 263 | $wpmem->user->upload\_user\_files( $user\_id, $wpmem->fields ); |
  |  | 264 | } |
  | 257 | 265 |  |
  | 258 | 266 | if ( $wpmem->mod\_reg == 1 ) { |
* ## [wp-members/trunk/admin/users.php](/changeset/1667369/wp-members/trunk/admin/users.php "Show the changeset 1667369 restricted to wp-members/trunk/admin/users.php")

  | [r1628757](/browser/wp-members/trunk/admin/users.php?rev=1628757#L207 "Show revision 1628757 of this file in browser") | [r1667369](/browser/wp-members/trunk/admin/users.php?rev=1667369#L207 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 207 | 207 | global $pagenow, $user\_action\_msg; |
  | 208 | 208 | if( $pagenow == 'users.php' && isset( $\_REQUEST['activated'] ) ) { |
  | 209 |  | $message = ~~$\_REQUEST['activated']~~; |
  |  | 209 | $message = esc\_html( $\_REQUEST['activated'] ); |
  | 210 | 210 | echo "<div class=\"updated\"><p>{$message}</p></div>"; |
  | 211 | 211 | } |
* ## [wp-members/trunk/changelog.txt](/changeset/1667369/wp-members/trunk/changelog.txt "Show the changeset 1667369 restricted to wp-members/trunk/changelog.txt")

  | [r1531322](/browser/wp-members/trunk/changelog.txt?rev=1531322#L1 "Show revision 1531322 of this file in browser") | [r1667369](/browser/wp-members/trunk/changelog.txt?rev=1667369#L1 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | ﻿= 3.1.5 = |
  |  | 1 | ﻿= 3.1.6 = |
  |  | 2 |  |
  |  | 3 | \* Fixed [wpmem\_field] display handling for multiple select and multiple checkbox field types. |
  |  | 4 | \* Updates to always load fields from wpmem\_fields() API function. |
  |  | 5 | \* Updates to begin to utilize new fields settings array.  Fields setting is still store in the same array format as before.  However, it is loaded into the new settings format.  Current object class keeps numeric keys in place for legacy purposes. |
  |  | 6 | \* Updates to dropdown handling on main options tab to display proper preselected value when site is using ssl (https://) and no value is selected. |
  |  | 7 | \* Added wpmem\_loginout() API function, changed [wpmem\_loginout] shortcode to use API function. |
  |  | 8 | \* Added wpmem\_array\_insert() API function, allows for inserting array elements at any point in an array. |
  |  | 9 | \* Added wp\_destroy\_current\_session() to logout function. |
  |  | 10 | \* Added WooCommerce support in native WP registration functions. Began adding WooCommerce classes to registration form elements. |
  |  | 11 | \* Added to wpmem\_user\_has\_role() function to check for a single role or if the user has a role that is in an array of roles. |
  |  | 12 | \* Added wpmem\_shortcodes\_loaded, wpmem\_hooks\_loaded, and wpmem\_dropins\_loaded to fire after. |
  |  | 13 | \* Added text input to set a default 'read more' link for auto excerpt. |
  |  | 14 | \* Fixed issue with auto excerpt where an excerpt shorter than the excerpt setting would not display the more link. |
  |  | 15 | \* Preliminary updates to include placeholder support in fields (this will be an option in a future release). |
  |  | 16 | \* Localization fix of untranslated strings. |
  |  | 17 | \* Wrap "Remember Me" checkbox label with label tag in login form. |
  |  | 18 | \* Moved remaining initialization functions to class constructor. |
  |  | 19 | \* Moved wpmem\_load\_shortcodes, wpmem\_load\_hooks, and wpmem\_load\_dropins to fire before. |
  |  | 20 | \* reCAPTCHA version 1 is no longer supported by Google. It is now deprecated in the plugin. If you have reCAPTCHA v1 selected, it will remain so. But once this is changed to a different CAPTCHA setting or if this is a new install, reCAPTCHA version 1 will no longer be available as a selection. |
  |  | 21 | \* Custom field term "Option Name" changed to "Meta Key" for clarity. |
  |  | 22 | \* Marked required custom field properties as required in Add/Edit Field dialogs. |
  |  | 23 | \* Changed redirect\_to process to escape the url with esc\_url\_raw rather than esc\_url, otherwise query string variables do not get handled correctly. |
  |  | 24 | \* Fixes issue with displaying checkbox state on the admin user profile screen. |
  |  | 25 | \* Fixes issue with auto excerpt when excerpts are displayed on single posts/pages. |
  |  | 26 | \* Applies style properties for the remember me checkbox label to the default stylesheets. The label tag was added to this text in 3.1.6 (see below). |
  |  | 27 | \* Applies some admin strings for translation. |
  |  | 28 |  |
  |  | 29 | = 3.1.5 = |
  | 2 | 30 |  |
  | 3 | 31 | \* Addressed some security issues to prevent XSS vulnerabilities. |
* ## [wp-members/trunk/css/generic-no-float.css](/changeset/1667369/wp-members/trunk/css/generic-no-float.css "Show the changeset 1667369 restricted to wp-members/trunk/css/generic-no-float.css")

  | [r1628757](/browser/wp-members/trunk/css/generic-no-float.css?rev=1628757#L98 "Show revision 1628757 of this file in browser") | [r1667369](/browser/wp-members/trunk/css/generic-no-float.css?rev=1667369#L98 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 98 | 98 | #wpmem\_reg input[type="email"], |
  | 99 | 99 | #wpmem\_reg input[type="url"], |
  |  | 100 | #wpmem\_reg input[type="number"], |
  |  | 101 | #wpmem\_reg input[type="date"], |
  | 100 | 102 | #wpmem\_reg textarea, |
  | 101 | 103 | #wpmem\_login input[type="text"], |
  | […](/browser/wp-members/trunk/css/generic-no-float.css?rev=1628757#L149) | […](/browser/wp-members/trunk/css/generic-no-float.css?rev=1667369#L151) |  |
  | 149 | 151 | font-weight: 700; |
  | 150 | 152 | margin-bottom: 10px; |
  |  | 153 | width: 100%; |
  | 151 | 154 | } |
  | 152 | 155 | #wpmem\_reg .form, |
  | […](/browser/wp-members/trunk/css/generic-no-float.css?rev=1628757#L174) | […](/browser/wp-members/trunk/css/generic-no-float.css?rev=1667369#L177) |  |
  | 174 | 177 | #wpmem\_reg .div\_image, |
  | 175 | 178 | #wpmem\_reg .div\_file, |
  | 176 |  | #wpmem\_reg .div\_url { |
  |  | 179 | #wpmem\_reg .div\_url, |
  |  | 180 | #wpmem\_reg .div\_number, |
  |  | 181 | #wpmem\_reg .div\_date { |
  | 177 | 182 | width:74%; |
  | 178 | 183 | margin:0 0 14px 0; |
* ## [wp-members/trunk/css/wp-members-2014-no-float.css](/changeset/1667369/wp-members/trunk/css/wp-members-2014-no-float.css "Show the changeset 1667369 restricted to wp-members/trunk/css/wp-members-2014-no-float.css")

  | [r1531322](/browser/wp-members/trunk/css/wp-members-2014-no-float.css?rev=1531322#L116 "Show revision 1531322 of this file in browser") | [r1667369](/browser/wp-members/trunk/css/wp-members-2014-no-float.css?rev=1667369#L116 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 116 | 116 | #wpmem\_reg .div\_image, |
  | 117 | 117 | #wpmem\_reg .div\_file, |
  | 118 |  | #wpmem\_reg .div\_url{ |
  |  | 118 | #wpmem\_reg .div\_url, |
  |  | 119 | #wpmem\_reg .div\_number, |
  |  | 120 | #wpmem\_reg .div\_date { |
  | 119 | 121 | width:74%; |
  | 120 | 122 | margin:0 0 14px 0; |
* ## [wp-members/trunk/css/wp-members-2015-no-float.css](/changeset/1667369/wp-members/trunk/css/wp-members-2015-no-float.css "Show the changeset 1667369 restricted to wp-members/trunk/css/wp-members-2015-no-float.css")

  | [r1548526](/browser/wp-members/trunk/css/wp-members-2015-no-float.css?rev=1548526#L147 "Show revision 1548526 of this file in browser") | [r1667369](/browser/wp-members/trunk/css/wp-members-2015-no-float.css?rev=1667369#L147 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 147 | 147 | #wpmem\_reg .div\_url, |
  | 148 | 148 | #wpmem\_reg .div\_image, |
  | 149 |  | #wpmem\_reg .div\_file { |
  |  | 149 | #wpmem\_reg .div\_file, |
  |  | 150 | #wpmem\_reg .div\_number, |
  |  | 151 | #wpmem\_reg .div\_date { |
  | 150 | 152 | width:74%; |
  | 151 | 153 | margin:0 0 14px 0; |
* ## [wp-members/trunk/css/wp-members-2016-no-float.css](/changeset/1667369/wp-members/trunk/css/wp-members-2016-no-float.css "Show the changeset 1667369 restricted to wp-members/trunk/css/wp-members-2016-no-float.css")

  | [r1548526](/browser/wp-members/trunk/css/wp-members-2016-no-float.css?rev=1548526#L155 "Show revision 1548526 of this file in browser") | [r1667369](/browser/wp-members/trunk/css/wp-members-2016-no-float.css?rev=1667369#L155 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 155 | 155 | #wpmem\_reg .div\_url, |
  | 156 | 156 | #wpmem\_reg .div\_file, |
  | 157 |  | #wpmem\_reg .div\_image { |
  |  | 157 | #wpmem\_reg .div\_image, |
  |  | 158 | #wpmem\_reg .div\_number, |
  |  | 159 | #wpmem\_reg .div\_date { |
  | 158 | 160 | width:74%; |
  | 159 | 161 | margin:0 0 14px 0; |
* ## [wp-members/trunk/inc/api.php](/changeset/1667369/wp-members/trunk/inc/api.php "Show the changeset 1667369 restricted to wp-members/trunk/inc/api.php")

  | [r1628757](/browser/wp-members/trunk/inc/api.php?rev=1628757#L289 "Show revision 1628757 of this file in browser") | [r1667369](/browser/wp-members/trunk/inc/api.php?rev=1667369#L289 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 289 | 289 | \* |
  | 290 | 290 | \* @global object        $current\_user Current user object. |
  |  | 291 | \* @global object        $wpmem        WP\_Members object. |
  | 291 | 292 | \* @param  string|array  $role         Slug or array of slugs of the role being checked. |
  | 292 | 293 | \* @param  int           $user\_id      ID of the user being checked (optional). |
  | […](/browser/wp-members/trunk/inc/api.php?rev=1628757#L311) | […](/browser/wp-members/trunk/inc/api.php?rev=1667369#L312) |  |
  | 311 | 312 | return ( in\_array( $role, $user->roles ) ) ? true : $has\_role; |
  | 312 | 313 | } |
  |  | 314 | } |
  |  | 315 |  |
  |  | 316 | /\*\* |
  |  | 317 | \* Checks if a user has a given meta value. |
  |  | 318 | \* |
  |  | 319 | \* @since 3.1.8 |
  |  | 320 | \* |
  |  | 321 | \* @global object  $wpmem     WP\_Members object. |
  |  | 322 | \* @param  string  $meta      Meta key being checked. |
  |  | 323 | \* @param  string  $value     Value the meta key should have (optional). |
  |  | 324 | \* @param  int     $user\_id   ID of the user being checked (optional). |
  |  | 325 | \* @return boolean $has\_meta  True if user has the meta value, otherwise false. |
  |  | 326 | \*/ |
  |  | 327 | function wpmem\_user\_has\_meta( $meta, $value = false, $user\_id = false ) { |
  |  | 328 | global $wpmem; |
  |  | 329 | $user\_id = ( $user\_id ) ? $user\_id : get\_current\_user\_id(); |
  |  | 330 | $has\_meta = false; |
  |  | 331 | $user\_value = get\_user\_meta( $user\_id, $meta, true ); |
  |  | 332 | if ( $value ) { |
  |  | 333 | $has\_meta = ( $user\_value == $value ) ? true : $has\_meta; |
  |  | 334 | } else { |
  |  | 335 | $has\_meta = ( $value ) ? true : $has\_meta; |
  |  | 336 | } |
  |  | 337 | return $has\_meta; |
  | 313 | 338 | } |
  | 314 | 339 |  |
* ## [wp-members/trunk/inc/class-wp-members-api.php](/changeset/1667369/wp-members/trunk/inc/class-wp-members-api.php "Show the changeset 1667369 restricted to wp-members/trunk/inc/class-wp-members-api.php")

  | [r1628757](/browser/wp-members/trunk/inc/class-wp-members-api.php?rev=1628757#L62 "Show revision 1628757 of this file in browser") | [r1667369](/browser/wp-members/trunk/inc/class-wp-members-api.php?rev=1667369#L62 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 62 | 62 | } |
  | 63 | 63 | return $display\_values; |
  |  | 64 | } |
  |  | 65 |  |
  |  | 66 | /\*\* |
  |  | 67 | \* Gets the display/label value of a field. |
  |  | 68 | \* |
  |  | 69 | \* @since 3.1.8 |
  |  | 70 | \* |
  |  | 71 | \* @param  string $meta    The field meta key. |
  |  | 72 | \* @param  string $user\_id The user's ID. |
  |  | 73 | \* @param  string $value   The field's value, if given. |
  |  | 74 | \* @return string $value   The display value. |
  |  | 75 | \*/ |
  |  | 76 | function get\_field\_display\_value( $meta, $user\_id, $value = null ) { |
  |  | 77 | global $wpmem; |
  |  | 78 | $fields = ( isset( $wpmem->fields ) ) ? $wpmem->fields : wpmem\_fields(); |
  |  | 79 | $field  = $fields[ $meta ]; |
  |  | 80 | $value  = ( $value ) ? $value : get\_user\_meta( $user\_id, $meta, true ); |
  |  | 81 | switch ( $field['type'] ) { |
  |  | 82 | case 'multiselect': |
  |  | 83 | case 'multicheckbox': |
  |  | 84 | break; |
  |  | 85 | case 'select': |
  |  | 86 | case 'radio': |
  |  | 87 | $value = $fields[ $meta ]['options'][ $value ]; |
  |  | 88 | break; |
  |  | 89 | case 'image': |
  |  | 90 | case 'file': |
  |  | 91 | $value = wp\_get\_attachment\_url( $value ); |
  |  | 92 | break; |
  |  | 93 | } |
  |  | 94 | return $value; |
  | 64 | 95 | } |
  | 65 | 96 |  |
* ## [wp-members/trunk/inc/class-wp-members-forms.php](/changeset/1667369/wp-members/trunk/inc/class-wp-members-forms.php "Show the changeset 1667369 restricted to wp-members/trunk/inc/class-wp-members-forms.php")

  | [r1628774](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1628774#L67 "Show revision 1628774 of this file in browser") | [r1667369](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1667369#L67 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 67 | 67 | case "email": |
  | 68 | 68 | case "number": |
  |  | 69 | case "date": |
  | 69 | 70 | $class = ( 'textbox' == $class ) ? "textbox" : $class; |
  | 70 | 71 | switch ( $type ) { |
  | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1628774#L75) | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1667369#L76) |  |
  | 75 | 76 | $value = esc\_attr( wp\_unslash( $value ) ); |
  | 76 | 77 | break; |
  | 77 |  | case 'number': |
  | 78 |  | ~~$value = $value~~; |
  |  | 78 | //case 'number': |
  |  | 79 | //$value = esc\_attr( $value ); |
  | 79 | 80 | default: |
  | 80 | 81 | $value = stripslashes( esc\_attr( $value ) ); |
  | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1628774#L85) | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1667369#L86) |  |
  | 85 | 86 | $pattern     = ( $pattern     ) ? ' pattern="' . $pattern . '"' : ''; |
  | 86 | 87 | $title       = ( $title       ) ? ' title="' . $title . '"' : ''; |
  | 87 |  | $min         = ( isset( $args['min'] ) ) ? ' min="' . $args['min'] . '"' : ''; |
  | 88 |  | $max         = ( isset( $args['max'] ) ) ? ' max="' . $args['max'] . '"' : ''; |
  |  | 88 | $min         = ( isset( $args['min'] ) && $args['min'] != '' ) ? ' min="' . $args['min'] . '"' : ''; |
  |  | 89 | $max         = ( isset( $args['max'] ) && $args['max'] != '' ) ? ' max="' . $args['max'] . '"' : ''; |
  | 89 | 90 | $str = "<input name=\"$name\" type=\"$type\" id=\"$name\" value=\"$value\" class=\"$class\"$placeholder$title$pattern$min$max" . ( ( $required ) ? " required " : "" ) . " />"; |
  | 90 | 91 | break; |
  | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1628774#L107) | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1667369#L108) |  |
  | 107 | 108 |  |
  | 108 | 109 | case "textarea": |
  | 109 |  | $value = stripslashes( esc\_textarea( $value ) ); |
  |  | 110 | $value = stripslashes( $value ); // stripslashes( esc\_textarea( $value ) ); |
  | 110 | 111 | $class = ( 'textbox' == $class ) ? "textarea" : $class; |
  | 111 | 112 | $rows  = ( isset( $args['rows'] ) ) ? $args['rows'] : '5'; |
  | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1628774#L314) | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1667369#L315) |  |
  | 314 | 315 |  |
  | 315 | 316 | /\*\* |
  | 316 |  | \* Login Form ~~Dialog~~. |
  |  | 317 | \* Login Form Builder. |
  | 317 | 318 | \* |
  | 318 | 319 | \* Builds the form used for login, change password, and reset password. |
  | 319 | 320 | \* |
  | 320 | 321 | \* @since 2.5.1 |
  |  | 322 | \* @since 3.1.7 Moved to forms object class as login\_form(). |
  | 321 | 323 | \* @since 3.1.7 Added WP action login\_form. |
  | 322 | 324 | \* |
  | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1628774#L486) | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1667369#L488) |  |
  | 486 | 488 | $links\_array = array( |
  | 487 | 489 | 'forgot' => array( |
  |  | 490 | 'tag'  => 'forgot', |
  | 488 | 491 | 'link' => add\_query\_arg( 'a', 'pwdreset', $wpmem->user\_pages['profile'] ), |
  | 489 | 492 | 'page' => 'profile', |
  | 490 | 493 | 'action' => 'login', |
  | 491 | 494 | ), |
  | 492 |  | 'register' => array( |
  |  | 495 | 'register' => array( |
  |  | 496 | 'tag'  => 'reg', |
  | 493 | 497 | 'link' => $wpmem->user\_pages['register'], |
  | 494 | 498 | 'page' => 'register', |
  | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1628774#L496) | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1667369#L500) |  |
  | 496 | 500 | ), |
  | 497 | 501 | 'username' => array( |
  |  | 502 | 'tag'  => 'username', |
  | 498 | 503 | 'link' => add\_query\_arg( 'a', 'getusername', $wpmem->user\_pages['profile'] ), |
  | 499 | 504 | 'page' => 'profile', |
  | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1628774#L502) | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1667369#L507) |  |
  | 502 | 507 | ); |
  | 503 | 508 | foreach ( $links\_array as $key => $value ) { |
  |  | 509 | $tag = $value['tag']; |
  | 504 | 510 | if ( ( $wpmem->user\_pages[ $value['page'] ] || 'members' == $page ) && $value['action'] == $arr['action'] ) { |
  | 505 | 511 | /\*\* |
  | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1628774#L511) | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1667369#L517) |  |
  | 511 | 517 | \* @param string The raw link. |
  | 512 | 518 | \*/ |
  | 513 |  | $link = apply\_filters( "wpmem\_{$~~key~~}\_link", $value['link'] ); |
  |  | 519 | $link = apply\_filters( "wpmem\_{$tag}\_link", $value['link'] ); |
  | 514 | 520 | $str  = $wpmem->get\_text( "{$key}\_link\_before" ) . '<a href="' . $link . '">' . $wpmem->get\_text( "{$key}\_link" ) . '</a>'; |
  | 515 | 521 | /\*\* |
  | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1628774#L523) | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1667369#L529) |  |
  | 523 | 529 | \* @param string $link The link. |
  | 524 | 530 | \*/ |
  | 525 |  | $form = $form . $args['link\_before'] . apply\_filters( "wpmem\_{$key}\_link\_str", $str, $link ) . $args['link\_after'] . $args['n']; |
  |  | 531 | $link = $args['link\_before'] . apply\_filters( "wpmem\_{$tag}\_link\_str", $str, $link ) . $args['link\_after'] . $args['n']; |
  |  | 532 | /\* |
  |  | 533 | \* If this is the register link, and the current post type is set to |
  |  | 534 | \* display the register form, and the current page is not the login |
  |  | 535 | \* page, then do not add the register link, otherwise add the link. |
  |  | 536 | \*/ |
  |  | 537 | $form = ( 'register' == $key && 1 == $wpmem->show\_reg[ get\_post\_type( get\_the\_ID() ) ] && wpmem\_current\_url() != wpmem\_login\_url() ) ? $form : $form . $link; |
  |  | 538 | //$form = ( 'register' == $key && isset( $wpmem->user\_pages['profile'] ) && ( wpmem\_current\_url() == $wpmem->user\_pages['profile'] ) && 1 == $wpmem->show\_reg[ get\_post\_type( get\_the\_ID() ) ] ) ? $form : $form . $link; |
  | 526 | 539 | } |
  | 527 | 540 | } |
  | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1628774#L572) | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1667369#L585) |  |
  | 572 | 585 |  |
  | 573 | 586 | return $form; |
  | 574 |  | } // End ~~wpmem\_~~login\_form. |
  |  | 587 | } // End login\_form. |
  | 575 | 588 |  |
  | 576 | 589 | /\*\* |
  | 577 |  | \* Registration Form ~~Dialog~~. |
  |  | 590 | \* Registration Form Builder. |
  | 578 | 591 | \* |
  | 579 | 592 | \* Outputs the form for new user registration and existing user edits. |
  | 580 | 593 | \* |
  | 581 | 594 | \* @since 2.5.1 |
  |  | 595 | \* @since 3.1.7 Moved to forms object class as register\_form(). |
  | 582 | 596 | \* |
  | 583 | 597 | \* @global object $wpmem        The WP\_Members object. |
  | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1628774#L746) | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1667369#L760) |  |
  | 746 | 760 |  |
  | 747 | 761 | $class = ( $field['type'] == 'password' || $field['type'] == 'email' || $field['type'] == 'url' ) ? 'text' : $field['type']; |
  | 748 |  |  |
  | 749 |  | ~~//  $label = '<label for="' . $meta\_key . '" class="' . $class . '">' . \_\_( $field['label'], 'wp-members' );~~ |
  | 750 |  | ~~//  $label = ( $field['required'] ) ? $label . $args['req\_mark'] : $label;~~ |
  | 751 |  | ~~//  $label = $label . '</label>';~~ |
  | 752 | 762 |  |
  | 753 | 763 | $label = wpmem\_form\_label( array( |
  | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1628774#L767) | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1667369#L777) |  |
  | 767 | 777 | switch ( $meta\_key ) { |
  | 768 | 778 | case( 'description' ): |
  | 769 |  | $val = htmlspecialchars( get\_user\_meta( $userdata->ID, 'description', 'true' ) ); |
  |  | 779 | case( 'textarea' == $field['type'] ): |
  |  | 780 | $val = get\_user\_meta( $userdata->ID, 'description', 'true' ); // esc\_textarea() is run when field is created. |
  | 770 | 781 | break; |
  | 771 | 782 |  |
  | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1628774#L776) | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1667369#L787) |  |
  | 776 | 787 |  |
  | 777 | 788 | case 'user\_url': |
  | 778 |  | $val = ~~esc\_url( $userdata->user\_url );~~ |
  |  | 789 | $val = $userdata->user\_url; // esc\_url() is run when the field is created. |
  | 779 | 790 | break; |
  | 780 | 791 |  |
  | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1628774#L861) | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1667369#L872) |  |
  | 861 | 872 | $input = ( $attachment\_url ) ? '<img src="' . $attachment\_url . '">' : $empty\_file; |
  | 862 | 873 | } |
  | 863 |  | ~~// @todo - come up with a way to handle file updates - user profile form does not support multitype~~ |
  | 864 | 874 | $input.= '<br />' . $wpmem->get\_text( 'profile\_upload' ) . '<br />'; |
  | 865 | 875 | $input.= wpmem\_form\_field( array( |
  | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1628774#L1091) | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1667369#L1101) |  |
  | 1091 | 1101 |  |
  | 1092 | 1102 | // Remove line breaks if enabled for easier filtering later. |
  | 1093 |  | $form = ( $args['strip\_breaks'] ) ? str\_replace( array( "\n", "\r", "\t" ), array( '','','' ), $form ) : $form; |
  |  | 1103 | $form = ( $args['strip\_breaks'] ) ? $this->strip\_breaks( $form, $rows ) : $form; //str\_replace( array( "\n", "\r", "\t" ), array( '','','' ), $form ) : $form; |
  | 1094 | 1104 |  |
  | 1095 | 1105 | /\*\* |
  | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1628774#L1135) | […](/browser/wp-members/trunk/inc/class-wp-members-forms.php?rev=1667369#L1145) |  |
  | 1135 | 1145 | // Return the generated form. |
  | 1136 | 1146 | return $form; |
  | 1137 |  | } // End wpmem\_inc\_registration. |
  |  | 1147 | } // End register\_form(). |
  |  | 1148 |  |
  |  | 1149 | /\*\* |
  |  | 1150 | \* Strip line breaks from form. |
  |  | 1151 | \* |
  |  | 1152 | \* Function removes line breaks and tabs. Checks for textarea fields |
  |  | 1153 | \* before stripping line breaks. |
  |  | 1154 | \* |
  |  | 1155 | \* @since 3.1.8 |
  |  | 1156 | \* |
  |  | 1157 | \* @param  string $form |
  |  | 1158 | \* @param  array  $rows |
  |  | 1159 | \* @return string $form |
  |  | 1160 | \*/ |
  |  | 1161 | function strip\_breaks( $form, $rows ) { |
  |  | 1162 | foreach( $rows as $key => $row ) { |
  |  | 1163 | if ( 'textarea' == $row['type'] ) { |
  |  | 1164 | $textareas[ $key ] = $row['field']; |
  |  | 1165 | } |
  |  | 1166 | } |
  |  | 1167 | $form = str\_replace( array( "\n", "\r", "\t" ), array( '','','' ), $form ); |
  |  | 1168 | if ( ! empty ( $textareas ) ) { |
  |  | 1169 | foreach ( $textareas as $textarea ) { |
  |  | 1170 | $stripped = str\_replace( array( "\n", "\r", "\t" ), array( '','','' ), $textarea ); |
  |  | 1171 | $form = str\_replace( $stripped, $textarea, $form ); |
  |  | 1172 | } |
  |  | 1173 | } |
  |  | 1174 | return $form; |
  |  | 1175 | } |
  | 1138 | 1176 |  |
  | 1139 | 1177 | } // End of WP\_Members\_Forms class. |
* ## [wp-members/trunk/inc/class-wp-members-user.php](/changeset/1667369/wp-members/trunk/inc/class-wp-members-user.php "Show the changeset 1667369 restricted to wp-members/trunk/inc/class-wp-members-user.php")

  | [r1628757](/browser/wp-members/trunk/inc/class-wp-members-user.php?rev=1628757#L157 "Show revision 1628757 of this file in browser") | [r1667369](/browser/wp-members/trunk/inc/class-wp-members-user.php?rev=1667369#L157 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 157 | 157 | // Handle file uploads, if any. |
  | 158 | 158 | if ( ! empty( $\_FILES ) ) { |
  | 159 |  |  |
  | 160 |  | foreach ( $wpmem->fields as $meta\_key => $field ) { |
  | 161 |  |  |
  | 162 |  | if ( ( 'file' == $field['type'] || 'image' == $field['type'] ) && is\_array( $\_FILES[ $meta\_key ] ) ) { |
  | 163 |  |  |
  | 164 |  | // Upload the file and save it as an attachment. |
  | 165 |  | $file\_post\_id = $wpmem->forms->do\_file\_upload( $\_FILES[ $meta\_key ], $user\_id ); |
  | 166 |  |  |
  | 167 |  | // Save the attachment ID as user meta. |
  | 168 |  | update\_user\_meta( $user\_id, $meta\_key, $file\_post\_id ); |
  | 169 |  | } |
  | 170 |  | } |
  |  | 159 | $this->upload\_user\_files( $user\_id, $wpmem->fields ); |
  | 171 | 160 | } |
  | 172 | 161 |  |
  | […](/browser/wp-members/trunk/inc/class-wp-members-user.php?rev=1628757#L333) | […](/browser/wp-members/trunk/inc/class-wp-members-user.php?rev=1667369#L322) |  |
  | 333 | 322 | } |
  | 334 | 323 |  |
  |  | 324 | /\*\* |
  |  | 325 | \* Handles retrieving a forgotten username. |
  |  | 326 | \* |
  |  | 327 | \* @since 3.0.8 |
  |  | 328 | \* @since 3.1.6 Dependencies now loaded by object. |
  |  | 329 | \* @since 3.1.8 Moved to user object. |
  |  | 330 | \* |
  |  | 331 | \* @return string $regchk The regchk value. |
  |  | 332 | \*/ |
  |  | 333 | function retrieve\_username() { |
  |  | 334 | if ( isset( $\_POST['formsubmit'] ) ) { |
  |  | 335 | $email = sanitize\_email( $\_POST['user\_email'] ); |
  |  | 336 | $user  = ( isset( $\_POST['user\_email'] ) ) ? get\_user\_by( 'email', $email ) : false; |
  |  | 337 | if ( $user ) { |
  |  | 338 | // Send it in an email. |
  |  | 339 | wpmem\_inc\_regemail( $user->ID, '', 4 ); |
  |  | 340 | /\*\* |
  |  | 341 | \* Fires after retrieving username. |
  |  | 342 | \* |
  |  | 343 | \* @since 3.0.8 |
  |  | 344 | \* |
  |  | 345 | \* @param int $user\_ID The user's numeric ID. |
  |  | 346 | \*/ |
  |  | 347 | do\_action( 'wpmem\_get\_username', $user->ID ); |
  |  | 348 | return 'usernamesuccess'; |
  |  | 349 | } else { |
  |  | 350 | return 'usernamefailed'; |
  |  | 351 | } |
  |  | 352 | } |
  |  | 353 | return; |
  |  | 354 | } |
  |  | 355 |  |
  |  | 356 | /\*\* |
  |  | 357 | \* Handle user file uploads for registration and profile update. |
  |  | 358 | \* |
  |  | 359 | \* @since 3.1.8 |
  |  | 360 | \* |
  |  | 361 | \* @param string $user\_id |
  |  | 362 | \* @param array  $fields |
  |  | 363 | \*/ |
  |  | 364 | function upload\_user\_files( $user\_id, $fields ) { |
  |  | 365 | global $wpmem; |
  |  | 366 | foreach ( $fields as $meta\_key => $field ) { |
  |  | 367 | if ( ( 'file' == $field['type'] || 'image' == $field['type'] ) && is\_array( $\_FILES[ $meta\_key ] ) ) { |
  |  | 368 | if ( ! empty( $\_FILES[ $meta\_key ]['name'] ) ) { |
  |  | 369 | // Upload the file and save it as an attachment. |
  |  | 370 | $file\_post\_id = $wpmem->forms->do\_file\_upload( $\_FILES[ $meta\_key ], $user\_id ); |
  |  | 371 | // Save the attachment ID as user meta. |
  |  | 372 | update\_user\_meta( $user\_id, $meta\_key, $file\_post\_id ); |
  |  | 373 | } |
  |  | 374 | } |
  |  | 375 | } |
  |  | 376 | } |
  |  | 377 |  |
  | 335 | 378 | } |
* ## [wp-members/trunk/inc/class-wp-members.php](/changeset/1667369/wp-members/trunk/inc/class-wp-members.php "Show the changeset 1667369 restricted to wp-members/trunk/inc/class-wp-members.php")

  | [r1628757](/browser/wp-members/trunk/inc/class-wp-members.php?rev=1628757#L312 "Show revision 1628757 of this file in browser") | [r1667369](/browser/wp-members/trunk/inc/class-wp-members.php?rev=1667369#L312 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 312 | 312 |  |
  | 313 | 313 | // Add filters. |
  | 314 |  | add\_filter( 'the\_content',           array( $this, 'do\_securify' ), 99 ); |
  | 315 |  | add\_filter( 'allow\_password\_reset',  'wpmem\_no\_reset' );                 // no password reset for non-activated users |
  | 316 |  | add\_filter( 'register\_form',         'wpmem\_wp\_register\_form' );         // adds fields to the default wp registration |
  | 317 |  | add\_filter( 'registration\_errors',   'wpmem\_wp\_reg\_validate', 10, 3 );   // native registration validation |
  | 318 |  | add\_filter( 'comments\_open',         'wpmem\_securify\_comments', 99 );    // securifies the comments |
  | 319 |  | add\_filter( 'wpmem\_securify',        'wpmem\_reg\_securify' );             // adds success message on login form if redirected |
  |  | 314 | add\_filter( 'the\_content',               array( $this, 'do\_securify' ), 99 ); |
  |  | 315 | add\_filter( 'allow\_password\_reset',      'wpmem\_no\_reset' );                 // no password reset for non-activated users |
  |  | 316 | add\_filter( 'register\_form',             'wpmem\_wp\_register\_form' );         // adds fields to the default wp registration |
  |  | 317 | add\_action( 'woocommerce\_register\_form', 'wpmem\_woo\_register\_form' ); |
  |  | 318 | add\_filter( 'registration\_errors',       'wpmem\_wp\_reg\_validate', 10, 3 );   // native registration validation |
  |  | 319 | add\_filter( 'comments\_open',             'wpmem\_securify\_comments', 99 );    // securifies the comments |
  |  | 320 | add\_filter( 'wpmem\_securify',            'wpmem\_reg\_securify' );             // adds success message on login form if redirected |
  | 320 | 321 |  |
  | 321 | 322 | // If registration is moderated, check for activation (blocks backend login by non-activated users). |
  | […](/browser/wp-members/trunk/inc/class-wp-members.php?rev=1628757#L426) | […](/browser/wp-members/trunk/inc/class-wp-members.php?rev=1667369#L427) |  |
  | 426 | 427 | require\_once( WPMEM\_PATH . 'inc/api.php' ); |
  | 427 | 428 | require\_once( WPMEM\_PATH . 'inc/utilities.php' ); |
  |  | 429 | require\_once( WPMEM\_PATH . 'inc/forms.php' ); |
  | 428 | 430 | require\_once( WPMEM\_PATH . 'inc/dialogs.php' ); |
  | 429 | 431 | require\_once( WPMEM\_PATH . 'inc/sidebar.php' ); |
  | 430 | 432 | require\_once( WPMEM\_PATH . 'inc/shortcodes.php' ); |
  | 431 | 433 | require\_once( WPMEM\_PATH . 'inc/email.php' ); |
  |  | 434 | require\_once( WPMEM\_PATH . 'inc/users.php' ); |
  | 432 | 435 | require\_once( WPMEM\_PATH . 'inc/deprecated.php' ); |
  | 433 | 436 | } |
  | […](/browser/wp-members/trunk/inc/class-wp-members.php?rev=1628757#L511) | […](/browser/wp-members/trunk/inc/class-wp-members.php?rev=1667369#L514) |  |
  | 511 | 514 |  |
  | 512 | 515 | case 'login': |
  | 513 |  | $regchk = ~~wpmem\_~~login(); |
  |  | 516 | $regchk = $this->user->login(); |
  | 514 | 517 | break; |
  | 515 | 518 |  |
  | 516 | 519 | case 'logout': |
  | 517 |  | $regchk = ~~wpmem\_~~logout(); |
  |  | 520 | $regchk = $this->user->logout(); |
  | 518 | 521 | break; |
  | 519 | 522 |  |
  | 520 | 523 | case 'pwdchange': |
  | 521 |  | $regchk = ~~wpmem\_change\_password(~~); |
  |  | 524 | $regchk = $this->user->password\_update( 'change' ); |
  | 522 | 525 | break; |
  | 523 | 526 |  |
  | 524 | 527 | case 'pwdreset': |
  | 525 |  | $regchk = ~~wpmem\_reset\_password(~~); |
  |  | 528 | $regchk = $this->user->password\_update( 'reset' ); |
  | 526 | 529 | break; |
  | 527 | 530 |  |
  | 528 | 531 | case 'getusername': |
  | 529 |  | $regchk = ~~wpmem\_~~retrieve\_username(); |
  |  | 532 | $regchk = $this->user->retrieve\_username(); |
  | 530 | 533 | break; |
  | 531 | 534 |  |
* ## [wp-members/trunk/inc/core.php](/changeset/1667369/wp-members/trunk/inc/core.php "Show the changeset 1667369 restricted to wp-members/trunk/inc/core.php")

  | [r1628757](/browser/wp-members/trunk/inc/core.php?rev=1628757#L214 "Show revision 1628757 of this file in browser") | [r1667369](/browser/wp-members/trunk/inc/core.php?rev=1667369#L214 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 214 | 214 | \* |
  | 215 | 215 | \* @since 2.8.3 |
  | 216 |  | \*/ |
  | 217 |  | function wpmem\_wp\_register\_form() { |
  |  | 216 | \* @since 3.1.8 Added $process argument. |
  |  | 217 | \*/ |
  |  | 218 | function wpmem\_wp\_register\_form( $process = 'wp' ) { |
  | 218 | 219 | /\*\* |
  | 219 | 220 | \* Load native WP registration functions. |
  | 220 | 221 | \*/ |
  | 221 | 222 | require\_once( WPMEM\_PATH . 'inc/wp-registration.php' ); |
  | 222 |  | wpmem\_do\_wp\_register\_form(); |
  |  | 223 | wpmem\_do\_wp\_register\_form( $process ); |
  | 223 | 224 | } |
  | 224 | 225 |  |
  | […](/browser/wp-members/trunk/inc/core.php?rev=1628757#L373) | […](/browser/wp-members/trunk/inc/core.php?rev=1667369#L374) |  |
  | 373 | 374 | \* @since 3.0.8 |
  | 374 | 375 | \* @since 3.1.6 Dependencies now loaded by object. |
  |  | 376 | \* @since 3.1.8 Now a wrapper for $wpmem->retrieve\_username() in WP\_Members\_Users Class. |
  |  | 377 | \* |
  |  | 378 | \* @global object $wpmem The WP-Members object class. |
  | 375 | 379 | \* |
  | 376 | 380 | \* @return string $regchk The regchk value. |
  | 377 | 381 | \*/ |
  | 378 | 382 | function wpmem\_retrieve\_username() { |
  | 379 |  |  |
  | 380 |  | if ( isset( $\_POST['formsubmit'] ) ) { |
  | 381 |  |  |
  | 382 |  | $email = sanitize\_email( $\_POST['user\_email'] ); |
  | 383 |  | $user  = ( isset( $\_POST['user\_email'] ) ) ? get\_user\_by( 'email', $email ) : false; |
  | 384 |  |  |
  | 385 |  | if ( $user ) { |
  | 386 |  |  |
  | 387 |  | // Send it in an email. |
  | 388 |  | wpmem\_inc\_regemail( $user->ID, '', 4 ); |
  | 389 |  |  |
  | 390 |  | /\*\* |
  | 391 |  | \* Fires after retrieving username. |
  | 392 |  | \* |
  | 393 |  | \* @since 3.0.8 |
  | 394 |  | \* |
  | 395 |  | \* @param int $user\_ID The user's numeric ID. |
  | 396 |  | \*/ |
  | 397 |  | do\_action( 'wpmem\_get\_username', $user->ID ); |
  | 398 |  |  |
  | 399 |  | return 'usernamesuccess'; |
  | 400 |  |  |
  | 401 |  | } else { |
  | 402 |  | return 'usernamefailed'; |
  | 403 |  | } |
  | 404 |  | } |
  | 405 |  | return; |
  |  | 383 | global $wpmem; |
  |  | 384 | return $wpmem->user->retrieve\_username(); |
  | 406 | 385 | } |
  | 407 | 386 |  |
* ## [wp-members/trunk/inc/deprecated.php](/changeset/1667369/wp-members/trunk/inc/deprecated.php "Show the changeset 1667369 restricted to wp-members/trunk/inc/deprecated.php")

  | [r1628757](/browser/wp-members/trunk/inc/deprecated.php?rev=1628757#L187 "Show revision 1628757 of this file in browser") | [r1667369](/browser/wp-members/trunk/inc/deprecated.php?rev=1667369#L187 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 187 | 187 | } |
  | 188 | 188 | endif; |
  |  | 189 |  |
  |  | 190 |  |
  |  | 191 | if ( ! function\_exists( 'wpmem\_do\_sc\_pages' ) ): |
  |  | 192 | /\*\* |
  |  | 193 | \* Builds the shortcode pages (login, register, user-profile, user-edit, password). |
  |  | 194 | \* |
  |  | 195 | \* Some of the logic here is similar to the wpmem\_securify() function. |
  |  | 196 | \* But where that function handles general content, this function |
  |  | 197 | \* handles building specific pages generated by shortcodes. |
  |  | 198 | \* |
  |  | 199 | \* @since 2.6.0 |
  |  | 200 | \* @deprecated 3.1.8 Use wpmem\_sc\_user\_profile() or wpmem\_sc\_forms() instead. |
  |  | 201 | \* |
  |  | 202 | \* @global object $wpmem        The WP\_Members object. |
  |  | 203 | \* @global string $wpmem\_themsg The WP-Members message container. |
  |  | 204 | \* @global object $post         The WordPress post object. |
  |  | 205 | \* |
  |  | 206 | \* @param  string $atts { |
  |  | 207 | \*     The shortcode attributes. |
  |  | 208 | \* |
  |  | 209 | \*     @type string $page |
  |  | 210 | \*     @type string $redirect\_to |
  |  | 211 | \*     @type string $register |
  |  | 212 | \* } |
  |  | 213 | \* @param  string $content |
  |  | 214 | \* @param  string $tag |
  |  | 215 | \* @return string $content |
  |  | 216 | \*/ |
  |  | 217 | function wpmem\_do\_sc\_pages( $atts, $content, $tag ) { |
  |  | 218 |  |
  |  | 219 | $page = ( isset( $atts['page'] ) ) ? $atts['page'] : $tag; |
  |  | 220 | $redirect\_to = ( isset( $atts['redirect\_to'] ) ) ? $atts['redirect\_to'] : null; |
  |  | 221 | $hide\_register = ( isset( $atts['register'] ) && 'hide' == $atts['register'] ) ? true : false; |
  |  | 222 |  |
  |  | 223 | global $wpmem, $wpmem\_themsg, $post; |
  |  | 224 | include\_once( WPMEM\_PATH . 'inc/dialogs.php' ); |
  |  | 225 |  |
  |  | 226 | $content = ''; |
  |  | 227 |  |
  |  | 228 | // Deprecating members-area parameter to be replaced by user-profile. |
  |  | 229 | $page = ( $page == 'user-profile' ) ? 'members-area' : $page; |
  |  | 230 |  |
  |  | 231 | if ( $page == 'members-area' || $page == 'register' ) { |
  |  | 232 |  |
  |  | 233 | if ( $wpmem->regchk == "captcha" ) { |
  |  | 234 | global $wpmem\_captcha\_err; |
  |  | 235 | $wpmem\_themsg = \_\_( 'There was an error with the CAPTCHA form.' ) . '<br /><br />' . $wpmem\_captcha\_err; |
  |  | 236 | } |
  |  | 237 |  |
  |  | 238 | if ( $wpmem->regchk == "loginfailed" ) { |
  |  | 239 | return wpmem\_inc\_loginfailed(); |
  |  | 240 | } |
  |  | 241 |  |
  |  | 242 | if ( ! is\_user\_logged\_in() ) { |
  |  | 243 | if ( $wpmem->action == 'register' && ! $hide\_register ) { |
  |  | 244 |  |
  |  | 245 | switch( $wpmem->regchk ) { |
  |  | 246 |  |
  |  | 247 | case "success": |
  |  | 248 | $content = wpmem\_inc\_regmessage( $wpmem->regchk,$wpmem\_themsg ); |
  |  | 249 | $content = $content . wpmem\_inc\_login(); |
  |  | 250 | break; |
  |  | 251 |  |
  |  | 252 | default: |
  |  | 253 | $content = wpmem\_inc\_regmessage( $wpmem->regchk,$wpmem\_themsg ); |
  |  | 254 | $content = $content . wpmem\_inc\_registration(); |
  |  | 255 | break; |
  |  | 256 | } |
  |  | 257 |  |
  |  | 258 | } elseif ( $wpmem->action == 'pwdreset' ) { |
  |  | 259 |  |
  |  | 260 | $content = wpmem\_page\_pwd\_reset( $wpmem->regchk, $content ); |
  |  | 261 |  |
  |  | 262 | } elseif( $wpmem->action == 'getusername' ) { |
  |  | 263 |  |
  |  | 264 | $content = wpmem\_page\_forgot\_username( $wpmem->regchk, $content ); |
  |  | 265 |  |
  |  | 266 | } else { |
  |  | 267 |  |
  |  | 268 | $content = ( $page == 'members-area' ) ? $content . wpmem\_inc\_login( 'members' ) : $content; |
  |  | 269 | $content = ( ( $page == 'register' || $wpmem->show\_reg[ $post->post\_type ] != 0 ) && ! $hide\_register ) ? $content . wpmem\_inc\_registration() : $content; |
  |  | 270 | } |
  |  | 271 |  |
  |  | 272 | } elseif ( is\_user\_logged\_in() && $page == 'members-area' ) { |
  |  | 273 |  |
  |  | 274 | /\*\* |
  |  | 275 | \* Filter the default heading in User Profile edit mode. |
  |  | 276 | \* |
  |  | 277 | \* @since 2.7.5 |
  |  | 278 | \* |
  |  | 279 | \* @param string The default edit mode heading. |
  |  | 280 | \*/ |
  |  | 281 | $heading = apply\_filters( 'wpmem\_user\_edit\_heading', \_\_( 'Edit Your Information', 'wp-members' ) ); |
  |  | 282 |  |
  |  | 283 | switch( $wpmem->action ) { |
  |  | 284 |  |
  |  | 285 | case "edit": |
  |  | 286 | $content = $content . wpmem\_inc\_registration( 'edit', $heading ); |
  |  | 287 | break; |
  |  | 288 |  |
  |  | 289 | case "update": |
  |  | 290 |  |
  |  | 291 | // Determine if there are any errors/empty fields. |
  |  | 292 |  |
  |  | 293 | if ( $wpmem->regchk == "updaterr" || $wpmem->regchk == "email" ) { |
  |  | 294 |  |
  |  | 295 | $content = $content . wpmem\_inc\_regmessage( $wpmem->regchk, $wpmem\_themsg ); |
  |  | 296 | $content = $content . wpmem\_inc\_registration( 'edit', $heading ); |
  |  | 297 |  |
  |  | 298 | } else { |
  |  | 299 |  |
  |  | 300 | //Case "editsuccess". |
  |  | 301 | $content = $content . wpmem\_inc\_regmessage( $wpmem->regchk, $wpmem\_themsg ); |
  |  | 302 | $content = $content . wpmem\_inc\_memberlinks(); |
  |  | 303 |  |
  |  | 304 | } |
  |  | 305 | break; |
  |  | 306 |  |
  |  | 307 | case "pwdchange": |
  |  | 308 |  |
  |  | 309 | $content = wpmem\_page\_pwd\_reset( $wpmem->regchk, $content ); |
  |  | 310 | break; |
  |  | 311 |  |
  |  | 312 | case "renew": |
  |  | 313 | $content = wpmem\_renew(); |
  |  | 314 | break; |
  |  | 315 |  |
  |  | 316 | default: |
  |  | 317 | $content = wpmem\_inc\_memberlinks(); |
  |  | 318 | break; |
  |  | 319 | } |
  |  | 320 |  |
  |  | 321 | } elseif ( is\_user\_logged\_in() && $page == 'register' ) { |
  |  | 322 |  |
  |  | 323 | $content = $content . wpmem\_inc\_memberlinks( 'register' ); |
  |  | 324 |  |
  |  | 325 | } |
  |  | 326 |  |
  |  | 327 | } |
  |  | 328 |  |
  |  | 329 | if ( $page == 'login' ) { |
  |  | 330 | $content = ( $wpmem->regchk == "loginfailed" ) ? wpmem\_inc\_loginfailed() : $content; |
  |  | 331 | $content = ( ! is\_user\_logged\_in() ) ? $content . wpmem\_inc\_login( 'login', $redirect\_to ) : wpmem\_inc\_memberlinks( 'login' ); |
  |  | 332 | } |
  |  | 333 |  |
  |  | 334 | if ( $page == 'password' ) { |
  |  | 335 | $content = wpmem\_page\_pwd\_reset( $wpmem->regchk, $content ); |
  |  | 336 | } |
  |  | 337 |  |
  |  | 338 | if ( $page == 'user-edit' ) { |
  |  | 339 | $content = wpmem\_page\_user\_edit( $wpmem->regchk, $content ); |
  |  | 340 | } |
  |  | 341 |  |
  |  | 342 | return $content; |
  |  | 343 | } // End wpmem\_do\_sc\_pages. |
  |  | 344 | endif; |
* ## [wp-members/trunk/inc/dialogs.php](/changeset/1667369/wp-members/trunk/inc/dialogs.php "Show the changeset 1667369 restricted to wp-members/trunk/inc/dialogs.php")

  | [r1628757](/browser/wp-members/trunk/inc/dialogs.php?rev=1628757#L23 "Show revision 1628757 of this file in browser") | [r1667369](/browser/wp-members/trunk/inc/dialogs.php?rev=1667369#L23 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 23 | 23 | \* - wpmem\_inc\_forgotusername |
  | 24 | 24 | \*/ |
  | 25 |  |  |
  | 26 |  |  |
  | 27 |  | ~~// Include the form building functions.~~ |
  | 28 |  | ~~include\_once( WPMEM\_PATH . 'inc/forms.php' );~~ |
  | 29 | 25 |  |
  | 30 | 26 |  |
* ## [wp-members/trunk/inc/forms.php](/changeset/1667369/wp-members/trunk/inc/forms.php "Show the changeset 1667369 restricted to wp-members/trunk/inc/forms.php")

  | [r1628757](/browser/wp-members/trunk/inc/forms.php?rev=1628757#L477 "Show revision 1628757 of this file in browser") | [r1667369](/browser/wp-members/trunk/inc/forms.php?rev=1667369#L477 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 477 | 477 | } |
  | 478 | 478 |  |
  |  | 479 | /\*\* |
  |  | 480 | \* Add registration fields to WooCommerce registration. |
  |  | 481 | \* |
  |  | 482 | \* As of WooCommerce 3.0, the WC registration process no longer includes the |
  |  | 483 | \* WP register\_form action hook.  It only includes woocommerce\_register\_form. |
  |  | 484 | \* In previous versions, WP-Members hooked to register\_form for both WP and |
  |  | 485 | \* WC registration. To provide backward compatibility with users who may |
  |  | 486 | \* continue to use updated WP-Members with pre-3.0 WooCommerce, this function |
  |  | 487 | \* checks for WC version and if it is older than 3.0 it will ignore adding |
  |  | 488 | \* the WP-Members form fields as they would have already been added when the |
  |  | 489 | \* register\_form action hook fired. |
  |  | 490 | \* |
  |  | 491 | \* @since 3.1.8 |
  |  | 492 | \*/ |
  |  | 493 | function wpmem\_woo\_register\_form() { |
  |  | 494 | if ( class\_exists( 'WooCommerce' ) ) { |
  |  | 495 | global $woocommerce; |
  |  | 496 | if ( version\_compare( $woocommerce->version, '3.0', ">=" ) ) { |
  |  | 497 | wpmem\_wp\_register\_form( 'woo' ); |
  |  | 498 | } |
  |  | 499 | } |
  |  | 500 | } |
  |  | 501 |  |
  | 479 | 502 | // End of file. |
* ## [wp-members/trunk/inc/register.php](/changeset/1667369/wp-members/trunk/inc/register.php "Show the changeset 1667369 restricted to wp-members/trunk/inc/register.php")

  | [r1628757](/browser/wp-members/trunk/inc/register.php?rev=1628757#L272 "Show revision 1628757 of this file in browser") | [r1667369](/browser/wp-members/trunk/inc/register.php?rev=1667369#L272 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 272 | 272 | \*/ |
  | 273 | 273 | global $current\_user; wp\_get\_current\_user(); |
  | 274 |  | if ( $wpmem->user->post\_data['user\_email'] != $current\_user->user\_email ) { |
  |  | 274 | if ( $wpmem->user->post\_data['user\_email'] != $current\_user->user\_email ) { |
  | 275 | 275 | if ( email\_exists( $wpmem->user->post\_data['user\_email'] ) ) { |
  | 276 | 276 | return "email"; |
  | 277 | 277 | exit(); |
  | 278 | 278 | } |
  | 279 |  | if ( ~~!~~is\_email( $wpmem->user->post\_data['user\_email']) ) { |
  |  | 279 | if ( in\_array( 'user\_email', $wpmem->fields ) && ! is\_email( $wpmem->user->post\_data['user\_email']) ) { |
  | 280 | 280 | $wpmem\_themsg = $wpmem->get\_text( 'reg\_valid\_email' ); |
  | 281 | 281 | return "updaterr"; |
  | […](/browser/wp-members/trunk/inc/register.php?rev=1628757#L363) | […](/browser/wp-members/trunk/inc/register.php?rev=1667369#L363) |  |
  | 363 | 363 | // Handle file uploads, if any. |
  | 364 | 364 | if ( ! empty( $\_FILES ) ) { |
  | 365 |  |  |
  | 366 |  | foreach ( $wpmem->fields as $meta\_key => $field ) { |
  | 367 |  |  |
  | 368 |  | if ( ( 'file' == $field['type'] || 'image' == $field['type'] ) && is\_array( $\_FILES[ $meta\_key ] ) ) { |
  | 369 |  | if ( ! empty( $\_FILES[ $meta\_key ]['name'] ) ) { |
  | 370 |  | // Upload the file and save it as an attachment. |
  | 371 |  | $file\_post\_id = $wpmem->forms->do\_file\_upload( $\_FILES[ $meta\_key ], $wpmem->user->post\_data['ID'] ); |
  | 372 |  |  |
  | 373 |  | // Save the attachment ID as user meta. |
  | 374 |  | update\_user\_meta( $wpmem->user->post\_data['ID'], $meta\_key, $file\_post\_id ); |
  | 375 |  | } |
  | 376 |  | } |
  | 377 |  | } |
  |  | 365 | $wpmem->user->upload\_user\_files( $wpmem->user->post\_data['ID'], $wpmem->fields ); |
  | 378 | 366 | } |
  | 379 | 367 |  |
* ## [wp-members/trunk/inc/shortcodes.php](/changeset/1667369/wp-members/trunk/inc/shortcodes.php "Show the changeset 1667369 restricted to wp-members/trunk/inc/shortcodes.php")

  | [r1628757](/browser/wp-members/trunk/inc/shortcodes.php?rev=1628757#L19 "Show revision 1628757 of this file in browser") | [r1667369](/browser/wp-members/trunk/inc/shortcodes.php?rev=1667369#L19 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 19 | 19 | \* - wpmem\_sc\_logged\_in |
  | 20 | 20 | \* - wpmem\_sc\_logged\_out |
  | 21 |  | ~~\* - wpmem\_do\_sc\_pages~~ |
  | 22 | 21 | \* - wpmem\_sc\_user\_count |
  | 23 | 22 | \* - wpmem\_sc\_user\_profile |
  | […](/browser/wp-members/trunk/inc/shortcodes.php?rev=1628757#L45) | […](/browser/wp-members/trunk/inc/shortcodes.php?rev=1667369#L44) |  |
  | 45 | 44 |  |
  | 46 | 45 | global $wpmem, $wpmem\_themsg; |
  | 47 |  |  |
  | 48 |  | ~~/\*\*~~ |
  | 49 |  | ~~\* Load core functions if they are not already loaded.~~ |
  | 50 |  | ~~\*/~~ |
  | 51 |  | ~~include\_once( WPMEM\_PATH . 'inc/core.php' );~~ |
  | 52 |  |  |
  | 53 |  | ~~/\*\*~~ |
  | 54 |  | ~~\* Load dialog functions if they are not already loaded.~~ |
  | 55 |  | ~~\*/~~ |
  | 56 |  | ~~include\_once( WPMEM\_PATH . 'inc/dialogs.php' );~~ |
  | 57 | 46 |  |
  | 58 | 47 | // Defaults. |
  | […](/browser/wp-members/trunk/inc/shortcodes.php?rev=1628757#L205) | […](/browser/wp-members/trunk/inc/shortcodes.php?rev=1667369#L194) |  |
  | 205 | 194 | if ( isset( $atts['role'] ) ) { |
  | 206 | 195 | $roles = explode( ',', $atts['role'] ); |
  | 207 |  | foreach ( $roles as $role ) { |
  | 208 |  | if ( in\_array( trim( $role ), $current\_user->roles ) ) { |
  | 209 |  | $do\_return = true; |
  | 210 |  | } |
  |  | 196 | if ( wpmem\_user\_has\_role( $roles ) ) { |
  |  | 197 | $do\_return = true; |
  | 211 | 198 | } |
  | 212 | 199 | } |
  | 213 | 200 |  |
  | 214 | 201 | // If there is a status attribute of "sub" and the user is logged in. |
  | 215 |  | if ( ( isset( $atts['status'] ) ) && $atts['status'] == 'sub' ~~&& is\_user\_logged\_in()~~ ) { |
  |  | 202 | if ( ( isset( $atts['status'] ) ) && $atts['status'] == 'sub' ) { |
  | 216 | 203 | if ( defined( 'WPMEM\_EXP\_MODULE' ) && $wpmem->use\_exp == 1 ) { |
  | 217 | 204 | if ( ! wpmem\_chk\_exp() ) { |
  | […](/browser/wp-members/trunk/inc/shortcodes.php?rev=1628757#L224) | […](/browser/wp-members/trunk/inc/shortcodes.php?rev=1667369#L211) |  |
  | 224 | 211 | } |
  | 225 | 212 |  |
  | 226 |  | // If the current page is the user profile and an action is being handled. |
  | 227 |  | if ( ( wpmem\_current\_url() == $wpmem->user\_pages['profile'] ) && isset( $\_GET['a'] ) ) { |
  |  | 213 | // If there is a meta key attribute. |
  |  | 214 | if ( isset( $atts['meta\_key'] ) ) { |
  |  | 215 | $value = ( isset( $atts['meta\_value'] ) ) ? $atta['meta\_value'] : false; |
  |  | 216 | if ( wpmem\_user\_has\_meta( $atts['meta\_key'], $value ) ) { |
  |  | 217 | $do\_return = true; |
  |  | 218 | } |
  |  | 219 | } |
  |  | 220 |  |
  |  | 221 | // Prevents display if the current page is the user profile and an action is being handled. |
  |  | 222 | if ( ( wpmem\_current\_url( true, false ) == wpmem\_profile\_url() ) && isset( $\_GET['a'] ) ) { |
  | 228 | 223 | $do\_return = false; |
  | 229 | 224 | } |
  | […](/browser/wp-members/trunk/inc/shortcodes.php?rev=1628757#L249) | […](/browser/wp-members/trunk/inc/shortcodes.php?rev=1667369#L244) |  |
  | 249 | 244 | return ( ! is\_user\_logged\_in() ) ? do\_shortcode( $content ) : ''; |
  | 250 | 245 | } |
  | 251 |  |  |
  | 252 |  | ~~if ( ! function\_exists( 'wpmem\_do\_sc\_pages' ) ):~~ |
  | 253 |  | ~~/\*\*~~ |
  | 254 |  | ~~\* Builds the shortcode pages (login, register, user-profile, user-edit, password).~~ |
  | 255 |  | ~~\*~~ |
  | 256 |  | ~~\* Some of the logic here is similar to the wpmem\_securify() function.~~ |
  | 257 |  | ~~\* But where that function handles general content, this function~~ |
  | 258 |  | ~~\* handles building specific pages generated by shortcodes.~~ |
  | 259 |  | ~~\*~~ |
  | 260 |  | ~~\* @since 2.6.0~~ |
  | 261 |  | ~~\*~~ |
  | 262 |  | ~~\* @global object $wpmem        The WP\_Members object.~~ |
  | 263 |  | ~~\* @global string $wpmem\_themsg The WP-Members message container.~~ |
  | 264 |  | ~~\* @global object $post         The WordPress post object.~~ |
  | 265 |  | ~~\*~~ |
  | 266 |  | ~~\* @param  string $atts {~~ |
  | 267 |  | ~~\*     The shortcode attributes.~~ |
  | 268 |  | ~~\*~~ |
  | 269 |  | ~~\*     @type string $page~~ |
  | 270 |  | ~~\*     @type string $redirect\_to~~ |
  | 271 |  | ~~\*     @type string $register~~ |
  | 272 |  | ~~\* }~~ |
  | 273 |  | ~~\* @param  string $content~~ |
  | 274 |  | ~~\* @param  string $tag~~ |
  | 275 |  | ~~\* @return string $content~~ |
  | 276 |  | ~~\*/~~ |
  | 277 |  | ~~function wpmem\_do\_sc\_pages( $atts, $content, $tag ) {~~ |
  | 278 |  |  |
  | 279 |  | ~~$page = ( isset( $atts['page'] ) ) ? $atts['page'] : $tag;~~ |
  | 280 |  | ~~$redirect\_to = ( isset( $atts['redirect\_to'] ) ) ? $atts['redirect\_to'] : null;~~ |
  | 281 |  | ~~$hide\_register = ( isset( $atts['register'] ) && 'hide' == $atts['register'] ) ? true : false;~~ |
  | 282 |  |  |
  | 283 |  | ~~global $wpmem, $wpmem\_themsg, $post;~~ |
  | 284 |  | ~~include\_once( WPMEM\_PATH . 'inc/dialogs.php' );~~ |
  | 285 |  |  |
  | 286 |  | ~~$content = '';~~ |
  | 287 |  |  |
  | 288 |  | ~~// Deprecating members-area parameter to be replaced by user-profile.~~ |
  | 289 |  | ~~$page = ( $page == 'user-profile' ) ? 'members-area' : $page;~~ |
  | 290 |  |  |
  | 291 |  | ~~if ( $page == 'members-area' || $page == 'register' ) {~~ |
  | 292 |  |  |
  | 293 |  | ~~if ( $wpmem->regchk == "captcha" ) {~~ |
  | 294 |  | ~~global $wpmem\_captcha\_err;~~ |
  | 295 |  | ~~$wpmem\_themsg = \_\_( 'There was an error with the CAPTCHA form.' ) . '<br /><br />' . $wpmem\_captcha\_err;~~ |
  | 296 |  | ~~}~~ |
  | 297 |  |  |
  | 298 |  | ~~if ( $wpmem->regchk == "loginfailed" ) {~~ |
  | 299 |  | ~~return wpmem\_inc\_loginfailed();~~ |
  | 300 |  | ~~}~~ |
  | 301 |  |  |
  | 302 |  | ~~if ( ! is\_user\_logged\_in() ) {~~ |
  | 303 |  | ~~if ( $wpmem->action == 'register' && ! $hide\_register ) {~~ |
  | 304 |  |  |
  | 305 |  | ~~switch( $wpmem->regchk ) {~~ |
  | 306 |  |  |
  | 307 |  | ~~case "success":~~ |
  | 308 |  | ~~$content = wpmem\_inc\_regmessage( $wpmem->regchk,$wpmem\_themsg );~~ |
  | 309 |  | ~~$content = $content . wpmem\_inc\_login();~~ |
  | 310 |  | ~~break;~~ |
  | 311 |  |  |
  | 312 |  | ~~default:~~ |
  | 313 |  | ~~$content = wpmem\_inc\_regmessage( $wpmem->regchk,$wpmem\_themsg );~~ |
  | 314 |  | ~~$content = $content . wpmem\_inc\_registration();~~ |
  | 315 |  | ~~break;~~ |
  | 316 |  | ~~}~~ |
  | 317 |  |  |
  | 318 |  | ~~} elseif ( $wpmem->action == 'pwdreset' ) {~~ |
  | 319 |  |  |
  | 320 |  | ~~$content = wpmem\_page\_pwd\_reset( $wpmem->regchk, $content );~~ |
  | 321 |  |  |
  | 322 |  | ~~} elseif( $wpmem->action == 'getusername' ) {~~ |
  | 323 |  |  |
  | 324 |  | ~~$content = wpmem\_page\_forgot\_username( $wpmem->regchk, $content );~~ |
  | 325 |  |  |
  | 326 |  | ~~} else {~~ |
  | 327 |  |  |
  | 328 |  | ~~$content = ( $page == 'members-area' ) ? $content . wpmem\_inc\_login( 'members' ) : $content;~~ |
  | 329 |  | ~~$content = ( ( $page == 'register' || $wpmem->show\_reg[ $post->post\_type ] != 0 ) && ! $hide\_register ) ? $content . wpmem\_inc\_registration() : $content;~~ |
  | 330 |  | ~~}~~ |
  | 331 |  |  |
  | 332 |  | ~~} elseif ( is\_user\_logged\_in() && $page == 'members-area' ) {~~ |
  | 333 |  |  |
  | 334 |  | ~~/\*\*~~ |
  | 335 |  | ~~\* Filter the default heading in User Profile edit mode.~~ |
  | 336 |  | ~~\*~~ |
  | 337 |  | ~~\* @since 2.7.5~~ |
  | 338 |  | ~~\*~~ |
  | 339 |  | ~~\* @param string The default edit mode heading.~~ |
  | 340 |  | ~~\*/~~ |
  | 341 |  | ~~$heading = apply\_filters( 'wpmem\_user\_edit\_heading', \_\_( 'Edit Your Information', 'wp-members' ) );~~ |
  | 342 |  |  |
  | 343 |  | ~~switch( $wpmem->action ) {~~ |
  | 344 |  |  |
  | 345 |  | ~~case "edit":~~ |
  | 346 |  | ~~$content = $content . wpmem\_inc\_registration( 'edit', $heading );~~ |
  | 347 |  | ~~break;~~ |
  | 348 |  |  |
  | 349 |  | ~~case "update":~~ |
  | 350 |  |  |
  | 351 |  | ~~// Determine if there are any errors/empty fields.~~ |
  | 352 |  |  |
  | 353 |  | ~~if ( $wpmem->regchk == "updaterr" || $wpmem->regchk == "email" ) {~~ |
  | 354 |  |  |
  | 355 |  | ~~$content = $content . wpmem\_inc\_regmessage( $wpmem->regchk, $wpmem\_themsg );~~ |
  | 356 |  | ~~$content = $content . wpmem\_inc\_registration( 'edit', $heading );~~ |
  | 357 |  |  |
  | 358 |  | ~~} else {~~ |
  | 359 |  |  |
  | 360 |  | ~~//Case "editsuccess".~~ |
  | 361 |  | ~~$content = $content . wpmem\_inc\_regmessage( $wpmem->regchk, $wpmem\_themsg );~~ |
  | 362 |  | ~~$content = $content . wpmem\_inc\_memberlinks();~~ |
  | 363 |  |  |
  | 364 |  | ~~}~~ |
  | 365 |  | ~~break;~~ |
  | 366 |  |  |
  | 367 |  | ~~case "pwdchange":~~ |
  | 368 |  |  |
  | 369 |  | ~~$content = wpmem\_page\_pwd\_reset( $wpmem->regchk, $content );~~ |
  | 370 |  | ~~break;~~ |
  | 371 |  |  |
  | 372 |  | ~~case "renew":~~ |
  | 373 |  | ~~$content = wpmem\_renew();~~ |
  | 374 |  | ~~break;~~ |
  | 375 |  |  |
  | 376 |  | ~~default:~~ |
  | 377 |  | ~~$content = wpmem\_inc\_memberlinks();~~ |
  | 378 |  | ~~break;~~ |
  | 379 |  | ~~}~~ |
  | 380 |  |  |
  | 381 |  | ~~} elseif ( is\_user\_logged\_in() && $page == 'register' ) {~~ |
  | 382 |  |  |
  | 383 |  | ~~$content = $content . wpmem\_inc\_memberlinks( 'register' );~~ |
  | 384 |  |  |
  | 385 |  | ~~}~~ |
  | 386 |  |  |
  | 387 |  | ~~}~~ |
  | 388 |  |  |
  | 389 |  | ~~if ( $page == 'login' ) {~~ |
  | 390 |  | ~~$content = ( $wpmem->regchk == "loginfailed" ) ? wpmem\_inc\_loginfailed() : $content;~~ |
  | 391 |  | ~~$content = ( ! is\_user\_logged\_in() ) ? $content . wpmem\_inc\_login( 'login', $redirect\_to ) : wpmem\_inc\_memberlinks( 'login' );~~ |
  | 392 |  | ~~}~~ |
  | 393 |  |  |
  | 394 |  | ~~if ( $page == 'password' ) {~~ |
  | 395 |  | ~~$content = wpmem\_page\_pwd\_reset( $wpmem->regchk, $content );~~ |
  | 396 |  | ~~}~~ |
  | 397 |  |  |
  | 398 |  | ~~if ( $page == 'user-edit' ) {~~ |
  | 399 |  | ~~$content = wpmem\_page\_user\_edit( $wpmem->regchk, $content );~~ |
  | 400 |  | ~~}~~ |
  | 401 |  |  |
  | 402 |  | ~~return $content;~~ |
  | 403 |  | ~~} // End wpmem\_do\_sc\_pages.~~ |
  | 404 |  | ~~endif;~~ |
  | 405 | 246 |  |
  | 406 | 247 | /\*\* |
  | […](/browser/wp-members/trunk/inc/shortcodes.php?rev=1628757#L453) | […](/browser/wp-members/trunk/inc/shortcodes.php?rev=1667369#L294) |  |
  | 453 | 294 | \* @since 3.1.2 Added function arguments. |
  | 454 | 295 | \* |
  | 455 |  | \* @param  array  $atts { |
  | 456 |  | \*     The shortcode attributes. |
  | 457 |  | \* |
  | 458 |  | \*     @type string $page |
  |  | 296 | \* @global object $wpmem        The WP\_Members object. |
  |  | 297 | \* @global string $wpmem\_themsg The WP-Members message container. |
  |  | 298 | \* |
  |  | 299 | \* @param  string $atts { |
  |  | 300 | \*     The shortcode attributes. |
  |  | 301 | \* |
  |  | 302 | \*     @type string $redirect\_to |
  | 459 | 303 | \* } |
  | 460 | 304 | \* @param  string $content |
  | […](/browser/wp-members/trunk/inc/shortcodes.php?rev=1628757#L463) | […](/browser/wp-members/trunk/inc/shortcodes.php?rev=1667369#L307) |  |
  | 463 | 307 | \*/ |
  | 464 | 308 | function wpmem\_sc\_user\_profile( $atts, $content, $tag ) { |
  | 465 |  | $atts['page'] = 'user-profile'; |
  | 466 |  | $content = wpmem\_do\_sc\_pages( $atts, $content, $tag ); |
  |  | 309 |  |
  |  | 310 | // @todo $redirect\_to is not currently used in the user profile. |
  |  | 311 | $redirect\_to   = ( isset( $atts['redirect\_to'] ) ) ? $atts['redirect\_to'] : null; |
  |  | 312 | $hide\_register = ( isset( $atts['register'] ) && 'hide' == $atts['register'] ) ? true : false; |
  |  | 313 |  |
  |  | 314 | global $wpmem, $wpmem\_themsg; |
  |  | 315 |  |
  |  | 316 | $content = ''; |
  |  | 317 |  |
  |  | 318 | if ( $wpmem->regchk == "captcha" ) { |
  |  | 319 | global $wpmem\_captcha\_err; |
  |  | 320 | $wpmem\_themsg = \_\_( 'There was an error with the CAPTCHA form.' ) . '<br /><br />' . $wpmem\_captcha\_err; |
  |  | 321 | } |
  |  | 322 |  |
  |  | 323 | if ( $wpmem->regchk == "loginfailed" ) { |
  |  | 324 | return wpmem\_inc\_loginfailed(); |
  |  | 325 | } |
  |  | 326 |  |
  |  | 327 | if ( is\_user\_logged\_in() ) { |
  |  | 328 |  |
  |  | 329 | /\*\* |
  |  | 330 | \* Filter the default heading in User Profile edit mode. |
  |  | 331 | \* |
  |  | 332 | \* @since 2.7.5 |
  |  | 333 | \* |
  |  | 334 | \* @param string The default edit mode heading. |
  |  | 335 | \*/ |
  |  | 336 | $heading = apply\_filters( 'wpmem\_user\_edit\_heading', \_\_( 'Edit Your Information', 'wp-members' ) ); |
  |  | 337 |  |
  |  | 338 | switch( $wpmem->action ) { |
  |  | 339 |  |
  |  | 340 | case "edit": |
  |  | 341 | $content = $content . wpmem\_inc\_registration( 'edit', $heading ); |
  |  | 342 | break; |
  |  | 343 |  |
  |  | 344 | case "update": |
  |  | 345 | // Determine if there are any errors/empty fields. |
  |  | 346 | if ( $wpmem->regchk == "updaterr" || $wpmem->regchk == "email" ) { |
  |  | 347 | $content = $content . wpmem\_inc\_regmessage( $wpmem->regchk, $wpmem\_themsg ); |
  |  | 348 | $content = $content . wpmem\_inc\_registration( 'edit', $heading ); |
  |  | 349 | } else { |
  |  | 350 | //Case "editsuccess". |
  |  | 351 | $content = $content . wpmem\_inc\_regmessage( $wpmem->regchk, $wpmem\_themsg ); |
  |  | 352 | $content = $content . wpmem\_inc\_memberlinks(); |
  |  | 353 | } |
  |  | 354 | break; |
  |  | 355 |  |
  |  | 356 | case "pwdchange": |
  |  | 357 |  |
  |  | 358 | $content = wpmem\_page\_pwd\_reset( $wpmem->regchk, $content ); |
  |  | 359 | break; |
  |  | 360 |  |
  |  | 361 | case "renew": |
  |  | 362 | $content = wpmem\_renew(); |
  |  | 363 | break; |
  |  | 364 |  |
  |  | 365 | default: |
  |  | 366 | $content = wpmem\_inc\_memberlinks(); |
  |  | 367 | break; |
  |  | 368 | } |
  |  | 369 |  |
  |  | 370 | } else { |
  |  | 371 |  |
  |  | 372 | if ( $wpmem->action == 'register' && ! $hide\_register ) { |
  |  | 373 |  |
  |  | 374 | switch( $wpmem->regchk ) { |
  |  | 375 |  |
  |  | 376 | case "success": |
  |  | 377 | $content = wpmem\_inc\_regmessage( $wpmem->regchk, $wpmem\_themsg ); |
  |  | 378 | $content = $content . wpmem\_inc\_login(); |
  |  | 379 | break; |
  |  | 380 |  |
  |  | 381 | default: |
  |  | 382 | $content = wpmem\_inc\_regmessage( $wpmem->regchk, $wpmem\_themsg ); |
  |  | 383 | $content = $content . wpmem\_inc\_registration(); |
  |  | 384 | break; |
  |  | 385 | } |
  |  | 386 |  |
  |  | 387 | } elseif ( $wpmem->action == 'pwdreset' ) { |
  |  | 388 |  |
  |  | 389 | $content = wpmem\_page\_pwd\_reset( $wpmem->regchk, $content ); |
  |  | 390 |  |
  |  | 391 | } elseif( $wpmem->action == 'getusername' ) { |
  |  | 392 |  |
  |  | 393 | $content = wpmem\_page\_forgot\_username( $wpmem->regchk, $content ); |
  |  | 394 |  |
  |  | 395 | } else { |
  |  | 396 |  |
  |  | 397 | $content = $content . wpmem\_inc\_login( 'members' ); |
  |  | 398 | $content = ( ! $hide\_register ) ? $content . wpmem\_inc\_registration() : $content; |
  |  | 399 | } |
  |  | 400 | } |
  |  | 401 |  |
  | 467 | 402 | return $content; |
  | 468 | 403 | } |
  | […](/browser/wp-members/trunk/inc/shortcodes.php?rev=1628757#L544) | […](/browser/wp-members/trunk/inc/shortcodes.php?rev=1667369#L479) |  |
  | 544 | 479 | global $wpmem; |
  | 545 | 480 | $fields = wpmem\_fields(); |
  | 546 |  | $field\_type = ( isset( $fields[ $field ]['type'] ) ) ? $fields[ $field ]['type'] : 'native'; |
  |  | 481 | $field\_type = ( isset( $fields[ $field ]['type'] ) ) ? $fields[ $field ]['type'] : 'native'; // @todo Is this needed? It seems to set the type to "native" if not set. |
  | 547 | 482 |  |
  | 548 | 483 | $result = $user\_info->{$field}; |
  | […](/browser/wp-members/trunk/inc/shortcodes.php?rev=1628757#L587) | […](/browser/wp-members/trunk/inc/shortcodes.php?rev=1667369#L522) |  |
  | 587 | 522 | return do\_shortcode( $result ); |
  | 588 | 523 | } |
  |  | 524 |  |
  |  | 525 | // Handle line breaks for textarea fields |
  |  | 526 | if ( isset( $field\_type ) && 'textarea' == $field\_type ) { |
  |  | 527 | $result = nl2br( $user\_info->{$field} ); |
  |  | 528 | } |
  | 589 | 529 |  |
  | 590 | 530 | // Remove underscores from value if requested (default: on). |
  | […](/browser/wp-members/trunk/inc/shortcodes.php?rev=1628757#L595) | […](/browser/wp-members/trunk/inc/shortcodes.php?rev=1667369#L535) |  |
  | 595 | 535 | $content = ( $content ) ? $result . $content : $result; |
  | 596 | 536 |  |
  | 597 |  | return do\_shortcode( ~~htmlspecialchars( $content )~~ ); |
  |  | 537 | return do\_shortcode( $content ); |
  | 598 | 538 | } |
  | 599 | 539 | return; |
* ## [wp-members/trunk/inc/users.php](/changeset/1667369/wp-members/trunk/inc/users.php "Show the changeset 1667369 restricted to wp-members/trunk/inc/users.php")

  | [r1628757](/browser/wp-members/trunk/inc/users.php?rev=1628757#L27 "Show revision 1628757 of this file in browser") | [r1667369](/browser/wp-members/trunk/inc/users.php?rev=1667369#L27 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 27 | 27 | function wpmem\_user\_profile() { |
  | 28 | 28 |  |
  | 29 |  | global $wpmem, $user\_id; |
  |  | 29 | global $wpmem, $user\_id, $current\_screen; |
  | 30 | 30 | /\*\* |
  | 31 | 31 | \* Filter the heading for the user profile additional fields. |
  | […](/browser/wp-members/trunk/inc/users.php?rev=1628757#L70) | […](/browser/wp-members/trunk/inc/users.php?rev=1667369#L70) |  |
  | 70 | 70 | $empty\_file = '<span class="description">' . \_\_( 'None' ) . '</span>'; |
  | 71 | 71 | if ( 'file' == $field['type'] ) { |
  | 72 |  | $input = ( ~~0 <~~ $attachment\_url ) ? '<a href="' . $attachment\_url . '">' . $attachment\_url . '</a>' : $empty\_file; |
  |  | 72 | $input = ( $attachment\_url ) ? '<a href="' . $attachment\_url . '">' . $attachment\_url . '</a>' : $empty\_file; |
  | 73 | 73 | } else { |
  | 74 |  | $input = ( ~~0 <~~ $attachment\_url ) ? '<img src="' . $attachment\_url . '">' : $empty\_file; |
  |  | 74 | $input = ( $attachment\_url ) ? '<img src="' . $attachment\_url . '">' : $empty\_file; |
  | 75 | 75 | } |
  | 76 |  | // @todo - come up with a way to handle file updates - user profile form does not support multitype |
  | 77 |  | //$show\_field.= '<br /><span class="description">' . \_\_( 'Update this file:' ) . '</span><br />'; |
  | 78 |  | //$show\_field.= wpmem\_create\_formfield( $meta . '\_update\_file', $field['type'], $val, $valtochk ); |
  |  | 76 | $input.= '<br />' . $wpmem->get\_text( 'profile\_upload' ) . '<br />'; |
  |  | 77 | $input.= wpmem\_form\_field( array( |
  |  | 78 | 'name'    => $meta, |
  |  | 79 | 'type'    => $field['type'], |
  |  | 80 | 'value'   => $val, |
  |  | 81 | 'compare' => $valtochk, |
  |  | 82 | ) ); |
  | 79 | 83 | } else { |
  | 80 | 84 | if ( $meta == 'tos' && $val == 'agree' ) { |
  | […](/browser/wp-members/trunk/inc/users.php?rev=1628757#L203) | […](/browser/wp-members/trunk/inc/users.php?rev=1667369#L207) |  |
  | 203 | 207 | } |
  | 204 | 208 | } |
  |  | 209 |  |
  |  | 210 | if ( ! empty( $\_FILES ) ) { |
  |  | 211 | $wpmem->user->upload\_user\_files( $user\_id, $wpmem\_fields ); |
  |  | 212 | } |
  | 205 | 213 | } |
  | 206 | 214 |  |
  |  | 215 | /\*\* |
  |  | 216 | \* Sets user profile update to multipart form data. |
  |  | 217 | \* |
  |  | 218 | \* If the fields array has a file or image field, this will echo the |
  |  | 219 | \* necessary "multipart/form-data" enctype for the form tag. |
  |  | 220 | \* |
  |  | 221 | \* @since 3.1.8 |
  |  | 222 | \*/ |
  |  | 223 | function wpmem\_user\_profile\_multipart() { |
  |  | 224 | global $wpmem; |
  |  | 225 | $has\_file = false; |
  |  | 226 | foreach ( wpmem\_fields() as $field ) { |
  |  | 227 | if ( $field['type'] == 'file' || $field['type'] == 'image' ) { |
  |  | 228 | $has\_file = true; |
  |  | 229 | break; |
  |  | 230 | } |
  |  | 231 | } |
  |  | 232 | echo ( $has\_file ) ? " enctype=\"multipart/form-data\"" : ''; |
  |  | 233 | } |
  |  | 234 |  |
  | 207 | 235 | // End of file. |
* ## [wp-members/trunk/inc/wp-registration.php](/changeset/1667369/wp-members/trunk/inc/wp-registration.php "Show the changeset 1667369 restricted to wp-members/trunk/inc/wp-registration.php")

  | [r1628757](/browser/wp-members/trunk/inc/wp-registration.php?rev=1628757#L28 "Show revision 1628757 of this file in browser") | [r1667369](/browser/wp-members/trunk/inc/wp-registration.php?rev=1667369#L28 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 28 | 28 | \* @since 3.1.1 Updated to support new (3.1.0) field types. |
  | 29 | 29 | \* @since 3.1.6 Updated to support new fields array. Added WC classes. |
  |  | 30 | \* @since 3.1.8 Added $process parameter. |
  | 30 | 31 | \*/ |
  | 31 |  | function wpmem\_do\_wp\_register\_form() { |
  |  | 32 | function wpmem\_do\_wp\_register\_form( $process = 'wp' ) { |
  | 32 | 33 |  |
  | 33 | 34 | global $wpmem; |
  | 34 |  | $wpmem\_fields = wpmem\_fields( ~~'wp'~~ ); |
  |  | 35 | $wpmem\_fields = wpmem\_fields( $process ); |
  | 35 | 36 |  |
  | 36 | 37 | // Check if this is WooCommerce account page. |
  | 37 | 38 | $is\_woo = false; |
  | 38 |  | if ( function\_exists( 'is\_account\_page' ) ) { |
  | 39 |  | $is\_woo = ( is\_account\_page() ) ? true : $is\_woo; |
  |  | 39 | if ( 'woo' == $process ) { |
  |  | 40 | $is\_woo = true; |
  |  | 41 | } else { |
  |  | 42 | if ( function\_exists( 'is\_account\_page' ) ) { |
  |  | 43 | $is\_woo = ( is\_account\_page() ) ? true : $is\_woo; |
  |  | 44 | } |
  | 40 | 45 | } |
  | 41 | 46 |  |
  | […](/browser/wp-members/trunk/inc/wp-registration.php?rev=1628757#L43) | […](/browser/wp-members/trunk/inc/wp-registration.php?rev=1667369#L48) |  |
  | 43 | 48 | foreach ( $wpmem\_fields as $meta\_key => $field ) { |
  | 44 | 49 |  |
  | 45 |  | $req = ( $field['required'] ) ? ~~' <span class="req">' . \_\_( '(required)' ) . '</span>'~~ : ''; |
  |  | 50 | $req = ( $field['required'] ) ? ( ( $is\_woo ) ? ' <span class="required">\*</span>' : ' <span class="req">' . \_\_( '(required)' ) . '</span>' ) : ''; |
  | 46 | 51 |  |
  | 47 | 52 | // File fields not yet supported for this form. |
* ## [wp-members/trunk/readme.txt](/changeset/1667369/wp-members/trunk/readme.txt "Show the changeset 1667369 restricted to wp-members/trunk/readme.txt")

  | [r1628757](/browser/wp-members/trunk/readme.txt?rev=1628757#L3 "Show revision 1628757 of this file in browser") | [r1667369](/browser/wp-members/trunk/readme.txt?rev=1667369#L3 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | Tags: access, authentication, content, login, member, membership, password, protect, register, registration, restriction, subscriber |
  | 4 | 4 | Requires at least: 3.6 |
  | 5 |  | Tested up to: 4.7~~.3~~ |
  | 6 |  | Stable tag: 3.1.~~7~~ |
  |  | 5 | Tested up to: 4.7 |
  |  | 6 | Stable tag: 3.1.8 |
  | 7 | 7 | License: GPLv2 |
  | 8 | 8 |  |
  | […](/browser/wp-members/trunk/readme.txt?rev=1628757#L113) | […](/browser/wp-members/trunk/readme.txt?rev=1667369#L113) |  |
  | 113 | 113 | == Upgrade Notice == |
  | 114 | 114 |  |
  | 115 |  | WP-Members 3.1.~~7~~ is a major update. There are no database changes (rollback is possible). See changelog for important details. Minimum WP version is 3.6. |
  |  | 115 | WP-Members 3.1.8 is a major update. There are no database changes (rollback is possible). See changelog for important details. Minimum WP version is 3.6. |
  | 116 | 116 |  |
  | 117 | 117 | == Screenshots == |
  | […](/browser/wp-members/trunk/readme.txt?rev=1628757#L135) | […](/browser/wp-members/trunk/readme.txt?rev=1667369#L135) |  |
  | 135 | 135 |  |
  | 136 | 136 | == Changelog == |
  |  | 137 |  |
  |  | 138 | = 3.1.8 = |
  |  | 139 |  |
  |  | 140 | \* Added new native registration handling to accommodate WooCommerce 3.0. |
  |  | 141 | \* Added support for user file upload on admin/dashboard profile. |
  |  | 142 | \* Added meta\_key/meta\_value attribute to [wpmem\_logged\_in] shortcode. |
  |  | 143 | \* Added wpmem\_user\_has\_meta() API function. |
  |  | 144 | \* Updated post editor shortcode button javascript to include new(er) shortcodes. |
  |  | 145 | \* Fixed WP-Members user profile shortcode to only display logged in content (by shortcode) if the wpmem\_a 'action' is not set (i.e. logged in content only displays if page is in "member links" state). |
  |  | 146 | \* Fixed register link in login form to prevent link from displaying if login form is displayed along with the registration form (standard configuration). |
  |  | 147 | \* Improved multisite support, including revisions to load all admin dependencies for administrator role, not just super admin. Dependency load role requirement is filterable. |
  |  | 148 | \* Improved line break stripping process in form builder to allow for line breaks in textarea fields. |
  |  | 149 | \* Improved field shortcode for textarea fields to display line breaks. |
  |  | 150 | \* Deprecated old wpmem\_do\_sc\_pages() function, updated wpmem\_sc\_user\_profile(). |
  |  | 151 | \* Removed $\_SERVER['REQUEST\_URI'] from all admin tab form action attributes. Replaced with new wpmem\_admin\_form\_post\_url() API function. |
  |  | 152 | \* Fields Tab: ground-up rebuild to utilize WP\_List\_Table and jquery sorting UI. |
  |  | 153 | \* Fields Tab: improved field add/edit screen: return link at bottom of page, display current field upon successful form submission, success message include return link. |
  |  | 154 | \* Fields Tab: added support for HTML5 field types: number, date. |
  |  | 155 | \* Fields Tab: added support for HTML5 field attributes: placeholder, pattern (regex), title, min, max. |
  | 137 | 156 |  |
  | 138 | 157 | = 3.1.7 = |
  | […](/browser/wp-members/trunk/readme.txt?rev=1628757#L165) | […](/browser/wp-members/trunk/readme.txt?rev=1667369#L184) |  |
  | 165 | 184 | \* Fixed load fields error checking, install function now correctly returns defaults. |
  | 166 | 185 | \* Changed password reset and password change to use wp\_set\_password() for improved performance with caching. |
  | 167 |  |  |
  | 168 |  | ~~= 3.1.6 =~~ |
  | 169 |  |  |
  | 170 |  | ~~\* Fixed [wpmem\_field] display handling for multiple select and multiple checkbox field types.~~ |
  | 171 |  | ~~\* Updates to always load fields from wpmem\_fields() API function.~~ |
  | 172 |  | ~~\* Updates to begin to utilize new fields settings array.  Fields setting is still store in the same array format as before.  However, it is loaded into the new settings format.  Current object class keeps numeric keys in place for legacy purposes.~~ |
  | 173 |  | ~~\* Updates to dropdown handling on main options tab to display proper preselected value when site is using ssl (https://) and no value is selected.~~ |
  | 174 |  | ~~\* Added wpmem\_loginout() API function, changed [wpmem\_loginout] shortcode to use API function.~~ |
  | 175 |  | ~~\* Added wpmem\_array\_insert() API function, allows for inserting array elements at any point in an array.~~ |
  | 176 |  | ~~\* Added wp\_destroy\_current\_session() to logout function.~~ |
  | 177 |  | ~~\* Added WooCommerce support in native WP registration functions. Began adding WooCommerce classes to registration form elements.~~ |
  | 178 |  | ~~\* Added to wpmem\_user\_has\_role() function to check for a single role or if the user has a role that is in an array of roles.~~ |
  | 179 |  | ~~\* Added wpmem\_shortcodes\_loaded, wpmem\_hooks\_loaded, and wpmem\_dropins\_loaded to fire after.~~ |
  | 180 |  | ~~\* Added text input to set a default 'read more' link for auto excerpt.~~ |
  | 181 |  | ~~\* Fixed issue with auto excerpt where an excerpt shorter than the excerpt setting would not display the more link.~~ |
  | 182 |  | ~~\* Preliminary updates to include placeholder support in fields (this will be an option in a future release).~~ |
  | 183 |  | ~~\* Localization fix of untranslated strings.~~ |
  | 184 |  | ~~\* Wrap "Remember Me" checkbox label with label tag in login form.~~ |
  | 185 |  | ~~\* Moved remaining initialization functions to class constructor.~~ |
  | 186 |  | ~~\* Moved wpmem\_load\_shortcodes, wpmem\_load\_hooks, and wpmem\_load\_dropins to fire before.~~ |
  | 187 |  | ~~\* reCAPTCHA version 1 is no longer supported by Google. It is now deprecated in the plugin. If you have reCAPTCHA v1 selected, it will remain so. But once this is changed to a different CAPTCHA setting or if this is a new install, reCAPTCHA version 1 will no longer be available as a selection.~~ |
  | 188 |  | ~~\* Custom field term "Option Name" changed to "Meta Key" for clarity.~~ |
  | 189 |  | ~~\* Marked required custom field properties as required in Add/Edit Field dialogs.~~ |
  | 190 |  | ~~\* Changed redirect\_to process to escape the url with esc\_url\_raw rather than esc\_url, otherwise query string variables do not get handled correctly.~~ |
  | 191 |  | ~~\* Fixes issue with displaying checkbox state on the admin user profile screen.~~ |
  | 192 |  | ~~\* Fixes issue with auto excerpt when excerpts are displayed on single posts/pages.~~ |
  | 193 |  | ~~\* Applies style properties for the remember me checkbox label to the default stylesheets. The label tag was added to this text in 3.1.6 (see below).~~ |
  | 194 |  | ~~\* Applies some admin strings for translation.~~ |
  | 195 |  |  |
  | 196 |  | ~~= 3.1.5 =~~ |
  | 197 |  |  |
  | 198 |  | ~~\* Addressed some security issues to prevent XSS vulnerabilities.~~ |
  | 199 |  | ~~\* Updated [wpmem\_show\_count] shortcode to include count of total blog users and users by role.  See: http://rkt.bz/xC~~ |
  | 200 |  | ~~\* Updated [wpmem\_field] shortcode to accept [wpmem\_field meta\_key] instead of [wpmem\_field field="meta\_key"] (although the latter will still work).  See http://rkt.bz/ae~~ |
  | 201 |  | ~~\* Updated [wpmem\_loginout] shortcode with some improvements to function code and link text attributes.  See: http://rkt.bz/29~~ |
  | 202 |  | ~~\* Updated auto excerpt for improved functionality, uses wp\_trim\_words(), deprecated add\_ellipsis, strip\_tags, close\_tags, parse\_shortcodes, strip\_shortcodes for filter (these were never documented so it is unlikely that anyone uses them).~~ |
  | 203 |  | ~~\* Updated hidden field type, now allows adding hidden fields to the registration form.~~ |
  | 204 |  | ~~\* Compartmentalized installation of initial settings.~~ |
  | 205 |  | ~~\* Field loader now validates settings, if none exist due to install error it will run the default fields install.~~ |
  | 206 |  | ~~\* Removed dialog setting downgrade on deactivation. Need to re-evaluate necessity of downgrading.~~ |
  | 207 |  | ~~\* Fixed issue with slash handling in Emails tab.~~ |
  | 208 |  | ~~\* Updated [wp-members] deprecated shortcode notice to include post/page information on where the shortcode is being used.~~ |
  | 209 |  |  |
  | 210 |  | ~~= 3.1.4 =~~ |
  | 211 |  |  |
  | 212 |  | ~~\* Change to the way the PayPal extension is integrated with the main plugin. This allows for some necessary filename changes in the extension.~~ |
  | 213 |  | ~~\* Added checks for PayPal extension function calls within the main plugin to avoid possible errors if it is deactivated.~~ |
  | 214 |  | ~~\* New wpmem\_is\_tab() API function checks the current tab in the plugin's admin panel.~~ |
  | 215 |  | ~~\* New wpmem\_is\_reg\_page() API function checks if the page the user registered on is the registration page.~~ |
  | 216 |  | ~~\* New wpmem\_load\_dropins() API function runs dropin load function.~~ |
  | 217 |  | ~~\* Documentation updates, cleaned up and addressed several @todo tags.~~ |
  | 218 |  | ~~\* Updated [wpmem\_field] shortcode to display display values instead of stored values for select (dropdown), multiple select, multiple checkbox, and radio group field types.~~ |
  | 219 |  | ~~\* Fixed bug in admin js file introduced when forgot username shortcode was added.~~ |
  | 220 |  | ~~\* Updates to reCAPTCHA2. Trims keys on save to avoid possible copy/paste whitespace issues, displays API error code(s) if WP\_DEBUG is turned on, change use of file\_get\_contents() to wp\_remote\_fopen() for broader acceptable use.~~ |
  | 221 |  |  |
  | 222 |  | ~~= 3.1.3 =~~ |
  | 223 |  |  |
  | 224 |  | ~~\* Fixed issue with display of [wp-members] field tag. Note: although this tag should remain operable, the tag is officially obsolete since 2.9.8 and should be used as [wpmem\_field].~~ |
  | 225 |  | ~~\* Fixed issue with calling PayPal extension functions if settings are enabled but the extension is disabled.~~ |
  | 226 |  | ~~\* Updated some admin-side strings for translation.~~ |
  | 227 |  | ~~\* Updated wpmem\_redirect\_to\_login() to \_\_not\_\_ check for wpmem\_is\_blocked(). Handling that outside the function will expand its usability.~~ |
  | 228 |  | ~~\* Updated row\_after logic in login form function so that it can be used for adding tags at the end of a row w/o adding a tag at the beginning.~~ |
  | 229 |  | ~~\* Updated widget to check for wpmem\_do\_sidebar() instead of obsolete wpmem() function.~~ |
  | 230 |  | ~~\* Updated email shortcodes used in new install.~~ |
  | 231 |  | ~~\* Added new utility function wpmem\_get() for checking posted variables and query strings with isset() and setting a default value.~~ |
  | 232 |  | ~~\* Added a nonce to register redirect by shortcode parameter. This will lead to being able to display a success message on the redirected page.~~ |
  | 233 |  | ~~\* Added redirect\_to argument in wpmem\_redirect\_to\_login().~~ |
  | 234 |  | ~~\* Added generic registration error message.~~ |
  | 235 |  | ~~\* Added [wpmem\_form forgot\_username] shortcode for displaying the forgot username form.~~ |
  | 236 |  |  |
  | 237 |  | ~~= 3.1.2 =~~ |
  | 238 |  |  |
  | 239 |  | ~~\* Minimum WordPress version increased to 3.6.~~ |
  | 240 |  | ~~\* Added user counts to user screen links (set as transient).~~ |
  | 241 |  | ~~\* Added redirect\_to parameter to wpmem\_login\_url().~~ |
  | 242 |  | ~~\* Added action parameter to wpmem\_profile\_url().~~ |
  | 243 |  | ~~\* Added echo argument to wpmem\_gettext().~~ |
  | 244 |  | ~~\* Added api function wpmem\_user\_pages() to return an array of the login, register, and profile page urls.~~ |
  | 245 |  | ~~\* Added shortcode [wpmem\_tos] for Terms of Service page url (replaces [wp-members page=tos url=http://mysite.com/path/to/tos/]).~~ |
  | 246 |  | ~~\* Added wpmem\_write\_log() function for writing notices to the WP error log.~~ |
  | 247 |  | ~~\* Added hide registration form parameter to wpmem\_profile shortcode: [wpmem\_profile register=hide].~~ |
  | 248 |  | ~~\* Added $defaults to wpmem\_sidebar\_status\_args. Now can pass $user\_login to be used in filters.~~ |
  | 249 |  | ~~\* Moved wpmem\_login\_status() to api.php.~~ |
  | 250 |  | ~~\* Deprecated [wp-members] shortcode, all other shortcodes no longer rely on wpmem\_shortcode().~~ |
  | 251 |  | ~~\* Fixed issue with pre-selected dropdown values to not select empty (separator) rows.~~ |
  | 252 |  | ~~\* Fixed field and custom shortcodes in email not being parsed.~~ |
  | 253 |  |  |
  | 254 |  | ~~= 3.1.1 =~~ |
  | 255 |  |  |
  | 256 |  | ~~\* Added downgrade function (currently runs on deactivation) to allow for version rollbacks.~~ |
  | 257 |  | ~~\* Added new dialogs functions to admin api, allows for custom dialogs to be added.~~ |
  | 258 |  | ~~\* Added $user\_id and $row to wpmem\_admin\_profile\_field and wpmem\_user\_profile\_field filters.~~ |
  | 259 |  | ~~\* Added new api class and api functions.~~ |
  | 260 |  | ~~\* Added [wpmem\_loginout] shortcode.~~ |
  | 261 |  | ~~\* Added support for new field types to native registration and users > add new (except file/image fields).~~ |
  | 262 |  | ~~\* Updated users > add new so that user can be activated when added.~~ |
  | 263 |  | ~~\* Updated [wpmem\_logged\_in] shortcode so that content is not shown on on a user profile page action.~~ |
  | 264 |  | ~~\* Updated email settings to only save new from/name if changed.~~ |
  | 265 |  | ~~\* Updated admin warning messges.~~ |
  | 266 |  | ~~\* Updated multiselect and multicheckbox fields to allow user selected delimiter (defaults to pipe "|").~~ |
  | 267 |  | ~~\* Fixes issue with profile update when file/image field is required.~~ |
  | 268 |  | ~~\* Fixes image field edit in fields tab to include file type.~~ |
  | 269 |  | ~~\* Fixes attribution setting for 3.0 settings array.~~ |
  | 270 |  | ~~\* Fixes for PHP7.~~ |
  | 271 |  |  |
  | 272 |  | ~~= 3.1.0 =~~ |
  | 273 |  |  |
  | 274 |  | ~~This package contains several fixes, some new filters, new field types and other functional improvements.~~ |
  | 275 |  |  |
  | 276 |  | ~~\* Some general code cleanup, reviewing inline documentation and comments.~~ |
  | 277 |  | ~~\* Fixed issue for sidebar with redirect\_to parameter set in widget settings.~~ |
  | 278 |  | ~~\* Fixed issue for custom error messages and email comparison error for profile update (so that errors show in form update state and not on links page).~~ |
  | 279 |  | ~~\* Fixed main options tab where checkbox may not display correct setting if unchecked.~~ |
  | 280 |  | ~~\* Fixed translation issue for required field error where all of the message except the field name was translated.~~ |
  | 281 |  | ~~\* Fixed issue for register shortcode page where if a user has registered, and is logging in but the login fails, display the login error message.~~ |
  | 282 |  | ~~\* Fixed register shortcode redirect parameter.~~ |
  | 283 |  | ~~\* Fixed confirm\_password to bypass sanitize\_text\_field (which breaks password comparison if certain characters are used).~~ |
  | 284 |  | ~~\* Added logic so that user\_pages are not blocked (login, register, user\_profile).~~ |
  | 285 |  | ~~\* Added after\_wrapper array value for wpmem\_{$page}\_links\_args filters~~ |
  | 286 |  | ~~\* Added a new admin api class, utilities object class, and forms object class.~~ |
  | 287 |  | ~~\* Added user facing strings as an array in the main $wpmem object class.~~ |
  | 288 |  | ~~\* Added wpmem\_default\_text\_strings filter for user facing text strings.~~ |
  | 289 |  | ~~\* Added new wpmem\_sidebar\_status\_args filter hook.~~ |
  | 290 |  | ~~\* Added new container in main object for email from and from name settings.~~ |
  | 291 |  | ~~\* Added file upload functions.~~ |
  | 292 |  | ~~\* Added new field types: multiple checkbox, multiple select, radio, file, image, email, url.~~ |
  | 293 |  | ~~\* Added "values" key to the register form rows array to hold possible values (i.e. select, multiple select, multiple checkbox, and radio group) and the actual value to be in the "value" key.~~ |
  | 294 |  | ~~\* Added the ability for dropdown/select fields to have a default value other than the first value.~~ |
  | 295 |  | ~~\* Added filter wpmem\_user\_upload\_dir for filtering the location of user uploaded files.~~ |
  | 296 |  | ~~\* Added wpmem\_register\_form\_rows\_admin and wpmem\_register\_form\_rows\_profile filter hooks.~~ |
  | 297 |  | ~~\* Deprecated use of wpmem\_chk\_qstr() function, use add\_query\_arg() instead.~~ |
  | 298 |  | ~~\* Deprecated use of get\_currentuserinfo() (deprecated in WP 4.5), use wp\_get\_current\_user() instead.~~ |
  | 299 |  | ~~\* Email function updates, added 'footer' as an array value in the main wpmem\_email\_filter filter.~~ |
  | 300 |  | ~~\* Changed install to set email/confirm\_email and user\_url as HTML5 field types "email" and "url" (now supported).~~ |
  | 301 |  | ~~\* Changed get\_action call from init action to template\_redirect action.~~ |
  | 302 |  | ~~\* Changed username in register form from log to user\_login to match wp native registration form.~~ |
  | 303 |  | ~~\* Changed [wp-members page="user-profile"] shortcode to [wpmem\_profile] (old shortcode will still work).~~ |
  | 304 |  | ~~\* Removed redirect parameter from register shortcode in shortcode menu.~~ |
  | 305 |  | ~~\* Removed kubrick stylesheet from selector (still packaged with download, shows as custom url if used).~~ |
  | 306 |  | ~~\* Changed all \_update\_ functions in install package to \_upgrade\_.~~ |
  | 307 |  | ~~\* Fixes an issue with PayPal extension where users may be set to pending if moderated registration is enabled after the user already has an expiration date.~~ |
  | 308 |  | ~~\* Update wpmem\_do\_sidebar to use use add\_query\_arg() if on a search query.~~ |
  | 309 |  |  |
  | 310 |  | ~~= 3.0.9 =~~ |
  | 311 |  |  |
  | 312 |  | ~~\* Added Custom Post Type support.~~ |
  | 313 |  | ~~\* Added wpmem\_member\_links\_args and wpmem\_register\_links\_args filters.~~ |
  | 314 |  | ~~\* Added $link parameter to wpmem\_forgot\_link\_str and wpmem\_reg\_link\_str filters (gives just the link as an available parameter).~~ |
  | 315 |  | ~~\* Added new wpmem\_sb\_reg\_link\_str and wpmem\_sb\_forgot\_link\_str filters (same format as above).~~ |
  | 316 |  | ~~\* Added [email] and [user-profile] shortcodes to the new user registration email.~~ |
  | 317 |  | ~~\* Added label\_text key to wpmem\_register\_form\_rows filter.~~ |
  | 318 |  | ~~\* Added new auto excerpt settings, can now be set by post type.~~ |
  | 319 |  | ~~\* Added new auto excerpt features including new wpmem\_auto\_excerpt\_args filter.~~ |
  | 320 |  | ~~\* Added forgot username retrieveal link (included on forgot password reset form).~~ |
  | 321 |  | ~~\* Added wpmem\_username\_link and wpmem\_username\_link\_str for filtering forgot username retrieval link.~~ |
  | 322 |  | ~~\* Added new upgrade process to WP\_Members object class.~~ |
  | 323 |  | ~~\* Fixed handling of post bulk actions to keep current screen (if one is used).~~ |
  | 324 |  | ~~\* Fixed handling of updates to the user pages in the options tab.~~ |
  | 325 |  | ~~\* Fixed handling of empty post object in is\_blocked() function.~~ |
  | 326 |  | ~~\* Improved email functions to eliminate get\_user\_meta() calls when not needed.~~ |
  | 327 |  |  |
  | 328 |  | ~~= 3.0.8 =~~ |
  | 329 |  |  |
  | 330 |  | ~~\* Added process for forgotten username retrieval.~~ |
  | 331 |  | ~~\* Removed last remaining instances of extract function.~~ |
  | 332 |  | ~~\* Updated settings for special pages (login|register|user-profile) to store only the numeric primary key ID. This will eliminate the need to update these settings if the site is moved (from a dev to live site, for example).  Legacy full URL settings will still be compatible without needing to be updated, but will be automatically updated when main options are saved.~~ |
  | 333 |  |  |
  | 334 |  | ~~= 3.0.7 =~~ |
  | 335 |  |  |
  | 336 |  | ~~\* Fix for use of display\_name on profile update.~~ |
  | 337 |  | ~~\* Fix for newer installs (post WP 4.0) where WPLANG is not defined and reCAPTCHA is used.~~ |
  | 338 |  | ~~\* Fix in wpmem\_form shortcode to skp if no additional tag exists.~~ |
  | 339 |  | ~~\* Fix to plugin\_basename.~~ |
  | 340 |  | ~~\* Changes in core to use fields from WP\_Members class (preparing for new form field process).~~ |
  | 341 |  | ~~\* Reviews and updates to code standards and inline documentation.~~ |
  | 342 |  | ~~\* Fix for password reset (typo in object name checking for moderated registration)~~ |
  | 343 |  | ~~\* Fix for PayPal extension (http://rkt.bz/r3); added logic to avoid errors if the PayPal extension is disabled but the main option setting remained turned on.~~ |
  | 344 |  |  |
  | 345 |  | ~~= 3.0.6 =~~ |
  | 346 |  |  |
  | 347 |  | ~~\* Updates to localization function - documented plugin\_locale filter, wpmem\_localization\_file filter, and improved load\_textdomain logic.~~ |
  | 348 |  | ~~\* Added /lang domain path to plugin header.~~ |
  | 349 |  | ~~\* Fixed a bug in the user export function that broke CSV columns when moderated registration was turned on.~~ |
  | 350 |  | ~~\* Improved current page retrieval in wpmem\_redirect\_to\_login() function.~~ |
  | 351 |  | ~~\* Fixed admin enqueued scripts (post/page screen hook did not load from new location).~~ |
  | 352 |  |  |
  | 353 |  | ~~= 3.0.5 =~~ |
  | 354 |  |  |
  | 355 |  | ~~\* Updated wpmem\_pwd\_change and wpmem\_pwd\_reset action hooks to include password as a parameter.~~ |
  | 356 |  | ~~\* Stylesheet updates for 2015, 2014, and generic (both float and no float).~~ |
  | 357 |  | ~~\* Fix to TinyMCE shortcode button, should now load button on new post/page editor.~~ |
  | 358 |  | ~~\* Added [WP-Members] to the TinyMCE shortcode button for clarity as to what it is.~~ |
  | 359 |  | ~~\* Moved admin js and css files to /admin/js/ and /admin/css/~~ |
  | 360 |  | ~~\* Moved admin class files to /admin/includes/~~ |
  | 361 |  | ~~\* Updated and verified all directories contain an index.php file to prevent directory browsing.~~ |
  | 362 |  |  |
  | 363 |  | ~~= 3.0.4 =~~ |
  | 364 |  |  |
  | 365 |  | ~~\* Reintroduced the global action variable $wpmem\_a for backward compatibility with certain add-ons, most notably the WP-Members MailChimp extension ( see http://rkt.bz/3b ). Users of this extension should upgrade.  This variable had been replaced with the new WP-Members object class introduced in 3.0. However, users of older extensions and those that may have customziations with logic may be using this variable, so rather than force updating and upgrading, it is being added back in.~~ |
  | 366 |  | ~~\* Change to the priority of functions hooked to the the\_content filter. Lowering the priority should better integrate the plugin with various builder plugins and other processes that currently filter the\_content after WP-Members since the content will now be filtered later in the process. This also should improve situations where in the past the on-the-fly texturization shortcode for the WP-Members forms might remain unparsed.~~ |
  | 367 |  |  |
  | 368 |  | ~~= 3.0.3 =~~ |
  | 369 |  |  |
  | 370 |  | ~~\* Bug fix recaptcha v2 decode json response on validation.~~ |
  | 371 |  | ~~\* Bug fix typo in $wpmem object name in admin/user-profile.php.~~ |
  | 372 |  | ~~\* Bug fix message string variable in wpmem\_msg\_dialog\_arr filter.~~ |
  | 373 |  | ~~\* Fix register form shortcode redirect\_to parameter.~~ |
  | 374 |  | ~~\* Admin forms now use submit\_button() function to generate submit button.~~ |
  | 375 |  | ~~\* Changed localization to load on init action which will allow for more flexibility with filtering custom language files.~~ |
  | 376 |  | ~~\* Added wpmem\_localization\_file and wpmem\_localization\_dir filters.~~ |
  | 377 |  | ~~\* Localization checks for file in /wp-content/ language directory first, then loads plugin default.~~ |
  | 378 |  |  |
  | 379 |  | ~~= 3.0.2 =~~ |
  | 380 |  |  |
  | 381 |  | ~~\* Added reCAPTCHA version 2 as an option. v1 will remain available for now, to be fully deprecated later.~~ |
  | 382 |  | ~~\* Fixed widget to use \_\_construct for WP 4.3 compatibility.~~ |
  | 383 |  | ~~\* Added error checking for WP reserved names when adding new custom fields.~~ |
  | 384 |  | ~~\* Added wpmem\_wp\_reserved\_terms filter for overriding reserved terms list.~~ |
  | 385 |  | ~~\* Added trim whitespace to password reset and password change form validation.~~ |
  | 386 |  |  |
  | 387 |  | ~~= 3.0.1 =~~ |
  | 388 |  |  |
  | 389 |  | ~~\* Fixed use of wp\_signon() for ssl.~~ |
  | 390 |  | ~~\* Fixed [wpmem\_msurl] email shortcode.~~ |
  | 391 |  | ~~\* Fixed admin js and css load (removed unnecessary slash).~~ |
  | 392 |  | ~~\* Fixed autoexcerpt to use setting from object and not wpmemembers\_autoex option.~~ |
  | 393 |  | ~~\* Added filter to remove comments array if content is blocked.~~ |
  | 394 |  |  |
  | 395 |  | ~~= 3.0.0 =~~ |
  | 396 |  |  |
  | 397 |  | ~~This release makes significant changes to the plugin's main options in the way they are stored. While care has been taken to make sure that you can roll back to a previous version, you may need to resave settings in the plugin's main options tab when attempting to roll back. It is advised that you test this update prior upgrading an existing install on a production site.~~ |
  | 398 |  |  |
  | 399 |  | ~~If you have any custom functions hooked to filters and actions that call any file includes directly from the plugin, please note that several file names have changed.~~ |
  | 400 |  |  |
  | 401 |  | ~~\* New settings and new plugin class WP\_Members.~~ |
  | 402 |  | ~~\* New settings now natively support Custom Post Types, both setting defaults and individual post blocking.~~ |
  | 403 |  | ~~\* Settings constants removed in favor of using the $wpmem object class.~~ |
  | 404 |  | ~~\* Added new|edit toggle to wpmem-register\_data filter hook.~~ |
  | 405 |  | ~~\* wpmem\_settings\_loaded action added.~~ |
  | 406 |  | ~~\* Securify comments changed to use comments\_open instead of comments\_template (with a blank template).~~ |
  | 407 |  | ~~\* New wpmem\_securify\_comments filter hook to customize whether comments load or not.~~ |
  | 408 |  | ~~\* Registration clear form button defaults to false.~~ |
  | 409 |  | ~~\* Removed wp\_set\_auth\_cookie from login function; it is already done as part of wp\_signon.~~ |
  | 410 |  | ~~\* Post meta box title filter is now for all post types wpmem\_admin\_{post type}\_meta\_title.~~ |
  | 411 |  | ~~\* New filter for Really Simple Captcha folder location: wpmem\_rs\_captcha\_folder.~~ |
  | 412 |  | ~~\* New shortcodes [wpmem\_form] added.~~ |
  | 413 |  | ~~\* Shortcode dropdown selector added to tinymce toolbar in Post/Page editor.~~ |
  | 414 |  | ~~\* Added redirect\_to as a function argument if calling wpmem\_logout() directly.~~ |
* ## [wp-members/trunk/wp-members.php](/changeset/1667369/wp-members/trunk/wp-members.php "Show the changeset 1667369 restricted to wp-members/trunk/wp-members.php")

  | [r1628757](/browser/wp-members/trunk/wp-members.php?rev=1628757#L4 "Show revision 1628757 of this file in browser") | [r1667369](/browser/wp-members/trunk/wp-members.php?rev=1667369#L4 "Show revision 1667369 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Plugin URI:  http://rocketgeek.com |
  | 5 | 5 | Description: WP access restriction and user registration.  For more information on plugin features, refer to <a href="http://rocketgeek.com/plugins/wp-members/users-guide/">the online Users Guide</a>. A <a href="http://rocketgeek.com/plugins/wp-members/quick-start-guide/">Quick Start Guide</a> is also available. WP-Members(tm) is a trademark of butlerblog.com. |
  | 6 |  | Version:     3.1.~~7~~ |
  |  | 6 | Version:     3.1.8 |
  | 7 | 7 | Author:      Chad Butler |
  | 8 | 8 | Author URI:  http://butlerblog.com/ |
  | […](/browser/wp-members/trunk/wp-members.php?rev=1628757#L63) | […](/browser/wp-members/trunk/wp-members.php?rev=1667369#L63) |  |
  | 63 | 63 |  |
  | 64 | 64 | // Initialize constants. |
  | 65 |  | define( 'WPMEM\_VERSION', '3.1.~~7~~' ); |
  |  | 65 | define( 'WPMEM\_VERSION', '3.1.8' ); |
  | 66 | 66 | define( 'WPMEM\_DEBUG', false ); |
  | 67 | 67 | define( 'WPMEM\_DIR',  plugin\_dir\_url ( \_\_FILE\_\_ ) ); |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=1667369)
* [Zip Archive](?format=zip&new=1667369)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from wordpress.org_f50827d5_20250125_212652.html ===


[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Showcase](https://wordpress.org/showcase/)
* [Hosting](https://wordpress.org/hosting/)
* Extend
  + [Themes](https://wordpress.org/themes/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Blocks](https://wordpress.org/blocks/)
  + [Openverse ↗︎](https://openverse.org/)
* Learn
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* Community
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [Events](https://events.wordpress.org/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* About
  + [About WordPress](https://wordpress.org/about/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
* [Get WordPress](https://wordpress.org/download/)

Search in WordPress.org

[Get WordPress](https://wordpress.org/download/)

[WordPress.org](https://wordpress.org/)

[Plugin Directory](https://wordpress.org/plugins/)

WP-Members Membership Plugin

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Fwp-members&locale=en_US)

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Fwp-members&locale=en_US)

Search plugins

![](https://ps.w.org/wp-members/assets/banner-772x250.png?rev=1195657)
![](https://ps.w.org/wp-members/assets/icon-256x256.png?rev=1226414)
# WP-Members Membership Plugin

By [Chad Butler](https://butlerblog.com/)

[Download](https://downloads.wordpress.org/plugin/wp-members.3.4.9.7.zip)

* [Details](https://wordpress.org/plugins/wp-members/#description)
* [Reviews](https://wordpress.org/plugins/wp-members/#reviews)
* [Installation](https://wordpress.org/plugins/wp-members/#installation)
* [Development](https://wordpress.org/plugins/wp-members/#developers)

[Support](https://wordpress.org/support/plugin/wp-members/)

## Description

The original membership plugin with content restriction, custom registration, and more.

### Membership Sites. Simplified.

You need a membership site, but you want to focus on your business, not mastering a plugin. WP-Members is simple to use, easy to set up, yet flexible in every way imaginable.

**Simple to install and configure – yet customizable and scalable!**

#### Features:

* Restrict or hide posts, pages, and custom post types
* Limit menu items to logged in users
* User login, registration, and profile integrated into your theme
* Create custom registration and profile fields
* Notify admin of new user registrations
* Hold new registrations for admin approval
* Create post excerpt teaser content automatically
* [Shortcodes for login, registration, content restriction, and more](https://rocketgeek.com/plugins/wp-members/docs/shortcodes/)
* Create powerful customizations with [more than 120 action and filter hooks](https://rocketgeek.com/plugins/wp-members/docs/filter-hooks/)
* [A library of API functions for extensibility](https://rocketgeek.com/plugins/wp-members/docs/api-functions/)

WP-Members allows you to restrict content as restricted or hidden, limiting access to registered users.

A full Users Guide is [available here](https://rocketgeek.com/plugins/wp-members/docs/). The guide outlines the installation process, and also documents how to use all of the settings.

#### Support

There is [freely available documentation on the plugin’s support site](https://rocketgeek.com/plugins/wp-members/docs/). Your question may be answered there. If you need assistance configuring the plugin or have questions on how to implement or customize features, [premium support is available](https://rocketgeek.com/product/wp-members-plugin-support/).

You can get priority support along with all of the plugin’s premium extensions in one [cost saving Pro Bundle!](https://rocketgeek.com/product/wp-members-pro-bundle/)

#### Premium Support

Premium support subscribers have access to priority email support, examples, tutorials, and code snippets that will help you extend and customize the base plugin using the plugin’s framework. [Visit the site for more info](https://rocketgeek.com/plugins/wp-members/support-options/).

#### Free Extensions

* [Stop Spam Registrations](https://rocketgeek.com/product/stop-spam-registrations/) – Uses stopforumspam.com’s API to block spam registrations.
* [Send Test Emails](https://rocketgeek.com/product/send-test-emails/) – A utility to send test versions of the plugin’s emails.

#### Premium Extensions

The plugin has several premium extensions for additional functionality. You can purchase any of them individually, or get them all for a significant discount in the Pro Bundle.

* [Advanced Options](https://rocketgeek.com/plugins/wp-members-advanced-options/) – adds additional settings to WP-Members for redirecting core WP created URLs, redirecting restricted content, hiding the WP toolbar, and more! Also includes integrations with popular plugins like WooCommerce, BuddyPress, bbPress, ADF, Easy Digital Downloads, and The Events Calendar.
* [Download Protect](https://rocketgeek.com/plugins/wp-members-download-protect/) – Allows you to restrict access to specific files, requiring the user to be logged in to access.
* [Invite Codes](https://rocketgeek.com/plugins/wp-members-invite-codes/) – set up invitation codes to restrict registration to only those with a valide invite code.
* [MailChimp Integration](https://rocketgeek.com/plugins/wp-members-mailchimp-integration/) – add MailChimp list subscription to your registation form.
* [Memberships for WooCommerce](https://rocketgeek.com/plugins/wp-members-memberships-for-woocommerce/) – Sell memberships through WooCommerce.
* [PayPal Subscriptions](https://rocketgeek.com/plugins/wp-members-paypal-subscriptions/) – Sell restricted content access through PayPal.
* [Security](https://rocketgeek.com/plugins/wp-members-security/) – adds a number of security features to the plugin such as preventing concurrent logins, registration form honey pot (spam blocker), require passwords be changed on first use, require passwords to be changed after defined period of time, require strong passwords, block registration by IP and email, restrict specified usernames from being registered.
* [Text Editor](https://rocketgeek.com/plugins/wp-members-text-editor/) – Adds an editor to the WP-Members admin panel to easily customize all user facing strings in the plugin.
* [User List](https://rocketgeek.com/plugins/wp-members-user-list/) – Display lists of users on your site. Great for creating user directories with detailed and customizable profiles.
* [User Tracking](https://rocketgeek.com/plugins/wp-members-user-tracking/) – Track what pages logged in users are visting and when.
* [WordPass Pro](https://rocketgeek.com/plugins/wordpass/) – Change your random password generator from gibberish to word-based passwords (can be used with or without WP-Members).

Get support along with all of the plugin’s premium extensions in one [cost saving Pro Bundle!](https://rocketgeek.com/product/wp-members-pro-bundle/)

## Screenshots

* [![](https://ps.w.org/wp-members/assets/screenshot-1.png?rev=830541)](https://ps.w.org/wp-members/assets/screenshot-1.png?rev=830541)

  The default when viewing a blocked post – the plugin will deliver a login screen and registration form in place of blocked content (this default can be changed to other options).
* [![](https://ps.w.org/wp-members/assets/screenshot-2.png?rev=1400806)](https://ps.w.org/wp-members/assets/screenshot-2.png?rev=1400806)

  Admin Panel – Options Tab – the various option settings for the plugin.
* [![](https://ps.w.org/wp-members/assets/screenshot-3.png?rev=830541)](https://ps.w.org/wp-members/assets/screenshot-3.png?rev=830541)

  Admin Panel – Fields Tab – the plugin field manager allows you to manage (or delete) the installed extra fields and field order, and also add your own custom fields.
* [![](https://ps.w.org/wp-members/assets/screenshot-4.png?rev=830541)](https://ps.w.org/wp-members/assets/screenshot-4.png?rev=830541)

  Admin Panel – Dialogs Tab – the major dialogs that the plugin uses for error and other messages can be edited in the plugin’s admin panel.
* [![](https://ps.w.org/wp-members/assets/screenshot-5.png?rev=830541)](https://ps.w.org/wp-members/assets/screenshot-5.png?rev=830541)

  Admin Panel – Emails Tab – all of the emails that are sent by the plugin can be edited in the admin panel.
* [![](https://ps.w.org/wp-members/assets/screenshot-6.png?rev=830541)](https://ps.w.org/wp-members/assets/screenshot-6.png?rev=830541)

  Posts > All Posts – The plugin adds a column to the list of posts and pages to display if a post or page is unblocked or blocked (the opposite of whatver you have set for the plugin’s default in the options tab).
* [![](https://ps.w.org/wp-members/assets/screenshot-7.png?rev=830541)](https://ps.w.org/wp-members/assets/screenshot-7.png?rev=830541)

  Posts > Edit Post – The plugin adds a meta box to the post/page editor allowing you to set an individual post to be blocked or unblocked (the opposite of whatver your default setting is).
* [![](https://ps.w.org/wp-members/assets/screenshot-8.png?rev=1168657)](https://ps.w.org/wp-members/assets/screenshot-8.png?rev=1168657)

  Responsive forms.

## Installation

WP-Members is designed to run “out-of-the-box” with no modifications to your WP installation necessary. Please follow the installation instructions below. **Most of the support issues that arise are a result of improper installation or simply not reading/following directions**.

#### Basic Install:

The best way to begin is to review the [Initial Setup Video](https://rocketgeek.com/plugins/wp-members/docs/videos/). There is also a complete [Users Guide available](https://rocketgeek.com/plugins/wp-members/docs/) that covers all of the plugin’s features in depth.

1. Upload the `/wp-members/` directory and its contents to the `/wp-content/plugins/` directory
2. Activate the plugin through the ‘Plugins’ menu in WordPress®

You are ready to begin using WP-Members. Now follow the instructions titled “Locking down your site” below.

#### Locking down your site:

* To restrict posts, you will need to use the `<!--more-->` link in your posts. Content above to the “more” split will display on summary pages (home, archive, category) but the user will be required to login to view the entire post. You may also use the plugin’s auto excerpt setting to create post excerpts automatically. If you do not use the “more” tag or the auto excerpt setting, full post content is going to show on archive templates, unless the post is marked as hidden.
* To begin restricting pages, change the plugin default setting for pages to be blocked. Unlike posts, the `<!--more-->` link is not necessary in the blocking of pages, but **must** be used if you have the “show excerpts” setting turned on for pages.
* To protect comments, we recommend setting “Users must be registered and logged in to comment” under Settings > Discussion.
* On the Settings > General page, it is recommended that you uncheck “Anyone can register”. While not required, this will prevent WP’s native registration from colliding with WP-Members, especially if you are using any of the WP-Members additional registration fields.
* Under Settings > Reading, “For each article in a feed, show” is recommended to be set to “Summary.” WordPress installs with full feed settings by default. If you don’t change this, your feeds will show full content.

#### Additional Setup Information

There are also some special pages that can be created with simple shortcodes:

* A User Profile page where registered members can edit their information and change/reset their password: [wpmem\_profile]
* A Registration page available for those that need a specific URL for registrations (such as email marketing or banner ad landing pages). Note: this is strictly optional as a registration form can also be included by default on blocked content pages: [wpmem\_form register]
* A Login page. This is also an optional page as the login form is included by default on blocked content. But if you need a specific login page, this can be created with a simple shortcode: [wpmem\_form login]
* [And more shortcodes are available](https://rocketgeek.com/plugins/wp-members/docs/shortcodes/)!

Powerful cusotmizations can be constructed with [over 120 action and filter hooks](https://rocketgeek.com/plugins/wp-members/docs/filter-hooks/), as well as user accessible functions.

## FAQ

The FAQs are maintained at https://rocketgeek.com/plugins/wp-members/docs/faqs/

## Reviews

![](https://secure.gravatar.com/avatar/a1b33378077ddc9cf338bd004eb7c48c0a565320869aeecfab6adf7625790398?s=60&d=retro&r=g)
### [Nope, not flexible nor easy to setup and use](https://wordpress.org/support/topic/nope-not-flexible-nor-easy-to-setup-and-use/)

[Avrom](https://profiles.wordpress.org/dividendninja/ "Posts by Avrom")
October 15, 2024
1 reply

“You need a membership site, but you want to focus on your business, not mastering a plugin. WP-Members is simple to use, easy to set up, yet flexible in every way imaginable.”
Well, actually no – on all those accounts. This is not simple or easy to use, and certainly not flexible in every way. Very time consuming and laborious to setup pages (since you have to keep going to settings to get to the plugin dashboard). Doesn’t even have the option to show in the WP menu. No, it’s not flexible.
For example you want a registration form, but you don’t want it everywhere on restricted pages – nope you can’t do that. Your going to get the registration form below every login box. I suppose I can make it work, but man its going to be a ton of work.
For the amount of time it would take to set all this up and figure it out, I will look at other options.

![](https://secure.gravatar.com/avatar/5ce8b63111bffcfd6d02273097c2340f37f89790d1e6ed618b65f96b5ef1f4fa?s=60&d=retro&r=g)
### [A Great plugin & Great support](https://wordpress.org/support/topic/a-great-plugin-great-support/)

[qgxruyfnhjfqtdi](https://profiles.wordpress.org/qgxruyfnhjfqtdi/ "Posts by qgxruyfnhjfqtdi")
October 7, 2024

The documentation and video’s make it very logical and easy to set up which is great.
On top of that any support questions are answered quickly and helpfully. The product works well and does what it says. I am very satisfied and feel confident any query along the way will be answered well. After looking around the various membership options available I am glad to have chosen WP Members.

![](https://secure.gravatar.com/avatar/fe0db0f1a7b8962c90f9ece5a7a913a654ddb253f038ed24fd04a6fcb1c285fe?s=60&d=retro&r=g)
### [Excellent plugin and support](https://wordpress.org/support/topic/excellent-plugin-and-support-593/)

[LS](https://profiles.wordpress.org/lsterling03/ "Posts by LS")
August 26, 2024
1 reply

I’ve used WP-Members many times. Highly recommend. It does a lot for a free plugin, especially if you know what you’re doing with the action and filter hooks. The pro-support plan is highly recommended if you will be making more extensive customizations. Access to the code snippet library really speeds up development. And when I’ve needed more assistance, the support I have received has truly been top-notch and sets WP-Members apart from other plugins. I like that it’s not bloated with things I don’t need, but has the ability to be expanded.

![](https://secure.gravatar.com/avatar/2b57d3279324b9a723349927b7f07f3b28e529cb07d770020e3b88f3f43d1c59?s=60&d=retro&r=g)
### [Works great so far.](https://wordpress.org/support/topic/works-great-so-far-51/)

[michaeljgibson](https://profiles.wordpress.org/michaeljgibson/ "Posts by michaeljgibson")
June 19, 2024

WP-Members seems to work great so far. I have only tested it with a local build on a demo web application, and it took me a bit of poking around to figure out all the options, but, at this point, I am pleased with how it works

![](https://secure.gravatar.com/avatar/f77bb27216222cb15c71fb66b001961cfc51d7fa9a2bfb72f0af0b1c90f015b3?s=60&d=retro&r=g)
### [Highly Recommended – Great Plugin Suite, Best Support](https://wordpress.org/support/topic/highly-recommended-great-plugin-suite-best-support/)

[edtorrey](https://profiles.wordpress.org/edtorrey/ "Posts by edtorrey")
June 9, 2024

2024-06-09: Rocketgeek continues to impress as a quality plugin accompanied by excellent support. I use many of the available extensions to enhance to functionality on my several public facing commercial websites. One of the most powerful is the front-end content access control afforded by the Membership feature; formerly called Product. Highly recommended.
12 Jan 2016: I replaced my earlier rating. If you are looking for a membership with rich access control management for WordPress, You have to give WP\_Members a close look. The quality of the build, rich feature inventory, and highest level support make this choice Top Shelf. Paid Support is very low cost and gives access to additional resources that speak volumes for Chad Butler, Plug-in Author. Great Product. Great Value. You’ll wonder how you lived without it. (I was not compensated in any way for this rating. Just very happy with the product.)

![](https://secure.gravatar.com/avatar/5e8bcc8bcece6f3766cc6e01dfca701869ffa600baa18d5afe289f57d12a9ebb?s=60&d=retro&r=g)
### [Great Membership Plugin](https://wordpress.org/support/topic/great-membership-plugin-8/)

[ibc3](https://profiles.wordpress.org/ibc3/ "Posts by ibc3")
May 21, 2024

I have been using WP-Members for years on several client websites. It is flexible and provides many features. Highly recommend. Great support, too!

[Read all 264 reviews](https://wordpress.org/support/plugin/wp-members/reviews/)
## Contributors & Developers

“WP-Members Membership Plugin” is open source software. The following people have contributed to this plugin.

Contributors

* ![](https://secure.gravatar.com/avatar/eb26ebe749779cf4dc946c841d61a0987eaface0a59c43d6bfdf2bf983711a77?s=32&d=mm&r=g) [Chad Butler](https://profiles.wordpress.org/cbutlerjr/)

“WP-Members Membership Plugin” has been translated into 20 locales. Thank you to [the translators](https://translate.wordpress.org/projects/wp-plugins/wp-members/contributors) for their contributions.

[Translate “WP-Members Membership Plugin” into your language.](https://translate.wordpress.org/projects/wp-plugins/wp-members)

### Interested in development?

[Browse the code](https://plugins.trac.wordpress.org/browser/wp-members/), check out the [SVN repository](https://plugins.svn.wordpress.org/wp-members/), or subscribe to the [development log](https://plugins.trac.wordpress.org/log/wp-members/) by [RSS](https://plugins.trac.wordpress.org/log/wp-members/?limit=100&mode=stop_on_copy&format=rss).

## Changelog

#### 3.5.0

* WP-Members pluggable deprecated for use in theme functions.php (wpmem will be initialized when plugins are loaded). If you have any WP-Members pluggable functions that load in the theme functions.php, you’ll need to move these to another location, such as a custom plugin file. Keep in mind, pluggable functions are no longer the preferred way of customizing (and have not been for many years) as most customizations, if not all, can be handled by using the plugin’s filter and action hooks.

#### 3.4.9.7

* Fixes a bug in the WooCommerce restricted product function that unintentionally restricts all products.
* Fixes an undefined property ($style) in the main WP\_Members object class.
* Fixes escaped HTML in the logged in state of the sidebar widget (a bug introduced in 3.4.9.6).
* Fixes escaped query string in password reset link and validation link (a bug introduced in 3.4.9.6).

#### 3.4.9.6

* Additional output escaping in the TOS dialog and the login/logout link function.
* Updated packaged jQuery UI styles (1.14.0).

#### 3.4.9.5

* Fixes a bug in the 3.4.9.4 release in an unannounced filter hook (that will be part of 3.5.0)

#### 3.4.9.4

* Adds index.php to user upload directories to prevent directory browsing if not specifically disabled elsewhere.
* Define $woo\_connector object variable for PHP 8.2+ with the premium WooCommerce integration extension.

#### 3.4.9.3

* Additional output escaping for user profile class.

#### 3.4.9.2

* Early patch fix for export if memberships are enabled but there are no memberships defined (from 3.5.0 included fixes).
* Early patch fix for fields data list in admin notification email if HTML formatted email is enabled (from 3.5.0 included fixes).
* Security review and patches: Review shortcode object class for sanitizing all shortcode attributes and escaping all output.
* Security review and patches: Review admin user profile class for sanitizing all input and escaping all output.

#### 3.4.9.1

* Update the allowed fields in the [wpmem\_fields] shortcode when enabled.
* Update WP version compatibility.

#### 3.4.9

* Security update for the [wpmem\_fields] shortcode. See the release notes on the support site for more detail.
* Adds wpmem\_field\_sc\_meta\_keys filter hook to filter meta keys allowed by the [wpmem\_fields] shortcode (default: fields that are in the WP-Members Fields array).
* Adds wpmem\_is\_login(), wpmem\_is\_register(), and wpmem\_is\_profile() conditional functions.

#### 3.4.8

* Fixes a 3.4.7 bug that causes “extra” user fields to not save option to add to user screen (users > all users).
* Fixes a 3.4.7 bug that throws a php error when saving settings in the main options tab.
* Fixes bug in 3.4.7 that causes custom fields array to be overwritten as empty when updating fields in the plugin’s Fields tab.
* Fixes issues with updating WP-Members WooCommerce integration settings in the main WP-Members options tab.
* Security update in Fields tab reorder processing.
* Code improvement udpates to RS Captcha validation processing.
* Adds wpmem\_get\_form\_state() API function (replaces checking $wpmem->regchk directly).

#### 3.4.7

* Code improvement and database upgrade for admin user search functions; removes the wp\_wpmembers\_user\_search\_keys table and replaces it with wp\_wpmembers\_user\_search\_crud.
* Code improvement in the password reset function for situations where an error may result in an empty user object.
* Code improvement in REST API filtering of blocked content for situations where there may be additional (i.e. custom) values (such as those created by page builders).
* Code improvement in hidden posts checking in case the “post\_\_not\_in” query\_var is not set.
* Code improvement to make sure required fields are required for the wp user profile, but allowable to be skipped by an admin.
* Code improvement to make sure all object variables are declared for php 8.2.
* Added timestamp field type.
* Added wpmem\_get\_membership\_id() API function.
* Added wpmem\_get\_membership\_slug() API function.
* Added wpmem\_is\_enabled() API function for checking if specific settings are enabled.
* Added “select all” option to several fields columns in the Fields tab.
* Added previous data array when updating user fields, can be used in filters to check for changes.
* Added ability to make WooCommerce products not purchaseable.
* Added wpmem\_user\_memberships shortcode to display a user’s memberships.
* Added wpmem\_user\_membership\_posts shortcode to display a list of membership restricted posts available to a user.
* Moved WooCommerce options out of “new feature” settings and expanded options.
* Added option to add WP-Members fields to the WooCommerce My Account user profile update.
* Added option to restrict WooCommerce product purchase if the product is set as restricted (requires that WC “product” custom post type be enabled for WP-Members).
* Added wpmem\_remove\_membership\_from\_post() to the API.
* Fix bug in wpmem\_add\_membership\_to\_post().

#### 3.4.6

* Fixes a bug in the user profile update object class that prevented non-admin users from updating WP-Members custom fields in the dashboard profile view.
* Fixes some logic in the registration/profile update to check for a valid $user object (if it’s a profile). It is rare that it wouldn’t be, but this is a “just in case” to avoid unnecessary php notice errors.
* Adds wpmem\_get\_user\_by\_meta() API function to retrieve a $user object by user meta (WP’s get\_user\_by() only does username, email, and ID).
* Adds wpmem\_add\_membership\_to\_post() API function to programmatically add a membership to a post. Can be used for bulk and on-the-fly post restriction.
* Adds wpmem\_add\_membership\_to\_posts() API functions to programmatically add a membership to a group of posts (an array of IDs or comma separated IDs). Can be used for bulk and on-the-fly post restriction.
* Adds wpmem\_create\_membership() API function to programmatically create a membership. Can be used to create new memberships when hooked to other actions.
* Adds wpmem\_create\_username\_from\_email() API function. If WooCommerce is installed, it will use the WC process, otherwise it uses a email user + number process until it finds a unique value.
* Adds wpmem\_login\_link(), wpmem\_get\_login\_link(), wpmem\_reg\_link(), and wpmem\_get\_reg\_link() for getting and displaying links to these identified pages (based on plugin’s settings).
* Adds rktgk\_wp\_parse\_args() to general plugin API. This is a utility function that functions like WP’s wp\_parse\_args(), but is fully recursive (which wp\_parse\_args() is not).
* Adds rktgk\_get\_row() to the general plugin API. This is a utility that functions like WP’s wpdb::get\_row(), but incrporates wpdb::prepare() by default (saving a necessary step).
* Updates rktgk\_build\_html\_tag() in the general plugin API to include an “echo” parameter to automatically print result to screen (false by default).
* Adds two new dialog message strings for acct\_not\_approved & acct\_not\_validated.
* Adds $tag for the form being generated in the wpmem\_{$form}\_defaults set of filters (login|changepassword|resetpassword|forgotusername).
* Adds author ID support for [wpmem\_field] shortcode to display user meta data based on the post/page author ID (rather than the current user or querystring user).
* Adds filter support for “shortcode\_atts\_wpmem\_profile”
* Improve message handling for password reset when moderated registration and confirmation link settings are enabled (and the user is not activated or confirmed).

#### 3.4.5

* 3.4.4 is not compatible with [WP-Members Advanced Options](https://rocketgeek.com/plugins/wp-members-advanced-options/) when redirect to login is used. This version corrects that issue by rolling back the change to only load membership restriction functions when the membership products setting is enabled.
* Adds wpmem\_login\_form\_button\_rows filter hook.
* Adds wpmem\_pwd\_reset\_email\_link filter hook
* Adds API functions wpmem\_profile\_url(), wpmem\_pwd\_reset\_url(), wpmem\_register\_url(), wpmem\_forgot\_username\_url().
* Adds API functions wpmem\_get\_membership\_name(), wpmem\_get\_membership\_meta(), wpmem\_get\_membership\_post\_list(), wpmem\_get\_post\_memberships(), wpmem\_get\_memberships().
* Adds API functions wpmem\_add\_query\_where(), wpmem\_get\_query\_where(), wpmem\_add\_user\_view\_link(), wpmem\_get\_user\_view\_link(), wpmem\_get\_user\_view\_count().
* Updates user views to use new API functions and adds capability to more easily customize user views.
* Code improvement: update instances of deprecated function wpmem\_gettext() to use wpmem\_get\_text().
* Code improvement: update wpmem\_user\_has\_role(), $current\_user global no longer necessary.
* Code improvement: update select2 library to version 4.1.0.
* CSS update: defines columns widths for Settings > WP-Members > Fields table.

#### 3.4.4

* Adds excerpt to membership restricted content when excerpts are used and the user is logged in (should work the same as blocked content for a non-logged in user).
* Adds excerpt to wpmem\_product\_restricted\_args arguments to be edited or removed using the filter.
* Adds [memberships] shortcode for admin notification email; this will include a list of memberships for the user in admin notification.
* Fixes potential issue with [wpmem\_field] shortcode if field does not have a defined type.
* Updates to [wpmem\_profile] and [wpmem\_form password] for improved password reset.
* Moves password reset link actions to template\_redirect action. This should resolve issues that occur when multiple instances of the\_content are run (i.e. the appearance of an invalid key message upon completing the password reset).
* Moves export class to main user object (previously loaded from admin files). @todo Export class file also remains in admin for backward compatibility if file is called directly.
* Moves admin object load (back) to “init” action (from “admin\_init”) as later load can cause problems with extensions loading on the “wpmem\_after\_admin\_init” action.
* Load dependencies after settings are loaded (allows for conditional loading of certain dependencies).
* Load membership/product restriction only if membership products setting is active.

#### 3.4.3

* Simplified check\_validated() and check\_activated() functions, included check for null $user.
* Added wpmem\_check\_validated and wpmem\_check\_activated filter hooks.
* Added display=”url” attribute to the [wpmem\_field] shortcode for file and image field types.
* Fix undefined variable in password reset.
* Improve onboarding process for both new installs and updates.

#### 3.4.2

* Applies checkbox CSS in add new user form.
* Code consolidation in admin options tab file (remove final use of wpmem\_use\_ssl()).
* Add wpmem\_recaptcha\_url filter to allow for changing the URL of the recaptcha script.
* Only apply pwd reset override on frontend (for login error).
* Fixes undefined $wpmem->reg\_form\_showing.
* Fixes a bug in the password change shortcode that causes a “too few arguments” error.
* Changes wpmem\_is\_user\_current() to wpmem\_user\_is\_current() for backwards compatibility with the plugin’s premium PayPal extension.
* Added the action being done as a parameter passed to the wpmem\_get\_action action hook.
* Added support for arrays, urls, and classes to wpmem\_sanitize\_field() (alias of rktgk\_sanitize\_field()). This is in addition to the sanitization already supported.
* apply\_custom\_product\_message() now runs do\_shortcode() to natively support shortcodes in custom membership product messages.
* Fixed an issue that did not display the custom product message if the user was not logged in.
* Improved custom product message for non-logged in state (same function is used by both logged in and logged out processes, so cleaned up to handle both states the same).
* Bug fix in password reset that potentially truncates the reset link.
* Bug fix in admin notification email for HTML formatted email (wpautop() was not being applied to email content).
* Bug fix in wpmem\_is\_reg\_type() that returned invalid object var.
* Added email arg for default linebreak.
* Added user ID to email filters.
* Added id, class, and wrapper attributes to [wpmem\_logged\_in] shortcode (wrapper defaults to “div” but can be changed to “span” or “p” or something else).
* Added user confirmed field to default export fields (if confirmation link setting is enabled).
* Added wpmem\_set\_user\_membership(), wpmem\_remove\_user\_membership(), and wpmem\_get\_user\_memberships() API functions.
* Introduces new installer/onboarding for both new installs and upgrades.

#### 3.4.1

* Revise the membership hierarchy logic (see release announcement for details).
* Changing “Product” text to “Membership” for clarity (was planned for 3.4.0).
* Changing “Block” text to “Restricted” for clarity (was planned for 3.4.0).
* Added wpmem\_is\_user\_current() api function.
* Added attachements to email function.
* Added wpmem\_email\_attachments filter.
* Moves external libraries to “vendor” directory.
* Removes a overlooked use of wpmem\_page\_pwd\_reset() which was deprecated as of 3.4.0.
* Sanitize email as email, not text.
* Fixes a bug in the user api for undefined variable when checking the user ip.
* Fixes a bug in 3.4.0 that causes an error in user export.
* Fixes a bug in 3.4.0 that causes the captcha validation to be run twice, resulting in failed captcha during registration.
* Fixes css issue that caused cursor change on all list table screens for drag-and-drop; should only show on Fields tab.

#### 3.4.0

Here is a list of changes in 3.4.0, but for a more detailed look at the impact of some of these items, be sure to review https://rocketgeek.com/release-announcements/wp-members-3-4-0-wow/

* Rebuilds the login widget functions so there are filter hooks that more closely mimic the main body login filters. Every attempt was made to provide an HTML result that is the same as previous versions, as well as providing support for legacy dialog tags.
* Rebuilt and revised user export functionality. Now includes an api function that can be used to customize user exports for a variety of uses.

New Feature Settings:

\* The default password reset process is now the reset link. New installs will automatically have this setting. Existing installs can change to this by toggling the setting to use the legacy option in Settings > WP-Members > Options > New Features.

\* The default new registration process now uses the email confirmation link. A user must confirm their email address prior to their account being able to log in. New installs will automatically have this setting, but you may opt to use the legacy option by changing the setting in Settings > WP-Members > Options > New Features.

\* The default emails at install reflect the above changes. Existing installs as always will not have their email content altered by the upgrade script.

* Post restricted message now completely separate from login form.
* Post restricted message now has new wrapper id – #wpmem\_restricted\_msg
* Improved redirect\_to handling in login and register forms. Can now specify a page by slug alone in the shortcode param for portability.
* Improved Google reCAPTCHA v3 (“invisible captcha”) to optionally display on all pages (recommended by Google to improve user “score”).
* Improved forms display in Customizer, now can view forms on blocked content (not just shortcode pages).
* Improved functionality of hidden posts. Now saved in WP settings (options) instead of as a transient.
* Improved user count transient. Now expires in 5 minutes instead of 30 seconds (will result in fewer loads of the query).
* Membership products now support hierarchy. This can be used for “levels” or for multiple expiration periods yet still only have to assign one membership to content for all child memberships.
* HTML email for WP-Members emails can be enabled as an option in the Emails tab.
* Login failed dialog now displays login form below the error. Removed “continue” (return) link from default message.
* Login failed dialog (#wpmem\_msg) text centered in stylesheet instead of applying in the div tag. Best way to customize is using the WP Customizer.
* Updates to export function.

  + deprecated ‘export\_fields’, use ‘fields’ instead.
* Clone menus is deprecated. The setting remains in place for users who have it enabled. But if it is not enabled, the setting is no longer available.
* Expands Customizer functionality so logged out forms show on blocked content (not just shortcodes).
* Adds integration for WP’s “registration\_errors” filter hook, allowing for standarized custom validation and integration with other plugins.

New API functions:

\* wpmem\_is\_reg\_form\_showing()

Deprecated functions:

\* wpmem\_inc\_loginfailed()

\* wpmem\_inc\_regmessage()

\* wpmem\_inc\_login()

\* wpmem\_page\_pwd\_reset()

\* wpmem\_page\_user\_edit()

\* wpmem\_page\_forgot\_username()

\* wpmem\_inc\_memberlinks()

\* wpmem\_gettext() – use wpmem\_get\_text() instead.

\* $wpmem->texturize()

Bug fixes:

\* Fixes a bug in the signon process that causes the “rememberme” option to be ignored.

\* Fixes a bug in wpmem\_is\_blocked() that returns false when checking a specific post ID.

\* Fixes a bug in the autoexcerpt function that caused a double “read more” link when excerpt length was set to zero.

## Meta

* Version **3.4.9.7**
* Last updated **3 months ago**
* Active installations **60,000+**
* WordPress version **4.0 or higher**
* Tested up to **6.6.2**
* Languages
  See all 21

  Close

  [Chinese (Hong Kong)](https://zh-hk.wordpress.org/plugins/wp-members/), [Chinese (Taiwan)](https://tw.wordpress.org/plugins/wp-members/), [Czech](https://cs.wordpress.org/plugins/wp-members/), [Dutch](https://nl.wordpress.org/plugins/wp-members/), [English (US)](https://wordpress.org/plugins/wp-members/), [French (France)](https://fr.wordpress.org/plugins/wp-members/), [German](https://de.wordpress.org/plugins/wp-members/), [German (Switzerland)](https://de-ch.wordpress.org/plugins/wp-members/), [Hungarian](https://hu.wordpress.org/plugins/wp-members/), [Italian](https://it.wordpress.org/plugins/wp-members/), [Japanese](https://ja.wordpress.org/plugins/wp-members/), [Korean](https://ko.wordpress.org/plugins/wp-members/), [Norwegian (Bokmål)](https://nb.wordpress.org/plugins/wp-members/), [Persian](https://fa.wordpress.org/plugins/wp-members/), [Portuguese (Brazil)](https://br.wordpress.org/plugins/wp-members/), [Romanian](https://ro.wordpress.org/plugins/wp-members/), [Russian](https://ru.wordpress.org/plugins/wp-members/), [Spanish (Mexico)](https://es-mx.wordpress.org/plugins/wp-members/), [Spanish (Spain)](https://es.wordpress.org/plugins/wp-members/), [Spanish (Venezuela)](https://ve.wordpress.org/plugins/wp-members/), and [Swedish](https://sv.wordpress.org/plugins/wp-members/).

  [Translate into your language](https://translate.wordpress.org/projects/wp-plugins/wp-members)
* Tags [authentication](https://wordpress.org/plugins/tags/authentication/)[login](https://wordpress.org/plugins/tags/login/)[membership](https://wordpress.org/plugins/tags/membership/)[registration](https://wordpress.org/plugins/tags/registration/)[Restriction](https://wordpress.org/plugins/tags/restriction/)
* [Advanced View](https://wordpress.org/plugins/wp-members/advanced/)

## Ratings

4.6 out of 5 stars.

* [228 5-star reviews
  5 stars

  228](https://wordpress.org/support/plugin/wp-members/reviews/?filter=5)
* [10 4-star reviews
  4 stars

  10](https://wordpress.org/support/plugin/wp-members/reviews/?filter=4)
* [7 3-star reviews
  3 stars

  7](https://wordpress.org/support/plugin/wp-members/reviews/?filter=3)
* [3 2-star reviews
  2 stars

  3](https://wordpress.org/support/plugin/wp-members/reviews/?filter=2)
* [16 1-star reviews
  1 star

  16](https://wordpress.org/support/plugin/wp-members/reviews/?filter=1)

[Add my review](https://wordpress.org/support/plugin/wp-members/reviews/#new-post)

[See all reviews](https://wordpress.org/support/plugin/wp-members/reviews/)

## Contributors

* ![](https://secure.gravatar.com/avatar/eb26ebe749779cf4dc946c841d61a0987eaface0a59c43d6bfdf2bf983711a77?s=32&d=mm&r=g) [Chad Butler](https://profiles.wordpress.org/cbutlerjr/)
## Support

Issues resolved in last two months:

1 out of 6

[View support forum](https://wordpress.org/support/plugin/wp-members/)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Privacy](https://wordpress.org/about/privacy/)

* [Showcase](https://wordpress.org/showcase/)
* [Themes](https://wordpress.org/themes/)
* [Plugins](https://wordpress.org/plugins/)
* [Patterns](https://wordpress.org/patterns/)

* [Learn](https://learn.wordpress.org/)
* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [WordPress.tv ↗](https://wordpress.tv/)

* [Get Involved](https://make.wordpress.org/)
* [Events](https://events.wordpress.org/)
* [Donate ↗](https://wordpressfoundation.org/donate/)
* [Five for the Future](https://wordpress.org/five-for-the-future/)

* [WordPress.com ↗](https://wordpress.com/?ref=wporg-footer)
* [Matt ↗](https://ma.tt/)
* [bbPress ↗](https://bbpress.org/)
* [BuddyPress ↗](https://buddypress.org/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our X (formerly Twitter) account](https://www.x.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)
* [Visit our YouTube channel](https://www.youtube.com/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from jvn.jp_4abae5bd_20250125_212643.html ===


![Japan Vulnerability Notes](/common/img/note_logo.gif)

Published:2017/06/13  Last Updated:2017/06/13
# JVN#51355647 WordPress plugin "WP-Members" vulnerable to cross-site scripting

## Overview

The WordPress plugin "WP-Members" contains a cross-site scripting vulnerability.

## Products Affected

* WP-Members prior to version 3.1.8

## Description

The WordPress plugin "WP-Members" contains a cross-site scripting vulnerability ([CWE-79](//cwe.mitre.org/data/definitions/79.html)).

## Impact

An arbitrary script may be executed on a logged in user's web browser.

## Solution

**Update the plugin**

Update the plugin according to the information provided by the developer.

## Vendor Status

| Vendor | Link |
| --- | --- |
| Chad Butler | [Changeset 1667369 â WordPress Plugin Repository](https://plugins.trac.wordpress.org/changeset/1667369/#file12) |
|  | [WordPress Plugins - WP-Members: Membership Framework - Changelog](https://wordpress.org/plugins/wp-members/#developers) |

## References

## JPCERT/CC Addendum

## Vulnerability Analysis by JPCERT/CC

CVSS v3
CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N
Base Score:
6.1

| Attack Vector(AV) | Physical (P) | Local (L) | Adjacent (A) | Network (N) |
| --- | --- | --- | --- | --- |
| Attack Complexity(AC) | High (H) | Low (L) |
| Privileges Required(PR) | High (H) | Low (L) | None (N) |
| User Interaction(UI) | Required (R) | None (N) |
| Scope(S) | Unchanged (U) | Changed (C) |
| Confidentiality Impact(C) | None (N) | Low (L) | High (H) |
| Integrity Impact(I) | None (N) | Low (L) | High (H) |
| Availability Impact(A) | None (N) | Low (L) | High (H) |

CVSS v2
AV:N/AC:H/Au:N/C:N/I:P/A:N
Base Score:
2.6

| Access Vector(AV) | Local (L) | Adjacent Network (A) | Network (N) |
| --- | --- | --- | --- |
| Access Complexity(AC) | High (H) | Medium (M) | Low (L) |
| Authentication(Au) | Multiple (M) | Single (S) | None (N) |
| Confidentiality Impact(C) | None (N) | Partial (P) | Complete (C) |
| Integrity Impact(I) | None (N) | Partial (P) | Complete (C) |
| Availability Impact(A) | None (N) | Partial (P) | Complete (C) |

## Credit

Chris Liu reported this vulnerability to IPA.

JPCERT/CC coordinated with the developer under Information Security Early Warning Partnership.

## Other Information

| JPCERT Alert |  |
| --- | --- |
| JPCERT Reports |  |
| CERT Advisory |  |
| CPNI Advisory |  |
| TRnotes |  |
| CVE | [CVE-2017-2222](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-2222) |
| JVN iPedia | [JVNDB-2017-000132](http://jvndb.jvn.jp/jvndb/JVNDB-2017-000132) |

* JVN
* [HOME](/en/index.html)
* [What is JVN ?](/en/nav/jvn.html)
* [Instructions](/en/nav/jvnhelp.html)
* [List of Vulnerability Report](/en/report/index.html)
* [VN\_JP](/en/jp/index.html)
* [VN\_JP(Unreachable)](/en/adj/index.html)
* [VN\_VU](/en/vu/index.html)
* [TA](/en/ta/index.html)
* [TRnotes](/en/tr/index.html)
* [JVN iPedia](http://jvndb.jvn.jp/en/)
* [MyJVN](http://jvndb.jvn.jp/en/apis/myjvn/index.html)
* [JVNJS/RSS](/en/rss/index.html)
* [Vendor List](/en/nav/index.html)
* [List of unreachable developers](/en/reply/index.html)
* [Contact](/en/contact/index.html)

Copyright (c) 2000-2017 JPCERT/CC and IPA. All rights reserved.


