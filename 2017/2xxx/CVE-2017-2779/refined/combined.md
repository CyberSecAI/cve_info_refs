=== Content from 0patch.blogspot.com_b3a5ef47_20250125_183932.html ===


# [0patch Blog](https://blog.0patch.com/)

Security Patching Simplified To The Extreme

## Friday, September 1, 2017

Posted by

[Mitja Kolsek](https://www.blogger.com/profile/00089863558178974677 "author profile")

on

[September 01, 2017](https://blog.0patch.com/2017/09/0patching-rsrc-arbitrary-null-write.html "permanent link")

### 0patching the RSRC Arbitrary NULL Write Vulnerability in LabVIEW (CVE-2017-2779)

**Whether Vendors Patch Their Products or Not, We Have Your Back**

by Mitja Kolsek, the 0patch Team

Three days ago, Cisco Talos published a [post about a code execution vulnerability in LabVIEW](http://blog.talosintelligence.com/2017/08/vulnerability-spotlight-code-execution.html), whereby opening a malformed *VI* file with LabVIEW results in writing NULL bytes at chosen memory locations. This can most likely be used for executing arbitrary code by carefully placing NULLs in various data structures or stack. Nothing unusual so far.

According to Talos' post, the producer of LabVIEW, [National Instruments](http://www.ni.com/), initially\* refused to patch this vulnerability, stating that *"National Instruments does not consider that this issue constitutes a vulnerability in their
product, since any .exe like file format can be modified to replace
legitimate content with malicious."*

(\* Subsequently, National Instruments [stated that they would produce a patch](http://www.ni.com/product-documentation/54099/en/).)

A *VI* file is not a Windows executable that would run on any Windows computer. However, if you have LabVIEW installed, a *VI* file will get opened by it, and can be made to automatically run its embedded code. This code is very powerful and by design has ability to access your file system and launch native executables. So a malicious *VI* file, say, received via email or found on the Internet, could attack your computer if opened in LabVIEW - even without the vulnerability described here.

This is not entirely different from, say, a Microsoft Word document, which is also not an executable file, but can contain powerful damaging macros. (Although Word does warn you about macros and you have to explicitly allow their execution.)

National Instruments provides [Security Best Practices](http://digital.ni.com/public.nsf/allkb/ECCA13EDE2300EFA86257FE100747965) stating that you should exercise the same precautions with a *VI* file as you would with a *EXE* or *DLL* file. This makes sense - if an attacker can get you to open his malicious *VI* file, he can simply put malicious *VI* code in it that will attack you, just as if he could get you to open a malicious *EXE*. Importantly, he does not gain any additional benefit from a memory corruption issue described here, as he would still need you to open his *VI* file - and in contrast to Word and macros, LabVIEW does not ask your permission to execute *VI* code.

However, the Security Best Practices document further states that if you want to safely inspect a suspect *VI* before running it, you should add that *VI* as a sub-*VI* to a blank *VI*, and inspect its code before running it.

In this case, however, there is a difference between a legitimately-formatted *VI* with malicious *VI* code (which does not get executed as a sub-*VI*) and a malformed *VI* causing memory corruption when loaded (which executes malicious code even if loaded as a sub-*VI*).

This vulnerability therefore allows an attacker to mount an attack with a malicious *VI* file against a user following National Instruments' Security Best Practices. Since the vendor initially stated that they would not issue a fix (it's still not available at the time of this writing), we decided to make one ourselves.

**Analysis**

In order to fix this vulnerability, we needed to first understand it. We started with a sample *VI* file.

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjOe1-tEb6ofkJSlA9XSrFoYz34JO4d7jxmhHB41CGGIVEOVPdyT0M0twMlYUSIrkArhXo1ZhvtmCxk-4WXnPw0Co_P_WP3bKVWwM1jhZ1bCkeWJuDl1hc8Ogt3GEE1QmyUeu9qMFwi8sQ5/s640/vi_file_hex.PNG)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjOe1-tEb6ofkJSlA9XSrFoYz34JO4d7jxmhHB41CGGIVEOVPdyT0M0twMlYUSIrkArhXo1ZhvtmCxk-4WXnPw0Co_P_WP3bKVWwM1jhZ1bCkeWJuDl1hc8Ogt3GEE1QmyUeu9qMFwi8sQ5/s1600/vi_file_hex.PNG)

A *.VI* file (example shown above) is a data file in a publicly undocumented format. It gets opened with labview.exe, which, among other things, parses the file's RSRC segments into in-memory RSRC data structures. You can see one RSRC segment at the beginning of the file above, but there can be others further down in a file.

Talos' [detailed vulnerability report](https://www.talosintelligence.com/reports/TALOS-2017-0273/) provided useful details on where their malformed *.VI* file caused a crash. Apparently, a method called ClearAllDataHdls (yes, the affected DLL comes with some symbols) walks through an array of what we can assume are "data handles". Each data handle has an *offset* to its own array of some 20-byte objects, and the *count* of these objects. The code simply walks through all objects of all handles, and writes a NULL to each one of them. Manipulating the said *offset* allows for writing one or more NULLs at arbitrarily chosen locations in memory.

It was trivial to create a malformed *.VI* file from a sample file based on this information. And, as expected, it crashed LabVIEW with an access violation. However, it did not crash it in ClearAllDataHdls, but in a method called StandardizeAndSanityChkRsrcMap (actually in a small helper function called by it). What happened? Was our POC different, did we find another bug?

It turned out we were using LabVIEW 2017, while Talos did their testing on version 2016. It appears that in version 2017, LabVIEW added some RSRC sanitization code, and in fact looking at this method revealed some sanity checks are being done on the RSRC data, whereby a *.VI* file is rejected if these checks fail. Unfortunately, these checks are not for the malformed data in question; in fact, StandardizeAndSanityChkRsrcMap also performs initialization of above-mentioned 20-byte objects by reversing their byte order to [little-endian](https://en.wikipedia.org/wiki/Endianness) format, and this very action is what resulted in our crash due to accessing an invalid memory address.

It was time to take a closer look at StandardizeAndSanityChkRsrcMap and understand the RSRC data structure. The following image shows the most important part of StandardizeAndSanityChkRsrcMap, where the outer loop walks through all the handles, and the inner loop walks through all objects of a given handle and byte-reverses them.

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjzbLwMGGeJs_7lM-E46X3Zx-tVlLoNrymgjRq6aeLYX_1iVCP8ePVUiYIisAoA-aZm9u4HTx8HWzAL6kAHDdMvPpfL4-ap6ope99m_Z0M51XM09_l3jytaoVd6vDpho6HqKkykOEy0eO74/s640/sanitize.PNG)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjzbLwMGGeJs_7lM-E46X3Zx-tVlLoNrymgjRq6aeLYX_1iVCP8ePVUiYIisAoA-aZm9u4HTx8HWzAL6kAHDdMvPpfL4-ap6ope99m_Z0M51XM09_l3jytaoVd6vDpho6HqKkykOEy0eO74/s1600/sanitize.PNG)

Now let's look at a sample RSRC structure in the memory, after all the values have been byte-reversed.

**52 53 52 43 0d 0a 03 00 4c 56 49 4e 4c 42 56 57  RSRC....LVINLBVW
c4 28 00 00 50 03 00 00 20 00 00 00 a4 28 00 00  .(..P... ....(..
00 00 00 00 00 00 00 00 20 00 00 00 34 00 00 00  ........ ...4...
38 03 00 00 17 00 00 00 4c 56 53 52 00 00 00 00  8.......LVSR....
24 01 00 00 52 54 53 47 00 00 00 00 38 01 00 00  $...RTSG....8...
76 65 72 73 00 00 00 00 4c 01 00 00 43 4f 4e 50  vers....L...CONP
00 00 00 00 60 01 00 00 4c 49 76 69 00 00 00 00  ....`...LIvi....
74 01 00 00 42 44 50 57 00 00 00 00 88 01 00 00  t...BDPW........
49 43 4f 4e 00 00 00 00 9c 01 00 00 69 63 6c 38  ICON........icl8
00 00 00 00 b0 01 00 00 54 49 54 4c 00 00 00 00  ........TITL....
c4 01 00 00 43 50 43 32 00 00 00 00 d8 01 00 00  ....CPC2........
4c 49 66 70 00 00 00 00 ec 01 00 00 46 50 48 62  LIfp........FPHb
00 00 00 00 00 02 00 00 46 50 53 45 00 00 00 00  ........FPSE....
14 02 00 00 56 50 44 50 00 00 00 00 28 02 00 00  ....VPDP....(...
4c 49 62 64 00 00 00 00 3c 02 00 00 42 44 48 62  LIbd....<...BDHb
00 00 00 00 50 02 00 00 42 44 53 45 00 00 00 00  ....P...BDSE....
64 02 00 00 56 49 54 53 00 00 00 00 78 02 00 00  d...VITS....x...
44 54 48 50 00 00 00 00 8c 02 00 00 4d 55 49 44  DTHP........MUID
00 00 00 00 a0 02 00 00 48 49 53 54 00 00 00 00  ........HIST....
b4 02 00 00 50 52 54 20 00 00 00 00 c8 02 00 00  ....PRT ........
56 43 54 50 00 00 00 00 dc 02 00 00 46 54 41 42  VCTP........FTAB
00 00 00 00 f0 02 00 00 00 00 00 00 00 00 00 00  ................
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
ff ff ff ff 00 00 00 00 a4 00 00 00 00 00 00 00  ................
04 00 00 00 ff ff ff ff 00 00 00 00 b8 00 00 00  ................
00 00 00 00 00 00 00 00 ff ff ff ff 00 00 00 00  ................
c8 00 00 00 00 00 00 00 00 00 00 00 ff ff ff ff  ................
00 00 00 00 d0 00 00 00 00 00 00 00 00 00 00 00  ................
ff ff ff ff 00 00 00 00 84 01 00 00 00 00 00 00  ................
00 00 00 00 ff ff ff ff 00 00 00 00 b8 01 00 00  ................
00 00 00 00 00 00 00 00 ff ff ff ff 00 00 00 00  ................
3c 02 00 00 00 00 00 00 00 00 00 00 ff ff ff ff  <...............
00 00 00 00 40 06 00 00 00 00 00 00 00 00 00 00  ....@...........
ff ff ff ff 00 00 00 00 5c 06 00 00 00 00 00 00  ........\.......
00 00 00 00 ff ff ff ff 00 00 00 00 64 06 00 00  ............d...
00 00 00 00 00 00 00 00 ff ff ff ff 00 00 00 00  ................
74 06 00 00 00 00 00 00 00 00 00 00 ff ff ff ff  t...............
00 00 00 00 50 09 00 00 00 00 00 00 00 00 00 00  ....P...........
ff ff ff ff 00 00 00 00 58 09 00 00 00 00 00 00  ........X.......
00 00 00 00 ff ff ff ff 00 00 00 00 60 09 00 00  ............`...
00 00 00 00 00 00 00 00 ff ff ff ff 00 00 00 00  ................
84 0a 00 00 00 00 00 00 00 00 00 00 ff ff ff ff  ................
00 00 00 00 08 24 00 00 00 00 00 00 00 00 00 00  .....$..........
ff ff ff ff 00 00 00 00 10 24 00 00 00 00 00 00  .........$......
00 00 00 00 ff ff ff ff 00 00 00 00 9c 24 00 00  .............$..
00 00 00 00 00 00 00 00 ff ff ff ff 00 00 00 00  ................
a4 24 00 00 00 00 00 00 00 00 00 00 ff ff ff ff  .$..............
00 00 00 00 ac 24 00 00 00 00 00 00 00 00 00 00  .....$..........
ff ff ff ff 00 00 00 00 d8 24 00 00 00 00 00 00  .........$......
00 00 00 00 ff ff ff ff 00 00 00 00 5c 25 00 00  ............\%..
00 00 00 00 80 00 00 00 ff ff ff ff 00 00 00 00  ................
38 28 00 00 00 00 00 00                          8(......**

The structure begins with a 30h-byte header (purple), followed by a DWORD structure length (blue), which is the size of the entire structure as shown - in our case 338h. After that, a DWORD handle count (green), 17h, tells us that there are 23 handles in the handle array that follows (red). Each handle consists of three DWORDs: some seemingly user-readable keyword, count of handle's objects (subtracted by 1, so 0 means 1 object), and the offset of its first object; the offset is meant from the handle count (green). Finally, the rest of the structure is object data area (black). Each object takes 20 bytes, and if a handle has *n* objects, they take *n* \* 20 consecutive bytes at the specified offset.

Clearly, a valid RSRC structure would have all handles' objects located neatly inside the object data area. But a malformed RSRC structure can specify an arbitrary offset, and thus tamper with chosen memory locations.

**Patching**

Our goal at this point was to add the missing sanity check to the original code: we should not allow accessing any object data outside the object data area.

We needed to find a good location for injecting the patch, and we chose one right after a handle's offset is obtained, at which point we had all information available to implement the sanitiy check. The following image shows the location of our patch.

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh3-X1qEh0cF2odwNjBKyOQH6vGqgEmJa4QMwdiVJB0elYyHwNAKPfH81wi4VbsW28eBtGkQy-3lhzbRXPTYlg-7UcpaSFg73KEfu7g5QNPxQwu63rAp71li_I-EI2AzgH7x7ZiGRTmJfYB/s640/sanitize-PATCH.PNG)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh3-X1qEh0cF2odwNjBKyOQH6vGqgEmJa4QMwdiVJB0elYyHwNAKPfH81wi4VbsW28eBtGkQy-3lhzbRXPTYlg-7UcpaSFg73KEfu7g5QNPxQwu63rAp71li_I-EI2AzgH7x7ZiGRTmJfYB/s1600/sanitize-PATCH.PNG)

We have the following information available at the patch injection point:

1. esi holds the offset of the current handle's first object
2. dword [ebp+10h] holds the number of objects for this handle (reduced by 1)
3. dword [ebp-4] holds the address of the handle count value, which is right next to the structure length value in memory.

The existing sanitization code exits the function with return value 6 (in eax) when the existing sanity checks fail, indicating to the caller that the structure is invalid. When this happens, LabVIEW tells the user that the file is invalid. We decided to do the same in our sanity check.

In pseudo-code, this is what we needed to do:

1. if offset of the current handle is negative or ridiculously large, we return with error 6
2. if the number of objects for the current handle is negative or ridiculously large, we return with error 6
3. multiply the number of objects with 20 to get the size of the object array
4. add offset to the size of object array to get the offset immediately after the array
5. calculate the maximum allowed offset by subtracting 34h (offset of handle count) from the structure length
6. if the last byte of object array is beyond the maximum allowed offset, return with error 6
7. Otherwise continue

This is the source code of the actual patch:

MODULE\_PATH "C:\Program Files (x86)\National Instruments\LabVIEW 2017\resource\mgcore\_SH\_17\_0.dll"
PATCH\_ID 276
PATCH\_FORMAT\_VER 2
VULN\_ID 2892
PLATFORM win32

patchlet\_start
 PATCHLET\_ID 1
 PATCHLET\_TYPE 2

 PATCHLET\_OFFSET 0x30c94
 N\_ORIGINALBYTES 5

 PIT mgcore\_SH\_17\_0!0x30c09

 code\_start

    ; esi is offset of the handle's object data
    test esi, 0FFF00000h   ; is offset negative or too huge?
    jnz error             ; if so, exit with error

    mov eax, dword [ebp+10h] ; eax = number of objects in this handle (-1)
    inc eax                  ; eax = actual number of objects in this handle
    test eax, 0FFF00000h     ; is number of objects negative or too huge?
    jnz error

    imul eax, 14h         ; size of object data for this handle

                          ; (1 object is 14h bytes)
    add eax, esi          ; eax = offset right after this handle's

                          ; last object

    mov edx, dword [ebp-4] ; stored address of handles\_num
    mov edx, [edx-4]      ; structure length is stored right before

                          ; handles\_num
    sub edx, 34h          ; edx is the maximum allowed offset
    cmp eax, edx          ; are we out of bounds?
    jg error              ; if so, exit with error

    jmp continue

 error:
    call PIT\_ExploitBlocked
    jmp PIT\_0x30c09       ; jmp to epilogue with error code 6

 continue:

 code\_end
patchlet\_end

Our micropatch has been published and distributed to all installed 0patch Agents yesterday (two days after Talos published vulnerability details), and you can see it in action in this video.

**The benefits of micropatching**

This story is a common one: a software vendor creates a product, many users use it, then someone finds a vulnerability. The vendor is notified but it's expensive for them to create and distribute a patch outside their schedule. Even with an updating mechanism in place, the so-called "fat updates" (updates that replace huge chunks of the product) are risky; many things can go wrong and expensive full-blown testing has to be done. And then the update has to be delivered to users, who have to waste their precious time with updating. And all that just for a single vulnerability? Understandably, vendors are inclined to try postponing such unwanted updates and bundle them with scheduled ones, often buying their time by downplaying the issue. When that happens, the security community likes to drop the details (*"hey, if the vendor says it's not an issue, there's no harm in publishing"*), and that usually pushes the vendor to issue a fix after all. They do it under pressure, and the risk of error is higher than usual. Finally, since un-updating is not really a thing, a botched fix could mean a nightmare for users to just get back to the vulnerable functional state.

In contrast, in-memory micropatching can fix a vulnerability with minimal and extremely controlled code modification (usually a dozen or so machine instructions) with no unwanted side effects. In addition, a micropatch can be applied to a product instantly, while the product is running, and just as instantly removed if suspected to be causing problems. All this allows the testing to be less rigorous, and only focused on the modified code - therefore cheaper.

Now imagine National Instruments had micropatching integrated in LabVIEW. It would be inexpensive to create and distribute a highly reliable micropatch for a vulnerability like this - especially with their intimate knowledge of the product -, and they could stay on their original release schedule while users would get their LabVIEW installations micropatched without even knowing it. No PR mess, no unhappy users, and very little disruption of business. What's not to like?

Software vendors are welcome to approach us about saving money, grief, and their users' time with micropatching.

If you have [0patch Agent](https://dist.0patch.com/download/latestagent)
installed (it's free!), this micropatch is already on your computer and
is getting automatically applied whenever you launch LabVIEW 2017.

[@mkolsek](https://twitter.com/mkolsek)

[@0patch](https://twitter.com/0patch)

[![](https://resources.blogblog.com/img/icon18_edit_allbkg.gif)](https://www.blogger.com/post-edit.g?blogID=7114610046316422325&postID=1689879815752952168&from=pencil "Edit Post")

[Email This](https://www.blogger.com/share-post.g?blogID=7114610046316422325&postID=1689879815752952168&target=email "Email This")[BlogThis!](https://www.blogger.com/share-post.g?blogID=7114610046316422325&postID=1689879815752952168&target=blog "BlogThis!")[Share to X](https://www.blogger.com/share-post.g?blogID=7114610046316422325&postID=1689879815752952168&target=twitter "Share to X")[Share to Facebook](https://www.blogger.com/share-post.g?blogID=7114610046316422325&postID=1689879815752952168&target=facebook "Share to Facebook")[Share to Pinterest](https://www.blogger.com/share-post.g?blogID=7114610046316422325&postID=1689879815752952168&target=pinterest "Share to Pinterest")

#### No comments:

#### Post a Comment

[Newer Post](https://blog.0patch.com/2017/09/exploit-kit-rendezvous-and-cve-2017-0022.html "Newer Post")

[Older Post](https://blog.0patch.com/2017/08/0patching-foxit-readers-saveas-0day-cve.html "Older Post")

[Home](https://blog.0patch.com/)

Subscribe to:
[Post Comments (Atom)](https://blog.0patch.com/feeds/1689879815752952168/comments/default)

## About 0patch

[0patch](https://0patch.com) (pronounced 'zero patch') is a platform for instantly distributing, applying and removing microscopic binary patches to/from running processes without having to restart these processes (much less reboot the entire computer). Brought to you by [ACROS Security](https://www.acrossecurity.com).

[Follow @0patch](https://twitter.com/0patch)

## Blog Archive

* ►
  [2025](https://blog.0patch.com/2025/)
  (1)
  + ►
    [January](https://blog.0patch.com/2025/01/)
    (1)

* ►
  [2024](https://blog.0patch.com/2024/)
  (23)
  + ►
    [December](https://blog.0patch.com/2024/12/)
    (1)
  + ►
    [November](https://blog.0patch.com/2024/11/)
    (4)
  + ►
    [October](https://blog.0patch.com/2024/10/)
    (2)
  + ►
    [September](https://blog.0patch.com/2024/09/)
    (1)
  + ►
    [July](https://blog.0patch.com/2024/07/)
    (2)
  + ►
    [June](https://blog.0patch.com/2024/06/)
    (2)
  + ►
    [May](https://blog.0patch.com/2024/05/)
    (1)
  + ►
    [April](https://blog.0patch.com/2024/04/)
    (4)
  + ►
    [March](https://blog.0patch.com/2024/03/)
    (1)
  + ►
    [February](https://blog.0patch.com/2024/02/)
    (4)
  + ►
    [January](https://blog.0patch.com/2024/01/)
    (1)

* ►
  [2023](https://blog.0patch.com/2023/)
  (26)
  + ►
    [November](https://blog.0patch.com/2023/11/)
    (3)
  + ►
    [October](https://blog.0patch.com/2023/10/)
    (3)
  + ►
    [September](https://blog.0patch.com/2023/09/)
    (2)
  + ►
    [August](https://blog.0patch.com/2023/08/)
    (1)
  + ►
    [July](https://blog.0patch.com/2023/07/)
    (1)
  + ►
    [June](https://blog.0patch.com/2023/06/)
    (5)
  + ►
    [May](https://blog.0patch.com/2023/05/)
    (1)
  + ►
    [April](https://blog.0patch.com/2023/04/)
    (1)
  + ►
    [March](https://blog.0patch.com/2023/03/)
    (5)
  + ►
    [February](https://blog.0patch.com/2023/02/)
    (2)
  + ►
    [January](https://blog.0patch.com/2023/01/)
    (2)

* ►
  [2022](https://blog.0patch.com/2022/)
  (26)
  + ►
    [December](https://blog.0patch.com/2022/12/)
    (3)
  + ►
    [October](https://blog.0patch.com/2022/10/)
    (6)
  + ►
    [September](https://blog.0patch.com/2022/09/)
    (3)
  + ►
    [August](https://blog.0patch.com/2022/08/)
    (2)
  + ►
    [July](https://blog.0patch.com/2022/07/)
    (2)
  + ►
    [June](https://blog.0patch.com/2022/06/)
    (3)
  + ►
    [May](https://blog.0patch.com/2022/05/)
    (2)
  + ►
    [March](https://blog.0patch.com/2022/03/)
    (4)
  + ►
    [January](https://blog.0patch.com/2022/01/)
    (1)

* ►
  [2021](https://blog.0patch.com/2021/)
  (23)
  + ►
    [December](https://blog.0patch.com/2021/12/)
    (2)
  + ►
    [November](https://blog.0patch.com/2021/11/)
    (3)
  + ►
    [October](https://blog.0patch.com/2021/10/)
    (2)
  + ►
    [September](https://blog.0patch.com/2021/09/)
    (1)
  + ►
    [August](https://blog.0patch.com/2021/08/)
    (3)
  + ►
    [July](https://blog.0patch.com/2021/07/)
    (2)
  + ►
    [June](https://blog.0patch.com/2021/06/)
    (1)
  + ►
    [May](https://blog.0patch.com/2021/05/)
    (3)
  + ►
    [March](https://blog.0patch.com/2021/03/)
    (2)
  + ►
    [February](https://blog.0patch.com/2021/02/)
    (2)
  + ►
    [January](https://blog.0patch.com/2021/01/)
    (2)

* ►
  [2020](https://blog.0patch.com/2020/)
  (19)
  + ►
    [December](https://blog.0patch.com/2020/12/)
    (2)
  + ►
    [November](https://blog.0patch.com/2020/11/)
    (2)
  + ►
    [September](https://blog.0patch.com/2020/09/)
    (1)
  + ►
    [August](https://blog.0patch.com/2020/08/)
    (2)
  + ►
    [July](https://blog.0patch.com/2020/07/)
    (3)
  + ►
    [June](https://blog.0patch.com/2020/06/)
    (2)
  + ►
    [May](https://blog.0patch.com/2020/05/)
    (2)
  + ►
    [March](https://blog.0patch.com/2020/03/)
    (1)
  + ►
    [February](https://blog.0patch.com/2020/02/)
    (2)
  + ►
    [January](https://blog.0patch.com/2020/01/)
    (2)

* ►
  [2019](https://blog.0patch.com/2019/)
  (7)
  + ►
    [September](https://blog.0patch.com/2019/09/)
    (1)
  + ►
    [June](https://blog.0patch.com/2019/06/)
    (1)
  + ►
    [April](https://blog.0patch.com/2019/04/)
    (2)
  + ►
    [February](https://blog.0patch.com/2019/02/)
    (2)
  + ►
    [January](https://blog.0patch.com/2019/01/)
    (1)

* ►
  [2018](https://blog.0patch.com/2018/)
  (11)
  + ►
    [October](https://blog.0patch.com/2018/10/)
    (2)
  + ►
    [September](https://blog.0patch.com/2018/09/)
    (2)
  + ►
    [August](https://blog.0patch.com/2018/08/)
    (1)
  + ►
    [May](https://blog.0patch.com/2018/05/)
    (2)
  + ►
    [March](https://blog.0patch.com/2018/03/)
    (1)
  + ►
    [February](https://blog.0patch.com/2018/02/)
    (1)
  + ►
    [January](https://blog.0patch.com/2018/01/)
    (2)

* ▼
  [2017](https://blog.0patch.com/2017/)
  (19)
  + ►
    [December](https://blog.0patch.com/2017/12/)
    (1)
  + ►
    [November](https://blog.0patch.com/2017/11/)
    (4)
  + ►
    [October](https://blog.0patch.com/2017/10/)
    (2)
  + ▼
    [September](https://blog.0patch.com/2017/09/)
    (2)
    - [Exploit Kit Rendezvous and CVE-2017-0022](https://blog.0patch.com/2017/09/exploit-kit-rendezvous-and-cve-2017-0022.html)
    - [0patching the RSRC Arbitrary NULL Write Vulnerabil...](https://blog.0patch.com/2017/09/0patching-rsrc-arbitrary-null-write.html)
  + ►
    [August](https://blog.0patch.com/2017/08/)
    (1)
  + ►
    [July](https://blog.0patch.com/2017/07/)
    (1)
  + ►
    [June](https://blog.0patch.com/2017/06/)
    (1)
  + ►
    [May](https://blog.0patch.com/2017/05/)
    (1)
  + ►
    [March](https://blog.0patch.com/2017/03/)
    (2)
  + ►
    [February](https://blog.0patch.com/2017/02/)
    (3)
  + ►
    [January](https://blog.0patch.com/2017/01/)
    (1)

* ►
  [2016](https://blog.0patch.com/2016/)
  (7)
  + ►
    [September](https://blog.0patch.com/2016/09/)
    (1)
  + ►
    [July](https://blog.0patch.com/2016/07/)
    (1)
  + ►
    [June](https://blog.0patch.com/2016/06/)
    (3)
  + ►
    [January](https://blog.0patch.com/2016/01/)
    (2)

## LinkedIn and Google tags

  ![](https://px.ads.linkedin.com/collect/?pid=1234785&fmt=gif)

|  |  |
| --- | --- |

Copyright ACROS Security / 0patch. Powered by [Blogger](https://www.blogger.com).



=== Content from www.talosintelligence.com_4734bcbc_20250125_183933.html ===


* [Cisco Login](/users/auth/saml)

* [Intelligence Center](/reputation)

  + [# Intelligence Center](/reputation)
  + BACK
  + [Intelligence Search](/reputation_center)
  + [Email & Spam Trends](/reputation_center/email_rep)
* [Vulnerability Research](/vulnerability_info)

  + [# Vulnerability Research](/vulnerability_info)
  + BACK
  + [Vulnerability Reports](/vulnerability_reports)
  + [Microsoft Advisories](/ms_advisories)
* [Incident Response](/incident_response)

  + [# Incident Response](/incident_response)
  + BACK
  + [Reactive Services](/incident_response/services#reactive-services)
  + [Proactive Services](/incident_response/services#proactive-services)
  + Emergency Support
* [Blog](https://blog.talosintelligence.com)
* [Support](https://support.talosintelligence.com)

More

* Security Resources

  # Security Resources

  + BACK
  Security Resources
  + [Open Source Security Tools](/software)
  + [Intelligence Categories Reference](/categories)
  + [Secure Endpoint Naming Reference](/secure-endpoint-naming)
* Media

  # Media

  + BACK
  Media
  + [Talos Intelligence Blog](https://blog.talosintelligence.com)
  + [Threat Source Newsletter](https://blog.talosintelligence.com/category/threat-source-newsletter/)
  + [Beers with Talos Podcast](/podcasts/shows/beers_with_talos)
  + [Talos Takes Podcast](/podcasts/shows/talos_takes)
  + [Talos Videos](https://www.youtube.com/channel/UCPZ1DtzQkStYBSG3GTNoyfg/featured)
* Company

  # Company

  + BACK
  Company
  + [About Talos](/about)
  + [Careers](/careers)

* Under Attack?
* [Cisco Login](/users/auth/saml)

## Contact Cisco Talos Incident Response

×

Close

This form is for Incident Response service inquiries only, including emergency network security needs.

For reputation or categorization inquiries, visit the [Talos Support site](/support).
For emergency DDoS mitigation assistance, please contact the [Cisco Secure DDoS Protection Team](https://www.cisco.com/c/en/us/products/collateral/security/ddos-emergency-attack-mitigation-aag.pdf).

Name

Company (optional)

Email address

Phone number

Preferred communication:

Email

Phone

What Incident Response Service are you interested in?
General Talos IR services and retainer information
Emergency Response
IR Plan
IR Playbooks
IR Readiness Assessment
Tabletop Exercises
Compromise Assessment
Threat Hunting
Cyber Range Training
Intelligence on Demand

Please provide as much detail as possible so we can best address your needs

I acknowledge that this is an inquiry for Incident Response services and that any other use of this form will not receive a response.

Send Email
Cancel

# Talos Vulnerability Report

### TALOS-2017-0273

## National Instruments LabVIEW RSRC Arbitrary Null Write Code Execution Vulnerability

##### August 29, 2017

##### CVE Number

CVE-2017-2779

### Summary

An exploitable memory corruption vulnerability exists in the RSRC segment parsing functionality of LabVIEW. A specially crafted VI file can cause an attacker controlled looping condition resulting in an arbitrary null write. An attacker controlled VI file can be used to trigger this vulnerability and can potentially result in code execution.

### Tested Versions

LabVIEW 2016 version 16.0

### Product URLs

<http://www.ni.com/labview/>

### CVSSv3 Score

7.5 - CVSS:3.0/AV:N/AC:H/PR:N/UI:R/S:U/C:H/I:H/A:H

### CWE

CWE-787: Out-of-bounds Write

### Details

LabVIEW provides engineers a simple environment to build measurement or control systems. LabVIEW is used to abstract many of the low-level details of various hardware and signal-processing libraries into a single platform. It uses a graphical programming approach to achieve this goal.

Modules utilized in this vulnerability:

```
start    end        module name
03cc0000 03d76000   mgcore_SH_16_0   (export symbols)       C:\Program Files\National Instruments\LabVIEW 2016\resource\mgcore_SH_16_0.dll
    Loaded symbol image file: C:\Program Files\National Instruments\LabVIEW 2016\resource\mgcore_SH_16_0.dll
    Image path: C:\Program Files\National Instruments\LabVIEW 2016\resource\mgcore_SH_16_0.dll
    Image name: mgcore_SH_16_0.dll
    Browse all global symbols  functions  data
    Timestamp:        Wed Jun 08 10:00:01 2016 (57584F11)
    CheckSum:         000B192B
    ImageSize:        000B6000
    File version:     16.0.0.49152

```

While opening a VI file, an RSRC segment can be parsed. An example of the beginning of this segment is shown below:

```
0:000> dc esi
0acf6690  43525352 03000a0d 4e49564c 5756424c  RSRC....LVINLBVW
0acf66a0  d00b0000 eb020000 20000000 b00b0000  ........... ....
0acf66b0  00000000 00000000 20000000 34000000  ........... ...4
0acf66c0  d8020000 14000000 5253564c 00000000  ........LVSR....
0acf66d0  00010000 47535452 00000000 14010000  ....RTSG........
0acf66e0  73726576 00000000 28010000 504e4f43  vers.......(CONP
0acf66f0  00000000 3c010000 6976494c 00000000  .......<LIvi....
0acf6700  50010000 57504442 00000000 64010000  ...PBDPW.......d

```

After parsing the RSRC segment into an internal RSRC struct, LabVIEW tries to clean up data handles created in this process. To begin this process, the loop counter is first extracted from the RSRC segment.

```
mgcore_SH_16_0!LVResFile::ClearAllDataHdls+0x18:
.text:1001FF98 008                 mov     esi, [ecx+2Ch] // [0] ecx is beginning of segment (0xacf6690 above)
.text:1001FF9B 008                 add     esi, ecx       // [1]
.text:1001FF9D 008                 mov     eax, [esi]     // [2]

```

Extracted first is the offset to the loop counter [0]. This value is then added to the beginning of the RSRC segment [1]. This new address is accessed to extract the loop counter used for termination of the main loop for clearing data handles.

The loop responsible for clearing the data handles is below:

```
mgcore_SH_16_0!LVResFile::ClearAllDataHdls+0x30:
.text:1001FFB0     loop_top:
.text:1001FFB0 00C                 mov     eax, [edx]        // [4] edx is our current pointer (starting at 0xacf66d0 above)
.text:1001FFB2 00C                 mov     ecx, [edx-4]
.text:1001FFB5 00C                 add     eax, esi          // [5]
.text:1001FFB7 00C                 test    ecx, ecx
.text:1001FFB9 00C                 jl      short dec_counter
.text:1001FFBB 00C                 add     eax, 10h
.text:1001FFBE 00C                 inc     ecx
.text:1001FFBF 00C                 nop
.text:1001FFC0
.text:1001FFC0     loop_inner:
.text:1001FFC0 00C                 mov     dword ptr [eax], 0 // [6]
.text:1001FFC6 00C                 add     eax, 14h
.text:1001FFC9 00C                 sub     ecx, 1
.text:1001FFCC 00C                 jnz     short loop_inner
.text:1001FFCE
.text:1001FFCE     dec_counter:
.text:1001FFCE 00C                 add     edx, 0Ch           // [7]
.text:1001FFD1 00C                 sub     edi, 1
.text:1001FFD4 00C                 jnz     short loop_top
.text:1001FFD6 00C                 pop     edi

```

The loop extracts the value under the current pointer [4] and adds it to the beginning of the segment [5]. This address is then cleared [6] and the pointer moves to the next section [7].

An attacker can control the loop counter as well as the offsets read from the RSRC struct used to calculate which address to clear, causing a write null anywhere situation. This null overwrite could potentially be leveraged into code execution.

### Crash Information

```
0:000> r
eax=57f416eb ebx=0b8be230 ecx=4c56494f edx=0bb1c1b0 esi=0bb1c084 edi=13ffffe9
eip=03d8ffc0 esp=0012d3d0 ebp=0012d3d8 iopl=0         nv up ei pl nz na po nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00010202
mgcore_SH_16_0!LVResFile::ClearAllDataHdls+0x40:
03d8ffc0 c70000000000    mov     dword ptr [eax],0    ds:0023:57f416eb=????????
0:000> !exploitable

!exploitable 1.6.0.0
Exploitability Classification: EXPLOITABLE
Recommended Bug Title: Exploitable - User Mode Write AV starting at mgcore_SH_16_0!LVResFile::ClearAllDataHdls+0x0000000000000040 (Hash=0x74591f62.0x054d4767)

User mode write access violations that are not near NULL are exploitable.

```
### Timeline

2017-01-25 - Vendor Disclosure

2017-08-29 - Public Release

##### Credit

Discovered by Cory Duplantis of Cisco Talos.

---

[Vulnerability Reports](/vulnerability_reports) [Next Report

TALOS-2017-0303](/vulnerability_reports/TALOS-2017-0303) [Previous Report

TALOS-2017-0323](/vulnerability_reports/TALOS-2017-0323)

* + ###### [Intelligence Center](/reputation)
  + [Intelligence Search](/reputation_center)
  + [Email & Spam Trends](/reputation_center/email_rep)
* + ###### [Vulnerability Research](/vulnerability_info)
  + [Vulnerability Reports](/vulnerability_reports)
  + [Microsoft Advisories](/ms_advisories)
* + ###### [Incident Response](/incident_response)
  + [Reactive Services](/incident_response/services#reactive-services)
  + [Proactive Services](/incident_response/services#proactive-services)
  + Emergency Support
* + ###### Security Resources
  + [Open Source Security Tools](/software)
  + [Intelligence Categories Reference](/categories)
  + [Secure Endpoint Naming Reference](/secure-endpoint-naming)
* + ###### Media
  + [Talos Intelligence Blog](https://blog.talosintelligence.com)
  + [Threat Source Newsletter](https://blog.talosintelligence.com/category/threat-source-newsletter/)
  + [Beers with Talos Podcast](/podcasts/shows/beers_with_talos)
  + [Talos Takes Podcast](/podcasts/shows/talos_takes)
  + [Talos Videos](https://www.youtube.com/channel/UCPZ1DtzQkStYBSG3GTNoyfg/featured)
* + ###### Support
  + [Support Documentation](https://support.talosintelligence.com)
* + ###### Company
  + [About Talos](/about)
  + [Careers](/careers)
  + [Cisco Security](https://www.cisco.com/c/en/us/products/security/product-listing.html)

###### Follow us

[![Cisco](/assets/logo_cisco_white-d87b7f7d3152ad412e48aad924a972cc5b802b7a53cb56b0792a4456c9b7b3a5.svg)](http://tools.cisco.com/security/center/home.x)

©
2025
Cisco Systems, Inc. and/or its affiliates. All rights
reserved. View our
[Privacy Policy.](http://www.cisco.com/web/siteassets/legal/privacy_full.html)



=== Content from blog.0patch.com_f48a487d_20250126_110505.html ===


# [0patch Blog](https://blog.0patch.com/)

Security Patching Simplified To The Extreme

## Friday, September 1, 2017

Posted by

[Mitja Kolsek](https://www.blogger.com/profile/00089863558178974677 "author profile")

on

[September 01, 2017](https://blog.0patch.com/2017/09/0patching-rsrc-arbitrary-null-write.html "permanent link")

### 0patching the RSRC Arbitrary NULL Write Vulnerability in LabVIEW (CVE-2017-2779)

**Whether Vendors Patch Their Products or Not, We Have Your Back**

by Mitja Kolsek, the 0patch Team

Three days ago, Cisco Talos published a [post about a code execution vulnerability in LabVIEW](http://blog.talosintelligence.com/2017/08/vulnerability-spotlight-code-execution.html), whereby opening a malformed *VI* file with LabVIEW results in writing NULL bytes at chosen memory locations. This can most likely be used for executing arbitrary code by carefully placing NULLs in various data structures or stack. Nothing unusual so far.

According to Talos' post, the producer of LabVIEW, [National Instruments](http://www.ni.com/), initially\* refused to patch this vulnerability, stating that *"National Instruments does not consider that this issue constitutes a vulnerability in their
product, since any .exe like file format can be modified to replace
legitimate content with malicious."*

(\* Subsequently, National Instruments [stated that they would produce a patch](http://www.ni.com/product-documentation/54099/en/).)

A *VI* file is not a Windows executable that would run on any Windows computer. However, if you have LabVIEW installed, a *VI* file will get opened by it, and can be made to automatically run its embedded code. This code is very powerful and by design has ability to access your file system and launch native executables. So a malicious *VI* file, say, received via email or found on the Internet, could attack your computer if opened in LabVIEW - even without the vulnerability described here.

This is not entirely different from, say, a Microsoft Word document, which is also not an executable file, but can contain powerful damaging macros. (Although Word does warn you about macros and you have to explicitly allow their execution.)

National Instruments provides [Security Best Practices](http://digital.ni.com/public.nsf/allkb/ECCA13EDE2300EFA86257FE100747965) stating that you should exercise the same precautions with a *VI* file as you would with a *EXE* or *DLL* file. This makes sense - if an attacker can get you to open his malicious *VI* file, he can simply put malicious *VI* code in it that will attack you, just as if he could get you to open a malicious *EXE*. Importantly, he does not gain any additional benefit from a memory corruption issue described here, as he would still need you to open his *VI* file - and in contrast to Word and macros, LabVIEW does not ask your permission to execute *VI* code.

However, the Security Best Practices document further states that if you want to safely inspect a suspect *VI* before running it, you should add that *VI* as a sub-*VI* to a blank *VI*, and inspect its code before running it.

In this case, however, there is a difference between a legitimately-formatted *VI* with malicious *VI* code (which does not get executed as a sub-*VI*) and a malformed *VI* causing memory corruption when loaded (which executes malicious code even if loaded as a sub-*VI*).

This vulnerability therefore allows an attacker to mount an attack with a malicious *VI* file against a user following National Instruments' Security Best Practices. Since the vendor initially stated that they would not issue a fix (it's still not available at the time of this writing), we decided to make one ourselves.

**Analysis**

In order to fix this vulnerability, we needed to first understand it. We started with a sample *VI* file.

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjOe1-tEb6ofkJSlA9XSrFoYz34JO4d7jxmhHB41CGGIVEOVPdyT0M0twMlYUSIrkArhXo1ZhvtmCxk-4WXnPw0Co_P_WP3bKVWwM1jhZ1bCkeWJuDl1hc8Ogt3GEE1QmyUeu9qMFwi8sQ5/s640/vi_file_hex.PNG)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjOe1-tEb6ofkJSlA9XSrFoYz34JO4d7jxmhHB41CGGIVEOVPdyT0M0twMlYUSIrkArhXo1ZhvtmCxk-4WXnPw0Co_P_WP3bKVWwM1jhZ1bCkeWJuDl1hc8Ogt3GEE1QmyUeu9qMFwi8sQ5/s1600/vi_file_hex.PNG)

A *.VI* file (example shown above) is a data file in a publicly undocumented format. It gets opened with labview.exe, which, among other things, parses the file's RSRC segments into in-memory RSRC data structures. You can see one RSRC segment at the beginning of the file above, but there can be others further down in a file.

Talos' [detailed vulnerability report](https://www.talosintelligence.com/reports/TALOS-2017-0273/) provided useful details on where their malformed *.VI* file caused a crash. Apparently, a method called ClearAllDataHdls (yes, the affected DLL comes with some symbols) walks through an array of what we can assume are "data handles". Each data handle has an *offset* to its own array of some 20-byte objects, and the *count* of these objects. The code simply walks through all objects of all handles, and writes a NULL to each one of them. Manipulating the said *offset* allows for writing one or more NULLs at arbitrarily chosen locations in memory.

It was trivial to create a malformed *.VI* file from a sample file based on this information. And, as expected, it crashed LabVIEW with an access violation. However, it did not crash it in ClearAllDataHdls, but in a method called StandardizeAndSanityChkRsrcMap (actually in a small helper function called by it). What happened? Was our POC different, did we find another bug?

It turned out we were using LabVIEW 2017, while Talos did their testing on version 2016. It appears that in version 2017, LabVIEW added some RSRC sanitization code, and in fact looking at this method revealed some sanity checks are being done on the RSRC data, whereby a *.VI* file is rejected if these checks fail. Unfortunately, these checks are not for the malformed data in question; in fact, StandardizeAndSanityChkRsrcMap also performs initialization of above-mentioned 20-byte objects by reversing their byte order to [little-endian](https://en.wikipedia.org/wiki/Endianness) format, and this very action is what resulted in our crash due to accessing an invalid memory address.

It was time to take a closer look at StandardizeAndSanityChkRsrcMap and understand the RSRC data structure. The following image shows the most important part of StandardizeAndSanityChkRsrcMap, where the outer loop walks through all the handles, and the inner loop walks through all objects of a given handle and byte-reverses them.

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjzbLwMGGeJs_7lM-E46X3Zx-tVlLoNrymgjRq6aeLYX_1iVCP8ePVUiYIisAoA-aZm9u4HTx8HWzAL6kAHDdMvPpfL4-ap6ope99m_Z0M51XM09_l3jytaoVd6vDpho6HqKkykOEy0eO74/s640/sanitize.PNG)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjzbLwMGGeJs_7lM-E46X3Zx-tVlLoNrymgjRq6aeLYX_1iVCP8ePVUiYIisAoA-aZm9u4HTx8HWzAL6kAHDdMvPpfL4-ap6ope99m_Z0M51XM09_l3jytaoVd6vDpho6HqKkykOEy0eO74/s1600/sanitize.PNG)

Now let's look at a sample RSRC structure in the memory, after all the values have been byte-reversed.

**52 53 52 43 0d 0a 03 00 4c 56 49 4e 4c 42 56 57  RSRC....LVINLBVW
c4 28 00 00 50 03 00 00 20 00 00 00 a4 28 00 00  .(..P... ....(..
00 00 00 00 00 00 00 00 20 00 00 00 34 00 00 00  ........ ...4...
38 03 00 00 17 00 00 00 4c 56 53 52 00 00 00 00  8.......LVSR....
24 01 00 00 52 54 53 47 00 00 00 00 38 01 00 00  $...RTSG....8...
76 65 72 73 00 00 00 00 4c 01 00 00 43 4f 4e 50  vers....L...CONP
00 00 00 00 60 01 00 00 4c 49 76 69 00 00 00 00  ....`...LIvi....
74 01 00 00 42 44 50 57 00 00 00 00 88 01 00 00  t...BDPW........
49 43 4f 4e 00 00 00 00 9c 01 00 00 69 63 6c 38  ICON........icl8
00 00 00 00 b0 01 00 00 54 49 54 4c 00 00 00 00  ........TITL....
c4 01 00 00 43 50 43 32 00 00 00 00 d8 01 00 00  ....CPC2........
4c 49 66 70 00 00 00 00 ec 01 00 00 46 50 48 62  LIfp........FPHb
00 00 00 00 00 02 00 00 46 50 53 45 00 00 00 00  ........FPSE....
14 02 00 00 56 50 44 50 00 00 00 00 28 02 00 00  ....VPDP....(...
4c 49 62 64 00 00 00 00 3c 02 00 00 42 44 48 62  LIbd....<...BDHb
00 00 00 00 50 02 00 00 42 44 53 45 00 00 00 00  ....P...BDSE....
64 02 00 00 56 49 54 53 00 00 00 00 78 02 00 00  d...VITS....x...
44 54 48 50 00 00 00 00 8c 02 00 00 4d 55 49 44  DTHP........MUID
00 00 00 00 a0 02 00 00 48 49 53 54 00 00 00 00  ........HIST....
b4 02 00 00 50 52 54 20 00 00 00 00 c8 02 00 00  ....PRT ........
56 43 54 50 00 00 00 00 dc 02 00 00 46 54 41 42  VCTP........FTAB
00 00 00 00 f0 02 00 00 00 00 00 00 00 00 00 00  ................
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
ff ff ff ff 00 00 00 00 a4 00 00 00 00 00 00 00  ................
04 00 00 00 ff ff ff ff 00 00 00 00 b8 00 00 00  ................
00 00 00 00 00 00 00 00 ff ff ff ff 00 00 00 00  ................
c8 00 00 00 00 00 00 00 00 00 00 00 ff ff ff ff  ................
00 00 00 00 d0 00 00 00 00 00 00 00 00 00 00 00  ................
ff ff ff ff 00 00 00 00 84 01 00 00 00 00 00 00  ................
00 00 00 00 ff ff ff ff 00 00 00 00 b8 01 00 00  ................
00 00 00 00 00 00 00 00 ff ff ff ff 00 00 00 00  ................
3c 02 00 00 00 00 00 00 00 00 00 00 ff ff ff ff  <...............
00 00 00 00 40 06 00 00 00 00 00 00 00 00 00 00  ....@...........
ff ff ff ff 00 00 00 00 5c 06 00 00 00 00 00 00  ........\.......
00 00 00 00 ff ff ff ff 00 00 00 00 64 06 00 00  ............d...
00 00 00 00 00 00 00 00 ff ff ff ff 00 00 00 00  ................
74 06 00 00 00 00 00 00 00 00 00 00 ff ff ff ff  t...............
00 00 00 00 50 09 00 00 00 00 00 00 00 00 00 00  ....P...........
ff ff ff ff 00 00 00 00 58 09 00 00 00 00 00 00  ........X.......
00 00 00 00 ff ff ff ff 00 00 00 00 60 09 00 00  ............`...
00 00 00 00 00 00 00 00 ff ff ff ff 00 00 00 00  ................
84 0a 00 00 00 00 00 00 00 00 00 00 ff ff ff ff  ................
00 00 00 00 08 24 00 00 00 00 00 00 00 00 00 00  .....$..........
ff ff ff ff 00 00 00 00 10 24 00 00 00 00 00 00  .........$......
00 00 00 00 ff ff ff ff 00 00 00 00 9c 24 00 00  .............$..
00 00 00 00 00 00 00 00 ff ff ff ff 00 00 00 00  ................
a4 24 00 00 00 00 00 00 00 00 00 00 ff ff ff ff  .$..............
00 00 00 00 ac 24 00 00 00 00 00 00 00 00 00 00  .....$..........
ff ff ff ff 00 00 00 00 d8 24 00 00 00 00 00 00  .........$......
00 00 00 00 ff ff ff ff 00 00 00 00 5c 25 00 00  ............\%..
00 00 00 00 80 00 00 00 ff ff ff ff 00 00 00 00  ................
38 28 00 00 00 00 00 00                          8(......**

The structure begins with a 30h-byte header (purple), followed by a DWORD structure length (blue), which is the size of the entire structure as shown - in our case 338h. After that, a DWORD handle count (green), 17h, tells us that there are 23 handles in the handle array that follows (red). Each handle consists of three DWORDs: some seemingly user-readable keyword, count of handle's objects (subtracted by 1, so 0 means 1 object), and the offset of its first object; the offset is meant from the handle count (green). Finally, the rest of the structure is object data area (black). Each object takes 20 bytes, and if a handle has *n* objects, they take *n* \* 20 consecutive bytes at the specified offset.

Clearly, a valid RSRC structure would have all handles' objects located neatly inside the object data area. But a malformed RSRC structure can specify an arbitrary offset, and thus tamper with chosen memory locations.

**Patching**

Our goal at this point was to add the missing sanity check to the original code: we should not allow accessing any object data outside the object data area.

We needed to find a good location for injecting the patch, and we chose one right after a handle's offset is obtained, at which point we had all information available to implement the sanitiy check. The following image shows the location of our patch.

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh3-X1qEh0cF2odwNjBKyOQH6vGqgEmJa4QMwdiVJB0elYyHwNAKPfH81wi4VbsW28eBtGkQy-3lhzbRXPTYlg-7UcpaSFg73KEfu7g5QNPxQwu63rAp71li_I-EI2AzgH7x7ZiGRTmJfYB/s640/sanitize-PATCH.PNG)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh3-X1qEh0cF2odwNjBKyOQH6vGqgEmJa4QMwdiVJB0elYyHwNAKPfH81wi4VbsW28eBtGkQy-3lhzbRXPTYlg-7UcpaSFg73KEfu7g5QNPxQwu63rAp71li_I-EI2AzgH7x7ZiGRTmJfYB/s1600/sanitize-PATCH.PNG)

We have the following information available at the patch injection point:

1. esi holds the offset of the current handle's first object
2. dword [ebp+10h] holds the number of objects for this handle (reduced by 1)
3. dword [ebp-4] holds the address of the handle count value, which is right next to the structure length value in memory.

The existing sanitization code exits the function with return value 6 (in eax) when the existing sanity checks fail, indicating to the caller that the structure is invalid. When this happens, LabVIEW tells the user that the file is invalid. We decided to do the same in our sanity check.

In pseudo-code, this is what we needed to do:

1. if offset of the current handle is negative or ridiculously large, we return with error 6
2. if the number of objects for the current handle is negative or ridiculously large, we return with error 6
3. multiply the number of objects with 20 to get the size of the object array
4. add offset to the size of object array to get the offset immediately after the array
5. calculate the maximum allowed offset by subtracting 34h (offset of handle count) from the structure length
6. if the last byte of object array is beyond the maximum allowed offset, return with error 6
7. Otherwise continue

This is the source code of the actual patch:

MODULE\_PATH "C:\Program Files (x86)\National Instruments\LabVIEW 2017\resource\mgcore\_SH\_17\_0.dll"
PATCH\_ID 276
PATCH\_FORMAT\_VER 2
VULN\_ID 2892
PLATFORM win32

patchlet\_start
 PATCHLET\_ID 1
 PATCHLET\_TYPE 2

 PATCHLET\_OFFSET 0x30c94
 N\_ORIGINALBYTES 5

 PIT mgcore\_SH\_17\_0!0x30c09

 code\_start

    ; esi is offset of the handle's object data
    test esi, 0FFF00000h   ; is offset negative or too huge?
    jnz error             ; if so, exit with error

    mov eax, dword [ebp+10h] ; eax = number of objects in this handle (-1)
    inc eax                  ; eax = actual number of objects in this handle
    test eax, 0FFF00000h     ; is number of objects negative or too huge?
    jnz error

    imul eax, 14h         ; size of object data for this handle

                          ; (1 object is 14h bytes)
    add eax, esi          ; eax = offset right after this handle's

                          ; last object

    mov edx, dword [ebp-4] ; stored address of handles\_num
    mov edx, [edx-4]      ; structure length is stored right before

                          ; handles\_num
    sub edx, 34h          ; edx is the maximum allowed offset
    cmp eax, edx          ; are we out of bounds?
    jg error              ; if so, exit with error

    jmp continue

 error:
    call PIT\_ExploitBlocked
    jmp PIT\_0x30c09       ; jmp to epilogue with error code 6

 continue:

 code\_end
patchlet\_end

Our micropatch has been published and distributed to all installed 0patch Agents yesterday (two days after Talos published vulnerability details), and you can see it in action in this video.

**The benefits of micropatching**

This story is a common one: a software vendor creates a product, many users use it, then someone finds a vulnerability. The vendor is notified but it's expensive for them to create and distribute a patch outside their schedule. Even with an updating mechanism in place, the so-called "fat updates" (updates that replace huge chunks of the product) are risky; many things can go wrong and expensive full-blown testing has to be done. And then the update has to be delivered to users, who have to waste their precious time with updating. And all that just for a single vulnerability? Understandably, vendors are inclined to try postponing such unwanted updates and bundle them with scheduled ones, often buying their time by downplaying the issue. When that happens, the security community likes to drop the details (*"hey, if the vendor says it's not an issue, there's no harm in publishing"*), and that usually pushes the vendor to issue a fix after all. They do it under pressure, and the risk of error is higher than usual. Finally, since un-updating is not really a thing, a botched fix could mean a nightmare for users to just get back to the vulnerable functional state.

In contrast, in-memory micropatching can fix a vulnerability with minimal and extremely controlled code modification (usually a dozen or so machine instructions) with no unwanted side effects. In addition, a micropatch can be applied to a product instantly, while the product is running, and just as instantly removed if suspected to be causing problems. All this allows the testing to be less rigorous, and only focused on the modified code - therefore cheaper.

Now imagine National Instruments had micropatching integrated in LabVIEW. It would be inexpensive to create and distribute a highly reliable micropatch for a vulnerability like this - especially with their intimate knowledge of the product -, and they could stay on their original release schedule while users would get their LabVIEW installations micropatched without even knowing it. No PR mess, no unhappy users, and very little disruption of business. What's not to like?

Software vendors are welcome to approach us about saving money, grief, and their users' time with micropatching.

If you have [0patch Agent](https://dist.0patch.com/download/latestagent)
installed (it's free!), this micropatch is already on your computer and
is getting automatically applied whenever you launch LabVIEW 2017.

[@mkolsek](https://twitter.com/mkolsek)

[@0patch](https://twitter.com/0patch)

[![](https://resources.blogblog.com/img/icon18_edit_allbkg.gif)](https://www.blogger.com/post-edit.g?blogID=7114610046316422325&postID=1689879815752952168&from=pencil "Edit Post")

[Email This](https://www.blogger.com/share-post.g?blogID=7114610046316422325&postID=1689879815752952168&target=email "Email This")[BlogThis!](https://www.blogger.com/share-post.g?blogID=7114610046316422325&postID=1689879815752952168&target=blog "BlogThis!")[Share to X](https://www.blogger.com/share-post.g?blogID=7114610046316422325&postID=1689879815752952168&target=twitter "Share to X")[Share to Facebook](https://www.blogger.com/share-post.g?blogID=7114610046316422325&postID=1689879815752952168&target=facebook "Share to Facebook")[Share to Pinterest](https://www.blogger.com/share-post.g?blogID=7114610046316422325&postID=1689879815752952168&target=pinterest "Share to Pinterest")

#### No comments:

#### Post a Comment

[Newer Post](https://blog.0patch.com/2017/09/exploit-kit-rendezvous-and-cve-2017-0022.html "Newer Post")

[Older Post](https://blog.0patch.com/2017/08/0patching-foxit-readers-saveas-0day-cve.html "Older Post")

[Home](https://blog.0patch.com/)

Subscribe to:
[Post Comments (Atom)](https://blog.0patch.com/feeds/1689879815752952168/comments/default)

## About 0patch

[0patch](https://0patch.com) (pronounced 'zero patch') is a platform for instantly distributing, applying and removing microscopic binary patches to/from running processes without having to restart these processes (much less reboot the entire computer). Brought to you by [ACROS Security](https://www.acrossecurity.com).

[Follow @0patch](https://twitter.com/0patch)

## Blog Archive

* ►
  [2025](https://blog.0patch.com/2025/)
  (1)
  + ►
    [January](https://blog.0patch.com/2025/01/)
    (1)

* ►
  [2024](https://blog.0patch.com/2024/)
  (23)
  + ►
    [December](https://blog.0patch.com/2024/12/)
    (1)
  + ►
    [November](https://blog.0patch.com/2024/11/)
    (4)
  + ►
    [October](https://blog.0patch.com/2024/10/)
    (2)
  + ►
    [September](https://blog.0patch.com/2024/09/)
    (1)
  + ►
    [July](https://blog.0patch.com/2024/07/)
    (2)
  + ►
    [June](https://blog.0patch.com/2024/06/)
    (2)
  + ►
    [May](https://blog.0patch.com/2024/05/)
    (1)
  + ►
    [April](https://blog.0patch.com/2024/04/)
    (4)
  + ►
    [March](https://blog.0patch.com/2024/03/)
    (1)
  + ►
    [February](https://blog.0patch.com/2024/02/)
    (4)
  + ►
    [January](https://blog.0patch.com/2024/01/)
    (1)

* ►
  [2023](https://blog.0patch.com/2023/)
  (26)
  + ►
    [November](https://blog.0patch.com/2023/11/)
    (3)
  + ►
    [October](https://blog.0patch.com/2023/10/)
    (3)
  + ►
    [September](https://blog.0patch.com/2023/09/)
    (2)
  + ►
    [August](https://blog.0patch.com/2023/08/)
    (1)
  + ►
    [July](https://blog.0patch.com/2023/07/)
    (1)
  + ►
    [June](https://blog.0patch.com/2023/06/)
    (5)
  + ►
    [May](https://blog.0patch.com/2023/05/)
    (1)
  + ►
    [April](https://blog.0patch.com/2023/04/)
    (1)
  + ►
    [March](https://blog.0patch.com/2023/03/)
    (5)
  + ►
    [February](https://blog.0patch.com/2023/02/)
    (2)
  + ►
    [January](https://blog.0patch.com/2023/01/)
    (2)

* ►
  [2022](https://blog.0patch.com/2022/)
  (26)
  + ►
    [December](https://blog.0patch.com/2022/12/)
    (3)
  + ►
    [October](https://blog.0patch.com/2022/10/)
    (6)
  + ►
    [September](https://blog.0patch.com/2022/09/)
    (3)
  + ►
    [August](https://blog.0patch.com/2022/08/)
    (2)
  + ►
    [July](https://blog.0patch.com/2022/07/)
    (2)
  + ►
    [June](https://blog.0patch.com/2022/06/)
    (3)
  + ►
    [May](https://blog.0patch.com/2022/05/)
    (2)
  + ►
    [March](https://blog.0patch.com/2022/03/)
    (4)
  + ►
    [January](https://blog.0patch.com/2022/01/)
    (1)

* ►
  [2021](https://blog.0patch.com/2021/)
  (23)
  + ►
    [December](https://blog.0patch.com/2021/12/)
    (2)
  + ►
    [November](https://blog.0patch.com/2021/11/)
    (3)
  + ►
    [October](https://blog.0patch.com/2021/10/)
    (2)
  + ►
    [September](https://blog.0patch.com/2021/09/)
    (1)
  + ►
    [August](https://blog.0patch.com/2021/08/)
    (3)
  + ►
    [July](https://blog.0patch.com/2021/07/)
    (2)
  + ►
    [June](https://blog.0patch.com/2021/06/)
    (1)
  + ►
    [May](https://blog.0patch.com/2021/05/)
    (3)
  + ►
    [March](https://blog.0patch.com/2021/03/)
    (2)
  + ►
    [February](https://blog.0patch.com/2021/02/)
    (2)
  + ►
    [January](https://blog.0patch.com/2021/01/)
    (2)

* ►
  [2020](https://blog.0patch.com/2020/)
  (19)
  + ►
    [December](https://blog.0patch.com/2020/12/)
    (2)
  + ►
    [November](https://blog.0patch.com/2020/11/)
    (2)
  + ►
    [September](https://blog.0patch.com/2020/09/)
    (1)
  + ►
    [August](https://blog.0patch.com/2020/08/)
    (2)
  + ►
    [July](https://blog.0patch.com/2020/07/)
    (3)
  + ►
    [June](https://blog.0patch.com/2020/06/)
    (2)
  + ►
    [May](https://blog.0patch.com/2020/05/)
    (2)
  + ►
    [March](https://blog.0patch.com/2020/03/)
    (1)
  + ►
    [February](https://blog.0patch.com/2020/02/)
    (2)
  + ►
    [January](https://blog.0patch.com/2020/01/)
    (2)

* ►
  [2019](https://blog.0patch.com/2019/)
  (7)
  + ►
    [September](https://blog.0patch.com/2019/09/)
    (1)
  + ►
    [June](https://blog.0patch.com/2019/06/)
    (1)
  + ►
    [April](https://blog.0patch.com/2019/04/)
    (2)
  + ►
    [February](https://blog.0patch.com/2019/02/)
    (2)
  + ►
    [January](https://blog.0patch.com/2019/01/)
    (1)

* ►
  [2018](https://blog.0patch.com/2018/)
  (11)
  + ►
    [October](https://blog.0patch.com/2018/10/)
    (2)
  + ►
    [September](https://blog.0patch.com/2018/09/)
    (2)
  + ►
    [August](https://blog.0patch.com/2018/08/)
    (1)
  + ►
    [May](https://blog.0patch.com/2018/05/)
    (2)
  + ►
    [March](https://blog.0patch.com/2018/03/)
    (1)
  + ►
    [February](https://blog.0patch.com/2018/02/)
    (1)
  + ►
    [January](https://blog.0patch.com/2018/01/)
    (2)

* ▼
  [2017](https://blog.0patch.com/2017/)
  (19)
  + ►
    [December](https://blog.0patch.com/2017/12/)
    (1)
  + ►
    [November](https://blog.0patch.com/2017/11/)
    (4)
  + ►
    [October](https://blog.0patch.com/2017/10/)
    (2)
  + ▼
    [September](https://blog.0patch.com/2017/09/)
    (2)
    - [Exploit Kit Rendezvous and CVE-2017-0022](https://blog.0patch.com/2017/09/exploit-kit-rendezvous-and-cve-2017-0022.html)
    - [0patching the RSRC Arbitrary NULL Write Vulnerabil...](https://blog.0patch.com/2017/09/0patching-rsrc-arbitrary-null-write.html)
  + ►
    [August](https://blog.0patch.com/2017/08/)
    (1)
  + ►
    [July](https://blog.0patch.com/2017/07/)
    (1)
  + ►
    [June](https://blog.0patch.com/2017/06/)
    (1)
  + ►
    [May](https://blog.0patch.com/2017/05/)
    (1)
  + ►
    [March](https://blog.0patch.com/2017/03/)
    (2)
  + ►
    [February](https://blog.0patch.com/2017/02/)
    (3)
  + ►
    [January](https://blog.0patch.com/2017/01/)
    (1)

* ►
  [2016](https://blog.0patch.com/2016/)
  (7)
  + ►
    [September](https://blog.0patch.com/2016/09/)
    (1)
  + ►
    [July](https://blog.0patch.com/2016/07/)
    (1)
  + ►
    [June](https://blog.0patch.com/2016/06/)
    (3)
  + ►
    [January](https://blog.0patch.com/2016/01/)
    (2)

## LinkedIn and Google tags

  ![](https://px.ads.linkedin.com/collect/?pid=1234785&fmt=gif)

|  |  |
| --- | --- |

Copyright ACROS Security / 0patch. Powered by [Blogger](https://www.blogger.com).



=== Content from www.ni.com_c496beb8_20250125_183931.html ===


* [Return to Home Page](https://www.ni.com/en.html)
* + [Solutions](//www.ni.com/en/solutions.html)
    Industries
    - [Academic and Research](//www.ni.com/en/solutions/academic-research.html)
    - [Aerospace, Defense, and Government](//www.ni.com/en/solutions/aerospace-defense.html)
    - [Electronics](//www.ni.com/en/solutions/electronics.html)
    - [Energy](//www.ni.com/en/solutions/energy.html)
    - [Industrial Machinery](//www.ni.com/en/solutions/industrial-machinery.html)
    - [Life Sciences](https://www.ni.com/en/solutions/life-sciences.html)
    - [Semiconductor](//www.ni.com/en/solutions/semiconductor.html)
    - [Transportation](//www.ni.com/en/solutions/transportation.html)
    Product Life Cycles
    - [Design and Prototype](//www.ni.com/en/solutions/design-prototype.html)
    - [Validation](//www.ni.com/en/solutions/validation.html)
    - [Production](//www.ni.com/en/solutions/production.html)
    Focus Areas
    - [5G and 6G Technology](//www.ni.com/en/solutions/5g-6g.html)
    - [ADAS and Autonomous Driving Testing](//www.ni.com/en/solutions/transportation/adas-and-autonomous-driving-testing.html)
    - [Electric Vehicle Test](//www.ni.com/en/solutions/transportation/electric-vehicle-test.html)
    - [Lifecycle Analytics](//www.ni.com/en/solutions/lifecycle-analytics.html)
    - [Radar and Electronic Warfare](//www.ni.com/en/solutions/aerospace-defense/radar-electronic-warfare-sigint.html)
    - [Space Launch and Exploration](//www.ni.com/en/solutions/aerospace-defense/space-launch-exploration.html)
    - [Validation Lab Innovations](https://www.ni.com/en/solutions/semiconductor/validation-lab-innovations.html)
    [See our approach to solutions](//www.ni.com/en/solutions.html)
    ![](https://ni.scene7.com/is/image/ni/02_patrick_robinson_0043_255x95)
    Get a Helping Hand

    From troubleshooting technical issues and product recommendations, to quotes and orders, we’re here to help.

    [Contact Us](//www.ni.com/en/contact-us.html)
  + [Products](//www.ni.com/en/shop.html)
    Software
    [View All Software](//www.ni.com/en/shop/software-portfolio.html)
    Test Automation
    - [LabVIEW](//www.ni.com/en/shop/labview.html)
    - [LabVIEW+ Suite](//www.ni.com/en/shop/labview/labview-plus-suite.html)
    - [TestStand (Test Execution)](//www.ni.com/en/shop/electronic-test-instrumentation/application-software-for-electronic-test-and-instrumentation-category/what-is-teststand.html)
    - [VeriStand (HIL Test Development)](//www.ni.com/en/shop/data-acquisition-and-control/application-software-for-data-acquisition-and-control-category/what-is-veristand.html)Free Interactive Test Software
    - [FlexLogger (for DAQ hardware)](//www.ni.com/en/shop/data-acquisition-and-control/flexlogger.html)
    - [InstrumentStudio (for PXI hardware)](https://www.ni.com/en/shop/electronic-test-instrumentation/application-software-for-electronic-test-and-instrumentation-category/instrumentstudio.html)Test Analytics and Operations
    - [DIAdem (for Analysis and Visualization)](//www.ni.com/en/shop/data-acquisition-and-control/application-software-for-data-acquisition-and-control-category/what-is-diadem.html)
    - [SystemLink (Test Operations)](//www.ni.com/en/shop/electronic-test-instrumentation/application-software-for-electronic-test-and-instrumentation-category/systemlink.html)
    - [OptimalPlus GO (Manufacturing Analytics)](//www.ni.com/en/shop/electronic-test-instrumentation/application-software-for-electronic-test-and-instrumentation-category/what-is-optimalplusgo.html)SERVICES
    [View All Services](//www.ni.com/en/shop/services.html)
    - [Repair Services](//www.ni.com/en/shop/services/hardware/repair-replacement-services.html)
    - [Calibration](//www.ni.com/en/shop/services/hardware/calibration-services.html)
    - [Training Courses](https://www.ni.com/en-us/shop/category/courses.html)
    HARDWARE
    [View All Hardware](https://www.ni.com/en/shop.html#pinned-nav-section1)
    Data Acquisition and Control
    - [Learn About DAQ](//www.ni.com/en/shop/data-acquisition.html)
    - [New DAQ Hardware (mioDAQ)](https://www.ni.com/en/shop/data-acquisition/miodaq-devices.html)
    - [Multifunction I/O](//www.ni.com/en-us/shop/category/multifunction-io.html)
    - [Voltage](//www.ni.com/en-us/shop/category/voltage.html)
    - [Digital I/O](//www.ni.com/en-us/shop/category/digital-io.html)
    - [Temperature](//www.ni.com/en-us/shop/category/temperature.html)
    - [Sound and Vibration](//www.ni.com/en-us/shop/category/sound-and-vibration.html)
    - [Current](//www.ni.com/en-us/shop/category/current.html)
    - [Strain, Pressure, and Force](//www.ni.com/en-us/shop/category/strain-pressure-and-force.html)Communication Interfaces
    - [Software Defined Radios](//www.ni.com/en-us/shop/category/software-defined-radios.html)
    - [GPIB, Serial, and Ethernet](//www.ni.com/en-us/shop/category/gpib-serial-and-ethernet.html)
    - [Industrial Communication Buses](//www.ni.com/en-us/shop/category/industrial-communication-buses.html)
    - [Vehicle Communication Buses](//www.ni.com/en-us/shop/category/vehicle-communication-buses.html)
    - [Avionics Communication Buses](//www.ni.com/en-us/shop/category/avionics-communication-buses.html)
    PXI Instrumentation
    - [Switches](//www.ni.com/en-us/shop/category/switches.html)
    - [Oscilloscopes](//www.ni.com/en-us/shop/category/oscilloscopes-and-digitizers.html)
    - [Digital Multimeters](//www.ni.com/en-us/shop/category/digital-multimeters.html)
    - [Waveform Generators](//www.ni.com/en-us/shop/category/waveform-generators.html)
    - [RF Signal Generators](//www.ni.com/en-us/shop/category/rf-signal-generators.html)
    - [SMUs and LCR Meters](//www.ni.com/en-us/shop/category/source-measure-units-and-lcr-meters.html)
    - [Power Supplies and Loads](//www.ni.com/en-us/shop/select/power-supplies-and-loads-category)
    - [Vector Signal Transceivers](//www.ni.com/en-us/shop/category/vector-signal-transceivers.html)
    - [FlexRIO Instruments](//www.ni.com/en-us/shop/category/flexrio-custom-instruments-and-processing.html)Accessories
    - [Power Accessories](//www.ni.com/en-us/shop/category/power-accessories.html)
    - [Connectors](//www.ni.com/en-us/shop/category/connectors.html)
    - [Cables](//www.ni.com/en-us/shop/category/cables.html)
    - [Sensors](//www.ni.com/en-us/shop/category/sensors.html)RESOURCES
    - [Ordering Resources](https://www.ni.com/en/shop/resources.html)
    - [Distributors](//www.ni.com/en/shop/resources/finding-distributor.html)
    [See all products](//www.ni.com/en/shop.html)
    [CompactDAQ

    Modular Data Acquisition](https://www.ni.com/en/shop/compactdaq.html)

    [CompactRIO

    Distributed Measurement and Control](https://www.ni.com/en/shop/compactrio.html)

    [PXI

    High-Performance Test](https://www.ni.com/en/shop/pxi.html)

    [LabVIEW+ Suite

    Automated Test System Development Software](https://www.ni.com/en/shop/labview/labview-plus-suite.html)
  + [Perspectives](//www.ni.com/en/perspectives.html)
    Perspectives

    Perspectives showcases how NI sees what’s next in the world of test and technology.

    [View all articles](https://www.ni.com/en/perspectives.html)

    ![](https://ni.scene7.com/is/image/ni/AdobeStock_538838391_249x112)
    Charting the Course for Test Development with LabVIEW
    LabVIEW remains key in test, promising speed, efficiency, and new features with NI’s investment in core tech, community, and integration.
    [Read our featured article](https://www.ni.com/en/perspectives/charting-course-test-development-labview.html)
  + [Support](//www.ni.com/en/support.html)
    Resources
    [View All Support Resources](https://www.ni.com/en/support.html)
    - [Software Downloads](//www.ni.com/en/support/downloads.html)
    - [Register and Activate](//www.ni.com/myni/products/en/)
    - [Product Documentation](https://www.ni.com/docs/)
    - [Release Notes](//www.ni.com/en/support/documentation/release-notes.html)
    - [Online Training](//learn.ni.com)
    - [KnowledgeBase](https://www.ni.com/en/search.html?pg=1&ps=10&sn=catnav:sup.kbs)
    - [Code Examples](//forums.ni.com/t5/Example-Programs/ct-p/code-documents)Request Support

    You can request repair, RMA, schedule calibration, or get technical support. A valid service agreement may be required.

    [Open a service request](https://www.ni.com/my-support/s/service-requests)

    Popular Software Downloads
    [See all Software Product Downloads](//www.ni.com/en/support/downloads/software-products.html)
    [![icon of LabVIEW logo](https://ni.scene7.com/is/image/ni/LabVIEW?$ni-icon-pm$)
    LabVIEW](https://www.ni.com/en/support/downloads/software-products/download.labview.html)

    [![icon of Multisim logo](https://ni.scene7.com/is/image/ni/Multisim_BG?$ni-icon-pm$)
    Multisim](https://www.ni.com/en/support/downloads/software-products/download.multisim.html)

    [![icon of Academic Volume License logo](https://ni.scene7.com/is/image/ni/sw_suites_bundles?$ni-icon-pm$)
    Academic Volume License](https://www.ni.com/en/support/downloads/software-products/download.academic-volume-license.html)

    Popular Driver Downloads
    [See all Driver Software Downloads](https://www.ni.com/en/search.html?pg=1&ps=10&sb=%2Brelevancy&sn=catnav:sup.dwl.ndr)
    - [NI-DAQmx](https://www.ni.com/en/support/downloads/drivers/download.ni-daq-mx.html)

      Provides support for NI data acquisition and signal conditioning devices.
    - [NI-VISA](//www.ni.com/en/support/downloads/drivers/download.ni-visa.html)

      Provides support for Ethernet, GPIB, serial, USB, and other types of instruments.
    - [NI-488.2](//www.ni.com/en/support/downloads/drivers/download.ni-488-2.html)

      Provides support for NI GPIB controllers and NI embedded controllers with GPIB ports.
  + [Community](//forums.ni.com/)
  + [Partners](https://www.ni.com/en/partners.html)
  + [Contact Us](//www.ni.com/en/contact-us.html)
    ![flag representing the selected language]()
  + My Account
  + [Account](//www.ni.com/myni/dashboard/)
  + Search
* [Cart](http://sine.ni.com/apps/utf8/nios.store?action=view_cart)
* + Solutions
    - Back
    - Industries
    - [Academic and Research](//www.ni.com/en/solutions/academic-research.html)
    - [Aerospace, Defense, and Government](//www.ni.com/en/solutions/aerospace-defense.html)
    - [Electronics](//www.ni.com/en/solutions/electronics.html)
    - [Energy](//www.ni.com/en/solutions/energy.html)
    - [Industrial Machinery](//www.ni.com/en/solutions/industrial-machinery.html)
    - [Life Sciences](https://www.ni.com/en/solutions/life-sciences.html)
    - [Semiconductor](//www.ni.com/en/solutions/semiconductor.html)
    - [Transportation](//www.ni.com/en/solutions/transportation.html)
    - Product Life Cycles
    - [Design and Prototype](//www.ni.com/en/solutions/design-prototype.html)
    - [Validation](//www.ni.com/en/solutions/validation.html)
    - [Production](//www.ni.com/en/solutions/production.html)
    - Focus Areas
    - [5G and 6G Technology](//www.ni.com/en/solutions/5g-6g.html)
    - [ADAS and Autonomous Driving Testing](//www.ni.com/en/solutions/transportation/adas-and-autonomous-driving-testing.html)
    - [Electric Vehicle Test](//www.ni.com/en/solutions/transportation/electric-vehicle-test.html)
    - [Lifecycle Analytics](//www.ni.com/en/solutions/lifecycle-analytics.html)
    - [Radar and Electronic Warfare](//www.ni.com/en/solutions/aerospace-defense/radar-electronic-warfare-sigint.html)
    - [Space Launch and Exploration](//www.ni.com/en/solutions/aerospace-defense/space-launch-exploration.html)
    - [Validation Lab Innovations](https://www.ni.com/en/solutions/semiconductor/validation-lab-innovations.html)
    - [See our approach to solutions](//www.ni.com/en/solutions.html)
  + Products
    - Back
    - Software
    - [View All Software](//www.ni.com/en/shop/software-portfolio.html)
    - Test Automation
    - [LabVIEW](//www.ni.com/en/shop/labview.html)
    - [LabVIEW+ Suite](//www.ni.com/en/shop/labview/labview-plus-suite.html)
    - [TestStand (Test Execution)](//www.ni.com/en/shop/electronic-test-instrumentation/application-software-for-electronic-test-and-instrumentation-category/what-is-teststand.html)
    - [VeriStand (HIL Test Development)](//www.ni.com/en/shop/data-acquisition-and-control/application-software-for-data-acquisition-and-control-category/what-is-veristand.html)
    - Free Interactive Test Software
    - [FlexLogger (for DAQ hardware)](//www.ni.com/en/shop/data-acquisition-and-control/flexlogger.html)
    - [InstrumentStudio (for PXI hardware)](https://www.ni.com/en/shop/electronic-test-instrumentation/application-software-for-electronic-test-and-instrumentation-category/instrumentstudio.html)
    - Test Analytics and Operations
    - [DIAdem (for Analysis and Visualization)](//www.ni.com/en/shop/data-acquisition-and-control/application-software-for-data-acquisition-and-control-category/what-is-diadem.html)
    - [SystemLink (Test Operations)](//www.ni.com/en/shop/electronic-test-instrumentation/application-software-for-electronic-test-and-instrumentation-category/systemlink.html)
    - [OptimalPlus GO (Manufacturing Analytics)](//www.ni.com/en/shop/electronic-test-instrumentation/application-software-for-electronic-test-and-instrumentation-category/what-is-optimalplusgo.html)
    - SERVICES
    - [View All Services](//www.ni.com/en/shop/services.html)
    - [Repair Services](//www.ni.com/en/shop/services/hardware/repair-replacement-services.html)
    - [Calibration](//www.ni.com/en/shop/services/hardware/calibration-services.html)
    - [Training Courses](https://www.ni.com/en-us/shop/category/courses.html)
    - HARDWARE
    - [View All Hardware](https://www.ni.com/en/shop.html#pinned-nav-section1)
    - Data Acquisition and Control
    - [Learn About DAQ](//www.ni.com/en/shop/data-acquisition.html)
    - [New DAQ Hardware (mioDAQ)](https://www.ni.com/en/shop/data-acquisition/miodaq-devices.html)
    - [Multifunction I/O](//www.ni.com/en-us/shop/category/multifunction-io.html)
    - [Voltage](//www.ni.com/en-us/shop/category/voltage.html)
    - [Digital I/O](//www.ni.com/en-us/shop/category/digital-io.html)
    - [Temperature](//www.ni.com/en-us/shop/category/temperature.html)
    - [Sound and Vibration](//www.ni.com/en-us/shop/category/sound-and-vibration.html)
    - [Current](//www.ni.com/en-us/shop/category/current.html)
    - [Strain, Pressure, and Force](//www.ni.com/en-us/shop/category/strain-pressure-and-force.html)
    - Communication Interfaces
    - [Software Defined Radios](//www.ni.com/en-us/shop/category/software-defined-radios.html)
    - [GPIB, Serial, and Ethernet](//www.ni.com/en-us/shop/category/gpib-serial-and-ethernet.html)
    - [Industrial Communication Buses](//www.ni.com/en-us/shop/category/industrial-communication-buses.html)
    - [Vehicle Communication Buses](//www.ni.com/en-us/shop/category/vehicle-communication-buses.html)
    - [Avionics Communication Buses](//www.ni.com/en-us/shop/category/avionics-communication-buses.html)
    - PXI Instrumentation
    - [Switches](//www.ni.com/en-us/shop/category/switches.html)
    - [Oscilloscopes](//www.ni.com/en-us/shop/category/oscilloscopes-and-digitizers.html)
    - [Digital Multimeters](//www.ni.com/en-us/shop/category/digital-multimeters.html)
    - [Waveform Generators](//www.ni.com/en-us/shop/category/waveform-generators.html)
    - [RF Signal Generators](//www.ni.com/en-us/shop/category/rf-signal-generators.html)
    - [SMUs and LCR Meters](//www.ni.com/en-us/shop/category/source-measure-units-and-lcr-meters.html)
    - [Power Supplies and Loads](//www.ni.com/en-us/shop/select/power-supplies-and-loads-category)
    - [Vector Signal Transceivers](//www.ni.com/en-us/shop/category/vector-signal-transceivers.html)
    - [FlexRIO Instruments](//www.ni.com/en-us/shop/category/flexrio-custom-instruments-and-processing.html)
    - Accessories
    - [Power Accessories](//www.ni.com/en-us/shop/category/power-accessories.html)
    - [Connectors](//www.ni.com/en-us/shop/category/connectors.html)
    - [Cables](//www.ni.com/en-us/shop/category/cables.html)
    - [Sensors](//www.ni.com/en-us/shop/category/sensors.html)
    - RESOURCES
    - [Ordering Resources](https://www.ni.com/en/shop/resources.html)
    - [Distributors](//www.ni.com/en/shop/resources/finding-distributor.html)
    - [See all products](//www.ni.com/en/shop.html)
  + [Perspectives](//www.ni.com/en/perspectives.html)
  + Support
    - Back
    - Resources
    - [View All Support Resources](https://www.ni.com/en/support.html)
    - [Software Downloads](//www.ni.com/en/support/downloads.html)
    - [Register and Activate](//www.ni.com/myni/products/en/)
    - [Product Documentation](https://www.ni.com/docs/)
    - [Release Notes](//www.ni.com/en/support/documentation/release-notes.html)
    - [Online Training](//learn.ni.com)
    - [KnowledgeBase](https://www.ni.com/en/search.html?pg=1&ps=10&sn=catnav:sup.kbs)
    - [Code Examples](//forums.ni.com/t5/Example-Programs/ct-p/code-documents)
    - Popular Software Downloads
    - [See all Software Product Downloads](//www.ni.com/en/support/downloads/software-products.html)
    - [icon of LabVIEW logo](https://www.ni.com/en/support/downloads/software-products/download.labview.html)
    - [icon of Multisim logo](https://www.ni.com/en/support/downloads/software-products/download.multisim.html)
    - [icon of Academic Volume License logo](https://www.ni.com/en/support/downloads/software-products/download.academic-volume-license.html)
    - Popular Driver Downloads
    - [See all Driver Software Downloads](https://www.ni.com/en/search.html?pg=1&ps=10&sb=%2Brelevancy&sn=catnav:sup.dwl.ndr)
    - [NI-DAQmx](https://www.ni.com/en/support/downloads/drivers/download.ni-daq-mx.html)
    - [NI-VISA](//www.ni.com/en/support/downloads/drivers/download.ni-visa.html)
    - [NI-488.2](//www.ni.com/en/support/downloads/drivers/download.ni-488-2.html)
    - Request Support
    - You can request repair, RMA, schedule calibration, or get technical support. A valid service agreement may be required.

      [Open a service request](https://www.ni.com/my-support/s/service-requests)
  + [Community](//forums.ni.com/)
  + [Partners](https://www.ni.com/en/partners.html)
  + [Contact Us](//www.ni.com/en/contact-us.html)
  + [Account](//www.ni.com/myni/dashboard/)

[Home](/en.html)

[Support](/en/support.html)

[Documentation](https://www.ni.com/docs/)

Supplemental

# Incomplete RSRC Validation in LabVIEW

Updated May 30, 2024

NI has implemented a fix for a crash that can occur in LabVIEW due to incomplete input validation of Virtual Instrument (VI) files. Links to relevant patches are included at the bottom of this page.

### Affected Products

LabVIEW 2017

LabVIEW 2016

LabVIEW 2015

LabVIEW 2014

### Background

A specially crafted VI file can cause the RSRC segment parsing function in LabVIEW to write an arbitrary number of zeros to memory when the VI file is opened by a user. This could result in memory corruption or a LabVIEW crash.

Memory corruption can be a security vulnerability. In this case, exploitation for code execution is very unlikely (for example, refer to the Common Consequences section of [CWE-476](https://cwe.mitre.org/data/definitions/476.html)) and has not been demonstrated. Exploitation for code execution is further mitigated by the operating system’s memory protections. The vulnerability cannot be exploited remotely because the RSRC segment parsing function is not bound to the network stack.

### Mitigation

Always exercise the same precautions with VI files as you would with EXE and DLL files. Refer to [Security Best Practices for LabVIEW VI Files](https://knowledge.ni.com/KnowledgeArticleDetails?id=kA00Z000000PAqcSAG&l=en-US) for guidelines.

### Available Patches

This issue was addressed in the following patches:

[LabVIEW 2014 SP1 f11](/en/support/downloads/software-products/download.labview.html)

[LabVIEW 2015 SP1 f9](/en/support/downloads/software-products/download.labview.html)

[LabVIEW 2016 f4](/en/support/downloads/software-products/download.labview.html)

[LabVIEW 2017 f2](/en/support/downloads/software-products/download.labview.html)

Note: Links above refer to the 32-bit Windows LabVIEW Development Environment patches only. Other platforms and bitnesses can be found by searching [NI Product Downloads](/en/support/downloads.html) for the relevant patch.

### CVSS Score

5.3 - CVSS:3.0/AV:L/AC:H/PR:N/UI:R/S:U/C:N/I:L/A:H

### Related Links

[CVE-2017-2779](https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-2779)

[CWE-476](https://cwe.mitre.org/data/definitions/476.html)

[TALOS-2017-0273](http://www.talosintelligence.com/reports/TALOS-2017-0273)

[Security Best Practices for LabVIEW VI Files](https://knowledge.ni.com/KnowledgeArticleDetails?id=kA00Z000000PAqcSAG&l=en-US)

Back to top

#### Was this information helpful?

Yes

No

What do you need our team of experts to assist you with?

Request a quote
Find the right product
Place an order
[Get support on a product](//www.ni.com/en-us/support.html)

How can we help?

Please enter your information below and we'll be intouch soon.
This field is required

This field is required

This field is required

This field is required

Country

Preferred communication method
Email
Phone call

Send

---

Thanks!

We'll be in touch soon!

![](//www.ni.com/content/dam/web/scene7/images/logo_2020_white.svg)

What do you need our team of experts to assist you with?

Request a quote
Find the right product
Place an order
[Get support on a product](//www.ni.com/en-us/support.html)

How can we help?

Next

Please enter your information below and we'll be intouch soon.
This field is required

This field is required

This field is required

This field is required

Country

Preferred communication method
Email
Phone call

Send

Thanks!

We'll be in touch soon!

![](//www.ni.com/content/dam/web/scene7/images/logo_2020_white.svg)

![](https://ni.scene7.com/is/image/ni/emerson_footer_white?fmt=png-alpha)

Solutions

* [Academic & Research](//www.ni.com/en/solutions/academic-research.html)
* [Aerospace, Defense, & Government](//www.ni.com/en/solutions/aerospace-defense.html)
* [Electronics](//www.ni.com/en/solutions/electronics.html)
* [Energy](//www.ni.com/en/solutions/energy.html)
* [Industrial Machinery](//www.ni.com/en/solutions/industrial-machinery.html)
* [Life Sciences](https://www.ni.com/en/solutions/life-sciences.html)
* [Semiconductor](//www.ni.com/en/solutions/semiconductor.html)
* [Transportation](//www.ni.com/en/solutions/transportation.html)

Orders

* [NI Distribution Partners](https://www.ni.com/en/partners/distributors.html)
* [Order Status and History](//www.ni.com/my/s/orders)
* [Retrieve a Quote](//lumen.ni.com/nicif/US/QUOTES_MYNI/content.xhtml?du=https:%2f%2fsine.ni.com%2fapps%2futf8%2fniwq.retrieve_quote)
* [Terms of Service](https://www.ni.com/en/about-ni/legal/service-terms.html)
* [Order by Part Number or Request a Quote](https://sine.ni.com/apps/utf8/nios.store?action=view_cart)

Company

* [NI is now part of Emerson](//www.emerson.com/en-us/news/2023/emerson-completes-ni-acquisition)
* [About](//www.ni.com/en/about-ni.html)
* [Emerson Careers](https://www.emerson.com/en-us/careers/)
* [Newsroom](//www.ni.com/en/about-ni/newsroom.html)
* [Supply Chain & Quality](//www.ni.com/en/about-ni/corporate-quality.html)
* [Events](//www.ni.com/en/events.html)

Support

* [Downloads](//www.ni.com/en/support/downloads.html)
* [Product Documentation](https://www.ni.com/docs/en-US/)
* [Discussion Forums](//forums.ni.com/t5/Discussion-Forums/ct-p/discussion-forums)
* [Activate a Product](//www.ni.com/en/support/downloads/activate.html)
* [Submit a Service Request](https://www.ni.com/my-support/s/service-requests)
* [Site Feedback](https://survey.ni.com/jfe/form/SV_daMuCfO1or7M5HD?Q_Language=EN)

[Facebook](//www.facebook.com/NationalInstruments/)
[Twitter](//twitter.com/NIglobal)
[LinkedIn](//www.linkedin.com/company/niglobal/)
[YouTube](//www.youtube.com/channel/UCyDcKI_0iqa15FNBUhIvV-g)
[Instagram](//www.instagram.com/niglobal/?hl=en )

[![]()](https://www.ni.com/global-gateway/)

[LEGAL](//www.ni.com/en/about-ni/legal.html) |
[IMPRINT](https://www.ni.com/en/about-ni/legal/imprint.html) |
[PRIVACY](//www.ni.com/en/about-ni/legal/privacy-statement.html) |

Cookie Settings

 ©  NATIONAL INSTRUMENTS CORP. ALL RIGHTS RESERVED.


