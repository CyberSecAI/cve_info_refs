=== Content from jenkins.io_cc29b174_20250124_115545.html ===


# Jenkins Security Advisory 2017-02-01

This advisory announces multiple vulnerabilities in Jenkins.

## Description

### Use of AES ECB block cipher mode without IV for encrypting secrets

**SECURITY-304 / CVE-2017-2598**

Secrets such as passwords are typically stored on disk and sent to users as part of some pages in encrypted form. These were encrypted using AES-128 ECB without IV, which exposes Jenkins and the stored secrets to unnecessary risks. Jenkins now encrypts secrets using AES-128 CBC with random IV.

### Items could be created with same name as existing item

**SECURITY-321 / CVE-2017-2599**

An insufficient permission check allowed users with the permission to create new items (e.g. jobs) to overwrite existing items they don’t have access to. After a Jenkins restart, children of the original item, such as builds, were then accessible in some circumstances.

### Node monitor data could be viewed by low privilege users

**SECURITY-343 / CVE-2017-2600**

Overall/Read permission was sufficient to access node monitor data via the remote API. These included system configuration and runtime information of these nodes.

### Possible cross-site scripting vulnerability in jQuery bundled with timeline widget

**SECURITY-349 / CVE-2011-4969**

The Simile timeline widget used on build history pages bundles an outdated jQuery vulnerable to CVE-2011-4969. We were unable to confirm that Jenkins is vulnerable, but updated the jQuery version bundled with the Simile timeline widget anyway.

### Persisted cross-site scripting vulnerability in parameter names and descriptions

**SECURITY-353 / CVE-2017-2601**

Users with the permission to configure jobs were able to inject JavaScript into parameter names and descriptions.

### Outdated jbcrypt version bundled with Jenkins

**SECURITY-354 / CVE-2015-0886**

Jenkins bundled an outdated version of jbcrypt that was affected by CVE-2015-0886.

### Pipeline metadata files not excluded in agent-to-controller security subsystem

**SECURITY-358 / CVE-2017-2602**

The Pipeline suite of plugins stored build metadata in the file `program.dat` and the directory `workflow/`. These were not excluded in the [agent-to-controller security subsystem](/security-144) and could therefore be written to by malicious agents.

### User data leak in disconnected agents' config.xml API

**SECURITY-362 / CVE-2017-2603**

Agents that were disconnected by users contained the disconnecting user’s `User` object in serialized form in the `config.xml` remote API output. This could leak sensitive data such as API tokens.

### Low privilege users were able to act on administrative monitors

**SECURITY-371 / CVE-2017-2604**

Administrative monitors are warnings about the system state shown to Jenkins admins. They sometimes provide actions to e.g. automatically address the reported problem, or disable the warning. These actions were not consistently protected by permission checks, thereby allowing low privilege users to act on them.

All administrative monitors now require the user accessing them to be an administrator.

### Re-key admin monitor leaves behind unencrypted credentials in upgraded installations

**SECURITY-376 / CVE-2017-1000362**

The re-key admin monitor was introduced in Jenkins 1.498 and re-encrypted all secrets in JENKINS\_HOME with a new key. It also created a backup directory with all old secrets, and the key used to encrypt them. These backups were world-readable and not removed afterwards.

Jenkins now deletes the backup directory, if present. Upgrading from before 1.498 will no longer create a backup directory. **Administrators relying on file access permissions in their manually created backups are advised to check them for the directory `$JENKINS_HOME/jenkins.security.RekeySecretAdminMonitor/backups`, and delete it if present.**

### Internal API allowed access to item names that should not be visible

**SECURITY-380 / CVE-2017-2606**

The method `Jenkins#getItems()` included a performance optimization that resulted in all items being returned if the *Logged in users can do anything* authorization strategy was used, and no access was granted to anonymous users (an option added in Jenkins 2.0). This only affects anonymous users (other users legitimately have access) that were able to get a list of items via an `UnprotectedRootAction`.

### Persisted cross-site scripting vulnerability in console notes

**SECURITY-382 / CVE-2017-2607**

Jenkins allows plugins to annotate build logs, adding new content or changing the presentation of existing content while the build is running. Popular examples include the highlighting of sections by [Ant Plugin](https://plugins.jenkins.io/ant), or the timestamp metadata from [Timestamper](https://plugins.jenkins.io/timestamper). Malicious Jenkins users, or users with SCM access, could configure jobs or modify build scripts such that they print serialized console notes that perform cross-site scripting attacks on Jenkins users viewing the build logs.

To prevent this, console notes are now signed by Jenkins when created, and Jenkins will only deserialize correctly signed console notes. **As a side effect, console notes created before updating to a release containing this fix will no longer be deserialized.** To restore the previous (unsafe) behavior, set the system property `hudson.console.ConsoleNote.INSECURE` to `true` as described on [Features controlled by system properties](/doc/book/managing/system-properties/).

### XStream remote code execution vulnerability

**SECURITY-383 / CVE-2017-2608**

XStream-based APIs in Jenkins (e.g. `/createItem` URLs, or `POST config.xml` remote API) were vulnerable to a remote code execution vulnerability involving the deserialization of various types in `javax.imageio`.

In case this extension of the blocklist results in regressions, the blocklist can be customized as described [in the Jenkins LTS upgrade guide for Jenkins 2.19.3](/doc/upgrade-guide/2.19/#upgrading-to-jenkins-lts-2-19-3).

### Information disclosure vulnerability in search suggestions

**SECURITY-385 / CVE-2017-2609**

The autocompletion for the search box provided the names of views the current user does not have access to in its suggestions. These suggestions were removed.

### Persisted cross-site scripting vulnerability in search suggestions

**SECURITY-388 / CVE-2017-2610**

Jenkins allows the creation of users with less-than and greater-than characters in their names. These user names were not escaped when displaying search suggestions, resulting in a cross-site scripting vulnerability.

### Insufficient permission check for periodic processes

**SECURITY-389 / CVE-2017-2611**

The URLs `/workspaceCleanup` and `/fingerprintCleanup` did not perform permission checks, allowing users with read access to Jenkins to trigger these background processes (that are otherwise performed daily), possibly causing additional load on Jenkins controller and agents.

### Low privilege users were able to override JDK download credentials

**SECURITY-392 / CVE-2017-2612**

Jenkins allows administrators to enter their username and password to the Oracle download site which provides JDKs for download. Users with read access to Jenkins were able to override these credentials, resulting in future builds possibly failing to download a JDK. A permission check has been added.

### User creation CSRF using GET by admins

**SECURITY-406 / CVE-2017-2613**

When administrators accessed a URL like `/user/example` via HTTP GET, a user with the ID `example` was created if it did not exist. While this user record was only retained until restart in most cases, administrators' web browsers could be manipulated to create a large number of user records.

Accessing these URLs now no longer results in a user record getting created, Jenkins will respond with 404 Not Found if no such user exists. When using the internal Jenkins user database, new users can be created via *Manage Jenkins Â» Manage Users*. To restore the previous (unsafe) behavior, set the system property `hudson.model.User.allowUserCreationViaUrl` to `true` as described on [Features controlled by system properties](/doc/book/managing/system-properties/).

## Severity

* SECURITY-304: **[medium](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N)**
* SECURITY-321: **[medium](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:N)**
* SECURITY-343: **[medium](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N)**
* SECURITY-349: **[medium](https://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2015-0886)**
* SECURITY-353: **[medium](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N)**
* SECURITY-354: **[medium](https://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2011-4969)**
* SECURITY-358: **[low](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:H/PR:L/UI:N/S:U/C:N/I:L/A:N)**
* SECURITY-362: **[low](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:H/PR:L/UI:R/S:U/C:L/I:N/A:N)**
* SECURITY-371: **[medium](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:N)**
* SECURITY-376: **[medium](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:L/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N)**
* SECURITY-380: **[medium](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N)**
* SECURITY-382: **[medium](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:H/PR:L/UI:N/S:U/C:L/I:L/A:N)**
* SECURITY-383: **[high](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)**
* SECURITY-385: **[medium](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N)**
* SECURITY-388: **[medium](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N)**
* SECURITY-389: **[medium](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:L)**
* SECURITY-392: **[medium](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:L)**
* SECURITY-406: **[medium](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:L)**

## Affected versions

* All Jenkins main line releases up to and including 2.43
* All Jenkins LTS releases up to and including 2.32.1

## Fix

* Jenkins main line users should update to 2.44
* Jenkins LTS users should update to 2.32.2

These versions include fixes to all the vulnerabilities described above. All prior versions are affected by these vulnerabilities unless otherwise indicated.

## Credit

The Jenkins project would like to thank the reporters for discovering and [reporting](/security/#reporting-vulnerabilities) these vulnerabilities:

* **Ben Walding, CloudBees, Inc.** for SECURITY-304
* **Daniel Beck, CloudBees, Inc.** for SECURITY-343, SECURITY-371, SECURITY-385, and SECURITY-392
* **James Dumay, CloudBees, Inc.** for SECURITY-380
* **Jean Marsault, Wavestone** for SECURITY-388 and SECURITY-406
* **Jesse Glick, CloudBees, Inc.** for SECURITY-358 and SECURITY-382
* **Mayuri Gaikwad and Suhas Gaikwad** for SECURITY-353
* **Moritz Bechler of AgNO3** for SECURITY-383
* **Robert Picard, Addepar** for SECURITY-389
* **Robert Pitt, Electronic Arts Inc.** for SECURITY-362
* **Steve Marlowe <smarlowe@cisco.com> of Cisco ASIG** for SECURITY-376
* **Taneli Vallo** for SECURITY-321

## Other Resources

* [Announcement blog post](/blog/2017/02/01/security-updates/)
* [Corresponding advisory from CloudBees for CloudBees Jenkins Platform](https://www.cloudbees.com/cloudbees-security-advisory-2017-02-01)



=== Content from access.redhat.com_ff53ffad_20250126_005544.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from bugzilla.redhat.com_640da511_20250124_115542.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3DCVE-2017-2598)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3DCVE-2017-2598)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3DCVE-2017-2598)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1418696

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1418696**](show_bug.cgi?id=1418696)
(CVE-2017-2598)
- [CVE-2017-2598](https://access.redhat.com/security/cve/CVE-2017-2598) jenkins: Use of AES ECB block cipher mode without IV for encrypting secrets (SECURITY-304)

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2017-2598 jenkins: Use of AES ECB block cipher mode without IV for encryp...

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2017-2598 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [1418736](show_bug.cgi?id=1418736 "CLOSED WONTFIX - CVE-2017-1000362 CVE-2017-2598 CVE-2017-2599 CVE-2017-2600 CVE-2017-2601 CVE-2017-2602 CVE-2017-2604 CVE-2017-2606 CVE-2017-2607 CVE-2017-2608 CVE-2017-2609 CVE-2017-2610 CVE-2017-2611 CVE-2017-2612 CVE-2017-2613 jenkins: various flaws [fedora-all]") | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1395176](show_bug.cgi?id=1395176) [1418735](show_bug.cgi?id=1418735) | | TreeView+ | [depends on](buglist.cgi?bug_id=1418696&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1418696&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2017-02-02 14:39 UTC by Andrej Nemec | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2021-10-21 11:50 UTC ([History](show_activity.cgi?id=1418696)) | | [CC List:](page.cgi?id=fields.html#cclist) | 12 users (show)  abhgupta bleanhar ccoleman dedgar dmcphers java-sig-commits jgoulding joelsmith mizdebsk msrb tdawson tiwillia | | Fixed In Version: | jenkins 2.44, jenkins 2.32.2 | | | Doc Type: | If docs needed, set a value | | | Doc Text: |  | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2021-10-21 11:50:56 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1418696#c0)  Andrej Nemec    2017-02-02 14:39:29 UTC  ```  The following flaw was found in Jenkins:  Secrets such as passwords are typically stored on disk and sent to users as part of some pages in encrypted form. These were encrypted using AES-128 ECB without IV, which exposes Jenkins and the stored secrets to unnecessary risks. Jenkins now encrypts secrets using AES-128 CBC with random IV.  External References:  [https://wiki.jenkins-ci.org/display/SECURITY/Jenkins+Security+Advisory+2017-02-01](https://wiki.jenkins-ci.org/display/SECURITY/Jenkins%2BSecurity%2BAdvisory%2B2017-02-01)  Upstream patch:  <https://github.com/jenkinsci/jenkins/commit/e6aa166246d1734f4798a9e31f78842f4c85c28b>   ```  [Comment 1](show_bug.cgi?id=1418696#c1)  Andrej Nemec    2017-02-02 15:23:19 UTC  ``` Created jenkins tracking bugs for this issue:  Affects: fedora-all [[bug 1418736](show_bug.cgi?id=1418736 "CLOSED WONTFIX - CVE-2017-1000362 CVE-2017-2598 CVE-2017-2599 CVE-2017-2600 CVE-2017-2601 CVE-2017-2602 CVE-2017-2604 CVE-2017-2606 CVE-2017-2607 CVE-2017-2608 CVE-2017-2609 CVE-2017-2610 CVE-2017-2611 CVE-2017-2612 CVE-2017-2613 jenkins: various flaws [fedora-all]")]   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1418696&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from github.com_170c5499_20250124_115544.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjenkinsci%2Fjenkins%2Fcommit%2Fe6aa166246d1734f4798a9e31f78842f4c85c28b)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjenkinsci%2Fjenkins%2Fcommit%2Fe6aa166246d1734f4798a9e31f78842f4c85c28b)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=jenkinsci%2Fjenkins)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[jenkinsci](/jenkinsci)
/
**[jenkins](/jenkinsci/jenkins)**
Public

* [Notifications](/login?return_to=%2Fjenkinsci%2Fjenkins) You must be signed in to change notification settings
* [Fork
  8.9k](/login?return_to=%2Fjenkinsci%2Fjenkins)
* [Star
   23.5k](/login?return_to=%2Fjenkinsci%2Fjenkins)

* [Code](/jenkinsci/jenkins)
* [Pull requests
  80](/jenkinsci/jenkins/pulls)
* [Actions](/jenkinsci/jenkins/actions)
* [Security](/jenkinsci/jenkins/security)
* [Insights](/jenkinsci/jenkins/pulse)

Additional navigation options

* [Code](/jenkinsci/jenkins)
* [Pull requests](/jenkinsci/jenkins/pulls)
* [Actions](/jenkinsci/jenkins/actions)
* [Security](/jenkinsci/jenkins/security)
* [Insights](/jenkinsci/jenkins/pulse)

## Commit

[Permalink](/jenkinsci/jenkins/commit/e6aa166246d1734f4798a9e31f78842f4c85c28b)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request [#105](https://github.com/jenkinsci/jenkins/pull/105) from jenkinsci-cert/SECURITY-304-t3

[Browse files](/jenkinsci/jenkins/tree/e6aa166246d1734f4798a9e31f78842f4c85c28b)
Browse the repository at this point in the history

```
[SECURITY-304] Encrypt new secrets with CBC and random IV instead of ECB
```

* Loading branch information

[![@jglick](https://avatars.githubusercontent.com/u/154109?s=40&v=4)](/jglick)

[jglick](/jenkinsci/jenkins/commits?author=jglick "View all commits by jglick")
committed
Jan 23, 2017

1 parent
[b0ed966](/jenkinsci/jenkins/commit/b0ed9669bc00dbccf1be6896bb527b4cf2e7687d)

commit e6aa166

 Show file tree

 Hide file tree

Showing
**14 changed files**
with
**517 additions**
and
**88 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* core/src

  + main/java

    - hudson

      * model

        + core/src/main/java/hudson/model/Item.java
          [Item.java](#diff-3b384eda7e829db950d9a012f189a7c8a9261d2ece8ad9919ebc2f83af2b51ca)
      * util

        + core/src/main/java/hudson/util/HistoricalSecrets.java
          [HistoricalSecrets.java](#diff-72b61d04b1c1cc3d17103519e10ab04d44dd712232fe977048490f14c7f35270)
        + core/src/main/java/hudson/util/Secret.java
          [Secret.java](#diff-660a24e9736ee8d457fd53ba4cf32b76a3d9401f90e120c274f904a139869511)
        + core/src/main/java/hudson/util/SecretRewriter.java
          [SecretRewriter.java](#diff-9ce77510ff8c40c19c781de68eab781ed3eb507104b4a8a5b60920f86aec42f2)
    - jenkins/security

      * core/src/main/java/jenkins/security/CryptoConfidentialKey.java
        [CryptoConfidentialKey.java](#diff-ab61dc83eebde8617bb43173d87112194afd3a2b52488f7ac8330eacd687fea2)
  + test/groovy/hudson/util

    - core/src/test/groovy/hudson/util/SecretRewriterTest.groovy
      [SecretRewriterTest.groovy](#diff-4fc444c4f7fae3ee0e8bfead8e6632ce4f0c337a339a2a2cf5f8b4c7ebf5257f)
    - core/src/test/groovy/hudson/util/SecretTest.groovy
      [SecretTest.groovy](#diff-dd6875ccfb4d83391b8d9c2a00986700266018020db1791bbe6311f1a3cd81bf)
* test/src/test

  + java

    - hudson/util

      * test/src/test/java/hudson/util/SecretCompatTest.java
        [SecretCompatTest.java](#diff-2a11cb55cde219ca7e820df1bb94dca03a1fe5f8d69542b3a4ef11a799e4f13b)
    - jenkins/security

      * test/src/test/java/jenkins/security/RekeySecretAdminMonitorTest.java
        [RekeySecretAdminMonitorTest.java](#diff-c65350b466006d40de56e6f3d6d39d813d93148736c57153fabab399b36fedeb)
    - lib/form

      * test/src/test/java/lib/form/PasswordTest.java
        [PasswordTest.java](#diff-df9379038237905d0d58052a456c83852858fd2c017981bac259066ed29138e2)
  + resources/hudson/util/SecretCompatTest/canReadPreSec304Secrets

    - test/src/test/resources/hudson/util/SecretCompatTest/canReadPreSec304Secrets/config.xml
      [config.xml](#diff-ef4e80f9db1329b5e32a09a4e267cbf71ddb6a3797a12d5737b49f00415be7e3)
    - jobs/OldSecret

      * test/src/test/resources/hudson/util/SecretCompatTest/canReadPreSec304Secrets/jobs/OldSecret/config.xml
        [config.xml](#diff-239f55b94995ebf3d30c05608d67e505bcadc7ff699603d2b6eb27f5bee14015)
    - secrets

      * test/src/test/resources/hudson/util/SecretCompatTest/canReadPreSec304Secrets/secrets/hudson.util.Secret
        [hudson.util.Secret](#diff-fc9a056a2b65a6022d2c48f982a2cbdf1b1026fe34f9d36589d960fbc9e3efd5)
      * test/src/test/resources/hudson/util/SecretCompatTest/canReadPreSec304Secrets/secrets/master.key
        [master.key](#diff-dd1eb09c1105f018e99769c468e4bcd0148cbe704fe4fd570902d2e2366e38ea)

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[core/src/main/java/hudson/model/Item.java](#diff-3b384eda7e829db950d9a012f189a7c8a9261d2ece8ad9919ebc2f83af2b51ca "core/src/main/java/hudson/model/Item.java")

Show comments

[View file](/jenkinsci/jenkins/blob/e6aa166246d1734f4798a9e31f78842f4c85c28b/core/src/main/java/hudson/model/Item.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -229,7 +229,7 @@ public interface Item extends PersistenceRoot, SearchableModelObject, AccessCont |
|  |  | Permission DISCOVER = new Permission(PERMISSIONS, "Discover", Messages.\_AbstractProject\_DiscoverPermission\_Description(), READ, PermissionScope.ITEM); |
|  |  | /\*\* |
|  |  | \* Ability to view configuration details. |
|  |  | \* If the user lacks {@link CONFIGURE} then any {@link Secret}s must be masked out, even in encrypted form. |
|  |  | \* If the user lacks {@link #CONFIGURE} then any {@link Secret}s must be masked out, even in encrypted form. |
|  |  | \* @see Secret#ENCRYPTED\_VALUE\_PATTERN |
|  |  | \*/ |
|  |  | Permission EXTENDED\_READ = new Permission(PERMISSIONS,"ExtendedRead", Messages.\_AbstractProject\_ExtendedReadPermission\_Description(), CONFIGURE, Boolean.getBoolean("hudson.security.ExtendedReadPermission"), new PermissionScope[]{PermissionScope.ITEM}); |
| Expand Down | |  |

84 changes: 84 additions & 0 deletions

84
[core/src/main/java/hudson/util/HistoricalSecrets.java](#diff-72b61d04b1c1cc3d17103519e10ab04d44dd712232fe977048490f14c7f35270 "core/src/main/java/hudson/util/HistoricalSecrets.java")

Show comments

[View file](/jenkinsci/jenkins/blob/e6aa166246d1734f4798a9e31f78842f4c85c28b/core/src/main/java/hudson/util/HistoricalSecrets.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,84 @@ |
|  |  | /\* |
|  |  | \* The MIT License |
|  |  | \* |
|  |  | \* Copyright (c) 2004-2010, Sun Microsystems, Inc., Kohsuke Kawaguchi |
|  |  | \* Copyright (c) 2016, CloudBees Inc. |
|  |  | \* |
|  |  | \* Permission is hereby granted, free of charge, to any person obtaining a copy |
|  |  | \* of this software and associated documentation files (the "Software"), to deal |
|  |  | \* in the Software without restriction, including without limitation the rights |
|  |  | \* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell |
|  |  | \* copies of the Software, and to permit persons to whom the Software is |
|  |  | \* furnished to do so, subject to the following conditions: |
|  |  | \* |
|  |  | \* The above copyright notice and this permission notice shall be included in |
|  |  | \* all copies or substantial portions of the Software. |
|  |  | \* |
|  |  | \* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR |
|  |  | \* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, |
|  |  | \* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE |
|  |  | \* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER |
|  |  | \* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, |
|  |  | \* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN |
|  |  | \* THE SOFTWARE. |
|  |  | \*/ |
|  |  | package hudson.util; |
|  |  |  |
|  |  | import com.trilead.ssh2.crypto.Base64; |
|  |  | import hudson.Util; |
|  |  | import jenkins.model.Jenkins; |
|  |  | import jenkins.security.CryptoConfidentialKey; |
|  |  | import org.kohsuke.accmod.Restricted; |
|  |  | import org.kohsuke.accmod.restrictions.NoExternalUse; |
|  |  |  |
|  |  | import javax.crypto.Cipher; |
|  |  | import javax.crypto.SecretKey; |
|  |  | import java.io.IOException; |
|  |  | import java.security.GeneralSecurityException; |
|  |  |  |
|  |  | import static java.nio.charset.StandardCharsets.UTF\_8; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Historical algorithms for decrypting {@link Secret}s. |
|  |  | \*/ |
|  |  | @Restricted(NoExternalUse.class) |
|  |  | public class HistoricalSecrets { |
|  |  |  |
|  |  | /\*package\*/ static Secret decrypt(String data, CryptoConfidentialKey key) throws IOException, GeneralSecurityException { |
|  |  | byte[] in = Base64.decode(data.toCharArray()); |
|  |  | Secret s = tryDecrypt(key.decrypt(), in); |
|  |  | if (s!=null) return s; |
|  |  |  |
|  |  | // try our historical key for backward compatibility |
|  |  | Cipher cipher = Secret.getCipher("AES"); |
|  |  | cipher.init(Cipher.DECRYPT\_MODE, getLegacyKey()); |
|  |  | return tryDecrypt(cipher, in); |
|  |  | } |
|  |  |  |
|  |  | /\*package\*/ static Secret tryDecrypt(Cipher cipher, byte[] in) { |
|  |  | try { |
|  |  | String plainText = new String(cipher.doFinal(in), UTF\_8); |
|  |  | if(plainText.endsWith(MAGIC)) |
|  |  | return new Secret(plainText.substring(0,plainText.length()-MAGIC.length())); |
|  |  | return null; |
|  |  | } catch (GeneralSecurityException e) { |
|  |  | return null; // if the key doesn't match with the bytes, it can result in BadPaddingException |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Turns {@link Jenkins#getSecretKey()} into an AES key. |
|  |  | \* |
|  |  | \* @deprecated |
|  |  | \* This is no longer the key we use to encrypt new information, but we still need this |
|  |  | \* to be able to decrypt what's already persisted. |
|  |  | \*/ |
|  |  | @Deprecated |
|  |  | /\*package\*/ static SecretKey getLegacyKey() throws GeneralSecurityException { |
|  |  | String secret = Secret.SECRET; |
|  |  | if(secret==null) return Jenkins.getInstance().getSecretKeyAsAES128(); |
|  |  | return Util.toAes128Key(secret); |
|  |  | } |
|  |  |  |
|  |  | private static final String MAGIC = "::::MAGIC::::"; |
|  |  | } |

147 changes: 94 additions & 53 deletions

147
[core/src/main/java/hudson/util/Secret.java](#diff-660a24e9736ee8d457fd53ba4cf32b76a3d9401f90e120c274f904a139869511 "core/src/main/java/hudson/util/Secret.java")

Show comments

[View file](/jenkinsci/jenkins/blob/e6aa166246d1734f4798a9e31f78842f4c85c28b/core/src/main/java/hudson/util/Secret.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2,6 +2,7 @@ |
|  |  | \* The MIT License |
|  |  | \* |
|  |  | \* Copyright (c) 2004-2010, Sun Microsystems, Inc., Kohsuke Kawaguchi |
|  |  | \* Copyright (c) 2016, CloudBees Inc. |
|  |  | \* |
|  |  | \* Permission is hereby granted, free of charge, to any person obtaining a copy |
|  |  | \* of this software and associated documentation files (the "Software"), to deal |
| Expand Down  Expand Up | | @@ -29,12 +30,12 @@ |
|  |  | import com.thoughtworks.xstream.io.HierarchicalStreamReader; |
|  |  | import com.thoughtworks.xstream.io.HierarchicalStreamWriter; |
|  |  | import com.trilead.ssh2.crypto.Base64; |
|  |  | import java.util.Arrays; |
|  |  | import jenkins.model.Jenkins; |
|  |  | import hudson.Util; |
|  |  | import jenkins.security.CryptoConfidentialKey; |
|  |  | import org.kohsuke.stapler.Stapler; |
|  |  |  |
|  |  | import javax.crypto.SecretKey; |
|  |  | import javax.crypto.Cipher; |
|  |  | import java.io.Serializable; |
|  |  | import java.io.UnsupportedEncodingException; |
| Expand All | | @@ -44,6 +45,8 @@ |
|  |  | import org.kohsuke.accmod.Restricted; |
|  |  | import org.kohsuke.accmod.restrictions.NoExternalUse; |
|  |  |  |
|  |  | import static java.nio.charset.StandardCharsets.UTF\_8; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Glorified {@link String} that uses encryption in the persisted form, to avoid accidental exposure of a secret. |
|  |  | \* |
| Expand All | | @@ -58,13 +61,20 @@ |
|  |  | \* @author Kohsuke Kawaguchi |
|  |  | \*/ |
|  |  | public final class Secret implements Serializable { |
|  |  | private static final byte PAYLOAD\_V1 = 1; |
|  |  | /\*\* |
|  |  | \* Unencrypted secret text. |
|  |  | \*/ |
|  |  | private final String value; |
|  |  | private byte[] iv; |
|  |  |  |
|  |  | /\*package\*/ Secret(String value) { |
|  |  | this.value = value; |
|  |  | } |
|  |  |  |
|  |  | private Secret(String value) { |
|  |  | /\*package\*/ Secret(String value, byte[] iv) { |
|  |  | this.value = value; |
|  |  | this.iv = iv; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand Down  Expand Up | | @@ -100,77 +110,102 @@ public int hashCode() { |
|  |  | return value.hashCode(); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Turns {@link Jenkins#getSecretKey()} into an AES key. |
|  |  | \* |
|  |  | \* @deprecated |
|  |  | \* This is no longer the key we use to encrypt new information, but we still need this |
|  |  | \* to be able to decrypt what's already persisted. |
|  |  | \*/ |
|  |  | @Deprecated |
|  |  | /\*package\*/ static SecretKey getLegacyKey() throws GeneralSecurityException { |
|  |  | String secret = SECRET; |
|  |  | if(secret==null) return Jenkins.getInstance().getSecretKeyAsAES128(); |
|  |  | return Util.toAes128Key(secret); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Encrypts {@link #value} and returns it in an encoded printable form. |
|  |  | \* |
|  |  | \* @see #toString() |
|  |  | \*/ |
|  |  | public String getEncryptedValue() { |
|  |  | try { |
|  |  | Cipher cipher = KEY.encrypt(); |
|  |  | // add the magic suffix which works like a check sum. |
|  |  | return new String(Base64.encode(cipher.doFinal((value+MAGIC).getBytes("UTF-8")))); |
|  |  | synchronized (this) { |
|  |  | if (iv == null) { //if we were created from plain text or other reason without iv |
|  |  | iv = KEY.newIv(); |
|  |  | } |
|  |  | } |
|  |  | Cipher cipher = KEY.encrypt(iv); |
|  |  | byte[] encrypted = cipher.doFinal(this.value.getBytes(UTF\_8)); |
|  |  | byte[] payload = new byte[1 + 8 + iv.length + encrypted.length]; |
|  |  | int pos = 0; |
|  |  | // For PAYLOAD\_V1 we use this byte shifting model, V2 probably will need DataOutput |
|  |  | payload[pos++] = PAYLOAD\_V1; |
|  |  | payload[pos++] = (byte)(iv.length >> 24); |
|  |  | payload[pos++] = (byte)(iv.length >> 16); |
|  |  | payload[pos++] = (byte)(iv.length >> 8); |
|  |  | payload[pos++] = (byte)(iv.length); |
|  |  | payload[pos++] = (byte)(encrypted.length >> 24); |
|  |  | payload[pos++] = (byte)(encrypted.length >> 16); |
|  |  | payload[pos++] = (byte)(encrypted.length >> 8); |
|  |  | payload[pos++] = (byte)(encrypted.length); |
|  |  | System.arraycopy(iv, 0, payload, pos, iv.length); |
|  |  | pos+=iv.length; |
|  |  | System.arraycopy(encrypted, 0, payload, pos, encrypted.length); |
|  |  | return "{"+new String(Base64.encode(payload))+"}"; |
|  |  | } catch (GeneralSecurityException e) { |
|  |  | throw new Error(e); // impossible |
|  |  | } catch (UnsupportedEncodingException e) { |
|  |  | throw new Error(e); // impossible |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Pattern matching a possible output of {@link #getEncryptedValue}. |
|  |  | \* Basically, any Base64-encoded value. |
|  |  | \* You must then call {@link #decrypt} to eliminate false positives. |
|  |  | \* Pattern matching a possible output of {@link #getEncryptedValue} |
|  |  | \* Basically, any Base64-encoded value optionally wrapped by {@code {}}. |
|  |  | \* You must then call {@link #decrypt(String)} to eliminate false positives. |
|  |  | \* @see #ENCRYPTED\_VALUE\_PATTERN |
|  |  | \*/ |
|  |  | @Restricted(NoExternalUse.class) |
|  |  | public static final Pattern ENCRYPTED\_VALUE\_PATTERN = Pattern.compile("[A-Za-z0-9+/]+={0,2}"); |
|  |  | public static final Pattern ENCRYPTED\_VALUE\_PATTERN = Pattern.compile("\\{?[A-Za-z0-9+/]+={0,2}}?"); |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Reverse operation of {@link #getEncryptedValue()}. Returns null |
|  |  | \* if the given cipher text was invalid. |
|  |  | \*/ |
|  |  | public static Secret decrypt(String data) { |
|  |  | if(data==null) return null; |
|  |  | try { |
|  |  | byte[] in = Base64.decode(data.toCharArray()); |
|  |  | Secret s = tryDecrypt(KEY.decrypt(), in); |
|  |  | if (s!=null) return s; |
|  |  | if (data == null) return null; |
|  |  |  |
|  |  | // try our historical key for backward compatibility |
|  |  | Cipher cipher = getCipher("AES"); |
|  |  | cipher.init(Cipher.DECRYPT\_MODE, getLegacyKey()); |
|  |  | return tryDecrypt(cipher, in); |
|  |  | } catch (GeneralSecurityException e) { |
|  |  | return null; |
|  |  | } catch (UnsupportedEncodingException e) { |
|  |  | throw new Error(e); // impossible |
|  |  | } catch (IOException e) { |
|  |  | return null; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /\*package\*/ static Secret tryDecrypt(Cipher cipher, byte[] in) throws UnsupportedEncodingException { |
|  |  | try { |
|  |  | String plainText = new String(cipher.doFinal(in), "UTF-8"); |
|  |  | if(plainText.endsWith(MAGIC)) |
|  |  | return new Secret(plainText.substring(0,plainText.length()-MAGIC.length())); |
|  |  | return null; |
|  |  | } catch (GeneralSecurityException e) { |
|  |  | return null; // if the key doesn't match with the bytes, it can result in BadPaddingException |
|  |  | if (data.startsWith("{") && data.endsWith("}")) { //likely CBC encrypted/containing metadata but could be plain text |
|  |  | byte[] payload; |
|  |  | try { |
|  |  | payload = Base64.decode(data.substring(1, data.length()-1).toCharArray()); |
|  |  | } catch (IOException e) { |
|  |  | return null; |
|  |  | } |
|  |  | switch (payload[0]) { |
|  |  | case PAYLOAD\_V1: |
|  |  | // For PAYLOAD\_V1 we use this byte shifting model, V2 probably will need DataOutput |
|  |  | int ivLength = ((payload[1] & 0xff) << 24) |
|  |  | | ((payload[2] & 0xff) << 16) |
|  |  | | ((payload[3] & 0xff) << 8) |
|  |  | | (payload[4] & 0xff); |
|  |  | int dataLength = ((payload[5] & 0xff) << 24) |
|  |  | | ((payload[6] & 0xff) << 16) |
|  |  | | ((payload[7] & 0xff) << 8) |
|  |  | | (payload[8] & 0xff); |
|  |  | if (payload.length != 1 + 8 + ivLength + dataLength) { |
|  |  | // not valid v1 |
|  |  | return null; |
|  |  | } |
|  |  | byte[] iv = Arrays.copyOfRange(payload, 9, 9 + ivLength); |
|  |  | byte[] code = Arrays.copyOfRange(payload, 9+ivLength, payload.length); |
|  |  | String text; |
|  |  | try { |
|  |  | text = new String(KEY.decrypt(iv).doFinal(code), UTF\_8); |
|  |  | } catch (GeneralSecurityException e) { |
|  |  | // it's v1 which cannot be historical, but not decrypting |
|  |  | return null; |
|  |  | } |
|  |  | return new Secret(text, iv); |
|  |  | default: |
|  |  | return null; |
|  |  | } |
|  |  | } else { |
|  |  | try { |
|  |  | return HistoricalSecrets.decrypt(data, KEY); |
|  |  | } catch (GeneralSecurityException e) { |
|  |  | return null; |
|  |  | } catch (UnsupportedEncodingException e) { |
|  |  | throw new Error(e); // impossible |
|  |  | } catch (IOException e) { |
|  |  | return null; |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -228,8 +263,6 @@ public Object unmarshal(HierarchicalStreamReader reader, final UnmarshallingCont |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | private static final String MAGIC = "::::MAGIC::::"; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Workaround for JENKINS-6459 / http://java.net/jira/browse/GLASSFISH-11862 |
|  |  | \* @see #getCipher(String) |
| Expand All | | @@ -246,6 +279,14 @@ public Object unmarshal(HierarchicalStreamReader reader, final UnmarshallingCont |
|  |  | \*/ |
|  |  | private static final CryptoConfidentialKey KEY = new CryptoConfidentialKey(Secret.class.getName()); |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Reset the internal secret key for testing. |
|  |  | \*/ |
|  |  | @Restricted(NoExternalUse.class) |
|  |  | /\*package\*/ static void resetKeyForTest() { |
|  |  | KEY.resetForTest(); |
|  |  | } |
|  |  |  |
|  |  | private static final long serialVersionUID = 1L; |
|  |  |  |
|  |  | static { |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[core/src/main/java/hudson/util/SecretRewriter.java](#diff-9ce77510ff8c40c19c781de68eab781ed3eb507104b4a8a5b60920f86aec42f2 "core/src/main/java/hudson/util/SecretRewriter.java")

Show comments

[View file](/jenkinsci/jenkins/blob/e6aa166246d1734f4798a9e31f78842f4c85c28b/core/src/main/java/hudson/util/SecretRewriter.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -40,7 +40,7 @@ public class SecretRewriter { |
|  |  |  |
|  |  | public SecretRewriter() throws GeneralSecurityException { |
|  |  | cipher = Secret.getCipher("AES"); |
|  |  | key = Secret.getLegacyKey(); |
|  |  | key = HistoricalSecrets.getLegacyKey(); |
|  |  | } |
|  |  |  |
|  |  | /\*\* @deprecated SECURITY-376: {@code backupDirectory} is ignored \*/ |
| Expand All | | @@ -62,7 +62,7 @@ private String tryRewrite(String s) throws IOException, InvalidKeyException { |
|  |  | return s; // not a valid base64 |
|  |  | } |
|  |  | cipher.init(Cipher.DECRYPT\_MODE, key); |
|  |  | Secret sec = Secret.tryDecrypt(cipher, in); |
|  |  | Secret sec = HistoricalSecrets.tryDecrypt(cipher, in); |
|  |  | if(sec!=null) // matched |
|  |  | return sec.getEncryptedValue(); // replace by the new encrypted value |
|  |  | else // not encrypted with the legacy key. leave it unmodified |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `e6aa166`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjenkinsci%2Fjenkins%2Fcommit%2Fe6aa166246d1734f4798a9e31f78842f4c85c28b) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


