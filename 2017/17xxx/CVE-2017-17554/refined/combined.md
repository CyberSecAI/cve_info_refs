=== Content from github.com_52a66cc2_20250125_181613.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FIv4n550%2Fvulnerability%2Fblob%2Fmaster%2FAn%2520NULL%2520pointer%2520dereference%2528DoS%2529%2520Vulnerability%2520was%2520found%2520in%2520function%2520%2520aubio_source_avcodec_readframe%2520of%2520aubio.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FIv4n550%2Fvulnerability%2Fblob%2Fmaster%2FAn%2520NULL%2520pointer%2520dereference%2528DoS%2529%2520Vulnerability%2520was%2520found%2520in%2520function%2520%2520aubio_source_avcodec_readframe%2520of%2520aubio.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=Iv4n550%2Fvulnerability)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Iv4n550](/Iv4n550)
/
**[vulnerability](/Iv4n550/vulnerability)**
Public

* [Notifications](/login?return_to=%2FIv4n550%2Fvulnerability) You must be signed in to change notification settings
* [Fork
  0](/login?return_to=%2FIv4n550%2Fvulnerability)
* [Star
   0](/login?return_to=%2FIv4n550%2Fvulnerability)

* [Code](/Iv4n550/vulnerability)
* [Issues
  0](/Iv4n550/vulnerability/issues)
* [Pull requests
  0](/Iv4n550/vulnerability/pulls)
* [Actions](/Iv4n550/vulnerability/actions)
* [Projects
  0](/Iv4n550/vulnerability/projects)
* [Security](/Iv4n550/vulnerability/security)
* [Insights](/Iv4n550/vulnerability/pulse)

Additional navigation options

* [Code](/Iv4n550/vulnerability)
* [Issues](/Iv4n550/vulnerability/issues)
* [Pull requests](/Iv4n550/vulnerability/pulls)
* [Actions](/Iv4n550/vulnerability/actions)
* [Projects](/Iv4n550/vulnerability/projects)
* [Security](/Iv4n550/vulnerability/security)
* [Insights](/Iv4n550/vulnerability/pulse)

## Files

 master
## Breadcrumbs

1. [vulnerability](/Iv4n550/vulnerability/tree/master)
/
# An NULL pointer dereference(DoS) Vulnerability was found in function aubio\_source\_avcodec\_readframe of aubio.md

Copy path Blame  Blame
## Latest commit

## History

[History](/Iv4n550/vulnerability/commits/master/An%20NULL%20pointer%20dereference%28DoS%29%20Vulnerability%20was%20found%20in%20function%20%20aubio_source_avcodec_readframe%20of%20aubio.md)144 lines (132 loc) · 5.91 KB master
## Breadcrumbs

1. [vulnerability](/Iv4n550/vulnerability/tree/master)
/
# An NULL pointer dereference(DoS) Vulnerability was found in function aubio\_source\_avcodec\_readframe of aubio.md

Top
## File metadata and controls

* Preview
* Code
* Blame

144 lines (132 loc) · 5.91 KB[Raw](https://github.com/Iv4n550/vulnerability/raw/refs/heads/master/An%20NULL%20pointer%20dereference%28DoS%29%20Vulnerability%20was%20found%20in%20function%20%20aubio_source_avcodec_readframe%20of%20aubio.md)
## Overview

An NULL pointer dereference(DoS) Vulnerability was found in function aubio\_source\_avcodec\_readframe of aubio

## Tested Versions

aubio 0.4.6

## Product URLs

<https://aubio.org/>

## Details

Aubio has an NULL pointer dereference denial-of-service vulnerability when parsing a crafted file. This occurs in the function aubio\_source\_avcodec\_readframe of the source\_avcodec.c when processing corrupted frames.
A SEGV appears if s->avr is NULL when we call function swr\_convert or avresample\_convert.

```
void aubio_source_avcodec_readframe(aubio_source_avcodec_t *s, uint_t * read_samples) {
	......
#ifdef HAVE_AVRESAMPLE
  AVAudioResampleContext *avr = s->avr;
#elif defined(HAVE_SWRESAMPLE)
  SwrContext *avr = s->avr;
#endif /* HAVE_AVRESAMPLE || HAVE_SWRESAMPLE */
	......
#ifdef HAVE_AVRESAMPLE
  in_linesize = 0;
  av_samples_get_buffer_size(&in_linesize, avCodecCtx->channels,
      avFrame->nb_samples, avCodecCtx->sample_fmt, 1);
  in_samples = avFrame->nb_samples;
  out_linesize = 0;
  max_out_samples = AUBIO_AVCODEC_MAX_BUFFER_SIZE;
  out_samples = avresample_convert ( avr,
        (uint8_t **)&output, out_linesize, max_out_samples,
        (uint8_t **)avFrame->data, in_linesize, in_samples);
#elif defined(HAVE_SWRESAMPLE)
  in_samples = avFrame->nb_samples;
  max_out_samples = AUBIO_AVCODEC_MAX_BUFFER_SIZE / avCodecCtx->channels;
  out_samples = swr_convert( avr,
      (uint8_t **)&output, max_out_samples,
      (const uint8_t **)avFrame->data, in_samples);
#endif /* HAVE_AVRESAMPLE || HAVE_SWRESAMPLE */
  if (out_samples <= 0) {
    AUBIO_WRN("source_avcodec: no sample found while converting frame (%s)\n", s->path);
    goto beach;
  }

  *read_samples = out_samples;

beach:
  s->avFormatCtx = avFormatCtx;
  s->avCodecCtx = avCodecCtx;
  s->avFrame = avFrame;
#if defined(HAVE_AVRESAMPLE) || defined(HAVE_SWRESAMPLE)
  s->avr = avr;
#endif /* HAVE_AVRESAMPLE || HAVE_SWRESAMPLE */
  s->output = output;

  av_packet_unref(&avPacket);
}
```

when parsing a crafted file, avresample\_open or swr\_init failed, and then s->avr is NULL.
function aubio\_source\_avcodec\_reset\_resampler in source\_avcodec.c

```
void aubio_source_avcodec_reset_resampler(aubio_source_avcodec_t * s, uint_t multi) {
  // create or reset resampler to/from mono/multi-channel
  if ( (multi != s->multi) || (s->avr == NULL) ) {
    int err;
    int64_t input_layout = av_get_default_channel_layout(s->input_channels);
    uint_t output_channels = multi ? s->input_channels : 1;
    int64_t output_layout = av_get_default_channel_layout(output_channels);
#ifdef HAVE_AVRESAMPLE
    AVAudioResampleContext *avr = avresample_alloc_context();
    AVAudioResampleContext *oldavr = s->avr;
#elif defined(HAVE_SWRESAMPLE)
    SwrContext *avr = swr_alloc();
    SwrContext *oldavr = s->avr;
#endif /* HAVE_AVRESAMPLE || HAVE_SWRESAMPLE */

    av_opt_set_int(avr, "in_channel_layout",  input_layout,           0);
    av_opt_set_int(avr, "out_channel_layout", output_layout,          0);
    av_opt_set_int(avr, "in_sample_rate",     s->input_samplerate,    0);
    av_opt_set_int(avr, "out_sample_rate",    s->samplerate,          0);
    av_opt_set_int(avr, "in_sample_fmt",      s->avCodecCtx->sample_fmt, 0);
#if HAVE_AUBIO_DOUBLE
    av_opt_set_int(avr, "out_sample_fmt",     AV_SAMPLE_FMT_DBL,      0);
#else
    av_opt_set_int(avr, "out_sample_fmt",     AV_SAMPLE_FMT_FLT,      0);
#endif
    // TODO: use planar?
    //av_opt_set_int(avr, "out_sample_fmt",     AV_SAMPLE_FMT_FLTP,      0);
#ifdef HAVE_AVRESAMPLE
    if ( ( err = avresample_open(avr) ) < 0)
#elif defined(HAVE_SWRESAMPLE)
    if ( ( err = swr_init(avr) ) < 0)
#endif /* HAVE_AVRESAMPLE || HAVE_SWRESAMPLE */
    {
      char errorstr[256];
      av_strerror (err, errorstr, sizeof(errorstr));
      AUBIO_ERR("source_avcodec: Could not open resampling context for %s (%s)\n",
          s->path, errorstr);
      return;
    }
    s->avr = avr;
    if (oldavr != NULL) {
#ifdef HAVE_AVRESAMPLE
      avresample_close( oldavr );
#elif defined(HAVE_SWRESAMPLE)
      swr_close ( oldavr );
#endif /* HAVE_AVRESAMPLE || HAVE_SWRESAMPLE */
      av_free ( oldavr );
      oldavr = NULL;
    }
    s->multi = multi;
  }
}

```

## Crash Information

exec cmd:/root/test/aubio/aubio-master/build/examples/aubiomfcc /root/test/aubio/crash-1-null-ptr
The output of gdb

```
(gdb) r /root/test/aubio/crash-1-null-ptr
Starting program: /root/test/aubio/aubio-master/build/examples/aubiomfcc /root/test/aubio/crash-1-null-ptr
[wav @ 0x605160] Estimating duration from bitrate, this may be inaccurate
[SWR @ 0x625a50] Input channel count and layout are unset
AUBIO ERROR: source_avcodec: Could not open resampling context for /root/test/aubio/crash-1-null-ptr (Invalid argument)
AUBIO WARNING: Lowest frequency bin (2048.00Hz) is higher than lowest frequency band (133.33-266.67Hz). Consider increasing the window size from 512 to 8192.
[pcm_s16le @ 0x607970] Multiple frames in a packet.

Program received signal SIGSEGV, Segmentation fault.
0x00007ffff5a851cb in swr_is_initialized (s=0x0) at libswresample/swresample.c:703
703	    return !!s->in_buffer.ch_count;
(gdb) bt
#0  0x00007ffff5a851cb in swr_is_initialized (s=0x0) at libswresample/swresample.c:703
#1  0x00007ffff5a85236 in swr_convert (s=0x0, out_arg=0x7fffffffe0a8, out_count=682, in_arg=0x608af0, in_count=85) at libswresample/swresample.c:712
#2  0x00007ffff7bc479f in aubio_source_avcodec_readframe (s=0x605060, read_samples=0x7fffffffe0fc) at ../src/io/source_avcodec.c:435
#3  0x00007ffff7bc4cd3 in aubio_source_avcodec_do (s=0x605060, read_data=0x607810, read=0x7fffffffe154) at ../src/io/source_avcodec.c:472
#4  0x0000000000402648 in examples_common_process (process_func=0x401d80 <process_block>, print=0x401d30 <process_print>) at ../examples/utils.c:168
#5  0x0000000000401c69 in main (argc=<optimized out>, argv=<optimized out>) at ../examples/aubiomfcc.c:71

```

## POC file

[crash-1-null-ptr](https://github.com/IvanCql/vulnerability/blob/master/crash-1-null-ptr)

## CREDIT

Chen Qilian, Huawei CSPL

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


