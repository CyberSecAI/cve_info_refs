=== Content from phabricator.wikimedia.org_67bcd079_20250124_205031.html ===
Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT140591)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T140591
# MediaWiki 1.28.1/1.27.2/1.23.16 security releaseClosed, Resolved[Public](/policy/explain/PHID-TASK-b2lrk7u55z2wzyphozin/view/)Actions

* [Edit Task](/maniphest/task/edit/140591/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/140591/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-b2lrk7u55z2wzyphozin/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-b2lrk7u55z2wzyphozin/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-b2lrk7u55z2wzyphozin/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-b2lrk7u55z2wzyphozin/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-b2lrk7u55z2wzyphozin/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-b2lrk7u55z2wzyphozin/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-b2lrk7u55z2wzyphozin/)
* [Protect as security issue](/wmf/escalate-task/140591/)
* [Award Token](/token/give/PHID-TASK-b2lrk7u55z2wzyphozin/)
* [Flag For Later](/flag/edit/PHID-TASK-b2lrk7u55z2wzyphozin/)

Assigned To

|  | [Reedy](/p/Reedy/) |
| --- | --- |

Authored By

|  | [Bawolff](/p/Bawolff/) |
| --- | --- |
| Jul 18 2016, 7:47 AM2016-07-18 07:47:48 (UTC+0) |

Tags

* [MediaWiki-General](/tag/mediawiki-general/)
* [Security-Team](/tag/security-team/) [(Our Part Is Done)](/project/board/1179/)
* [Security](/tag/security/)
Referenced Files

|  | [F7315873: 1.28.1v2.tar](/F7315873) |
| --- | --- |
| Apr 6 2017, 6:26 PM2017-04-06 18:26:51 (UTC+0) |

|  | [F7280208: 1.23.16v4.tar](/F7280208) |
| --- | --- |
| Apr 5 2017, 11:06 PM2017-04-05 23:06:26 (UTC+0) |

|  | [F7270342: 1.23.16v3-withoutapisecurity.tar](/F7270342) |
| --- | --- |
| Apr 5 2017, 5:27 PM2017-04-05 17:27:39 (UTC+0) |

|  | [F7270341: 1.23.16v3-withapisecurity.tar](/F7270341) |
| --- | --- |
| Apr 5 2017, 5:27 PM2017-04-05 17:27:39 (UTC+0) |

|  | [F7214130: 1.23.16v2-withoutapisecurity.tar](/F7214130) |
| --- | --- |
| Apr 4 2017, 5:12 PM2017-04-04 17:12:26 (UTC+0) |

|  | [F7214128: 1.23.16v2-withapisecurity.tar](/F7214128) |
| --- | --- |
| Apr 4 2017, 5:12 PM2017-04-04 17:12:26 (UTC+0) |

|  | [F7153973: 0006-SECURITY-Whitelist-DTD-declaration-in-SVG.patch](/F7153973) |
| --- | --- |
| Apr 2 2017, 11:45 PM2017-04-02 23:45:04 (UTC+0) |

|  | [F7153969: 0004-SECURITY-SpecialWatchlist-Check-CSRF-token-when-usin.patch](/F7153969) |
| --- | --- |
| Apr 2 2017, 11:45 PM2017-04-02 23:45:04 (UTC+0) |

[View All Files](/file/ui/curtain/list/PHID-TASK-b2lrk7u55z2wzyphozin/)Subscribers

|  | [Aklapper](/p/Aklapper/) |
| --- | --- |

|  | [Bawolff](/p/Bawolff/) |
| --- | --- |

|  | [• demon](/p/demon/) |
| --- | --- |

|  | [greg](/p/greg/) |
| --- | --- |

|  | [Grunny](/p/Grunny/) |
| --- | --- |

|  | [Jdforrester-WMF](/p/Jdforrester-WMF/) |
| --- | --- |

|  | [Reedy](/p/Reedy/) |
| --- | --- |

|  | [Tgr](/p/Tgr/) |
| --- | --- |

# Description

MW Versions: 1.28.1/1.27.2/1.23.16.

Previous release work: [T133070](/T133070)

### Core

| Maniphest ID | CVE ID | REL1\_23 | REL1\_27 | REL1\_28 | REL1\_29/master |
| --- | --- | --- | --- | --- | --- |
| [T68404](/T68404) | CVE-2017-0371 | Done | Done | Done | Done |
| [T156184](/T156184) (part 1) | CVE-2017-0368 | Done | Done | Done | Done |
| [T109140](/T109140)/[T122209](/T122209) | CVE-2017-0363 / CVE-2017-0364 | 01-T109140-REL1\_23.patch13 KB[Download](https://phab.wmfusercontent.org/file/download/dni5r56vml3g472hm33u/PHID-FILE-nyai6tfsqvijwzpomb4o/01-T109140-REL1_23.patch) | 01-T109140-REL1\_27.patch14 KB[Download](https://phab.wmfusercontent.org/file/download/ddpieguw52h7bmmhgfje/PHID-FILE-t77mxhxlefjfeoihm6kh/01-T109140-REL1_27.patch) | 01-T109140-REL1\_28.patch13 KB[Download](https://phab.wmfusercontent.org/file/download/4vmvo4tya5ss3xp3jwrd/PHID-FILE-eyvhgrbcai777dlnqgzt/01-T109140-REL1_28.patch) | 01-T109140-master.patch13 KB[Download](https://phab.wmfusercontent.org/file/download/l74andieu4jrnbh2iccx/PHID-FILE-l4puw5472ljodydoltl7/01-T109140-master.patch) |
| [T144845](/T144845) | CVE-2017-0365 | T144845-REL1\_23.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/sdjgrqwuev7dv4njgnqf/PHID-FILE-mk5w7wu2xhrtqmt4276q/T144845-REL1_23.patch) | T144845-REL1\_27.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/2mhvcvtpszyjwp3nylkq/PHID-FILE-bmu6vj2n2lymahcn2g62/T144845-REL1_27.patch) | T144845-REL1\_28.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/74arhawchm5woj7whpr4/PHID-FILE-r6k3xl5nrrj56co4j5sn/T144845-REL1_28.patch) | T144845-master.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/oipllvsngjijte6gy36c/PHID-FILE-slpqnlgyqbppknqpgpcq/T144845-master.patch) |
| [T125177](/T125177) | CVE-2017-0361 | 03-T125117-REL1\_23.patch6 KB[Download](https://phab.wmfusercontent.org/file/download/rw7navjd6axf7udn62ee/PHID-FILE-yafalecvjmlwzcqxqnoq/03-T125117-REL1_23.patch) | 03-T125117-REL1\_27.patch7 KB[Download](https://phab.wmfusercontent.org/file/download/7oygw2bkwutg7pusaqp6/PHID-FILE-vwzj4rhkn3wny5nmqrya/03-T125117-REL1_27.patch) | 03-T125117-REL1\_28.patch7 KB[Download](https://phab.wmfusercontent.org/file/download/d6ojh5iwtqsc2svcrxwf/PHID-FILE-wfx7ommc3wgo6zjwk5kt/03-T125117-REL1_28.patch) | 03-T125177-master.patch6 KB[Download](https://phab.wmfusercontent.org/file/download/g2cefdq4awz3cw2ulatu/PHID-FILE-ohnk7xu2k63ruccfw2tf/03-T125177-master.patch) |
| [T150044](/T150044) | CVE-2017-0362 | 04-T150044-REL1\_23.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/w3w3z7vrt3dwvm2no4mw/PHID-FILE-iot5ud3ls6ptaxxwftwb/04-T150044-REL1_23.patch) | 04-T150044-REL1\_27.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/tchrurypdt5b4dthjh5u/PHID-FILE-k2xa3u24ajzwf7okb5d6/04-T150044-REL1_27.patch) | 04-T150044-REL1\_28.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/umtudkkfcfkfivowbzjz/PHID-FILE-dk36hptxjtj6xqmmks2v/04-T150044-REL1_28.patch) | 04-T150044-master.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/ls7dv6cc5qorlmx7jvk2/PHID-FILE-svfrsgpmvflibds7ifnh/04-T150044-master.patch) |
| [T156184](/T156184) (part 2) | CVE-2017-0368 | T156184-2-REL1\_23.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/gbyzii5grw4wcdllo2p3/PHID-FILE-cv2xr26dk2pp3qll6ssu/T156184-2-REL1_23.patch) | T156184-2-REL1\_27.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/b4b5rsrowyuw4hhrpdak/PHID-FILE-ziaaqjc54yizfgw4pilt/T156184-2-REL1_27.patch) | T156184-2-REL1\_28.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/tmjdbsgqn4ftgjjmbrph/PHID-FILE-hlterckizidyxtaxclao/T156184-2-REL1_28.patch) | T156184-2-master.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/ewv7hayuouc56ac522vn/PHID-FILE-u5ploja4avzwybv7f2vm/T156184-2-master.patch) |
| [T151735](/T151735) | CVE-2017-0366 | T151735-REL1\_23.patch21 KB[Download](https://phab.wmfusercontent.org/file/download/a7ty55x3tfsr3czxkk2m/PHID-FILE-pod2ujlbog26zp73a3cv/T151735-REL1_23.patch) | T151735-REL1\_27.patch22 KB[Download](https://phab.wmfusercontent.org/file/download/npc7hl3gvxe5qpycw6be/PHID-FILE-hdpngcob2q6z4qszvdjp/T151735-REL1_27.patch) | T151735-REL1\_28.patch22 KB[Download](https://phab.wmfusercontent.org/file/download/gd5f2tn6dqud33w7rwae/PHID-FILE-lwnmf7mv2a7iu2o2uzqo/T151735-REL1_28.patch) | T151735-v4-master22 KB[Download](https://phab.wmfusercontent.org/file/download/bmm2qf6lgerrljv27l6w/PHID-FILE-6aj6gdlcmcuwzmlo2k4e/T151735-v4-master) |
| [T161453](/T161453) | CVE-2017-0367 | n/a (introduced in REL1\_27) | T161453-REL1\_27.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/pn6cnbcmu6jrcbejjkwv/PHID-FILE-on75ac7dlnnsecscmmxl/T161453-REL1_27.patch) | T161453-REL1\_28.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/7hwqvtqnilyvgx4fon5l/PHID-FILE-vp7j2p3vkylmj75bytv6/T161453-REL1_28.patch) | T161453-master.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/d2b6hmfm3lctbl5n2rad/PHID-FILE-o6aqcygeun2sitlr2y4b/T161453-master.patch) |
| [T48143](/T48143) | CVE-2017-0370 | T48143-REL1\_23.patch3 KB[Download](https://phab.wmfusercontent.org/file/download/76llfpkzwx6vc2zkdicm/PHID-FILE-lpzkzu4w2udgiqky7mrn/T48143-REL1_23.patch) | T48143-REL1\_27.patch3 KB[Download](https://phab.wmfusercontent.org/file/download/5aaqxuzztbnmdn6f4pmn/PHID-FILE-6oyv7kz2rcka4eu5ntpp/T48143-REL1_27.patch) | T48143-REL1\_28.patch3 KB[Download](https://phab.wmfusercontent.org/file/download/ryvzepreawii5pwxt2zf/PHID-FILE-5jxxmnzcrenp5tx23fvu/T48143-REL1_28.patch) | T48143-master.patch3 KB[Download](https://phab.wmfusercontent.org/file/download/dqkhk5jojk247ruzlmm5/PHID-FILE-e4w7qu4dfchjzomkmf6e/T48143-master.patch) |
| [T108138](/T108138) | CVE-2017-0369 | T108138-REL1\_23.patch5 KB[Download](https://phab.wmfusercontent.org/file/download/sue5cbda4kqlua73uwrf/PHID-FILE-qm6fgybrrie7lny2rq6r/T108138-REL1_23.patch) | T108138-REL1\_27.patch4 KB[Download](https://phab.wmfusercontent.org/file/download/oy53cjgcnialh4ipi7x6/PHID-FILE-35t6x4xd7k3aaqfynol7/T108138-REL1_27.patch) | T108138-REL1\_28.patch4 KB[Download](https://phab.wmfusercontent.org/file/download/pwnqdb2mx34sjotu3lqj/PHID-FILE-r42q5xdnquuhjppadhbm/T108138-REL1_28.patch) | T108138-master.patch4 KB[Download](https://phab.wmfusercontent.org/file/download/zxcmc2y3e3uzxmfvgwli/PHID-FILE-tdrolougzarubut3urjd/T108138-master.patch) |
|

| Patch tarballs |
| --- |
| master.tar80 KB[Download](https://phab.wmfusercontent.org/file/download/2rane27xcwlys66wyqo7/PHID-FILE-nc4ivinxalzoo26x3up4/master.tar) |
| 1.28.1v2.tar80 KB[Download](https://phab.wmfusercontent.org/file/download/xpz2mik5omjmtds75uaw/PHID-FILE-3xqmp5n52xvggbly2pxu/1.28.1v2.tar) |
| 1.27.2.tar80 KB[Download](https://phab.wmfusercontent.org/file/download/cmil6d2zavup2h7w7fhi/PHID-FILE-bjftc665rq6fba2ndpyg/1.27.2.tar) |
| 1.23.16v4.tar70 KB[Download](https://phab.wmfusercontent.org/file/download/squqowfuukljee7gtcrq/PHID-FILE-fhrc6zvjfrywdkg3gssh/1.23.16v4.tar) |
|

### Extensions

Like usual, please don't add an extension if we don't bundle those -- [see the list](/diffusion/MREL/browse/master/make-release/make-release.yaml)

| Maniphest ID | CVE ID | REL1\_23 | REL1\_27 | REL1\_28 | REL1\_29/master |
| --- | --- | --- | --- | --- | --- |
| [T158689](/T158689) | CVE-2017-0372 | n/a | T158689-REL1\_27.patch926 B[Download](https://phab.wmfusercontent.org/file/download/vn5yz7esauemvgn3snmf/PHID-FILE-tg6ddwkvfnqj5nep7tlv/T158689-REL1_27.patch) | T158689-REL1\_28.patch926 B[Download](https://phab.wmfusercontent.org/file/download/lndpx7clq6n6dr5u5aj2/PHID-FILE-l772uig5wbud2pqmxekz/T158689-REL1_28.patch) | T158689-master.patch926 B[Download](https://phab.wmfusercontent.org/file/download/ohcw3427r4zrw4udzw34/PHID-FILE-kznziek35k2jxcawi6fk/T158689-master.patch) |
|

# Related ObjectsSearch...

* Task Graph
* Mentions

|  |  | Status | Subtype | Assigned | Task |
| --- | --- | --- | --- | --- | --- |
|  |  | Resolved |  | [• demon](/p/demon/) | T161996 [Release MediaWiki 1.28.1/1.27.2/1.23.16](/T161996) |
|  |  | Resolved |  | [Reedy](/p/Reedy/) | T140591 [MediaWiki 1.28.1/1.27.2/1.23.16 security release](/T140591) |
|  |  | Resolved |  | [• dpatrick](/p/dpatrick/) | T125177 [api.log contains passwords in plaintext](/T125177) |
|  |  | Resolved |  | [Bawolff](/p/Bawolff/) | T68404 [New CSS syntax for attr() allows web bugs](/T68404) |
|  |  | Resolved |  | [matmarex](/p/matmarex/) | T150044 ["Mark all pages visited" on the watchlist does not require a CSRF token](/T150044) |
|  |  | Resolved |  | [Tgr](/p/Tgr/) | T109140 [Special:UserLogin?returnto=interwiki:foo will redirect to external sites](/T109140) |
|  |  | Resolved |  | [matmarex](/p/matmarex/) | T122209 [Special:Search allows redirects to any interwiki link](/T122209) |
|  |  | Resolved |  | [Bawolff](/p/Bawolff/) | T144845 [XSS in SearchHighlighter::highlightText() [requires non-default config]](/T144845) |
|  |  | Resolved |  | [Bawolff](/p/Bawolff/) | T108138 [Sysops can undelete pages, although the page is protected against it](/T108138) |
|  |  | Resolved |  | [Bawolff](/p/Bawolff/) | T48143 [Spam blacklist ineffective on encoded URLs inside file inclusion syntax's link parameter](/T48143) |
|  |  | Resolved |  | [Reedy](/p/Reedy/) | T158689 [Parameters injection in SyntaxHighlight results in multiple vulnerabilities](/T158689) |
|  |  |  |  |  | Restricted Task |
|  |  | Resolved |  | [Bawolff](/p/Bawolff/) | T151735 [SVG filter evasion using default attribute values in DTD declaration](/T151735) |
|  |  | Resolved |  | [Reedy](/p/Reedy/) | T161453 [Having LocalisationCache directory default to system tmp directory is insecure](/T161453) |
|  |  | Resolved |  | [Reedy](/p/Reedy/) | T154215 [Localisation cache tmp file assumes tmp path is unique](/T154215) |
|  |  | Resolved |  | [Bawolff](/p/Bawolff/) | T156184 [Make rawHTML mode not apply to system messages](/T156184) |

Mentioned In [T168823: Tracking bug for 1.27.4/1.28.3/1.29.2 security releases](/T168823)
[T149869: Security review for PageForms](/T149869)
[T137551: Logout does not work when the loginwiki account is unattached](/T137551) Mentioned Here [rMWe2c9d4dfa90b: Improve/rename Parser::replaceUnusualEscapes](/rMWe2c9d4dfa90b57cad70ad185e6667e8ba76464db)
[T156184: Make rawHTML mode not apply to system messages](/T156184)
[T161453: Having LocalisationCache directory default to system tmp directory is insecure](/T161453)
[T151735: SVG filter evasion using default attribute values in DTD declaration](/T151735)
[T48143: Spam blacklist ineffective on encoded URLs inside file inclusion syntax's link parameter](/T48143)
[T108138: Sysops can undelete pages, although the page is protected against it](/T108138)
[T143790: $wgBlockDisablesLogin = true; + $wgEmailConfirmToEdit = true; causes the wiki to be inaccessible for anonymous users](/T143790)
[rMWd8852217e2d8: Localisation updates from https://translatewiki.net.](/rMWd8852217e2d8b7d2e5fc2ec9b79196f47ea0836a)
[T158689: Parameters injection in SyntaxHighlight results in multiple vulnerabilities](/T158689)
[rMW6a068d18e1e3: API: Insist authn parameters be in the POST body](/rMW6a068d18e1e34c8744d12cfee08fe998828f9387)
[T144845: XSS in SearchHighlighter::highlightText() [requires non-default config]](/T144845)
[T68404: New CSS syntax for attr() allows web bugs](/T68404)
[T109140: Special:UserLogin?returnto=interwiki:foo will redirect to external sites](/T109140)
[T122209: Special:Search allows redirects to any interwiki link](/T122209)
[T127114: Login throttle can be tricked using non-canonicalized usernames](/T127114)
[T150044: "Mark all pages visited" on the watchlist does not require a CSRF token](/T150044)
[T133070: MediaWiki 1.27.1 security release](/T133070)
[T125177: api.log contains passwords in plaintext](/T125177)
### Event Timeline

There are a very large number of changes, so older changes are hidden. [Show Older Changes](/transactions/showolder/PHID-TASK-b2lrk7u55z2wzyphozin/?after=3113280&quoteTargetID=UQ0_1&quoteRef=T140591)

[Reedy](/p/Reedy/) added a comment.Edited · [Mar 19 2017, 10:24 PM2017-03-19 22:24:23 (UTC+0)](#3113280)Comment Actions

Bad patch

[Reedy](/p/Reedy/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-gutpij2rblysxzu/)[Mar 19 2017, 10:24 PM2017-03-19 22:24:34 (UTC+0)](#3113281)[Reedy](/p/Reedy/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-2fb5cyr5kiihqi2/)[Mar 19 2017, 10:29 PM2017-03-19 22:29:57 (UTC+0)](#3113282)

[Reedy](/p/Reedy/) added a comment.[Mar 19 2017, 10:42 PM2017-03-19 22:42:09 (UTC+0)](#3113283)Comment Actions

03-T125117-REL1\_27.patch7 KB[Download](https://phab.wmfusercontent.org/file/download/7oygw2bkwutg7pusaqp6/PHID-FILE-vwzj4rhkn3wny5nmqrya/03-T125117-REL1_27.patch)

2nd time lucky

[Reedy](/p/Reedy/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-neah3h4qo7pc4wp/)[Mar 19 2017, 10:42 PM2017-03-19 22:42:23 (UTC+0)](#3113284)

[Reedy](/p/Reedy/) added a comment.[Mar 19 2017, 10:55 PM2017-03-19 22:55:50 (UTC+0)](#3113285)Comment Actions

03-T125117-REL1\_23.patch6 KB[Download](https://phab.wmfusercontent.org/file/download/rw7navjd6axf7udn62ee/PHID-FILE-yafalecvjmlwzcqxqnoq/03-T125117-REL1_23.patch)

[Reedy](/p/Reedy/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-wdqfe3fxkcpches/)[Mar 19 2017, 10:56 PM2017-03-19 22:56:05 (UTC+0)](#3113286)

[Reedy](/p/Reedy/) added a comment.[Mar 19 2017, 11:02 PM2017-03-19 23:02:35 (UTC+0)](#3113288)Comment Actions

So that's a complete set of patches for the backports....

Probably need some release-notes adding at the end as some patches don't seem to have them, so weren't backported

Guess I need to get ontop of the CVE's too

Then just seeing if/what applies to master...

Write some announcement emails, and get this shipped. And hopefully see the back of REL1\_23

[Reedy](/p/Reedy/) added a comment.[Mar 19 2017, 11:12 PM2017-03-19 23:12:55 (UTC+0)](#3113306)Comment Actions

All patches currently apply to master where HEAD is [d8852217e2d8b7d2e5fc2ec9b79196f47ea0836a](/rMWd8852217e2d8b7d2e5fc2ec9b79196f47ea0836a)

```
reedy@ubuntu64-web-esxi:~/git/mediawiki/core$ git am 01-T109140-master.patch
Applying: SECURITY: Do not directly redirect to interwikis, but use splash page
reedy@ubuntu64-web-esxi:~/git/mediawiki/core$ git am T144845-master.patch
Applying: SECURITY: XSS in search if $wgAdvancedSearchHighlighting = true;
reedy@ubuntu64-web-esxi:~/git/mediawiki/core$ git am 03-T125177-master.patch
Applying: SECURITY: API: Don't log "sensitive" parameters
reedy@ubuntu64-web-esxi:~/git/mediawiki/core$ git am 04-T150044-master.patch
Applying: SECURITY: SpecialWatchlist: Check CSRF token when using "Mark all pages visited"
reedy@ubuntu64-web-esxi:~/git/mediawiki/core$
```

[Reedy](/p/Reedy/) added a comment.Edited · [Mar 19 2017, 11:21 PM2017-03-19 23:21:59 (UTC+0)](#3113328)Comment Actions

For consistency/due diligence/best practices, review of current core patches on tin:

```
reedy@tin:/srv/patches/1.29.0-wmf.16/core$ ls -al
total 44
drwxrwxr-x 2 twentyafterfour wikidev  4096 Mar 13 21:30 .
drwxrwxr-x 4 twentyafterfour wikidev  4096 Feb 28 18:06 ..
-rw-rw-r-- 1 twentyafterfour wikidev 14245 Feb 28 18:06 01-T109140.patch
-rw-r--r-- 1 twentyafterfour wikidev  1679 Feb 28 18:06 02-T127114-master_1.28wmf2.patch
-rw-rw-r-- 1 twentyafterfour wikidev  6903 Feb 28 18:06 03-T125177.patch
-rw-rw-r-- 1 twentyafterfour wikidev  1505 Feb 28 18:06 04-T150044.patch
-rw-rw-r-- 1 twentyafterfour wikidev  1318 Mar 13 21:30 05-T160266.patch
reedy@tin:/srv/patches/1.29.0-wmf.16/core$
```

5 patches on master

1 is a prevention, but maybe not the best fix for T160266. It'd be nice if we could include it in the release, if ready in time, but if it's not ready, it's not ready.

Patch for [T127114](/T127114) is still staged on tin (To be applied). Can we drop it yet per Gergo's comments on the bug? Makes things cleaner

[T144845](/T144845) isn't applicable for WMF cluster, so not deployed currently

Only extension patch is SyntaxHighlight\_GeSHi, patch is above

[Reedy](/p/Reedy/) added a comment.[Mar 19 2017, 11:53 PM2017-03-19 23:53:15 (UTC+0)](#3113369)Comment Actions

cf target bug

> In [T127114#3113366](/T127114#3113366), [@Reedy](/p/Reedy/) wrote:
>
> If we don't need these anymore, we should drop them from prod
>
> I see <https://gerrit.wikimedia.org/r/#/c/270669/> on master, but it doesn't seem it was ever backported.... Do we want it backported?
>
> [T127114](/T127114) says "done"...
>
> Gerrit says
>
> ```
> Branches	REL1_27, REL1_28, fundraising/REL1_27, master, sandbox/twentyafterfour/group0, wmf/1.29.0-wmf.10, wmf/1.29.0-wmf.11, wmf/1.29.0-wmf.12, wmf/1.29.0-wmf.13, wmf/1.29.0-wmf.14, wmf/1.29.0-wmf.15, wmf/1.29.0-wmf.16, wmf/1.29.0-wmf.2, wmf/1.29.0-wmf.3, wmf/1.29.0-wmf.4, wmf/1.29.0-wmf.5, wmf/1.29.0-wmf.6, wmf/1.29.0-wmf.7, wmf/1.29.0-wmf.8
> Tags	1.27.0, 1.27.0-rc.0, 1.27.0-rc.1, 1.27.1, 1.28.0, 1.28.0-rc.0, 1.28.0-rc.1
> ```
>
> So we just need to do REL1\_23?
>
> Has this been publicised?

Why is [T127114](/T127114) listed on here? It might need to be backported to REL1\_23... But other than that, it's been merged far enough back to be in 1.27.0 anyway...

[Reedy](/p/Reedy/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-gpoidqkqleqwvvv/)[Mar 19 2017, 11:55 PM2017-03-19 23:55:08 (UTC+0)](#3113370)

[Reedy](/p/Reedy/) added a comment.[Mar 19 2017, 11:57 PM2017-03-19 23:57:45 (UTC+0)](#3113371)Comment Actions

Seems I'm repeating myself.

For REL1\_23 <https://github.com/wikimedia/mediawiki/commit/3c00b14e7df7bc761646cd016516d21e892c1fe2> made it into 1.23.14/1.23.15

So, the question is why this is tagged against this bug? Anyone know?

> In [T140591#2998570](/T140591#2998570), [@Reedy](/p/Reedy/) wrote:
>
> For [T127114](/T127114), I note that that branches already have this patch... But no mention of it in 1.27.1, 1.26.4, 1.23.15? For 1.23.. It was in 1.23.14 <https://lists.wikimedia.org/pipermail/mediawiki-announce/2016-August/000195.html>
>
> REL1\_23: <https://github.com/wikimedia/mediawiki/commit/3c00b14e7df7bc761646cd016516d21e892c1fe2>
>
> REL1\_27: <https://github.com/wikimedia/mediawiki/commit/1b93286162f23e1633607293e4dbd878d28b54a7>
>
> So why are these patches listed for this release? Because it wasn't apparently publicised?

[Reedy](/p/Reedy/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-4l24rlbaqiphj5y/)[Mar 19 2017, 11:58 PM2017-03-19 23:58:03 (UTC+0)](#3113372)

[Reedy](/p/Reedy/) added a comment.[Mar 20 2017, 12:04 AM2017-03-20 00:04:17 (UTC+0)](#3113376)Comment Actions

Other subtasks listed... But no patches up at the top. Are we wanting to include them?

* [T143790](/T143790) - <https://gerrit.wikimedia.org/r/#/c/306863/> is CR -1
* [T108138](/T108138) has patches attached...
* [T48143](/T48143) has patches attached...
[Reedy](/p/Reedy/) created subtask Restricted Task.[Mar 20 2017, 12:34 AM2017-03-20 00:34:35 (UTC+0)](#3113416)[Bawolff](/p/Bawolff/) added a subtask: [T151735: SVG filter evasion using default attribute values in DTD declaration](/T151735).[Mar 27 2017, 1:17 PM2017-03-27 13:17:28 (UTC+0)](#3133851)[Bawolff](/p/Bawolff/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-3m7ok2wykg7xm6c/)[Mar 27 2017, 1:44 PM2017-03-27 13:44:57 (UTC+0)](#3133915)

[Reedy](/p/Reedy/) added a comment.[Mar 28 2017, 8:23 PM2017-03-28 20:23:03 (UTC+0)](#3138341)Comment Actions

Tentatively suggesting friday as the cut off for new tasks to be added (ignoring any UNBREAK NOW that comes in as per usual)

[Bawolff](/p/Bawolff/) added a subtask: [T161453: Having LocalisationCache directory default to system tmp directory is insecure](/T161453).[Mar 28 2017, 10:03 PM2017-03-28 22:03:02 (UTC+0)](#3138599)[• demon](/p/demon/) subscribed.[Mar 30 2017, 5:52 PM2017-03-30 17:52:28 (UTC+0)](#3144494)[Reedy](/p/Reedy/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-5ldlojkikhgto2g/)[Mar 30 2017, 5:53 PM2017-03-30 17:53:28 (UTC+0)](#3144495)[Reedy](/p/Reedy/) removed a subtask: [T143790: $wgBlockDisablesLogin = true; + $wgEmailConfirmToEdit = true; causes the wiki to be inaccessible for anonymous users](/T143790).[Reedy](/p/Reedy/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-kmx2tivgg76sq26/)[Mar 30 2017, 5:55 PM2017-03-30 17:55:33 (UTC+0)](#3144506)[Reedy](/p/Reedy/) closed subtask [T150044: "Mark all pages visited" on the watchlist does not require a CSRF token](/T150044) as Resolved.[Mar 30 2017, 5:58 PM2017-03-30 17:58:51 (UTC+0)](#3144519)[Reedy](/p/Reedy/) closed subtask [T109140: Special:UserLogin?returnto=interwiki:foo will redirect to external sites](/T109140) as Resolved.[Reedy](/p/Reedy/) closed subtask [T122209: Special:Search allows redirects to any interwiki link](/T122209) as Resolved.

[Reedy](/p/Reedy/) closed subtask [T144845: XSS in SearchHighlighter::highlightText() [requires non-default config]](/T144845) as Resolved.[Mar 30 2017, 6:00 PM2017-03-30 18:00:56 (UTC+0)](#3144539)Comment Actions

Need to decide if [T108138](/T108138) is going into this release

[Reedy](/p/Reedy/) closed subtask [T158689: Parameters injection in SyntaxHighlight results in multiple vulnerabilities](/T158689) as Resolved.[Mar 30 2017, 6:02 PM2017-03-30 18:02:32 (UTC+0)](#3144545)[Reedy](/p/Reedy/) closed subtask [T151735: SVG filter evasion using default attribute values in DTD declaration](/T151735) as Resolved.[Reedy](/p/Reedy/) closed subtask [T161453: Having LocalisationCache directory default to system tmp directory is insecure](/T161453) as Resolved.

[Reedy](/p/Reedy/) added a comment.[Mar 30 2017, 6:04 PM2017-03-30 18:04:33 (UTC+0)](#3144559)Comment Actions

[T48143](/T48143) too.

Depending on the decision, they should be removed as children from this task

[Reedy](/p/Reedy/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-jc2jwneyyqbybiy/)[Mar 30 2017, 10:10 PM2017-03-30 22:10:44 (UTC+0)](#3145495)

[Reedy](/p/Reedy/) added a comment.[Mar 31 2017, 12:01 AM2017-03-31 00:01:19 (UTC+0)](#3145605)Comment Actions

[T48143](/T48143) and [T108138](/T108138) both now have a full complement of patches. But untested

[Bawolff](/p/Bawolff/) added a subtask: [T156184: Make rawHTML mode not apply to system messages](/T156184).[Mar 31 2017, 6:42 AM2017-03-31 06:42:14 (UTC+0)](#3145731)[Bawolff](/p/Bawolff/) added a comment.[Mar 31 2017, 6:45 AM2017-03-31 06:45:23 (UTC+0)](#3145734)Comment Actions
> > In [T140591#3113328](/T140591#3113328), [@Reedy](/p/Reedy/) wrote:
>
> For consistency/due diligence/best practices, review of current core patches on tin:
>
> ```
> reedy@tin:/srv/patches/1.29.0-wmf.16/core$ ls -al
> total 44
> drwxrwxr-x 2 twentyafterfour wikidev  4096 Mar 13 21:30 .
> drwxrwxr-x 4 twentyafterfour wikidev  4096 Feb 28 18:06 ..
> -rw-rw-r-- 1 twentyafterfour wikidev 14245 Feb 28 18:06 01-T109140.patch
> -rw-r--r-- 1 twentyafterfour wikidev  1679 Feb 28 18:06 02-T127114-master_1.28wmf2.patch
> -rw-rw-r-- 1 twentyafterfour wikidev  6903 Feb 28 18:06 03-T125177.patch
> -rw-rw-r-- 1 twentyafterfour wikidev  1505 Feb 28 18:06 04-T150044.patch
> -rw-rw-r-- 1 twentyafterfour wikidev  1318 Mar 13 21:30 05-T160266.patch
> reedy@tin:/srv/patches/1.29.0-wmf.16/core$
> ```
>
> 5 patches on master
>
> 1 is a prevention, but maybe not the best fix for T160266. It'd be nice if we could include it in the release, if ready in time, but if it's not ready, it's not ready.

Otoh it might make sense to do it as a private part of the fix for [T156184](/T156184)

[Reedy](/p/Reedy/) added a comment.[Mar 31 2017, 12:55 PM2017-03-31 12:55:49 (UTC+0)](#3146512)Comment Actions

Need to make decisions about these last few... We wanted to use today mostly as a cut off point, looking to get the release done next Thursday....

[Reedy](/p/Reedy/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-gky3gwoiptio2xq/)[Apr 1 2017, 4:23 PM2017-04-01 16:23:26 (UTC+0)](#3148345)[Reedy](/p/Reedy/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-lmutwq5kky7hvsc/)[Apr 1 2017, 4:26 PM2017-04-01 16:26:44 (UTC+0)](#3148348)[Reedy](/p/Reedy/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-yibp3v6h234qm3j/)[Apr 1 2017, 4:33 PM2017-04-01 16:33:41 (UTC+0)](#3148349)[Reedy](/p/Reedy/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-dz2mppydyansfda/)[Reedy](/p/Reedy/) closed subtask [T108138: Sysops can undelete pages, although the page is protected against it](/T108138) as Resolved.[Reedy](/p/Reedy/) closed subtask [T48143: Spam blacklist ineffective on encoded URLs inside file inclusion syntax's link parameter](/T48143) as Resolved.

[Reedy](/p/Reedy/) added a comment.[Apr 1 2017, 4:37 PM2017-04-01 16:37:58 (UTC+0)](#3148362)Comment Actions

[@Bawolff](/p/Bawolff/) What's the other "secret" patch to be associated with [T156184](/T156184) ?

[Reedy](/p/Reedy/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-sszli4kqthfb2pc/)[Apr 1 2017, 9:08 PM2017-04-01 21:08:18 (UTC+0)](#3148596)[Bawolff](/p/Bawolff/) added a comment.Edited · [Apr 1 2017, 9:51 PM2017-04-01 21:51:27 (UTC+0)](#3148621)Comment Actions
> In [T140591#3148362](/T140591#3148362), [@Reedy](/p/Reedy/) wrote:
>
> [@Bawolff](/p/Bawolff/) What's the other "secret" patch to be associated with [T156184](/T156184) ?

~~The one at T160266#3117039~~

**EDIT** I meant the other patch - <https://phabricator.wikimedia.org/T160266#3096811> . The one that's deployed on cluster

[Bawolff](/p/Bawolff/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-fli2ukbmb7laiij/)[Apr 1 2017, 10:15 PM2017-04-01 22:15:44 (UTC+0)](#3148631)[Bawolff](/p/Bawolff/) closed subtask [T156184: Make rawHTML mode not apply to system messages](/T156184) as Resolved.[Apr 1 2017, 10:46 PM2017-04-01 22:46:18 (UTC+0)](#3148637)[Bawolff](/p/Bawolff/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-3bou2mi2p73qink/)[Reedy](/p/Reedy/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-iibp2qhtrrizpur/)[Apr 2 2017, 3:12 PM2017-04-02 15:12:31 (UTC+0)](#3149064)

[Reedy](/p/Reedy/) added a comment.[Apr 2 2017, 5:42 PM2017-04-02 17:42:14 (UTC+0)](#3149286)Comment Actions

Rather than trying to update the table above, and also to make life easier for the actual release, here are some tars of all the patches! Including the bump/release note finalisations patch

1.28.1

1.28.1.tar80 KB[Download](https://phab.wmfusercontent.org/file/download/msckjhqpftvu2vswph2w/PHID-FILE-yzer5jssx4iggzucykrm/1.28.1.tar)

---

0002-SECURITY-XSS-in-search-if-wgAdvancedSearchHighlighti.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/lxooyef2k2godbwn5t2o/PHID-FILE-jgtjs57gxmtkfyqpw73m/0002-SECURITY-XSS-in-search-if-wgAdvancedSearchHighlighti.patch)

0003-SECURITY-API-Don-t-log-sensitive-parameters.patch7 KB[Download](https://phab.wmfusercontent.org/file/download/cngratpmhxcy3fqk5bby/PHID-FILE-ez3q27sih7kxahwkm5ob/0003-SECURITY-API-Don-t-log-sensitive-parameters.patch)

0004-SECURITY-SpecialWatchlist-Check-CSRF-token-when-usin.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/we6eh3m4hr6sinmpntva/PHID-FILE-bpd7snsnec4vkaphti7v/0004-SECURITY-SpecialWatchlist-Check-CSRF-token-when-usin.patch)

0005-SECURITY-Escape-wikitext-content-model-format-in-mes.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/7qgxlijkm7tpjvpzttbz/PHID-FILE-yxhyrk4xpxftlixvbxtd/0005-SECURITY-Escape-wikitext-content-model-format-in-mes.patch)

0001-SECURITY-Do-not-directly-redirect-to-interwikis-but-.patch14 KB[Download](https://phab.wmfusercontent.org/file/download/vzu5lllyl7ncsqja2zhq/PHID-FILE-lqhryh5fg4xcmdugqwhr/0001-SECURITY-Do-not-directly-redirect-to-interwikis-but-.patch)

0007-SECURITY-Don-t-write-LocalisationCache-to-temporary-.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/bcjcvmdag54wdxgdkymo/PHID-FILE-sgwxehcpyh3ddudfizdz/0007-SECURITY-Don-t-write-LocalisationCache-to-temporary-.patch)

0008-SECURITY-Always-normalize-link-url-before-adding-to-.patch3 KB[Download](https://phab.wmfusercontent.org/file/download/5tcmxqlibes7igbvwdez/PHID-FILE-vpcdetc3y5hvbv3whmfp/0008-SECURITY-Always-normalize-link-url-before-adding-to-.patch)

0009-SECURITY-Do-not-allow-users-to-undelete-a-page-they-.patch8 KB[Download](https://phab.wmfusercontent.org/file/download/s5go6atxlpze3uahqztw/PHID-FILE-66e4wdctopnf5fbvwcqo/0009-SECURITY-Do-not-allow-users-to-undelete-a-page-they-.patch)

0010-Bump-wgVersion-and-finalise-RELEASE-NOTES-for-1.28.1.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/h2dpg3fkep737yh7ddzy/PHID-FILE-5omlveip4ogt36hzsxoa/0010-Bump-wgVersion-and-finalise-RELEASE-NOTES-for-1.28.1.patch)

0006-SECURITY-Whitelist-DTD-declaration-in-SVG.patch22 KB[Download](https://phab.wmfusercontent.org/file/download/rmmw57xavkcds5jtfpj6/PHID-FILE-4z3uf56k53rst22ptael/0006-SECURITY-Whitelist-DTD-declaration-in-SVG.patch)

[Reedy](/p/Reedy/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-lv6wbdz37e22tmg/)[Apr 2 2017, 5:44 PM2017-04-02 17:44:09 (UTC+0)](#3149287)

[Reedy](/p/Reedy/) added a comment.[Apr 2 2017, 6:37 PM2017-04-02 18:37:27 (UTC+0)](#3149308)Comment Actions

1.27.2

1.27.2.tar80 KB[Download](https://phab.wmfusercontent.org/file/download/cmil6d2zavup2h7w7fhi/PHID-FILE-bjftc665rq6fba2ndpyg/1.27.2.tar)

---

0002-SECURITY-XSS-in-search-if-wgAdvancedSearchHighlighti.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/bby5drs2o2e6yp647fgo/PHID-FILE-yx4vfnkigqzoqu5ieg24/0002-SECURITY-XSS-in-search-if-wgAdvancedSearchHighlighti.patch)

0003-SECURITY-API-Don-t-log-sensitive-parameters.patch7 KB[Download](https://phab.wmfusercontent.org/file/download/zfsvyqg2bqofgtmma6y6/PHID-FILE-auaxlcbg6ykivslsi3ua/0003-SECURITY-API-Don-t-log-sensitive-parameters.patch)

0004-SECURITY-SpecialWatchlist-Check-CSRF-token-when-usin.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/d3flgtwliwuzwdkxdn7h/PHID-FILE-rvostmbn2lbqpqfsnuiw/0004-SECURITY-SpecialWatchlist-Check-CSRF-token-when-usin.patch)

0001-SECURITY-Do-not-directly-redirect-to-interwikis-but-.patch14 KB[Download](https://phab.wmfusercontent.org/file/download/najrjeexhthaoeeltrll/PHID-FILE-xg252ox3pfmtu3vlprng/0001-SECURITY-Do-not-directly-redirect-to-interwikis-but-.patch)

0007-SECURITY-Don-t-write-LocalisationCache-to-temporary-.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/xmoaycvc2fsvosmojcpt/PHID-FILE-g6p473zsey6a4xhrngqv/0007-SECURITY-Don-t-write-LocalisationCache-to-temporary-.patch)

0008-SECURITY-Always-normalize-link-url-before-adding-to-.patch3 KB[Download](https://phab.wmfusercontent.org/file/download/pqnmrwgxowcximaqbnku/PHID-FILE-mbyqe7uvaa75625ye6sa/0008-SECURITY-Always-normalize-link-url-before-adding-to-.patch)

0009-SECURITY-Do-not-allow-users-to-undelete-a-page-they-.patch5 KB[Download](https://phab.wmfusercontent.org/file/download/gbf6mnvtkake6snovzhp/PHID-FILE-7eus53awgknchdaumu43/0009-SECURITY-Do-not-allow-users-to-undelete-a-page-they-.patch)

0010-Bump-wgVersion-and-finalise-RELEASE-NOTES-for-1.27.2.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/64md7avcy5ubnvcxmou3/PHID-FILE-2mpor63l7gsod67bibvm/0010-Bump-wgVersion-and-finalise-RELEASE-NOTES-for-1.27.2.patch)

0006-SECURITY-Whitelist-DTD-declaration-in-SVG.patch22 KB[Download](https://phab.wmfusercontent.org/file/download/2zrgsj5ybbm5omrqz7z2/PHID-FILE-6pmoqcwupd4jwotn2naq/0006-SECURITY-Whitelist-DTD-declaration-in-SVG.patch)

0005-SECURITY-Escape-wikitext-content-model-format-in-mes.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/5tezpzz4x4xwgzl6lowi/PHID-FILE-jtwoacben6ezbtaqod4h/0005-SECURITY-Escape-wikitext-content-model-format-in-mes.patch)

[Reedy](/p/Reedy/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-q2jcymeob7u6i5j/)[Apr 2 2017, 6:37 PM2017-04-02 18:37:46 (UTC+0)](#3149309)

[Reedy](/p/Reedy/) added a comment.[Apr 2 2017, 7:10 PM2017-04-02 19:10:03 (UTC+0)](#3149329)Comment Actions

So, as we've not decided about [T125177](/T125177). I've made 2 sets of patches for REL1\_23, one has <https://gerrit.wikimedia.org/r/#/c/336838/> at the top (and as such, needs merging first if we go down that route), and one without it.

I want to get this resolved before we get that far to do the release, but doing the prep now for ease

---

With 336838

1.23.16-withapisecurity.tar70 KB[Download](https://phab.wmfusercontent.org/file/download/3g3d4rcuecctzjorptjj/PHID-FILE-7ua3bsaauos2bjcs6x2l/1.23.16-withapisecurity.tar)

0002-SECURITY-XSS-in-search-if-wgAdvancedSearchHighlighti.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/kptomnfucnu27rqc34zl/PHID-FILE-6q2rtsohxtlt2agssxv6/0002-SECURITY-XSS-in-search-if-wgAdvancedSearchHighlighti.patch)

0003-SECURITY-API-Don-t-log-sensitive-parameters.patch5 KB[Download](https://phab.wmfusercontent.org/file/download/rlzemukyhi4frladqqn2/PHID-FILE-umfh3rr7hnvyfbanjjso/0003-SECURITY-API-Don-t-log-sensitive-parameters.patch)

0004-SECURITY-SpecialWatchlist-Check-CSRF-token-when-usin.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/yxnzidfoottzx5utjpfn/PHID-FILE-kjs2siwq6unbzaqgqyvv/0004-SECURITY-SpecialWatchlist-Check-CSRF-token-when-usin.patch)

0005-SECURITY-Escape-wikitext-content-model-format-in-mes.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/arwcss3ilyanmbae7foj/PHID-FILE-nj6nmnabwbfucyw5skvy/0005-SECURITY-Escape-wikitext-content-model-format-in-mes.patch)

0001-SECURITY-Do-not-directly-redirect-to-interwikis-but-.patch13 KB[Download](https://phab.wmfusercontent.org/file/download/ja5eajolz3tpt3rd3xgr/PHID-FILE-jv5ujd3yd6w7pojoulvh/0001-SECURITY-Do-not-directly-redirect-to-interwikis-but-.patch)

0007-SECURITY-Always-normalize-link-url-before-adding-to-.patch3 KB[Download](https://phab.wmfusercontent.org/file/download/7y3uenacrc53rva4m2xd/PHID-FILE-fj2jbclbidazis7vtcd3/0007-SECURITY-Always-normalize-link-url-before-adding-to-.patch)

0008-SECURITY-Do-not-allow-users-to-undelete-a-page-they-.patch5 KB[Download](https://phab.wmfusercontent.org/file/download/2gaghuer3aarmxaff3gc/PHID-FILE-yvg5ndnn4lcmglcyxdhy/0008-SECURITY-Do-not-allow-users-to-undelete-a-page-they-.patch)

0009-Bump-wgVersion-and-finalise-RELEASE-NOTES-for-1.23.1.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/ar276mu4mduacft4azri/PHID-FILE-nefc464ejrnqj5fmsbn4/0009-Bump-wgVersion-and-finalise-RELEASE-NOTES-for-1.23.1.patch)

0006-SECURITY-Whitelist-DTD-declaration-in-SVG.patch22 KB[Download](https://phab.wmfusercontent.org/file/download/foy5ke4ughrtqngd7up7/PHID-FILE-eyuqgz24yuk47roayjcr/0006-SECURITY-Whitelist-DTD-declaration-in-SVG.patch)

---

Without 336838

1.23.16-withoutapisecurity.tar60 KB[Download](https://phab.wmfusercontent.org/file/download/3h67tqquykt2thgzrr6z/PHID-FILE-hkqxg7zkcsb7quhcvbtg/1.23.16-withoutapisecurity.tar)

0002-SECURITY-XSS-in-search-if-wgAdvancedSearchHighlighti.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/bnd2ozp5xmz537zxmzen/PHID-FILE-idht2geozdj3ujzqvtsx/0002-SECURITY-XSS-in-search-if-wgAdvancedSearchHighlighti.patch)

0003-SECURITY-SpecialWatchlist-Check-CSRF-token-when-usin.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/7xuh7hjagpmen3lllmn3/PHID-FILE-t6mlhljlmebfaoiiktml/0003-SECURITY-SpecialWatchlist-Check-CSRF-token-when-usin.patch)

0004-SECURITY-Escape-wikitext-content-model-format-in-mes.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/5hokcesyda4bfhwhleh2/PHID-FILE-znmph4cstk3pov4xbhcg/0004-SECURITY-Escape-wikitext-content-model-format-in-mes.patch)

0001-SECURITY-Do-not-directly-redirect-to-interwikis-but-.patch13 KB[Download](https://phab.wmfusercontent.org/file/download/ysnvyat47pbrzgityndd/PHID-FILE-u2gd6cdgvrcu223blfvz/0001-SECURITY-Do-not-directly-redirect-to-interwikis-but-.patch)

0006-SECURITY-Always-normalize-link-url-before-adding-to-.patch3 KB[Download](https://phab.wmfusercontent.org/file/download/hfq4xe2coxqdy3q2b4bg/PHID-FILE-sjgffuktyohabh3adphc/0006-SECURITY-Always-normalize-link-url-before-adding-to-.patch)

0007-SECURITY-Do-not-allow-users-to-undelete-a-page-they-.patch5 KB[Download](https://phab.wmfusercontent.org/file/download/b5g5dt56vy6cbbsmnxw5/PHID-FILE-v54hgsa3a6dapwoz536i/0007-SECURITY-Do-not-allow-users-to-undelete-a-page-they-.patch)

0005-SECURITY-Whitelist-DTD-declaration-in-SVG.patch22 KB[Download](https://phab.wmfusercontent.org/file/download/2tiqeezupjffry77xpdm/PHID-FILE-2yerauo6vi7xm5vk2omh/0005-SECURITY-Whitelist-DTD-declaration-in-SVG.patch)

0008-Bump-wgVersion-and-finalise-RELEASE-NOTES-for-1.23.1.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/aiqy3exy24gdjsvkeb7d/PHID-FILE-onbux6pd6isbmwhdwvol/0008-Bump-wgVersion-and-finalise-RELEASE-NOTES-for-1.23.1.patch)

[Reedy](/p/Reedy/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-igivosqfaci46p7/)[Apr 2 2017, 7:10 PM2017-04-02 19:10:12 (UTC+0)](#3149330)[Reedy](/p/Reedy/) added a parent task: [T161996: Release MediaWiki 1.28.1/1.27.2/1.23.16](/T161996).[Apr 2 2017, 7:23 PM2017-04-02 19:23:19 (UTC+0)](#3149355)[Reedy](/p/Reedy/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-axykmd6e3y76jtz/)[Apr 2 2017, 10:22 PM2017-04-02 22:22:43 (UTC+0)](#3149514)

[Reedy](/p/Reedy/) added a comment.[Apr 2 2017, 11:45 PM2017-04-02 23:45:04 (UTC+0)](#3149564)Comment Actions

master.tar80 KB[Download](https://phab.wmfusercontent.org/file/download/2rane27xcwlys66wyqo7/PHID-FILE-nc4ivinxalzoo26x3up4/master.tar)

---

0001-SECURITY-Do-not-directly-redirect-to-interwikis-but-.patch14 KB[Download](https://phab.wmfusercontent.org/file/download/ns6t2gmbc2ybpsf3smi6/PHID-FILE-czrrj3o6koxdild66wnr/0001-SECURITY-Do-not-directly-redirect-to-interwikis-but-.patch)

0002-SECURITY-XSS-in-search-if-wgAdvancedSearchHighlighti.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/if5bi6o4rlgbsrgaelfp/PHID-FILE-3gmm6zdlj2ha7d467ma7/0002-SECURITY-XSS-in-search-if-wgAdvancedSearchHighlighti.patch)

0003-SECURITY-API-Don-t-log-sensitive-parameters.patch7 KB[Download](https://phab.wmfusercontent.org/file/download/mhdyp5g6g5ngbcpgaprd/PHID-FILE-jijzgsrpi7shqmjv6usy/0003-SECURITY-API-Don-t-log-sensitive-parameters.patch)

0004-SECURITY-SpecialWatchlist-Check-CSRF-token-when-usin.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/junm4pbamojyetrjra7l/PHID-FILE-kk4zcx5v2qoll4arsd27/0004-SECURITY-SpecialWatchlist-Check-CSRF-token-when-usin.patch)

0005-SECURITY-Escape-wikitext-content-model-format-in-mes.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/kqxzopgvims733egbjxz/PHID-FILE-ldaxz3ge65svq6ns2gqh/0005-SECURITY-Escape-wikitext-content-model-format-in-mes.patch)

0007-SECURITY-Don-t-write-LocalisationCache-to-temporary-.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/bnk3lutmlznjgi7gq5yq/PHID-FILE-p7rpppogyhpjrspw2ys5/0007-SECURITY-Don-t-write-LocalisationCache-to-temporary-.patch)

0008-SECURITY-Always-normalize-link-url-before-adding-to-.patch3 KB[Download](https://phab.wmfusercontent.org/file/download/nz2eeqatmffdjqb2ek57/PHID-FILE-2w55xuove2qw2rbe52v5/0008-SECURITY-Always-normalize-link-url-before-adding-to-.patch)

0006-SECURITY-Whitelist-DTD-declaration-in-SVG.patch22 KB[Download](https://phab.wmfusercontent.org/file/download/o5dclcjdjwksvcnx7wos/PHID-FILE-sqyquz564ichgmk4y4jz/0006-SECURITY-Whitelist-DTD-declaration-in-SVG.patch)

0009-SECURITY-Do-not-allow-users-to-undelete-a-page-they.patch5 KB[Download](https://phab.wmfusercontent.org/file/download/b24nbujmncgruhfe3e6f/PHID-FILE-xjfwvuujrghsmq66n3gs/0009-SECURITY-Do-not-allow-users-to-undelete-a-page-they.patch)

[Reedy](/p/Reedy/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-o3p42y26zlclb6y/)[Apr 2 2017, 11:45 PM2017-04-02 23:45:18 (UTC+0)](#3149565)[Grunny](/p/Grunny/) subscribed.[Apr 4 2017, 1:40 PM2017-04-04 13:40:19 (UTC+0)](#3153698)Comment Actions

I believe the patch for MW 1.23 related to [T48143](/T48143) will break as it adds the call to parser::normalizeLinkUrl but the Parser::normalizeLinkUrl method does not exist in MW 1.23, as it is still using Parser::replaceUnusualEscapes instead.

[Reedy](/p/Reedy/) added a comment.[Apr 4 2017, 1:48 PM2017-04-04 13:48:19 (UTC+0)](#3153760)Comment Actions

Looks like you're right, thanks [@Grunny](/p/Grunny/)

Of course, helpfully, <https://github.com/wikimedia/mediawiki/blob/4f43a9608fd4af27cce666c94caabb8106d50cc4/includes/parser/Parser.php#L1980> doesn't have a @since tag on it...

[@Bawolff](/p/Bawolff/) Is swapping to replaceUnusualEscapes in REL1\_23 enough, or do we need to backport some/all of normalizeLinkUrl from a newer version?

[Reedy](/p/Reedy/) added a comment.[Apr 4 2017, 2:47 PM2017-04-04 14:47:15 (UTC+0)](#3153955)Comment Actions
> [15:33:54] <bawolff> yeah, looking at [e2c9d4df](/rMWe2c9d4dfa90b57cad70ad185e6667e8ba76464db), replaceUnusualEscapes is good enough for our purposes

I'll get the patch updated and re-tarred

[Grunny](/p/Grunny/) added a comment.[Apr 4 2017, 4:36 PM2017-04-04 16:36:24 (UTC+0)](#3154243)Comment Actions

For the MW 1.23 patch for [T108138](/T108138), it looks like $user is undefined in the Title::userCan call as well, as it currently repeatedly calls $this->getUser() rather than storing it in a $user variable.

[Reedy](/p/Reedy/) added a comment.[Apr 4 2017, 4:47 PM2017-04-04 16:47:14 (UTC+0)](#3154274)Comment Actions
> In [T140591#3154243](/T140591#3154243), [@Grunny](/p/Grunny/) wrote:
>
> For the MW 1.23 patch for [T108138](/T108138), it looks like $user is undefined in the Title::userCan call as well, as it currently repeatedly calls $this->getUser() rather than storing it in a $user variable.

The latter isn't great, but isn't a major issue (MW won't be creating new user objects every time). Will fix it up at the same time

[Reedy](/p/Reedy/) added a comment.[Apr 4 2017, 5:12 PM2017-04-04 17:12:26 (UTC+0)](#3154324)Comment Actions

1.23.16v2-withapisecurity.tar80 KB[Download](https://phab.wmfusercontent.org/file/download/bfe3l5avht4g37ji3xa6/PHID-FILE-zkre476m37gra4fujm3t/1.23.16v2-withapisecurity.tar)

1.23.16v2-withoutapisecurity.tar60 KB[Download](https://phab.wmfusercontent.org/file/download/5shtz3k3ela2vorejvlb/PHID-FILE-233aoebxowrwwyeywkby/1.23.16v2-withoutapisecurity.tar)

Updated, thanks [@Grunny](/p/Grunny/)

[Reedy](/p/Reedy/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-ukubioqse4zrqyv/)[Apr 4 2017, 5:13 PM2017-04-04 17:13:03 (UTC+0)](#3154325)[Grunny](/p/Grunny/) added a comment.[Apr 5 2017, 9:08 AM2017-04-05 09:08:59 (UTC+0)](#3156642)Comment Actions

Thanks, [@Reedy](/p/Reedy/)! Found one more issue in the patches for MW 1.23. In the patch for [T108138](/T108138), the calls to getUserPermissionsErrorsInternal are passing the undefined variable $rigor as MW 1.23 is still using the boolean $doExpensiveQueries instead. The call to Title::userCan should also probably use a boolean true instead of 'secure' for consistency.

[Reedy](/p/Reedy/) added a comment.[Apr 5 2017, 5:27 PM2017-04-05 17:27:39 (UTC+0)](#3158067)Comment Actions

1.23.16v3-withapisecurity.tar80 KB[Download](https://phab.wmfusercontent.org/file/download/rknlfhi4dbtiarhwwwy3/PHID-FILE-xzf5rjia3b6pvqemisgp/1.23.16v3-withapisecurity.tar)

1.23.16v3-withoutapisecurity.tar60 KB[Download](https://phab.wmfusercontent.org/file/download/gi6a6pzjyb3oyq7l74d7/PHID-FILE-pbnywicwoqw5tu36u7ix/1.23.16v3-withoutapisecurity.tar)

[Reedy](/p/Reedy/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-goj2koxuoanndlc/)[Apr 5 2017, 5:28 PM2017-04-05 17:28:11 (UTC+0)](#3158072)Comment Actions

Thanks again [@Grunny](/p/Grunny/)

Are Wikia going to stop using such an ancient MW anytime soon so they don't care about 1.23? ;)

[Reedy](/p/Reedy/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-3z25jyzdpmsio64/)[Apr 5 2017, 9:09 PM2017-04-05 21:09:21 (UTC+0)](#3158862)

[Reedy](/p/Reedy/) added a comment.[Apr 5 2017, 11:06 PM2017-04-05 23:06:26 (UTC+0)](#3159174)Comment Actions

API changes are gonna land, <https://gerrit.wikimedia.org/r/#/c/336838/> is merged in public

1.23.16v4.tar70 KB[Download](https://phab.wmfusercontent.org/file/download/squqowfuukljee7gtcrq/PHID-FILE-fhrc6zvjfrywdkg3gssh/1.23.16v4.tar)

[Reedy](/p/Reedy/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-5pbplnzjm44275q/)[Apr 5 2017, 11:07 PM2017-04-05 23:07:36 (UTC+0)](#3159182)[Reedy](/p/Reedy/) closed subtask Restricted Task as Resolved.[Apr 6 2017, 2:02 PM2017-04-06 14:02:54 (UTC+0)](#3160385)[Reedy](/p/Reedy/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-ij2nn3zp5tuqmtj/)[Apr 6 2017, 3:51 PM2017-04-06 15:51:28 (UTC+0)](#3160663)

[Reedy](/p/Reedy/) added a comment.[Apr 6 2017, 6:26 PM2017-04-06 18:26:51 (UTC+0)](#3161333)Comment Actions

1.28.1v2.tar80 KB[Download](https://phab.wmfusercontent.org/file/download/xpz2mik5omjmtds75uaw/PHID-FILE-3xqmp5n52xvggbly2pxu/1.28.1v2.tar)

Rebase for patch merged into REL1\_28

[Reedy](/p/Reedy/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-5jzwnabxicir32a/)[Apr 6 2017, 6:27 PM2017-04-06 18:27:06 (UTC+0)](#3161334)[Reedy](/p/Reedy/) claimed this task.[Apr 6 2017, 8:52 PM2017-04-06 20:52:00 (UTC+0)](#3161798)[Reedy](/p/Reedy/) edited projects, added [MediaWiki-General](/tag/mediawiki-general/), [Security-Team](/tag/security-team/); removed [acl\*security](/tag/acl_security/).[Reedy](/p/Reedy/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-pqoivkae6bhizin/)" to "Public (No Login Required)".Restricted Application added a project: [acl\*security](/tag/acl_security/).  · [View Herald Transcript](/herald/transcript/1778012/)[Apr 6 2017, 8:52 PM2017-04-06 20:52:01 (UTC+0)](#3161801)[Reedy](/p/Reedy/) closed this task as Resolved.[Apr 6 2017, 8:53 PM2017-04-06 20:53:01 (UTC+0)](#3161803)[Reedy](/p/Reedy/) mentioned this in [T149869: Security review for PageForms](/T149869).[Apr 6 2017, 9:52 PM2017-04-06 21:52:28 (UTC+0)](#3161924)[Reedy](/p/Reedy/) mentioned this in [T168823: Tracking bug for 1.27.4/1.28.3/1.29.2 security releases](/T168823).[Nov 2 2017, 7:37 PM2017-11-02 19:37:56 (UTC+0)](#3730657)[sbassett](/p/sbassett/) moved this task from [Incoming](/project/board/1179/) to [Our Part Is Done](/project/board/1179/) on the [Security-Team](/tag/security-team/) board.[Jun 11 2019, 6:34 PM2019-06-11 18:34:05 (UTC+0)](#5250971)[sbassett](/p/sbassett/) moved this task from [Pending deployment / release](/project/board/30/) to [Done](/project/board/30/) on the [acl\*security](/tag/acl_security/) board.[Sep 26 2019, 2:34 PM2019-09-26 14:34:19 (UTC+0)](#5526808)[• chasemp](/p/chasemp/) added a project: [Security](/tag/security/).[Feb 10 2020, 10:59 PM2020-02-10 22:59:07 (UTC+0)](#5869640) · [• chasemp](/p/chasemp/) removed a project: [acl\*security](/tag/acl_security/).[Feb 20 2020, 8:17 PM2020-02-20 20:17:37 (UTC+0)](#5904717) · [Aklapper](/p/Aklapper/) removed a subscriber: [Anomie](/p/Anomie/).[Oct 16 2020, 5:42 PM2020-10-16 17:42:14 (UTC+0)](#6554997) · [Log In to Comment](/login/?next=)Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. · [Wikimedia Foundation](https://wikimediafoundation.org/) · [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) · [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) · [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) · [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) · [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) · [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) · [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)

=== Content from phabricator.wikimedia.org_2df12186_20250124_205032.html ===
Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT68404)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T68404
# New CSS syntax for attr() allows web bugsClosed, Resolved[Public](/policy/explain/PHID-TASK-uc4pzf6n7hc24xbgarm4/view/)Actions

* [Edit Task](/maniphest/task/edit/68404/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/68404/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-uc4pzf6n7hc24xbgarm4/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-uc4pzf6n7hc24xbgarm4/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-uc4pzf6n7hc24xbgarm4/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-uc4pzf6n7hc24xbgarm4/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-uc4pzf6n7hc24xbgarm4/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-uc4pzf6n7hc24xbgarm4/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-uc4pzf6n7hc24xbgarm4/)
* [Protect as security issue](/wmf/escalate-task/68404/)
* [Award Token](/token/give/PHID-TASK-uc4pzf6n7hc24xbgarm4/)
* [Flag For Later](/flag/edit/PHID-TASK-uc4pzf6n7hc24xbgarm4/)

Assigned To

|  | [Bawolff](/p/Bawolff/) |
| --- | --- |

Authored By

|  | [Schnark](/p/Schnark/) |
| --- | --- |
| Jun 10 2014, 9:42 AM2014-06-10 09:42:00 (UTC+0) |

Tags

* [Security-Core](/tag/security-core/) [(Backlog)](/project/board/427/)
* [Privacy](/tag/privacy/)
* [MW-1.28-release-notes](/tag/mw-1.28-release-notes/)
* [MW-1.28-release (WMF-deploy-2016-10-04\_(1.28.0-wmf.21))](/tag/wmf-deploy-2016-10-04_1.28.0-wmf.21/)
* [MW-1.27-release-notes](/tag/mw-1.27-release-notes/)
* [MW-1.23-release](/tag/mw-1.23-release/) [(Backlog)](/project/board/603/)
* [MW-1.26-release](/tag/mw-1.26-release/) [(Backlog)](/project/board/1177/)
* [Security](/tag/security/)
Referenced Files

|  | [F13660: bug66404.patch](/F13660) |
| --- | --- |
| Nov 22 2014, 3:13 AM2014-11-22 03:13:44 (UTC+0) |

Subscribers

|  | [Aklapper](/p/Aklapper/) |
| --- | --- |

|  | [Bawolff](/p/Bawolff/) |
| --- | --- |

|  | [• csteipp](/p/csteipp/) |
| --- | --- |

|  | [gerritbot](/p/gerritbot/) |
| --- | --- |

|  | [• MZMcBride](/p/MZMcBride/) |
| --- | --- |

|  | [Reedy](/p/Reedy/) |
| --- | --- |

|  | [Schnark](/p/Schnark/) |
| --- | --- |

# Description

The sanitizer rejects any inline CSS with "url(" to prevent web bugs. [1] has a proposed update to attr() which would allow to circumvent this check:

<div title="[https://example.org/image.png"](https://example.org/image.png%22) style="background-image: attr(title url);"></div>

creates a span with an URL as title. The inline CSS then adds an background image defined by that title interpreted as URL, i.e. shows an image from any domain.

According to [2] no browser currently implements this syntax ([3] claims it is implemented in IE9, which I could not reproduce, and is wrong according to [4]). But once this syntax gets implemented by some browser, the sanitizer should reject /attr\s\*\([^),]+url/ (I'm not entirely sure about this regexp, but something like that should do the job).

[1]: <https://www.w3.org/TR/css3-values/#attr-notation>

[2]: <https://developer.mozilla.org/en/docs/Web/CSS/attr#Browser_Compatibility>

[3]: <https://bugzilla.mozilla.org/show_bug.cgi?id=435426#c2>

[4]: [http://msdn.microsoft.com/en-us/library/ie/ms537660%28v=vs.85%29.aspx#attr](http://msdn.microsoft.com/en-us/library/ie/ms537660%28v%3Dvs.85%29.aspx#attr)

---

**Version**: unspecified

**Severity**: normal

# Details

Reference bz66404

|  | Subject | Repo | Branch | Lines +/- |
| --- | --- | --- | --- | --- |
|  | [Disallow css attr() with url type](https://gerrit.wikimedia.org/r/c/316621) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [REL1\_26](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/REL1_26) | +10 -0 |
|  | [Disallow css attr() with url type](https://gerrit.wikimedia.org/r/c/316618) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [REL1\_27](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/REL1_27) | +11 -0 |
|  | [Disallow css attr() with url type](https://gerrit.wikimedia.org/r/c/316714) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [REL1\_23](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/REL1_23) | +10 -0 |
|  | [Disallow css attr() with url type](https://gerrit.wikimedia.org/r/c/310257) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/master) | +3 -0 |

[Customize query in gerrit](https://gerrit.wikimedia.org/r/#/q/bug:T68404)
# Related ObjectsSearch...

* Task Graph
* Mentions

|  |  | Status | Subtype | Assigned | Task |
| --- | --- | --- | --- | --- | --- |
|  |  | Resolved |  | [• demon](/p/demon/) | T161996 [Release MediaWiki 1.28.1/1.27.2/1.23.16](/T161996) |
|  |  | Resolved |  | [Reedy](/p/Reedy/) | T140591 [MediaWiki 1.28.1/1.27.2/1.23.16 security release](/T140591) |
|  |  | Resolved |  | [Bawolff](/p/Bawolff/) | T68404 [New CSS syntax for attr() allows web bugs](/T68404) |

Mentioned In [T140591: MediaWiki 1.28.1/1.27.2/1.23.16 security release](/T140591)
### Event Timeline

[• bzimport](/p/bzimport/) raised the priority of this task from  to Needs Triage.[Nov 22 2014, 3:13 AM2014-11-22 03:13:43 (UTC+0)](#690622)[• bzimport](/p/bzimport/) added a project: [Security-Core](/tag/security-core/).[• bzimport](/p/bzimport/) set Reference to bz66404.[• bzimport](/p/bzimport/) changed Security from none to Software security bug.Restricted Application changed the visibility from "Public (No Login Required)" to "[acl\*security](/tag/acl_security/) (Project)".  · [View Herald Transcript](/herald/transcript/374279/)[Nov 22 2014, 3:13 AM2014-11-22 03:13:43 (UTC+0)](#690627)Restricted Application changed the edit policy from "All Users" to "[acl\*security](/tag/acl_security/) (Project)".  · [View Herald Transcript](/herald/transcript/374279/)[Schnark](/p/Schnark/) created this task.[Jun 10 2014, 9:42 AM2014-06-10 09:42:00 (UTC+0)](#690631)[• csteipp](/p/csteipp/) added a comment.[Jun 10 2014, 6:20 PM2014-06-10 18:20:01 (UTC+0)](#690634)Comment Actions

Thanks for noticing that Michael. I don't think it would hurt to add a blacklist for that, and if support is dropped in the final spec, we can always take it out. I'll make a patch for that today.

I'm still trying to verify that no browsers currently support it. If that's the case, then we can do the change publicly. If not we'll do this a security patch.

[• csteipp](/p/csteipp/) added a comment.[Jun 11 2014, 11:35 PM2014-06-11 23:35:04 (UTC+0)](#690648)Comment Actions

(In reply to Michael M. from comment #0)

> According to [2] no browser currently implements this syntax ([3] claims it
>
> is implemented in IE9, which I could not reproduce, and is wrong according
>
> to [4]). But once this syntax gets implemented by some browser, the
>
> sanitizer should reject /attr\s\*\([^),]+url/ (I'm not entirely sure about
>
> this regexp, but something like that should do the job).

I'm not seeing definitive, formal definition of syntax, so it seems little ambiguous if a comma can separate the first and second parameter to the function. The functional notation says, "If a function takes a list of arguments, the arguments are separated by a comma (‘,’) with optional whitespace before and after the comma." But the definition of attr() and all the given examples use the comma to indicate the fallback. Off the top of my head, I can't think of another attribute with an optional second parameter to check of most browsers implemented it right.

So to be safer, I think I'll do, /attr\s\*\([^)]+[\s,]+url/. That would match a fallback to the string "url", or an attr-name of "url" if proceeded by 2 or more whitespace chars. I'd rather err on the side of being conservative and protect against browsers not quite implementing the spec right.

I'm still investigating if any popular browsers implement this yet.

[• csteipp](/p/csteipp/) added a comment.[Jun 11 2014, 11:36 PM2014-06-11 23:36:14 (UTC+0)](#690667)Comment Actions

Created attachment 15633

Add blacklist for attr() with url

Adding a patch here, in case we find any browsers implementing this and need to patch the cluster.

**Attached**: bug66404.patch977 B[Download](https://phab.wmfusercontent.org/file/download/xtqbda5nehwvgeqpts2b/PHID-FILE-xecrsi5bsw3ogpd5usjv/bug66404.patch)

[• csteipp](/p/csteipp/) added a project: [acl\*security](/tag/acl_security/).[Nov 24 2014, 9:27 PM2014-11-24 21:27:55 (UTC+0)](#782207)Restricted Application changed the visibility from "[acl\*security](/tag/acl_security/) (Project)" to "[Custom Policy](/transactions/new/PHID-XACT-TASK-i6boexu3seoav24/)".  · [View Herald Transcript](/herald/transcript/421010/)[Nov 24 2014, 9:27 PM2014-11-24 21:27:55 (UTC+0)](#782208)Restricted Application changed the edit policy from "[acl\*security](/tag/acl_security/) (Project)" to "[Custom Policy](/transactions/new/PHID-XACT-TASK-33wm427xxmbmi44/)".  · [View Herald Transcript](/herald/transcript/421010/)[Krinkle](/p/Krinkle/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-cc6pgz4gmh5h7mo/)[Nov 27 2014, 11:07 PM2014-11-27 23:07:42 (UTC+0)](#792398)Restricted Application changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-wars3tqhr3vp73r/)" to "[Custom Policy](/transactions/new/PHID-XACT-TASK-wars3tqhr3vp73r/)".  · [View Herald Transcript](/herald/transcript/426987/)[Nov 27 2014, 11:07 PM2014-11-27 23:07:42 (UTC+0)](#792399)Restricted Application changed the edit policy from "[Custom Policy](/transactions/old/PHID-XACT-TASK-wor4xea67rmxl6v/)" to "[Custom Policy](/transactions/new/PHID-XACT-TASK-wor4xea67rmxl6v/)".  · [View Herald Transcript](/herald/transcript/426987/)[• dpatrick](/p/dpatrick/) claimed this task.[Aug 14 2015, 8:13 PM2015-08-14 20:13:46 (UTC+0)](#1541039)[• dpatrick](/p/dpatrick/) triaged this task as Low priority.Restricted Application added a subscriber: [Aklapper](/p/Aklapper/).  · [View Herald Transcript](/herald/transcript/884132/)[Aug 14 2015, 8:13 PM2015-08-14 20:13:46 (UTC+0)](#1541040)[• csteipp](/p/csteipp/) added a project: [Privacy](/tag/privacy/).[Aug 20 2015, 9:23 PM2015-08-20 21:23:04 (UTC+0)](#1558771)[Bawolff](/p/Bawolff/) subscribed.Edited · [Jun 27 2016, 9:58 AM2016-06-27 09:58:44 (UTC+0)](#2408904)Comment Actions

Given nobody supports this syntax yet [1], and probably nobody will in the super-near future, I think we should maybe just submit this to gerrit like an ordinary patch.

Anyone opposed to me publicly submitting csteipp's patch to gerrit like a non-security bug?

One thing to note, is that the CSS2 version of attr, is really only useful with :before and :after pseudo-elements (which can't be used with inline styles), so it might even be safe to ban attr() outright

[1] <http://caniuse.com/#search=attr>

[Bawolff](/p/Bawolff/) moved this task from [Backlog / Other](/project/board/30/) to [Patch pending deployment](/project/board/30/) on the [acl\*security](/tag/acl_security/) board.[Jul 10 2016, 6:19 PM2016-07-10 18:19:12 (UTC+0)](#2445871)[Bawolff](/p/Bawolff/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-3hkvg4r57et7ygn/)" to "Public (No Login Required)".[Sep 13 2016, 9:45 AM2016-09-13 09:45:40 (UTC+0)](#2632162)[Bawolff](/p/Bawolff/) changed the edit policy from "[Custom Policy](/transactions/old/PHID-XACT-TASK-m5s6dvca5ugd2fp/)" to "All Users".[Bawolff](/p/Bawolff/) changed Security from Software security bug to None.[gerritbot](/p/gerritbot/) subscribed.[Sep 13 2016, 9:45 AM2016-09-13 09:45:52 (UTC+0)](#2632166)Comment Actions

Change 310257 had a related patch set uploaded (by Brian Wolff):

Disallow css attr() with url type

<https://gerrit.wikimedia.org/r/310257>

[gerritbot](/p/gerritbot/) added a project: [Patch-For-Review](/tag/patch-for-review/).[Sep 13 2016, 9:45 AM2016-09-13 09:45:53 (UTC+0)](#2632167)[• dpatrick](/p/dpatrick/) reassigned this task from [• dpatrick](/p/dpatrick/) to [Bawolff](/p/Bawolff/).[Sep 28 2016, 5:35 PM2016-09-28 17:35:34 (UTC+0)](#2674830)[• dpatrick](/p/dpatrick/) subscribed.[gerritbot](/p/gerritbot/) added a comment.[Sep 29 2016, 12:58 AM2016-09-29 00:58:43 (UTC+0)](#2676131)Comment Actions

Change 310257 merged by jenkins-bot:

Disallow css attr() with url type

<https://gerrit.wikimedia.org/r/310257>

[ReleaseTaggerBot](/p/ReleaseTaggerBot/) added projects: [MW-1.28-release-notes](/tag/mw-1.28-release-notes/), [MW-1.28-release (WMF-deploy-2016-10-04\_(1.28.0-wmf.21))](/tag/wmf-deploy-2016-10-04_1.28.0-wmf.21/).[Sep 29 2016, 1:00 AM2016-09-29 01:00:36 (UTC+0)](#2676132)[Krinkle](/p/Krinkle/) unsubscribed.[Sep 29 2016, 8:14 PM2016-09-29 20:14:35 (UTC+0)](#2678217)[gerritbot](/p/gerritbot/) added a comment.[Oct 18 2016, 7:33 PM2016-10-18 19:33:05 (UTC+0)](#2726719)Comment Actions

Change 316618 had a related patch set uploaded (by Brian Wolff):

Disallow css attr() with url type

<https://gerrit.wikimedia.org/r/316618>

[gerritbot](/p/gerritbot/) added a comment.[Oct 18 2016, 7:53 PM2016-10-18 19:53:37 (UTC+0)](#2726795)Comment Actions

Change 316621 had a related patch set uploaded (by Brian Wolff):

Disallow css attr() with url type

<https://gerrit.wikimedia.org/r/316621>

[gerritbot](/p/gerritbot/) added a comment.[Oct 18 2016, 10:47 PM2016-10-18 22:47:31 (UTC+0)](#2727316)Comment Actions

Change 316714 had a related patch set uploaded (by Brian Wolff):

Disallow css attr() with url type

<https://gerrit.wikimedia.org/r/316714>

[Bawolff](/p/Bawolff/) closed this task as Resolved.[Oct 18 2016, 10:50 PM2016-10-18 22:50:59 (UTC+0)](#2727317)Comment Actions

Patch merged, and backported to all maintained branches

[Bawolff](/p/Bawolff/) added a parent task: [T140591: MediaWiki 1.28.1/1.27.2/1.23.16 security release](/T140591).[Oct 18 2016, 10:52 PM2016-10-18 22:52:24 (UTC+0)](#2727320)[gerritbot](/p/gerritbot/) added a comment.[Oct 18 2016, 11:01 PM2016-10-18 23:01:20 (UTC+0)](#2727344)Comment Actions

Change 316714 merged by jenkins-bot:

Disallow css attr() with url type

<https://gerrit.wikimedia.org/r/316714>

[gerritbot](/p/gerritbot/) added a comment.[Oct 18 2016, 11:01 PM2016-10-18 23:01:22 (UTC+0)](#2727345)Comment Actions

Change 316618 merged by jenkins-bot:

Disallow css attr() with url type

<https://gerrit.wikimedia.org/r/316618>

[ReleaseTaggerBot](/p/ReleaseTaggerBot/) added projects: [MW-1.27-release-notes](/tag/mw-1.27-release-notes/), [MW-1.23-release](/tag/mw-1.23-release/).[Oct 19 2016, 12:00 AM2016-10-19 00:00:57 (UTC+0)](#2727429)[gerritbot](/p/gerritbot/) added a comment.[Oct 19 2016, 7:45 PM2016-10-19 19:45:34 (UTC+0)](#2729820)Comment Actions

Change 316621 merged by Umherirrender:

Disallow css attr() with url type

<https://gerrit.wikimedia.org/r/316621>

[ReleaseTaggerBot](/p/ReleaseTaggerBot/) added a project: [MW-1.26-release](/tag/mw-1.26-release/).[Oct 19 2016, 8:00 PM2016-10-19 20:00:21 (UTC+0)](#2729855)[• demon](/p/demon/) mentioned this in [T140591: MediaWiki 1.28.1/1.27.2/1.23.16 security release](/T140591).[Jan 24 2017, 11:40 PM2017-01-24 23:40:41 (UTC+0)](#2967309)

[Reedy](/p/Reedy/) subscribed.[Apr 2 2017, 10:28 PM2017-04-02 22:28:02 (UTC+0)](#3149520)Comment Actions

We should CVE this one too as a matter of course in T160876

[Reedy](/p/Reedy/) added a comment.[Apr 3 2017, 12:44 PM2017-04-03 12:44:11 (UTC+0)](#3150480)Comment Actions

Or has this disappeared from the spec?

I see attr(src url) but no title url...

[Anomie](/p/Anomie/) subscribed.[Apr 3 2017, 1:58 PM2017-04-03 13:58:28 (UTC+0)](#3150736)Comment Actions

It's still there, they just changed the anchor. Note that the actual attribute name doesn't matter, it could as easily be data-foobar.

[Anomie](/p/Anomie/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-357ehcwx55uomfc/)[Apr 3 2017, 1:58 PM2017-04-03 13:58:43 (UTC+0)](#3150737)

[Anomie](/p/Anomie/) added a comment.[Apr 3 2017, 2:48 PM2017-04-03 14:48:30 (UTC+0)](#3150872)Comment Actions

Since [@Reedy](/p/Reedy/) asked,

**Flaw:** MediaWiki's anti-web-bug CSS sanitization does not remove attr(foo url).

**Exploit:** The extensions proposed to the CSS attr() function in the [CSS Values and Units Module Level 3](https://www.w3.org/TR/css3-values/#attr-notation), specifically the 'url' type, could be used to insert a [web bug](https://en.wikipedia.org/wiki/Web_bug) in a wiki page.

This is mitigated by the fact that no major browser currently implements these extensions (according to <http://caniuse.com/#feat=css3-attr>).

[• MZMcBride](/p/MZMcBride/) subscribed.[Apr 5 2017, 1:52 AM2017-04-05 01:52:01 (UTC+0)](#3155997)[sbassett](/p/sbassett/) moved this task from [Patch pending deployment](/project/board/30/) to [Done](/project/board/30/) on the [acl\*security](/tag/acl_security/) board.[Sep 26 2019, 2:38 PM2019-09-26 14:38:41 (UTC+0)](#5526851)[sbassett](/p/sbassett/) moved this task from [Intake](/project/board/1205/) to [Done](/project/board/1205/) on the [Privacy](/tag/privacy/) board.[Oct 16 2019, 5:50 PM2019-10-16 17:50:16 (UTC+0)](#5581298)[sbassett](/p/sbassett/) removed a project: [Patch-For-Review](/tag/patch-for-review/).[• chasemp](/p/chasemp/) added a project: [Security](/tag/security/).[Feb 10 2020, 11:00 PM2020-02-10 23:00:52 (UTC+0)](#5870205) · [• chasemp](/p/chasemp/) removed a project: [acl\*security](/tag/acl_security/).[Feb 20 2020, 8:18 PM2020-02-20 20:18:40 (UTC+0)](#5905044) · [Aklapper](/p/Aklapper/) removed subscribers: [Anomie](/p/Anomie/), [• dpatrick](/p/dpatrick/).[Oct 16 2020, 5:43 PM2020-10-16 17:43:41 (UTC+0)](#6555809) · [Log In to Comment](/login/?next=)Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. · [Wikimedia Foundation](https://wikimediafoundation.org/) · [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) · [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) · [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) · [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) · [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) · [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) · [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)
