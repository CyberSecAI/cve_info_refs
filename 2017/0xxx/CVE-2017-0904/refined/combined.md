=== Content from github.com_61381335_20250124_154738.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjtdowney%2Fprivate_address_check%2Fcommit%2F58a0d7fe31de339c0117160567a5b33ad82b46af)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjtdowney%2Fprivate_address_check%2Fcommit%2F58a0d7fe31de339c0117160567a5b33ad82b46af)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=jtdowney%2Fprivate_address_check)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[jtdowney](/jtdowney)
/
**[private\_address\_check](/jtdowney/private_address_check)**
Public

* [Notifications](/login?return_to=%2Fjtdowney%2Fprivate_address_check) You must be signed in to change notification settings
* [Fork
  12](/login?return_to=%2Fjtdowney%2Fprivate_address_check)
* [Star
   42](/login?return_to=%2Fjtdowney%2Fprivate_address_check)

* [Code](/jtdowney/private_address_check)
* [Issues
  0](/jtdowney/private_address_check/issues)
* [Pull requests
  1](/jtdowney/private_address_check/pulls)
* [Actions](/jtdowney/private_address_check/actions)
* [Projects
  0](/jtdowney/private_address_check/projects)
* [Security](/jtdowney/private_address_check/security)
* [Insights](/jtdowney/private_address_check/pulse)

Additional navigation options

* [Code](/jtdowney/private_address_check)
* [Issues](/jtdowney/private_address_check/issues)
* [Pull requests](/jtdowney/private_address_check/pulls)
* [Actions](/jtdowney/private_address_check/actions)
* [Projects](/jtdowney/private_address_check/projects)
* [Security](/jtdowney/private_address_check/security)
* [Insights](/jtdowney/private_address_check/pulse)

## Commit

[Permalink](/jtdowney/private_address_check/commit/58a0d7fe31de339c0117160567a5b33ad82b46af)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix bypass bug with malformed addresses

[Browse files](/jtdowney/private_address_check/tree/58a0d7fe31de339c0117160567a5b33ad82b46af)
Browse the repository at this point in the history

```
The Ruby Resolv library can return an empty array from getaddresses for
some atypical IP address encodings. This was brought to my attention by
[@EdOverflow](https://github.com/EdOverflow).
```

* Loading branch information

[![@jtdowney](https://avatars.githubusercontent.com/u/44654?s=40&v=4)](/jtdowney)

[jtdowney](/jtdowney/private_address_check/commits?author=jtdowney "View all commits by jtdowney")
committed
Nov 5, 2017

1 parent
[47b15f6](/jtdowney/private_address_check/commit/47b15f6e6a67da601a2cde49e739a43b288c924f)

commit 58a0d7f

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**6 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* lib

  + lib/private\_address\_check.rb
    [private\_address\_check.rb](#diff-b3cf336e424e07af9abb4615e7072dac91f1818cc6f83e51f1f748cf86f8dc75)
* test

  + test/private\_address\_check\_test.rb
    [private\_address\_check\_test.rb](#diff-876705aaf3b75f64dbdd431e1adf57f92732aa0266c538c1e97d3fe8494aa9c3)

## There are no files selected for viewing

2 changes: 2 additions & 0 deletions

2
[lib/private\_address\_check.rb](#diff-b3cf336e424e07af9abb4615e7072dac91f1818cc6f83e51f1f748cf86f8dc75 "lib/private_address_check.rb")

Show comments

[View file](/jtdowney/private_address_check/blob/58a0d7fe31de339c0117160567a5b33ad82b46af/lib/private_address_check.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -31,6 +31,8 @@ def private\_address?(address) |
|  |  |  |
|  |  | def resolves\_to\_private\_address?(hostname) |
|  |  | ips = Resolv.getaddresses(hostname) |
|  |  | return true if ips.empty? |
|  |  |  |
|  |  | ips.any? do |ip| |
|  |  | private\_address?(ip) |
|  |  | end |
| Expand Down | |  |

4 changes: 4 additions & 0 deletions

4
[test/private\_address\_check\_test.rb](#diff-876705aaf3b75f64dbdd431e1adf57f92732aa0266c538c1e97d3fe8494aa9c3 "test/private_address_check_test.rb")

Show comments

[View file](/jtdowney/private_address_check/blob/58a0d7fe31de339c0117160567a5b33ad82b46af/test/private_address_check_test.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -35,4 +35,8 @@ def test\_private\_hostname\_for\_public\_addresses |
|  |  | def test\_private\_hostname\_for\_private\_addresses |
|  |  | assert PrivateAddressCheck.resolves\_to\_private\_address?("localhost") |
|  |  | end |
|  |  |  |
|  |  | def test\_private\_address\_for\_malformed\_addresses |
|  |  | assert PrivateAddressCheck.resolves\_to\_private\_address?("127.1") |
|  |  | end |
|  |  | end |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `58a0d7f`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjtdowney%2Fprivate_address_check%2Fcommit%2F58a0d7fe31de339c0117160567a5b33ad82b46af) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from edoverflow.com_f69b7d9a_20250124_154737.html ===


[EdOverflow](https://edoverflow.com/)

[About](/about/)
[Projects](/projects/)
[Media](/media/)
[Swimming](/swimming/)

Nov 9, 2017

# Bypassing Server-Side Request Forgery filters by abusing a bug in Ruby's native resolver

## Summary

This is a security advisory for a bug that I discovered in `Resolv::getaddresses` that enabled me to bypass multiple Server-Side Request Forgery filters. Applications such as GitLab and HackerOne were affected by this bug. The disclosure of all reports referenced in this advisory follow [HackerOne’s Vulnerability Disclosure Guidelines](https://www.hackerone.com/disclosure-guidelines).

This bug was assigned [CVE-2017-0904](https://cve.mitre.org/cgi-bin/cvename.cgi?name=2017-0904).

## Vulnerability Details

`Resolv::getaddresses` is OS-dependent, therefore by playing around with different IP formats one can return blank values. This bug can be abused to bypass exclusion lists often used to protect against SSRF.

| 💻 Machine 1 | 💻 Machine 2 |
| --- | --- |
| ruby 2.3.3p222 (2016-11-21) [x86\_64-linux-gnu] | ruby 2.3.1p112 (2016-04-26) [x86\_64-linux-gnu] |

💻 Machine 1

```
irb(main):002:0> Resolv.getaddresses("127.0.0.1")
=> ["127.0.0.1"]
irb(main):003:0> Resolv.getaddresses("localhost")
=> ["127.0.0.1"]
irb(main):004:0> Resolv.getaddresses("127.000.000.1")
=> ["127.0.0.1"]

```

💻 Machine 2

```
irb(main):008:0> Resolv.getaddresses("127.0.0.1")
=> ["127.0.0.1"]
irb(main):009:0> Resolv.getaddresses("localhost")
=> ["127.0.0.1"]
irb(main):010:0> Resolv.getaddresses("127.000.000.1")
=> [] # 😱

```

This issue is reproducible in the latest stable build of Ruby:

```
$ ruby -v
ruby 2.4.3p201 (2017-10-11 revision 60168) [x86_64-linux]
$ irb
irb(main):001:0> require 'resolv'
=> true
irb(main):002:0> Resolv.getaddresses("127.000.001")
=> []

```
## Proof of concept

```
irb(main):001:0> require 'resolv'
=> true
irb(main):002:0> uri = "0x7f.1"
=> "0x7f.1"
irb(main):003:0> server_ips = Resolv.getaddresses(uri)
=> [] # The bug!
irb(main):004:0> blocked_ips = ["127.0.0.1", "::1", "0.0.0.0"]
=> ["127.0.0.1", "::1", "0.0.0.0"]
irb(main):005:0> (blocked_ips & server_ips).any?
=> false # Bypass

```
## Root cause

The following section describes the root cause of this bug. I have added some comments in the code snippets to help the reader follow along.

When we run irb in debug mode (`irb -d`) the following error is returned:

```
irb(main):002:0> Resolv.getaddresses "127.1"
Exception `Resolv::DNS::Config::NXDomain' at /usr/lib/ruby/2.3.0/resolv.rb:549 - 127.1
Exception `Resolv::DNS::Config::NXDomain' at /usr/lib/ruby/2.3.0/resolv.rb:549 - 127.1
=> []

```

So the exception stems from `fetch_resource()` [[1]](https://github.com/ruby/ruby/blob/e16bd0f4d81ef74035712853a5eb527f28abb342/lib/resolv.rb#L514-L554). The “NXDOMAIN” response indicates that the resolver cannot find a corresponding PTR record. No surprise there, since, as we will see later on, `resolv.rb` uses the operating system’s resolver.

```
# Reverse DNS lookup on 💻 Machine 1.
$ nslookup 127.0.0.1
Server:   127.0.0.53
Address:  127.0.0.53#53
Non-authoritative answer:
1.0.0.127.in-addr.arpa  name = localhost.
Authoritative answers can be found from:
$ nslookup 127.000.000.1
Server:   127.0.0.53
Address:  127.0.0.53#53
Non-authoritative answer:
Name: 127.000.000.1
Address: 127.0.0.1
# NXDOMAIN for 127.1.
$ nslookup 127.1
Server:   127.0.0.53
Address:  127.0.0.53#53
** server can't find 127.1: NXDOMAIN

```

Now the following code snippets demonstrate why `Resolv::getaddresses` is OS-dependent.

`getaddresses` takes the address (`name`) and passes it on to `each_address` where once it has been resolved it is appended to the `ret` array.

```
# File lib/resolv.rb, line 100
def getaddresses(name)
  # This is the "ret" array.
  ret = []
  # This is where "address" is appended to the "ret" array.
  each_address(name) {|address| ret << address}
  return ret
end

```

`each_address` runs the `name` through `@resolvers`.

```
# File lib/resolv.rb, line 109
def each_address(name)
    if AddressRegex =~ name
      yield name
      return
    end
    yielded = false
    # "name" is passed on to the resolver here.
    @resolvers.each {|r|
      r.each_address(name) {|address|
        yield address.to_s
        yielded = true
      }
      return if yielded
    }
end

```

`@resolvers` is initialised in `initialize()`.

```
# File lib/resolv.rb, line 109
def initialize(resolvers=[Hosts.new, DNS.new])
    @resolvers = resolvers
end

```

Further on, `initialize` is actually initialised by setting `config_info` to `nil` which uses the default configuration in this case `/etc/resolv.conf`.

```
# File lib/resolv.rb, line 308
# Set to /etc/resolv.conf ¯\_(ツ)_/¯
def initialize(config_info=nil)
  @mutex = Thread::Mutex.new
  @config = Config.new(config_info)
  @initialized = nil
end

```

Here is the default configuration:

```
# File lib/resolv.rb, line 959
def Config.default_config_hash(filename="/etc/resolv.conf")
  if File.exist? filename
    config_hash = Config.parse_resolv_conf(filename)
  else
    if /mswin|cygwin|mingw|bccwin/ =~ RUBY_PLATFORM
      require 'win32/resolv'
      search, nameserver = Win32::Resolv.get_resolv_info
      config_hash = {}
      config_hash[:nameserver] = nameserver if nameserver
      config_hash[:search] = [search].flatten if search
    end
  end
  config_hash || {}
end

```

This demonstrates that `Resolv::getaddresses` is OS-dependent and that `getaddresses` returns an empty `ret` array when supplied with an IP address that fails during a reverse DNS lookup.

## Mitigation

I suggest staying away from `Resolv::getaddresses` altogether and using the `Socket` library.

```
irb(main):002:0> Resolv.getaddresses("127.1")
=> []
irb(main):003:0> Socket.getaddrinfo("127.1", nil).sample[3]
=> "127.0.0.1"

```

The Ruby Core dev team suggested using the same library.

> The right way to check an address is using OS's resolver instead of resolv.rb if the address is resolved by OS's resolver. For example, Addrinfo.getaddrinfo of socket library can be used.
> - Tanaka Akira

```
% ruby -rsocket -e '
as = Addrinfo.getaddrinfo("192.168.0.1", nil)
p as
p as.map {|a| a.ipv4_private? }
'
[#<Addrinfo: 192.168.0.1 TCP>, #<Addrinfo: 192.168.0.1 UDP>, #<Addrinfo: 192.168.0.1 SOCK_RAW>]
[true, true, true]

```
## Affected Applications and gems

### GitLab Community Edition and Enterprise Edition

*Link to report: <https://hackerone.com/reports/215105>*

The fix for [Mustafa Hasan](https://hackerone.com/strukt)’s [report](https://hackerone.com/reports/135937) ([!17286](https://gitlab.com/gitlab-org/gitlab-ce/issues/17286)) could be easily bypassed by abusing this bug. GitLab introduced an exclusion list, but would resolve the user-supplied address using `Resolv::getaddresses` and then compare the output to the values in the exclusion list. This meant that one could no longer use certain addresses such as `http://127.0.0.1` and `http://localhost/`, which Mustafa Hasan used in the original report. The bypasses allowed me to scan a GitLab intance’s internal network.

![Error message - Open port](https://user-images.githubusercontent.com/18099289/32322200-fed2e176-bfc3-11e7-8bc1-e2dc241abf6b.png)

![Error message - Closed port](https://user-images.githubusercontent.com/18099289/32322478-ec02630e-bfc4-11e7-9d76-d481d27db8f3.png)

GitLab have provided a patch: <https://about.gitlab.com/2017/11/08/gitlab-10-dot-1-dot-2-security-release/>.

### [private\_address\_check](https://github.com/jtdowney/private_address_check) by [John Downey](https://twitter.com/jtdowney)

*Link to report: <https://github.com/jtdowney/private_address_check/issues/1>*

[private\_address\_check](https://github.com/jtdowney/private_address_check) is a Ruby gem that helps prevent SSRF. The actual filtering takes place in `lib/private_address_check.rb`. The process starts by attempting to resolve the user-supplied URL with `Resolv::getaddresses` and then compares the returned value with a the values in the blacklist. Once again I was able to use the same technique as before with GitLab to bypass this filter.

```
# File lib/private_address_check.rb, line 32
def resolves_to_private_address?(hostname)
  ips = Resolv.getaddresses(hostname)
  ips.any? do |ip|
    private_address?(ip)
  end
end

```

Consequently, [HackerOne was affected by this bypass](https://hackerone.com/reports/287245), because they use the *private\_address\_check* gem to prevent SSRF on the “Integrations” panel: `https://hackerone.com/{BBP}/integrations`.

![HackerOne - Blocked Address](https://user-images.githubusercontent.com/18099289/32408319-5f50eb78-c196-11e7-8aee-c6ffd572597f.png)

![HackerOne - Bypass](https://user-images.githubusercontent.com/18099289/32408337-7bcdd874-c196-11e7-9fcc-1de5283bd7b0.png)

Unfortunately, I was unable to exploit this SSRF and therefore the issue only consisted of a filter bypass. HackerOne still encouraged me to report it, because they take any potential security issue into consideration and this bypass demonstrated a potential risk.

This issue was patched in [version 0.4.0](https://github.com/jtdowney/private_address_check/commit/58a0d7fe31de339c0117160567a5b33ad82b46af).

## Unaffected applications and gems

### [ssrf\_filter](https://github.com/arkadiyt/ssrf_filter) by [Arkadiy Tetelman](https://twitter.com/arkadiyt)

This gem is not vulnerable, because it checks if the value returned is empty.

```
# File lib/ssrf_filter/ssrf_filter.rb, line 116
raise UnresolvedHostname, "Could not resolve hostname '#{hostname}'" if ip_addresses.empty?

```
```
irb(main):001:0> require 'ssrf_filter'
=> true
irb(main):002:0> SsrfFilter.get("http://127.1/")
SsrfFilter::UnresolvedHostname: Could not resolve hostname '127.1'
  from /var/lib/gems/2.3.0/gems/ssrf_filter-1.0.2/lib/ssrf_filter/ssrf_filter.rb:116:in `block (3 levels) in <class:SsrfFilter>'
  from /var/lib/gems/2.3.0/gems/ssrf_filter-1.0.2/lib/ssrf_filter/ssrf_filter.rb:107:in `times'
  from /var/lib/gems/2.3.0/gems/ssrf_filter-1.0.2/lib/ssrf_filter/ssrf_filter.rb:107:in `block (2 levels) in <class:SsrfFilter>'
  from (irb):2
  from /usr/bin/irb:11:in `<main>'

```
### [faraday-restrict-ip-addresses](https://rubygems.org/gems/faraday-restrict-ip-addresses/versions/0.1.1) by [Ben Lavender](https://github.com/bhuga)

This gem uses `Addrinfo.getaddrinfo` as recommended by the Ruby Code dev team.

```
# File lib/faraday/restrict_ip_addresses.rb, line 61
def addresses(hostname)
      Addrinfo.getaddrinfo(hostname, nil, :UNSPEC, :STREAM).map { |a| IPAddr.new(a.ip_address) }
    rescue SocketError => e
      # In case of invalid hostname, return an empty list of addresses
      []
end

```
## Conclusion

The author would like to acknowledge the help provided by [Tom Hudson](https://twitter.com/TomNomNom) and [Yasin Soliman](https://twitter.com/SecurityYasin) during the discovery of the bug.

Both [John Downey](https://twitter.com/jtdowney) and [Arkadiy Tetelman](https://twitter.com/arkadiyt) were extremely responsive. John Downey was able to immediately provide a patch, and Arkadiy Tetelman helped me figure out why their gem was not affected by the issue.

Finally, whatever you do, please do not view the source code of this write-up.

---

Update (Friday, 10 November 2017): I expanded the “Root cause” section in order to better explain the actual issue.

[Ruby](https://edoverflow.com/tags/ruby)
[bug bounty](https://edoverflow.com/tags/bug-bounty)
[Buy me a coffee ☕](https://www.buymeacoffee.com/edoverflow)[←Operation FGTNY 🗽 - Solving the H1-212 CTF](https://edoverflow.com/2017/h1-212-ctf/)
[A lightweight reconnaissance setup for bug bounty hunters→](https://edoverflow.com/2017/lightweight-reconnaissance-setup/)

© 2023 [EdOverflow](https://edoverflow.com/)

[RSS](/index.xml)

[Privacy](/privacy/)

[Disclaimer](/disclaimer/)

![](https://queue.simpleanalyticscdn.com/noscript.gif)

=== Content from github.com_3a90fbde_20250124_154739.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjtdowney%2Fprivate_address_check%2Fissues%2F1)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjtdowney%2Fprivate_address_check%2Fissues%2F1)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=jtdowney%2Fprivate_address_check)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[jtdowney](/jtdowney)
/
**[private\_address\_check](/jtdowney/private_address_check)**
Public

* [Notifications](/login?return_to=%2Fjtdowney%2Fprivate_address_check) You must be signed in to change notification settings
* [Fork
  12](/login?return_to=%2Fjtdowney%2Fprivate_address_check)
* [Star
   42](/login?return_to=%2Fjtdowney%2Fprivate_address_check)

* [Code](/jtdowney/private_address_check)
* [Issues
  0](/jtdowney/private_address_check/issues)
* [Pull requests
  1](/jtdowney/private_address_check/pulls)
* [Actions](/jtdowney/private_address_check/actions)
* [Projects
  0](/jtdowney/private_address_check/projects)
* [Security](/jtdowney/private_address_check/security)
* [Insights](/jtdowney/private_address_check/pulse)

Additional navigation options

* [Code](/jtdowney/private_address_check)
* [Issues](/jtdowney/private_address_check/issues)
* [Pull requests](/jtdowney/private_address_check/pulls)
* [Actions](/jtdowney/private_address_check/actions)
* [Projects](/jtdowney/private_address_check/projects)
* [Security](/jtdowney/private_address_check/security)
* [Insights](/jtdowney/private_address_check/pulse)

# Resolv::getaddresses bug allows one to bypass your SSRF filter. #1

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[Resolv::getaddresses bug allows one to bypass your SSRF filter.](#top)#1Copy link[![@EdOverflow](https://avatars.githubusercontent.com/u/18099289?u=e14beb1f7aefcbc53d3aa33d4b554caf64ab94b1&v=4&size=80)](/EdOverflow)
## Description

[![@EdOverflow](https://avatars.githubusercontent.com/u/18099289?u=e14beb1f7aefcbc53d3aa33d4b554caf64ab94b1&v=4&size=48)](/EdOverflow)[EdOverflow](https://github.com/EdOverflow)opened [on Nov 7, 2017](https://github.com/jtdowney/private_address_check/issues/1#issue-271788653)
# Description

`Resolv::getaddresses` is OS-dependent, therefore by playing around with different IP formats one can return blank values. This bug can be abused to bypass your exclusion list.

| 💻 Machine 1 | 💻 Machine 2 |
| --- | --- |
| ruby 2.3.3p222 (2016-11-21) [x86\_64-linux-gnu] | ruby 2.3.1p112 (2016-04-26) [x86\_64-linux-gnu] |

💻 Machine 1

```
irb(main):002:0> Resolv.getaddresses("127.0.0.1")
=> ["127.0.0.1"]
irb(main):003:0> Resolv.getaddresses("localhost")
=> ["127.0.0.1"]
irb(main):004:0> Resolv.getaddresses("127.000.000.1")
=> ["127.0.0.1"]

```

💻 Machine 2

```
irb(main):008:0> Resolv.getaddresses("127.0.0.1")
=> ["127.0.0.1"]
irb(main):009:0> Resolv.getaddresses("localhost")
=> ["127.0.0.1"]
irb(main):010:0> Resolv.getaddresses("127.000.000.1")
=> []

```
# Proof of concept

```
irb(main):001:0> require 'private_address_check'
=> true
irb(main):002:0> PrivateAddressCheck.resolves_to_private_address?("127.1")
=> false # Bypass

```
# Mitigation

I suggest staying away from `Resolv::getaddresses` altogether and using the `Socket` class.

```
irb(main):002:0> Resolv.getaddresses("127.1")
=> []
irb(main):003:0> Socket.getaddrinfo("127.1", nil).sample[3]
=> "127.0.0.1"

```
👍1👎1😄1🎉2😕1❤️1
## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


