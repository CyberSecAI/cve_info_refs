```
{
  "cve": "CVE-2017-0904",
  "description": "The Ruby Resolv library can return an empty array from getaddresses for some atypical IP address encodings. This can be abused to bypass exclusion lists often used to protect against SSRF.",
  "vulnerability": {
    "root_cause": "The `Resolv::getaddresses` function in the Ruby standard library is OS-dependent and performs a reverse DNS lookup. When provided with certain malformed IP address formats, such as '127.1' or '127.000.001', it can fail to resolve the address and return an empty array instead of the IP address. This occurs because the underlying OS resolver fails to find a corresponding PTR record (reverse DNS lookup fails) for these malformed IP address formats.",
    "weaknesses": [
      "The `Resolv::getaddresses` function relies on OS-level DNS resolution which may behave inconsistently across different operating systems.",
      "The function doesn't properly handle malformed IP address representations, leading to unexpected empty results rather than a consistent resolution or an error.",
      "Inconsistent behavior with malformed IPs: some Ruby versions/OS combinations resolve '127.0.0.1', '127.000.000.1' etc. correctly, while others return an empty array."
    ],
    "impact": "An attacker can bypass Server-Side Request Forgery (SSRF) filters that rely on `Resolv::getaddresses` to validate or sanitize hostnames. By providing a malformed IP address, the function returns an empty array, which is not recognized as a private or restricted address, effectively bypassing the filter. This allows the attacker to access internal network resources or perform other unauthorized actions.",
    "attack_vectors": [
      "The attacker provides a malformed IP address (e.g., '127.1', '0x7f.1', '127.000.001') as input to an application that uses `Resolv::getaddresses` for address validation.",
       "The attacker manipulates the hostname/address parameter in a request to exploit the vulnerability."
    ],
    "required_capabilities": [
      "The attacker needs to be able to control the hostname/address parameter passed to an application that uses the vulnerable `Resolv::getaddresses` function for SSRF protection."
    ]
  },
  "affected_systems": [
    "Applications using the vulnerable `Resolv::getaddresses` function in Ruby versions < 2.4.3p201 (and potentially later versions depending on OS).",
    "Specifically, GitLab Community Edition and Enterprise Edition, and the private_address_check gem were identified as vulnerable."
  ],
    "references": [
    "https://cve.mitre.org/cgi-bin/cvename.cgi?name=2017-0904",
    "https://edoverflow.com/2017/bypassing-server-side-request-forgery-filters-by-abusing-a-bug-in-rubys-native-resolver/",
    "https://github.com/jtdowney/private_address_check/commit/58a0d7fe31de339c0117160567a5b33ad82b46af",
     "https://github.com/jtdowney/private_address_check/issues/1"
  ]
}
```