=== Content from blog.torproject.org_82d123d3_20250125_200852.html ===

[![Tor Blog](../static/images/logo.png)](../)

* [About](https://www.torproject.org/about/history/)
* [Support](https://support.torproject.org/)
* [Community](https://community.torproject.org/)
* [Forum](https://forum.torproject.org/)
* [Donate](https://donate.torproject.org/)

# Tor 0.3.0.9 is released (with security update for clients)

by nickm | June 29, 2017

![](../static/images/lead.png)

Source code for a new Tor release (0.3.0.9) is now available on the website.

Tor 0.3.0.9 fixes a path selection bug that would allow a client to use a guard that was in the same network family as a chosen exit relay. This is a security regression; all clients running earlier versions of 0.3.0.x or 0.3.1.x should upgrade to 0.3.0.9 or 0.3.1.4-alpha when packages become available. Â Packages should be available soon, along with a Tor Browser release early next week.Â

One last reminder: Tor 0.2.4, 0.2.6, and 0.2.7 will no longer be supported after 1 August of this year.Â  Tor 0.2.8 will not be supported after 1 Jan of 2018.Â  Tor 0.2.5 will not be supported after 1 May of 2018.Â  If you need a release with long-term support, 0.2.9 is

what we recommend: we plan to support it until at least 1 Jan 2020.

This release also backports several other bugfixes from the 0.3.1.x series.

## Changes in version 0.3.0.9 - 2017-06-29

* Major bugfixes (path selection, security, backport from 0.3.1.4-alpha): Â  Â
  + When choosing which guard to use for a circuit, avoid the exit's family along with the exit itself. Previously, the new guard selection logic avoided the exit, but did not consider its family. Fixes bug [22753](https://bugs.torproject.org/22753); bugfix on 0.3.0.1-alpha. Tracked as TROVE-2016- 006 and CVE-2017-0377. Â
* Major bugfixes (entry guards, backport from 0.3.1.1-alpha): Â
  + Don't block bootstrapping when a primary bridge is offline and we can't get its descriptor. Fixes bug [22325](https://bugs.torproject.org/22325); fixes one case of bug [21969](https://bugs.torproject.org/21969); bugfix on 0.3.0.3-alpha. Â

Â

* Major bugfixes (entry guards, backport from 0.3.1.4-alpha): Â  Â
  + When starting with an old consensus, do not add new entry guards unless the consensus is "reasonably live" (under 1 day old). Fixes one root cause of bug [22400](https://bugs.torproject.org/22400); bugfix on 0.3.0.1-alpha. Â
* Minor features (geoip): Â  Â
  + Update geoip and geoip6 to the June 8 2017 Maxmind GeoLite2 Country database. Â
* Minor bugfixes (voting consistency, backport from 0.3.1.1-alpha): Â  Â
  + Reject version numbers with non-numeric prefixes (such as +, -, or whitespace). Disallowing whitespace prevents differential version parsing between POSIX-based and Windows platforms. Fixes bug [21507](https://bugs.torproject.org/21507) and part of 21508; bugfix on 0.0.8pre1. Â
* Minor bugfixes (linux seccomp2 sandbox, backport from 0.3.1.4-alpha): Â  Â
  + Permit the fchmod system call, to avoid crashing on startup when starting with the seccomp2 sandbox and an unexpected set of permissions on the data directory or its contents. Fixes bug [22516](https://bugs.torproject.org/22516); bugfix on 0.2.5.4-alpha. Â
* Minor bugfixes (defensive programming, backport from 0.3.1.4-alpha): Â
  + Fix a memset() off the end of an array when packing cells. This bug should be harmless in practice, since the corrupted bytes are still in the same structure, and are always padding bytes, ignored, or immediately overwritten, depending on compiler behavior. Nevertheless, because the memset()'s purpose is to make sure that any other cell-handling bugs can't expose bytes to the network, we need to fix it. Fixes bug [22737](https://bugs.torproject.org/22737); bugfix on 0.2.4.11-alpha. Fixes CID 1401591. Â

* [releases](../category/releases)

## Comments

Please note that the comment area below has been archived.

hunter2 (not verified) said:

June 29, 2017

[Permalink](#comment-269510)

### [I would like some type ofâ¦](#comment-269510)

I would like some type of update process for which you may have the latest version of TBB, but a new version of Tor is released and you could choose to update Tor to the latest version within the current version of TBB, so you wouldn't have to wait X days or weeks in order to update to the latest version of TBB which has the latest version of Tor!

smalling (not verified) said:

June 30, 2017

In reply to [I would like some type ofâ¦](#comment-269510) by hunter2 (not verified)

[Permalink](#comment-269528)

### [Just my 2 Lithuanian cents:â¦](#comment-269528)

Just my 2 Lithuanian cents: If there's a version of Tor that has a serious bug for clients, they'll probably deploy a new release of the Tor Browser with the fix. But most of the time you don't need to always have a version more recent that the one that is bundled with your Tor Browser, so I don't think it would be worth the effort *IMO*.

< < sl0b > > (not verified) said:

June 30, 2017

In reply to [Just my 2 Lithuanian cents:â¦](#comment-269528) by smalling (not verified)

[Permalink](#comment-269539)

### [And IMO, I disagree. I findâ¦](#comment-269539)

And IMO, I disagree. I find OP's proposal useful.

bluesmaster61 (not verified) said:

July 01, 2017

In reply to [And IMO, I disagree. I findâ¦](#comment-269539) by < < sl0b > > (not verified)

[Permalink](#comment-269550)

### [A version release for one orâ¦](#comment-269550)

A version release for one or more cosmetic or otherwise non-catastrophic bugs, is a violation of good SW process, as well as a waste of time and resources, including that of the user. Therefore zaps can be made available to the community for minor stuff, and releases reserved for level I and II faults, or when there have been enough zaps to warrant a major version push. It is, one may say, the unwritten rule of SW development, and just good sense.

luv

BUG or attack â¦ (not verified) said:

June 29, 2017

[Permalink](#comment-269511)

### [BUG or attack on TOR networkâ¦](#comment-269511)

Since version 7.0 entry node (IP/Server) & country never changes! This behavior is still present in 7.0.1. All entry nodes are now only from US, UK, France, Netherlands & occasionally Germany. Previously (in 6.x and older) entry nodes from vastly more countries were used.

Description below (tested with a clean TOR Browser install):

A-TOR Browser

1-Entry NODE (eN)

2-Middle NODE (mN)

3-Exit NODE (xN)

B-Internet

Old behavior (6.x or older) New behavior (7.x)

New eN from a different country Same eN IP & from the same country

----------------------------------- -----------------------------------

New Identity

Restart Tor Browser

Close Tor browser, then start another session

New Tor Circuit does change the mN & xN in 7.x, just as it did in older versions.

The only way to change the eN IP/Server and geographic location/country is to do the following:

1- exit Tor Browser

2- navigate to folder TorBrowser/Data/Tor

3- delete all the cached-\* & control\_auth\_cookie

4- start Tor Browser

After this the eN IP/Server changes to one from only a handful of five different countries (as listed above). But then again the eN IP will always be stuck no matter what is done, that is until I follow the four steps above & delete all the cached files.

Please fix this. I liked the old behavior (also seems more secure to me), where clicking New Identity or restarting the Tor Browser also changed the eN.

yawning

yawning said:

June 30, 2017

In reply to [BUG or attack on TOR networkâ¦](#comment-269511) by BUG or attack â¦ (not verified)

[Permalink](#comment-269525)

### [> Since version 7.0 entryâ¦](#comment-269525)

> Since version 7.0 entry node (IP/Server) & country never changes!

Tor has used a Guard (fixed entry node) for years.

> Please fix this. I liked the old behavior (also seems more secure to me), where clicking New Identity or restarting the Tor Browser also changed the eN.

It's not more secure, and is quite a bit worse by a long margin. And the old behavior that you describe, would have been a massive anonymity bug if it existed in the first place.

smalling (not verified) said:

June 30, 2017

In reply to [BUG or attack on TOR networkâ¦](#comment-269511) by BUG or attack â¦ (not verified)

[Permalink](#comment-269527)

### [Please read the relevant FAQâ¦](#comment-269527)

Please read the relevant FAQ:

<https://www.torproject.org/docs/faq.html.en#EntryGuards>

Bug confirmed! (not verified) said:

June 30, 2017

In reply to [BUG or attack on TOR networkâ¦](#comment-269511) by BUG or attack â¦ (not verified)

[Permalink](#comment-269541)

### [> BUG or attackâ¦](#comment-269541)

**> BUG or attack**

Bug confirmed! Tor never generates a new circuit or chooses a entry node when *New Identity (Ctrl+Shift+U)* is selected or the browser itself is relaunched.

**> 3- delete all the cached-\* & control\_auth\_cookie**

Thank you Sir! Now I can at least change the entry node server/IP, but still confined to the same geographic region; all of the entry nodes I've gotten so far is in the UK.

I have been stuck with the same entry node the past few weeks and was quite worried that I have somehow messed up the settings. Glad to know it wasn't just me.

**> Tor has used a Guard (fixed entry node) for years.**

I am not (and I don't think the OP did either) disputing the fact that Tor uses the same entry node throughout a session, only that entry node never changes if *New Identity* is selected or if the browser itself is relaunched.

**> Please read the relevant FAQ:

> <https://www.torproject.org/docs/faq.html.en#EntryGuards>**

What does any of this have to do with *New Identity (Ctrl+Shift+U)* not generating a new circuit? All it does is change the middle and exit nodes, the same as *New Tor Circuit for this site (Ctrl+Shift+L)*?

If this is by design then why not get rid of the *New Identity (Ctrl+Shift+U)* menu option?

> It's not more secure, and is quite a bit worse by a long margin.

So changing the entry node every time Tor Browser starts or a session is started by clicking *New Identity (Ctrl+Shift+U)* is less secure?

Let's say 1.1.1.1 located in the UK, is my entry node. Now please explain how using this same server/IP as the entry node for a year or more is secure (as the entry node never changes)? Anyone able to trace you to this entry node (very easily done) will be able to collect a year worth of data passing through.

So now, how do I report this to a dev?

arma

arma said:

July 01, 2017

In reply to [> BUG or attackâ¦](#comment-269541) by Bug confirmed! (not verified)

[Permalink](#comment-269545)

### [> If this is by design thenâ¦](#comment-269545)

> If this is by design then why not get rid of the New Identity (Ctrl+Shift+U) menu option?

The New Identity button also discards the application-level browser stuff like cookies. It is essentially like restarting Tor Browser -- it flushes the browser state.

> Now please explain how using this same server/IP as the entry node for a year or more is secure

The very short version is at the FAQ entry people pointed you to:

<https://www.torproject.org/docs/faq#EntryGuards>

Here is the much longer version:

[https://blog.torproject.org/blog/improving-tors-anonymity-changing-guarâ¦](https://blog.torproject.org/blog/improving-tors-anonymity-changing-guard-parameters)

And in case that one doesn't convince you either, check out

<https://petsymposium.org/2014/papers/Dingledine.pdf>

buried alive (not verified) said:

June 30, 2017

[Permalink](#comment-269514)

### [Torsocks, Torify... â¦](#comment-269514)

Torsocks, Torify...

Would it be so difficult to include one or both of these in TBB releases?

I'd also like to know how to configure WGET for use in TBB, whereas in Tails it's already setup.

The Black Spot (not verified) said:

July 03, 2017

In reply to [Torsocks, Torify... â¦](#comment-269514) by buried alive (not verified)

[Permalink](#comment-269584)

### [Hell yeah that's what I wantâ¦](#comment-269584)

Hell yeah that's what I want to know, dawg. But are they tellin' ya? Naw.

arma

arma said:

July 03, 2017

In reply to [Torsocks, Torify... â¦](#comment-269514) by buried alive (not verified)

[Permalink](#comment-269605)

### [For putting torsocks intoâ¦](#comment-269605)

For putting torsocks into tor browser, I think it's probably better to leave it as a separate tool. That's the unix way, after all, and also most people installing Tor Browser aren't going to ever notice it, and also there are fine torsocks packages for many platforms.

As for setting up your wget to use a socks proxy on port 9150, that sounds like a fine topic for a tor.stackexchange.com question (after you've checked to see if there is one already).

I <3 to bite myself (not verified) said:

July 03, 2017

In reply to arma

[Permalink](#comment-269613)

### [Searching stack exchange forâ¦](#comment-269613)

Searching stack exchange for anything requires the completion of a CAPTCHA, which never loads, because I refuse to allow JavaScript and I tighten the settings. Thanks anyway.

Anonymous (not verified) said:

June 30, 2017

[Permalink](#comment-269522)

### [I fetched and upgraded torâ¦](#comment-269522)

I fetched and upgraded tor from Tor's repository (hidden service) on Debian 9, stretch:

deb tor+<http://sdscoq7snqtznauu.onion/torproject.org> stretch main

and it's still version 0.2.9.11-1~deb9u1. Why not 3.0.x series? Or which version to be on apt's repositories is decided by Debian (not Tor Project), and they decide to still stick to 0.2.9??

pastly

pastly said:

June 30, 2017

In reply to [I fetched and upgraded torâ¦](#comment-269522) by Anonymous (not verified)

[Permalink](#comment-269530)

### [0.2.9.X is the long-termâ¦](#comment-269530)

0.2.9.X is the long-term support series.

0.2.9.11 is a perfectly fine version to be using.

Anonymous (not verified) said:

July 02, 2017

In reply to pastly

[Permalink](#comment-269559)

### [Can we expect on update ofâ¦](#comment-269559)

Can we expect on update of the repository (to 0.3.x) soon or will it stick to 0.2.9.x forever?

Is there a way to install the latest stable version (0.3.0.9) with via package manager?

<https://www.torproject.org/docs/debian> only suggests 0.3.0.x-experimental, but I want 0.3.0.9 stable.

Anon (not verified) said:

June 30, 2017

In reply to [I fetched and upgraded torâ¦](#comment-269522) by Anonymous (not verified)

[Permalink](#comment-269540)

### [Download https://distâ¦](#comment-269540)

Download <https://dist.torproject.org/tor-0.3.0.9.tar.gz>

Extract the tar.gz

CD to the folder that you extracted the tar.gz to.

Use ./configure" command

Then use the "make" command

After that is finished use the "make install" command. And you now should have the latest version installed. You can get future versions from <https://dist.torproject.org> and you can also get the file signature there.

arma

arma said:

July 01, 2017

In reply to [Download https://distâ¦](#comment-269540) by Anon (not verified)

[Permalink](#comment-269544)

### [You get a bunch of greatâ¦](#comment-269544)

You get a bunch of great things from the deb package, like having it run as a separate user, having it drop its privileges properly, having logs plus log rotation, and having it set ulimit -n higher so if you configure it to be a relay it won't be broken.

If you want a Tor 0.3.0.x deb package, you can get it from:

<https://www.torproject.org/docs/debian>

Most people will be happier switching their deb repository, rather than doing the install manually from tarball.

Anonymous (not verified) said:

July 01, 2017

In reply to arma

[Permalink](#comment-269546)

### [Yep, exactly! Thank guys!â¦](#comment-269546)

Yep, exactly! Thank guys!

I can manually install the newest stable package (0.3.x) from the tarball if I want, can create the binary package (0.3.x\_amd64.deb, for example) too. But as a "regular user", I still prefer to fetch and install/upgrade from the repositories for pretty some reasons, like:

+) Save time (quite a few minutes -- in normal cases, maybe more in unexpected situations)

+) Newest version may required [newer] libraries (especially when the program is pretty large, like hundreds of MB or GB). Upgrading the dependencies, however, may cause problems for other programs which still require the older versions of the libraries.

+) I would trust the Debian/TorProject guys on which version of Tor is the best to used, by using the one from the repository, unless I have very clear and specific reasons to pick a newer version.

+) etc.

Anonymous (not verified) said:

July 02, 2017

In reply to [I fetched and upgraded torâ¦](#comment-269522) by Anonymous (not verified)

[Permalink](#comment-269567)

### [0.3.0.9 is finally availableâ¦](#comment-269567)

UPDATE: 0.3.0.9 is finally available on the repository!

Anonymous (not verified) said:

July 03, 2017

In reply to [0.3.0.9 is finally availableâ¦](#comment-269567) by Anonymous (not verified)

[Permalink](#comment-269574)

### [Checked:â¦](#comment-269574)

Checked:

ii tor 0.3.0.9-1~d90.stretch+1 amd64 anonymizing overlay network for TCP

Awesome! Thank guys!

Anonymous (not verified) said:

June 30, 2017

[Permalink](#comment-269535)

### [Sorry for the off topicâ¦](#comment-269535)

Sorry for the off topic. When should I expect confirmation/rejection about the internship (bridge bw scanner)?

PPA update! (not verified) said:

July 01, 2017

[Permalink](#comment-269556)

### [Please Ubuntu PPA update.](#comment-269556)

Please Ubuntu PPA update.

arma

arma said:

July 02, 2017

In reply to [Please Ubuntu PPA update.](#comment-269556) by PPA update! (not verified)

[Permalink](#comment-269570)

### [I don't know which Ubuntuâ¦](#comment-269570)

I don't know which Ubuntu PPA you mean, but I believe there are zero Ubuntu PPAs made by Tor people.

So if you want somebody to update their PPA, you should do something more direct than asking on here.

Anonymous (not verified) said:

July 01, 2017

[Permalink](#comment-269558)

### [https://www.mozilla.org/enâ¦](#comment-269558)

<https://www.mozilla.org/en-US/firefox/52.2.1/releasenotes/>

A new FFesr is released. TBB update is necessary?

Anonymous (not verified) said:

July 03, 2017

In reply to [https://www.mozilla.org/enâ¦](#comment-269558) by Anonymous (not verified)

[Permalink](#comment-269585)

### [That's what I want to knowâ¦](#comment-269585)

That's what I want to know. Will the latest and greatest version of FFesr be included in the next TBB release?

arma

arma said:

July 03, 2017

In reply to [https://www.mozilla.org/enâ¦](#comment-269558) by Anonymous (not verified)

[Permalink](#comment-269610)

### [Looks like it fixes oneâ¦](#comment-269610)

Looks like it fixes one issue, and it's not a security related issue?

I don't know what the Tor Browser folks are planning, but I wouldn't be surprised if the plan is to just wait until 52.3.

gk

gk said:

July 05, 2017

In reply to [https://www.mozilla.org/enâ¦](#comment-269558) by Anonymous (not verified)

[Permalink](#comment-269629)

### [No, there is no Tor Browserâ¦](#comment-269629)

No, there is no Tor Browser update necessary for this issue. It's not clear yet whether we are affected by this problem. If so, we'll think about picking this up if we do a 7.0.3 before the usual security fix update which is planned for the first week in August.

Anonymous (not verified) said:

July 02, 2017

[Permalink](#comment-269568)

### [What about Win32 expertâ¦](#comment-269568)

What about Win32 expert bundle? And it is possible, finally, to build Win64 version in 2017?

gk

gk said:

July 05, 2017

In reply to [What about Win32 expertâ¦](#comment-269568) by Anonymous (not verified)

[Permalink](#comment-269630)

### [The expert bundle should beâ¦](#comment-269630)

The expert bundle should be available now. And, yes, we plan to have a 64bit Windows version for our alpha series at least in 2017. That included the whole browser and the expert bundle. So, stay tuned.

Anonymous (not verified) said:

July 02, 2017

[Permalink](#comment-269569)

### [thanks for a prompt fix andâ¦](#comment-269569)

thanks for a prompt fix and another excellent release!

Anonymous (not verified) said:

July 03, 2017

[Permalink](#comment-269586)

### [Is TBB/Tor affected by this?â¦](#comment-269586)

Is TBB/Tor affected by this?

= 'Severe' Systemd Bug Allowed Remote Code Execution For Two Years

[https://it.slashdot.org/story/17/07/03/0343258/severe-systemd-bug-allowâ¦](https://it.slashdot.org/story/17/07/03/0343258/severe-systemd-bug-allowed-remote-code-execution-for-two-years)

arma

arma said:

July 03, 2017

In reply to [Is TBB/Tor affected by this?â¦](#comment-269586) by Anonymous (not verified)

[Permalink](#comment-269606)

### [Tor Browser has nothing toâ¦](#comment-269606)

Tor Browser has nothing to do with systemd, so, no.

Tor isn't either, except if you are running a vulnerable systemd, in which case it's still the vulnerable systemd that is the problem. :)

Stay up to date with your system packages.

$man which (not verified) said:

July 03, 2017

[Permalink](#comment-269587)

### [Why not include uBlockâ¦](#comment-269587)

Why not include uBlock Origin (<https://en.wikipedia.org/wiki/UBlock_Origin>) in TBB? Is it okay if I add it myself?

arma

arma said:

July 03, 2017

In reply to [Why not include uBlockâ¦](#comment-269587) by $man which (not verified)

[Permalink](#comment-269607)

### [First, asking this questionâ¦](#comment-269607)

First, asking this question in a blog post about Tor is likely to never reach most Tor Browser people.

I'd suggest asking it on tor.stackexchange.com, where the answer will last longer.

In fact, I bet somebody already has, and can point to the answer here?

Anonymous (not verified) said:

July 04, 2017

In reply to arma

[Permalink](#comment-269624)

### [In fact, I bet somebodyâ¦](#comment-269624)

> In fact, I bet somebody already has, and can point to the answer here?

Yes! **Simple "LT" answer:** Tor's design document explain this <https://www.torproject.org/projects/torbrowser/design/#philosophy> in the "5. No filters" section.

**More compilcated answer:** I should also mention that there's some disagreement between Tor people on this. See [ticket 17569](https://trac.torproject.org/projects/tor/ticket/17569) for more discussion. One of the Tor Browser developers Edelstein said: "FWIW, I also like this idea. I think it will help improve privacy, security, performance, and usability."

Tails includes uBlock by default.

My 0.02 satoshis on this is that I'd like to see uBlock by default on the Tor Browser, this will improve performance, and besides that, some of the arguments made: 1) Mike Perry said that one of the reasons he didn't want to ship an ad-blocker was that it would give more incentive for Google to block Tor, but Google certainly does not block the Brave Browser, despite it blocking Google trackers, and using Tor with Google is already a big trouble, indicating that not blocking ads wont change the situation, 2) advertising made on sites to Tor users DOES NOT make sense, I'm from country X and I get an advertisement for a local product (apartment, yoga, ...) that is found only in country Y, they're just wasting money right? 3) Just because Tor Browser already provides strong protection against tracking does not mean other things that block trackers should'nt be added, the situation in the latter case will be much better than in the former.

Anyway, those were just my irrelevant 0.02 satoshis, I still think that they're doing the right choice by sticking to the Tor philosophy of providing true privacy by design without requiring fundamentally and intrinsically imperfect ways such as tracker blocking.

Another thing that is worth considering is adding an addon that bundle common CDN resources, such as Jquery ... sure Tor Browser already protects against them, but there will be a performance improvement. But that's another thing.

the aliens areâ¦ (not verified) said:

July 03, 2017

[Permalink](#comment-269588)

### [Release ETA?](#comment-269588)

Release ETA?

arma

arma said:

July 03, 2017

In reply to [Release ETA?](#comment-269588) by the aliens areâ¦ (not verified)

[Permalink](#comment-269608)

### [If you mean an ETA for theâ¦](#comment-269608)

If you mean an ETA for the release of Tor 0.3.0.9, it was released when this blog post went up.

If you mean an ETA for a Tor Browser that includes this new Tor version, there is now one as of today (whew -- building Tor Browser is still way more effort than it ought to be).

Anonymous (not verified) said:

July 03, 2017

[Permalink](#comment-269592)

### [!!!WARNING!!! Tor Browserâ¦](#comment-269592)

!!!WARNING!!! Tor Browser and all VPN services seems blocked in Russia from today! !!!WARNING!!!

bb sweet anonymity.

Anonymous (not verified) said:

July 03, 2017

[Permalink](#comment-269603)

### [I'm using Tor (client only)â¦](#comment-269603)

I'm using Tor (client only) on Linux. According to man torrc, the options DisableAllSwap and Sandbox could enhance security of Tor, so they shouldn't harm security or anonymity in any way. Would you recommend me to enable them? Do these options have some drawbacks?

arma

arma said:

July 03, 2017

In reply to [I'm using Tor (client only)â¦](#comment-269603) by Anonymous (not verified)

[Permalink](#comment-269604)

### [Feel free to set them! Theâ¦](#comment-269604)

Feel free to set them! The Sandbox one might cause some surprise crashes, if Tor does something that the sandbox didn't expect (either accidentally, where a crash is bad, or maliciously, where a crash is good). The Sandbox feature is still experimental, so please experiment with it.

DisableAllSwap is probably also fine, except if you're running a relay and you don't have that much ram, in which case it will turn bad.

Let us know if you learn any lessons from trying them. :)

Anonymous (not verified) said:

July 04, 2017

In reply to arma

[Permalink](#comment-269617)

### [Which of two choices is moreâ¦](#comment-269617)

Which of two choices is more secure?

1. Using sandbox option in torrc

2. Creating restricted file structure in some directory and then running tor via command chroot pointing to this directory. Of course, chroot is called with option --userspec so after changing the root directory for tor process it drops privileges to a non-root user.

Anonymous (not verified) said:

July 05, 2017

In reply to [Which of two choices is moreâ¦](#comment-269617) by Anonymous (not verified)

[Permalink](#comment-269650)

### [My 2 cents:â¦](#comment-269650)

My 2 cents:

Actually, chroot was never intended to be security mechanism. It should be used to isolate non-malicious behavior, so you'll not damage main file system tree accidentally. It is in no way related to malicious behavior when application intentionally tries to get out of chroot. If you do have the last case, use either SELinux or virtual machines for forced isolation.

Anonymous (not verified) said:

July 04, 2017

In reply to arma

[Permalink](#comment-269619)

### [Thank you, Roger! I'll tryâ¦](#comment-269619)

Thank you, Roger! I'll try these options.

*The Sandbox one might cause some surprise crashes*

The idea of crashes sounds suspicious. It wouldn't be good if core dump with all keys, chains, circuits and the list of visited sites is dumped somewhere on my hard drive, so it can be later found by forensic analysis...

*DisableAllSwap is probably also fine, except if you're running a relay and you don't have that much ram, in which case it will turn bad.*

I don't use swap on my hard drive anyway, so it shouldn't be a problem.

yawning

yawning said:

July 04, 2017

In reply to [Thank you, Roger! I'll tryâ¦](#comment-269619) by Anonymous (not verified)

[Permalink](#comment-269626)

### [> The idea of crashes soundsâ¦](#comment-269626)

> The idea of crashes sounds suspicious.

What safe behavior is there, if the daemon is in a state where it is attempting system calls (or file system access) that aren't whitelisted. To be pedantic, the behavior in most cases is that the kernel will `SIGSYS` the daemon, with `SIGKILL` used in some cases.

> It wouldn't be good if core dump with all keys, chains, circuits and the list of visited sites is dumped somewhere on my hard drive, so it can be later found by forensic analysis...

Unless you configure it otherwise, the daemon does this: `prctl(PR\_SET\_DUMPABLE, 0);`

DisableAllSwap just calls mlockall(). It's totally pointless if you don't have a swap partition.

Anonymous (not verified) said:

July 05, 2017

In reply to yawning

[Permalink](#comment-269651)

### [I don't know internals soâ¦](#comment-269651)

I don't know Linux internals so well. I'm using standard Debian jessie, and I never change preferences related to creation of core dumps. Am I right that core dumps in Debian are now disabled by default? At least, I never see core files on my system.

Anonymous (not verified) said:

July 04, 2017

In reply to arma

[Permalink](#comment-269622)

### [Let us know if you learn anyâ¦](#comment-269622)

*Let us know if you learn any lessons from trying them. :)*

OK, my comment will be too minor, but still...

I don't map my real IP to my hostname, because... no any program on my PC needs it. It is configured as follows:

```

1. # hostname<br />
2. MYHOSTNAME<br />
3. # cat /etc/hosts<br />
4. 127.0.0.1       localhost<br />
5. 127.0.1.1       MYHOSTNAME<br />
6. # cat /etc/hostname<br />
7. MYHOSTNAME

```

So, somehow MYHOSTNAME cannot be resolved, because 127.0.1.1 is not the IP on any of my network interfaces. Actually, man hostname tells that

```

1. -i, --ip-address<br />
2. Display the network address(es) of the host name.<br />
3. Note that this works *only if the host  name can  be resolved.*<br />
4. Avoid using this option; use hostname --all-ip-addresses instead.

```

So, the situation when "the host name cannot be resolved" is treated as normal. Since Tor doesn't rely on any DNS system or hostnames, I expect that it doesn't need to mess up with my personal useless hostname. However, if sandbox is enabled, this error is printed:

```

1. Jul 04 13:32:19.000 [notice] Tor 0.3.0.9 (git-xxxxxxxxxxxxxxxx) opening [log](http://www.php.net/log) [file](http://www.php.net/file).<br />
2. Jul 04 13:32:19.000 [notice] Parsing GEOIP IPv4 [file](http://www.php.net/file) /usr/share/tor/geoip.<br />
3. Jul 04 13:32:19.000 [notice] Parsing GEOIP IPv6 [file](http://www.php.net/file) /usr/share/tor/geoip6.<br />
4. Jul 04 13:32:20.000 [notice] Bootstrapped 0%: Starting<br />
5. Jul 04 13:32:21.000 [notice] Starting with guard context "default"<br />
6. Jul 04 13:32:21.000 [notice] Bootstrapped 80%: Connecting to the Tor network<br />
7. Jul 04 13:32:21.000 [notice] Opening Control listener on /var/run/tor/control<br />
8. Jul 04 13:32:21.000 [notice] Bootstrapped 85%: Finishing handshake with first hop<br />
9. Jul 04 13:32:22.000 [notice] Bootstrapped 90%: Establishing a Tor circuit<br />
10. Jul 04 13:32:22.000 [notice] Tor has successfully opened a circuit. Looks like client functionality is working.<br />
11. Jul 04 13:32:22.000 [notice] Bootstrapped 100%: Done<br />
12. Jul 04 13:34:20.000 [notice] New control connection opened.<br />
13. Jul 04 13:34:21.000 [err] sandbox_getaddrinfo(): Bug: (Sandbox) failed to get address MYHOSTNAME! (on Tor 0.3.0.9)

```

Still, Tor works fine with this err. To avoid it I fixed my /etc/hosts to be

`127.0.0.1 localhost MYHOSTNAME`

which I think is also fine solution. Nevertheless, I cannot see why sandbox\_getaddrinfo needs to be called by Tor.

Anonymous (not verified) said:

July 04, 2017

In reply to arma

[Permalink](#comment-269623)

### [Sorry, let me add this to myâ¦](#comment-269623)

Sorry, let me add this to my previous two comments.

The error with gethost address is observed **only** when I start tor-arm (immediately when tor-arm is started, with root permissions). NEWNYM command on ControlPort doesn't force Tor to produce this err. I mean, if tor-arm is not used, I cannot observe this tor log error (independently of the content of /etc/hosts and hostname).

If tor-arm is launched, the error in tor log is observed in all cases, including the case of original configuration (when hostname is resolved to fake 127.0.1.1) and full fix case (when hostname is mapped to my real IP in /etc/hosts). I don't know what tor-arm tweaks in tor process to force him to give this error...

HI EVERYBODY (not verified) said:

July 03, 2017

[Permalink](#comment-269612)

### [One question, i have windowsâ¦](#comment-269612)

One question, i have windows 64 bits, and always i had torborwser in 64bits, then since torbrowser 7 and 7.2 7.3

i have torbrowser 32bits, and i have afraid this is only with me,, then i ask. why not is verion 64bits???

gk

gk said:

July 05, 2017

In reply to [One question, i have windowsâ¦](#comment-269612) by HI EVERYBODY (not verified)

[Permalink](#comment-269631)

### [Tor Browser has never been aâ¦](#comment-269631)

Tor Browser has never been a 64bit application so far for Windows users. But we plan to provide it later this year in our alpha series. If everything works out as we hope it'll be available for stable users, too. Maybe already with Tor Browser 7.5 but latest with the switch to Tor Browser 8.

noEnglish (not verified) said:

July 04, 2017

[Permalink](#comment-269614)

### [I found a bugâ¦](#comment-269614)

I found a bug

Option -> Privcay Tab -> Always use private browsing mode -> Keep until -> I close Tor Browser

Crash error

gk

gk said:

July 05, 2017

In reply to [I found a bugâ¦](#comment-269614) by noEnglish (not verified)

[Permalink](#comment-269632)

### [Does this happen with a newâ¦](#comment-269632)

Does this happen with a new clean Tor Browser 7.0.2? On which operating system?

AnnA (not verified) said:

July 04, 2017

[Permalink](#comment-269615)

### [Mac : happen for few monthsâ¦](#comment-269615)

Mac : For some 2-3 months Mac doesn't accept soft loaded from the net. One have to go through App Store, if it exists (Tor does not...), at costs...

gk

gk said:

July 05, 2017

In reply to [Mac : happen for few monthsâ¦](#comment-269615) by AnnA (not verified)

[Permalink](#comment-269634)

### [That should be no problem asâ¦](#comment-269634)

That should be no problem as Tor Browser is signed. Does Tor Browser 7.0.2 not work for you? If so, what error message do you get and what OS X version are you on?

Brandy (not verified) said:

July 04, 2017

[Permalink](#comment-269621)

### [how do u set up bitcoin coreâ¦](#comment-269621)

how do u set up bitcoin core to use tor?? before there was vidalia control panel but now the whole tor browser opens up... how u open tor without the torbrowser?? pls hlp

Anonymous (not verified) said:

July 05, 2017

In reply to [how do u set up bitcoin coreâ¦](#comment-269621) by Brandy (not verified)

[Permalink](#comment-269663)

### [Seems like the type ofâ¦](#comment-269663)

Seems like the type of questions that can be answered in: <https://tor.stackexchange.com>

Anonymous (not verified) said:

July 04, 2017

[Permalink](#comment-269625)

### [Sometimes I see concurrentâ¦](#comment-269625)

Sometimes I see concurrent simultaneous connections from my own IP to the same Guard node. So,

`# netstat -apn | grep MY_IP`

shows up to 4 different connections (they use different src ports and the same dst port) between my IP and my Guard node. Why tor needs to separate these TCP connections? Why one TCP connection between my IP and my Guard is not enough?

onthenet (not verified) said:

July 04, 2017

[Permalink](#comment-269627)

### [A littlebit offtopic:â¦](#comment-269627)

A littlebit offtopic:

<https://robtex.com>

is not working without javascript. That is new.

Is this a TBB-problem or a new ...feature from robtex.com?

gk

gk said:

July 05, 2017

In reply to [A littlebit offtopic:â¦](#comment-269627) by onthenet (not verified)

[Permalink](#comment-269633)

### [For what it is worth: Weâ¦](#comment-269633)

For what it is worth: We have blog posts specifically for Tor Browser releases. I guess your issue would fit in one of those pretty well. Just for the next time. :) To answer your question: I am not sure yet. Could you give me some steps to reproduce your problem? "not working without javascript" can mean many things...

Anonymous (not verified) said:

July 05, 2017

In reply to gk

[Permalink](#comment-269674)

### [""not working withoutâ¦](#comment-269674)

""not working without javascript" can mean many things..."

Before, you can use the search form field on robtex without javascript on in TBB.

Now, without javascript the site is not able to work.

Before, you can choose between the old -good(-:- "answer" or the new

teeming design. Now you get nothing without javascript)-:.

Anonymous (not verified) said:

July 05, 2017

[Permalink](#comment-269636)

### [It sounds like Tor has beenâ¦](#comment-269636)

It sounds like Tor faces the most serious problems in China. I'm wondering how Tor (Tor Browser) is working in China now: is it able to pass the Great Firewall, are Chinese able to use Tor and how difficult it is for them to use Tor from china, how effective does the Chinese Gov get in blocking Tor now (in comparison with in the past)??

(I post the questions here since the Tor Browser 7.0.2 post isn't allowed comments).

pastly

pastly said:

July 05, 2017

In reply to [It sounds like Tor has beenâ¦](#comment-269636) by Anonymous (not verified)

[Permalink](#comment-269640)

### [As I said on your otherâ¦](#comment-269640)

As I said on your other comment, people in China should be able to use meek bridges.

Anonymous (not verified) said:

July 05, 2017

In reply to pastly

[Permalink](#comment-269644)

### [Thank you, pastly!â¦](#comment-269644)

Thank you, pastly!

I thought the 7.0.2 release post doesn't allow comments :)

Anonymous (not verified) said:

July 05, 2017

[Permalink](#comment-269654)

### [Could I restrict list of myâ¦](#comment-269654)

Could I restrict list of my Guard nodes by 1) excluding some countries or by 2) specifying the country I want to choose Guard from? I don't like the idea that most of Tor nodes are now located in Germany. It means that if your Guard is also in Germany, then very often all 3 nodes in the chain are from Germany. It sounds not good...

I know that there was discussion in tor project about path selection, like should different nodes correspond to different AS or not, and so on... But now, AFAIK, only nodes within 0.0.0.0/16 are excluded.

Another point is that Guard should be more trusted node than the others. I know that state adversary can use any hosting providers in the whole globe independently from its own country, but his abilities to monitor and analyze traffic are less restricted in its own country. E.g., in the case of NSA I wouldn't like the idea that my Guard is hosted in US. Moreover, in general, I don't think that it is good idea to choose Guard from your own country. As I understand, path selection should force adversary to make so many international collaborations between countries, that it makes the harm to anonymity mostly impractical.

Maybe I'm totally wrong, and my interaction with Guard selection cannot make things better.

pastly

pastly said:

July 05, 2017

In reply to [Could I restrict list of myâ¦](#comment-269654) by Anonymous (not verified)

[Permalink](#comment-269660)

### [Yes you can restrict yourâ¦](#comment-269660)

Yes you can restrict your node selection.

A couple more reasons why you may not want to:

- geoip isn't necessarily accurate

- your node selection patterns may stand out to a big adversary

Anonymous (not verified) said:

July 06, 2017

In reply to pastly

[Permalink](#comment-269730)

### [Yes you can restrict yourâ¦](#comment-269730)

*Yes you can restrict your node selection.*

I cannot see any simple way to restrict the choice of Guard nodes (except of manually specifying particular node I decide to choose). I don't want to use ExcludeNodes, because I'm OK with middleman nodes (and, probably, Exit nodes) from adversary countries.

Thirdtrytopost (not verified) said:

July 05, 2017

[Permalink](#comment-269681)

### [Tails 3.01 uses TOR 0.3.0.9â¦](#comment-269681)

Tails 3.01 uses TOR 0.3.0.9 but has a serious flaw. It leaks the http authentication to all web sites visited (a unique ID), so a user can easily be tracked.

Is this a flaw with Tails 3.01 or with TOR 0.3.0.9?

arma

arma said:

July 05, 2017

In reply to [Tails 3.01 uses TOR 0.3.0.9â¦](#comment-269681) by Thirdtrytopost (not verified)

[Permalink](#comment-269692)

### [Well, it's not an issue withâ¦](#comment-269692)

Well, it's not an issue with Tor, because Tor is just the underlying transport -- it does not understand or think about the bytes that it helps you send back and forth to websites.

So you should be looking at Tor Browser, which is also included in Tails.

But it sounds to me like you are misunderstanding something. http client auth is used at far fewer than "all" web sites, for starters.

Are you saying this because you actually found a bug? Or because you went to some "how safe am I" website and it told you to be scared of the phrase "http authentication"? If it's the former, please open a ticket at <https://bugs.torproject.org/>

joe (not verified) said:

July 16, 2017

[Permalink](#comment-269848)

### [hi i cant connect to torâ¦](#comment-269848)

hi i cant connect to tor network i did what Ive done many times before with installing the tor program.

it seems like its about to connect but doesn't. can any one help

gk

gk said:

July 17, 2017

In reply to [hi i cant connect to torâ¦](#comment-269848) by joe (not verified)

[Permalink](#comment-269858)

### [Which operating system areâ¦](#comment-269858)

Which operating system are you on? What is happening exactly? Do you get error messages?

Anonymous (not verified) said:

July 27, 2017

[Permalink](#comment-270038)

### [After upgrading from 0.2.9â¦](#comment-270038)

After upgrading from 0.2.9.xx to 0.3.0.xx (stable versions from torproject repo for debian) I noticed the following problem with tor client. If tor is not actively used during many hours, it fails to construct new circuits, but old circuits still can be used. I see from netstat that it has few new connections established, but getinfo circuits-status shows that no new circuits are constructed. Any application has connection timeout if I try to use it with tor. To fix the issue I have to restart my tor.

First time my "long live" old circuit was youtube. Next time it was XMPP connection. In both cases I had just one circuit. So, basically, I leave my tor running for night, but at morning it cannot make any new circuit. However, already established circuits continue to work. May it be some interference with ISP preferences? I don't know. But it looks like a tor problem, because according to netstat new connections are got established by tor.

## Recent Updates

## [New Alpha Release: Tor Browser 14.5a2](/new-alpha-release-tor-browser-145a2/)

by [ma1](/author/ma1) | January 14, 2025

Tor Browser 14.5a2 is now available from the Tor Browser download page and also from our distribution directory.

## [New Release: Tails 6.11](/new-release-tails-611/)

by [tails](/author/tails) | January 9, 2025

Tails 6.11 fixes several critical security vulnerabilities that were identified during an external audit.

## [New Release: Tor Browser 14.0.4](/new-release-tor-browser-1404/)

by [morgan](/author/morgan) | January 8, 2025

Tor Browser 14.0.4 is now available from the Tor Browser download page and also from our distribution directory.

### Download Tor Browser

Download Tor Browser to experience real private browsing without tracking, surveillance, or censorship.

[Download Tor Browser](https://www.torproject.org/download/)

### Subscribe to our Newsletter

Get monthly updates and opportunities from the Tor Project:

[Sign up](https://newsletter.torproject.org/)

####

####

####

####

####

####

####

Trademark, copyright notices, and rules for use by third parties can be found in our [FAQ](https://www.torproject.org/about/trademark/).



=== Content from github.com_097d964f_20250125_200854.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorproject%2Ftor%2Fcommit%2F665baf5ed5c6186d973c46cdea165c0548027350)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorproject%2Ftor%2Fcommit%2F665baf5ed5c6186d973c46cdea165c0548027350)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torproject%2Ftor)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torproject](/torproject)
/
**[tor](/torproject/tor)**
Public

* [Notifications](/login?return_to=%2Ftorproject%2Ftor) You must be signed in to change notification settings
* [Fork
  946](/login?return_to=%2Ftorproject%2Ftor)
* [Star
   4.5k](/login?return_to=%2Ftorproject%2Ftor)

* [Code](/torproject/tor)
* [Pull requests
  152](/torproject/tor/pulls)
* [Actions](/torproject/tor/actions)
* [Security](/torproject/tor/security)
* [Insights](/torproject/tor/pulse)

Additional navigation options

* [Code](/torproject/tor)
* [Pull requests](/torproject/tor/pulls)
* [Actions](/torproject/tor/actions)
* [Security](/torproject/tor/security)
* [Insights](/torproject/tor/pulse)

## Commit

[Permalink](/torproject/tor/commit/665baf5ed5c6186d973c46cdea165c0548027350)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Consider the exit family when applying guard restrictions.

[Browse files](/torproject/tor/tree/665baf5ed5c6186d973c46cdea165c0548027350)
Browse the repository at this point in the history

```
When the new path selection logic went into place, I accidentally
dropped the code that considered the _family_ of the exit node when
deciding if the guard was usable, and we didn't catch that during
code review.

This patch makes the guard_restriction_t code consider the exit
family as well, and adds some (hopefully redundant) checks for the
case where we lack a node_t for a guard but we have a bridge_info_t
for it.

Fixes bug 22753; bugfix on 0.3.0.1-alpha. Tracked as TROVE-2016-006
and [CVE-2017-0377](https://github.com/advisories/GHSA-vxgf-qp88-w686 "CVE-2017-0377").
```

* Loading branch information

[![@nmathewson](https://avatars.githubusercontent.com/u/162054?s=40&v=4)](/nmathewson)

[nmathewson](/torproject/tor/commits?author=nmathewson "View all commits by nmathewson")
committed
Jun 29, 2017

1 parent
[a242d19](/torproject/tor/commit/a242d194c74b318b8ee4b347efd09ed13d0d2549)

commit 665baf5

 Show file tree

 Hide file tree

Showing
**5 changed files**
with
**53 additions**
and
**6 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* changes

  + changes/bug22753
    [bug22753](#diff-2765f4ccd162b7bf6693061605a1e9a8241d99bf7888d63e6de2b5fa28dad99c)
* src/or

  + src/or/entrynodes.c
    [entrynodes.c](#diff-50040c2fc6fea3fbca00517cd1604a4c5775a8b7a818819646323d28fef70586)
  + src/or/entrynodes.h
    [entrynodes.h](#diff-1d0cdaae93ba49dae85f2bd6e4c5bd7d812ce934c426ad980c5c072cc7248708)
  + src/or/nodelist.c
    [nodelist.c](#diff-406e01ca1a87dedac9f07e73f1233a2fb06b1a645c740992caa5fc9bd99993da)
  + src/or/nodelist.h
    [nodelist.h](#diff-cdc6d057dfaa02c1d17c229dbe21967ccbaf5013e083c383b78f1c62fb363a4d)

## There are no files selected for viewing

7 changes: 7 additions & 0 deletions

7
[changes/bug22753](#diff-2765f4ccd162b7bf6693061605a1e9a8241d99bf7888d63e6de2b5fa28dad99c "changes/bug22753")

Show comments

[View file](/torproject/tor/blob/665baf5ed5c6186d973c46cdea165c0548027350/changes/bug22753)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,7 @@ |
|  |  | o Major bugfixes (path selection, security): |
|  |  | - When choosing which guard to use for a circuit, avoid the |
|  |  | exit's family along with the exit itself. Previously, the new |
|  |  | guard selection logic avoided the exit, but did not consider |
|  |  | its family. Fixes bug 22753; bugfix on 0.3.0.1-alpha. Tracked |
|  |  | as TROVE-2016-006 and CVE-2017-0377. |
|  |  |  |

39 changes: 38 additions & 1 deletion

39
[src/or/entrynodes.c](#diff-50040c2fc6fea3fbca00517cd1604a4c5775a8b7a818819646323d28fef70586 "src/or/entrynodes.c")

Show comments

[View file](/torproject/tor/blob/665baf5ed5c6186d973c46cdea165c0548027350/src/or/entrynodes.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1428,6 +1428,38 @@ entry\_guard\_passes\_filter(const or\_options\_t \*options, guard\_selection\_t \*gs, |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /\*\* Return true iff <b>guard</b> is in the same family as <b>node</b>. |
|  |  | \*/ |
|  |  | static int |
|  |  | guard\_in\_node\_family(const entry\_guard\_t \*guard, const node\_t \*node) |
|  |  | { |
|  |  | const node\_t \*guard\_node = node\_get\_by\_id(guard->identity); |
|  |  | if (guard\_node) { |
|  |  | return nodes\_in\_same\_family(guard\_node, node); |
|  |  | } else { |
|  |  | /\* If we don't have a node\_t for the guard node, we might have |
|  |  | \* a bridge\_info\_t for it. So let's check to see whether the bridge |
|  |  | \* address matches has any family issues. |
|  |  | \* |
|  |  | \* (Strictly speaking, I believe this check is unnecessary, since we only |
|  |  | \* use it to avoid the exit's family when building circuits, and we don't |
|  |  | \* build multihop circuits until we have a routerinfo\_t for the |
|  |  | \* bridge... at which point, we'll also have a node\_t for the |
|  |  | \* bridge. Nonetheless, it seems wise to include it, in case our |
|  |  | \* assumptions change down the road. -nickm.) |
|  |  | \*/ |
|  |  | if (get\_options()->EnforceDistinctSubnets && guard->bridge\_addr) { |
|  |  | tor\_addr\_t node\_addr; |
|  |  | node\_get\_addr(node, &node\_addr); |
|  |  | if (addrs\_in\_same\_network\_family(&node\_addr, |
|  |  | &guard->bridge\_addr->addr)) { |
|  |  | return 1; |
|  |  | } |
|  |  | } |
|  |  | return 0; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Return true iff <b>guard</b> obeys the restrictions defined in <b>rst</b>. |
|  |  | \* (If <b>rst</b> is NULL, there are no restrictions.) |
| Expand All | | @@ -1440,7 +1472,12 @@ entry\_guard\_obeys\_restriction(const entry\_guard\_t \*guard, |
|  |  | if (! rst) |
|  |  | return 1; // No restriction? No problem. |
|  |  |  |
|  |  | // Only one kind of restriction exists right now |
|  |  | // Only one kind of restriction exists right now: excluding an exit |
|  |  | // ID and all of its family. |
|  |  | const node\_t \*node = node\_get\_by\_id((const char\*)rst->exclude\_id); |
|  |  | if (node && guard\_in\_node\_family(guard, node)) |
|  |  | return 0; |
|  |  |  |
|  |  | return tor\_memneq(guard->identity, rst->exclude\_id, DIGEST\_LEN); |
|  |  | } |
|  |  |  |
| Expand Down | |  |

9 changes: 5 additions & 4 deletions

9
[src/or/entrynodes.h](#diff-1d0cdaae93ba49dae85f2bd6e4c5bd7d812ce934c426ad980c5c072cc7248708 "src/or/entrynodes.h")

Show comments

[View file](/torproject/tor/blob/665baf5ed5c6186d973c46cdea165c0548027350/src/or/entrynodes.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -276,16 +276,17 @@ struct entry\_guard\_handle\_t; |
|  |  | \* A restriction to remember which entry guards are off-limits for a given |
|  |  | \* circuit. |
|  |  | \* |
|  |  | \* Right now, we only use restrictions to block a single guard from being |
|  |  | \* selected; this mechanism is designed to be more extensible in the future, |
|  |  | \* however. |
|  |  | \* Right now, we only use restrictions to block a single guard and its family |
|  |  | \* from being selected; this mechanism is designed to be more extensible in |
|  |  | \* the future, however. |
|  |  | \* |
|  |  | \* Note: This mechanism is NOT for recording which guards are never to be |
|  |  | \* used: only which guards cannot be used on <em>one particular circuit</em>. |
|  |  | \*/ |
|  |  | struct entry\_guard\_restriction\_t { |
|  |  | /\*\* |
|  |  | \* The guard's RSA identity digest must not equal this. |
|  |  | \* The guard's RSA identity digest must not equal this; and it must not |
|  |  | \* be in the same family as any node with this digest. |
|  |  | \*/ |
|  |  | uint8\_t exclude\_id[DIGEST\_LEN]; |
|  |  | }; |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[src/or/nodelist.c](#diff-406e01ca1a87dedac9f07e73f1233a2fb06b1a645c740992caa5fc9bd99993da "src/or/nodelist.c")

Show comments

[View file](/torproject/tor/blob/665baf5ed5c6186d973c46cdea165c0548027350/src/or/nodelist.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1343,7 +1343,7 @@ nodelist\_refresh\_countries(void) |
|  |  |  |
|  |  | /\*\* Return true iff router1 and router2 have similar enough network addresses |
|  |  | \* that we should treat them as being in the same family \*/ |
|  |  | static inline int |
|  |  | int |
|  |  | addrs\_in\_same\_network\_family(const tor\_addr\_t \*a1, |
|  |  | const tor\_addr\_t \*a2) |
|  |  | { |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[src/or/nodelist.h](#diff-cdc6d057dfaa02c1d17c229dbe21967ccbaf5013e083c383b78f1c62fb363a4d "src/or/nodelist.h")

Show comments

[View file](/torproject/tor/blob/665baf5ed5c6186d973c46cdea165c0548027350/src/or/nodelist.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -94,6 +94,8 @@ int node\_is\_unreliable(const node\_t \*router, int need\_uptime, |
|  |  | int router\_exit\_policy\_all\_nodes\_reject(const tor\_addr\_t \*addr, uint16\_t port, |
|  |  | int need\_uptime); |
|  |  | void router\_set\_status(const char \*digest, int up); |
|  |  | int addrs\_in\_same\_network\_family(const tor\_addr\_t \*a1, |
|  |  | const tor\_addr\_t \*a2); |
|  |  |  |
|  |  | /\*\* router\_have\_minimum\_dir\_info tests to see if we have enough |
|  |  | \* descriptor information to create circuits. |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `665baf5`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorproject%2Ftor%2Fcommit%2F665baf5ed5c6186d973c46cdea165c0548027350) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from trac.torproject.org_0f790241_20250125_200903.html ===


[Skip to content](#content-body)
GitLab
[![](data:image/gif;base64...)](/ "Homepage")

* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)

This is an archived project. Repository and other project resources are read-only.

# Resolve TROVE-2017-006: Regression in guard family avoidance in 0.3.0 series

In 0.3.0, when I revised the guard selection code, I got the "don't use your exit as first-hop if even if it's your guard" logic right, but I accidentally omitted "don't use anything in the exit's family as a guard."

The impact here is that some circuits will still use a guard on the same circuit as an exit even when the two are in the same family.

(Putting this issue up on the tracker now because knowing about it does not (much) help an attacker exploit it.)

This is TROVE-2017-006 and CVE-2017-0377.

To upload designs, you'll need to enable LFS and have an admin enable hashed storage. [More information](/help/user/project/issues/design_management.md#prerequisites)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.



=== Content from avatars.githubusercontent.com_40b08201_20250126_113655.html ===
�PNG

   
IHDR  �  �   �.�b  �IDATx���Qm�0 E�u
�B(�@)�@
C�߾�i�[�s�IQn�m������ � v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�6{ /d?�����q�=���f$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$���7���8gO����Ϟ��x-��H>H|�$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$���]v�~���[�Uz>��r]�t�C���{@��2~c���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; a�=���9{�#nv@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� �1��
 ���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H�
  ��)�� �J!    IEND�B`�

=== Content from github.com_1fa6e4be_20250126_113655.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-vxgf-qp88-w686)

**CVE-2017-0377**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-vxgf-qp88-w686)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [Unreviewed](/advisories?query=type%3Aunreviewed)
3. [CVE-2017-0377](/advisories/GHSA-vxgf-qp88-w686)

## Tor 0.3.x before 0.3.0.9 has a guard-selection algorithm...

High severity

Unreviewed

Published
May 17, 2022
to the GitHub Advisory Database
•
Updated Jan 27, 2023

## Package

No package listed—
[Suggest a package](/advisories/GHSA-vxgf-qp88-w686/improve)

## Affected versions

Unknown

## Patched versions

Unknown

## Description

Tor 0.3.x before 0.3.0.9 has a guard-selection algorithm that only considers the exit relay (not the exit relay's family), which might allow remote attackers to defeat intended anonymity properties by leveraging the existence of large families.

### References

* <https://nvd.nist.gov/vuln/detail/CVE-2017-0377>
* [torproject/tor@665baf5](https://github.com/torproject/tor/commit/665baf5ed5c6186d973c46cdea165c0548027350)
* <https://blog.torproject.org/blog/tor-0309-released-security-update-clients>
* <https://blog.torproject.org/blog/tor-0314-alpha-released-security-update-clients>
* <https://security-tracker.debian.org/CVE-2017-0377>
* <https://trac.torproject.org/projects/tor/ticket/22753>

Published by the [National Vulnerability Database](https://nvd.nist.gov/vuln/detail/CVE-2017-0377)
Jul 2, 2017

Published to the GitHub Advisory Database
May 17, 2022

Last updated
Jan 27, 2023

### Severity

High

7.5

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
High

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N

### EPSS score

0.374%

# Exploit Prediction Scoring System (EPSS)

This score estimates the probability of this vulnerability being exploited within the next 30 days.
Data provided by [FIRST](https://www.first.org/epss/user-guide).

 (73rd percentile)

### Weaknesses

[CWE-200](/advisories?query=cwe%3A200)

### CVE ID

CVE-2017-0377

### GHSA ID

GHSA-vxgf-qp88-w686

### Source code

No known source code

Dependabot alerts are not supported on this advisory because it does not have a package from a supported ecosystem with an affected and fixed version.

[Learn more about GitHub language support](https://docs.github.com/get-started/learning-about-github/github-language-support#about-supported-languages)

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-vxgf-qp88-w686/improve).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from bugs.torproject.org_74fd3878_20250126_113657.html ===


[Skip to content](#content-body)
GitLab
[![](data:image/gif;base64...)](/ "Homepage")

* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)

This is an archived project. Repository and other project resources are read-only.

# Resolve TROVE-2017-006: Regression in guard family avoidance in 0.3.0 series

In 0.3.0, when I revised the guard selection code, I got the "don't use your exit as first-hop if even if it's your guard" logic right, but I accidentally omitted "don't use anything in the exit's family as a guard."

The impact here is that some circuits will still use a guard on the same circuit as an exit even when the two are in the same family.

(Putting this issue up on the tracker now because knowing about it does not (much) help an attacker exploit it.)

This is TROVE-2017-006 and CVE-2017-0377.

To upload designs, you'll need to enable LFS and have an admin enable hashed storage. [More information](/help/user/project/issues/design_management.md#prerequisites)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.



=== Content from blog.torproject.org_05b0e142_20250125_200853.html ===

[![Tor Blog](../static/images/logo.png)](../)

* [About](https://www.torproject.org/about/history/)
* [Support](https://support.torproject.org/)
* [Community](https://community.torproject.org/)
* [Forum](https://forum.torproject.org/)
* [Donate](https://donate.torproject.org/)

# Tor 0.3.1.4-alpha is released (with security update for clients)

by nickm | June 29, 2017

![](../static/images/lead.png)

Hello again! This post announces the fourth alpha in the 0.3.1.x series, which weÂ just released today. There's a stable release too; I'll mention that in the next post.

Tor 0.3.1.4-alpha fixes a path selection bug that would allow a client to use a guard that was in the same network family as a chosen exit relay. This is a security regression; all clients running earlier versions of 0.3.0.x or 0.3.1.x should upgrade to 0.3.0.9 or 0.3.1.4-alpha.

This release also fixes several other bugs introduced in 0.3.0.x and 0.3.1.x, including others that can affect bandwidth usage and correctness.

Since this is an alpha release, you can expect more bugs than usual. If you'd rather have a more stable experience, stick to the stable releases.

If you build Tor from source, you can find Tor 0.3.1.4-alpha at the usual place (at the Download page on our website). Otherwise, you'll probably want to wait until packages are available. There should be a new Tor Browser release early next week.

## Changes in version 0.3.1.4-alpha - 2017-06-29

* New dependencies:
  + To build with zstd and lzma support, Tor now requires the pkg-config tool at build time. (This requirement was new in 0.3.1.1-alpha, but was not noted at the time. Noting it here to close ticket [22623](https://bugs.torproject.org/22623).)
* Major bugfixes (path selection, security):
  + When choosing which guard to use for a circuit, avoid the exit's family along with the exit itself. Previously, the new guard selection logic avoided the exit, but did not consider its family. Fixes bug [22753](https://bugs.torproject.org/22753); bugfix on 0.3.0.1-alpha. Tracked as TROVE-2016- 006 and CVE-2017-0377.

Â

* Major bugfixes (compression, zstd):
  + Correctly detect a full buffer when decompressing a large zstd- compressed input. Previously, we would sometimes treat a full buffer as an error. Fixes bug [22628](https://bugs.torproject.org/22628); bugfix on 0.3.1.1-alpha.
* Major bugfixes (directory protocol):
  + Ensure that we send "304 Not modified" as HTTP status code when a client is attempting to fetch a consensus or consensus diff, and the best one we can send them is one they already have. Fixes bug [22702](https://bugs.torproject.org/22702); bugfix on 0.3.1.1-alpha.
* Major bugfixes (entry guards):
  + When starting with an old consensus, do not add new entry guards unless the consensus is "reasonably live" (under 1 day old). Fixes one root cause of bug [22400](https://bugs.torproject.org/22400); bugfix on 0.3.0.1-alpha.
* Minor features (bug mitigation, diagnostics, logging):
  + Avoid an assertion failure, and log a better error message, when unable to remove a file from the consensus cache on Windows. Attempts to mitigate and diagnose bug [22752](https://bugs.torproject.org/22752).
* Minor features (geoip):
  + Update geoip and geoip6 to the June 8 2017 Maxmind GeoLite2 Country database.
* Minor bugfixes (compression):
  + When compressing or decompressing a buffer, check for a failure to create a compression object. Fixes bug [22626](https://bugs.torproject.org/22626); bugfix on 0.3.1.1-alpha.
  + When decompressing a buffer, check for extra data after the end of the compressed data. Fixes bug [22629](https://bugs.torproject.org/22629); bugfix on 0.3.1.1-alpha.
  + When decompressing an object received over an anonymous directory connection, if we have already decompressed it using an acceptable compression method, do not reject it for looking like an unacceptable compression method. Fixes part of bug [22670](https://bugs.torproject.org/22670); bugfix on 0.3.1.1-alpha.
  + When serving directory votes compressed with zlib, do not claim to have compressed them with zstd. Fixes bug [22669](https://bugs.torproject.org/22669); bugfix on 0.3.1.1-alpha.
  + When spooling compressed data to an output buffer, don't try to spool more data when there is no more data to spool and we are not trying to flush the input. Previously, we would sometimes launch compression requests with nothing to do, which interferes with our 22672 checks. Fixes bug [22719](https://bugs.torproject.org/22719); bugfix on 0.2.0.16-alpha.
* Minor bugfixes (defensive programming):
  + Detect and break out of infinite loops in our compression code. We don't think that any such loops exist now, but it's best to be safe. Closes ticket [22672](https://bugs.torproject.org/22672).
  + Fix a memset() off the end of an array when packing cells. This bug should be harmless in practice, since the corrupted bytes are still in the same structure, and are always padding bytes, ignored, or immediately overwritten, depending on compiler behavior. Nevertheless, because the memset()'s purpose is to make sure that any other cell-handling bugs can't expose bytes to the network, we need to fix it. Fixes bug [22737](https://bugs.torproject.org/22737); bugfix on 0.2.4.11-alpha. Fixes CID 1401591.
* Minor bugfixes (linux seccomp2 sandbox):
  + Permit the fchmod system call, to avoid crashing on startup when starting with the seccomp2 sandbox and an unexpected set of permissions on the data directory or its contents. Fixes bug [22516](https://bugs.torproject.org/22516); bugfix on 0.2.5.4-alpha.
  + Fix a crash in the LZMA module, when the sandbox was enabled, and liblzma would allocate more than 16 MB of memory. We solve this by bumping the mprotect() limit in the sandbox module from 16 MB to 20 MB. Fixes bug [22751](https://bugs.torproject.org/22751); bugfix on 0.3.1.1-alpha.
* Minor bugfixes (logging):
  + When decompressing, do not warn if we fail to decompress using a compression method that we merely guessed. Fixes part of bug [22670](https://bugs.torproject.org/22670); bugfix on 0.1.1.14-alpha.
  + When decompressing, treat mismatch between content-encoding and actual compression type as a protocol warning. Fixes part of bug [22670](https://bugs.torproject.org/22670); bugfix on 0.1.1.9-alpha.
  + Downgrade "assigned\_to\_cpuworker failed" message to info-level severity. In every case that can reach it, either a better warning has already been logged, or no warning is warranted. Fixes bug [22356](https://bugs.torproject.org/22356); bugfix on 0.2.6.3-alpha.
  + Demote a warn that was caused by libevent delays to info if netflow padding is less than 4.5 seconds late, or to notice if it is more (4.5 seconds is the amount of time that a netflow record might be emitted after, if we chose the maximum timeout). Fixes bug [22212](https://bugs.torproject.org/22212); bugfix on 0.3.1.1-alpha.
* Minor bugfixes (process behavior):
  + When exiting because of an error, always exit with a nonzero exit status. Previously, we would fail to report an error in our exit status in cases related to \_\_OwningControllerProcess failure, lockfile contention, and Ed25519 key initialization. Fixes bug [22720](https://bugs.torproject.org/22720); bugfix on versions 0.2.1.6-alpha, 0.2.2.28-beta, and 0.2.7.2-alpha respectively. Reported by "f55jwk4f"; patch from "huyvq".
* Documentation:
  + Add a manpage description for the key-pinning-journal file. Closes ticket [22347](https://bugs.torproject.org/22347).
  + Correctly note that bandwidth accounting values are stored in the state file, and the bw\_accounting file is now obsolete. Closes ticket [16082](https://bugs.torproject.org/16082).
  + Document more of the files in the Tor data directory, including cached-extrainfo, secret\_onion\_key{,\_ntor}.old, hidserv-stats, approved-routers, sr-random, and diff-cache. Found while fixing ticket [22347](https://bugs.torproject.org/22347).

* [releases](../category/releases)

## Comments

Please note that the comment area below has been archived.

Anonymous (not verified) said:

July 08, 2017

[Permalink](#comment-269776)

### [[07-08 17:59:58] Torbuttonâ¦](#comment-269776)

[07-08 17:59:58] Torbutton INFO: controlPort >> 650 STREAM 2187 NEW 0 1.1.1.1.$AAA...EEE.exit:53 PURPOSE=DIR\_FETCH

[07-08 17:59:58] Torbutton INFO: controlPort >> 650 STREAM 2189 NEW 0 1.1.1.1.$AAA...EEE.exit:53 PURPOSE=DIR\_FETCH

[07-08 17:59:58] Torbutton INFO: controlPort >> 650 STREAM 2191 NEW 0 1.1.1.1.$AAA...EEE.exit:53 PURPOSE=DIR\_FETCH

Why the same node? Why 3 times in a row? Why STREAM numbers are odd only?

gk

gk said:

July 10, 2017

In reply to [[07-08 17:59:58] Torbuttonâ¦](#comment-269776) by Anonymous (not verified)

[Permalink](#comment-269798)

### [Not sure, to be honest. Doesâ¦](#comment-269798)

Not sure, to be honest. Does that issue go away with older tor versions? You could test that with extracting the expert bundle (you'll find the respective tor-win32\*zip files in the Tor Browser bundles directories at <https://archive.torproject.org/tor-package-archive/torbrowser/>) and copyinf the tor.exe file over the one in the Tor Browser you are using? Maybe we can first narrow down the problem to be either in the tor or the Tor Browser area that way.

Anonymous (not verified) said:

July 11, 2017

In reply to gk

[Permalink](#comment-269806)

### [Is this really an issue? Isnâ¦](#comment-269806)

Is this really an issue? Isn't it a Tor issue?

Tor stable 0.3.0.9: three, to the same, even, i.e. STREAM numbers could be odd or even.

The whole algorithm looks like this: STREAM 169 NODE. When DONE, STREAM 172,174,176 NODE. 2 streams (170,171) also disappeared.

Anonymous (not verified) said:

July 13, 2017

In reply to [Is this really an issue? Isnâ¦](#comment-269806) by Anonymous (not verified)

[Permalink](#comment-269820)

### [Could somebody from the Torâ¦](#comment-269820)

Could somebody from the Tor Team explain is this an intended behavior or not?

liteshield (not verified) said:

July 14, 2017

[Permalink](#comment-269835)

### [tor\_bug\_occurred\_(): Bug:â¦](#comment-269835)

tor\_bug\_occurred\_(): Bug: consdiffmgr.c:1289: store\_multiple: Non-fatal assertion !(ent == NULL) failed. (on Tor 0.3.1.4-alpha fab91a290ded3e74)

Bug: Non-fatal assertion !(ent == NULL) failed in store\_multiple at consdiffmgr.c:1289. (Stack trace not available) (on Tor 0.3.1.4-alpha fab91a290ded3e74)

Anonymous (not verified) said:

July 14, 2017

[Permalink](#comment-269841)

### [Unable to unlink ".\\Data\â¦](#comment-269841)

Unable to unlink ".\\Data\\Tor\\LocalState\\diff-cache/1001" while removing file: Permission denied

tor\_bug\_occurred\_(): Bug: consdiffmgr.c:1289: store\_multiple: Non-fatal assertion !(ent == NULL) failed. (on Tor 0.3.1.4-alpha fab91a290ded3e74)

Bug: Non-fatal assertion !(ent == NULL) failed in store\_multiple at consdiffmgr.c:1289. (Stack trace not available) (on Tor 0.3.1.4-alpha fab91a290ded3e74)

tor\_bug\_occurred\_(): Bug: consdiffmgr.c:328: cdm\_diff\_ht\_purge: Non-fatal assertion !((\*diff)->entry == NULL) failed. (on Tor 0.3.1.4-alpha fab91a290ded3e74)

Bug: Non-fatal assertion !((\*diff)->entry == NULL) failed in cdm\_diff\_ht\_purge at consdiffmgr.c:328. (Stack trace not available) (on Tor 0.3.1.4-alpha fab91a290ded3e74)

eventdns: All nameservers have failed

gk

gk said:

July 17, 2017

In reply to [Unable to unlink ".\\Data\â¦](#comment-269841) by Anonymous (not verified)

[Permalink](#comment-269860)

### [Thanks for reporting thisâ¦](#comment-269860)

Thanks for reporting this bug. This is <https://trac.torproject.org/projects/tor/ticket/22752>. Do you have some more information that could help us tracking this problem down?

Alan Mintaka (not verified) said:

July 20, 2017

[Permalink](#comment-269900)

### [Plse disregard last requestâ¦](#comment-269900)

Plse disregard last request for help RE Bad Gateway 502 Error. I added an "Inbound Rule" in Windows Firewall for the TOR executable for firefox.exe, defaulted everything, and that seems to have done the trick for the time being. Anyone using Windows Firewall might want to check this out.

Also forgot to mention that I'm using Windows 7 "Home Premium." Have no idea how this would play out in Windows 8 or 10, and don't want to know.

Response is on the slow side, but I kind of expected that for anonymous browsing. I'll work through the other blog posts and community support to try to resolve that.

## Recent Updates

## [New Alpha Release: Tor Browser 14.5a2](/new-alpha-release-tor-browser-145a2/)

by [ma1](/author/ma1) | January 14, 2025

Tor Browser 14.5a2 is now available from the Tor Browser download page and also from our distribution directory.

## [New Release: Tails 6.11](/new-release-tails-611/)

by [tails](/author/tails) | January 9, 2025

Tails 6.11 fixes several critical security vulnerabilities that were identified during an external audit.

## [New Release: Tor Browser 14.0.4](/new-release-tor-browser-1404/)

by [morgan](/author/morgan) | January 8, 2025

Tor Browser 14.0.4 is now available from the Tor Browser download page and also from our distribution directory.

### Download Tor Browser

Download Tor Browser to experience real private browsing without tracking, surveillance, or censorship.

[Download Tor Browser](https://www.torproject.org/download/)

### Subscribe to our Newsletter

Get monthly updates and opportunities from the Tor Project:

[Sign up](https://newsletter.torproject.org/)

####

####

####

####

####

####

####

Trademark, copyright notices, and rules for use by third parties can be found in our [FAQ](https://www.torproject.org/about/trademark/).


