=== Content from bugs.launchpad.net_42c79986_20250124_190513.html ===

[Log in / Register](https://bugs.launchpad.net/mahara/%2Bbug/1404117/%2Blogin)

[![](https://launchpadlibrarian.net/302557383/mahara_64x64.png)](https://launchpad.net/mahara)

## [Mahara](https://launchpad.net/mahara)

* [Overview](https://launchpad.net/mahara)
* [Code](https://code.launchpad.net/mahara)
* [Bugs](https://bugs.launchpad.net/mahara)
* [Blueprints](https://blueprints.launchpad.net/mahara)
* [Translations](https://translations.launchpad.net/mahara)
* [Answers](https://answers.launchpad.net/mahara)

# XSS via uploaded XML

Bug #1404117 reported by
[Kristina Hoeppner](https://launchpad.net/~kris-hoeppner)
on 2014-12-19

[258](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [Mahara](https://bugs.launchpad.net/mahara) | Fix Released | High | [Son Nguyen](https://launchpad.net/~ngson2000) | [Mahara 15.04.0](https://launchpad.net/mahara/%2Bmilestone/15.04.0) |
|  | [1.10](https://bugs.launchpad.net/mahara/1.10) | Fix Released | High | [Son Nguyen](https://launchpad.net/~ngson2000) | [Mahara 1.10.3](https://launchpad.net/mahara/%2Bmilestone/1.10.3) |
|  | [1.8](https://bugs.launchpad.net/mahara/1.8) | Fix Released | High | Unassigned | [Mahara 1.8.7](https://launchpad.net/mahara/%2Bmilestone/1.8.7) |
|  | [1.9](https://bugs.launchpad.net/mahara/1.9) | Fix Released | High | Unassigned | [Mahara 1.9.5](https://launchpad.net/mahara/%2Bmilestone/1.9.5) |
|  | [15.04](https://bugs.launchpad.net/mahara/15.04) | Fix Released | High | [Son Nguyen](https://launchpad.net/~ngson2000) | [Mahara 15.04.0](https://launchpad.net/mahara/%2Bmilestone/15.04.0) |

### Bug Description

Reported by Roman Mironov

Dear Sir/Madam,

I have found a security vulnerability and would like to disclose it to you.

An attacker can use this vulnerability to initiate stored Cross-Site scripting attacks on authenticated users.

Bug Description:

It is possible to upload .xml files with malicious code and then share them with users.

As proof of concept it was possible to share a file between accounts that redirects the user to google.com.

In order to reproduce this proof of concept please follow these steps:

Preconditions:

1) Ensure you have 2 accounts (user A and user B) that have access to each others Journal entries.

2) Create an .xml file that has the following line of code:

<script xmlns="<http://www.w3.org/1999/xhtml>">document.location='<http://google.com'>;</script>

Steps to Reproduce:

1) Log-in as user A.

2) Navigate to /artefact/internal/index.php and select Journal on the Navigation block.

3) Press the 'New Entry' button.

4) Enter any Title and Entry text.

5) Add the previously created .xml file as an attachment and press 'Save Entry'.

6) Log-in as user B.

7) Navigate to user A profile page.

8) Find the previously created Journal entry and press the 'Download' button next to the .xml file name.

9) Observe that you are redirected to google.

## CVE References

* [2017-1000140](/bugs/cve/2017-1000140 "Mahara 1.8 before 1.8.7 and 1.9 befor...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Son Nguyen (ngson2000)](https://launchpad.net/~ngson2000) wrote on 2015-01-04: |  |  | [#1](/mahara/%2Bbug/1404117/comments/1) |
| --- | --- | --- | --- |

We need filter out all malicious codes in XML file like we do for HTML.

We need filter out all malicious codes in XML file like we do for HTML.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Wells (u-aaronw)](https://launchpad.net/~u-aaronw) wrote on 2015-01-12: |  |  | [#2](/mahara/%2Bbug/1404117/comments/2) |
| --- | --- | --- | --- |

Yeah, that seems to be the suggestion given by OWASP: <https://www.owasp.org/index.php/OWASP_Periodic_Table_of_Vulnerabilities_-_XML_Injection>

"The framework should provide safe libraries for constructing and manipulating XML documents that automatically encode all dynamic data. The framework should disallow any direct access to raw XML. "

Unfortunately HTMLPurifier doesn't really support cleaning XML (I mean, does XML have exactly the same stuff that needs to be cleaned out, as HTML does?).

Another option we could look at would be to add a "Content-Disposition: attachment" header to XML files. Currently we serve XML files without a Content-Disposition header, which tells the browser to display them in the browser window. And even for other file types that are unrecognized, we do "Content-Disposition: inline", which tells it to try to display the file in the browser window and download it if that's not possible. We should really be doing "Content-Disposition:attachment", which would tell the browser to download the file, and NOT display it in the window. This is especially true because the link reads "Download"!

Yeah, that seems to be the suggestion given by OWASP: https://www.owasp.org/index.php/OWASP\_Periodic\_Table\_of\_Vulnerabilities\_-\_XML\_Injection
"The framework should provide safe libraries for constructing and manipulating XML documents that automatically encode all dynamic data. The framework should disallow any direct access to raw XML. "
Unfortunately HTMLPurifier doesn't really support cleaning XML (I mean, does XML have exactly the same stuff that needs to be cleaned out, as HTML does?).
Another option we could look at would be to add a "Content-Disposition: attachment" header to XML files. Currently we serve XML files without a Content-Disposition header, which tells the browser to display them in the browser window. And even for other file types that are unrecognized, we do "Content-Disposition: inline", which tells it to try to display the file in the browser window and download it if that's not possible. We should really be doing "Content-Disposition:attachment", which would tell the browser to download the file, and NOT display it in the window. This is especially true because the link reads "Download"!

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Mahara Bot (dev-mahara)](https://launchpad.net/~dev-mahara) wrote on 2015-02-09:  [**A change has been merged**](/mahara/%2Bbug/1404117/comments/3) |  |  | [#3](/mahara/%2Bbug/1404117/comments/3) |
| --- | --- | --- | --- |

Reviewed: <https://reviews.mahara.org/4253>

Committed: <http://gitorious.org/mahara/mahara/commit/13428c09f5245a44b5623c4bcfd50768299a2e24>

Submitter: Robert Lyon (<email address hidden>)

Branch: 1.8\_STABLE

commit 13428c09f5245a44b5623c4bcfd50768299a2e24

Author: Son Nguyen <email address hidden>

Date: Mon Jan 5 12:03:34 2015 +1300

Display cleaned content of XML file. [Bug 1404117](/bugs/1404117)

Change-Id: I0dffc63f0ea10409c9ae18b9194a13a2287e0a7c

Signed-off-by: Son Nguyen <email address hidden>

Reviewed: https://reviews.mahara.org/4253
Committed: http://gitorious.org/mahara/mahara/commit/13428c09f5245a44b5623c4bcfd50768299a2e24
Submitter: Robert Lyon (robertl@catalyst.net.nz)
Branch: 1.8\_STABLE
commit 13428c09f5245a44b5623c4bcfd50768299a2e24
Author: Son Nguyen <son.nguyen@catalyst.net.nz>
Date: Mon Jan 5 12:03:34 2015 +1300
Display cleaned content of XML file. Bug 1404117
Change-Id: I0dffc63f0ea10409c9ae18b9194a13a2287e0a7c
Signed-off-by: Son Nguyen <son.nguyen@catalyst.net.nz>

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Mahara Bot (dev-mahara)](https://launchpad.net/~dev-mahara) wrote on 2015-02-09: |  |  | [#4](/mahara/%2Bbug/1404117/comments/4) |
| --- | --- | --- | --- |

Reviewed: <https://reviews.mahara.org/4254>

Committed: <http://gitorious.org/mahara/mahara/commit/c91bac68f3921dec820464d63f98f12441f997ce>

Submitter: Robert Lyon (<email address hidden>)

Branch: 1.9\_STABLE

commit c91bac68f3921dec820464d63f98f12441f997ce

Author: Son Nguyen <email address hidden>

Date: Mon Jan 5 12:03:34 2015 +1300

Display cleaned content of XML file. [Bug 1404117](/bugs/1404117)

Change-Id: I0dffc63f0ea10409c9ae18b9194a13a2287e0a7c

Signed-off-by: Son Nguyen <email address hidden>

Reviewed: https://reviews.mahara.org/4254
Committed: http://gitorious.org/mahara/mahara/commit/c91bac68f3921dec820464d63f98f12441f997ce
Submitter: Robert Lyon (robertl@catalyst.net.nz)
Branch: 1.9\_STABLE
commit c91bac68f3921dec820464d63f98f12441f997ce
Author: Son Nguyen <son.nguyen@catalyst.net.nz>
Date: Mon Jan 5 12:03:34 2015 +1300
Display cleaned content of XML file. Bug 1404117
Change-Id: I0dffc63f0ea10409c9ae18b9194a13a2287e0a7c
Signed-off-by: Son Nguyen <son.nguyen@catalyst.net.nz>

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Mahara Bot (dev-mahara)](https://launchpad.net/~dev-mahara) wrote on 2015-02-09: |  |  | [#5](/mahara/%2Bbug/1404117/comments/5) |
| --- | --- | --- | --- |

Reviewed: <https://reviews.mahara.org/4255>

Committed: <http://gitorious.org/mahara/mahara/commit/f8a6c8aa14de3b13b07b8dfe3b2068031afe204e>

Submitter: Robert Lyon (<email address hidden>)

Branch: 1.10\_STABLE

commit f8a6c8aa14de3b13b07b8dfe3b2068031afe204e

Author: Son Nguyen <email address hidden>

Date: Mon Jan 5 12:03:34 2015 +1300

Display cleaned content of XML file. [Bug 1404117](/bugs/1404117)

Change-Id: I0dffc63f0ea10409c9ae18b9194a13a2287e0a7c

Signed-off-by: Son Nguyen <email address hidden>

Reviewed: https://reviews.mahara.org/4255
Committed: http://gitorious.org/mahara/mahara/commit/f8a6c8aa14de3b13b07b8dfe3b2068031afe204e
Submitter: Robert Lyon (robertl@catalyst.net.nz)
Branch: 1.10\_STABLE
commit f8a6c8aa14de3b13b07b8dfe3b2068031afe204e
Author: Son Nguyen <son.nguyen@catalyst.net.nz>
Date: Mon Jan 5 12:03:34 2015 +1300
Display cleaned content of XML file. Bug 1404117
Change-Id: I0dffc63f0ea10409c9ae18b9194a13a2287e0a7c
Signed-off-by: Son Nguyen <son.nguyen@catalyst.net.nz>

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Mahara Bot (dev-mahara)](https://launchpad.net/~dev-mahara) wrote on 2015-02-09: |  |  | [#6](/mahara/%2Bbug/1404117/comments/6) |
| --- | --- | --- | --- |

Reviewed: <https://reviews.mahara.org/4121>

Committed: <http://gitorious.org/mahara/mahara/commit/3cf591539c8ae51183ea45426345c9350798eb15>

Submitter: Robert Lyon (<email address hidden>)

Branch: master

commit 3cf591539c8ae51183ea45426345c9350798eb15

Author: Son Nguyen <email address hidden>

Date: Mon Jan 5 12:03:34 2015 +1300

Display cleaned content of XML file. [Bug 1404117](/bugs/1404117)

Change-Id: I0dffc63f0ea10409c9ae18b9194a13a2287e0a7c

Signed-off-by: Son Nguyen <email address hidden>

Reviewed: https://reviews.mahara.org/4121
Committed: http://gitorious.org/mahara/mahara/commit/3cf591539c8ae51183ea45426345c9350798eb15
Submitter: Robert Lyon (robertl@catalyst.net.nz)
Branch: master
commit 3cf591539c8ae51183ea45426345c9350798eb15
Author: Son Nguyen <son.nguyen@catalyst.net.nz>
Date: Mon Jan 5 12:03:34 2015 +1300
Display cleaned content of XML file. Bug 1404117
Change-Id: I0dffc63f0ea10409c9ae18b9194a13a2287e0a7c
Signed-off-by: Son Nguyen <son.nguyen@catalyst.net.nz>

[Robert Lyon (robertl-9)](https://launchpad.net/~robertl-9)
on 2015-02-09

| **information type**: | Private Security → Public Security |
| --- | --- |

[Robert Lyon (robertl-9)](https://launchpad.net/~robertl-9)
on 2015-04-17

| Changed in mahara: | |
| --- | --- |
| **status**: | Fix Committed → Fix Released |

[See full activity log](https://bugs.launchpad.net/mahara/%2Bbug/1404117/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/mahara/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/mahara/%2Bbug/1404117/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/mahara/%2Bbug/1404117/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/mahara/%2Bbug/1404117/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))


