=== Content from bugs.launchpad.net_a31608c5_20250125_044212.html ===

[Log in / Register](https://bugs.launchpad.net/mahara/%2Bbug/1429647/%2Blogin)

[![](https://launchpadlibrarian.net/302557383/mahara_64x64.png)](https://launchpad.net/mahara)

## [Mahara](https://launchpad.net/mahara)

* [Overview](https://launchpad.net/mahara)
* [Code](https://code.launchpad.net/mahara)
* [Bugs](https://bugs.launchpad.net/mahara)
* [Blueprints](https://blueprints.launchpad.net/mahara)
* [Translations](https://translations.launchpad.net/mahara)
* [Answers](https://answers.launchpad.net/mahara)

# Watchlist lets you watch and receive notifications about pages you don't have view access to

Bug #1429647 reported by
[Aaron Wells](https://launchpad.net/~u-aaronw)
on 2015-03-08

[256](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [Mahara](https://bugs.launchpad.net/mahara) | Fix Released | Medium | Unassigned | [Mahara 15.04.0](https://launchpad.net/mahara/%2Bmilestone/15.04.0) |
|  | [1.10](https://bugs.launchpad.net/mahara/1.10) | Fix Released | Medium | Unassigned | [Mahara 1.10.3](https://launchpad.net/mahara/%2Bmilestone/1.10.3) |
|  | [1.8](https://bugs.launchpad.net/mahara/1.8) | Fix Released | Medium | Unassigned | [Mahara 1.8.7](https://launchpad.net/mahara/%2Bmilestone/1.8.7) |
|  | [1.9](https://bugs.launchpad.net/mahara/1.9) | Fix Released | Medium | Unassigned | [Mahara 1.9.5](https://launchpad.net/mahara/%2Bmilestone/1.9.5) |
|  | [15.04](https://bugs.launchpad.net/mahara/15.04) | Fix Released | Medium | Unassigned | [Mahara 15.04.0](https://launchpad.net/mahara/%2Bmilestone/15.04.0) |
|  | [15.10](https://bugs.launchpad.net/mahara/15.10) | Fix Released | Medium | Unassigned | [Mahara 15.10.0](https://launchpad.net/mahara/%2Bmilestone/15.10.0) |

### Bug Description

In analyzing watchlist [bug 1429505](/bugs/1429505) (pages stay on your watchlist even if you lose access to them) I noticed a couple of things in the code:

1. You apparently still can receive watchlist notifications about pages on your watchlist which you don't have access to.

2. There are no access control checks in togglewatchlist.json.php, so it is apparently possible to add a page to your watchlist even if you don't have access to it.

Together, these bugs mean that a user could watch private pages, and receive notifications about changes to those pages. While these notifications would not contain the actual page content, they would contain the title of the page and the names of blocks and/or artefacts changed in the page.

Tags:

[security](/mahara/%2Bbugs?field.tag=security)
[viewaccess](/mahara/%2Bbugs?field.tag=viewaccess)
[behat](/mahara/%2Bbugs?field.tag=behat)
[behat-needed](/mahara/%2Bbugs?field.tag=behat-needed)
[watchlist](/mahara/%2Bbugs?field.tag=watchlist)

## CVE References

* [2017-1000143](/bugs/cve/2017-1000143 "Mahara 1.8 before 1.8.7 and 1.9 befor...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Wells (u-aaronw)](https://launchpad.net/~u-aaronw) wrote on 2015-03-08: |  |  | [#1](/mahara/%2Bbug/1429647/comments/1) |
| --- | --- | --- | --- |

This bug report is based mostly on looking at the code. I still have to actually run some tests to determine whether the code behaves as I think it does...

This bug report is based mostly on looking at the code. I still have to actually run some tests to determine whether the code behaves as I think it does...

| **information type**: | Public → Private Security |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Robert Lyon (robertl-9)](https://launchpad.net/~robertl-9) wrote on 2015-04-01: |  |  | [#2](/mahara/%2Bbug/1429647/comments/2) |
| --- | --- | --- | --- |

I've added a patch for this to doublecheck the view id

To test:

1) make a page and share it with your friends

2) log in as a user who is a friend and watch the page

3) look in db for the entry in usr\_watchlist\_view - make note of the view id

4) log in as a user that is not a friend - go to any view page they can see and manually manipulate things

- if using firebug on the HTML tab view the <head> and scroll down until you see

<script type="application/javascript">

<link href="<http://mahara-devel/theme/raw/static/style/tinymceskin.css?v=3651>" type="text/css" rel="stylesheet">

Expand the script one and you should see

var viewid =

Click the 'edit this HTML' button in firebug and change the id to the one in step 3 and click the 'edit this HHTML' button again

5) now click the 'Add page to watchlist' link in mahara

If all done right you will see the page has been added to the usr\_watchlist\_view table if the patch is not in place.

If the patch is present then you should see an error message on screen

I've added a patch for this to doublecheck the view id
To test:
1) make a page and share it with your friends
2) log in as a user who is a friend and watch the page
3) look in db for the entry in usr\_watchlist\_view - make note of the view id
4) log in as a user that is not a friend - go to any view page they can see and manually manipulate things
- if using firebug on the HTML tab view the <head> and scroll down until you see
<script type="application/javascript">
<link href="http://mahara-devel/theme/raw/static/style/tinymceskin.css?v=3651" type="text/css" rel="stylesheet">
Expand the script one and you should see
var viewid =
Click the 'edit this HTML' button in firebug and change the id to the one in step 3 and click the 'edit this HHTML' button again
5) now click the 'Add page to watchlist' link in mahara
If all done right you will see the page has been added to the usr\_watchlist\_view table if the patch is not in place.
If the patch is present then you should see an error message on screen

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Robert Lyon (robertl-9)](https://launchpad.net/~robertl-9) wrote on 2015-04-01: |  |  | [#3](/mahara/%2Bbug/1429647/comments/3) |
| --- | --- | --- | --- |

Patch for this bug <https://reviews.mahara.org/#/c/4576/>

Patch for this bug https://reviews.mahara.org/#/c/4576/

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jinelle Foley-Barnes (jinelleb)](https://launchpad.net/~jinelleb) wrote on 2015-04-01: |  |  | [#4](/mahara/%2Bbug/1429647/comments/4) |
| --- | --- | --- | --- |

Hi Rob,

Thanks for the test instructions.

Cheers,

Jinelle

Hi Rob,
Thanks for the test instructions.
Cheers,
Jinelle

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kristina Hoeppner (kris-hoeppner)](https://launchpad.net/~kris-hoeppner) wrote on 2015-04-15: |  |  | [#6](/mahara/%2Bbug/1429647/comments/6) |
| --- | --- | --- | --- |

Aaron, how can someone remove an item from somebody else's watchlist? Is that a new feature?

Aaron, how can someone remove an item from somebody else's watchlist? Is that a new feature?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Wells (u-aaronw)](https://launchpad.net/~u-aaronw) wrote on 2015-04-15: |  |  | [#7](/mahara/%2Bbug/1429647/comments/7) |
| --- | --- | --- | --- |

Kristina,

Sorry, I misspoke. I meant to say "it means that if you add a page to your watchlist, and the page owner then revokes your view access to that page".

Since I can't edit Launchpad comments, I'll just repost it with the correction, so it'll be clearer:

So, on further investigation, the watchlist activity has code in it which checks that each person has permission to view the item, and removes it from their watchlist if they don't.

This is a little strange, because it means that if you add a page to your watchlist and the page owner then removes your view access to the page, it remains on your watchlist until they make a change to the page's contents. It also doesn't support the new feedback-watchlist notifications... because I didn't add code for that when I was writing it. :)

We should probably just make a cron task to clear away invalid watchlist items.

But this patch is still good, to prevent people from manipulating their watchlist in order to find out page titles and such.

Kristina,
Sorry, I misspoke. I meant to say "it means that if you add a page to your watchlist, and the page owner then revokes your view access to that page".
Since I can't edit Launchpad comments, I'll just repost it with the correction, so it'll be clearer:
So, on further investigation, the watchlist activity has code in it which checks that each person has permission to view the item, and removes it from their watchlist if they don't.
This is a little strange, because it means that if you add a page to your watchlist and the page owner then removes your view access to the page, it remains on your watchlist until they make a change to the page's contents. It also doesn't support the new feedback-watchlist notifications... because I didn't add code for that when I was writing it. :)
We should probably just make a cron task to clear away invalid watchlist items.
But this patch is still good, to prevent people from manipulating their watchlist in order to find out page titles and such.

[Robert Lyon (robertl-9)](https://launchpad.net/~robertl-9)
on 2015-04-16

| **information type**: | Private Security → Public Security |
| --- | --- |

[Robert Lyon (robertl-9)](https://launchpad.net/~robertl-9)
on 2015-04-17

| Changed in mahara: | |
| --- | --- |
| **status**: | Fix Committed → Fix Released |

[Jinelle Foley-Barnes (jinelleb)](https://launchpad.net/~jinelleb)
on 2015-04-20

| **tags**: | added: behat behat-needed |
| --- | --- |

[See full activity log](https://bugs.launchpad.net/mahara/%2Bbug/1429647/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/mahara/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/mahara/%2Bbug/1429647/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/mahara/%2Bbug/1429647/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/mahara/%2Bbug/1429647/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))


