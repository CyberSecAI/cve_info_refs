=== Content from bugs.launchpad.net_334d242b_20250124_200914.html ===

[Log in / Register](https://bugs.launchpad.net/mahara/%2Bbug/1234615/%2Blogin)

[![](https://launchpadlibrarian.net/302557383/mahara_64x64.png)](https://launchpad.net/mahara)

## [Mahara](https://launchpad.net/mahara)

* [Overview](https://launchpad.net/mahara)
* [Code](https://code.launchpad.net/mahara)
* [Bugs](https://bugs.launchpad.net/mahara)
* [Blueprints](https://blueprints.launchpad.net/mahara)
* [Translations](https://translations.launchpad.net/mahara)
* [Answers](https://answers.launchpad.net/mahara)

# Not checking artefact permissions before exporting

Bug #1234615 reported by
[Aaron Wells](https://launchpad.net/~u-aaronw)
on 2013-10-03

[256](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [Mahara](https://bugs.launchpad.net/mahara) | Fix Released | Medium | Unassigned |  |
|  | [1.10](https://bugs.launchpad.net/mahara/1.10) | Won't Fix | Medium | Unassigned |  |
|  | [1.9](https://bugs.launchpad.net/mahara/1.9) | Won't Fix | Medium | Unassigned |  |
|  | [15.04](https://bugs.launchpad.net/mahara/15.04) | Fix Released | Medium | Unassigned | [Mahara 15.04.8](https://launchpad.net/mahara/%2Bmilestone/15.04.8) |
|  | [15.10](https://bugs.launchpad.net/mahara/15.10) | Fix Released | Medium | Unassigned | [Mahara 15.10.4](https://launchpad.net/mahara/%2Bmilestone/15.10.4) |
|  | [16.04](https://bugs.launchpad.net/mahara/16.04) | Fix Released | Medium | Unassigned | [Mahara 16.04.2](https://launchpad.net/mahara/%2Bmilestone/16.04.2) |
|  | [16.10](https://bugs.launchpad.net/mahara/16.10) | Fix Released | Medium | Unassigned | [Mahara 16.10.0](https://launchpad.net/mahara/%2Bmilestone/16.10.0) |

### Bug Description

In <https://bugs.launchpad.net/bugs/1211758> , the reporter mentioned that in addition to embedding other users' artefacts in your pages, you could export them to view their full content:

#3: Export function allows arbitrary file download

Using the technique above you can get a 1024x1024 'thumbnail' of any users arbitrary file. Simply use the export function on a page like the one above where other users images are embedded. Make sure the embedded images max-size is set to 1024 and it will appear within /files/extra.

There is an obvious fix for this issue, of checking $USER->can\_publish\_artefac()t or $USER->can\_view\_artefact() on each artefact before exporting it. But when Robert tested this fix, he found that it was too resource-intensive (as part of the already resource-intensive export process) for it to work while exporting an average-sized portfolio.

Since fixing the embedding of other users' data mitigates the risk from this issue and was easier to accomplish, I've released that fix and spun this one off into a separate bug to fix when we're able.

Tags:

[export](/mahara/%2Bbugs?field.tag=export)
[no-behat-needed](/mahara/%2Bbugs?field.tag=no-behat-needed)

## CVE References

* [2017-1000133](/bugs/cve/2017-1000133 "Mahara 15.04 before 15.04.8 and 15.10...")

[Aaron Wells (u-aaronw)](https://launchpad.net/~u-aaronw)
on 2013-12-16

| Changed in mahara: | |
| --- | --- |
| **milestone**: | 1.8.1 → 1.9.0 |

[Aaron Wells (u-aaronw)](https://launchpad.net/~u-aaronw)
on 2014-04-14

| Changed in mahara: | |
| --- | --- |
| **milestone**: | 1.9.0 → 1.9.1 |
| **no longer affects**: | mahara/1.6 |

[Aaron Wells (u-aaronw)](https://launchpad.net/~u-aaronw)
on 2014-09-09

| **no longer affects**: | mahara/1.7 |
| --- | --- |

[Jinelle Foley-Barnes (jinelleb)](https://launchpad.net/~jinelleb)
on 2015-04-20

| **tags**: | added: no-behat-needed |
| --- | --- |

[Aaron Wells (u-aaronw)](https://launchpad.net/~u-aaronw)
on 2015-10-27

| **no longer affects**: | mahara/1.8 |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Robert Lyon (robertl-9)](https://launchpad.net/~robertl-9) wrote on 2016-07-07: |  |  | [#1](/mahara/%2Bbug/1234615/comments/1) |
| --- | --- | --- | --- |

From my investigations it looks the problem is only related to the HTML export and when blocks have artefacts attached that are not owned by the user.

From my investigations it looks the problem is only related to the HTML export and when blocks have artefacts attached that are not owned by the user.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Robert Lyon (robertl-9)](https://launchpad.net/~robertl-9) wrote on 2016-07-07: |  |  | [#2](/mahara/%2Bbug/1234615/comments/2) |
| --- | --- | --- | --- |

And because of that we can use can\_view\_artefact() as the number of artefacts not owned by user being exported will be low

And because of that we can use can\_view\_artefact() as the number of artefacts not owned by user being exported will be low

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Mahara Bot (dev-mahara)](https://launchpad.net/~dev-mahara) wrote on 2016-07-11:  [**A change has been merged**](/mahara/%2Bbug/1234615/comments/3) |  |  | [#3](/mahara/%2Bbug/1234615/comments/3) |
| --- | --- | --- | --- |

Reviewed: <https://reviews.mahara.org/6672>

Committed: <https://git.mahara.org/mahara/mahara/commit/aa31ba590f15010b6b27d9cec66a9f1ce8d62c7e>

Submitter: Robert Lyon (<email address hidden>)

Branch: master

commit aa31ba590f15010b6b27d9cec66a9f1ce8d62c7e

Author: Robert Lyon <email address hidden>

Date: Fri Jul 8 11:02:22 2016 +1200

[Bug 1234615](/bugs/1234615): Check that resized image files are viewable by user

When exporting via Html export process - if not then ignore the file

To test:

1) Add an image block/file to a page and set a width value

2) Go into db block\_instance table and change the artefactid to an

image that is owned by another user

3) Reload the page - you should see the image block but not the

attached image

4) Export the page as HTML, either as full or standalone

Before patch - you will end up with image file in the files/extra/

directory

After patch - you should not get the image in the files/extra/

directory and you should get an info warning 'Unable to copy artefact

file \*\*\*' on export page.

behatnotneeded

Change-Id: Iaeb9404b3329c4eb3eac59354801b598f7cd5ba8

Signed-off-by: Robert Lyon <email address hidden>

Reviewed: https://reviews.mahara.org/6672
Committed: https://git.mahara.org/mahara/mahara/commit/aa31ba590f15010b6b27d9cec66a9f1ce8d62c7e
Submitter: Robert Lyon (robertl@catalyst.net.nz)
Branch: master
commit aa31ba590f15010b6b27d9cec66a9f1ce8d62c7e
Author: Robert Lyon <robertl@catalyst.net.nz>
Date: Fri Jul 8 11:02:22 2016 +1200
Bug 1234615: Check that resized image files are viewable by user
When exporting via Html export process - if not then ignore the file
To test:
1) Add an image block/file to a page and set a width value
2) Go into db block\_instance table and change the artefactid to an
image that is owned by another user
3) Reload the page - you should see the image block but not the
attached image
4) Export the page as HTML, either as full or standalone
Before patch - you will end up with image file in the files/extra/
directory
After patch - you should not get the image in the files/extra/
directory and you should get an info warning 'Unable to copy artefact
file \*\*\*' on export page.
behatnotneeded
Change-Id: Iaeb9404b3329c4eb3eac59354801b598f7cd5ba8
Signed-off-by: Robert Lyon <robertl@catalyst.net.nz>

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Mahara Bot (dev-mahara)](https://launchpad.net/~dev-mahara) wrote on 2016-07-11: |  |  | [#4](/mahara/%2Bbug/1234615/comments/4) |
| --- | --- | --- | --- |

Reviewed: <https://reviews.mahara.org/6692>

Committed: <https://git.mahara.org/mahara/mahara/commit/36ab4bffb02b1a4f43ed1a5fd20dccad4a18d642>

Submitter: Robert Lyon (<email address hidden>)

Branch: 16.04\_STABLE

commit 36ab4bffb02b1a4f43ed1a5fd20dccad4a18d642

Author: Robert Lyon <email address hidden>

Date: Fri Jul 8 11:02:22 2016 +1200

[Bug 1234615](/bugs/1234615): Check that resized image files are viewable by user

When exporting via Html export process - if not then ignore the file

To test:

1) Add an image block/file to a page and set a width value

2) Go into db block\_instance table and change the artefactid to an

image that is owned by another user

3) Reload the page - you should see the image block but not the

attached image

4) Export the page as HTML, either as full or standalone

Before patch - you will end up with image file in the files/extra/

directory

After patch - you should not get the image in the files/extra/

directory and you should get an info warning 'Unable to copy artefact

file \*\*\*' on export page.

behatnotneeded

Change-Id: Iaeb9404b3329c4eb3eac59354801b598f7cd5ba8

Signed-off-by: Robert Lyon <email address hidden>

Reviewed: https://reviews.mahara.org/6692
Committed: https://git.mahara.org/mahara/mahara/commit/36ab4bffb02b1a4f43ed1a5fd20dccad4a18d642
Submitter: Robert Lyon (robertl@catalyst.net.nz)
Branch: 16.04\_STABLE
commit 36ab4bffb02b1a4f43ed1a5fd20dccad4a18d642
Author: Robert Lyon <robertl@catalyst.net.nz>
Date: Fri Jul 8 11:02:22 2016 +1200
Bug 1234615: Check that resized image files are viewable by user
When exporting via Html export process - if not then ignore the file
To test:
1) Add an image block/file to a page and set a width value
2) Go into db block\_instance table and change the artefactid to an
image that is owned by another user
3) Reload the page - you should see the image block but not the
attached image
4) Export the page as HTML, either as full or standalone
Before patch - you will end up with image file in the files/extra/
directory
After patch - you should not get the image in the files/extra/
directory and you should get an info warning 'Unable to copy artefact
file \*\*\*' on export page.
behatnotneeded
Change-Id: Iaeb9404b3329c4eb3eac59354801b598f7cd5ba8
Signed-off-by: Robert Lyon <robertl@catalyst.net.nz>

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Mahara Bot (dev-mahara)](https://launchpad.net/~dev-mahara) wrote on 2016-07-11: |  |  | [#5](/mahara/%2Bbug/1234615/comments/5) |
| --- | --- | --- | --- |

Reviewed: <https://reviews.mahara.org/6693>

Committed: <https://git.mahara.org/mahara/mahara/commit/d6399ee68eddf53a46bb046f77656bb4fb3044b8>

Submitter: Robert Lyon (<email address hidden>)

Branch: 15.10\_STABLE

commit d6399ee68eddf53a46bb046f77656bb4fb3044b8

Author: Robert Lyon <email address hidden>

Date: Fri Jul 8 11:02:22 2016 +1200

[Bug 1234615](/bugs/1234615): Check that resized image files are viewable by user

When exporting via Html export process - if not then ignore the file

To test:

1) Add an image block/file to a page and set a width value

2) Go into db block\_instance table and change the artefactid to an

image that is owned by another user

3) Reload the page - you should see the image block but not the

attached image

4) Export the page as HTML, either as full or standalone

Before patch - you will end up with image file in the files/extra/

directory

After patch - you should not get the image in the files/extra/

directory and you should get an info warning 'Unable to copy artefact

file \*\*\*' on export page.

behatnotneeded

Change-Id: Iaeb9404b3329c4eb3eac59354801b598f7cd5ba8

Signed-off-by: Robert Lyon <email address hidden>

Reviewed: https://reviews.mahara.org/6693
Committed: https://git.mahara.org/mahara/mahara/commit/d6399ee68eddf53a46bb046f77656bb4fb3044b8
Submitter: Robert Lyon (robertl@catalyst.net.nz)
Branch: 15.10\_STABLE
commit d6399ee68eddf53a46bb046f77656bb4fb3044b8
Author: Robert Lyon <robertl@catalyst.net.nz>
Date: Fri Jul 8 11:02:22 2016 +1200
Bug 1234615: Check that resized image files are viewable by user
When exporting via Html export process - if not then ignore the file
To test:
1) Add an image block/file to a page and set a width value
2) Go into db block\_instance table and change the artefactid to an
image that is owned by another user
3) Reload the page - you should see the image block but not the
attached image
4) Export the page as HTML, either as full or standalone
Before patch - you will end up with image file in the files/extra/
directory
After patch - you should not get the image in the files/extra/
directory and you should get an info warning 'Unable to copy artefact
file \*\*\*' on export page.
behatnotneeded
Change-Id: Iaeb9404b3329c4eb3eac59354801b598f7cd5ba8
Signed-off-by: Robert Lyon <robertl@catalyst.net.nz>

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Mahara Bot (dev-mahara)](https://launchpad.net/~dev-mahara) wrote on 2016-07-11: |  |  | [#6](/mahara/%2Bbug/1234615/comments/6) |
| --- | --- | --- | --- |

Reviewed: <https://reviews.mahara.org/6694>

Committed: <https://git.mahara.org/mahara/mahara/commit/32b65c72762f50dbddfda20a5c9b74c66cbb5343>

Submitter: Robert Lyon (<email address hidden>)

Branch: 15.04\_STABLE

commit 32b65c72762f50dbddfda20a5c9b74c66cbb5343

Author: Robert Lyon <email address hidden>

Date: Fri Jul 8 11:02:22 2016 +1200

[Bug 1234615](/bugs/1234615): Check that resized image files are viewable by user

When exporting via Html export process - if not then ignore the file

To test:

1) Add an image block/file to a page and set a width value

2) Go into db block\_instance table and change the artefactid to an

image that is owned by another user

3) Reload the page - you should see the image block but not the

attached image

4) Export the page as HTML, either as full or standalone

Before patch - you will end up with image file in the files/extra/

directory

After patch - you should not get the image in the files/extra/

directory and you should get an info warning 'Unable to copy artefact

file \*\*\*' on export page.

behatnotneeded

Change-Id: Iaeb9404b3329c4eb3eac59354801b598f7cd5ba8

Signed-off-by: Robert Lyon <email address hidden>

Reviewed: https://reviews.mahara.org/6694
Committed: https://git.mahara.org/mahara/mahara/commit/32b65c72762f50dbddfda20a5c9b74c66cbb5343
Submitter: Robert Lyon (robertl@catalyst.net.nz)
Branch: 15.04\_STABLE
commit 32b65c72762f50dbddfda20a5c9b74c66cbb5343
Author: Robert Lyon <robertl@catalyst.net.nz>
Date: Fri Jul 8 11:02:22 2016 +1200
Bug 1234615: Check that resized image files are viewable by user
When exporting via Html export process - if not then ignore the file
To test:
1) Add an image block/file to a page and set a width value
2) Go into db block\_instance table and change the artefactid to an
image that is owned by another user
3) Reload the page - you should see the image block but not the
attached image
4) Export the page as HTML, either as full or standalone
Before patch - you will end up with image file in the files/extra/
directory
After patch - you should not get the image in the files/extra/
directory and you should get an info warning 'Unable to copy artefact
file \*\*\*' on export page.
behatnotneeded
Change-Id: Iaeb9404b3329c4eb3eac59354801b598f7cd5ba8
Signed-off-by: Robert Lyon <robertl@catalyst.net.nz>

[Robert Lyon (robertl-9)](https://launchpad.net/~robertl-9)
on 2016-07-11

| **information type**: | Private Security → Public Security |
| --- | --- |

[Robert Lyon (robertl-9)](https://launchpad.net/~robertl-9)
on 2016-10-21

| Changed in mahara: | |
| --- | --- |
| **milestone**: | 16.04.1 → none |
| **status**: | Fix Committed → Fix Released |

[See full activity log](https://bugs.launchpad.net/mahara/%2Bbug/1234615/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/mahara/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/mahara/%2Bbug/1234615/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/mahara/%2Bbug/1234615/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/mahara/%2Bbug/1234615/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))


