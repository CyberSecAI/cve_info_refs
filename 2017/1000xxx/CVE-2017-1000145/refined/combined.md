=== Content from bugs.launchpad.net_8aeca6a5_20250124_131938.html ===

[Log in / Register](https://bugs.launchpad.net/mahara/%2Bbug/1460368/%2Blogin)

[![](https://launchpadlibrarian.net/302557383/mahara_64x64.png)](https://launchpad.net/mahara)

## [Mahara](https://launchpad.net/mahara)

* [Overview](https://launchpad.net/mahara)
* [Code](https://code.launchpad.net/mahara)
* [Bugs](https://bugs.launchpad.net/mahara)
* [Blueprints](https://blueprints.launchpad.net/mahara)
* [Translations](https://translations.launchpad.net/mahara)
* [Answers](https://answers.launchpad.net/mahara)

# Even if you disallow anonymous comments at the site level, you can still place anonymous comments on artefacts

Bug #1460368 reported by
[Wen-Chang Chien(簡文章)](https://launchpad.net/~wcchien)
on 2015-05-31

[264](/%2Bhelp-bugs/bug-heat.html)

This bug affects 2 people

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [Mahara](https://bugs.launchpad.net/mahara) | Fix Released | Medium | [Robert Lyon](https://launchpad.net/~robertl-9) | [Mahara 15.10.0](https://launchpad.net/mahara/%2Bmilestone/15.10.0) |
|  | [1.10](https://bugs.launchpad.net/mahara/1.10) | Fix Released | Medium | Unassigned | [Mahara 1.10.5](https://launchpad.net/mahara/%2Bmilestone/1.10.5) |
|  | [1.9](https://bugs.launchpad.net/mahara/1.9) | Fix Released | Medium | Unassigned | [Mahara 1.9.7](https://launchpad.net/mahara/%2Bmilestone/1.9.7) |
|  | [15.04](https://bugs.launchpad.net/mahara/15.04) | Fix Released | Medium | Unassigned | [Mahara 15.04.2](https://launchpad.net/mahara/%2Bmilestone/15.04.2) |
|  | [15.10](https://bugs.launchpad.net/mahara/15.10) | Fix Released | Medium | [Robert Lyon](https://launchpad.net/~robertl-9) | [Mahara 15.10.0](https://launchpad.net/mahara/%2Bmilestone/15.10.0) |

### Bug Description

Anonymous comments function is enabled on artefact page of public share page that disallow anonymous comments.

Here's how to replicate the specific bug:

0. Clean install of Mahara

1. Log in as admin

2. Got to Administration -> Configure site -> Ste options -> User Settings

3. Set [Anonymous comments] OFF

4. Go to Portfolio -> Create a new Page -> Store a picture on this page.

5. Edit this new page access -> Enable [Share with public] and [Allow comments].

6. Log out.

7. Open this page as guest role.

8. Click one picture of this page.

9. [Anonymous comments] function is enabled on artefact page.

I found the cause of this bug.

In /artefact/artefact.php, Line 149

==================================================

if ($artefact->get('allowcomments'))

    $addfeedbackform = pieform(ArtefactTypeComment::add\_comment\_form(false, $artefact->get('approvecomments')));

    $extrastylesheets[] = 'style/jquery.rating.css';

    $javascript[] = 'jquery.rating';

}

==================================================================

I suggest

if ($artefact->get('allowcomments'))

change to:

if ($artefact->get('allowcomments') && ( $USER->is\_logged\_in() || (!$USER->is\_logged\_in() && get\_config('anonymouscomments')))) {

Tags:

[feedback](/mahara/%2Bbugs?field.tag=feedback)

## CVE References

* [2017-1000145](/bugs/cve/2017-1000145 "Mahara 1.9 before 1.9.7 and 1.10 befo...")

[Robert Lyon (robertl-9)](https://launchpad.net/~robertl-9)
on 2015-06-02

| Changed in mahara: | |
| --- | --- |
| **status**: | New → In Progress |
| **importance**: | Undecided → High |
| **assignee**: | nobody → Robert Lyon (robertl-9) |
| **milestone**: | none → 15.10.0 |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Robert Lyon (robertl-9)](https://launchpad.net/~robertl-9) wrote on 2015-06-03: |  |  | [#1](/mahara/%2Bbug/1460368/comments/1) |
| --- | --- | --- | --- |

<https://reviews.mahara.org/#/c/4814/>

https://reviews.mahara.org/#/c/4814/

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Wells (u-aaronw)](https://launchpad.net/~u-aaronw) wrote on 2015-07-01: |  |  | [#2](/mahara/%2Bbug/1460368/comments/2) |
| --- | --- | --- | --- |

This bug is also present in Mahara 1.9, 1.10, and 15.04. (And probably earlier.)

Patch for 1.9: <https://reviews.mahara.org/4908>

Patch for 1.10: <https://reviews.mahara.org/4909>

Patch for 15.04: <https://reviews.mahara.org/#/c/4907>

This bug is also present in Mahara 1.9, 1.10, and 15.04. (And probably earlier.)
Patch for 1.9: https://reviews.mahara.org/4908
Patch for 1.10: https://reviews.mahara.org/4909
Patch for 15.04: https://reviews.mahara.org/#/c/4907

| **tags**: | added: feedback |
| --- | --- |
| **summary**: | - Anonymous comments function is enabled on artefact page of public share- page that disallow anonymous comments.+ Even if you disallow anonymous comments at the site level, you can still+ place anonymous comments on artefacts |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Wells (u-aaronw)](https://launchpad.net/~u-aaronw) wrote on 2015-07-10: |  |  | [#3](/mahara/%2Bbug/1460368/comments/3) |
| --- | --- | --- | --- |

Hi Wen-Chang Chien,

Thanks for reporting this issue! I've added your name to the list of security contributors to the Mahara project: <https://wiki.mahara.org/wiki/Contributors#Mahara_code>

Let me know if you'd like to have your Twitter handle or other website on there (or if you want to be removed from the page).

Cheers,

Aaron

Hi Wen-Chang Chien,
Thanks for reporting this issue! I've added your name to the list of security contributors to the Mahara project: https://wiki.mahara.org/wiki/Contributors#Mahara\_code
Let me know if you'd like to have your Twitter handle or other website on there (or if you want to be removed from the page).
Cheers,
Aaron

| **information type**: | Private Security → Public Security |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Wells (u-aaronw)](https://launchpad.net/~u-aaronw) wrote on 2015-07-10: |  |  | [#4](/mahara/%2Bbug/1460368/comments/4) |
| --- | --- | --- | --- |

Downgrading the severity on this one from "High" to "Medium", because the artefact owner still has to make their page public and allow comments.

Downgrading the severity on this one from "High" to "Medium", because the artefact owner still has to make their page public and allow comments.

[See full activity log](https://bugs.launchpad.net/mahara/%2Bbug/1460368/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/mahara/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

## Duplicates of this bug

* [Bug #1476823](https://bugs.launchpad.net/mahara/%2Bbug/1476823 "Anonymous comments aren't turned off for artefact comments")

You are
[not directly subscribed to this bug's notifications.](/mahara/%2Bbug/1460368/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/mahara/%2Bbug/1460368/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/mahara/%2Bbug/1460368/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))


