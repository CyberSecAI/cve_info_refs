=== Content from bugs.launchpad.net_99e4fede_20250124_222106.html ===

[Log in / Register](https://bugs.launchpad.net/mahara/%2Bbug/1567784/%2Blogin)

[![](https://launchpadlibrarian.net/302557383/mahara_64x64.png)](https://launchpad.net/mahara)

## [Mahara](https://launchpad.net/mahara)

* [Overview](https://launchpad.net/mahara)
* [Code](https://code.launchpad.net/mahara)
* [Bugs](https://bugs.launchpad.net/mahara)
* [Blueprints](https://blueprints.launchpad.net/mahara)
* [Translations](https://translations.launchpad.net/mahara)
* [Answers](https://answers.launchpad.net/mahara)

# Session ID's not being regenerated

Bug #1567784 reported by
[Aaron Wells](https://launchpad.net/~u-aaronw)
on 2016-04-08

[256](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [Mahara](https://bugs.launchpad.net/mahara) | Fix Released | High | Unassigned | [Mahara 16.04.0](https://launchpad.net/mahara/%2Bmilestone/16.04.0) |
|  | [15.04](https://bugs.launchpad.net/mahara/15.04) | Fix Released | High | Unassigned | [Mahara 15.04.7](https://launchpad.net/mahara/%2Bmilestone/15.04.7) |
|  | [15.10](https://bugs.launchpad.net/mahara/15.10) | Fix Released | High | Unassigned | [Mahara 15.10.3](https://launchpad.net/mahara/%2Bmilestone/15.10.3) |
|  | [16.04](https://bugs.launchpad.net/mahara/16.04) | Fix Released | High | Unassigned | [Mahara 16.04.0](https://launchpad.net/mahara/%2Bmilestone/16.04.0) |
|  | [16.10](https://bugs.launchpad.net/mahara/16.10) | Fix Released | High | Unassigned | [Mahara 16.10.0](https://launchpad.net/mahara/%2Bmilestone/16.10.0) |

### Bug Description

Security best practice requires that the session ID be changed whenever a user logs in or out (or makes other similar changes to their access level). If this is not done, then it makes session highjacking attacks a lot easier.

In PHP this is best done by calling the function session\_regenerate\_id(). And Mahara does indeed have quite old code that does this in htdocs/auth/user.php, whenever a user is logged in (but not logged out). However, this code stopped working in Mahara 15.04. This appears to be due to the changes we made to htdocs/auth/session.php to prevent session locking from interfering with ajax scripts, which cause session\_start() and session\_write\_close() to be called several times per script execution instead of just once.

We need to:

1. Make sure that session\_regenerate\_id() works correctly, so that the user's session ID really does change when they log in (preferrably in a way that will work for all auth methods)

2. And expand this so that the user's session ID is also changed when they log out.

## CVE References

* [2017-1000150](/bugs/cve/2017-1000150 "Mahara 15.04 before 15.04.7 and 15.10...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Wells (u-aaronw)](https://launchpad.net/~u-aaronw) wrote on 2016-04-15: |  |  | [#1](/mahara/%2Bbug/1567784/comments/1) |
| --- | --- | --- | --- |

Patch: <https://reviews.mahara.org/6349>

Patch: https://reviews.mahara.org/6349

[Aaron Wells (u-aaronw)](https://launchpad.net/~u-aaronw)
on 2016-04-21

| **information type**: | Private Security → Public Security |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Mahara Bot (dev-mahara)](https://launchpad.net/~dev-mahara) wrote on 2016-04-21:  [**A change has been merged**](/mahara/%2Bbug/1567784/comments/2) |  |  | [#2](/mahara/%2Bbug/1567784/comments/2) |
| --- | --- | --- | --- |

Reviewed: <https://reviews.mahara.org/6374>

Committed: <https://git.mahara.org/mahara/mahara/commit/16305b41e01dbe04e81c22f79dc5ee2fb63336f9>

Submitter: Aaron Wells (<email address hidden>)

Branch: 16.04\_STABLE

commit 16305b41e01dbe04e81c22f79dc5ee2fb63336f9

Author: Aaron Wells <email address hidden>

Date: Fri Apr 15 20:16:06 2016 +1200

[Bug 1567784](/bugs/1567784): session\_regenerate\_id() not working

We have existing code that tries to regenerate your

session ID when you log in. But it stopped working

in PHP 15.04 because the session has usually been

closed when it gets called.

Change-Id: I5f99cdf355892040866bb0113fd934e3d37bf33c

behatnotneeded: Can't be tested by behat

(cherry picked from commit a923f51be7723a640b4ddbcf9163a8128b9ec4b3)

Reviewed: https://reviews.mahara.org/6374
Committed: https://git.mahara.org/mahara/mahara/commit/16305b41e01dbe04e81c22f79dc5ee2fb63336f9
Submitter: Aaron Wells (aaronw@catalyst.net.nz)
Branch: 16.04\_STABLE
commit 16305b41e01dbe04e81c22f79dc5ee2fb63336f9
Author: Aaron Wells <aaronw@catalyst.net.nz>
Date: Fri Apr 15 20:16:06 2016 +1200
Bug 1567784: session\_regenerate\_id() not working
We have existing code that tries to regenerate your
session ID when you log in. But it stopped working
in PHP 15.04 because the session has usually been
closed when it gets called.
Change-Id: I5f99cdf355892040866bb0113fd934e3d37bf33c
behatnotneeded: Can't be tested by behat
(cherry picked from commit a923f51be7723a640b4ddbcf9163a8128b9ec4b3)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Mahara Bot (dev-mahara)](https://launchpad.net/~dev-mahara) wrote on 2016-04-21: |  |  | [#3](/mahara/%2Bbug/1567784/comments/3) |
| --- | --- | --- | --- |

Reviewed: <https://reviews.mahara.org/6375>

Committed: <https://git.mahara.org/mahara/mahara/commit/fef939a0435353067d07c16154d347cfd7c039d1>

Submitter: Robert Lyon (<email address hidden>)

Branch: 15.10\_STABLE

commit fef939a0435353067d07c16154d347cfd7c039d1

Author: Aaron Wells <email address hidden>

Date: Fri Apr 15 20:16:06 2016 +1200

[Bug 1567784](/bugs/1567784): session\_regenerate\_id() not working

We have existing code that tries to regenerate your

session ID when you log in. But it stopped working

in PHP 15.04 because the session has usually been

closed when it gets called.

Change-Id: I5f99cdf355892040866bb0113fd934e3d37bf33c

behatnotneeded: Can't be tested by behat

(cherry picked from commit a923f51be7723a640b4ddbcf9163a8128b9ec4b3)

Reviewed: https://reviews.mahara.org/6375
Committed: https://git.mahara.org/mahara/mahara/commit/fef939a0435353067d07c16154d347cfd7c039d1
Submitter: Robert Lyon (robertl@catalyst.net.nz)
Branch: 15.10\_STABLE
commit fef939a0435353067d07c16154d347cfd7c039d1
Author: Aaron Wells <aaronw@catalyst.net.nz>
Date: Fri Apr 15 20:16:06 2016 +1200
Bug 1567784: session\_regenerate\_id() not working
We have existing code that tries to regenerate your
session ID when you log in. But it stopped working
in PHP 15.04 because the session has usually been
closed when it gets called.
Change-Id: I5f99cdf355892040866bb0113fd934e3d37bf33c
behatnotneeded: Can't be tested by behat
(cherry picked from commit a923f51be7723a640b4ddbcf9163a8128b9ec4b3)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Mahara Bot (dev-mahara)](https://launchpad.net/~dev-mahara) wrote on 2016-04-21: |  |  | [#4](/mahara/%2Bbug/1567784/comments/4) |
| --- | --- | --- | --- |

Reviewed: <https://reviews.mahara.org/6376>

Committed: <https://git.mahara.org/mahara/mahara/commit/4692ab43960fbd3819bbf007877ebccb1cc98fd0>

Submitter: Robert Lyon (<email address hidden>)

Branch: 15.04\_STABLE

commit 4692ab43960fbd3819bbf007877ebccb1cc98fd0

Author: Aaron Wells <email address hidden>

Date: Fri Apr 15 20:16:06 2016 +1200

[Bug 1567784](/bugs/1567784): session\_regenerate\_id() not working

We have existing code that tries to regenerate your

session ID when you log in. But it stopped working

in PHP 15.04 because the session has usually been

closed when it gets called.

Change-Id: I5f99cdf355892040866bb0113fd934e3d37bf33c

behatnotneeded: Can't be tested by behat

(cherry picked from commit a923f51be7723a640b4ddbcf9163a8128b9ec4b3)

Reviewed: https://reviews.mahara.org/6376
Committed: https://git.mahara.org/mahara/mahara/commit/4692ab43960fbd3819bbf007877ebccb1cc98fd0
Submitter: Robert Lyon (robertl@catalyst.net.nz)
Branch: 15.04\_STABLE
commit 4692ab43960fbd3819bbf007877ebccb1cc98fd0
Author: Aaron Wells <aaronw@catalyst.net.nz>
Date: Fri Apr 15 20:16:06 2016 +1200
Bug 1567784: session\_regenerate\_id() not working
We have existing code that tries to regenerate your
session ID when you log in. But it stopped working
in PHP 15.04 because the session has usually been
closed when it gets called.
Change-Id: I5f99cdf355892040866bb0113fd934e3d37bf33c
behatnotneeded: Can't be tested by behat
(cherry picked from commit a923f51be7723a640b4ddbcf9163a8128b9ec4b3)

[Robert Lyon (robertl-9)](https://launchpad.net/~robertl-9)
on 2016-10-21

| Changed in mahara: | |
| --- | --- |
| **status**: | Fix Committed → Fix Released |

[See full activity log](https://bugs.launchpad.net/mahara/%2Bbug/1567784/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/mahara/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/mahara/%2Bbug/1567784/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/mahara/%2Bbug/1567784/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/mahara/%2Bbug/1567784/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))


