=== Content from bugs.launchpad.net_19821604_20250125_052530.html ===

[Log in / Register](https://bugs.launchpad.net/mahara/%2Bbug/1447377/%2Blogin)

[![](https://launchpadlibrarian.net/302557383/mahara_64x64.png)](https://launchpad.net/mahara)

## [Mahara](https://launchpad.net/mahara)

* [Overview](https://launchpad.net/mahara)
* [Code](https://code.launchpad.net/mahara)
* [Bugs](https://bugs.launchpad.net/mahara)
* [Blueprints](https://blueprints.launchpad.net/mahara)
* [Translations](https://translations.launchpad.net/mahara)
* [Answers](https://answers.launchpad.net/mahara)

# Stored XSS in user reports access lists, and shared tabs for user/group/institution

Bug #1447377 reported by
[Hugh Davenport](https://launchpad.net/~hugh-davenport)
on 2015-04-22

[256](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [Mahara](https://bugs.launchpad.net/mahara) | Fix Released | Critical | [Hugh Davenport](https://launchpad.net/~hugh-davenport) | [Mahara 15.10.0](https://launchpad.net/mahara/%2Bmilestone/15.10.0) |
|  | [1.10](https://bugs.launchpad.net/mahara/1.10) | Fix Released | Critical | Unassigned | [Mahara 1.10.4](https://launchpad.net/mahara/%2Bmilestone/1.10.4) |
|  | [1.9](https://bugs.launchpad.net/mahara/1.9) | Fix Released | Critical | Unassigned | [Mahara 1.9.6](https://launchpad.net/mahara/%2Bmilestone/1.9.6) |
|  | [15.04](https://bugs.launchpad.net/mahara/15.04) | Fix Released | Critical | Unassigned | [Mahara 15.04.1](https://launchpad.net/mahara/%2Bmilestone/15.04.1) |
|  | [15.10](https://bugs.launchpad.net/mahara/15.10) | Fix Released | Undecided | Unassigned |  |

### Bug Description

This one requires a malicious institution admin, but could still result in privilege escalation to full admin.

Steps to reproduce:

- As admin, create a new institution, and a new user with admin rights in that institution

- Log in as new institution admin, change name of institution to "<script>alert(1);</script>"

- Add some new users to the institution, their profile pages will automatically be shared with the institution

- If full admin runs a user report on that new user now, and views access list, they will see the XSS

- If a user shares a page with this institution, then views "Shared by me", then it will trigger

- If a group shares a page ..., it will trigger

- If a institution shares a page ..., it will trigger (can be a different institution, just have to be in same institution to be able to share with it (or it is searchable?)).

Mainly low risk, as doesn't gain privilege, but the full admin may view access list report of all users legitimately, so that makes it critical as privilege escalation is possible (walled gardens setups where lots of institution admins, and they aren't full admins).

Patch to come.

Cheers,

Hugh

## CVE References

* [2017-1000144](/bugs/cve/2017-1000144 "Mahara 1.9 before 1.9.6 and 1.10 befo...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Hugh Davenport (hugh-davenport)](https://launchpad.net/~hugh-davenport) wrote on 2015-04-22: |  |  | [#1](/mahara/%2Bbug/1447377/comments/1) |
| --- | --- | --- | --- |

* [bug-1447377.patch](https://bugs.launchpad.net/mahara/%2Bbug/1447377/%2Battachment/4381828/%2Bfiles/bug-1447377.patch)
  [Edit](/mahara/%2Bbug/1447377/%2Battachment/4381828)
  (2.5 KiB,
  text/plain)

Patch added

Patch added

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Robert Lyon (robertl-9)](https://launchpad.net/~robertl-9) wrote on 2015-04-28: |  |  | [#2](/mahara/%2Bbug/1447377/comments/2) |
| --- | --- | --- | --- |

Hi Hugh,

I've added a patch to gerrit for this:

<https://reviews.mahara.org/#/c/4698/>

It's based on your patch - but with a slight change - see comment in gerrit

Hi Hugh,
I've added a patch to gerrit for this:
https://reviews.mahara.org/#/c/4698/
It's based on your patch - but with a slight change - see comment in gerrit

| Changed in mahara: | |
| --- | --- |
| **status**: | Triaged → In Progress |
| **milestone**: | none → 15.10.0 |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jinelle Foley-Barnes (jinelleb)](https://launchpad.net/~jinelleb) wrote on 2015-04-30: |  |  | [#3](/mahara/%2Bbug/1447377/comments/3) |
| --- | --- | --- | --- |

Hi,

I've been trying to test this, I think I may be going wrong.

- As admin, create a new institution, and a new user with admin rights in that institution

- Log in as new institution admin, change name of institution to "<script>alert(1);</script>"

I couldn't do step 2 because when I logged in as new institution admin I couldn't access institutions because I'm not a site admin. However I did see that I got the confirmation message to say that I had become the Institution admin of the "testing" institution. I just couldn't access it.

Let me know where I’m going wrong.

Thanks,

Jinelle

Hi,
I've been trying to test this, I think I may be going wrong.
- As admin, create a new institution, and a new user with admin rights in that institution
- Log in as new institution admin, change name of institution to "<script>alert(1);</script>"
I couldn't do step 2 because when I logged in as new institution admin I couldn't access institutions because I'm not a site admin. However I did see that I got the confirmation message to say that I had become the Institution admin of the "testing" institution. I just couldn't access it.
Let me know where I’m going wrong.
Thanks,
Jinelle

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Mahara Bot (dev-mahara)](https://launchpad.net/~dev-mahara) wrote on 2015-05-28:  [**A change has been merged**](/mahara/%2Bbug/1447377/comments/4) |  |  | [#4](/mahara/%2Bbug/1447377/comments/4) |
| --- | --- | --- | --- |

Reviewed: <https://reviews.mahara.org/4778>

Committed: <https://git.nzoss.org.nz/mahara/mahara/commit/fff46e5493c0cb17ce03defccc7a6b738615a4b1>

Submitter: Robert Lyon (<email address hidden>)

Branch: 15.04\_STABLE

commit fff46e5493c0cb17ce03defccc7a6b738615a4b1

Author: Hugh Davenport <email address hidden>

Date: Tue Apr 28 12:38:56 2015 +1200

Escape institution\_display\_name correctly ([Bug #1447377](/bugs/1447377))

Institution names were not being escaped properly in the

accesslist.

This patch escapes them properly as well as clearing the

compiled cache for the templates where this problem occurs.

Change-Id: I2e675af0b84a3a7106e0245a5faa6ee2095a7e06

Signed-off-by: Robert Lyon <email address hidden>

Reviewed: https://reviews.mahara.org/4778
Committed: https://git.nzoss.org.nz/mahara/mahara/commit/fff46e5493c0cb17ce03defccc7a6b738615a4b1
Submitter: Robert Lyon (robertl@catalyst.net.nz)
Branch: 15.04\_STABLE
commit fff46e5493c0cb17ce03defccc7a6b738615a4b1
Author: Hugh Davenport <hugh@catalyst.net.nz>
Date: Tue Apr 28 12:38:56 2015 +1200
Escape institution\_display\_name correctly (Bug #1447377)
Institution names were not being escaped properly in the
accesslist.
This patch escapes them properly as well as clearing the
compiled cache for the templates where this problem occurs.
Change-Id: I2e675af0b84a3a7106e0245a5faa6ee2095a7e06
Signed-off-by: Robert Lyon <robertl@catalyst.net.nz>

[Aaron Wells (u-aaronw)](https://launchpad.net/~u-aaronw)
on 2015-05-28

| Changed in mahara: | |
| --- | --- |
| **status**: | In Progress → Fix Committed |
| **information type**: | Private Security → Public Security |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Mahara Bot (dev-mahara)](https://launchpad.net/~dev-mahara) wrote on 2015-05-28: |  |  | [#5](/mahara/%2Bbug/1447377/comments/5) |
| --- | --- | --- | --- |

Reviewed: <https://reviews.mahara.org/4777>

Committed: <https://git.nzoss.org.nz/mahara/mahara/commit/66efb9a70fd2e1ace257252147d5b5754658239d>

Submitter: Aaron Wells (<email address hidden>)

Branch: 1.10\_STABLE

commit 66efb9a70fd2e1ace257252147d5b5754658239d

Author: Hugh Davenport <email address hidden>

Date: Tue Apr 28 12:38:56 2015 +1200

Escape institution\_display\_name correctly ([Bug #1447377](/bugs/1447377))

Institution names were not being escaped properly in the

accesslist.

This patch escapes them properly as well as clearing the

compiled cache for the templates where this problem occurs.

Change-Id: I2e675af0b84a3a7106e0245a5faa6ee2095a7e06

Signed-off-by: Robert Lyon <email address hidden>

Reviewed: https://reviews.mahara.org/4777
Committed: https://git.nzoss.org.nz/mahara/mahara/commit/66efb9a70fd2e1ace257252147d5b5754658239d
Submitter: Aaron Wells (aaronw@catalyst.net.nz)
Branch: 1.10\_STABLE
commit 66efb9a70fd2e1ace257252147d5b5754658239d
Author: Hugh Davenport <hugh@catalyst.net.nz>
Date: Tue Apr 28 12:38:56 2015 +1200
Escape institution\_display\_name correctly (Bug #1447377)
Institution names were not being escaped properly in the
accesslist.
This patch escapes them properly as well as clearing the
compiled cache for the templates where this problem occurs.
Change-Id: I2e675af0b84a3a7106e0245a5faa6ee2095a7e06
Signed-off-by: Robert Lyon <robertl@catalyst.net.nz>

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Mahara Bot (dev-mahara)](https://launchpad.net/~dev-mahara) wrote on 2015-06-03: |  |  | [#6](/mahara/%2Bbug/1447377/comments/6) |
| --- | --- | --- | --- |

Reviewed: <https://reviews.mahara.org/4810>

Committed: <https://git.nzoss.org.nz/mahara/mahara/commit/721bddaa3413c67ab816f1e02940c6c31d5682fc>

Submitter: Robert Lyon (<email address hidden>)

Branch: master

commit 721bddaa3413c67ab816f1e02940c6c31d5682fc

Author: Aaron Wells <email address hidden>

Date: Fri May 29 10:43:03 2015 +1200

Add log description to lib/db/upgrade.php block

[Bug 1447377](/bugs/1447377)

Change-Id: Id0f64a6dc883f31de69595a05a321e2ec7ac1b09

Reviewed: https://reviews.mahara.org/4810
Committed: https://git.nzoss.org.nz/mahara/mahara/commit/721bddaa3413c67ab816f1e02940c6c31d5682fc
Submitter: Robert Lyon (robertl@catalyst.net.nz)
Branch: master
commit 721bddaa3413c67ab816f1e02940c6c31d5682fc
Author: Aaron Wells <aaronw@catalyst.net.nz>
Date: Fri May 29 10:43:03 2015 +1200
Add log description to lib/db/upgrade.php block
Bug 1447377
Change-Id: Id0f64a6dc883f31de69595a05a321e2ec7ac1b09

[Aaron Wells (u-aaronw)](https://launchpad.net/~u-aaronw)
on 2015-10-23

| Changed in mahara: | |
| --- | --- |
| **status**: | Fix Committed → Fix Released |

[See full activity log](https://bugs.launchpad.net/mahara/%2Bbug/1447377/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/mahara/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/mahara/%2Bbug/1447377/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/mahara/%2Bbug/1447377/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/mahara/%2Bbug/1447377/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [bug-1447377.patch](https://bugs.launchpad.net/mahara/%2Bbug/1447377/%2Battachment/4381828/%2Bfiles/bug-1447377.patch)
  [Edit](/mahara/%2Bbug/1447377/%2Battachment/4381828 "Change patch details")

* [Add patch](/mahara/%2Bbug/1447377/%2Baddcomment?field.patch=on)

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))


