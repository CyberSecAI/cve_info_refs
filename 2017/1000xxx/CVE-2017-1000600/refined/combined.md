=== Content from youtu.be_17ff6522_20250125_180730.html ===
[00:06] thank you so for the last nine years
[00:10] we've underestimated the impact of a
[00:13] common class of wonder abilities in PHP
[00:16] applications hundreds probably thousands
[00:19] of instances of this issue have been
[00:20] found we've overlooked a simple behavior
[00:23] in PHP which exposes them to
[00:25] exploitation through on serialization my
[00:29] name salmon one way or another I spend a
[00:32] lot of my time exploiting web
[00:34] applications while attacking web
[00:37] applications so what I tend to do is ask
[00:40] myself what vonner abilities does this
[00:42] app have and what's the impact of
[00:44] exploiting those issues the research I'm
[00:47] gonna talk about today doesn't have much
[00:48] impact on the first part of that
[00:50] question so I'll be talking about
[00:52] vulnerabilities that you've probably
[00:53] thought you already knew about but I'll
[00:56] be giving you a different answer than
[00:57] you might have expected for what the
[01:00] impact of exploiting them is so before I
[01:03] talk about my own research I think it's
[01:04] really important to say that this is
[01:06] really just a tiny addition to some
[01:09] wonderful research done by a man called
[01:11] Stephan Esther about ten years ago so he
[01:15] discovered this issue in PHP with on
[01:18] serialization and so our serialization
[01:22] is for those of you who don't know
[01:24] really basically it's basically a
[01:25] process by which PHP converts internal
[01:30] objects into a string representation
[01:31] that can be stored in a database or
[01:34] passed over the wire and then converted
[01:36] back to an object in PHP the examples on
[01:39] the slide are really simple so I've just
[01:40] given like an integer and a string but
[01:43] it can deal with much more complicated
[01:45] objects and what Stefan SR realized was
[01:48] that there's a technique quite closely
[01:50] related to return orientated programming
[01:51] called property orientated programming
[01:54] whereby you can construct sort of a
[01:57] malicious objects that if you get
[01:58] everything right upon being unsterilized
[02:01] will sort of cause a chain of methods to
[02:03] be caught and cause something malicious
[02:05] to happen so as the issue is
[02:09] additionally understood there's a
[02:10] function called uncie realized on PHP
[02:13] and that's called on some data and as I
[02:17] mentioned basically certain methods are
[02:19] automatically invoked upon unsee
[02:21] realization so there's a method called
[02:22] wakeup which is called whenever an
[02:25] object is unsee realized and there's
[02:27] also a method called destruct which is
[02:29] called whenever an object is destroyed
[02:32] if we get things just right basically we
[02:34] can sort of chain together certain
[02:36] objects so that something nasty happens
[02:39] if you're not familiar with that issue I
[02:41] can't encourage you enough to sort of
[02:44] read Stephanie's research I gave a talk
[02:47] myself here three years ago I think sort
[02:50] of covering a lot of the same material
[02:52] but for the rest of this presentation
[02:53] you'll just have to accept that
[02:55] serialization is bad okay so what am I
[03:00] going to go through today I'm going to
[03:02] start by talking about something called
[03:04] stream wrappers which is a functionality
[03:06] in PHP which basically can be triggered
[03:10] on any file operation and I'll go
[03:13] through a bunch of those and we'll end
[03:15] up focusing in on the what's called the
[03:17] fast dream wrapper which deals with a
[03:19] type of archive called a far archive
[03:21] which is sort of supposed to be the PHP
[03:24] equivalent of jar archives I'll talk
[03:27] about something called file planting so
[03:30] we're going to need to get one of these
[03:31] archives on to our target system the
[03:34] easiest way is just to upload one if
[03:35] we've got that functionality in the app
[03:37] but there's a couple of other things we
[03:39] could look at if we can't do that
[03:41] identifying the type of vulnerabilities
[03:43] that are affected by this issue then I'm
[03:46] going to talk about there's a really
[03:48] nice tool called PHP GGC the GGC is for
[03:51] generic gadget chains by a guy called
[03:55] Charles Fong who works for handy onyx I
[03:57] think and that's sort of why say serial
[04:01] foe PHP if you're familiar with white so
[04:03] serial in Java exploitation and he's
[04:06] kindly given me permission to release a
[04:09] branch sort of alongside this talk which
[04:11] uses some of the techniques I'm talking
[04:13] about to embed some of the payloads that
[04:15] are already included with that tool in a
[04:17] in a far archive then I'll go through a
[04:20] number of case studies talk briefly
[04:22] about how we could defend against this
[04:24] issue and then a few things to take away
[04:27] okay so the first part of this talk is
[04:30] essentially adventures in going in
[04:33] reading the PHP manual and I came across
[04:36] this cartoon which might not make that
[04:38] much sense at the moment but we'll go
[04:40] back to it after I've shown you some
[04:41] stuff from the manual and then it will
[04:43] hopefully make more sense okay so this
[04:47] is the page in the PHP manual which
[04:48] describes Stream wrappers so essentially
[04:52] it comes with lots of these built in
[04:54] Stream wrappers and there's a list at
[04:55] the bottom of the ones which are enabled
[04:56] by default and they're triggered by all
[04:59] sorts of different file operations so
[05:01] opening a file or checking your for file
[05:03] exists copying a file that kind of thing
[05:07] these have been used to other stream
[05:10] wrappers have been used in lots of
[05:11] different sort of exploit techniques so
[05:13] you'll hopefully be quite familiar with
[05:16] the remote stream wrappers which I've
[05:18] grouped here file HTTP FTP and data data
[05:22] is not strictly remote but it does
[05:24] require this setting allow you are LF
[05:26] open to be true to use it so it sort of
[05:29] falls neatly into that category so these
[05:32] are these stream wrappers that
[05:34] essentially you use to access external
[05:36] files from PHP so it can turn a local
[05:40] file include into a remote file included
[05:42] if you can provide like a HTTP URL it
[05:45] will go off and grab that file and
[05:47] include it as code often these are the
[05:49] things behind server side request
[05:51] forgery issues so for instance if we've
[05:53] got a call to file get contents and we
[05:55] control the argument we can give it an
[05:57] HTTP or an FTP argument and it will go
[06:00] off and get that file and finally
[06:02] they're activated by X X Z so X and our
[06:05] external entity issues the next stream
[06:12] wrapper I wanted to talk about is the
[06:13] PHP stream wrapper so that's often used
[06:17] for instance in local file included
[06:19] exploits we can use PHP code on such
[06:21] that input to grab standard i/o which
[06:24] will be what we've posted to a page if
[06:26] we're you know if PHP is running as a as
[06:30] a web server there's a quite a neat
[06:33] technique you can use to read the source
[06:35] code of a file with a local file include
[06:38] because this stream wrapper includes
[06:40] some filtering functionality so if we
[06:43] included a PHP file from another PHP
[06:46] file it's going to try and run that but
[06:47] if we want to read the source code we
[06:49] can base 64 encode that then include it
[06:52] and then on our end we can basics
[06:54] defrauding code that and read the source
[06:56] code Stephan essay used a really neat
[06:59] sort of variation of this on one of his
[07:02] early on serialization exploits so he
[07:04] was able to put together a chain which
[07:06] would write arbitrary data to a file but
[07:09] there was a prefix on the file which was
[07:11] PHP Die which would stop any code after
[07:14] that from running well what he managed
[07:16] to do was essentially
[07:17] base 64 decode everything before it was
[07:20] written to the file and that sort of
[07:22] nullifies this header and then he could
[07:24] prepare his other data to write anything
[07:26] to the file the next stream wrapper is
[07:29] glob whenever I come across this I think
[07:32] it's going to be really useful but it
[07:34] works differently from the others so you
[07:36] can for instance call file get contents
[07:38] glob and then a path and get a listing
[07:41] of files this is the example from the
[07:44] manual of how it's used so it's used
[07:45] with the directory iterator there and
[07:48] there's a page in the manual that lists
[07:50] all the operations supported by any
[07:52] stream wrapper and the glob stream
[07:53] wrapper literally supports none of them
[07:56] so there's two stream wrap has left as
[07:59] they deliver and four which are both
[08:00] related to archives so if we're looking
[08:03] to exploit those what we could think
[08:05] about is if there's issues in the native
[08:07] code so maybe we could supply sort of a
[08:09] malicious archive and try and trigger
[08:12] some memory corruption or something like
[08:14] that that's going to be quite difficult
[08:17] to exploit sort of in the presence of
[08:19] modern mitigations like a SLR and Det
[08:22] now obviously there's something else
[08:25] there otherwise I wouldn't be giving
[08:26] this talk so we'll focus in on the far
[08:29] wrapper
[08:30] and within the manual it lists
[08:33] everything that's in a far archive and
[08:35] the first thing it lists is quite
[08:37] interesting so there's something called
[08:39] a stub and the stub contains PHP code so
[08:42] immediately as an attacker we think what
[08:45] can we get it to run that code through
[08:47] the stream wrapper so I wrote a simple
[08:49] test program to set the stub to just
[08:52] echo something out and then to access
[08:54] the file through the stream wrapper and
[08:58] unsurprisingly it doesn't trigger that
[09:00] code and just to sort of confirm that
[09:02] everything was working as I expected we
[09:04] can execute that archive and the stub
[09:06] does get executed now as best as I can
[09:09] tell essentially that's the only
[09:11] circumstance in which that code gets run
[09:13] if we access that file as an executor
[09:17] not wanting to be desired we move on to
[09:19] the next element of the file and there's
[09:21] something called a manifest in all four
[09:23] archives and if we look at the manual
[09:26] page which lists what within a manifest
[09:28] there's something very interesting in
[09:30] there so we can have metadata in this
[09:33] archive which is contained in the
[09:34] manifest which is in the standard
[09:36] serialized format so sort of again not
[09:39] expecting it to work but we may as well
[09:41] try I constructed a simple sort of test
[09:45] program so we define a class called test
[09:48] object and we set the metadata to an
[09:50] instance of this class and then another
[09:52] test program which again defines this
[09:55] class but also has a destructor defined
[09:57] this time so that if the object gets
[09:59] unsterilized and destroyed it should
[10:00] trigger this code and we're going to
[10:03] access a file in the archive and
[10:05] surprise surprise it actually does work
[10:08] so if we can put serialized data within
[10:11] an archive and then access it through
[10:12] the stream wrapper that will be unsee
[10:15] realized and if it hadn't been so
[10:17] obvious you would have done something
[10:18] like that okay so just to sort of
[10:23] confirm that everything is working as I
[10:25] expected I made a couple more test
[10:26] programs so instead of getting the
[10:28] contents of a file within that archive
[10:30] we'll just check whether the file exists
[10:32] and also we can check whether a file
[10:35] that clearly doesn't exist exists and
[10:38] both times the destructor still gets
[10:40] called so hopefully now that makes a
[10:44] little bit more sense so from this sort
[10:49] of obvious attack methodology emerges
[10:51] with sort of two parts so we had need to
[10:54] get one of these archives onto the
[10:55] target and then we need to reference it
[10:58] through the stream wrapper to cause our
[11:00] payload to be unsee realized and this is
[11:02] quite similar to local file include
[11:05] vulnerabilities so in that case we need
[11:08] to get a file onto the target and then
[11:09] include the source code so if you are
[11:13] familiar with the sort of standard on
[11:15] serialization issue there's a couple of
[11:18] differences to be aware of so when a
[11:21] normal uncie realization issue occurs
[11:24] the application is very deliberately
[11:25] uncie realized something and then does
[11:27] something with it so it's often easy to
[11:30] access a number of magic methods so not
[11:33] just this destruct and wake up for
[11:35] instance there's one called two string
[11:36] so we could you know try and trigger a
[11:39] chain that way in this case the
[11:41] applications not really had any
[11:43] intention to one serialize anything so
[11:45] we only have destruct and wake up to
[11:47] start our chain from and there's a sort
[11:50] of a quirk that means it within a
[11:53] destruct chain we've lost the current
[11:55] paths or anything any file operations we
[11:57] do within that chain we need to use
[11:59] absolute birth okay are the I showed you
[12:04] a lot of copies of this slide with the
[12:06] different elements of a fire archive the
[12:08] third element is the file contents which
[12:10] I hope is obvious the fourth element is
[12:12] a signature which it says is optional
[12:15] but by default PHP will only access one
[12:18] of these archives if it has a valid
[12:20] signature so that's not optional to us
[12:22] as an attacker
[12:25] okay that you've probably seen enough of
[12:27] the manual now so I'm going to take a
[12:29] few things out of it and hopefully you
[12:30] can trust me that this is what the
[12:32] manual says there's three valid formats
[12:35] for a fire file sort of the base file
[12:37] format tar format and zip format for now
[12:41] I'm going to ignore the zip format so
[12:42] that might be useful if we were
[12:44] attacking a system which had some
[12:46] legitimate functionality which allowed
[12:48] us to upload a zip file but fahren tar
[12:52] both have some sort of interesting
[12:54] flexibilities in their format that could
[12:56] be exploitable to us so we'll start off
[12:58] with the base file format I've done has
[13:01] sort of a little hex dump with all the
[13:03] different elements in it and if I can
[13:06] from here the green is the serialized
[13:09] metadata in the sort of standard format
[13:12] so that's probably the most interesting
[13:14] thing to us but what I wanted you to
[13:16] actually notice is for the stub so that
[13:19] stub never got run but we can set it to
[13:21] essentially anything we want as long as
[13:23] it includes this small segment of code
[13:25] and that means we can prefix a valid
[13:28] archive with anything we want we can put
[13:30] it in the stub and that will be the
[13:32] start of the file so we can fake a lot
[13:34] of file formats by simply putting data
[13:36] into the stub now sometimes that might
[13:40] not be quite enough for us and there's
[13:42] some interesting flexibilities in the
[13:44] tar file format that allow us to do
[13:46] something else I'm not going to go sort
[13:48] of into the full details of that file
[13:50] format but these are sort of the the
[13:53] important points and these two in
[13:56] particular so the first 100 bytes of a
[13:59] tar archive is the file name of the
[14:01] first file in the r-mo so that's quite
[14:03] flexible to us we can change that and
[14:05] we're simply changing the name of the
[14:07] file and the end of the archive is
[14:09] marked 1,024 zero bytes and anything
[14:13] after that is ignored so this is quite
[14:15] useful for us to sort of make files that
[14:18] might pose as two different formats so
[14:21] to just to go through it really simply
[14:23] here's here's another hex dump this is
[14:25] at the start of a tar archive what I can
[14:29] do is change the name of that first file
[14:32] to what looks like gibberish but if I go
[14:34] through I said the first two bytes to a
[14:36] JPEG header the next two bytes say
[14:39] basically this is a comment within the
[14:40] JPEG file and the next two bytes to the
[14:43] length of that comment now we can set
[14:45] that length to encompass the whole of
[14:47] the archive and then just carry on a
[14:49] JPEG file afterwards and because we've
[14:51] got those 1,024 null bytes the PHP when
[14:58] it's dealing with the archive will
[14:59] ignore everything after that and
[15:00] something dealing with the image will
[15:03] see the archive essentially as a comment
[15:05] and everything else is the image so
[15:08] hopefully I've got one of these in the
[15:10] distant so this is just a picture of my
[15:14] cat you're missing some good pictures of
[15:40] my cat prepared like a song-and-dance
[16:10] routine
[16:24] so make sure so HDMI so I meant to
[16:27] strike finish a PC right back to the
[16:46] important stuff a picture of my cat if I
[16:51] change the file name of the picture
[16:52] might go and open it with an archive
[17:01] program we can see it's recognized as a
[17:03] tower
[17:07] right so it's got this unusually named
[17:10] fun in it but it's also got all the
[17:12] elements of a file file which I
[17:14] mentioned earlier so it's got the stub
[17:16] and the metadata which is in the
[17:20] standard PHP serialized format and it's
[17:24] got the signature which isn't really
[17:26] sort of human readable but so we can see
[17:31] that it's essentially a perfect polyglot
[17:33] so the you know depending on which
[17:36] application is using it it views it as a
[17:38] perfectly legitimate sort of file of
[17:41] that format so I mentioned earlier about
[17:50] our sort of fall planting so is there
[17:52] anything beyond just uploading a file to
[17:55] the target application we can do to get
[17:57] one on there so there's a couple of
[18:02] tricks from local file inclusion that we
[18:05] could use I've referenced them there
[18:07] so Brett Moore came up with a really
[18:10] cool technique with PHP Mpho whereby
[18:14] basically if you upload a file to a PHP
[18:16] page it gets saved to the temporary
[18:18] folder and the dollar underscore files
[18:22] array gets populated and if I'm PHP info
[18:27] outputs this so it will tell us where
[18:29] that temporary file is but as soon as
[18:30] PHP info has finished outputting it will
[18:32] delete that file but what we can do is
[18:34] sort of store PHP info by refusing to
[18:37] receive its output once we've got what
[18:40] we need and that will cause the fire to
[18:41] persist for some time Jimmy ran smart
[18:45] demonstrated that there's basically
[18:48] really low entropy in the names of these
[18:50] files on windows so a bit of feedback
[18:55] I've had after I gave this talk last
[18:57] week if black cat has made me realise
[18:59] that one of the things I put up here
[19:01] isn't really feasible so the session
[19:03] file stuff you can only trigger this on
[19:06] a file which has an extension so in
[19:09] Windows the temporary files will have
[19:11] the TMP extension but in Linux they
[19:15] won't and as far as I know in both
[19:17] session files won't have an extent
[19:19] you can't trigger this issue on a file
[19:21] with no extension and then finally up
[19:25] but sort of mentioned log files there
[19:26] I've not managed to pull it off but in
[19:28] theory it's possible it's quite
[19:30] difficult too we need to know the entire
[19:32] contents of the file to calculate a
[19:34] valid signature for whatever we're going
[19:35] to append on the end of that file or you
[19:38] know in the middle of it okay so in
[19:42] terms of identifying the vulnerabilities
[19:44] that are affected by this it's
[19:46] essentially all X X E and a number of SS
[19:49] are F issues on PHP applications I
[19:52] thought it was worth mentioning that
[19:54] there's an option which is sometimes
[19:56] used to protect against exit C which is
[19:59] the no net option which says no network
[20:01] because this is dealing only with local
[20:03] files that doesn't protect against this
[20:06] if we're looking to sort of detect the
[20:09] fact that we can use Stream wrappers you
[20:12] know in a black box way it's much more
[20:15] preferable to use the FTP wrapper than
[20:17] the HTTP wrapper because it supports a
[20:19] lot more operations and I'll demonstrate
[20:22] that shortly if we've got no way to sort
[20:27] of connect our band with ourselves we
[20:30] can try using the file stream wrapper
[20:32] and observing the behavior of the
[20:34] application so essentially if it behaves
[20:37] a certain way with a valid path and we
[20:39] can chuck file colon slash slash in
[20:41] front of it then that probably means
[20:43] that stream wrappers are working ok so
[20:47] PHP GAC is basically why so serial for
[20:51] PHP I've just taken all the good bits
[20:54] and written a couple of lines of code to
[20:57] basically put the the palos which are
[20:59] already included with that into a fire
[21:02] archive using the techniques are
[21:03] discussed a quick note on the payload so
[21:08] so to have them work with the demos I'm
[21:11] doing today I'm doing most of them
[21:12] against the latest version of PHP and
[21:16] there's kind of a defense-in-depth
[21:18] change that's been made so you used to
[21:19] be able to dynamically call a function
[21:21] called the sir
[21:22] which would evaluate as PHP our
[21:25] strengths but they've prevented you from
[21:27] doing that now so I'm simply calling a
[21:30] function called passed
[21:31] which calls out to a system command and
[21:34] spits the output out if we're sort of
[21:37] attacking a hardened system and it has
[21:39] functions that pass through our exit you
[21:42] know banned most applications seem to
[21:45] use this library manager called composer
[21:46] and that includes a simple function
[21:49] which wraps include so we could abuse
[21:51] that to include PHP code from another
[21:54] file so all the case studies I'm going
[21:59] to go through today were found with
[22:01] manual analysis two of them could have
[22:04] been easily found with this sort of FTP
[22:06] kernel such techniques I talked about
[22:08] earlier and they all use just a simple
[22:11] uploading a file onto the target to
[22:14] place it there okay so the first one I'm
[22:16] going to look at is a CMS called typo3
[22:20] many things to a developer called Oliver
[22:22] Haider who helped to fix the issue so
[22:27] the the code path from user input to
[22:30] where the vulnerability is is fairly
[22:32] complicated but the the vulnerability is
[22:34] hopefully fairly clear from here so
[22:37] where we end up is with file exists
[22:40] being called on a URL decoded value so
[22:43] when it's trying to work out what type
[22:45] of path were giving it it's issues when
[22:48] it processes links but when it's trying
[22:51] to work out how to process the but it
[22:52] does things like check if it's got
[22:54] colons or slashes in it and says I know
[22:56] that's a remote file but it does that
[23:00] before then URL decoding so as long as
[23:02] we encode for instance the colon we can
[23:05] trick it into thinking it's dealing with
[23:07] a local file and it will call file
[23:09] exists on a path completely under our
[23:10] control
[23:24] they say the first thing we need to do
[23:29] is generate a payload like any sensible
[23:33] person but lots of pictures of my cat
[23:35] and my pictures further if at first if I
[23:39] run PHP did you see - yeah that this
[23:42] will list the payloads it's not
[23:44] formatted very nice so I mentioned some
[23:47] of these are so some of them were two
[23:53] string payloads so we can't use them you
[23:56] know with this exploit but what I'm
[24:00] going to do is so I'm taking as the
[24:05] input cat one dot jpg I'll output ip3
[24:08] dot jpg I'm going to use a payload of
[24:13] brother Loki one and I'm going to try
[24:16] and run the command do you name - I ok
[24:27] so that's written into my pictures
[24:30] directory type it's reader jpg so I'm
[24:40] running this demo just as admin this CMS
[24:44] of implements of fine grained access
[24:46] model and it doesn't come with any
[24:48] standard roles or anything like that the
[24:50] functionality I'm abusing would be
[24:52] accessible to lots of non admin users
[25:06] [Music]
[25:17] so I'm going to upload the payload that
[25:20] I generated earlier and actually what
[25:29] I'm going to do I'm just going to listen
[25:36] on port 443 on me so I'm listening on
[25:47] port 443 on another server and I'm going
[25:49] to try and trigger the FTP stream
[25:51] wrapper to sort of demonstrate that
[25:54] Stream wrappers are being activated so
[25:57] if I go to any page and add some content
[26:05] add an image is element that has a link
[26:10] as long as I encode that colon so that's
[26:36] connected back to us and we can see that
[26:38] the FTP stream app has been activated
[26:41] I can do my poor impression of an FTP
[26:44] server and we can see that it's trying
[26:47] to access xxx why why why
[27:07] so if instead of using the FTP Stream
[27:10] wrapper we access that payloads through
[27:12] the faster a mapper
[27:16] hopefully
[27:30] [Music]
[28:18] try again
[28:19] I thought I was so clever when I fixed
[28:29] the damage to work not online that's
[28:32] that's what this turns me right that's
[28:40] right this is the request
[28:47] so somewhere down here this be saying
[28:50] that the link to that far and if we
[28:55] intercept the response at the top there
[29:01] and see it's triggered the pilot and
[29:07] yeah that's the end of that demo there's
[29:11] not okay so the next step over is in
[29:25] WordPress and when I first found this
[29:27] issue so that you know they ultimately
[29:30] the issue is in PHP but we need to find
[29:33] vulnerabilities in applications to
[29:34] exploit it so I found this issue in
[29:38] WordPress and thought how that'd be a
[29:39] you know a good one to demonstrate it
[29:41] and thought they would fix it fairly
[29:43] quickly you can see when I reported it
[29:46] and it hasn't been fixed yet so you know
[29:51] I've ended up feeling that the only
[29:53] responsible thing is to disclose it as
[29:56] it is so this is this is my favorite of
[30:00] the vulnerabilities because it's
[30:01] slightly more subtle and this is
[30:05] ultimately where the vulnerability is so
[30:08] it calculates this variable thumb file
[30:11] and it ends up calling file exists on it
[30:14] but the way it calculates this variable
[30:16] is it takes this value file calculates
[30:20] the base name of that and it replaces
[30:22] every occurrence of that with this value
[30:25] thumb and there's no guarantee that the
[30:29] base name of the file only occurs once
[30:31] so what we're going to do is try and get
[30:32] it to replace the start of the file
[30:35] rather than just the end so write this
[30:40] value file comes from this function get
[30:44] attached file and in most cases that
[30:48] prepends the applications sort of upload
[30:50] directory to to the file name but in
[30:54] certain circumstances it doesn't so if
[30:56] the file starts with a slash
[30:57] then it's a Linux absolute path but if
[31:00] it starts with a single character then a
[31:02] codon then a forward slash then it's a
[31:05] Windows absolute part so despite the
[31:07] fact that we're attacking a Linux system
[31:09] we're going to give it a file path that
[31:11] looks like a Windows absolute path and
[31:14] as you know abused this functionality to
[31:17] end up replacing the start of the file
[31:19] name and therefore activating the stream
[31:22] wrapper in terms of the payload I'm
[31:25] going to use today until fairly recently
[31:28] so November 2017 there was a payload
[31:32] that I presented here three years ago
[31:34] which went from two string two code
[31:37] execution they've made some changes
[31:39] since then and that payload is no longer
[31:40] valid so we have to try and find another
[31:43] one WordPress is quite limited in what
[31:45] classes you can use to construct these
[31:48] kind of payloads so sort of looking
[31:50] through the the classes that are there
[31:52] there's a one that really stands out
[31:54] which is this requests utility filtered
[31:57] iterator which is an array iterator so
[32:00] this essentially backs an array and when
[32:03] you iterate through an array this is the
[32:04] code that gets executed and this uses a
[32:08] property defined for bet so if we
[32:11] control the object we control this
[32:13] callback and we can call any function we
[32:15] want with any argument we want now this
[32:18] is obviously only triggered by iterating
[32:20] through the array so we need to find
[32:22] something else to iterate through the
[32:23] array I looked around you know both the
[32:27] classes that are already loaded and
[32:29] WordPress and a few system classes and
[32:31] couldn't find anything to do this so the
[32:34] natural sort of next step is to look if
[32:36] there's any common plugins that have
[32:37] anything like this and there's a very
[32:40] common plug-in for the word commerce and
[32:42] that includes a class which has a fairly
[32:46] benign looking destructor because it's
[32:49] just for closing files but the thing
[32:51] that it does that's useful for us is it
[32:53] iterates through one of its properties
[32:55] so we can use that to trigger the other
[32:57] part of the payload
[33:00] let's have a look at this turn now
[33:07] for this demo I sort of scripted it
[33:09] because there's quite a lot of you know
[33:11] grabbing various values from various
[33:13] places WordPress seems to run horribly
[33:19] slowly on my computer so apologies so I
[33:33] was just this is the one case where
[33:37] WordPress has sort of predefined roles
[33:41] and stuff like that so it's quite clear
[33:42] what user we can do this asked if I can
[33:48] log in the server right so this is the
[33:52] latest version of WordPress and has the
[33:54] latest version of WooCommerce installed
[33:55] on it one of these should be users users
[34:02] and so I've set up a user called author
[34:06] which is a member of the earth or Alf so
[34:08] WordPress goes of anonymous subscribers
[34:12] authors editors admins so you know this
[34:17] issue is only exposed to authenticated
[34:19] users but they're certainly not supposed
[34:21] to be able to execute code
[34:40] this should hopefully do everything for
[34:43] me so the first thing it does is upload
[34:46] the file is doing it through XML RPC so
[34:50] the value is base 64 encoded but we can
[34:53] have a look at that file in here it's
[34:58] basically got sort of a JPEG header on
[35:01] it but not much more and then it goes
[35:03] straight into the stub and has are
[35:05] serialized payload in the metadata
[35:07] exception so it'll upload the file
[35:15] slowly so it's uploaded to file and then
[35:38] we need to just log in to the normal
[35:40] user interface to grab a cookie
[35:41] basically all right
[35:46] so it's logged in and got his cookies
[35:48] we're gonna use this one here is the
[35:50] admin cookie or the you know the backend
[35:52] cookie so using that cookie it's then
[35:57] going to access the page to edit the
[36:02] post that represents the file that we
[36:03] just uploaded we need to access that
[36:11] page to get something called the nonce
[36:14] which we're going to need to do the next
[36:18] stuff that we need to do so it's
[36:19] grabbing the value of this non sear and
[36:25] then it's using that and it's setting
[36:28] the file name to Zed colon slash said so
[36:32] when the code that we looked at earlier
[36:34] replaces the base file it's going to
[36:36] replace the said at the end but it's
[36:37] also going to replace the Zed at the
[36:39] start because the start of the file is
[36:41] the same as the basepart
[36:50] but eventually go through so now it's
[37:09] going to set the thumb value to a fire
[37:12] path to access the payload that we just
[37:16] uploaded and now finally when it
[37:22] triggers the it triggers the thumbnail
[37:27] functionality through this XML RPC call
[37:29] to work press get meteor item so
[37:32] hopefully if I intercept the response to
[37:34] that down on the bottom we've called you
[37:37] name - a again we'll see how fast it
[37:43] sphere
[37:59] it's just to say you know we can call
[38:01] any girl my is closer I'll leave
[38:06] that running in the background okay so
[38:17] the final case study is in a library
[38:19] called TC PDF I'm going to exploit it
[38:21] through CMS could console but really the
[38:25] important point is this is that this is
[38:27] in quite a widespread library so as far
[38:29] as I know this is the standard library
[38:32] and PHP applications to convert HTML to
[38:34] PDFs and in quite a simple way of sort
[38:39] of exposes the issue so in this sort of
[38:44] standard application scenario there's
[38:46] some situations where we might be
[38:48] deliberately given access to the HTML
[38:50] that's being sent to a PDF but also we
[38:53] often find we can sort of cross-site
[38:54] script into some code that's then being
[38:57] rendered into a PDF and the
[39:02] vulnerability is like I said quite
[39:03] straightforward essentially it's it you
[39:06] know runs a tag handler through all the
[39:07] tags at the HTML and if it encountered
[39:10] an image tag it calls this function
[39:11] image with the source attribute and that
[39:16] does a few things but you know full
[39:18] story to a file exists called with with
[39:20] the value as we supplied it so let's
[39:23] look at that
[39:35] so we need to generate a payload again
[39:50] and try cutting ezc faster this time
[39:59] [Music]
[40:08] again the same as the first demo it's a
[40:11] you wouldn't need to be an admin to
[40:13] access all this functionality but I
[40:15] haven't set up a bunch of users with the
[40:17] various different parameters so the CMS
[40:30] includes this article functionality and
[40:32] there's a setting you can have on
[40:34] articles to allow them to be exported as
[40:38] PDF which then uses the library so I've
[40:46] got this article set up I've just got
[40:48] the contents there's xxx yyy that should
[40:53] generate PDF latex yyy if I edit the
[41:02] content of that
[41:20] so first I'm just going to put an image
[41:23] tag that literally references the image
[41:26] with no stream wrapper so I'm just using
[41:37] a relative path to the image in the code
[41:40] now if I save this the HTML view of the
[41:45] article won't work properly because
[41:47] that's the browser is looking for that
[41:49] relative path and not finding it
[41:53] but the PDF asked me did I upload the
[42:00] image
[42:23] we try that again
[42:28] we got a PDF with the image and define
[42:35] try that so you can see it's still
[42:38] breaking you know in the browser but if
[42:53] I put the father in front of this see
[43:04] even more broken in the browser because
[43:06] that doesn't understand the file you are
[43:08] a little if we send it to the PDF
[43:11] Janerio triggers the failure
[43:23] okay so in terms of defending against
[43:25] this issue obviously it would be ideal
[43:27] to avoid those types of vulnerabilities
[43:30] altogether but bearing in mind that they
[43:33] were already nine types of
[43:34] vulnerabilities and we're still finding
[43:35] them in applications now that might not
[43:37] be that realistic sort of IPS is IDS's
[43:41] antivirus software should be able to
[43:44] detect this quite easily you know with
[43:45] signatures and things like that it
[43:49] doesn't seem possible to disable that
[43:51] the sort of behavior of that stream
[43:53] wrapper from the command line or PHP dot
[43:56] ini' but you could potentially you know
[44:00] a disable it during compilation
[44:01] I've spoken to PHP about the issue a
[44:04] couple of months ago I haven't heard
[44:06] back but hopefully in the long term as
[44:09] they will address this issue so what do
[44:13] I want you to take away from the
[44:14] presentation more broadly than just PHP
[44:17] we're seeing a lot of unsee realization
[44:20] issues in multiple languages and they're
[44:23] made a lot worse by you know I've said
[44:26] complexity there but bloat is probably
[44:28] the right words you know people are
[44:30] adding libraries to applications and not
[44:32] worrying about whether they're used
[44:33] anymore or not not removing them we're
[44:36] starting to see some libraries implement
[44:38] sort of defensive codes they're trying
[44:40] to you know remove behaviors that are
[44:43] very useful for on serialization
[44:45] exploits by abusing this streem wrapper
[44:49] you know we can exploit a number of
[44:51] different vulnerabilities so xxe yes srf
[44:55] you know certainly if certain settings
[44:58] are set so for instance allow URL F open
[45:00] is set to false on PHP some of these
[45:03] issues you probably wouldn't even pick
[45:05] up and you would certainly report them
[45:08] as very low impact on the pen test now
[45:11] hopefully you realize they can be used
[45:13] to trigger code execution and yeah
[45:17] hopefully I've made it clear sort of
[45:19] easy ways to identify the issues either
[45:21] looking at source code or with black box
[45:23] methods so I've added one slide from the
[45:26] talk that I gave last week
[45:29] because a couple of people have pointed
[45:30] out to me that somebody else discovered
[45:34] this behavior and used it in a CTF so a
[45:37] guy called orange side sort of said it
[45:41] as a CTF challenge I think towards the
[45:44] end of 2017 you know I think as far as
[45:48] we're both aware we both just discovered
[45:51] the same thing independently and and
[45:54] yeah you know you often find that in
[45:56] security people have the same ideas
[46:00] around the same time so that's me all
[46:03] finished are there any questions anyone
[46:08] got a question for Sam yep when you were
[46:14] basically injecting your injection into
[46:17] the JPEG there's no possibility to
[46:19] actually insert a reverse shell so you
[46:22] cannot get a shot back out of it yeah so
[46:25] what you could do I mentioned about the
[46:28] the assert stuff so previous to PHP 7.2
[46:32] it was really easy to with these kind of
[46:35] an serialization payloads to run
[46:37] arbitrary PHP code which obviously you
[46:39] could write a whole reverse shell and
[46:41] and contain it within that JPEG I
[46:45] mentioned the composers got a wrapper
[46:48] for include file so if you were looking
[46:50] to execute sort of more complicated code
[46:53] than just running one command what you
[46:55] could do is embed in that jpay your
[46:57] whole PHP source file as part of the
[46:59] archive and then include that with the
[47:02] sort of composer wrapper function and
[47:04] then you know you'd be running a whole
[47:06] whatever you wanted but you reverse
[47:08] shell would probably be the funny things
[47:11] yes anyone else know don't give it up
[47:20] first Sam
[47:22] you

=== Content from www.theregister.co.uk_4aacb163_20250125_180728.html ===


[![](/design_picker/ae01b183a707a7db8cd5f2c947715ed56d335138/graphics/std/user_icon_white_extents_16x16.png)
![](/design_picker/ae01b183a707a7db8cd5f2c947715ed56d335138/graphics/std/user_icon_white_filled_extents_16x16.png)
Sign in / up](https://account.theregister.com/register/)

[![The Register® — Biting the hand that feeds IT](/design_picker/fa16d26efb42e6ba1052f1d387470f643c5aa18d/graphics/std/reg_logo_no_strapline.png)](https://www.theregister.com/)

[![](/design_picker/ae01b183a707a7db8cd5f2c947715ed56d335138/graphics/std/magnifying_glass_white_extents_16x16.png)](https://search.theregister.com/)

![](/design_picker/ae01b183a707a7db8cd5f2c947715ed56d335138/graphics/icon/burger_menu_white_16x16.png)
![](/design_picker/ae01b183a707a7db8cd5f2c947715ed56d335138/graphics/icon/burger_menu_white_close_16x16.png)

## Topics

[Security](#subnav-box-nav-security)
## [Security](#subnav-box-nav-security)

[All Security](https://www.theregister.com/security/)[Cyber-crime](https://www.theregister.com/security/cyber_crime/)[Patches](https://www.theregister.com/security/patches/)[Research](https://www.theregister.com/security/research/)[CSO](https://www.theregister.com/security/cso/)
[(X)](#masthead)

[Off-Prem](#subnav-box-nav-off_prem)
## [Off-Prem](#subnav-box-nav-off_prem)

[All Off-Prem](https://www.theregister.com/off_prem/)[Edge + IoT](https://www.theregister.com/off_prem/edge_iot/)[Channel](https://www.theregister.com/off_prem/channel/)[PaaS + IaaS](https://www.theregister.com/off_prem/paas_iaas/)[SaaS](https://www.theregister.com/off_prem/saas/)
[(X)](#masthead)

[On-Prem](#subnav-box-nav-on_prem)
## [On-Prem](#subnav-box-nav-on_prem)

[All On-Prem](https://www.theregister.com/on_prem/)[Systems](https://www.theregister.com/on_prem/systems/)[Storage](https://www.theregister.com/on_prem/storage/)[Networks](https://www.theregister.com/on_prem/networks/)[HPC](https://www.theregister.com/on_prem/hpc/)[Personal Tech](https://www.theregister.com/on_prem/personal_tech/)[CxO](https://www.theregister.com/on_prem/cxo/)[Public Sector](https://www.theregister.com/on_prem/public_sector/)
[(X)](#masthead)

[Software](#subnav-box-nav-software)
## [Software](#subnav-box-nav-software)

[All Software](https://www.theregister.com/software/)[AI + ML](https://www.theregister.com/software/ai_ml/)[Applications](https://www.theregister.com/software/applications/)[Databases](https://www.theregister.com/software/databases/)[DevOps](https://www.theregister.com/software/devops/)[OSes](https://www.theregister.com/software/oses/)[Virtualization](https://www.theregister.com/software/virtualization/)
[(X)](#masthead)

[Offbeat](#subnav-box-nav-offbeat)
## [Offbeat](#subnav-box-nav-offbeat)

[All Offbeat](https://www.theregister.com/offbeat/)[Debates](https://www.theregister.com/Debates/)[Columnists](https://www.theregister.com/offbeat/columnists/)[Science](https://www.theregister.com/offbeat/science/)[Geek's Guide](https://www.theregister.com/offbeat/geeks_guide/)[BOFH](https://www.theregister.com/offbeat/bofh/)[Legal](https://www.theregister.com/offbeat/legal/)[Bootnotes](https://www.theregister.com/offbeat/bootnotes/)[Site News](https://www.theregister.com/offbeat/site_news/)[About Us](https://www.theregister.com/offbeat/about_us/)
[(X)](#masthead)

[Special Features](#subnav-box-nav-special_features)
## Special Features

[All Special Features](https://www.theregister.com/special_features)
[The Future of the Datacenter](https://www.theregister.com/special_features/future_of_the_datacenter)
[Cybersecurity Month](https://www.theregister.com/special_features/cybersecurity_month)
[VMware Explore](https://www.theregister.com/special_features/vmware_explore)
[Cloud Infrastructure Month](https://www.theregister.com/special_features/cloud_infrastructure_month)

## Vendor Voice

[Vendor Voice](#subnav-box-nav-tag-vendor-voice)
## [Vendor Voice](#subnav-box-nav-tag-vendor-voice)

[All Vendor Voice](https://www.theregister.com/VendorVoice/)
[Amazon Web Services (AWS) New Horizon in Cloud Computing](https://www.theregister.com/VendorVoice/aws_new_horizon_financial_services/)
[Pure Storage](https://www.theregister.com/VendorVoice/pure_storage_portworx/)
[Kilka Tech](https://www.theregister.com/VendorVoice/aws_klika_tech/)
[HERE and AWS](https://www.theregister.com/VendorVoice/aws_here/)
[Vonage](https://www.theregister.com/VendorVoice/aws_vonage/)
[GE Vernova with AWS](https://www.theregister.com/VendorVoice/aws_ge_vernova_manufacturing/)
[Google Cloud Data Transformation](https://www.theregister.com/VendorVoice/google_cloud_data_transformation/)
[Google Gemini](https://www.theregister.com/VendorVoice/google_gemini/)
[(X)](#masthead)

[Resources](#subnav-box-nav-resources)
## Resources

[Whitepapers](https://whitepapers.theregister.com/)
[Webinars & Events](https://whitepapers.theregister.com/events/list/)
[Newsletters](https://account.theregister.com/edit/newsletter/)

[![](https://pubads.g.doubleclick.net/gampad/ad?co=1&iu=/6978/reg_security/front&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=2&c=2Z5UoX-8-7pcEO11KTVVZhwAAAJE&t=ct%3Dns%26unitnum%3D2%26raptor%3Dcondor%26pos%3Dtop%26test%3D0)](https://pubads.g.doubleclick.net/gampad/jump?co=1&iu=/6978/reg_security/front&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=2&c=2Z5UoX-8-7pcEO11KTVVZhwAAAJE&t=ct%3Dns%26unitnum%3D2%26raptor%3Dcondor%26pos%3Dtop%26test%3D0)

#### [Security](/security/)

[**16**
![comment bubble on white](/design_picker/f5daacc84b9722c1e31ba85f836c37e4ad993fc4/graphics/icons/bubble_comment_white.png)](https://forums.theregister.com/forum/all/2018/08/20/php_unserialisation_wordpress_vuln/ "View comments on this article")

This article is more than **1 year old**

# So phar, so FUD: PHP flaw puts WordPress sites at risk of hacks

[**16**
![comment bubble on white](/design_picker/f5daacc84b9722c1e31ba85f836c37e4ad993fc4/graphics/icons/bubble_comment_white.png)](https://forums.theregister.com/forum/all/2018/08/20/php_unserialisation_wordpress_vuln/ "View comments on this article")

## But claims of 'complete system compromise' are a little extreme

![icon](/design_picker/d518b499f8a6e2c65d4d8c49aca8299d54b03012/graphics/icon/vulture_red.svg)
[John Leyden](/Author/John-Leyden "Read more by this author")

Mon 20 Aug 2018  //
12:40 UTC

![](/design_picker/d2e337b97204af4aa34dda04c4e5d56d954b216f/graphics/icons/social_share_icon.svg)

Bsides Manchester A newly discovered WordPress flaw has left installs of the ubiquitous content management system potentially vulnerable to hacking.

A security shortcoming within WordPress's PHP framework can be leveraged by logged-in non-admin users to run arbitrary malicious code and commands on the host servers, infosec consultancy Secarma has warned.

The "unserialization" hole in the platform's code can be exploited using a combination of XML external entity (XXE) attacks and server-side request forgery (SSRF). It also requires a vulnerable plugin to be installed on the site.

[![](https://pubads.g.doubleclick.net/gampad/ad?co=1&iu=/6978/reg_security/front&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=2&c=2Z5UoX-8-7pcEO11KTVVZhwAAAJE&t=ct%3Dns%26unitnum%3D2%26raptor%3Dcondor%26pos%3Dtop%26test%3D0)](https://pubads.g.doubleclick.net/gampad/jump?co=1&iu=/6978/reg_security/front&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=2&c=2Z5UoX-8-7pcEO11KTVVZhwAAAJE&t=ct%3Dns%26unitnum%3D2%26raptor%3Dcondor%26pos%3Dtop%26test%3D0)

To make the attack work, a miscreant would need to log in and upload a booby-trapped file to the target application, then trigger a file operation through a crafted file name (that accesses the file through the `phar://` stream wrapper), causing the target application to "unserialize" metadata contained in the file. That metadata can contain malicious commands, which are executed as a result of the deserialization.

[![](https://pubads.g.doubleclick.net/gampad/ad?co=1&iu=/6978/reg_security/front&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=4&c=44Z5UoX-8-7pcEO11KTVVZhwAAAJE&t=ct%3Dns%26unitnum%3D426raptor%3Dfalcon%26pos%3Dmid%26test%3D0)](https://pubads.g.doubleclick.net/gampad/jump?co=1&iu=/6978/reg_security/front&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=4&c=44Z5UoX-8-7pcEO11KTVVZhwAAAJE&t=ct%3Dns%26unitnum%3D4%26raptor%3Dfalcon%26pos%3Dmid%26test%3D0)

[![](https://pubads.g.doubleclick.net/gampad/ad?co=1&iu=/6978/reg_security/front&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=3&c=33Z5UoX-8-7pcEO11KTVVZhwAAAJE&t=ct%3Dns%26unitnum%3D3%26raptor%3Deagle%26pos%3Dmid%26test%3D0)](https://pubads.g.doubleclick.net/gampad/jump?co=1&iu=/6978/reg_security/front&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=3&c=33Z5UoX-8-7pcEO11KTVVZhwAAAJE&t=ct%3Dns%26unitnum%3D3%26raptor%3Deagle%26pos%3Dmid%26test%3D0)

Unserialization of attacker-controlled data is a known class of vulnerability that can lead to the execution of malicious code, smuggled in with the data, on the host server. German security researcher [Stefan Esser](https://twitter.com/i0n1c) first documented the family of flaws 10 years ago.

WordPress was informed of the issue in February 2017 but has yet to take action, according to Secarma. PDF generation library [TCPDF](https://tcpdf.org/) is similarly vulnerable. Content management system Typo3 was vulnerable up until early June – before it released updates to protect users.

[![](https://pubads.g.doubleclick.net/gampad/ad?co=1&iu=/6978/reg_security/front&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=4&c=44Z5UoX-8-7pcEO11KTVVZhwAAAJE&t=ct%3Dns%26unitnum%3D426raptor%3Dfalcon%26pos%3Dmid%26test%3D0)](https://pubads.g.doubleclick.net/gampad/jump?co=1&iu=/6978/reg_security/front&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=4&c=44Z5UoX-8-7pcEO11KTVVZhwAAAJE&t=ct%3Dns%26unitnum%3D4%26raptor%3Dfalcon%26pos%3Dmid%26test%3D0)

Research into the vulnerability was presented by Secarma's Sam Thomas at Thursday's BSides cybersecurity conference in Manchester, UK – days after it was unveiled at Black Hat USA in Las Vegas last week. His presentation (video below) was titled *It's A PHP Unserialization Vulnerability Jim, But Not As We Know It*. The part between the 30 and 38 minutes concentrates on the WordPress issue.

[Youtube Video](https://youtu.be/GePBmsNJw6Y)

A white paper, *File Operation Induced Unserialization via the `phar://` Stream Wrapper* ([PDF](https://cdn2.hubspot.net/hubfs/3853213/us-18-Thomas-It%27s-A-PHP-Unserialization-Vulnerability-Jim-But-Not-As-We-....pdf)), describes the issue in more depth.

[![](https://pubads.g.doubleclick.net/gampad/ad?co=1&iu=/6978/reg_security/front&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=3&c=33Z5UoX-8-7pcEO11KTVVZhwAAAJE&t=ct%3Dns%26unitnum%3D3%26raptor%3Deagle%26pos%3Dmid%26test%3D0)](https://pubads.g.doubleclick.net/gampad/jump?co=1&iu=/6978/reg_security/front&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=3&c=33Z5UoX-8-7pcEO11KTVVZhwAAAJE&t=ct%3Dns%26unitnum%3D3%26raptor%3Deagle%26pos%3Dmid%26test%3D0)

Thomas told *El Reg* immediately after his Manchester gig that he had reported the serious PHP-related vulnerability in Wordpress through HackerOne – which runs its bug bounty programme – months ago but despite this the vuln had not been properly resolved. *El Reg* contacted both WordPress and HackerOne for comment.

We have yet to hear back from WordPress. HackerOne confirmed it worked with WordPress but declined to offer anything much beyond that. "Due to our confidentiality obligations to our customers, HackerOne does not comment on customer bug bounty programs," the outfit told *El Reg*.

Thomas said the WordPress flaw involves a "subtle vulnerability in thumbnail processing which allows an attacker to reach a 'file\_exists' call with control of the start of the parameter."

As things stand, the objective scope of the vulnerability, and how easy it might be to exploit is unclear. Thomas's presentation contained a number of caveats omitted from Secarma's press release about the presentation, which boldly claimed the flaw left "30 per cent of the world's top 1,000 websites vulnerable to hacking and data breaches."

Crucially, an attacker would need a suitable account, be able to upload images or other files, and the site would need a vulnerable plugin installed before malicious commands could be injected, for example. To pull off a complete host system compromise, further vulnerabilities would likely need to be exploited to escalate the intruder's privileges.

After careful analysis and a review of available material, *El Reg*'s security desk has concluded claims of a "massive WordPress vulnerability" are a load of tribble's testicles.

There's an issue here, but the premise that millions of websites are at risk of complete system compromise above and beyond the general widely known risk of running WordPress hasn't been substantiated by Secarma, a security business owned by hosting outfit UKFast.

WordPress hasn't issued a patch, and we have no information about mitigation from the CMS vendor to go on either. During his presentation Thomas said that the "issue is only exposed to authenticated users... they are certainly not supposed to be able to execute [code]."

In the absence of a fix, WordPress users need to be careful about new accounts that are author level and above, Thomas advised. These accounts should be locked down because the now-public hacking technique can be used to elevate privileges to admin. "Ultimately it's an issue within PHP," Thomas said, adding during a [Twitter exchange](https://twitter.com/_s_n_t/status/1030573635617124353) that "the issue works against the default configuration of WordPress and PHP, [as far as I know] it is not dependent on network or system setup."

Chinese researcher Orange Tsai had discovered the same problem, Thomas acknowledged during his Manchester presentation.

WordPress is widely used by bloggers, news outlets and all manner of businesses as a content management system. It's no stranger to security problems of one sort or another, to put it mildly. ®

**Get our** [Tech Resources](https://whitepapers.theregister.com/)

![](/design_picker/d2e337b97204af4aa34dda04c4e5d56d954b216f/graphics/icons/social_share_icon.svg)
Share

#### More about

* [Vulnerability](/Tag/Vulnerability/)

More like these

×
### More about

* [Vulnerability](/Tag/Vulnerability/)

### Narrower topics

* [Y2K](/Tag/Y2K/)
* [Zero Day Initiative](/Tag/Zero%20Day%20Initiative/)

### Broader topics

* [Security](/Tag/Security/)

#### More about

![](/design_picker/d2e337b97204af4aa34dda04c4e5d56d954b216f/graphics/icons/social_share_icon.svg)
Share

[**16**
![comment bubble on white](/design_picker/f5daacc84b9722c1e31ba85f836c37e4ad993fc4/graphics/icons/bubble_comment_white.png)
COMMENTS](https://forums.theregister.com/forum/all/2018/08/20/php_unserialisation_wordpress_vuln/ "View comments on this article")

#### More about

* [Vulnerability](/Tag/Vulnerability/)

More like these

×
### More about

* [Vulnerability](/Tag/Vulnerability/)

### Narrower topics

* [Y2K](/Tag/Y2K/)
* [Zero Day Initiative](/Tag/Zero%20Day%20Initiative/)

### Broader topics

* [Security](/Tag/Security/)

#### TIP US OFF

[Send us news](https://www.theregister.com/Profile/contact/)

---

### Other stories you might like

[#### Nominet probes network intrusion linked to Ivanti zero-day exploit

Unauthorized activity detected, but no backdoors found
Security13 Jan 2025 | 6](/2025/01/13/nominet_ivanti_zero_day/?td=keepreading)

[#### Miscreants 'mass exploited' Fortinet firewalls, 'highly probable' zero-day used

Updated Ransomware 'not off the table,' Arctic Wolf threat hunter tells El Reg
Networks14 Jan 2025 | 25](/2025/01/14/miscreants_mass_exploited_fortinet_firewalls/?td=keepreading)

[#### Cryptojacking, backdoors abound as fiends abuse Aviatrix Controller bug

This is what happens when you publish PoCs immediately, hm?
Patches13 Jan 2025 | 1](/2025/01/13/severe_aviatrix_controller_vulnerability/?td=keepreading)

[#### Where do European SMEs start when it comes to conquering the world?

The answer is in Denmark
Sponsored Feature](/2024/11/25/where_do_european_smes_start/?td=keepreading)

[![](https://pubads.g.doubleclick.net/gampad/ad?co=1&iu=/6978/reg_security/front&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=6&c=66Z5UoX-8-7pcEO11KTVVZhwAAAJE&t=ct%3Dns%26unitnum%3D6%26raptor%3Dhawk%26pos%3Dbtm%26test%3D0)](https://pubads.g.doubleclick.net/gampad/jump?co=1&iu=/6978/reg_security/front&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=6&c=66Z5UoX-8-7pcEO11KTVVZhwAAAJE&t=ct%3Dns%26unitnum%3D6%26raptor%3Dhawk%26pos%3Dbtm%26test%3D0)

[#### SonicWall flags critical bug likely exploited as zero-day, rolls out hotfix

Big organizations and governments are main users of these gateways
Patches23 Jan 2025 | 6](/2025/01/23/sonicwall_critical_bug/?td=keepreading)

[#### Six vulnerabilities in ubiquitous rsync tool announced and fixed in a day

Turns out tool does both file transfers *and* security fixes fast
Patches17 Jan 2025 | 21](/2025/01/17/rsync_vulnerabilities/?td=keepreading)

[#### Zero-day exploits plague Ivanti Connect Secure appliances for second year running

Factory resets and apply patches is the advice amid fortnight delay for other appliances
Patches9 Jan 2025 | 2](/2025/01/09/zeroday_exploits_ivanti/?td=keepreading)

[#### MediaTek rings in the new year with a parade of chipset vulns

Manufacturers should have had ample time to apply the fixes
Security6 Jan 2025 | 5](/2025/01/06/mediatek_chipset_vulnerabilities/?td=keepreading)

[#### UK ICO not happy with Google's plans to allow device fingerprinting

Infosec in brief Also, Ascension notifies 5.6M victims, Krispy Kreme bandits come forward, LockBit 4.0 released, and more
Security23 Dec 2024 | 75](/2024/12/23/uk_ico_not_happy_with/?td=keepreading)

[#### Apache issues patches for critical Struts 2 RCE bug

More details released after devs allowed weeks to apply fixes
Patches12 Dec 2024 |](/2024/12/12/apache_struts_2_vuln/?td=keepreading)

[#### Three more vulns spotted in Ivanti CSA, all critical, one 10/10

Patch up, everyone – that admin portal is mighty attractive to your friendly cyberattacker
Patches11 Dec 2024 | 2](/2024/12/11/ivanti_vulns_critical/?td=keepreading)

[#### Fully patched Cleo products under renewed 'zero-day-ish' mass attack

Thousands of servers targeted while customers wait for patches
Research10 Dec 2024 |](/2024/12/10/cleo_vulnerability/?td=keepreading)

The Register ![icon](/design_picker/d518b499f8a6e2c65d4d8c49aca8299d54b03012/graphics/icon/vulture_white.png) Biting the hand that feeds IT

#### About Us

* [Contact us](https://www.theregister.com/Profile/contact/)
* [Advertise with us](https://www.theregister.com/AdvertiseWithUs/)
* [Who we are](https://www.theregister.com/Profile/about_the_register/)

#### Our Websites

* [The Next Platform](https://www.nextplatform.com/)
* [DevClass](https://devclass.com/)
* [Blocks and Files](https://blocksandfiles.com/)

#### Your Privacy

* [Cookies Policy](https://www.theregister.com/Profile/cookies/)
* [Privacy Policy](https://www.theregister.com/Profile/privacy/)
* [Ts & Cs](https://www.theregister.com/Profile/terms_and_conditions_of_use/)

[![Situation Publishing](/design_picker/d2e337b97204af4aa34dda04c4e5d56d954b216f/graphics/std/sitpublogo_2022.png)](https://situationpublishing.com/)

Copyright. All rights reserved © 1998–2025

![no-js](/Design/graphics/std/transparent_pixel.png)


