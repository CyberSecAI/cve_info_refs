=== Content from security.gentoo.org_284132ba_20250125_233942.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# VDE: Privilege escalation — GLSA **201711-11**

A vulnerability was discovered in VDE which may allow local users
to gain root privileges.

### Affected packages

| Package | **net-misc/vde** on all architectures |
| --- | --- |
| Affected versions | < **2.3.2-r4** |
| Unaffected versions | >= **2.3.2-r4** |

### Background

VDE is an ethernet compliant virtual network that can be spawned over a
set of physical computer over the Internet.

### Description

It was discovered that Gentoo’s default VDE installation suffered from
a privilege escalation vulnerability in the init script. This script
calls an unsafe ‘chown’ command which gives members from “qemu”
group root privileges.

### Impact

A local attacker could escalate privileges to root.

### Workaround

There is no known workaround at this time.

### Resolution

All VDE users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=net-misc/vde-2.3.2-r4"

```
### References

* [CVE-2017-16638](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2017-16638)

**Release date**

November 12, 2017

**Latest revision**

November 12, 2017: 1

**Severity**

normal

**Exploitable**

local

**Bugzilla entries**

* [603382](https://bugs.gentoo.org/show_bug.cgi?id=603382)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from bugs.gentoo.org_deccdc35_20250126_125022.html ===

[![Gentoo Websites Logo](extensions/Gentoo/web/gentoo_org.png)](/ "Go to the Gentoo Bugzilla homepage")
Go to:
[Gentoo Home](https://www.gentoo.org/)
[Documentation](https://www.gentoo.org/support/documentation/)
[Forums](https://forums.gentoo.org/)
[Lists](https://www.gentoo.org/get-involved/mailing-lists/)
[Bugs](/)
[Planet](https://planet.gentoo.org/)
[Store](https://www.gentoo.org/inside-gentoo/stores/)
[Wiki](https://wiki.gentoo.org/)
**[Get Gentoo!](https://www.gentoo.org/downloads/)**

Gentoo's Bugzilla – Search by bug number

* [Home](./)
* | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?keywords=i&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?keywords=i&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

You may find a single bug by entering its bug id here:

* + [Home](./)
  + | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?keywords=i&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?keywords=i&GoAheadAndLogIn=1#forgot)
    Login:

    [x]



=== Content from bugs.gentoo.org_23ce1115_20250125_233942.html ===

[![Gentoo Websites Logo](extensions/Gentoo/web/gentoo_org.png)](/ "Go to the Gentoo Bugzilla homepage")
Go to:
[Gentoo Home](https://www.gentoo.org/)
[Documentation](https://www.gentoo.org/support/documentation/)
[Forums](https://forums.gentoo.org/)
[Lists](https://www.gentoo.org/get-involved/mailing-lists/)
[Bugs](/)
[Planet](https://planet.gentoo.org/)
[Store](https://www.gentoo.org/inside-gentoo/stores/)
[Wiki](https://wiki.gentoo.org/)
**[Get Gentoo!](https://www.gentoo.org/downloads/)**

Gentoo's Bugzilla – Bug 603382
<net-misc/vde-2.3.2-r4: privilege escalation via init script
Last modified: 2017-11-12 22:35:24 UTC node [vulture]

* [Home](./)
* | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=603382&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=603382&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 603382**](show_bug.cgi?id=603382)
(CVE-2017-16638)
- <net-misc/vde-2.3.2-r4: privilege escalation via init script

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
<net-misc/vde-2.3.2-r4: privilege escalation via init script

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2017-16638 | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | Gentoo Security | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=Gentoo Security "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Auditing ([show other bugs](buglist.cgi?component=Auditing&product=Gentoo%20Security&bug_status=__open__)) | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All Linux | |  | | | [Importance](page.cgi?id=fields.html#importance): | High major | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Gentoo Security | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") | B1 [glsa cve] | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2016-12-21 21:08 UTC by Michael Orlitzky | | --- | --- | | Modified: | 2017-11-12 22:35 UTC ([History](show_activity.cgi?id=603382)) | | CC List: | 2 users (show)  jmbsvicetto np-hardass | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") | * [540006](show_bug.cgi?id=540006 "RESOLVED FIXED - [Auditing] sys-apps/openrc: checkpath: {hard,symbolic} link as possible attack vector to gain privilege escalation") | | [Package list:](page.cgi?id=fields.html#cf_stabilisation_atoms "Contains a list of packages (and optionally, architectures) to keyword or stabilize. One fully qualified package per line, optionally followed by a space-delimited list of architectures for that package.") |  | | [Runtime testing required:](page.cgi?id=fields.html#cf_runtime_testing_required "Indicate what level of testing is required. For manual testing following instructions in the bug, choose \"Manual\". For only compile-testing, choose \"No\". For where tests must pass, choose \"Yes\".") | --- | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [**vde.init-r1**](attachment.cgi?id=489566 "View the content of the attachment") (vde.init-r1,728 bytes, text/plain)  [2017-08-18 23:38 UTC](#attach_489566 "Go to the comment associated with the attachment"), Michael Orlitzky | [Details](attachment.cgi?id=489566&action=edit) | | [**vde.confd-r1**](attachment.cgi?id=489568 "View the content of the attachment") (vde.confd-r1,258 bytes, text/plain)  [2017-08-18 23:40 UTC](#attach_489568 "Go to the comment associated with the attachment"), Michael Orlitzky | [Details](attachment.cgi?id=489568&action=edit) | | [View All](attachment.cgi?bugid=603382&action=viewall)  [Add an attachment](attachment.cgi?bugid=603382&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=603382&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](#c0)  Michael Orlitzky   gentoo-dev  2016-12-21 21:08:36 UTC  ``` The init script for vde changes ownership of the /var/run/vde.ctl directory:    VDE_SOCK_CHMOD="770"   VDE_SOCK_CHOWN=":qemu"   ...   chmod -R ${VDE_SOCK_CHMOD} /var/run/vde.ctl   chown -R ${VDE_SOCK_CHOWN} /var/run/vde.ctl  The first time around, that's probably safe. However, the second time around, root is using "chown" on files controlled by the qemu group, and that can unintentionally grant that group root access.  For example, if I add my local "mjo" user to the qemu group, and if I'm running vanilla-sources, I can do:    while true; do \     ln -f /run/ntpd.sock /var/run/vde.ctl/ctl; \   done;  to repeatedly hard-link the vde socket to the root-owned ntpd socket (a silly choice, but avoids issues with cross-filesystem hardlink restrictions). If I start VDE while that loop is executing, the init script will call chown/chmod on my hardlink, and change the permissions of ntpd.sock:    $ ls /run | grep ntpd   -rw-r--r--  1 root     root        5 2016-12-20 17:06 ntpd.pid   srwxrwx---  2 root     qemu        0 2016-12-20 17:06 ntpd.sock ```  [Comment 1](#c1)  Kristian Fiskerstrand (RETIRED)   gentoo-dev  2016-12-22 18:05:40 UTC  ``` @mjo: Please keep in mind that assigning aliases to CC on security related bug reports does not grant anyone access, and as such should not be used.  For the rest of the report, please see also [bug 540006](show_bug.cgi?id=540006 "RESOLVED FIXED - [Auditing] sys-apps/openrc: checkpath: {hard,symbolic} link as possible attack vector to gain privilege escalation") for similar hardening in checkpath which mitigates this attack as well as includes discussion on the kernel mitigation in gentoo-sources for this attack ```  [Comment 2](#c2)  Michael Orlitzky   gentoo-dev  2017-08-18 23:38:50 UTC  ``` Created [attachment 489566](attachment.cgi?id=489566 "vde.init-r1") [[details](attachment.cgi?id=489566&action=edit "vde.init-r1")] vde.init-r1 ```  [Comment 3](#c3)  Michael Orlitzky   gentoo-dev  2017-08-18 23:40:21 UTC  ``` Created [attachment 489568](attachment.cgi?id=489568 "vde.confd-r1") [[details](attachment.cgi?id=489568&action=edit "vde.confd-r1")] vde.confd-r1  Here are two reworked init.d/conf.d files that I think do the right thing, and a lot cleaner (and without this vulnerability).  Can the maintainer please take a look? I'm not a user of vde myself so I may have missed something subtle. ```  [Comment 4](#c4)  Michael Orlitzky   gentoo-dev  2017-08-18 23:44:52 UTC  ``` It looks like this got new maintainers since I filed the bug. Jorge, please see if my init script could work. ```  [Comment 5](#c5)  Adam Feldman   gentoo-dev  2017-09-20 22:26:58 UTC  ``` commit 6f1fcfa83b146bdca6c5def233e63c14a0c89d7d (HEAD -> master, origin/master, origin/HEAD) Author: NP-Hardass <NP-Hardass@gentoo.org> Date:   Wed Sep 20 18:04:09 2017 -0400      profiles: base/package.use.mask package.mask: Drop net-misc/vde masks      Acked-By: mjo@gentoo.org     Bug: <https://bugs.gentoo.org/603382>  commit 26fdd489e493639d3ecc5bfb58175cb04828c15b Author: NP-Hardass <NP-Hardass@gentoo.org> Date:   Wed Sep 20 17:57:57 2017 -0400      net-misc/vde: Drop vulnerable versions      Bug: <https://bugs.gentoo.org/603382>     Package-Manager: Portage-2.3.8, Repoman-2.3.3  commit bd4f1fb99926525dd935c37f4ec35fd963d43e4a Author: NP-Hardass <NP-Hardass@gentoo.org> Date:   Wed Sep 20 17:57:05 2017 -0400      net-misc/vde: 2.3.2-r4 stable for amd64, x86      Package-Manager: Portage-2.3.8, Repoman-2.3.3  commit 487449d882b95ff9d88657746ee835553e461a27 Author: NP-Hardass <NP-Hardass@gentoo.org> Date:   Wed Sep 20 17:48:21 2017 -0400      net-misc/vde: Revbump to 2.3.2-r4, EAPI bump      Acked-By: mjo@gentoo.org     Bug: <https://bugs.gentoo.org/603382>     Package-Manager: Portage-2.3.8, Repoman-2.3.3  Only waiting on a ppc stabilization to bring it back to where it was, pre-mask ```  [Comment 6](#c6)  Michael Orlitzky   gentoo-dev  2017-09-29 16:56:32 UTC  ``` This is all good (thanks to np-hardass), can it please be made public so that I can reference it in the CVE request? ```  [Comment 7](#c7)  Michael Orlitzky   gentoo-dev  2017-10-24 21:16:06 UTC  ``` (In reply to Michael Orlitzky from [comment #6](show_bug.cgi?id=603382#c6)) > This is all good (thanks to np-hardass), can it please be made public so > that I can reference it in the CVE request?  Ping =) ```  [Comment 8](#c8)  Adam Feldman   gentoo-dev  2017-10-24 22:59:08 UTC  ``` (In reply to NP-Hardass from [comment #5](show_bug.cgi?id=603382#c5)) > commit 6f1fcfa83b146bdca6c5def233e63c14a0c89d7d (HEAD -> master, > origin/master, origin/HEAD) > Author: NP-Hardass <NP-Hardass@gentoo.org> > Date:   Wed Sep 20 18:04:09 2017 -0400 >  >     profiles: base/package.use.mask package.mask: Drop net-misc/vde masks >  >     Acked-By: mjo@gentoo.org >     Bug: <https://bugs.gentoo.org/603382> >  > commit 26fdd489e493639d3ecc5bfb58175cb04828c15b > Author: NP-Hardass <NP-Hardass@gentoo.org> > Date:   Wed Sep 20 17:57:57 2017 -0400 >  >     net-misc/vde: Drop vulnerable versions >  >     Bug: <https://bugs.gentoo.org/603382> >     Package-Manager: Portage-2.3.8, Repoman-2.3.3 >  > commit bd4f1fb99926525dd935c37f4ec35fd963d43e4a > Author: NP-Hardass <NP-Hardass@gentoo.org> > Date:   Wed Sep 20 17:57:05 2017 -0400 >  >     net-misc/vde: 2.3.2-r4 stable for amd64, x86 >  >     Package-Manager: Portage-2.3.8, Repoman-2.3.3 >  > commit 487449d882b95ff9d88657746ee835553e461a27 > Author: NP-Hardass <NP-Hardass@gentoo.org> > Date:   Wed Sep 20 17:48:21 2017 -0400 >  >     net-misc/vde: Revbump to 2.3.2-r4, EAPI bump >  >     Acked-By: mjo@gentoo.org >     Bug: <https://bugs.gentoo.org/603382> >     Package-Manager: Portage-2.3.8, Repoman-2.3.3 >  > Only waiting on a ppc stabilization to bring it back to where it was, > pre-mask  I should clarify that we dropped stable keywords for ppc in the interim.  We shouldn't be waiting on anything to move forward, AFAICT. ```  [Comment 9](#c9)  Michael Orlitzky   gentoo-dev  2017-11-06 22:53:43 UTC  ``` This was assigned CVE-2017-16638 so I think it's ready for security@ to finish up. ```  [Comment 10](#c10)  D'juan McDonald (domhnall)    2017-11-07 02:30:19 UTC  ``` CVE-2017-16638 (<https://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2017-16638>): The Gentoo net-misc/vde package before version 2.3.2-r4 may allow members of the "qemu" group to gain root privileges by creating a hard link in a directory on which "chown" is called recursively by the OpenRC service script.   @maintainer(s), proceed with stable-bot for: =net-misc/vde: Revbump to 2.3.2-r4  @security, Summary changed. Whiteboard changed. Severity changed. Vote changed.  Personally have never used package either. Change set attributes to object.   Gentoo Security Padawan: (jmbailey/mbailey_j) ```  [Comment 11](#c11)  Christopher Díaz Riveros (RETIRED)   gentoo-dev Security  2017-11-07 14:12:27 UTC  ``` Thank you all,  New GLSA Request filled. ```  [Comment 12](#c12)  GLSAMaker/CVETool Bot   gentoo-dev  2017-11-12 22:35:24 UTC  ``` This issue was resolved and addressed in  GLSA 201711-11 at <https://security.gentoo.org/glsa/201711-11> by GLSA coordinator Christopher Diaz Riveros (chrisadr). ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=603382)
* - [XML](show_bug.cgi?ctype=xml&id=603382)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=603382)
* - [Clone In The Same
  Product](enter_bug.cgi?cloned_bug_id=603382&product=Gentoo%20Security)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=603382&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=603382&GoAheadAndLogIn=1#forgot)
    Login:

    [x]


