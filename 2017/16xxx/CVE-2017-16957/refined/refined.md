```
{
  "vulnerability_details": {
    "root_cause": "The vulnerability is due to insufficient input validation in the `diagnostic.lua` script of TP-Link routers. Specifically, the `zone_get_effect_devices` function does not sanitize the 'iface' parameter from HTTP POST data before using it in a shell command via `io.popen`. This allows for command injection.",
    "weaknesses": [
      "Command Injection",
      "Lack of Input Validation"
    ],
    "impact": "Successful exploitation allows an attacker to execute arbitrary commands on the router's root shell.",
    "attack_vectors": [
      "HTTP POST request to `/cgi-bin/luci/;stok=<token>/admin/diagnostic?form=diag`",
      "Manipulation of the 'iface' parameter in the POST data with malicious shell commands."
    ],
     "required_capabilities": "The attacker needs to have valid web login credentials, or exploit a session hijack or a weak credential brute-force vulnerability in order to obtain access to `/cgi-bin/luci/;stok=<token>/admin/diagnostic?form=diag`."
  },
   "affected_components": [
    "Affected executable application: uhttpd",
        "Affected source code file: /usr/lib/lua/luci/controller/admin/diagnostic.lua",
        "Affected function: zone_get_effect_devices(t)"
    ],
    "affected_products":[
        "Tp-Link TL-WVR300 (Only hardware version v4)",
        "Tp-Link TL-WVR302 (only hardware version v2)",
        "Tp-Link TL-WVR450 (ALL the hardware version and firmware version)",
        "Tp-Link TL-WVR450L (ALL the hardware version and firmware version)",
        "Tp-Link TL-WVR450G (Only hardware version v5)",
        "Tp-Link TL-WVR458 (ALL the hardware version and firmware version)",
        "Tp-Link TL-WVR458L (ALL the hardware version and firmware version)",
        "Tp-Link TL-WVR458P (ALL the hardware version and firmware version)",
        "Tp-Link TL-WVR900G (Only hardware version v3)",
        "Tp-Link TL-WVR900L (ALL the hardware version and firmware version)",
        "Tp-Link TL-WVR1200L (ALL the hardware version and firmware version)",
        "Tp-Link TL-WVR1300L (ALL the hardware version and firmware version)",
        "Tp-Link TL-WVR1300G (ALL the hardware version and firmware version)",
        "Tp-Link TL-WVR1750L (ALL the hardware version and firmware version)",
        "Tp-Link TL-WVR2600L (ALL the hardware version and firmware version)",
        "Tp-Link TL-WVR4300L (ALL the hardware version and firmware version)",
        "Tp-Link TL-WAR302 (ALL the hardware version and firmware version)",
        "Tp-Link TL-WAR450 (ALL the hardware version and firmware version)",
        "Tp-Link TL-WAR450L (ALL the hardware version and firmware version)",
        "Tp-Link TL-WAR458 (ALL the hardware version and firmware version)",
        "Tp-Link TL-WAR458L (ALL the hardware version and firmware version)",
        "Tp-Link TL-WAR900L (ALL the hardware version and firmware version)",
        "Tp-Link TL-WAR1200L (ALL the hardware version and firmware version)",
        "Tp-Link TL-WAR1300L (ALL the hardware version and firmware version)",
        "Tp-Link TL-WAR1750L (ALL the hardware version and firmware version)",
        "Tp-Link TL-WAR2600L (ALL the hardware version and firmware version)",
        "Tp-Link TL-ER3210G (ALL the hardware version and firmware version)",
        "Tp-Link TL-ER3220G (ALL the hardware version and firmware version)",
        "Tp-Link TL-ER5110G (ALL the hardware version and firmware version)",
        "Tp-Link TL-ER5120G (ALL the hardware version and firmware version)",
         "Tp-Link TL-ER5510G (Only hardware version v2,v3)",
        "Tp-Link TL-ER5520G (Only hardware version v2,v3)",
        "Tp-Link TL-ER6110G (ALL the hardware version and firmware version)",
        "Tp-Link TL-ER6120G (Only hardware version v2)",
        "Tp-Link TL-ER6220G (ALL the hardware version and firmware version)",
        "Tp-Link TL-ER6510G (ALL the hardware version and firmware version)",
         "Tp-Link TL-ER6520G (Only hardware version v2,v3)",
        "Tp-Link TL-ER7520G (ALL the hardware version and firmware version)",
        "Tp-Link TL-R473 (only hardware version v5)",
        "Tp-Link TL-R473G (ALL the hardware version and firmware version)",
        "Tp-Link TL-R473P-AC (ALL the hardware version and firmware version)",
        "Tp-Link TL-R473GP-AC (ALL the hardware version and firmware version)",
        "Tp-Link TL-R478 (only hardware version v6)",
        "Tp-Link TL-R478+ (only hardware version v7)",
        "Tp-Link TL-R478G (ALL the hardware version and firmware version)",
         "Tp-Link TL-R478G+ (only hardware version v3)",
        "Tp-Link TL-R479P-AC (ALL the hardware version and firmware version)",
        "Tp-Link TL-R479GP-AC (ALL the hardware version and firmware version)",
        "Tp-Link TL-R479GPE-AC (ALL the hardware version and firmware version)",
        "Tp-Link TL-R483 (only hardware version v5)",
        "Tp-Link TL-R483G (only hardware version v2)",
        "Tp-Link TL-R488 (Only hardware version v5)",
        "Tp-Link TL-R4149G (ALL the hardware version and firmware version)",
        "Tp-Link TL-R4239G (Only hardware version v2)",
         "Tp-Link TL-R4299G (Only hardware version v2)"
        ]
}
```