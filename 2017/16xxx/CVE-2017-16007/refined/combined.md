=== Content from blog.intothesymmetry.com_632012dd_20250125_073047.html ===

[Skip to main content](#main)

# [Into the symmetry](http://blog.intothesymmetry.com/)

Search

### Search This Blog

### Critical vulnerability in JSON Web Encryption (JWE) - RFC 7516

[March 13, 2017](http://blog.intothesymmetry.com/2017/03/critical-vulnerability-in-json-web.html "permanent link")

tl;dr if you are using [go-jose](https://github.com/square/go-jose), [node-jose](https://github.com/cisco/node-jose), [jose2go](https://github.com/dvsekhvalnov/jose2go), [Nimbus JOSE+JWT](https://bitbucket.org/connect2id/nimbus-jose-jwt/wiki/Home) or [jose4j](https://bitbucket.org/b_c/jose4j/wiki/Home) with [ECDH-ES](https://tools.ietf.org/html/rfc7518#section-4.6) please update to the latest version. [RFC 7516 aka JSON Web Encryption (JWE)](https://tools.ietf.org/html/rfc7516) hence many software libraries implementing this specification used to suffer from a classic [Invalid Curve Attack](http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.107.3920&rep=rep1&type=pdf). This would allow an attacker to completely recover the secret key of a party using JWE with [Key Agreement with Elliptic Curve Diffie-Hellman Ephemeral Static (ECDH-ES)](https://tools.ietf.org/html/rfc7518#section-4.6), where the sender could extract receiver’s private key.

# Premise

In this blog post I assume you are already knowledgeable about elliptic curves and their use in cryptography. If not [Nick Sullivan](https://twitter.com/grittygrease)'s [A (Relatively Easy To Understand) Primer on Elliptic Curve Cryptography](https://blog.cloudflare.com/a-relatively-easy-to-understand-primer-on-elliptic-curve-cryptography/) or Andrea Corbellini's series [Elliptic Curve Cryptography: finite fields and discrete logarithms](http://andrea.corbellini.name/2015/05/23/elliptic-curve-cryptography-finite-fields-and-discrete-logarithms/) are great starting points. Then if you further want to [climb the elliptic learning curve](https://moderncrypto.org/mail-archive/curves/2016/000784.html) including the related attacks you might also want to visit <https://safecurves.cr.yp.to/>. Also [DJB and Tanja talk at 31c3](https://www.youtube.com/watch?v=y_YxRUTI-xU) comes with an explanation of this very attack (see minute 43) or  [Juraj Somorovsky et al's research](http://web-in-security.blogspot.ch/2015/09/practical-invalid-curve-attacks.html) can become handy for learners.

Note that this research was started and inspired by [Quan Nguyen from Google](https://research.google.com/pubs/pub45790.html) and then refined by [Antonio Sanso from Adobe](https://twitter.com/asanso).

# Introduction

JSON Web Token (JWT) is a JSON-based open standard ([RFC 7519](https://tools.ietf.org/html/rfc7519)) defined in the [OAuth specification family](https://tools.ietf.org/wg/oauth/) used for creating access tokens. The [Javascript Object Signing and Encryption (JOSE) IETF expert group](https://tools.ietf.org/wg/jose/) was then formed to formalize a set of signing and encryption methods for JWT that led to the release of  [RFC 7515 aka  JSON Web Signature (JWS)](https://tools.ietf.org/html/rfc7515) and [RFC 7516 aka JSON Web Encryption (JWE)](https://tools.ietf.org/html/rfc7516). In this post we are going to focus on JWE.

A typical JWE is dot separated string that contains five parts:

* The *JWE Protected Header*
* The *JWE Encrypted Key*
* The *JWE Initialization Vector*
* The *JWE Ciphertext*
* The *JWE Authentication Tag*

An example of a JWE taken from the [specification](https://tools.ietf.org/html/rfc7516#section-3.3) would look like:

       eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ.
     OKOawDo13gRp2ojaHV7LFpZcgV7T6DVZKTyKOMTYUmKoTCVJRgckCL9kiMT03JGe
     ipsEdY3mx\_etLbbWSrFr05kLzcSr4qKAq7YN7e9jwQRb23nfa6c9d-StnImGyFDb
     Sv04uVuxIp5Zms1gNxKKK2Da14B8S4rzVRltdYwam\_lDp5XnZAYpQdb76FdIKLaV
     mqgfwX7XWRxv2322i-vDxRfqNzo\_tETKzpVLzfiwQyeyPGLBIO56YJ7eObdv0je8
     1860ppamavo35UgoRdbYaBcoh9QcfylQr66oc6vFWXRcZ\_ZT2LawVCWTIy3brGPi
     6UklfCpIMfIjf7iGdXKHzg.
     48V1\_ALb6US04U3b.
     5eym8TW\_c8SuK0ltJ3rpYIzOeDQz7TALvtu6UG9oMo4vpzs9tX\_EFShS8iB7j6ji
     SdiwkIr3ajwQzaBtQD\_A.
     XFBoMYUZodetZdvTiFvSkQ

This JWE employs RSA-OAEP for key encryption and A256GCM for content encryption :

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjM-IbfW_HNodke4PhKnoI2ZxPTulnovY9fIxADOOUG1jVFp3yXxlu8i9bUhZpb40fFKQRzqxnBeS7jWkTuPsVWlYcuYIYcxCyGGowUP5E_LHWaSRFyCT3KB9N1zQLILQkzKfy50rmOryOF/s400/header0.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjM-IbfW_HNodke4PhKnoI2ZxPTulnovY9fIxADOOUG1jVFp3yXxlu8i9bUhZpb40fFKQRzqxnBeS7jWkTuPsVWlYcuYIYcxCyGGowUP5E_LHWaSRFyCT3KB9N1zQLILQkzKfy50rmOryOF/s1600/header0.png)

This is only one of the many possibilities JWE provides. A separate specification called [RFC 7518 aka JSON Web Algorithms (JWA)](https://tools.ietf.org/html/rfc7518) lists all the possible available algorithms that can be used. The one we are discussing today is the [Key Agreement with Elliptic Curve Diffie-Hellman Ephemeral Static (ECDH-ES)](https://tools.ietf.org/html/rfc7518#section-4.6).  This algorithm allows deriving an ephemeral shared secret ([this blog post from Neil Madden](https://neilmadden.wordpress.com/2016/05/20/ephemeral-elliptic-curve-diffie-hellman-key-agreement-in-java/) shows a concrete example on how to do ephemeral key agreement).

In this case the *JWE Protected Header* lists as well the used elliptic curve used for  the key agreement:

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiJzkHqi7xZURRT95JSWKZtBuSFMBF_1JxHKz6omNP9jQLyeEBW9zTD1B5KJt-MvNflQPm1IQ102IiuPn3Slq2LO4Xd7wmJSOvCUPpFTq9w7JEwFk2PvpFMkaEiFFA2b7jrfbKKDT0tPV_D/s400/header.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiJzkHqi7xZURRT95JSWKZtBuSFMBF_1JxHKz6omNP9jQLyeEBW9zTD1B5KJt-MvNflQPm1IQ102IiuPn3Slq2LO4Xd7wmJSOvCUPpFTq9w7JEwFk2PvpFMkaEiFFA2b7jrfbKKDT0tPV_D/s1600/header.png)

Once the shared secret is calculated the key agreement result can be used in one of two ways:

**1.** directly as the Content Encryption Key (CEK) for the "enc" algorithm, in the Direct Key Agreement mode, or

**2.** as a symmetric key used to wrap the CEK with the A128KW, A192KW, or A256KW algorithms, in the Key Agreement with Key Wrapping mode.

This is out of scope for this post but as for the other algorithms the [JOSE Cookbook](https://tools.ietf.org/html/rfc7520) contains example of usage for ECDH-ES in combination with AES-GCM or AES-CBC plus HMAC.
# Observation

As highlighted by Quan during is talk at [RWC 2017](https://www.realworldcrypto.com/rwc2017) :

#### ***Decryption/Signature verification’ input is always under attacker’s control***

As we will see thorough thispost this simple observation will be enough to fully recover the receiver’s private key. But first we need to dig a bit into elliptic curve bits and pieces.

# Elliptic Curves

An elliptic curve is the set of solutions defined by an equation of the form

y^2 = x^3 + ax + b

Equations of this type are called *Weierstrass equations*. An elliptic curve would look like:

|  |
| --- |
| **y^2 = x^3 + 4x + 20** |

In order to apply the theory of elliptic curves to cryptography we need to look at elliptic curves whose points have coordinates in a finite field Fq. The same curve will then look like below over Finite Field of size 191:

|  |
| --- |
| **y^2 = x^3 + 4x + 20 over Finite Field of size 191** |

For JWE the elliptic curves in scope are the one defined in [Suite B](https://www.nsa.gov/ia/programs/suiteb_cryptography/index.shtml) and ([only recently](https://www.rfc-editor.org/rfc/rfc8037.txt)) [DJB](https://cr.yp.to/djb.html)'s curve.

Between those, the curve that so far has reached the higher amount of usage is the famous P-256 (defined in Suite B).

Time to open [Sage](http://www.sagemath.org/). Let's define P-256:

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgzD54KrTyR8XvS7T17K0_7sWg2dZBW3HGpPRufYSGLDXZO-vrG3F8yL1FOmcOkV0zDfbWOhZm_tVKrEhoQAwutOJNUnmvbvMrn_VRWzU_CbkhIeGN_ebvjrXYMmzXg9RTjpd6OSktePDAK/s400/p256.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgzD54KrTyR8XvS7T17K0_7sWg2dZBW3HGpPRufYSGLDXZO-vrG3F8yL1FOmcOkV0zDfbWOhZm_tVKrEhoQAwutOJNUnmvbvMrn_VRWzU_CbkhIeGN_ebvjrXYMmzXg9RTjpd6OSktePDAK/s1600/p256.png)

The order of the curve is a really huge number hence there isn't much an attacker can do with this curve (if the software implements ECDH correctly) in order to guess the private key used in the agreement. This brings us to the next section:

# The Attack

The attack described here is really the classical [Invalid Curve Attack](http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.107.3920&rep=rep1&type=pdf). The attack is as simple as powerful and takes advantage from the mere fact that Weierstrass's formula for scalar multiplication does not take in consideration the coefficient **b**of the curve equation:

y^2 = ax^3 + ax + b

The original's P-256 equation is

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgzD54KrTyR8XvS7T17K0_7sWg2dZBW3HGpPRufYSGLDXZO-vrG3F8yL1FOmcOkV0zDfbWOhZm_tVKrEhoQAwutOJNUnmvbvMrn_VRWzU_CbkhIeGN_ebvjrXYMmzXg9RTjpd6OSktePDAK/s400/p256.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgzD54KrTyR8XvS7T17K0_7sWg2dZBW3HGpPRufYSGLDXZO-vrG3F8yL1FOmcOkV0zDfbWOhZm_tVKrEhoQAwutOJNUnmvbvMrn_VRWzU_CbkhIeGN_ebvjrXYMmzXg9RTjpd6OSktePDAK/s1600/p256.png)

As we mention above the order of this curve is really big. So we need now to find a more convenient curve for the attacker. Easy peasy with Sage:

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgSUWvXm7uy1-IpGqmWHQuKoSLqhnfIf9TnLSenbGlpe7-FL7dgLI6FgmvOI9F1RciHN19WknPNDL8u5UmCKV21xLl6-6gUWk_I9GRuhQKLDDV0HpLtWqW0HU7Pjg5yPZf5b7dy_vqOq2PT/s400/lift.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgSUWvXm7uy1-IpGqmWHQuKoSLqhnfIf9TnLSenbGlpe7-FL7dgLI6FgmvOI9F1RciHN19WknPNDL8u5UmCKV21xLl6-6gUWk_I9GRuhQKLDDV0HpLtWqW0HU7Pjg5yPZf5b7dy_vqOq2PT/s1600/lift.png)

As you can see from the image above we just found a nicer curve (from the attacker point of view) that has an order with many small factors. Then we found a point **P** on the curve that has a really small order (2447 in this example).

Now we can build malicious JWEs (see the **Demo Time section** below) and extract the value of the secret key modulo 2447 with complexity O(2447).

A crucial part for the attack to succeed is to have the victim to repeat his own contribution to the resulting shared key. In other words this means that the victim should have his private key to be the same for each key agreement. Conveniently enough this is how the [Key Agreement with Elliptic Curve Diffie-Hellman Ephemeral Static (ECDH-ES)](https://tools.ietf.org/html/rfc7518#section-4.6) works. Indeed ES stands for Ephemeral-Static were Static is the contribution of the victim!

At this stage we can repeat these operations (find a new curve, craft malicious JWEs, recover the secret key modulo the small order) many many times and collecting information about the secret key modulo many many small orders.

And finally [Chinese Remainder Theorem](https://en.wikipedia.org/wiki/Chinese_remainder_theorem) for the win!

At the end of the day the issue here is that the specification and consequently all the libraries I checked missed to validate that the received public key (contained in the *JWE Protected Header)* is on the curve. You can see the **Vulnerable Libraries section** below to check how the various libraries fixed the issue.
Again you can find details of the attack in the [original paper](http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.107.3920&rep=rep1&type=pdf).
# Demo Time

#### [INSTANT DEMO CLICK HERE](https://afternoon-fortress-81941.herokuapp.com/)

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiDf_Tw74nGxhEfHXQY2Ba3EC6cuhG8x6utZCvYw0VOJTSQqq9Ux4lSs5DzDPDWMeKzym6ITlFqalsDTxQgTNh_LX3fNJvHM4Oz3E-Q4TBrwKkvqr71PKfz6i_SSsDG1Vfb9vglN-pbwZkU/s400/attacker.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiDf_Tw74nGxhEfHXQY2Ba3EC6cuhG8x6utZCvYw0VOJTSQqq9Ux4lSs5DzDPDWMeKzym6ITlFqalsDTxQgTNh_LX3fNJvHM4Oz3E-Q4TBrwKkvqr71PKfz6i_SSsDG1Vfb9vglN-pbwZkU/s1600/attacker.png)
####

#### Explanation

In order to show how the attack would work in practice I set up a live demo in Heroku. In <https://obscure-everglades-31759.herokuapp.com/>is up and running one Node.js server app that will act as a victim in this case. The assumption is this: in order to communicate with this web application you need to encrypt a token using the [Key Agreement with Elliptic Curve Diffie-Hellman Ephemeral Static (ECDH-ES)](https://tools.ietf.org/html/rfc7518#section-4.6). The static public key from the server needed for the key agreement is in <https://obscure-everglades-31759.herokuapp.com/ecdh-es-public.json>:

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhVWnajHeGV6Q9uAWlvWV3oBahIRiyIuXumkaM2kX11eoWvNPTE3rxItMJW477XXi6yWJYh1eq4LXxd_eHESqIdFtTd1RjhSgwQAI12uY4MGC_t3PiagW8H-oC053uX9A3imAi8sByAMr3n/s320/ecdh.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhVWnajHeGV6Q9uAWlvWV3oBahIRiyIuXumkaM2kX11eoWvNPTE3rxItMJW477XXi6yWJYh1eq4LXxd_eHESqIdFtTd1RjhSgwQAI12uY4MGC_t3PiagW8H-oC053uX9A3imAi8sByAMr3n/s1600/ecdh.png)
An application that want to POST data to this server needs first to do a key agreement using the server's  public key above and then encrypt the payload using the derived shared key using the JWE format. Once the JWE is in place this can be posted to <https://obscure-everglades-31759.herokuapp.com/secret> . The web app will respond with a *response status 200* if all went well (namely if it can decrypt the payload content) and with a  *response status 400* if for some reason the received token is missing or invalid. This will act as an oracle for any potential attacker in the way shown in the previous **The Attack** section.

I set up an attacker application in <https://afternoon-fortress-81941.herokuapp.com/> .

You can visit it and click the '**Recover Key**' button and observe how the attacker is able to recover the secret key from the server piece by piece. Note that this is only a demo application so the recovered secret key is really small in order to reduce the waiting time. In practice the secret key will be significantly larger (hence it will take a bit more to recover the key).

In case you experience problem with the live demo, or simply if  want to see the code under the hood, you can find the demo code in Github:

* <https://github.com/asanso/jwe-receiver> contains the code of the **vulnerable server**.
* <https://github.com/asanso/jwe-sender> contains the code of the **attacker**.

# Vulnerable Libraries

Here you can find a list of libraries that were vulnerable to this particular attack so far:

* [node-jose](https://github.com/cisco/node-jose)  v0.9.3 include the fixes necessary, which was [published few weeks ago](https://github.com/cisco/node-jose/blob/master/CHANGELOG.md). Here the [Gist](https://gist.github.com/asanso/fa25685348051ef6a28d49aa0f27a4ae) of the original proof of concept.\*
* [jose2go](https://github.com/dvsekhvalnov/jose2go)'s fix landed in [version 1.3](https://groups.google.com/forum/#!topic/golang-nuts/iyaBhyOX9A0).
* [Nimbus JOSE+JWT](https://bitbucket.org/connect2id/nimbus-jose-jwt/wiki/Home) pushed out a fixed artifact to Maven central as v4.34.2 . Here the [Gist](https://gist.github.com/asanso/5b8cabb862e6f730e00a97d8565dc325) of the original proof of concept.\*\*
* [jose4j](https://bitbucket.org/b_c/jose4j/wiki/Home) now comes with a [fix](https://bitbucket.org/b_c/jose4j/commits/0517896170af8d5c057407c70a7b08dae454829e) for this problem since v0.5.5 . Here the [Gist](https://gist.github.com/asanso/350e3ce993e44d0509c6023aa77fc6af) of the original proof of concept.\*\*
* [go-jose](https://github.com/square/go-jose) (this is the original library found vulnerable by [Quan Nguyen)](https://research.google.com/pubs/pub45790.html)

Some of the libraries were implemented in a programming language that already protects against this attack checking that the result of the scalar multiplication is on the curve:

\* Latest version of Node.js is immune to this attack. It was still possible to be vulnerable when using  browsers without web crypto support.

\*\* Affected was the default Java SUN JCA provider that comes with Java prior to version 1.8.0\_51. Later Java versions and the BouncyCastle JCA provider are not affected.

# Improving the JWE standard

I reported this issue to the JOSE working group via a [mail to the appropriate mailing list](https://www.ietf.org/mail-archive/web/jose/current/msg05612.html). We all seem to agree that an errata where the problem is listed is at least welcomed.This post is a direct attempt to raise awareness about this specific problem.

# Acknowledgement

The author would like to thanks the maintainers of [go-jose](https://github.com/square/go-jose), [node-jose](https://github.com/cisco/node-jose), [jose2go](https://github.com/dvsekhvalnov/jose2go), [Nimbus JOSE+JWT](https://bitbucket.org/connect2id/nimbus-jose-jwt/wiki/Home) and [jose4j](https://bitbucket.org/b_c/jose4j/wiki/Home) for the responsiveness on fixing the issue. [Francesco Mari](https://twitter.com/francescomari) for helping out with the development of the demo application. [Tommaso Teofili](https://twitter.com/tteofili) and [Simone Tripodi](https://twitter.com/simonetripodi) for troubleshooting. Finally as mentioned above I would like to thank [Quan Nguyen from Google](https://research.google.com/pubs/pub45790.html), indeed this research could not be possible without his initial incipit.

**That's all folks. For more crypto goodies, [follow me on Twitter](https://twitter.com/asanso/).**

Share

* Get link
* Facebook
* X
* Pinterest
* Email
* Other Apps

### Labels

[bounty](http://blog.intothesymmetry.com/search/label/bounty)
[crypto](http://blog.intothesymmetry.com/search/label/crypto)
[jwe](http://blog.intothesymmetry.com/search/label/jwe)
[jwt](http://blog.intothesymmetry.com/search/label/jwt)
[vulnerability](http://blog.intothesymmetry.com/search/label/vulnerability)

Labels:
[bounty](http://blog.intothesymmetry.com/search/label/bounty)
[crypto](http://blog.intothesymmetry.com/search/label/crypto)
[jwe](http://blog.intothesymmetry.com/search/label/jwe)
[jwt](http://blog.intothesymmetry.com/search/label/jwt)
[vulnerability](http://blog.intothesymmetry.com/search/label/vulnerability)

Share

* Get link
* Facebook
* X
* Pinterest
* Email
* Other Apps

### Comments

![](//www.blogger.com/img/blogger_logo_round_35.png)

[Unknown](https://www.blogger.com/profile/03180972204867205393) said…

I hope people know that this is a problem with JOSE implementations and/or how they are used rather than the spec itself.

[17 March 2017 at 12:55](http://blog.intothesymmetry.com/2017/03/critical-vulnerability-in-json-web.html?showComment=1489780523048#c1745697670802127874 "comment permalink")
[![](https://resources.blogblog.com/img/icon_delete13.gif)](https://www.blogger.com/delete-comment.g?blogID=5832863639484084941&postID=1745697670802127874 "Delete Comment")

![](//www.blogger.com/img/blogger_logo_round_35.png)

[ll](https://www.blogger.com/profile/13409233330078201207) said…

true. Said that the spec could better warn the implementers. I bet it would have been way less vulnerable implementations...

[21 March 2017 at 00:57](http://blog.intothesymmetry.com/2017/03/critical-vulnerability-in-json-web.html?showComment=1490083036180#c6054658322352681371 "comment permalink")
[![](https://resources.blogblog.com/img/icon_delete13.gif)](https://www.blogger.com/delete-comment.g?blogID=5832863639484084941&postID=6054658322352681371 "Delete Comment")

[Post a Comment](https://www.blogger.com/comment/fullpage/post/5832863639484084941/2944417194682605697)

### Popular posts from this blog

### [OpenSSL Key Recovery Attack on DH small subgroups (CVE-2016-0701)](http://blog.intothesymmetry.com/2016/01/openssl-key-recovery-attack-on-dh-small.html)

[January 28, 2016](http://blog.intothesymmetry.com/2016/01/openssl-key-recovery-attack-on-dh-small.html "permanent link")

Usual Mandatory Disclaimer: IANAC (I am not a cryptographer) so I might likely end up writing a bunch of mistakes in this blog post... tl;dr The OpenSSL 1.0.2 releases suffer from a Key Recovery Attack on DH small subgroups . This issue got assigned CVE-2016-0701 with a severity of High and OpenSSL 1.0.2 users should upgrade to 1.0.2f. If an application is using DH configured with parameters based on primes that are not "safe" or not Lim-Lee (as the one in RFC 5114 ) and either Static DH ciphersuites are used or DHE ciphersuites with the default OpenSSL configuration (in particular SSL\_OP\_SINGLE\_DH\_USE is not set) then is vulnerable to this attack.  It is believed that many popular applications (e.g. Apache mod\_ssl) do set the  SSL\_OP\_SINGLE\_DH\_USE option and would therefore not be at risk (for DHE ciphersuites), they still might be for Static DH ciphersuites. Introduction So if you are still here it means you wanna know more. And here is the thing. In my last bl...

Share

* Get link
* Facebook
* X
* Pinterest
* Email
* Other Apps

[23 comments](https://www.blogger.com/comment/fullpage/post/5832863639484084941/2235833002254502540)

[Read more](http://blog.intothesymmetry.com/2016/01/openssl-key-recovery-attack-on-dh-small.html "OpenSSL Key Recovery Attack on DH small subgroups (CVE-2016-0701)")

### [The Curious Case of WebCrypto Diffie-Hellman on Firefox - Small Subgroups Key Recovery Attack on DH](http://blog.intothesymmetry.com/2020/01/the-curious-case-of-webcrypto-diffie.html)

[January 07, 2020](http://blog.intothesymmetry.com/2020/01/the-curious-case-of-webcrypto-diffie.html "permanent link")

tl;dr Mozilla Firefox prior to version 72 suffers from Small Subgroups Key Recovery Attack on DH in the WebCrypto 's API. The Firefox's team fixed the issue r emoving completely support for DH over finite fields (that is not in the WebCrypto standard). If you find this interesting read further below. Premise In this blog post I assume you are already knowledgeable about Diffie-Hellman over finite fields and related attacks. If not I recommend to read any cryptography book that covers public key cryptography. Here is a really cool simple explanation by David Wong : I found a cooler way to explain Diffie-Hellman :D pic.twitter.com/DlPvGwZbto — David Wong (@cryptodavidw) January 4, 2020 If you want more details about Small Subgroups Key Recovery Attack on DH I covered some background in one of my previous post ( OpenSSL Key Recovery Attack on DH small subgroups (CVE-2016-0701) ). There is also an academic pape r where we examine the issue with some more rigors. ...

Share

* Get link
* Facebook
* X
* Pinterest
* Email
* Other Apps

[2 comments](https://www.blogger.com/comment/fullpage/post/5832863639484084941/7432388175917295566)

[Read more](http://blog.intothesymmetry.com/2020/01/the-curious-case-of-webcrypto-diffie.html "The Curious Case of WebCrypto Diffie-Hellman on Firefox -   Small Subgroups Key Recovery Attack on DH")

### twitter

> Verifiable Delay Functions from Supersingular Isogenies and Pairings with [@luca\_defeo](https://twitter.com/luca_defeo?ref_src=twsrc%5Etfw) [@SimonMasson2](https://twitter.com/SimonMasson2?ref_src=twsrc%5Etfw) and Christophe Petit <https://t.co/Z9hMv4q4wK> [pic.twitter.com/Z3yR8FCZbb](https://t.co/Z3yR8FCZbb)
>
> — Antonio Sanso (@asanso) [February 21, 2019](https://twitter.com/asanso/status/1098592424992092167?ref_src=twsrc%5Etfw)

### Books from me

[![Books from me](https://images.manning.com/255/340/resize/book/e/14336f9-6493-46dc-938c-11a34c9d20ac/Richer-OAuth2-HI.png)](https://www.manning.com/books/oauth-2-in-action)

OAuth 2 in Action

### Archive

* [January 20201](http://blog.intothesymmetry.com/2020/01/)
* [August 20191](http://blog.intothesymmetry.com/2019/08/)
* [July 20192](http://blog.intothesymmetry.com/2019/07/)
* [May 20191](http://blog.intothesymmetry.com/2019/05/)
* [December 20182](http://blog.intothesymmetry.com/2018/12/)
* [July 20181](http://blog.intothesymmetry.com/2018/07/)
* [April 20181](http://blog.intothesymmetry.com/2018/04/)
* [February 20181](http://blog.intothesymmetry.com/2018/02/)
* [January 20182](http://blog.intothesymmetry.com/2018/01/)
* [December 20171](http://blog.intothesymmetry.com/2017/12/)

* [October 20172](http://blog.intothesymmetry.com/2017/10/)
* [August 20172](http://blog.intothesymmetry.com/2017/08/)
* [June 20171](http://blog.intothesymmetry.com/2017/06/)
* [May 20172](http://blog.intothesymmetry.com/2017/05/)
* [April 20172](http://blog.intothesymmetry.com/2017/04/)
* [March 20171](http://blog.intothesymmetry.com/2017/03/)
* [November 20161](http://blog.intothesymmetry.com/2016/11/)
* [October 20161](http://blog.intothesymmetry.com/2016/10/)
* [June 20161](http://blog.intothesymmetry.com/2016/06/)
* [May 20161](http://blog.intothesymmetry.com/2016/05/)
* [April 20161](http://blog.intothesymmetry.com/2016/04/)
* [January 20162](http://blog.intothesymmetry.com/2016/01/)
* [December 20153](http://blog.intothesymmetry.com/2015/12/)
* [October 20151](http://blog.intothesymmetry.com/2015/10/)
* [September 20152](http://blog.intothesymmetry.com/2015/09/)
* [August 20151](http://blog.intothesymmetry.com/2015/08/)
* [June 20151](http://blog.intothesymmetry.com/2015/06/)
* [May 20151](http://blog.intothesymmetry.com/2015/05/)
* [April 20151](http://blog.intothesymmetry.com/2015/04/)
* [March 20151](http://blog.intothesymmetry.com/2015/03/)
* [January 20151](http://blog.intothesymmetry.com/2015/01/)
* [December 20141](http://blog.intothesymmetry.com/2014/12/)
* [October 20141](http://blog.intothesymmetry.com/2014/10/)
* [September 20142](http://blog.intothesymmetry.com/2014/09/)
* [August 20141](http://blog.intothesymmetry.com/2014/08/)
* [April 20142](http://blog.intothesymmetry.com/2014/04/)
* [February 20141](http://blog.intothesymmetry.com/2014/02/)
* [May 20132](http://blog.intothesymmetry.com/2013/05/)
* [October 20121](http://blog.intothesymmetry.com/2012/10/)
* [August 20121](http://blog.intothesymmetry.com/2012/08/)
* [June 20122](http://blog.intothesymmetry.com/2012/06/)
* [January 20121](http://blog.intothesymmetry.com/2012/01/)
* [January 20111](http://blog.intothesymmetry.com/2011/01/)
* [August 20101](http://blog.intothesymmetry.com/2010/08/)
* [June 20101](http://blog.intothesymmetry.com/2010/06/)
* [May 20102](http://blog.intothesymmetry.com/2010/05/)
* [March 20102](http://blog.intothesymmetry.com/2010/03/)
* [February 20101](http://blog.intothesymmetry.com/2010/02/)

Show more
Show less

### Labels

* [AS vulnerability](http://blog.intothesymmetry.com/search/label/AS%20vulnerability)
* [bounty](http://blog.intothesymmetry.com/search/label/bounty)
* [browser-security](http://blog.intothesymmetry.com/search/label/browser-security)
* [client vulnerability](http://blog.intothesymmetry.com/search/label/client%20vulnerability)
* [crypto](http://blog.intothesymmetry.com/search/label/crypto)
* [csrf](http://blog.intothesymmetry.com/search/label/csrf)
* [dh](http://blog.intothesymmetry.com/search/label/dh)
* [ecc](http://blog.intothesymmetry.com/search/label/ecc)
* [isogeny](http://blog.intothesymmetry.com/search/label/isogeny)
* [ita](http://blog.intothesymmetry.com/search/label/ita)

* [jwe](http://blog.intothesymmetry.com/search/label/jwe)
* [jwt](http://blog.intothesymmetry.com/search/label/jwt)
* [kubernetes](http://blog.intothesymmetry.com/search/label/kubernetes)
* [MS DRBG](http://blog.intothesymmetry.com/search/label/MS%20DRBG)
* [oauth](http://blog.intothesymmetry.com/search/label/oauth)
* [oltu](http://blog.intothesymmetry.com/search/label/oltu)
* [openssl](http://blog.intothesymmetry.com/search/label/openssl)
* [pre-oauth](http://blog.intothesymmetry.com/search/label/pre-oauth)
* [saml](http://blog.intothesymmetry.com/search/label/saml)
* [tls](http://blog.intothesymmetry.com/search/label/tls)
* [vdf](http://blog.intothesymmetry.com/search/label/vdf)
* [vulnerability](http://blog.intothesymmetry.com/search/label/vulnerability)

Show more
Show less

[Powered by Blogger](https://www.blogger.com)



=== Content from github.com_6ebdf2d9_20250125_073049.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcisco%2Fnode-jose)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcisco%2Fnode-jose)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=cisco%2Fnode-jose)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[cisco](/cisco)
/
**[node-jose](/cisco/node-jose)**
Public

* [Notifications](/login?return_to=%2Fcisco%2Fnode-jose) You must be signed in to change notification settings
* [Fork
  125](/login?return_to=%2Fcisco%2Fnode-jose)
* [Star
   707](/login?return_to=%2Fcisco%2Fnode-jose)

### License

[Apache-2.0 license](/cisco/node-jose/blob/master/LICENSE)

[707
stars](/cisco/node-jose/stargazers) [125
forks](/cisco/node-jose/forks) [Branches](/cisco/node-jose/branches) [Tags](/cisco/node-jose/tags) [Activity](/cisco/node-jose/activity)
 [Star](/login?return_to=%2Fcisco%2Fnode-jose)

 [Notifications](/login?return_to=%2Fcisco%2Fnode-jose) You must be signed in to change notification settings

* [Code](/cisco/node-jose)
* [Issues
  56](/cisco/node-jose/issues)
* [Pull requests
  9](/cisco/node-jose/pulls)
* [Actions](/cisco/node-jose/actions)
* [Projects
  0](/cisco/node-jose/projects)
* [Wiki](/cisco/node-jose/wiki)
* [Security](/cisco/node-jose/security)
* [Insights](/cisco/node-jose/pulse)

Additional navigation options

* [Code](/cisco/node-jose)
* [Issues](/cisco/node-jose/issues)
* [Pull requests](/cisco/node-jose/pulls)
* [Actions](/cisco/node-jose/actions)
* [Projects](/cisco/node-jose/projects)
* [Wiki](/cisco/node-jose/wiki)
* [Security](/cisco/node-jose/security)
* [Insights](/cisco/node-jose/pulse)

# cisco/node-jose

    master[Branches](/cisco/node-jose/branches)[Tags](/cisco/node-jose/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[275 Commits](/cisco/node-jose/commits/master/) | | |
| [.github](/cisco/node-jose/tree/master/.github ".github") | | [.github](/cisco/node-jose/tree/master/.github ".github") |  |  |
| [lib](/cisco/node-jose/tree/master/lib "lib") | | [lib](/cisco/node-jose/tree/master/lib "lib") |  |  |
| [test](/cisco/node-jose/tree/master/test "test") | | [test](/cisco/node-jose/tree/master/test "test") |  |  |
| [.editorconfig](/cisco/node-jose/blob/master/.editorconfig ".editorconfig") | | [.editorconfig](/cisco/node-jose/blob/master/.editorconfig ".editorconfig") |  |  |
| [.eslintrc](/cisco/node-jose/blob/master/.eslintrc ".eslintrc") | | [.eslintrc](/cisco/node-jose/blob/master/.eslintrc ".eslintrc") |  |  |
| [.gitignore](/cisco/node-jose/blob/master/.gitignore ".gitignore") | | [.gitignore](/cisco/node-jose/blob/master/.gitignore ".gitignore") |  |  |
| [.npmignore](/cisco/node-jose/blob/master/.npmignore ".npmignore") | | [.npmignore](/cisco/node-jose/blob/master/.npmignore ".npmignore") |  |  |
| [.travis.yml](/cisco/node-jose/blob/master/.travis.yml ".travis.yml") | | [.travis.yml](/cisco/node-jose/blob/master/.travis.yml ".travis.yml") |  |  |
| [AUTHORS](/cisco/node-jose/blob/master/AUTHORS "AUTHORS") | | [AUTHORS](/cisco/node-jose/blob/master/AUTHORS "AUTHORS") |  |  |
| [CHANGELOG.md](/cisco/node-jose/blob/master/CHANGELOG.md "CHANGELOG.md") | | [CHANGELOG.md](/cisco/node-jose/blob/master/CHANGELOG.md "CHANGELOG.md") |  |  |
| [LICENSE](/cisco/node-jose/blob/master/LICENSE "LICENSE") | | [LICENSE](/cisco/node-jose/blob/master/LICENSE "LICENSE") |  |  |
| [README.md](/cisco/node-jose/blob/master/README.md "README.md") | | [README.md](/cisco/node-jose/blob/master/README.md "README.md") |  |  |
| [gulpfile.js](/cisco/node-jose/blob/master/gulpfile.js "gulpfile.js") | | [gulpfile.js](/cisco/node-jose/blob/master/gulpfile.js "gulpfile.js") |  |  |
| [package-lock.json](/cisco/node-jose/blob/master/package-lock.json "package-lock.json") | | [package-lock.json](/cisco/node-jose/blob/master/package-lock.json "package-lock.json") |  |  |
| [package.json](/cisco/node-jose/blob/master/package.json "package.json") | | [package.json](/cisco/node-jose/blob/master/package.json "package.json") |  |  |
| [runas](/cisco/node-jose/blob/master/runas "runas") | | [runas](/cisco/node-jose/blob/master/runas "runas") |  |  |
| View all files | | |

## Repository files navigation

* README
* Apache-2.0 license
# node-jose

[![Greenkeeper badge](https://camo.githubusercontent.com/0f2863932e9721240514d231a4adeed2ba9d02d7caf14da53b57e0f5564a8361/68747470733a2f2f6261646765732e677265656e6b65657065722e696f2f636973636f2f6e6f64652d6a6f73652e737667)](https://greenkeeper.io/)
[![Build Status](https://camo.githubusercontent.com/330572dbdd3f02cf5f8441076533f814c6c2f9beff95de59620853fdedbb3f0b/68747470733a2f2f7472617669732d63692e6f72672f636973636f2f6e6f64652d6a6f73652e7376673f6272616e63683d6d6173746572)](https://travis-ci.org/cisco/node-jose)

A JavaScript implementation of the JSON Object Signing and Encryption (JOSE) for current web browsers and node.js-based servers. This library implements (wherever possible) all algorithms, formats, and options in [JWS](https://tools.ietf.org/html/rfc7515 "Jones, M., J. Bradley and N. Sakimura, 'JSON Web Signature (JWS)' RFC 7515, May 2015"), [JWE](https://tools.ietf.org/html/rfc7516 "Jones, M. and J. Hildebrand 'JSON Web Encryption (JWE)', RFC 7516, May 2015"), [JWK](https://tools.ietf.org/html/rfc7517 "Jones, M., 'JSON Web Key (JWK)', RFC 7517, May 2015"), and [JWA](https://tools.ietf.org/html/rfc7518 "Jones, M., 'JSON Web Algorithms (JWA)', RFC 7518, May 2015") and uses native cryptographic support ([WebCrypto API](http://www.w3.org/TR/WebCryptoAPI/) or node.js' "[crypto](https://nodejs.org/api/crypto.html)" module) where feasible.

* [Installing](#installing)
* [Basics](#basics)
* [Keys and Key Stores](#keys-and-key-stores)
  + [Obtaining a KeyStore](#obtaining-a-keystore)
  + [Exporting a KeyStore](#exporting-a-keystore)
  + [Retrieving Keys](#retrieving-keys)
  + [Searching for Keys](#searching-for-keys)
  + [Managing Keys](#managing-keys)
  + [Importing and Exporting a Single Key](#importing-and-exporting-a-single-key)
  + [Obtaining a Key's Thumbprint](#obtaining-a-keys-thumbprint)
* [Signatures](#signatures)
  + [Keys Used for Signing and Verifying](#keys-used-for-signing-and-verifying)
  + [Signing Content](#signing-content)
  + [Verifying a JWS](#verifying-a-jws)
    - [Allowing (or Disallowing) Signature Algorithms](#allowing-or-disallowing-signature-algorithms)
    - [Handling `crit` Header Members](#handling-crit-header-members)
* [Encryption](#encryption)
  + [Keys Used for Encrypting and Decrypting](#keys-used-for-encrypting-and-decrypting)
  + [Encrypting Content](#encrypting-content)
  + [Decrypting a JWE](#decrypting-a-jwe)
    - [Allowing (or Disallowing) Encryption Algorithms](#allowing-or-disallowing-encryption-algorithms)
    - [Handling `crit` Header Members](#handling-crit-header-members-1)
* [Useful Utilities](#useful-utilities)
  + [Converting to Buffer](#converting-to-buffer)
  + [URI-Safe Base64](#uri-safe-base64)
  + [Random Bytes](#random-bytes)

## Installing

To install the latest from [NPM](https://npmjs.com/):

```
  npm install node-jose
```

Or to install a specific release:

```
  npm install node-jose@0.3.0
```

Alternatively, the latest unpublished code can be installed directly from the repository:

```
  npm install git+https://github.com/cisco/node-jose.git
```

## Basics

Require the library as normal:

```
var jose = require('node-jose');
```

This library uses [Promises](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise) for nearly every operation.

This library supports [Browserify](http://browserify.org/) and [Webpack](https://webpack.github.io/). To use in a web browser, `require('node-jose')` and bundle with the rest of your app.

The content to be signed/encrypted -- or returned from being verified/decrypted -- are [Buffer](https://nodejs.org/api/buffer.html) objects.

## Keys and Key Stores

The `jose.JWK` namespace deals with JWK and JWK-sets.

* `jose.JWK.Key` is a logical representation of a JWK, and is the "raw" entry point for various cryptographic operations (e.g., sign, verify, encrypt, decrypt).
* `jose.JWK.KeyStore` represents a collection of Keys.

Creating a JWE or JWS ultimately require one or more explicit Key objects.

Processing a JWE or JWS relies on a KeyStore.

### Obtaining a KeyStore

To create an empty keystore:

```
keystore = jose.JWK.createKeyStore();
```

To import a JWK-set as a keystore:

```
// {input} is a String or JSON object representing the JWK-set
jose.JWK.asKeyStore(input).
     then(function(result) {
       // {result} is a jose.JWK.KeyStore
       keystore = result;
     });
```

### Exporting a KeyStore

To export the public keys of a keystore as a JWK-set:

```
output = keystore.toJSON();
```

To export **all** the keys of a keystore:

```
output = keystore.toJSON(true);
```

### Retrieving Keys

To retrieve a key from a keystore:

```
// by 'kid'
key = keystore.get(kid);
```

This retrieves the first key that matches the given {kid}. If multiple keys have the same {kid}, you can further narrow what to retrieve:

```
// ... and by 'kty'
key = keystore.get(kid, { kty: 'RSA' });

// ... and by 'use'
key = keystore.get(kid, { use: 'enc' });

// ... and by 'alg'
key = keystore.get(kid, { use: 'RSA-OAEP' });

// ... and by 'kty' and 'use'
key = keystore.get(kid, { kty: 'RSA', use: 'enc' });

// same as above, but with a single {props} argument
key = keystore.get({ kid: kid, kty: 'RSA', use: 'enc' });
```

### Searching for Keys

To retrieve all the keys from a keystore:

```
everything = keystore.all();
```

`all()` can be filtered much like `get()`:

```
// filter by 'kid'
everything = keystore.all({ kid: kid });

// filter by 'kty'
everything = keystore.all({ kty: 'RSA' });

// filter by 'use'
everything = keystore.all({ use: 'enc' });

// filter by 'alg'
everything = keystore.all({ alg: 'RSA-OAEP' });

// filter by 'kid' + 'kty' + 'alg'
everything = keystore.all({ kid: kid, kty: 'RSA', alg: 'RSA-OAEP' });
```

### Managing Keys

To import an existing Key (as a JSON object or Key instance):

```
// input is either a:
// *  jose.JWK.Key to copy from; or
// *  JSON object representing a JWK; or
keystore.add(input).
        then(function(result) {
          // {result} is a jose.JWK.Key
          key = result;
        });
```

To import and existing Key from a PEM or DER:

```
// input is either a:
// *  String serialization of a JSON JWK/(base64-encoded) PEM/(binary-encoded) DER
// *  Buffer of a JSON JWK/(base64-encoded) PEM/(binary-encoded) DER
// form is either a:
// * "json" for a JSON stringified JWK
// * "private" for a DER encoded 'raw' private key
// * "pkcs8" for a DER encoded (unencrypted!) PKCS8 private key
// * "public" for a DER encoded SPKI public key (alternate to 'spki')
// * "spki" for a DER encoded SPKI public key
// * "pkix" for a DER encoded PKIX X.509 certificate
// * "x509" for a DER encoded PKIX X.509 certificate
// * "pem" for a PEM encoded of PKCS8 / SPKI / PKIX
keystore.add(input, form).
        then(function(result) {
          // {result} is a jose.JWK.Key
        });
```

To generate a new Key:

```
// first argument is the key type (kty)
// second is the key size (in bits) or named curve ('crv') for "EC"
keystore.generate("oct", 256).
        then(function(result) {
          // {result} is a jose.JWK.Key
          key = result;
        });

// ... with properties
var props = {
  kid: 'gBdaS-G8RLax2qgObTD94w',
  alg: 'A256GCM',
  use: 'enc'
};
keystore.generate("oct", 256, props).
        then(function(result) {
          // {result} is a jose.JWK.Key
          key = result;
        });
```

To remove a Key from its Keystore:

```
keystore.remove(key);
// NOTE: key.keystore does not change!!
```

### Importing and Exporting a Single Key

To create a single "stand alone" key:

```
jose.JWK.createKey("oct", 256, { alg: "A256GCM" }).
         then(function(result) {
           // {result} is a jose.JWK.Key
           // {result.keystore} is a unique jose.JWK.KeyStore
         });
```

To import a single Key:

```
// where input is either a:
// *  jose.JWK.Key instance
// *  JSON Object representation of a JWK
jose.JWK.asKey(input).
        then(function(result) {
          // {result} is a jose.JWK.Key
          // {result.keystore} is a unique jose.JWK.KeyStore
        });

// where input is either a:
// *  String serialization of a JSON JWK/(base64-encoded) PEM/(binary-encoded) DER
// *  Buffer of a JSON JWK/(base64-encoded) PEM/(binary-encoded) DER
// form is either a:
// * "json" for a JSON stringified JWK
// * "pkcs8" for a DER encoded (unencrypted!) PKCS8 private key
// * "spki" for a DER encoded SPKI public key
// * "pkix" for a DER encoded PKIX X.509 certificate
// * "x509" for a DER encoded PKIX X.509 certificate
// * "pem" for a PEM encoded of PKCS8 / SPKI / PKIX
jose.JWK.asKey(input, form).
        then(function(result) {
          // {result} is a jose.JWK.Key
          // {result.keystore} is a unique jose.JWK.KeyStore
        });
```

To export the public portion of a Key as a JWK:

```
var output = key.toJSON();
```

To export the public **and** private portions of a Key:

```
var output = key.toJSON(true);
```

### Obtaining a Key's Thumbprint

To get or calculate a [RFC 7638](https://tools.ietf.org/html/rfc7638) thumbprint for a key:

```
// where hash is a supported algorithm, currently one of:
// * SHA-1
// * SHA-256
// * SHA-384
// * SHA-512
key.thumbprint(hash).
    then(function(print) {
      // {print} is a Buffer containing the thumbprint binary value
    });
```

When importing or generating a key that does not have a "kid" defined, a
"SHA-256" thumbprint is calculated and used as the "kid".

## Signatures

### Keys Used for Signing and Verifying

When signing content, the key is expected to meet one of the following:

1. A secret key (e.g, `"kty":"oct"`)
2. The **private** key from a PKI (`"kty":"EC"` or `"kty":"RSA"`) key pair

When verifying content, the key is expected to meet one of the following:

1. A secret key (e.g, `"kty":"oct"`)
2. The **public** key from a PKI (`"kty":"EC"` or `"kty":"RSA"`) key pair

### Signing Content

At its simplest, to create a JWS:

```
// {input} is a Buffer
jose.JWS.createSign(key).
        update(input).
        final().
        then(function(result) {
          // {result} is a JSON object -- JWS using the JSON General Serialization
        });
```

The JWS is signed using the preferred algorithm appropriate for the given Key. The preferred algorithm is the first item returned by `key.algorithms("sign")`.

To create a JWS using another serialization format:

```
jose.JWS.createSign({ format: 'flattened' }, key).
        update(input).
        final().
        then(function(result) {
          // {result} is a JSON object -- JWS using the JSON Flattened Serialization
        });

jose.JWS.createSign({ format: 'compact' }, key).
        update(input).
        final().
        then(function(result) {
          // {result} is a String -- JWS using the Compact Serialization
        });
```

To create a JWS using a specific algorithm:

```
jose.JWS.createSign({ fields: { alg: 'PS256' } }, key).
        update(input).
        final().
        then(function(result) {
          // ....
        });
```

To create a JWS for a specified content type:

```
jose.JWS.createSign({ fields: { cty: 'jwk+json' } }, key).
        update(input).
        final().
        then(function(result) {
          // ....
        });
```

To create a JWS from String content:

```
jose.JWS.createSign(key).
        update(input, "utf8").
        final().
        then(function(result) {
          // ....
        });
```

To create a JWS with multiple signatures:

```
// {keys} is an Array of jose.JWK.Key instances
jose.JWS.createSign(keys).
        update(input).
        final().
        then(function(result) {
          // ....
        });
```

### Verifying a JWS

To verify a JWS, and retrieve the payload:

```
jose.JWS.createVerify(keystore).
        verify(input).
        then(function(result) {
          // {result} is a Object with:
          // *  header: the combined 'protected' and 'unprotected' header members
          // *  payload: Buffer of the signed content
          // *  signature: Buffer of the verified signature
          // *  key: The key used to verify the signature
        });
```

To verify using an implied Key:

```
// {key} can be:
// *  jose.JWK.Key
// *  JSON object representing a JWK
jose.JWS.createVerify(key).
        verify(input).
        then(function(result) {
          // ...
        });
```

To verify using a key embedded in the JWS:

```
jose.JWS.createVerify().
        verify(input, { allowEmbeddedKey: true }).
        then(function(result) {
          // ...
        });
```

Alternatively, a cached `createVerify()` can be configured to allow an embedded key:

```
var verifier = jose.JWS.createVerify({ allowEmbeddedKey: true });

verifier.verify(input).
         then(function(result) {
           // ...
         });
```

The key can be embedded using either 'jwk' or 'x5c', and can be located in either the JWS Unprotected Header or JWS Protected Header.

**NOTE:** `verify()` will use the embedded key (if found and permitted) instead of any other key.

#### Allowing (or Disallowing) Signature Algorithms

To restrict what signature algorithms are allowed when verifying, add the `algorithms` member to the `options` Object. The `algorithms` member is either a string or an array of strings, where the string value(s) can be one of the following:

* `"*"`: accept all supported algorithms
* **`<alg name>`** (e.g., `"PS256"`): accept the specific algorithm (can have a single '\*' to match a range of algorithms)
* **`!<alg name>`** (e.g., `"!RS256"`): *do not* accept the specific algorithm (can have a single '\*' to match a range of algorithms)

The negation is intended to be used with the wildcard accept string, and disallow takes precedence over allowed.

To only accept RSA-PSS sigatures:

```
var opts = {
  algorithms: ["PS*"]
};
jose.JWS.createVerify(key, opts).
        verify(input).
        then(function(result) {
          // ...
        });
```

To accept any algorithm, but disallow HMAC-based signatures:

```
var opts = {
  algorithms: ["*", "!HS*"]
};
jose.JWS.createVerify(key, opts).
        verify(input).
        then(function(result) {
          // ...
        });
```

#### Handling `crit` Header Members

To accept 'crit' field members, add the `handlers` member to the options Object. The `handlers` member is itself an Object, where its member names are the `crit` header member, and the value is one of:

* `Function`: takes the JWE decrypt output (just prior to decrypting) and returns a Promise for the processing of the member.
* `Object`: An object with the following `Function` members:
  + "prepare" -- takes the JWE decrypt output (just prior to decrypting) and returns a Promise for the processing of the member.
  + "complete" -- takes the JWE decrypt output (immediately after decrypting) and returns a Promise for the processing of the member.

**NOTE** If the handler function returns a promise, the fulfilled value is ignored. It is expected these handler functions will modify the provided value directly.

To perform additional (pre-verify) processing on a `crit` header member:

```
var opts = {
  handlers: {
    "exp": function(jws) {
      // {jws} is the JWS verify output, pre-verification
      jws.header.exp = new Date(jws.header.exp);
    }
  }
};
jose.JWS.createVerify(key, opts).
        verify(input).
        then(function(result) {
          // ...
        });
```

To perform additional (post-verify) processing on a `crit` header member:

```
var opts = {
  handlers: {
    "exp": {
      complete: function(jws) {
        // {jws} is the JWS verify output, post-verification
        jws.header.exp = new Date(jws.header.exp);
      }
    }
  }
};
jose.JWS.createVerify(key, opts).
        verify(input).
        then(function(result) {
          // ...
        });
```

## Encryption

### Keys Used for Encrypting and Decrypting

When encrypting content, the key is expected to meet one of the following:

1. A secret key (e.g, `"kty":"oct"`)
2. The **public** key from a PKI (`"kty":"EC"` or `"kty":"RSA"`) key pair

When decrypting content, the key is expected to meet one of the following:

1. A secret key (e.g, `"kty":"oct"`)
2. The **private** key from a PKI (`"kty":"EC"` or `"kty":"RSA"`) key pair

### Encrypting Content

At its simplest, to create a JWE:

```
// {input} is a Buffer
jose.JWE.createEncrypt(key).
        update(input).
        final().
        then(function(result) {
          // {result} is a JSON Object -- JWE using the JSON General Serialization
        });
```

How the JWE content is encrypted depends on the provided Key.

* If the Key only supports content encryption algorithms, then the preferred algorithm is used to encrypt the content and the key encryption algorithm (i.e., the "alg" member) is set to "dir". The preferred algorithm is the first item returned by `key.algorithms("encrypt")`.
* If the Key supports key management algorithms, then the JWE content is encrypted using "A128CBC-HS256" by default, and the Content Encryption Key is encrypted using the preferred algorithms for the given Key. The preferred algorithm is the first item returned by `key.algorithms("wrap")`.

To create a JWE using a different serialization format:

```
jose.JWE.createEncrypt({ format: 'compact' }, key).
        update(input).
        final().
        then(function(result) {
          // {result} is a String -- JWE using the Compact Serialization
        });

jose.JWE.createEncrypt({ format: 'flattened' }, key).
        update(input).
        final().
        then(function(result) {
          // {result} is a JSON Object -- JWE using the JSON Flattened Serialization
        });
```

To create a JWE and compressing the content before encrypting:

```
jose.JWE.createEncrypt({ zip: true }, key).
        update(input).
        final().
        then(function(result) {
          // ....
        });
```

To create a JWE for a specific content type:

```
jose.JWE.createEncrypt({ fields: { cty : 'jwk+json' } }, key).
        update(input).
        final().
        then(function(result) {
          // ....
        });
```

To create a JWE with multiple recipients:

```
// {keys} is an Array of jose.JWK.Key instances
jose.JWE.createEncrypt(keys).
        update(input).
        final().
        then(function(result) {
          // ....
        });
```

### Decrypting a JWE

To decrypt a JWE, and retrieve the plaintext:

```
jose.JWE.createDecrypt(keystore).
        decrypt(input).
        then(function(result) {
          // {result} is a Object with:
          // *  header: the combined 'protected' and 'unprotected' header members
          // *  protected: an array of the member names from the "protected" member
          // *  key: Key used to decrypt
          // *  payload: Buffer of the decrypted content
          // *  plaintext: Buffer of the decrypted content (alternate)
        });
```

To decrypt a JWE using an implied key:

```
jose.JWE.createDecrypt(key).
        decrypt(input).
        then(function(result) {
          // ....
        });
```

#### Allowing (or Disallowing) Encryption Algorithms

To restrict what encryption algorithms are allowed when verifying, add the `algorithms` member to the `options` Object. The `algorithms` member is either a string or an array of strings, where the string value(s) can be one of the following:

* `"*"`: accept all supported algorithms
* **`<alg name>`** (e.g., `"A128KW"`): accept the specific algorithm (can have a single '\*' to match a range of similar algorithms)
* **`!<alg name>`** (e.g., `"!RSA1_5"`): *do not* accept the specific algorithm (can have a single '\*' to match a range of similar algorithms)

The negation is intended to be used with the wildcard accept string, and disallow takes precedence over allowed.

To only accept "dir" and AES-GCM encryption:

```
var opts = {
  algorithms: ["dir", "A*GCM"]
};
jose.JWE.createDecrypt(key, opts).
        decrypt(input).
        then(function(result) {
          // ...
        });
```

To accept any algorithm, but disallow RSA-based encryption:

```
var opts = {
  algorithms: ["*", "!RSA*"]
};
jose.JWS.createVerify(key, opts).
        verify(input).
        then(function(result) {
          // ...
        });
```

#### Handling `crit` Header Members

To accept 'crit' field members, add the `handlers` member to the options Object. The `handlers` member is itself an Object, where its member names are the `crit` header member, and the value is one of:

* `Function`: takes the JWE decrypt output (just prior to decrypting) and returns a Promise for the processing of the member.
* `Object`: An object with the following `Function` members:
  + "prepare" -- takes the JWE decrypt output (just prior to decrypting) and returns a Promise for the processing of the member.
  + "complete" -- takes the JWE decrypt output (immediately after decrypting) and returns a Promise for the processing of the member.

**NOTE** If the handler function returns a promise, the fulfilled value is ignored. It is expected these handler functions will modify the provided value directly.

To perform additional (pre-decrypt) processing on a `crit` header member:

```
var opts = {
  handlers: {
    "exp": function(jwe) {
      // {jwe} is the JWE decrypt output, pre-decryption
      jwe.header.exp = new Date(jwe.header.exp);
    }
  }
};
jose.JWE.createDecrypt(key, opts).
        decrypt(input).
        then(function(result) {
          // ...
        });
```

To perform additional (post-decrypt) processing on a `crit` header member:

```
var opts = {
  handlers: {
    "exp": {
      complete: function(jwe) {
        // {jwe} is the JWE decrypt output, post-decryption
        jwe.header.exp = new Date(jwe.header.exp);
      }
    }
  }
};
jose.JWE.createDecrypt(key, opts).
        decrypt(input).
        then(function(result) {
          // ...
        });
```

## Useful Utilities

### Converting to Buffer

To convert a [Typed Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Typed_arrays), [ArrayBuffer](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer), or Array of Numbers to a Buffer:

```
buff = jose.util.asBuffer(input);
```

### URI-Safe Base64

This exposes [urlsafe-base64](https://github.com/RGBboy/urlsafe-base64)'s `encode` and `decode` methods as `encode` and `decode` (respectively).

To convert from a Buffer to a base64uri-encoded String:

```
var output = jose.util.base64url.encode(input);
```

To convert a String to a base64uri-encoded String:

```
// explicit encoding
output = jose.util.base64url.encode(input, "utf8");

// implied "utf8" encoding
output = jose.util.base64url.encode(input);
```

To convert a base64uri-encoded String to a Buffer:

```
var output = jose.util.base64url.decode(input);
```

### Random Bytes

To generate a Buffer of octets, regardless of platform:

```
// argument is size (in bytes)
var rnd = jose.util.randomBytes(32);
```

This function uses:

* `crypto.randomBytes()` on node.js
* `crypto.getRandomValues()` on modern browsers
* A PRNG based on AES and SHA-1 for older platforms

## About

No description, website, or topics provided.
### Resources

[Readme](#readme-ov-file)
### License

[Apache-2.0 license](#Apache-2.0-1-ov-file)

[Activity](/cisco/node-jose/activity)
[Custom properties](/cisco/node-jose/custom-properties)
### Stars

[**707**
stars](/cisco/node-jose/stargazers)
### Watchers

[**19**
watching](/cisco/node-jose/watchers)
### Forks

[**125**
forks](/cisco/node-jose/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fcisco%2Fnode-jose&report=cisco+%28user%29)

## [Releases](/cisco/node-jose/releases)

[31
tags](/cisco/node-jose/tags)

## [Packages 0](/orgs/cisco/packages?repo_name=node-jose)

No packages published

## [Contributors 33](/cisco/node-jose/graphs/contributors)

[+ 19 contributors](/cisco/node-jose/graphs/contributors)

## Languages

* [JavaScript
  99.7%](/cisco/node-jose/search?l=javascript)
* [Shell
  0.3%](/cisco/node-jose/search?l=shell)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from gist.github.com_d0ea7484_20250125_073048.html ===

[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fasanso%2Ffa25685348051ef6a28d49aa0f27a4ae)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fasanso%2Ffa25685348051ef6a28d49aa0f27a4ae&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fasanso%2Ffa25685348051ef6a28d49aa0f27a4ae) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fasanso%2Ffa25685348051ef6a28d49aa0f27a4ae&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@asanso](https://avatars.githubusercontent.com/u/494825?s=64&v=4)](/asanso)

# [asanso](/asanso)/**[node-jose.js](/asanso/fa25685348051ef6a28d49aa0f27a4ae)**

Last active
December 4, 2017 21:13

Show Gist options

* [Download ZIP](/asanso/fa25685348051ef6a28d49aa0f27a4ae/archive/7968006eb032f5de69a304281f7f9d4cbc0c29cb.zip)

* [Star
  2
  (2)](/login?return_to=https%3A%2F%2Fgist.github.com%2Fasanso%2Ffa25685348051ef6a28d49aa0f27a4ae)You must be signed in to star a gist
* [Fork
  1
  (1)](/login?return_to=https%3A%2F%2Fgist.github.com%2Fasanso%2Ffa25685348051ef6a28d49aa0f27a4ae)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/asanso/fa25685348051ef6a28d49aa0f27a4ae.js&quot;&gt;&lt;/script&gt;
* Save asanso/fa25685348051ef6a28d49aa0f27a4ae to your computer and use it in GitHub Desktop.

[Code](/asanso/fa25685348051ef6a28d49aa0f27a4ae)
[Revisions
3](/asanso/fa25685348051ef6a28d49aa0f27a4ae/revisions)
[Stars
2](/asanso/fa25685348051ef6a28d49aa0f27a4ae/stargazers)
[Forks
1](/asanso/fa25685348051ef6a28d49aa0f27a4ae/forks)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/asanso/fa25685348051ef6a28d49aa0f27a4ae.js&quot;&gt;&lt;/script&gt;

Save asanso/fa25685348051ef6a28d49aa0f27a4ae to your computer and use it in GitHub Desktop.

[Download ZIP](/asanso/fa25685348051ef6a28d49aa0f27a4ae/archive/7968006eb032f5de69a304281f7f9d4cbc0c29cb.zip)

 [Raw](/asanso/fa25685348051ef6a28d49aa0f27a4ae/raw/7968006eb032f5de69a304281f7f9d4cbc0c29cb/node-jose.js)

[**node-jose.js**](#file-node-jose-js)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

|  | "use strict"; |
| --- | --- |
|  |  |
|  | var forEach = require("lodash.foreach"); |
|  | var chai = require("chai"); |
|  |  |
|  | var JWE = require("../../lib/jwe"), |
|  | JWK = require("../../lib/jwk"); |
|  |  |
|  | var assert = chai.assert; |
|  |  |
|  | describe("jwe/roundtrip", function() { |
|  | var vectors = [ |
|  | { |
|  | desc: "ECDH-ES+A128KW + A128CBC-HS256", |
|  | jwk: { |
|  | "kty": "EC", |
|  | "kid": "3f7b122d-e9d2-4ff7-bdeb-a1487063d799", |
|  | "crv": "P-256", |
|  | "x": "weNJy2HscCSM6AEDTDg04biOvhFhyyWvOHQfeF\_PxMQ", |
|  | "y": "e8lnCO-AlStT-NJVX-crhB7QRYhiix03illJOVAOyck", |
|  | "d": "VEmDZpDXXK8p8N0Cndsxs924q6nS1RXFASRl6BfUqdw" |
|  | }, |
|  | alg: "ECDH-ES+A128KW", |
|  | enc: "A128CBC-HS256", |
|  | plaintext: new Buffer("Gambling is illegal at Bushwood sir, and I never slice.", "utf8") |
|  | } |
|  | ]; |
|  | forEach(vectors, function(v) { |
|  | it("test " + v.desc + " encrypt + decrypt", function() { |
|  | var promise, |
|  | key; |
|  | promise = JWK.asKey(v.jwk); |
|  | promise = promise.then(function(jwk) { |
|  | key = jwk; |
|  | var cfg = { |
|  | contentAlg: v.enc |
|  | }; |
|  | var recipient = { |
|  | key: key, |
|  | header: { |
|  | alg: v.alg |
|  | } |
|  | }; |
|  | var jwe = JWE.createEncrypt(cfg, recipient); |
|  | return jwe.update(v.plaintext).final(); |
|  | }); |
|  | promise = promise.then(function(result) { |
|  |  |
|  | //The malicious JWE contains a public key with order 113 |
|  | var maliciousJWE1 = {}; |
|  | maliciousJWE1.protected = "eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiZ1RsaTY1ZVRRN3otQmgxNDdmZjhLM203azJVaURpRzJMcFlrV0FhRkpDYyIsInkiOiJjTEFuakthNGJ6akQ3REpWUHdhOUVQclJ6TUc3ck9OZ3NpVUQta2YzMEZzIiwiY3J2IjoiUC0yNTYifX0"; |
|  | maliciousJWE1.encrypted\_key = "qGAdxtEnrV\_3zbIxU2ZKrMWcejNltjA\_dtefBFnRh9A2z9cNIqYRWg"; |
|  | maliciousJWE1.iv = "pEA5kX304PMCOmFSKX\_cEg"; |
|  | maliciousJWE1.ciphertext = "a9fwUrx2JXi1OnWEMOmZhXd94-bEGCH9xxRwqcGuG2AMo-AwHoljdsH5C\_kcTqlXS5p51OB1tvgQcMwB5rpTxg"; |
|  | maliciousJWE1.tag = "72CHiYFecyDvuUa43KKT6w"; |
|  | //eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiZ1RsaTY1ZVRRN3otQmgxNDdmZjhLM203azJVaURpRzJMcFlrV0FhRkpDYyIsInkiOiJjTEFuakthNGJ6akQ3REpWUHdhOUVQclJ6TUc3ck9OZ3NpVUQta2YzMEZzIiwiY3J2IjoiUC0yNTYifX0.qGAdxtEnrV\_3zbIxU2ZKrMWcejNltjA\_dtefBFnRh9A2z9cNIqYRWg.pEA5kX304PMCOmFSKX\_cEg.a9fwUrx2JXi1OnWEMOmZhXd94-bEGCH9xxRwqcGuG2AMo-AwHoljdsH5C\_kcTqlXS5p51OB1tvgQcMwB5rpTxg.72CHiYFecyDvuUa43KKT6w |
|  | assert.ok(result); |
|  | var jwe = JWE.createDecrypt(key); |
|  | //this proof that jwk.d (the private key) is equals 26 % 113 |
|  | //THIS CAN BE DONE MANY TIME |
|  | //.... |
|  | //AND THAN CHINESE REMAINDER THEOREM FTW |
|  | return jwe.decrypt(maliciousJWE1); |
|  | }); |
|  | promise = promise.then(function(result) { |
|  | assert.deepEqual(result.plaintext, v.plaintext); |
|  | }); |
|  | return promise; |
|  | }); |
|  | }); |
|  | }); |

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2Fasanso%2Ffa25685348051ef6a28d49aa0f27a4ae)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


