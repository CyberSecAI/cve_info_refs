=== Content from sandstorm.io_0aece663_20250125_055104.html ===

[This site is historical, from when Sandstorm was a startup. Sandstorm the open source project has moved to sandstorm.org. More info »](/news/2024-01-14-move-to-sandstorm-org)

[Sandstorm.io](/)
[Get Sandstorm](/get)
[Features](/features)
[Technology](/how-it-works)
[Blog](/news/)
[Docs](https://docs.sandstorm.io)
[Code](https://github.com/sandstorm-io/sandstorm)
[Community](/community)
[About](/about)

# Sandstorm Blog

* [Fediverse](https://floss.social/%40sandstorm)* [Github](https://github.com/sandstorm-io/sandstorm)

[Sandstorm is a self-hostable web productivity suite.
Host your own](/get)
### Recommended Posts

* [Open Source Web Apps Aren't Viable; Let's Fix That](/news/2014-07-21-open-source-web-apps-require-federated-hosting)
* [Sandstorm's security track record, and what it means for self-hosting](/news/2016-02-29-security-track-record)
* [Decentralization is about diversity](/news/2016-08-17-decentralization-is-about-diversity)
* [8 New open source self-hostable apps](/news/2016-01-22-8-new-open-source-apps.html)
* [Sandstorm for Work Beta: LDAP, SAML, organization management](/news/2016-04-06-sandstorm-for-work)
* [Free publicity for your indie web app, and free Oasis service for you](/news/2016-02-05-app-author-publicity-oasis)
* [Free, automated SSL certificates for Sandstorm self-hosters](/news/2015-10-01-free-ssl-certificates.html)
* [Why doesn't Sandstorm just run Docker apps?](/news/2014-08-19-why-not-run-docker-apps.html)
* [Understand the Sandstorm sharing model](/news/2015-05-05-delegation-is-the-cornerstone-of-civilization.html)

### Further Reading

* [How Sandstorm Works](/how-it-works)
* [Sandstorm Documentation](http://docs.sandstorm.io)
* [How to install Sandstorm](/install)

[« All posts](/news/ "All posts")

## Sandstorm gets a security review

By [Kenton Varda](https://github.com/kentonv)
- 02 Mar 2017

Sandstorm recently underwent a security review by [DevCore Inc.](http://devco.re/), commissioned by Department of Cyber Security of Taiwan. The company has in the past found RCEs in big-name services like [Uber](https://hackerone.com/reports/125980) and [Facebook](http://devco.re/blog/2016/04/21/how-I-hacked-facebook-and-found-someones-backdoor-script-eng-ver/).

Although the full report is not public (and is not in English), Taiwan’s Digital Minister, [Audrey Tang](https://en.wikipedia.org/wiki/Audrey_Tang), tells us that overall DevCore feels Sandstorm has “excellent security design.”

As would be expected of any good security review, DevCore did find several issues. Last night we released build 0.203 to fix them. All servers should automatically update within 24 hours of the release (by midnight tonight, PST), but if you’d like to speed up the process (or if you have disabled automatic updates), you can SSH into your server now and type:

```
sudo sandstorm update

```
### Vulnerabilities Discovered (and fixed)

#### 1. Insufficient e-mail address validation

When logging in with an e-mail address, a user could enter an address like “foo@evil.com,bar@example.com”. In this case, login e-mails would be sent to *both* addresses, while Sandstorm would treat the user as if they were a member of the latter domain, “example.com”. Hence, an attacker could specify their real address as the first address and a fake address at a domain of their choice as the second, in order to appear to be a member of the domain. Servers that use Sandstorm’s organizational features (until recently only available as part of the [now-defunct](https://sandstorm.io/news/2017-02-06-sandstorm-returning-to-community-roots) product “Sandstorm for Work”) can be configured to automatically promote members of a domain to full users, allowing them to install apps, create grains, and discover the identities of other members of the organization. Such users would **not** receive access to any other grains on the server, but an attacker could install their own apps that consume the server’s resources, including CPU, RAM, and disk. An attacker could also combine this vulnerability with one of the others below, all of which require full user status as a starting point.

The root cause of this bug is Sandstorm’s use of a library called Nodemailer to send e-mail. It turns out that Nodemailer “helpfully” interprets comma-separated lists of addresses as multiple addresses. This is true even if the string is already part of an array. For instance, say you pass the following array in the `to` field of a mail sent via Nodemailer:

```
[ "foo@example.com",
  "bar@example.com,baz@example.com",
  { name: "Garply", address: "qux@example.com,corge@example.com" } ]

```

Surprisingly, this three-element array will send e-mail to *five* addresses – foo@, bar@, baz@, qux@, and corge@.

We did not anticipate this feature and assumed that Nodemailer would fail to send e-mail to an invalid address.

**Severity:** Moderate **if** Sandstorm is configured with an organization defined by e-mail domain. If you do not define an organization, or if you define it by LDAP, SAML, or G Suite domain, then we do not believe this bug can be meaningfully exploited.

**Fix:** Sandstorm now performs its own validation of addresses to ensure, among other things, that no separator characters are accepted and only one @-sign is allowed. Fixed in commit [37bd9a7](https://github.com/sandstorm-io/sandstorm/commit/37bd9a7f4eb776cdc2d3615f0bfea1254b66f59d).

#### 2. Insufficient path validation when building ZIP backups

The owner of a Sandstorm grain can download a backup of the grain’s content in ZIP format. Sandstorm shells out to the `zip` utility to build this archive, but does so inside a sandbox designed to prevent exploitation of bugs in the utility.

Unfortunately, a combination of factors resulted in the possibility of a minor data leak:

* The list of files to include in the archive is passed to `zip` on standard input, delimited by newlines. However, it is possible for a filename to contain a newline character. Sandstorm actually checked for this, but accidentally failed to perform the check in one code path triggered by the existence of an empty directory.
* The zip sandbox carefully hid sensitive directories like `/var`, `/proc`, and even `/etc`. However, after the zip sandbox was written, two new directories, `/etc.host` and `/run.host`, which are aliases for the host system’s `/etc` and `/run`, were added. Unfortunately, the zip sandbox was not updated to hide these directories, hence they were visible to the zip program.

As a result of this, a user could create a grain containing an empty directory named `/var/blah\n/etc.host/passwd`, save a backup, and find the backup contained a copy of the host’s `/etc/passwd` file (which, despite its name, does not contain passwords, but does contain a list of local user accounts).

**Severity:** Low. An attacker who has full user status (permission to create grains) can read files located in the server’s `/etc` and `/run` directories that are set world-readable (or specifically readable to the Sandstorm service account). No other host system directories are exposed. Usually, any files under `/etc` that contain sensitive secrets would be hidden from all users except root, hence would not be readable by Sandstorm nor by the attacker.

**Fix:** We have fixed the validation of filenames so that newlines are never permitted, and we have enhanced the zip sandbox to use a whitelist of top-level directories rather than a blacklist. Fixed in commits [4ea8df7](https://github.com/sandstorm-io/sandstorm/commit/4ea8df7403381d9b657b121b3c98d8081b27414d) and [6e8572e](https://github.com/sandstorm-io/sandstorm/commit/6e8572ea8bb56d0216bb1b410e5040edc051b120).

#### 3. Server-side request forgery

Apps running on Sandstorm can make outgoing HTTP requests through a few mechanisms. Additionally, users can instruct Sandstorm to download an app package file from an arbitrary URL. Sandstorm did not attempt to prevent these requests from reaching localhost or private network destinations. Because of this, a full user of the Sandstorm server (but not a visitor) could probe the internal network on which the Sandstorm server was hosted, as well as services exposed to localhost on the server itself.

This is a problem if unprotected services are exposed to the Sandstorm server *and* you have invited users to your server who should not be trusted to access those services. Sandstorm itself does not expose any unprotected services to localhost, so some other service must be running locally to cause a problem. Only HTTP requests are possible.

**Severity:** High **if** unprotected HTTP services are visible to the Sandstorm server *and* you have invited users to your server who should not be trusted to access those services. Otherwise, low. Sandstorm itself does not expose any unprotected services to localhost, so some other service must be running locally to cause a problem. Only HTTP requests are possible.

**Fix:** Sandstorm now allows the server admin to configure an IP address blacklist. User-initiated requests will not be allowed from these addresses. By default, standard private network address ranges are blacklisted. Annoyingly, this “fix” is likely to break some servers who use private app indexes, but avoiding such breakage would mean leaving others vulnerable. Admins will need to update their blacklists accordingly. Fixed in commit [164997f](https://github.com/sandstorm-io/sandstorm/commit/164997fb958effbc90c5328c166706280a84aaa1).

#### 4. Failure to mitigate Linux kernel CVE-2017-6074

*(This was caught by Sandstorm core developer [David Renshaw](https://github.com/dwrensha), not by DevCore, but is fixed in the same release.)*

A recent Linux kernel bug could allow a malicious app to cause a kernel panic or perhaps break out of its sandbox. The bug is in Linux, but Sandstorm aims to protect against such bugs via seccomp. [Historically, Sandstorm’s sandbox has been very successful at blocking Linux vulnerabilities before they are discovered.](https://docs.sandstorm.io/en/latest/using/security-non-events/#linux-kernel) However, this one slipped through. On Sandstorm, the published PoC exploit for this bug only causes a kernel panic (not a sandbox breakout), but a developer with deep understanding of the bug and the Linux kernel might be able to create a successful attack in other ways.

**Severity:** High if you permit users you don’t trust to install apps on your server, or commonly install apps from untrustworthy sources, and you do not keep your kernel up-to-date.

**Fix:** Sandstorm’s seccomp filter has been updated to prohibit the creation of DCCP sockets. Fixed in commit [34749f9](https://github.com/sandstorm-io/sandstorm/commit/34749f9c0141a89680860b15433e8ac9dbdbbb62).

### Conclusion

We are excited to have received such a thorough security review. Some of the problems discovered were very obscure and we’re impressed that DevCore was able to find them. We thank Audrey Tang and the Department of Cyber Security of Taiwan for commissioning this review.

* ### [Get Sandstorm](/get)

  + [Self-host Sandstorm](/get)+ [Source code (GitHub)](https://github.com/sandstorm-io/sandstorm)+ [For educators](/go/education)
* ### [Features](/features)

  + [App Market](https://apps.sandstorm.io)
  + [Core features](/features)+ [Security features](/features#security)+ [For organizations](/business)+ [For developers](/developer)
* ### [Documentation](https://docs.sandstorm.io)

  + [How to use Sandstorm](https://docs.sandstorm.io/en/latest/using/)+ [Developer Hub](https://docs.sandstorm.io/en/latest/developing/)+ [Administering & installing](https://docs.sandstorm.io/en/latest/administering/)+ [Security](https://docs.sandstorm.io/en/latest/using/security-practices/)
* ### [Technology (How it Works)](/how-it-works)

  + [Fine-grained object containers](/how-it-works#grains)+ [Capability-based security](/how-it-works#capabilities)
* ### [Community](/community)

  + [Sandstorm Blog](/news)+ [Connect with us](/community#connect-with)+ [Help others](/community#helpothers)+ [Help the project](/community#helpproject)
* ### [About](/about)

  + [Sandstorm story](/about)+ [Team](/about#team)+ [Advisors](/about#advisors)+ Contact
* ### Connect

This page was hand-crafted using only the finest web technologies.



=== Content from devco.re_35b1a190_20250125_055101.html ===


[![](/images/logo.svg)](/en/)

* Services
  [## Red Team Assessment

  Simulation of real-world attacks to identify vulnerabilities and achieve objectives without disrupting business operations.](/en/services/red-team/)
  [## Penetration Testing

  Infiltration of designated enterprise systems to uncover potential vulnerabilities and assess the risks or damages.](/en/services/penetration-test/)
  [## Security Consulting

  Consultation of resource distribution and long-term defensive strategies from the attacker’s perspective.](/en/services/security-consulting/)
  [## Security Training

  Instruction on defending and preventing incidents with the hacker mindset, also the response procedures and analysis of attacks when incidents happen.](/en/services/security-training/)
* Research
  [## Overview

  Research of updated cybersecurity techniques and trends, assess the security of products, and evolve the red team with broad experience.](/en/research/overview/)
  [## Competitions and Awards

  Awards from international cybersecurity competitions.](/en/research/awards/)
  [## Enterprise Vulnerability Reports

  Research of the risk of enterprise systems, identification of potential weaknesses, and report to vendors.](/en/research/bug-bounty/)
  [## International Conferences

  Sharing vulnerability research and security knowledge at international cybersecurity conferences.](/en/research/talks/)
  [## CVE List

  Discovery of critical vulnerabilities in leading international products and services.](/en/research/cve/)
* Company
  [## Company Overview

  Founded by a world-class white hat hacker team, providing cybersecurity services including Red Team Assessment, Penetration Testing, Security Consulting, and Security Training.](/en/company/about/)
  [## Team Members

  Composed of cybersecurity experts with the hacker mindset, exploring innovative exploitation techniques with high morality and extreme caution.](/en/company/our-team/)
  [## Achievements

  DEVCORE has been invited to leading cybersecurity conferences, has uncovered hundreds of critical product vulnerabilities, and helped enterprises improve their defensive capabilities.](/en/company/history/)
  [## Corporate Social Responsibility

  We provide diverse internship channels and programs to nurture the next generation and promote cybersecurity awareness.](/en/company/csr/)
  [## Job Opportunities

  Join us to secure the world and improve the cybersecurity industry together.](/en/company/jobs/)
* News
  [## BLOG

  Latest news](/en/blog/)
  [## Media Resources

  Media Kit, Logo and Usage Guideline](/en/media-kit/)
* [Search](/en/search/)
* [Contact](/en/contact/)

* Services
  [## Red Team Assessment](/en/services/red-team/)
  [## Penetration Testing](/en/services/penetration-test/)
  [## Security Consulting](/en/services/security-consulting/)
  [## Security Training](/en/services/security-training/)
* Research
  [## Overview](/en/research/overview/)
  [## Competitions and Awards](/en/research/awards/)
  [## Enterprise Vulnerability Reports](/en/research/bug-bounty/)
  [## International Conferences](/en/research/talks/)
  [## CVE List](/en/research/cve/)
* Company
  [## Company Overview](/en/company/about/)
  [## Team Members](/en/company/our-team/)
  [## Achievements](/en/company/history/)
  [## Corporate Social Responsibility](/en/company/csr/)
  [## Job Opportunities](/en/company/jobs/)
* News
  [## BLOG](/en/blog/)
  [## Media Resources](/en/media-kit/)
* [## Search](/en/search/)
  [## Contact](/en/contact/)
* Language
  [## 中文](/)
  [## English](/en)

# BLOG

* [All Articles](/en/blog/)
* [Tech Editorials](/en/blog/category/Tech%20Editorials/)
* [Media Resources](/en/media-kit/)

[Tech Editorials](/en/blog/category/Tech%20Editorials)
[#Advisory](/en/blog/tag/Advisory/) [#CVE](/en/blog/tag/CVE/) [#Vulnerability](/en/blog/tag/Vulnerability/)
# Sandstorm Security Review

[Shaolin](/en/blog/author/shaolin)
2018-01-26

![](https://devco.re/assets/img/blog/20180126/cover.png)

---

[Sandstorm Security Review](/blog/2018/01/26/Sandstorm-Security-Review-CVE-2017-6200-en/) (English Version)

[一次在 Sandstorm 跳脫沙箱的滲透經驗](/blog/2018/01/26/Sandstorm-Security-Review-CVE-2017-6200/) (中文版本)

## Introduction

In early 2017, we had a pentesting target protected with [Sandstorm](https://sandstorm.io/). Sandstorm is a web-based platform which allows users to install their web apps, such as WordPress, GitLab, etc. The main feature of Sandstorm is that it containerizes every app in its own sandbox. Therefore, even though we had found several vulnerabilities of the apps, we still could not put a threat to the server.

In order to leverage the vulnerabilities, we put part of efforts into review of Sandstorm’s source codes, and tried to escape the sandbox to impact the whole server. Finally, we found a number of uncommon and interesting vulnerabilities, and received CVE IDs as follows:

* CVE-2017-6198 (Denial of Service)
* CVE-2017-6199 (Bypassing Authorization Schema)
* CVE-2017-6200 (Insecure Direct Object References)
* CVE-2017-6201 (Server-Side Request Forgery)

## Exploitation Details

### CVE-2017-6198

This is a DoS created by system resource exhaustion. The root cause is that Sandstorm does not have a comprehensive policy to limit the amount of resource used by every apps run on it. In `src/sandstorm/supervisor.c++` only the maximum number of files opened by each process was limited. See the codes below:

```
void SupervisorMain::setResourceLimits() {
  struct rlimit limit;
  memset(&limit, 0, sizeof(limit));
  limit.rlim_cur = 1024;
  limit.rlim_max = 4096;
  KJ_SYSCALL(setrlimit(RLIMIT_NOFILE, &limit));
}

```

Ref: [https://github.com/sandstorm-io/sandstorm/blob/v0.202/src/sandstorm/supervisor.c++#L824](https://github.com/sandstorm-io/sandstorm/blob/v0.202/src/sandstorm/supervisor.c%2B%2B#L824)

Since supervisor does not restrict the amount of subprocesses and storage usage, attackers can raise a resource exhaustion attack to crash the server by simply uploading a malicious app which keeps calling fork() (aka the “fork bomb”) or consumes huge storage space.

### CVE-2017-6199

Usually Sandstorm will designate unique permissions to the specific members of a certain organization, and the default membership validation method is to check user’s email address and see whether the string after `@` exists in their white list. See the codes below:

```
if (identity.services.email.email.toLowerCase().split("@").pop() === emailDomain) {
    return true;
}

```

Ref: <https://github.com/sandstorm-io/sandstorm/blob/v0.202/shell/packages/sandstorm-db/db.js#L1112>

Therefore, when an attacker fills in an email like `[[email protected]](/cdn-cgi/l/email-protection),[[email protected]](/cdn-cgi/l/email-protection)` and the system will automatically consider the attacker a member of the `aaa.bbb` organization.

Another key factor that contributes to the successful attack lies in one of the features when users log on Sandstorm. Users does not need to set up passwords for Sandstorm. Each time when the users need to log onto the service, they only need to fill in their email address, and they’ll receive a set of random unique password for login. The reason why the example above works is because the system treats `[[email protected]](/cdn-cgi/l/email-protection),[[email protected]](/cdn-cgi/l/email-protection)` as a user from aaa.bbb domain, and the random password will be sent to the two email addresses, `[[email protected]](/cdn-cgi/l/email-protection)` and `[[email protected]](/cdn-cgi/l/email-protection)` As long as one can receive the password, they can log in to use the service.

Below is a quick demonstration:

1. On Sandstorm, restrict access to users from domain `aaa.bbb` only.
   ![](/assets/img/blog/20180126/1.png)
2. On login page, fill in `[[email protected]](/cdn-cgi/l/email-protection),[[email protected]](/cdn-cgi/l/email-protection)` for the email field.
   (Note: at the front end, the email field is checked with HTML5 validation, but it is not further checked for validity at the back end)
   ![](/assets/img/blog/20180126/2.png)
3. Retrieve random password in [[email protected]](/cdn-cgi/l/email-protection) mailbox.
   ![](/assets/img/blog/20180126/3.png)
4. Login successful. `[[email protected]](/cdn-cgi/l/email-protection),[[email protected]](/cdn-cgi/l/email-protection)` is considered as a user and member of `aaa.bbb` organization!
   ![](/assets/img/blog/20180126/4.png)

In our pentesting, the target website allowed users from validated domains to install their own apps. Therefore, through this bypass exploit, further attacks could be accomplished by combining other vulnerabilities described in this blog post (CVE-2017-6198, CVE-2017-6200, CVE-2017-6201).

### CVE-2017-6200

This is an interesting vulnerability. Totally two little validation flaws were exploited to initiate this attack!
On Sandstorm, owners of each Grain (Sandstorm container, in short, an app sandbox) can download their backup data for the app. But because of the two vulnerabilities in the packing process, an attacker can pack the files under the `/etc` and `/run` directories located on the server outside the sandbox. The security issues were as follows:

1. The packing process has hid `/var`, `/proc`, `/etc` and other sensitive directories, but did not hide `/etc.host` and `/run.host` these two directories. These directories are the aliases for the directories `/etc` and `/run` on the server respectively, which are relatively newer features.
2. The system will pack the legitimate files, have them sorted out, and create zip packages through the standard input interface. The separation between files are determined by line-breaks (`\n`). As a result, when a line-break string appears in the file name, illegal path file names can be injected and packed with zip. Although the app checks whether there is a line-break in the file name, but the directory name was not checked.

Ref: <https://github.com/sandstorm-io/sandstorm/blob/v0.202/src/sandstorm/backup.c%2B%2B#L271>

By using these two vulnerabilities together, the attacker simply has to create a directory in the sandbox `/var/exp\n/etc.host/passwd\n` , then backup files containing `/etc/passwd` on the server can be retrieved through backup downloading function.

Screenshot of a real-world scenario:

1. First, create a new directory in Grain `/var/exp\n/etc.host/passwd\n`, and use the Grain Backup function to download the backup file.
   ![](/assets/img/blog/20180126/5.png)
2. After unzipping the backup file, from `etc.host` we’ll see `/etc/passwd` of the server outside the sandbox.
   ![](/assets/img/blog/20180126/6.png)

### CVE-2017-6201

This is a classic SSRF (Server-Side Request Forgery) issue. Sandstorm allow installation of apps from arbitrary sources, and an attacker can simply let the server access a certain location by providing an installation URL. The problem was identified on `https://[target]/install/xxxChangeItEveryTimexxx?url=http://127.0.0.1:22/` This sample link confirms whether the server’s port 22 is open.

![](/assets/img/blog/20180126/7.png)

(Parse Error, which implies server’s port 22 is open)
## Follow-up Updates

After we reported the vulnerabilities, Sandstorm fixed it immediately and then published an article:
<https://sandstorm.io/news/2017-03-02-security-review>

Through this pentesting experience, we consider Sandstorm a safe platform with outstanding security mechanisms. This is mainly attributed to its fundamental design rationale: to assume that every app installed is malicious. With this vigilant assumption, Sandstorm’s defence mechanisms for the core system become comprehensive and watertight. Apart from the server-side protection, some common client-side attacks (such as XSS, CSRF) are handled properly by Sandstorm’s unique countermeasures, such as host name randomization. That is, it is very difficult for attackers to sabotage the server by simply manipulating the apps, and so does privilege escalation through attacking at the client-side.

Nevertheless, such an impressive platform still had some minor mistakes which led to security issues. Most of the vulnerabilities found this time are improper usages of libraries or negligence of existing defence architecture while introducing new features. These types of vulnerability are also common in our other projects. We would like to take the opportunity to remind developers, always present a comprehensive security review especially when developing new features to avoid vulnerabilities caused by the gaps between defence mechanisms.

[### Shaolin](/en/blog/author/shaolin)
Red Team Director

喜愛資訊技術、喜歡跟別人走不一樣的路。有一點點智障的熱血人，期望能利用資訊的力量對世界有所貢獻。

[![](/images/logo.svg)](/en/)

###### Services

* [Red Team Assessment](/en/services/red-team/)
* [Penetration Testing](/en/services/penetration-test/)
* [Security Consulting](/en/services/security-consulting/)
* [Security Training](/en/services/security-training/)

###### Research

* [Overview](/en/research/overview/)
* [Competitions and Awards](/en/research/awards/)
* [Enterprise Vulnerability Reports](/en/research/bug-bounty/)
* [International Conferences](/en/research/talks/)
* [CVE List](/en/research/cve/)

###### Company

* [Company Overview](/en/company/about/)
* [Team Members](/en/company/our-team/)
* [Achievements](/en/company/history/)
* [Corporate Social Responsibility](/en/company/csr/)
* [Job Opportunities](/en/company/jobs/)
* [Contact](/en/contact/)

###### News

* [Blog](/en/blog/)
* [Media Resources](/en/media-kit/)

© 2025 DEVCORE **All rights reserved.**
[Privacy Policy](/en/privacy-policy/)

Language :[中文](/)|[English](/en/)



=== Content from github.com_2e254d22_20250125_055103.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsandstorm-io%2Fsandstorm%2Fcommit%2F164997fb958effbc90c5328c166706280a84aaa1)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsandstorm-io%2Fsandstorm%2Fcommit%2F164997fb958effbc90c5328c166706280a84aaa1)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=sandstorm-io%2Fsandstorm)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sandstorm-io](/sandstorm-io)
/
**[sandstorm](/sandstorm-io/sandstorm)**
Public

* [Notifications](/login?return_to=%2Fsandstorm-io%2Fsandstorm) You must be signed in to change notification settings
* [Fork
  710](/login?return_to=%2Fsandstorm-io%2Fsandstorm)
* [Star
   6.8k](/login?return_to=%2Fsandstorm-io%2Fsandstorm)

* [Code](/sandstorm-io/sandstorm)
* [Issues
  629](/sandstorm-io/sandstorm/issues)
* [Pull requests
  20](/sandstorm-io/sandstorm/pulls)
* [Actions](/sandstorm-io/sandstorm/actions)
* [Projects
  0](/sandstorm-io/sandstorm/projects)
* [Wiki](/sandstorm-io/sandstorm/wiki)
* [Security](/sandstorm-io/sandstorm/security)
* [Insights](/sandstorm-io/sandstorm/pulse)

Additional navigation options

* [Code](/sandstorm-io/sandstorm)
* [Issues](/sandstorm-io/sandstorm/issues)
* [Pull requests](/sandstorm-io/sandstorm/pulls)
* [Actions](/sandstorm-io/sandstorm/actions)
* [Projects](/sandstorm-io/sandstorm/projects)
* [Wiki](/sandstorm-io/sandstorm/wiki)
* [Security](/sandstorm-io/sandstorm/security)
* [Insights](/sandstorm-io/sandstorm/pulse)

## Commit

[Permalink](/sandstorm-io/sandstorm/commit/164997fb958effbc90c5328c166706280a84aaa1)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Implement IP blacklist for user-initiated requests.

[Browse files](/sandstorm-io/sandstorm/tree/164997fb958effbc90c5328c166706280a84aaa1)
Browse the repository at this point in the history

* Loading branch information

[![@kentonv](https://avatars.githubusercontent.com/u/4001805?s=40&v=4)](/kentonv)

[kentonv](/sandstorm-io/sandstorm/commits?author=kentonv "View all commits by kentonv")
committed
Mar 2, 2017

1 parent
[d616a50](/sandstorm-io/sandstorm/commit/d616a50002092037048a0a1c6546c8f6183cc861)

commit 164997f

 Show file tree

 Hide file tree

Showing
**13 changed files**
with
**539 additions**
and
**131 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* shell

  + client

    - shell/client/admin-client.js
      [admin-client.js](#diff-6ecd8825a154c8b1b4b9410ffef0333dfbd197ea6b48c16f91337bf4adbac7e5)
    - admin

      * shell/client/admin/admin.html
        [admin.html](#diff-53259ca45d0b55464b5bbbbd77a1a7d9eba9e896f658277cd722e886eea565f6)
      * shell/client/admin/networking-client.js
        [networking-client.js](#diff-38e92125082ad90e586dddbb2ab817bc403f6f51e48a29ab13952840d918ecd0)
      * shell/client/admin/networking.html
        [networking.html](#diff-30dc8de51619e2067dc6408237050fe11526057df188fa6fe4f3af3ab0a376a3)
    - styles

      * shell/client/styles/\_admin-networking.scss
        [\_admin-networking.scss](#diff-3f01b547382ea7b4b1ba238bcf87d34e55253b095d4eaafb0570541bc79764c5)
      * shell/client/styles/\_new-admin.scss
        [\_new-admin.scss](#diff-97ca11f7560268f2a4ebdf8f2373ce455d228240440b7573c119375a7b032fad)
  + imports

    - shell/imports/constants.js
      [constants.js](#diff-029c7f834fc10cfab6bd05dab458233da39ea2570552eb347af4356ebf00ce86)
    - server

      * shell/imports/server/migrations.js
        [migrations.js](#diff-118b0af3e3d51dd30582390d312b43f1056f7b703a1ead04f530589d518222b4)
      * shell/imports/server/networking.js
        [networking.js](#diff-e6bcdc465a5507779e34c48465e0b36346183a314bf8dfd9b2896f9a4d152944)
  + server

    - shell/server/00-startup.js
      [00-startup.js](#diff-6bb5f1a5680e8dd3f29cec55c3187f6efa7ed67421fea5cab106dc51dd8a0bf8)
    - drivers

      * shell/server/drivers/external-ui-view.js
        [external-ui-view.js](#diff-76fd4a0f5173d5888a27671ea76abc8880fdfe99125c6e9f3e3e9d900d385e46)
    - shell/server/hack-session.js
      [hack-session.js](#diff-7ee1059d194064ae6d83f88bdaab95a49d809ce1ff3b49f22980afd7a135f7f5)
    - shell/server/installer.js
      [installer.js](#diff-8d6a2fdd7758b7b24f124a9d38ee5a128b445765a55fca1b1ed57bc96587f02d)

## There are no files selected for viewing

4 changes: 4 additions & 0 deletions

4
[shell/client/admin-client.js](#diff-6ecd8825a154c8b1b4b9410ffef0333dfbd197ea6b48c16f91337bf4adbac7e5 "shell/client/admin-client.js")

Show comments

[View file](/sandstorm-io/sandstorm/blob/164997fb958effbc90c5328c166706280a84aaa1/shell/client/admin-client.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -150,6 +150,10 @@ Router.map(function () { |
|  |  | path: "/admin/preinstalled-apps", |
|  |  | controller: newAdminRoute, |
|  |  | }); |
|  |  | this.route("newAdminNetworking", { |
|  |  | path: "/admin/networking", |
|  |  | controller: newAdminRoute, |
|  |  | }); |
|  |  | this.route("newAdminMaintenance", { |
|  |  | path: "/admin/maintenance", |
|  |  | controller: newAdminRoute, |
| Expand Down | |  |

4 changes: 4 additions & 0 deletions

4
[shell/client/admin/admin.html](#diff-53259ca45d0b55464b5bbbbd77a1a7d9eba9e896f658277cd722e886eea565f6 "shell/client/admin/admin.html")

Show comments

[View file](/sandstorm-io/sandstorm/blob/164997fb958effbc90c5328c166706280a84aaa1/shell/client/admin/admin.html)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -99,6 +99,10 @@ <h2>Configuration</h2> |
|  |  | <div class="item-name">App sources</div> |
|  |  | <div class="item-subtext">Where to look for apps and app updates.</div> |
|  |  | {{/adminNavItem}} |
|  |  | {{#adminNavItem routeName="newAdminNetworking"}} |
|  |  | <div class="item-name">Networking</div> |
|  |  | <div class="item-subtext">Control how the network is accessed.</div> |
|  |  | {{/adminNavItem}} |
|  |  | </ul> |
|  |  | </li> |
|  |  | <li> |
| Expand Down | |  |

105 changes: 105 additions & 0 deletions

105
[shell/client/admin/networking-client.js](#diff-38e92125082ad90e586dddbb2ab817bc403f6f51e48a29ab13952840d918ecd0 "shell/client/admin/networking-client.js")

Show comments

[View file](/sandstorm-io/sandstorm/blob/164997fb958effbc90c5328c166706280a84aaa1/shell/client/admin/networking-client.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,105 @@ |
|  |  | // Sandstorm - Personal Cloud Sandbox |
|  |  | // Copyright (c) 2017 Sandstorm Development Group, Inc. and contributors |
|  |  | // All rights reserved. |
|  |  | // |
|  |  | // Licensed under the Apache License, Version 2.0 (the "License"); |
|  |  | // you may not use this file except in compliance with the License. |
|  |  | // You may obtain a copy of the License at |
|  |  | // |
|  |  | // http://www.apache.org/licenses/LICENSE-2.0 |
|  |  | // |
|  |  | // Unless required by applicable law or agreed to in writing, software |
|  |  | // distributed under the License is distributed on an "AS IS" BASIS, |
|  |  | // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. |
|  |  | // See the License for the specific language governing permissions and |
|  |  | // limitations under the License. |
|  |  |  |
|  |  | import { PRIVATE\_IPV4\_ADDRESSES, PRIVATE\_IPV6\_ADDRESSES } from "/imports/constants.js"; |
|  |  |  |
|  |  | const DEFAULT\_IP\_BLACKLIST = PRIVATE\_IPV4\_ADDRESSES.concat(PRIVATE\_IPV6\_ADDRESSES).join("\n"); |
|  |  |  |
|  |  | Template.newAdminNetworking.onCreated(function () { |
|  |  | this.originalIpBlacklist = globalDb.getSettingWithFallback("ipBlacklist", ""); |
|  |  | this.ipBlacklist = new ReactiveVar(this.originalIpBlacklist); |
|  |  | this.formState = new ReactiveVar({ |
|  |  | state: "edit", // Other allowed states: "submitting", "success", and "error" |
|  |  | message: undefined, |
|  |  | }); |
|  |  | }); |
|  |  |  |
|  |  | Template.newAdminNetworking.helpers({ |
|  |  | ipBlacklist() { |
|  |  | const instance = Template.instance(); |
|  |  | return instance.ipBlacklist.get(); |
|  |  | }, |
|  |  |  |
|  |  | saveDisabled() { |
|  |  | const instance = Template.instance(); |
|  |  | return instance.formState.get().state === "submitting" || |
|  |  | instance.ipBlacklist.get() === instance.originalIpBlacklist; |
|  |  | }, |
|  |  |  |
|  |  | restoreDisabled() { |
|  |  | const instance = Template.instance(); |
|  |  | return instance.ipBlacklist.get() === DEFAULT\_IP\_BLACKLIST; |
|  |  | }, |
|  |  |  |
|  |  | hasError() { |
|  |  | const instance = Template.instance(); |
|  |  | return instance.formState.get().state === "error"; |
|  |  | }, |
|  |  |  |
|  |  | hasSuccess() { |
|  |  | const instance = Template.instance(); |
|  |  | return instance.formState.get().state === "success"; |
|  |  | }, |
|  |  |  |
|  |  | message() { |
|  |  | const instance = Template.instance(); |
|  |  | return instance.formState.get().message; |
|  |  | }, |
|  |  | }); |
|  |  |  |
|  |  | Template.newAdminNetworking.events({ |
|  |  | "submit .admin-networking"(evt) { |
|  |  | evt.preventDefault(); |
|  |  | evt.stopPropagation(); |
|  |  | }, |
|  |  |  |
|  |  | "input textarea.ip-blacklist"(evt) { |
|  |  | evt.preventDefault(); |
|  |  | evt.stopPropagation(); |
|  |  | const instance = Template.instance(); |
|  |  | instance.ipBlacklist.set(evt.currentTarget.value); |
|  |  | }, |
|  |  |  |
|  |  | "click .save"(evt) { |
|  |  | const instance = Template.instance(); |
|  |  | const newIpBlacklist = instance.ipBlacklist.get(); |
|  |  |  |
|  |  | instance.formState.set({ |
|  |  | state: "submitting", |
|  |  | message: "", |
|  |  | }); |
|  |  |  |
|  |  | Meteor.call("setSetting", undefined, "ipBlacklist", newIpBlacklist, (err) => { |
|  |  | if (err) { |
|  |  | instance.formState.set({ |
|  |  | state: "error", |
|  |  | message: err.message, |
|  |  | }); |
|  |  | } else { |
|  |  | instance.originalIpBlacklist = newIpBlacklist; |
|  |  | instance.formState.set({ |
|  |  | state: "success", |
|  |  | message: "Saved changes.", |
|  |  | }); |
|  |  | } |
|  |  | }); |
|  |  | }, |
|  |  |  |
|  |  | "click .restore"(evt) { |
|  |  | const instance = Template.instance(); |
|  |  | instance.ipBlacklist.set(DEFAULT\_IP\_BLACKLIST); |
|  |  | }, |
|  |  | }); |

37 changes: 37 additions & 0 deletions

37
[shell/client/admin/networking.html](#diff-30dc8de51619e2067dc6408237050fe11526057df188fa6fe4f3af3ab0a376a3 "shell/client/admin/networking.html")

Show comments

[View file](/sandstorm-io/sandstorm/blob/164997fb958effbc90c5328c166706280a84aaa1/shell/client/admin/networking.html)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,37 @@ |
|  |  | <template name="newAdminNetworking"> |
|  |  | <h1> |
|  |  | <ul class="admin-breadcrumbs"> |
|  |  | <li>{{#linkTo route="newAdminRoot"}}Admin{{/linkTo}}</li> |
|  |  | <li>Security</li> |
|  |  | </ul> |
|  |  | </h1> |
|  |  |  |
|  |  | {{#if hasSuccess}} |
|  |  | {{#focusingSuccessBox}} |
|  |  | {{message}} |
|  |  | {{/focusingSuccessBox}} |
|  |  | {{/if}} |
|  |  | {{#if hasError}} |
|  |  | {{#focusingErrorBox}} |
|  |  | {{message}} |
|  |  | {{/focusingErrorBox}} |
|  |  | {{/if}} |
|  |  |  |
|  |  | <form class="admin-networking"> |
|  |  | <div class="form-group"> |
|  |  | <label> |
|  |  | Server-side request IP blacklist: |
|  |  | <textarea class="ip-blacklist" value="{{ ipBlacklist }}"></textarea> |
|  |  | </label> |
|  |  | <span class="form-subtext">Users will be prohibited from making requests to these IP addresses. This includes making a request from an app, downloading an SPK file from a user-provided URL, etc. You may specify one IP address or network (in CIDR notation, e.g. "127.0.0.0/8") per line. The default value includes standard local and private network addresses. Note that when an HTTP proxy is in use, this setting may be ignored; the proxy must implement its own blacklist.</span> |
|  |  | </div> |
|  |  |  |
|  |  | {{!-- TODO(someday): Allow whitelisting certain IPs or hosts? --}} |
|  |  | {{!-- TODO(someday): Configure HTTP proxy here. --}} |
|  |  |  |
|  |  | <div class="button-row"> |
|  |  | <button type="submit" class="save" disabled="{{saveDisabled}}">Save</button> |
|  |  | <button type="button" class="restore" disabled="{{restoreDisabled}}">Restore defaults</button> |
|  |  | </div> |
|  |  | </form> |
|  |  | </template> |

20 changes: 20 additions & 0 deletions

20
[shell/client/styles/\_admin-networking.scss](#diff-3f01b547382ea7b4b1ba238bcf87d34e55253b095d4eaafb0570541bc79764c5 "shell/client/styles/_admin-networking.scss")

Show comments

[View file](/sandstorm-io/sandstorm/blob/164997fb958effbc90c5328c166706280a84aaa1/shell/client/styles/_admin-networking.scss)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,20 @@ |
|  |  | .admin-networking { |
|  |  | @extend %standard-form; |
|  |  |  |
|  |  | textarea { |
|  |  | min-height: 200px; |
|  |  | font-family: monospace; |
|  |  | } |
|  |  |  |
|  |  | .save { |
|  |  | @extend %button-base; |
|  |  | @extend %button-primary; |
|  |  | margin-left: 10px; |
|  |  | } |
|  |  |  |
|  |  | .restore { |
|  |  | @extend %button-base; |
|  |  | @extend %button-secondary; |
|  |  | margin-left: 10px; |
|  |  | } |
|  |  | } |

1 change: 1 addition & 0 deletions

1
[shell/client/styles/\_new-admin.scss](#diff-97ca11f7560268f2a4ebdf8f2373ce455d228240440b7573c119375a7b032fad "shell/client/styles/_new-admin.scss")

Show comments

[View file](/sandstorm-io/sandstorm/blob/164997fb958effbc90c5328c166706280a84aaa1/shell/client/styles/_new-admin.scss)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -104,3 +104,4 @@ |
|  |  | @import "\_admin-users.scss"; |
|  |  | @import "\_admin-stats.scss"; |
|  |  | @import "\_admin-hosting-management.scss"; |
|  |  | @import "\_admin-networking.scss"; |

54 changes: 52 additions & 2 deletions

54
[shell/imports/constants.js](#diff-029c7f834fc10cfab6bd05dab458233da39ea2570552eb347af4356ebf00ce86 "shell/imports/constants.js")

Show comments

[View file](/sandstorm-io/sandstorm/blob/164997fb958effbc90c5328c166706280a84aaa1/shell/imports/constants.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -14,6 +14,56 @@ |
|  |  | // See the License for the specific language governing permissions and |
|  |  | // limitations under the License. |
|  |  |  |
|  |  | ACCOUNT\_DELETION\_SUSPENSION\_TIME = 7 \* 60 \* 60 \* 24 \* 1000; // 7 days in ms |
|  |  | const ACCOUNT\_DELETION\_SUSPENSION\_TIME = 7 \* 60 \* 60 \* 24 \* 1000; // 7 days in ms |
|  |  |  |
|  |  | export { ACCOUNT\_DELETION\_SUSPENSION\_TIME }; |
|  |  | // Lists below developed from RFC6890, which is an overview of all special addresses. |
|  |  | const PRIVATE\_IPV4\_ADDRESSES = [ |
|  |  | "10.0.0.0/8", // RFC1918 reserved for internal network |
|  |  | "127.0.0.0/8", // RFC1122 loopback / localhost |
|  |  | "169.254.0.0/16", // RFC3927 "link local" (auto-configured LAN in absence of DHCP) |
|  |  | "172.16.0.0/12", // RFC1918 reserved for internal network |
|  |  | "192.168.0.0/16", // RFC1918 reserved for internal network |
|  |  | ]; |
|  |  |  |
|  |  | const PRIVATE\_IPV6\_ADDRESSES = [ |
|  |  | "::1/128", // RFC4291 loopback / localhost |
|  |  | "fc00::/7", // RFC4193 unique private network |
|  |  | "fe80::/10", // RFC4291 "link local" (auto-configured LAN in absence of DHCP) |
|  |  | ]; |
|  |  |  |
|  |  | const SPECIAL\_IPV4\_ADDRESSES = [ |
|  |  | "0.0.0.0/8", // RFC1122 "this host" / wildcard |
|  |  | "100.64.0.0/10", // RFC6598 "shared address space" for carrier-grade NAT |
|  |  | "192.0.0.0/24", // RFC6890 reserved for special protocols |
|  |  | "192.0.2.0/24", // RFC5737 "example address" block 1 -- like example.com for IPs |
|  |  | "192.88.99.0/24", // RFC3068 6to4 relay |
|  |  | "198.18.0.0/15", // RFC2544 standard benchmarks |
|  |  | "198.51.100.0/24", // RFC5737 "example address" block 2 -- like example.com for IPs |
|  |  | "203.0.113.0/24", // RFC5737 "example address" block 3 -- like example.com for IPs |
|  |  | "224.0.0.0/4", // RFC1112 multicast |
|  |  | "240.0.0.0/4", // RFC1112 multicast / reserved for future use |
|  |  | "255.255.255.255/32" // RFC0919 broadcast address |
|  |  | ]; |
|  |  |  |
|  |  | const SPECIAL\_IPV6\_ADDRESSES = [ |
|  |  | "::/128", // RFC4291 unspecified address / wildcard |
|  |  | "64:ff9b::/96", // RFC6052 IPv4-IPv6 translation |
|  |  | "::ffff:0:0/96", // RFC4291 IPv4-mapped address |
|  |  | // TODO(someday): I don't understand the difference between the above |
|  |  | // two. Both are described as mapping ip4 addresses into the ip6 |
|  |  | // space. Perhaps this should be allowed, however, we'd need to |
|  |  | // filter the ip4 address against the ip4 blacklist, so special |
|  |  | // handling would be needed. |
|  |  | "100::/64", // RFC6666 discard-only address block |
|  |  | "2001::/23", // RFC2928 reserved for special protocols |
|  |  | "2001:2::/48", // RFC5180 standard benchmarks |
|  |  | "2001:db8::/32", // RFC3849 "example address" block -- like example.com for IPs |
|  |  | "2001:10::/28", // RFC4843 ORCHID |
|  |  | "2002::/16", // RFC3056 6to4 relay |
|  |  | "ff00::/8", // RFC4291 multicast |
|  |  | ]; |
|  |  |  |
|  |  | export { |
|  |  | ACCOUNT\_DELETION\_SUSPENSION\_TIME, PRIVATE\_IPV4\_ADDRESSES, PRIVATE\_IPV6\_ADDRESSES, |
|  |  | SPECIAL\_IPV4\_ADDRESSES, SPECIAL\_IPV6\_ADDRESSES |
|  |  | }; |

11 changes: 11 additions & 0 deletions

11
[shell/imports/server/migrations.js](#diff-118b0af3e3d51dd30582390d312b43f1056f7b703a1ead04f530589d518222b4 "shell/imports/server/migrations.js")

Show comments

[View file](/sandstorm-io/sandstorm/blob/164997fb958effbc90c5328c166706280a84aaa1/shell/imports/server/migrations.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -9,6 +9,7 @@ import { \_ } from "meteor/underscore"; |
|  |  | import { Match } from "meteor/check"; |
|  |  | import { userPictureUrl, fetchPicture } from "/imports/server/accounts/picture.js"; |
|  |  | import { waitPromise } from "/imports/server/async-helpers.js"; |
|  |  | import { PRIVATE\_IPV4\_ADDRESSES, PRIVATE\_IPV6\_ADDRESSES } from "/imports/constants.js"; |
|  |  |  |
|  |  | const Future = Npm.require("fibers/future"); |
|  |  | const Url = Npm.require("url"); |
| Expand Down  Expand Up | | @@ -777,6 +778,15 @@ function removeFeatureKeys(db, backend) { |
|  |  | db.notifications.remove({ "admin.type": "trialFeatureKeyExpired" }); |
|  |  | } |
|  |  |  |
|  |  | function setIpBlacklist(db, backend) { |
|  |  | if (Meteor.settings.public.isTesting) { |
|  |  | db.collections.settings.insert({ \_id: "ipBlacklist", value: "192.168.0.0/16" }); |
|  |  | } else { |
|  |  | const defaultIpBlacklist = PRIVATE\_IPV4\_ADDRESSES.concat(PRIVATE\_IPV6\_ADDRESSES).join("\n"); |
|  |  | db.collections.settings.insert({ \_id: "ipBlacklist", value: defaultIpBlacklist }); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | // This must come after all the functions named within are defined. |
|  |  | // Only append to this list! Do not modify or remove list entries; |
|  |  | // doing so is likely change the meaning and semantics of user databases. |
| Expand Down  Expand Up | | @@ -813,6 +823,7 @@ const MIGRATIONS = [ |
|  |  | setNewServer, |
|  |  | addMembraneRequirementsToIdentities, |
|  |  | addEncryptionToFrontendRefIpNetwork, |
|  |  | setIpBlacklist, |
|  |  | ]; |
|  |  |  |
|  |  | const NEW\_SERVER\_STARTUP = [ |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `164997f`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsandstorm-io%2Fsandstorm%2Fcommit%2F164997fb958effbc90c5328c166706280a84aaa1) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


