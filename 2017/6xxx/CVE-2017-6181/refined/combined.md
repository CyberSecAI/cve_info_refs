=== Content from bugs.ruby-lang.org_c4ff37b6_20250125_145055.html ===


Search

### Project

### General

### Profile

* [Sign in](/login)
* [Register](/account/register)

* [Home](/)
* [Projects](/projects)
* [Help](https://www.redmine.org/guide)

[Search](/projects/ruby-master/search):

 Ruby master[All Projects](/projects?jump=issues)
# [Ruby](/projects/ruby?jump=issues) » Ruby master

* [Overview](/projects/ruby-master)
* [Activity](/projects/ruby-master/activity)
* [Roadmap](/projects/ruby-master/roadmap)
* [Issues](/projects/ruby-master/issues)
* [Repository](/projects/ruby-master/repository)
* [Like](/projects/ruby-master/hearts)

### Custom queries

* [Backport 3.1](/projects/ruby-master/issues?query_id=287)
* [Backport 3.2](/projects/ruby-master/issues?query_id=293)
* [Backport 3.3](/projects/ruby-master/issues?query_id=300)
* [bugs: unassigned](/projects/ruby-master/issues?query_id=75)
* [DevMeeting](/projects/ruby-master/issues?query_id=156)
* [matz](/projects/ruby-master/issues?query_id=72)
* [Open issues with attachment](/projects/ruby-master/issues?query_id=160)
* [Windows](/projects/ruby-master/issues?query_id=335)

Actions
Copy link
## Bug #13234

closed
![](https://www.gravatar.com/avatar/eefbf5cde49236ebfd360c5c436d3b17e017beb0c669fb060139ea5aed24cb36?rating=PG&size=50&default=mm "Author: fumfel (Kamil Frankowicz)")

### Infinite recursion (stack overflow) in parse\_char\_class()

Added by [fumfel (Kamil Frankowicz)](/users/12088) [almost 8 years](/projects/ruby-master/activity?from=2017-02-20 "02/20/2017 07:38 AM") ago.
Updated [almost 8 years](/projects/ruby-master/activity?from=2017-03-12 "03/12/2017 02:03 PM") ago.

Status:ClosedAssignee:-Target version:-
ruby -v:Backport:[2.2: DONTNEED, 2.3: DONTNEED, 2.4: DONE](https://github.com/ruby/ruby/wiki/How-To-Request-Backport)
[[ruby-core:79624]](https://blade.ruby-lang.org/ruby-core/79624)

---

**Description**

After some fuzz testing I found a crashing test case.

Git HEAD: fbd5cda6aad6db01bbca3d893a9970314a1bd52c

To reproduce: miniruby ruby\_so\_parse\_char\_class

Error log: bug-13234.log

---

**Files**

[Download all files](/attachments/issues/13234/download "Download all files")

| [ruby\_so\_parse\_char\_class](/attachments/6387) (4 KB) [ruby\_so\_parse\_char\_class](/attachments/download/6387/ruby_so_parse_char_class "Download") | POC to trigger stack overflow (miniruby) | fumfel (Kamil Frankowicz), 02/20/2017 07:38 AM |  |
| --- | --- | --- | --- |
| [bug-13234.log](/attachments/6388) (82.3 KB) [bug-13234.log](/attachments/download/6388/bug-13234.log "Download") |  | nobu (Nobuyoshi Nakada), 02/20/2017 10:41 AM |  |

* [History](/issues/13234?tab=history)
* [Notes](/issues/13234?tab=notes)
* [Property changes](/issues/13234?tab=properties)
* [Associated revisions](/issues/13234?tab=changesets)

ActionsCopy link
[#1](#note-1)
[[ruby-core:79626]](https://blade.ruby-lang.org/ruby-core/79626)
#### Updated by [shyouhei (Shyouhei Urabe)](/users/10) [almost 8 years](/projects/ruby-master/activity?from=2017-02-20 "02/20/2017 08:55 AM") ago

Kamil Frankowicz wrote:

> After some fuzz testing I found a crashing test case.

Great... I can reproduce this. Not sure if this is an "infinite" recursion or just too deep to run on my machine, though.

Do you run a fuzz test for ruby or for your project? If this is something disclosable please do so, because currently ruby lacks such thing.

ActionsCopy link
[#2](#note-2)
#### Updated by [nobu (Nobuyoshi Nakada)](/users/4) [almost 8 years](/projects/ruby-master/activity?from=2017-02-20 "02/20/2017 09:46 AM") ago

* **Status** changed from *Open* to *Closed*

Applied in changeset r57660.

---

regparse.c: initialize return values

* regparse.c (parse\_char\_class): initialize return values before

  depth limit check. returned values will be freed in callers

  regardless the error. [[ruby-core:79624]](/issues/13234) [Bug [#13234](/issues/13234 "Bug: Infinite recursion (stack overflow) in parse_char_class() (Closed)")]

ActionsCopy link
[#3](#note-3)
[[ruby-core:79627]](https://blade.ruby-lang.org/ruby-core/79627)
#### Updated by [nobu (Nobuyoshi Nakada)](/users/4) [almost 8 years](/projects/ruby-master/activity?from=2017-02-20 "02/20/2017 10:41 AM") ago

* **File** [bug-13234.log](/attachments/6388) [bug-13234.log](/attachments/download/6388/bug-13234.log "Download") added
* **Description** updated ([diff](/journals/63047/diff?detail_id=43990 "View differences"))
* **Backport** changed from *2.2: UNKNOWN, 2.3: UNKNOWN, 2.4: UNKNOWN* to *2.2: DONTNEED, 2.3: DONTNEED, 2.4: REQUIRED*

ActionsCopy link
[#4](#note-4)
[[ruby-core:79630]](https://blade.ruby-lang.org/ruby-core/79630)
#### Updated by [fumfel (Kamil Frankowicz)](/users/12088) [almost 8 years](/projects/ruby-master/activity?from=2017-02-20 "02/20/2017 04:43 PM") ago

Shyouhei Urabe wrote:

> Kamil Frankowicz wrote:
>
> > After some fuzz testing I found a crashing test case.
>
> Great... I can reproduce this. Not sure if this is an "infinite" recursion or just too deep to run on my machine, though.
>
> Do you run a fuzz test for ruby or for your project? If this is something disclosable please do so, because currently ruby lacks such thing.

I fuzz ruby (in this case miniruby binary) with American Fuzzy Lop fuzzer (<http://lcamtuf.coredump.cx/afl/>). My testing corpus contains files from various open source projects written in ruby. It's all :-)

ActionsCopy link
[#5](#note-5)
[[ruby-core:79678]](https://blade.ruby-lang.org/ruby-core/79678)
#### Updated by [fumfel (Kamil Frankowicz)](/users/12088) [almost 8 years](/projects/ruby-master/activity?from=2017-02-22 "02/22/2017 09:49 AM") ago

This is CVE-2017-6181.

ActionsCopy link
[#6](#note-6)
[[ruby-core:79682]](https://blade.ruby-lang.org/ruby-core/79682)
#### Updated by [shyouhei (Shyouhei Urabe)](/users/10) [almost 8 years](/projects/ruby-master/activity?from=2017-02-22 "02/22/2017 10:36 AM") ago

Thank you again for the useful information. Will consider using the fuzzer and hopefully integrate into our test suite if possible/allowed.

ActionsCopy link
[#7](#note-7)
[[ruby-core:80056]](https://blade.ruby-lang.org/ruby-core/80056)
#### Updated by [naruse (Yui NARUSE)](/users/5) [almost 8 years](/projects/ruby-master/activity?from=2017-03-12 "03/12/2017 02:03 PM") ago

* **Backport** changed from *2.2: DONTNEED, 2.3: DONTNEED, 2.4: REQUIRED* to *2.2: DONTNEED, 2.3: DONTNEED, 2.4: DONE*

ruby\_2\_4 r57909 merged revision(s) 57660.

Actions
Copy link

Also available in: [Atom](/issues/13234.atom)
[PDF](/issues/13234.pdf)

Like0
Like0Like0Like0Like0Like0Like0Like0

Powered by [Redmine](https://www.redmine.org/) © 2006-2024 Jean-Philippe Lang

Loading...



=== Content from blade.ruby-lang.org_c049505a_20250126_093855.html ===
From: shyouhei@...
Date: 2017-02-22T10:36:02+00:00
Subject: [ruby-core:79682] [Ruby trunk Bug#13234] Infinite recursion (stack overflow) in parse\_char\_class()
Issue #13234 has been updated by Shyouhei Urabe.
Thank you again for the useful information. Will consider using the fuzzer and hopefully integrate into our test suite if possible/allowed.
----------------------------------------
Bug #13234: Infinite recursion (stack overflow) in parse\_char\_class()
https://bugs.ruby-lang.org/issues/13234#change-63102
\* Author: Kamil Frankowicz
\* Status: Closed
\* Priority: Normal
\* Assignee:
\* Target version:
\* ruby -v:
\* Backport: 2.2: DONTNEED, 2.3: DONTNEED, 2.4: REQUIRED
----------------------------------------
After some fuzz testing I found a crashing test case.
Git HEAD: fbd5cda6aad6db01bbca3d893a9970314a1bd52c
To reproduce: miniruby ruby\_so\_parse\_char\_class
Error log: bug-13234.log
---Files--------------------------------
ruby\_so\_parse\_char\_class (4 KB)
bug-13234.log (82.3 KB)
--
https://bugs.ruby-lang.org/
Unsubscribe:

