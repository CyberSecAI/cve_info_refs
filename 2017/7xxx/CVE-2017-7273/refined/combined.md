=== Content from github.com_bbade2ad_20250125_222557.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F1ebb71143758f45dc0fa76e2f48429e13b16d110)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F1ebb71143758f45dc0fa76e2f48429e13b16d110)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.9k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  438](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/1ebb71143758f45dc0fa76e2f48429e13b16d110)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

HID: hid-cypress: validate length of report

[Browse files](/torvalds/linux/tree/1ebb71143758f45dc0fa76e2f48429e13b16d110)
Browse the repository at this point in the history

```
Make sure we have enough of a report structure to validate before
looking at it.

Reported-by: Benoit Camredon <benoit.camredon@airbus.com>
Tested-by: Benoit Camredon <benoit.camredon@airbus.com>
Cc: stable <stable@vger.kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Jiri Kosina <jkosina@suse.cz>
```

* Loading branch information

[![@gregkh](https://avatars.githubusercontent.com/u/14953?s=40&v=4)](/gregkh)

[gregkh](/torvalds/linux/commits?author=gregkh "View all commits by gregkh")
authored and
Jiri Kosina
committed
Jan 6, 2017

1 parent
[08f9572](/torvalds/linux/commit/08f9572671c8047e7234cbf150869aa3c3d59a97)

commit 1ebb711

Showing
**1 changed file**
with
**3 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

3 changes: 3 additions & 0 deletions

3
[drivers/hid/hid-cypress.c](#diff-a3e0b84e025df41223c0ff17ebd48f0cf4c53e802b28b4647cafd3f28cef074e "drivers/hid/hid-cypress.c")

Show comments

[View file](/torvalds/linux/blob/1ebb71143758f45dc0fa76e2f48429e13b16d110/drivers/hid/hid-cypress.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -39,6 +39,9 @@ static \_\_u8 \*cp\_report\_fixup(struct hid\_device \*hdev, \_\_u8 \*rdesc, |
|  |  | if (!(quirks & CP\_RDESC\_SWAPPED\_MIN\_MAX)) |
|  |  | return rdesc; |
|  |  |  |
|  |  | if (\*rsize < 4) |
|  |  | return rdesc; |
|  |  |  |
|  |  | for (i = 0; i < \*rsize - 4; i++) |
|  |  | if (rdesc[i] == 0x29 && rdesc[i + 2] == 0x19) { |
|  |  | rdesc[i] = 0x19; |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `1ebb711`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F1ebb71143758f45dc0fa76e2f48429e13b16d110) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from git.kernel.org_d06e188c_20250125_222552.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=1ebb71143758f45dc0fa76e2f48429e13b16d110)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=1ebb71143758f45dc0fa76e2f48429e13b16d110)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=1ebb71143758f45dc0fa76e2f48429e13b16d110)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=1ebb71143758f45dc0fa76e2f48429e13b16d110)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2017-01-06 15:33:36 +0100 |
| --- | --- | --- |
| committer | Jiri Kosina <jkosina@suse.cz> | 2017-01-06 16:06:43 +0100 |
| commit | [1ebb71143758f45dc0fa76e2f48429e13b16d110](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=1ebb71143758f45dc0fa76e2f48429e13b16d110) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=1ebb71143758f45dc0fa76e2f48429e13b16d110)) | |
| tree | [807bc3a12427e4334d2c54716759e26ac2c3ebc1](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=1ebb71143758f45dc0fa76e2f48429e13b16d110) | |
| parent | [08f9572671c8047e7234cbf150869aa3c3d59a97](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=08f9572671c8047e7234cbf150869aa3c3d59a97) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=1ebb71143758f45dc0fa76e2f48429e13b16d110&id2=08f9572671c8047e7234cbf150869aa3c3d59a97)) | |
| download | [linux-1ebb71143758f45dc0fa76e2f48429e13b16d110.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-1ebb71143758f45dc0fa76e2f48429e13b16d110.tar.gz) | |

HID: hid-cypress: validate length of reportMake sure we have enough of a report structure to validate before
looking at it.
Reported-by: Benoit Camredon <benoit.camredon@airbus.com>
Tested-by: Benoit Camredon <benoit.camredon@airbus.com>
Cc: stable <stable@vger.kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Jiri Kosina <jkosina@suse.cz>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=1ebb71143758f45dc0fa76e2f48429e13b16d110)

| -rw-r--r-- | [drivers/hid/hid-cypress.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/drivers/hid/hid-cypress.c?id=1ebb71143758f45dc0fa76e2f48429e13b16d110) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 0 deletions

| diff --git a/drivers/hid/hid-cypress.c b/drivers/hid/hid-cypress.cindex 1b764d1745f3da..1689568b597d4e 100644--- a/[drivers/hid/hid-cypress.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/hid/hid-cypress.c?id=08f9572671c8047e7234cbf150869aa3c3d59a97)+++ b/[drivers/hid/hid-cypress.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/hid/hid-cypress.c?id=1ebb71143758f45dc0fa76e2f48429e13b16d110)@@ -39,6 +39,9 @@ static \_\_u8 \*cp\_report\_fixup(struct hid\_device \*hdev, \_\_u8 \*rdesc, if (!(quirks & CP\_RDESC\_SWAPPED\_MIN\_MAX)) return rdesc; + if (\*rsize < 4)+ return rdesc;+ for (i = 0; i < \*rsize - 4; i++) if (rdesc[i] == 0x29 && rdesc[i + 2] == 0x19) { rdesc[i] = 0x19; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-25 22:24:29 +0000



=== Content from www.kernel.org_b0940581_20250125_222556.html ===
commit 75353ac8ff437322ca5520b28d9f9b4b41b39bd6
Author: Greg Kroah-Hartman
Date: Sun Jan 15 13:43:07 2017 +0100
Linux 4.9.4
commit 6fea974494af50921a5201ebb30c65dde30a1a2b
Author: Larry Finger
Date: Wed Dec 21 11:18:55 2016 -0600
rtlwifi: rtl\_usb: Fix missing entry in USB driver's private data
commit 60f59ce0278557f7896d5158ae6d12a4855a72cc upstream.
These drivers need to be able to reference "struct ieee80211\_hw" from
the driver's private data, and vice versa. The USB driver failed to
store the address of ieee80211\_hw in the private data. Although this
bug has been present for a long time, it was not exposed until
commit ba9f93f82aba ("rtlwifi: Fix enter/exit power\_save").
Fixes: ba9f93f82aba ("rtlwifi: Fix enter/exit power\_save")
Signed-off-by: Larry Finger
Signed-off-by: Kalle Valo
Signed-off-by: Greg Kroah-Hartman
commit 7dae85b5c355a55c3ef44ef4dad0a77125802c7f
Author: Larry Finger
Date: Sat Nov 26 14:43:35 2016 -0600
rtlwifi: Fix enter/exit power\_save
commit ba9f93f82abafe2552eac942ebb11c2df4f8dd7f upstream.
In commit a5ffbe0a1993 ("rtlwifi: Fix scheduling while atomic bug") and
commit a269913c52ad ("rtlwifi: Rework rtl\_lps\_leave() and rtl\_lps\_enter()
to use work queue"), an error was introduced in the power-save routines
due to the fact that leaving PS was delayed by the use of a work queue.
This problem is fixed by detecting if the enter or leave routines are
in interrupt mode. If so, the workqueue is used to place the request.
If in normal mode, the enter or leave routines are called directly.
Fixes: a269913c52ad ("rtlwifi: Rework rtl\_lps\_leave() and rtl\_lps\_enter() to use work queue")
Reported-by: Ping-Ke Shih
Signed-off-by: Larry Finger
Cc: Stable
Signed-off-by: Kalle Valo
Signed-off-by: Greg Kroah-Hartman
commit 3f41ee3a45cb3b2a458e7c4aa69c0638fd745ad2
Author: Imre Deak
Date: Mon Dec 5 18:27:37 2016 +0200
drm/i915/gen9: Fix PCODE polling during CDCLK change notification
commit 2c7d0602c815277f7cb7c932b091288710d8aba7 upstream.
commit 848496e5902833600f7992f4faa82dc1546051ba
Author: Ville Syrjälä
Date: Wed Jul 13 16:32:03 2016 +0300
drm/i915: Wait up to 3ms for the pcu to ack the cdclk change request on SKL
increased the timeout to match the spec, but we still see a timeout on
at least one SKL. A CDCLK change request following the failed one will
succeed nevertheless.
I could reproduce this problem easily by running kms\_pipe\_crc\_basic in a
loop. In all failure cases \_wait\_for() was pre-empted for >3ms and so in
the worst case - when the pre-emption happened right after calculating
timeout\_\_ in \_wait\_for() - we called skl\_cdclk\_wait\_for\_pcu\_ready() only
once which failed and so \_wait\_for() timed out. As opposed to this the
spec says to keep retrying the request for at most a 3ms period.
To fix this send the first request explicitly to guarantee that there is
3ms between the first and last request. Though this matches the spec, I
noticed that in rare cases this can still time out if we sent only a few
requests (in the worst case 2) \_and\_ PCODE is busy for some reason even
after a previous request and a 3ms delay. To work around this retry the
polling with pre-emption disabled to maximize the number of requests.
Also increase the timeout to 10ms to account for interrupts that could
reduce the number of requests. With this change I couldn't trigger
the problem.
v2:
- Use 1ms poll period instead of 10us. (Chris)
v3:
- Poll with pre-emption disabled to increase the number of request
attempts. (Ville, Chris)
- Factor out a helper to poll, it's also needed by the next patch.
v4:
- Pass reply\_mask, reply to skl\_pcode\_request(), instead of assuming the
reply is generic. (Ville)
v5:
- List the request specific timeout values as code comment. (Ville)
v6:
- Try the poll first with preemption enabled.
- Add code comment about first request being queued by PCODE. (Art)
- Add timeout\_base\_ms argument. (Ville)
v7:
- Clarify code comment about first queued request. (Chris)
Cc: Ville Syrjälä
Cc: Chris Wilson
Cc: Art Runyan
Cc:  # v4.2- : 3b2c171 : drm/i915: Wait up to 3ms
Cc:  # v4.2-
Fixes: 5d96d8afcfbb ("drm/i915/skl: Deinit/init the display at suspend/resume")
Reference: https://bugs.freedesktop.org/show\_bug.cgi?id=97929
Testcase: igt/kms\_pipe\_crc\_basic/suspend-read-crc-pipe-B
Signed-off-by: Imre Deak
Reviewed-by: Chris Wilson
Link: http://patchwork.freedesktop.org/patch/msgid/1480955258-26311-1-git-send-email-imre.deak@intel.com
(cherry picked from commit a0b8a1fe34430c3a82258e8cb45f5968bdf31afd)
Signed-off-by: Jani Nikula
Signed-off-by: Greg Kroah-Hartman
commit 93f2976eb0276c932b22da771c90b9b4cd52ee49
Author: Dennis Kadioglu
Date: Mon Jan 9 17:10:46 2017 +0100
ALSA: usb-audio: Add a quirk for Plantronics BT600
commit 2e40795c3bf344cfb5220d94566205796e3ef19a upstream.
Plantronics BT600 does not support reading the sample rate which leads
to many lines of "cannot get freq at ep 0x1" and "cannot get freq at
ep 0x82". This patch adds the USB ID of the BT600 to quirks.c and
avoids those error messages.
Signed-off-by: Dennis Kadioglu
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit f52e670a5b29dd4fc94f0e386ee85724ec052f06
Author: Uwe Kleine-König
Date: Thu Dec 8 17:37:08 2016 +0100
spi: mvebu: fix baudrate calculation for armada variant
commit 7243e0b20729d372e97763617a7a9c89f29b33e1 upstream.
The calculation of SPR and SPPR doesn't round correctly at several
places which might result in baud rates that are too big. For example
with tclk\_hz = 250000001 and target rate 25000000 it determined a
divider of 10 which is wrong.
Instead of fixing all the corner cases replace the calculation by an
algorithm without a loop which should even be quicker to execute apart
from being correct.
Fixes: df59fa7f4bca ("spi: orion: support armada extended baud rates")
Signed-off-by: Uwe Kleine-König
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 05b7bdf1c3d8fe9c1bd92887a863a02c4cdcd207
Author: Grygorii Strashko
Date: Mon Dec 5 09:27:44 2016 +0530
ARM: omap2+: am437x: rollback to use omap3\_gptimer\_timer\_init()
commit f86a2c875fd146d9b82c8fdd86d31084507bcf4c upstream.
The commit 55ee7017ee31 ("arm: omap2: board-generic: use
omap4\_local\_timer\_init for AM437x") unintentionally changes the
clocksource devices for AM437x from OMAP GP Timer to SyncTimer32K.
Unfortunately, the SyncTimer32K is starving from frequency deviation
as mentioned in commit 5b5c01359152 ("ARM: OMAP2+: AM43x: Use gptimer
as clocksource") and, as reported by Franklin [1], even its monotonic
nature is under question (most probably there is a HW issue, but it's
still under investigation).
Taking into account above facts It's reasonable to rollback to the use
of omap3\_gptimer\_timer\_init().
[1] http://www.spinics.net/lists/linux-omap/msg127425.html
Fixes: 55ee7017ee31 ("arm: omap2: board-generic: use
omap4\_local\_timer\_init for AM437x")
Reported-by: Cooper Jr., Franklin
Signed-off-by: Grygorii Strashko
Signed-off-by: Lokesh Vutla
Signed-off-by: Keerthy
Signed-off-by: Tony Lindgren
Signed-off-by: Greg Kroah-Hartman
commit b8ba5faa7a6bdf1d8a86c1fc77651c566445402d
Author: Geert Uytterhoeven
Date: Tue Nov 22 12:33:11 2016 +0100
ARM: 8631/1: clkdev: Detect errors in clk\_hw\_register\_clkdev() for mass registration
commit 9388093db44356af911adf3d355b7544a13a63cd upstream.
Unlike clk\_register\_clkdev(), clk\_hw\_register\_clkdev() doesn't check for
passed error objects from a previous registration call. Hence the caller
of clk\_hw\_register\_\*() has to check for errors before calling
clk\_hw\_register\_clkdev\*().
Make clk\_hw\_register\_clkdev() more similar to clk\_register\_clkdev() by
adding this error check, removing the burden from callers that do mass
registration.
Fixes: e4f1b49bda6d6aa2 ("clkdev: Add clk\_hw based registration APIs")
Fixes: 944b9a41e004534f ("clk: ls1x: Migrate to clk\_hw based OF and registration APIs")
Fixes: 44ce9a9ae977736f ("MIPS: TXx9: Convert to Common Clock Framework")
Fixes: f48d947a162dfa9d ("clk: clps711x: Migrate to clk\_hw based OF and registration APIs")
Fixes: b4626a7f489238a5 ("CLK: Add Loongson1C clock support")
Signed-off-by: Geert Uytterhoeven
Signed-off-by: Russell King
Signed-off-by: Greg Kroah-Hartman
commit 87dbf3dc165240f1a3bed1ac7243a6b73c474029
Author: Tony Lindgren
Date: Mon Nov 7 16:50:11 2016 -0700
ARM: OMAP4+: Fix bad fallthrough for cpuidle
commit cbf2642872333547b56b8c4d943f5ed04ac9a4ee upstream.
We don't want to fall through to a bunch of errors for retention
if PM\_OMAP4\_CPU\_OSWR\_DISABLE is not configured for a SoC.
Fixes: 6099dd37c669 ("ARM: OMAP5 / DRA7: Enable CPU RET on suspend")
Acked-by: Santosh Shilimkar
Signed-off-by: Tony Lindgren
Signed-off-by: Greg Kroah-Hartman
commit b336dc57bc927e0fb3e7d2591d70b9ec7e426e18
Author: Tony Lindgren
Date: Mon Nov 7 16:50:10 2016 -0700
ARM: OMAP5: Fix build for PM code
commit da6d5993bf951846956903bee4f0eafd918250db upstream.
It's CONFIG\_SOC\_OMAP5, not CONFIG\_ARCH\_OMAP5. Looks like make randconfig
builds have not hit this one yet.
Fixes: b3bf289c1c45 ("ARM: OMAP2+: Fix build with CONFIG\_SMP and CONFIG\_PM is not set")
Acked-by: Santosh Shilimkar
Signed-off-by: Tony Lindgren
Signed-off-by: Greg Kroah-Hartman
commit 0f665deba9bc67a2af52e2e956a13e59ba1600f8
Author: Tony Lindgren
Date: Mon Nov 7 16:50:11 2016 -0700
ARM: OMAP5: Fix mpuss\_early\_init
commit 8a8be46afeaa47aed1debe7e9b18152f9826a6b7 upstream.
We need to properly initialize mpuss also on omap5 like we do on omap4.
Otherwise we run into similar kexec problems like we had on omap4 when
trying to kexec from a kernel with PM initialized.
Fixes: 0573b957fc21 ("ARM: OMAP4+: Prevent CPU1 related hang with kexec")
Acked-by: Santosh Shilimkar
Signed-off-by: Tony Lindgren
Signed-off-by: Greg Kroah-Hartman
commit aa1c7b01c9c7f263a0eb91a543fb91078ab5a508
Author: Thomas Gleixner
Date: Thu Dec 22 11:14:06 2016 +0100
bus: arm-ccn: Prevent hotplug callback leak
commit 26242b330093fd14c2e94fb6cbdf0f482ab26576 upstream.
In case the driver registration fails, the hotplug callback is leaked.
Not fatal, because it's never invoked as there are no instances registered,
but wrong nevertheless.
Fixes: fdc15a36d84e ("bus/arm-ccn: Convert to hotplug statemachine")
Signed-off-by: Thomas Gleixner
Cc: Sebastian Andrzej Siewior
Cc: Mark Rutland
Cc: Pawel Moll
Cc: Suzuki K Poulose
Cc: Peter Zijlstra
Cc: Will Deacon
Signed-off-by: Greg Kroah-Hartman
commit bd99e7a6036e847476f130bfadc67d772debe636
Author: Chuck Lever
Date: Tue Nov 29 11:04:26 2016 -0500
svcrdma: Clear xpt\_bc\_xps in xprt\_setup\_rdma\_bc() error exit arm
commit 1b9f700b8cfc31089e2dfa5d0905c52fd4529b50 upstream.
Logic copied from xs\_setup\_bc\_tcp().
Fixes: 39a9beab5acb ('rpc: share one xps between all backchannels')
Signed-off-by: Chuck Lever
Signed-off-by: J. Bruce Fields
Signed-off-by: Greg Kroah-Hartman
commit c2ce1c4133b31d60aaf0a075fe109e905ecb237b
Author: Neil Armstrong
Date: Wed Sep 7 10:18:42 2016 +0200
ARM: qcom\_defconfig: Fix MDM9515 LCC and GCC config
commit 206787737e308bb447d18adef7da7749188212f5 upstream.
Correct prefix is MDM instead of MSM.
Fixes: 8aa788d3e59a ("ARM: configs: qualcomm: Add MDM9615 missing defconfigs")
Signed-off-by: Neil Armstrong
Reviewed-by: Stephen Boyd
Signed-off-by: Andy Gross
Signed-off-by: Greg Kroah-Hartman
commit e925eb34265951eca92cbdba31bffc46c80da9e6
Author: Kyle Roeschley
Date: Mon Oct 31 11:26:17 2016 -0500
ARM: zynq: Reserve correct amount of non-DMA RAM
commit 7a3cc2a7b2c723aa552028f4e66841cec183756d upstream.
On Zynq, we haven't been reserving the correct amount of DMA-incapable
RAM to keep DMA away from it (per the Zynq TRM Section 4.1, it should be
the first 512k). In older kernels, this was masked by the
memblock\_reserve call in arm\_memblock\_init(). Now, reserve the correct
amount excplicitly rather than relying on swapper\_pg\_dir, which is an
address and not a size anyway.
Fixes: 46f5b96 ("ARM: zynq: Reserve not DMAable space in front of the kernel")
Signed-off-by: Kyle Roeschley
Tested-by: Nathan Rossi
Signed-off-by: Michal Simek
Signed-off-by: Greg Kroah-Hartman
commit 78e2d9405e2ddb2c5c5c1f5dc9ead81191277c70
Author: Robert Jarzmik
Date: Mon Sep 26 09:21:51 2016 +0200
ARM: pxa: fix pxa25x interrupt init
commit e413bd33ac44b6d0bebc0ef2ac19cbe7558a7303 upstream.
In the device-tree case, the root interrupt controller cannot be
accessed through the 6th coprocessor, contrary to pxa27x and pxa3xx
architectures.
Fix it to behave as in non-devicetree builds.
Fixes: 32f17997c130 ("ARM: pxa: remove irq init from dt machines")
Signed-off-by: Robert Jarzmik
Signed-off-by: Greg Kroah-Hartman
commit 596ff0afbe8e2e61fdb5cf222b8d72545af77e4e
Author: Andreas Färber
Date: Mon Oct 24 17:09:50 2016 +0200
ARM64: dts: bcm2835: Fix bcm2837 compatible string
commit 4f24450c6e580ac8591942c8bf65355a06b44635 upstream.
bcm2837-rpi-3-b.dts, its only in-tree user, was overriding it as
"brcm,bcm2837" already.
Fixes: 9d56c22a7861 ("ARM: bcm2835: Add devicetree for the Raspberry Pi 3.")
Cc: Stephen Warren
Signed-off-by: Andreas Färber
Signed-off-by: Eric Anholt
Signed-off-by: Greg Kroah-Hartman
commit e3937bc1cc0bb627e3495e7635d7bb5243ad90eb
Author: Andrea Merello
Date: Fri Nov 11 09:38:21 2016 -0800
ARM64: dts: bcm2837-rpi-3-b: remove incorrect pwr LED
commit a44e87b47148c6ee6b78509f47e6a15c0fae890a upstream.
We are incorrectly defining the pwr LED, attaching it to a gpio line
that is wired to the Wi-Fi SDIO module (which fails due to this).
The actual power LED is connected to the GPIO expander, which we don't
expose currently.
Fixes: 9d56c22a7861 ("ARM: bcm2835: Add devicetree for the Raspberry Pi 3.")
Thanks-to: Eric Anholt  [for clarifying we can't control the LED]
Signed-off-by: Andrea Merello
Signed-off-by: Eric Anholt
Signed-off-by: Greg Kroah-Hartman
commit d40152d5ac671bba821f0bd2183f2a59de1ae326
Author: Matthias Brugger
Date: Wed Oct 26 16:15:00 2016 +0200
arm64: dts: mt8173: Fix auxadc node
commit a3207d644fb89e5d7d5e01f00c04dcfc6d2d44d5 upstream.
The devicetree node for mt8173-auxadc lacks the clock and
io-channel-cells property. This leads to a non-working driver.
mt6577-auxadc 11001000.auxadc: failed to get auxadc clock
mt6577-auxadc: probe of 11001000.auxadc failed with error -2
Fix these fields to get the device up and running.
Fixes: 748c7d4de46a ("ARM64: dts: mt8173: Add thermal/auxadc device
nodes")
Signed-off-by: Matthias Brugger
Signed-off-by: Greg Kroah-Hartman
commit 08aed6e8883d3be7a8a1578231fc3dcafd2a9df3
Author: Mark Rutland
Date: Thu Nov 24 10:25:12 2016 +0000
tools/virtio: fix READ\_ONCE()
commit 5da889c795b1fbefc9d8f058b54717ab8ab17891 upstream.
The virtio tools implementation of READ\_ONCE() has a single parameter called
'var', but erroneously refers to 'val' for its cast, and thus won't work unless
there's a variable of the correct type that happens to be called 'var'.
Fix this with s/var/val/, making READ\_ONCE() work as expected regardless.
Fixes: a7c490333df3cff5 ("tools/virtio: use virt\_xxx barriers")
Signed-off-by: Mark Rutland
Cc: Jason Wang
Cc: Michael S. Tsirkin
Cc: linux-kernel@vger.kernel.org
Cc: virtualization@lists.linux-foundation.org
Signed-off-by: Michael S. Tsirkin
Reviewed-by: Cornelia Huck
Reviewed-by: Jason Wang
Signed-off-by: Greg Kroah-Hartman
commit e7d05ec1923e59a976d1095108a44a5f0533a0fe
Author: Larry Finger
Date: Thu Dec 22 21:06:53 2016 -0600
powerpc: Fix build warning on 32-bit PPC
commit 8ae679c4bc2ea2d16d92620da8e3e9332fa4039f upstream.
I am getting the following warning when I build kernel 4.9-git on my
PowerBook G4 with a 32-bit PPC processor:
AS arch/powerpc/kernel/misc\_32.o
arch/powerpc/kernel/misc\_32.S:299:7: warning: "CONFIG\_FSL\_BOOKE" is not defined [-Wundef]
This problem is evident after commit 989cea5c14be ("kbuild: prevent
lib-ksyms.o rebuilds"); however, this change in kbuild only exposes an
error that has been in the code since 2005 when this source file was
created. That was with commit 9994a33865f4 ("powerpc: Introduce
entry\_{32,64}.S, misc\_{32,64}.S, systbl.S").
The offending line does not make a lot of sense. This error does not
seem to cause any errors in the executable, thus I am not recommending
that it be applied to any stable versions.
Thanks to Nicholas Piggin for suggesting this solution.
Fixes: 9994a33865f4 ("powerpc: Introduce entry\_{32,64}.S, misc\_{32,64}.S, systbl.S")
Signed-off-by: Larry Finger
Cc: Nicholas Piggin
Cc: Benjamin Herrenschmidt
Cc: Paul Mackerras
Cc: Michael Ellerman
Cc: linuxppc-dev@lists.ozlabs.org
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 2fc33ff4ba817484a5307a4b5ef352d20d7af746
Author: Takashi Sakamoto
Date: Tue Jan 3 11:58:33 2017 +0900
ALSA: firewire-tascam: Fix to handle error from initialization of stream data
commit 6a2a2f45560a9cb7bc49820883b042e44f83726c upstream.
This module has a bug not to return error code in a case that data
structure for transmitted packets fails to be initialized.
This commit fixes the bug.
Fixes: 35efa5c489de ("ALSA: firewire-tascam: add streaming functionality")
Signed-off-by: Takashi Sakamoto
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 2c867216c555f5897b327daed6240bfb9e489c97
Author: Greg Kroah-Hartman
Date: Fri Jan 6 15:33:36 2017 +0100
HID: hid-cypress: validate length of report
commit 1ebb71143758f45dc0fa76e2f48429e13b16d110 upstream.
Make sure we have enough of a report structure to validate before
looking at it.
Reported-by: Benoit Camredon
Tested-by: Benoit Camredon
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Jiri Kosina
commit e425ed1d3c75295a3578df1a8b0314a83d9a5ec8
Author: David Ahern
Date: Tue Jan 10 15:22:25 2017 -0800
net: vrf: do not allow table id 0
[ Upstream commit 24c63bbc18e25d5d8439422aa5fd2d66390b88eb ]
Frank reported that vrf devices can be created with a table id of 0.
This breaks many of the run time table id checks and should not be
allowed. Detect this condition at create time and fail with EINVAL.
Fixes: 193125dbd8eb ("net: Introduce VRF device driver")
Reported-by: Frank Kellermann
Signed-off-by: David Ahern
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 7b7a5a85b1d90efbad5b5c9efe8a06e13832ec01
Author: David Ahern
Date: Tue Jan 10 14:37:35 2017 -0800
net: ipv4: Fix multipath selection with vrf
[ Upstream commit 7a18c5b9fb31a999afc62b0e60978aa896fc89e9 ]
fib\_select\_path does not call fib\_select\_multipath if oif is set in the
flow struct. For VRF use cases oif is always set, so multipath route
selection is bypassed. Use the FLOWI\_FLAG\_SKIP\_NH\_OIF to skip the oif
check similar to what is done in fib\_table\_lookup.
Add saddr and proto to the flow struct for the fib lookup done by the
VRF driver to better match hash computation for a flow.
Fixes: 613d09b30f8b ("net: Use VRF device index for lookups on TX")
Signed-off-by: David Ahern
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 7cc73483a4c7f0a2ac71b590ca35877f43bf0f2d
Author: Gil Rockah
Date: Tue Jan 10 22:33:38 2017 +0200
net/mlx5e: Remove WARN\_ONCE from adaptive moderation code
[ Upstream commit 0bbcc0a8fc394d01988fe0263ccf7fddb77a12c3 ]
When trying to do interface down or changing interface configuration
under heavy traffic, some of the adaptive moderation corner cases can
occur and leave a WARN\_ONCE call trace in the kernel log.
Those WARN\_ONCE are meant for debug only, and should have been inserted
only under debug. We avoid such call traces by removing those WARN\_ONCE.
Fixes: cb3c7fd4f839 ("net/mlx5e: Support adaptive RX coalescing")
Signed-off-by: Gil Rockah
Signed-off-by: Saeed Mahameed
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 17a561b19a274448c99b49cd0eb148e5890576ce
Author: Herbert Xu
Date: Tue Jan 10 12:24:15 2017 -0800
gro: Disable frag0 optimization on IPv6 ext headers
[ Upstream commit 57ea52a865144aedbcd619ee0081155e658b6f7d ]
The GRO fast path caches the frag0 address. This address becomes
invalid if frag0 is modified by pskb\_may\_pull or its variants.
So whenever that happens we must disable the frag0 optimization.
This is usually done through the combination of gro\_header\_hard
and gro\_header\_slow, however, the IPv6 extension header path did
the pulling directly and would continue to use the GRO fast path
incorrectly.
This patch fixes it by disabling the fast path when we enter the
IPv6 extension header path.
Fixes: 78a478d0efd9 ("gro: Inline skb\_gro\_header and cache frag0 virtual address")
Reported-by: Slava Shwartsman
Signed-off-by: Herbert Xu
Signed-off-by: Eric Dumazet
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 934ca017c85083ee25062f4d92935f6edc336bd5
Author: Eric Dumazet
Date: Tue Jan 10 19:52:43 2017 -0800
gro: use min\_t() in skb\_gro\_reset\_offset()
[ Upstream commit 7cfd5fd5a9813f1430290d20c0fead9b4582a307 ]
On 32bit arches, (skb->end - skb->data) is not 'unsigned int',
so we shall use min\_t() instead of min() to avoid a compiler error.
Fixes: 1272ce87fa01 ("gro: Enter slow-path if there is no tailroom")
Reported-by: kernel test robot
Signed-off-by: Eric Dumazet
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit ec0fdcb88c6f451dc3d436406de69fbf48a2e1da
Author: Herbert Xu
Date: Tue Jan 10 12:24:01 2017 -0800
gro: Enter slow-path if there is no tailroom
[ Upstream commit 1272ce87fa017ca4cf32920764d879656b7a005a ]
The GRO path has a fast-path where we avoid calling pskb\_may\_pull
and pskb\_expand by directly accessing frag0. However, this should
only be done if we have enough tailroom in the skb as otherwise
we'll have to expand it later anyway.
This patch adds the check by capping frag0\_len with the skb tailroom.
Fixes: cb18978cbf45 ("gro: Open-code final pskb\_may\_pull")
Reported-by: Slava Shwartsman
Signed-off-by: Herbert Xu
Signed-off-by: Eric Dumazet
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 33364eee1fe4b1bdff89312645ee3a624858dbc9
Author: Anna, Suman
Date: Mon Jan 9 21:48:56 2017 -0600
net: add the AF\_QIPCRTR entries to family name tables
[ Upstream commit 5d722b3024f6762addb8642ffddc9f275b5107ae ]
Commit bdabad3e363d ("net: Add Qualcomm IPC router") introduced a
new address family. Update the family name tables accordingly so
that the lockdep initialization can use the proper names for this
family.
Cc: Courtney Cavin
Cc: Bjorn Andersson
Signed-off-by: Suman Anna
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 2ff4a0243c9e7b16c4fa1e9b7ab08525f4b11a40
Author: Florian Fainelli
Date: Mon Jan 9 11:58:34 2017 -0800
net: dsa: Ensure validity of dst->ds[0]
[ Upstream commit faf3a932fbeb77860226a8323eacb835edc98648 ]
It is perfectly possible to have non zero indexed switches being present
in a DSA switch tree, in such a case, we will be deferencing a NULL
pointer while dsa\_cpu\_port\_ethtool\_{setup,restore}. Be more defensive
and ensure that dst->ds[0] is valid before doing anything with it.
Fixes: 0c73c523cf73 ("net: dsa: Initialize CPU port ethtool ops per tree")
Signed-off-by: Florian Fainelli
Reviewed-by: Vivien Didelot
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 66f24d624baaa9934c3288cd01d2b6dd65a399d3
Author: hayeswang
Date: Tue Jan 10 17:04:07 2017 +0800
r8152: fix rx issue for runtime suspend
[ Upstream commit 75dc692eda114cb234a46cb11893a9c3ea520934 ]
Pause the rx and make sure the rx fifo is empty when the autosuspend
occurs.
If the rx data comes when the driver is canceling the rx urb, the host
controller would stop getting the data from the device and continue
it after next rx urb is submitted. That is, one continuing data is
split into two different urb buffers. That let the driver take the
data as a rx descriptor, and unexpected behavior happens.
Signed-off-by: Hayes Wang
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit c8a89b4f5248e8d6742317b674010bdfeb31e06e
Author: hayeswang
Date: Tue Jan 10 17:04:06 2017 +0800
r8152: split rtl8152\_suspend function
[ Upstream commit 8fb280616878b81c0790a0c33acbeec59c5711f4 ]
Split rtl8152\_suspend() into rtl8152\_system\_suspend() and
rtl8152\_rumtime\_suspend().
Signed-off-by: Hayes Wang
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 294f2c8896370e0ce6c258df140fafe8fc43a857
Author: Florian Fainelli
Date: Sat Jan 7 21:01:57 2017 -0800
net: dsa: bcm\_sf2: Utilize nested MDIO read/write
[ Upstream commit 2cfe8f8290bd28cf1ee67db914a6e76cf8e6437b ]
We are implementing a MDIO bus which is behind another one, so use the
nested version of the accessors to get lockdep annotations correct.
Fixes: 461cd1b03e32 ("net: dsa: bcm\_sf2: Register our slave MDIO bus")
Signed-off-by: Florian Fainelli
Reviewed-by: Andrew Lunn
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit ac77aab46168435a88911f5a3e1b9e0c246d3c14
Author: Florian Fainelli
Date: Sat Jan 7 21:01:56 2017 -0800
net: dsa: bcm\_sf2: Do not clobber b53\_switch\_ops
[ Upstream commit a4c61b92b3a4cbda35bb0251a5063a68f0861b2c ]
We make the bcm\_sf2 driver override ds->ops which points to
b53\_switch\_ops since b53\_switch\_alloc() did the assignent. This is all
well and good until a second b53 switch comes in, and ends up using the
bcm\_sf2 operations. Make a proper local copy, substitute the ds->ops
pointer and then override the operations.
Fixes: f458995b9ad8 ("net: dsa: bcm\_sf2: Utilize core B53 driver when possible")
Signed-off-by: Florian Fainelli
Reviewed-by: Andrew Lunn
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit b55f6ca7380d609a40e0441d345404d100da3d45
Author: Daniel Borkmann
Date: Sat Jan 7 00:26:33 2017 +0100
bpf: change back to orig prog on too many passes
[ Upstream commit 9d5ecb09d525469abd1a10c096cb5a17206523f2 ]
If after too many passes still no image could be emitted, then
swap back to the original program as we do in all other cases
and don't use the one with blinding.
Fixes: 959a75791603 ("bpf, x86: add support for constant blinding")
Signed-off-by: Daniel Borkmann
Acked-by: Alexei Starovoitov
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit a4d205a595217a45450ad402cbc5326c37dc0359
Author: David Ahern
Date: Tue Jan 3 09:37:55 2017 -0800
net: vrf: Add missing Rx counters
[ Upstream commit 926d93a33e59b2729afdbad357233c17184de9d2 ]
The move from rx-handler to L3 receive handler inadvertantly dropped the
rx counters. Restore them.
Fixes: 74b20582ac38 ("net: l3mdev: Add hook in ip and ipv6")
Reported-by: Dinesh Dutt
Signed-off-by: David Ahern
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit efc455f08ea8c31db60e3a9b307f6abb8ef63ede
Author: Alexander Duyck
Date: Mon Jan 2 13:32:54 2017 -0800
ipv4: Do not allow MAIN to be alias for new LOCAL w/ custom rules
[ Upstream commit 5350d54f6cd12eaff623e890744c79b700bd3f17 ]
In the case of custom rules being present we need to handle the case of the
LOCAL table being intialized after the new rule has been added. To address
that I am adding a new check so that we can make certain we don't use an
alias of MAIN for LOCAL when allocating a new table.
Fixes: 0ddcf43d5d4a ("ipv4: FIB Local/MAIN table collapse")
Reported-by: Oliver Brunel
Signed-off-by: Alexander Duyck
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit fe1e13cfe2c41bb43942555cebe248153d3aba1b
Author: Michal Tesar
Date: Mon Jan 2 14:38:36 2017 +0100
igmp: Make igmp group member RFC 3376 compliant
[ Upstream commit 7ababb782690e03b78657e27bd051e20163af2d6 ]
5.2. Action on Reception of a Query
When a system receives a Query, it does not respond immediately.
Instead, it delays its response by a random amount of time, bounded
by the Max Resp Time value derived from the Max Resp Code in the
received Query message. A system may receive a variety of Queries on
different interfaces and of different kinds (e.g., General Queries,
Group-Specific Queries, and Group-and-Source-Specific Queries), each
of which may require its own delayed response.
Before scheduling a response to a Query, the system must first
consider previously scheduled pending responses and in many cases
schedule a combined response. Therefore, the system must be able to
maintain the following state:
o A timer per interface for scheduling responses to General Queries.
o A per-group and interface timer for scheduling responses to Group-
Specific and Group-and-Source-Specific Queries.
o A per-group and interface list of sources to be reported in the
response to a Group-and-Source-Specific Query.
When a new Query with the Router-Alert option arrives on an
interface, provided the system has state to report, a delay for a
response is randomly selected in the range (0, [Max Resp Time]) where
Max Resp Time is derived from Max Resp Code in the received Query
message. The following rules are then used to determine if a Report
needs to be scheduled and the type of Report to schedule. The rules
are considered in order and only the first matching rule is applied.
1. If there is a pending response to a previous General Query
scheduled sooner than the selected delay, no additional response
needs to be scheduled.
2. If the received Query is a General Query, the interface timer is
used to schedule a response to the General Query after the
selected delay. Any previously pending response to a General
Query is canceled.
--8<--
Currently the timer is rearmed with new random expiration time for
every incoming query regardless of possibly already pending report.
Which is not aligned with the above RFE.
It also might happen that higher rate of incoming queries can
postpone the report after the expiration time of the first query
causing group membership loss.
Now the per interface general query timer is rearmed only
when there is no pending report already scheduled on that interface or
the newly selected expiration time is before the already pending
scheduled report.
Signed-off-by: Michal Tesar
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 7826d11cf44c53ff294e20ffe4365c068089054a
Author: Ian Kumlien
Date: Mon Jan 2 09:18:35 2017 +0100
flow\_dissector: Update pptp handling to avoid null pointer deref.
[ Upstream commit d0af683407a26a4437d8fa6e283ea201f2ae8146 ]
\_\_skb\_flow\_dissect can be called with a skb or a data packet, either
can be NULL. All calls seems to have been moved to \_\_skb\_header\_pointer
except the pptp handling which is still calling skb\_header\_pointer.
skb\_header\_pointer will use skb->data and thus:
[ 109.556866] BUG: unable to handle kernel NULL pointer dereference at 0000000000000080
[ 109.557102] IP: [] \_\_skb\_flow\_dissect+0xa88/0xce0
[ 109.557263] PGD 0
[ 109.557338]
[ 109.557484] Oops: 0000 [#1] SMP
[ 109.557562] Modules linked in: chaoskey
[ 109.557783] CPU: 2 PID: 0 Comm: swapper/2 Not tainted 4.9.0 #79
[ 109.557867] Hardware name: Supermicro A1SRM-LN7F/LN5F/A1SRM-LN7F-2758, BIOS 1.0c 11/04/2015
[ 109.557957] task: ffff94085c27bc00 task.stack: ffffb745c0068000
[ 109.558041] RIP: 0010:[] [] \_\_skb\_flow\_dissect+0xa88/0xce0
[ 109.558203] RSP: 0018:ffff94087fc83d40 EFLAGS: 00010206
[ 109.558286] RAX: 0000000000000130 RBX: ffffffff8975bf80 RCX: ffff94084fab6800
[ 109.558373] RDX: 0000000000000010 RSI: 000000000000000c RDI: 0000000000000000
[ 109.558460] RBP: 0000000000000b88 R08: 0000000000000000 R09: 0000000000000022
[ 109.558547] R10: 0000000000000008 R11: ffff94087fc83e04 R12: 0000000000000000
[ 109.558763] R13: ffff94084fab6800 R14: ffff94087fc83e04 R15: 000000000000002f
[ 109.558979] FS: 0000000000000000(0000) GS:ffff94087fc80000(0000) knlGS:0000000000000000
[ 109.559326] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 109.559539] CR2: 0000000000000080 CR3: 0000000281809000 CR4: 00000000001026e0
[ 109.559753] Stack:
[ 109.559957] 000000000000000c ffff94084fab6822 0000000000000001 ffff94085c2b5fc0
[ 109.560578] 0000000000000001 0000000000002000 0000000000000000 0000000000000000
[ 109.561200] 0000000000000000 0000000000000000 0000000000000000 0000000000000000
[ 109.561820] Call Trace:
[ 109.562027]
[ 109.562108] [] ? eth\_get\_headlen+0x7a/0xf0
[ 109.562522] [] ? igb\_poll+0x96a/0xe80
[ 109.562737] [] ? net\_rx\_action+0x20b/0x350
[ 109.562953] [] ? \_\_do\_softirq+0xe8/0x280
[ 109.563169] [] ? irq\_exit+0xaa/0xb0
[ 109.563382] [] ? do\_IRQ+0x4b/0xc0
[ 109.563597] [] ? common\_interrupt+0x7f/0x7f
[ 109.563810]
[ 109.563890] [] ? cpuidle\_enter\_state+0x130/0x2c0
[ 109.564304] [] ? cpuidle\_enter\_state+0x120/0x2c0
[ 109.564520] [] ? cpu\_startup\_entry+0x19f/0x1f0
[ 109.564737] [] ? start\_secondary+0x12a/0x140
[ 109.564950] Code: 83 e2 20 a8 80 0f 84 60 01 00 00 c7 04 24 08 00
00 00 66 85 d2 0f 84 be fe ff ff e9 69 fe ff ff 8b 34 24 89 f2 83 c2
04 66 85 c0 <41> 8b 84 24 80 00 00 00 0f 49 d6 41 8d 31 01 d6 41 2b 84
24 84
[ 109.569959] RIP [] \_\_skb\_flow\_dissect+0xa88/0xce0
[ 109.570245] RSP
[ 109.570453] CR2: 0000000000000080
Fixes: ab10dccb1160 ("rps: Inspect PPTP encapsulated by GRE to get flow hash")
Signed-off-by: Ian Kumlien
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 9f65f5d4746bdfe274a5f6ae7ce99c2441c8d286
Author: Reiter Wolfgang
Date: Tue Jan 3 01:39:10 2017 +0100
drop\_monitor: consider inserted data in genlmsg\_end
[ Upstream commit 3b48ab2248e61408910e792fe84d6ec466084c1a ]
Final nlmsg\_len field update must reflect inserted net\_dm\_drop\_point
data.
This patch depends on previous patch:
"drop\_monitor: add missing call to genlmsg\_end"
Signed-off-by: Reiter Wolfgang
Acked-by: Neil Horman
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 9f7551e05b0f59c09bf0ef8277e3364449feacb6
Author: Reiter Wolfgang
Date: Sat Dec 31 21:11:57 2016 +0100
drop\_monitor: add missing call to genlmsg\_end
[ Upstream commit 4200462d88f47f3759bdf4705f87e207b0f5b2e4 ]
Update nlmsg\_len field with genlmsg\_end to enable userspace processing
using nlmsg\_next helper. Also adds error handling.
Signed-off-by: Reiter Wolfgang
Acked-by: Neil Horman
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit a8a213f296ae0287e2f46a251e10a88f2c30ba61
Author: David Ahern
Date: Thu Dec 29 15:29:03 2016 -0800
net: ipv4: dst for local input routes should use l3mdev if relevant
[ Upstream commit f5a0aab84b74de68523599817569c057c7ac1622 ]
IPv4 output routes already use l3mdev device instead of loopback for dst's
if it is applicable. Change local input routes to do the same.
This fixes icmp responses for unreachable UDP ports which are directed
to the wrong table after commit 9d1a6c4ea43e4 because local\_input
routes use the loopback device. Moving from ingress device to loopback
loses the L3 domain causing responses based on the dst to get to lost.
Fixes: 9d1a6c4ea43e4 ("net: icmp\_route\_lookup should use rt dev to
determine L3 domain")
Signed-off-by: David Ahern
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit e7422080e35d1faff66016f4163a34b09de78815
Author: Wei Zhang
Date: Thu Dec 29 16:45:04 2016 +0800
net: fix incorrect original ingress device index in PKTINFO
[ Upstream commit f0c16ba8933ed217c2688b277410b2a37ba81591 ]
When we send a packet for our own local address on a non-loopback
interface (e.g. eth0), due to the change had been introduced from
commit 0b922b7a829c ("net: original ingress device index in PKTINFO"), the
original ingress device index would be set as the loopback interface.
However, the packet should be considered as if it is being arrived via the
sending interface (eth0), otherwise it would break the expectation of the
userspace application (e.g. the DHCPRELEASE message from dhcp\_release
binary would be ignored by the dnsmasq daemon, since it come from lo which
is not the interface dnsmasq bind to)
Fixes: 0b922b7a829c ("net: original ingress device index in PKTINFO")
Acked-by: David Ahern
Signed-off-by: Wei Zhang
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 2ffc694b572729d5f3e450a3b7d953eb88f4d550
Author: Mathias Krause
Date: Wed Dec 28 17:52:15 2016 +0100
rtnl: stats - add missing netlink message size checks
[ Upstream commit 4775cc1f2d5abca894ac32774eefc22c45347d1c ]
We miss to check if the netlink message is actually big enough to contain
a struct if\_stats\_msg.
Add a check to prevent userland from sending us short messages that would
make us access memory beyond the end of the message.
Fixes: 10c9ead9f3c6 ("rtnetlink: add new RTM\_GETSTATS message to dump...")
Signed-off-by: Mathias Krause
Cc: Roopa Prabhu
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 8cb7d6277f01327d0503cd679afa9b09e76f2c97
Author: Saeed Mahameed
Date: Wed Dec 28 14:58:42 2016 +0200
net/mlx5e: Disable netdev after close
[ Upstream commit 37f304d10030bb425c19099e7b955d9c3ec4cba3 ]
Disable netdev should come after it was closed, although no harm of doing it
before -hence the MLX5E\_STATE\_DESTROYING bit- but it is more natural this way.
Fixes: 26e59d8077a3 ("net/mlx5e: Implement mlx5e interface attach/detach callbacks")
Signed-off-by: Saeed Mahameed
Reviewed-by: Mohamad Haj Yahia
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit ee9f2fd3f6b686ae6b04fc0c432984e10eb74006
Author: Saeed Mahameed
Date: Wed Dec 28 14:58:41 2016 +0200
net/mlx5e: Don't sync netdev state when not registered
[ Upstream commit 610e89e05c3f28a7394935aa6b91f99548c4fd3c ]
Skip setting netdev vxlan ports and netdev rx\_mode on driver load
when netdev is not yet registered.
Synchronizing with netdev state is needed only on reset flow where the
netdev remains registered for the whole reset period.
This also fixes an access before initialization of net\_device.addr\_list\_lock
- which for some reason initialized on register\_netdev - where we queued
set\_rx\_mode work on driver load before netdev registration.
Fixes: 26e59d8077a3 ("net/mlx5e: Implement mlx5e interface attach/detach callbacks")
Signed-off-by: Saeed Mahameed
Reported-by: Sebastian Ott
Reviewed-by: Mohamad Haj Yahia
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 33c782dd15145746475758a8052bd698ae1a6e90
Author: Mohamad Haj Yahia
Date: Wed Dec 28 14:58:37 2016 +0200
net/mlx5: Prevent setting multicast macs for VFs
[ Upstream commit ccce1700263d8b5b219359d04180492a726cea16 ]
Need to check that VF mac address entered by the admin user is either
zero or unicast mac.
Multicast mac addresses are prohibited.
Fixes: 77256579c6b4 ('net/mlx5: E-Switch, Introduce Vport administration functions')
Signed-off-by: Mohamad Haj Yahia
Signed-off-by: Saeed Mahameed
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit b22c86ff8e78a74f4b1a531f671beb97278b138d
Author: Maor Gottlieb
Date: Wed Dec 28 14:58:35 2016 +0200
net/mlx5: Mask destination mac value in ethtool steering rules
[ Upstream commit 077b1e8069b9b74477b01d28f6b83774dc19a142 ]
We need to mask the destination mac value with the destination mac
mask when adding steering rule via ethtool.
Fixes: 1174fce8d1410 ('net/mlx5e: Support l3/l4 flow type specs in ethtool flow steering')
Signed-off-by: Maor Gottlieb
Signed-off-by: Saeed Mahameed
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit efbbc75c00fc15598cd863dfe117dfa976e8b971
Author: Eli Cohen
Date: Wed Dec 28 14:58:34 2016 +0200
net/mlx5: Avoid shadowing numa\_node
[ Upstream commit d151d73dcc99de87c63bdefebcc4cb69de1cdc40 ]
Avoid using a local variable named numa\_node to avoid shadowing a public
one.
Fixes: db058a186f98 ('net/mlx5\_core: Set irq affinity hints')
Signed-off-by: Eli Cohen
Signed-off-by: Saeed Mahameed
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit ca8a64467f2a20f86218c483c03fb7fc8c33c156
Author: Daniel Jurgens
Date: Wed Dec 28 14:58:33 2016 +0200
net/mlx5: Cancel recovery work in remove flow
[ Upstream commit 689a248df83b6032edc57e86267b4e5cc8d7174e ]
If there is pending delayed work for health recovery it must be canceled
if the device is being unloaded.
Fixes: 05ac2c0b7438 ("net/mlx5: Fix race between PCI error handlers and health work")
Signed-off-by: Daniel Jurgens
Signed-off-by: Saeed Mahameed
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 7bf1de7f2749ad858c33d3133240d5c3df046658
Author: Noa Osherovich
Date: Wed Dec 28 14:58:32 2016 +0200
net/mlx5: Check FW limitations on log\_max\_qp before setting it
[ Upstream commit 883371c453b937f9eb581fb4915210865982736f ]
When setting HCA capabilities, set log\_max\_qp to be the minimum
between the selected profile's value and the HCA limitation.
Fixes: 938fe83c8dcb ('net/mlx5\_core: New device capabilities...')
Signed-off-by: Noa Osherovich
Signed-off-by: Saeed Mahameed
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 9b4a34ff89878abbab4e22efaf7c2c683664304f
Author: Paul Blakey
Date: Wed Dec 28 14:54:47 2016 +0200
net/sched: cls\_flower: Fix missing addr\_type in classify
[ Upstream commit 0df0f207aab4f42e5c96a807adf9a6845b69e984 ]
Since we now use a non zero mask on addr\_type, we are matching on its
value (IPV4/IPV6). So before this fix, matching on enc\_src\_ip/enc\_dst\_ip
failed in SW/classify path since its value was zero.
This patch sets the proper value of addr\_type for encapsulated packets.
Fixes: 970bfcd09791 ('net/sched: cls\_flower: Use mask for addr\_type')
Signed-off-by: Paul Blakey
Reviewed-by: Hadar Hen Zion
Acked-by: Jiri Pirko
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 99f40c6bf565eaf69c705d944f687712e108a3dd
Author: Florian Fainelli
Date: Tue Dec 27 18:23:06 2016 -0800
net: stmmac: Fix race between stmmac\_drv\_probe and stmmac\_open
[ Upstream commit 5701659004d68085182d2fd4199c79172165fa65 ]
There is currently a small window during which the network device registered by
stmmac can be made visible, yet all resources, including and clock and MDIO bus
have not had a chance to be set up, this can lead to the following error to
occur:
[ 473.919358] stmmaceth 0000:01:00.0 (unnamed net\_device) (uninitialized):
stmmac\_dvr\_probe: warning: cannot get CSR clock
[ 473.919382] stmmaceth 0000:01:00.0: no reset control found
[ 473.919412] stmmac - user ID: 0x10, Synopsys ID: 0x42
[ 473.919429] stmmaceth 0000:01:00.0: DMA HW capability register supported
[ 473.919436] stmmaceth 0000:01:00.0: RX Checksum Offload Engine supported
[ 473.919443] stmmaceth 0000:01:00.0: TX Checksum insertion supported
[ 473.919451] stmmaceth 0000:01:00.0 (unnamed net\_device) (uninitialized):
Enable RX Mitigation via HW Watchdog Timer
[ 473.921395] libphy: PHY stmmac-1:00 not found
[ 473.921417] stmmaceth 0000:01:00.0 eth0: Could not attach to PHY
[ 473.921427] stmmaceth 0000:01:00.0 eth0: stmmac\_open: Cannot attach to
PHY (error: -19)
[ 473.959710] libphy: stmmac: probed
[ 473.959724] stmmaceth 0000:01:00.0 eth0: PHY ID 01410cc2 at 0 IRQ POLL
(stmmac-1:00) active
[ 473.959728] stmmaceth 0000:01:00.0 eth0: PHY ID 01410cc2 at 1 IRQ POLL
(stmmac-1:01)
[ 473.959731] stmmaceth 0000:01:00.0 eth0: PHY ID 01410cc2 at 2 IRQ POLL
(stmmac-1:02)
[ 473.959734] stmmaceth 0000:01:00.0 eth0: PHY ID 01410cc2 at 3 IRQ POLL
(stmmac-1:03)
Fix this by making sure that register\_netdev() is the last thing being done,
which guarantees that the clock and the MDIO bus are available.
Fixes: 4bfcbd7abce2 ("stmmac: Move the mdio\_register/\_unregister in probe/remove")
Reported-by: Kweh, Hock Leong
Signed-off-by: Florian Fainelli
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 09babe4ce12ef1698db87c29ad9329529fab1c85
Author: Daniel Borkmann
Date: Wed Dec 21 18:04:11 2016 +0100
net, sched: fix soft lockup in tc\_classify
[ Upstream commit 628185cfddf1dfb701c4efe2cfd72cf5b09f5702 ]
Shahar reported a soft lockup in tc\_classify(), where we run into an
endless loop when walking the classifier chain due to tp->next == tp
which is a state we should never run into. The issue only seems to
trigger under load in the tc control path.
What happens is that in tc\_ctl\_tfilter(), thread A allocates a new
tp, initializes it, sets tp\_created to 1, and calls into tp->ops->change()
with it. In that classifier callback we had to unlock/lock the rtnl
mutex and returned with -EAGAIN. One reason why we need to drop there
is, for example, that we need to request an action module to be loaded.
This happens via tcf\_exts\_validate() -> tcf\_action\_init/\_1() meaning
after we loaded and found the requested action, we need to redo the
whole request so we don't race against others. While we had to unlock
rtnl in that time, thread B's request was processed next on that CPU.
Thread B added a new tp instance successfully to the classifier chain.
When thread A returned grabbing the rtnl mutex again, propagating -EAGAIN
and destroying its tp instance which never got linked, we goto replay
and redo A's request.
This time when walking the classifier chain in tc\_ctl\_tfilter() for
checking for existing tp instances we had a priority match and found
the tp instance that was created and linked by thread B. Now calling
again into tp->ops->change() with that tp was successful and returned
without error.
tp\_created was never cleared in the second round, thus kernel thinks
that we need to link it into the classifier chain (once again). tp and
\*back point to the same object due to the match we had earlier on. Thus
for thread B's already public tp, we reset tp->next to tp itself and
link it into the chain, which eventually causes the mentioned endless
loop in tc\_classify() once a packet hits the data path.
Fix is to clear tp\_created at the beginning of each request, also when
we replay it. On the paths that can cause -EAGAIN we already destroy
the original tp instance we had and on replay we really need to start
from scratch. It seems that this issue was first introduced in commit
12186be7d2e1 ("net\_cls: fix unconfigured struct tcf\_proto keeps chaining
and avoid kernel panic when we use cls\_cgroup").
Fixes: 12186be7d2e1 ("net\_cls: fix unconfigured struct tcf\_proto keeps chaining and avoid kernel panic when we use cls\_cgroup")
Reported-by: Shahar Klein
Signed-off-by: Daniel Borkmann
Cc: Cong Wang
Acked-by: Eric Dumazet
Tested-by: Shahar Klein
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit ee99e2bc5e8a61e5e0025b7e654e6179d31a75fa
Author: Dave Jones
Date: Thu Dec 22 11:16:22 2016 -0500
ipv6: handle -EFAULT from skb\_copy\_bits
[ Upstream commit a98f91758995cb59611e61318dddd8a6956b52c3 ]
By setting certain socket options on ipv6 raw sockets, we can confuse the
length calculation in rawv6\_push\_pending\_frames triggering a BUG\_ON.
RIP: 0010:[] [] rawv6\_sendmsg+0xc30/0xc40
RSP: 0018:ffff881f6c4a7c18 EFLAGS: 00010282
RAX: 00000000fffffff2 RBX: ffff881f6c681680 RCX: 0000000000000002
RDX: ffff881f6c4a7cf8 RSI: 0000000000000030 RDI: ffff881fed0f6a00
RBP: ffff881f6c4a7da8 R08: 0000000000000000 R09: 0000000000000009
R10: ffff881fed0f6a00 R11: 0000000000000009 R12: 0000000000000030
R13: ffff881fed0f6a00 R14: ffff881fee39ba00 R15: ffff881fefa93a80
Call Trace:
[] ? unmap\_page\_range+0x693/0x830
[] inet\_sendmsg+0x67/0xa0
[] sock\_sendmsg+0x38/0x50
[] SYSC\_sendto+0xef/0x170
[] SyS\_sendto+0xe/0x10
[] do\_syscall\_64+0x50/0xa0
[] entry\_SYSCALL64\_slow\_path+0x25/0x25
Handle by jumping to the failure path if skb\_copy\_bits gets an EFAULT.
Reproducer:
#include
#include
#include
#include
#include
#include
#include
#define LEN 504
int main(int argc, char\* argv[])
{
int fd;
int zero = 0;
char buf[LEN];
memset(buf, 0, LEN);
fd = socket(AF\_INET6, SOCK\_RAW, 7);
setsockopt(fd, SOL\_IPV6, IPV6\_CHECKSUM, &zero, 4);
setsockopt(fd, SOL\_IPV6, IPV6\_DSTOPTS, &buf, LEN);
sendto(fd, buf, 1, 0, (struct sockaddr \*) buf, 110);
}
Signed-off-by: Dave Jones
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit d36a1cb1e3285ba7eb1bcff5b231b4786deefc5b
Author: Willem de Bruijn
Date: Thu Dec 22 18:19:16 2016 -0500
inet: fix IP(V6)\_RECVORIGDSTADDR for udp sockets
[ Upstream commit 39b2dd765e0711e1efd1d1df089473a8dd93ad48 ]
Socket cmsg IP(V6)\_RECVORIGDSTADDR checks that port range lies within
the packet. For sockets that have transport headers pulled, transport
offset can be negative. Use signed comparison to avoid overflow.
Fixes: e6afc8ace6dd ("udp: remove headers from UDP packets before queueing")
Reported-by: Nisar Jagabar
Signed-off-by: Willem de Bruijn
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit ed3cc329c7bc82c0f29735d81b26f96287dbe08a
Author: Xin Long
Date: Thu Dec 15 23:05:52 2016 +0800
sctp: sctp\_transport\_lookup\_process should rcu\_read\_unlock when transport is null
[ Upstream commit 08abb79542c9e8c367d1d8e44fe1026868d3f0a7 ]
Prior to this patch, sctp\_transport\_lookup\_process didn't rcu\_read\_unlock
when it failed to find a transport by sctp\_addrs\_lookup\_transport.
This patch is to fix it by moving up rcu\_read\_unlock right before checking
transport and also to remove the out path.
Fixes: 1cceda784980 ("sctp: fix the issue sctp\_diag uses lock\_sock in rcu\_read\_lock")
Signed-off-by: Xin Long
Acked-by: Marcelo Ricardo Leitner
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 8b8fbe5c25abcdc93fcb91c896c40452ca9789a3
Author: David Ahern
Date: Wed Dec 14 14:31:11 2016 -0800
net: vrf: Drop conntrack data after pass through VRF device on Tx
[ Upstream commit eb63ecc1706b3e094d0f57438b6c2067cfc299f2 ]
Locally originated traffic in a VRF fails in the presence of a POSTROUTING
rule. For example,
$ iptables -t nat -A POSTROUTING -s 11.1.1.0/24 -j MASQUERADE
$ ping -I red -c1 11.1.1.3
ping: Warning: source address might be selected on device other than red.
PING 11.1.1.3 (11.1.1.3) from 11.1.1.2 red: 56(84) bytes of data.
ping: sendmsg: Operation not permitted
Worse, the above causes random corruption resulting in a panic in random
places (I have not seen a consistent backtrace).
Call nf\_reset to drop the conntrack info following the pass through the
VRF device. The nf\_reset is needed on Tx but not Rx because of the order
in which NF\_HOOK's are hit: on Rx the VRF device is after the real ingress
device and on Tx it is is before the real egress device. Connection
tracking should be tied to the real egress device and not the VRF device.
Fixes: 8f58336d3f78a ("net: Add ethernet header for pass through VRF device")
Fixes: 35402e3136634 ("net: Add IPv6 support to VRF device")
Signed-off-by: David Ahern
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit d4a0b2e40c46898a307e37a857f623c3d884b1fe
Author: David Ahern
Date: Wed Dec 14 11:06:18 2016 -0800
net: vrf: Fix NAT within a VRF
[ Upstream commit a0f37efa82253994b99623dbf41eea8dd0ba169b ]
Connection tracking with VRF is broken because the pass through the VRF
device drops the connection tracking info. Removing the call to nf\_reset
allows DNAT and MASQUERADE to work across interfaces within a VRF.
Fixes: 73e20b761acf ("net: vrf: Add support for PREROUTING rules on vrf device")
Signed-off-by: David Ahern
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman


=== Content from git.kernel.org_aa6d9be6_20250125_222555.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=4faec4a2ef5dd481682cc155cb9ea14ba2534b76)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=4faec4a2ef5dd481682cc155cb9ea14ba2534b76)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=4faec4a2ef5dd481682cc155cb9ea14ba2534b76)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=4faec4a2ef5dd481682cc155cb9ea14ba2534b76)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2017-01-06 15:33:36 +0100 |
| --- | --- | --- |
| committer | Ben Hutchings <ben@decadent.org.uk> | 2017-03-16 02:18:39 +0000 |
| commit | [4faec4a2ef5dd481682cc155cb9ea14ba2534b76](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=4faec4a2ef5dd481682cc155cb9ea14ba2534b76) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=4faec4a2ef5dd481682cc155cb9ea14ba2534b76)) | |
| tree | [a687b080c638eebcef891aa60ba2de1bfc6fe0e7](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=4faec4a2ef5dd481682cc155cb9ea14ba2534b76) | |
| parent | [c3726b442527ab31c7110d0445411f5b5343db01](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=c3726b442527ab31c7110d0445411f5b5343db01) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=4faec4a2ef5dd481682cc155cb9ea14ba2534b76&id2=c3726b442527ab31c7110d0445411f5b5343db01)) | |
| download | [linux-4faec4a2ef5dd481682cc155cb9ea14ba2534b76.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-4faec4a2ef5dd481682cc155cb9ea14ba2534b76.tar.gz) | |

HID: hid-cypress: validate length of reportNotice: this object is not reachable from any branch.
commit 1ebb71143758f45dc0fa76e2f48429e13b16d110 upstream.
Make sure we have enough of a report structure to validate before
looking at it.
Reported-by: Benoit Camredon <benoit.camredon@airbus.com>
Tested-by: Benoit Camredon <benoit.camredon@airbus.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Jiri Kosina <jkosina@suse.cz>
Signed-off-by: Ben Hutchings <ben@decadent.org.uk>
Notice: this object is not reachable from any branch.
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=4faec4a2ef5dd481682cc155cb9ea14ba2534b76)

| -rw-r--r-- | [drivers/hid/hid-cypress.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/drivers/hid/hid-cypress.c?id=4faec4a2ef5dd481682cc155cb9ea14ba2534b76) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 0 deletions

| diff --git a/drivers/hid/hid-cypress.c b/drivers/hid/hid-cypress.cindex 9e43aaca9774be..d6cae2632cba2a 100644--- a/[drivers/hid/hid-cypress.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/hid/hid-cypress.c?id=c3726b442527ab31c7110d0445411f5b5343db01)+++ b/[drivers/hid/hid-cypress.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/hid/hid-cypress.c?id=4faec4a2ef5dd481682cc155cb9ea14ba2534b76)@@ -40,6 +40,9 @@ static \_\_u8 \*cp\_report\_fixup(struct hid\_device \*hdev, \_\_u8 \*rdesc, if (!(quirks & CP\_RDESC\_SWAPPED\_MIN\_MAX)) return rdesc; + if (\*rsize < 4)+ return rdesc;+ for (i = 0; i < \*rsize - 4; i++) if (rdesc[i] == 0x29 && rdesc[i + 2] == 0x19) { \_\_u8 tmp; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-25 22:24:32 +0000


