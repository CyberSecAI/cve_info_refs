=== Content from bugs.chromium.org_2eddfdc8_20250125_182154.html ===



=== Content from github.com_6b775e89_20250125_182156.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgrpc%2Fgrpc%2Fpull%2F9833)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgrpc%2Fgrpc%2Fpull%2F9833)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=grpc%2Fgrpc)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[grpc](/grpc)
/
**[grpc](/grpc/grpc)**
Public

* [Notifications](/login?return_to=%2Fgrpc%2Fgrpc) You must be signed in to change notification settings
* [Fork
  10.6k](/login?return_to=%2Fgrpc%2Fgrpc)
* [Star
   42.3k](/login?return_to=%2Fgrpc%2Fgrpc)

* [Code](/grpc/grpc)
* [Issues
  659](/grpc/grpc/issues)
* [Pull requests
  374](/grpc/grpc/pulls)
* [Actions](/grpc/grpc/actions)
* [Projects
  0](/grpc/grpc/projects)
* [Security](/grpc/grpc/security)
* [Insights](/grpc/grpc/pulse)

Additional navigation options

* [Code](/grpc/grpc)
* [Issues](/grpc/grpc/issues)
* [Pull requests](/grpc/grpc/pulls)
* [Actions](/grpc/grpc/actions)
* [Projects](/grpc/grpc/projects)
* [Security](/grpc/grpc/security)
* [Insights](/grpc/grpc/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fgrpc%2Fgrpc%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fgrpc%2Fgrpc%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Fixed Heap-buffer-overflow in parse\_unix via clusterfuzz #9833

 Merged

[dgquintas](/dgquintas)
merged 5 commits into
[grpc:master](/grpc/grpc/tree/master "grpc/grpc:master")
from
[dgquintas:parse\_address\_clusterfuzz](/dgquintas/grpc/tree/parse_address_clusterfuzz "dgquintas/grpc:parse_address_clusterfuzz")

Feb 28, 2017

 Merged

# [Fixed Heap-buffer-overflow in parse\_unix via clusterfuzz](#top) #9833

[dgquintas](/dgquintas)
merged 5 commits into
[grpc:master](/grpc/grpc/tree/master "grpc/grpc:master")
from
[dgquintas:parse\_address\_clusterfuzz](/dgquintas/grpc/tree/parse_address_clusterfuzz "dgquintas/grpc:parse_address_clusterfuzz")

Feb 28, 2017

[Conversation
17](/grpc/grpc/pull/9833)
[Commits
5](/grpc/grpc/pull/9833/commits)
[Checks
0](/grpc/grpc/pull/9833/checks)
[Files changed](/grpc/grpc/pull/9833/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![dgquintas](https://avatars.githubusercontent.com/u/120217?s=60&v=4)](/dgquintas)

Copy link

Contributor

### @dgquintas **[dgquintas](/dgquintas)** commented [Feb 22, 2017](#issue-209603580) • edited Loading

Fixes

* <https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=661>
* <https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=655>
* <https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=650>

Sorry, something went wrong.

All reactions

[![@dgquintas](https://avatars.githubusercontent.com/u/120217?s=40&v=4)](/dgquintas)

`[Fixed Heap-buffer-overflow in parse_unix via clusterfuzz](/grpc/grpc/pull/9833/commits/bcd5f12e4bca2ed2c00cddb5ffd046aef6f4fb31 "Fixed Heap-buffer-overflow in parse_unix via clusterfuzz")`

`[bcd5f12](/grpc/grpc/pull/9833/commits/bcd5f12e4bca2ed2c00cddb5ffd046aef6f4fb31)`

[![@dgquintas](https://avatars.githubusercontent.com/u/120217?s=40&v=4)](/dgquintas)
[dgquintas](/dgquintas)
added
[kind/bug](/grpc/grpc/labels/kind/bug)
[area/core](/grpc/grpc/labels/area/core)
labels
[Feb 22, 2017](#event-973445070)

[![@dgquintas](https://avatars.githubusercontent.com/u/120217?s=40&v=4)](/dgquintas)
[dgquintas](/dgquintas)
assigned [ctiller](/ctiller) and [markdroth](/markdroth)
[Feb 22, 2017](#event-973445077)

 [![@dgquintas](https://avatars.githubusercontent.com/u/120217?s=40&v=4)](/dgquintas)
[dgquintas](/dgquintas)
requested review from
[ctiller](/ctiller) and
[markdroth](/markdroth)
[February 22, 2017 22:34](#event-973445084)

[![@googlebot](https://avatars.githubusercontent.com/u/5384588?s=40&u=b2b68981375faf7e582e8bf043e4d16f9bff44dd&v=4)](/googlebot)
[googlebot](/googlebot)
added
the
[cla: yes](/grpc/grpc/labels/cla%3A%20yes)
label
[Feb 22, 2017](#event-973445170)

[![@dgquintas](https://avatars.githubusercontent.com/u/120217?s=80&v=4)](/dgquintas)

Copy link

Contributor

Author

### **[dgquintas](/dgquintas)** commented [Feb 22, 2017](#issuecomment-281827469)

| Do you know if something needs to be done to mark the clusterfuzz entry as fixed? |
| --- |

All reactions

Sorry, something went wrong.

[![markdroth](https://avatars.githubusercontent.com/u/18664614?s=60&v=4)](/markdroth)

**[markdroth](/markdroth)**
reviewed
[Feb 22, 2017](#pullrequestreview-23355041)

 [View reviewed changes](/grpc/grpc/pull/9833/files/bcd5f12e4bca2ed2c00cddb5ffd046aef6f4fb31)

[src/core/ext/client\_channel/parse\_address.c](/grpc/grpc/pull/9833/files/bcd5f12e4bca2ed2c00cddb5ffd046aef6f4fb31#diff-6f2acfc79af2c356a17e935d1db93c70a49706fc49832a862a1e624710df3fa8)
Outdated

|  |  |  |
| --- | --- | --- |
|  |  | un->sun\_family = AF\_UNIX; |
|  |  | strcpy(un->sun\_path, uri->path); |
|  |  | strncpy(un->sun\_path, uri->path, sizeof(un->sun\_path) - 1 /\* null term'd \*/); |

Copy link

Member

### @markdroth **[markdroth](/markdroth)** [Feb 22, 2017](#discussion_r102594518)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

strncpy() is notoriously difficult to use in a safe way, because if the string is longer than the specified length, it does not copy the trailing NUL byte to the destination string. strlcpy() is a much safer alternative to strncpy(), but it's unfortunately not portable. :(

I assume that this misfeature of strncpy() is why you're using memset() above to initialize the whole struct. However, that seems a bit fragile, because a future developer looking at this code might think "the memset() isn't really necessary, because we're explicitly setting all of the fields below". An alternative would be to do something like this right after this line:

```
un->sun_path[sizeof(un->sun_path) - 1] = '\0';

```

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @dgquintas **[dgquintas](/dgquintas)** [Feb 22, 2017](#discussion_r102597669)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Yes, that was exactly why I was zeroing the memory. Good point though, setting the terminator explicitly is more robust.

Done.

Sorry, something went wrong.

All reactions

[![@dgquintas](https://avatars.githubusercontent.com/u/120217?s=40&v=4)](/dgquintas)

`[Set terminator explicitly](/grpc/grpc/pull/9833/commits/f05359f6975003197d83ec5a1b78893e01000f99 "Set terminator explicitly")`

`[f05359f](/grpc/grpc/pull/9833/commits/f05359f6975003197d83ec5a1b78893e01000f99)`

[![markdroth](https://avatars.githubusercontent.com/u/18664614?s=60&v=4)](/markdroth)

**[markdroth](/markdroth)**
approved these changes
[Feb 22, 2017](#pullrequestreview-23359678)

 [View reviewed changes](/grpc/grpc/pull/9833/files/f05359f6975003197d83ec5a1b78893e01000f99)

[![ctiller](https://avatars.githubusercontent.com/u/10120821?s=60&v=4)](/ctiller)

**[ctiller](/ctiller)**
reviewed
[Feb 23, 2017](#pullrequestreview-23409412)

 [View reviewed changes](/grpc/grpc/pull/9833/files/f05359f6975003197d83ec5a1b78893e01000f99)

[src/core/ext/client\_channel/parse\_address.c](/grpc/grpc/pull/9833/files/f05359f6975003197d83ec5a1b78893e01000f99#diff-6f2acfc79af2c356a17e935d1db93c70a49706fc49832a862a1e624710df3fa8)
Outdated

|  |  | @@ -51,7 +51,8 @@ int parse\_unix(grpc\_uri \*uri, grpc\_resolved\_address \*resolved\_addr) { | |
| --- | --- | --- | --- |
|  |  | struct sockaddr\_un \*un = (struct sockaddr\_un \*)resolved\_addr->addr; |
|  |  |  |
|  |  | un->sun\_family = AF\_UNIX; |
|  |  | strcpy(un->sun\_path, uri->path); |
|  |  | strncpy(un->sun\_path, uri->path, sizeof(un->sun\_path) - 1 /\* null term'd \*/); |

Copy link

Member

### @ctiller **[ctiller](/ctiller)** [Feb 23, 2017](#discussion_r102649701)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Should we just `return 0` if uri->path is too long?

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @dgquintas **[dgquintas](/dgquintas)** [Feb 23, 2017](#discussion_r102765120)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

yes. Done.

Sorry, something went wrong.

All reactions

 [![@dgquintas](https://avatars.githubusercontent.com/u/120217?s=40&v=4)](/dgquintas)
[dgquintas](/dgquintas)
[force-pushed](/grpc/grpc/compare/a40662ee3a4a2e34bb11da932211dd14a2d9d9f1..d6d86b04e4b94cd6f5a15cb7a3351e90e76c6eb1)
the
parse\_address\_clusterfuzz

branch
from
[`a40662e`](/grpc/grpc/commit/a40662ee3a4a2e34bb11da932211dd14a2d9d9f1) to
[`d6d86b0`](/grpc/grpc/commit/d6d86b04e4b94cd6f5a15cb7a3351e90e76c6eb1)  [Compare](/grpc/grpc/compare/a40662ee3a4a2e34bb11da932211dd14a2d9d9f1..d6d86b04e4b94cd6f5a15cb7a3351e90e76c6eb1)
[February 23, 2017 17:14](#event-974732210)

[![markdroth](https://avatars.githubusercontent.com/u/18664614?s=60&v=4)](/markdroth)

**[markdroth](/markdroth)**
requested changes
[Feb 23, 2017](#pullrequestreview-23533832)

 [View reviewed changes](/grpc/grpc/pull/9833/files)

[src/core/ext/client\_channel/parse\_address.c](/grpc/grpc/pull/9833/files#diff-6f2acfc79af2c356a17e935d1db93c70a49706fc49832a862a1e624710df3fa8)
Outdated

|  |  | @@ -49,12 +49,11 @@ | |
| --- | --- | --- | --- |
|  |  |  |
|  |  | int parse\_unix(grpc\_uri \*uri, grpc\_resolved\_address \*resolved\_addr) { |
|  |  | struct sockaddr\_un \*un = (struct sockaddr\_un \*)resolved\_addr->addr; |
|  |  |  |
|  |  | const size\_t maxlen = sizeof(un->sun\_path); |
|  |  | if (strnlen(uri->path, maxlen) == maxlen) return 0; |

Copy link

Member

### @markdroth **[markdroth](/markdroth)** [Feb 23, 2017](#discussion_r102766724)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Won't this fail if the size is exactly maxlen?

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @dgquintas **[dgquintas](/dgquintas)** [Feb 23, 2017](#discussion_r102769478)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

If the size is exactly maxlen, we have a problem: the \0 would be one-past the end

Sorry, something went wrong.

All reactions

[src/core/ext/client\_channel/parse\_address.c](/grpc/grpc/pull/9833/files#diff-6f2acfc79af2c356a17e935d1db93c70a49706fc49832a862a1e624710df3fa8)
Outdated

|  |  | resolved\_addr->len = strlen(un->sun\_path) + sizeof(un->sun\_family) + 1; |
| --- | --- | --- |
|  |  |  |
|  |  | strcpy(un->sun\_path, uri->path); |
|  |  | resolved\_addr->len = strlen(un->sun\_path) + maxlen + 1; |

Copy link

Member

### @markdroth **[markdroth](/markdroth)** [Feb 23, 2017](#discussion_r102767210)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Looks like you put `maxlen` here instead of `sizeof(un->sun_family)`, where you probably actually meant to `replace sizeof(un->sun_path)`.

Shouldn't this actually just be set to `sizeof(struct sockaddr_un)`?

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @dgquintas **[dgquintas](/dgquintas)** [Feb 23, 2017](#discussion_r102769599)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

You are too quick :) I noticed right after pushing, took me ~1 min to fix and re-push but that was already too late!

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @dgquintas **[dgquintas](/dgquintas)** [Feb 23, 2017](#discussion_r102769834)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

agh! hold on, push didn't go through...

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @dgquintas **[dgquintas](/dgquintas)** [Feb 23, 2017](#discussion_r102770063)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

ok, NOW. PTAL.

Sorry, something went wrong.

All reactions

[![@dgquintas](https://avatars.githubusercontent.com/u/120217?s=80&v=4)](/dgquintas)

Copy link

Contributor

Author

### **[dgquintas](/dgquintas)** commented [Feb 23, 2017](#issuecomment-282061625) via email

| Yes, I noticed that seconds after sending that commit. Refresh :) … On 23 February 2017 at 09:20, Mark D. Roth \*\*\*@\*\*\*.\*\*\*> wrote: \*\*\*@\*\*\*.\*\*\*\* requested changes on this pull request. ------------------------------ In src/core/ext/client\_channel/parse\_address.c <[#9833 (comment)](https://github.com/grpc/grpc/pull/9833#discussion_r102766724)>: > @@ -49,12 +49,11 @@ int parse\_unix(grpc\_uri \*uri, grpc\_resolved\_address \*resolved\_addr) { struct sockaddr\_un \*un = (struct sockaddr\_un \*)resolved\_addr->addr; - + const size\_t maxlen = sizeof(un->sun\_path); + if (strnlen(uri->path, maxlen) == maxlen) return 0; Won't this fail if the size is exactly maxlen? ------------------------------ In src/core/ext/client\_channel/parse\_address.c <[#9833 (comment)](https://github.com/grpc/grpc/pull/9833#discussion_r102767210)>: > un->sun\_family = AF\_UNIX; - strncpy(un->sun\_path, uri->path, sizeof(un->sun\_path) - 1 /\* null term'd \*/); - un->sun\_path[sizeof(un->sun\_path) - 1] = '\0'; - resolved\_addr->len = strlen(un->sun\_path) + sizeof(un->sun\_family) + 1; - + strcpy(un->sun\_path, uri->path); + resolved\_addr->len = strlen(un->sun\_path) + maxlen + 1; Looks like you put maxlen here instead of sizeof(un->sun\_family), where you probably actually meant to replace sizeof(un->sun\_path). Shouldn't this actually just be set to sizeof(struct sockaddr\_un)? — You are receiving this because you authored the thread. Reply to this email directly, view it on GitHub <[#9833 (review)](https://github.com/grpc/grpc/pull/9833#pullrequestreview-23533832)>, or mute the thread <<https://github.com/notifications/unsubscribe-auth/AAHVmaY5-bcFtL2PSPPYrZgVL2z5Fsr7ks5rfb_6gaJpZM4MJSIN>> . |
| --- |

All reactions

Sorry, something went wrong.

[![@dgquintas](https://avatars.githubusercontent.com/u/120217?s=40&v=4)](/dgquintas)

`[Simply return 0 on input path too long](/grpc/grpc/pull/9833/commits/e2869fee8db5f7a94858b551089c45bbb1bd943b "Simply return 0 on input path too long")`

`[e2869fe](/grpc/grpc/pull/9833/commits/e2869fee8db5f7a94858b551089c45bbb1bd943b)`

 [![@dgquintas](https://avatars.githubusercontent.com/u/120217?s=40&v=4)](/dgquintas)
[dgquintas](/dgquintas)
[force-pushed](/grpc/grpc/compare/d6d86b04e4b94cd6f5a15cb7a3351e90e76c6eb1..e2869fee8db5f7a94858b551089c45bbb1bd943b)
the
parse\_address\_clusterfuzz

branch
from
[`d6d86b0`](/grpc/grpc/commit/d6d86b04e4b94cd6f5a15cb7a3351e90e76c6eb1) to
[`e2869fe`](/grpc/grpc/commit/e2869fee8db5f7a94858b551089c45bbb1bd943b)  [Compare](/grpc/grpc/compare/d6d86b04e4b94cd6f5a15cb7a3351e90e76c6eb1..e2869fee8db5f7a94858b551089c45bbb1bd943b)
[February 23, 2017 17:32](#event-974761642)

[![markdroth](https://avatars.githubusercontent.com/u/18664614?s=60&v=4)](/markdroth)

**[markdroth](/markdroth)**
reviewed
[Feb 23, 2017](#pullrequestreview-23540580)

 [View reviewed changes](/grpc/grpc/pull/9833/files/e2869fee8db5f7a94858b551089c45bbb1bd943b)

[src/core/ext/client\_channel/parse\_address.c](/grpc/grpc/pull/9833/files/f05359f6975003197d83ec5a1b78893e01000f99..e2869fee8db5f7a94858b551089c45bbb1bd943b#diff-6f2acfc79af2c356a17e935d1db93c70a49706fc49832a862a1e624710df3fa8)
Outdated

|  |  | resolved\_addr->len = strlen(un->sun\_path) + sizeof(un->sun\_family) + 1; |
| --- | --- | --- |
|  |  |  |
|  |  | strcpy(un->sun\_path, uri->path); |
|  |  | resolved\_addr->len = path\_len + sizeof(un->sun\_family) + 1; |

Copy link

Member

### @markdroth **[markdroth](/markdroth)** [Feb 23, 2017](#discussion_r102773202)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I still don't think it's appropriate to use `path_len` here, since the size of the address is the size of the buffer, not the size of the string in the buffer (which may be smaller than the full size of the buffer).

Why are we not simply saying `resolved_addr->len = sizeof(struct sockaddr_un)`?

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @dgquintas **[dgquintas](/dgquintas)** [Feb 23, 2017](#discussion_r102775301)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

This was the previously existing logic, but I think you are right: all other types of addresses populate `len` with that way. Changed.

Sorry, something went wrong.

All reactions

[src/core/ext/client\_channel/parse\_address.c](/grpc/grpc/pull/9833/files/f05359f6975003197d83ec5a1b78893e01000f99..e2869fee8db5f7a94858b551089c45bbb1bd943b#diff-6f2acfc79af2c356a17e935d1db93c70a49706fc49832a862a1e624710df3fa8)

|  |  | @@ -49,12 +49,12 @@ | |
| --- | --- | --- | --- |
|  |  |  |
|  |  | int parse\_unix(grpc\_uri \*uri, grpc\_resolved\_address \*resolved\_addr) { |
|  |  | struct sockaddr\_un \*un = (struct sockaddr\_un \*)resolved\_addr->addr; |
|  |  |  |
|  |  | const size\_t maxlen = sizeof(un->sun\_path); |
|  |  | const size\_t path\_len = strnlen(uri->path, maxlen); |

Copy link

Member

### @markdroth **[markdroth](/markdroth)** [Feb 23, 2017](#discussion_r102773637)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Doesn't look like the logic actually changed here. But upon further review, I think this is correct: if the NUL byte is at maxlen, strnlen() will return maxlen - 1, which is fine, and if the NUL byte is at maxlen + 1, we don't have enough room in the buffer, so we should fail.

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @dgquintas **[dgquintas](/dgquintas)** [Feb 23, 2017](#discussion_r102774379)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Yes, exactly.

Sorry, something went wrong.

All reactions

[![@dgquintas](https://avatars.githubusercontent.com/u/120217?s=40&v=4)](/dgquintas)

`[poopulate ->len with size of struct](/grpc/grpc/pull/9833/commits/d9314adb8e3bc687d15269c6e25554741ded4ea6 "poopulate ->len with size of struct")`

`[d9314ad](/grpc/grpc/pull/9833/commits/d9314adb8e3bc687d15269c6e25554741ded4ea6)`

[![markdroth](https://avatars.githubusercontent.com/u/18664614?s=60&v=4)](/markdroth)

**[markdroth](/markdroth)**
approved these changes
[Feb 23, 2017](#pullrequestreview-23543108)

 [View reviewed changes](/grpc/grpc/pull/9833/files/d9314adb8e3bc687d15269c6e25554741ded4ea6)

[![@dgquintas](https://avatars.githubusercontent.com/u/120217?s=40&v=4)](/dgquintas)

`[Merge branch 'master' of github.com:grpc/grpc into parse_address_clus…](/grpc/grpc/pull/9833/commits/7ff6cd2757ee0d82e486b634c3f02aadaf809ac1 "Merge branch 'master' of github.com:grpc/grpc into parse_address_clusterfuzz")`
 …

`[7ff6cd2](/grpc/grpc/pull/9833/commits/7ff6cd2757ee0d82e486b634c3f02aadaf809ac1)`

```
…terfuzz
```

[![@dgquintas](https://avatars.githubusercontent.com/u/120217?s=80&v=4)](/dgquintas)

Copy link

Contributor

Author

### **[dgquintas](/dgquintas)** commented [Feb 28, 2017](#issuecomment-283191005)

| Issues: [#9147](https://github.com/grpc/grpc/issues/9147) [#9762](https://github.com/grpc/grpc/issues/9762) [#9797](https://github.com/grpc/grpc/issues/9797) [#9399](https://github.com/grpc/grpc/issues/9399) |
| --- |

All reactions

Sorry, something went wrong.

[![@dgquintas](https://avatars.githubusercontent.com/u/120217?s=40&v=4)](/dgquintas)
[dgquintas](/dgquintas)
merged commit [`5f13f48`](/grpc/grpc/commit/5f13f4898612c136cff1f2d04a91c25b6d4b694a)
into
grpc:master

[Feb 28, 2017](https://github.com/grpc/grpc/pull/9833#event-980971278)

[![@lock](https://avatars.githubusercontent.com/in/6672?s=40&v=4)](/apps/lock)
[lock](/apps/lock)
bot
locked as **resolved** and limited conversation to collaborators
[Jan 24, 2019](#event-2094262296)

[Sign up for free](/join?source=comment-repo)
**to subscribe to this conversation on GitHub**.
Already have an account?
[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgrpc%2Fgrpc%2Fpull%2F9833).

Reviewers

[![@ctiller](https://avatars.githubusercontent.com/u/10120821?s=40&v=4)](/ctiller) [ctiller](/ctiller)

ctiller left review comments

[![@markdroth](https://avatars.githubusercontent.com/u/18664614?s=40&v=4)](/markdroth) [markdroth](/markdroth)

markdroth approved these changes

Assignees

[![@ctiller](https://avatars.githubusercontent.com/u/10120821?s=40&v=4)](/ctiller) [ctiller](/ctiller)

[![@markdroth](https://avatars.githubusercontent.com/u/18664614?s=40&v=4)](/markdroth) [markdroth](/markdroth)

Labels

[area/core](/grpc/grpc/labels/area/core)
[cla: yes](/grpc/grpc/labels/cla%3A%20yes)
[kind/bug](/grpc/grpc/labels/kind/bug)

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

4 participants

[![@dgquintas](https://avatars.githubusercontent.com/u/120217?s=52&v=4)](/dgquintas) [![@ctiller](https://avatars.githubusercontent.com/u/10120821?s=52&v=4)](/ctiller) [![@markdroth](https://avatars.githubusercontent.com/u/18664614?s=52&v=4)](/markdroth) [![@googlebot](https://avatars.githubusercontent.com/u/5384588?s=52&v=4)](/googlebot)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


