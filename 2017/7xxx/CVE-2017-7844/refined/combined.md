=== Content from www.mozilla.org_34c98868_20250125_222902.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2017-27

## Security vulnerabilities fixed in Firefox 57.0.1

Announced
November 29, 2017
Impact
critical
Products
Firefox
Fixed in

* Firefox 57.0.1

#### [#CVE-2017-7843: Web worker in Private Browsing mode can write IndexedDB data](#CVE-2017-7843)

Reporter
Konark
Impact
high
##### Description

When Private Browsing mode is used, it is possible for a web worker to write persistent data to IndexedDB and fingerprint a user uniquely. IndexedDB should not be available in Private Browsing mode and this stored data will persist across multiple private browsing mode sessions because it is not cleared when exiting.

##### References

* [Bug 1410106](https://bugzilla.mozilla.org/show_bug.cgi?id=1410106)

#### [#CVE-2017-7844: Visited history information leak through SVG image](#CVE-2017-7844)

Reporter
Daniel Jackson
Impact
high
##### Description

A combination of an external SVG image referenced on a page and the coloring of anchor links stored within this image can be used to determine which pages a user has in their history. This can allow a malicious website to query user history.
*Note: This issue only affects Firefox 57. Earlier releases are not affected.*

##### References

* [Bug 1420001](https://bugzilla.mozilla.org/show_bug.cgi?id=1420001)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_861a7577_20250125_222900.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1420001)
* [XML](/show_bug.cgi?ctype=xml&id=1420001)

Closed
[Bug 1420001](/show_bug.cgi?id=1420001)
(CVE-2017-7844)

Opened 7 years ago
Closed 7 years ago

# History leakage through anchors in SVG in canvas tags

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

History leakage through anchors in SVG in canvas tags

## Categories

### (Core :: CSS Parsing and Computation, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=CSS%20Parsing%20and%20Computation#CSS%20Parsing%20and%20Computation)

CSS Parsing and Computation
▾

Core :: CSS Parsing and Computation

Issues with loading CSS style sheets from the network, parsing style sheets and style attributes in HTML markup, performing the CSS cascade, selector matching, and producing correct computed values for CSS properties.

Example bugs:

* toggling class name on an element does not restyle the element
* background-color property does not support hsl() values

Specifications covered:

* CSS Cascading
* CSS Conditional
* CSS Logical Properties
* CSS Namespaces
* CSS Scoping
* CSS Style Attributes
* CSS Syntax
* CSS Values
* CSS Variables
* Media Queries
* Selectors

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=CSS%20Parsing%20and%20Computation&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=CSS%20Parsing%20and%20Computation&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=CSS%20Parsing%20and%20Computation)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

57 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla59

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| thunderbird\_esr52 | --- | [unaffected](/buglist.cgi?f1=cf_status_thunderbird_esr52&o1=equals&v1=unaffected) |
| firefox-esr52 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=unaffected) |
| firefox57 | [+](/buglist.cgi?f1=cf_tracking_firefox57&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox57&o1=equals&v1=fixed) |
| firefox58 | [+](/buglist.cgi?f1=cf_tracking_firefox58&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox58&o1=equals&v1=fixed) |
| firefox59 | [+](/buglist.cgi?f1=cf_tracking_firefox59&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox59&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr52 |  | unaffected |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr52 |  | unaffected |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox57 | + | fixed |
| firefox58 | + | fixed |
| firefox59 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: email, Assigned: emilio)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/1d91d22a4892f16f744b31fd4286144e?d=mm&size=40)  [emilio](/user_profile?user_id=546716)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/06e42ccae3f40d8fc874292369ec4c21?d=mm&size=40)  [email](/user_profile?user_id=108157)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/1d91d22a4892f16f744b31fd4286144e?d=mm&size=40)  [emilio](/user_profile?user_id=546716)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

17 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1420526](/show_bug.cgi?id=1420526 "RESOLVED FIXED - Improve SVG-as-image :visited reftests to be effective at testing for :visited styles not applying")

Dependency [tree](/showdependencytree.cgi?id=1420001&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1420001)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: regression, reporter-external, sec-high, Whiteboard: [regression from stylo][adv-main57+][adv-esr52.5.1+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2017-7844

[Keywords:](/describekeywords.cgi)

[regression](/buglist.cgi?keywords=regression&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[regression from stylo][adv-main57+][adv-esr52.5.1+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a1007683_1689 "7 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [Disable :visited if the document is being used as an image.](/attachment.cgi?id=8931776)  [7 years ago](#c4)  [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)   2.13 KB, patch | dholbert : [review+](#c5 "7 years ago")  abillings : [approval-mozilla-beta+](#a273166_280903 "7 years ago")  Sylvestre : [approval-mozilla-release+](#c18 "7 years ago")  abillings : [sec-approval+](#a273166_280903 "7 years ago") | [Details](/attachment.cgi?id=8931776&action=edit) | [Diff](/attachment.cgi?id=8931776&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1420001&attachment=8931776) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Daniel Jackson](/user_profile?user_id=108157)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1420001#c0)• 7 years ago |
|  | |

User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:58.0) Gecko/20100101 Firefox/58.0
Build ID: 20171120142222
Steps to reproduce:
Demo: <http://homepages.cs.ncl.ac.uk/dan.jackson/avisited/>
...you may need to reload a couple of times to make it work.
1. Place an <a> tag for each history sniffing attempt in an external SVG document (within a 'foreignObject' tag)
2. Create an <img> that references the SVG file
3. Draws that image to a <canvas> element
4. Try one/both of:
a. look through the pixels to find the a:visited colour; or
b. save the canvas as a (PNG) Blob to see if there is a file size difference (the unvisited colour is the same as the background colour, resulting in a smaller file).
Actual results:
The page is (at least after reloading) able to determine URLs I have previously visited.
Expected results:
The page should not be able to sniff the user's browsing history.
In particular, it looks like other browsers render "a:visited" the same as "a" when drawing SVG to an image.

|  | [Kohei Yoshino](/user_profile?user_id=232883) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420001#a11972_232883)• 7 years ago |

Component: Untriaged → Document NavigationProduct: Firefox → Core

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420001#a16645_3881)• 7 years ago |

Flags: needinfo?(dholbert)Flags: needinfo?(dbaron)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1420001#c1)• 7 years ago |
|  | |

I can also reproduce by simply viewing this data URL:
data:text/html,<img src="<http://homepages.cs.ncl.ac.uk/dan.jackson/avisited/example.com.svg>">
(The text paints as red, if you've visited example.com.)
The bug stops reproducing (on the original testcase and on this ^^ data URL) if you disable layout.css.servo.enabled. So, this seems to be a regression from stylo, and hence affects 57 and later.
I'm going to mark this as security-sensitive, since this is a relatively serious privacy leakage. We might want to consider shipping this in a 57.0.x dot release, if the fix ends up being upliftable.
[Tracking Requested - why for this release]: Privacy-leakage, regression.Group: layout-core-securityStatus: UNCONFIRMED → NEW
[status-firefox57](/buglist.cgi?f1=cf_status_firefox57&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox57&o1=equals&v1=affected)
[status-firefox58](/buglist.cgi?f1=cf_status_firefox58&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox58&o1=equals&v1=affected)
[status-firefox59](/buglist.cgi?f1=cf_status_firefox59&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox59&o1=equals&v1=affected)
[tracking-firefox58](/buglist.cgi?f1=cf_tracking_firefox58&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox58&o1=equals&v1=%3F)Component: Document Navigation → CSS Parsing and ComputationEver confirmed: trueKeywords: [regression](/buglist.cgi?keywords=regression&resolution=---)Version: 58 Branch → 57 Branch

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1420001#c2)• 7 years ago |
|  | |

So this was [bug 641731](/show_bug.cgi?id=641731 "RESOLVED FIXED - SVG images should not honor :visited selectors") regressing, basically.
That bug \*did\* land with reftests -- not sure yet why they didn't catch this:
<https://dxr.mozilla.org/mozilla-central/rev/0bb0f14672fdda31c19aea1ed829e050d693b9af/layout/reftests/svg/as-image/reftest.list#192-201>
They're are supposed to be testing that visited style \*does not\* apply in an <img>, using <a href=""> inside of an image that we've previously loaded, as noted here:
<https://dxr.mozilla.org/mozilla-central/rev/0bb0f14672fdda31c19aea1ed829e050d693b9af/layout/reftests/svg/as-image/svg-image-visited-1-helper.svg#17-20>
Thoughts about why they might be failing to catch this:
- maybe there's some delay between loading the image & the history DB being updated (so we haven't yet realized that the image has been visited, by the time we load the actual testcase)
- maybe there's something special about file:// URIs (which reftests use by default) that makes this work a little differently.
- maybe we disabled history-tracking / "places" during reftests? (I'm just having a faint memory of this change happening for reftests at some point, to speed up reftest runs... That would definitely prevent these reftests from being effective.)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1420001#c3)• 7 years ago |
|  | |

The fix on [bug 641731](/show_bug.cgi?id=641731 "RESOLVED FIXED - SVG images should not honor :visited selectors") was a very small tweak to layout/style/nsCSSRuleProcessor.cpp, to the function nsCSSRuleProcessor::GetContentState -- making it check aElement->OwnerDoc()->IsBeingUsedAsImage() alongside the existing "are we in private browsing mode" check:
<https://hg.mozilla.org/mozilla-central/rev/2052ffffcb6b>
(Because we also intentionally ignore :visited rules in private browsing mode, it seems.)
It looks like the ignoring-:visited-during-private-browsing-mode feature \*does work correctly\* in Nightly, so that seems to have made it into stylo, AFAICT. Emilio/heycam, do you know where that check happens (where the nsCSSRuleProcessor::GetContentState equivalent might be in servo/stylo)? And can we add a nsIDocument::IsBeingUsedAsImage() check there?Flags: needinfo?(dholbert) → needinfo?(emilio)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420001#a148923_278074)• 7 years ago |

Flags: needinfo?(cam)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420001#a148964_278074)• 7 years ago |

Flags: needinfo?(dholbert)

|  | [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420001#a150478_546716)• 7 years ago |

Assignee: nobody → emilioFlags: needinfo?(emilio)

|  | [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1420001#c4)• 7 years ago |
|  | |

Attached patch

[Disable :visited if the document is being used as an image.](attachment.cgi?id=8931776&action=diff)
— [Details](attachment.cgi?id=8931776&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1420001&attachment=8931776)

Thanks for half-writing the patch Daniel :P
[Attachment #8931776](/attachment.cgi?id=8931776&action=edit "Disable :visited if the document is being used as an image.") -
Flags: review?(dholbert)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1420001#c5)• 7 years ago |
|  | |

Comment on [attachment 8931776](/attachment.cgi?id=8931776 "Disable :visited if the document is being used as an image.") [[details]](/attachment.cgi?id=8931776&action=edit "Disable :visited if the document is being used as an image.") [[diff]](/attachment.cgi?id=8931776&action=diff "Disable :visited if the document is being used as an image.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1420001&attachment=8931776)
Disable :visited if the document is being used as an image.
Review of [attachment 8931776](/attachment.cgi?id=8931776 "Disable :visited if the document is being used as an image.") [[details]](/attachment.cgi?id=8931776&action=edit "Disable :visited if the document is being used as an image.") [[diff]](/attachment.cgi?id=8931776&action=diff "Disable :visited if the document is being used as an image.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1420001&attachment=8931776):
-----------------------------------------------------------------
Lgtm, assuming you've tested it locally.
Sadly the commit message kinda gives away the issue, but I guess the code-change itself does too, so there's no way around that. Please request sec-approval before landing.
[Attachment #8931776](/attachment.cgi?id=8931776&action=edit "Disable :visited if the document is being used as an image.") -
Flags: review?(dholbert) → review+

|  | [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1420001#c6)• 7 years ago |
|  | |

According to <https://wiki.mozilla.org/Security/Bug_Approval_Process>, we only need to do that for sec-high / sec-crit.
This bug isn't rated, but I suspect it's not a critical vulnerability of any sort. Do you really think this needs sec-approval to land?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1420001#c7)• 7 years ago |
|  | |

Do we need some sort of follow-up bug for investigating why reftests didn't catch this issue?

|  | [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1420001#c8)• 7 years ago |
|  | |

(In reply to (PTO - Back 27-Nov) Ryan VanderMeulen [:RyanVM] from [comment #7](/show_bug.cgi?id=1420001#c7 "RESOLVED FIXED - History leakage through anchors in SVG in canvas tags"))
> Do we need some sort of follow-up bug for investigating why reftests didn't
> catch this issue?
Yeah, definitely. Though I suspect the answer is "async link coloring", the same reason tons of :visited reftests are flakes.

|  | [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1420001#c9)• 7 years ago |
|  | |

Ok, talked with Daniel, he thinks differently, I'm requesting approval + uplift to branches.

|  | [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1420001#c10)• 7 years ago |
|  | |

Comment on [attachment 8931776](/attachment.cgi?id=8931776 "Disable :visited if the document is being used as an image.") [[details]](/attachment.cgi?id=8931776&action=edit "Disable :visited if the document is being used as an image.") [[diff]](/attachment.cgi?id=8931776&action=diff "Disable :visited if the document is being used as an image.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1420001&attachment=8931776)
Disable :visited if the document is being used as an image.
Approval Request Comment
[Feature/Bug causing the regression]: Stylo
[User impact if declined]: Trivial user history query, so pretty high impact. Allows any website to trivially query your user history.
[Is this code covered by automated tests?]: yes, but in practice they didn't catch the issue, so I guess the answer is "not really".
[Has the fix been verified in Nightly?]: no
[Needs manual test from QE? If yes, steps to reproduce]: yes, see [comment 0](/show_bug.cgi?id=1420001#c0 "RESOLVED FIXED - History leakage through anchors in SVG in canvas tags").
[List of other uplifts needed for the feature/fix]: none
[Is the change risky?]: not risky
[Why is the change risky/not risky?]: reuses an existing mechanism which was just missing a condition.
[String changes made/needed]: none
[Security approval request comment]
How easily could an exploit be constructed based on the patch?
Probably relatively easily.
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?
Not comments, but the patch itself is pretty self-explanatory.
Which older supported branches are affected by this flaw?
57+
If not all supported branches, which bug introduced the flaw?
Stylo
Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?
No, but they should apply cleanly.
How likely is this patch to cause regressions; how much testing does it need?
Not much, it uses an already-existing mechanism, so the patch is quite simple.
[Attachment #8931776](/attachment.cgi?id=8931776&action=edit "Disable :visited if the document is being used as an image.") -
Flags: sec-approval?
[Attachment #8931776](/attachment.cgi?id=8931776&action=edit "Disable :visited if the document is being used as an image.") -
Flags: approval-mozilla-beta?

|  | [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1420001#c11)• 7 years ago |
|  | |

Comment on [attachment 8931776](/attachment.cgi?id=8931776 "Disable :visited if the document is being used as an image.") [[details]](/attachment.cgi?id=8931776&action=edit "Disable :visited if the document is being used as an image.") [[diff]](/attachment.cgi?id=8931776&action=diff "Disable :visited if the document is being used as an image.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1420001&attachment=8931776)
Disable :visited if the document is being used as an image.
See the comment above for the approval request.
[Attachment #8931776](/attachment.cgi?id=8931776&action=edit "Disable :visited if the document is being used as an image.") -
Flags: approval-mozilla-release?

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420001#a161323_278074)• 7 years ago |

Blocks: [1420526](/show_bug.cgi?id=1420526 "RESOLVED FIXED - Improve SVG-as-image :visited reftests to be effective at testing for :visited styles not applying")

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1420001#c12)• 7 years ago |
|  | |

Thanks! Answering some questions/thoughts:
(In reply to Emilio Cobos Álvarez [:emilio] from [comment #6](/show_bug.cgi?id=1420001#c6 "RESOLVED FIXED - History leakage through anchors in SVG in canvas tags"))
> According to <https://wiki.mozilla.org/Security/Bug_Approval_Process>, we only
> need to do that for sec-high / sec-crit.-approval to land?
I think it's at least sec-high; CC'ing dveditz and abillings for their thoughts. I'll tag it as sec-high for now, since it enables trivial history-stealing which we've tried to make hard ever since [bug 147777](/show_bug.cgi?id=147777 "RESOLVED FIXED - :visited support allows queries into global history"). Also noting that esr52 is unaffected (so no uplift needed there), since this is effectively a regression from stylo.
(In reply to Emilio Cobos Álvarez [:emilio] from [comment #8](/show_bug.cgi?id=1420001#c8 "RESOLVED FIXED - History leakage through anchors in SVG in canvas tags"))
> (In reply to (PTO - Back 27-Nov) Ryan VanderMeulen [:RyanVM] from [comment #7](/show_bug.cgi?id=1420001#c7 "RESOLVED FIXED - History leakage through anchors in SVG in canvas tags"))
> > Do we need some sort of follow-up bug for investigating why reftests didn't
> > catch this issue?
>
> Yeah, definitely. Though I suspect the answer is "async link coloring"
(See also [comment 2](/show_bug.cgi?id=1420001#c2 "RESOLVED FIXED - History leakage through anchors in SVG in canvas tags") - IIRC we turned off places for reftest runs at some point, and that sped up reftests but also inadvertantly kneecapped the reftests that were supposed to be testing this feature. We do also have this mochitest, though, and we probably need to morph the reftests such that they're run as part of that mochitest: <https://dxr.mozilla.org/mozilla-central/source/layout/style/test/test_visited_reftests.html> )
I filed [bug 1420526](/show_bug.cgi?id=1420526 "RESOLVED FIXED - Improve SVG-as-image :visited reftests to be effective at testing for :visited styles not applying") to get this effectively tested again, anyway.
[status-firefox-esr52](/buglist.cgi?f1=cf_status_firefox_esr52&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=unaffected)
[status-thunderbird\_esr52](/buglist.cgi?f1=cf_status_thunderbird_esr52&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_thunderbird_esr52&o1=equals&v1=unaffected)Flags: needinfo?(dholbert)Flags: needinfo?(dbaron)Flags: needinfo?(cam)Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)Whiteboard: [regression from stylo]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1420001#c13)• 7 years ago |
|  | |

This seems sec-high to me.
sec-approval+ for trunk. I'll approve for beta as well.
[status-firefox57](/buglist.cgi?f1=cf_status_firefox57&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox57&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox57&o1=equals&v1=wontfix)
[tracking-firefox58](/buglist.cgi?f1=cf_tracking_firefox58&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox58&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox58&o1=equals&v1=%2B)
[tracking-firefox59](/buglist.cgi?f1=cf_tracking_firefox59&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox59&o1=equals&v1=%2B)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420001#a273166_280903)• 7 years ago |

[Attachment #8931776](/attachment.cgi?id=8931776&action=edit "Disable :visited if the document is being used as an image.") -
Flags: sec-approval?
[Attachment #8931776](/attachment.cgi?id=8931776&action=edit "Disable :visited if the document is being used as an image.") -
Flags: sec-approval+
[Attachment #8931776](/attachment.cgi?id=8931776&action=edit "Disable :visited if the document is being used as an image.") -
Flags: approval-mozilla-beta?
[Attachment #8931776](/attachment.cgi?id=8931776&action=edit "Disable :visited if the document is being used as an image.") -
Flags: approval-mozilla-beta+

|  | [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1420001#c14)• 7 years ago |
|  | |

<https://github.com/servo/servo/pull/19398>

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1420001#c15)• 7 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/d1599028c579>
[status-firefox58](/buglist.cgi?f1=cf_status_firefox58&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox58&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox58&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1420001#c16)• 7 years ago |
|  | |

This was merged to m-c as well.
<https://hg.mozilla.org/mozilla-central/rev/ed1802f246cb>Status: NEW → RESOLVEDClosed: 7 years ago
[status-firefox59](/buglist.cgi?f1=cf_status_firefox59&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox59&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox59&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla59

|  | [Erin Lancaster [:elan]](/user_profile?user_id=423519) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420001#a488219_423519)• 7 years ago |

Flags: needinfo?(rkothari)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420001#a488892_280903)• 7 years ago |

[status-firefox57](/buglist.cgi?f1=cf_status_firefox57&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox57&o1=equals&v1=wontfix) → [affected](/buglist.cgi?f1=cf_status_firefox57&o1=equals&v1=affected)
[tracking-firefox57](/buglist.cgi?f1=cf_tracking_firefox57&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox57&o1=equals&v1=%2B)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420001#a498525_280903)• 7 years ago |

Alias: CVE-2017-7844Whiteboard: [regression from stylo] → [regression from stylo][adv-main57+][adv-esr52.5.1+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1420001#c17)• 7 years ago |
|  | |

This is going into 57.0.1 today, right?Flags: needinfo?(sledru)

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1420001#c18)• 7 years ago |
|  | |

Comment on [attachment 8931776](/attachment.cgi?id=8931776 "Disable :visited if the document is being used as an image.") [[details]](/attachment.cgi?id=8931776&action=edit "Disable :visited if the document is being used as an image.") [[diff]](/attachment.cgi?id=8931776&action=diff "Disable :visited if the document is being used as an image.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1420001&attachment=8931776)
Disable :visited if the document is being used as an image.
Approved, thanksFlags: needinfo?(sledru)
[Attachment #8931776](/attachment.cgi?id=8931776&action=edit "Disable :visited if the document is being used as an image.") -
Flags: approval-mozilla-release? → approval-mozilla-release+

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420001#a499091_495955)• 7 years ago |

Flags: needinfo?(rkothari)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1420001#c19)• 7 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-release/rev/83885c5b00ed4947579565a404e252bc7e077cb3>
[status-firefox57](/buglist.cgi?f1=cf_status_firefox57&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox57&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox57&o1=equals&v1=fixed)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420001#a594036_1689)• 7 years ago |

Group: layout-core-security → core-security-release

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420001#a638865_428608)• 7 years ago |

Flags: sec-bounty?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420001#a1007683_1689)• 7 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1420001#c20)• 7 years ago |
|  | |

Dan, am I OK to land some test-patches for this bug, to get this bug tested? (Test patches are over on [bug 1420526](/show_bug.cgi?id=1420526 "RESOLVED FIXED - Improve SVG-as-image :visited reftests to be effective at testing for :visited styles not applying").)
I wanted to double-check before landing, since this bug is still closed, and IIRC typically we don't land automated tests until bugs are ready to open up. (But in this case, I think it should be fine because the test-patch doesn't reveal much to a hypothetical attacker beyond what they can already find out. The test patch is mostly shifting some already-existing tests from one test harness to another, to make them actually functional, per end of [comment 12](/show_bug.cgi?id=1420001#c12 "RESOLVED FIXED - History leakage through anchors in SVG in canvas tags"). I'm also adjusting the tests to make them more robust in our harness, but that's not super relevant to an attacker.Flags: needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1420001#c21)• 7 years ago |
|  | |

Yes, it's fine to land those tests now. For a crash testcase I'd want to wait for more uptake of the fix first but that doesn't apply in this case.Flags: needinfo?(dveditz)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1420001#c22)• 7 years ago |
|  | |

Thanks! Just landed on inbound.

|  | [Diane Hosfelt](/user_profile?user_id=575751) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1420001#c23)• 6 years ago |
|  | |

Does this still need to be restricted?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420001#a24117074_1689)• 6 years ago |

Group: core-security-release

|  | [Eddy Petrișor](/user_profile?user_id=645663) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1420001#c24)• 5 years ago |
|  | |

(In reply to Daniel Holbert [:dholbert] (AFK Aug 23-25) from [comment #1](/show_bug.cgi?id=1420001#c1 "RESOLVED FIXED - History leakage through anchors in SVG in canvas tags"))

> I can also reproduce by simply viewing this data URL:
>
> data:text/html,<img
>
> src="[http://homepages.cs.ncl.ac.uk/dan.jackson/avisited/example.com.svg">](http://homepages.cs.ncl.ac.uk/dan.jackson/avisited/example.com.svg%22%3E)
>
> (The text paints as red, if you've visited example.com.)
>
> The bug stops reproducing (on the original testcase and on this ^^ data URL)
>
> if you disable layout.css.servo.enabled. So, this seems to be a regression
>
> from stylo, and hence affects 57 and later.
>
> I'm going to mark this as security-sensitive, since this is a relatively
>
> serious privacy leakage. We might want to consider shipping this in a
>
> 57.0.x dot release, if the fix ends up being upliftable.
>
> [Tracking Requested - why for this release]: Privacy-leakage, regression.

Is the test link above valid for this bug? Because I can see it (the red link to example) both on 68.0.2 (64-bit) and on nightly 70.0a1 (2019-08-22) (64 de biți) on Windows 10, while the first (<http://homepages.cs.ncl.ac.uk/dan.jackson/avisited/>) looks correct - no visited rendering for either of the links.

Flags: needinfo?(emilio)

|  | [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1420001#c25)• 5 years ago |
|  | |

Can you clarify? You can see it if you go directly to `http://homepages.cs.ncl.ac.uk/dan.jackson/avisited/example.com.svg`, right? But not if you go to `data:text/html,<img src="http://homepages.cs.ncl.ac.uk/dan.jackson/avisited/example.com.svg">`.

If so that's working as expected.

Flags: needinfo?(emilio)

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420001#a205683034_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1420001&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_71e16fe6_20250126_122648.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1410106)
* [XML](/show_bug.cgi?ctype=xml&id=1410106)

Closed
[Bug 1410106](/show_bug.cgi?id=1410106)
(CVE-2017-7843)

Opened 7 years ago
Closed 7 years ago

# fingerprinting users in private window using web-worker + indexedDB

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

fingerprinting users in private window using web-worker + indexedDB

## Categories

### (Firefox :: Private Browsing, defect)

[Product:](/describecomponents.cgi?product=Firefox)

Firefox
▾

Firefox
For bugs in Firefox Desktop, the Mozilla Foundation's web browser. For Firefox user interface issues in menus, bookmarks, location bar, and preferences. Many Firefox bugs will either be filed here or in the [Core](https://bugzilla.mozilla.org/describecomponents.cgi?product=Core) product. Bugs for developer tools (F12) should be filed in the [DevTools](https://bugzilla.mozilla.org/describecomponents.cgi?product=DevTools) product. ([more info](https://wiki.mozilla.org/Modules/All#Firefox))
[See Open Bugs in This Product](/buglist.cgi?product=Firefox&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Firefox)
Watch This Product

[Component:](/describecomponents.cgi?product=Firefox&component=Private%20Browsing#Private%20Browsing)

Private Browsing
▾

Firefox :: Private Browsing
For bugs and feature requests in Firefox's Private Browsing implementation.
[See Open Bugs in This Component](/buglist.cgi?product=Firefox&component=Private%20Browsing&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Firefox&component=Private%20Browsing&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Firefox&component=Private%20Browsing)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

56 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

Firefox 58

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr52 | [57+](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=57%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=fixed) |
| firefox56 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox56&o1=equals&v1=wontfix) |
| firefox57 | [+](/buglist.cgi?f1=cf_tracking_firefox57&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox57&o1=equals&v1=fixed) |
| firefox58 | [+](/buglist.cgi?f1=cf_tracking_firefox58&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox58&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| firefox-esr52 | 57+ | fixed |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox56 |  | wontfix |
| firefox57 | + | fixed |
| firefox58 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: modi.konark, Assigned: asuth)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/75b1e0d00a677e73b24efe34917fa1e9?d=mm&size=40)  [asuth](/user_profile?user_id=151407)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/018d536a2c248ac5fc6d451764986c0d?d=mm&size=40)  [modi.konark](/user_profile?user_id=473831)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/9c043b04a6702f66940ab8ea398e08a3?d=mm&size=40)  [timhuang](/user_profile?user_id=547199)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

28 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[IndexedDB-on-PBackground](/show_bug.cgi?id=994190 "RESOLVED FIXED - Modify main-thread IndexedDB to use PBackground")

[1455985](/show_bug.cgi?id=1455985 "RESOLVED FIXED - Add Private Browsing tests")

Dependency [tree](/showdependencytree.cgi?id=1410106&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1410106)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [fingerprinting][adv-main57+][adv-esr52.5.1])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2017-7843

[Keywords:](/describekeywords.cgi)

[csectype-disclosure](/buglist.cgi?keywords=csectype-disclosure&resolution=---),
[privacy](/buglist.cgi?keywords=privacy&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[fingerprinting][adv-main57+][adv-esr52.5.1]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a9431392_1689 "7 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [avaida](/user_profile?user_id=488993) | [qe-verify](#c42 "7 years ago") | - |
| --- | --- | --- |
| [avaida](/user_profile?user_id=488993) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | blocking-fx-sync1.7 | ? |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [idb.patch](/attachment.cgi?id=8925587)  [7 years ago](#c12)  [Andrea Marchesini [:baku]](/user_profile?user_id=446257)   3.85 KB, patch | asuth : [review+](#c14 "7 years ago")  ritu : [approval-mozilla-release+](#c38 "7 years ago")  lizzard : [approval-mozilla-esr52+](#c39 "7 years ago")  abillings : [sec-approval+](#a1685014_280903 "7 years ago") | [Details](/attachment.cgi?id=8925587&action=edit) | [Diff](/attachment.cgi?id=8925587&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1410106&attachment=8925587) |
| --- | --- | --- |
| [browser test of IndexedDB open calls in window/dedicatedworker/sharedworker in normal and PB windows](/attachment.cgi?id=8925768)  [7 years ago](#c20)  [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)   6.36 KB, patch | janv : [review+](#c21 "7 years ago") | [Details](/attachment.cgi?id=8925768&action=edit) | [Diff](/attachment.cgi?id=8925768&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1410106&attachment=8925768) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Konark Modi - @konarkmodi](/user_profile?user_id=473831)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1410106#c0)• 7 years ago |
|  | |

User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10\_12\_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.62 Safari/537.36
Steps to reproduce:
It's possible to fingerprint users in private window by first-party and third-party scripts
1. Can be tracked even after browser restarts.
2. Can be tracked even after user clears Everything. (history / cookies / offline data )
Demo:
1. Visit the test page in normal window and private window:
<https://cdn.cliqz.com/browser-f/fun-demo/test-webworker-indexed-db.html>
It increments visit count, from inside the web-worker and on the page. Both using indexedDB as the storage.
Visit count this point should be 1. Meaning new unique visit.
2. Now restart the browser and visit the page again in both normal and private window.
It increments the counter to 2. Which means private-window behaviour is not as intended. The expectation is that the user is still treated as a new user.
Repeat the steps after selecting clearing everything in `clear recent history`, the counter still increments.
Actual results:
This is a serious bug, as it can be exploited for moving tracking from cookies to web-workers + indexedDB and have a persistent UUID. Which makes it possible to track a user irrespective of private window, across websites.
Also, as per the MDN documentation and this bug: [https://bugzilla.mozilla.org/show\_bug.cgi?id=781982](/show_bug.cgi?id=781982 "RESOLVED DUPLICATE - IndexedDB does not function in private browsing mode") , private window should not have access to IndexedDB but as demonstrated web workers are able to use IndexedDB
Expected results:
1. Private window should not have access to IndexedDB even via web workers.
2. IndexedDB state should be cleaned after closing private window.
Although if the user has disabled `always` accept third-party cookies, the attack is only possible as a first-party, but even then I think private window should not allow tracking even from a first-party perspective.
Should also respect clear history / cookies / storage signal

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1410106#c1)• 7 years ago |
|  | |

Either I'm not understanding the steps or I can't reproduce this on Nightly (58).Component: Untriaged → Private Browsing

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1410106#c2)• 7 years ago |
|  | |

(In reply to Konark from [comment #0](/show_bug.cgi?id=1410106#c0 "RESOLVED FIXED - fingerprinting users in private window using web-worker + indexedDB"))
> Repeat the steps after selecting clearing everything in `clear recent
> history`, the counter still increments.
That's currently expected (other bugs filed) because IndexedDB isn't cleared based on time, only if you "forget about this site".
Matt can reproduce the PB IndexedDB persisting across a restart.Keywords: [csectype-disclosure](/buglist.cgi?keywords=csectype-disclosure&resolution=---),
[privacy](/buglist.cgi?keywords=privacy&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)Whiteboard: [fingerprinting]

|  | [Konark Modi - @konarkmodi](/user_profile?user_id=473831)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1410106#c3)• 7 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #1](/show_bug.cgi?id=1410106#c1 "RESOLVED FIXED - fingerprinting users in private window using web-worker + indexedDB"))
> Either I'm not understanding the steps or I can't reproduce this on Nightly
> (58).
I tested the steps on Nighty 58 now, and it's reproducible. It does not work, if you user sets third-party cookie settings changed to `from visited` or `never`. However, even in that case loading as first party should work.
Let me know, if I should improve the steps to reproduce.

|  | [Konark Modi - @konarkmodi](/user_profile?user_id=473831)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1410106#c4)• 7 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #2](/show_bug.cgi?id=1410106#c2 "RESOLVED FIXED - fingerprinting users in private window using web-worker + indexedDB"))
> (In reply to Konark from [comment #0](/show_bug.cgi?id=1410106#c0 "RESOLVED FIXED - fingerprinting users in private window using web-worker + indexedDB"))
> > Repeat the steps after selecting clearing everything in `clear recent
> > history`, the counter still increments.
>
> That's currently expected (other bugs filed) because IndexedDB isn't cleared
> based on time, only if you "forget about this site".
>
As far as I checked, `Forget about this site` does not completely mitigate this attack. My understanding is the following:
1. There is no way to forget about a site that the user visits in PB? Assuming the user never visited that site as a first party in normal mode.
2. AFAIK, "Forget about this site", does not have an option to forget about a third-party site which can track a user, since most likely the user never visited it. If a third-party is using the above exploit, then would be interesting to see, how to delete the indexedDB for that.
> Matt can reproduce the PB IndexedDB persisting across a restart.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1410106#c5)• 7 years ago |
|  | |

(In reply to Konark from [comment #3](/show_bug.cgi?id=1410106#c3 "RESOLVED FIXED - fingerprinting users in private window using web-worker + indexedDB"))
> It does not work, if you user sets third-party cookie settings changed to `from visited` or `never`.
Thanks-- that was my problem.
(In reply to Konark from [comment #4](/show_bug.cgi?id=1410106#c4 "RESOLVED FIXED - fingerprinting users in private window using web-worker + indexedDB"))
> 1. There is no way to forget about a site that the user visits in PB?
Yes, because the assumption is that when you close the session we forget everything. Not doing that for IndexedDB is a major failing. I also find it surprising because I know we have tested this and I would hope we have automated tests to ensure it.

|  | [Christiane Ruetten [INACTIVE]](/user_profile?user_id=465475) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1410106#c6)• 7 years ago |
|  | |

I'm surprised to hear that PB is writing site-specific data to the profile at all. Once it's in the file system's blocks, it's out of control and will never really go away again.

|  | [Konark Modi - @konarkmodi](/user_profile?user_id=473831)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1410106#c7)• 7 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #5](/show_bug.cgi?id=1410106#c5 "RESOLVED FIXED - fingerprinting users in private window using web-worker + indexedDB"))
> (In reply to Konark from [comment #3](/show_bug.cgi?id=1410106#c3 "RESOLVED FIXED - fingerprinting users in private window using web-worker + indexedDB"))
> > It does not work, if you user sets third-party cookie settings changed to `from visited` or `never`.
>
> Thanks-- that was my problem.
But because first-party can also access indexedDB in PB via workers, it should also work without changing the settings for third party cookies.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1410106#c8)• 7 years ago |
|  | |

Andrew: assigned this to you because I don't know how long Ehsan will be "away". You could also talk to Wennie about whether :groovecoder would be an appropriate assignee as he's trying to learn this area.Assignee: nobody → overholt

|  | [Andrew Overholt [:overholt]](/user_profile?user_id=442218) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1410106#c9)• 7 years ago |
|  | |

I heard Luke is interested in working on this.Assignee: overholt → lcrouch

|  | [Luke Crouch [:groovecoder]](/user_profile?user_id=403306) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1410106#c10)• 7 years ago |
|  | |

Yeah, I'll jump into it. Will plan to get fixed for 58, so if I don't have a fix this week I'll ping back here to get some extra help next week.

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1410106#c11)• 7 years ago |
|  | |

Tracking for 58. It is pretty late to get a fix in 57 but not impossible.
[status-firefox57](/buglist.cgi?f1=cf_status_firefox57&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_firefox57&o1=equals&v1=%3F)
[status-firefox58](/buglist.cgi?f1=cf_status_firefox58&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox58&o1=equals&v1=affected)
[tracking-firefox58](/buglist.cgi?f1=cf_tracking_firefox58&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox58&o1=equals&v1=%2B)

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1410106#c12)• 7 years ago |
|  | |

Attached patch

[idb.patch](attachment.cgi?id=8925587&action=diff)
— [Details](attachment.cgi?id=8925587&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1410106&attachment=8925587)

[Attachment #8925587](/attachment.cgi?id=8925587&action=edit "idb.patch") -
Flags: review?(jvarga)
[Attachment #8925587](/attachment.cgi?id=8925587&action=edit "idb.patch") -
Flags: feedback?

|  | [Jan Varga [:janv]](/user_profile?user_id=8340) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1410106#c13)• 7 years ago |
|  | |

Comment on [attachment 8925587](/attachment.cgi?id=8925587 "idb.patch") [[details]](/attachment.cgi?id=8925587&action=edit "idb.patch") [[diff]](/attachment.cgi?id=8925587&action=diff "idb.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1410106&attachment=8925587)
idb.patch
I think Andrew has better knowledge of the private browsing flags.
[Attachment #8925587](/attachment.cgi?id=8925587&action=edit "idb.patch") -
Flags: review?(jvarga) → review?(bugmail)

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1410106#c14)• 7 years ago |
|  | |

Comment on [attachment 8925587](/attachment.cgi?id=8925587 "idb.patch") [[details]](/attachment.cgi?id=8925587&action=edit "idb.patch") [[diff]](/attachment.cgi?id=8925587&action=diff "idb.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1410106&attachment=8925587)
idb.patch
Review of [attachment 8925587](/attachment.cgi?id=8925587 "idb.patch") [[details]](/attachment.cgi?id=8925587&action=edit "idb.patch") [[diff]](/attachment.cgi?id=8925587&action=diff "idb.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1410106&attachment=8925587):
-----------------------------------------------------------------
Ugh, yeah, when recently looking at this code very recently I was worried about this exact situation and had a to-do to attempt to repro.
In terms of uplift we \*ABSOLUTELY\* need this on 57.
Restating the problem:
- Under the existing code, IDBFactory:mPrivateBrowsingMode is the source of authority for whether to treat the context as in private browsing mode. This is separately tracked from the OriginAttributes because of the annoying invariant that a system-principaled docshell can be in private browsing mode, but it will not have the OriginAttribute set, because we can't mutate the singleton system principal.
- IDBFactory::CreateForWindow propagates mPrivateBrowsingMode correctly.
- IDBFactory::CreateForWindow does not.
Restating the solution:
- Stop propagating the private browsing mode separately from the OriginAttribute.
- Rely on the OriginAttribute
The one minor wrinkle in this is the aforementioned "I'm a system-principaled private browsing docshell and I naively attempt to use IDB and the only thing stopping me from logging private browsing data is the existing check." I don't think code is doing this right now because of the assertion at <http://searchfox.org/mozilla-central/rev/5a60492a53667fc61a62af1847d005a210b7a4f6/dom/indexedDB/IDBFactory.cpp#625> but I think we do want to have a guard that ensures that in the system-principal case, if nsILoadContext::UsePrivateBrowsing() is true, we either early fail or explicitly crash.
[Attachment #8925587](/attachment.cgi?id=8925587&action=edit "idb.patch") -
Flags: review?(bugmail)
[Attachment #8925587](/attachment.cgi?id=8925587&action=edit "idb.patch") -
Flags: review+
[Attachment #8925587](/attachment.cgi?id=8925587&action=edit "idb.patch") -
Flags: feedback?

|  | [Georg Koppen](/user_profile?user_id=349211) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1410106#c15)• 7 years ago |
|  | |

One interesting thing we found is that some users are hitting crashes reliably due to this bug in our ESR 52-based Tor Browser:
#0 mozilla::dom::quota::QuotaObject::DisableQuotaCheck (this=0x0)
at /home/debian/build/tor-browser/dom/quota/ActorsParent.cpp:2714
#1 0x00007ffff39cf5ad in mozilla::dom::indexedDB::(anonymous namespace)::DatabaseConnection::DisableQuotaChecks (
this=0x7fffcac91580) at /home/debian/build/tor-browser/dom/indexedDB/ActorsParent.cpp:11355
#2 mozilla::dom::indexedDB::(anonymous namespace)::Database::StartTransactionOp::DoDatabaseWork (this=0x7fffcac79040,
aConnection=0x7fffcac91580) at /home/debian/build/tor-browser/dom/indexedDB/ActorsParent.cpp:14927
#3 0x00007ffff39cf10e in mozilla::dom::indexedDB::(anonymous namespace)::TransactionDatabaseOperationBase::RunOnConnectionThread (this=this@entry=0x7fffcac79040) at /home/debian/build/tor-browser/dom/indexedDB/ActorsParent.cpp:23735
#4 0x00007ffff39cf28a in mozilla::dom::indexedDB::(anonymous namespace)::Database::StartTransactionOp::RunOnConnectionThread
(this=0x7fffcac79040) at /home/debian/build/tor-browser/dom/indexedDB/ActorsParent.cpp:14914
#5 0x00007ffff39c71b4 in mozilla::dom::indexedDB::(anonymous namespace)::TransactionDatabaseOperationBase::Run (
this=0x7fffcac79040) at /home/debian/build/tor-browser/dom/indexedDB/ActorsParent.cpp:23906
#6 0x00007ffff28ca7b1 in nsThread::ProcessNextEvent (this=0x7fffcc480590, aMayWait=<optimized out>, aResult=0x7fffc1888ccf)
at /home/debian/build/tor-browser/xpcom/threads/nsThread.cpp:1216
#7 0x00007ffff28e53b5 in NS\_ProcessNextEvent (aThread=<optimized out>, aThread@entry=0x7fffcc480590,
aMayWait=aMayWait@entry=true) at /home/debian/build/tor-browser/xpcom/glue/nsThreadUtils.cpp:361
#8 0x00007ffff39b9e55 in mozilla::dom::indexedDB::(anonymous namespace)::ConnectionPool::ThreadRunnable::Run (
this=0x7fffcc0aaca0) at /home/debian/build/tor-browser/dom/indexedDB/ActorsParent.cpp:13539
#9 0x00007ffff28ca7b1 in nsThread::ProcessNextEvent (this=0x7fffcc480590, aMayWait=<optimized out>, aResult=0x7fffc1888dff)
at /home/debian/build/tor-browser/xpcom/threads/nsThread.cpp:1216
#10 0x00007ffff28e53b5 in NS\_ProcessNextEvent (aThread=<optimized out>, aThread@entry=0x7fffcc480590,
aMayWait=aMayWait@entry=false) at /home/debian/build/tor-browser/xpcom/glue/nsThreadUtils.cpp:361
#11 0x00007ffff2bb0f81 in mozilla::ipc::MessagePumpForNonMainThreads::Run (this=0x7fffcc4085c0, aDelegate=0x7fffc70b9d50)
at /home/debian/build/tor-browser/ipc/glue/MessagePump.cpp:338
#12 0x00007ffff2b81b1c in MessageLoop::RunHandler (this=<optimized out>)
at /home/debian/build/tor-browser/ipc/chromium/src/base/message\_loop.cc:225
#13 MessageLoop::Run (this=this@entry=0x7fffc70b9d50)
at /home/debian/build/tor-browser/ipc/chromium/src/base/message\_loop.cc:205
#14 0x00007ffff28c953f in nsThread::ThreadFunc (aArg=0x7fffcc480590)
at /home/debian/build/tor-browser/xpcom/threads/nsThread.cpp:467
#15 0x00007ffff7f96ec7 in \_pt\_root (arg=0x7fffcc0630c0)
at /home/debian/build/tor-browser/nsprpub/pr/src/pthreads/ptthread.c:216
#16 0x00007ffff7bc3494 in start\_thread (arg=0x7fffc1889700) at pthread\_create.c:333
#17 0x00007ffff6c51abf in clone () at ../sysdeps/unix/sysv/linux/x86\_64/clone.S:97
The crash does not happen if they are not in Private Browsing Mode (PBM). I have not debugged this problem but I guess the code is not tested for this particular case (as everyone was assuming IndexedDB is off in PBM anyway).
I guess this would go away with the proposed patch, right?

|  | [Georg Koppen](/user_profile?user_id=349211) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1410106#c16)• 7 years ago |
|  | |

For more details about the crashing and steps to reproduce see: <https://trac.torproject.org/projects/tor/ticket/24040>

|  | [Luke Crouch [:groovecoder]](/user_profile?user_id=403306) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1410106#c17)• 7 years ago |
|  | |

I did a quick hg import of this patch, then mach build and mach run. But I still see the same error/behavior as [comment #0](/show_bug.cgi?id=1410106#c0 "RESOLVED FIXED - fingerprinting users in private window using web-worker + indexedDB")?

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1410106#c18)• 7 years ago |
|  | |

Comment on [attachment 8925587](/attachment.cgi?id=8925587 "idb.patch") [[details]](/attachment.cgi?id=8925587&action=edit "idb.patch") [[diff]](/attachment.cgi?id=8925587&action=diff "idb.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1410106&attachment=8925587)
idb.patch
[Security approval request comment]
How easily could an exploit be constructed based on the patch?
It's not about exploiting this bug, it's about using IDB in workers in privateBrowsing mode.
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?
No. Just a generic PrincipalInfo.attrs() check.
Which older supported branches are affected by this flaw?
All.
If not all supported branches, which bug introduced the flaw?
[Bug 994190](/show_bug.cgi?id=994190 "RESOLVED FIXED - Modify main-thread IndexedDB to use PBackground")
Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?
Not too complex.
How likely is this patch to cause regressions; how much testing does it need?
low. The bug was introduced by a 'temporary' TODO if-statement.
[Attachment #8925587](/attachment.cgi?id=8925587&action=edit "idb.patch") -
Flags: sec-approval?

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1410106#c19)• 7 years ago |
|  | |

(In reply to Luke Crouch [:groovecoder] from [comment #17](/show_bug.cgi?id=1410106#c17 "RESOLVED FIXED - fingerprinting users in private window using web-worker + indexedDB"))
> I did a quick hg import of this patch, then mach build and mach run. But I
> still see the same error/behavior as [comment #0](/show_bug.cgi?id=1410106#c0 "RESOLVED FIXED - fingerprinting users in private window using web-worker + indexedDB")?
<https://treeherder.mozilla.org/#/jobs?repo=try&revision=a3f8f2017d7494f0c733f71e2c8b0b928b181433>
I pushed to try. Can you check it again with this build? Locally it works correctly.

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1410106#c20)• 7 years ago |
|  | |

Attached patch

[browser test of IndexedDB open calls in window/dedicatedworker/sharedworker in normal and PB windows](attachment.cgi?id=8925768&action=diff)
— [Details](attachment.cgi?id=8925768&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1410106&attachment=8925768)

Here's a test that passes for me with :baku's fix and fails for me without :baku's fix applied.
These are what the failures look like WITHOUT the patch applied:
The following tests failed:
24 INFO TEST-UNEXPECTED-FAIL | dom/indexedDB/test/browser\_private\_idb.js | IndexedDB does not work in a private-browsing Worker. - Got created, expected error
Stack trace:
chrome://mochikit/content/browser-test.js:test\_is:1010
chrome://mochitests/content/browser/dom/indexedDB/test/browser\_private\_idb.js:null:147
25 INFO TEST-UNEXPECTED-FAIL | dom/indexedDB/test/browser\_private\_idb.js | IndexedDB does not work in a private-browsing SharedWorker. - Got created, expected error
We of course \*do not\* want to land the tests concurrently with the bug because they make the problem super obvious. That said, there's not much doubt about the fix patch patching a hole in something related to private browsing and IDB.
[Attachment #8925768](/attachment.cgi?id=8925768&action=edit "browser test of IndexedDB open calls in window/dedicatedworker/sharedworker in normal and PB windows") -
Flags: review?(jvarga)

|  | [Jan Varga [:janv]](/user_profile?user_id=8340) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1410106#c21)• 7 years ago |
|  | |

Comment on [attachment 8925768](/attachment.cgi?id=8925768 "browser test of IndexedDB open calls in window/dedicatedworker/sharedworker in normal and PB windows") [[details]](/attachment.cgi?id=8925768&action=edit "browser test of IndexedDB open calls in window/dedicatedworker/sharedworker in normal and PB windows") [[diff]](/attachment.cgi?id=8925768&action=diff "browser test of IndexedDB open calls in window/dedicatedworker/sharedworker in normal and PB windows") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1410106&attachment=8925768)
browser test of IndexedDB open calls in window/dedicatedworker/sharedworker in normal and PB windows
Review of [attachment 8925768](/attachment.cgi?id=8925768 "browser test of IndexedDB open calls in window/dedicatedworker/sharedworker in normal and PB windows") [[details]](/attachment.cgi?id=8925768&action=edit "browser test of IndexedDB open calls in window/dedicatedworker/sharedworker in normal and PB windows") [[diff]](/attachment.cgi?id=8925768&action=diff "browser test of IndexedDB open calls in window/dedicatedworker/sharedworker in normal and PB windows") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1410106&attachment=8925768):
-----------------------------------------------------------------
Nice, thanks.
[Attachment #8925768](/attachment.cgi?id=8925768&action=edit "browser test of IndexedDB open calls in window/dedicatedworker/sharedworker in normal and PB windows") -
Flags: review?(jvarga) → review+

|  | [Luke Crouch [:groovecoder]](/user_profile?user_id=403306) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1410106#c22)• 7 years ago |
|  | |

(In reply to Andrea Marchesini [:baku] from [comment #19](/show_bug.cgi?id=1410106#c19 "RESOLVED FIXED - fingerprinting users in private window using web-worker + indexedDB"))
> I pushed to try. Can you check it again with this build? Locally it works
> correctly.
Ah yes, I was testing with a fast build. Now I got it to work with your build and with a local binary build.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1410106#c23)• 7 years ago |
|  | |

sec-approval+ for trunk. This isn't going to make 57 or ESR52.5.
[status-firefox57](/buglist.cgi?f1=cf_status_firefox57&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_firefox57&o1=equals&v1=%3F) → [wontfix](/buglist.cgi?f1=cf_status_firefox57&o1=equals&v1=wontfix)
[status-firefox-esr52](/buglist.cgi?f1=cf_status_firefox_esr52&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=affected)
[tracking-firefox-esr52](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=%3F)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1410106#a1685014_280903)• 7 years ago |

[Attachment #8925587](/attachment.cgi?id=8925587&action=edit "idb.patch") -
Flags: sec-approval? → sec-approval+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1410106#c24)• 7 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/8a46aeb0b562>Status: UNCONFIRMED → RESOLVEDClosed: 7 years ago
[status-firefox56](/buglist.cgi?f1=cf_status_firefox56&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox56&o1=equals&v1=wontfix)
[status-firefox58](/buglist.cgi?f1=cf_status_firefox58&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox58&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox58&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → Firefox 58

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1410106#c25)• 7 years ago |
|  | |

Jan, we're also going to need QuotaManager cleanup logic for this in a follow-up. Specifically, after running the test I created, I ended up with the directory "storage/default/http+++example.com^privateBrowsingId=1" with an "idb" directory in the testing profile. (Which was empty because the test deletes the database once it's done with it.)
Should we just add cleanup logic during the quota initialization sweep, or should we do a minor version change bump?Flags: needinfo?(jvarga)

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1410106#c26)• 7 years ago |
|  | |

:ritu, is this something you can authorize a ride-along or last-minute RC landing for 57? I really need to emphasize:
\*THIS IS/WAS A SERIOUS GAP IN OUR PRIVATE BROWSING IMPLEMENTATION\*.
The fallout is:
- A site in private browsing can persistently store data in the user's profile using IndexedDB from a Worker thread. This data will be accessible from future private browsing sessions in an affected browser, but not from non-private browsing sessions. The data is still partitioned like a container was used. So something like "browse to bluenile.com in private browsing, close private browsing window, close firefox, start firefox, start privatebrowsing, browse to bluenile.com" will result in the data previously stored in indexeddb still being accessible.
- The name of the site the user visited in private browsing mode will be visible in the profile directory. So in the above example, there'd be a "https+++bluenile.com^privateBrowsingId=1".
- Any IDB storage used by the site will show up under our about:preferences "Site Data" "Settings..." storage UI that enumerates origins and their storage used. The UI will successfully clear the private browsing origin, but that's obviously going to be disconcerting for the users.
- If the site created one or more IDB databases but deleted them, then the origin will not show up in that storage UI, even though the profile directory that clearly identifies the site origin was visited and that it was visited in private browsing mode will exist and continue to exist. (Until we implement and land a fix for patch 25, but since that will be a somewhat more blatant patch, we do want to land that separately and later.)
To reiterate the good news:
- Private Browsing does operate like a container because of our OriginAttributes mechanism, so the data is partitioned from non-private-browsing, and will be unable to communicate with windows on the same origin not in private-browsing mode, etc.Flags: needinfo?(rkothari)

|  | [Jan Varga [:janv]](/user_profile?user_id=8340) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1410106#c27)• 7 years ago |
|  | |

(In reply to Andrew Sutherland [:asuth] from [comment #25](/show_bug.cgi?id=1410106#c25 "RESOLVED FIXED - fingerprinting users in private window using web-worker + indexedDB"))
> Jan, we're also going to need QuotaManager cleanup logic for this in a
> follow-up. Specifically, after running the test I created, I ended up with
> the directory "storage/default/http+++example.com^privateBrowsingId=1" with
> an "idb" directory in the testing profile. (Which was empty because the
> test deletes the database once it's done with it.)
>
> Should we just add cleanup logic during the quota initialization sweep, or
> should we do a minor version change bump?
Hm, so after the fix, we should never create storage/default/http+++example.com^privateBrowsingId=1 directory because CheckPermission() is called before we call EnsureOriginIsInitialized(), right ?
Are you worried about such directories that were created before the fix ?Flags: needinfo?(jvarga)

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1410106#c28)• 7 years ago |
|  | |

(In reply to Jan Varga [:janv] from [comment #27](/show_bug.cgi?id=1410106#c27 "RESOLVED FIXED - fingerprinting users in private window using web-worker + indexedDB"))
> Hm, so after the fix, we should never create
> storage/default/http+++example.com^privateBrowsingId=1 directory because
> CheckPermission() is called before we call EnsureOriginIsInitialized(),
> right ?
Yes.
> Are you worried about such directories that were created before the fix ?
Exactly.

|  | [Jan Varga [:janv]](/user_profile?user_id=8340) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1410106#c29)• 7 years ago |
|  | |

(In reply to Andrew Sutherland [:asuth] from [comment #28](/show_bug.cgi?id=1410106#c28 "RESOLVED FIXED - fingerprinting users in private window using web-worker + indexedDB"))
> (In reply to Jan Varga [:janv] from [comment #27](/show_bug.cgi?id=1410106#c27 "RESOLVED FIXED - fingerprinting users in private window using web-worker + indexedDB"))
> > Hm, so after the fix, we should never create
> > storage/default/http+++example.com^privateBrowsingId=1 directory because
> > CheckPermission() is called before we call EnsureOriginIsInitialized(),
> > right ?
>
> Yes.
>
> > Are you worried about such directories that were created before the fix ?
>
> Exactly.
In that case, I think a minor upgrade is not optimal, since if the user goes back to a previous version, create some dirs with ^privateBrowsingId=1 and then goes back to the original version, these dirs won't be cleared.
Major version change bump would be better, but as we know that's a pain in the ass ...
So for now I would do it as part of the quota initialization sweep and once there's a good reason to do a major version change bump, we can move the cleanup there.

|  | [Ritu Kothari (:ritu) (Inactive, please n-i to RyanVM, jcristau, or pascal)](/user_profile?user_id=538805) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1410106#c30)• 7 years ago |
|  | |

Hi Andrew, I am willing to consider this one for RC2 (which we will gtb tomm) if security team agrees this is a low risk change.
Dan, Al, I know in [comment 23](/show_bug.cgi?id=1410106#c23 "RESOLVED FIXED - fingerprinting users in private window using web-worker + indexedDB"), your recommendation was not to take this in 57. Based on [comment 25](/show_bug.cgi?id=1410106#c25 "RESOLVED FIXED - fingerprinting users in private window using web-worker + indexedDB"), do you believe this is worth uplifting in RC2? Please let me know. If this needs more bake time, we can consider uplifting this in a 57.x dot release. Thanks for your help!Flags: needinfo?(rkothari)Flags: needinfo?(dveditz)Flags: needinfo?(bugmail)Flags: needinfo?(abillings)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1410106#c31)• 7 years ago |
|  | |

We need to land this on ESR-52 whenever we ship this on the main release. Are we ready to get a backport and take it there, too?
I agree this is a bad PB bug and the fix doesn't appear risky.Assignee: lcrouch → bugmailBlocks: [IndexedDB-on-PBackground](/show_bug.cgi?id=994190 "RESOLVED FIXED - Modify main-thread IndexedDB to use PBackground")Flags: needinfo?(dveditz)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1410106#c32)• 7 years ago |
|  | |

If Dan sees no issues, we can take it.Flags: needinfo?(abillings)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1410106#c33)• 7 years ago |
|  | |

(Assuming we do both...)

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1410106#c34)• 7 years ago |
|  | |

Really sorry guys, this is too late for 57 :(
We are going to do a rc3 this week end but in case we have any potential regression caused by this patch, we won't be able to ship 57 on Tuesday...
However, as dot releases are still a thing, we could take this as ride along (meaning that we would have to do a dot release for esr too).

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1410106#a2340977_1689)• 7 years ago |

Group: firefox-core-security → core-security-release

|  | [Andrew Overholt [:overholt]](/user_profile?user_id=442218) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1410106#c35)• 7 years ago |
|  | |

Andrew told me he's running a local ESR52 build with the patch here to see if it works (and will otherwise make an ESR52-specific patch). He'll ask for esr52 approval there so we can land that at the same time as 57.x. Thanks, Andrew!

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1410106#c36)• 7 years ago |
|  | |

Comment on [attachment 8925587](/attachment.cgi?id=8925587 "idb.patch") [[details]](/attachment.cgi?id=8925587&action=edit "idb.patch") [[diff]](/attachment.cgi?id=8925587&action=diff "idb.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1410106&attachment=8925587)
idb.patch
Both the patch and the test graft to esr52 (and release) successfully. See:
- [Comment 18](/show_bug.cgi?id=1410106#c18 "RESOLVED FIXED - fingerprinting users in private window using web-worker + indexedDB") for the security approval request.
- [Comment 23](/show_bug.cgi?id=1410106#c23 "RESOLVED FIXED - fingerprinting users in private window using web-worker + indexedDB") for security approval.
- [Comment 26](/show_bug.cgi?id=1410106#c26 "RESOLVED FIXED - fingerprinting users in private window using web-worker + indexedDB") for general fallout of the bug.
[[ESR Approval Request Comment]]
This is sec-high. See next approval request for all other Q's.
[[Release Approval Request Comment]]
[Feature/Bug causing the regression]:
[Bug 994190](/show_bug.cgi?id=994190 "RESOLVED FIXED - Modify main-thread IndexedDB to use PBackground"), Firefox 35, IndexedDB on workers.
[User impact if declined]:
See [Comment 26](/show_bug.cgi?id=1410106#c26 "RESOLVED FIXED - fingerprinting users in private window using web-worker + indexedDB") for details, but, in short, Private Browsing is broken in DOM Workers.
[Is this code covered by automated tests?]:
The non-Private-Browsing aspects are covered. Because so many internal Gecko subsystems depend on IndexedDB (in non-PB mode), we have massive end-to-end coverage on top of the extensive IndexedDB tests. The problem is that we didn't have enough tests of where it's not expected to work.
[Attachment 8925768](/attachment.cgi?id=8925768 "browser test of IndexedDB open calls in window/dedicatedworker/sharedworker in normal and PB windows") [[details]](/attachment.cgi?id=8925768&action=edit "browser test of IndexedDB open calls in window/dedicatedworker/sharedworker in normal and PB windows") [[diff]](/attachment.cgi?id=8925768&action=diff "browser test of IndexedDB open calls in window/dedicatedworker/sharedworker in normal and PB windows") on this bug has been created to provide automated coverage going forward, and was tested against (then-trunk) 58, current release (just now), and current esr52 (just now) with and without the patch to verify the test correctly detects the failure and the fix correctly fixes it. The plan is to land that test once the esr52 point release and 57 point release have happened.
[Has the fix been verified in Nightly?]:
Yes, 2017-11-08, 14 days ago per Bugzilla.
[Needs manual test from QE? If yes, steps to reproduce]:
No, but [comment 0](/show_bug.cgi?id=1410106#c0 "RESOLVED FIXED - fingerprinting users in private window using web-worker + indexedDB") has a test case if someone really wanted to.
[List of other uplifts needed for the feature/fix]:
No other uplifts required.
[Is the change risky?]:
No, it's the best.
[Why is the change risky/not risky?]:
It's a minimal change in how we propagate a single boolean related to private browsing, eliminating the edge-cases between content pages and workers. As noted in automated test coverage discussion, the tree would turn VERY orange if we got it wrong.
[String changes made/needed]:
No changes made.Flags: needinfo?(bugmail)
[Attachment #8925587](/attachment.cgi?id=8925587&action=edit "idb.patch") -
Flags: approval-mozilla-release?
[Attachment #8925587](/attachment.cgi?id=8925587&action=edit "idb.patch") -
Flags: approval-mozilla-esr52?

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1410106#c37)• 7 years ago |
|  | |

(messing with 57 flags in case it helps the bugzilla queries for approval requests).
[status-firefox57](/buglist.cgi?f1=cf_status_firefox57&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox57&o1=equals&v1=wontfix) → [affected](/buglist.cgi?f1=cf_status_firefox57&o1=equals&v1=affected)
[tracking-firefox57](/buglist.cgi?f1=cf_tracking_firefox57&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox57&o1=equals&v1=%3F)

|  | [Ritu Kothari (:ritu) (Inactive, please n-i to RyanVM, jcristau, or pascal)](/user_profile?user_id=538805) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1410106#a3392697_538805)• 7 years ago |

[tracking-firefox57](/buglist.cgi?f1=cf_tracking_firefox57&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox57&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox57&o1=equals&v1=%2B)

|  | [Ritu Kothari (:ritu) (Inactive, please n-i to RyanVM, jcristau, or pascal)](/user_profile?user_id=538805) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1410106#c38)• 7 years ago |
|  | |

Comment on [attachment 8925587](/attachment.cgi?id=8925587 "idb.patch") [[details]](/attachment.cgi?id=8925587&action=edit "idb.patch") [[diff]](/attachment.cgi?id=8925587&action=diff "idb.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1410106&attachment=8925587)
idb.patch
Thanks Andrew for your due diligence on this uplift nomination. We've decided to take this one due to the user impact and also since it has baked for a while on Nightly58/59, Release57+.
Liz, will let you drive the ESR dot releaseFlags: needinfo?(lhenry)
[Attachment #8925587](/attachment.cgi?id=8925587&action=edit "idb.patch") -
Flags: approval-mozilla-release? → approval-mozilla-release+

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1410106#c39)• 7 years ago |
|  | |

Comment on [attachment 8925587](/attachment.cgi?id=8925587 "idb.patch") [[details]](/attachment.cgi?id=8925587&action=edit "idb.patch") [[diff]](/attachment.cgi?id=8925587&action=diff "idb.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1410106&attachment=8925587)
idb.patch
Taking this for ESR 52.5.1, important privacy fix.
This is the most organized uplift request ever! Thanks!Flags: needinfo?(lhenry)
[Attachment #8925587](/attachment.cgi?id=8925587&action=edit "idb.patch") -
Flags: approval-mozilla-esr52? → approval-mozilla-esr52+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1410106#c40)• 7 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-release/rev/55236000eb15>
[status-firefox57](/buglist.cgi?f1=cf_status_firefox57&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox57&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox57&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1410106#c41)• 7 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr52/rev/f6216ea8b8fc4ff0c22f95e0aae6c4df2a5e6b5f>
[status-firefox-esr52](/buglist.cgi?f1=cf_status_firefox_esr52&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=fixed)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1410106#a3476521_451704)• 7 years ago |

[tracking-firefox-esr52](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=%3F) → [57+](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=57%2B)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1410106#a3478393_280903)• 7 years ago |

Alias: CVE-2017-7843
[status-firefox-esr52](/buglist.cgi?f1=cf_status_firefox_esr52&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=fixed) → [affected](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=affected)
[tracking-firefox-esr52](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=isnotempty):
[57+](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=57%2B) → [?](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=%3F)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1410106#a3478417_280903)• 7 years ago |

Whiteboard: [fingerprinting] → [fingerprinting][adv-main57+][adv-esr52.5.1]

|  | [Andrei Vaida [:avaida]](/user_profile?user_id=488993) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1410106#c42)• 7 years ago |
|  | |

(In reply to Andrew Sutherland [:asuth] from [comment #36](/show_bug.cgi?id=1410106#c36 "RESOLVED FIXED - fingerprinting users in private window using web-worker + indexedDB"))
> [Is this code covered by automated tests?]:
> The non-Private-Browsing aspects are covered. Because so many internal
> Gecko subsystems depend on IndexedDB (in non-PB mode), we have massive
> end-to-end coverage on top of the extensive IndexedDB tests. The problem is
> that we didn't have enough tests of where it's not expected to work.
>
> [Attachment 8925768](/attachment.cgi?id=8925768 "browser test of IndexedDB open calls in window/dedicatedworker/sharedworker in normal and PB windows") [[details]](/attachment.cgi?id=8925768&action=edit "browser test of IndexedDB open calls in window/dedicatedworker/sharedworker in normal and PB windows") [[diff]](/attachment.cgi?id=8925768&action=diff "browser test of IndexedDB open calls in window/dedicatedworker/sharedworker in normal and PB windows") on this bug has been created to provide
> automated coverage going forward, and was tested against (then-trunk) 58,
> current release (just now), and current esr52 (just now) with and without
> the patch to verify the test correctly detects the failure and the fix
> correctly fixes it. The plan is to land that test once the esr52 point
> release and 57 point release have happened.
>
> [Has the fix been verified in Nightly?]:
> Yes, 2017-11-08, 14 days ago per Bugzilla.
>
> [Needs manual test from QE? If yes, steps to reproduce]:
> No, but [comment 0](/show_bug.cgi?id=1410106#c0 "RESOLVED FIXED - fingerprinting users in private window using web-worker + indexedDB") has a test case if someone really wanted to.
Has automated coverage, does not need manual testing - per Andrew.Flags: qe-verify-

|  | [Konark Modi - @konarkmodi](/user_profile?user_id=473831)  Reporter |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1410106#c43)• 7 years ago |
|  | |

Hi, just tested it on FF 57.0.1, could not reproduce it there.
But I did not see any information about this security fix in release notes for 57.0.1,
<https://www.mozilla.org/en-US/firefox/57.0.1/releasenotes/>Flags: needinfo?(bugmail)

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1410106#c44)• 7 years ago |
|  | |

Thanks for testing the new release (and originally reporting!!). The security team can weigh in with the specifics, but I believe we're waiting for the ESR52 dot release and probably for time for users to update to the new version to disclose the CVE and specific vulnerabilities fixed. I too am interested in the answer since that impacts when I can land the test!Flags: needinfo?(bugmail)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1410106#c45)• 7 years ago |
|  | |

(In reply to Konark from [comment #43](/show_bug.cgi?id=1410106#c43 "RESOLVED FIXED - fingerprinting users in private window using web-worker + indexedDB"))
> But I did not see any information about this security fix in release notes
> for 57.0.1,
> <https://www.mozilla.org/en-US/firefox/57.0.1/releasenotes/>
We had an issue getting ESR52.5.1 out the door. Since this issue is also fixed in that release, we don't want to disclose it before we get a new build out. It was originally going to be in the last day or so but we've been delayed until at least Monday.
Advisories don't go in the release notes anyway. It will be on the Known Vulnerabilities page for the release at <https://www.mozilla.org/en-US/security/known-vulnerabilities/firefox/>
Andrew, you won't be able to land the test before Christmas. We want the release with the fix out and with a high uptake before we land a test that shows the vulnerability.

|  | [Konark Modi - @konarkmodi](/user_profile?user_id=473831)  Reporter |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1410106#c46)• 7 years ago |
|  | |

(In reply to Al Billings [:abillings] from [comment #45](/show_bug.cgi?id=1410106#c45 "RESOLVED FIXED - fingerprinting users in private window using web-worker + indexedDB"))
> (In reply to Konark from [comment #43](/show_bug.cgi?id=1410106#c43 "RESOLVED FIXED - fingerprinting users in private window using web-worker + indexedDB"))
>
> > But I did not see any information about this security fix in release notes
> > for 57.0.1,
> > <https://www.mozilla.org/en-US/firefox/57.0.1/releasenotes/>
>
> We had an issue getting ESR52.5.1 out the door. Since this issue is also
> fixed in that release, we don't want to disclose it before we get a new
> build out. It was originally going to be in the last day or so but we've
> been delayed until at least Monday.
Thanks for the details, I did not realize ESR52.5.1 was not released yet, I saw it on the FTP and thought it's released (<https://ftp.mozilla.org/pub/firefox/releases/52.5.1esr/mac/> - it's a 404 now), so will wait for a new update to test.
> Advisories don't go in the release notes anyway. It will be on the Known
> Vulnerabilities page for the release at
> <https://www.mozilla.org/en-US/security/known-vulnerabilities/firefox/>
> Andrew, you won't be able to land the test before Christmas. We want the
> release with the fix out and with a high uptake before we land a test that
> shows the vulnerability.

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1410106#a5271360_580382)• 7 years ago |

[status-firefox-esr52](/buglist.cgi?f1=cf_status_firefox_esr52&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=fixed)
[tracking-firefox-esr52](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=%3F) → [57+](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=57%2B)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1410106#a9091644_280903)• 7 years ago |

Flags: sec-bounty?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1410106#a9431392_1689)• 7 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Konark Modi - @konarkmodi](/user_profile?user_id=473831)  Reporter |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1410106#c47)• 7 years ago |
|  | |

Is it safe to remove the secure flag from this bug now?

|  | [Johann Hofmann [:johannh]](/user_profile?user_id=522029) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1410106#a15718883_522029)• 7 years ago |

Flags: needinfo?(abillings)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1410106#a15738458_1689)• 7 years ago |

Group: core-security-release

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1410106#a15738999_280903)• 7 years ago |

Flags: needinfo?(abillings)

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1410106#a16001943_151407)• 7 years ago |

Blocks: [1455985](/show_bug.cgi?id=1455985 "RESOLVED FIXED - Add Private Browsing tests")

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1410106#a208662944_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1410106&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Andrea Marchesini [:baku]](/user_profile?user_id=446257)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from wiki.mozilla.org_73f8d6fa_20250126_122649.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from wiki.mozilla.org_3659d679_20250126_122648.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)


