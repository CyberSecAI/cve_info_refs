=== Content from pagure.io_66ba90f4_20250125_144143.html ===


[![pagure Logo](/theme/static/pagure-logo.png?version=5.14.1)](/)

* [Log In](/login/?next=https://pagure.io/arm-image-installer/pull-request/10)

###

### [**arm-image-installer**](/arm-image-installer)

Clone
##### **Source Code**

GIT

* [Source](/arm-image-installer)
* [Issues
  9](/arm-image-installer/issues)
* [Pull Requests
  3](/arm-image-installer/pull-requests)
* [Stats](/arm-image-installer/stats)

#### #10 Verify that mount didn't fail, fix CVE-2017-7496 Merged 7 years ago by pbrobinson. Opened 7 years ago by misc. misc/arm-image-installer [fix-CVE-2017-7496](/fork/misc/arm-image-installer/tree/fix-CVE-2017-7496)  into  [master](/arm-image-installer/tree/master)

* [Comments](#comments)
* [Files Changed
  1](#request_diff)
* [Commits
  1](#commit_list)
* [Patch](/arm-image-installer/pull-request/10.patch)

[**Verify that mount didn't fail, fix CVE-2017-7496**](/fork/misc/arm-image-installer/c/189ccc3d890237fa24c920c53a75de45fab64102)
Michael Scherer
 •
7 years ago

[`189ccc3`](/fork/misc/arm-image-installer/c/189ccc3d890237fa24c920c53a75de45fab64102)

[arm-image-installer](/fork/misc/arm-image-installer/blob/a492555e6055ecdf5bb4bbee03d024bf88ef66cd/f/arm-image-installer "View file as of a492555")

file modified

+9

|  |  | ``` @@ -301,7 +301,16 @@  ``` |
| --- | --- | --- |
|  |  | ```   # make temp mount points ``` |
|  |  | ```   mkdir /tmp/{boot,root} &> /dev/null ``` |
|  |  | ```   mount "$BOOTPART" /tmp/boot &> /dev/null ``` |
|  |  | ``` + if [ $? -ne 0 ]; then ``` |
|  |  | ``` +         echo "Error: mount $BOOTPART /tmp/boot failed" ``` |
|  |  | ``` +         exit 1 ``` |
|  |  | ``` + fi ``` |
|  |  | ``` +  ``` |
|  |  | ```   mount "$ROOTPART" /tmp/root &> /dev/null ``` |
|  |  | ``` + if [ $? -ne 0 ]; then ``` |
|  |  | ``` +         echo "Error: mount $ROOTPART /tmp/root failed" ``` |
|  |  | ``` +         exit 1 ``` |
|  |  | ``` + fi ``` |
|  |  | ```    ``` |
|  |  | ```   # turn off selinux ``` |
|  |  | ```   if [ "$SELINUX" != "" ] ; then ``` |
|  |  |

![](https://seccdn.libravatar.org/avatar/b4dbfa816c8479c511c0f86f88ca923a810be42d6c2f803bc17cb3f6e74f35c3?s=24&d=retro)
[misc](/user/misc "Michael S (misc)")
[commented 7 years ago](#comment-0 "Permalink to this headline")

Since /tmp is world writable, and we do not verify the return code

of mount (or mkdir), a local attacker could precreate /tmp/boot

and /tmp/root directories in a way that mount fail, and later

add symlink to fool the script. For example /tmp/root/etc/ pointing to

/etc , which in turn will make this sed call

sed -i 's/root:x:/root::/' /tmp/root/etc/passwd

modify the real /etc/password file (since the tool is running

as root, SELinux policies are most likely bypasswed, and the symlink

protection in /tmp wouldn't be applicable if the symlink is directory).

![](https://seccdn.libravatar.org/avatar/b4dbfa816c8479c511c0f86f88ca923a810be42d6c2f803bc17cb3f6e74f35c3?s=24&d=retro)

rebased

7 years ago

![](https://seccdn.libravatar.org/avatar/4e8d68fe76de63043f2c89e9e363e4dc5af5775e488004cc7a8398c86381b072?s=24&d=retro)

Pull-Request has been merged by pbrobinson

7 years ago

##### Metadata

  **Assignee**
None

**Tags**
No Tags

##### Changes Summary 1

[+9
-0

**file changed**

arm-image-installer](#_1)

Powered by [Pagure](https://pagure.io/pagure) 5.14.1
[Documentation](https://docs.pagure.org/pagure/usage/index.html) •
[File an Issue](https://pagure.io/pagure/new_issue) •
[About](/about) •
[SSH Hostkey/Fingerprint](/ssh_info)

© Red Hat, Inc. and others.


