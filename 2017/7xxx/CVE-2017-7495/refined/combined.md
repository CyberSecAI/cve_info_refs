=== Content from git.kernel.org_79e9dc31_20250126_015221.html ===


| [cgit logo](/) | [index](/) : [kernel/git/netdev/net.git](/pub/scm/linux/kernel/git/netdev/net.git/) | main |
| --- | --- | --- |
| Netdev Group's networking tree | Netdev Group |

| [about](/pub/scm/linux/kernel/git/netdev/net.git/about/)[summary](/pub/scm/linux/kernel/git/netdev/net.git/)[refs](/pub/scm/linux/kernel/git/netdev/net.git/refs/?id=7892032cfe67f4bde6fc2ee967e45a8fbaf33756)[log](/pub/scm/linux/kernel/git/netdev/net.git/log/)[tree](/pub/scm/linux/kernel/git/netdev/net.git/tree/?id=7892032cfe67f4bde6fc2ee967e45a8fbaf33756)[commit](/pub/scm/linux/kernel/git/netdev/net.git/commit/?id=7892032cfe67f4bde6fc2ee967e45a8fbaf33756)[diff](/pub/scm/linux/kernel/git/netdev/net.git/diff/?id=7892032cfe67f4bde6fc2ee967e45a8fbaf33756)[stats](/pub/scm/linux/kernel/git/netdev/net.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Dumazet <edumazet@google.com> | 2017-02-04 23:18:55 -0800 |
| --- | --- | --- |
| committer | David S. Miller <davem@davemloft.net> | 2017-02-05 17:23:04 -0500 |
| commit | [7892032cfe67f4bde6fc2ee967e45a8fbaf33756](/pub/scm/linux/kernel/git/netdev/net.git/commit/?id=7892032cfe67f4bde6fc2ee967e45a8fbaf33756) ([patch](/pub/scm/linux/kernel/git/netdev/net.git/patch/?id=7892032cfe67f4bde6fc2ee967e45a8fbaf33756)) | |
| tree | [cbadc1cb0484fbdcd3d5d68d5189c1d022d0d0d4](/pub/scm/linux/kernel/git/netdev/net.git/tree/?id=7892032cfe67f4bde6fc2ee967e45a8fbaf33756) | |
| parent | [d71b7896886345c53ef1d84bda2bc758554f5d61](/pub/scm/linux/kernel/git/netdev/net.git/commit/?id=d71b7896886345c53ef1d84bda2bc758554f5d61) ([diff](/pub/scm/linux/kernel/git/netdev/net.git/diff/?id=7892032cfe67f4bde6fc2ee967e45a8fbaf33756&id2=d71b7896886345c53ef1d84bda2bc758554f5d61)) | |
| download | [net-7892032cfe67f4bde6fc2ee967e45a8fbaf33756.tar.gz](/pub/scm/linux/kernel/git/netdev/net.git/snapshot/net-7892032cfe67f4bde6fc2ee967e45a8fbaf33756.tar.gz) | |

ip6\_gre: fix ip6gre\_err() invalid readsAndrey Konovalov reported out of bound accesses in ip6gre\_err()
If GRE flags contains GRE\_KEY, the following expression
\*(((\_\_be32 \*)p) + (grehlen / 4) - 1)
accesses data ~40 bytes after the expected point, since
grehlen includes the size of IPv6 headers.
Let's use a "struct gre\_base\_hdr \*greh" pointer to make this
code more readable.
p[1] becomes greh->protocol.
grhlen is the GRE header length.
Fixes: c12b395a4664 ("gre: Support GRE over IPv6")
Signed-off-by: Eric Dumazet <edumazet@google.com>
Reported-by: Andrey Konovalov <andreyknvl@google.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
[Diffstat](/pub/scm/linux/kernel/git/netdev/net.git/diff/?id=7892032cfe67f4bde6fc2ee967e45a8fbaf33756)

| -rw-r--r-- | [net/ipv6/ip6\_gre.c](/pub/scm/linux/kernel/git/netdev/net.git/diff/net/ipv6/ip6_gre.c?id=7892032cfe67f4bde6fc2ee967e45a8fbaf33756) | 40 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 21 insertions, 19 deletions

| diff --git a/net/ipv6/ip6\_gre.c b/net/ipv6/ip6\_gre.cindex 558631860d91bb..630b73be599977 100644--- a/[net/ipv6/ip6\_gre.c](/pub/scm/linux/kernel/git/netdev/net.git/tree/net/ipv6/ip6_gre.c?id=d71b7896886345c53ef1d84bda2bc758554f5d61)+++ b/[net/ipv6/ip6\_gre.c](/pub/scm/linux/kernel/git/netdev/net.git/tree/net/ipv6/ip6_gre.c?id=7892032cfe67f4bde6fc2ee967e45a8fbaf33756)@@ -367,35 +367,37 @@ static void ip6gre\_tunnel\_uninit(struct net\_device \*dev)   static void ip6gre\_err(struct sk\_buff \*skb, struct inet6\_skb\_parm \*opt,- u8 type, u8 code, int offset, \_\_be32 info)+ u8 type, u8 code, int offset, \_\_be32 info) {- const struct ipv6hdr \*ipv6h = (const struct ipv6hdr \*)skb->data;- \_\_be16 \*p = (\_\_be16 \*)(skb->data + offset);- int grehlen = offset + 4;+ const struct gre\_base\_hdr \*greh;+ const struct ipv6hdr \*ipv6h;+ int grehlen = sizeof(\*greh); struct ip6\_tnl \*t;+ int key\_off = 0; \_\_be16 flags;+ \_\_be32 key; - flags = p[0];- if (flags&(GRE\_CSUM|GRE\_KEY|GRE\_SEQ|GRE\_ROUTING|GRE\_VERSION)) {- if (flags&(GRE\_VERSION|GRE\_ROUTING))- return;- if (flags&GRE\_KEY) {- grehlen += 4;- if (flags&GRE\_CSUM)- grehlen += 4;- }+ if (!pskb\_may\_pull(skb, offset + grehlen))+ return;+ greh = (const struct gre\_base\_hdr \*)(skb->data + offset);+ flags = greh->flags;+ if (flags & (GRE\_VERSION | GRE\_ROUTING))+ return;+ if (flags & GRE\_CSUM)+ grehlen += 4;+ if (flags & GRE\_KEY) {+ key\_off = grehlen + offset;+ grehlen += 4; } - /\* If only 8 bytes returned, keyed message will be dropped here \*/- if (!pskb\_may\_pull(skb, grehlen))+ if (!pskb\_may\_pull(skb, offset + grehlen)) return; ipv6h = (const struct ipv6hdr \*)skb->data;- p = (\_\_be16 \*)(skb->data + offset);+ greh = (const struct gre\_base\_hdr \*)(skb->data + offset);+ key = key\_off ? \*(\_\_be32 \*)(skb->data + key\_off) : 0;  t = ip6gre\_tunnel\_lookup(skb->dev, &ipv6h->daddr, &ipv6h->saddr,- flags & GRE\_KEY ?- \*(((\_\_be32 \*)p) + (grehlen / 4) - 1) : 0,- p[1]);+ key, greh->protocol); if (!t) return; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-26 01:50:58 +0000



=== Content from www.kernel.org_8497d536_20250124_150348.html ===
commit 536b1f59b9b2be80e5cdc02ca3300d7fe9f44cc1
Author: Greg Kroah-Hartman
Date: Tue Jun 7 18:23:53 2016 -0700
Linux 4.6.2
commit 18055cbc5e852cda2b1dc7486f85e8af626d8a02
Author: Jon Hunter
Date: Wed Mar 30 17:09:13 2016 +0100
regulator: Fix deadlock during regulator registration
commit a2151374230820a3a6e654f2998b2a44dbfae4e1 upstream.
Commit 5e3ca2b349b1 ("regulator: Try to resolve regulators supplies on
registration") added a call to regulator\_resolve\_supply() within
regulator\_register() where the regulator\_list\_mutex is held. This causes
a deadlock to occur on the Tegra114 Dalmore board when the palmas PMIC
is registered because regulator\_register\_resolve\_supply() calls
regulator\_dev\_lookup() which may try to acquire the regulator\_list\_mutex
again.
Fix this by releasing the mutex before calling
regulator\_register\_resolve\_supply() and update the error exit path to
ensure the mutex is released on an error.
[Made commit message more legible -- broonie]
Signed-off-by: Jon Hunter
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 55d37507a61b889945fac08f3ea7b3a0c8d95522
Author: Mike Marciniszyn
Date: Tue May 24 12:50:23 2016 -0700
IB/hfi1: Fix hard lockup due to not using save/restore spin lock
commit 7049de65c9e520886f06d6f9deceaaed5d93fb7c upstream.
Commit b9b06cb6feda
("IB/hfi1: Fix missing lock/unlock in verbs drain callback")
added a spin lock.
Unfortunately, the new lock code can be called from a base
level interrupt state, and an interrupt that can get stacked
will attempt to get the same lock.
Fix by using the flag save/restore spin lock variation.
Cc: stable@vger.kernel.org # 4.6+
Reviewed-by: Sebastian Sanchez
Signed-off-by: Mike Marciniszyn
Signed-off-by: Dennis Dalessandro
Signed-off-by: Doug Ledford
Signed-off-by: Greg Kroah-Hartman
commit 1ce76644efbacb708b6c9f1d893890bdd410465c
Author: Arnd Bergmann
Date: Sat Apr 16 22:41:46 2016 +0200
drm: msm: remove unused variable
commit 6979cd54c0667189bb0805c0fcebfef8afc5a191 upstream.
A recent cleanup removed the only user of the 'kms' variable in
msm\_preclose(), causing a harmless compiler warning:
drivers/gpu/drm/msm/msm\_drv.c: In function 'msm\_preclose':
drivers/gpu/drm/msm/msm\_drv.c:468:18: error: unused variable 'kms' [-Werror=unused-variable]
This removes the variable as well.
Signed-off-by: Arnd Bergmann
Fixes: 4016260ba47a ("drm/msm: fix bug after preclose removal")
Signed-off-by: Rob Clark
Signed-off-by: Greg Kroah-Hartman
commit 9b09e96744342e7a7fbf92fc0a698ab67887fcb7
Author: Dave Chinner
Date: Wed May 18 13:54:23 2016 +1000
xfs: skip stale inodes in xfs\_iflush\_cluster
commit 7d3aa7fe970791f1a674b14572a411accf2f4d4e upstream.
We don't write back stale inodes so we should skip them in
xfs\_iflush\_cluster, too.
Signed-off-by: Dave Chinner
Reviewed-by: Brian Foster
Reviewed-by: Christoph Hellwig
Signed-off-by: Dave Chinner
Signed-off-by: Greg Kroah-Hartman
commit 03b58aaa2f6974a074eeb4687bb894399729e0f6
Author: Dave Chinner
Date: Wed May 18 13:54:22 2016 +1000
xfs: fix inode validity check in xfs\_iflush\_cluster
commit 51b07f30a71c27405259a0248206ed4e22adbee2 upstream.
Some careless idiot(\*) wrote crap code in commit 1a3e8f3 ("xfs:
convert inode cache lookups to use RCU locking") back in late 2010,
and so xfs\_iflush\_cluster checks the wrong inode for whether it is
still valid under RCU protection. Fix it to lock and check the
correct inode.
(\*) Careless-idiot: Dave Chinner
Discovered-by: Brain Foster
Signed-off-by: Dave Chinner
Reviewed-by: Christoph Hellwig
Signed-off-by: Dave Chinner
Signed-off-by: Greg Kroah-Hartman
commit 94e7cf3f6e2fa8c8301516db503126b7e96b4551
Author: Dave Chinner
Date: Wed May 18 13:53:42 2016 +1000
xfs: xfs\_iflush\_cluster fails to abort on error
commit b1438f477934f5a4d5a44df26f3079a7575d5946 upstream.
When a failure due to an inode buffer occurs, the error handling
fails to abort the inode writeback correctly. This can result in the
inode being reclaimed whilst still in the AIL, leading to
use-after-free situations as well as filesystems that cannot be
unmounted as the inode log items left in the AIL never get removed.
Fix this by ensuring fatal errors from xfs\_imap\_to\_bp() result in
the inode flush being aborted correctly.
Reported-by: Shyam Kaushik
Diagnosed-by: Shyam Kaushik
Tested-by: Shyam Kaushik
Signed-off-by: Dave Chinner
Reviewed-by: Christoph Hellwig
Signed-off-by: Dave Chinner
Signed-off-by: Greg Kroah-Hartman
commit 5b0d2a625088e4138fab67152b91be6359da4563
Author: Dave Chinner
Date: Wed May 18 13:52:42 2016 +1000
xfs: remove xfs\_fs\_evict\_inode()
commit 8179c03629de67f515d3ab825b5a9428687d4b85 upstream.
Joe Lawrence reported a list\_add corruption with 4.6-rc1 when
testing some custom md administration code that made it's own
block device nodes for the md array. The simple test loop of:
for i in {0..100}; do
mknod --mode=0600 $tmp/tmp\_node b $MAJOR $MINOR
mdadm --detail --export $tmp/tmp\_node > /dev/null
rm -f $tmp/tmp\_node
done
Would produce this warning in bd\_acquire() when mdadm opened the
device node:
list\_add double add: new=ffff88043831c7b8, prev=ffff8804380287d8, next=ffff88043831c7b8.
And then produce this from bd\_forget from kdevtmpfs evicting a block
dev inode:
list\_del corruption. prev->next should be ffff8800bb83eb10, but was ffff88043831c7b8
This is a regression caused by commit c19b3b05 ("xfs: mode di\_mode
to vfs inode"). The issue is that xfs\_inactive() frees the
unlinked inode, and the above commit meant that this freeing zeroed
the mode in the struct inode. The problem is that after evict() has
called ->evict\_inode, it expects the i\_mode to be intact so that it
can call bd\_forget() or cd\_forget() to drop the reference to the
block device inode attached to the XFS inode.
In reality, the only thing we do in xfs\_fs\_evict\_inode() that is not
generic is call xfs\_inactive(). We can move the xfs\_inactive() call
to xfs\_fs\_destroy\_inode() without any problems at all, and this
will leave the VFS inode intact until it is completely done with it.
So, remove xfs\_fs\_evict\_inode(), and do the work it used to do in
->destroy\_inode instead.
Reported-by: Joe Lawrence
Signed-off-by: Dave Chinner
Reviewed-by: Brian Foster
Signed-off-by: Dave Chinner
Signed-off-by: Greg Kroah-Hartman
commit 3abc7b73224c789af7a471c32d78f1665582ec87
Author: Dave Chinner
Date: Wed Apr 6 07:06:20 2016 +1000
xfs: Don't wrap growfs AGFL indexes
commit ad747e3b299671e1a53db74963cc6c5f6cdb9f6d upstream.
Commit 96f859d ("libxfs: pack the agfl header structure so
XFS\_AGFL\_SIZE is correct") allowed the freelist to use the empty
slot at the end of the freelist on 64 bit systems that was not
being used due to sizeof() rounding up the structure size.
This has caused versions of xfs\_repair prior to 4.5.0 (which also
has the fix) to report this as a corruption once the filesystem has
been grown. Older kernels can also have problems (seen from a whacky
container/vm management environment) mounting filesystems grown on a
system with a newer kernel than the vm/container it is deployed on.
To avoid this problem, change the initial free list indexes not to
wrap across the end of the AGFL, hence avoiding the initialisation
of agf\_fllast to the last index in the AGFL.
Signed-off-by: Dave Chinner
Reviewed-by: Carlos Maiolino
Signed-off-by: Dave Chinner
Signed-off-by: Greg Kroah-Hartman
commit 88f4d3b70849f436021d9d0290a85f32bf46b0bb
Author: Eric Sandeen
Date: Wed Apr 6 07:05:41 2016 +1000
xfs: disallow rw remount on fs with unknown ro-compat features
commit d0a58e833931234c44e515b5b8bede32bd4e6eed upstream.
Today, a kernel which refuses to mount a filesystem read-write
due to unknown ro-compat features can still transition to read-write
via the remount path. The old kernel is most likely none the wiser,
because it's unaware of the new feature, and isn't using it. However,
writing to the filesystem may well corrupt metadata related to that
new feature, and moving to a newer kernel which understand the feature
will have problems.
Right now the only ro-compat feature we have is the free inode btree,
which showed up in v3.16. It would be good to push this back to
all the active stable kernels, I think, so that if anyone is using
newer mkfs (which enables the finobt feature) with older kernel
releases, they'll be protected.
Signed-off-by: Eric Sandeen
Reviewed-by: Bill O'Donnell
Reviewed-by: Dave Chinner
Signed-off-by: Dave Chinner
Signed-off-by: Greg Kroah-Hartman
commit 579c08b8ed33ee94543aeaaabf6bbd6b0d9c8a13
Author: Arnd Bergmann
Date: Mon Apr 25 17:35:30 2016 +0200
gcov: disable tree-loop-im to reduce stack usage
commit c87bf431448b404a6ef5fbabd74c0e3e42157a7f upstream.
Enabling CONFIG\_GCOV\_PROFILE\_ALL produces us a lot of warnings like
lib/lz4/lz4hc\_compress.c: In function 'lz4\_compresshcctx':
lib/lz4/lz4hc\_compress.c:514:1: warning: the frame size of 1504 bytes is larger than 1024 bytes [-Wframe-larger-than=]
After some investigation, I found that this behavior started with gcc-4.9,
and opened https://gcc.gnu.org/bugzilla/show\_bug.cgi?id=69702.
A suggested workaround for it is to use the -fno-tree-loop-im
flag that turns off one of the optimization stages in gcc, so the
code runs a little slower but does not use excessive amounts
of stack.
We could make this conditional on the gcc version, but I could not
find an easy way to do this in Kbuild and the benefit would be
fairly small, given that most of the gcc version in production are
affected now.
I'm marking this for 'stable' backports because it addresses a bug
with code generation in gcc that exists in all kernel versions
with the affected gcc releases.
Signed-off-by: Arnd Bergmann
Acked-by: Peter Oberparleiter
Signed-off-by: Michal Marek
Signed-off-by: Greg Kroah-Hartman
commit e2a120ab424856178a5ceae7521100808ee9112b
Author: Kirill A. Shutemov
Date: Fri May 27 14:27:38 2016 -0700
mm: thp: avoid false positive VM\_BUG\_ON\_PAGE in page\_move\_anon\_rmap()
commit 0798d3c022dc63eb0ec02b511e1f76ca8411ef8e upstream.
If page\_move\_anon\_rmap() is refiling a pmd-splitted THP mapped in a tail
page from a pte, the "address" must be THP aligned in order for the
page->index bugcheck to pass in the CONFIG\_DEBUG\_VM=y builds.
Link: http://lkml.kernel.org/r/1464253620-106404-1-git-send-email-kirill.shutemov@linux.intel.com
Fixes: 6d0a07edd17c ("mm: thp: calculate the mapcount correctly for THP pages during WP faults")
Signed-off-by: Kirill A. Shutemov
Reported-by: Mika Westerberg
Tested-by: Mika Westerberg
Reviewed-by: Andrea Arcangeli
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 6d7ceda76ce9708fa796a9c494f0422370dd6055
Author: Srinivas Pandruvada
Date: Sat May 14 20:09:52 2016 -0700
scripts/package/Makefile: rpmbuild add support of RPMOPTS
commit 65a9f31c5042e5bb50d30ed8ae374044be561054 upstream.
After commit 21a59991ce0c ("scripts/package/Makefile: rpmbuild is needed
for rpm targets"), it is no longer possible to specify RPMOPTS.
For example, we can no longer able to control \_topdir using the following
make command.
make RPMOPTS="--define '\_topdir /home/xyz/workspace/'" binrpm-pkg
Fixes: 21a59991ce0c ("scripts/package/Makefile: rpmbuild is needed for rpm targets")
Signed-off-by: Srinivas Pandruvada
Signed-off-by: Michal Marek
Signed-off-by: Greg Kroah-Hartman
commit 923dd9f8eb9d5ecf2e6cd2b02a29a0129ffff23a
Author: Ville Syrjälä
Date: Thu May 26 15:16:25 2016 -0700
dma-debug: avoid spinlock recursion when disabling dma-debug
commit 3017cd63f26fc655d56875aaf497153ba60e9edf upstream.
With netconsole (at least) the pr\_err("... disablingn") call can
recurse back into the dma-debug code, where it'll try to grab
free\_entries\_lock again. Avoid the problem by doing the printk after
dropping the lock.
Link: http://lkml.kernel.org/r/1463678421-18683-1-git-send-email-ville.syrjala@linux.intel.com
Signed-off-by: Ville Syrjälä
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 41103c791d4af40643183825d61eb7bb34282ac3
Author: Rafael J. Wysocki
Date: Fri May 20 23:09:49 2016 +0200
PM / sleep: Handle failures in device\_suspend\_late() consistently
commit 3a17fb329da68cb00558721aff876a80bba2fdb9 upstream.
Grygorii Strashko reports:
The PM runtime will be left disabled for the device if its
.suspend\_late() callback fails and async suspend is not allowed
for this device. In this case device will not be added in
dpm\_late\_early\_list and dpm\_resume\_early() will ignore this
device, as result PM runtime will be disabled for it forever
(side effect: after 8 subsequent failures for the same device
the PM runtime will be reenabled due to disable\_depth overflow).
To fix this problem, add devices to dpm\_late\_early\_list regardless
of whether or not device\_suspend\_late() returns errors for them.
That will ensure failures in there to be handled consistently for
all devices regardless of their async suspend/resume status.
Reported-by: Grygorii Strashko
Tested-by: Grygorii Strashko
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit b64a69a65e749d9d09851963e3bbbad8f858d946
Author: Weston Andros Adamson
Date: Wed May 25 10:07:23 2016 -0400
nfs: avoid race that crashes nfs\_init\_commit
commit ade8febde0271513360bac44883dbebad44276c3 upstream.
Since the patch "NFS: Allow multiple commit requests in flight per file"
we can run multiple simultaneous commits on the same inode. This
introduced a race over collecting pages to commit that made it possible
to call nfs\_init\_commit() with an empty list - which causes crashes like
the one below.
The fix is to catch this race and avoid calling nfs\_init\_commit and
initiate\_commit when there is no work to do.
Here is the crash:
[600522.076832] BUG: unable to handle kernel NULL pointer dereference at 0000000000000040
[600522.078475] IP: [] nfs\_init\_commit+0x22/0x130 [nfs]
[600522.078745] PGD 4272b1067 PUD 4272cb067 PMD 0
[600522.078972] Oops: 0000 [#1] SMP
[600522.079204] Modules linked in: nfsv3 nfs\_layout\_flexfiles rpcsec\_gss\_krb5 nfsv4 dns\_resolver nfs fscache dcdbas ip6t\_rpfilter ip6t\_REJECT nf\_reject\_ipv6 xt\_conntrack ebtable\_nat ebtable\_broute bridge stp llc ebtable\_filter ebtables ip6table\_nat nf\_conntrack\_ipv6 nf\_defrag\_ipv6 nf\_nat\_ipv6 ip6table\_mangle ip6table\_security ip6table\_raw ip6table\_filter ip6\_tables iptable\_nat nf\_conntrack\_ipv4 nf\_defrag\_ipv4 nf\_nat\_ipv4 nf\_nat nf\_conntrack iptable\_mangle iptable\_security iptable\_raw vmw\_vsock\_vmci\_transport vsock bonding ipmi\_devintf ipmi\_msghandler coretemp crct10dif\_pclmul crc32\_pclmul ghash\_clmulni\_intel ppdev vmw\_balloon parport\_pc parport acpi\_cpufreq vmw\_vmci i2c\_piix4 shpchp nfsd auth\_rpcgss nfs\_acl lockd grace sunrpc xfs libcrc32c vmwgfx drm\_kms\_helper ttm drm crc32c\_intel serio\_raw vmxnet3
[600522.081380] vmw\_pvscsi ata\_generic pata\_acpi
[600522.081809] CPU: 3 PID: 15667 Comm: /usr/bin/python Not tainted 4.1.9-100.pd.88.el7.x86\_64 #1
[600522.082281] Hardware name: VMware, Inc. VMware Virtual Platform/440BX Desktop Reference Platform, BIOS 6.00 09/30/2014
[600522.082814] task: ffff8800bbbfa780 ti: ffff88042ae84000 task.ti: ffff88042ae84000
[600522.083378] RIP: 0010:[] [] nfs\_init\_commit+0x22/0x130 [nfs]
[600522.083973] RSP: 0018:ffff88042ae87438 EFLAGS: 00010246
[600522.084571] RAX: 0000000000000000 RBX: ffff880003485e40 RCX: ffff88042ae87588
[600522.085188] RDX: 0000000000000000 RSI: ffff88042ae874b0 RDI: ffff880003485e40
[600522.085756] RBP: ffff88042ae87448 R08: ffff880003486010 R09: ffff88042ae874b0
[600522.086332] R10: 0000000000000000 R11: 0000000000000005 R12: ffff88042ae872d0
[600522.086905] R13: ffff88042ae874b0 R14: ffff880003485e40 R15: ffff88042704c840
[600522.087484] FS: 00007f4728ff2740(0000) GS:ffff88043fd80000(0000) knlGS:0000000000000000
[600522.088070] CS: 0010 DS: 0000 ES: 0000 CR0: 000000008005003b
[600522.088663] CR2: 0000000000000040 CR3: 000000042b6aa000 CR4: 00000000001406e0
[600522.089327] Stack:
[600522.089926] 0000000000000001 ffff88042ae87588 ffff88042ae874f8 ffffffffa04f09fa
[600522.090549] 0000000000017840 0000000000017840 ffff88042ae87588 ffff8803258d9930
[600522.091169] ffff88042ae87578 ffffffffa0563d80 0000000000000000 ffff88042704c840
[600522.091789] Call Trace:
[600522.092420] [] pnfs\_generic\_commit\_pagelist+0x1da/0x320 [nfsv4]
[600522.093052] [] ? ff\_layout\_commit\_prepare\_v3+0x30/0x30 [nfs\_layout\_flexfiles]
[600522.093696] [] ff\_layout\_commit\_pagelist+0x15/0x20 [nfs\_layout\_flexfiles]
[600522.094359] [] nfs\_generic\_commit\_list+0xe8/0x120 [nfs]
[600522.095032] [] nfs\_commit\_inode+0xba/0x110 [nfs]
[600522.095719] [] nfs\_release\_page+0x44/0xd0 [nfs]
[600522.096410] [] try\_to\_release\_page+0x32/0x50
[600522.097109] [] shrink\_page\_list+0x961/0xb30
[600522.097812] [] shrink\_inactive\_list+0x1cd/0x550
[600522.098530] [] shrink\_lruvec+0x635/0x840
[600522.099250] [] shrink\_zone+0xf0/0x2f0
[600522.099974] [] do\_try\_to\_free\_pages+0x192/0x470
[600522.100709] [] try\_to\_free\_pages+0xda/0x170
[600522.101464] [] \_\_alloc\_pages\_nodemask+0x588/0x970
[600522.102235] [] alloc\_pages\_vma+0xb5/0x230
[600522.103000] [] ? cpumask\_any\_but+0x39/0x50
[600522.103774] [] wp\_page\_copy.isra.55+0x95/0x490
[600522.104558] [] ? \_\_wake\_up+0x48/0x60
[600522.105357] [] do\_wp\_page+0xab/0x4f0
[600522.106137] [] ? release\_task+0x36b/0x470
[600522.106902] [] ? eventfd\_ctx\_read+0x67/0x1c0
[600522.107659] [] handle\_mm\_fault+0xc78/0x1900
[600522.108431] [] \_\_do\_page\_fault+0x181/0x420
[600522.109173] [] ? \_\_audit\_syscall\_exit+0x1e6/0x280
[600522.109893] [] do\_page\_fault+0x30/0x80
[600522.110594] [] ? syscall\_trace\_leave+0xc6/0x120
[600522.111288] [] page\_fault+0x28/0x30
[600522.111947] Code: 5d c3 0f 1f 80 00 00 00 00 0f 1f 44 00 00 55 4c 8d 87 d0 01 00 00 48 89 e5 53 48 89 fb 48 83 ec 08 4c 8b 0e 49 8b 41 18 4c 39 ce <48> 8b 40 40 4c 8b 50 30 74 24 48 8b 87 d0 01 00 00 48 8b 7e 08
[600522.113343] RIP [] nfs\_init\_commit+0x22/0x130 [nfs]
[600522.114003] RSP
[600522.114636] CR2: 0000000000000040
Fixes: af7cf057 (NFS: Allow multiple commit requests in flight per file)
Signed-off-by: Weston Andros Adamson
Signed-off-by: Anna Schumaker
Signed-off-by: Greg Kroah-Hartman
commit 35b5ea7019bcb78e93793578629397895cee6fc8
Author: Nicolai Stange
Date: Thu May 5 19:46:19 2016 -0400
ext4: silence UBSAN in ext4\_mb\_init()
commit 935244cd54b86ca46e69bc6604d2adfb1aec2d42 upstream.
Currently, in ext4\_mb\_init(), there's a loop like the following:
do {
...
offset += 1 << (sb->s\_blocksize\_bits - i);
i++;
} while (i <= sb->s\_blocksize\_bits + 1);
Note that the updated offset is used in the loop's next iteration only.
However, at the last iteration, that is at i == sb->s\_blocksize\_bits + 1,
the shift count becomes equal to (unsigned)-1 > 31 (c.f. C99 6.5.7(3))
and UBSAN reports
UBSAN: Undefined behaviour in fs/ext4/mballoc.c:2621:15
shift exponent 4294967295 is too large for 32-bit type 'int'
[...]
Call Trace:
[] dump\_stack+0xbc/0x117
[] ? \_atomic\_dec\_and\_lock+0x169/0x169
[] ubsan\_epilogue+0xd/0x4e
[] \_\_ubsan\_handle\_shift\_out\_of\_bounds+0x1fb/0x254
[] ? \_\_ubsan\_handle\_load\_invalid\_value+0x158/0x158
[] ? kmem\_cache\_alloc+0x101/0x390
[] ? ext4\_mb\_init+0x13b/0xfd0
[] ? create\_cache+0x57/0x1f0
[] ? create\_cache+0x11a/0x1f0
[] ? mutex\_lock+0x38/0x60
[] ? mutex\_unlock+0x1b/0x50
[] ? put\_online\_mems+0x5b/0xc0
[] ? kmem\_cache\_create+0x117/0x2c0
[] ext4\_mb\_init+0xc49/0xfd0
[...]
Observe that the mentioned shift exponent, 4294967295, equals (unsigned)-1.
Unless compilers start to do some fancy transformations (which at least
GCC 6.0.0 doesn't currently do), the issue is of cosmetic nature only: the
such calculated value of offset is never used again.
Silence UBSAN by introducing another variable, offset\_incr, holding the
next increment to apply to offset and adjust that one by right shifting it
by one position per loop iteration.
Bugzilla: https://bugzilla.kernel.org/show\_bug.cgi?id=114701
Bugzilla: https://bugzilla.kernel.org/show\_bug.cgi?id=112161
Signed-off-by: Nicolai Stange
Signed-off-by: Theodore Ts'o
Signed-off-by: Greg Kroah-Hartman
commit e7bc51456cc65d9b040e4921df43a5367e02aa10
Author: Nicolai Stange
Date: Thu May 5 17:38:03 2016 -0400
ext4: address UBSAN warning in mb\_find\_order\_for\_block()
commit b5cb316cdf3a3f5f6125412b0f6065185240cfdc upstream.
Currently, in mb\_find\_order\_for\_block(), there's a loop like the following:
while (order <= e4b->bd\_blkbits + 1) {
...
bb += 1 << (e4b->bd\_blkbits - order);
}
Note that the updated bb is used in the loop's next iteration only.
However, at the last iteration, that is at order == e4b->bd\_blkbits + 1,
the shift count becomes negative (c.f. C99 6.5.7(3)) and UBSAN reports
UBSAN: Undefined behaviour in fs/ext4/mballoc.c:1281:11
shift exponent -1 is negative
[...]
Call Trace:
[] dump\_stack+0xbc/0x117
[] ? \_atomic\_dec\_and\_lock+0x169/0x169
[] ubsan\_epilogue+0xd/0x4e
[] \_\_ubsan\_handle\_shift\_out\_of\_bounds+0x1fb/0x254
[] ? \_\_ubsan\_handle\_load\_invalid\_value+0x158/0x158
[] ? ext4\_mb\_generate\_from\_pa+0x590/0x590
[] ? ext4\_read\_block\_bitmap\_nowait+0x598/0xe80
[] mb\_find\_order\_for\_block+0x1ce/0x240
[...]
Unless compilers start to do some fancy transformations (which at least
GCC 6.0.0 doesn't currently do), the issue is of cosmetic nature only: the
such calculated value of bb is never used again.
Silence UBSAN by introducing another variable, bb\_incr, holding the next
increment to apply to bb and adjust that one by right shifting it by one
position per loop iteration.
Bugzilla: https://bugzilla.kernel.org/show\_bug.cgi?id=114701
Bugzilla: https://bugzilla.kernel.org/show\_bug.cgi?id=112161
Signed-off-by: Nicolai Stange
Signed-off-by: Theodore Ts'o
Signed-off-by: Greg Kroah-Hartman
commit 80f1ca541c8ffcad850b9ff8c0e085a51e0b14c9
Author: Jan Kara
Date: Thu May 5 11:10:15 2016 -0400
ext4: fix oops on corrupted filesystem
commit 74177f55b70e2f2be770dd28684dd6d17106a4ba upstream.
When filesystem is corrupted in the right way, it can happen
ext4\_mark\_iloc\_dirty() in ext4\_orphan\_add() returns error and we
subsequently remove inode from the in-memory orphan list. However this
deletion is done with list\_del(&EXT4\_I(inode)->i\_orphan) and thus we
leave i\_orphan list\_head with a stale content. Later we can look at this
content causing list corruption, oops, or other issues. The reported
trace looked like:
WARNING: CPU: 0 PID: 46 at lib/list\_debug.c:53 \_\_list\_del\_entry+0x6b/0x100()
list\_del corruption, 0000000061c1d6e0->next is LIST\_POISON1
0000000000100100)
CPU: 0 PID: 46 Comm: ext4.exe Not tainted 4.1.0-rc4+ #250
Stack:
60462947 62219960 602ede24 62219960
602ede24 603ca293 622198f0 602f02eb
62219950 6002c12c 62219900 601b4d6b
Call Trace:
[<6005769c>] ? vprintk\_emit+0x2dc/0x5c0
[<602ede24>] ? printk+0x0/0x94
[<600190bc>] show\_stack+0xdc/0x1a0
[<602ede24>] ? printk+0x0/0x94
[<602ede24>] ? printk+0x0/0x94
[<602f02eb>] dump\_stack+0x2a/0x2c
[<6002c12c>] warn\_slowpath\_common+0x9c/0xf0
[<601b4d6b>] ? \_\_list\_del\_entry+0x6b/0x100
[<6002c254>] warn\_slowpath\_fmt+0x94/0xa0
[<602f4d09>] ? \_\_mutex\_lock\_slowpath+0x239/0x3a0
[<6002c1c0>] ? warn\_slowpath\_fmt+0x0/0xa0
[<60023ebf>] ? set\_signals+0x3f/0x50
[<600a205a>] ? kmem\_cache\_free+0x10a/0x180
[<602f4e88>] ? mutex\_lock+0x18/0x30
[<601b4d6b>] \_\_list\_del\_entry+0x6b/0x100
[<601177ec>] ext4\_orphan\_del+0x22c/0x2f0
[<6012f27c>] ? \_\_ext4\_journal\_start\_sb+0x2c/0xa0
[<6010b973>] ? ext4\_truncate+0x383/0x390
[<6010bc8b>] ext4\_write\_begin+0x30b/0x4b0
[<6001bb50>] ? copy\_from\_user+0x0/0xb0
[<601aa840>] ? iov\_iter\_fault\_in\_readable+0xa0/0xc0
[<60072c4f>] generic\_perform\_write+0xaf/0x1e0
[<600c4166>] ? file\_update\_time+0x46/0x110
[<60072f0f>] \_\_generic\_file\_write\_iter+0x18f/0x1b0
[<6010030f>] ext4\_file\_write\_iter+0x15f/0x470
[<60094e10>] ? unlink\_file\_vma+0x0/0x70
[<6009b180>] ? unlink\_anon\_vmas+0x0/0x260
[<6008f169>] ? free\_pgtables+0xb9/0x100
[<600a6030>] \_\_vfs\_write+0xb0/0x130
[<600a61d5>] vfs\_write+0xa5/0x170
[<600a63d6>] SyS\_write+0x56/0xe0
[<6029fcb0>] ? \_\_libc\_waitpid+0x0/0xa0
[<6001b698>] handle\_syscall+0x68/0x90
[<6002633d>] userspace+0x4fd/0x600
[<6002274f>] ? save\_registers+0x1f/0x40
[<60028bd7>] ? arch\_prctl+0x177/0x1b0
[<60017bd5>] fork\_handler+0x85/0x90
Fix the problem by using list\_del\_init() as we always should with
i\_orphan list.
Reported-by: Vegard Nossum
Signed-off-by: Jan Kara
Signed-off-by: Theodore Ts'o
Signed-off-by: Greg Kroah-Hartman
commit e0df369860a0bb5b1b1238c2d734b3784ed4b119
Author: Seth Forshee
Date: Thu May 5 10:52:38 2016 -0400
ext4: fix check of dqget() return value in ext4\_ioctl\_setproject()
commit ff0bc08454917964291f72ee5b8eca66de4bc250 upstream.
A failed call to dqget() returns an ERR\_PTR() and not null. Fix
the check in ext4\_ioctl\_setproject() to handle this correctly.
Fixes: 9b7365fc1c82 ("ext4: add FS\_IOC\_FSSETXATTR/FS\_IOC\_FSGETXATTR interface support")
Signed-off-by: Seth Forshee
Signed-off-by: Theodore Ts'o
Reviewed-by: Jan Kara
Signed-off-by: Greg Kroah-Hartman
commit 447b62eddcfb060449dd1e1269c128d7aede5450
Author: Theodore Ts'o
Date: Sat Apr 30 00:49:54 2016 -0400
ext4: clean up error handling when orphan list is corrupted
commit 7827a7f6ebfcb7f388dc47fddd48567a314701ba upstream.
Instead of just printing warning messages, if the orphan list is
corrupted, declare the file system is corrupted. If there are any
reserved inodes in the orphaned inode list, declare the file system
corrupted and stop right away to avoid doing more potential damage to
the file system.
Signed-off-by: Theodore Ts'o
Signed-off-by: Greg Kroah-Hartman
commit 84ce09a5524ec339c3964725f040c186e29169dd
Author: Theodore Ts'o
Date: Sat Apr 30 00:48:54 2016 -0400
ext4: fix hang when processing corrupted orphaned inode list
commit c9eb13a9105e2e418f72e46a2b6da3f49e696902 upstream.
If the orphaned inode list contains inode #5, ext4\_iget() returns a
bad inode (since the bootloader inode should never be referenced
directly). Because of the bad inode, we end up processing the inode
repeatedly and this hangs the machine.
This can be reproduced via:
mke2fs -t ext4 /tmp/foo.img 100
debugfs -w -R "ssv last\_orphan 5" /tmp/foo.img
mount -o loop /tmp/foo.img /mnt
(But don't do this if you are using an unpatched kernel if you care
about the system staying functional. :-)
This bug was found by the port of American Fuzzy Lop into the kernel
to find file system problems[1]. (Since it \*only\* happens if inode #5
shows up on the orphan list --- 3, 7, 8, etc. won't do it, it's not
surprising that AFL needed two hours before it found it.)
[1] http://events.linuxfoundation.org/sites/events/files/slides/AFL%20filesystem%20fuzzing%2C%20Vault%202016\_0.pdf
Reported by: Vegard Nossum
Signed-off-by: Theodore Ts'o
Signed-off-by: Greg Kroah-Hartman
commit efafc4236827a88320bfe12da8ddc7edaf6e8495
Author: Jan Kara
Date: Sun Apr 24 00:56:03 2016 -0400
ext4: fix data exposure after a crash
commit 06bd3c36a733ac27962fea7d6f47168841376824 upstream.
Huang has reported that in his powerfail testing he is seeing stale
block contents in some of recently allocated blocks although he mounts
ext4 in data=ordered mode. After some investigation I have found out
that indeed when delayed allocation is used, we don't add inode to
transaction's list of inodes needing flushing before commit. Originally
we were doing that but commit f3b59291a69d removed the logic with a
flawed argument that it is not needed.
The problem is that although for delayed allocated blocks we write their
contents immediately after allocating them, there is no guarantee that
the IO scheduler or device doesn't reorder things and thus transaction
allocating blocks and attaching them to inode can reach stable storage
before actual block contents. Actually whenever we attach freshly
allocated blocks to inode using a written extent, we should add inode to
transaction's ordered inode list to make sure we properly wait for block
contents to be written before committing the transaction. So that is
what we do in this patch. This also handles other cases where stale data
exposure was possible - like filling hole via mmap in
data=ordered,nodelalloc mode.
The only exception to the above rule are extending direct IO writes where
blkdev\_direct\_IO() waits for IO to complete before increasing i\_size and
thus stale data exposure is not possible. For now we don't complicate
the code with optimizing this special case since the overhead is pretty
low. In case this is observed to be a performance problem we can always
handle it using a special flag to ext4\_map\_blocks().
Fixes: f3b59291a69d0b734be1fc8be489fef2dd846d3d
Reported-by: "HUANG Weller (CM/ESW12-CN)"
Tested-by: "HUANG Weller (CM/ESW12-CN)"
Signed-off-by: Jan Kara
Signed-off-by: Theodore Ts'o
Signed-off-by: Greg Kroah-Hartman
commit c72b52a2d088ec809b9ef6d6828b09c5f2024b9c
Author: Ville Syrjälä
Date: Wed Mar 9 19:07:24 2016 +0200
drm/i915: Pass the correct crtc state to .update\_plane()
commit 9f6151c9039084e18c118831779a99ac8f29e39c upstream.
Pass the current crtc state, not the old crtc state, to the
.update\_plane() hook.
Noticed on BSW when PRIMSIZE was getting programmed to a stale value
which produced utter garbage on screen eg. wwhen going from 1920x1080
to 1024x768.
Cc: Maarten Lankhorst
Fixes: a758e6845825 ("drm/i915: Do not use commit\_plane for sprite planes.")
Signed-off-by: Ville Syrjälä
Link: http://patchwork.freedesktop.org/patch/msgid/1457543247-13987-3-git-send-email-ville.syrjala@linux.intel.com
Reviewed-by: Maarten Lankhorst
Signed-off-by: Greg Kroah-Hartman
commit 63d0430f991314f5af8968784d3488da7ce95aa2
Author: Philipp Zabel
Date: Thu May 12 15:00:44 2016 +0200
drm/imx: Match imx-ipuv3-crtc components using device node in platform data
commit 310944d148e3600dcff8b346bee7fa01d34903b1 upstream.
The component master driver imx-drm-core matches component devices using
their of\_node. Since commit 950b410dd1ab ("gpu: ipu-v3: Fix imx-ipuv3-crtc
module autoloading"), the imx-ipuv3-crtc dev->of\_node is not set during
probing. Before that, of\_node was set and caused an of: modalias to be
used instead of the platform: modalias, which broke module autoloading.
On the other hand, if dev->of\_node is not set yet when the imx-ipuv3-crtc
probe function calls component\_add, component matching in imx-drm-core
fails. While dev->of\_node will be set once the next component tries to
bring up the component master, imx-drm-core component binding will never
succeed if one of the crtc devices is probed last.
Add of\_node to the component platform data and match against the
pdata->of\_node instead of dev->of\_node in imx-drm-core to work around
this problem.
Fixes: 950b410dd1ab ("gpu: ipu-v3: Fix imx-ipuv3-crtc module autoloading")
Signed-off-by: Philipp Zabel
Tested-by: Fabio Estevam
Tested-by: Lothar Waßmann
Tested-by: Heiko Schocher
Tested-by: Chris Ruehl
Signed-off-by: Greg Kroah-Hartman
commit 60ae20cc590e546cd23225adbed3ac258c1b3770
Author: Ville Syrjälä
Date: Fri May 6 16:46:52 2016 +0300
drm: Add helper for DP++ adaptors
commit b3daa5ef52c26acd7432c787989bd92d48070c76 upstream.
Add a helper which aids in the identification of DP dual mode
(aka. DP++) adaptors. There are several types of adaptors
specified: type 1 DVI, type 1 HDMI, type 2 DVI, type 2 HDMI
Type 1 adaptors have a max TMDS clock limit of 165MHz, type 2 adaptors
may go as high as 300MHz and they provide a register informing the
source device what the actual limit is. Supposedly also type 1 adaptors
may optionally implement this register. This TMDS clock limit is the
main reason why we need to identify these adaptors.
Type 1 adaptors provide access to their internal registers and the sink
DDC bus through I2C. Type 2 adaptors provide this access both via I2C
and I2C-over-AUX. A type 2 source device may choose to implement either
of these methods. If a source device implements the I2C-over-AUX
method, then the driver will obviously need specific support for such
adaptors since the port is driven like an HDMI port, but DDC
communication happes over the AUX channel.
This helper should be enough to identify the adaptor type (some
type 1 DVI adaptors may be a slight exception) and the maximum TMDS
clock limit. Another feature that may be available is control over
the TMDS output buffers on the adaptor, possibly allowing for some
power saving when the TMDS link is down.
Other user controllable features that may be available in the adaptors
are downstream i2c bus speed control when using i2c-over-aux, and
some control over the CEC pin. I chose not to provide any helper
functions for those since I have no use for them in i915 at this time.
The rest of the registers in the adaptor are mostly just information,
eg. IEEE OUI, hardware and firmware revision, etc.
v2: Pass adaptor type to helper functions to ease driver implementation
Fix a bunch of typoes (Paulo)
Add DRM\_DP\_DUAL\_MODE\_UNKNOWN for the case where we don't (yet) know
the type (Paulo)
Reject 0x00 and 0xff DP\_DUAL\_MODE\_MAX\_TMDS\_CLOCK values (Paulo)
Adjust drm\_dp\_dual\_mode\_detect() type2 vs. type1 detection to
ease future LSPCON enabling
Remove the unused DP\_DUAL\_MODE\_LAST\_RESERVED define
v3: Fix kernel doc function argument descriptions (Jani)
s/NONE/UNKNOWN/ in drm\_dp\_dual\_mode\_detect() docs
Add kernel doc for enum drm\_dp\_dual\_mode\_type
Actually build the docs
Fix more typoes
v4: Adjust code indentation of type2 adaptor detection (Shashank)
Add debug messages for failurs cases (Shashank)
v5: EXPORT\_SYMBOL(drm\_dp\_dual\_mode\_read) (Paulo)
Cc: Tore Anderson
Cc: Paulo Zanoni
Cc: Shashank Sharma
Cc: Daniel Vetter
Cc: Shashank Sharma
Signed-off-by: Ville Syrjälä
Reviewed-by: Shashank Sharma  (v4)
Link: http://patchwork.freedesktop.org/patch/msgid/1462542412-25533-1-git-send-email-ville.syrjala@linux.intel.com
(cherry picked from commit ede53344dbfd1dd43bfd73eb6af743d37c56a7c3)
Signed-off-by: Jani Nikula
Signed-off-by: Greg Kroah-Hartman
commit f5c446d7a152da038a5d3e85e3e6f3097fd21023
Author: Ville Syrjälä
Date: Wed Mar 9 19:07:25 2016 +0200
drm/i915: Fix watermarks for VLV/CHV
commit caed361d83b204b7766924b80463bf7502ee7986 upstream.
commit 92826fcdfc14 ("drm/i915: Calculate watermark related members in the crtc\_state, v4.")
broke thigns by removing the pre vs. post wm update distinction. We also
lost the pre plane wm update entirely for VLV/CHV from the crtc enable
path.
This caused underruns on modeset and plane enable/disable on CHV,
and often those can lead to a dead pipe.
So let's bring back the pre vs. post thing, and let's toss in an
explicit wm update to valleyview\_crtc\_enable() to avoid having to
put it into the common code.
This is more or less a partial revert of the offending commit.
Cc: Maarten Lankhorst
Cc: drm-intel-fixes@lists.freedesktop.org
Fixes: 92826fcdfc14 ("drm/i915: Calculate watermark related members in the crtc\_state, v4.")
Signed-off-by: Ville Syrjälä
Link: http://patchwork.freedesktop.org/patch/msgid/1457543247-13987-4-git-send-email-ville.syrjala@linux.intel.com
Reviewed-by: Maarten Lankhorst
Signed-off-by: Greg Kroah-Hartman
commit ccb46409376e6dde67453833cfcb6d950852fdec
Author: Ville Syrjälä
Date: Fri May 13 17:55:17 2016 +0300
drm/i915: Don't leave old junk in ilk active watermarks on readout
commit 7045c3689f148a0c95f42bae8ef3eb2829ac7de9 upstream.
When we read out the watermark state from the hardware we're supposed to
transfer that into the active watermarks, but currently we fail to any
part of the active watermarks that isn't explicitly written. Let's clear
it all upfront.
Looks like this has been like this since the beginning, when I added the
readout. No idea why I didn't clear it up.
Cc: Matt Roper
Fixes: 243e6a44b9ca ("drm/i915: Init HSW watermark tracking in intel\_modeset\_setup\_hw\_state()")
Signed-off-by: Ville Syrjälä
Reviewed-by: Matt Roper
Signed-off-by: Matt Roper
Link: http://patchwork.freedesktop.org/patch/msgid/1463151318-14719-2-git-send-email-ville.syrjala@linux.intel.com
(cherry picked from commit 15606534bf0a65d8a74a90fd57b8712d147dbca6)
Signed-off-by: Jani Nikula
Signed-off-by: Greg Kroah-Hartman
commit 28b3b41dd1f908d640a1b3370b48cd915775032e
Author: Ville Syrjälä
Date: Mon May 2 22:08:24 2016 +0300
drm/i915: Enable/disable TMDS output buffers in DP++ adaptor as needed
commit 0c2fb7c6c8fef2092051192095a7788231ba9a42 upstream.
To save a bit of power, let's try to turn off the TMDS output buffers
in DP++ adaptors when we're not driving the port.
v2: Let's not forget DDI, toss in a debug message while at it
v3: Just do the TMDS output control based on adaptor type. With the
helper getting passed the type, we wouldn't actually have to
check at all in the driver, but the check eliminates the debug
output more honest
Cc: Tore Anderson
Cc: Paulo Zanoni
Cc: Shashank Sharma
Cc: Daniel Vetter
Signed-off-by: Ville Syrjälä
Link: http://patchwork.freedesktop.org/patch/msgid/1462216105-20881-4-git-send-email-ville.syrjala@linux.intel.com
Reviewed-by: Shashank Sharma
(cherry picked from commit b2ccb822d376d1bbbe5d1f9118d1488b25e6bc6d)
Signed-off-by: Jani Nikula
Signed-off-by: Greg Kroah-Hartman
commit 0c7c171590589516db8371af1b79779f0c3a9894
Author: Ville Syrjälä
Date: Mon May 2 22:08:23 2016 +0300
drm/i915: Respect DP++ adaptor TMDS clock limit
commit c578d15226c99f0566d5d022f81af6b7d69928db upstream.
Try to detect the max TMDS clock limit for the DP++ adaptor (if any)
and take it into account when checking the port clock.
Note that as with the sink (HDMI vs. DVI) TMDS clock limit we'll ignore
the adaptor TMDS clock limit in the modeset path, in case users are
already "overclocking" their TMDS links. One subtle change here is that
we'll have to respect the adaptor TMDS clock limit when we decide whether
to do 12bpc or 8bpc, otherwise we might end up picking 12bpc and
accidentally driving the TMDS link out of spec even when the user chose
a mode that fits wihting the limits at 8bpc. This means you can't
"overclock" your DP++ dongle at 12bpc anymore, but you can continue to
do so at 8bpc.
Note that for simplicity we'll use the I2C access method for all dual
mode adaptors including type 2. Otherwise we'd have to start mixing
DP AUX and HDMI together. In the future we may need to do that if we
come across any board designs that don't hook up the DDC pins to the
DP++ connectors. Such boards would obviously only work with type 2
dual mode adaptors, and not type 1.
v2: Store adaptor type under indel\_hdmi->dp\_dual\_mode
Deal with DRM\_DP\_DUAL\_MODE\_UNKNOWN
Pass adaptor type to drm\_dp\_dual\_mode\_max\_tmds\_clock(),
and use it for type1 adaptors as well
Reported-by: Tore Anderson
Fixes: 7a0baa623446 ("Revert "drm/i915: Disable 12bpc hdmi for now"")
Cc: Paulo Zanoni
Cc: Shashank Sharma
Cc: Daniel Vetter
Signed-off-by: Ville Syrjälä
Link: http://patchwork.freedesktop.org/patch/msgid/1462216105-20881-3-git-send-email-ville.syrjala@linux.intel.com
Reviewed-by: Shashank Sharma
(cherry picked from commit b1ba124d8e95cca48d33502a4a76b1ed09d213ce)
Signed-off-by: Jani Nikula
Signed-off-by: Greg Kroah-Hartman
commit 69205c5c16df0702870179c8419e89cc954bd311
Author: Daniel Vetter
Date: Wed May 18 18:47:11 2016 +0200
drm/i915/psr: Try to program link training times correctly
commit 03b7b5f983091bca17e9c163832fcde56971d7d1 upstream.
The default of 0 is 500us of link training, but that's not enough for
some platforms. Decoding this correctly means we're using 2.5ms of
link training on these platforms, which fixes flickering issues
associated with enabling PSR.
v2: Unbotch the math a bit.
v3: Drop debug hunk.
v4: Improve commit message.
Tested-by: Lyude
Cc: Lyude
Bugzilla: https://bugs.freedesktop.org/show\_bug.cgi?id=95176
Cc: Rodrigo Vivi
Cc: Sonika Jindal
Cc: Durgadoss R
Cc: "Pandiyan, Dhinakaran"
Tested-by: Ville Syrjälä
Reviewed-by: Ville Syrjälä
Tested-by: fritsch@kodi.tv
Signed-off-by: Daniel Vetter
Link: http://patchwork.freedesktop.org/patch/msgid/1463590036-17824-2-git-send-email-daniel.vetter@ffwll.ch
(cherry picked from commit 50db139018f9c94376d5f4db94a3bae65fdfac14)
Signed-off-by: Jani Nikula
Signed-off-by: Greg Kroah-Hartman
commit 35cde4017ac929e8d2dae57de54f84e476e24bb3
Author: Glenn Ruben Bakke
Date: Fri Apr 22 18:06:11 2016 +0200
Bluetooth: 6lowpan: Fix memory corruption of ipv6 destination address
commit 55441070ca1cbd47ce1ad2959bbf4b47aed9b83b upstream.
The memcpy of ipv6 header destination address to the skb control block
(sbk->cb) in header\_create() results in currupted memory when bt\_xmit()
is issued. The skb->cb is "released" in the return of header\_create()
making room for lower layer to minipulate the skb->cb.
The value retrieved in bt\_xmit is not persistent across header creation
and sending, and the lower layer will overwrite portions of skb->cb,
making the copied destination address wrong.
The memory corruption will lead to non-working multicast as the first 4
bytes of the copied destination address is replaced by a value that
resolves into a non-multicast prefix.
This fix removes the dependency on the skb control block between header
creation and send, by moving the destination address memcpy to the send
function path (setup\_create, which is called from bt\_xmit).
Signed-off-by: Glenn Ruben Bakke
Acked-by: Jukka Rissanen
Signed-off-by: Marcel Holtmann
Signed-off-by: Greg Kroah-Hartman
commit 5d82a4b5bc708ab30cf41cb024f8d45b31987374
Author: Lyude
Date: Tue May 31 12:49:07 2016 -0400
drm/atomic: Verify connector->funcs != NULL when clearing states
Unfortunately since we don't have Dave's connector refcounting patch
here yet, it's very possible that drm\_atomic\_state\_default\_clear() could
get called by intel\_display\_resume() when
intel\_dp\_mst\_destroy\_connector() isn't completely finished destroying an
mst connector, but has already finished setting connector->funcs to
NULL. As such, we need to treat the connector like it's already been
destroyed and just skip it, otherwise we'll end up dereferencing a NULL
pointer.
This fix is only required for 4.6 and below. David Airlie's patchseries
for 4.7 to add connector reference counting provides a more proper fix
for this.
Changes since v1:
- Fix leftover whitespace
Upstream fix: 0552f7651bc2 ("drm/i915/mst: use reference counted
connectors. (v3)")
Reviewed-by: Daniel Vetter
Signed-off-by: Lyude
Signed-off-by: Greg Kroah-Hartman
commit 7360309ba4b5f4ae2839844748e23a157ffdc67d
Author: Lyude
Date: Tue May 31 12:49:06 2016 -0400
drm/i915: Discard previous atomic state on resume if connectors change
If an MST device is disconnected while the machine is suspended, the
number of connectors will change as well after we call
intel\_dp\_mst\_resume(). This means that any previous atomic state we had
before suspending is no longer valid, since it'll still be pointing to
missing connectors. We need to check for this before committing the
state, otherwise we'll kernel panic on resume whenever if any MST
display was disconnected before we started resuming:
BUG: unable to handle kernel NULL pointer dereference at 0000000000000008
IP: [] drm\_atomic\_helper\_check\_modeset+0x29f/0xb40 [drm\_kms\_helper]
Call Trace:
[] intel\_atomic\_check+0x34/0x1180 [i915]
[] ? mark\_held\_locks+0x6f/0xa0
[] ? trace\_hardirqs\_on\_caller+0x129/0x1b0
[] drm\_atomic\_check\_only+0x192/0x620 [drm]
[] ? pci\_pm\_thaw+0x21/0x90
[] drm\_atomic\_commit+0x17/0x60 [drm]
[] intel\_display\_resume+0xbd/0x160 [i915]
[] ? pci\_pm\_thaw+0x90/0x90
[] i915\_drm\_resume+0xd8/0x160 [i915]
[] i915\_pm\_resume+0x25/0x30 [i915]
[] pci\_pm\_resume+0x64/0xa0
[] dpm\_run\_callback+0x90/0x190
[] device\_resume+0xd5/0x1f0
[] async\_resume+0x1d/0x50
[] async\_run\_entry\_fn+0x48/0x150
[] process\_one\_work+0x1e9/0x5c0
[] ? process\_one\_work+0x166/0x5c0
[] worker\_thread+0x48/0x4e0
[] ? process\_one\_work+0x5c0/0x5c0
[] kthread+0xe4/0x100
[] ret\_from\_fork+0x22/0x50
[] ? kthread\_create\_on\_node+0x200/0x200
Changes since v1:
- Move drm\_atomic\_state\_free() call down so we're holding the
appropriate locks when destroying the atomic state
Changes since v2:
- Check that state != NULL before we start accessing it's members
This fix is only required for 4.6 and below. David Airlie's patchseries
for 4.7 to add connector reference counting provides a more proper fix
for this.
Upstream fix: 0552f7651bc2 ("drm/i915/mst: use reference counted
connectors. (v3)")
Reviewed-by: Daniel Vetter
Signed-off-by: Lyude
Signed-off-by: Greg Kroah-Hartman
commit e4eb16ab490ed87b9b67733193e39b44ba0cf07c
Author: Lyude
Date: Thu May 12 10:56:59 2016 -0400
drm/fb\_helper: Fix references to dev->mode\_config.num\_connector
commit 255f0e7c418ad95a4baeda017ae6182ba9b3c423 upstream.
During boot, MST hotplugs are generally expected (even if no physical
hotplugging occurs) and result in DRM's connector topology changing.
This means that using num\_connector from the current mode configuration
can lead to the number of connectors changing under us. This can lead to
some nasty scenarios in fbcon:
- We allocate an array to the size of dev->mode\_config.num\_connectors.
- MST hotplug occurs, dev->mode\_config.num\_connectors gets incremented.
- We try to loop through each element in the array using the new value
of dev->mode\_config.num\_connectors, and end up going out of bounds
since dev->mode\_config.num\_connectors is now larger then the array we
allocated.
fb\_helper->connector\_count however, will always remain consistent while
we do a modeset in fb\_helper.
Note: This is just polish for 4.7, Dave Airlie's drm\_connector
refcounting fixed these bugs for real. But it's good enough duct-tape
for stable kernel backporting, since backporting the refcounting
changes is way too invasive.
Signed-off-by: Lyude
[danvet: Clarify why we need this. Also remove the now unused "dev"
local variable to appease gcc.]
Signed-off-by: Daniel Vetter
Link: http://patchwork.freedesktop.org/patch/msgid/1463065021-18280-3-git-send-email-cpaul@redhat.com
Signed-off-by: Greg Kroah-Hartman
commit c266d0078d7de7b9474879df8f805d3e22474006
Author: Lyude
Date: Thu May 12 10:56:58 2016 -0400
drm/i915/fbdev: Fix num\_connector references in intel\_fb\_initial\_config()
commit 14a3842a1d5945067d1dd0788f314e14d5b18e5b upstream.
During boot time, MST devices usually send a ton of hotplug events
irregardless of whether or not any physical hotplugs actually occurred.
Hotplugs mean connectors being created/destroyed, and the number of DRM
connectors changing under us. This isn't a problem if we use
fb\_helper->connector\_count since we only set it once in the code,
however if we use num\_connector from struct drm\_mode\_config we risk it's
value changing under us. On top of that, there's even a chance that
dev->mode\_config.num\_connector != fb\_helper->connector\_count. If the
number of connectors happens to increase under us, we'll end up using
the wrong array size for memcpy and start writing beyond the actual
length of the array, occasionally resulting in kernel panics.
Note: This is just polish for 4.7, Dave Airlie's drm\_connector
refcounting fixed these bugs for real. But it's good enough duct-tape
for stable kernel backporting, since backporting the refcounting
changes is way too invasive.
Signed-off-by: Lyude
[danvet: Clarify why we need this.]
Signed-off-by: Daniel Vetter
Link: http://patchwork.freedesktop.org/patch/msgid/1463065021-18280-2-git-send-email-cpaul@redhat.com
Signed-off-by: Greg Kroah-Hartman
commit 3d6e1fd56ca52391719872fc01120bf64cf7522b
Author: Mario Kleiner
Date: Tue May 24 18:12:43 2016 +0200
drm/amdgpu: Fix hdmi deep color support.
commit 9d746ab68163d642dae13756b2b3145b2e38cb65 upstream.
When porting the hdmi deep color detection code from
radeon-kms to amdgpu-kms apparently some kind of
copy and paste error happened, attaching an else
branch to the wrong if statement.
The result is that hdmi deep color mode is always
disabled, regardless of gpu and display capabilities and
user wishes, as the code mistakenly thinks that the display
doesn't provide the required max\_tmds\_clock limit and falls
back to 8 bpc.
This patch fixes deep color support, as tested on a
R9 380 Tonga Pro + suitable display, and should be
backported to all kernels with amdgpu-kms support.
Signed-off-by: Mario Kleiner
Cc: Alex Deucher
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit 2c88c77f9f803d14c21755e39d611518aefce529
Author: Alex Deucher
Date: Mon May 2 10:24:41 2016 -0400
drm/amdgpu: use drm\_mode\_vrefresh() rather than mode->vrefresh
commit 6b8812eb004ee2b24aac8b1a711a0e8e797df3ce upstream.
This is a port of radeon commit:
3d2d98ee1af0cf6eebfbd6bff4c17d3601ac1284
drm/radeon: use drm\_mode\_vrefresh() rather than mode->vrefresh
to amdgpu.
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit 932d68f3a322c3fe86683df2d1e934542c3d99f8
Author: Thomas Hellstrom
Date: Tue May 3 11:24:35 2016 +0200
drm/vmwgfx: Kill some lockdep warnings
commit 93cd16817ae5ddcfc548784b51c76bf6d7923442 upstream.
Some global KMS state that is elsewhere protected by the mode\_config
mutex here needs to be protected with a local mutex. Remove corresponding
lockdep checks and introduce a new driver-private global\_kms\_state\_mutex,
and make sure its locking order is \*after\* the crtc locks in order to
avoid having to release those when the new mutex is taken.
Signed-off-by: Thomas Hellstrom
Reviewed-by: Brian Paul
Reviewed-by: Sinclair Yeh
Signed-off-by: Greg Kroah-Hartman
commit d0f24236341e862f3a7b0a0837efb468d9d22217
Author: Itai Handler
Date: Tue Nov 3 00:20:56 2015 +0200
drm/gma500: Fix possible out of bounds read
commit 7ccca1d5bf69fdd1d3c5fcf84faf1659a6e0ad11 upstream.
Fix possible out of bounds read, by adding missing comma.
The code may read pass the end of the dsi\_errors array
when the most significant bit (bit #31) in the intr\_stat register
is set.
This bug has been detected using CppCheck (static analysis tool).
Signed-off-by: Itai Handler
Signed-off-by: Patrik Jakobsson
Signed-off-by: Greg Kroah-Hartman
commit bb366dc9e9a440a410498b2ea08566822b4f83bf
Author: Tomáš Trnka
Date: Fri May 20 16:41:10 2016 +0200
sunrpc: fix stripping of padded MIC tokens
commit c0cb8bf3a8e4bd82e640862cdd8891400405cb89 upstream.
The length of the GSS MIC token need not be a multiple of four bytes.
It is then padded by XDR to a multiple of 4 B, but unwrap\_integ\_data()
would previously only trim mic.len + 4 B. The remaining up to three
bytes would then trigger a check in nfs4svc\_decode\_compoundargs(),
leading to a "garbage args" error and mount failure:
nfs4svc\_decode\_compoundargs: compound not properly padded!
nfsd: failed to decode arguments!
This would prevent older clients using the pre-RFC 4121 MIC format
(37-byte MIC including a 9-byte OID) from mounting exports from v3.9+
servers using krb5i.
The trimming was introduced by commit 4c190e2f913f ("sunrpc: trim off
trailing checksum before returning decrypted or integrity authenticated
buffer").
Fixes: 4c190e2f913f "unrpc: trim off trailing checksum..."
Signed-off-by: Tomáš Trnka
Acked-by: Jeff Layton
Signed-off-by: J. Bruce Fields
Signed-off-by: Greg Kroah-Hartman
commit 345de6e350883491cb53b8b5e32335c73fc993f2
Author: Juergen Gross
Date: Wed May 18 16:44:54 2016 +0200
xen: use same main loop for counting and remapping pages
commit dd14be92fbf5bc1ef7343f34968440e44e21b46a upstream.
Instead of having two functions for cycling through the E820 map in
order to count to be remapped pages and remap them later, just use one
function with a caller supplied sub-function called for each region to
be processed. This eliminates the possibility of a mismatch between
both loops which showed up in certain configurations.
Suggested-by: Ed Swierk
Signed-off-by: Juergen Gross
Signed-off-by: David Vrabel
Signed-off-by: Greg Kroah-Hartman
commit 54891d9185363de1251f64f44a12f0de173927a7
Author: Ross Lagerwall
Date: Tue May 10 16:11:00 2016 +0100
xen/events: Don't move disabled irqs
commit f0f393877c71ad227d36705d61d1e4062bc29cf5 upstream.
Commit ff1e22e7a638 ("xen/events: Mask a moving irq") open-coded
irq\_move\_irq() but left out checking if the IRQ is disabled. This broke
resuming from suspend since it tries to move a (disabled) irq without
holding the IRQ's desc->lock. Fix it by adding in a check for disabled
IRQs.
The resulting stacktrace was:
kernel BUG at /build/linux-UbQGH5/linux-4.4.0/kernel/irq/migration.c:31!
invalid opcode: 0000 [#1] SMP
Modules linked in: xenfs xen\_privcmd ...
CPU: 0 PID: 9 Comm: migration/0 Not tainted 4.4.0-22-generic #39-Ubuntu
Hardware name: Xen HVM domU, BIOS 4.6.1-xs125180 05/04/2016
task: ffff88003d75ee00 ti: ffff88003d7bc000 task.ti: ffff88003d7bc000
RIP: 0010:[] [] irq\_move\_masked\_irq+0xd2/0xe0
RSP: 0018:ffff88003d7bfc50 EFLAGS: 00010046
RAX: 0000000000000000 RBX: ffff88003d40ba00 RCX: 0000000000000001
RDX: 0000000000000001 RSI: 0000000000000100 RDI: ffff88003d40bad8
RBP: ffff88003d7bfc68 R08: 0000000000000000 R09: ffff88003d000000
R10: 0000000000000000 R11: 000000000000023c R12: ffff88003d40bad0
R13: ffffffff81f3a4a0 R14: 0000000000000010 R15: 00000000ffffffff
FS: 0000000000000000(0000) GS:ffff88003da00000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 00007fd4264de624 CR3: 0000000037922000 CR4: 00000000003406f0
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
Stack:
ffff88003d40ba38 0000000000000024 0000000000000000 ffff88003d7bfca0
ffffffff814c8d92 00000010813ef89d 00000000805ea732 0000000000000009
0000000000000024 ffff88003cc39b80 ffff88003d7bfce0 ffffffff814c8f66
Call Trace:
[] eoi\_pirq+0xb2/0xf0
[] \_\_startup\_pirq+0xe6/0x150
[] xen\_irq\_resume+0x319/0x360
[] xen\_suspend+0xb5/0x180
[] multi\_cpu\_stop+0xb5/0xe0
[] ? cpu\_stop\_queue\_work+0x80/0x80
[] cpu\_stopper\_thread+0xb0/0x140
[] ? finish\_task\_switch+0x76/0x220
[] ? \_\_raw\_callee\_save\_\_\_pv\_queued\_spin\_unlock+0x11/0x20
[] smpboot\_thread\_fn+0x105/0x160
[] ? sort\_range+0x30/0x30
[] kthread+0xd8/0xf0
[] ? kthread\_create\_on\_node+0x1e0/0x1e0
[] ret\_from\_fork+0x3f/0x70
[] ? kthread\_create\_on\_node+0x1e0/0x1e0
Signed-off-by: Ross Lagerwall
Reviewed-by: Boris Ostrovsky
Signed-off-by: David Vrabel
Signed-off-by: Greg Kroah-Hartman
commit 2b3448ce36c2d7bb02a0cf60f7e29fddb40ec70c
Author: Gavin Shan
Date: Wed Apr 27 11:14:51 2016 +1000
powerpc/eeh: Restore initial state in eeh\_pe\_reset\_and\_recover()
commit 5a0cdbfd17b90a89c64a71d8aec9773ecdb20d0d upstream.
The function eeh\_pe\_reset\_and\_recover() is used to recover EEH
error when the passthrou device are transferred to guest and
backwards. The content in the device's config space will be lost
on PE reset issued in the middle of the recovery. The function
saves/restores it before/after the reset. However, config access
to some adapters like Broadcom BCM5719 at this point will causes
fenced PHB. The config space is always blocked and we save 0xFF's
that are restored at late point. The memory BARs are totally
corrupted, causing another EEH error upon access to one of the
memory BARs.
This restores the config space on those adapters like BCM5719
from the content saved to the EEH device when it's populated,
to resolve above issue.
Fixes: 5cfb20b9 ("powerpc/eeh: Emulate EEH recovery for VFIO devices")
Signed-off-by: Gavin Shan
Reviewed-by: Russell Currey
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit 2a86408d6d1c1de0dba2587f914a05eb04c8c2da
Author: Guilherme G. Piccoli
Date: Mon Apr 11 16:17:22 2016 -0300
Revert "powerpc/eeh: Fix crash in eeh\_add\_device\_early() on Cell"
commit c2078d9ef600bdbe568c89e5ddc2c6f15b7982c8 upstream.
This reverts commit 89a51df5ab1d38b257300b8ac940bbac3bb0eb9b.
The function eeh\_add\_device\_early() is used to perform EEH
initialization in devices added later on the system, like in
hotplug/DLPAR scenarios. Since the commit 89a51df5ab1d ("powerpc/eeh:
Fix crash in eeh\_add\_device\_early() on Cell") a new check was introduced
in this function - Cell has no EEH capabilities which led to kernel oops
if hotplug was performed, so checking for eeh\_enabled() was introduced
to avoid the issue.
However, in architectures that EEH is present like pSeries or PowerNV,
we might reach a case in which no PCI devices are present on boot time
and so EEH is not initialized. Then, if a device is added via DLPAR for
example, eeh\_add\_device\_early() fails because eeh\_enabled() is false,
and EEH end up not being enabled at all.
This reverts the aforementioned patch since a new verification was
introduced by the commit d91dafc02f42 ("powerpc/eeh: Delay probing EEH
device during hotplug") and so the original Cell issue does not happen
anymore.
Reviewed-by: Gavin Shan
Signed-off-by: Guilherme G. Piccoli
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit a61001463652ec2a0113d2cd93d0c2786639a3a1
Author: Gavin Shan
Date: Wed Apr 27 11:14:50 2016 +1000
powerpc/eeh: Don't report error in eeh\_pe\_reset\_and\_recover()
commit affeb0f2d3a9af419ad7ef4ac782e1540b2f7b28 upstream.
The function eeh\_pe\_reset\_and\_recover() is used to recover EEH
error when the passthrough device are transferred to guest and
backwards, meaning the device's driver is vfio-pci or none.
When the driver is vfio-pci that provides error\_detected() error
handler only, the handler simply stops the guest and it's not
expected behaviour. On the other hand, no error handlers will
be called if we don't have a bound driver.
This ignores the error handler in eeh\_pe\_reset\_and\_recover()
that reports the error to device driver to avoid the exceptional
behaviour.
Fixes: 5cfb20b9 ("powerpc/eeh: Emulate EEH recovery for VFIO devices")
Signed-off-by: Gavin Shan
Reviewed-by: Russell Currey
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit f3dc33df76b0843af9a8ca3871fc22b103024ed8
Author: Hari Bathini
Date: Fri Apr 15 22:48:02 2016 +1000
powerpc/book3s64: Fix branching to OOL handlers in relocatable kernel
commit 8ed8ab40047a570fdd8043a40c104a57248dd3fd upstream.
Some of the interrupt vectors on 64-bit POWER server processors are only
32 bytes long (8 instructions), which is not enough for the full
first-level interrupt handler. For these we need to branch to an
out-of-line (OOL) handler. But when we are running a relocatable kernel,
interrupt vectors till \_\_end\_interrupts marker are copied down to real
address 0x100. So, branching to labels (ie. OOL handlers) outside this
section must be handled differently (see LOAD\_HANDLER()), considering
relocatable kernel, which would need at least 4 instructions.
However, branching from interrupt vector means that we corrupt the
CFAR (come-from address register) on POWER7 and later processors as
mentioned in commit 1707dd16. So, EXCEPTION\_PROLOG\_0 (6 instructions)
that contains the part up to the point where the CFAR is saved in the
PACA should be part of the short interrupt vectors before we branch out
to OOL handlers.
But as mentioned already, there are interrupt vectors on 64-bit POWER
server processors that are only 32 bytes long (like vectors 0x4f00,
0x4f20, etc.), which cannot accomodate the above two cases at the same
time owing to space constraint. Currently, in these interrupt vectors,
we simply branch out to OOL handlers, without using LOAD\_HANDLER(),
which leaves us vulnerable when running a relocatable kernel (eg. kdump
case). While this has been the case for sometime now and kdump is used
widely, we were fortunate not to see any problems so far, for three
reasons:
1. In almost all cases, production kernel (relocatable) is used for
kdump as well, which would mean that crashed kernel's OOL handler
would be at the same place where we end up branching to, from short
interrupt vector of kdump kernel.
2. Also, OOL handler was unlikely the reason for crash in almost all
the kdump scenarios, which meant we had a sane OOL handler from
crashed kernel that we branched to.
3. On most 64-bit POWER server processors, page size is large enough
that marking interrupt vector code as executable (see commit
429d2e83) leads to marking OOL handler code from crashed kernel,
that sits right below interrupt vector code from kdump kernel, as
executable as well.
Let us fix this by moving the \_\_end\_interrupts marker down past OOL
handlers to make sure that we also copy OOL handlers to real address
0x100 when running a relocatable kernel.
This fix has been tested successfully in kdump scenario, on an LPAR with
4K page size by using different default/production kernel and kdump
kernel.
Also tested by manually corrupting the OOL handlers in the first kernel
and then kdump'ing, and then causing the OOL handlers to fire - mpe.
Fixes: c1fb6816fb1b ("powerpc: Add relocation on exception vector handlers")
Signed-off-by: Hari Bathini
Signed-off-by: Mahesh Salgaonkar
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit f38db9379af750cf0d6ecf957af129100dc62a9e
Author: Sven Eckelmann
Date: Sat May 21 17:48:17 2016 +0800
batman-adv: Fix double neigh\_node\_put in batadv\_v\_ogm\_route\_update
The router is put down twice when it was non-NULL and either orig\_ifinfo is
NULL afterwards or batman-adv receives a packet with the same sequence
number. This will end up in a use-after-free when the batadv\_neigh\_node is
removed because the reference counter ended up too early at 0.
This patch is skipping netdev and is being sent directly to stable in
accordance with David S. Miller[1].
The reason is that this patch applies only on linux-4.6 and not on
linux-4.7/net because it was "accidentally" fixed by a refactoring
commit (more details in [2]).
It addresses a reference imbalance which systematically leads to a
use-after-free and then a kernel crash.
[1] https://www.mail-archive.com/b.a.t.m.a.n@lists.open-mesh.org/msg15258.html
[2] https://www.mail-archive.com/b.a.t.m.a.n@lists.open-mesh.org/msg15252.html
Fixes: 9323158ef9f4 ("batman-adv: OGMv2 - implement originators logic")
Signed-off-by: Sven Eckelmann
Signed-off-by: Antonio Quartulli
Signed-off-by: Greg Kroah-Hartman
commit 1c291d3adad88eb74a5d9a38a75266bfb527bfa2
Author: Zhao Qiang
Date: Wed Mar 9 09:48:11 2016 +0800
QE-UART: add "fsl,t1040-ucc-uart" to of\_device\_id
commit 11ca2b7ab432eb90906168c327733575e68d388f upstream.
New bindings use "fsl,t1040-ucc-uart" as the compatible for qe-uart.
So add it.
Signed-off-by: Zhao Qiang
Signed-off-by: Greg Kroah-Hartman
commit 9d6d4bc3f6346915aeba7df9653d606ba0cc1613
Author: Oleg Nesterov
Date: Mon May 23 16:23:50 2016 -0700
wait/ptrace: assume \_\_WALL if the child is traced
commit bf959931ddb88c4e4366e96dd22e68fa0db9527c upstream.
The following program (simplified version of generated by syzkaller)
#include
#include
#include
#include
#include
void \*thread\_func(void \*arg)
{
ptrace(PTRACE\_TRACEME, 0,0,0);
return 0;
}
int main(void)
{
pthread\_t thread;
if (fork())
return 0;
while (getppid() != 1)
;
pthread\_create(&thread, NULL, thread\_func, NULL);
pthread\_join(thread, NULL);
return 0;
}
creates an unreapable zombie if /sbin/init doesn't use \_\_WALL.
This is not a kernel bug, at least in a sense that everything works as
expected: debugger should reap a traced sub-thread before it can reap the
leader, but without \_\_WALL/\_\_WCLONE do\_wait() ignores sub-threads.
Unfortunately, it seems that /sbin/init in most (all?) distributions
doesn't use it and we have to change the kernel to avoid the problem.
Note also that most init's use sys\_waitid() which doesn't allow \_\_WALL, so
the necessary user-space fix is not that trivial.
This patch just adds the "ptrace" check into eligible\_child(). To some
degree this matches the "tsk->ptrace" in exit\_notify(), ->exit\_signal is
mostly ignored when the tracee reports to debugger. Or WSTOPPED, the
tracer doesn't need to set this flag to wait for the stopped tracee.
This obviously means the user-visible change: \_\_WCLONE and \_\_WALL no
longer have any meaning for debugger. And I can only hope that this won't
break something, but at least strace/gdb won't suffer.
We could make a more conservative change. Say, we can take \_\_WCLONE into
account, or !thread\_group\_leader(). But it would be nice to not
complicate these historical/confusing checks.
Signed-off-by: Oleg Nesterov
Reported-by: Dmitry Vyukov
Cc: Denys Vlasenko
Cc: Jan Kratochvil
Cc: "Michael Kerrisk (man-pages)"
Cc: Pedro Alves
Cc: Roland McGrath
Cc:
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 0784672d05684de901fc2aa56150d7ea9a475a2d
Author: Chen Feng
Date: Fri May 20 16:59:02 2016 -0700
mm/compaction.c: fix zoneindex in kcompactd()
commit 6cd9dc3e75078ef646076fa63adfb9b85ced0b66 upstream.
While testing the kcompactd in my platform 3G MEM only DMA ZONE. I
found the kcompactd never wakeup. It seems the zoneindex has already
minus 1 before. So the traverse here should be <=.
It fixes a regression where kswapd could previously compact, but
kcompactd not. Not a crash fix though.
[akpm@linux-foundation.org: fix kcompactd\_do\_work() as well, per Hugh]
Link: http://lkml.kernel.org/r/1463659121-84124-1-git-send-email-puck.chen@hisilicon.com
Fixes: accf62422b3a ("mm, kswapd: replace kswapd compaction with waking up kcompactd")
Signed-off-by: Chen Feng
Acked-by: Vlastimil Babka
Cc: Hugh Dickins
Cc: Michal Hocko
Cc: Kirill A. Shutemov
Cc: Johannes Weiner
Cc: Tejun Heo
Cc: Zhuangluan Su
Cc: Yiping Xu
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 0d6855d014e26710495baf881e277c616d67dea1
Author: Stefan Bader
Date: Fri May 20 16:58:38 2016 -0700
mm: use phys\_addr\_t for reserve\_bootmem\_region() arguments
commit 4b50bcc7eda4d3cc9e3f2a0aa60e590fedf728c5 upstream.
Since commit 92923ca3aace ("mm: meminit: only set page reserved in the
memblock region") the reserved bit is set on reserved memblock regions.
However start and end address are passed as unsigned long. This is only
32bit on i386, so it can end up marking the wrong pages reserved for
ranges at 4GB and above.
This was observed on a 32bit Xen dom0 which was booted with initial
memory set to a value below 4G but allowing to balloon in memory
(dom0\_mem=1024M for example). This would define a reserved bootmem
region for the additional memory (for example on a 8GB system there was
a reverved region covering the 4GB-8GB range). But since the addresses
were passed on as unsigned long, this was actually marking all pages
from 0 to 4GB as reserved.
Fixes: 92923ca3aacef63 ("mm: meminit: only set page reserved in the memblock region")
Link: http://lkml.kernel.org/r/1463491221-10573-1-git-send-email-stefan.bader@canonical.com
Signed-off-by: Stefan Bader
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit c5d679e43bb8a2fe7f2a1d252cca52fb08a0833d
Author: Colin Ian King
Date: Fri Mar 18 15:51:31 2016 +0000
PKCS#7: fix missing break on OID\_sha224 case
commit 06af9b0f4949b85b20107e6d75f5eba15111d220 upstream.
The OID\_sha224 case is missing a break and it falls through
to the -ENOPKG error default. Since HASH\_ALGO\_SHA224 seems
to be supported, this looks like an unintentional missing break.
Fixes: 07f081fb5057 ("PKCS#7: Add OIDs for sha224, sha284 and sha512 hash algos and use them")
Signed-off-by: Colin Ian King
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit c3373d15e99654d544c1419179b32b7892eb98df
Author: Tiffany Lin
Date: Mon Mar 14 08:16:14 2016 -0300
media: v4l2-compat-ioctl32: fix missing reserved field copy in put\_v4l2\_create32
commit baf43c6eace43868e490f18560287fa3481b2159 upstream.
In v4l2-compliance utility, test VIDIOC\_CREATE\_BUFS will check whether reserved
filed of v4l2\_create\_buffers filled with zero
Reserved field is filled with zero in v4l\_create\_bufs.
This patch copy reserved field of v4l2\_create\_buffer from kernel space to user
space
Signed-off-by: Tiffany Lin
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit de98345b2bf53e1ca92d1a7dd3ef023b752fa568
Author: Prarit Bhargava
Date: Wed May 11 12:27:16 2016 -0400
PCI: Disable all BAR sizing for devices with non-compliant BARs
commit ad67b437f187ea818b2860524d10f878fadfdd99 upstream.
b84106b4e229 ("PCI: Disable IO/MEM decoding for devices with non-compliant
BARs") disabled BAR sizing for BARs 0-5 of devices that don't comply with
the PCI spec. But it didn't do anything for expansion ROM BARs, so we
still try to size them, resulting in warnings like this on Broadwell-EP:
pci 0000:ff:12.0: BAR 6: failed to assign [mem size 0x00000001 pref]
Move the non-compliant BAR check from \_\_pci\_read\_base() up to
pci\_read\_bases() so it applies to the expansion ROM BAR as well as
to BARs 0-5.
Note that direct callers of \_\_pci\_read\_base(), like sriov\_init(), will now
bypass this check. We haven't had reports of devices with broken SR-IOV
BARs yet.
[bhelgaas: changelog]
Fixes: b84106b4e229 ("PCI: Disable IO/MEM decoding for devices with non-compliant BARs")
Signed-off-by: Prarit Bhargava
Signed-off-by: Bjorn Helgaas
CC: Thomas Gleixner
CC: Ingo Molnar
CC: "H. Peter Anvin"
CC: Andi Kleen
Signed-off-by: Greg Kroah-Hartman
commit ade217987b4122e81f0ec9569343a1655b417096
Author: Andrew Jeffery
Date: Wed Apr 20 11:24:17 2016 +0930
pinctrl: exynos5440: Use off-stack memory for pinctrl\_gpio\_range
commit 71324fdc72ef0163e57631aa814a9a81e9e4770b upstream.
The range is registered into a linked list which can be referenced
throughout the lifetime of the driver. Ensure the range's memory is useful
for the same lifetime by adding it to the driver's private data structure.
The bug was introduced in the driver's initial commit, which was present in
v3.10.
Fixes: f0b9a7e521fa ("pinctrl: exynos5440: add pinctrl driver for Samsung EXYNOS5440 SoC")
Signed-off-by: Andrew Jeffery
Acked-by: Tomasz Figa
Reviewed-by: Krzysztof Kozlowski
Signed-off-by: Linus Walleij
Signed-off-by: Greg Kroah-Hartman
commit 3f3befd020509cd9678865e7e2539318b826db98
Author: Martin Sperl
Date: Mon Feb 29 11:39:21 2016 +0000
clk: bcm2835: correctly enable fractional clock support
commit 959ca92a3235fc4b17c1e18483fc390b3d612254 upstream.
The current driver calculates the clock divider with
fractional support enabled.
But it does not enable fractional support in the
control register itself resulting in an integer only divider,
but in clk\_set\_rate responds back the fractionally divided
clock frequency.
This patch enables fractional support in the control register
whenever there is a fractional bit set in the requested clock divider.
Mash clock limits are are also handled for the PWM clock
applying the correct divider limits (2 and max\_int) applicable to
basic fractional divider support (mash order of 1).
It also adds locking to protect the read/modify/write cycle of
the register modification.
Fixes: 41691b8862e2 ("clk: bcm2835: Add support for programming the
audio domain clocks")
Signed-off-by: Martin Sperl
Signed-off-by: Eric Anholt
Reviewed-by: Eric Anholt
Signed-off-by: Greg Kroah-Hartman
commit d0559152de4bfdf2db9c800a0379e762ebc7737d
Author: Martin Sperl
Date: Mon Feb 29 11:39:20 2016 +0000
clk: bcm2835: divider value has to be 1 or more
commit 997f16bd5d2e9b3456027f96fcadfe1e2bf12f4e upstream.
Current clamping of a normal divider allows a value < 1 to be valid.
A divider of < 1 would actually only be possible if we had a PLL...
So this patch clamps the divider to 1.
Fixes: 41691b8862e2 ("clk: bcm2835: Add support for programming the
audio domain clocks")
Signed-off-by: Martin Sperl
Signed-off-by: Eric Anholt
Reviewed-by: Eric Anholt
Signed-off-by: Greg Kroah-Hartman
commit 11e3690a519143f3442491bbaed80217fdb476ba
Author: Martin Sperl
Date: Mon Feb 29 11:39:17 2016 +0000
clk: bcm2835: pll\_off should only update CM\_PLL\_ANARST
commit 6727f086cfe4ddcc651eb2bf4301abfcf619be06 upstream.
bcm2835\_pll\_off is currently assigning CM\_PLL\_ANARST to the control
register, which may lose the other bits that are currently set by the
clock dividers.
It also now locks during the read/modify/write cycle of both
registers.
Fixes: 41691b8862e2 ("clk: bcm2835: Add support for programming the
audio domain clocks")
Signed-off-by: Martin Sperl
Signed-off-by: Eric Anholt
Reviewed-by: Eric Anholt
Signed-off-by: Greg Kroah-Hartman
commit 528b498ea5e7fd6260aa457aba9335699b8a66c4
Author: Vladimir Zapolskiy
Date: Tue Mar 8 01:41:29 2016 +0200
clk: at91: fix check of clk\_register() returned value
commit cb0ceaf77d93964a0d00477c79f4499123f6159c upstream.
The clk\_register() function returns a valid pointer to struct clk or
ERR\_PTR() error code, this makes a check for returned NULL value
useless and may lead to oops on error path.
Signed-off-by: Vladimir Zapolskiy
Acked-by: Alexandre Belloni
Acked-by: Boris Brezillon
Fixes: bcc5fd49a0fd ("clk: at91: add a driver for the h32mx clock")
Signed-off-by: Stephen Boyd
Signed-off-by: Greg Kroah-Hartman
commit 4709231f7ad9fce6254e99e8ff685d26a1c6fa60
Author: Eric Anholt
Date: Wed Apr 13 13:05:03 2016 -0700
clk: bcm2835: Fix PLL poweron
commit e708b383f4b94feca2e0d5d06e1cfc13cdfea100 upstream.
In poweroff, we set the reset bit and the power down bit, but only
managed to unset the reset bit for poweron. This meant that if HDMI
did -EPROBE\_DEFER after it had grabbed its clocks, we'd power down the
PLLH (that had been on at boot time) and never recover.
Signed-off-by: Eric Anholt
Fixes: 41691b8862e2 ("clk: bcm2835: Add support for programming the audio domain clocks")
Signed-off-by: Stephen Boyd
Signed-off-by: Greg Kroah-Hartman
commit a17392e676ff43f487e15211adb464a293ebf3b3
Author: Daniel Lezcano
Date: Tue May 17 16:54:00 2016 +0200
cpuidle: Fix cpuidle\_state\_is\_coupled() argument in cpuidle\_enter()
commit e7387da52028b072489c45efeb7a916c0205ebd2 upstream.
Commit 0b89e9aa2856 (cpuidle: delay enabling interrupts until all
coupled CPUs leave idle) rightfully fixed a regression by letting
the coupled idle state framework to handle local interrupt enabling
when the CPU is exiting an idle state.
The current code checks if the idle state is coupled and, if so, it
will let the coupled code to enable interrupts. This way, it can
decrement the ready-count before handling the interrupt. This
mechanism prevents the other CPUs from waiting for a CPU which is
handling interrupts.
But the check is done against the state index returned by the back
end driver's ->enter functions which could be different from the
initial index passed as parameter to the cpuidle\_enter\_state()
function.
entered\_state = target\_state->enter(dev, drv, index);
[ ... ]
if (!cpuidle\_state\_is\_coupled(drv, entered\_state))
local\_irq\_enable();
[ ... ]
If the 'index' is referring to a coupled idle state but the
'entered\_state' is \*not\* coupled, then the interrupts are enabled
again. All CPUs blocked on the sync barrier may busy loop longer
if the CPU has interrupts to handle before decrementing the
ready-count. That's consuming more energy than saving.
Fixes: 0b89e9aa2856 (cpuidle: delay enabling interrupts until all coupled CPUs leave idle)
Signed-off-by: Daniel Lezcano
[ rjw: Subject & changelog ]
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit 1325d1ec0f9866d1aff88198cb451a9751da8ae9
Author: Dave Gerlach
Date: Tue Apr 5 14:05:38 2016 -0500
cpuidle: Indicate when a device has been unregistered
commit c998c07836f985b24361629dc98506ec7893e7a0 upstream.
Currently the 'registered' member of the cpuidle\_device struct is set
to 1 during cpuidle\_register\_device. In this same function there are
checks to see if the device is already registered to prevent duplicate
calls to register the device, but this value is never set to 0 even on
unregister of the device. Because of this, any attempt to call
cpuidle\_register\_device after a call to cpuidle\_unregister\_device will
fail which shouldn't be the case.
To prevent this, set registered to 0 when the device is unregistered.
Fixes: c878a52d3c7c (cpuidle: Check if device is already registered)
Signed-off-by: Dave Gerlach
Acked-by: Daniel Lezcano
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit 9a2a66b526e58a772b34da22af0075157cf9a7e4
Author: Ulf Hansson
Date: Fri Apr 8 13:10:23 2016 +0200
PM / Runtime: Fix error path in pm\_runtime\_force\_resume()
commit 0ae3aeefabbeef26294e7a349b51f1c761d46c9f upstream.
As pm\_runtime\_set\_active() may fail because the device's parent isn't
active, we can end up executing the ->runtime\_resume() callback for the
device when it isn't allowed.
Fix this by invoking pm\_runtime\_set\_active() before running the callback
and let's also deal with the error code.
Fixes: 37f204164dfb (PM: Add pm\_runtime\_suspend|resume\_force functions)
Signed-off-by: Ulf Hansson
Reviewed-by: Linus Walleij
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit db68cb368b918d1d6db87ae06929b19dd44f6c14
Author: Ville Syrjälä
Date: Fri Apr 22 22:38:55 2016 +0300
mfd: intel\_soc\_pmic\_core: Terminate panel control GPIO lookup table correctly
commit 36e6d081cfb2cb64e6d8e5121cffb1e62f894d36 upstream.
GPIO lookup tables are supposed to be zero terminated. Let's do that
and avoid accidentally walking off the end.
Fixes: 61dd2ca2d44e ("mfd: intel\_soc\_pmic\_core: Add lookup table for Panel Control as GPIO signal")
Signed-off-by: Ville Syrjälä
Acked-by: Linus Walleij
Acked-by: Daniel Vetter
Signed-off-by: Lee Jones
Signed-off-by: Greg Kroah-Hartman
commit 29b0aa9e376b70806ed8e018abe1645a6f641d42
Author: Heikki Krogerus
Date: Mon Apr 18 15:14:56 2016 +0300
mfd: intel-lpss: Save register context on suspend
commit 41a3da2b8e1639d983192e3650670df4ecc94cf7 upstream.
All configurations are lost and the registers will have
default values when the hardware is suspended and resumed,
so saving the private register space context on suspend, and
restoring it on resume.
Fixes: 4b45efe85263 (mfd: Add support for Intel Sunrisepoint LPSS devices)
Signed-off-by: Heikki Krogerus
Signed-off-by: Lee Jones
Signed-off-by: Greg Kroah-Hartman
commit 648dbfa6cb8a86bec2e1d8f3da1e16bb47418bed
Author: Andy Shevchenko
Date: Fri Feb 19 10:42:10 2016 +0200
mfd: intel\_quark\_i2c\_gpio: Remove clock tree on error path
commit 7f0c5ae18d649ed2f4978cbf07c02a0ff732f23e upstream.
There is a potential resource leak in case when ->probe() fails. We have to
unregister and remove clock tree which is done here.
This is a follow up to previously pushed commit c4726abce63b ("mfd:
intel\_quark\_i2c\_gpio: Use clkdev\_create()") that prevents double free() when
clkdev\_drop() followed by kfree() in devm\_kcalloc() release stage.
I leave Fixes tag here, but the backporting will require to backport the commit
c4726abce63b ("mfd: intel\_quark\_i2c\_gpio: Use clkdev\_create()") first.
Fixes: 60ae5b9f5cdd (mfd: intel\_quark\_i2c\_gpio: Add Intel Quark X1000 I2C-GPIO MFD Driver)
Signed-off-by: Andy Shevchenko
Acked-by: Stephen Boyd
Signed-off-by: Lee Jones
Signed-off-by: Greg Kroah-Hartman
commit ddce032df6a9236f3a59dacce9ee529487667fdb
Author: Akshay Bhat
Date: Mon Apr 18 15:47:53 2016 -0400
hwmon: (ads7828) Enable internal reference
commit 7a18afe8097731b8ffb6cb5b2b3b418ded77c105 upstream.
On ads7828 the internal reference defaults to off upon power up. When
using internal reference, it needs to be turned on and the voltage needs
to settle before normal conversion cycle can be started. Hence perform a
dummy read in the probe to enable the internal reference allowing the
voltage to settle before performing a normal read.
Without this fix, the first read from the ADC when using internal
reference always returns incorrect data.
Signed-off-by: Akshay Bhat
Signed-off-by: Guenter Roeck
Signed-off-by: Greg Kroah-Hartman
commit 4d8cd5e768d3f806d31364dc480b80272a4eb4d4
Author: Javier Martinez Canillas
Date: Wed Mar 23 20:59:34 2016 -0300
regulator: Try to resolve regulators supplies on registration
commit 5e3ca2b349b1e2c80b060b51bbf2af37448fad85 upstream.
Commit 6261b06de565 ("regulator: Defer lookup of supply to regulator\_get")
moved the regulator supplies lookup logic from the regulators registration
to the regulators get time.
Unfortunately, that changed the behavior of the regulator core since now a
parent supply with a child regulator marked as always-on, won't be enabled
unless a client driver attempts to get the child regulator during boot.
This patch tries to resolve the parent supply for the already registered
regulators each time that a new regulator is registered. So the regulators
that have child regulators marked as always on will be enabled regardless
if a driver gets the child regulator or not.
That was the behavior before the mentioned commit, since parent supplies
were looked up at regulator registration time instead of during child get.
Since regulator\_resolve\_supply() checks for rdev->supply, most of the times
it will be a no-op. Errors aren't checked to keep the possible out of order
dependencies which was the motivation for the mentioned commit.
Also, the supply being available will be enforced on regulator get anyways
in case the resolve fails on regulators registration.
Fixes: 6261b06de565 ("regulator: Defer lookup of supply to regulator\_get")
Suggested-by: Mark Brown
Signed-off-by: Javier Martinez Canillas
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 71a9e868f374d7d5c18144c9d5f3f2a5df42139b
Author: Raghava Aditya Renukunta
Date: Mon Apr 25 23:32:37 2016 -0700
aacraid: Fix for KDUMP driver hang
commit 78cbccd3bd683c295a44af8050797dc4a41376ff upstream.
When KDUMP is triggered the driver first talks to the firmware in INTX
mode, but the adapter firmware is still in MSIX mode. Therefore the first
driver command hangs since the driver is waiting for an INTX response and
firmware gives a MSIX response. If when the OS is installed on a RAID
drive created by the adapter KDUMP will hang since the driver does not
receive a response in sync mode.
Fixed by: Change the firmware to INTX mode if it is in MSIX mode before
sending the first sync command.
Signed-off-by: Raghava Aditya Renukunta
Reviewed-by: Johannes Thumshirn
Signed-off-by: Martin K. Petersen
Signed-off-by: Greg Kroah-Hartman
commit 6c15939124e0563880bcc0bb33c0c4f3b4301384
Author: Raghava Aditya Renukunta
Date: Mon Apr 25 23:31:57 2016 -0700
aacraid: Fix for aac\_command\_thread hang
commit fc4bf75ea300a5e62a2419f89dd0e22189dd7ab7 upstream.
Typically under error conditions, it is possible for aac\_command\_thread()
to miss the wakeup from kthread\_stop() and go back to sleep, causing it
to hang aac\_shutdown.
In the observed scenario, the adapter is not functioning correctly and so
aac\_fib\_send() never completes (or time-outs depending on how it was
called). Shortly after aac\_command\_thread() starts it performs
aac\_fib\_send(SendHostTime) which hangs. When aac\_probe\_one
/aac\_get\_adapter\_info send time outs, kthread\_stop is called which breaks
the command thread out of it's hang.
The code will still go back to sleep in schedule\_timeout() without
checking kthread\_should\_stop() so it causes aac\_probe\_one to hang until
the schedule\_timeout() which is 30 minutes.
Fixed by: Adding another kthread\_should\_stop() before schedule\_timeout()
Signed-off-by: Raghava Aditya Renukunta
Reviewed-by: Johannes Thumshirn
Signed-off-by: Martin K. Petersen
Signed-off-by: Greg Kroah-Hartman
commit 7acda5d39f4928215472181de0d135023314450c
Author: Raghava Aditya Renukunta
Date: Mon Apr 25 23:31:26 2016 -0700
aacraid: Relinquish CPU during timeout wait
commit 07beca2be24cc710461c0b131832524c9ee08910 upstream.
aac\_fib\_send has a special function case for initial commands during
driver initialization using wait < 0(pseudo sync mode). In this case,
the command does not sleep but rather spins checking for timeout.This
loop is calls cpu\_relax() in an attempt to allow other processes/threads
to use the CPU, but this function does not relinquish the CPU and so the
command will hog the processor. This was observed in a KDUMP
"crashkernel" and that prevented the "command thread" (which is
responsible for completing the command from being timed out) from
starting because it could not get the CPU.
Fixed by replacing "cpu\_relax()" call with "schedule()"
Signed-off-by: Raghava Aditya Renukunta
Reviewed-by: Johannes Thumshirn
Signed-off-by: Martin K. Petersen
Signed-off-by: Greg Kroah-Hartman
commit b3b7ad330d02ba7d6a150eeea3efae2118eca07f
Author: Raghava Aditya Renukunta
Date: Mon Apr 25 23:31:12 2016 -0700
aacraid: Start adapter after updating number of MSIX vectors
commit 116d77fea02e2a5aded7d29ba4c692774cb339f1 upstream.
The adapter has to be started after updating the number of MSIX Vectors
Fixes: ecc479e00db8 (aacraid: Set correct MSIX count for EEH recovery)
Signed-off-by: Raghava Aditya Renukunta
Reviewed-by: Johannes Thumshirn
Signed-off-by: Martin K. Petersen
Signed-off-by: Greg Kroah-Hartman
commit cc3db459b518bad266141947d903feb30e22fd6d
Author: Martin K. Petersen
Date: Mon May 9 21:39:43 2016 -0400
Revert "lpfc: Delete unnecessary checks before the function call mempool\_destroy"
commit d65c8fff867a6450c58ce31572e883148a445ddf upstream.
This reverts commit 9be321819c43417432a8376428b90fe3fe3a3510 which
caused a regression on hardware using the SLI3 interface.
Reported-by: Dick Kennedy
Signed-off-by: Martin K. Petersen
Signed-off-by: James Bottomley
Signed-off-by: Greg Kroah-Hartman
commit 5933622cae3fcf3b5c008f99bcd2b0fdb1b3e2e6
Author: wang yanqing
Date: Sat May 7 00:33:53 2016 +0800
rtlwifi: pci: use dev\_kfree\_skb\_irq instead of kfree\_skb in rtl\_pci\_reset\_trx\_ring
commit cf968937d27751296920e6b82ffa89735e3a0023 upstream.
We can't use kfree\_skb in irq disable context, because spin\_lock\_irqsave
make sure we are always in irq disable context, use dev\_kfree\_skb\_irq
instead of kfree\_skb is better than dev\_kfree\_skb\_any.
This patch fix below kernel warning:
[ 7612.095528] ------------[ cut here ]------------
[ 7612.095546] WARNING: CPU: 3 PID: 4460 at kernel/softirq.c:150 \_\_local\_bh\_enable\_ip+0x58/0x80()
[ 7612.095550] Modules linked in: rtl8723be x86\_pkg\_temp\_thermal btcoexist rtl\_pci rtlwifi rtl8723\_common
[ 7612.095567] CPU: 3 PID: 4460 Comm: ifconfig Tainted: G W 4.4.0+ #4
[ 7612.095570] Hardware name: LENOVO 20DFA04FCD/20DFA04FCD, BIOS J5ET48WW (1.19 ) 08/27/2015
[ 7612.095574] 00000000 00000000 da37fc70 c12ce7c5 00000000 da37fca0 c104cc59 c19d4454
[ 7612.095584] 00000003 0000116c c19d4784 00000096 c10508a8 c10508a8 00000200 c1b42400
[ 7612.095594] f29be780 da37fcb0 c104ccad 00000009 00000000 da37fcbc c10508a8 f21f08b8
[ 7612.095604] Call Trace:
[ 7612.095614] [] dump\_stack+0x41/0x5c
[ 7612.095620] [] warn\_slowpath\_common+0x89/0xc0
[ 7612.095628] [] ? \_\_local\_bh\_enable\_ip+0x58/0x80
[ 7612.095634] [] ? \_\_local\_bh\_enable\_ip+0x58/0x80
[ 7612.095640] [] warn\_slowpath\_null+0x1d/0x20
[ 7612.095646] [] \_\_local\_bh\_enable\_ip+0x58/0x80
[ 7612.095653] [] destroy\_conntrack+0x64/0xa0
[ 7612.095660] [] nf\_conntrack\_destroy+0xf/0x20
[ 7612.095665] [] skb\_release\_head\_state+0x55/0xa0
[ 7612.095670] [] skb\_release\_all+0xb/0x20
[ 7612.095674] [] \_\_kfree\_skb+0xb/0x60
[ 7612.095679] [] kfree\_skb+0x30/0x70
[ 7612.095686] [] ? rtl\_pci\_reset\_trx\_ring+0x22d/0x370 [rtl\_pci]
[ 7612.095692] [] rtl\_pci\_reset\_trx\_ring+0x22d/0x370 [rtl\_pci]
[ 7612.095698] [] rtl\_pci\_start+0x19/0x190 [rtl\_pci]
[ 7612.095705] [] rtl\_op\_start+0x56/0x90 [rtlwifi]
[ 7612.095712] [] drv\_start+0x36/0xc0
[ 7612.095717] [] ieee80211\_do\_open+0x2d3/0x890
[ 7612.095725] [] ? call\_netdevice\_notifiers\_info+0x2e/0x60
[ 7612.095730] [] ieee80211\_open+0x4d/0x50
[ 7612.095736] [] \_\_dev\_open+0xa3/0x130
[ 7612.095742] [] ? \_raw\_spin\_unlock\_bh+0x13/0x20
[ 7612.095748] [] \_\_dev\_change\_flags+0x89/0x140
[ 7612.095753] [] ? selinux\_capable+0xd/0x10
[ 7612.095759] [] dev\_change\_flags+0x29/0x60
[ 7612.095765] [] devinet\_ioctl+0x553/0x670
[ 7612.095772] [] ? \_copy\_to\_user+0x28/0x40
[ 7612.095777] [] inet\_ioctl+0x85/0xb0
[ 7612.095783] [] sock\_ioctl+0x67/0x260
[ 7612.095788] [] ? sock\_fasync+0x80/0x80
[ 7612.095795] [] do\_vfs\_ioctl+0x6b/0x550
[ 7612.095800] [] ? selinux\_file\_ioctl+0x102/0x1e0
[ 7612.095807] [] ? timekeeping\_suspend+0x294/0x320
[ 7612.095813] [] ? \_\_hrtimer\_run\_queues+0x14a/0x210
[ 7612.095820] [] ? security\_file\_ioctl+0x34/0x50
[ 7612.095827] [] SyS\_ioctl+0x70/0x80
[ 7612.095832] [] do\_fast\_syscall\_32+0x84/0x120
[ 7612.095839] [] sysenter\_past\_esp+0x36/0x55
[ 7612.095844] ---[ end trace 97e9c637a20e8348 ]---
Signed-off-by: Wang YanQing
Acked-by: Larry Finger
Signed-off-by: Kalle Valo
Signed-off-by: Greg Kroah-Hartman
commit 649e3cb294e6d3c6549e9342aa762973d4a9e34d
Author: wang yanqing
Date: Tue May 3 00:38:36 2016 +0800
rtlwifi: Fix logic error in enter/exit power-save mode
commit 873ffe154ae074c46ed2d72dbd9a2a99f06f55b4 upstream.
In commit a269913c52ad ("rtlwifi: Rework rtl\_lps\_leave() and
rtl\_lps\_enter() to use work queue"), the tests for enter/exit
power-save mode were inverted. With this change applied, the
wifi connection becomes much more stable.
Fixes: a269913c52ad ("rtlwifi: Rework rtl\_lps\_leave() and rtl\_lps\_enter() to use work queue")
Signed-off-by: Wang YanQing
Acked-by: Larry Finger
Signed-off-by: Kalle Valo
Signed-off-by: Greg Kroah-Hartman
commit 1f19f23ec55fd79a448dac3a8024404f1bbc0fdf
Author: Larry Finger
Date: Wed Mar 16 13:33:35 2016 -0500
rtlwifi: btcoexist: Implement antenna selection
commit baa1702290953295e421f0f433e2b1ff4815827c upstream.
The previous patch added an option to rtl8723be to manually select the
antenna for those cases when only a single antenna is present, and the
on-board EEPROM is incorrectly programmed. This patch implements the
necessary changes in the Bluetooth coexistence driver.
Signed-off-by: Larry Finger
Signed-off-by: Kalle Valo
Signed-off-by: Greg Kroah-Hartman
commit 2c00bf0046782fd9dfab7b7354e3fd322bc5a5b1
Author: Larry Finger
Date: Wed Mar 16 13:33:34 2016 -0500
rtlwifi: rtl8723be: Add antenna select module parameter
commit c18d8f5095715c56bb3cd9cba64242542632054b upstream.
A number of new laptops have been delivered with only a single antenna.
In principle, this is OK; however, a problem arises when the on-board
EEPROM is programmed to use the other antenna connection. The option
of opening the computer and moving the connector is not always possible
as it will void the warranty in some cases. In addition, this solution
breaks the Windows driver when the box dual boots Linux and Windows.
A fix involving a new module parameter has been developed. This commit
adds the new parameter and implements the changes needed for the driver.
Signed-off-by: Larry Finger
Signed-off-by: Kalle Valo
Signed-off-by: Greg Kroah-Hartman
commit c56bee3c9e5b6632e27005fda31b57b1fd4eb6a3
Author: Krzysztof Kozlowski
Date: Mon Mar 14 09:07:13 2016 +0900
hwrng: exynos - Fix unbalanced PM runtime put on timeout error path
commit f1925d78d7b710a1179828d53e918295f5f5d222 upstream.
In case of timeout during read operation, the exit path lacked PM
runtime put. This could lead to unbalanced runtime PM usage counter thus
leaving the device in an active state.
Fixes: d7fd6075a205 ("hwrng: exynos - Add timeout for waiting on init done")
Signed-off-by: Krzysztof Kozlowski
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit e2971a9b4a759546511cf9e1c56161b8dccfa9b5
Author: Joseph Salisbury
Date: Mon Mar 14 14:51:48 2016 -0400
ath5k: Change led pin configuration for compaq c700 laptop
commit 7b9bc799a445aea95f64f15e0083cb19b5789abe upstream.
BugLink: http://bugs.launchpad.net/bugs/972604
Commit 09c9bae26b0d3c9472cb6ae45010460a2cee8b8d ("ath5k: add led pin
configuration for compaq c700 laptop") added a pin configuration for the Compaq
c700 laptop. However, the polarity of the led pin is reversed. It should be
red for wifi off and blue for wifi on, but it is the opposite. This bug was
reported in the following bug report:
http://pad.lv/972604
Fixes: 09c9bae26b0d3c9472cb6ae45010460a2cee8b8d ("ath5k: add led pin configuration for compaq c700 laptop")
Signed-off-by: Joseph Salisbury
Signed-off-by: Kalle Valo
Signed-off-by: Greg Kroah-Hartman
commit 69cbb20164fb559cf65bb5987648ce99cd67f9fd
Author: Anilkumar Kolli
Date: Tue Apr 26 21:35:48 2016 +0530
ath10k: fix kernel panic, move arvifs list head init before htt init
commit 4ad24a9d83bd4bf0a85e95bf144e18d3fda4fbf1 upstream.
It is observed that while loading and unloading ath10k modules
in an infinite loop, before ath10k\_core\_start() completion HTT
rx frames are received, while processing these frames,
dereferencing the arvifs list code is getting hit before
initilizing the arvifs list, causing a kernel panic.
This patch initilizes the arvifs list before initilizing htt.
Fixes the below issue:
[] (ath10k\_htt\_rx\_pktlog\_completion\_handler+0x278/0xd08 [ath10k\_core])
[] (ath10k\_htt\_rx\_pktlog\_completion\_handler [ath10k\_core])
[] (ath10k\_htt\_txrx\_compl\_task+0x5f4/0xeb0 [ath10k\_core])
[] (ath10k\_htt\_txrx\_compl\_task [ath10k\_core])
[] (tasklet\_action+0x8c/0xec)
[] (tasklet\_action)
[] (\_\_do\_softirq+0xf8/0x228)
[] (\_\_do\_softirq) [] (run\_ksoftirqd+0x30/0x90)
Code: e5954ad8 e2899008 e1540009 0a00000d (e5943008)
---[ end trace 71de5c2e011dbf56 ]---
Kernel panic - not syncing: Fatal exception in interrupt
Fixes: 500ff9f9389d ("ath10k: implement chanctx API")
Signed-off-by: Anilkumar Kolli
Signed-off-by: Kalle Valo
Signed-off-by: Greg Kroah-Hartman
commit d75673857619d32a4819c3b3cf7193b26758db5d
Author: Rajkumar Manoharan
Date: Thu Apr 7 12:11:54 2016 +0530
ath10k: fix rx\_channel during hw reconfigure
commit 1ce8c1484e80010a6e4b9611c65668ff77556f45 upstream.
Upon firmware assert, restart work will be triggered so that mac80211
will reconfigure the driver. An issue is reported that after restart
work, survey dump data do not contain in-use (SURVEY\_INFO\_IN\_USE) info
for operating channel. During reconfigure, since mac80211 already has
valid channel context for given radio, channel context iteration return
num\_chanctx > 0. Hence rx\_channel is always NULL. Fix this by assigning
channel context to rx\_channel when driver restart is in progress.
Signed-off-by: Rajkumar Manoharan
Signed-off-by: Kalle Valo
Signed-off-by: Greg Kroah-Hartman
commit 3903f64ba2b1af67a32bba70630f87e63433a2f2
Author: Rajkumar Manoharan
Date: Wed Mar 2 20:13:52 2016 +0530
ath10k: fix firmware assert in monitor mode
commit 8a75fc54745fd3ce9062ab1cc6429a9da9ac2a68 upstream.
commit 166de3f1895d ("ath10k: remove supported chain mask") had revealed
an issue on monitor mode. Configuring NSS upon monitor interface
creation is causing target assert in all qca9888x and qca6174 firmware.
Firmware assert issue can be reproduced by below sequence even after
reverting commit 166de3f1895d ("ath10k: remove supported chain mask").
ip link set wlan0 down
iw wlan0 set type monitor
iw phy0 set antenna 7
ip link set wlan0 up
This issue is originally reported on qca9888 with 10.1 firmware.
Fixes: 5572a95b4b ("ath10k: apply chainmask settings to vdev on creation")
Reported-by: Janusz Dziedzic
Signed-off-by: Rajkumar Manoharan
Signed-off-by: Kalle Valo
Signed-off-by: Greg Kroah-Hartman
commit 1840f2b66f16df8c997ad8043c3d736e2dbce2c9
Author: Anilkumar Kolli
Date: Fri Mar 11 11:46:39 2016 +0530
ath10k: fix debugfs pktlog\_filter write
commit 9ddc486aa09a3413a6c492fcf160ce61bfccb7b1 upstream.
It is observed that, we are disabling the packet log if we write same
value to the pktlog\_filter for the second time. Always enable pktlogs
on non zero filter.
Fixes: 90174455ae05 ("ath10k: add support to configure pktlog filter")
Signed-off-by: Anilkumar Kolli
Signed-off-by: Kalle Valo
Signed-off-by: Greg Kroah-Hartman
commit 49ba5b374f6810bf4c3e0f5f3c2fa23a80d547e1
Author: Vittorio Gambaletta (VittGam)
Date: Mon Apr 11 04:48:55 2016 +0200
ath9k: Fix LED polarity for some Mini PCI AR9220 MB92 cards.
commit 0f9edcdd88a993914fa1d1dc369b35dc503979db upstream.
The Wistron DNMA-92 and Compex WLM200NX have inverted LED polarity
(active high instead of active low).
The same PCI Subsystem ID is used by both cards, which are based on
the same Atheros MB92 design.
Cc:
Cc:
Cc:
Signed-off-by: Vittorio Gambaletta
Signed-off-by: Kalle Valo
Signed-off-by: Greg Kroah-Hartman
commit 1b49828588915a38e17fd38ca97e6406444c1404
Author: Vittorio Gambaletta (VittGam)
Date: Mon Apr 11 04:48:54 2016 +0200
ath9k: Add a module parameter to invert LED polarity.
commit cd84042ce9040ad038e958bc67a46fcfc015c736 upstream.
The LED can be active high instead of active low on some hardware.
Add the led\_active\_high module parameter. It defaults to -1 to obey
platform data as before.
Setting the parameter to 1 or 0 will force the LED respectively
active high or active low.
Cc:
Cc:
Cc:
Signed-off-by: Vittorio Gambaletta
Signed-off-by: Kalle Valo
Signed-off-by: Greg Kroah-Hartman
commit a51c3d995f741a59994063d9d94f214216a8b9d4
Author: Alexander Kurz
Date: Thu Apr 14 23:30:49 2016 +0200
ARM: dts: imx35: restore existing used clock enumeration
commit 3397c2c45b1b6f54834dfeae30a73046f33ca943 upstream.
A new element got inserted into enum mx35\_clks with commit 3713e3f5e927
("clk: imx35: define two clocks for rtc"). This insertion shifted most
nummerical clock assignments to a new nummerical value which in turn
rendered most hardcoded nummeric values in imx35.dtsi incorrect.
Restore the existing order by moving the newly introduced clock to the
end of the enum. Update the dts documentation accordingly.
Signed-off-by: Alexander Kurz
Fixes: 3713e3f5e927 ("clk: imx35: define two clocks for rtc")
Signed-off-by: Shawn Guo
Signed-off-by: Greg Kroah-Hartman
commit 37278f9db951f11b200c549e4250847ca82a3e96
Author: Marek Szyprowski
Date: Fri May 6 09:27:16 2016 +0200
ARM: dts: exynos: Add interrupt line to MAX8997 PMIC on exynos4210-trats
commit 330d12764e15f6e3e94ff34cda29db96d2589c24 upstream.
MAX8997 PMIC requires interrupt and fails probing without it.
Signed-off-by: Marek Szyprowski
Fixes: d105f0b1215d ("ARM: dts: Add basic dts file for Samsung Trats board")
[k.kozlowski: Write commit message, add CC-stable]
Signed-off-by: Krzysztof Kozlowski
Signed-off-by: Greg Kroah-Hartman
commit 5d787de946242221c4eef057c84ecc85576b8292
Author: Florian Vallee
Date: Tue Apr 19 17:50:05 2016 +0200
ARM: dts: at91: fix typo in sama5d2 PIN\_PD24 description
commit b1f3a3b03eb5f61b4051e2da9aa15653e705e111 upstream.
Fix a typo on PIN\_PD24 for UTXD2 and FLEXCOM4\_IO3 which were
wrongly linked to PIN\_PD23).
Signed-off-by: Florian Vallee
Fixes: 7f16cb676c00 ("ARM: at91/dt: add sama5d2 pinmux")
[nicolas.ferre@atmel.com: add commit message, changed subject]
Signed-off-by: Nicolas Ferre
Signed-off-by: Greg Kroah-Hartman
commit eca549900e5b9ccd0d32ea27bb8d2717b54e2657
Author: Imre Kaloz
Date: Fri Jul 31 20:42:00 2015 +0200
ARM: mvebu: fix GPIO config on the Linksys boards
commit 9800917cf92f5b5fe5cae706cb70db8d014f663c upstream.
Some of the GPIO configs were wrong in the submitted DTS files,
this patch fixes all affected boards.
Signed-off-by: Imre Kaloz
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Gregory CLEMENT
commit 6a78b3ecd8219a476646682665a8b7b59d2098a7
Author: Priit Laes
Date: Thu Mar 24 21:52:17 2016 +0200
ARM: sun7i: dt: Enable dram gate 5 (tve0 clock) for simplefb TV output
commit 4b8ccef22fb547007ac38c4e5a28a773adee1e6e upstream.
Seems like dram\_gate 5 was forgotten when DRAM gating driver was added.
Add it.
Fixes: 0b4bf5a5200b (ARM: dts: sun7i: Add DRAM gates)
Signed-off-by: Priit Laes
Signed-off-by: Maxime Ripard
Signed-off-by: Greg Kroah-Hartman
commit b8f8349d497205286fd405d2fdf689a631e1f322
Author: Priit Laes
Date: Thu Mar 24 21:52:16 2016 +0200
ARM: sun4i: dt: Enable dram gate 5 (tve0 clock) for simplefb TV output
commit bec38aaafd9ec1463dd3857f02bc029707e4213d upstream.
Seems like dram\_gate 5 was forgotten when DRAM gate driver was added.
Enable it.
Fixes: 82f8582feef4 (ARM: dts: sun4i: Add DRAM gates)
Signed-off-by: Priit Laes
Signed-off-by: Maxime Ripard
Signed-off-by: Greg Kroah-Hartman
commit 786f010dc699b1c8df122ab32ef7d9899fa3fd1d
Author: Cameron Gutman
Date: Fri May 27 16:23:50 2016 -0700
Input: xpad - prevent spurious input from wired Xbox 360 controllers
commit 1ff5fa3c6732f08e01ae12f12286d4728c9e4d86 upstream.
After initially connecting a wired Xbox 360 controller or sending it
a command to change LEDs, a status/response packet is interpreted as
controller input. This causes the state of buttons represented in
byte 2 of the controller data packet to be incorrect until the next
valid input packet. Wireless Xbox 360 controllers are not affected.
Writing a new value to the LED device while holding the Start button
and running jstest is sufficient to reproduce this bug. An event will
come through with the Start button released.
Xboxdrv also won't attempt to read controller input from a packet
where byte 0 is non-zero. It also checks that byte 1 is 0x14, but
that value differs between wired and wireless controllers and this
code is shared by both. I think just checking byte 0 is enough to
eliminate unwanted packets.
The following are some examples of 3-byte status packets I saw:
01 03 02
02 03 00
03 03 03
08 03 00
Signed-off-by: Cameron Gutman
Signed-off-by: Pavel Rojtberg
Signed-off-by: Dmitry Torokhov
Signed-off-by: Greg Kroah-Hartman
commit a7b4508f0af855bf70fbbad0b90a522a23af601a
Author: Pavel Rojtberg
Date: Fri May 27 16:22:25 2016 -0700
Input: xpad - move pending clear to the correct location
commit 4efc6939a83c54fb3417541be48991afd0290ba3 upstream.
otherwise we lose ff commands: https://github.com/paroj/xpad/issues/27
Signed-off-by: Pavel Rojtberg
Signed-off-by: Dmitry Torokhov
Signed-off-by: Greg Kroah-Hartman
commit 3c9fd4b43979b7ece47a6b2f81518f0be43d21a8
Author: Ricky Liang
Date: Fri May 20 10:58:59 2016 -0700
Input: uinput - handle compat ioctl for UI\_SET\_PHYS
commit affa80bd97f7ca282d1faa91667b3ee9e4c590e6 upstream.
When running a 32-bit userspace on a 64-bit kernel, the UI\_SET\_PHYS
ioctl needs to be treated with special care, as it has the pointer
size encoded in the command.
Signed-off-by: Ricky Liang
Signed-off-by: Dmitry Torokhov
Signed-off-by: Greg Kroah-Hartman
commit 9982464a668d468789f80b761b7d43b11a44768c
Author: Mark Brown
Date: Wed May 18 18:30:39 2016 +0100
ASoC: ak4642: Enable cache usage to fix crashes on resume
commit d3030d11961a8c103cf07aed59905276ddfc06c2 upstream.
The ak4642 driver is using a regmap cache sync to restore the
configuration of the chip on resume but (as Peter observed) does not
actually define a register cache which means that the resume is never
going to work and we trigger asserts in regmap. Fix this by enabling
caching.
Reported-by: Geert Uytterhoeven
Reported-by: Peter Ujfalusi
Tested-by: Geert Uytterhoeven
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit ecd717314e55bf12a2c1c0ada51b3b888f2403b1
Author: Mikulas Patocka
Date: Tue May 24 22:48:33 2016 +0200
affs: fix remount failure when there are no options changed
commit 01d6e08711bf90bc4d7ead14a93a0cbd73b1896a upstream.
Commit c8f33d0bec99 ("affs: kstrdup() memory handling") checks if the
kstrdup function returns NULL due to out-of-memory condition.
However, if we are remounting a filesystem with no change to
filesystem-specific options, the parameter data is NULL. In this case,
kstrdup returns NULL (because it was passed NULL parameter), although no
out of memory condition exists. The mount syscall then fails with
ENOMEM.
This patch fixes the bug. We fail with ENOMEM only if data is non-NULL.
The patch also changes the call to replace\_mount\_options - if we didn't
pass any filesystem-specific options, we don't call
replace\_mount\_options (thus we don't erase existing reported options).
Fixes: c8f33d0bec99 ("affs: kstrdup() memory handling")
Signed-off-by: Mikulas Patocka
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 5e1ff12114cf7788ef1355d0f388c2f84aac090e
Author: Maciej W. Rozycki
Date: Thu May 26 12:55:45 2016 +0100
MIPS: VDSO: Build with `-fno-strict-aliasing'
commit 94cc36b84acc29f543b48bc5ed786011b112a666 upstream.
Avoid an aliasing issue causing a build error in VDSO:
In file included from include/linux/srcu.h:34:0,
from include/linux/notifier.h:15,
from ./arch/mips/include/asm/uprobes.h:9,
from include/linux/uprobes.h:61,
from include/linux/mm\_types.h:13,
from ./arch/mips/include/asm/vdso.h:14,
from arch/mips/vdso/vdso.h:27,
from arch/mips/vdso/gettimeofday.c:11:
include/linux/workqueue.h: In function 'work\_static':
include/linux/workqueue.h:186:2: error: dereferencing type-punned pointer will break strict-aliasing rules [-Werror=strict-aliasing]
return \*work\_data\_bits(work) & WORK\_STRUCT\_STATIC;
^
cc1: all warnings being treated as errors
make[2]: \*\*\* [arch/mips/vdso/gettimeofday.o] Error 1
with a CONFIG\_DEBUG\_OBJECTS\_WORK configuration and GCC 5.2.0. Include
`-fno-strict-aliasing' along with compiler options used, as required for
kernel code, fixing a problem present since the introduction of VDSO
with commit ebb5e78cc634 ("MIPS: Initial implementation of a VDSO").
Thanks to Tejun for diagnosing this properly!
Signed-off-by: Maciej W. Rozycki
Reviewed-by: James Hogan
Fixes: ebb5e78cc634 ("MIPS: Initial implementation of a VDSO")
Cc: Tejun Heo
Cc: linux-mips@linux-mips.org
Patchwork: https://patchwork.linux-mips.org/patch/13357/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit f4daf9b84e750c76b10b10adc9ec241062f844e3
Author: Harvey Hunt
Date: Wed May 25 11:06:35 2016 +0100
MIPS: lib: Mark intrinsics notrace
commit aedcfbe06558a9f53002e82d5be64c6c94687726 upstream.
On certain MIPS32 devices, the ftrace tracer "function\_graph" uses
\_\_lshrdi3() during the capturing of trace data. ftrace then attempts to
trace \_\_lshrdi3() which leads to infinite recursion and a stack overflow.
Fix this by marking \_\_lshrdi3() as notrace. Mark the other compiler
intrinsics as notrace in case the compiler decides to use them in the
ftrace path.
Signed-off-by: Harvey Hunt
Cc:
Cc:
Patchwork: https://patchwork.linux-mips.org/patch/13354/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 4a75432acfd4b7635f623dd1d98f99e0fe49a457
Author: James Hogan
Date: Tue May 24 09:35:11 2016 +0100
MIPS: Build microMIPS VDSO for microMIPS kernels
commit bb93078e655be1e24d68f28f2756676e62c037ce upstream.
MicroMIPS kernels may be expected to run on microMIPS only cores which
don't support the normal MIPS instruction set, so be sure to pass the
-mmicromips flag through to the VDSO cflags.
Fixes: ebb5e78cc634 ("MIPS: Initial implementation of a VDSO")
Signed-off-by: James Hogan
Cc: Paul Burton
Cc: linux-mips@linux-mips.org
Patchwork: https://patchwork.linux-mips.org/patch/13349/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 9a2fdd0483e1780e4665b94d97a55602b5fbcdc4
Author: James Hogan
Date: Tue May 24 09:35:10 2016 +0100
MIPS: Fix sigreturn via VDSO on microMIPS kernel
commit 13eb192d10bcc9ac518d57356179071d603bcb4e upstream.
In microMIPS kernels, handle\_signal() sets the isa16 mode bit in the
vdso address so that the sigreturn trampolines (which are offset from
the VDSO) get executed as microMIPS.
However commit ebb5e78cc634 ("MIPS: Initial implementation of a VDSO")
changed the offsets to come from the VDSO image, which already have the
isa16 mode bit set correctly since they're extracted from the VDSO
shared library symbol table.
Drop the isa16 mode bit handling from handle\_signal() to fix sigreturn
for cores which support both microMIPS and normal MIPS. This doesn't fix
microMIPS only cores, since the VDSO is still built for normal MIPS, but
thats a separate problem.
Fixes: ebb5e78cc634 ("MIPS: Initial implementation of a VDSO")
Signed-off-by: James Hogan
Cc: Paul Burton
Cc: linux-mips@linux-mips.org
Patchwork: https://patchwork.linux-mips.org/patch/13348/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 0fe690fa3b0cda04a49f9e94ef8634f01e8921a7
Author: Maciej W. Rozycki
Date: Thu May 12 10:19:08 2016 +0100
MIPS: ptrace: Prevent writes to read-only FCSR bits
commit abf378be49f38c4d3e23581d3df3fa9f1b1b11d2 upstream.
Correct the cases missed with commit 9b26616c8d9d ("MIPS: Respect the
ISA level in FCSR handling") and prevent writes to read-only FCSR bits
there.
This in particular applies to FP context initialisation where any IEEE
754-2008 bits preset by `mips\_set\_personality\_nan' are cleared before
the relevant ptrace(2) call takes effect and the PTRACE\_POKEUSR request
addressing FPC\_CSR where no masking of read-only FCSR bits is done.
Remove the FCSR clearing from FP context initialisation then and unify
PTRACE\_POKEUSR/FPC\_CSR and PTRACE\_SETFPREGS handling, by factoring out
code from `ptrace\_setfpregs' and calling it from both places.
This mostly matters to soft float configurations where the emulator can
be switched this way to a mode which should not be accessible and cannot
be set with the CTC1 instruction. With hard float configurations any
effect is transient anyway as read-only bits will retain their values at
the time the FP context is restored.
Signed-off-by: Maciej W. Rozycki
Cc: linux-mips@linux-mips.org
Patchwork: https://patchwork.linux-mips.org/patch/13239/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 664ebbd2b71918abe54b137f0ab3876bb3d4519c
Author: Maciej W. Rozycki
Date: Thu May 12 10:18:27 2016 +0100
MIPS: ptrace: Fix FP context restoration FCSR regression
commit 4249548454f7ba4581aeee26bd83f42b48a14d15 upstream.
Fix a floating-point context restoration regression introduced with
commit 9b26616c8d9d ("MIPS: Respect the ISA level in FCSR handling")
that causes a Floating Point exception and consequently a kernel oops
with hard float configurations when one or more FCSR Enable and their
corresponding Cause bits are set both at a time via a ptrace(2) call.
To do so reinstate Cause bit masking originally introduced with commit
b1442d39fac2 ("MIPS: Prevent user from setting FCSR cause bits") to
address this exact problem and then inadvertently removed from the
PTRACE\_SETFPREGS request with the commit referred above.
Signed-off-by: Maciej W. Rozycki
Cc: linux-mips@linux-mips.org
Patchwork: https://patchwork.linux-mips.org/patch/13238/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit a2f8254a071f9890eff771ff8e4f4e0cb9bcde18
Author: Paul Burton
Date: Thu Apr 21 12:43:57 2016 +0100
MIPS: Disable preemption during prctl(PR\_SET\_FP\_MODE, ...)
commit bd239f1e1429e7781096bf3884bdb1b2b1bb4f28 upstream.
Whilst a PR\_SET\_FP\_MODE prctl is performed there are decisions made
based upon whether the task is executing on the current CPU. This may
change if we're preempted, so disable preemption to avoid such changes
for the lifetime of the mode switch.
Signed-off-by: Paul Burton
Fixes: 9791554b45a2 ("MIPS,prctl: add PR\_[GS]ET\_FP\_MODE prctl options for MIPS")
Reviewed-by: Maciej W. Rozycki
Tested-by: Aurelien Jarno
Cc: Adam Buchbinder
Cc: James Hogan
Cc: linux-mips@linux-mips.org
Cc: linux-kernel@vger.kernel.org
Patchwork: https://patchwork.linux-mips.org/patch/13144/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit d1692853620495e30f7af687a917d61a2d3efe81
Author: Paul Burton
Date: Thu Apr 21 18:04:53 2016 +0100
MIPS: Prevent "restoration" of MSA context in non-MSA kernels
commit 6533af4d4831c421cd9aa4dce7cfc19a3514cc09 upstream.
If a kernel doesn't support MSA context (ie. CONFIG\_CPU\_HAS\_MSA=n) then
it will only keep 64 bits per FP register in thread context, and the
calls to set\_fpr64 in restore\_msa\_extcontext will overrun the end of the
FP register context into the FCSR & MSACSR values. GCC 6.x has become
smart enough to detect this & complain like so:
arch/mips/kernel/signal.c: In function 'protected\_restore\_fp\_context':
./arch/mips/include/asm/processor.h:114:17: error: array subscript is above array bounds [-Werror=array-bounds]
fpr->val##width[FPR\_IDX(width, idx)] = val; \
~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~
./arch/mips/include/asm/processor.h:118:1: note: in expansion of macro 'BUILD\_FPR\_ACCESS'
BUILD\_FPR\_ACCESS(64)
The only way to trigger this code to run would be for a program to set
up an artificial extended MSA context structure following a sigframe &
execute sigreturn. Whilst this doesn't allow a program to write to any
state that it couldn't already, it makes little sense to allow this
"restoration" of MSA context in a system that doesn't support MSA.
Fix this by killing a program with SIGSYS if it tries something as crazy
as "restoring" fake MSA context in this way, also fixing the build error
& allowing for most of restore\_msa\_extcontext to be optimised out of
kernels without support for MSA.
Signed-off-by: Paul Burton
Reported-by: Michal Toman
Fixes: bf82cb30c7e5 ("MIPS: Save MSA extended context around signals")
Tested-by: Aaro Koskinen
Cc: James Hogan
Cc: Michal Toman
Cc: linux-mips@linux-mips.org
Patchwork: https://patchwork.linux-mips.org/patch/13164/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 2f8a8e57f9ed9044b9890521744a19ea7a215d1f
Author: Paul Burton
Date: Thu Apr 21 12:43:58 2016 +0100
MIPS: Force CPUs to lose FP context during mode switches
commit 6b8322576e9d325b65c54fbef64e4e8690ad70ce upstream.
Commit 9791554b45a2 ("MIPS,prctl: add PR\_[GS]ET\_FP\_MODE prctl options
for MIPS") added support for the PR\_SET\_FP\_MODE prctl, which allows a
userland program to modify its FP mode at runtime. This is most notably
required if dynamic linking leads to the FP mode requirement changing at
runtime from that indicated in the initial executable's ELF header. In
order to avoid overhead in the general FP context restore code, it aimed
to have threads in the process become unable to enable the FPU during a
mode switch & have the thread calling the prctl syscall wait for all
other threads in the process to be context switched at least once. Once
that happens we can know that no thread in the process whose mode will
be switched has live FP context, and it's safe to perform the mode
switch. However in the (rare) case of modeswitches occurring in
multithreaded programs this can lead to indeterminate delays for the
thread invoking the prctl syscall, and the code monitoring for those
context switches was woefully inadequate for all but the simplest cases.
Fix this by broadcasting an IPI if other CPUs may have live FP context
for an affected thread, with a handler causing those CPUs to relinquish
their FPU ownership. Threads will then be allowed to continue running
but will stall on the wait\_on\_atomic\_t in enable\_restore\_fp\_context if
they attempt to use FP again whilst the mode switch is still in
progress. The end result is less fragile poking at scheduler context
switch counts & a more expedient completion of the mode switch.
Signed-off-by: Paul Burton
Fixes: 9791554b45a2 ("MIPS,prctl: add PR\_[GS]ET\_FP\_MODE prctl options for MIPS")
Reviewed-by: Maciej W. Rozycki
Cc: Adam Buchbinder
Cc: James Hogan
Cc: linux-mips@linux-mips.org
Cc: linux-kernel@vger.kernel.org
Patchwork: https://patchwork.linux-mips.org/patch/13145/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit bab73d27b323eb9db1e4b54a393f4f97ceb593bc
Author: James Hogan
Date: Fri Apr 15 10:07:24 2016 +0100
MIPS: Fix MSA ld\_\*/st\_\* asm macros to use PTR\_ADDU
commit ea1688573426adc2587ed52d086b51c7c62eaca3 upstream.
The MSA ld\_\*/st\_\* assembler macros for when the toolchain doesn't
support MSA use addu to offset the base address. However it is a virtual
memory pointer so fix it to use PTR\_ADDU which expands to daddu for
64-bit kernels.
Signed-off-by: James Hogan
Cc: Paul Burton
Cc: linux-mips@linux-mips.org
Patchwork: https://patchwork.linux-mips.org/patch/13062/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit c841b82e735c2784e29b4472afb52c06433403c7
Author: Paul Burton
Date: Fri Apr 15 10:07:23 2016 +0100
MIPS: Use copy\_s.fmt rather than copy\_u.fmt
commit 8a3c8b48aca8771bff3536e40aa26ffb311699d1 upstream.
In revision 1.12 of the MSA specification, the copy\_u.w instruction has
been removed for MIPS32 & the copy\_u.d instruction has been removed for
MIPS64. Newer toolchains (eg. Codescape SDK essentials 2015.10) will
complain about this like so:
arch/mips/kernel/r4k\_fpu.S:290: Error: opcode not supported on this
processor: mips32r2 (mips32r2) `copy\_u.w $1,$w26[3]'
Since we always copy to the width of a GPR, simply use copy\_s instead of
copy\_u to fix this.
Signed-off-by: Paul Burton
Signed-off-by: James Hogan
Cc: linux-mips@linux-mips.org
Patchwork: https://patchwork.linux-mips.org/patch/13061/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 990a6023ee81c91ed333dfccef03843fe2b73ceb
Author: Huacai Chen
Date: Thu Mar 17 20:41:05 2016 +0800
MIPS: Loongson-3: Reserve 32MB for RS780E integrated GPU
commit 3484de7bcbed20ecbf2b8d80671619e7059e2dd7 upstream.
Due to datasheet, reserving 0xff800000~0xffffffff (8MB below 4GB) is
not enough for RS780E integrated GPU's TOM (top of memory) registers
and MSI/MSI-x memory region, so we reserve 0xfe000000~0xffffffff (32MB
below 4GB).
Signed-off-by: Huacai Chen
Cc: Aurelien Jarno
Cc: Steven J . Hill
Cc: Fuxin Zhang
Cc: Zhangjin Wu
Cc: linux-mips@linux-mips.org
Patchwork: https://patchwork.linux-mips.org/patch/12889/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit ed58c916ae90af0e8e6156435c09dad18051f88c
Author: Huacai Chen
Date: Thu Mar 17 20:37:10 2016 +0800
MIPS: Reserve nosave data for hibernation
commit a95d069204e178f18476f5499abab0d0d9cbc32c upstream.
After commit 92923ca3aacef63c92d ("mm: meminit: only set page reserved
in the memblock region"), the MIPS hibernation is broken. Because pages
in nosave data section should be "reserved", but currently they aren't
set to "reserved" at initialization. This patch makes hibernation work
again.
Signed-off-by: Huacai Chen
Cc: Aurelien Jarno
Cc: Steven J . Hill
Cc: Fuxin Zhang
Cc: Zhangjin Wu
Cc: linux-mips@linux-mips.org
Patchwork: https://patchwork.linux-mips.org/patch/12888/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 5bc4ddc789664910d5e599d35091901fbb4279e4
Author: Matthias Schiffer
Date: Thu Mar 24 16:02:52 2016 +0100
MIPS: ath79: make bootconsole wait for both THRE and TEMT
commit f5b556c94c8490d42fea79d7b4ae0ecbc291e69d upstream.
This makes the ath79 bootconsole behave the same way as the generic 8250
bootconsole.
Also waiting for TEMT (transmit buffer is empty) instead of just THRE
(transmit buffer is not full) ensures that all characters have been
transmitted before the real serial driver starts reconfiguring the serial
controller (which would sometimes result in garbage being transmitted.)
This change does not cause a visible performance loss.
In addition, this seems to fix a hang observed in certain configurations on
many AR7xxx/AR9xxx SoCs during autoconfig of the real serial driver.
A more complete follow-up patch will disable 8250 autoconfig for ath79
altogether (the serial controller is detected as a 16550A, which is not
fully compatible with the ath79 serial, and the autoconfig may lead to
undefined behavior on ath79.)
Signed-off-by: Matthias Schiffer
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Greg Kroah-Hartman
commit 599eacdcc7fb5539dc36c2f5219d3da8ae7fd0b3
Author: Huacai Chen
Date: Thu Mar 17 20:41:06 2016 +0800
MIPS: Loongson-3: Fix build error after ld-version.sh modification
commit 820880cdba0137baff6cc0e828c3c418c363ae44 upstream.
Commit d5ece1cb074b2c ("Fix ld-version.sh to handle large 3rd version
part") modifies the ld version description. This causes a build error
on Loongson-3, so fix it.
Signed-off-by: Huacai Chen
Cc: Aurelien Jarno
Cc: Steven J . Hill
Cc: Fuxin Zhang
Cc: Zhangjin Wu
Cc: Huacai Chen
Cc: linux-mips@linux-mips.org
Patchwork: https://patchwork.linux-mips.org/patch/12890/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 404cb7fb23d3f6a1dd7ccc3f2df9d80a96d92355
Author: Paul Burton
Date: Tue Mar 1 02:37:59 2016 +0000
MIPS: Sync icache & dcache in set\_pte\_at
commit 37d22a0d798b5c938b277d32cfd86dc231381342 upstream.
It's possible for pages to become visible prior to update\_mmu\_cache
running if a thread within the same address space preempts the current
thread or runs simultaneously on another CPU. That is, the following
scenario is possible:
CPU0 CPU1
write to page
flush\_dcache\_page
flush\_icache\_page
set\_pte\_at
map page
update\_mmu\_cache
If CPU1 maps the page in between CPU0's set\_pte\_at, which marks it valid
& visible, and update\_mmu\_cache where the dcache flush occurs then CPU1s
icache will fill from stale data (unless it fills from the dcache, in
which case all is good, but most MIPS CPUs don't have this property).
Commit 4d46a67a3eb8 ("MIPS: Fix race condition in lazy cache flushing.")
attempted to fix that by performing the dcache flush in
flush\_icache\_page such that it occurs before the set\_pte\_at call makes
the page visible. However it has the problem that not all code that
writes to pages exposed to userland call flush\_icache\_page. There are
many callers of set\_pte\_at under mm/ and only 2 of them do call
flush\_icache\_page. Thus the race window between a page becoming visible
& being coherent between the icache & dcache remains open in some cases.
To illustrate some of the cases, a WARN was added to \_\_update\_cache with
this patch applied that triggered in cases where a page about to be
flushed from the dcache was not the last page provided to
flush\_icache\_page. That is, backtraces were obtained for cases in which
the race window is left open without this patch. The 2 standout examples
follow.
When forking a process:
[ 15.271842] [<80417630>] \_\_update\_cache+0xcc/0x188
[ 15.277274] [<80530394>] copy\_page\_range+0x56c/0x6ac
[ 15.282861] [<8042936c>] copy\_process.part.54+0xd40/0x17ac
[ 15.289028] [<80429f80>] do\_fork+0xe4/0x420
[ 15.293747] [<80413808>] handle\_sys+0x128/0x14c
When exec'ing an ELF binary:
[ 14.445964] [<80417630>] \_\_update\_cache+0xcc/0x188
[ 14.451369] [<80538d88>] move\_page\_tables+0x414/0x498
[ 14.457075] [<8055d848>] setup\_arg\_pages+0x220/0x318
[ 14.462685] [<805b0f38>] load\_elf\_binary+0x530/0x12a0
[ 14.468374] [<8055ec3c>] search\_binary\_handler+0xbc/0x214
[ 14.474444] [<8055f6c0>] do\_execveat\_common+0x43c/0x67c
[ 14.480324] [<8055f938>] do\_execve+0x38/0x44
[ 14.485137] [<80413808>] handle\_sys+0x128/0x14c
These code paths write into a page, call flush\_dcache\_page then call
set\_pte\_at without flush\_icache\_page inbetween. The end result is that
the icache can become corrupted & userland processes may execute
unexpected or invalid code, typically resulting in a reserved
instruction exception, a trap or a segfault.
Fix this race condition fully by performing any cache maintenance
required to keep the icache & dcache in sync in set\_pte\_at, before the
page is made valid. This has the added bonus of ensuring the cache
maintenance always happens in one location, rather than being duplicated
in flush\_icache\_page & update\_mmu\_cache. It also matches the way other
architectures solve the same problem (see arm, ia64 & powerpc).
Signed-off-by: Paul Burton
Reported-by: Ionela Voinescu
Cc: Lars Persson
Fixes: 4d46a67a3eb8 ("MIPS: Fix race condition in lazy cache flushing.")
Cc: Steven J. Hill
Cc: David Daney
Cc: Huacai Chen
Cc: Aneesh Kumar K.V
Cc: Andrew Morton
Cc: Jerome Marchand
Cc: Kirill A. Shutemov
Cc: linux-mips@linux-mips.org
Cc: linux-kernel@vger.kernel.org
Patchwork: https://patchwork.linux-mips.org/patch/12722/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit f497b77b0e907a752b11546337099150db7e1786
Author: Paul Burton
Date: Tue Mar 1 02:37:58 2016 +0000
MIPS: Handle highmem pages in \_\_update\_cache
commit f4281bba818105c7c91799abe40bc05c0dbdaa25 upstream.
The following patch will expose \_\_update\_cache to highmem pages. Handle
them by mapping them in for the duration of the cache maintenance, just
like in \_\_flush\_dcache\_page. The code for that isn't shared because we
need the page address in \_\_update\_cache so sharing became messy. Given
that the entirity is an extra 5 lines, just duplicate it.
Signed-off-by: Paul Burton
Cc: Lars Persson
Cc: Andrew Morton
Cc: Jerome Marchand
Cc: Kirill A. Shutemov
Cc: linux-mips@linux-mips.org
Cc: linux-kernel@vger.kernel.org
Patchwork: https://patchwork.linux-mips.org/patch/12721/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 7b35229a6d6458c5b2a424470ff1280378d33192
Author: Paul Burton
Date: Tue Mar 1 02:37:57 2016 +0000
MIPS: Flush highmem pages in \_\_flush\_dcache\_page
commit 234859e49a15323cf1b2331bdde7f658c4cb45fb upstream.
When flush\_dcache\_page is called on an executable page, that page is
about to be provided to userland & we can presume that the icache
contains no valid entries for its address range. However if the icache
does not fill from the dcache then we cannot presume that the pages
content has been written back as far as the memories that the dcache
will fill from (ie. L2 or further out).
This was being done for lowmem pages, but not for highmem which can lead
to icache corruption. Fix this by mapping highmem pages & flushing their
content from the dcache in \_\_flush\_dcache\_page before providing the page
to userland, just as is done for lowmem pages.
Signed-off-by: Paul Burton
Cc: Lars Persson
Cc: Andrew Morton
Cc: Kirill A. Shutemov
Cc: linux-mips@linux-mips.org
Cc: linux-kernel@vger.kernel.org
Patchwork: https://patchwork.linux-mips.org/patch/12720/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit a82fdd38d226913e5b0113582b40b8b75c81e3b2
Author: James Hogan
Date: Tue Mar 1 22:19:36 2016 +0000
MIPS: Fix watchpoint restoration
commit a7e89326b415b5d81c4b1016fd4a40db861eb58d upstream.
Commit f51246efee2b ("MIPS: Get rid of finish\_arch\_switch().") moved the
\_\_restore\_watch() call from finish\_arch\_switch() (i.e. after resume()
returns) to before the resume() call in switch\_to(). This results in
watchpoints only being restored when a task is descheduled, preventing
the watchpoints from being effective most of the time, except due to
chance before the watchpoints are lazily removed.
Fix the call sequence from switch\_to() through to
mips\_install\_watch\_registers() to pass the task\_struct pointer of the
next task, instead of using current. This allows the watchpoints for the
next (non-current) task to be restored without reintroducing
finish\_arch\_switch().
Fixes: f51246efee2b ("MIPS: Get rid of finish\_arch\_switch().")
Signed-off-by: James Hogan
Cc: Paul Burton
Cc: linux-mips@linux-mips.org
Patchwork: https://patchwork.linux-mips.org/patch/12726/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 2dfc57bd1228a926ac9489d90e1d21d6be0738c6
Author: James Hogan
Date: Mon Feb 8 18:43:51 2016 +0000
MIPS: Fix uapi include in exported asm/siginfo.h
commit 987e5b834467c9251ca584febda65ef8f66351a9 upstream.
Since commit 8cb48fe169dd ("MIPS: Provide correct siginfo\_t.si\_stime"),
MIPS' uapi/asm/siginfo.h has included uapi/asm-generic/siginfo.h
directly before defining MIPS' struct siginfo, in order to get the
necessary definitions needed for the siginfo struct without the generic
copy\_siginfo() hitting compiler errors due to struct siginfo not yet
being defined.
Now that the generic copy\_siginfo() is moved out to linux/signal.h we
can safely include asm-generic/siginfo.h before defining the MIPS
specific struct siginfo, which avoids the uapi/ include as well as
breakage due to generic copy\_siginfo() being defined before struct
siginfo.
Reported-by: Christopher Ferris
Fixes: 8cb48fe169dd ("MIPS: Provide correct siginfo\_t.si\_stime")
Signed-off-by: James Hogan
Cc: Petr Malat
Cc: linux-mips@linux-mips.org
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 5cff029679bce51bd181f54c93a8533177d66fd8
Author: James Hogan
Date: Mon Feb 8 18:43:49 2016 +0000
MIPS: Fix siginfo.h to use strict posix types
commit 5daebc477da4dfeb31ae193d83084def58fd2697 upstream.
Commit 85efde6f4e0d ("make exported headers use strict posix types")
changed the asm-generic siginfo.h to use the \_\_kernel\_\* types, and
commit 3a471cbc081b ("remove \_\_KERNEL\_STRICT\_NAMES") make the internal
types accessible only to the kernel, but the MIPS implementation hasn't
been updated to match.
Switch to proper types now so that the exported asm/siginfo.h won't
produce quite so many compiler errors when included alone by a user
program.
Signed-off-by: James Hogan
Cc: Christopher Ferris
Cc: linux-mips@linux-mips.org
Cc: linux-kernel@vger.kernel.org
Patchwork: https://patchwork.linux-mips.org/patch/12477/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit fd03fca280b377adea93eed19fb6bc3d26ee596a
Author: James Hogan
Date: Fri Dec 4 22:25:02 2015 +0000
MIPS: Avoid using unwind\_stack() with usermode
commit 81a76d7119f63c359750e4adeff922a31ad1135f upstream.
When showing backtraces in response to traps, for example crashes and
address errors (usually unaligned accesses) when they are set in debugfs
to be reported, unwind\_stack will be used if the PC was in the kernel
text address range. However since EVA it is possible for user and kernel
address ranges to overlap, and even without EVA userland can still
trigger an address error by jumping to a KSeg0 address.
Adjust the check to also ensure that it was running in kernel mode. I
don't believe any harm can come of this problem, since unwind\_stack() is
sufficiently defensive, however it is only meant for unwinding kernel
code, so to be correct it should use the raw backtracing instead.
Signed-off-by: James Hogan
Reviewed-by: Leonid Yegoshin
Cc: linux-mips@linux-mips.org
Patchwork: https://patchwork.linux-mips.org/patch/11701/
Signed-off-by: Ralf Baechle
(cherry picked from commit d2941a975ac745c607dfb590e92bb30bc352dad9)
Signed-off-by: Greg Kroah-Hartman
commit f77518651e31b961809cd0fa5f2b6f12af6cc1c5
Author: James Hogan
Date: Fri Dec 4 22:25:01 2015 +0000
MIPS: Don't unwind to user mode with EVA
commit a816b306c62195b7c43c92cb13330821a96bdc27 upstream.
When unwinding through IRQs and exceptions, the unwinding only continues
if the PC is a kernel text address, however since EVA it is possible for
user and kernel address ranges to overlap, potentially allowing
unwinding to continue to user mode if the user PC happens to be in the
kernel text address range.
Adjust the check to also ensure that the register state from before the
exception is actually running in kernel mode, i.e. !user\_mode(regs).
I don't believe any harm can come of this problem, since the PC is only
output, the stack pointer is checked to ensure it resides within the
task's stack page before it is dereferenced in search of the return
address, and the return address register is similarly only output (if
the PC is in a leaf function or the beginning of a non-leaf function).
However unwind\_stack() is only meant for unwinding kernel code, so to be
correct the unwind should stop there.
Signed-off-by: James Hogan
Reviewed-by: Leonid Yegoshin
Cc: linux-mips@linux-mips.org
Patchwork: https://patchwork.linux-mips.org/patch/11700/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 0ea534fb90a014e7c39225a825be44bef69a1301
Author: Maciej W. Rozycki
Date: Tue May 17 06:12:27 2016 +0100
MIPS: MSA: Fix a link error on `\_init\_msa\_upper' with older GCC
commit e49d38488515057dba8f0c2ba4cfde5be4a7281f upstream.
Fix a build regression from commit c9017757c532 ("MIPS: init upper 64b
of vector registers when MSA is first used"):
arch/mips/built-in.o: In function `enable\_restore\_fp\_context':
traps.c:(.text+0xbb90): undefined reference to `\_init\_msa\_upper'
traps.c:(.text+0xbb90): relocation truncated to fit: R\_MIPS\_26 against `\_init\_msa\_upper'
traps.c:(.text+0xbef0): undefined reference to `\_init\_msa\_upper'
traps.c:(.text+0xbef0): relocation truncated to fit: R\_MIPS\_26 against `\_init\_msa\_upper'
to !CONFIG\_CPU\_HAS\_MSA configurations with older GCC versions, which are
unable to figure out that calls to `\_init\_msa\_upper' are indeed dead.
Of the many ways to tackle this failure choose the approach we have
already taken in `thread\_msa\_context\_live'.
[ralf@linux-mips.org: Drop patch segment to junk file.]
Signed-off-by: Maciej W. Rozycki
Cc: linux-mips@linux-mips.org
Patchwork: https://patchwork.linux-mips.org/patch/13271/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 482a601d4c69eba3900f6ca4f5fa0b7feb0ffb00
Author: Paul Burton
Date: Thu Apr 21 14:04:55 2016 +0100
MIPS: math-emu: Fix jalr emulation when rd == $0
commit ab4a92e66741b35ca12f8497896bafbe579c28a1 upstream.
When emulating a jalr instruction with rd == $0, the code in
isBranchInstr was incorrectly writing to GPR $0 which should actually
always remain zeroed. This would lead to any further instructions
emulated which use $0 operating on a bogus value until the task is next
context switched, at which point the value of $0 in the task context
would be restored to the correct zero by a store in SAVE\_SOME. Fix this
by not writing to rd if it is $0.
Fixes: 102cedc32a6e ("MIPS: microMIPS: Floating point support.")
Signed-off-by: Paul Burton
Cc: Maciej W. Rozycki
Cc: James Hogan
Cc: linux-mips@linux-mips.org
Cc: linux-kernel@vger.kernel.org
Patchwork: https://patchwork.linux-mips.org/patch/13160/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 2ce206484f16fe353aff89ac890c146cafca1a41
Author: Leonid Yegoshin
Date: Tue Apr 28 12:53:35 2015 -0700
MIPS64: R6: R2 emulation bugfix
commit 41fa29e4d8cf4150568a0fe9bb4d62229f9caed5 upstream.
Error recovery pointers for fixups was improperly set as ".word"
which is unsuitable for MIPS64.
Replaced by STR(PTR)
[ralf@linux-mips.org: Apply changes as requested in the review process.]
Signed-off-by: Leonid Yegoshin
Reviewed-by: James Hogan
Reviewed-by: Markos Chandras
Fixes: b0a668fb2038 ("MIPS: kernel: mips-r2-to-r6-emul: Add R2 emulator for MIPS R6")
Cc: macro@linux-mips.org
Cc: linux-mips@linux-mips.org
Cc: linux-kernel@vger.kernel.org
Patchwork: https://patchwork.linux-mips.org/patch/9911/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 0e4c51d2532cc6fd1ff858365e893f2f39aa26b4
Author: Chao Yu
Date: Wed May 11 19:48:44 2016 +0800
f2fs: fix deadlock when flush inline data
commit ab47036d8f7227361cad7894adee8e66ab6f95b2 upstream.
Below backtrace info was reported by Yunlei He:
Call Trace:
[] schedule+0x35/0x80
[] rwsem\_down\_read\_failed+0xed/0x130
[] call\_rwsem\_down\_read\_failed+0x18/0x
[] down\_read+0x20/0x30
[] f2fs\_evict\_inode+0x242/0x3a0 [f2fs]
[] evict+0xc7/0x1a0
[] iput+0x196/0x200
[] \_\_dentry\_kill+0x179/0x1e0
[] dput+0x199/0x1f0
[] \_\_fput+0x18b/0x220
[] \_\_\_\_fput+0xe/0x10
[] task\_work\_run+0x77/0x90
[] exit\_to\_usermode\_loop+0x73/0xa2
[] do\_syscall\_64+0xfa/0x110
[] entry\_SYSCALL64\_slow\_path+0x25/0x25
Call Trace:
[] schedule+0x35/0x80
[] \_\_wait\_on\_freeing\_inode+0xa3/0xd0
[] ? autoremove\_wake\_function+0x40/0x4
[] find\_inode\_fast+0x7d/0xb0
[] ilookup+0x6a/0xd0
[] sync\_node\_pages+0x210/0x650 [f2fs]
[] ? do\_fsync+0x70/0x70
[] block\_operations+0x9e/0xf0 [f2fs]
[] ? bio\_endio+0x55/0x60
[] write\_checkpoint+0x92/0xba0 [f2fs]
[] ? mempool\_free\_slab+0x17/0x20
[] ? mempool\_free+0x2b/0x80
[] ? do\_fsync+0x70/0x70
[] f2fs\_sync\_fs+0x63/0xd0 [f2fs]
[] ? ext4\_sync\_fs+0xbf/0x190
[] sync\_fs\_one\_sb+0x20/0x30
[] iterate\_supers+0xb9/0x110
[] sys\_sync+0x55/0x90
[] do\_syscall\_64+0x69/0x110
[] entry\_SYSCALL64\_slow\_path+0x25/0x25
With following excuting serials, we will set inline\_node in inode page
after inode was unlinked, result in a deadloop described as below:
1. open file
2. write file
3. unlink file
4. write file
5. close file
Thread A Thread B
- dput
- iput\_final
- inode->i\_state |= I\_FREEING
- evict
- f2fs\_evict\_inode
- f2fs\_sync\_fs
- write\_checkpoint
- block\_operations
- f2fs\_lock\_all (down\_write(cp\_rwsem))
- f2fs\_lock\_op (down\_read(cp\_rwsem))
- sync\_node\_pages
- ilookup
- find\_inode\_fast
- \_\_wait\_on\_freeing\_inode
(wait on I\_FREEING clear)
Here, we change to set inline\_node flag only for linked inode for fixing.
Reported-by: Yunlei He
Signed-off-by: Chao Yu
Tested-by: Jaegeuk Kim
Signed-off-by: Jaegeuk Kim
Signed-off-by: Greg Kroah-Hartman


=== Content from github.com_fa353ff5_20250124_150351.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F06bd3c36a733ac27962fea7d6f47168841376824)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F06bd3c36a733ac27962fea7d6f47168841376824)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.9k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  437](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/06bd3c36a733ac27962fea7d6f47168841376824)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

ext4: fix data exposure after a crash

[Browse files](/torvalds/linux/tree/06bd3c36a733ac27962fea7d6f47168841376824)
Browse the repository at this point in the history

```
Huang has reported that in his powerfail testing he is seeing stale
block contents in some of recently allocated blocks although he mounts
ext4 in data=ordered mode. After some investigation I have found out
that indeed when delayed allocation is used, we don't add inode to
transaction's list of inodes needing flushing before commit. Originally
we were doing that but commit [f3b5929](https://github.com/torvalds/linux/commit/f3b59291a69d0b734be1fc8be489fef2dd846d3d) removed the logic with a
flawed argument that it is not needed.

The problem is that although for delayed allocated blocks we write their
contents immediately after allocating them, there is no guarantee that
the IO scheduler or device doesn't reorder things and thus transaction
allocating blocks and attaching them to inode can reach stable storage
before actual block contents. Actually whenever we attach freshly
allocated blocks to inode using a written extent, we should add inode to
transaction's ordered inode list to make sure we properly wait for block
contents to be written before committing the transaction. So that is
what we do in this patch. This also handles other cases where stale data
exposure was possible - like filling hole via mmap in
data=ordered,nodelalloc mode.

The only exception to the above rule are extending direct IO writes where
blkdev_direct_IO() waits for IO to complete before increasing i_size and
thus stale data exposure is not possible. For now we don't complicate
the code with optimizing this special case since the overhead is pretty
low. In case this is observed to be a performance problem we can always
handle it using a special flag to ext4_map_blocks().

CC: stable@vger.kernel.org
Fixes: [f3b5929](https://github.com/torvalds/linux/commit/f3b59291a69d0b734be1fc8be489fef2dd846d3d)
Reported-by: "HUANG Weller (CM/ESW12-CN)" <Weller.Huang@cn.bosch.com>
Tested-by: "HUANG Weller (CM/ESW12-CN)" <Weller.Huang@cn.bosch.com>
Signed-off-by: Jan Kara <jack@suse.cz>
Signed-off-by: Theodore Ts'o <tytso@mit.edu>
```

* Loading branch information

[![@jankara](https://avatars.githubusercontent.com/u/5585575?s=40&v=4)](/jankara) [![@tytso](https://avatars.githubusercontent.com/u/51416?s=40&v=4)](/tytso)

[jankara](/torvalds/linux/commits?author=jankara "View all commits by jankara")
authored and
[tytso](/torvalds/linux/commits?author=tytso "View all commits by tytso")
committed
Apr 24, 2016

1 parent
[1f60fbe](/torvalds/linux/commit/1f60fbe7274918adb8db2f616e321890730ab7e3)

commit 06bd3c3

Showing
**1 changed file**
with
**15 additions**
and
**9 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

24 changes: 15 additions & 9 deletions

24
[fs/ext4/inode.c](#diff-a562265a4bd35509240b021ce42548786e4f1e507c9c96a1bf81539cfca9c933 "fs/ext4/inode.c")

Show comments

[View file](/torvalds/linux/blob/06bd3c36a733ac27962fea7d6f47168841376824/fs/ext4/inode.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -684,6 +684,21 @@ int ext4\_map\_blocks(handle\_t \*handle, struct inode \*inode, |
|  |  | ret = check\_block\_validity(inode, map); |
|  |  | if (ret != 0) |
|  |  | return ret; |
|  |  |  |
|  |  | /\* |
|  |  | \* Inodes with freshly allocated blocks where contents will be |
|  |  | \* visible after transaction commit must be on transaction's |
|  |  | \* ordered data list. |
|  |  | \*/ |
|  |  | if (map->m\_flags & EXT4\_MAP\_NEW && |
|  |  | !(map->m\_flags & EXT4\_MAP\_UNWRITTEN) && |
|  |  | !(flags & EXT4\_GET\_BLOCKS\_ZERO) && |
|  |  | !IS\_NOQUOTA(inode) && |
|  |  | ext4\_should\_order\_data(inode)) { |
|  |  | ret = ext4\_jbd2\_file\_inode(handle, inode); |
|  |  | if (ret) |
|  |  | return ret; |
|  |  | } |
|  |  | } |
|  |  | return retval; |
|  |  | } |
| Expand Down  Expand Up | | @@ -1289,15 +1304,6 @@ static int ext4\_write\_end(struct file \*file, |
|  |  | int i\_size\_changed = 0; |
|  |  |  |
|  |  | trace\_ext4\_write\_end(inode, pos, len, copied); |
|  |  | if (ext4\_test\_inode\_state(inode, EXT4\_STATE\_ORDERED\_MODE)) { |
|  |  | ret = ext4\_jbd2\_file\_inode(handle, inode); |
|  |  | if (ret) { |
|  |  | unlock\_page(page); |
|  |  | put\_page(page); |
|  |  | goto errout; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | if (ext4\_has\_inline\_data(inode)) { |
|  |  | ret = ext4\_write\_inline\_data\_end(inode, pos, len, |
|  |  | copied, page); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `06bd3c3`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F06bd3c36a733ac27962fea7d6f47168841376824) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from git.kernel.org_20dc506f_20250124_150346.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=06bd3c36a733ac27962fea7d6f47168841376824)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=06bd3c36a733ac27962fea7d6f47168841376824)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=06bd3c36a733ac27962fea7d6f47168841376824)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=06bd3c36a733ac27962fea7d6f47168841376824)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jan Kara <jack@suse.cz> | 2016-04-24 00:56:03 -0400 |
| --- | --- | --- |
| committer | Theodore Ts'o <tytso@mit.edu> | 2016-04-24 00:56:03 -0400 |
| commit | [06bd3c36a733ac27962fea7d6f47168841376824](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=06bd3c36a733ac27962fea7d6f47168841376824) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=06bd3c36a733ac27962fea7d6f47168841376824)) | |
| tree | [e4f4abc0b8a5bc40cd51905329f44a9cdfbc80a0](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=06bd3c36a733ac27962fea7d6f47168841376824) | |
| parent | [1f60fbe7274918adb8db2f616e321890730ab7e3](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=1f60fbe7274918adb8db2f616e321890730ab7e3) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=06bd3c36a733ac27962fea7d6f47168841376824&id2=1f60fbe7274918adb8db2f616e321890730ab7e3)) | |
| download | [linux-06bd3c36a733ac27962fea7d6f47168841376824.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-06bd3c36a733ac27962fea7d6f47168841376824.tar.gz) | |

ext4: fix data exposure after a crashHuang has reported that in his powerfail testing he is seeing stale
block contents in some of recently allocated blocks although he mounts
ext4 in data=ordered mode. After some investigation I have found out
that indeed when delayed allocation is used, we don't add inode to
transaction's list of inodes needing flushing before commit. Originally
we were doing that but commit f3b59291a69d removed the logic with a
flawed argument that it is not needed.
The problem is that although for delayed allocated blocks we write their
contents immediately after allocating them, there is no guarantee that
the IO scheduler or device doesn't reorder things and thus transaction
allocating blocks and attaching them to inode can reach stable storage
before actual block contents. Actually whenever we attach freshly
allocated blocks to inode using a written extent, we should add inode to
transaction's ordered inode list to make sure we properly wait for block
contents to be written before committing the transaction. So that is
what we do in this patch. This also handles other cases where stale data
exposure was possible - like filling hole via mmap in
data=ordered,nodelalloc mode.
The only exception to the above rule are extending direct IO writes where
blkdev\_direct\_IO() waits for IO to complete before increasing i\_size and
thus stale data exposure is not possible. For now we don't complicate
the code with optimizing this special case since the overhead is pretty
low. In case this is observed to be a performance problem we can always
handle it using a special flag to ext4\_map\_blocks().
CC: stable@vger.kernel.org
Fixes: f3b59291a69d0b734be1fc8be489fef2dd846d3d
Reported-by: "HUANG Weller (CM/ESW12-CN)" <Weller.Huang@cn.bosch.com>
Tested-by: "HUANG Weller (CM/ESW12-CN)" <Weller.Huang@cn.bosch.com>
Signed-off-by: Jan Kara <jack@suse.cz>
Signed-off-by: Theodore Ts'o <tytso@mit.edu>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=06bd3c36a733ac27962fea7d6f47168841376824)

| -rw-r--r-- | [fs/ext4/inode.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/fs/ext4/inode.c?id=06bd3c36a733ac27962fea7d6f47168841376824) | 24 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 15 insertions, 9 deletions

| diff --git a/fs/ext4/inode.c b/fs/ext4/inode.cindex 981a1fc30eaa2c..250c2df04a92c5 100644--- a/[fs/ext4/inode.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/ext4/inode.c?id=1f60fbe7274918adb8db2f616e321890730ab7e3)+++ b/[fs/ext4/inode.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/ext4/inode.c?id=06bd3c36a733ac27962fea7d6f47168841376824)@@ -684,6 +684,21 @@ out\_sem: ret = check\_block\_validity(inode, map); if (ret != 0) return ret;++ /\*+ \* Inodes with freshly allocated blocks where contents will be+ \* visible after transaction commit must be on transaction's+ \* ordered data list.+ \*/+ if (map->m\_flags & EXT4\_MAP\_NEW &&+ !(map->m\_flags & EXT4\_MAP\_UNWRITTEN) &&+ !(flags & EXT4\_GET\_BLOCKS\_ZERO) &&+ !IS\_NOQUOTA(inode) &&+ ext4\_should\_order\_data(inode)) {+ ret = ext4\_jbd2\_file\_inode(handle, inode);+ if (ret)+ return ret;+ } } return retval; }@@ -1289,15 +1304,6 @@ static int ext4\_write\_end(struct file \*file, int i\_size\_changed = 0;  trace\_ext4\_write\_end(inode, pos, len, copied);- if (ext4\_test\_inode\_state(inode, EXT4\_STATE\_ORDERED\_MODE)) {- ret = ext4\_jbd2\_file\_inode(handle, inode);- if (ret) {- unlock\_page(page);- put\_page(page);- goto errout;- }- }- if (ext4\_has\_inline\_data(inode)) { ret = ext4\_write\_inline\_data\_end(inode, pos, len, copied, page); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-24 15:02:23 +0000



=== Content from source.android.com_dfb8c0dc_20250124_150352.html ===


[![Android Open Source Project](https://www.gstatic.com/devrel-devsite/prod/vda41147226ae308b24384f785d31d739107d2716272d99cd11c490ff3892954d/androidsource/images/lockup.svg)](/)

`/`

* English
* Deutsch
* Español
* Español – América Latina
* Français
* Indonesia
* Italiano
* Polski
* Português
* Português – Brasil
* Tiếng Việt
* Türkçe
* Русский
* עברית
* العربيّة
* فارسی
* हिंदी
* বাংলা
* ภาษาไทย
* 中文 – 简体
* 中文 – 繁體
* 日本語
* 한국어

[Android Code Search](https://cs.android.com/android/platform/superproject/main)
Sign in

* [Documentation](https://source.android.com/docs)

[What's New?](https://source.android.com/docs/whatsnew)

[Getting Started](https://source.android.com/docs/setup)

[Security](https://source.android.com/docs/security)

[Core Topics](https://source.android.com/docs/core)

[Compatibility](https://source.android.com/docs/compatibility)

[Android Devices](https://source.android.com/docs/devices)

[Automotive](https://source.android.com/docs/automotive)

[Reference](https://source.android.com/reference)

[![Android Open Source Project](https://www.gstatic.com/devrel-devsite/prod/vda41147226ae308b24384f785d31d739107d2716272d99cd11c490ff3892954d/androidsource/images/lockup.svg)](/)

* [Docs](/docs)
  + More
  + [What's New?](/docs/whatsnew)
  + [Getting Started](/docs/setup)
  + [Security](/docs/security)
  + [Core Topics](/docs/core)
  + [Compatibility](/docs/compatibility)
  + [Android Devices](/docs/devices)
  + [Automotive](/docs/automotive)
  + [Reference](/reference)
* [Android Code Search](https://cs.android.com/android/platform/superproject/main)

* [Overview](/docs/security)
* Security overview
  + [Secure an Android device](/docs/security/overview)
  + [Kernel security](/docs/security/overview/kernel-security)
  + [App security](/docs/security/overview/app-security)
  + [Implement security](/docs/security/overview/implement)
  + [Updates and resources](/docs/security/overview/updates-resources)
  + [ASPIRE](/docs/security/overview/aspire)
  + [Reports](/docs/security/overview/reports)
  + [Enhancements](/docs/security/enhancements)
  + [Acknowledgements](/docs/security/overview/acknowledgements)
* Android Security Bulletins
  + [Bulletins home](/docs/security/bulletin)
  + [Overview](/docs/security/bulletin/asb-overview)
  + 2025 bulletins
    - [January](/docs/security/bulletin/2025-01-01)
  + 2024 bulletins
    - [December](/docs/security/bulletin/2024-12-01)
    - [November](/docs/security/bulletin/2024-11-01)
    - [October](/docs/security/bulletin/2024-10-01)
    - [September](/docs/security/bulletin/2024-09-01)
    - [August](/docs/security/bulletin/2024-08-01)
    - [July](/docs/security/bulletin/2024-07-01)
    - [June](/docs/security/bulletin/2024-06-01)
    - [May](/docs/security/bulletin/2024-05-01)
    - [April](/docs/security/bulletin/2024-04-01)
    - [March](/docs/security/bulletin/2024-03-01)
    - [February](/docs/security/bulletin/2024-02-01)
    - [January](/docs/security/bulletin/2024-01-01)
    - [Android 15](/docs/security/bulletin/android-15)
  + 2023 bulletins
    - [December](/docs/security/bulletin/2023-12-01)
    - [November](/docs/security/bulletin/2023-11-01)
    - [October](/docs/security/bulletin/2023-10-01)
    - [September](/docs/security/bulletin/2023-09-01)
    - [August](/docs/security/bulletin/2023-08-01)
    - [July](/docs/security/bulletin/2023-07-01)
    - [June](/docs/security/bulletin/2023-06-01)
    - [May](/docs/security/bulletin/2023-05-01)
    - [April](/docs/security/bulletin/2023-04-01)
    - [March](/docs/security/bulletin/2023-03-01)
    - [February](/docs/security/bulletin/2023-02-01)
    - [January](/docs/security/bulletin/2023-01-01)
    - [Android 14](/docs/security/bulletin/android-14)
  + 2022 bulletins
    - [December](/docs/security/bulletin/2022-12-01)
    - [November](/docs/security/bulletin/2022-11-01)
    - [October](/docs/security/bulletin/2022-10-01)
    - [September](/docs/security/bulletin/2022-09-01)
    - [August](/docs/security/bulletin/2022-08-01)
    - [July](/docs/security/bulletin/2022-07-01)
    - [June](/docs/security/bulletin/2022-06-01)
    - [May](/docs/security/bulletin/2022-05-01)
    - [April](/docs/security/bulletin/2022-04-01)
    - [March](/docs/security/bulletin/2022-03-01)
    - [Android 12L](/docs/security/bulletin/android-12l)
    - [February](/docs/security/bulletin/2022-02-01)
    - [January](/docs/security/bulletin/2022-01-01)
    - [Android 13](/docs/security/bulletin/android-13)
    - [Index](/docs/security/bulletin/2022)
  + 2021 bulletins
    - [December](/docs/security/bulletin/2021-12-01)
    - [November](/docs/security/bulletin/2021-11-01)
    - [October](/docs/security/bulletin/2021-10-01)
    - [September](/docs/security/bulletin/2021-09-01)
    - [August](/docs/security/bulletin/2021-08-01)
    - [July](/docs/security/bulletin/2021-07-01)
    - [June](/docs/security/bulletin/2021-06-01)
    - [May](/docs/security/bulletin/2021-05-01)
    - [April](/docs/security/bulletin/2021-04-01)
    - [March](/docs/security/bulletin/2021-03-01)
    - [February](/docs/security/bulletin/2021-02-01)
    - [January](/docs/security/bulletin/2021-01-01)
    - [Android 12](/docs/security/bulletin/android-12)
    - [Index](/docs/security/bulletin/2021)
  + 2020 bulletins
    - [December](/docs/security/bulletin/2020-12-01)
    - [November](/docs/security/bulletin/2020-11-01)
    - [October](/docs/security/bulletin/2020-10-01)
    - [September](/docs/security/bulletin/2020-09-01)
    - [August](/docs/security/bulletin/2020-08-01)
    - [July](/docs/security/bulletin/2020-07-01)
    - [June](/docs/security/bulletin/2020-06-01)
    - [May](/docs/security/bulletin/2020-05-01)
    - [April](/docs/security/bulletin/2020-04-01)
    - [March](/docs/security/bulletin/2020-03-01)
    - [February](/docs/security/bulletin/2020-02-01)
    - [January](/docs/security/bulletin/2020-01-01)
    - [Android 11](/docs/security/bulletin/android-11)
    - [Index](/docs/security/bulletin/2020)
  + 2019 bulletins
    - [December](/docs/security/bulletin/2019-12-01)
    - [November](/docs/security/bulletin/2019-11-01)
    - [October](/docs/security/bulletin/2019-10-01)
    - [September](/docs/security/bulletin/2019-09-01)
    - [August](/docs/security/bulletin/2019-08-01)
    - [July](/docs/security/bulletin/2019-07-01)
    - [June](/docs/security/bulletin/2019-06-01)
    - [May](/docs/security/bulletin/2019-05-01)
    - [April](/docs/security/bulletin/2019-04-01)
    - [March](/docs/security/bulletin/2019-03-01)
    - [February](/docs/security/bulletin/2019-02-01)
    - [January](/docs/security/bulletin/2019-01-01)
    - [Android 10](/docs/security/bulletin/android-10)
    - [Index](/docs/security/bulletin/2019)
  + 2018 bulletins
    - [December](/docs/security/bulletin/2018-12-01)
    - [November](/docs/security/bulletin/2018-11-01)
    - [October](/docs/security/bulletin/2018-10-01)
    - [September](/docs/security/bulletin/2018-09-01)
    - [August](/docs/security/bulletin/2018-08-01)
    - [July](/docs/security/bulletin/2018-07-01)
    - [June](/docs/security/bulletin/2018-06-01)
    - [May](/docs/security/bulletin/2018-05-01)
    - [April](/docs/security/bulletin/2018-04-01)
    - [March](/docs/security/bulletin/2018-03-01)
    - [February](/docs/security/bulletin/2018-02-01)
    - [January](/docs/security/bulletin/2018-01-01)
    - [Index](/docs/security/bulletin/2018)
  + 2017 bulletins
    - [December](/docs/security/bulletin/2017-12-01)
    - [November](/docs/security/bulletin/2017-11-01)
    - [October](/docs/security/bulletin/2017-10-01)
    - [September](/docs/security/bulletin/2017-09-01)
    - [August](/docs/security/bulletin/2017-08-01)
    - [July](/docs/security/bulletin/2017-07-01)
    - [June](/docs/security/bulletin/2017-06-01)
    - [May](/docs/security/bulletin/2017-05-01)
    - [April](/docs/security/bulletin/2017-04-01)
    - [March](/docs/security/bulletin/2017-03-01)
    - [February](/docs/security/bulletin/2017-02-01)
    - [January](/docs/security/bulletin/2017-01-01)
    - [Index](/docs/security/bulletin/2017)
  + 2016 bulletins
    - [December](/docs/security/bulletin/2016-12-01)
    - [November](/docs/security/bulletin/2016-11-01)
    - [October](/docs/security/bulletin/2016-10-01)
    - [September](/docs/security/bulletin/2016-09-01)
    - [August](/docs/security/bulletin/2016-08-01)
    - [July](/docs/security/bulletin/2016-07-01)
    - [June](/docs/security/bulletin/2016-06-01)
    - [May](/docs/security/bulletin/2016-05-01)
    - [April](/docs/security/bulletin/2016-04-02)
    - [March](/docs/security/bulletin/2016-03-01)
    - [February](/docs/security/bulletin/2016-02-01)
    - [January](/docs/security/bulletin/2016-01-01)
    - [Index](/docs/security/bulletin/2016)
  + 2015 bulletins
    - [December](/docs/security/bulletin/2015-12-01)
    - [November](/docs/security/bulletin/2015-11-01)
    - [October](/docs/security/bulletin/2015-10-01)
    - [September](/docs/security/bulletin/2015-09-01)
    - [August](/docs/security/bulletin/2015-08-01)
    - [Index](/docs/security/bulletin/2015)
  + Pixel/Nexus bulletins
  + [Overview](/docs/security/bulletin/pixel)
  + 2025 bulletins
    - [January](/docs/security/bulletin/pixel/2025-01-01)
  + 2024 bulletins
    - [December](/docs/security/bulletin/pixel/2024-12-01)
    - [November](/docs/security/bulletin/pixel/2024-11-01)
    - [October](/docs/security/bulletin/pixel/2024-10-01)
    - [September](/docs/security/bulletin/pixel/2024-09-01)
    - [August](/docs/security/bulletin/pixel/2024-08-01)
    - [July](/docs/security/bulletin/pixel/2024-07-01)
    - [June](/docs/security/bulletin/pixel/2024-06-01)
    - [May](/docs/security/bulletin/pixel/2024-05-01)
    - [April](/docs/security/bulletin/pixel/2024-04-01)
    - [March](/docs/security/bulletin/pixel/2024-03-01)
    - [February](/docs/security/bulletin/pixel/2024-02-01)
    - [January](/docs/security/bulletin/pixel/2024-01-01)
  + 2023 bulletins
    - [December](/docs/security/bulletin/pixel/2023-12-01)
    - [November](/docs/security/bulletin/pixel/2023-11-01)
    - [October](/docs/security/bulletin/pixel/2023-10-01)
    - [September](/docs/security/bulletin/pixel/2023-09-01)
    - [August](/docs/security/bulletin/pixel/2023-08-01)
    - [July](/docs/security/bulletin/pixel/2023-07-01)
    - [June](/docs/security/bulletin/pixel/2023-06-01)
    - [May](/docs/security/bulletin/pixel/2023-05-01)
    - [April](/docs/security/bulletin/pixel/2023-04-01)
    - [March](/docs/security/bulletin/pixel/2023-03-01)
    - [February](/docs/security/bulletin/pixel/2023-02-01)
    - [January](/docs/security/bulletin/pixel/2023-01-01)
  + 2022 bulletins
    - [December](/docs/security/bulletin/pixel/2022-12-01)
    - [November](/docs/security/bulletin/pixel/2022-11-01)
    - [October](/docs/security/bulletin/pixel/2022-10-01)
    - [September](/docs/security/bulletin/pixel/2022-09-01)
    - [August](/docs/security/bulletin/pixel/2022-08-01)
    - [July](/docs/security/bulletin/pixel/2022-07-01)
    - [June](/docs/security/bulletin/pixel/2022-06-01)
    - [May](/docs/security/bulletin/pixel/2022-05-01)
    - [April](/docs/security/bulletin/pixel/2022-04-01)
    - [March](/docs/security/bulletin/pixel/2022-03-01)
    - [February](/docs/security/bulletin/pixel/2022-02-01)
    - [January](/docs/security/bulletin/pixel/2022-01-01)
  + 2021 bulletins
    - [December](/docs/security/bulletin/pixel/2021-12-01)
    - [November](/docs/security/bulletin/pixel/2021-11-01)
    - [October](/docs/security/bulletin/pixel/2021-10-01)
    - [September](/docs/security/bulletin/pixel/2021-09-01)
    - [August](/docs/security/bulletin/pixel/2021-08-01)
    - [July](/docs/security/bulletin/pixel/2021-07-01)
    - [June](/docs/security/bulletin/pixel/2021-06-01)
    - [May](/docs/security/bulletin/pixel/2021-05-01)
    - [April](/docs/security/bulletin/pixel/2021-04-01)
    - [March](/docs/security/bulletin/pixel/2021-03-01)
    - [February](/docs/security/bulletin/pixel/2021-02-01)
    - [January](/docs/security/bulletin/pixel/2021-01-01)
    - [Index](/docs/security/bulletin/pixel/2021)
  + 2020 bulletins
    - [December](/docs/security/bulletin/pixel/2020-12-01)
    - [November](/docs/security/bulletin/pixel/2020-11-01)
    - [October](/docs/security/bulletin/pixel/2020-10-01)
    - [September](/docs/security/bulletin/pixel/2020-09-01)
    - [August](/docs/security/bulletin/pixel/2020-08-01)
    - [July](/docs/security/bulletin/pixel/2020-07-01)
    - [June](/docs/security/bulletin/pixel/2020-06-01)
    - [May](/docs/security/bulletin/pixel/2020-05-01)
    - [April](/docs/security/bulletin/pixel/2020-04-01)
    - [March](/docs/security/bulletin/pixel/2020-03-01)
    - [February](/docs/security/bulletin/pixel/2020-02-01)
    - [January](/docs/security/bulletin/pixel/2020-01-01)
    - [Index](/docs/security/bulletin/pixel/2020)
  + 2019 bulletins
    - [December](/docs/security/bulletin/pixel/2019-12-01)
    - [November](/docs/security/bulletin/pixel/2019-11-01)
    - [October](/docs/security/bulletin/pixel/2019-10-01)
    - [September](/docs/security/bulletin/pixel/2019-09-01)
    - [August](/docs/security/bulletin/pixel/2019-08-01)
    - [July](/docs/security/bulletin/pixel/2019-07-01)
    - [June](/docs/security/bulletin/pixel/2019-06-01)
    - [May](/docs/security/bulletin/pixel/2019-05-01)
    - [April](/docs/security/bulletin/pixel/2019-04-01)
    - [March](/docs/security/bulletin/pixel/2019-03-01)
    - [February](/docs/security/bulletin/pixel/2019-02-01)
    - [January](/docs/security/bulletin/pixel/2019-01-01)
    - [Index](/docs/security/bulletin/pixel/2019)
  + 2018 bulletins
    - [December](/docs/security/bulletin/pixel/2018-12-01)
    - [November](/docs/security/bulletin/pixel/2018-11-01)
    - [October](/docs/security/bulletin/pixel/2018-10-01)
    - [September](/docs/security/bulletin/pixel/2018-09-01)
    - [August](/docs/security/bulletin/pixel/2018-08-01)
    - [July](/docs/security/bulletin/pixel/2018-07-01)
    - [June](/docs/security/bulletin/pixel/2018-06-01)
    - [May](/docs/security/bulletin/pixel/2018-05-01)
    - [April](/docs/security/bulletin/pixel/2018-04-01)
    - [March](/docs/security/bulletin/pixel/2018-03-01)
    - [February](/docs/security/bulletin/pixel/2018-02-01)
    - [January](/docs/security/bulletin/pixel/2018-01-01)
    - [Index](/docs/security/bulletin/pixel/2018)
  + 2017 bulletins
    - [December](/docs/security/bulletin/pixel/2017-12-01)
    - [November](/docs/security/bulletin/pixel/2017-11-01)
    - [October](/docs/security/bulletin/pixel/2017-10-01)
    - [Index](/docs/security/bulletin/pixel/2017)
  + Android Automotive
  + [Overview](/docs/security/bulletin/aaos)
  + 2025 bulletins
    - [January](/docs/security/bulletin/aaos/2025-01-01)
  + 2024 bulletins
    - [December](/docs/security/bulletin/aaos/2024-12-01)
    - [November](/docs/security/bulletin/aaos/2024-11-01)
    - [October](/docs/security/bulletin/aaos/2024-10-01)
    - [September](/docs/security/bulletin/aaos/2024-09-01)
    - [August](/docs/security/bulletin/aaos/2024-08-01)
    - [July](/docs/security/bulletin/aaos/2024-07-01)
    - [June](/docs/security/bulletin/aaos/2024-06-01)
    - [May](/docs/security/bulletin/aaos/2024-05-01)
    - [April](/docs/security/bulletin/aaos/2024-04-01)
    - [March](/docs/security/bulletin/aaos/2024-03-01)
    - [February](/docs/security/bulletin/aaos/2024-02-01)
    - [January](/docs/security/bulletin/aaos/2024-01-01)
  + 2023 bulletins
    - [December](/docs/security/bulletin/aaos/2023-12-01)
    - [November](/docs/security/bulletin/aaos/2023-11-01)
    - [October](/docs/security/bulletin/aaos/2023-10-01)
    - [September](/docs/security/bulletin/aaos/2023-09-01)
    - [August](/docs/security/bulletin/aaos/2023-08-01)
    - [July](/docs/security/bulletin/aaos/2023-07-01)
    - [June](/docs/security/bulletin/aaos/2023-06-01)
    - [May](/docs/security/bulletin/aaos/2023-05-01)
    - [April](/docs/security/bulletin/aaos/2023-04-01)
    - [March](/docs/security/bulletin/aaos/2023-03-01)
    - [February](/docs/security/bulletin/aaos/2023-02-01)
    - [January](/docs/security/bulletin/aaos/2023-01-01)
  + 2022 bulletins
    - [December](/docs/security/bulletin/aaos/2022-12-01)
    - [November](/docs/security/bulletin/aaos/2022-11-01)
    - [October](/docs/security/bulletin/aaos/2022-10-01)
    - [September](/docs/security/bulletin/aaos/2022-09-01)
    - [August](/docs/security/bulletin/aaos/2022-08-01)
    - [July](/docs/security/bulletin/aaos/2022-07-01)
    - [June](/docs/security/bulletin/aaos/2022-06-01)
    - [May](/docs/security/bulletin/aaos/2022-05-01)
    - [April](/docs/security/bulletin/aaos/2022-04-01)
    - [March](/docs/security/bulletin/aaos/2022-03-01)
    - [February](/docs/security/bulletin/aaos/2022-02-01)
    - [January](/docs/security/bulletin/aaos/2022-01-01)
  + 2021 bulletins
    - [December](/docs/security/bulletin/aaos/2021-12-01)
    - [November](/docs/security/bulletin/aaos/2021-11-01)
    - [October](/docs/security/bulletin/aaos/2021-10-01)
    - [September](/docs/security/bulletin/aaos/2021-09-01)
    - [August](/docs/security/bulletin/aaos/2021-08-01)
    - [July](/docs/security/bulletin/aaos/2021-07-01)
    - [June](/docs/security/bulletin/aaos/2021-06-01)
    - [May](/docs/security/bulletin/aaos/2021-05-01)
    - [April](/docs/security/bulletin/aaos/2021-04-01)
    - [March](/docs/security/bulletin/aaos/2021-03-01)
    - [February](/docs/security/bulletin/aaos/2021-02-01)
    - [January](/docs/security/bulletin/aaos/2021-01-01)
  + Chromecast
  + [Overview](/docs/security/bulletin/chromecast)
  + 2024 bulletins
    - [December](/docs/security/bulletin/chromecast/2024-12-01)
    - [September](/docs/security/bulletin/chromecast/2024-09-01)
    - [July](/docs/security/bulletin/chromecast/2024-07-01)
    - [March](/docs/security/bulletin/chromecast/2024-03-01)
  + 2023 bulletins
    - [December](/docs/security/bulletin/chromecast/2023-12-01)
    - [September](/docs/security/bulletin/chromecast/2023-07-01)
    - [June](/docs/security/bulletin/chromecast/2023-06-01)
    - [April](/docs/security/bulletin/chromecast/2023-04-01)
  + 2022 bulletins
    - [December](/docs/security/bulletin/chromecast/2022-12-01)
    - [October](/docs/security/bulletin/chromecast/2022-10-01)
    - [July](/docs/security/bulletin/chromecast/2022-07-01)
  + Wear
  + [Overview](/docs/security/bulletin/wear)
  + 2025 bulletins
    - [January](/docs/security/bulletin/wear/2025/2025-01-01)
  + 2024 bulletins
    - [December](/docs/security/bulletin/wear/2024/2024-12-01)
    - [November](/docs/security/bulletin/wear/2024/2024-11-01)
    - [October](/docs/security/bulletin/wear/2024/2024-10-01)
    - [September](/docs/security/bulletin/wear/2024/2024-09-01)
    - [August](/docs/security/bulletin/wear/2024/2024-08-01)
    - [July](/docs/security/bulletin/wear/2024/2024-07-01)
    - [June](/docs/security/bulletin/wear/2024/2024-06-01)
    - [May](/docs/security/bulletin/wear/2024/2024-05-01)
    - [April](/docs/security/bulletin/wear/2024/2024-04-01)
    - [March](/docs/security/bulletin/wear/2024/2024-03-01)
    - [February](/docs/security/bulletin/wear/2024/2024-02-01)
    - [January](/docs/security/bulletin/wear/2024/2024-01-01)
  + 2023 bulletins
    - [December](/docs/security/bulletin/wear/2023/2023-12-01)
    - [November](/docs/security/bulletin/wear/2023/2023-11-01)
    - [October](/docs/security/bulletin/wear/2023/2023-10-01)
    - [September](/docs/security/bulletin/wear/2023/2023-09-01)
    - [August](/docs/security/bulletin/wear/2023/2023-08-01)
  + Pixel Watch
  + [Overview](/docs/security/bulletin/pixel-watch)
  + 2024 bulletins
    - [December](/docs/security/bulletin/pixel-watch/2024-12-01)
    - [August](/docs/security/bulletin/pixel-watch/2024-08-01)
    - [July](/docs/security/bulletin/pixel-watch/2024-07-01)
    - [June](/docs/security/bulletin/pixel-watch/2024-06-01)
    - [May](/docs/security/bulletin/pixel-watch/2024-05-01)
    - [April](/docs/security/bulletin/pixel-watch/2024-04-01)
    - [March](/docs/security/bulletin/pixel-watch/2024-03-01)
    - [February](/docs/security/bulletin/pixel-watch/2024-02-01)
    - [January](/docs/security/bulletin/pixel-watch/2024-01-01)
  + 2023 bulletins
    - [December](/docs/security/bulletin/pixel-watch/2023/2023-12-01)
    - [September](/docs/security/bulletin/pixel-watch/2023/2023-09-01)
    - [June](/docs/security/bulletin/pixel-watch/2023/2023-06-01)
  + Advisories
  + [Overview](/docs/security/bulletin/advisory)
  + [March 2016](/docs/security/bulletin/advisory/2016-03-18)
* Features
  + [Overview](/docs/security/features)
  + [Application Sandbox](/docs/security/app-sandbox)
  + [OMAPI vendor stable interface](/docs/security/features/open-mobile-api)
  + App signing
    - [Overview](/docs/security/features/apksigning)
    - [APK signature scheme v2](/docs/security/features/apksigning/v2)
    - [APK signature scheme v3](/docs/security/features/apksigning/v3)
    - [APK signature scheme v3.1](/docs/security/features/apksigning/v3-1)
    - [APK signature scheme v4](/docs/security/features/apksigning/v4)
  + Authentication
    - [Overview](/docs/security/features/authentication)
    - [Gatekeeper](/docs/security/features/authentication/gatekeeper)
    - Biometrics
      * [Overview](/docs/security/features/biometric)
      * [Measure biometric security](/docs/security/features/biometric/measure)
      * [Fingerprint HIDL](/docs/security/features/authentication/fingerprint-hal)
      * [Face authentication HIDL](/docs/security/features/biometric/face-authentication)
    - Protected confirmation
      * [Overview](/docs/security/features/protected-confirmation)
      * [Implementation](/docs/security/features/protected-confirmation/implementation)
      * [Design guidelines](/docs/security/features/protected-confirmation/design)
      * [Accessibility](/docs/security/features/protected-confirmation/accessibility)
  + DICE
    - [Overview](/docs/security/features/dice)
    - [Applications of DICE](/docs/security/features/dice/applications-of-dice)
  + Encryption
    - [Overview](/docs/security/features/encryption)
    - [File-based encryption](/docs/security/features/encryption/file-based)
    - [Full-disk encryption](/docs/security/features/encryption/full-disk)
    - [Metadata encryption](/docs/security/features/encryption/metadata)
    - [Enable Adiantum](/docs/security/features/encryption/adiantum)
    - [Hardware-wrapped keys](/docs/security/features/encryption/hw-wrapped-keys)
  + Keystore
    - [Overview](/docs/security/features/keystore)
    - [Features](/docs/security/features/keystore/features)
    - [Key and ID attestation](/docs/security/features/keystore/attestation)
    - [Version binding](/docs/security/features/keystore/version-binding)
    - [Authorization tags](/docs/security/features/keystore/tags)
    - [Functions](/docs/security/features/keystore/implementer-ref)
  + Identity credential
    - [Overview](/docs/security/features/identity-credentials)
  + SELinux
    - [Overview](/docs/security/features/selinux)
    - [Concepts](/docs/security/features/selinux/concepts)
    - [Implementation](/docs/security/features/selinux/implement)
    - [Customization](/docs/security/features/selinux/customize)
    - [Build sepolicy](/docs/security/features/selinux/build)
    - [Compatibility](/docs/security/features/selinux/compatibility)
    - [Validation](/docs/security/features/selinux/validate)
    - [Write policy](/docs/security/features/selinux/device-policy)
    - [Vendor init](/docs/security/features/selinux/vendor-init)
  + Trusty TEE
    - [Overview](/docs/security/features/trusty)
    - [Download and build](/docs/security/features/trusty/download-and-build)
    - [Trusty API reference](/docs/security/features/trusty/trusty-ref)
  + Verified Boot
    - [Overview](/docs/security/features/verifiedboot)
    - [Device state](/docs/security/features/verifiedboot/device-state)
    - [Verify Boot](/docs/security/features/verifiedboot/verified-boot)
    - [Boot flow](/docs/security/features/verifiedboot/boot-flow)
    - [Implement dm-verity](/docs/security/features/verifiedboot/dm-verity)
    - [Verify system\_other partition](/docs/security/features/verifiedboot/verify-system-other-partition)
    - [Reference implementation](/docs/security/features/verifiedboot/avb)
  + Safety Center
    - [Overview](/docs/security/safety-center/overview)
    - [Customize Safety Center](/docs/security/safety-center/customize)
    - [Customize Safety Center UI](/docs/security/safety-center/customize-ui)
    - [Interact with Safety Center](/docs/security/safety-center/interact)
    - [Testing and validation](/docs/security/safety-center/test-requirements)
  + Cellular security
    - [Overview](/docs/security/features/cellular-security/overview)
    - [Disable 2G](/docs/security/features/cellular-security/disable-2g)
  + [Private space](/docs/security/features/private-space)
* Testing
  + [Overview](/docs/security/test/fuzz-sanitize)
  + [Memory safety](/docs/security/test/memory-safety)
  + Arm Memory Tagging Extension
  + [Overview](/docs/security/test/memory-safety/arm-mte)
  + [Bootloader support](/docs/security/test/memory-safety/bootloader-support)
  + [Understand MTE reports](/docs/security/test/memory-safety/mte-reports)
  + [MTE configuration](/docs/security/test/memory-safety/mte-configuration)
  + Sanitizers
  + [Overview](/docs/security/test/sanitizers)
  + [AddressSanitizer](/docs/security/test/asan)
  + [Kernel AddressSanitizer](/docs/security/test/kasan)
  + [Hardware-assisted AddressSanitizer](/docs/security/test/hwasan)
  + [Understand HWASan reports](/docs/security/test/memory-safety/hwasan-reports)
  + [UndefinedBehaviorSanitizer](/docs/security/test/ubsan)
  + Other topics
  + [Control flow integrity](/docs/security/test/cfi)
  + [Kernel control flow integrity](/docs/security/test/kcfi)
  + [Execute-only memory](/docs/security/test/execute-only-memory)
  + [Fuzz with libFuzzer](/docs/security/test/libfuzzer)
  + [GWP-ASan and KFENCE](/docs/security/test/memory-safety/gwp-asan-kfence)
  + [Security Test Suite development kit](/docs/security/test/sts-sdk)
  + [Scudo](/docs/security/test/scudo)
  + [ShadowCallStack](/docs/security/test/shadow-call-stack)
  + [Tagged pointers](/docs/security/test/tagged-pointers)
  + [Zero initialized memory](/docs/security/test/memory-safety/zero-initialized-memory)
* Best practices
  + [Overview](/docs/security/best-practices)
  + [Operational security](/docs/security/best-practices/ops)
  + [System security](/docs/security/best-practices/system)
  + [App security](/docs/security/best-practices/app)
  + [Network security](/docs/security/best-practices/network)
  + [Hardware security](/docs/security/best-practices/hardware)
  + [Privacy security](/docs/security/best-practices/privacy)

* What's new?
* [Release notes](/docs/whatsnew/release-notes)
* [Latest security bulletins](/docs/whatsnew/latest-security-bulletins)
* [Latest Compatibility Definition Document (CDD)](/docs/whatsnew/latest-cdd)
* [Site updates](/docs/whatsnew/site-updates)
* Getting Started
* [About](/docs/setup/about)
* [Start](/docs/setup/start)
* [Download](/docs/setup/download)
* [Build](/docs/setup/build)
* [Test](/docs/setup/test)
* [Create](/docs/setup/create/coding-tasks)
* [Contribute](/docs/setup/contribute)
* [Community](/docs/setup/community/cofc)
* [Tools, build, and related reference](/docs/setup/reference)
* Security
* [Overview](/docs/security/overview)
* [Bulletins](/docs/security/bulletin)
* [Features](/docs/security/features)
* [Testing](/docs/security/test/fuzz-sanitize)
* [Best Practices](/docs/security/best-practices)
* Core Topics
* [Architecture](/docs/core/architecture)
* [Audio](/docs/core/audio)
* [Camera](/docs/core/camera)
* [Connectivity](/docs/core/connect)
* [Data](/docs/core/data)
* [Display](/docs/core/display)
* [Fonts](/docs/core/fonts/custom-font-fallback)
* [Graphics](/docs/core/graphics)
* [Interaction](/docs/core/interaction)
* [Media](/docs/core/media)
* [Performance](/docs/core/perf)
* [Permissions](/docs/core/permissions)
* [Power](/docs/core/power)
* [Runtime](/docs/core/runtime)
* [Settings](/docs/core/settings)
* [Storage](/docs/core/storage)
* [Tests](/docs/core/tests)
* [Updates](/docs/core/ota)
* [Virtualization](/docs/core/virtualization)
* Compatibility
* [Compatibility Definition Document (CDD)](/docs/compatibility/cdd)
* [Compatibility Test Suite (CTS)](/docs/compatibility/cts)
* Android Devices
* [Cuttlefish](/docs/devices/cuttlefish)
* [Enterprise](/docs/devices/admin)
* [TV](/docs/devices/tv)
* Automotive
* [Get Started](/docs/automotive/start/what_automotive)
* [Guidelines for Development](/docs/automotive/guidelines)
* [Development Tools](/docs/automotive/dev-tools)
* [Testing Tools and Infrastructure](/docs/automotive/tools)
* [Release Details](/docs/automotive/start/releases)
* Reference
* [HIDL](/reference/hidl)
* [HAL](/reference/hal)
* [Trade Federation](/reference/tradefed/classes)
* [Security Test Suite](/reference/sts/classes)

* [AOSP](https://source.android.com/)
* [Security](https://source.android.com/docs/security)

# Android Security Bulletin—September 2017

Stay organized with collections

Save and categorize content based on your preferences.

*Published September 5, 2017 | Updated October 5, 2017*

The Android Security Bulletin contains details of security vulnerabilities
affecting Android devices. Security patch levels of September 05, 2017 or later
address all of these issues. Refer to the [Pixel
and Nexus update schedule](https://support.google.com/pixelphone/answer/4457705#pixel_phones&nexus_devices) to learn how to check a device's security patch
level.

Partners were notified of the issues described in the bulletin at least a month
ago. Source code patches for these issues have been released to the Android Open
Source Project (AOSP) repository and linked from this bulletin. This bulletin
also includes links to patches outside of AOSP.

The most severe of these issues is a critical severity vulnerability in media
framework that could enable a remote attacker using a specially crafted file to
execute arbitrary code within the context of a privileged process. The
[severity
assessment](/docs/security/overview/updates-resources#severity) is based on the effect that exploiting the vulnerability would
possibly have on an affected device, assuming the platform and service
mitigations are turned off for development purposes or if successfully bypassed.

We have had no reports of active customer exploitation or abuse of these newly
reported issues. Refer to the
[Android and Google Play Protect mitigations](#mitigations) section
for details on the [Android
security platform protections](/docs/security/enhancements) and Google Play Protect, which improve the
security of the Android platform.

We encourage all customers to accept these updates to their devices.

**Note:** Information on the latest over-the-air update (OTA) and
firmware images for Google devices is available in the
[Google device updates](#google-device-updates) section.

## Announcements

* This bulletin has two security patch level strings to provide Android
  partners with the flexibility to more quickly fix a subset of vulnerabilities
  that are similar across all Android devices. See
  [Common questions and answers](#questions) for additional information:
  + **2017-09-01**: Partial security patch level string. This
    security patch level string indicates that all issues associated with 2017-09-01
    (and all previous security patch level strings) are addressed.
  + **2017-09-05**: Complete security patch level string. This
    security patch level string indicates that all issues associated with 2017-09-01
    and 2017-09-05 (and all previous security patch level strings) are
    addressed.

## Android and Google service mitigations

This is a summary of the mitigations provided by the
[Android security platform](/docs/security/enhancements)
and service protections such as
[Google Play Protect](https://www.android.com/play-protect). These
capabilities reduce the likelihood that security vulnerabilities could be
successfully exploited on Android.

* Exploitation for many issues on Android is made more difficult by
  enhancements in newer versions of the Android platform. We encourage all users
  to update to the latest version of Android where possible.
* The Android security team actively monitors for abuse through [Google Play Protect](https://www.android.com/play-protect) and warns
  users about [Potentially Harmful Applications](https://developers.google.com/android/play-protect/potentially-harmful-applications). Google Play Protect is enabled by default on devices
  with [Google Mobile Services](http://www.android.com/gms), and is
  especially important for users who install apps from outside of Google
  Play.

## 2017-09-01 security patch level—Vulnerability details

In the sections below, we provide details for each of the security
vulnerabilities that apply to the 2017-09-01 patch level. Vulnerabilities are
grouped under the component that they affect. There is a description of the
issue and a table with the CVE, associated references,
[type of vulnerability](#type),
[severity](/docs/security/overview/updates-resources#severity),
and updated AOSP versions (where applicable). When available, we link the public
change that addressed the issue to the bug ID, like the AOSP change list. When
multiple changes relate to a single bug, additional references are linked to
numbers following the bug ID.

### Framework

The most severe vulnerability in this section could enable a local malicious
application to bypass user interaction requirements in order to gain access to
additional permissions.

| CVE | References | Type | Severity | Updated AOSP versions |
| CVE-2017-0752 | [A-62196835](https://android.googlesource.com/platform/frameworks/base/%2B/6ca2eccdbbd4f11698bd5312812b4d171ff3c8ce) [[2](https://android.googlesource.com/platform/packages/apps/Settings/%2B/fc65be941a4dbebfdbe53cd0bd6cc5cc1142a908)] | EoP | High | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0, 7.1.1, 7.1.2 |

### Libraries

The most severe vulnerability in this section could enable a remote attacker
using a specially crafted file to execute arbitrary code within the context of
an unprivileged process.

| CVE | References | Type | Severity | Updated AOSP versions |
| CVE-2017-0753 | [A-62218744](https://android.googlesource.com/platform/manifest/%2B/c0218b536c4243993bb666910d888cf16191dfd1) | RCE | High | 7.1.1, 7.1.2, 8.0 |
| CVE-2017-6983 | [A-63852675](https://android.googlesource.com/platform/external/sqlite/%2B/a1b4a910e8bf11e03479d91004652fc5919f475b) | RCE | High | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0, 7.1.1, 7.1.2, 8.0 |
| CVE-2017-0755 | [A-32178311](https://android.googlesource.com/platform/frameworks/minikin/%2B/0dfb3527ba1ebbe97ad927e1f773427201aab501) | EoP | High | 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0, 7.1.1, 7.1.2, 8.0 |

### Media Framework

The most severe vulnerability in this section could enable a remote attacker
using a specially crafted file to execute arbitrary code within the context of
a privileged process.

| CVE | References | Type | Severity | Updated AOSP versions |
| CVE-2017-0756 | [A-34621073](https://android.googlesource.com/platform/frameworks/av/%2B/9aa026d0b867b270149dd7323ce36f4f9bfea980) | RCE | Critical | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0, 7.1.1, 7.1.2 |
| CVE-2017-0757 | [A-36006815](https://android.googlesource.com/platform/external/libavc/%2B/bb88d4430189b66270c66ff9167fc5bcf4356cf2) | RCE | Critical | 6.0, 6.0.1, 7.0, 7.1.1, 7.1.2 |
| CVE-2017-0758 | [A-36492741](https://android.googlesource.com/platform/external/libhevc/%2B/4a534a34b14944f3513b7c101fc74ab0ec9eac0d) | RCE | Critical | 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0, 7.1.1, 7.1.2 |
| CVE-2017-0759 | [A-36715268](https://android.googlesource.com/platform/frameworks/av/%2B/6c91acf543ea20281f7e3d83414fab3cc64f1938) | RCE | Critical | 6.0, 6.0.1, 7.0, 7.1.1, 7.1.2 |
| CVE-2017-0760 | [A-37237396](https://android.googlesource.com/platform/frameworks/av/%2B/9cb10d49b1319ea1207cc2f445089aa9266ffc71) | RCE | Critical | 6.0, 6.0.1, 7.0, 7.1.1, 7.1.2 |
| CVE-2017-0761 | [A-38448381](https://android.googlesource.com/platform/external/libavc/%2B/ce512058186120a0de2916f6e22be58455df1a49) | RCE | Critical | 6.0, 6.0.1, 7.0, 7.1.1, 7.1.2, 8.0 |
| CVE-2017-0762 | [A-62214264](https://android.googlesource.com/platform/external/libhevc/%2B/50acbc692998474c598834c9453ca9675b8fb95b) | RCE | Critical | 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0, 7.1.1, 7.1.2 |
| CVE-2017-0763 | [A-62534693](https://android.googlesource.com/platform/external/libhevc/%2B/0b57e70715c17e038b2fec0f808c1cd2172f4775) | RCE | Critical | 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0, 7.1.1, 7.1.2, 8.0 |
| CVE-2017-0764 | [A-62872015](https://android.googlesource.com/platform/external/tremolo/%2B/dbf3d0fa7b89aa09ec7bf69699f6233c59070dbc) | RCE | Critical | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0, 7.1.1, 7.1.2, 8.0 |
| CVE-2017-0765 | [A-62872863](https://android.googlesource.com/platform/frameworks/av/%2B/7c4c7fa208e31dc6f355a4488f267122015730a3) | RCE | Critical | 6.0, 6.0.1, 7.0, 7.1.1, 7.1.2, 8.0 |
| CVE-2017-0766 | [A-37776688](https://android.googlesource.com/platform/manifest/%2B/c0218b536c4243993bb666910d888cf16191dfd1) | RCE | High | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0, 7.1.1, 7.1.2 |
| CVE-2017-0767 | [A-37536407](https://android.googlesource.com/platform/frameworks/av/%2B/2410a6fa4286efc8c5b5a5f33f6eeb023bfb6abb) [[2](https://android.googlesource.com/platform/hardware/qcom/audio/%2B/045e30499e3c73fb05b0a97da2420fd27bb263a3)] | EoP | High | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0, 7.1.1, 7.1.2 |
| CVE-2017-0768 | [A-62019992](https://android.googlesource.com/platform/frameworks/av/%2B/d8cc1fe9294accf05c6afcbe7821a485b9939af7) | EoP | High | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0, 7.1.1, 7.1.2, 8.0 |
| CVE-2017-0769 | [A-37662122](https://android.googlesource.com/platform/frameworks/av/%2B/0be8a2541594feec746195d6dbbc0db6c602175e) | EoP | High | 7.0, 7.1.1, 7.1.2, 8.0 |
| CVE-2017-0770 | [A-38234812](https://android.googlesource.com/platform/frameworks/av/%2B/292d85545c6dec3c4386ec1fc2877597ea0ac5cc) | EoP | High | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0, 7.1.1, 7.1.2, 8.0 |
| CVE-2017-0771 | [A-37624243](https://android.googlesource.com/platform/external/skia/%2B/f593adeec75fe65771dfe67deca33fa4434b4e8a) | DoS | High | 7.0, 7.1.1, 7.1.2 |
| CVE-2017-0772 | [A-38115076](https://android.googlesource.com/platform/external/libavc/%2B/1e0b52c25b20685ff9d6a14603b6a30f698824a7) | DoS | High | 6.0, 6.0.1, 7.0, 7.1.1, 7.1.2, 8.0 |
| CVE-2017-0773 | [A-37615911](https://android.googlesource.com/platform/external/libhevc/%2B/9a03f9511559f82d034603e1df1425a4e0650f92) | DoS | High | 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0, 7.1.1, 7.1.2, 8.0 |
| CVE-2017-0774 | [A-62673844](https://android.googlesource.com/platform/frameworks/av/%2B/d4af2450c500c7d153fd66771b613f6e6882bf08) [[2](https://android.googlesource.com/platform/frameworks/av/%2B/5f56ec847a7f6250abd36a2f8a7b7baf4f966d11)] | DoS | High | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0, 7.1.1, 7.1.2 |
| CVE-2017-0775 | [A-62673179](https://android.googlesource.com/platform/frameworks/av/%2B/a1d5b40aaaa050af40c0f95d8b2d3e1ae8cfebbf) | DoS | High | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0, 7.1.1, 7.1.2, 8.0 |
| CVE-2017-0776 | [A-38496660](https://android.googlesource.com/platform/external/libavc/%2B/5863b2e39357d82d53b3163afd38ad3bb0a07042) | ID | Moderate | 7.0, 7.1.1, 7.1.2, 8.0 |
| DoS | High | 6.0.1 |
| CVE-2017-0777 | [A-38342499](https://android.googlesource.com/platform/external/sonivox/%2B/112d9533b13134edbf4b7ee17db735b4b1468297) | ID | Moderate | 7.0, 7.1.1, 7.1.2 |
| DoS | High | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1 |
| CVE-2017-0778 | [A-62133227](https://android.googlesource.com/platform/frameworks/av/%2B/d7a044350bc151c7f7c04e04aaf136488630d655) | ID | Moderate | 7.0, 7.1.1, 7.1.2 |
| DoS | High | 5.0.2, 5.1.1, 6.0, 6.0.1 |
| CVE-2017-0779 | [A-38340117](https://android.googlesource.com/platform/frameworks/av/%2B/ff4c8310ab7976ea9930b1dc4e3383720d5b5a8d) [[2](https://android.googlesource.com/platform/frameworks/av/%2B/b58464fa783c75ba9d304f670a4392df6fa98ed8)] | ID | Moderate | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0, 7.1.1, 7.1.2 |

### Runtime

The most severe vulnerability in this section could enable a remote attacker
using a specially crafted file to cause an application to hang.

| CVE | References | Type | Severity | Updated AOSP versions |
| CVE-2017-0780 | [A-37742976](https://android.googlesource.com/platform/packages/apps/Messaging/%2B/06cbd7f26ba58399f296d85fd155442c7f2ac837) | DoS | High | 6.0, 6.0.1, 7.0, 7.1.1, 7.1.2, 8.0 |

### System

The most severe vulnerability in this section could enable a proximate
attacker to execute arbitrary code within the context of a privileged
process.

| CVE | References | Type | Severity | Updated AOSP versions |
| CVE-2017-0781 | [A-63146105](https://android.googlesource.com/platform/system/bt/%2B/c513a8ff5cfdcc62cc14da354beb1dd22e56be0e) [[2](https://android.googlesource.com/platform/system/bt/%2B/1e0bb31f6a809b49014483dc118b9d9ad31ade68)] | RCE | Critical | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0, 7.1.1, 7.1.2, 8.0 |
| CVE-2017-0782 | [A-63146237](https://android.googlesource.com/platform/system/bt/%2B/4e47f3db62bab524946c46efe04ed6a2b896b150) [[2](https://android.googlesource.com/platform/system/bt/%2B/1b08775917413f1674882130a948add1ae44cc91)] [[3](https://android.googlesource.com/platform/system/bt/%2B/c568fa9088ded964e0ac99db236e612de5d82177)] | RCE | Critical | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0, 7.1.1, 7.1.2, 8.0 |
| CVE-2017-0783 | [A-63145701](https://android.googlesource.com/platform/system/bt/%2B/1e77fefc8b9c832239e1b32c6a6880376065e24e) | ID | High | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0, 7.1.1, 7.1.2, 8.0 |
| CVE-2017-0784 | [A-37287958](https://android.googlesource.com/platform/packages/apps/Nfc/%2B/e216bc208bc0f0f685d8271ef8a0b5da8fae1088) | EoP | Moderate | 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0, 7.1.1, 7.1.2 |
| CVE-2017-0785 | [A-63146698](https://android.googlesource.com/platform/system/bt/%2B/226ea26684d4cd609a5b456d3d2cc762453c2d75) | ID | Moderate | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0, 7.1.1, 7.1.2, 8.0 |

## 2017-09-05 security patch level—Vulnerability details

In the sections below, we provide details for each of the security
vulnerabilities that apply to the 2017-09-05 patch level. Vulnerabilities are
grouped under the component that they affect and include details such as the
CVE, associated references, [type of vulnerability](#type),
[severity](/docs/security/overview/updates-resources#severity),
component (where applicable), and updated AOSP versions (where applicable). When
available, we link the public change that addressed the issue to the bug ID,
like the AOSP change list. When multiple changes relate to a single bug,
additional references are linked to numbers following the bug ID.

### Broadcom components

The most severe vulnerability in this section could enable a proximate
attacker using a specially crafted file to execute arbitrary code within the
context of a privileged process.

| CVE | References | Type | Severity | Component |
| CVE-2017-11120 | A-62575409[\*](#asterisk) B-V2017061204 | RCE | Critical | Wi-Fi driver |
| CVE-2017-11121 | A-62576413[\*](#asterisk) B-V2017061205 | RCE | Critical | Wi-Fi driver |
| CVE-2017-7065 | A-62575138[\*](#asterisk) B-V2017061202 | RCE | Critical | Wi-Fi driver |
| CVE-2017-0786 | A-37351060[\*](#asterisk) B-V2017060101 | EoP | High | Wi-Fi driver |
| CVE-2017-0787 | A-37722970[\*](#asterisk) B-V2017053104 | EoP | Moderate | Wi-Fi driver |
| CVE-2017-0788 | A-37722328[\*](#asterisk) B-V2017053103 | EoP | Moderate | Wi-Fi driver |
| CVE-2017-0789 | A-37685267[\*](#asterisk) B-V2017053102 | EoP | Moderate | Wi-Fi driver |
| CVE-2017-0790 | A-37357704[\*](#asterisk) B-V2017053101 | EoP | Moderate | Wi-Fi driver |
| CVE-2017-0791 | A-37306719[\*](#asterisk) B-V2017052302 | EoP | Moderate | Wi-Fi driver |
| CVE-2017-0792 | A-37305578[\*](#asterisk) B-V2017052301 | ID | Moderate | Wi-Fi driver |

### Imgtk components

The most severe vulnerability in this section could enable a local malicious
application to access data outside of its permission levels.

| CVE | References | Type | Severity | Component |
| CVE-2017-0793 | A-35764946[\*](#asterisk) | ID | High | Memory subsystem |

### Kernel components

The most severe vulnerability in this section could enable a remote attacker
using a specially crafted file to execute arbitrary code within the context of
a privileged process.

| CVE | References | Type | Severity | Component |
| CVE-2017-8890 | A-38413975 [Upstream kernel](http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=657831ffc38e30092a2d5f03d385d710eb88b09a) | RCE | Critical | Networking subsystem |
| CVE-2017-9076 | A-62299478 [Upstream kernel](http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=83eaddab4378db256d00d295bda6ca997cd13a52) | EoP | High | Networking subsystem |
| CVE-2017-9150 | A-62199770 [Upstream kernel](http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=0d0e57697f162da4aa218b5feafe614fb666db07) | ID | High | Linux kernel |
| CVE-2017-7487 | A-62070688 [Upstream kernel](http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=ee0d8d8482345ff97a75a7d747efc309f13b0d80) | EoP | High | IPX protocol driver |
| CVE-2017-6214 | A-37901268 [Upstream kernel](http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=ccf7abb93af09ad0868ae9033d1ca8108bdaec82) | DoS | High | Networking subsystem |
| CVE-2017-6346 | A-37897645 [Upstream kernel](http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=d199fab63c11998a602205f7ee7ff7c05c97164b) | EoP | High | Linux kernel |
| CVE-2017-5897 | A-37871211 [Upstream kernel](https://git.kernel.org/pub/scm/linux/kernel/git/davem/net.git/commit/?id=7892032cfe67f4bde6fc2ee967e45a8fbaf33756) | ID | High | Networking subsystem |
| CVE-2017-7495 | A-62198330 [Upstream kernel](http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=06bd3c36a733ac27962fea7d6f47168841376824) | ID | High | File system |
| CVE-2017-7616 | A-37751399 [Upstream kernel](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=cf01fb9985e8deb25ccf0ea54d916b8871ae0e62) | ID | Moderate | Linux kernel |
| CVE-2017-12146 | A-35676417 [Upstream kernel](https://git.kernel.org/pub/scm/linux/kernel/git/gregkh/driver-core.git/commit/?h=driver-core-next&id=6265539776a0810b7ce6398c27866ddb9c6bd154) | EoP | Moderate | Linux kernel |
| CVE-2017-0794 | A-35644812[\*](#asterisk) | EoP | Moderate | SCSI driver |

### MediaTek components

The most severe vulnerability in this section could enable a local malicious
application to execute arbitrary code within the context of a privileged
process.

| CVE | References | Type | Severity | Component |
| CVE-2017-0795 | A-36198473[\*](#asterisk) M-ALPS03361480 | EoP | High | Accessory detector driver |
| CVE-2017-0796 | A-62458865[\*](#asterisk) M-ALPS03353884 M-ALPS03353886 M-ALPS03353887 | EoP | High | AUXADC driver |
| CVE-2017-0797 | A-62459766[\*](#asterisk) M-ALPS03353854 | EoP | High | Accessory detector driver |
| CVE-2017-0798 | A-36100671[\*](#asterisk) M-ALPS03365532 | EoP | High | Kernel |
| CVE-2017-0799 | A-36731602[\*](#asterisk) M-ALPS03342072 | EoP | High | Lastbus |
| CVE-2017-0800 | A-37683975[\*](#asterisk) M-ALPS03302988 | EoP | High | TEEI |
| CVE-2017-0801 | A-38447970[\*](#asterisk) M-ALPS03337980 | EoP | High | LibMtkOmxVdec |
| CVE-2017-0802 | A-36232120[\*](#asterisk) M-ALPS03384818 | EoP | Moderate | Kernel |
| CVE-2017-0803 | A-36136137[\*](#asterisk) M-ALPS03361477 | EoP | Moderate | Accessory detector driver |
| CVE-2017-0804 | A-36274676[\*](#asterisk) M-ALPS03361487 | EoP | Moderate | MMC driver |

### Qualcomm components

The most severe vulnerability in this section could enable a remote attacker
using a specially crafted file to execute arbitrary code within the context of
a privileged process.

| CVE | References | Type | Severity | Component |
| CVE-2017-11041 | A-36130225[\*](#asterisk) QC-CR#2053101 | RCE | Critical | LibOmxVenc |
| CVE-2017-10996 | A-38198574 [QC-CR#901529](https://source.codeaurora.org/quic/la/kernel/msm-3.18/commit/?id=9f261e5dfe101bbe35043822a89bffa78e080b3b) | ID | High | Linux kernel |
| CVE-2017-9725 | A-38195738 [QC-CR#896659](https://source.codeaurora.org/quic/la/kernel/msm-4.4/commit/?h=aosp/android-4.4&id=1f8f9b566e8446c13b954220c226c58d22076f88) | EoP | High | Memory subsystem |
| CVE-2017-9724 | A-38196929 [QC-CR#863303](https://source.codeaurora.org/quic/la/kernel/msm-3.10/commit/?id=5328a92fa26eabe2ba259b1d813f9de488efc9ec) | EoP | High | Linux kernel |
| CVE-2017-8278 | A-62379474 [QC-CR#2013236](https://source.codeaurora.org/quic/la/platform/hardware/qcom/audio/commit/?id=16caa80d6bd59fc645afda37dec4104d451e2f66) | EoP | High | Audio driver |
| CVE-2017-10999 | A-36490777[\*](#asterisk) QC-CR#2010713 | EoP | Moderate | IPA driver |
| CVE-2017-11001 | A-36815555[\*](#asterisk) QC-CR#2051433 | ID | Moderate | Wi-Fi driver |
| CVE-2017-11002 | A-37712167[\*](#asterisk) QC-CR#2058452 QC-CR#2054690 QC-CR#2058455 | ID | Moderate | Wi-Fi driver |
| CVE-2017-8250 | A-62379051 [QC-CR#2003924](https://source.codeaurora.org/quic/la/kernel/msm-3.18/commit/?id=9be5b16de622c2426408425e3df29e945cd21d37) | EoP | Moderate | GPU driver |
| CVE-2017-9677 | A-62379475 [QC-CR#2022953](https://source.codeaurora.org/quic/la/kernel/msm-3.18/commit/?id=dc333eb1c31b5bdd2b6375d7cb890086d8f27d8b) | EoP | Moderate | Audio driver |
| CVE-2017-10998 | A-38195131 [QC-CR#108461](https://source.codeaurora.org/quic/la//kernel/msm-3.18/commit/?id=208e72e59c8411e75d4118b48648a5b7d42b1682) | EoP | Moderate | Audio driver |
| CVE-2017-9676 | A-62378596 [QC-CR#2016517](https://source.codeaurora.org/quic/la/kernel/msm-3.18/commit/?id=c1f749639030305a3b02185c180240a8195fb715) | ID | Moderate | File system |
| CVE-2017-8280 | A-62377236 [QC-CR#2015858](https://source.codeaurora.org/quic/la/kernel/msm-3.18/commit/?id=49b9a02eaaeb0b70608c6fbcadff7d83833b9614) | EoP | Moderate | WLAN driver |
| CVE-2017-8251 | A-62379525 [QC-CR#2006015](https://source.codeaurora.org/quic/la/kernel/msm-4.4/commit/?id=771254edea3486535453dbb76d090cd6bcf92af9) | EoP | Moderate | Camera driver |
| CVE-2017-10997 | A-33039685[\*](#asterisk) QC-CR#1103077 | EoP | Moderate | PCI driver |
| CVE-2017-11000 | A-36136563[\*](#asterisk) QC-CR#2031677 | EoP | Moderate | Camera driver |
| CVE-2017-8247 | A-62378684 [QC-CR#2023513](https://source.codeaurora.org/quic/la/kernel/msm-4.4/commit/?id=84f8c42e5d848b1d04f49d253f98296e8c2280b9) | EoP | Moderate | Camera driver |
| CVE-2017-9720 | A-36264696[\*](#asterisk) QC-CR#2041066 | EoP | Moderate | Camera driver |
| CVE-2017-8277 | A-62378788 [QC-CR#2009047](https://source.codeaurora.org/quic/la//kernel/msm-4.4/commit/?id=c9a6f09f1030cec591df837622cb54bbb2d24ddc) | EoP | Moderate | Video driver |
| CVE-2017-8281 | A-62378232 [QC-CR#2015892](https://source.codeaurora.org/quic/la/kernel/msm-3.18/commit/?id%3D9be5b16de622c2426408425e3df29e945cd21d37&sa=D&usg=AFQjCNHuM63XOo5Y0C7bMJQIIedBHSDKjw) | ID | Moderate | Automotive multimedia |
| CVE-2017-11040 | A-37567102[\*](#asterisk) QC-CR#2038166 | ID | Moderate | Video driver |

## Google device updates

This table contains the security patch level in the latest over-the-air update
(OTA) and firmware images for Google devices. The Google device OTAs may also
contain additional updates. The Google device firmware images are available on
the [Google
Developer site](https://developers.google.com/android/nexus/images).

Pixel, Pixel XL, Pixel C, Nexus Player, Nexus 5X, and Nexus 6P
devices will be receiving the September security patches as part of the
upgrade to Android Oreo.

| Google device | Security patch level |
| --- | --- |
| Pixel / Pixel XL | 2017-09-05 |
| Nexus 5X | 2017-09-05 |
| Nexus 6 | 2017-09-05 |
| Nexus 6P | 2017-09-05 |
| Nexus 9 | 2017-09-05 |
| Nexus Player | 2017-09-05 |
| Pixel C | 2017-09-05 |

## Acknowledgements

We would like to thank these researchers for their contributions:

| CVEs | Researchers |
| CVE-2017-11000 | Baozeng Ding ([@sploving](https://twitter.com/sploving1)), Chengming Yang, and Yang Song of Alibaba Mobile Security Group |
| CVE-2017-0781, CVE-2017-0782, CVE-2017-0783, CVE-2017-0785 | Ben Seri and Gregory Vishnepolsky of Armis, Inc. (<https://armis.com>) |
| CVE-2017-0800, CVE-2017-0798 | Chengming Yang, Baozeng Ding, and Yang Song of Alibaba Mobile Security Group |
| CVE-2017-0765 | Chi Zhang, Mingjian Zhou ([@Mingjian\_Zhou](https://twitter.com/Mingjian_Zhou)), and Xuxian Jiang of [C0RE Team](http://c0reteam.org) |
| CVE-2017-0758 | [Chong Wang](http://weibo.com/csddl) and 金哲 (Zhe Jin) of Chengdu Security Response Center, Qihoo 360 Technology Co. Ltd. |
| CVE-2017-0752 | Cong Zheng ([@shellcong](https://twitter.com/shellcong)), Wenjun Hu, Xiao Zhang, and Zhi Xu of Palo Alto Networks |
| CVE-2017-0801 | Dacheng Shao, Mingjian Zhou ([@Mingjian\_Zhou](https://twitter.com/Mingjian_Zhou)), and Xuxian Jiang of [C0RE Team](http://c0reteam.org) |
| CVE-2017-0755 | Dawei Peng of Alibaba Mobile Security Team ([weibo: Vinc3nt4H](http://weibo.com/u/5622360291)) |
| CVE-2017-0775, CVE-2017-0774, CVE-2017-0771 | Elphet and Gong Guang of Alpha Team, Qihoo 360 Technology Co. Ltd. |
| CVE-2017-0784 | En He ([@heeeeen4x](https://twitter.com/heeeeen4x)) and Bo Liu of [MS509Team](http://www.ms509.com) |
| CVE-2017-10997 | Gengjia Chen ([@chengjia4574](https://twitter.com/chengjia4574)) and [pjf](http://weibo.com/jfpan) of IceSword Lab, Qihoo 360 Technology Co. Ltd. |
| CVE-2017-0786, CVE-2017-0792, CVE-2017-0791, CVE-2017-0790, CVE-2017-0789, CVE-2017-0788, CVE-2017-0787 | Hao Chen and Guang Gong of Alpha Team, Qihoo 360 Technology Co. Ltd. |
| CVE-2017-0802 | Jake Corina ([@JakeCorina](https://twitter.com/JakeCorina)) of Shellphish Grill Team |
| CVE-2017-0780 | Jason Gu and Seven Shen of Trend Micro |
| CVE-2017-0769 | Mingjian Zhou ([@Mingjian\_Zhou](https://twitter.com/Mingjian_Zhou)), Dacheng Shao, and Xuxian Jiang of [C0RE Team](http://c0reteam.org) |
| CVE-2017-0794, CVE-2017-9720, CVE-2017-11001, CVE-2017-10999, CVE-2017-0766 | Pengfei Ding (丁鹏飞), Chenfu Bao (包沉浮), Lenx Wei (韦韬) of Baidu X-Lab (百度安全实验室) |
| CVE-2017-0772 | Seven Shen of Trend Micro |
| CVE-2017-0757 | Vasily Vasiliev |
| CVE-2017-0768, CVE-2017-0779 | Wenke Dou, Mingjian Zhou ([@Mingjian\_Zhou](https://twitter.com/Mingjian_Zhou)), and Xuxian Jiang of [C0RE Team](http://c0reteam.org) |
| CVE-2017-0759 | [Weichao Sun](https://twitter.com/sunblate) of Alibaba Inc. |
| CVE-2017-0796 | Xiangqian Zhang, Chengming Yang, Baozeng Ding, and Yang Song of Alibaba Mobile Security Group |
| CVE-2017-0753 | Yangkang ([@dnpushme](https://twitter.com/dnpushme)) and hujianfei of Qihoo360 Qex Team |
| CVE-2017-12146 | Yonggang Guo ([@guoygang](https://twitter.com/guoygang)) of IceSword Lab, Qihoo 360 Technology Co. Ltd. |
| CVE-2017-0767 | Yongke Wang and Yuebin Sun of [Tencent's Xuanwu Lab](http://xlab.tencent.com) |
| CVE-2017-0804, CVE-2017-0803, CVE-2017-0799, CVE-2017-0795 | [Yu Pan](http://weibo.com/panyu6325) and Yang Dai of Vulpecker Team, Qihoo 360 Technology Co. Ltd |
| CVE-2017-0760 | [Zinuo Han](http://weibo.com/ele7enxxh) and 金哲 (Zhe Jin) of Chengdu Security Response Center, Qihoo 360 Technology Co. Ltd. |
| CVE-2017-0764, CVE-2017-0761, CVE-2017-0776, CVE-2017-0777, CVE-2017-0778 | [Zinuo Han](http://weibo.com/ele7enxxh) of Chengdu Security Response Center, Qihoo 360 Technology Co. Ltd. |

## Common questions and answers

This section answers common questions that may occur after reading this
bulletin.

**1. How do I determine if my device is updated to address these issues?**

To learn how to check a device's security patch level, read the instructions on
the [Pixel
and Nexus update schedule](https://support.google.com/pixelphone/answer/4457705#pixel_phones&nexus_devices).

* Security patch levels of 2017-09-01 or later address all issues associated
  with the 2017-09-01 security patch level.
* Security patch levels of 2017-09-05 or later address all issues associated
  with the 2017-09-05 security patch level and all previous patch levels.

Device manufacturers that include these updates should set the patch string
level to:

* [ro.build.version.security\_patch]:[2017-09-01]
* [ro.build.version.security\_patch]:[2017-09-05]

**2. Why does this bulletin have two security patch levels?**

This bulletin has two security patch levels so that Android partners have the
flexibility to fix a subset of vulnerabilities that are similar across all
Android devices more quickly. Android partners are encouraged to fix all issues
in this bulletin and use the latest security patch level.

* Devices that use the 2017-09-01 security patch level must include all issues
  associated with that security patch level, as well as fixes for all issues
  reported in previous security bulletins.
* Devices that use the security patch level of 2017-09-05 or newer must
  include all applicable patches in this (and previous) security
  bulletins.

Partners are encouraged to bundle the fixes for all issues they are addressing
in a single update.

**3. What do the entries in the *Type* column mean?**

Entries in the *Type* column of the vulnerability details table reference
the classification of the security vulnerability.

| Abbreviation | Definition |
| RCE | Remote code execution |
| EoP | Elevation of privilege |
| ID | Information disclosure |
| DoS | Denial of service |
| N/A | Classification not available |

**4. What do the entries in the *References* column mean?**

Entries under the *References* column of the vulnerability details table
may contain a prefix identifying the organization to which the reference value
belongs.

| Prefix | Reference |
| A- | Android bug ID |
| QC- | Qualcomm reference number |
| M- | MediaTek reference number |
| N- | NVIDIA reference number |
| B- | Broadcom reference number |

**5. What does a \* next to the Android bug ID in the *References*
column mean?**

Issues that are not publicly available have a \* next to the Android bug ID in
the *References* column. The update for that issue is generally contained
in the latest binary drivers for Nexus devices available from the [Google Developer
site](https://developers.google.com/android/nexus/drivers).

## Versions

| Version | Date | Notes |
| 1.0 | September 5, 2017 | Bulletin published. |
| 1.1 | September 12, 2017 | Added details for CVE-2017-0781, CVE-2017-0782, CVE-2017-0783, and CVE-2017-0785 as part of industry-coordinated disclosure. |
| 1.2 | September 13, 2017 | Bulletin revised to include AOSP links. |
| 1.3 | September 25, 2017 | Added details for CVE-2017-11120 and CVE-2017-11121 as part of industry-coordinated disclosure. |
| 1.4 | September 28, 2017 | Update vendor reference for CVE-2017-11001. |

Content and code samples on this page are subject to the licenses described in the [Content License](/license). Java and OpenJDK are trademarks or registered trademarks of Oracle and/or its affiliates.

Last updated 2024-08-26 UTC.

[[["Easy to understand","easyToUnderstand","thumb-up"],["Solved my problem","solvedMyProblem","thumb-up"],["Other","otherUp","thumb-up"]],[["Missing the information I need","missingTheInformationINeed","thumb-down"],["Too complicated / too many steps","tooComplicatedTooManySteps","thumb-down"],["Out of date","outOfDate","thumb-down"],["Samples / code issue","samplesCodeIssue","thumb-down"],["Other","otherDown","thumb-down"]],["Last updated 2024-08-26 UTC."],[],[]]

* ### Build

  + [Android repository](//android.googlesource.com)
  + [Requirements](/source/requirements)
  + [Downloading](/source/downloading)
  + [Preview binaries](//developers.google.com/android/blobs-preview/)
  + [Factory images](//developers.google.com/android/images/)
  + [Driver binaries](//developers.google.com/android/drivers/)
* ### Connect

  + [@Android on Twitter](//twitter.com/Android/)
  + [@AndroidDev on Twitter](//twitter.com/AndroidDev/)
  + [Android Blog](//blog.google/products/android/)
  + [Google Security Blog](//security.googleblog.com)
  + [Platform on Google Groups](//groups.google.com/forum/?fromgroups#!forum/android-platform/)
  + [Building on Google Groups](//groups.google.com/forum/?fromgroups#!forum/android-building/)
  + [Porting on Google Groups](//groups.google.com/forum/?fromgroups#!forum/android-porting/)
* ### Get help

  + [Android Help Center](//support.google.com/android/)
  + [Pixel Help Center](//support.google.com/pixelphone/)
  + [www.android.com](//www.android.com)
  + [Google Mobile Services](//www.android.com/gms/)
  + [Stack Overflow](//stackoverflow.com/questions/tagged/android-source/)
  + [Issue Tracker](//issuetracker.google.com/issues?q=status:open%20componentid:190923)

* [About Android](/source/)
* [Community](/source/community)
* [Legal](/legal)
* [License](/license)
* [Privacy](//policies.google.com/privacy)
* [Site feedback](//issuetracker.google.com/issues/new?component=191476)
* Manage cookies

* English
* Deutsch
* Español
* Español – América Latina
* Français
* Indonesia
* Italiano
* Polski
* Português
* Português – Brasil
* Tiếng Việt
* Türkçe
* Русский
* עברית
* العربيّة
* فارسی
* हिंदी
* বাংলা
* ภาษาไทย
* 中文 – 简体
* 中文 – 繁體
* 日本語
* 한국어



=== Content from bugzilla.redhat.com_ca2d4e33_20250124_150350.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1450261)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1450261)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1450261)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1450261

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1450261**](show_bug.cgi?id=1450261)
(CVE-2017-7495)
- [CVE-2017-7495](https://access.redhat.com/security/cve/CVE-2017-7495) kernel: ext4: power failure during write(2) causes on-disk information leak

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2017-7495 kernel: ext4: power failure during write(2) causes on-disk info...

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2017-7495 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [1454551](show_bug.cgi?id=1454551) [1454552](show_bug.cgi?id=1454552) [1454553](show_bug.cgi?id=1454553) [1461806](show_bug.cgi?id=1461806) [1461807](show_bug.cgi?id=1461807) | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1325973](show_bug.cgi?id=1325973) | | TreeView+ | [depends on](buglist.cgi?bug_id=1450261&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1450261&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2017-05-12 03:17 UTC by Wade Mealing | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2023-09-25 05:56 UTC ([History](show_activity.cgi?id=1450261)) | | [CC List:](page.cgi?id=fields.html#cclist) | 23 users (show)  aquini bhu dhoward dominik.mierzejewski esammons fhrbata iboverma jross kernel-mgr lczerner lwang matt mcressma mguzik nmurray pholasek plougher pmatouse rvrbovsk slawomir vdronov williams wmealing | | Fixed In Version: |  | | | Doc Type: | If docs needed, set a value | | | Doc Text: | A vulnerability was found in the Linux kernel where filesystems mounted with data=ordered mode may allow an attacker to read stale data from recently allocated blocks in new files after a system 'reset' by abusing ext4 mechanics of delayed allocation. | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2018-03-23 15:12:46 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1450261#c0)  Wade Mealing    2017-05-12 03:17:41 UTC  ``` A flaw was found in the kernels implementation of ext4 for filesystems mounted with data=ordered mode. Stale data from recently allocated blocks may appear in newly created blocks in files when a system is 'power reset'.  This may allow an attacker to gain information about file contents being written to disk when the system was being reset.  This issue only affects regular write()'s and not when an application is using direct IO.  In testing, the amount of stale-data leakage is at maximum the amount of outstanding delayed journal transactions to the underlying device since the last commit (defaulting to 5 seconds, but tunable/exasperated with commit=nrsec mount option).   ```  [Comment 2](show_bug.cgi?id=1450261#c2)  Wade Mealing    2017-05-12 03:18:21 UTC  ``` Mitigation:  Alternative filesystems may be used in place of ext4 in case of sensitive data leak. Alternatively, don't hard reset the system.   ```  [Comment 3](show_bug.cgi?id=1450261#c3)  Wade Mealing    2017-05-23 03:28:27 UTC  ``` Acknowledgments:  Name: Takeshi Nishimura (NEC)   ```  [Comment 5](show_bug.cgi?id=1450261#c5)  Wade Mealing    2017-05-23 03:49:51 UTC  ``` Statement:  This issue does not affect the Linux kernel packages as shipped with Red Hat Enterprise Linux 5 and 6.  This issue affects the Linux kernel packages as shipped with Red Hat Enterprise Linux 7 and MRG-2.  Future Linux kernel updates for the respective releases may address this issue. fs   ```  [Comment 6](show_bug.cgi?id=1450261#c6)  Wade Mealing    2017-05-23 03:56:25 UTC  ``` External References:  <https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=06bd3c36a733ac27962fea7d6f47168841376824>  <http://seclists.org/oss-sec/2017/q2/259>   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1450261&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from access.redhat.com_da540b5f_20250126_015221.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from www.openwall.com_37220c01_20250124_150349.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](1) [[next>]](3) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <CALJHwhTK3+YqzhtPLa96QNYTkfDRv_YPc0bieXvLgQDRRoFRWQ@mail.gmail.com>
Date: Mon, 15 May 2017 15:40:39 +1000
From: Wade Mealing <wmealing@...hat.com>
To: oss-security@...ts.openwall.com
Subject: CVE-2017-7495 kernel : information leak on ext4 when hardware reset.

When a power failure (or hardware reset) occurs, applications writing to an
ext4 filesystem system may create a situation in which writes to one file
may appear in another file (ergo information leak).

This may be at least data corruption, a controlled attacker may be able to
leverage this to steal data from writes to the same ext4 subsystem.

Reference:

Red Hat Bugzilla:
<https://bugzilla.redhat.com/show_bug.cgi?id=1450261>

Upstream patch:
<https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=06bd3c36a733ac27962fea7d6f47168841376824>

Thanks

--

Wade Mealing
Red Hat Product Security

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).


