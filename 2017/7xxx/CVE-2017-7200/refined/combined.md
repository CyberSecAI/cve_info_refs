=== Content from bugs.launchpad.net_27d862da_20250125_094235.html ===

[Log in / Register](https://bugs.launchpad.net/ossn/%2Bbug/1606495/%2Blogin)

[![](/@@/product-logo)](https://launchpad.net/ossn)

## [OpenStack Security Notes](https://launchpad.net/ossn)

* [Overview](https://launchpad.net/ossn)
* [Code](https://code.launchpad.net/ossn)
* [Bugs](https://bugs.launchpad.net/ossn)
* [Blueprints](https://blueprints.launchpad.net/ossn)
* [Translations](https://translations.launchpad.net/ossn)
* [Answers](https://answers.launchpad.net/ossn)

# copy\_from in api v1 allows network port scan

Bug #1606495 reported by
[Tom Patzig](https://launchpad.net/~tom-patzig)
on 2016-07-26

[16](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [Glance](https://bugs.launchpad.net/glance) | Won't Fix | Undecided | Unassigned |  |
|  | [OpenStack Security Advisory](https://bugs.launchpad.net/ossa) | Opinion | Undecided | Unassigned |  |
|  | [OpenStack Security Notes](https://bugs.launchpad.net/ossn) | Fix Released | Undecided | [Luke Hinds](https://launchpad.net/~lhinds) |  |

### Bug Description

copy\_from allows to create Images with an url like <http://localhost:22>

The remote content gets copied unverified in the defined glance store.

E.g. after downloading the image with copy\_from url <http://localhost:22>, you see the OpenSSH banner.

This is a security issue, as it allows users to do network "scans" for open ports and it copies remote (potentially malicious) content unverified to your configured glance store.

glance api v1 is still the default in horizon.

See [original description](comments/0)

Tags:

[security](/ossn/%2Bbugs?field.tag=security)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2016-07-26: |  |  | [#1](/ossn/%2Bbug/1606495/comments/1) |
| --- | --- | --- | --- |

Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.

Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.

| **description**: | updated |
| --- | --- |
| Changed in ossa: | |
| **status**: | New â†’ Incomplete |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brian Rosmaita (brian-rosmaita)](https://launchpad.net/~brian-rosmaita) wrote on 2016-07-27: |  |  | [#2](/ossn/%2Bbug/1606495/comments/2) |
| --- | --- | --- | --- |

Yep, copy\_from is dangerous, that's why it's not in the v2 API and one reason why the v1 API will be deprecated in Newton.

As far as malicious content goes, it does make it easier for an end user to be tricked (they just need to know the URL) and Glance will go get it for them. But if a cloud allows end users to upload image data, the end user can simply download from the URL and then upload the payload. Thus I don't see it as being much different from the current situation.

The port scanner is an interesting case as it can expose information about what ports are in use on the server running Glance. I don't know whether it could reveal info that couldn't be discovered by other means. Someone else will have to answer that.

Yep, copy\_from is dangerous, that's why it's not in the v2 API and one reason why the v1 API will be deprecated in Newton.
As far as malicious content goes, it does make it easier for an end user to be tricked (they just need to know the URL) and Glance will go get it for them. But if a cloud allows end users to upload image data, the end user can simply download from the URL and then upload the payload. Thus I don't see it as being much different from the current situation.
The port scanner is an interesting case as it can expose information about what ports are in use on the server running Glance. I don't know whether it could reveal info that couldn't be discovered by other means. Someone else will have to answer that.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2016-07-27: |  |  | [#3](/ossn/%2Bbug/1606495/comments/3) |
| --- | --- | --- | --- |

@Brian,

I think the port scan issue is that it allows a (more) masked port scan since the scan would come from glance. At the very least it could be utilized to scan resources that are not available externally because glance may talk on internal interfaces to other cloud-systems. This may expose information about what to attack once access to the internal networks are breached.

Secondarily it could be used to proxy-scan other hosts that are not part of the current cloud deployment. This could be used as a means to mask the real origin of the scan.

Could the info be found via other means? Yes, in some cases.

@Brian,
I think the port scan issue is that it allows a (more) masked port scan since the scan would come from glance. At the very least it could be utilized to scan resources that are not available externally because glance may talk on internal interfaces to other cloud-systems. This may expose information about what to attack once access to the internal networks are breached.
Secondarily it could be used to proxy-scan other hosts that are not part of the current cloud deployment. This could be used as a means to mask the real origin of the scan.
Could the info be found via other means? Yes, in some cases.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brian Rosmaita (brian-rosmaita)](https://launchpad.net/~brian-rosmaita) wrote on 2016-07-28: |  |  | [#4](/ossn/%2Bbug/1606495/comments/4) |
| --- | --- | --- | --- |

@Morgan,

Thanks for the additional info on the port scan issue.

My opinion is that this is a "won't fix" as a bug, since v1 is going to be deprecated and the functionality isn't present in v2. But that's just my opinion, we'll have to see what others think.

@Morgan,
Thanks for the additional info on the port scan issue.
My opinion is that this is a "won't fix" as a bug, since v1 is going to be deprecated and the functionality isn't present in v2. But that's just my opinion, we'll have to see what others think.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tom Patzig (tom-patzig)](https://launchpad.net/~tom-patzig) wrote on 2016-07-29: |  |  | [#5](/ossn/%2Bbug/1606495/comments/5) |
| --- | --- | --- | --- |

Was v1 already deprecated for Liberty & Mitaka If not than this might be a valid security bug for this stable releases.

If v1 is deprecated, than this is a horizon bug, which does only support v1. There is a blueprint open [https://blueprints.launchpad.net/horizon/+spec/horizon-glance-v2](https://blueprints.launchpad.net/horizon/%2Bspec/horizon-glance-v2)

But until this gets implemented a horizon config option, which disables the copy\_from URL input form, might be very helpful to address this issue.

Was v1 already deprecated for Liberty & Mitaka If not than this might be a valid security bug for this stable releases.
If v1 is deprecated, than this is a horizon bug, which does only support v1. There is a blueprint open https://blueprints.launchpad.net/horizon/+spec/horizon-glance-v2
But until this gets implemented a horizon config option, which disables the copy\_from URL input form, might be very helpful to address this issue.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brian Rosmaita (brian-rosmaita)](https://launchpad.net/~brian-rosmaita) wrote on 2016-07-29: |  |  | [#6](/ossn/%2Bbug/1606495/comments/6) |
| --- | --- | --- | --- |

Tom, you are right, the deprecation of v1 won't happen until Newton, so this will be a problem in the stable releases for a few cycles.

A horizon option to disable copy\_from sounds like a good idea to me.

On the Glance side, there is an existing "upload\_image" policy that blocks copy\_from -- but it also blocks any other functionality for uploading image data, and it affects both the v1 and v2 APIs.

Tom, you are right, the deprecation of v1 won't happen until Newton, so this will be a problem in the stable releases for a few cycles.
A horizon option to disable copy\_from sounds like a good idea to me.
On the Glance side, there is an existing "upload\_image" policy that blocks copy\_from -- but it also blocks any other functionality for uploading image data, and it affects both the v1 and v2 APIs.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-08-01: |  |  | [#7](/ossn/%2Bbug/1606495/comments/7) |
| --- | --- | --- | --- |

It seems like this bug can't be fixed with a non breaking stable branch fix. Perhaps it can be covered by the eventual OSSN about glance image creation ?

How about adding a "src\_store" blacklist option to prevent connections to localhost and management networks ?

It seems like this bug can't be fixed with a non breaking stable branch fix. Perhaps it can be covered by the eventual OSSN about glance image creation ?
How about adding a "src\_store" blacklist option to prevent connections to localhost and management networks ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tom Patzig (tom-patzig)](https://launchpad.net/~tom-patzig) wrote on 2016-08-04: |  |  | [#8](/ossn/%2Bbug/1606495/comments/8) |
| --- | --- | --- | --- |

What about a "copy\_from" policy to forbid this feature in glance v1?

What about a "copy\_from" policy to forbid this feature in glance v1?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tom Patzig (tom-patzig)](https://launchpad.net/~tom-patzig) wrote on 2016-08-04: |  |  | [#9](/ossn/%2Bbug/1606495/comments/9) |
| --- | --- | --- | --- |

Ahh there is a copy\_from policy for glance - which allows to restrict this action to certain roles, like admin. I think this is sufficient to circumvent.

Ahh there is a copy\_from policy for glance - which allows to restrict this action to certain roles, like admin. I think this is sufficient to circumvent.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brian Rosmaita (brian-rosmaita)](https://launchpad.net/~brian-rosmaita) wrote on 2016-08-04: |  |  | [#10](/ossn/%2Bbug/1606495/comments/10) |
| --- | --- | --- | --- |

@tom-patzig: you are correct, don't know how I missed that. Yes, an existing solution for this is to restrict the copy\_from policy to admins or trusted users.

@tom-patzig: you are correct, don't know how I missed that. Yes, an existing solution for this is to restrict the copy\_from policy to admins or trusted users.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brian Rosmaita (brian-rosmaita)](https://launchpad.net/~brian-rosmaita) wrote on 2016-08-04: |  |  | [#11](/ossn/%2Bbug/1606495/comments/11) |
| --- | --- | --- | --- |

And I should mention, I tested this in devstack. Setting the policy to:

"copy\_from": "role:admin"

allowed my admin user to use copy-from with v1, whereas my demo user got a 403.

And I should mention, I tested this in devstack. Setting the policy to:
"copy\_from": "role:admin"
allowed my admin user to use copy-from with v1, whereas my demo user got a 403.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-09-01: |  |  | [#12](/ossn/%2Bbug/1606495/comments/12) |
| --- | --- | --- | --- |

I've switched the OSSA task to Opinion and added ossg-coresec until we figure out how to coordinate this disclosure with a Security Note.

I've switched the OSSA task to Opinion and added ossg-coresec until we figure out how to coordinate this disclosure with a Security Note.

| Changed in ossa: | |
| --- | --- |
| **status**: | Incomplete â†’ Opinion |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Travis McPeak (travis-mcpeak)](https://launchpad.net/~travis-mcpeak) wrote on 2016-09-01: |  |  | [#13](/ossn/%2Bbug/1606495/comments/13) |
| --- | --- | --- | --- |

Yep, this seems like a pretty clear-cut SSRF type issue. Since Glance typically sits on a privileged network in many deployments an attacker could use this to enumerate internal network details.

Agree embargoed note is the right thing to do to give deployers a chance to flip the switch/validate the switch is already flipped.

+OSSN

Yep, this seems like a pretty clear-cut SSRF type issue. Since Glance typically sits on a privileged network in many deployments an attacker could use this to enumerate internal network details.
Agree embargoed note is the right thing to do to give deployers a chance to flip the switch/validate the switch is already flipped.
+OSSN

[Luke Hinds (lhinds)](https://launchpad.net/~lhinds)
on 2016-09-01

| Changed in ossn: | |
| --- | --- |
| **assignee**: | nobody â†’ Luke Hinds (lhinds) |

[Luke Hinds (lhinds)](https://launchpad.net/~lhinds)
on 2016-09-29

| Changed in ossn: | |
| --- | --- |
| **assignee**: | Luke Hinds (lhinds) â†’ Travis McPeak (travis-mcpeak) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2017-01-17: |  |  | [#14](/ossn/%2Bbug/1606495/comments/14) |
| --- | --- | --- | --- |

The VMT is being asked questions about this report by a vendor servicing the organization who reported it. Is there any benefit in continuing to keep this under embargo? Is the planned OSSN nearly ready, or should we go ahead and let that process continue in public at this point?

The VMT is being asked questions about this report by a vendor servicing the organization who reported it. Is there any benefit in continuing to keep this under embargo? Is the planned OSSN nearly ready, or should we go ahead and let that process continue in public at this point?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Ian Cordasco (icordasc)](https://launchpad.net/~icordasc) wrote on 2017-01-17: |  |  | [#15](/ossn/%2Bbug/1606495/comments/15) |
| --- | --- | --- | --- |

I'm not sure where Luke or Travis are in writing up an OSSN, but I'd caution against mentioning this part of the original bug report:

> it copies remote (potentially malicious) content unverified to your configured glance store.

Glance regularly deals in potentially malicious and unverified content. If any user can upload image data than all of that data could be malicious or unverified. Unless your Nova compute nodes, however, can run any type of virtualization the actual effect of that malicious content is dubious. The image data is never displayed in Horizon, so there's no XSS or other attacks possible there. The image data isn't excecuted on download by Glance client on any of the hosts or on a user's machine. For it to be executed, the user would have to take those steps directly and if they know Glance is the \*image\* service, I doubt they'd try to execute an image. So, like a separate issue we had reported, I'm unsure what people's threat model is around this.

I'm not sure where Luke or Travis are in writing up an OSSN, but I'd caution against mentioning this part of the original bug report:
> it copies remote (potentially malicious) content unverified to your configured glance store.
Glance regularly deals in potentially malicious and unverified content. If any user can upload image data than all of that data could be malicious or unverified. Unless your Nova compute nodes, however, can run any type of virtualization the actual effect of that malicious content is dubious. The image data is never displayed in Horizon, so there's no XSS or other attacks possible there. The image data isn't excecuted on download by Glance client on any of the hosts or on a user's machine. For it to be executed, the user would have to take those steps directly and if they know Glance is the \*image\* service, I doubt they'd try to execute an image. So, like a separate issue we had reported, I'm unsure what people's threat model is around this.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Ian Cordasco (icordasc)](https://launchpad.net/~icordasc) wrote on 2017-01-17: |  |  | [#16](/ossn/%2Bbug/1606495/comments/16) |
| --- | --- | --- | --- |

As to whether or not to keep this under embargo, I'd vote it's pointless. There is no fix. And the OSSN might be written faster without the embargo.

As to whether or not to keep this under embargo, I'd vote it's pointless. There is no fix. And the OSSN might be written faster without the embargo.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brian Rosmaita (brian-rosmaita)](https://launchpad.net/~brian-rosmaita) wrote on 2017-01-17: |  |  | [#17](/ossn/%2Bbug/1606495/comments/17) |
| --- | --- | --- | --- |

Agree with Ian. We should focus on the port-scanner aspect of this report.

An operator can restrict copy-from to privileged users by setting the copy\_from policy appropriately. We recommend that this be done in deployments where the copy-from functionality could be used as a port scanner as described in the bug.

Agree with Ian. We should focus on the port-scanner aspect of this report.
An operator can restrict copy-from to privileged users by setting the copy\_from policy appropriately. We recommend that this be done in deployments where the copy-from functionality could be used as a port scanner as described in the bug.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2017-01-18: |  |  | [#18](/ossn/%2Bbug/1606495/comments/18) |
| --- | --- | --- | --- |

I agree with the last comments, if OSSG is fine with this course of actions, lets open this bug report.

I agree with the last comments, if OSSG is fine with this course of actions, lets open this bug report.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Luke Hinds (lhinds)](https://launchpad.net/~lhinds) wrote on 2017-01-26: |  |  | [#19](/ossn/%2Bbug/1606495/comments/19) |
| --- | --- | --- | --- |

@Tristian, fine by me to open this.

@Tristian, fine by me to open this.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2017-01-26: |  |  | [#20](/ossn/%2Bbug/1606495/comments/20) |
| --- | --- | --- | --- |

Opening as agreed.

Opening as agreed.

| **information type**: | Private Security â†’ Public |
| --- | --- |
| **tags**: | added: security |

[Robert Clark (robert-clark)](https://launchpad.net/~robert-clark)
on 2017-02-09

| Changed in ossn: | |
| --- | --- |
| **assignee**: | Travis McPeak (travis-mcpeak) â†’ nobody |

[Luke Hinds (lhinds)](https://launchpad.net/~lhinds)
on 2017-02-15

| Changed in ossn: | |
| --- | --- |
| **assignee**: | nobody â†’ Luke Hinds (lhinds) |

[Luke Hinds (lhinds)](https://launchpad.net/~lhinds)
on 2017-03-09

| Changed in ossn: | |
| --- | --- |
| **status**: | New â†’ In Progress |

[Luke Hinds (lhinds)](https://launchpad.net/~lhinds)
on 2017-03-16

| Changed in ossn: | |
| --- | --- |
| **status**: | In Progress â†’ Fix Released |

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2017-09-25

| **description**: | updated |
| --- | --- |

[Brian Rosmaita (brian-rosmaita)](https://launchpad.net/~brian-rosmaita)
on 2018-01-31

| Changed in glance: | |
| --- | --- |
| **status**: | New â†’ Won't Fix |

[See full activity log](https://bugs.launchpad.net/ossn/%2Bbug/1606495/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/ossn/%2Bfilebug)

This report contains
**Public**
information

Everyone can see this information.

You are
[not directly subscribed to this bug's notifications.](/ossn/%2Bbug/1606495/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/ossn/%2Bbug/1606495/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/ossn/%2Bbug/1606495/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
Â â€¢
[Take the tour](https://launchpad.net/%2Btour)
Â â€¢
[Read the guide](https://help.launchpad.net/)

Â© 2004
[CanonicalÂ Ltd.](http://canonical.com/)
Â â€¢
[Terms of use](https://launchpad.net/legal)
Â â€¢
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
Â â€¢
[Contact Launchpad Support](/feedback)
Â â€¢
[Blog](http://blog.launchpad.net/)
Â â€¢
[Careers](https://canonical.com/careers)
Â â€¢
[System status](https://ubuntu.social/%40launchpadstatus)
Â â€¢
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from bugs.launchpad.net_8e9fae37_20250125_094234.html ===

[Log in / Register](https://bugs.launchpad.net/glance/%2Bbug/1153614/%2Blogin)

[![](https://launchpadlibrarian.net/355215744/glance-chipmunk-64.png)](https://launchpad.net/glance)

## [Glance](https://launchpad.net/glance)

* [Overview](https://launchpad.net/glance)
* [Code](https://code.launchpad.net/glance)
* [Bugs](https://bugs.launchpad.net/glance)
* [Blueprints](https://blueprints.launchpad.net/glance)
* [Translations](https://translations.launchpad.net/glance)
* [Answers](https://answers.launchpad.net/glance)

# Add a policy to control copy-from functionality

Bug #1153614 reported by
[Stuart McLaren](https://launchpad.net/~stuart-mclaren)
on 2013-03-11

[6](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [Glance](https://bugs.launchpad.net/glance) | Fix Released | Medium | [John Bresnahan](https://launchpad.net/~jbresnah) | [Glance 2013.2 "havana"](https://launchpad.net/glance/%2Bmilestone/2013.2) |

### Bug Description

It might be useful to have a policy to control whether the copy-from functionality can be used or not, eg:

$ cat /etc/glance/policy.json

{

Â Â Â Â "default": "",

Â Â Â Â "manage\_image\_cache": "role:admin",

Â Â Â Â "publicize\_image": "role:admin",

Â Â Â Â "copy\_from": "role:admin" <<<

}

this would allow an operator to enable/disable the copy-from functionality for regular users, and if desired, prevent data being copied from 'external' sources.

[Mark Washenberger (markwash)](https://launchpad.net/~markwash)
on 2013-03-13

| Changed in glance: | |
| --- | --- |
| **milestone**: | none â†’ havana-1 |
| **importance**: | Undecided â†’ Medium |
| **status**: | New â†’ Triaged |

[John Bresnahan (jbresnah)](https://launchpad.net/~jbresnah)
on 2013-03-28

| Changed in glance: | |
| --- | --- |
| **assignee**: | nobody â†’ John Bresnahan (jbresnah) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2013-03-28:  [**Fix proposed to glance (master)**](/glance/%2Bbug/1153614/comments/1) |  |  | [#1](/glance/%2Bbug/1153614/comments/1) |
| --- | --- | --- | --- |

Fix proposed to branch: master

Review: <https://review.openstack.org/25591>

Fix proposed to branch: master
Review: https://review.openstack.org/25591

| Changed in glance: | |
| --- | --- |
| **status**: | Triaged â†’ In Progress |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Mark Washenberger (markwash)](https://launchpad.net/~markwash) wrote on 2013-03-28: |  |  | [#2](/glance/%2Bbug/1153614/comments/2) |
| --- | --- | --- | --- |

Is there ever a reason to have "copy\_from" restrict differently than "image\_upload"? I suspect the answer is yes, but I want to understand why.

Is there ever a reason to have "copy\_from" restrict differently than "image\_upload"? I suspect the answer is yes, but I want to understand why.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [John Bresnahan (jbresnah)](https://launchpad.net/~jbresnah) wrote on 2013-03-28: |  |  | [#3](/glance/%2Bbug/1153614/comments/3) |
| --- | --- | --- | --- |

Mark, here are a couple of reasons that I thought of (tho none come from a real world scenario that I have seen):

A malicious user could use copy\_from functionality to use Glance to download data and avoid having their IP address known/logged/blocked.

Host based authentication could be put in place by a repository such that the Glance server is the only endpoint allowed to download data, thus copy\_from (or --location) would be the only way for users to access it. An admin may want to limit what users could access it.

This question dovetails into another that I had. Should there be a whitelist or blacklist of host/urls with which Glance will allow the use of copy\_from or location?

Mark, here are a couple of reasons that I thought of (tho none come from a real world scenario that I have seen):
A malicious user could use copy\_from functionality to use Glance to download data and avoid having their IP address known/logged/blocked.
Host based authentication could be put in place by a repository such that the Glance server is the only endpoint allowed to download data, thus copy\_from (or --location) would be the only way for users to access it. An admin may want to limit what users could access it.
This question dovetails into another that I had. Should there be a whitelist or blacklist of host/urls with which Glance will allow the use of copy\_from or location?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Stuart McLaren (stuart-mclaren)](https://launchpad.net/~stuart-mclaren) wrote on 2013-03-29: |  |  | [#4](/glance/%2Bbug/1153614/comments/4) |
| --- | --- | --- | --- |

Hi Mark,

The copy\_from policy could be considered one of the pieces required to support an implied policy: only allow data upload/download via the API endpoint. ie if you combine it with set\_image\_location and also pare down the 'known\_stores'

store types this is the behaviour you get.

Why might you want to turn off copy\_from?

1) Network hardware: you may want all data to be pushed through your load balancers/rate limiters. The copy from means uploaded data would go straight to your server, bypassing the usual upload path

2) Secure sites: You may have a site policy mandating that all traffic uses SSL. If the swift store is enabled you could copy from a plain http swift store .

Hi Mark,
The copy\_from policy could be considered one of the pieces required to support an implied policy: only allow data upload/download via the API endpoint. ie if you combine it with set\_image\_location and also pare down the 'known\_stores'
store types this is the behaviour you get.
Why might you want to turn off copy\_from?
1) Network hardware: you may want all data to be pushed through your load balancers/rate limiters. The copy from means uploaded data would go straight to your server, bypassing the usual upload path
2) Secure sites: You may have a site policy mandating that all traffic uses SSL. If the swift store is enabled you could copy from a plain http swift store .

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2013-04-23:  [**Fix merged to glance (master)**](/glance/%2Bbug/1153614/comments/5) |  |  | [#5](/glance/%2Bbug/1153614/comments/5) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/25591>

Committed: <http://github.com/openstack/glance/commit/b1ac90f7914d91b25144cc4063fa994fb5019ee3>

Submitter: Jenkins

Branch: master

commit b1ac90f7914d91b25144cc4063fa994fb5019ee3

Author: John Bresnahan <email address hidden>

Date: Wed Mar 27 14:03:38 2013 -1000

Add a policy handler to control copy-from functionality

This patch adds the ability to set a policy handler to control what

Â Â Â Â users can use the 'copy\_from' feature in the v1 API.

Fixes bug: 1153614

Change-Id: Ie194979a2aa66c9327bf14d7a85ead6f773a6079

Reviewed: https://review.openstack.org/25591
Committed: http://github.com/openstack/glance/commit/b1ac90f7914d91b25144cc4063fa994fb5019ee3
Submitter: Jenkins
Branch: master
commit b1ac90f7914d91b25144cc4063fa994fb5019ee3
Author: John Bresnahan <jbresnah@redhat.com>
Date: Wed Mar 27 14:03:38 2013 -1000
Add a policy handler to control copy-from functionality
This patch adds the ability to set a policy handler to control what
users can use the 'copy\_from' feature in the v1 API.
Fixes bug: 1153614
Change-Id: Ie194979a2aa66c9327bf14d7a85ead6f773a6079

| Changed in glance: | |
| --- | --- |
| **status**: | In Progress â†’ Fix Committed |

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2013-05-29

| Changed in glance: | |
| --- | --- |
| **status**: | Fix Committed â†’ Fix Released |

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2013-10-17

| Changed in glance: | |
| --- | --- |
| **milestone**: | havana-1 â†’ 2013.2 |

[See full activity log](https://bugs.launchpad.net/glance/%2Bbug/1153614/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/glance/%2Bfilebug)

This report contains
**Public**
information

Everyone can see this information.

You are
[not directly subscribed to this bug's notifications.](/glance/%2Bbug/1153614/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/glance/%2Bbug/1153614/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/glance/%2Bbug/1153614/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
Â â€¢
[Take the tour](https://launchpad.net/%2Btour)
Â â€¢
[Read the guide](https://help.launchpad.net/)

Â© 2004
[CanonicalÂ Ltd.](http://canonical.com/)
Â â€¢
[Terms of use](https://launchpad.net/legal)
Â â€¢
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
Â â€¢
[Contact Launchpad Support](/feedback)
Â â€¢
[Blog](http://blog.launchpad.net/)
Â â€¢
[Careers](https://canonical.com/careers)
Â â€¢
[System status](https://ubuntu.social/%40launchpadstatus)
Â â€¢
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from wiki.openstack.org_cb780310_20250125_094239.html ===


* [![OpenStack](https://wiki.openstack.org/w/images/thumb/c/c4/OpenStack_Logo_-_notext.png/30px-OpenStack_Logo_-_notext.png)](/wiki/Main_Page "Visit the main page")

* Page
  + [Page](/wiki/OSSN/OSSN-0078 "View the content page [c]")
  + [Discussion](/w/index.php?title=Talk:OSSN/OSSN-0078&action=edit&redlink=1 "Discussion about the content page [t]")
  + [View source](/w/index.php?title=OSSN/OSSN-0078&action=edit "This page is protected.
    You can view its source [e]")
  + [History](/w/index.php?title=OSSN/OSSN-0078&action=history "Past revisions of this page [h]")

* Print/export
  + [Create a book](/w/index.php?title=Special:Book&bookcmd=book_creator&referer=OSSN%2FOSSN-0078)
  + [Download as PDF](/w/index.php?title=Special:Book&bookcmd=render_article&arttitle=OSSN%2FOSSN-0078&returnto=OSSN%2FOSSN-0078&oldid=152414&writer=rl)
  + [Printable version](/w/index.php?title=OSSN/OSSN-0078&printable=yes "Printable version of this page [p]")

* Tools
  + [Page information](/w/index.php?title=OSSN/OSSN-0078&action=info "More information about this page")
  + [Permanent link](/w/index.php?title=OSSN/OSSN-0078&oldid=152414 "Permanent link to this revision of the page")
  + [Special pages](/wiki/Special%3ASpecialPages "A list of all special pages [q]")
  + [Related changes](/wiki/Special%3ARecentChangesLinked/OSSN/OSSN-0078 "Recent changes in pages linked from this page [k]")
  + [What links here](/wiki/Special%3AWhatLinksHere/OSSN/OSSN-0078 "A list of all wiki pages that link here [j]")

* * [Create account](/w/index.php?title=Special:CreateAccount&returnto=OSSN%2FOSSN-0078 "You are encouraged to create an account and log in; however, it is not mandatory")
* * [Log in](/w/index.php?title=Special:UserLogin&returnto=OSSN%2FOSSN-0078 "You are encouraged to log in; however, it is not mandatory [o]")
* * [Log in / create account with OpenID](/w/index.php?title=Special:OpenIDLogin&returnto=OSSN/OSSN-0078)
* + English

* [Home](http://www.openstack.org)
* [Software](http://www.openstack.org/software)
* [User Stories](http://www.openstack.org/user-stories)
* [Community](http://www.openstack.org/community)
* [Profile](http://www.openstack.org/profile)
* [Blog](http://www.openstack.org/blog)
* [Wiki](http://wiki.openstack.org)
* [Documentation](http://docs.openstack.org)

Jump to: [navigation](#mw-head),
[search](#p-search)

# OSSN/OSSN-0078

< [OSSN](/wiki/OSSN "OSSN")

## copy\_from in Image Service API v1 allows network port scan

### Summary

The `copy\_from` feature in Image Service API v1 supplied by Glance can
allow an attacker to perform masked network port scans.

### Affected Services / Software

Version 1 of the Glance Image Service (deprecated in Newton).

### Discussion

In Version 1 of the Glance Image Service API it is possible to create
images with a URL such as `<http://localhost:22`>. This could then allow
an attacker to enumerate internal network details while appearing
masked, since the scan would appear to originate from the Glance image
service.

### Recommended Actions

Version 1 of the Glance Image Service API was deprecated in the Newton
cycle, so operators should upgrade to a later version that will allow
use of Version 2.

Existing deployments can limit policy on `copy\_from` by restricting use
to `admin` within `policy.json` as follows:

```
   "copy_from": "role:admin"

```
### Contacts / References

Author: Luke Hinds, Red Hat

This OSSNÂ : <https://wiki.openstack.org/wiki/OSSN/OSSN-0078>

Original LaunchPad BugÂ : [https://bugs.launchpad.net/ossn/+bug/1606495](https://bugs.launchpad.net/ossn/%2Bbug/1606495)

OpenStack Security ProjectÂ : <https://launchpad.net/~openstack-ossg>

Retrieved from "<https://wiki.openstack.org/w/index.php?title=OSSN/OSSN-0078&oldid=152414>"

* [Privacy policy](/wiki/OpenStack%3APrivacy_policy "OpenStack:Privacy policy")
* [About OpenStack](/wiki/OpenStack%3AAbout "OpenStack:About")
* [Disclaimers](/wiki/OpenStack%3AGeneral_disclaimer "OpenStack:General disclaimer")

* [![Attribution 3.0 Unported (CC BY 3.0)](/w/resources/assets/licenses/cc-by.png)](http://creativecommons.org/licenses/by/3.0/)
* [![Powered by MediaWiki](/w/resources/assets/poweredby_mediawiki_88x31.png)](//www.mediawiki.org/)


