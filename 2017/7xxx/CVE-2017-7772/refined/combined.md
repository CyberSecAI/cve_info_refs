=== Content from bugzilla.mozilla.org_4579fafb_20250126_085007.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1352)
* [XML](/show_bug.cgi?ctype=xml&id=1352)

Closed
[Bug 1352](/show_bug.cgi?id=1352)

Opened 26 years ago
Closed 26 years ago

# nsString::ToNewCString()

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

nsString::ToNewCString()

## Categories

### (Core :: DOM: HTML Parser, defect, P1)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20HTML%20Parser#DOM%3A%20HTML%20Parser)

DOM: HTML Parser
▾

Core :: DOM: HTML Parser
This system consumes content from the web, parses, validates and builds a content model (document)
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20HTML%20Parser&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20HTML%20Parser&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20HTML%20Parser)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Windows NT

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

major

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: troy, Assigned: rickg)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/8b3d47997ad6b23d9578a4b796cf4294?d=mm&size=40)  [rickg](/user_profile?user_id=3828)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

![](https://secure.gravatar.com/avatar/7c260576dd1304bb09f3df2f6183846a?d=mm&size=40)  [gem](/user_profile?user_id=4141)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/6d721cd00fc18fe29a87103b991f42f8?d=mm&size=40)  [troy](/user_profile?user_id=3825)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

1 person

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

---

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

---

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [troy](/user_profile?user_id=3825)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1352#c0)• 26 years ago |
|  | |

We have a continuing problem where the callers of ToNewCString() expect
the memory to be allocated using NSPR and call PR\_Free to free the memory.
I thought we were going to change nsString to use NSPR, but it's still
using the new operator.
The nsString header file doesn't say, and that makes the problem even worse.
[E] FMM: Freeing mismatched memory in free {1 occurrence}
Address 0x0420a588 points into a C++ new block in heap 0x03c40000
Location of free attempt
free [dbgheap.c:925]
PR\_Free [prmem.c:66]
net\_OpenCacheFatDB [mkcache.c:262]
NET\_SetDiskCacheSize [mkcache.c:1298]
NET\_SetupPrefs [mkgeturl.c:677]
NET\_FinishInitNetLib [mkgeturl.c:751]
NS\_InitNetlib(void) [nsNetThread.cpp:97]
nsNetlibThread::NetlibThreadMain(void \*) [nsNetThread.cpp:219]
PR\_NativeRunThread [pruthr.c:381]
threadstartex [threadex.c:212]
lstrcmpiW [KERNEL32.dll]
Allocation location
new(UINT) [new.cpp:23]
nsString::ToNewCString(void)const [nsString.cpp:467]
nsNetFile::GetFilePath(char const\*,char \* \*) [nsNetFile.cpp:180]
WH\_FileName [nsNetStubs.cpp:946]
net\_OpenCacheFatDB [mkcache.c:252]
NET\_SetDiskCacheSize [mkcache.c:1298]
NET\_SetupPrefs [mkgeturl.c:677]
NET\_FinishInitNetLib [mkgeturl.c:751]
NS\_InitNetlib(void) [nsNetThread.cpp:97]
nsNetlibThread::NetlibThreadMain(void \*) [nsNetThread.cpp:219]
PR\_NativeRunThread [pruthr.c:381]
threadstartex [threadex.c:212]
lstrcmpiW [KERNEL32.dll]

|  | [rickg](/user_profile?user_id=3828)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1352#a710813_3828)• 26 years ago |

Status: NEW → ASSIGNED

|  | [rickg](/user_profile?user_id=3828)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1352#a749783_3828)• 26 years ago |

Status: ASSIGNED → RESOLVEDClosed: 26 years agoResolution: --- → FIXED

|  | [rickg](/user_profile?user_id=3828)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1352#c1)• 26 years ago |
|  | |

The real problem is a policy issue. I've done a better job of documenting the
issue.

|  | [rubydoo123](/user_profile?user_id=3849) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1352#c2)• 26 years ago |
|  | |

how would I verify this bug? Would it be more appropriate for rickg, kipp or
troy to verify?

|  | [rubydoo123](/user_profile?user_id=3849) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1352#c3)• 26 years ago |
|  | |

Troy provide a test case for verification

|  | [rubydoo123](/user_profile?user_id=3849) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1352#a7429893_3849)• 26 years ago |

QA Contact: 4141

|  | [rubydoo123](/user_profile?user_id=3849) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1352#a7818552_3849)• 26 years ago |

Status: RESOLVED → VERIFIEDQA Contact: 4141 → 3849

|  | [rubydoo123](/user_profile?user_id=3849) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1352#c4)• 26 years ago |
|  | |

marking verified, discussed with engineer

|  | [gem](/user_profile?user_id=4141) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1352#a7829386_4141)• 26 years ago |

QA Contact: 3849 → 4141

|  | [gem](/user_profile?user_id=4141) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1352#c5)• 26 years ago |
|  | |

As per Troy email 2/9, " it's a programming problem and there is no test case
that you can use to confirm the problem or verify that it's fixed." Set to
verified as Rick has done better documentation.
You need to [log in](/show_bug.cgi?id=1352&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑



=== Content from www.mozilla.org_ac4f657a_20250125_131435.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2017-15

## Security vulnerabilities fixed in Firefox 54

Announced
June 13, 2017
Impact
critical
Products
Firefox
Fixed in

* Firefox 54

#### [#CVE-2017-5472: Use-after-free using destroyed node when regenerating trees](#CVE-2017-5472)

Reporter
Nils
Impact
critical
##### Description

A use-after-free vulnerability with the frameloader during tree reconstruction while regenerating CSS layout when attempting to use a node in the tree that no longer exists. This results in a potentially exploitable crash.

##### References

* [Bug 1365602](https://bugzilla.mozilla.org/show_bug.cgi?id=1365602)

#### [#CVE-2017-7749: Use-after-free during docshell reloading](#CVE-2017-7749)

Reporter
Nils
Impact
high
##### Description

A use-after-free vulnerability when using an incorrect URL during the reloading of a docshell. This results in a potentially exploitable crash.

##### References

* [Bug 1355039](https://bugzilla.mozilla.org/show_bug.cgi?id=1355039)

#### [#CVE-2017-7750: Use-after-free with track elements](#CVE-2017-7750)

Reporter
Nils
Impact
high
##### Description

A use-after-free vulnerability during video control operations when a `<track>` element holds a reference to an older window if that window has been replaced in the DOM. This results in a potentially exploitable crash.

##### References

* [Bug 1356558](https://bugzilla.mozilla.org/show_bug.cgi?id=1356558)

#### [#CVE-2017-7751: Use-after-free with content viewer listeners](#CVE-2017-7751)

Reporter
Nils
Impact
high
##### Description

A use-after-free vulnerability with content viewer listeners that results in a potentially exploitable crash.

##### References

* [Bug 1363396](https://bugzilla.mozilla.org/show_bug.cgi?id=1363396)

#### [#CVE-2017-7752: Use-after-free with IME input](#CVE-2017-7752)

Reporter
Nils
Impact
moderate
##### Description

A use-after-free vulnerability during specific user interactions with the input method editor (IME) in some languages due to how events are handled. This results in a potentially exploitable crash but would require specific user interaction to trigger.

##### References

* [Bug 1359547](https://bugzilla.mozilla.org/show_bug.cgi?id=1359547)

#### [#CVE-2017-7754: Out-of-bounds read in WebGL with ImageInfo object](#CVE-2017-7754)

Reporter
Tobias Klein
Impact
high
##### Description

An out-of-bounds read in WebGL with a maliciously crafted `ImageInfo` object during WebGL operations.

##### References

* [Bug 1357090](https://bugzilla.mozilla.org/show_bug.cgi?id=1357090)

#### [#CVE-2017-7755: Privilege escalation through Firefox Installer with same directory DLL files](#CVE-2017-7755)

Reporter
Yuji Tounai of NTT Communications, Eili Masami of Tachibana Lab
Impact
high
##### Description

The Firefox installer on Windows can be made to load malicious DLL files stored in the same directory as the installer when it is run. This allows privileged execution if the installer is run with elevated privileges.
*Note: This attack only affects Windows operating systems. Other operating systems are unaffected.*

##### References

* [Bug 1361326](https://bugzilla.mozilla.org/show_bug.cgi?id=1361326)

#### [#CVE-2017-7756: Use-after-free and use-after-scope logging XHR header errors](#CVE-2017-7756)

Reporter
Abhishek Arya
Impact
high
##### Description

A use-after-free and use-after-scope vulnerability when logging errors from headers for XML HTTP Requests (XHR). This could result in a potentially exploitable crash.

##### References

* [Bug 1366595](https://bugzilla.mozilla.org/show_bug.cgi?id=1366595)

#### [#CVE-2017-7757: Use-after-free in IndexedDB](#CVE-2017-7757)

Reporter
F. Alonso (revskills)
Impact
high
##### Description

A use-after-free vulnerability in IndexedDB when one of its objects is destroyed in memory while a method on it is still being executed. This results in a potentially exploitable crash.

##### References

* [Bug 1356824](https://bugzilla.mozilla.org/show_bug.cgi?id=1356824)

#### [#CVE-2017-7778: Vulnerabilities in the Graphite 2 library](#CVE-2017-7778)

Reporter
Holger Fuhrmannek, Tyson Smith
Impact
high
##### Description

A number of security vulnerabilities in the Graphite 2 library including out-of-bounds reads, buffer overflow reads and writes, and the use of uninitialized memory. These issues were addressed in Graphite 2 version 1.3.10.

##### References

* [Graphite2 lz4::decompress out of bounds write (CVE-2017-7778)](https://bugzilla.mozilla.org/show_bug.cgi?id=1349310)
* [Graphite2 out of bounds read [@ graphite2::Pass::readPass] (CVE-2017-7771)](https://bugzilla.mozilla.org/show_bug.cgi?id=1350047)
* [Graphite2 heap-buffer-overflow write [@ lz4::decompress] (CVE-2017-7772)](https://bugzilla.mozilla.org/show_bug.cgi?id=1352745)
* [Graphite2 heap-buffer-overflow write [@ lz4::decompress] src/Decompressor (CVE-2017-7773)](https://bugzilla.mozilla.org/show_bug.cgi?id=1352747)
* [Graphite2 out of bounds read [@ graphite2::Silf::readGraphite] (CVE-2017-7774)](https://bugzilla.mozilla.org/show_bug.cgi?id=1355174)
* [Graphite2 Assertion 'size() > n' failed (CVE-2017-7775)](https://bugzilla.mozilla.org/show_bug.cgi?id=1355182)
* [Graphite2 heap-buffer-overflow read [@ graphite2::Silf::getClassGlyph] (CVE-2017-7776)](https://bugzilla.mozilla.org/show_bug.cgi?id=1356607)
* [Graphite2 use of uninitialized memory [@ graphite2::GlyphCache::Loader::read\_glyph] (CVE-2017-7777)](https://bugzilla.mozilla.org/show_bug.cgi?id=1358551)

#### [#CVE-2017-7758: Out-of-bounds read in Opus encoder](#CVE-2017-7758)

Reporter
Nicolas Trippar of Zimperium zLabs
Impact
high
##### Description

An out-of-bounds read vulnerability with the Opus encoder when the number of channels in an audio stream changes while the encoder is in use.

##### References

* [Bug 1368490](https://bugzilla.mozilla.org/show_bug.cgi?id=1368490)

#### [#CVE-2017-7759: Android intent URLs can cause navigation to local file system](#CVE-2017-7759)

Reporter
Takeshi Terada
Impact
high
##### Description

Android intent URLs given to Firefox for Android can be used to navigate from HTTP or HTTPS URLs to local `file:` URLs, allowing for the reading of local data through a violation of same-origin policy.
*Note: This attack only affects Firefox for Android. Other operating systems are not affected.*

##### References

* [Bug 1356893](https://bugzilla.mozilla.org/show_bug.cgi?id=1356893)

#### [#CVE-2017-7760: File manipulation and privilege escalation via callback parameter in Mozilla Windows Updater and Maintenance Service](#CVE-2017-7760)

Reporter
Holger Fuhrmannek
Impact
high
##### Description

The Mozilla Windows updater modifies some files to be updated by reading the original file and applying changes to it. The location of the original file can be altered by a malicious user by passing a special path to the callback parameter through the Mozilla Maintenance Service, allowing the manipulation of files in the installation directory and privilege escalation by manipulating the Mozilla Maintenance Service, which has privileged access.
*Note: This attack requires local system access and only affects Windows. Other operating systems are not affected.*

##### References

* [Bug 1348645](https://bugzilla.mozilla.org/show_bug.cgi?id=1348645)

#### [#CVE-2017-7761: File deletion and privilege escalation through Mozilla Maintenance Service helper.exe application](#CVE-2017-7761)

Reporter
Holger Fuhrmannek
Impact
moderate
##### Description

The Mozilla Maintenance Service `helper.exe` application creates a temporary directory writable by non-privileged users. When this is combined with creation of a junction (a form of symbolic link), protected files in the target directory of the junction can be deleted by the Mozilla Maintenance Service, which has privileged access.
*Note: This attack requires local system access and only affects Windows. Other operating systems are not affected.*

##### References

* [Bug 1215648](https://bugzilla.mozilla.org/show_bug.cgi?id=1215648)
* [Code execution / Privilege escalation problems with NSIS installers](https://sourceforge.net/p/nsis/bugs/1125/)

#### [#CVE-2017-7762: Addressbar spoofing in Reader mode](#CVE-2017-7762)

Reporter
Jun Kokatsu
Impact
moderate
##### Description

When entered directly, Reader Mode did not strip the username and password section of URLs displayed in the addressbar. This can be used for spoofing the domain of the current page.

##### References

* [Bug 1358248](https://bugzilla.mozilla.org/show_bug.cgi?id=1358248)

#### [#CVE-2017-7763: Mac fonts render some unicode characters as spaces](#CVE-2017-7763)

Reporter
Michał Bentkowski
Impact
moderate
##### Description

Default fonts on OS X display some Tibetan characters as whitespace. When used in the addressbar as part of an IDN this can be used for domain name spoofing attacks.
*Note: This attack only affects OS X operating systems. Other operating systems are unaffected.*

##### References

* [Bug 1360309](https://bugzilla.mozilla.org/show_bug.cgi?id=1360309)

#### [#CVE-2017-7764: Domain spoofing with combination of Canadian Syllabics and other unicode blocks](#CVE-2017-7764)

Reporter
Samuel Erb
Impact
moderate
##### Description

Characters from the "Canadian Syllabics" unicode block can be mixed with characters from other unicode blocks in the addressbar instead of being rendered as their raw "punycode" form, allowing for domain name spoofing attacks through character confusion. The current Unicode standard allows characters from "Aspirational Use Scripts" such as Canadian Syllabics to be mixed with Latin characters in the "moderately restrictive" IDN profile. We have changed Firefox behavior to match the upcoming Unicode version 10.0 which removes this category and treats them as "Limited Use Scripts."

##### References

* [Bug 1364283](https://bugzilla.mozilla.org/show_bug.cgi?id=1364283)
* [Proposed Update to Unicode Standard Annex](http://www.unicode.org/reports/tr31/tr31-26.html#Aspirational_Use_Scripts)

#### [#CVE-2017-7765: Mark of the Web bypass when saving executable files](#CVE-2017-7765)

Reporter
Jonathan Birch and Microsoft Vulnerability Research
Impact
moderate
##### Description

The "Mark of the Web" was not correctly saved on Windows when files with very long names were downloaded from the Internet. Without the Mark of the Web data, the security warning that Windows displays before running executables downloaded from the Internet is not shown.
*Note: This attack only affects Windows operating systems. Other operating systems are unaffected.*

##### References

* [Bug 1273265](https://bugzilla.mozilla.org/show_bug.cgi?id=1273265)

#### [#CVE-2017-7766: File execution and privilege escalation through updater.ini, Mozilla Windows Updater, and Mozilla Maintenance Service](#CVE-2017-7766)

Reporter
Seb Patane
Impact
high
##### Description

An attack using manipulation of `updater.ini` contents, used by the Mozilla Windows Updater, and privilege escalation through the Mozilla Maintenance Service to allow for arbitrary file execution and deletion by the Maintenance Service, which has privileged access.
*Note: This attack requires local system access and only affects Windows. Other operating systems are not affected.*

##### References

* [Bug 1342742](https://bugzilla.mozilla.org/show_bug.cgi?id=1342742)

#### [#CVE-2017-7767: Privilege escalation and arbitrary file overwrites through Mozilla Windows Updater and Mozilla Maintenance Service](#CVE-2017-7767)

Reporter
Seb Patane
Impact
moderate
##### Description

The Mozilla Maintenance Service can be invoked by an unprivileged user to overwrite arbitrary files with junk data using the Mozilla Windows Updater, which runs with the Maintenance Service's privileged access.
*Note: This attack requires local system access and only affects Windows. Other operating systems are not affected.*

##### References

* [Bug 1336964](https://bugzilla.mozilla.org/show_bug.cgi?id=1336964)

#### [#CVE-2017-7768: 32 byte arbitrary file read through Mozilla Maintenance Service](#CVE-2017-7768)

Reporter
Seb Patane
Impact
moderate
##### Description

The Mozilla Maintenance Service can be invoked by an unprivileged user to read 32 bytes of any arbitrary file on the local system by convincing the service that it is reading a status file provided by the Mozilla Windows Updater. The Mozilla Maintenance Service executes with privileged access, bypassing system protections against unprivileged users.
*Note: This attack requires local system access and only affects Windows. Other operating systems are not affected.*

##### References

* [Bug 1336979](https://bugzilla.mozilla.org/show_bug.cgi?id=1336979)

#### [#CVE-2017-7770: Addressbar spoofing with JavaScript events and fullscreen mode](#CVE-2017-7770)

Reporter
Jordi Chancel
Impact
moderate
##### Description

A mechanism where when a new tab is loaded through JavaScript events, if fullscreen mode is then entered, the addressbar will not be rendered. This would allow a malicious site to displayed a spoofed addressbar, showing the location of an arbitrary website instead of the one loaded.
*Note: this issue only affects Firefox for Android. Desktop Firefox is unaffected.*

##### References

* [Bug 1317242](https://bugzilla.mozilla.org/show_bug.cgi?id=1317242)

#### [#CVE-2017-5471: Memory safety bugs fixed in Firefox 54](#CVE-2017-5471)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Mats Palmgren, Philipp, Byron Campen, Christian Holler, Gary Kwong, Benjamin Bouvier, Bob Clary, Jon Coppeard, and Michael Layzell reported memory safety bugs present in Firefox 53. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 54](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1349604%2C1318645%2C1361098%2C1361100%2C1341026%2C1349421%2C1360852%2C1299147%2C1352073%2C1354853%2C1366446%2C1342181%2C1343069)

#### [#CVE-2017-5470: Memory safety bugs fixed in Firefox 54 and Firefox ESR 52.2](#CVE-2017-5470)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Tyson Smith, Mats Palmgren, Philipp, Masayuki Nakano, Christian Holler, Andrew McCreight, Gary Kwong, André Bargull, Carsten Book, Jesse Schwartzentruber, Julian Hector, Marcia Knous, Ronald Crane, and Nils Ohlmeier reported memory safety bugs present in Firefox 53 and Firefox ESR 52.1. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 54 and Firefox ESR 52.2](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1359639%2C1349595%2C1352295%2C1352556%2C1342552%2C1342567%2C1346012%2C1366140%2C1368732%2C1297111%2C1362590%2C1357462%2C1363280%2C1349266%2C1352093%2C1348424%2C1347748%2C1356025%2C1325513%2C1367692)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_daaa842d_20250126_085004.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1352745)
* [XML](/show_bug.cgi?ctype=xml&id=1352745)

Closed
[Bug 1352745](/show_bug.cgi?id=1352745)
(CVE-2017-7772)

Opened 8 years ago
Closed 8 years ago

# Graphite2 heap-buffer-overflow write [@ lz4::decompress]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Graphite2 heap-buffer-overflow write [@ lz4::decompress]

## Categories

### (Core :: Graphics: Text, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics%3A%20Text#Graphics%3A%20Text)

Graphics: Text
▾

Core :: Graphics: Text

Issues with glyph rasterization and painting, font format support, and interfacing with platform font APIs. For issues with font selection, text shaping, and glyph selection, see the Layout: Text and Fonts component.

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20Text&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20Text&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics%3A%20Text)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla55

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr45 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=wontfix) |
| firefox-esr52 | [54+](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=54%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=fixed) |
| firefox53 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox53&o1=equals&v1=wontfix) |
| firefox54 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox54&o1=equals&v1=fixed) |
| firefox55 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox55&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr45 |  | wontfix |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr52 | 54+ | fixed |
| firefox53 |  | wontfix |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox54 |  | fixed |
| firefox55 |  | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: tsmith, Assigned: jfkthame)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/e0f9759e1d7514ae4adfd806869e3c5d?d=mm&size=40)  [jfkthame](/user_profile?user_id=329583)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/a2837b951fa7dc639a2568203478ff0a?d=mm&size=40)  [tsmith](/user_profile?user_id=486634)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/029a38b9773f1943419c24b7c3d93761?d=mm&size=40)  [lsalzman](/user_profile?user_id=536714)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

### (Blocks 1 open bug)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[CVE-2017-7778](/show_bug.cgi?id=1349310 "RESOLVED FIXED - Graphite2 lz4::decompress out of bounds write")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[fuzzing-fonts](/show_bug.cgi?id=750695 "NEW - [meta] Fuzzing: Fonts")

Dependency [tree](/showdependencytree.cgi?id=1352745&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1352745)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [post-critsmash-triage][adv-main54+][adv-esr52.2+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2017-7772

[Keywords:](/describekeywords.cgi)

[csectype-bounds](/buglist.cgi?keywords=csectype-bounds&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[post-critsmash-triage][adv-main54+][adv-esr52.2+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [mwobensmith](/user_profile?user_id=452604) | [qe-verify](#a5349203_452604 "8 years ago") | - |
| --- | --- | --- |
| [mwobensmith](/user_profile?user_id=452604) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [test\_case.ttf](/attachment.cgi?id=8853697)  [8 years ago](#c0)  [Tyson Smith [:tsmith] (PTO)](/user_profile?user_id=486634)   1.69 KB, application/x-font-ttf |  | [Details](/attachment.cgi?id=8853697&action=edit) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Tyson Smith [:tsmith] (PTO)](/user_profile?user_id=486634)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1352745#c0)• 8 years ago |
|  | |

Attached file
[test\_case.ttf](attachment.cgi?id=8853697)
— [Details](attachment.cgi?id=8853697&action=edit)

Found in 28cc60d with a 32 bit build.
To reproduce run:
./gr2fonttest -auto -demand test\_case.ttf
==4360==ERROR: AddressSanitizer: heap-buffer-overflow on address 0xf5202b0f at pc 0x081ad092 bp 0xffadad08 sp 0xffadacfc
WRITE of size 16 at 0xf5202b0f thread T0
#0 0x81ad091 in (anonymous namespace)::safe\_copy(unsigned char\*, unsigned char const\*, unsigned int) src/inc/Compression.h:65:22
#1 0x81ad091 in lz4::decompress(void const\*, unsigned int, void\*, unsigned int) src/Decompressor.cpp:103
#2 0x814e6ac in graphite2::Face::Table::decompress() src/Face.cpp:339:20
#3 0x814dd32 in graphite2::Face::Table::Table(graphite2::Face const&, graphite2::TtfUtil::Tag, unsigned int) src/Face.cpp:292:9
#4 0x8140540 in (anonymous namespace)::load\_face(graphite2::Face&, unsigned int) src/gr\_face.cpp:49:21
#5 0x8141aba in gr\_make\_face\_with\_ops src/gr\_face.cpp:89:16
#6 0x8141aba in gr\_make\_file\_face src/gr\_face.cpp:242
#7 0x813b99e in Parameters::testFileFont() const gr2fonttest/gr2FontTest.cpp:639:20
#8 0x813d9d3 in main gr2fonttest/gr2FontTest.cpp:798:9
#9 0xf753c636 in \_\_libc\_start\_main /build/glibc-5sb1ri/glibc-2.23/csu/../csu/libc-start.c:291
#10 0x805fe47 in \_start (graphite2/gr2fonttest+0x805fe47)
0xf5202b0f is located 11 bytes to the right of 10756-byte region [0xf5200100,0xf5202b04)
allocated by thread T0 here:
#0 0x8104184 in \_\_interceptor\_malloc (/home/user/workspace/graphite2/gr2fonttest+0x8104184)
#1 0x814e5f2 in unsigned char\* graphite2::gralloc<unsigned char>(unsigned int) src/inc/Main.h:88:28
#2 0x814e5f2 in graphite2::Face::Table::decompress() src/Face.cpp:333
#3 0x814dd32 in graphite2::Face::Table::Table(graphite2::Face const&, graphite2::TtfUtil::Tag, unsigned int) src/Face.cpp:292:9
#4 0x8140540 in (anonymous namespace)::load\_face(graphite2::Face&, unsigned int) src/gr\_face.cpp:49:21
#5 0x8141aba in gr\_make\_face\_with\_ops src/gr\_face.cpp:89:16
#6 0x8141aba in gr\_make\_file\_face src/gr\_face.cpp:242
#7 0x813b99e in Parameters::testFileFont() const gr2fonttest/gr2FontTest.cpp:639:20
#8 0x813d9d3 in main gr2fonttest/gr2FontTest.cpp:798:9
#9 0xf753c636 in \_\_libc\_start\_main /build/glibc-5sb1ri/glibc-2.23/csu/../csu/libc-start.c:291

|  | [Tyson Smith [:tsmith] (PTO)](/user_profile?user_id=486634)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1352745#c1)• 8 years ago |
|  | |

I believe this was introduced after the 1.3.9 graphite and does not affect Firefox (yet)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1352745#a8155_75935)• 8 years ago |

Flags: needinfo?(martin\_hosken)

|  | [martin\_hosken](/user_profile?user_id=405861) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1352745#c2)• 8 years ago |
|  | |

Fixed upstream 8afc7d0. All part of getting the 32-bit rollover bug fixed in the decompressor, so just another aspect of this kind of bug.Flags: needinfo?(martin\_hosken)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1352745#a420943_1689)• 8 years ago |

Status: NEW → RESOLVEDClosed: 8 years ago
[status-firefox55](/buglist.cgi?f1=cf_status_firefox55&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox55&o1=equals&v1=unaffected)
[status-firefox-esr45](/buglist.cgi?f1=cf_status_firefox_esr45&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=unaffected)
[status-firefox-esr52](/buglist.cgi?f1=cf_status_firefox_esr52&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=unaffected)Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)Resolution: --- → FIXED

|  | [Tyson Smith [:tsmith] (PTO)](/user_profile?user_id=486634)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1352745#a425916_486634)• 8 years ago |

Blocks: [CVE-2017-7778](/show_bug.cgi?id=1349310 "RESOLVED FIXED - Graphite2 lz4::decompress out of bounds write")Status: RESOLVED → REOPENEDKeywords: [regression](/buglist.cgi?keywords=regression&resolution=---)Resolution: FIXED → ---

|  | [Milan Sreckovic [:milan] (needinfo for best results)](/user_profile?user_id=456486) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1352745#c3)• 8 years ago |
|  | |

We should retest once [bug 1349310](/show_bug.cgi?id=1349310 "RESOLVED FIXED - Graphite2 lz4::decompress out of bounds write") lands.

|  | [Tyson Smith [:tsmith] (PTO)](/user_profile?user_id=486634)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1352745#a1455563_486634)• 8 years ago |

Blocks: [fuzzing-fonts](/show_bug.cgi?id=750695 "NEW - [meta] Fuzzing: Fonts")

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1352745#a3273084_329583)• 8 years ago |

No longer blocks: [CVE-2017-7778](/show_bug.cgi?id=1349310 "RESOLVED FIXED - Graphite2 lz4::decompress out of bounds write")Depends on: [CVE-2017-7778](/show_bug.cgi?id=1349310 "RESOLVED FIXED - Graphite2 lz4::decompress out of bounds write")

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1352745#c4)• 8 years ago |
|  | |

Milan suggested a retest in [comment 3](/show_bug.cgi?id=1352745#c3 "RESOLVED FIXED - Graphite2 heap-buffer-overflow write [@ lz4::decompress]"). Can you do this, Tyson?Flags: needinfo?(twsmith)

|  | [Tyson Smith [:tsmith] (PTO)](/user_profile?user_id=486634)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1352745#c5)• 8 years ago |
|  | |

Verified fixed in graphite commit 090076bf4Flags: needinfo?(twsmith)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1352745#a4097100_428608)• 8 years ago |

Status: REOPENED → RESOLVEDClosed: 8 years ago → 8 years agoResolution: --- → FIXED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1352745#a4132259_1689)• 8 years ago |

Group: gfx-core-security → core-security-release

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1352745#a4143183_75935)• 8 years ago |

Assignee: nobody → jfkthame
[status-firefox53](/buglist.cgi?f1=cf_status_firefox53&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox53&o1=equals&v1=wontfix)
[status-firefox54](/buglist.cgi?f1=cf_status_firefox54&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox54&o1=equals&v1=fixed)
[status-firefox55](/buglist.cgi?f1=cf_status_firefox55&o1=isnotempty):
[unaffected](/buglist.cgi?f1=cf_status_firefox55&o1=equals&v1=unaffected) → [fixed](/buglist.cgi?f1=cf_status_firefox55&o1=equals&v1=fixed)
[status-firefox-esr45](/buglist.cgi?f1=cf_status_firefox_esr45&o1=isnotempty):
[unaffected](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=unaffected) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=wontfix)
[status-firefox-esr52](/buglist.cgi?f1=cf_status_firefox_esr52&o1=isnotempty):
[unaffected](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=unaffected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=fixed)Target Milestone: --- → mozilla55

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1352745#a5349203_452604)• 8 years ago |

Flags: qe-verify-Whiteboard: [post-critsmash-triage]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1352745#a5697254_280903)• 8 years ago |

[tracking-firefox-esr52](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=isnotempty):
--- → [54+](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=54%2B)Whiteboard: [post-critsmash-triage] → [post-critsmash-triage][adv-main54+][adv-esr52.2+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1352745#a5711514_280903)• 8 years ago |

Alias: CVE-2017-7772

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1352745#a17990729_1689)• 7 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1352745&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Tyson Smith [:tsmith] (PTO)](/user_profile?user_id=486634)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_2db658dc_20250126_085006.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1350047)
* [XML](/show_bug.cgi?ctype=xml&id=1350047)

Closed
[Bug 1350047](/show_bug.cgi?id=1350047)
(CVE-2017-7771)

Opened 8 years ago
Closed 8 years ago

# Graphite2: out of bounds read [@ graphite2::Pass::readPass]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Graphite2: out of bounds read [@ graphite2::Pass::readPass]

## Categories

### (Core :: Graphics: Text, defect, P3)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics%3A%20Text#Graphics%3A%20Text)

Graphics: Text
▾

Core :: Graphics: Text

Issues with glyph rasterization and painting, font format support, and interfacing with platform font APIs. For issues with font selection, text shaping, and glyph selection, see the Layout: Text and Fonts component.

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20Text&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20Text&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics%3A%20Text)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P3

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla55

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr45 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=wontfix) |
| firefox-esr52 | [54+](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=54%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=fixed) |
| firefox53 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox53&o1=equals&v1=wontfix) |
| firefox54 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox54&o1=equals&v1=fixed) |
| firefox55 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox55&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr45 |  | wontfix |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr52 | 54+ | fixed |
| firefox53 |  | wontfix |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox54 |  | fixed |
| firefox55 |  | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: tsmith, Assigned: jfkthame)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/e0f9759e1d7514ae4adfd806869e3c5d?d=mm&size=40)  [jfkthame](/user_profile?user_id=329583)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/a2837b951fa7dc639a2568203478ff0a?d=mm&size=40)  [tsmith](/user_profile?user_id=486634)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/029a38b9773f1943419c24b7c3d93761?d=mm&size=40)  [lsalzman](/user_profile?user_id=536714)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

### (Blocks 1 open bug)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[CVE-2017-7774](/show_bug.cgi?id=1355174 "RESOLVED FIXED - Graphite2: out of bounds read [@ graphite2::Silf::readGraphite]")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[fuzzing-fonts](/show_bug.cgi?id=750695 "NEW - [meta] Fuzzing: Fonts")

Dependency [tree](/showdependencytree.cgi?id=1350047&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1350047)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1355148](/show_bug.cgi?id=1355148 "RESOLVED DUPLICATE - Graphite2: out of bounds read [@ graphite2::Silf::readClassMap]")

## Details

### (Keywords: csectype-bounds, sec-high, testcase, Whiteboard: [gfx-noted][post-critsmash-triage][adv-main54+][adv-esr52.2+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2017-7771

[Keywords:](/describekeywords.cgi)

[csectype-bounds](/buglist.cgi?keywords=csectype-bounds&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[gfx-noted][post-critsmash-triage][adv-main54+][adv-esr52.2+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [mwobensmith](/user_profile?user_id=452604) | [qe-verify](#a6131133_452604 "8 years ago") | - |
| --- | --- | --- |
| [mwobensmith](/user_profile?user_id=452604) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file, 1 obsolete file)

| [test\_case.ttf](/attachment.cgi?id=8850653)  [8 years ago](#c0)  [Tyson Smith [:tsmith] (PTO)](/user_profile?user_id=486634)   5.09 KB, application/x-font-ttf |  | [Details](/attachment.cgi?id=8850653&action=edit) |
| --- | --- | --- |
| [test\_case.ttf](/attachment.cgi?id=8856618)  [8 years ago](#c14)  [Tyson Smith [:tsmith] (PTO)](/user_profile?user_id=486634)   1.58 KB, application/x-font-ttf |  | [Details](/attachment.cgi?id=8856618&action=edit) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Tyson Smith [:tsmith] (PTO)](/user_profile?user_id=486634)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1350047#c0)• 8 years ago |
|  | |

Attached file
[test\_case.ttf](attachment.cgi?id=8850653) (obsolete)
— [Details](attachment.cgi?id=8850653&action=edit)

Found with a 32bit build running gr2FontTest.
Invalid read of size 1
at 0x807EBDD: \_peek<1> (Endian.h:77)
by 0x807EBDD: read<unsigned char> (Endian.h:60)
by 0x807EBDD: graphite2::Pass::readPass(unsigned char const\*, unsigned int, unsigned int, graphite2::Face&, graphite2::passtype, unsigned int, graphite2::Error&) (Pass.cpp:102)
by 0x80650B2: graphite2::Silf::readGraphite(unsigned char const\*, unsigned int, graphite2::Face&, unsigned int) (Silf.cpp:216)
by 0x80555B7: graphite2::Face::readGraphite(graphite2::Face::Table const&) (Face.cpp:149)
by 0x804EF04: (anonymous namespace)::load\_face(graphite2::Face&, unsigned int) (gr\_face.cpp:59)
by 0x804FCE8: gr\_make\_face\_with\_ops (gr\_face.cpp:89)
by 0x804FCE8: gr\_make\_file\_face (gr\_face.cpp:242)
by 0x804C77A: Parameters::testFileFont() const (gr2FontTest.cpp:639)
by 0x804D936: main (gr2FontTest.cpp:798)
Address 0xe3406f0a is not stack'd, malloc'd or (recently) free'd
Process terminating with default action of signal 11 (SIGSEGV)
Access not within mapped region at address 0xE3406F0A
at 0x807EBDD: \_peek<1> (Endian.h:77)
by 0x807EBDD: read<unsigned char> (Endian.h:60)
by 0x807EBDD: graphite2::Pass::readPass(unsigned char const\*, unsigned int, unsigned int, graphite2::Face&, graphite2::passtype, unsigned int, graphite2::Error&) (Pass.cpp:102)
by 0x80650B2: graphite2::Silf::readGraphite(unsigned char const\*, unsigned int, graphite2::Face&, unsigned int) (Silf.cpp:216)
by 0x80555B7: graphite2::Face::readGraphite(graphite2::Face::Table const&) (Face.cpp:149)
by 0x804EF04: (anonymous namespace)::load\_face(graphite2::Face&, unsigned int) (gr\_face.cpp:59)
by 0x804FCE8: gr\_make\_face\_with\_ops (gr\_face.cpp:89)
by 0x804FCE8: gr\_make\_file\_face (gr\_face.cpp:242)
by 0x804C77A: Parameters::testFileFont() const (gr2FontTest.cpp:639)
by 0x804D936: main (gr2FontTest.cpp:798)

|  | [Tyson Smith [:tsmith] (PTO)](/user_profile?user_id=486634)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1350047#a894_486634)• 8 years ago |

Blocks: [fuzzing-fonts](/show_bug.cgi?id=750695 "NEW - [meta] Fuzzing: Fonts")

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1350047#c1)• 8 years ago |
|  | |

Martin, one more for you :)Flags: needinfo?(martin\_hosken)

|  | [martin\_hosken](/user_profile?user_id=405861) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1350047#c2)• 8 years ago |
|  | |

Not sure how this one triggered a bug. Running this rejects the font due to lack of any glyphs, before any passes are read. Can you remind me of the command line you used to run this?Flags: needinfo?(martin\_hosken) → needinfo?(twsmith)

|  | [Tyson Smith [:tsmith] (PTO)](/user_profile?user_id=486634)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1350047#c3)• 8 years ago |
|  | |

(In reply to martin\_hosken from [comment #2](/show_bug.cgi?id=1350047#c2 "RESOLVED FIXED - Graphite2: out of bounds read [@ graphite2::Pass::readPass]"))
> Not sure how this one triggered a bug. Running this rejects the font due to
> lack of any glyphs, before any passes are read. Can you remind me of the
> command line you used to run this?
This was found on a 32bit build using the following command line:
valgrind -q ./gr2fonttest -auto -demand -noprint test\_case.ttfFlags: needinfo?(twsmith)

|  | [martin\_hosken](/user_profile?user_id=405861) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1350047#c4)• 8 years ago |
|  | |

And when I run that (albeit without valgrind), I get "Invalid font, failed to read or parse tables" which triggers before any loading of any passes and therefore the backtrace never fires. Are you running with the latest code (at least to before today)?Flags: needinfo?(twsmith)

|  | [Tyson Smith [:tsmith] (PTO)](/user_profile?user_id=486634)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1350047#c5)• 8 years ago |
|  | |

(In reply to martin\_hosken from [comment #4](/show_bug.cgi?id=1350047#c4 "RESOLVED FIXED - Graphite2: out of bounds read [@ graphite2::Pass::readPass]"))
> And when I run that (albeit without valgrind), I get "Invalid font, failed
> to read or parse tables" which triggers before any loading of any passes and
> therefore the backtrace never fires. Are you running with the latest code
> (at least to before today)?
Yes I was using the latest code and this \*needs\* to be run under valgrind to detect the issue.Flags: needinfo?(twsmith)

|  | [martin\_hosken](/user_profile?user_id=405861) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1350047#c6)• 8 years ago |
|  | |

But I can't get it to get to that piece of code. I set a breakpoint on the first time the line valgrind complains about is ever hit and the program exits long before that because the font fails another test somewhere else (no glyphs in the font). Any ideas?

|  | [Tyson Smith [:tsmith] (PTO)](/user_profile?user_id=486634)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1350047#c7)• 8 years ago |
|  | |

Looks like it is compiler dependent.
Building a 32bit build with Clang 3.8 I can reproduce the issue.
Building a 32bit build with GCC 5.4.0 I can NOT reproduce the issue.

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1350047#c8)• 8 years ago |
|  | |

That's a bit worrying in itself; assuming valgrind doesn't warn about using an uninitialized value earlier (which could explain why the two builds take different paths), it sounds like we could be running into an undefined-behavior situation somewhere along the way.
If you change the optimization level, does that affect reproducibility (with either compiler)?

|  | [Tyson Smith [:tsmith] (PTO)](/user_profile?user_id=486634)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1350047#c9)• 8 years ago |
|  | |

FWIW I did try running this test case under a 32bit UBSan build but it didn't report any issues

|  | [martin\_hosken](/user_profile?user_id=405861) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1350047#c10)• 8 years ago |
|  | |

I'm busy most of today and installing clang 32-bit on my 64-bit Ubuntu 16.04 is not coming together. But I have committed a speculative fix. So if you get a chance to give it a try, then I might have hit lucky :)

|  | [Bas Schouten (:bas.schouten)](/user_profile?user_id=272464) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1350047#a1091769_272464)• 8 years ago |

Priority: -- → P3Whiteboard: [gfx-noted]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1350047#c11)• 8 years ago |
|  | |

ni? tyson to check out [comment 10](/show_bug.cgi?id=1350047#c10 "RESOLVED FIXED - Graphite2: out of bounds read [@ graphite2::Pass::readPass]")Flags: needinfo?(twsmith)

|  | [Tyson Smith [:tsmith] (PTO)](/user_profile?user_id=486634)  Reporter |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1350047#c12)• 8 years ago |
|  | |

I verified this bug is no longer reproducible with the latest commit (8afc7d0) in the graphite repo. However this test case now triggers [bug 1355148](/show_bug.cgi?id=1355148 "RESOLVED DUPLICATE - Graphite2: out of bounds read [@ graphite2::Silf::readClassMap]")Flags: needinfo?(twsmith)See Also: → [1355148](/show_bug.cgi?id=1355148 "RESOLVED DUPLICATE - Graphite2: out of bounds read [@ graphite2::Silf::readClassMap]")

|  | [Tyson Smith [:tsmith] (PTO)](/user_profile?user_id=486634)  Reporter |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1350047#c13)• 8 years ago |
|  | |

Actually this is still reproducible and I don't need Valgrind to detect it now.
STR:
Run in gdb with a 32-bit debug build.
./g2fonttest test\_case.ttf -auto -demand -noprint
Program received signal SIGSEGV, Segmentation fault.
graphite2::Pass::readPass (this=<optimized out>,
pass\_start=0x880abd48 <error: Cannot access memory at address 0x880abd48>,
pass\_length=2147483795, subtable\_base=<optimized out>, face=..., pt=<optimized out>,
version=131072, e=...) at src/Pass.cpp:102
102 const byte flags = be::read<byte>(p);
(gdb) bt
#0 graphite2::Pass::readPass (this=<optimized out>,
pass\_start=0x880abd48 <error: Cannot access memory at address 0x880abd48>,
pass\_length=2147483795, subtable\_base=<optimized out>, face=..., pt=<optimized out>,
version=131072, e=...) at src/Pass.cpp:102
#1 0x080646b0 in graphite2::Silf::readGraphite (this=<optimized out>,
silf\_start=<optimized out>, lSilf=<optimized out>, face=..., version=<optimized out>)
at src/Silf.cpp:216
#2 0x080551d8 in graphite2::Face::readGraphite (this=<optimized out>, silf=...)
at src/Face.cpp:149
#3 0x0804f27e in (anonymous namespace)::load\_face (face=..., options=<optimized out>)
at src/gr\_face.cpp:59
#4 gr\_make\_face\_with\_ops (appFaceHandle=<optimized out>, ops=<optimized out>,
faceOptions=<optimized out>) at src/gr\_face.cpp:89
#5 0x080502c2 in gr\_make\_file\_face (filename=<optimized out>, faceOptions=134811874)
at src/gr\_face.cpp:242
#6 0x0804c6eb in Parameters::testFileFont (this=0xffffcf08)
at gr2fonttest/gr2FontTest.cpp:639
#7 0x0804d9ed in main (argc=<optimized out>, argv=<optimized out>)
at gr2fonttest/gr2FontTest.cpp:798

|  | [Tyson Smith [:tsmith] (PTO)](/user_profile?user_id=486634)  Reporter |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1350047#c14)• 8 years ago |
|  | |

Attached file
[test\_case.ttf](attachment.cgi?id=8856618)
— [Details](attachment.cgi?id=8856618&action=edit)

[Attachment #8850653](/attachment.cgi?id=8850653&action=edit "test_case.ttf") -
Attachment is obsolete: true

|  | [martin\_hosken](/user_profile?user_id=405861) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1350047#c15)• 8 years ago |
|  | |

This seems now to be the same core issue being considered in [bug 1355174](/show_bug.cgi?id=1355174 "RESOLVED FIXED - Graphite2: out of bounds read [@ graphite2::Silf::readGraphite]") where passes\_start is passing its range test when it shouldn't be.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1350047#a3024487_1689)• 8 years ago |

Depends on: [CVE-2017-7774](/show_bug.cgi?id=1355174 "RESOLVED FIXED - Graphite2: out of bounds read [@ graphite2::Silf::readGraphite]")Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Stephanie Ouillon [:arroway] (needinfo me)](/user_profile?user_id=485442) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1350047#c16)• 8 years ago |
|  | |

[bug 1355174](/show_bug.cgi?id=1355174 "RESOLVED FIXED - Graphite2: out of bounds read [@ graphite2::Silf::readGraphite]") ad [bug 1355148](/show_bug.cgi?id=1355148 "RESOLVED DUPLICATE - Graphite2: out of bounds read [@ graphite2::Silf::readClassMap]") have been fixed, does this bug still reproduce?Flags: needinfo?(twsmith)

|  | [Tyson Smith [:tsmith] (PTO)](/user_profile?user_id=486634)  Reporter |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1350047#c17)• 8 years ago |
|  | |

Verified fixed in graphite commit 090076bf4Flags: needinfo?(twsmith)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1350047#a5938433_428608)• 8 years ago |

Status: NEW → RESOLVEDClosed: 8 years agoResolution: --- → FIXED

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1350047#a5945648_75935)• 8 years ago |

Assignee: nobody → jfkthame
[status-firefox53](/buglist.cgi?f1=cf_status_firefox53&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox53&o1=equals&v1=wontfix)
[status-firefox54](/buglist.cgi?f1=cf_status_firefox54&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox54&o1=equals&v1=fixed)
[status-firefox55](/buglist.cgi?f1=cf_status_firefox55&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox55&o1=equals&v1=fixed)
[status-firefox-esr45](/buglist.cgi?f1=cf_status_firefox_esr45&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=wontfix)
[status-firefox-esr52](/buglist.cgi?f1=cf_status_firefox_esr52&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=fixed)Target Milestone: --- → mozilla55

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1350047#a6131133_452604)• 8 years ago |

Flags: qe-verify-Whiteboard: [gfx-noted] → [gfx-noted][post-critsmash-triage]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1350047#a6140986_1689)• 8 years ago |

Group: gfx-core-security → core-security-release

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1350047#a6479413_280903)• 8 years ago |

[tracking-firefox-esr52](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=isnotempty):
--- → [54+](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=54%2B)Whiteboard: [gfx-noted][post-critsmash-triage] → [gfx-noted][post-critsmash-triage][adv-main54+][adv-esr52.2+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1350047#a6493661_280903)• 8 years ago |

Alias: CVE-2017-7771

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1350047#a18772908_1689)• 7 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1350047&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Tyson Smith [:tsmith] (PTO)](/user_profile?user_id=486634)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


