=== Content from sourceware.org_81b23ac9_20250125_175929.html ===


Sourceware Bugzilla – Bug 22148
Integer overflow in elf64-x86-64.c, binutils 2.29.1
Last modified: 2017-09-18 20:21:58 UTC

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=22148&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=22148&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 22148**](show_bug.cgi?id=22148)
- Integer overflow in elf64-x86-64.c, binutils 2.29.1

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
Integer overflow in elf64-x86-64.c, binutils 2.29.1

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | binutils | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=binutils "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | binutils ([show other bugs](buglist.cgi?component=binutils&product=binutils&bug_status=__open__)) | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | 2.29 | |  | | | [Importance](page.cgi?id=fields.html#importance): | P2 normal | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | 2.30 | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Not yet assigned to anyone | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2017-09-18 01:34 UTC by skysider | | --- | --- | | Modified: | 2017-09-18 20:21 UTC ([History](show_activity.cgi?id=22148)) | | CC List: | 0 users | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Host:](page.cgi?id=fields.html#cf_gcchost "A custom Free Text field in this installation of Bugzilla.") |  | | [Target:](page.cgi?id=fields.html#cf_gcctarget "A custom Free Text field in this installation of Bugzilla.") |  | | [Build:](page.cgi?id=fields.html#cf_gccbuild "A custom Free Text field in this installation of Bugzilla.") |  | | [Last reconfirmed:](page.cgi?id=fields.html#cf_reconfirmed_on "A custom Date/Time field in this installation of Bugzilla.") |  | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [**poc of integer overlow**](attachment.cgi?id=10418 "View the content of the attachment") (4.88 KB, application/x-executable)  [2017-09-18 01:34 UTC](#attach_10418 "Go to the comment associated with the attachment"), skysider | [Details](attachment.cgi?id=10418&action=edit) | | [View All](attachment.cgi?bugid=22148&action=viewall)  [Add an attachment](attachment.cgi?bugid=22148&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=22148&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=22148#c0)  skysider    2017-09-18 01:34:58 UTC  ``` Created [attachment 10418](attachment.cgi?id=10418 "poc of integer overlow") [[details]](attachment.cgi?id=10418&action=edit "poc of integer overlow") poc of integer overlow  In elf64-x86-64.c:6718, function elf_x86_64_get_synthetic_symtab  static long elf_x86_64_get_synthetic_symtab (bfd *abfd, 				 long symcount ATTRIBUTE_UNUSED, 				 asymbol **syms ATTRIBUTE_UNUSED, 				 long dynsymcount, 				 asymbol **dynsyms, 				 asymbol **ret) { ......  dynrelcount = bfd_canonicalize_dynamic_reloc (abfd, dynrelbuf, 						dynsyms);  /* Sort the relocs by address.  */ qsort (dynrelbuf, dynrelcount, sizeof (arelent *), compare_relocs); ...... }  When I use objdump to deal with a specific elf file, it causes segmentation fault. Here is the backtrace:  (gdb) bt                                                                                                                                                    #0  0x0000000000456d43 in compare_relocs (ap=0x800000000084ebd8, bp=0x84ebe0) at elf64-x86-64.c:6635                                    #1  0x00007ffff784030f in _quicksort (pbase=pbase@entry=0x84ebe0, total_elems=total_elems@entry=18446744073709551615,                        size=size@entry=8, cmp=cmp@entry=0x456d40 <compare_relocs>, arg=0x0) at qsort.c:122                                                                                 #2  0x00007ffff7842642 in __GI___qsort_r (b=b@entry=0x84ebe0,      cmp=cmp@entry=0x456d40 <compare_relocs>, arg=arg@entry=0x0) at msort.c:216                                                                                                                    #3  0x00007ffff7842768 in __GI_qsort (b=b@entry=0x84ebe0, n=n@entry=18446744073709551615, s=s@entry=8,                      cmp=cmp@entry=0x456d40 <compare_relocs>) at msort.c:308                                       #4  0x000000000045a00d in elf_x86_64_get_synthetic_symtab (abfd=0x8451c0, symcount=<optimized out>, syms=<optimized out>,            dynsymcount=<optimized out>, dynsyms=<optimized out>, ret=0x83e668 <synthsyms>) at elf64-x86-64.c:6722                                        #5  0x0000000000408287 in dump_bfd (abfd=abfd@entry=0x8451c0) at ./objdump.c:3525                              #6  0x0000000000408b48 in display_object_bfd (abfd=0x8451c0) at ./objdump.c:3603                                                                                 #7  display_any_bfd (file=file@entry=0x8451c0, level=level@entry=0) at ./objdump.c:3692                                                                   #8  0x000000000040ae14 in display_file (filename=0x7fffffffe8ba "../out/crashes/id:000000,sig:11,src:000000,op:flip1,pos:9273",                                       target=<optimized out>, last_file=1) at ./objdump.c:3713                                                                            #9  0x0000000000404d5e in main (argc=3, argv=0x7fffffffe698) at ./objdump.c:4015                                                                         (gdb) p/x 18446744073709551615                                                                                                                          $41 = 0xffffffffffffffff       We can see that the n parameter is -1, which is negative, but the qsort parameter type is unsigned, so there is an integer overfow. ```  [Comment 1](show_bug.cgi?id=22148#c1)  Sourceware Commits    2017-09-18 20:10:50 UTC  ``` The master branch has been updated by H.J. Lu <hjl@sourceware.org>:  <https://sourceware.org/git/gitweb.cgi?p=binutils-gdb.git;h=94670f6cf11fc29cc6db6814b38c4305d9bcac96>  commit 94670f6cf11fc29cc6db6814b38c4305d9bcac96 Author: H.J. Lu <hjl.tools@gmail.com> Date:   Mon Sep 18 13:05:25 2017 -0700      Check error return from bfd_canonicalize_dynamic_reloc          Since bfd_canonicalize_dynamic_reloc returns -1 on error, check it in     _bfd_x86_elf_get_synthetic_symtab.          	[PR ld/22148](show_bug.cgi?id=22148 "RESOLVED FIXED - Integer overflow in elf64-x86-64.c, binutils 2.29.1")     	* elfxx-x86.c (_bfd_x86_elf_get_synthetic_symtab): Check error     	return from bfd_canonicalize_dynamic_reloc. ```  [Comment 2](show_bug.cgi?id=22148#c2)  Sourceware Commits    2017-09-18 20:19:16 UTC  ``` The binutils-2_29-branch branch has been updated by H.J. Lu <hjl@sourceware.org>:  <https://sourceware.org/git/gitweb.cgi?p=binutils-gdb.git;h=e6ff33ca50c1180725dde11c84ee93fcdb4235ef>  commit e6ff33ca50c1180725dde11c84ee93fcdb4235ef Author: H.J. Lu <hjl.tools@gmail.com> Date:   Mon Sep 18 13:05:25 2017 -0700      Check error return from bfd_canonicalize_dynamic_reloc          Since bfd_canonicalize_dynamic_reloc returns -1 on error, check it in     elf_i386_get_synthetic_symtab and elf_x86_64_get_synthetic_symtab.          	[PR ld/22148](show_bug.cgi?id=22148 "RESOLVED FIXED - Integer overflow in elf64-x86-64.c, binutils 2.29.1")     	* elf32-i386.c (elf_i386_get_synthetic_symtab): Check error     	return from bfd_canonicalize_dynamic_reloc.     	* elf64-x86-64.c (elf_x86_64_get_synthetic_symtab): Likewise.          (cherry picked from commit 94670f6cf11fc29cc6db6814b38c4305d9bcac96) ```  [Comment 3](show_bug.cgi?id=22148#c3)  H.J. Lu    2017-09-18 20:21:58 UTC  ``` Fixed for master and 2.29 branches. ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=22148)
* - [XML](show_bug.cgi?ctype=xml&id=22148)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=22148)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=22148&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=22148&GoAheadAndLogIn=1#forgot)
    Login:

    [x]


