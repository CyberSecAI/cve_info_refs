=== Content from bugzilla.redhat.com_a5af0992_20250125_191323.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1489356)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1489356)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1489356)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1489356

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1489356**](show_bug.cgi?id=1489356)
- There is a heap-buffer-overflow in bson\_utf8\_validate() function of libbson.

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
There is a heap-buffer-overflow in bson\_utf8\_validate() function of libbson.

| | [Keywords](describekeywords.cgi): |  | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED DUPLICATE of [bug 1489355](show_bug.cgi?id=1489355 "CLOSED ERRATA - There is a heap-buffer-overflow in bson_utf8_validate() function of libbson.") | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Fedora | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Fedora | | [Component:](describecomponents.cgi?product=Fedora "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | libbson | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | rawhide | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Unspecified | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Unspecified | | [Priority:](page.cgi?id=fields.html#priority) | unspecified | | [Severity:](page.cgi?id=fields.html#bug_severity) | urgent | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Petr Pisar | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | Fedora Extras Quality Assurance | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | | TreeView+ | [depends on](buglist.cgi?bug_id=1489356&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1489356&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2017-09-07 09:21 UTC by owl337 | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2017-09-11 08:01 UTC ([History](show_activity.cgi?id=1489356)) | | [CC List:](page.cgi?id=fields.html#cclist) | 3 users (show)  fedora jesse ppisar | | Fixed In Version: |  | | | Doc Type: | If docs needed, set a value | | | Doc Text: |  | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2017-09-11 08:01:07 UTC | | | Type: | Bug | | | Embargoed: |  | | | [Dependent Products:](page.cgi?id=fields.html#dependent_products "Other Products that are affected by this bug.") | Ember-CSI Red Hat Enterprise Virtualization Manager Red Hat OpenStack Service Telemetry Framework | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | | [**POC**](attachment.cgi?id=1323015 "View the content of the attachment") (95 bytes, application/x-rar)  [2017-09-07 09:22 UTC](#attach_1323015 "Go to the comment associated with the attachment"), owl337 | *no flags* | [Details](attachment.cgi?id=1323015&action=edit) | | [View All](attachment.cgi?bugid=1489356&action=viewall) | | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1489356#c0)  owl337    2017-09-07 09:21:57 UTC  ``` Description of problem:  There is a heap-buffer-overflow in bson_utf8_validate() function of libbson.   Version-Release number of selected component (if applicable):  <= latest version  How reproducible:  ./bson-metrics POC1  Steps to Reproduce:  The debugging information is as follows:  $ ./bson-metrics POC1  Segmentation fault  ASAN debugging information:  $ ./bson-metrics POC1 ================================================================= ==61994==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x61900000b880 at pc 0x7f1da16706b7 bp 0x7ffe5cc1a480 sp 0x7ffe5cc1a478 READ of size 1 at 0x61900000b880 thread T0     #0 0x7f1da16706b6  (/home/icy/secreal/libbson-asan/install/lib/libbson-1.0.so.0+0xa96b6)     #1 0x7f1da16394cb  (/home/icy/secreal/libbson-asan/install/lib/libbson-1.0.so.0+0x724cb)     #2 0x4dbe3c  (/home/icy/secreal/libbson-asan/install/test/bson-metrics+0x4dbe3c)     #3 0x7f1da06d4abf  (/lib/x86_64-linux-gnu/libc.so.6+0x20abf)     #4 0x435648  (/home/icy/secreal/libbson-asan/install/test/bson-metrics+0x435648)  0x61900000b880 is located 0 bytes to the right of 1024-byte region [0x61900000b480,0x61900000b880) allocated by thread T0 here:     #0 0x4bc78b  (/home/icy/secreal/libbson-asan/install/test/bson-metrics+0x4bc78b)     #1 0x7f1da1662aff  (/home/icy/secreal/libbson-asan/install/lib/libbson-1.0.so.0+0x9baff)  Shadow bytes around the buggy address:   0x0c327fff96c0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c327fff96d0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c327fff96e0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c327fff96f0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c327fff9700: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 =>0x0c327fff9710:[fa]fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c327fff9720: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c327fff9730: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c327fff9740: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c327fff9750: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c327fff9760: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07    Heap left redzone:       fa   Heap right redzone:      fb   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack partial redzone:   f4   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb ==61994==ABORTING  GDB debugging information:  (gdb) set args POC1 (gdb) r ...  Breakpoint 7, bson_utf8_validate (utf8=0x61900000b48e "\006", utf8_len=4294967295, allow_null=<optimized out>)     at src/bson/bson-utf8.c:143 143	      if ((utf8_len - i) < seq_length) { (gdb) c 1007  Will ignore next 1006 crossings of breakpoint 7.  Continuing.  Breakpoint 7, bson_utf8_validate (utf8=0x61900000b48e "\006", utf8_len=4294967295, allow_null=<optimized out>)     at src/bson/bson-utf8.c:143 143	      if ((utf8_len - i) < seq_length) { (gdb) i b Num     Type           Disp Enb Address            What 7       breakpoint     keep y   0x00007ffff7b7e310 in bson_utf8_validate at src/bson/bson-utf8.c:143 	breakpoint already hit 1008 times (gdb) n 151	      c = utf8[i] & first_mask; (gdb)  156	      for (j = i + 1; j < (i + seq_length); j++) { (gdb)  182	      if (c > 0x0010FFFF) { (gdb)  197	      switch (seq_length) { (gdb)  199	         if (c <= 0x007F) { (gdb)  130	   for (i = 0; i < utf8_len; i += seq_length) { (gdb) n ================================================================= ==100494==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x61900000b880 at pc 0x7ffff7b7e6b7 bp 0x7fffffffd800 sp 0x7fffffffd7f8 READ of size 1 at 0x61900000b880 thread T0     #0 0x7ffff7b7e6b6  (/home/icy/secreal/libbson-asan/install/lib/libbson-1.0.so.0+0xa96b6)     #1 0x7ffff7b474cb  (/home/icy/secreal/libbson-asan/install/lib/libbson-1.0.so.0+0x724cb)     #2 0x4dbe3c  (/home/icy/secreal/libbson-asan/install/test/bson-metrics+0x4dbe3c)     #3 0x7ffff6be2abf  (/lib/x86_64-linux-gnu/libc.so.6+0x20abf)     #4 0x435648  (/home/icy/secreal/libbson-asan/install/test/bson-metrics+0x435648)  0x61900000b880 is located 0 bytes to the right of 1024-byte region [0x61900000b480,0x61900000b880) allocated by thread T0 here:     #0 0x4bc78b  (/home/icy/secreal/libbson-asan/install/test/bson-metrics+0x4bc78b)     #1 0x7ffff7b70aff  (/home/icy/secreal/libbson-asan/install/lib/libbson-1.0.so.0+0x9baff)  Shadow bytes around the buggy address:   0x0c327fff96c0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c327fff96d0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c327fff96e0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c327fff96f0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c327fff9700: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 =>0x0c327fff9710:[fa]fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c327fff9720: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c327fff9730: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c327fff9740: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c327fff9750: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c327fff9760: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07    Heap left redzone:       fa   Heap right redzone:      fb   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack partial redzone:   f4   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb ==100494==ABORTING [Inferior 1 (process 100494) exited with code 01]  (gdb) bt  #0  bson_utf8_validate (utf8=0x61900000b48e "\006", utf8_len=4294967295, allow_null=<optimized out>)     at src/bson/bson-utf8.c:143 #1  0x00007ffff7b474cc in bson_iter_visit_all (iter=<optimized out>, visitor=<optimized out>, data=<optimized out>)     at src/bson/bson-iter.c:2069 #2  0x00000000004dbe3d in bson_metrics (data=<optimized out>, bson=<optimized out>, length=<optimized out>)     at bson-metrics.c:208 #3  main (argc=<optimized out>, argv=<optimized out>) at bson-metrics.c:257   This vulnerability was triggered in function bson_utf8_validate() at line src/bson/bson-utf8.c:130:  130	   for (i = 0; i < utf8_len; i += seq_length) { 131	      _bson_utf8_get_sequence (&utf8[i], &seq_length, &first_mask); 132	 133	      /* 134	       * Ensure we have a valid multi-byte sequence length. 135	       */ 136	      if (!seq_length) { 137	         return false; 138	      } 139	 140	      /* 141	       * Ensure we have enough bytes left. 142	       */ 143	      if ((utf8_len - i) < seq_length) { 144	         return false; 145	      } 146	 ...   Actual results:  crash  Expected results:  crash  Additional info:   Credits:  This vulnerability is detected by team OWL337, with our custom fuzzer collAFL. Please contact ganshuitao   and chaoz.cn if you need more info about the team, the tool or the vulnerability.   ```  [Comment 1](show_bug.cgi?id=1489356#c1)  owl337    2017-09-07 09:22:26 UTC  ``` Created [attachment 1323015](attachment.cgi?id=1323015 "POC") [[details]](attachment.cgi?id=1323015&action=edit "POC") POC   ```  [Comment 2](show_bug.cgi?id=1489356#c2)  A. Jesse Jiryu Davis    2017-09-09 14:22:14 UTC  ``` This is the same logic bug as #1489355   ```  [Comment 3](show_bug.cgi?id=1489356#c3)  Petr Pisar    2017-09-11 08:01:07 UTC  ```   *** This bug has been marked as a duplicate of [bug 1489355](show_bug.cgi?id=1489355 "CLOSED ERRATA - There is a heap-buffer-overflow in bson_utf8_validate() function of libbson.") ***   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1489356&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from bugzilla.redhat.com_ccc12243_20250125_191324.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1489362)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1489362)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1489362)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1489362

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1489362**](show_bug.cgi?id=1489362)
- There is a heap-based buffer overflow in bson-to-json.c.

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
There is a heap-based buffer overflow in bson-to-json.c.

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED DUPLICATE of [bug 1489355](show_bug.cgi?id=1489355 "CLOSED ERRATA - There is a heap-buffer-overflow in bson_utf8_validate() function of libbson.") | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Fedora | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Fedora | | [Component:](describecomponents.cgi?product=Fedora "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | libbson | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | rawhide | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Unspecified | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Unspecified | | [Priority:](page.cgi?id=fields.html#priority) | unspecified | | [Severity:](page.cgi?id=fields.html#bug_severity) | urgent | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Petr Pisar | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | Fedora Extras Quality Assurance | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") | [https://jira.mongodb.org/projects/SEC...](https://jira.mongodb.org/projects/SECURITY/issues/SECURITY-476) | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | | TreeView+ | [depends on](buglist.cgi?bug_id=1489362&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1489362&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2017-09-07 09:26 UTC by owl337 | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2017-09-15 07:34 UTC ([History](show_activity.cgi?id=1489362)) | | [CC List:](page.cgi?id=fields.html#cclist) | 3 users (show)  fedora jesse ppisar | | Fixed In Version: |  | | | Doc Type: | If docs needed, set a value | | | Doc Text: |  | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2017-09-15 07:34:23 UTC | | | Type: | Bug | | | Embargoed: |  | | | [Dependent Products:](page.cgi?id=fields.html#dependent_products "Other Products that are affected by this bug.") | Ember-CSI Red Hat Enterprise Virtualization Manager Red Hat OpenStack Service Telemetry Framework | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | | [**./bson-to-json POC2**](attachment.cgi?id=1323017 "View the content of the attachment") (165 bytes, application/x-rar)  [2017-09-07 09:26 UTC](#attach_1323017 "Go to the comment associated with the attachment"), owl337 | *no flags* | [Details](attachment.cgi?id=1323017&action=edit) | | [View All](attachment.cgi?bugid=1489362&action=viewall) | | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1489362#c0)  owl337    2017-09-07 09:26:23 UTC  ``` Created [attachment 1323017](attachment.cgi?id=1323017 "./bson-to-json POC2") [[details]](attachment.cgi?id=1323017&action=edit "./bson-to-json POC2") ./bson-to-json POC2  Description of problem:  There is a heap-based buffer overflow in bson-to-json.c.  Version-Release number of selected component (if applicable):  <= latest  How reproducible:  ./bson-to-json POC2  Steps to Reproduce:   The debugging information is as follows:  $ ./bson-to-json POC2  (null) (null) (null) (null) (null) (null) (null) (null) (null) (null) (null) (null) Segmentation fault  ASAN debugging information:   $ ./bson-to-json POC2 (null) (null) (null) (null) (null) (null) (null) (null) (null) (null) (null) (null) ================================================================= ==7328==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x61900000b880 at pc 0x7fa38d86f6e7 bp 0x7ffe730e9400 sp 0x7ffe730e93f8 READ of size 1 at 0x61900000b880 thread T0     #0 0x7fa38d86f6e6  (/home/icy/secreal/libbson-asan/install/lib/libbson-1.0.so.0+0xa96e6)     #1 0x7fa38d8384bb  (/home/icy/secreal/libbson-asan/install/lib/libbson-1.0.so.0+0x724bb)     #2 0x7fa38d81dbe4  (/home/icy/secreal/libbson-asan/install/lib/libbson-1.0.so.0+0x57be4)     #3 0x4dbb76  (/home/icy/secreal/libbson-asan/examples/bson-to-json+0x4dbb76)     #4 0x7fa38c8d3abf  (/lib/x86_64-linux-gnu/libc.so.6+0x20abf)     #5 0x435458  (/home/icy/secreal/libbson-asan/examples/bson-to-json+0x435458)  0x61900000b880 is located 0 bytes to the right of 1024-byte region [0x61900000b480,0x61900000b880) allocated by thread T0 here:     #0 0x4bc59b  (/home/icy/secreal/libbson-asan/examples/bson-to-json+0x4bc59b)     #1 0x7fa38d861b2f  (/home/icy/secreal/libbson-asan/install/lib/libbson-1.0.so.0+0x9bb2f)  Shadow bytes around the buggy address:   0x0c327fff96c0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c327fff96d0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c327fff96e0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c327fff96f0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c327fff9700: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 =>0x0c327fff9710:[fa]fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c327fff9720: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c327fff9730: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c327fff9740: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c327fff9750: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c327fff9760: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07    Heap left redzone:       fa   Heap right redzone:      fb   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack partial redzone:   f4   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb ==7328==ABORTING   GDB debugging information:  (gdb) set args POC2 (gdb) r ...  (gdb) set args fuzz/bson2json_out/crashes/id\:000002\,sig\:11\,src\:000767\,op\:arith8\,pos\:178\,val\:+3 (gdb) r ... (null) (null) (null) (null) (null) (null) (null) (null) (null) (null) (null) (null)  Program received signal SIGSEGV, Segmentation fault. bson_utf8_validate (utf8=0x61233c "\006", utf8_len=4294967295, allow_null=<optimized out>) at src/bson/bson-utf8.c:131 131	      _bson_utf8_get_sequence (&utf8[i], &seq_length, &first_mask); (gdb) bt #0  bson_utf8_validate (utf8=0x61233c "\006", utf8_len=4294967295, allow_null=<optimized out>)     at src/bson/bson-utf8.c:131 #1  0x00007ffff7b99646 in bson_iter_visit_all (iter=0x7fffffffdf80,      visitor=0x7ffff7dd0020 <bson_as_extended_json_visitors>, data=0x7fffffffe028) at src/bson/bson-iter.c:2069 #2  0x00007ffff7b8b148 in _bson_as_json_visit_all (bson=<optimized out>, length=0x0,      visitors=0x7ffff7dd0020 <bson_as_extended_json_visitors>) at src/bson/bson.c:3245 #3  0x0000000000401167 in main (argc=<optimized out>, argv=0x7fffffffe438) at bson-to-json.c:69   Actual results:  crash  Expected results:  crash  Additional info:   Credits:  This vulnerability is detected by team OWL337, with our custom fuzzer collAFL. Please contact ganshuitao   and chaoz.cn if you need more info about the team, the tool or the vulnerability.   ```  [Comment 1](show_bug.cgi?id=1489362#c1)  Petr Pisar    2017-09-07 13:27:39 UTC  ``` This is very probably duplicate of [bug #1489355](show_bug.cgi?id=1489355 "CLOSED ERRATA - There is a heap-buffer-overflow in bson_utf8_validate() function of libbson.")   ```  [Comment 2](show_bug.cgi?id=1489362#c2)  A. Jesse Jiryu Davis    2017-09-09 14:23:39 UTC  ``` Yes it is a duplicate of [bug #1489355](show_bug.cgi?id=1489355 "CLOSED ERRATA - There is a heap-buffer-overflow in bson_utf8_validate() function of libbson.")   ```  [Comment 3](show_bug.cgi?id=1489362#c3)  Petr Pisar    2017-09-15 07:34:23 UTC  ```   *** This bug has been marked as a duplicate of [bug 1489355](show_bug.cgi?id=1489355 "CLOSED ERRATA - There is a heap-buffer-overflow in bson_utf8_validate() function of libbson.") ***   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1489362&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from bugzilla.redhat.com_0e2aebc9_20250125_191322.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1489355)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1489355)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1489355)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1489355

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1489355**](show_bug.cgi?id=1489355)
- There is a heap-buffer-overflow in bson\_utf8\_validate() function of libbson.

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
There is a heap-buffer-overflow in bson\_utf8\_validate() function of libbson.

| | [Keywords](describekeywords.cgi): |  | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Fedora | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Fedora | | [Component:](describecomponents.cgi?product=Fedora "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | libbson | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | rawhide | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Unspecified | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Unspecified | | [Priority:](page.cgi?id=fields.html#priority) | unspecified | | [Severity:](page.cgi?id=fields.html#bug_severity) | unspecified | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Petr Pisar | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | Fedora Extras Quality Assurance | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") | [https://jira.mongodb.org/projects/SEC...](https://jira.mongodb.org/projects/SECURITY/issues/SECURITY-476) | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | Duplicates (2): | [1489356](show_bug.cgi?id=1489356 "CLOSED DUPLICATE - There is a heap-buffer-overflow in bson_utf8_validate() function of libbson.") [1489362](show_bug.cgi?id=1489362 "CLOSED DUPLICATE - There is a heap-based buffer overflow in bson-to-json.c.")  ([view as bug list](buglist.cgi?bug_id=1489356,1489362)) | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [CVE-2017-14227](show_bug.cgi?id=1494401 "CLOSED WONTFIX - CVE-2017-14227 libbson: Heap based buffer over read in the bson_utf8_validate function") | | TreeView+ | [depends on](buglist.cgi?bug_id=1489355&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1489355&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2017-09-07 09:21 UTC by owl337 | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2018-01-04 09:14 UTC ([History](show_activity.cgi?id=1489355)) | | [CC List:](page.cgi?id=fields.html#cclist) | 3 users (show)  fedora jesse ppisar | | Fixed In Version: | libbson-1.8.0-1.fc28 | | | Doc Type: | If docs needed, set a value | | | Doc Text: |  | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2018-01-04 09:14:20 UTC | | | Type: | Bug | | | Embargoed: |  | | | [Dependent Products:](page.cgi?id=fields.html#dependent_products "Other Products that are affected by this bug.") | Ember-CSI Red Hat Enterprise Virtualization Manager Red Hat OpenStack Service Telemetry Framework | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | | [**Triggered by " ./bson-metrics POC1"**](attachment.cgi?id=1323012 "View the content of the attachment") (95 bytes, application/x-rar)  [2017-09-07 09:21 UTC](#attach_1323012 "Go to the comment associated with the attachment"), owl337 | *no flags* | [Details](attachment.cgi?id=1323012&action=edit) | | [**POC1 file input for examples/bson-metrics.c program**](attachment.cgi?id=1323092 "View the content of the attachment") (28 bytes, application/octet-stream)  [2017-09-07 12:58 UTC](#attach_1323092 "Go to the comment associated with the attachment"), Petr Pisar | *no flags* | [Details](attachment.cgi?id=1323092&action=edit) | | [Show Obsolete](#a0) (1) [View All](attachment.cgi?bugid=1489355&action=viewall&hide_obsolete=1) | | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1489355#c0)  owl337    2017-09-07 09:21:17 UTC  ``` Created [attachment 1323012](attachment.cgi?id=1323012 "Triggered by  \" ./bson-metrics POC1\"") [[details]](attachment.cgi?id=1323012&action=edit "Triggered by  \" ./bson-metrics POC1\"") Triggered by  " ./bson-metrics POC1"  Description of problem:  There is a heap-buffer-overflow in bson_utf8_validate() function of libbson.   Version-Release number of selected component (if applicable):  <= latest version  How reproducible:  ./bson-metrics POC1  Steps to Reproduce:  The debugging information is as follows:  $ ./bson-metrics POC1  Segmentation fault  ASAN debugging information:  $ ./bson-metrics POC1 ================================================================= ==61994==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x61900000b880 at pc 0x7f1da16706b7 bp 0x7ffe5cc1a480 sp 0x7ffe5cc1a478 READ of size 1 at 0x61900000b880 thread T0     #0 0x7f1da16706b6  (/home/icy/secreal/libbson-asan/install/lib/libbson-1.0.so.0+0xa96b6)     #1 0x7f1da16394cb  (/home/icy/secreal/libbson-asan/install/lib/libbson-1.0.so.0+0x724cb)     #2 0x4dbe3c  (/home/icy/secreal/libbson-asan/install/test/bson-metrics+0x4dbe3c)     #3 0x7f1da06d4abf  (/lib/x86_64-linux-gnu/libc.so.6+0x20abf)     #4 0x435648  (/home/icy/secreal/libbson-asan/install/test/bson-metrics+0x435648)  0x61900000b880 is located 0 bytes to the right of 1024-byte region [0x61900000b480,0x61900000b880) allocated by thread T0 here:     #0 0x4bc78b  (/home/icy/secreal/libbson-asan/install/test/bson-metrics+0x4bc78b)     #1 0x7f1da1662aff  (/home/icy/secreal/libbson-asan/install/lib/libbson-1.0.so.0+0x9baff)  Shadow bytes around the buggy address:   0x0c327fff96c0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c327fff96d0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c327fff96e0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c327fff96f0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c327fff9700: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 =>0x0c327fff9710:[fa]fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c327fff9720: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c327fff9730: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c327fff9740: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c327fff9750: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c327fff9760: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07    Heap left redzone:       fa   Heap right redzone:      fb   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack partial redzone:   f4   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb ==61994==ABORTING  GDB debugging information:  (gdb) set args POC1 (gdb) r ...  Breakpoint 7, bson_utf8_validate (utf8=0x61900000b48e "\006", utf8_len=4294967295, allow_null=<optimized out>)     at src/bson/bson-utf8.c:143 143	      if ((utf8_len - i) < seq_length) { (gdb) c 1007  Will ignore next 1006 crossings of breakpoint 7.  Continuing.  Breakpoint 7, bson_utf8_validate (utf8=0x61900000b48e "\006", utf8_len=4294967295, allow_null=<optimized out>)     at src/bson/bson-utf8.c:143 143	      if ((utf8_len - i) < seq_length) { (gdb) i b Num     Type           Disp Enb Address            What 7       breakpoint     keep y   0x00007ffff7b7e310 in bson_utf8_validate at src/bson/bson-utf8.c:143 	breakpoint already hit 1008 times (gdb) n 151	      c = utf8[i] & first_mask; (gdb)  156	      for (j = i + 1; j < (i + seq_length); j++) { (gdb)  182	      if (c > 0x0010FFFF) { (gdb)  197	      switch (seq_length) { (gdb)  199	         if (c <= 0x007F) { (gdb)  130	   for (i = 0; i < utf8_len; i += seq_length) { (gdb) n ================================================================= ==100494==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x61900000b880 at pc 0x7ffff7b7e6b7 bp 0x7fffffffd800 sp 0x7fffffffd7f8 READ of size 1 at 0x61900000b880 thread T0     #0 0x7ffff7b7e6b6  (/home/icy/secreal/libbson-asan/install/lib/libbson-1.0.so.0+0xa96b6)     #1 0x7ffff7b474cb  (/home/icy/secreal/libbson-asan/install/lib/libbson-1.0.so.0+0x724cb)     #2 0x4dbe3c  (/home/icy/secreal/libbson-asan/install/test/bson-metrics+0x4dbe3c)     #3 0x7ffff6be2abf  (/lib/x86_64-linux-gnu/libc.so.6+0x20abf)     #4 0x435648  (/home/icy/secreal/libbson-asan/install/test/bson-metrics+0x435648)  0x61900000b880 is located 0 bytes to the right of 1024-byte region [0x61900000b480,0x61900000b880) allocated by thread T0 here:     #0 0x4bc78b  (/home/icy/secreal/libbson-asan/install/test/bson-metrics+0x4bc78b)     #1 0x7ffff7b70aff  (/home/icy/secreal/libbson-asan/install/lib/libbson-1.0.so.0+0x9baff)  Shadow bytes around the buggy address:   0x0c327fff96c0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c327fff96d0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c327fff96e0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c327fff96f0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c327fff9700: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 =>0x0c327fff9710:[fa]fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c327fff9720: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c327fff9730: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c327fff9740: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c327fff9750: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c327fff9760: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07    Heap left redzone:       fa   Heap right redzone:      fb   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack partial redzone:   f4   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb ==100494==ABORTING [Inferior 1 (process 100494) exited with code 01]  (gdb) bt  #0  bson_utf8_validate (utf8=0x61900000b48e "\006", utf8_len=4294967295, allow_null=<optimized out>)     at src/bson/bson-utf8.c:143 #1  0x00007ffff7b474cc in bson_iter_visit_all (iter=<optimized out>, visitor=<optimized out>, data=<optimized out>)     at src/bson/bson-iter.c:2069 #2  0x00000000004dbe3d in bson_metrics (data=<optimized out>, bson=<optimized out>, length=<optimized out>)     at bson-metrics.c:208 #3  main (argc=<optimized out>, argv=<optimized out>) at bson-metrics.c:257   This vulnerability was triggered in function bson_utf8_validate() at line src/bson/bson-utf8.c:130:  130	   for (i = 0; i < utf8_len; i += seq_length) { 131	      _bson_utf8_get_sequence (&utf8[i], &seq_length, &first_mask); 132	 133	      /* 134	       * Ensure we have a valid multi-byte sequence length. 135	       */ 136	      if (!seq_length) { 137	         return false; 138	      } 139	 140	      /* 141	       * Ensure we have enough bytes left. 142	       */ 143	      if ((utf8_len - i) < seq_length) { 144	         return false; 145	      } 146	 ...   Actual results:  crash  Expected results:  crash  Additional info:   Credits:  This vulnerability is detected by team OWL337, with our custom fuzzer collAFL. Please contact ganshuitao   and chaoz.cn if you need more info about the team, the tool or the vulnerability.   ```  [Comment 1](show_bug.cgi?id=1489355#c1)  Petr Pisar    2017-09-07 10:35:03 UTC  ``` Thank you for your report. It looks like this issue is not specific to Fedora build and you should report your security findings directly to libbson authors <<https://docs.mongodb.com/manual/tutorial/create-a-vulnerability-report/>> because the root problem is there.   ```  [Comment 2](show_bug.cgi?id=1489355#c2)  Petr Pisar    2017-09-07 12:51:11 UTC  ``` The problem is not in bson_utf8_validate(). The problem is that somebson_iter_codewscope() computes the string length as 4294967295 passes this wrong value to bson_utf8_validate() as the second utf8_len argument.   ```  [Comment 3](show_bug.cgi?id=1489355#c3)  Petr Pisar    2017-09-07 12:58:52 UTC  ``` Created [attachment 1323092](attachment.cgi?id=1323092 "POC1 file input for examples/bson-metrics.c program") [[details]](attachment.cgi?id=1323092&action=edit "POC1 file input for examples/bson-metrics.c program") POC1 file input for examples/bson-metrics.c program  The reproducer runs examples/bson-metrics.c on this attached POC1 file with this content:  $ hexdump -C POC1  00000000  15 00 00 00 0f 00 0e 00  00 00 00 00 00 00 06 00  |................| 00000010  00 00 00 00 00 00 03 e8  88 88 00 00              |............| 0000001c   ```  [Comment 4](show_bug.cgi?id=1489355#c4)  Petr Pisar    2017-09-07 13:09:42 UTC  ``` I can reproduce it with current upstream git code 1.7.0-rc0-24-g3dd28b6.   ```  [Comment 5](show_bug.cgi?id=1489355#c5)  Petr Pisar    2017-09-07 13:11:41 UTC  ``` And also with developmental 1.8.0-rc0 code.   ```  [Comment 6](show_bug.cgi?id=1489355#c6)  Petr Pisar    2017-09-07 13:22:48 UTC  ``` I forwarded it to <<https://jira.mongodb.org/projects/SECURITY/issues/SECURITY-476>>.   ```  [Comment 7](show_bug.cgi?id=1489355#c7)  A. Jesse Jiryu Davis    2017-09-09 14:21:18 UTC  ``` Bugfix in progress, here's a public description:  <https://jira.mongodb.org/browse/CDRIVER-2269>  libbson crashes while iterating over a valid (but strange) BSON input. We'll release the fix next week.   ```  [Comment 8](show_bug.cgi?id=1489355#c8)  Petr Pisar    2017-09-11 08:01:07 UTC  ``` *** [Bug 1489356](show_bug.cgi?id=1489356 "CLOSED DUPLICATE - There is a heap-buffer-overflow in bson_utf8_validate() function of libbson.") has been marked as a duplicate of this bug. ***   ```  [Comment 9](show_bug.cgi?id=1489355#c9)  Petr Pisar    2017-09-15 07:34:23 UTC  ``` *** [Bug 1489362](show_bug.cgi?id=1489362 "CLOSED DUPLICATE - There is a heap-based buffer overflow in bson-to-json.c.") has been marked as a duplicate of this bug. ***   ```  [Comment 10](show_bug.cgi?id=1489355#c10)  Fedora Update System    2017-09-15 09:14:22 UTC  ``` libbson-1.8.0-1.fc27 has been submitted as an update to Fedora 27. <https://bodhi.fedoraproject.org/updates/FEDORA-2017-1953158d1f>   ```  [Comment 11](show_bug.cgi?id=1489355#c11)  Petr Pisar    2017-09-15 09:44:30 UTC  ``` All Fedoras are affected. This is not reproducible with the reporter's sample but it's reproducible with the new tests added together with the fix. I will port it back.   ```  [Comment 12](show_bug.cgi?id=1489355#c12)  Fedora Update System    2017-09-15 11:48:49 UTC  ``` libbson-1.6.3-2.fc26 has been submitted as an update to Fedora 26. <https://bodhi.fedoraproject.org/updates/FEDORA-2017-a4cf96bcca>   ```  [Comment 13](show_bug.cgi?id=1489355#c13)  Fedora Update System    2017-09-15 12:41:42 UTC  ``` libbson-1.3.5-4.fc25 has been submitted as an update to Fedora 25. <https://bodhi.fedoraproject.org/updates/FEDORA-2017-7edc2ea787>   ```  [Comment 14](show_bug.cgi?id=1489355#c14)  Fedora Update System    2017-09-15 16:53:22 UTC  ``` libbson-1.8.0-1.fc27 has been pushed to the Fedora 27 testing repository. If problems still persist, please make note of it in this bug report. See [https://fedoraproject.org/wiki/QA:Updates_Testing](https://fedoraproject.org/wiki/QA%3AUpdates_Testing) for instructions on how to install test updates. You can provide feedback for this update here: <https://bodhi.fedoraproject.org/updates/FEDORA-2017-1953158d1f>   ```  [Comment 15](show_bug.cgi?id=1489355#c15)  Fedora Update System    2017-09-16 04:25:31 UTC  ``` libbson-1.6.3-2.fc26 has been pushed to the Fedora 26 testing repository. If problems still persist, please make note of it in this bug report. See [https://fedoraproject.org/wiki/QA:Updates_Testing](https://fedoraproject.org/wiki/QA%3AUpdates_Testing) for instructions on how to install test updates. You can provide feedback for this update here: <https://bodhi.fedoraproject.org/updates/FEDORA-2017-a4cf96bcca>   ```  [Comment 16](show_bug.cgi?id=1489355#c16)  Fedora Update System    2017-09-16 05:31:14 UTC  ``` libbson-1.3.5-4.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report. See [https://fedoraproject.org/wiki/QA:Updates_Testing](https://fedoraproject.org/wiki/QA%3AUpdates_Testing) for instructions on how to install test updates. You can provide feedback for this update here: <https://bodhi.fedoraproject.org/updates/FEDORA-2017-7edc2ea787>   ```  [Comment 17](show_bug.cgi?id=1489355#c17)  Fedora Update System    2017-09-26 23:54:38 UTC  ``` libbson-1.6.3-2.fc26 has been pushed to the Fedora 26 stable repository. If problems still persist, please make note of it in this bug report.   ```  [Comment 18](show_bug.cgi?id=1489355#c18)  Fedora Update System    2017-09-27 05:27:25 UTC  ``` libbson-1.3.5-4.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.   ```  [Comment 19](show_bug.cgi?id=1489355#c19)  Fedora Update System    2017-09-30 06:31:17 UTC  ``` libbson-1.8.0-1.fc27 has been pushed to the Fedora 27 stable repository. If problems still persist, please make note of it in this bug report.   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1489355&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)


