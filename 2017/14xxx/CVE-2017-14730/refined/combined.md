=== Content from github.com_1a98f58f_20250125_080322.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgentoo%2Fgentoo%2Fpull%2F5665)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgentoo%2Fgentoo%2Fpull%2F5665)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=gentoo%2Fgentoo)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[gentoo](/gentoo)
/
**[gentoo](/gentoo/gentoo)**
Public

* [Notifications](/login?return_to=%2Fgentoo%2Fgentoo) You must be signed in to change notification settings
* [Fork
  2.1k](/login?return_to=%2Fgentoo%2Fgentoo)
* [Star
   2.1k](/login?return_to=%2Fgentoo%2Fgentoo)

* [Code](/gentoo/gentoo)
* [Pull requests
  900](/gentoo/gentoo/pulls)
* [Actions](/gentoo/gentoo/actions)
* [Projects
  0](/gentoo/gentoo/projects)
* [Security](/gentoo/gentoo/security)
* [Insights](/gentoo/gentoo/pulse)

Additional navigation options

* [Code](/gentoo/gentoo)
* [Pull requests](/gentoo/gentoo/pulls)
* [Actions](/gentoo/gentoo/actions)
* [Projects](/gentoo/gentoo/projects)
* [Security](/gentoo/gentoo/security)
* [Insights](/gentoo/gentoo/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fgentoo%2Fgentoo%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fgentoo%2Fgentoo%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# app-admin/logstash-bin: bump to 5.5.3/5.6.1, drop old #5665

 Closed

[hydrapolic](/hydrapolic)
wants to merge
2
commits into
[gentoo:master](/gentoo/gentoo/tree/master "gentoo/gentoo:master")
from
[hydrapolic:logstash](/hydrapolic/gentoo-1/tree/logstash "hydrapolic/gentoo-1:logstash")

 Closed

# [app-admin/logstash-bin: bump to 5.5.3/5.6.1, drop old](#top) #5665

[hydrapolic](/hydrapolic)
wants to merge
2
commits into
[gentoo:master](/gentoo/gentoo/tree/master "gentoo/gentoo:master")
from
[hydrapolic:logstash](/hydrapolic/gentoo-1/tree/logstash "hydrapolic/gentoo-1:logstash")

[Conversation
12](/gentoo/gentoo/pull/5665)
[Commits
2](/gentoo/gentoo/pull/5665/commits)
[Checks
0](/gentoo/gentoo/pull/5665/checks)
[Files changed](/gentoo/gentoo/pull/5665/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![hydrapolic](https://avatars.githubusercontent.com/u/3277373?s=60&v=4)](/hydrapolic)

Copy link

Contributor

### @hydrapolic **[hydrapolic](/hydrapolic)** commented [Sep 8, 2017](#issue-256232295)

 *No description provided.*

Sorry, something went wrong.

All reactions

[![@gentoo-repo-qa-bot](https://avatars.githubusercontent.com/u/12962539?s=40&u=173a589236873ee92f8074bb3a38b184a834420f&v=4)](/gentoo-repo-qa-bot)
[gentoo-repo-qa-bot](/gentoo-repo-qa-bot)
added
[self-maintained](/gentoo/gentoo/labels/self-maintained)
The PR changes only packages that are maintained by the submitter (i.e. no need to ask anybody else)
[assigned](/gentoo/gentoo/labels/assigned)
PR successfully assigned to the package maintainer(s).
labels
[Sep 8, 2017](#event-1240684294)

[![@gentoo-repo-qa-bot](https://avatars.githubusercontent.com/u/12962539?s=80&u=173a589236873ee92f8074bb3a38b184a834420f&v=4)](/gentoo-repo-qa-bot)

Copy link

Collaborator

### **[gentoo-repo-qa-bot](/gentoo-repo-qa-bot)** commented [Sep 8, 2017](#issuecomment-328088104)

| Pull Request assignment  *Areas affected*: ebuilds *Packages affected*: app-admin/logstash-bin  **app-admin/logstash-bin**: [@hydrapolic](https://github.com/hydrapolic), ~~erkiferenc[at]gmail.com~~, @gentoo/proxy-maint |
| --- |

All reactions

Sorry, something went wrong.

[![@ferki](https://avatars.githubusercontent.com/u/3117609?s=80&v=4)](/ferki)

Copy link

Contributor

### **[ferki](/ferki)** commented [Sep 8, 2017](#issuecomment-328111434)

| Nice, thanks!  Couple of quick questions (without testing these cases out yet):   1. Would the move of the pidfile interfere with shutting down an already running instance? (Also, should existing users remove the old pidfile dir?) 2. Should users move the data they may already have in `/opt/logstash/data`?   I *guess* it might be enough to just notify the users on upgrade, to make sure they can check if they need clean up and/or move data properly (on first install these doesn't seem to matter). |
| --- |

All reactions

Sorry, something went wrong.

[![@hydrapolic](https://avatars.githubusercontent.com/u/3277373?s=80&u=7962c00063408bda48b9ec230d323d8c5b26a9ee&v=4)](/hydrapolic)

Copy link

Contributor

Author

### **[hydrapolic](/hydrapolic)** commented [Sep 10, 2017](#issuecomment-328321493) ‚Ä¢ edited Loading

| 1. Yes, the logstash instance will not stop and the user will notice as he will not be able to start a new one. But I do suppose the Gentoo users are smart enough to find the old process and kill it (there will be a hint in the log "already running"). The old piddir will disappear after the reboot, so no action is needed. 2. I only run two instances of logstash, but haven't found anything valuable in the data directory - only the uuid that is generated automatically.   But I'm also fine by adding a note for those that are upgrading. |
| --- |

 üëç
1
 ferki reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@ferki](https://avatars.githubusercontent.com/u/3117609?s=80&v=4)](/ferki)

Copy link

Contributor

### **[ferki](/ferki)** commented [Sep 18, 2017](#issuecomment-330293062) ‚Ä¢ edited Loading

| I believe the data directory mostly (only?) used for the persistent queue, which might be important during non-normal operation (e.g. abnormal pipeline termination, or similar), that might happen after moving the pidfile, and killing the process forcefully (see [Shutting Down Logstash](https://www.elastic.co/guide/en/logstash/5.5/shutdown.html)).  Other use case for the persistent queues is to provide buffering during bursts and/or when the delivery is slower than the incoming amount of logs. So normally there's no data, but if there is something, then it is most probably important (and need to be picked up by the new process).  I also think Gentoo users who are using persistent queues are also able to shut down the old instance properly, and check if there's any data to be moved. Though after thinking a lot about this, I'd say the ebuild should at least remind the user about these, as I'm afraid it can lead to a potential data loss. Something along the lines of:  ``` The default pidfile directory has been changed from /run/logstash to /run. Please ensure any running logstash processes are shut down cleanly. The default data directory has been moved from /opt/logstash/data to /var/lib/logstash/data. Please check and move its contents as necessary.  ```  Maybe I'm just overly cautious :) |
| --- |

All reactions

Sorry, something went wrong.

[![@hydrapolic](https://avatars.githubusercontent.com/u/3277373?s=80&u=7962c00063408bda48b9ec230d323d8c5b26a9ee&v=4)](/hydrapolic)

Copy link

Contributor

Author

### **[hydrapolic](/hydrapolic)** commented [Sep 19, 2017](#issuecomment-330501539)

| Yeah, that sounds reasonable [@ferki](https://github.com/ferki). I'll add it to the PR and bump to 5.5.3 instead.  Thanks! |
| --- |

 üëç
1
 ferki reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

 [![@hydrapolic](https://avatars.githubusercontent.com/u/3277373?s=40&u=7962c00063408bda48b9ec230d323d8c5b26a9ee&v=4)](/hydrapolic)
[hydrapolic](/hydrapolic)
[force-pushed](/gentoo/gentoo/compare/801005e605f409c989d037a61b5f46d05f85579b..9df19ef2e03997ca0dadad31b5681e75b8496ccb)
the
logstash

branch
from
[`801005e`](/gentoo/gentoo/commit/801005e605f409c989d037a61b5f46d05f85579b) to
[`9df19ef`](/gentoo/gentoo/commit/9df19ef2e03997ca0dadad31b5681e75b8496ccb)  [Compare](/gentoo/gentoo/compare/801005e605f409c989d037a61b5f46d05f85579b..9df19ef2e03997ca0dadad31b5681e75b8496ccb)
[September 20, 2017 13:53](#event-1257479843)

[![@hydrapolic](https://avatars.githubusercontent.com/u/3277373?s=40&u=7962c00063408bda48b9ec230d323d8c5b26a9ee&v=4)](/hydrapolic)
[hydrapolic](/hydrapolic)
changed the title
~~app-admin/logstash-bin: bump to 5.5.2, drop old~~
app-admin/logstash-bin: bump to 5.5.3, drop old
[Sep 20, 2017](#event-1257481128)

[![@hydrapolic](https://avatars.githubusercontent.com/u/3277373?s=80&u=7962c00063408bda48b9ec230d323d8c5b26a9ee&v=4)](/hydrapolic)

Copy link

Contributor

Author

### **[hydrapolic](/hydrapolic)** commented [Sep 20, 2017](#issuecomment-330858952)

| [@ferki](https://github.com/ferki) [@orlitzky](https://github.com/orlitzky), ok with this PR? |
| --- |

All reactions

Sorry, something went wrong.

[![@ferki](https://avatars.githubusercontent.com/u/3117609?s=80&v=4)](/ferki)

Copy link

Contributor

### **[ferki](/ferki)** commented [Sep 21, 2017](#issuecomment-331053669)

| [@hydrapolic](https://github.com/hydrapolic): for me, it looks working correctly and as intended üëç |
| --- |

 üëç
1
 hydrapolic reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@orlitzky](https://avatars.githubusercontent.com/u/1432135?s=80&v=4)](/orlitzky)

Copy link

Contributor

### **[orlitzky](/orlitzky)** commented [Sep 21, 2017](#issuecomment-331210450)

| Personally I would remove `LS_PIDFILE` from the conf.d file and just set `pidfile="/run/${RC_SVCNAME}.pid"` (which will be unique, because the service name is). That way no one can try to change the PID file location and cause themselves problems. But the vulnerability is fixed, so it's good by me. |
| --- |

All reactions

Sorry, something went wrong.

[![@hydrapolic](https://avatars.githubusercontent.com/u/3277373?s=80&u=7962c00063408bda48b9ec230d323d8c5b26a9ee&v=4)](/hydrapolic)

Copy link

Contributor

Author

### **[hydrapolic](/hydrapolic)** commented [Sep 25, 2017](#issuecomment-331805634)

| Yes that's a good point, I'll make it so. |
| --- |

All reactions

Sorry, something went wrong.

 [hydrapolic](/hydrapolic)
added 2 commits
[September 25, 2017 10:19](#commits-pushed-cb03b3b)

[![@hydrapolic](https://avatars.githubusercontent.com/u/3277373?s=40&v=4)](/hydrapolic)

`[app-admin/logstash-bin: bump to 5.5.3/5.6.1](/gentoo/gentoo/pull/5665/commits/cb03b3b25115459f9eb551b8190622fa00e5a9fb "app-admin/logstash-bin: bump to 5.5.3/5.6.1

Package-Manager: Portage-2.3.10, Repoman-2.3.3")`
 ‚Ä¶

`[cb03b3b](/gentoo/gentoo/pull/5665/commits/cb03b3b25115459f9eb551b8190622fa00e5a9fb)`

```
Package-Manager: Portage-2.3.10, Repoman-2.3.3
```

[![@hydrapolic](https://avatars.githubusercontent.com/u/3277373?s=40&v=4)](/hydrapolic)

`[app-admin/logstash-bin: drop old](/gentoo/gentoo/pull/5665/commits/969be735e83056711723d978399ef0e45d48f675 "app-admin/logstash-bin: drop old

Package-Manager: Portage-2.3.10, Repoman-2.3.3")`
 ‚Ä¶

`[969be73](/gentoo/gentoo/pull/5665/commits/969be735e83056711723d978399ef0e45d48f675)`

```
Package-Manager: Portage-2.3.10, Repoman-2.3.3
```

 [![@hydrapolic](https://avatars.githubusercontent.com/u/3277373?s=40&u=7962c00063408bda48b9ec230d323d8c5b26a9ee&v=4)](/hydrapolic)
[hydrapolic](/hydrapolic)
[force-pushed](/gentoo/gentoo/compare/9df19ef2e03997ca0dadad31b5681e75b8496ccb..969be735e83056711723d978399ef0e45d48f675)
the
logstash

branch
from
[`9df19ef`](/gentoo/gentoo/commit/9df19ef2e03997ca0dadad31b5681e75b8496ccb) to
[`969be73`](/gentoo/gentoo/commit/969be735e83056711723d978399ef0e45d48f675)  [Compare](/gentoo/gentoo/compare/9df19ef2e03997ca0dadad31b5681e75b8496ccb..969be735e83056711723d978399ef0e45d48f675)
[September 25, 2017 08:20](#event-1263207291)

[![@hydrapolic](https://avatars.githubusercontent.com/u/3277373?s=40&u=7962c00063408bda48b9ec230d323d8c5b26a9ee&v=4)](/hydrapolic)
[hydrapolic](/hydrapolic)
changed the title
~~app-admin/logstash-bin: bump to 5.5.3, drop old~~
app-admin/logstash-bin: bump to 5.5.3/5.6.1, drop old
[Sep 25, 2017](#event-1263207496)

[![@gentoo-repo-qa-bot](https://avatars.githubusercontent.com/u/12962539?s=80&u=173a589236873ee92f8074bb3a38b184a834420f&v=4)](/gentoo-repo-qa-bot)

Copy link

Collaborator

### **[gentoo-repo-qa-bot](/gentoo-repo-qa-bot)** commented [Sep 25, 2017](#issuecomment-331813975)

| üëç All QA issues have been fixed! |
| --- |

All reactions

Sorry, something went wrong.

[![@orlitzky](https://avatars.githubusercontent.com/u/1432135?s=80&v=4)](/orlitzky)

Copy link

Contributor

### **[orlitzky](/orlitzky)** commented [Sep 25, 2017](#issuecomment-331853205)

| Pulled, thank you! |
| --- |

All reactions

Sorry, something went wrong.

[![@orlitzky](https://avatars.githubusercontent.com/u/1432135?s=40&v=4)](/orlitzky)
[orlitzky](/orlitzky)
closed this
[Sep 25, 2017](#event-1263506103)

[![@hydrapolic](https://avatars.githubusercontent.com/u/3277373?s=80&u=7962c00063408bda48b9ec230d323d8c5b26a9ee&v=4)](/hydrapolic)

Copy link

Contributor

Author

### **[hydrapolic](/hydrapolic)** commented [Sep 25, 2017](#issuecomment-331856423)

| Thanks [@orlitzky](https://github.com/orlitzky) and [@ferki](https://github.com/ferki). |
| --- |

All reactions

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fgentoo%2Fgentoo%2Fpull%2F5665)

Reviewers

No reviews

Assignees

No one assigned

Labels

[assigned](/gentoo/gentoo/labels/assigned)
PR successfully assigned to the package maintainer(s).
[self-maintained](/gentoo/gentoo/labels/self-maintained)
The PR changes only packages that are maintained by the submitter (i.e. no need to ask anybody else)

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

4 participants

[![@hydrapolic](https://avatars.githubusercontent.com/u/3277373?s=52&v=4)](/hydrapolic) [![@gentoo-repo-qa-bot](https://avatars.githubusercontent.com/u/12962539?s=52&v=4)](/gentoo-repo-qa-bot) [![@ferki](https://avatars.githubusercontent.com/u/3117609?s=52&v=4)](/ferki) [![@orlitzky](https://avatars.githubusercontent.com/u/1432135?s=52&v=4)](/orlitzky)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from gitweb.gentoo.org_4f614149_20250125_080324.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
GitWeb

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Gentoo Repository](/repo/gentoo.git)
* [Repositories](/repo/)
* [Projects](/proj/)
* [Developer Overlays](/dev/)
* [User Overlays](/user/)
* [Data](/data/)
* [Websites](/sites/)

| [cgit logo](/) | [index](/) : [repo/gentoo.git](/repo/gentoo.git/) | master |
| --- | --- | --- |
| Official Gentoo ebuild repository | Infrastructure team <infrastructure@gentoo.org> |

| [summary](/repo/gentoo.git/)[refs](/repo/gentoo.git/refs/?id=bbd6cb398c1740c68e9b1b78340c887c58c1fbda)[log](/repo/gentoo.git/log/)[tree](/repo/gentoo.git/tree/?id=bbd6cb398c1740c68e9b1b78340c887c58c1fbda)[commit](/repo/gentoo.git/commit/?id=bbd6cb398c1740c68e9b1b78340c887c58c1fbda)[diff](/repo/gentoo.git/diff/?id=bbd6cb398c1740c68e9b1b78340c887c58c1fbda) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Tomas Mozes <hydrapolic@gmail.com> | 2017-09-25 10:19:20 +0200 |
| --- | --- | --- |
| committer | Michael Orlitzky <mjo@gentoo.org> | 2017-09-25 07:27:24 -0400 |
| commit | [bbd6cb398c1740c68e9b1b78340c887c58c1fbda](/repo/gentoo.git/commit/?id=bbd6cb398c1740c68e9b1b78340c887c58c1fbda) ([patch](/repo/gentoo.git/patch/?id=bbd6cb398c1740c68e9b1b78340c887c58c1fbda)) | |
| tree | [7b8d2ae7a867204bea9d0d36907b623880f7d745](/repo/gentoo.git/tree/?id=bbd6cb398c1740c68e9b1b78340c887c58c1fbda) | |
| parent | [sci-geosciences/gpsbabel: Fix build with Qt-5.9 again](/repo/gentoo.git/commit/?id=52f7b74352b325b3980c4922e980701066c79a18) ([diff](/repo/gentoo.git/diff/?id=bbd6cb398c1740c68e9b1b78340c887c58c1fbda&id2=52f7b74352b325b3980c4922e980701066c79a18)) | |
| download | [gentoo-bbd6cb398c1740c68e9b1b78340c887c58c1fbda.tar.gz](/repo/gentoo.git/snapshot/gentoo-bbd6cb398c1740c68e9b1b78340c887c58c1fbda.tar.gz)[gentoo-bbd6cb398c1740c68e9b1b78340c887c58c1fbda.tar.bz2](/repo/gentoo.git/snapshot/gentoo-bbd6cb398c1740c68e9b1b78340c887c58c1fbda.tar.bz2)[gentoo-bbd6cb398c1740c68e9b1b78340c887c58c1fbda.zip](/repo/gentoo.git/snapshot/gentoo-bbd6cb398c1740c68e9b1b78340c887c58c1fbda.zip) | |

app-admin/logstash-bin: bump to 5.5.3/5.6.1Package-Manager: Portage-2.3.10, Repoman-2.3.3
Signed-off-by: Michael Orlitzky <mjo@gentoo.org>
[Diffstat](/repo/gentoo.git/diff/?id=bbd6cb398c1740c68e9b1b78340c887c58c1fbda)

| -rw-r--r-- | [app-admin/logstash-bin/Manifest](/repo/gentoo.git/diff/app-admin/logstash-bin/Manifest?id=bbd6cb398c1740c68e9b1b78340c887c58c1fbda) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [app-admin/logstash-bin/files/logstash.confd](/repo/gentoo.git/diff/app-admin/logstash-bin/files/logstash.confd?id=bbd6cb398c1740c68e9b1b78340c887c58c1fbda) | 6 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [app-admin/logstash-bin/files/logstash.initd](/repo/gentoo.git/diff/app-admin/logstash-bin/files/logstash.initd?id=bbd6cb398c1740c68e9b1b78340c887c58c1fbda) | 11 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [app-admin/logstash-bin/logstash-bin-5.5.3.ebuild](/repo/gentoo.git/diff/app-admin/logstash-bin/logstash-bin-5.5.3.ebuild?id=bbd6cb398c1740c68e9b1b78340c887c58c1fbda) | 75 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [app-admin/logstash-bin/logstash-bin-5.6.1.ebuild](/repo/gentoo.git/diff/app-admin/logstash-bin/logstash-bin-5.6.1.ebuild?id=bbd6cb398c1740c68e9b1b78340c887c58c1fbda) | 75 | |  |  |  | | --- | --- | --- | |

5 files changed, 160 insertions, 9 deletions

| diff --git a/app-admin/logstash-bin/Manifest b/app-admin/logstash-bin/Manifestindex 88779e69bfe5..5988e838aaee 100644--- a/[app-admin/logstash-bin/Manifest](/repo/gentoo.git/tree/app-admin/logstash-bin/Manifest?id=52f7b74352b325b3980c4922e980701066c79a18)+++ b/[app-admin/logstash-bin/Manifest](/repo/gentoo.git/tree/app-admin/logstash-bin/Manifest?id=bbd6cb398c1740c68e9b1b78340c887c58c1fbda)@@ -1,3 +1,5 @@ DIST logstash-5.2.2.zip 100068713 SHA256 35bd0378f5b9001b4c3056b11496936ef47c09e3ddc469353bc8951e3b81e174 SHA512 923b35e8bcc97f6036cd4a484df546b2cc1341ec8fe5080bea8f979856086aaaae5f71fa0c3f7aee2207f7c3e71aec18af416278123362f89990c05ec9e2c92f WHIRLPOOL 4a67ed0ba3b532da5d488b2e45f53149b4e63b6b638b6fe1058a13eab904cb7ec24cd87306868a4770fe6aadfe13f7d76bfc9973e73104a8e4e9aee455321c32 DIST logstash-5.3.2.zip 100247384 SHA256 b0dfe9295c86dc4efbc1b0884c8078fd414e2e96480c3b513b2a92dab47cb505 SHA512 c150a3076b035204677275081267ac781b34d7abd1e93214cf79d73c326afb58b24ebd91453dd6fb7ba3157cb28de9b319e077e07e4b0cb3db939b99174b130b WHIRLPOOL 83d8b347266e0846b2967b6c11c6615dd3a438d8eaf5dbe057caf7569a6f64ff39a352b56b9ef9127d045d7a37d484a5a09130961cbe190946d7f1b52a66251a DIST logstash-5.4.3.zip 100434357 SHA256 074f46832c823775c10e662ddbe8007ce19790591aeb617f351a998f9adc5c9a SHA512 036667b9209bdc7ddb3e1c979bfe059b2aa6021c1efb4db0a2eeef0b3adec6f6dd1c2a326da2447abd31f40fbeddda50d495cc936b0c23e0ad541a6e8ac40048 WHIRLPOOL ff691031d7e4083491d7448867defc10f3bbe0a10f47194df3444fcf71baa0b8f133d4b0791b0837673130be078b425f8722a7e7b177c07fdd5968c94adfddba+DIST logstash-5.5.3.zip 99551442 SHA256 f81ff55feb21ff4edd4283938ac8362c2906d98f9427d8660dab8465e08f0da9 SHA512 a4328ad0b8192b7c5aaed155d608d9db6adeaefd640e461ef4467daa1a28a2ae25d6b2b1adcf47c5dd82b66fc1adbf8ba5f3eabcf7e69dd8719a5860795877aa WHIRLPOOL d3482df4a7729f6b34973816e39315c69254a641e9811131d7d5e12ede54003a326c5773e799ee471dda01a6113762919ea81ab56ede62d29221f63ed5a7f8c7+DIST logstash-5.6.1.zip 107893345 SHA256 a484176009af9f9a526360a529e2777e18a8928b50a223bb0823bfa45da958c6 SHA512 d2ddc62e14013ed69e2666cb3831bec2cd22f5bcdb147ec431fe1effa64bcb4f8feb2ea77a1c0b43deefeec9a502effe1975a2061c632c57b58b36b5010cb17d WHIRLPOOL f430a452b815e44147bf22b6ed7ab1df01cfe27ec44f2f38007127899cb7408d626f2090efba2ebddd22fd95731ed8df971d3e7793c35b174681ecbb02914ba3diff --git a/app-admin/logstash-bin/files/logstash.confd b/app-admin/logstash-bin/files/logstash.confdindex dd861d0633f3..6dbbe627a5ad 100644--- a/[app-admin/logstash-bin/files/logstash.confd](/repo/gentoo.git/tree/app-admin/logstash-bin/files/logstash.confd?id=52f7b74352b325b3980c4922e980701066c79a18)+++ b/[app-admin/logstash-bin/files/logstash.confd](/repo/gentoo.git/tree/app-admin/logstash-bin/files/logstash.confd?id=bbd6cb398c1740c68e9b1b78340c887c58c1fbda)@@ -5,6 +5,9 @@ # Set a home directory #LS\_HOME=/var/lib/logstash +# Set data directory+#LS\_DATA\_DIR=${LS\_HOME}/data+ # Arguments to pass to logstash agent #LS\_OPTS="" @@ -12,9 +15,6 @@ #LS\_HEAP\_SIZE="500m" #LS\_JAVA\_OPTS="-Djava.io.tmpdir=$HOME" -# pidfiles location-#LS\_PIDFILE=/run/logstash/logstash.pid- # user id to be invoked as #LS\_USER=logstash #LS\_GROUP=logstashdiff --git a/app-admin/logstash-bin/files/logstash.initd b/app-admin/logstash-bin/files/logstash.initdindex 0a0f7ad11b8b..2133421377d6 100644--- a/[app-admin/logstash-bin/files/logstash.initd](/repo/gentoo.git/tree/app-admin/logstash-bin/files/logstash.initd?id=52f7b74352b325b3980c4922e980701066c79a18)+++ b/[app-admin/logstash-bin/files/logstash.initd](/repo/gentoo.git/tree/app-admin/logstash-bin/files/logstash.initd?id=bbd6cb398c1740c68e9b1b78340c887c58c1fbda)@@ -7,6 +7,7 @@ LS\_GROUP=${LS\_GROUP:-$LS\_USER} LS\_LOG\_DIR=${LS\_LOG\_DIR:-/var/log/logstash} LS\_CONF\_DIR=${LS\_CONF\_DIR:-/etc/logstash/conf.d} LS\_HOME=${LS\_HOME:-/var/lib/logstash}+LS\_DATA\_DIR=${LS\_DATA\_DIR:-$LS\_HOME/data} LS\_HEAP\_SIZE=${LS\_HEAP\_SIZE:-500m} LS\_NICE=${LS\_NICE:-19} LS\_JAVA\_OPTS=${LS\_JAVA\_OPTS:-"-Djava.io.tmpdir=${LS\_HOME}"}@@ -17,9 +18,9 @@ KILL\_ON\_STOP\_TIMEOUT=${KILL\_ON\_STOP\_TIMEOUT:-0} LS\_INSTALL\_DIR="/opt/logstash"  command="${LS\_INSTALL\_DIR}/bin/logstash"-command\_args="--path.config ${LS\_CONF\_DIR} --path.logs ${LS\_LOG\_DIR} ${LS\_OPTS}"+command\_args="--path.config ${LS\_CONF\_DIR} --path.logs ${LS\_LOG\_DIR} --path.data ${LS\_DATA\_DIR} ${LS\_OPTS}" command\_background="true"-pidfile=${LS\_PIDFILE:-"/run/logstash/logstash.pid"}+pidfile="/run/${RC\_SVCNAME}.pid"  start\_stop\_daemon\_args="--user ${LS\_USER}:${LS\_GROUP} \ --chdir ${LS\_HOME}@@ -38,7 +39,7 @@ checkconfig() { fi  ebegin "Checking your configuration"- ${command} ${command\_args} --config.test\_and\_exit+ ${command} ${command\_args} --path.logs "${LS\_LOG\_DIR}/configcheck" --config.test\_and\_exit eend $? "Configuration error. Please fix your configuration files." } @@ -55,11 +56,9 @@ start\_pre() { rc\_ulimit="-n ${LS\_OPEN\_FILES}"  local d- for d in "${LS\_INSTALL\_DIR}/data" "$(dirname "${pidfile}")" "${LS\_LOG\_DIR}"; do+ for d in "${LS\_HOME}" "${LS\_DATA\_DIR}" "${LS\_DATA\_DIR}/queue" "${LS\_DATA\_DIR}/dead\_letter\_queue" "${LS\_LOG\_DIR}"; do checkpath -d -o "${LS\_USER}":"${LS\_GROUP}" -m750 "$d"- chown -R "${LS\_USER}":"${LS\_GROUP}" "$d" done- }  stop() {diff --git a/app-admin/logstash-bin/logstash-bin-5.5.3.ebuild b/app-admin/logstash-bin/logstash-bin-5.5.3.ebuildnew file mode 100644index 000000000000..0c945e550909--- /dev/null+++ b/[app-admin/logstash-bin/logstash-bin-5.5.3.ebuild](/repo/gentoo.git/tree/app-admin/logstash-bin/logstash-bin-5.5.3.ebuild?id=bbd6cb398c1740c68e9b1b78340c887c58c1fbda)@@ -0,0 +1,75 @@+# Copyright 1999-2017 Gentoo Foundation+# Distributed under the terms of the GNU General Public License v2++EAPI=6++inherit user++MY\_PN="${PN%-bin}"+MY\_P="${MY\_PN}-${PV}"++DESCRIPTION="Tool for managing events and logs"+HOMEPAGE="https://www.elastic.co/products/logstash"+SRC\_URI="https://artifacts.elastic.co/downloads/${MY\_PN}/${MY\_P}.zip"++# source: LICENSE.txt and NOTICE.txt+LICENSE="Apache-2.0 MIT"+SLOT="0"+KEYWORDS="~amd64"++RESTRICT="strip"+QA\_PREBUILT="opt/logstash/vendor/jruby/lib/jni/\*/libjffi\*.so"++RDEPEND="virtual/jre:1.8"++S="${WORKDIR}/${MY\_P}"++pkg\_setup() {+ enewgroup ${MY\_PN}+ enewuser ${MY\_PN} -1 -1 /var/lib/${MY\_PN} ${MY\_PN}+}++src\_install() {+ keepdir /etc/"${MY\_PN}"/{conf.d,patterns,plugins}+ keepdir "/var/lib/${MY\_PN}"+ keepdir "/var/log/${MY\_PN}"++ insinto "/usr/share/${MY\_PN}"+ newins "${FILESDIR}/agent.conf.sample" agent.conf++ insinto "/opt/${MY\_PN}"+ doins -r .+ fperms 0755 "/opt/${MY\_PN}/bin/${MY\_PN}" "/opt/${MY\_PN}/vendor/jruby/bin/jruby" "/opt/${MY\_PN}/bin/logstash-plugin"++ insinto /etc/logrotate.d+ newins "${FILESDIR}/${MY\_PN}.logrotate" "${MY\_PN}"++ newconfd "${FILESDIR}/${MY\_PN}.confd" "${MY\_PN}"+ newinitd "${FILESDIR}/${MY\_PN}.initd" "${MY\_PN}"++ insinto /usr/share/eselect/modules+ doins "${FILESDIR}"/logstash-plugin.eselect+}++pkg\_postinst() {+ ewarn "The default pidfile directory has been changed from /run/logstash to /run."+ ewarn "Please ensure any running logstash processes are shut down cleanly."+ ewarn+ ewarn "The default data directory has been moved from /opt/logstash/data to"+ ewarn "/var/lib/logstash/data. Please check and move its contents as necessary."+ ewarn+ ewarn "Self installed plugins are removed during Logstash upgrades (Bug #622602)"+ ewarn "Install the plugins via eselect module that will automatically re-install"+ ewarn "all self installed plugins after Logstash upgrades."+ einfo+ einfo "Installing plugins:"+ einfo "eselect logstash-plugin install logstash-output-gelf"+ einfo++ einfo "Reinstalling self installed plugins (installed via eselect module):"+ eselect logstash-plugin reinstall++ einfo+ einfo "Sample configuration:"+ einfo "${EROOT%/}/usr/share/${MY\_PN}"+}diff --git a/app-admin/logstash-bin/logstash-bin-5.6.1.ebuild b/app-admin/logstash-bin/logstash-bin-5.6.1.ebuildnew file mode 100644index 000000000000..0c945e550909--- /dev/null+++ b/[app-admin/logstash-bin/logstash-bin-5.6.1.ebuild](/repo/gentoo.git/tree/app-admin/logstash-bin/logstash-bin-5.6.1.ebuild?id=bbd6cb398c1740c68e9b1b78340c887c58c1fbda)@@ -0,0 +1,75 @@+# Copyright 1999-2017 Gentoo Foundation+# Distributed under the terms of the GNU General Public License v2++EAPI=6++inherit user++MY\_PN="${PN%-bin}"+MY\_P="${MY\_PN}-${PV}"++DESCRIPTION="Tool for managing events and logs"+HOMEPAGE="https://www.elastic.co/products/logstash"+SRC\_URI="https://artifacts.elastic.co/downloads/${MY\_PN}/${MY\_P}.zip"++# source: LICENSE.txt and NOTICE.txt+LICENSE="Apache-2.0 MIT"+SLOT="0"+KEYWORDS="~amd64"++RESTRICT="strip"+QA\_PREBUILT="opt/logstash/vendor/jruby/lib/jni/\*/libjffi\*.so"++RDEPEND="virtual/jre:1.8"++S="${WORKDIR}/${MY\_P}"++pkg\_setup() {+ enewgroup ${MY\_PN}+ enewuser ${MY\_PN} -1 -1 /var/lib/${MY\_PN} ${MY\_PN}+}++src\_install() {+ keepdir /etc/"${MY\_PN}"/{conf.d,patterns,plugins}+ keepdir "/var/lib/${MY\_PN}"+ keepdir "/var/log/${MY\_PN}"++ insinto "/usr/share/${MY\_PN}"+ newins "${FILESDIR}/agent.conf.sample" agent.conf++ insinto "/opt/${MY\_PN}"+ doins -r .+ fperms 0755 "/opt/${MY\_PN}/bin/${MY\_PN}" "/opt/${MY\_PN}/vendor/jruby/bin/jruby" "/opt/${MY\_PN}/bin/logstash-plugin"++ insinto /etc/logrotate.d+ newins "${FILESDIR}/${MY\_PN}.logrotate" "${MY\_PN}"++ newconfd "${FILESDIR}/${MY\_PN}.confd" "${MY\_PN}"+ newinitd "${FILESDIR}/${MY\_PN}.initd" "${MY\_PN}"++ insinto /usr/share/eselect/modules+ doins "${FILESDIR}"/logstash-plugin.eselect+}++pkg\_postinst() {+ ewarn "The default pidfile directory has been changed from /run/logstash to /run."+ ewarn "Please ensure any running logstash processes are shut down cleanly."+ ewarn+ ewarn "The default data directory has been moved from /opt/logstash/data to"+ ewarn "/var/lib/logstash/data. Please check and move its contents as necessary."+ ewarn+ ewarn "Self installed plugins are removed during Logstash upgrades (Bug #622602)"+ ewarn "Install the plugins via eselect module that will automatically re-install"+ ewarn "all self installed plugins after Logstash upgrades."+ einfo+ einfo "Installing plugins:"+ einfo "eselect logstash-plugin install logstash-output-gelf"+ einfo++ einfo "Reinstalling self installed plugins (installed via eselect module):"+ eselect logstash-plugin reinstall++ einfo+ einfo "Sample configuration:"+ einfo "${EROOT%/}/usr/share/${MY\_PN}"+} |
| --- |

### Questions or comments?

Please feel free to [contact us](https://www.gentoo.org/inside-gentoo/contact/).

**¬© 2001‚Äì2024 Gentoo Authors**

Gentoo is a trademark of the Gentoo Foundation, Inc. and of F√∂rderverein Gentoo e.V.
The contents of this document, unless otherwise expressly stated, are licensed under the
[CC-BY-SA-4.0](https://creativecommons.org/licenses/by-sa/4.0/) license.
The [Gentoo Name and Logo Usage Guidelines](https://www.gentoo.org/inside-gentoo/foundation/name-logo-guidelines.html) apply.



=== Content from gitweb.gentoo.org_46855a3d_20250125_080323.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
GitWeb

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Gentoo Repository](/repo/gentoo.git)
* [Repositories](/repo/)
* [Projects](/proj/)
* [Developer Overlays](/dev/)
* [User Overlays](/user/)
* [Data](/data/)
* [Websites](/sites/)

| [cgit logo](/) | [index](/) : [repo/gentoo.git](/repo/gentoo.git/) | master |
| --- | --- | --- |
| Official Gentoo ebuild repository | Infrastructure team <infrastructure@gentoo.org> |

| [summary](/repo/gentoo.git/)[refs](/repo/gentoo.git/refs/?id=18f97c851c209f291b31ae7a902719f1c17c79fa)[log](/repo/gentoo.git/log/)[tree](/repo/gentoo.git/tree/?id=18f97c851c209f291b31ae7a902719f1c17c79fa)[commit](/repo/gentoo.git/commit/?id=18f97c851c209f291b31ae7a902719f1c17c79fa)[diff](/repo/gentoo.git/diff/?id=18f97c851c209f291b31ae7a902719f1c17c79fa) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Tomas Mozes <hydrapolic@gmail.com> | 2017-09-25 10:19:51 +0200 |
| --- | --- | --- |
| committer | Michael Orlitzky <mjo@gentoo.org> | 2017-09-25 07:27:27 -0400 |
| commit | [18f97c851c209f291b31ae7a902719f1c17c79fa](/repo/gentoo.git/commit/?id=18f97c851c209f291b31ae7a902719f1c17c79fa) ([patch](/repo/gentoo.git/patch/?id=18f97c851c209f291b31ae7a902719f1c17c79fa)) | |
| tree | [686939a3c41707a2293902298683402dacdd120b](/repo/gentoo.git/tree/?id=18f97c851c209f291b31ae7a902719f1c17c79fa) | |
| parent | [app-admin/logstash-bin: bump to 5.5.3/5.6.1](/repo/gentoo.git/commit/?id=bbd6cb398c1740c68e9b1b78340c887c58c1fbda) ([diff](/repo/gentoo.git/diff/?id=18f97c851c209f291b31ae7a902719f1c17c79fa&id2=bbd6cb398c1740c68e9b1b78340c887c58c1fbda)) | |
| download | [gentoo-18f97c851c209f291b31ae7a902719f1c17c79fa.tar.gz](/repo/gentoo.git/snapshot/gentoo-18f97c851c209f291b31ae7a902719f1c17c79fa.tar.gz)[gentoo-18f97c851c209f291b31ae7a902719f1c17c79fa.tar.bz2](/repo/gentoo.git/snapshot/gentoo-18f97c851c209f291b31ae7a902719f1c17c79fa.tar.bz2)[gentoo-18f97c851c209f291b31ae7a902719f1c17c79fa.zip](/repo/gentoo.git/snapshot/gentoo-18f97c851c209f291b31ae7a902719f1c17c79fa.zip) | |

app-admin/logstash-bin: drop oldPackage-Manager: Portage-2.3.10, Repoman-2.3.3
Signed-off-by: Michael Orlitzky <mjo@gentoo.org>
[Diffstat](/repo/gentoo.git/diff/?id=18f97c851c209f291b31ae7a902719f1c17c79fa)

| -rw-r--r-- | [app-admin/logstash-bin/Manifest](/repo/gentoo.git/diff/app-admin/logstash-bin/Manifest?id=18f97c851c209f291b31ae7a902719f1c17c79fa) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [app-admin/logstash-bin/logstash-bin-5.2.2.ebuild](/repo/gentoo.git/diff/app-admin/logstash-bin/logstash-bin-5.2.2.ebuild?id=18f97c851c209f291b31ae7a902719f1c17c79fa) | 56 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [app-admin/logstash-bin/logstash-bin-5.3.2.ebuild](/repo/gentoo.git/diff/app-admin/logstash-bin/logstash-bin-5.3.2.ebuild?id=18f97c851c209f291b31ae7a902719f1c17c79fa) | 57 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [app-admin/logstash-bin/logstash-bin-5.4.3-r1.ebuild](/repo/gentoo.git/diff/app-admin/logstash-bin/logstash-bin-5.4.3-r1.ebuild?id=18f97c851c209f291b31ae7a902719f1c17c79fa) | 73 | |  |  |  | | --- | --- | --- | |

4 files changed, 0 insertions, 189 deletions

| diff --git a/app-admin/logstash-bin/Manifest b/app-admin/logstash-bin/Manifestindex 5988e838aaee..a407019018c0 100644--- a/[app-admin/logstash-bin/Manifest](/repo/gentoo.git/tree/app-admin/logstash-bin/Manifest?id=bbd6cb398c1740c68e9b1b78340c887c58c1fbda)+++ b/[app-admin/logstash-bin/Manifest](/repo/gentoo.git/tree/app-admin/logstash-bin/Manifest?id=18f97c851c209f291b31ae7a902719f1c17c79fa)@@ -1,5 +1,2 @@-DIST logstash-5.2.2.zip 100068713 SHA256 35bd0378f5b9001b4c3056b11496936ef47c09e3ddc469353bc8951e3b81e174 SHA512 923b35e8bcc97f6036cd4a484df546b2cc1341ec8fe5080bea8f979856086aaaae5f71fa0c3f7aee2207f7c3e71aec18af416278123362f89990c05ec9e2c92f WHIRLPOOL 4a67ed0ba3b532da5d488b2e45f53149b4e63b6b638b6fe1058a13eab904cb7ec24cd87306868a4770fe6aadfe13f7d76bfc9973e73104a8e4e9aee455321c32-DIST logstash-5.3.2.zip 100247384 SHA256 b0dfe9295c86dc4efbc1b0884c8078fd414e2e96480c3b513b2a92dab47cb505 SHA512 c150a3076b035204677275081267ac781b34d7abd1e93214cf79d73c326afb58b24ebd91453dd6fb7ba3157cb28de9b319e077e07e4b0cb3db939b99174b130b WHIRLPOOL 83d8b347266e0846b2967b6c11c6615dd3a438d8eaf5dbe057caf7569a6f64ff39a352b56b9ef9127d045d7a37d484a5a09130961cbe190946d7f1b52a66251a-DIST logstash-5.4.3.zip 100434357 SHA256 074f46832c823775c10e662ddbe8007ce19790591aeb617f351a998f9adc5c9a SHA512 036667b9209bdc7ddb3e1c979bfe059b2aa6021c1efb4db0a2eeef0b3adec6f6dd1c2a326da2447abd31f40fbeddda50d495cc936b0c23e0ad541a6e8ac40048 WHIRLPOOL ff691031d7e4083491d7448867defc10f3bbe0a10f47194df3444fcf71baa0b8f133d4b0791b0837673130be078b425f8722a7e7b177c07fdd5968c94adfddba DIST logstash-5.5.3.zip 99551442 SHA256 f81ff55feb21ff4edd4283938ac8362c2906d98f9427d8660dab8465e08f0da9 SHA512 a4328ad0b8192b7c5aaed155d608d9db6adeaefd640e461ef4467daa1a28a2ae25d6b2b1adcf47c5dd82b66fc1adbf8ba5f3eabcf7e69dd8719a5860795877aa WHIRLPOOL d3482df4a7729f6b34973816e39315c69254a641e9811131d7d5e12ede54003a326c5773e799ee471dda01a6113762919ea81ab56ede62d29221f63ed5a7f8c7 DIST logstash-5.6.1.zip 107893345 SHA256 a484176009af9f9a526360a529e2777e18a8928b50a223bb0823bfa45da958c6 SHA512 d2ddc62e14013ed69e2666cb3831bec2cd22f5bcdb147ec431fe1effa64bcb4f8feb2ea77a1c0b43deefeec9a502effe1975a2061c632c57b58b36b5010cb17d WHIRLPOOL f430a452b815e44147bf22b6ed7ab1df01cfe27ec44f2f38007127899cb7408d626f2090efba2ebddd22fd95731ed8df971d3e7793c35b174681ecbb02914ba3diff --git a/app-admin/logstash-bin/logstash-bin-5.2.2.ebuild b/app-admin/logstash-bin/logstash-bin-5.2.2.ebuilddeleted file mode 100644index cda22abd473f..000000000000--- a/[app-admin/logstash-bin/logstash-bin-5.2.2.ebuild](/repo/gentoo.git/tree/app-admin/logstash-bin/logstash-bin-5.2.2.ebuild?id=bbd6cb398c1740c68e9b1b78340c887c58c1fbda)+++ /dev/null@@ -1,56 +0,0 @@-# Copyright 1999-2017 Gentoo Foundation-# Distributed under the terms of the GNU General Public License v2--EAPI=6--inherit user--MY\_PN="${PN%-bin}"-MY\_P="${MY\_PN}-${PV}"--DESCRIPTION="Tool for managing events and logs"-HOMEPAGE="https://www.elastic.co/products/logstash"-SRC\_URI="https://artifacts.elastic.co/downloads/${MY\_PN}/${MY\_P}.zip"--LICENSE="Apache-2.0"-SLOT="0"-KEYWORDS="~amd64"--RESTRICT="strip"-QA\_PREBUILT="opt/logstash/vendor/jruby/lib/jni/\*/libjffi\*.so"--RDEPEND="virtual/jre:1.8"--S="${WORKDIR}/${MY\_P}"--pkg\_setup() {- enewgroup ${MY\_PN}- enewuser ${MY\_PN} -1 -1 /var/lib/${MY\_PN} ${MY\_PN}-}--src\_install() {- keepdir /etc/"${MY\_PN}"/{conf.d,patterns,plugins}- keepdir "/var/log/${MY\_PN}"-- insinto "/usr/share/${MY\_PN}"- newins "${FILESDIR}/agent.conf.sample" agent.conf-- insinto "/opt/${MY\_PN}"- doins -r .- fperms 0755 "/opt/${MY\_PN}/bin/${MY\_PN}" "/opt/${MY\_PN}/vendor/jruby/bin/jruby" "/opt/${MY\_PN}/bin/logstash-plugin"-- insinto /etc/logrotate.d- newins "${FILESDIR}/${MY\_PN}.logrotate" "${MY\_PN}"-- newconfd "${FILESDIR}/${MY\_PN}.confd" "${MY\_PN}"- newinitd "${FILESDIR}/${MY\_PN}.initd" "${MY\_PN}"-}--pkg\_postinst() {- ewarn "The default user changed from root to ${MY\_PN}. If you wish to run as root (for"- ewarn "example to read local logs), be sure to change LS\_USER and LS\_GROUP in"- ewarn "${EROOT%/}/etc/conf.d/${MY\_PN}"- einfo- einfo "Installing plugins: (bug #601294)"- einfo "DEBUG=1 JARS\_SKIP='true' bin/logstash-plugin install logstash-output-gelf"-}diff --git a/app-admin/logstash-bin/logstash-bin-5.3.2.ebuild b/app-admin/logstash-bin/logstash-bin-5.3.2.ebuilddeleted file mode 100644index fbb7c1bfc373..000000000000--- a/[app-admin/logstash-bin/logstash-bin-5.3.2.ebuild](/repo/gentoo.git/tree/app-admin/logstash-bin/logstash-bin-5.3.2.ebuild?id=bbd6cb398c1740c68e9b1b78340c887c58c1fbda)+++ /dev/null@@ -1,57 +0,0 @@-# Copyright 1999-2017 Gentoo Foundation-# Distributed under the terms of the GNU General Public License v2--EAPI=6--inherit user--MY\_PN="${PN%-bin}"-MY\_P="${MY\_PN}-${PV}"--DESCRIPTION="Tool for managing events and logs"-HOMEPAGE="https://www.elastic.co/products/logstash"-SRC\_URI="https://artifacts.elastic.co/downloads/${MY\_PN}/${MY\_P}.zip"--# source: LICENSE.txt and NOTICE.txt-LICENSE="Apache-2.0 MIT"-SLOT="0"-KEYWORDS="~amd64"--RESTRICT="strip"-QA\_PREBUILT="opt/logstash/vendor/jruby/lib/jni/\*/libjffi\*.so"--RDEPEND="virtual/jre:1.8"--S="${WORKDIR}/${MY\_P}"--pkg\_setup() {- enewgroup ${MY\_PN}- enewuser ${MY\_PN} -1 -1 /var/lib/${MY\_PN} ${MY\_PN}-}--src\_install() {- keepdir /etc/"${MY\_PN}"/{conf.d,patterns,plugins}- keepdir "/var/log/${MY\_PN}"-- insinto "/usr/share/${MY\_PN}"- newins "${FILESDIR}/agent.conf.sample" agent.conf-- insinto "/opt/${MY\_PN}"- doins -r .- fperms 0755 "/opt/${MY\_PN}/bin/${MY\_PN}" "/opt/${MY\_PN}/vendor/jruby/bin/jruby" "/opt/${MY\_PN}/bin/logstash-plugin"-- insinto /etc/logrotate.d- newins "${FILESDIR}/${MY\_PN}.logrotate" "${MY\_PN}"-- newconfd "${FILESDIR}/${MY\_PN}.confd" "${MY\_PN}"- newinitd "${FILESDIR}/${MY\_PN}.initd" "${MY\_PN}"-}--pkg\_postinst() {- ewarn "The default user changed from root to ${MY\_PN}. If you wish to run as root (for"- ewarn "example to read local logs), be sure to change LS\_USER and LS\_GROUP in"- ewarn "${EROOT%/}/etc/conf.d/${MY\_PN}"- einfo- einfo "Installing plugins: (bug #601294)"- einfo "DEBUG=1 JARS\_SKIP='true' bin/logstash-plugin install logstash-output-gelf"-}diff --git a/app-admin/logstash-bin/logstash-bin-5.4.3-r1.ebuild b/app-admin/logstash-bin/logstash-bin-5.4.3-r1.ebuilddeleted file mode 100644index f8c948c748cf..000000000000--- a/[app-admin/logstash-bin/logstash-bin-5.4.3-r1.ebuild](/repo/gentoo.git/tree/app-admin/logstash-bin/logstash-bin-5.4.3-r1.ebuild?id=bbd6cb398c1740c68e9b1b78340c887c58c1fbda)+++ /dev/null@@ -1,73 +0,0 @@-# Copyright 1999-2017 Gentoo Foundation-# Distributed under the terms of the GNU General Public License v2--EAPI=6--inherit user--MY\_PN="${PN%-bin}"-MY\_P="${MY\_PN}-${PV}"--DESCRIPTION="Tool for managing events and logs"-HOMEPAGE="https://www.elastic.co/products/logstash"-SRC\_URI="https://artifacts.elastic.co/downloads/${MY\_PN}/${MY\_P}.zip"--# source: LICENSE.txt and NOTICE.txt-LICENSE="Apache-2.0 MIT"-SLOT="0"-KEYWORDS="~amd64"--RESTRICT="strip"-QA\_PREBUILT="opt/logstash/vendor/jruby/lib/jni/\*/libjffi\*.so"--RDEPEND="virtual/jre:1.8"--S="${WORKDIR}/${MY\_P}"--pkg\_setup() {- enewgroup ${MY\_PN}- enewuser ${MY\_PN} -1 -1 /var/lib/${MY\_PN} ${MY\_PN}-}--src\_install() {- keepdir /etc/"${MY\_PN}"/{conf.d,patterns,plugins}- keepdir "/var/lib/${MY\_PN}"- keepdir "/var/log/${MY\_PN}"-- insinto "/usr/share/${MY\_PN}"- newins "${FILESDIR}/agent.conf.sample" agent.conf-- insinto "/opt/${MY\_PN}"- doins -r .- fperms 0755 "/opt/${MY\_PN}/bin/${MY\_PN}" "/opt/${MY\_PN}/vendor/jruby/bin/jruby" "/opt/${MY\_PN}/bin/logstash-plugin"-- insinto /etc/logrotate.d- newins "${FILESDIR}/${MY\_PN}.logrotate" "${MY\_PN}"-- newconfd "${FILESDIR}/${MY\_PN}.confd" "${MY\_PN}"- newinitd "${FILESDIR}/${MY\_PN}.initd" "${MY\_PN}"-- insinto /usr/share/eselect/modules- doins "${FILESDIR}"/logstash-plugin.eselect-}--pkg\_postinst() {- ewarn "The default user changed from root to ${MY\_PN}. If you wish to run as root (for"- ewarn "example to read local logs), be sure to change LS\_USER and LS\_GROUP in"- ewarn "${EROOT%/}/etc/conf.d/${MY\_PN}"- ewarn- ewarn "Self installed plugins are removed during Logstash upgrades (Bug #622602)"- ewarn "Install the plugins via eselect module that will automatically re-install"- ewarn "all self installed plugins after Logstash upgrades."- einfo- einfo "Installing plugins:"- einfo "eselect logstash-plugin install logstash-output-gelf"- einfo-- einfo "Reinstalling self installed plugins (installed via eselect module):"- eselect logstash-plugin reinstall-- einfo- einfo "Sample configuration:"- einfo "${EROOT%/}/usr/share/${MY\_PN}"-} |
| --- |

### Questions or comments?

Please feel free to [contact us](https://www.gentoo.org/inside-gentoo/contact/).

**¬© 2001‚Äì2024 Gentoo Authors**

Gentoo is a trademark of the Gentoo Foundation, Inc. and of F√∂rderverein Gentoo e.V.
The contents of this document, unless otherwise expressly stated, are licensed under the
[CC-BY-SA-4.0](https://creativecommons.org/licenses/by-sa/4.0/) license.
The [Gentoo Name and Logo Usage Guidelines](https://www.gentoo.org/inside-gentoo/foundation/name-logo-guidelines.html) apply.



=== Content from bugs.gentoo.org_f37bdd18_20250125_080320.html ===

[![Gentoo Websites Logo](extensions/Gentoo/web/gentoo_org.png)](/ "Go to the Gentoo Bugzilla homepage")
Go to:
[Gentoo Home](https://www.gentoo.org/)
[Documentation](https://www.gentoo.org/support/documentation/)
[Forums](https://forums.gentoo.org/)
[Lists](https://www.gentoo.org/get-involved/mailing-lists/)
[Bugs](/)
[Planet](https://planet.gentoo.org/)
[Store](https://www.gentoo.org/inside-gentoo/stores/)
[Wiki](https://wiki.gentoo.org/)
**[Get Gentoo!](https://www.gentoo.org/downloads/)**

Gentoo's Bugzilla ‚Äì Bug¬†628558
app-admin/logstash-bin: root privilege escalation via init script
Last modified: 2021-08-11 19:57:35 UTC node [vulture]

* [Home](./)
* | [New](enter_bug.cgi?format=guided)‚Äì[[Ex]](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New¬†Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=628558&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=628558&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug¬†628558**](show_bug.cgi?id=628558)
(CVE-2017-14730)
- app-admin/logstash-bin: root privilege escalation via init script

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
app-admin/logstash-bin: root privilege escalation via init script

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2017-14730 | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | Gentoo Security | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=Gentoo Security "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Auditing ([show other bugs](buglist.cgi?component=Auditing&product=Gentoo%20Security&bug_status=__open__)) | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All Linux | |  | | | [Importance](page.cgi?id=fields.html#importance): | Normal normal | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Gentoo Security Audit Team | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") | ~1 [noglsa cve] | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2017-08-21 23:33 UTC by Michael Orlitzky | | --- | --- | | Modified: | 2021-08-11 19:57 UTC ([History](show_activity.cgi?id=628558)) | | CC List: | 3 users (show)  erkiferenc hydrapolic mgorny | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Package list:](page.cgi?id=fields.html#cf_stabilisation_atoms "Contains a list of packages (and optionally, architectures) to keyword or stabilize. One fully qualified package per line, optionally followed by a space-delimited list of architectures for that package.") |  | | [Runtime testing required:](page.cgi?id=fields.html#cf_runtime_testing_required "Indicate what level of testing is required. For manual testing following instructions in the bug, choose \"Manual\". For only compile-testing, choose \"No\". For where tests must pass, choose \"Yes\".") | --- | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [**logstash-bin-remove-chown.diff**](attachment.cgi?id=490192 "View the content of the attachment") (logstash-bin-remove-chown.diff,1.29 KB, patch)  [2017-08-23 05:55 UTC](#attach_490192 "Go to the comment associated with the attachment"), Ferenc Erki | [Details](attachment.cgi?id=490192&action=edit) | [Diff](attachment.cgi?id=490192&action=diff) | | [**logstash-bin-fix-628558.diff**](attachment.cgi?id=490210 "View the content of the attachment") (logstash-bin-fix-628558.diff,2.07 KB, patch)  [2017-08-23 10:54 UTC](#attach_490210 "Go to the comment associated with the attachment"), Ferenc Erki | [Details](attachment.cgi?id=490210&action=edit) | [Diff](attachment.cgi?id=490210&action=diff) | | [Show Obsolete](#a0) (1) [View All](attachment.cgi?bugid=628558&action=viewall&hide_obsolete=1)  [Add an attachment](attachment.cgi?bugid=628558&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=628558&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](#c0)  Michael Orlitzky   gentoo-dev  2017-08-21 23:33:37 UTC  ``` This bug covers two vulnerabilities -- one minor, related to the PID file, and the other major, related to the recursive "chown." For the latter I've marked this private.  == PID file manipulation ==  The logstash-bin init script gives ownership of the PID file directory to the same user that the daemon runs as:    for d in "${LS_INSTALL_DIR}/data" "$(dirname "${pidfile}")" "${LS_LOG_DIR}";   do       checkpath -d -o "${LS_USER}":"${LS_GROUP}" -m750 "$d"       chown -R "${LS_USER}":"${LS_GROUP}" "$d"   done  As a result, the ${LS_USER} user can write whatever he wants into the PID file. Later, that may be exploitable: when the service is stopped, root will call "kill" on the contents of that file.  The good news is, you shouldn't need to call checkpath for the PID file at all. With command_background="true", OpenRC creates the PID file as root:root, and the problematic "checkpath" can be avoided if you store the PID file directly in /run. That is, simply set:    pidfile="/run/logstash.pid"  In [bug 628546](show_bug.cgi?id=628546 "RESOLVED FIXED - <app-admin/filebeat-5.5.2: DoS via PID file manipulation"), I suggested some improvements to the user/group handling; in particular, that you not allow them to change on-the-fly. The reasoning was that, if the user/group change, you need to adjust the ownership and permissions of any existing files from the old LS_USER to the new one. There I hinted at another problem, "to work around that, you'll come up with some recursive chown thing, and introduce a new problem." I'm sorry to say that logstash-bin now has that new problem =)  == Root privilege escalation through chown ==  When you call chown recursively, it follows links (both hard and sym). There are some kernel hardening options that can help you avoid that, but they're not enabled by default in a vanilla linux kernel, so we can't rely on them. Here's the bad scenario:    1. The first time you start logstash-bin, it changes ownership of      LS_LOG_DIR to LS_USER:LS_GROUP.    2. LS_USER is a bad guy, and he creates a symlink in LS_LOG_DIR pointing      to /root/.bashrc    3. The next time you start logstash-bin, it runs "chown -R LS_USER" on      LS_LOG_DIR, and chown follows the symlink, giving ownership of      /root/.bashrc to LS_USER. Now LS_USER is root.  There is no easy fix for this when LS_USER and LS_GROUP are variables. If at all possible, you should create a restricted user and group for logstash-bin in the ebuild, and then hard-code them in the init script. That way, you never need to fix the permissions on a bunch of pre-existing files and directories. ```  [Comment 1](#c1)  Ferenc Erki    2017-08-22 11:49:14 UTC  ``` Thanks for the bug. I'm not that actively maintaining this package anymore in practice, but considering the nature of the issue, I'm more than happy to help out.  As far as I remember, the original intention with the init script was to be as close as possible to upstream. I haven't checked recent upstream init scripts, so they may or may not need notification as well (or maybe there's a related report already).  Since the ebuild already creates the user and group intended for default usage, it seems easy to remove the chown step from the init script, and ensure (initial) directory ownership and permissions from the ebuild itself.  Would that be enough to fix these issues? Also, where is it best to provide patches and in which format? ```  [Comment 2](#c2)  Michael Orlitzky   gentoo-dev  2017-08-22 12:18:31 UTC  ``` (In reply to Ferenc Erki from [comment #1](show_bug.cgi?id=628558#c1)) >  > As far as I remember, the original intention with the init script was to be > as close as possible to upstream. I haven't checked recent upstream init > scripts, so they may or may not need notification as well (or maybe there's > a related report already).  Ah, I see that upstream is using LS_USER and LS_GROUP, but it doesn't have the "chown" call so I think it's safe.   > Since the ebuild already creates the user and group intended for default > usage, it seems easy to remove the chown step from the init script, and > ensure (initial) directory ownership and permissions from the ebuild itself.  Yup, that's how I would fix it:    1. Replace LS_USER and LS_GROUP with "logstash" in the init script,      and drop the variables from the conf.d file.    2. Set pidfile="/run/logstash.pid" in the init script.    3. Remove the "chown" call from the "for" loop, and don't loop over the      PID file directory at all (i.e. don't call checkpath on /run).  > Would that be enough to fix these issues? Also, where is it best to provide > patches and in which format?  That should do it. You can post a patch here if you want, in unified format (diff -u) or as the output from one of the git commands. git diff, git format-patch, etc. are all acceptable. You can even submit pull requests on Github if that's most convenient: <https://github.com/gentoo/gentoo/>  Finally, you could just attach the new files to this bug.  The init script and conf.d files will need new revisions, so will need to be named e.g. logstash.initd-r1 and logstash.confd-r1. Then we'll need a revision bump for the newest logstash-bin ebuild that uses the new init script and conf.d file. That way, we can stabilize the new revision, and ensure that all users get the fixed init script.  One more thing to consider: I see that the ebuilds are doing,    enewuser ${MY_PN} -1 -1 /var/lib/${MY_PN} ${MY_PN}  Maybe in light of that, the LS_HOME variable should be hard-coded to /var/lib/logstash, too? ```  [Comment 3](#c3)  Tom√°≈° M√≥zes    2017-08-22 17:48:09 UTC  ``` Thanks for the well prepared report.  For the PID manipulation case, we just remove the chown and move the pid directly under /run.  The second case is a bit tricky. Logstash (like filebeat) may take input as logs (mostly owned by root), so he needs read access. Once we had root as the default user, but since logstash can take network input as well where we don't need root, this was changed to the dedicated logstash user. If we create a special user and one needs to read logs in /var/log then the group permission needs to be updated everywhere which is kind of weird. Probably it's easier to drop the chown and set a warning in the ebuild. Or an alternative would be to prepare a separate script for updating privileges (stripped from the init script)? ```  [Comment 4](#c4)  Michael Orlitzky   gentoo-dev  2017-08-22 17:57:31 UTC  ``` The two non-PIDfile directories that get chown'ed at the moment are,    LS_INSTALL_DIR="/opt/logstash"   LS_LOG_DIR=${LS_LOG_DIR:-/var/log/logstash}  If the logstash user needs to read something else under /var/log, like /var/log/messages, then does the current init script even address that?  I don't have an easy answer for how to grant access to that stuff. Group permissions weren't flexible enough for me, so I use POSIX ACLs for most things. You could make the logs have group "logstash", or add the logstash user to the root group, or... a hundred other things that all have trade-offs.  An automated script might work, but you have to be really careful to never call chown or chmod on a file in a directory that isn't owned by root. ```  [Comment 5](#c5)  Tom√°≈° M√≥zes    2017-08-22 19:23:54 UTC  ``` In order to read the logs,you need to specify the user with appropriate permissions. We do not set the permissions on system logs (the ones to be processed by logstash) since they are specified elsewhere in the config.  The chown calls are there to ensure that you can switch LS_USER between root and any other user (usually logstash) and it will just work without permission denied warnings. Suppose you first run logstash as root, all the data dir are owned as root and later you wish to run as logstash user and you do not have petmission on data directories. Those chowns handled these situations. ```  [Comment 6](#c6)  Ferenc Erki    2017-08-22 19:30:54 UTC  ``` Sorry for long post, but I felt it's worth to share my thoughts on some related details/features which I'd like to see keep preserved for Gentoo.  TL;DR: 1. Let's drop chown. 2. Keep LS_USER, LS_GROUP, LS_PIDFILE and LS_HOME configurable for multi-instance scenarios. 2a. Add config option for `--path.data` if needed. 3. Let start-stop-daemon manage pidfiles.  Long version:  > Ah, I see that upstream is using LS_USER and LS_GROUP, but it doesn't have the > "chown" call so I think it's safe.  Yes, upstream seem to be generating init scripts and/or systemd units during installation via their `system-install` script, which in turn seems to be just using `pleaserun`. And the template in there seems to be not affected (has `chown`, but not a recursive one, and only for the logging directory. Maybe we can simply run `system-install` too to generate an init script instead of maintaining and installing a handcrafted one?  >  1. Replace LS_USER and LS_GROUP with "logstash" in the init script, >     and drop the variables from the conf.d file.  If there's any way, I'd strongly prefer to keep them, due to a quite common use case of running multiple logstash instances on the same machine, but with different privileges, configuration, etc (for example having one logstash per product team, and/or service). This is something that is not fully implemented yet for Gentoo init scripts (but e.g. the somewhat related elasticsearch initscripts can do it already), but let's say "almost there", and would be nice to complete.  >   2. Set pidfile="/run/logstash.pid" in the init script.  For the same reasons, I think it should also be configurable. I'm relatively indifferent about the default location, as long as we can avoid security issues. That being said, I would prefer using the path upstream uses (`/var/run/logstash.pid` as of this moment). I believe the original reason behind  using a directory like `/var/run/logstash` for pidfiles was due to the same multi-instance reasons (so `productA.pid` and `teamB.pid` could all live there). Though this can be solved with name prefixing as well (`/run/logstash.productA.pid` and `/run/logstash.teamB.pid`).  I think it's good if we let start-stop-daemon to handle the files themselves (which would also mean keeping it owned by root as well, if I understand correctly).  >   3. Remove the "chown" call from the "for" loop, and don't loop over the      PID file directory at all (i.e. don't call checkpath on /run).  Yeah, I think the `chown` must go, at least in its recursive form, but preferably fully. It seems like it was introduced on <https://github.com/gentoo/gentoo/commit/bbdc5412061adf598ed935697441a7d6b05f7614>, and I believe the previous `checkpath` method was not affected by this issue (maybe the `checkpath -f` should be avoided for the same sym/hardlink modificatin reasons).  > Maybe in light of that, the LS_HOME variable should be hard-coded to /var/lib/logstash, too?  I'd keep it configurable too, for the same multi-instance reasons.  > Logstash (like filebeat) may take input as logs (mostly owned by root), so he needs read access.  I'd say it's up to the administrator to ensure permissions are set on log sources (which might not only be files). For product-related services, it was usually already there because the same user, or at least the same group owned all things logstash needed to touch for the given product. Root could decide to run logstash as root for system logs, or more preferably, just set group permissions for the `logstash` user. I guess this is an area that would be hard to handle as a generic case with a tool, and it's best to leave the decision to administrators (and helping them by leaving all the config options within their reach under `/etc/conf.d`).  > Probably it's easier to drop the chown and set a warning in the ebuild.  Yeah, I think I'd go for that. Some warning along the lines of  "If you change privileges for your logstash instance, please make sure it has proper permissions for all the following:  1. inputs it should read from  2. outputs it should write to (including its own logs)"  might be sufficient.  My only remaining question is about `/opt/logstash/data`, which seems like a more recent addition. It is configurable via the `--path.data` command line option of logstash, and since it seems to be used for logstash persistent queues, I'd expect this should be different for every instance too for a multi-instance scenario. I'd guess it's good enough to set it to `${LS_HOME}/data` as a default (instead of the shared-by-all location of `/opt/logstash/data`). ```  [Comment 7](#c7)  Michael Orlitzky   gentoo-dev  2017-08-22 19:36:26 UTC  ``` (In reply to Tom√°≈° M√≥zes from [comment #5](show_bug.cgi?id=628558#c5)) >  > The chown calls are there to ensure that you can switch LS_USER between root > and any other user (usually logstash) and it will just work without > permission denied warnings.  Ok, that's the situation I've had trouble with in the past. I'm not even sure there is a safe way to do it. It might be possible with a script that gets run only once, and if you are able to rely on GNU chown with its "--from" flag, and if you make sure to traverse the files and directories in a safe order (don't chown a directory before its files). But those points just address the problems that I've thought of -- I'd be willing to bet there are others. ```  [Comment 8](#c8)  Michael Orlitzky   gentoo-dev  2017-08-22 19:39:51 UTC  ``` I'm fine with leaving LS_USER, LS_GROUP, and LS_HOME for multiple-instance support; you only run into problems if you try to support people changing them on-the-fly for a single instance. (It's still TBD if this can be solved.)  /var/run is a symlink to /run these days, but /run/logstash/<whatever>.pid is also fine. Just be sure to create it as root:root, rather than as LS_USER:LS_GROUP. ```  [Comment 9](#c9)  Ferenc Erki    2017-08-23 05:55:01 UTC  ``` Created [attachment 490192](attachment.cgi?id=490192 "logstash-bin-remove-chown.diff") [[details](attachment.cgi?id=490192&action=edit "logstash-bin-remove-chown.diff"), [diff](attachment.cgi?id=490192&action=diff "logstash-bin-remove-chown.diff")] logstash-bin-remove-chown.diff  Alright, judging by the release notes and recent official package contents, it looks like things around packaging, init scripts handling and also configuration style changed considerably for the 5.x releases.  I'm afraid that would be too big of a change to be on par with that, so I'd say let's just fix this bug on its own, and handle the rest separately, if you agree.  In my own quick tests, I believe this attached patch solves both issues (no files are set to be automatically owned by LS_USER/LS_GROUP). I aimed for least changes compared to current situation in Gentoo, and it doesn't contain revbumping the init script nor all the current ebuild files in tree yet. I can update it later, or feel free to apply those changes too.  Does this look enough to address this bug's concerns? ```  [Comment 10](#c10)  Ferenc Erki    2017-08-23 10:54:12 UTC  ``` Created [attachment 490210](attachment.cgi?id=490210 "logstash-bin-fix-628558.diff") [[details](attachment.cgi?id=490210&action=edit "logstash-bin-fix-628558.diff"), [diff](attachment.cgi?id=490210&action=diff "logstash-bin-fix-628558.diff")] logstash-bin-fix-628558.diff  Hmm, with the patch above, it fails to start up properly because the following locations are created as root during the checkconfig() call in the initscript:   - logfiles under LS_LOG_DIR (/var/log/logstash)  - contents of the data directory under /opt/logstash/data (with further subdirectories like `queue` and `dead_letter_queue`)  while those locations are expected to be writable by LS_USER.  After iterating through various approaches, I updated my proposed patch to:   - override logdir for the configcheck command to prevent us from having to chown logs created during that step  - use checkpath to ensure `root:root` ownership on the directory of the pidfiles to protecting users who already have vulnerable permissions on their pathes  - use checkpath to ensure `LS_USER:LS_GROUP` ownership on the (IMHO) minimal set of pathes (to correct for the permissions created during `checkconfig()`)  Note: for now, I tried to avoid moving the pidfiles one level up to prevent issues when a logstash instance is already running during installation time.  Please review this set of changes. I would be happy to revbump all ebuilds/files involved. ```  [Comment 11](#c11)  Tom√°≈° M√≥zes    2017-08-25 12:09:32 UTC  ``` What if we add some check to see if there are any symlinks in /var/lib/logstash or /var/log/logstash? Or what if we use find -type {d,f} instead of chown and skip setting perms on symlinks? ```  [Comment 12](#c12)  Kristian Fiskerstrand (RETIRED)   gentoo-dev  2017-08-25 12:15:54 UTC  ``` (In reply to Tom√°≈° M√≥zes from [comment #11](show_bug.cgi?id=628558#c11)) > What if we add some check to see if there are any symlinks in > /var/lib/logstash or /var/log/logstash? Or what if we use find -type {d,f} > instead of chown and skip setting perms on symlinks?  Depending on how it is done it can be open to race conditions ```  [Comment 13](#c13)  Tom√°≈° M√≥zes    2017-08-25 16:06:02 UTC  ``` And regarding /opt/logstash/data and /opt/logstash/config, they are in my todo list for changing. The data dir should move to /var/lib/logstash and the config to /etc/logstash. But that can be done in the next version bump. ```  [Comment 14](#c14)  Tom√°≈° M√≥zes    2017-08-25 16:06:44 UTC  ``` (In reply to Kristian Fiskerstrand from [comment #12](show_bug.cgi?id=628558#c12)) > (In reply to Tom√°≈° M√≥zes from [comment #11](show_bug.cgi?id=628558#c11)) > > What if we add some check to see if there are any symlinks in > > /var/lib/logstash or /var/log/logstash? Or what if we use find -type {d,f} > > instead of chown and skip setting perms on symlinks? >  > Depending on how it is done it can be open to race conditions  And is there a correct way to do it? Do we have some package in Gentoo we can build on? ```  [Comment 15](#c15)  Michael Orlitzky   gentoo-dev  2017-08-27 14:24:08 UTC  ``` (In reply to Tom√°≈° M√≥zes from [comment #11](show_bug.cgi?id=628558#c11)) > What if we add some check to see if there are any symlinks in > /var/lib/logstash or /var/log/logstash? Or what if we use find -type {d,f} > instead of chown and skip setting perms on symlinks?  Hard links have the same problem...   > And is there a correct way to do it? Do we have some package in Gentoo we can build on?  I haven't seen one yet. ```  [Comment 16](#c16)  Tom√°≈° M√≥zes    2017-09-08 12:02:03 UTC  ``` <https://github.com/gentoo/gentoo/pull/5665> ```  [Comment 17](#c17)  Michael Orlitzky   gentoo-dev  2017-09-25 11:31:26 UTC  ``` security@, this has been fixed, and the old versions removed from the tree. ```  [Comment 18](#c18)  Kristian Fiskerstrand (RETIRED)   gentoo-dev  2017-09-25 12:04:03 UTC  ``` (In reply to Michael Orlitzky from [comment #17](show_bug.cgi?id=628558#c17)) > security@, this has been fixed, and the old versions removed from the tree.  Have you requested a CVE or do you want Security Project to do this?  Lifting restriction, fix is public and allows for using this bug as reference in request. ```  [Comment 19](#c19)  Michael Orlitzky   gentoo-dev  2017-09-25 12:20:49 UTC  ``` (In reply to Kristian Fiskerstrand from [comment #18](show_bug.cgi?id=628558#c18)) > (In reply to Michael Orlitzky from [comment #17](show_bug.cgi?id=628558#c17)) > > security@, this has been fixed, and the old versions removed from the tree. >  > Have you requested a CVE or do you want Security Project to do this? >   I'll do it today. ```  [Comment 20](#c20)  Kristian Fiskerstrand (RETIRED)   gentoo-dev  2017-09-25 12:51:15 UTC  ``` (In reply to Michael Orlitzky from [comment #19](show_bug.cgi?id=628558#c19)) > (In reply to Kristian Fiskerstrand from [comment #18](show_bug.cgi?id=628558#c18)) > > (In reply to Michael Orlitzky from [comment #17](show_bug.cgi?id=628558#c17)) > > > security@, this has been fixed, and the old versions removed from the tree. > >  > > Have you requested a CVE or do you want Security Project to do this? > >  >  > I'll do it today.  Thanks!  Since package is not in stable, there won't be a GLSA for this issue. Since cleanup etc is done, once CVE is assigned we can close the bug. ```  [Comment 21](#c21)  Michael Orlitzky   gentoo-dev  2017-09-25 18:24:08 UTC  ``` The "chown" issue in the init script has been assigned CVE-2017-14730. ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=628558)
* -¬†[XML](show_bug.cgi?ctype=xml&id=628558)
* -¬†[Clone This Bug](enter_bug.cgi?cloned_bug_id=628558)
* -¬†[Clone In The Same
  Product](enter_bug.cgi?cloned_bug_id=628558&product=Gentoo%20Security)
* -¬†Top of page

* + [Home](./)
  + | [New](enter_bug.cgi?format=guided)‚Äì[[Ex]](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New¬†Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=628558&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=628558&GoAheadAndLogIn=1#forgot)
    Login:

    [x]


