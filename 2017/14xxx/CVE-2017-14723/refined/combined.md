=== Content from github.com_219e2369_20250124_213436.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FWordPress%2FWordPress%2Fcommit%2F70b21279098fc973eae803693c0705a548128e48)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FWordPress%2FWordPress%2Fcommit%2F70b21279098fc973eae803693c0705a548128e48)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=WordPress%2FWordPress)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[WordPress](/WordPress)
/
**[WordPress](/WordPress/WordPress)**
Public

* [Notifications](/login?return_to=%2FWordPress%2FWordPress) You must be signed in to change notification settings
* [Fork
  12.7k](/login?return_to=%2FWordPress%2FWordPress)
* [Star
   19.8k](/login?return_to=%2FWordPress%2FWordPress)

* [Code](/WordPress/WordPress)
* [Pull requests
  0](/WordPress/WordPress/pulls)
* [Actions](/WordPress/WordPress/actions)
* [Security](/WordPress/WordPress/security)
* [Insights](/WordPress/WordPress/pulse)

Additional navigation options

* [Code](/WordPress/WordPress)
* [Pull requests](/WordPress/WordPress/pulls)
* [Actions](/WordPress/WordPress/actions)
* [Security](/WordPress/WordPress/security)
* [Insights](/WordPress/WordPress/pulse)

## Commit

[Permalink](/WordPress/WordPress/commit/70b21279098fc973eae803693c0705a548128e48)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Database: Hardening for `wpdb::prepare()`

[Browse files](/WordPress/WordPress/tree/70b21279098fc973eae803693c0705a548128e48)
Browse the repository at this point in the history

```
Previously if you passed an array of values for placeholders, additional values could be passed as well. Now additional values will be ignored.

Built from [https://develop.svn.wordpress.org/trunk@41470](https://develop.svn.wordpress.org/trunk%4041470)

git-svn-id: [http://core.svn.wordpress.org/trunk@41303](http://core.svn.wordpress.org/trunk%4041303) 1a063a9b-81f0-0310-95a4-ce76da25c4cd
```

* Loading branch information

[![@aaroncampbell](https://avatars.githubusercontent.com/u/802412?s=40&v=4)](/aaroncampbell)

[aaroncampbell](/WordPress/WordPress/commits?author=aaroncampbell "View all commits by aaroncampbell")
committed
Sep 19, 2017

1 parent
[69de732](/WordPress/WordPress/commit/69de73224ffc761b248db55a78885c9794cd74e8)

commit 70b2127

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**11 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* wp-includes

  + wp-includes/version.php
    [version.php](#diff-e3321c16995a4342da7495e1e3840612b6d91de979b5250c777baf2a40dccfbd)
  + wp-includes/wp-db.php
    [wp-db.php](#diff-2c36931849eb4c257c002717728d28b9026f52ccd423e55b5d15f139a4752fea)

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[wp-includes/version.php](#diff-e3321c16995a4342da7495e1e3840612b6d91de979b5250c777baf2a40dccfbd "wp-includes/version.php")

Show comments

[View file](/WordPress/WordPress/blob/70b21279098fc973eae803693c0705a548128e48/wp-includes/version.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -4,7 +4,7 @@ |
|  |  | \* |
|  |  | \* @global string $wp\_version |
|  |  | \*/ |
|  |  | $wp\_version = '4.9-alpha-41457'; |
|  |  | $wp\_version = '4.9-alpha-41470'; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Holds the WordPress DB revision, increments when changes are made to the WordPress DB schema. |
| Expand Down | |  |

11 changes: 10 additions & 1 deletion

11
[wp-includes/wp-db.php](#diff-2c36931849eb4c257c002717728d28b9026f52ccd423e55b5d15f139a4752fea "wp-includes/wp-db.php")

Show comments

[View file](/WordPress/WordPress/blob/70b21279098fc973eae803693c0705a548128e48/wp-includes/wp-db.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1236,9 +1236,18 @@ public function prepare( $query, $args ) { |
|  |  |  |
|  |  | $args = func\_get\_args(); |
|  |  | array\_shift( $args ); |
|  |  |  |
|  |  | // If args were passed as an array (as in vsprintf), move them up |
|  |  | if ( isset( $args[0] ) && is\_array($args[0]) ) |
|  |  | if ( is\_array( $args[0] ) && count( $args ) == 1 ) { |
|  |  | $args = $args[0]; |
|  |  | } |
|  |  |  |
|  |  | foreach ( $args as $arg ) { |
|  |  | if ( ! is\_scalar( $arg ) ) { |
|  |  | \_doing\_it\_wrong( 'wpdb::prepare', sprintf( \_\_( 'Unsupported value type (%s).' ), gettype( $arg ) ), '4.8.2' ); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | $query = str\_replace( "'%s'", '%s', $query ); // in case someone mistakenly already singlequoted it |
|  |  | $query = str\_replace( '"%s"', '%s', $query ); // doublequote unquoting |
|  |  | $query = preg\_replace( '|(?<!%)%f|' , '%F', $query ); // Force floats to be locale unaware |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `70b2127`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FWordPress%2FWordPress%2Fcommit%2F70b21279098fc973eae803693c0705a548128e48) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.debian.org_a0941c5c_20250124_213441.html ===


---

[[Date Prev](msg00258.html)][[Date Next](msg00260.html)]
[[Thread Prev](msg00258.html)][[Thread Next](msg00260.html)]
[[Date Index](maillist.html#00259)]
[[Thread Index](threads.html#00259)]

# [SECURITY] [DSA 3997-1] wordpress security update

---

* *To*: debian-security-announce@lists.debian.org
* *Subject*: [SECURITY] [DSA 3997-1] wordpress security update
* *From*: Yves-Alexis Perez <corsac@debian.org>
* *Date*: Wed, 11 Oct 2017 13:51:21 +0200
* *Message-id*: <[[🔎]](/msgid-search/59de05b9.a0071.7885b94b%40scapa.corsac.net) [59de05b9.a0071.7885b94b@scapa.corsac.net](msg00259.html)>
* *Reply-to*: debian-security-announce-request@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian Security Advisory DSA-3997-1                   security@debian.org
<https://www.debian.org/security/>                        Yves-Alexis Perez
October 10, 2017                      <https://www.debian.org/security/faq>
- -------------------------------------------------------------------------

Package        : wordpress
CVE ID         : CVE-2017-14718 CVE-2017-14719 CVE-2017-14720 CVE-2017-14721
                 CVE-2017-14722 CVE-2017-14723 CVE-2017-14724 CVE-2017-14725
                 CVE-2017-14726 CVE-2017-14990
Debian Bug     : 876274 877629

Several vulnerabilities were discovered in Wordpress, a web blogging tool.
They would allow remote attackers to exploit path-traversal issues, perform SQL
injections and various cross-site scripting attacks.

For the oldstable distribution (jessie), these problems have been fixed
in version 4.1+dfsg-1+deb8u15.

For the stable distribution (stretch), these problems have been fixed in
version 4.7.5+dfsg-2+deb9u1.

For the testing distribution (buster), these problems have been fixed
in version 4.8.2+dfsg-2.

For the unstable distribution (sid), these problems have been fixed in
version 4.8.2+dfsg-2.

We recommend that you upgrade your wordpress packages.

Further information about Debian Security Advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://www.debian.org/security/>

Mailing list: debian-security-announce@lists.debian.org
-----BEGIN PGP SIGNATURE-----

iQEzBAEBCgAdFiEE8vi34Qgfo83x35gF3rYcyPpXRFsFAlneAZYACgkQ3rYcyPpX
RFtLWwgAqlmWIr+gUrKGKGdCCl1bHy/XI6RM3ezTXa3Mbkesu0JPh9l7JvxpinSm
sAPjgPCMjzL89uJvUt8DsFlK7DsZv03NxZAeLoR7NbzPx0z1iHFUogbv32yZfKwI
DNtBF9HjwTLxb8CSZG9XKgxk1RWwscoe6DqyyYTcVGdQonzPFUVoZxDCtrS6R2TZ
el5ycFEpaoNb9hIaZvpYtXmDYeUibvHeV0SC9WfmBCXKpTX/0th/YK2hS+/P1Xcn
xlLM4tVXgftYOnZYVMZugVcJuVWm8edoMOyv+kFYQQvSgwuyJuGNVePGrUod5kmV
w9bAsukRwTjloWNFJQik9OzHahuNcw==
=CMTQ
-----END PGP SIGNATURE-----

```

---



=== Content from wordpress.org_d59dff0e_20250124_213440.html ===


[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Showcase](https://wordpress.org/showcase/)
* [Hosting](https://wordpress.org/hosting/)
* Extend
  + [Themes](https://wordpress.org/themes/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Blocks](https://wordpress.org/blocks/)
  + [Openverse ↗︎](https://openverse.org/)
* Learn
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* Community
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [Events](https://events.wordpress.org/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* About
  + [About WordPress](https://wordpress.org/about/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
* [Get WordPress](https://wordpress.org/download/)

Search in WordPress.org

[Get WordPress](https://wordpress.org/download/)

[WordPress.org](https://wordpress.org/)

[News](https://wordpress.org/news)

WordPress 4.8.2 Security and Maintenance Release

All posts

Search results

* Categories
  + [All Posts](https://wordpress.org/news/all-posts/)
  + [Awards](https://wordpress.org/news/category/awards/)
  + [Community](https://wordpress.org/news/category/community/)
  + [Design](https://wordpress.org/news/category/design/)
  + [Development](https://wordpress.org/news/category/development/)
  + [Documentation](https://wordpress.org/news/category/documentation/)
  + [Events](https://wordpress.org/news/category/events/)
  + [Features](https://wordpress.org/news/category/features/)
  + [General](https://wordpress.org/news/category/general/)
  + [Interviews](https://wordpress.org/news/category/interviews/)
  + [Meta](https://wordpress.org/news/category/meta/)
  + [Month in WordPress](https://wordpress.org/news/category/month-in-wordpress/)
  + [Performance](https://wordpress.org/news/category/performance/)
  + [Podcast](https://wordpress.org/news/podcast/)
  + [Releases](https://wordpress.org/news/category/releases/)
  + [Security](https://wordpress.org/news/category/security/)
  + [Store](https://wordpress.org/news/category/store/)
  + [Testing](https://wordpress.org/news/category/testing/)
  + [Updates](https://wordpress.org/news/category/updates/)
  + [WordCamp](https://wordpress.org/news/category/wordcamp/)

* Categories
  + [All Posts](https://wordpress.org/news/all-posts/)
  + [Awards](https://wordpress.org/news/category/awards/)
  + [Community](https://wordpress.org/news/category/community/)
  + [Design](https://wordpress.org/news/category/design/)
  + [Development](https://wordpress.org/news/category/development/)
  + [Documentation](https://wordpress.org/news/category/documentation/)
  + [Events](https://wordpress.org/news/category/events/)
  + [Features](https://wordpress.org/news/category/features/)
  + [General](https://wordpress.org/news/category/general/)
  + [Interviews](https://wordpress.org/news/category/interviews/)
  + [Meta](https://wordpress.org/news/category/meta/)
  + [Month in WordPress](https://wordpress.org/news/category/month-in-wordpress/)
  + [Performance](https://wordpress.org/news/category/performance/)
  + [Podcast](https://wordpress.org/news/podcast/)
  + [Releases](https://wordpress.org/news/category/releases/)
  + [Security](https://wordpress.org/news/category/security/)
  + [Store](https://wordpress.org/news/category/store/)
  + [Testing](https://wordpress.org/news/category/testing/)
  + [Updates](https://wordpress.org/news/category/updates/)
  + [WordCamp](https://wordpress.org/news/category/wordcamp/)

September 19, 2017
By [Aaron D. Campbell](https://profiles.wordpress.org/aaroncampbell/)
in [Releases](https://wordpress.org/news/category/releases/), [Security](https://wordpress.org/news/category/security/)
# WordPress 4.8.2 Security and Maintenance Release

---

WordPress 4.8.2 is now available. This is a **security release** for all previous versions and we strongly encourage you to update your sites immediately.

WordPress versions 4.8.1 and earlier are affected by these security issues:

1. `$wpdb->prepare()` can create unexpected and unsafe queries leading to potential SQL injection (SQLi). WordPress core is not directly vulnerable to this issue, but we’ve added hardening to prevent plugins and themes from accidentally causing a vulnerability. Reported by [Slavco](https://hackerone.com/slavco)
2. A cross-site scripting (XSS) vulnerability was discovered in the oEmbed discovery. Reported by xknown of the WordPress Security Team.
3. A cross-site scripting (XSS) vulnerability was discovered in the visual editor. Reported by [Rodolfo Assis (@brutelogic)](https://twitter.com/brutelogic) of Sucuri Security.
4. A path traversal vulnerability was discovered in the file unzipping code. Reported by [Alex Chapman (noxrnet)](https://hackerone.com/noxrnet).
5. A cross-site scripting (XSS) vulnerability was discovered in the plugin editor. Reported by 陈瑞琦 (Chen Ruiqi).
6. An open redirect was discovered on the user and term edit screens. Reported by [Yasin Soliman (ysx)](https://hackerone.com/ysx).
7. A path traversal vulnerability was discovered in the customizer. Reported by Weston Ruter of the WordPress Security Team.
8. A cross-site scripting (XSS) vulnerability was discovered in template names. Reported by [Luka (sikic)](https://hackerone.com/sikic).
9. A cross-site scripting (XSS) vulnerability was discovered in the link modal. Reported by [Anas Roubi (qasuar)](https://hackerone.com/qasuar).

Thank you to the reporters of these issues for practicing [responsible disclosure](https://make.wordpress.org/core/handbook/testing/reporting-security-vulnerabilities/).

In addition to the security issues above, WordPress 4.8.2 contains 6 maintenance fixes to the 4.8 release series. For more information, see the [release notes](https://codex.wordpress.org/Version_4.8.2) or consult the [list of changes](https://core.trac.wordpress.org/query?status=closed&milestone=4.8.2&group=component&col=id&col=summary&col=component&col=status&col=owner&col=type&col=priority&col=keywords&order=priority).

[Download WordPress 4.8.2](https://wordpress.org/download/) or venture over to Dashboard → Updates and simply click “Update Now.” Sites that support automatic background updates are already beginning to update to WordPress 4.8.2.

Thanks to everyone who contributed to 4.8.2.

Share this:

* [Threads](https://wordpress.org/news/2017/09/wordpress-4-8-2-security-and-maintenance-release/?share=threads&nb=1)
* [Mastodon](https://wordpress.org/news/2017/09/wordpress-4-8-2-security-and-maintenance-release/?share=mastodon&nb=1)
* [Bluesky](https://wordpress.org/news/2017/09/wordpress-4-8-2-security-and-maintenance-release/?share=bluesky&nb=1)
* [X](https://wordpress.org/news/2017/09/wordpress-4-8-2-security-and-maintenance-release/?share=x&nb=1)
* [Facebook](https://wordpress.org/news/2017/09/wordpress-4-8-2-security-and-maintenance-release/?share=facebook&nb=1)
* [LinkedIn](https://wordpress.org/news/2017/09/wordpress-4-8-2-security-and-maintenance-release/?share=linkedin&nb=1)

---

[Previous The Month in WordPress: August 2017](https://wordpress.org/news/2017/09/the-month-in-wordpress-august-2017/)
[Next Global WordPress Translation Day 3](https://wordpress.org/news/2017/09/global-wordpress-translation-day-3/)

## Get the Latest Updates

### Subscribe to WordPress News

Email Address

Subscribe

Join 18.7K other subscribers

### WP Briefing — The WordPress Podcast

Learn about where WordPress is going and how you can get involved.

* [Apple Podcasts](https://podcasts.apple.com/us/podcast/wp-briefing/id1551691710)
* [Pocket Casts](https://pca.st/uqvvmt8t)
* [RSS](https://wordpress.org/news/feed/podcast)
* [Spotify](https://open.spotify.com/show/6BxgmE9Qg2TZA8EKZLJ4zS)
* [Stitcher](https://www.stitcher.com/show/wp-briefing)

[Listen to all episodes](https://wordpress.org/news/podcast/)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Privacy](https://wordpress.org/about/privacy/)

* [Showcase](https://wordpress.org/showcase/)
* [Themes](https://wordpress.org/themes/)
* [Plugins](https://wordpress.org/plugins/)
* [Patterns](https://wordpress.org/patterns/)

* [Learn](https://learn.wordpress.org/)
* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [WordPress.tv ↗](https://wordpress.tv/)

* [Get Involved](https://make.wordpress.org/)
* [Events](https://events.wordpress.org/)
* [Donate ↗](https://wordpressfoundation.org/donate/)
* [Five for the Future](https://wordpress.org/five-for-the-future/)

* [WordPress.com ↗](https://wordpress.com/?ref=wporg-footer)
* [Matt ↗](https://ma.tt/)
* [bbPress ↗](https://bbpress.org/)
* [BuddyPress ↗](https://buddypress.org/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our X (formerly Twitter) account](https://www.x.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)
* [Visit our YouTube channel](https://www.youtube.com/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from core.trac.wordpress.org_48e6c535_20250124_213434.html ===


[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Showcase](https://wordpress.org/showcase/)
* [Hosting](https://wordpress.org/hosting/)
* Extend
  + [Themes](https://wordpress.org/themes/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Blocks](https://wordpress.org/blocks/)
  + [Openverse ↗︎](https://openverse.org/)
* Learn
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* Community
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [Events](https://events.wordpress.org/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* About
  + [About WordPress](https://wordpress.org/about/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Make WordPress Core](https://make.wordpress.org/core/)

* [Blog](https://make.wordpress.org/core/)
* [Handbook](https://make.wordpress.org/core/handbook/)
* [Tickets](https://make.wordpress.org/core/reports/)
* [Components](https://make.wordpress.org/core/components/)
* [Browse Source](https://core.trac.wordpress.org/browser "Browse Source")
* [Trac Timeline](https://core.trac.wordpress.org/timeline "Trac Timeline")
* [Create a New Ticket](https://login.wordpress.org/?redirect_to=https://core.trac.wordpress.org/newticket "Create a New Ticket")

Search:

* [Login](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fcore.trac.wordpress.org%2Fchangeset%2F41470)
* [Notifications](https://make.wordpress.org/core/notifications/)

## Context Navigation

* ← [Previous Changeset](/changeset/41469 "Changeset 41469")
* [Next Changeset](/changeset/41471 "Changeset 41471") →

---

# Changeset 41470

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
09/19/2017 02:47:46 PM
([7 years](/timeline?from=2017-09-19T14%3A47%3A46Z&precision=second "See timeline at 09/19/2017 02:47:46 PM") ago)

Author:
aaroncampbell
Message:

Database: Hardening for `wpdb::prepare()`

Previously if you passed an array of values for placeholders, additional values could be passed as well. Now additional values will be ignored.

Location:
[trunk](/browser/trunk?rev=41470)
Files:

2 edited

* [src/wp-includes/wp-db.php](/browser/trunk/src/wp-includes/wp-db.php?rev=41470 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))
* [tests/phpunit/tests/db.php](/browser/trunk/tests/phpunit/tests/db.php?rev=41470 "Show entry in browser")
  (modified)
  ([1 diff](#file1 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [trunk/src/wp-includes/wp-db.php](/changeset/41470/trunk/src/wp-includes/wp-db.php "Show the changeset 41470 restricted to trunk/src/wp-includes/wp-db.php")

  | [r41241](/browser/trunk/src/wp-includes/wp-db.php?rev=41241#L1237 "Show revision 41241 of this file in browser") | [r41470](/browser/trunk/src/wp-includes/wp-db.php?rev=41470#L1237 "Show revision 41470 of this file in browser") |  |
  | --- | --- | --- |
  | 1237 | 1237 | $args = func\_get\_args(); |
  | 1238 | 1238 | array\_shift( $args ); |
  |  | 1239 |  |
  | 1239 | 1240 | // If args were passed as an array (as in vsprintf), move them up |
  | 1240 |  | if ( is~~set( $args[0] ) && is\_array($args[0]) )~~ |
  |  | 1241 | if ( is\_array( $args[0] ) && count( $args ) == 1 ) { |
  | 1241 | 1242 | $args = $args[0]; |
  |  | 1243 | } |
  |  | 1244 |  |
  |  | 1245 | foreach ( $args as $arg ) { |
  |  | 1246 | if ( ! is\_scalar( $arg ) ) { |
  |  | 1247 | \_doing\_it\_wrong( 'wpdb::prepare', sprintf( \_\_( 'Unsupported value type (%s).' ), gettype( $arg ) ), '4.8.2' ); |
  |  | 1248 | } |
  |  | 1249 | } |
  |  | 1250 |  |
  | 1242 | 1251 | $query = str\_replace( "'%s'", '%s', $query ); // in case someone mistakenly already singlequoted it |
  | 1243 | 1252 | $query = str\_replace( '"%s"', '%s', $query ); // doublequote unquoting |
* ## [trunk/tests/phpunit/tests/db.php](/changeset/41470/trunk/tests/phpunit/tests/db.php "Show the changeset 41470 restricted to trunk/tests/phpunit/tests/db.php")

  | [r40544](/browser/trunk/tests/phpunit/tests/db.php?rev=40544#L355 "Show revision 40544 of this file in browser") | [r41470](/browser/trunk/tests/phpunit/tests/db.php?rev=41470#L355 "Show revision 41470 of this file in browser") |  |
  | --- | --- | --- |
  | 355 | 355 | } |
  | 356 | 356 |  |
  |  | 357 | function test\_prepare\_sprintf() { |
  |  | 358 | global $wpdb; |
  |  | 359 |  |
  |  | 360 | $prepared = $wpdb->prepare( "SELECT \* FROM $wpdb->users WHERE id = %d AND user\_login = %s", 1, "admin" ); |
  |  | 361 | $this->assertEquals( "SELECT \* FROM $wpdb->users WHERE id = 1 AND user\_login = 'admin'", $prepared ); |
  |  | 362 | } |
  |  | 363 |  |
  |  | 364 | /\*\* |
  |  | 365 | \* @expectedIncorrectUsage wpdb::prepare |
  |  | 366 | \*/ |
  |  | 367 | function test\_prepare\_sprintf\_invalid\_args() { |
  |  | 368 | global $wpdb; |
  |  | 369 |  |
  |  | 370 | $prepared = @$wpdb->prepare( "SELECT \* FROM $wpdb->users WHERE id = %d AND user\_login = %s", 1, array( "admin" ) ); |
  |  | 371 | $this->assertEquals( "SELECT \* FROM $wpdb->users WHERE id = 1 AND user\_login = ''", $prepared ); |
  |  | 372 |  |
  |  | 373 | $prepared = @$wpdb->prepare( "SELECT \* FROM $wpdb->users WHERE id = %d AND user\_login = %s", array( 1 ), "admin" ); |
  |  | 374 | $this->assertEquals( "SELECT \* FROM $wpdb->users WHERE id = 0 AND user\_login = 'admin'", $prepared ); |
  |  | 375 | } |
  |  | 376 |  |
  |  | 377 | function test\_prepare\_vsprintf() { |
  |  | 378 | global $wpdb; |
  |  | 379 |  |
  |  | 380 | $prepared = $wpdb->prepare( "SELECT \* FROM $wpdb->users WHERE id = %d AND user\_login = %s", array( 1, "admin" ) ); |
  |  | 381 | $this->assertEquals( "SELECT \* FROM $wpdb->users WHERE id = 1 AND user\_login = 'admin'", $prepared ); |
  |  | 382 | } |
  |  | 383 |  |
  |  | 384 | /\*\* |
  |  | 385 | \* @expectedIncorrectUsage wpdb::prepare |
  |  | 386 | \*/ |
  |  | 387 | function test\_prepare\_vsprintf\_invalid\_args() { |
  |  | 388 | global $wpdb; |
  |  | 389 |  |
  |  | 390 | $prepared = @$wpdb->prepare( "SELECT \* FROM $wpdb->users WHERE id = %d AND user\_login = %s", array( 1, array( "admin" ) ) ); |
  |  | 391 | $this->assertEquals( "SELECT \* FROM $wpdb->users WHERE id = 1 AND user\_login = ''", $prepared ); |
  |  | 392 |  |
  |  | 393 | $prepared = @$wpdb->prepare( "SELECT \* FROM $wpdb->users WHERE id = %d AND user\_login = %s", array( array( 1 ), "admin" ) ); |
  |  | 394 | $this->assertEquals( "SELECT \* FROM $wpdb->users WHERE id = 0 AND user\_login = 'admin'", $prepared ); |
  |  | 395 | } |
  |  | 396 |  |
  | 357 | 397 | function test\_db\_version() { |
  | 358 | 398 | global $wpdb; |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=41470)
* [Zip Archive](?format=zip&new=41470)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Privacy](https://wordpress.org/about/privacy/)

* [Showcase](https://wordpress.org/showcase/)
* [Themes](https://wordpress.org/themes/)
* [Plugins](https://wordpress.org/plugins/)
* [Patterns](https://wordpress.org/patterns/)

* [Learn](https://learn.wordpress.org/)
* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [WordPress.tv ↗](https://wordpress.tv/)

* [Get Involved](https://make.wordpress.org/)
* [Events](https://events.wordpress.org/)
* [Donate ↗](https://wordpressfoundation.org/donate/)
* [Five for the Future](https://wordpress.org/five-for-the-future/)

* [WordPress.com ↗](https://wordpress.com/?ref=wporg-footer)
* [Matt ↗](https://ma.tt/)
* [bbPress ↗](https://bbpress.org/)
* [BuddyPress ↗](https://buddypress.org/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our X (formerly Twitter) account](https://www.x.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)
* [Visit our YouTube channel](https://www.youtube.com/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from github.com_66a5d0d9_20250124_213437.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FWordPress%2FWordPress%2Fcommit%2Ffc930d3daed1c3acef010d04acc2c5de93cd18ec)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FWordPress%2FWordPress%2Fcommit%2Ffc930d3daed1c3acef010d04acc2c5de93cd18ec)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=WordPress%2FWordPress)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[WordPress](/WordPress)
/
**[WordPress](/WordPress/WordPress)**
Public

* [Notifications](/login?return_to=%2FWordPress%2FWordPress) You must be signed in to change notification settings
* [Fork
  12.7k](/login?return_to=%2FWordPress%2FWordPress)
* [Star
   19.8k](/login?return_to=%2FWordPress%2FWordPress)

* [Code](/WordPress/WordPress)
* [Pull requests
  0](/WordPress/WordPress/pulls)
* [Actions](/WordPress/WordPress/actions)
* [Security](/WordPress/WordPress/security)
* [Insights](/WordPress/WordPress/pulse)

Additional navigation options

* [Code](/WordPress/WordPress)
* [Pull requests](/WordPress/WordPress/pulls)
* [Actions](/WordPress/WordPress/actions)
* [Security](/WordPress/WordPress/security)
* [Insights](/WordPress/WordPress/pulse)

## Commit

[Permalink](/WordPress/WordPress/commit/fc930d3daed1c3acef010d04acc2c5de93cd18ec)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Database: Hardening to bring `wpdb::prepare()` inline with documentat…

[Browse files](/WordPress/WordPress/tree/fc930d3daed1c3acef010d04acc2c5de93cd18ec)
Browse the repository at this point in the history

```
…ion.

`wpdb::prepare()` supports %s, %d, and %F as placeholders in the query string. Any other non-escaped % will be escaped.

Built from [https://develop.svn.wordpress.org/trunk@41496](https://develop.svn.wordpress.org/trunk%4041496)

git-svn-id: [http://core.svn.wordpress.org/trunk@41329](http://core.svn.wordpress.org/trunk%4041329) 1a063a9b-81f0-0310-95a4-ce76da25c4cd
```

* Loading branch information

[![@aaroncampbell](https://avatars.githubusercontent.com/u/802412?s=40&v=4)](/aaroncampbell)

[aaroncampbell](/WordPress/WordPress/commits?author=aaroncampbell "View all commits by aaroncampbell")
committed
Sep 19, 2017

1 parent
[5225e02](/WordPress/WordPress/commit/5225e026ef497bb96c9ce167a842270236db283a)

commit fc930d3

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**4 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* wp-includes

  + wp-includes/version.php
    [version.php](#diff-e3321c16995a4342da7495e1e3840612b6d91de979b5250c777baf2a40dccfbd)
  + wp-includes/wp-db.php
    [wp-db.php](#diff-2c36931849eb4c257c002717728d28b9026f52ccd423e55b5d15f139a4752fea)

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[wp-includes/version.php](#diff-e3321c16995a4342da7495e1e3840612b6d91de979b5250c777baf2a40dccfbd "wp-includes/version.php")

Show comments

[View file](/WordPress/WordPress/blob/fc930d3daed1c3acef010d04acc2c5de93cd18ec/wp-includes/version.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -4,7 +4,7 @@ |
|  |  | \* |
|  |  | \* @global string $wp\_version |
|  |  | \*/ |
|  |  | $wp\_version = '4.9-alpha-41483'; |
|  |  | $wp\_version = '4.9-alpha-41496'; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Holds the WordPress DB revision, increments when changes are made to the WordPress DB schema. |
| Expand Down | |  |

4 changes: 3 additions & 1 deletion

4
[wp-includes/wp-db.php](#diff-2c36931849eb4c257c002717728d28b9026f52ccd423e55b5d15f139a4752fea "wp-includes/wp-db.php")

Show comments

[View file](/WordPress/WordPress/blob/fc930d3daed1c3acef010d04acc2c5de93cd18ec/wp-includes/wp-db.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1252,6 +1252,7 @@ public function prepare( $query, $args ) { |
|  |  | $query = str\_replace( '"%s"', '%s', $query ); // doublequote unquoting |
|  |  | $query = preg\_replace( '|(?<!%)%f|' , '%F', $query ); // Force floats to be locale unaware |
|  |  | $query = preg\_replace( '|(?<!%)%s|', "'%s'", $query ); // quote the strings, avoiding escaped strings like %%s |
|  |  | $query = preg\_replace( '/%(?:%|$|([^dsF]))/', '%%\\1', $query ); // escape any unescaped percents |
|  |  | array\_walk( $args, array( $this, 'escape\_by\_ref' ) ); |
|  |  | return @vsprintf( $query, $args ); |
|  |  | } |
| Expand Down  Expand Up | | @@ -2821,7 +2822,8 @@ protected function strip\_invalid\_text( $data ) { |
|  |  | } |
|  |  |  |
|  |  | if ( is\_array( $value['length'] ) ) { |
|  |  | $queries[ $col ] = $this->prepare( "CONVERT( LEFT( CONVERT( %s USING $charset ), %.0f ) USING $connection\_charset )", $value['value'], $value['length']['length'] ); |
|  |  | $length = sprintf( '%.0f', $value['length']['length'] ); |
|  |  | $queries[ $col ] = $this->prepare( "CONVERT( LEFT( CONVERT( %s USING $charset ), $length ) USING $connection\_charset )", $value['value'] ); |
|  |  | } else if ( 'binary' !== $charset ) { |
|  |  | // If we don't have a length, there's no need to convert binary - it will always return the same result. |
|  |  | $queries[ $col ] = $this->prepare( "CONVERT( CONVERT( %s USING $charset ) USING $connection\_charset )", $value['value'] ); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `fc930d3`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FWordPress%2FWordPress%2Fcommit%2Ffc930d3daed1c3acef010d04acc2c5de93cd18ec) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from core.trac.wordpress.org_ad2cc896_20250124_213435.html ===


[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Showcase](https://wordpress.org/showcase/)
* [Hosting](https://wordpress.org/hosting/)
* Extend
  + [Themes](https://wordpress.org/themes/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Blocks](https://wordpress.org/blocks/)
  + [Openverse ↗︎](https://openverse.org/)
* Learn
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* Community
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [Events](https://events.wordpress.org/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* About
  + [About WordPress](https://wordpress.org/about/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Make WordPress Core](https://make.wordpress.org/core/)

* [Blog](https://make.wordpress.org/core/)
* [Handbook](https://make.wordpress.org/core/handbook/)
* [Tickets](https://make.wordpress.org/core/reports/)
* [Components](https://make.wordpress.org/core/components/)
* [Browse Source](https://core.trac.wordpress.org/browser "Browse Source")
* [Trac Timeline](https://core.trac.wordpress.org/timeline "Trac Timeline")
* [Create a New Ticket](https://login.wordpress.org/?redirect_to=https://core.trac.wordpress.org/newticket "Create a New Ticket")

Search:

* [Login](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fcore.trac.wordpress.org%2Fchangeset%2F41496)
* [Notifications](https://make.wordpress.org/core/notifications/)

## Context Navigation

* ← [Previous Changeset](/changeset/41495 "Changeset 41495")
* [Next Changeset](/changeset/41497 "Changeset 41497") →

---

# Changeset 41496

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
09/19/2017 05:55:33 PM
([7 years](/timeline?from=2017-09-19T17%3A55%3A33Z&precision=second "See timeline at 09/19/2017 05:55:33 PM") ago)

Author:
aaroncampbell
Message:

Database: Hardening to bring `wpdb::prepare()` inline with documentation.

`wpdb::prepare()` supports %s, %d, and %F as placeholders in the query string. Any other non-escaped % will be escaped.

Location:
[trunk](/browser/trunk?rev=41496)
Files:

2 edited

* [src/wp-includes/wp-db.php](/browser/trunk/src/wp-includes/wp-db.php?rev=41496 "Show entry in browser")
  (modified)
  ([2 diffs](#file0 "Show differences"))
* [tests/phpunit/tests/db.php](/browser/trunk/tests/phpunit/tests/db.php?rev=41496 "Show entry in browser")
  (modified)
  ([2 diffs](#file1 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [trunk/src/wp-includes/wp-db.php](/changeset/41496/trunk/src/wp-includes/wp-db.php "Show the changeset 41496 restricted to trunk/src/wp-includes/wp-db.php")

  | [r41483](/browser/trunk/src/wp-includes/wp-db.php?rev=41483#L1253 "Show revision 41483 of this file in browser") | [r41496](/browser/trunk/src/wp-includes/wp-db.php?rev=41496#L1253 "Show revision 41496 of this file in browser") |  |
  | --- | --- | --- |
  | 1253 | 1253 | $query = preg\_replace( '|(?<!%)%f|' , '%F', $query ); // Force floats to be locale unaware |
  | 1254 | 1254 | $query = preg\_replace( '|(?<!%)%s|', "'%s'", $query ); // quote the strings, avoiding escaped strings like %%s |
  |  | 1255 | $query = preg\_replace( '/%(?:%|$|([^dsF]))/', '%%\\1', $query ); // escape any unescaped percents |
  | 1255 | 1256 | array\_walk( $args, array( $this, 'escape\_by\_ref' ) ); |
  | 1256 | 1257 | return @vsprintf( $query, $args ); |
  | […](/browser/trunk/src/wp-includes/wp-db.php?rev=41483#L2822) | […](/browser/trunk/src/wp-includes/wp-db.php?rev=41496#L2823) |  |
  | 2822 | 2823 |  |
  | 2823 | 2824 | if ( is\_array( $value['length'] ) ) { |
  | 2824 |  | $queries[ $col ] = $this->prepare( "CONVERT( LEFT( CONVERT( %s USING $charset ), %.0f ) USING $connection\_charset )", $value['value'], $value['length']['length'] ); |
  |  | 2825 | $length = sprintf( '%.0f', $value['length']['length'] ); |
  |  | 2826 | $queries[ $col ] = $this->prepare( "CONVERT( LEFT( CONVERT( %s USING $charset ), $length ) USING $connection\_charset )", $value['value'] ); |
  | 2825 | 2827 | } else if ( 'binary' !== $charset ) { |
  | 2826 | 2828 | // If we don't have a length, there's no need to convert binary - it will always return the same result. |
* ## [trunk/tests/phpunit/tests/db.php](/changeset/41496/trunk/tests/phpunit/tests/db.php "Show the changeset 41496 restricted to trunk/tests/phpunit/tests/db.php")

  | [r41470](/browser/trunk/tests/phpunit/tests/db.php?rev=41470#L274 "Show revision 41470 of this file in browser") | [r41496](/browser/trunk/tests/phpunit/tests/db.php?rev=41496#L274 "Show revision 41496 of this file in browser") |  |
  | --- | --- | --- |
  | 274 | 274 | } |
  | 275 | 275 |  |
  |  | 276 |  |
  | 276 | 277 | /\*\* |
  | 277 | 278 | \* Test that SQL modes are set correctly |
  | […](/browser/trunk/tests/phpunit/tests/db.php?rev=41470#L1116) | […](/browser/trunk/tests/phpunit/tests/db.php?rev=41496#L1117) |  |
  | 1116 | 1117 | $this->assertSame( 'utf8\_general\_ci', $result['collate'] ); |
  | 1117 | 1118 | } |
  |  | 1119 |  |
  |  | 1120 | /\*\* |
  |  | 1121 | \* |
  |  | 1122 | \*/ |
  |  | 1123 | function test\_prepare\_with\_unescaped\_percents() { |
  |  | 1124 | global $wpdb; |
  |  | 1125 |  |
  |  | 1126 | $sql = $wpdb->prepare( '%d %1$d %%% %', 1 ); |
  |  | 1127 | $this->assertEquals( '1 %1$d %% %', $sql ); |
  |  | 1128 | } |
  | 1118 | 1129 | } |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=41496)
* [Zip Archive](?format=zip&new=41496)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Privacy](https://wordpress.org/about/privacy/)

* [Showcase](https://wordpress.org/showcase/)
* [Themes](https://wordpress.org/themes/)
* [Plugins](https://wordpress.org/plugins/)
* [Patterns](https://wordpress.org/patterns/)

* [Learn](https://learn.wordpress.org/)
* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [WordPress.tv ↗](https://wordpress.tv/)

* [Get Involved](https://make.wordpress.org/)
* [Events](https://events.wordpress.org/)
* [Donate ↗](https://wordpressfoundation.org/donate/)
* [Five for the Future](https://wordpress.org/five-for-the-future/)

* [WordPress.com ↗](https://wordpress.com/?ref=wporg-footer)
* [Matt ↗](https://ma.tt/)
* [bbPress ↗](https://bbpress.org/)
* [BuddyPress ↗](https://buddypress.org/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our X (formerly Twitter) account](https://www.x.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)
* [Visit our YouTube channel](https://www.youtube.com/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


