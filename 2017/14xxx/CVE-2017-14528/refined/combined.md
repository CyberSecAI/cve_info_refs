=== Content from lists.debian.org_0e361f5b_20250125_175841.html ===


---

[[Date Prev](msg00009.html)][[Date Next](msg00011.html)]
[[Thread Prev](msg00009.html)][[Thread Next](msg00011.html)]
[[Date Index](maillist.html#00010)]
[[Thread Index](threads.html#00010)]

# [SECURITY] [DLA 2523-1] imagemagick security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 2523-1] imagemagick security update
* *From*: Sylvain Beucler <beuc@beuc.net>
* *Date*: Tue, 12 Jan 2021 18:43:56 +0100
* *Message-id*: <[[🔎]](/msgid-search/20210112174356.GA5462%40mail.beuc.net) [20210112174356.GA5462@mail.beuc.net](msg00010.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian LTS Advisory DLA-2523-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>
January 12, 2021                              <https://wiki.debian.org/LTS>
- -------------------------------------------------------------------------

Package        : imagemagick
Version        : 8:6.9.7.4+dfsg-11+deb9u11
CVE ID         : CVE-2017-14528 CVE-2020-19667 CVE-2020-25665 CVE-2020-25674
                 CVE-2020-27560 CVE-2020-27750 CVE-2020-27760 CVE-2020-27763
                 CVE-2020-27765 CVE-2020-27773 CVE-2020-29599
Debian Bug     : 878544 972797 977205

Several security vulnerabilities were found in ImageMagick, a suite of
image manipulation programs. An attacker could cause denial of service
and execution of arbitrary code when a crafted image file is
processed.

CVE-2017-14528

    The TIFFSetProfiles function in coders/tiff.c has incorrect
    expectations about whether LibTIFF TIFFGetField return values
    imply that data validation has occurred, which allows remote
    attackers to cause a denial of service (use-after-free after an
    invalid call to TIFFSetField, and application crash) via a crafted
    file.

CVE-2020-19667

    Stack-based buffer overflow and unconditional jump in ReadXPMImage
    in coders/xpm.c

CVE-2020-25665

    The PALM image coder at coders/palm.c makes an improper call to
    AcquireQuantumMemory() in routine WritePALMImage() because it
    needs to be offset by 256. This can cause a out-of-bounds read
    later on in the routine. This could cause impact to reliability.

CVE-2020-25674

    WriteOnePNGImage() from coders/png.c (the PNG coder) has a for
    loop with an improper exit condition that can allow an
    out-of-bounds READ via heap-buffer-overflow. This occurs because
    it is possible for the colormap to have less than 256 valid values
    but the loop condition will loop 256 times, attempting to pass
    invalid colormap data to the event logger.

CVE-2020-27560

    ImageMagick allows Division by Zero in OptimizeLayerFrames in
    MagickCore/layer.c, which may cause a denial of service.

CVE-2020-27750

    A flaw was found in MagickCore/colorspace-private.h and
    MagickCore/quantum.h. An attacker who submits a crafted file that
    is processedcould trigger undefined behavior in the form of values
    outside the range of type `unsigned char` and math division by
    zero. This would most likely lead to an impact to application
    availability, but could potentially cause other problems related
    to undefined behavior.

CVE-2020-27760

    In `GammaImage()` of /MagickCore/enhance.c, depending on the
    `gamma` value, it's possible to trigger a divide-by-zero condition
    when a crafted input file is processed by ImageMagick. This could
    lead to an impact to application availability.

CVE-2020-27763

    A flaw was found in MagickCore/resize.c. An attacker who submits a
    crafted file that is processed by ImageMagick could trigger
    undefined behavior in the form of math division by zero. This
    would most likely lead to an impact to application availability,
    but could potentially cause other problems related to undefined
    behavior.

CVE-2020-27765

    A flaw was found in MagickCore/segment.c. An attacker who submits
    a crafted file that is processed by ImageMagick could trigger
    undefined behavior in the form of math division by zero. This
    would most likely lead to an impact to application availability,
    but could potentially cause other problems related to undefined
    behavior.

CVE-2020-27773

    A flaw was found in MagickCore/gem-private.h. An attacker who
    submits a crafted file that is processed by ImageMagick could
    trigger undefined behavior in the form of values outside the range
    of type `unsigned char` or division by zero. This would most
    likely lead to an impact to application availability, but could
    potentially cause other problems related to undefined behavior.

CVE-2020-29599

    ImageMagick mishandles the -authenticate option, which allows
    setting a password for password-protected PDF files. The
    user-controlled password was not properly escaped/sanitized and it
    was therefore possible to inject additional shell commands via
    coders/pdf.c.

For Debian 9 stretch, these problems have been fixed in version
8:6.9.7.4+dfsg-11+deb9u11.

We recommend that you upgrade your imagemagick packages.

For the detailed security status of imagemagick please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/imagemagick>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>
-----BEGIN PGP SIGNATURE-----

iQEzBAEBCgAdFiEEQic8GuN/xDR88HkSj/HLbo2JBZ8FAl/93REACgkQj/HLbo2J
BZ9dTwf+OquA6Hn9JslevO+QRmx5TQw/8WwhsVRTylhPX1BE7WxCy2UDzwmECQVq
e2AihD3//rJovN8RMNxnpMbuOCAMaAZRQTTQHbgX7jJBdzj47EEvmtdNxYDzoa1v
BlQkUpvVoLQcui+4HQJxk8ZpxygE9xPow57N05Fy7HZvcd2wBm9V2wkvpS4qu+VR
BqYDuSY3NiAIaRlGs5kC+AHFZ8X8cmi1RTEGko5A8PYLuYcd4ErqhwxvoIH+kK0t
rP3gA1wPwm1W+d/GZ2hiShqcW6W0EndIBHCFGOqfP09lIKGOdjBqNY5xm2dlXOa0
TWt0guMN8IfQILglaIqqH32bY0xaOg==
=SMWK
-----END PGP SIGNATURE-----

```

---



=== Content from www.imagemagick.org_bae6b10d_20250125_175843.html ===


# Legacy ImageMagick Discussions Archive

Use https://github.com/ImageMagick/ImageMagick/discussions instead.

[Skip to content](#start_here)

Search

[Advanced search](./search.php "Advanced search")

* Quick links

  + [Unanswered topics](./search.php?search_id=unanswered)
  + [Active topics](./search.php?search_id=active_topics)
  + [Search](./search.php)
* [FAQ](/discourse-server/app.php/help/faq "Frequently Asked Questions")
* [Login](./ucp.php?mode=login&redirect=viewtopic.php%3Ff%3D3%26t%3D32560 "Login")

* [Magick](https://imagemagick.org)
  [Board index](./index.php)
  [ImageMagick](./viewforum.php?f=14)
  [Bugs](./viewforum.php?f=3)
* [Search](./search.php "View the advanced search options")

## [Use-after-free in TIFFSetField()](./viewtopic.php?t=32560)

Post any defects you find in the released or beta versions of the ImageMagick software here. Include the ImageMagick version, OS, and any command-line required to reproduce the problem. Got a patch for a bug? Post it here.

[Post Reply](./posting.php?mode=reply&t=32560 "Post a reply")

* [Print view](./viewtopic.php?t=32560&view=print "Print view")

Search

[Advanced search](./search.php "Advanced search")

4 posts
• Page **1** of **1**

[fumfel](./memberlist.php?mode=viewprofile&u=33428)
**Posts:** [12](./search.php?author_id=33428&sr=posts) **Joined:** 2016-09-20T06:30:11-07:00
**Authentication code:** 1151

### [Use-after-free in TIFFSetField()](./viewtopic.php?p=149062#p149062)

* [Quote](./posting.php?mode=quote&p=149062 "Reply with quote")

[Post](./viewtopic.php?p=149062#p149062 "Post")
by **[fumfel](./memberlist.php?mode=viewprofile&u=33428)** » 2017-08-23T08:38:02-07:00

More details and faulting test case: <http://bugzilla.maptools.org/show_bug.cgi?id=2730>
Regards,

Kamil Frankowicz

[Top](#top "Top")

[![User avatar](./download/file.php?avatar=2_1655996059.jpg)](./memberlist.php?mode=viewprofile&u=2)
[magick](./memberlist.php?mode=viewprofile&u=2)
Site Admin
**Posts:** [11064](./search.php?author_id=2&sr=posts) **Joined:** 2003-05-31T11:32:55-07:00

### [Re: Use-after-free in TIFFSetField()](./viewtopic.php?p=149063#p149063)

* [Quote](./posting.php?mode=quote&p=149063 "Reply with quote")

[Post](./viewtopic.php?p=149063#p149063 "Post")
by **[magick](./memberlist.php?mode=viewprofile&u=2)** » 2017-08-23T10:28:22-07:00

The stack trace shows the fault occurs withing the libTIFF delegate library. ImageMagick calls libTIFF's TIFFGetField() to obtain a private tag profile 37724 (used by Adobe). TIFFGetField() returns success with a length of 9908 bytes and a data buffer to the location of the profile. Unfortunately the data buffer is corrupt. The fix to this problem lies within the TIFF delegate library, libTIFF. If the 37724 profile is corrupt, libTIFF should return something other than success (1) for TIFFGetField(). If it does return success, the associated data buffer should be valid and subsequently touching it would not return a fault.

[Top](#top "Top")

[fumfel](./memberlist.php?mode=viewprofile&u=33428)
**Posts:** [12](./search.php?author_id=33428&sr=posts) **Joined:** 2016-09-20T06:30:11-07:00
**Authentication code:** 1151

### [Re: Use-after-free in TIFFSetField()](./viewtopic.php?p=149446#p149446)

* [Quote](./posting.php?mode=quote&p=149446 "Reply with quote")

[Post](./viewtopic.php?p=149446#p149446 "Post")
by **[fumfel](./memberlist.php?mode=viewprofile&u=33428)** » 2017-09-04T12:28:14-07:00

Reply from LibTIFF developer: <http://bugzilla.maptools.org/show_bug.cgi?id=2730#c3>
Regards,

Kamil Frankowicz

[Top](#top "Top")

[![User avatar](./download/file.php?avatar=2_1655996059.jpg)](./memberlist.php?mode=viewprofile&u=2)
[magick](./memberlist.php?mode=viewprofile&u=2)
Site Admin
**Posts:** [11064](./search.php?author_id=2&sr=posts) **Joined:** 2003-05-31T11:32:55-07:00

### [Re: Use-after-free in TIFFSetField()](./viewtopic.php?p=149448#p149448)

* [Quote](./posting.php?mode=quote&p=149448 "Reply with quote")

[Post](./viewtopic.php?p=149448#p149448 "Post")
by **[magick](./memberlist.php?mode=viewprofile&u=2)** » 2017-09-04T13:52:39-07:00

Can you try the latest release of ImageMagick, 6.9.9-11? We tried your test case and it returned gracefully:

Code: Select all

```
$ convert tiff_uaf_TIFFSetField test.tif
convert: Incorrect value for "ICC Profile"; tag ignored. `TIFFFetchNormalTag' @ warning/tiff.c/TIFFWarnings/921.
convert: unable to decompress image `tiff_uaf_TIFFSetField' @ error/psd.c/ReadPSDChannel/1385.
```

[Top](#top "Top")

[Post Reply](./posting.php?mode=reply&t=32560 "Post a reply")

* [Print view](./viewtopic.php?t=32560&view=print "Print view")

Display: All posts1 day7 days2 weeks1 month3 months6 months1 year
Sort by: AuthorPost timeSubject
Direction: AscendingDescending

---

4 posts
• Page **1** of **1**

[Return to “Bugs”](./viewforum.php?f=3)

Jump to

* [ImageMagick](./viewforum.php?f=14)
* [↳   Users](./viewforum.php?f=1)
* [↳   Developers](./viewforum.php?f=2)
* [↳   Bugs](./viewforum.php?f=3)
* [↳   Consulting](./viewforum.php?f=24)
* [↳   Kudos and Rants](./viewforum.php?f=19)
* [↳   Announce](./viewforum.php?f=4)
* [ImageMagick Program Interfaces](./viewforum.php?f=15)
* [↳   MagickWand](./viewforum.php?f=6)
* [↳   Magick++](./viewforum.php?f=23)
* [↳   PerlMagick](./viewforum.php?f=7)
* [↳   IMagick](./viewforum.php?f=18)
* [↳   MagickWand for PHP](./viewforum.php?f=10)
* [↳   Windows COM+ & Visual Basic](./viewforum.php?f=8)
* [↳   Magick Scripting Language](./viewforum.php?f=9)
* [↳   Magick.NET](./viewforum.php?f=27)
* [ImageMagick Studio Web Interface](./viewforum.php?f=16)
* [↳   MagickStudio](./viewforum.php?f=5)
* [Digital Image Processing](./viewforum.php?f=21)
* [↳   Digital Image Processing](./viewforum.php?f=22)
* [↳   Fred's Scripts](./viewforum.php?f=26)

* [Magick](https://imagemagick.org) [Board index](./index.php)
* All times are UTC-07:00
* [Delete cookies](/discourse-server/app.php/user/delete_cookies)

Powered by [phpBB](https://www.phpbb.com/)® Forum Software © phpBB Limited

[Privacy](./ucp.php?mode=privacy "Privacy")
|
[Terms](./ucp.php?mode=terms "Terms")

###



=== Content from wiki.debian.org_8d48714b_20250126_104751.html ===

[![Debian](https://www.debian.org/Pics/openlogo-50.png)](https://www.debian.org "Debian Homepage")

[Wiki](/FrontPage "Debian Wiki Homepage")

[Login](/LTS?action=login)

* [FrontPage](/FrontPage)
* [RecentChanges](/RecentChanges)
* [FindPage](/FindPage)
* [HelpContents](/HelpContents)
* [LTS](/LTS)

Search:

[![Debian](https://www.debian.org/Pics/openlogo-50.png)](https://www.debian.org "Debian Homepage")
[Wiki](/FrontPage "Debian Wiki Homepage")/

* [Login](/LTS?action=login)
* Comments
* [Info](/LTS?action=info)
* [Attachments](/LTS?action=AttachFile)
* More Actions:
  Raw Text
  Print View
  Render as Docbook
  Delete Cache
  ------------------------
  Check Spelling
  Like Pages
  Local Site Map
  ------------------------
  Rename Page
  Delete Page
  ------------------------
  Subscribe User
  ------------------------
  Remove Spam
  Revert to this revision
  Package Pages
  ------------------------
  Load
  Save
  SlideShow

# * [LTS](/LTS)

[Translation(s)](/DebianWiki/EditorGuide#translation): [English](/LTS) - [Deutsch](/de/LTS) - [Español](/es/LTS) - [Français](/fr/LTS) - [Italiano](/it/LTS) - [한국어](/ko/LTS) - [Português](/pt/LTS) - [Português (Brasil)](/pt_BR/LTS) - [Русский](/ru/LTS)

# Debian Long Term Support

Debian Long Term Support (LTS) is a project to extend the lifetime of all Debian stable releases to (at least) 5 years. Debian LTS is not handled by the Debian Security and Release teams, but by a separate group of volunteers and companies interested in making it a success.

Thus the Debian LTS team takes over security maintenance of the various releases once the Debian Security team stops its work.

![/!\](/htdocs/debwiki/img/alert.png "/!\")

LTS ([last modified 2024-08-15 02:46:47](/LTS?action=info))

* Debian [privacy policy](https://www.debian.org/legal/privacy), Wiki [team](/Teams/DebianWiki), [bugs](https://bugs.debian.org/wiki.debian.org) and [config](https://salsa.debian.org/debian/wiki.debian.org).
* Powered by [MoinMoin](https://moinmo.in/ "This site uses the MoinMoin Wiki software.") and [Python](https://moinmo.in/Python "MoinMoin is written in Python."), with hosting provided by [Metropolitan Area Network Darmstadt](https://www.man-da.de/).



=== Content from bugzilla.maptools.org_70a0fe2a_20250125_175841.html ===


|  |
| --- |

* [Home](./)
* | [New](enter_bug.cgi)
* | [Search](query.cgi)
* |
* | [Reports](report.cgi)
* | [New Account](createaccount.cgi)
* |
  [Help](docs/en/html/bug_page.html)
* | [Log In](http://bugzilla.maptools.org/show_bug.cgi?id=2730&GoAheadAndLogIn=1)

*First*
*Last*
*Prev*
*Next*

*No search results available*

[**Bug 2730**](show_bug.cgi?id=2730) -
Use-after-free in TIFFSetField()

| Summary: | Use-after-free in TIFFSetField() |
| --- | --- |

| | **[Status](page.cgi?id=fields.html#status)**: | RESOLVED INVALID | | --- | --- | |  | | | **Product**: | libtiff | | **[Component](describecomponents.cgi?product=libtiff):** | default | | **Version**: | unspecified | | **Platform**: | PC Linux | |  | | | **[Importance](page.cgi?id=fields.html#importance)**: | P2 normal | | **Target Milestone**: | --- | | **[Assigned To](page.cgi?id=fields.html#assigned_to)**: | Frank Warmerdam | |  | | | **URL**: |  | | **Whiteboard**: |  | | | **[Keywords](describekeywords.cgi)**: |  | | |  | | | Depends on: |  | | Blocks: |  ||  | Show dependency [tree](showdependencytree.cgi?id=2730&hide_resolved=1) / [graph](showdependencygraph.cgi?id=2730) | | |  | | **Reported**: | 2017-08-23 04:04 by Kamil Frankowicz | | --- | --- | | **Modified**: | 2017-09-02 07:15 ([History](show_activity.cgi?id=2730)) | |  | | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| Attachments | |
| --- | --- |
| [**POC to trigger use-after-free**](attachment.cgi?id=810 "View the content of the attachment") (22.14 KB, application/octet-stream)  [2017-08-23 04:04](#attach_810 "Go to the comment associated with the attachment"), Kamil Frankowicz | [Details](attachment.cgi?id=810&action=edit) |
| [Add an attachment](attachment.cgi?bugid=2730&action=enter) (proposed patch, testcase, etc.) | |

| Note You need to [log in](show_bug.cgi?id=2730&GoAheadAndLogIn=1) before you can comment on or make changes to this bug.   ---   *[Description](show_bug.cgi?id=2730#c0) From Kamil Frankowicz  2017-08-23 04:04:28* ``` [Created an attachment (id=810)](attachment.cgi?id=810 "POC to trigger use-after-free") [[details]](attachment.cgi?id=810&action=edit "POC to trigger use-after-free") POC to trigger use-after-free  After some ImageMagick fuzz testing I found a crashing test case.  Version: 4.0.8  To reproduce (with IM): convert tiff_uaf_TIFFSetField /dev/null  ASAN:  ==22901==ERROR: AddressSanitizer: heap-use-after-free on address 0x62400000e100 at pc 0x000000432770 bp 0x7ffca10cbba0 sp 0x7ffca10cb348 READ of size 3544 at 0x62400000e100 thread T0     #0 0x43276f in memcpy /scratch/llvm/clang-4/xenial/final/llvm.src/projects/compiler-rt/lib/asan/../sanitizer_common/sanitizer_common_interceptors.inc:655:5     #1 0x7fa1695d451b  (/usr/lib/x86_64-linux-gnu/libtiff.so.5+0xc51b)     #2 0x7fa1695d4b53 in TIFFSetField (/usr/lib/x86_64-linux-gnu/libtiff.so.5+0xcb53)     #3 0x7fa16b2ebbdf in TIFFSetProfiles XYZ/ImageMagick/coders/tiff.c:2984:14     #4 0x7fa16b2ebbdf in WriteTIFFImage XYZ/ImageMagick/coders/tiff.c:3691     #5 0x7fa16a882786 in WriteImage XYZ/ImageMagick/MagickCore/constitute.c:1114:14     #6 0x7fa16a883d09 in WriteImages XYZ/ImageMagick/MagickCore/constitute.c:1333:13     #7 0x7fa169e95246 in ConvertImageCommand XYZ/ImageMagick/MagickWand/convert.c:3280:11     #8 0x7fa16a047125 in MagickCommandGenesis XYZ/ImageMagick/MagickWand/mogrify.c:183:14     #9 0x4ee3e9 in MagickMain XYZ/ImageMagick/utilities/magick.c:149:10     #10 0x4ee3e9 in main XYZ/ImageMagick/utilities/magick.c:180     #11 0x7fa1658a582f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f)     #12 0x41a338 in _start (/usr/local/bin/magick+0x41a338)  0x62400000e100 is located 0 bytes inside of 7640-byte region [0x62400000e100,0x62400000fed8) freed by thread T0 here:     #0 0x4c13ee in realloc /scratch/llvm/clang-4/xenial/final/llvm.src/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:79:3     #1 0x7fa16ab038e3 in ResizeMagickMemory XYZ/ImageMagick/MagickCore/memory.c:1225:9     #2 0x7fa16ab038e3 in ResizeQuantumMemory XYZ/ImageMagick/MagickCore/memory.c:1289  previously allocated by thread T0 here:     #0 0x4c103c in __interceptor_malloc /scratch/llvm/clang-4/xenial/final/llvm.src/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:66:3     #1 0x7fa16ab019a4 in AcquireMagickMemory XYZ/ImageMagick/MagickCore/memory.c:464:10     #2 0x7fa16ab019a4 in AcquireQuantumMemory XYZ/ImageMagick/MagickCore/memory.c:537     #3 0x7fa16b2f1536 in ReadProfile XYZ/ImageMagick/coders/tiff.c:538:10     #4 0x7fa16a87dfa4 in ReadImage XYZ/ImageMagick/MagickCore/constitute.c:497:13     #5 0x7fa16a881661 in ReadImages XYZ/ImageMagick/MagickCore/constitute.c:866:9     #6 0x7fa169e8b1d1 in ConvertImageCommand XYZ/ImageMagick/MagickWand/convert.c:641:18     #7 0x7fa16a047125 in MagickCommandGenesis XYZ/ImageMagick/MagickWand/mogrify.c:183:14     #8 0x4ee3e9 in MagickMain XYZ/ImageMagick/utilities/magick.c:149:10     #9 0x4ee3e9 in main XYZ/ImageMagick/utilities/magick.c:180     #10 0x7fa1658a582f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f)  SUMMARY: AddressSanitizer: heap-use-after-free /scratch/llvm/clang-4/xenial/final/llvm.src/projects/compiler-rt/lib/asan/../sanitizer_common/sanitizer_common_interceptors.inc:655:5 in memcpy Shadow bytes around the buggy address:   0x0c487fff9bd0: fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa   0x0c487fff9be0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c487fff9bf0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c487fff9c00: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c487fff9c10: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa =>0x0c487fff9c20:[fd]fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd   0x0c487fff9c30: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd   0x0c487fff9c40: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd   0x0c487fff9c50: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd   0x0c487fff9c60: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd   0x0c487fff9c70: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07    Heap left redzone:       fa   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb ==22901==ABORTING ```  ------- *Comment [#1](show_bug.cgi?id=2730#c1) From Even Rouault  2017-08-23 07:43:35* ------- ``` This might be an issue with ImageMagick itself. Please report to them. Or re-open if you can reproduce with libtiff utilities (or a small self contained program using libtiff API only). I tried "tiffcp -c none tiff_uaf_TIFFSetField out" for example and it works fine ```  ------- *Comment [#2](show_bug.cgi?id=2730#c2) From Kamil Frankowicz  2017-08-23 14:54:14* ------- ``` From <https://www.imagemagick.org/discourse-server/viewtopic.php?f=3&t=32560>  "The stack trace shows the fault occurs withing the libTIFF delegate library. ImageMagick calls libTIFF's TIFFGetField() to obtain a private tag profile 37724 (used by Adobe). TIFFGetField() returns success with a length of 3544 bytes and a data buffer to the location of the profile. Unfortunately the data buffer is corrupt. The fix to this problem lies within the TIFF delegate library, libTIFF. If the 37724 profile is corrupt, libTIFF should return something other than success (1) for TIFFGetField(). If it does return success, the associated data buffer should be valid and subsequently touching it would not return a fault." ```  ------- *Comment [#3](show_bug.cgi?id=2730#c3) From Even Rouault  2017-09-02 07:15:40* ------- ``` libtiff has no knowledge of how a buffer is corrupt / of the semantics of the tag. It returns in TIFFGetField() a buffer of the size of the number of indicated bytes, and in TIFFSetField() expects that the provided buffer is of the indicated size. Here ImageMagick passes to TIFFSetField() a buffer of declared size 3544, but of actual size something smaller.  ImageMagick should deal with that on its side. There's nothing libtiff can do about that. ``` |
| --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=2730)
* - [XML](show_bug.cgi?ctype=xml&id=2730)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=2730)
* - Top of page

*First*
*Last*
*Prev*
*Next*

*No search results available*

* Actions:
  + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Search](query.cgi)
  + |
  + | [Reports](report.cgi)
  + | [New Account](createaccount.cgi)
  + |
    [Help](docs/en/html/bug_page.html)
  + | [Log In](http://bugzilla.maptools.org/show_bug.cgi?id=2730&GoAheadAndLogIn=1)


