=== Content from www.greyhathacker.net_84441895_20250125_210335.html ===


[GreyHatHacker.NET](https://www.greyhathacker.net/ "GreyHatHacker.NET")

Malware, Vulnerabilities, Exploits and more . . .

#### Menu

* [About](https://www.greyhathacker.net/?page_id=13)

Search for:

# IKARUS anti.virus and its 9 exploitable kernel vulnerabilities

Here is a list of the 9 kernel vulnerabilities I discovered over a month ago in an antivirus product called IKARUS anti.virus which has finally been fixed. Most of the vulnerabilities were due to the inputted output buffer address (Irp->UserBuffer) being saved on the stack which is later used without being validated when using as an argument. The table below lists the ioctls, related CVE and type of vulnerability

| **IOCTL** | **CVE ID** | **Vulnerability Type** |
| --- | --- | --- |
| 0x8300000c | CVE-2017-14961 | Arbitrary Write |
| 0x83000058 | CVE-2017-14962 | Out of Bounds Write |
| 0x83000058 | CVE-2017-14963 | Arbitrary Write |
| 0x8300005c | CVE-2017-14964 | Arbitrary Write |
| 0x830000cc | CVE-2017-14965 | Arbitrary Write |
| 0x830000c0 | CVE-2017-14966 | Arbitrary Write |
| 0x83000080 | CVE-2017-14967 | Arbitrary Write |
| 0x830000c4 | CVE-2017-14968 | Arbitrary Write |
| 0x83000084 | CVE-2017-14969 | Arbitrary Write |

Fixed version numbers ([vendors advisory](https://www.ikarussecurity.com/about-ikarus/security-blog/vulnerability-in-windows-antivirus-products-ik-sa-2017-0002) ~~soon to be released~~)

|  | **Vulnerable version** | **Fixed version** |
| --- | --- | --- |
| Software | 2.16.7 | 2.16.18 |
| ntguard.sys | 0.18780.0.0 | 0.43.0.0 |
| ntguard\_x64.sys | 0.18780.0.0 | 0.43.0.0 |

I’m exploiting the vulnerable subroutine used by ioctl 0x8300000c by overwriting the \_SEP\_TOKEN\_PRIVILEGES structure where arg\_20 is our inputted output buffer address.

![](/images/8300000c-64.png)

In our process \_SEP\_TOKEN\_PRIVILEGES structure I’m overwriting a byte in the “Present” field and a byte in the “Enabled” field with the hardcoded value of 0x11 by calling the vulnerable subroutine twice.

```
DeviceIoControl(hDevice, 0x8300000c, NULL, 0, (LPVOID)PresentByteOffset, 0, &dwRetBytes, NULL);
DeviceIoControl(hDevice, 0x8300000c, NULL, 0, (LPVOID)EnableByteOffset, 0, &dwRetBytes, NULL);
```

![](/images/cve-2017-14961.png)

The exploit can be downloaded from here [[zip](/docs/cve-2017-14961.zip)] (pass “ghh”) or from Exploit-DB when it gets published.

[@ParvezGHH](https://twitter.com/parvezghh)

Posted in [All](https://www.greyhathacker.net/?cat=18), [Bugs](https://www.greyhathacker.net/?cat=8), [Exploits](https://www.greyhathacker.net/?cat=7), [Vulnerabilities](https://www.greyhathacker.net/?cat=6) and tagged [Elevate](https://www.greyhathacker.net/?tag=elevate), [Kernel](https://www.greyhathacker.net/?tag=kernel) on [November 13, 2017](https://www.greyhathacker.net/?p=995 "4:51 pm") by [Parvez](https://www.greyhathacker.net/?author=1 "View all posts by Parvez"). [5 Comments](https://www.greyhathacker.net/?p=995#comments)

[← Exploiting Vir.IT eXplorer Anti-Virus Arbitrary Write Vulnerability](https://www.greyhathacker.net/?p=990) [Exploiting System Shield AntiVirus Arbitrary Write Vulnerability using SeTakeOwnershipPrivilege →](https://www.greyhathacker.net/?p=1006)

### 5 comments

1. ![](https://secure.gravatar.com/avatar/29a97a38bea34f7d0a36d16efb58fe78?s=40&d=mm&r=g) **Alex** says:
   [February 15, 2018 at 2:50 pm](https://www.greyhathacker.net/?p=995#comment-13579)

   You can upload the ntguard\_x64.sys & ntguard.sys [0.18780.0.0]

   I checked their site and they do not have old versions.

   Kind regards,
3. ![](https://secure.gravatar.com/avatar/f6306376486bff7a746a72d6dd054e36?s=40&d=mm&r=g) **[Parvez](http://www.greyhathacker.net)** says:
   [February 15, 2018 at 3:18 pm](https://www.greyhathacker.net/?p=995#comment-13580)

   Here are the vulnerable drivers of Ikarus Antivirus <https://www.greyhathacker.net/docs/ntguard.zip>
5. ![](https://secure.gravatar.com/avatar/29a97a38bea34f7d0a36d16efb58fe78?s=40&d=mm&r=g) **Alex** says:
   [February 15, 2018 at 4:36 pm](https://www.greyhathacker.net/?p=995#comment-13581)

   Many thanks!

   it’s working with winlogon.exe but doesn’t work with csrss.exe. =c
7. ![](https://secure.gravatar.com/avatar/29a97a38bea34f7d0a36d16efb58fe78?s=40&d=mm&r=g) **Alex** says:
   [February 15, 2018 at 4:37 pm](https://www.greyhathacker.net/?p=995#comment-13582)

   win 10 x64 (Unable to open csrss.exe process)
9. ![](https://secure.gravatar.com/avatar/f6306376486bff7a746a72d6dd054e36?s=40&d=mm&r=g) **[Parvez](http://www.greyhathacker.net)** says:
   [February 15, 2018 at 5:39 pm](https://www.greyhathacker.net/?p=995#comment-13583)

   You should be able to open the process (unless there are other restrictions) but I noticed CreateRemoteThread api doesn’t work so you might need to research into another method to execute the code.

### Leave a Reply

Your email address will not be published. Required fields are marked \*

Comment \*

Name \*

Email \*

Website

#### Recent Posts

* [Dokany/Google Drive File Stream Kernel Stack-based Buffer Overflow Vulnerability](https://www.greyhathacker.net/?p=1041)
* [Exploiting STOPzilla AntiMalware Arbitrary Write Vulnerability using SeCreateTokenPrivilege](https://www.greyhathacker.net/?p=1025)
* [Exploiting System Shield AntiVirus Arbitrary Write Vulnerability using SeTakeOwnershipPrivilege](https://www.greyhathacker.net/?p=1006)
* [IKARUS anti.virus and its 9 exploitable kernel vulnerabilities](https://www.greyhathacker.net/?p=995)
* [Exploiting Vir.IT eXplorer Anti-Virus Arbitrary Write Vulnerability](https://www.greyhathacker.net/?p=990)
#### Categories

* [All](https://www.greyhathacker.net/?cat=18)
* [Bugs](https://www.greyhathacker.net/?cat=8)
* [Exploits](https://www.greyhathacker.net/?cat=7)
* [Malware](https://www.greyhathacker.net/?cat=5)
* [Mitigation](https://www.greyhathacker.net/?cat=40)
* [Other](https://www.greyhathacker.net/?cat=34)
* [Vulnerabilities](https://www.greyhathacker.net/?cat=6)
#### Tags

[ActionScript](https://www.greyhathacker.net/?tag=actionscript)
[ActiveX](https://www.greyhathacker.net/?tag=activex)
[Adobe](https://www.greyhathacker.net/?tag=adobe)
[Anti-Rootkit](https://www.greyhathacker.net/?tag=anti-rootkit)
[ASLR](https://www.greyhathacker.net/?tag=aslr)
[Autorun](https://www.greyhathacker.net/?tag=autorun)
[BHO](https://www.greyhathacker.net/?tag=bho)
[BlazeDVD](https://www.greyhathacker.net/?tag=blazedvd)
[Download and Execute](https://www.greyhathacker.net/?tag=download-and-execute)
[Elevate](https://www.greyhathacker.net/?tag=elevate)
[EMET](https://www.greyhathacker.net/?tag=emet)
[FakeAV](https://www.greyhathacker.net/?tag=fakeav)
[heapspray](https://www.greyhathacker.net/?tag=heapspray)
[Hidden](https://www.greyhathacker.net/?tag=hidden)
[Hijack](https://www.greyhathacker.net/?tag=hijack)
[IrfanView](https://www.greyhathacker.net/?tag=irfanview)
[Java](https://www.greyhathacker.net/?tag=java)
[Kernel](https://www.greyhathacker.net/?tag=kernel)
[Macros](https://www.greyhathacker.net/?tag=macros)
[McAfee](https://www.greyhathacker.net/?tag=mcafee)
[MSI](https://www.greyhathacker.net/?tag=msi)
[MSWord](https://www.greyhathacker.net/?tag=msword)
[PGP](https://www.greyhathacker.net/?tag=pgp)
[pif](https://www.greyhathacker.net/?tag=pif)
[RemoteExec](https://www.greyhathacker.net/?tag=remoteexec)
[Return to Libc](https://www.greyhathacker.net/?tag=return-to-libc)
[ROP](https://www.greyhathacker.net/?tag=rop)
[Sandbox](https://www.greyhathacker.net/?tag=sandbox)
[Skype](https://www.greyhathacker.net/?tag=skype)
[SureThing](https://www.greyhathacker.net/?tag=surething)
[Symantec](https://www.greyhathacker.net/?tag=symantec)
[trailing](https://www.greyhathacker.net/?tag=trailing)
[UAC](https://www.greyhathacker.net/?tag=uac)
[URI](https://www.greyhathacker.net/?tag=uri)
[Vista](https://www.greyhathacker.net/?tag=vista)
#### Archives

* [January 2019](https://www.greyhathacker.net/?m=201901) (1)
* [September 2018](https://www.greyhathacker.net/?m=201809) (1)
* [January 2018](https://www.greyhathacker.net/?m=201801) (1)
* [November 2017](https://www.greyhathacker.net/?m=201711) (2)
* [September 2016](https://www.greyhathacker.net/?m=201609) (1)
* [December 2015](https://www.greyhathacker.net/?m=201512) (2)
* [July 2015](https://www.greyhathacker.net/?m=201507) (1)
* [January 2015](https://www.greyhathacker.net/?m=201501) (1)
* [December 2014](https://www.greyhathacker.net/?m=201412) (1)
* [June 2014](https://www.greyhathacker.net/?m=201406) (1)
* [January 2014](https://www.greyhathacker.net/?m=201401) (1)
* [November 2013](https://www.greyhathacker.net/?m=201311) (1)
* [September 2013](https://www.greyhathacker.net/?m=201309) (1)
* [February 2013](https://www.greyhathacker.net/?m=201302) (1)
* [December 2012](https://www.greyhathacker.net/?m=201212) (1)
* [August 2012](https://www.greyhathacker.net/?m=201208) (1)
* [June 2012](https://www.greyhathacker.net/?m=201206) (1)
* [February 2012](https://www.greyhathacker.net/?m=201202) (1)
* [January 2012](https://www.greyhathacker.net/?m=201201) (1)
* [December 2011](https://www.greyhathacker.net/?m=201112) (1)
* [November 2011](https://www.greyhathacker.net/?m=201111) (1)
* [August 2011](https://www.greyhathacker.net/?m=201108) (2)
* [July 2011](https://www.greyhathacker.net/?m=201107) (1)
* [April 2011](https://www.greyhathacker.net/?m=201104) (1)
* [March 2011](https://www.greyhathacker.net/?m=201103) (1)
* [October 2010](https://www.greyhathacker.net/?m=201010) (3)
* [June 2010](https://www.greyhathacker.net/?m=201006) (1)
* [May 2010](https://www.greyhathacker.net/?m=201005) (1)
* [March 2010](https://www.greyhathacker.net/?m=201003) (2)
* [February 2010](https://www.greyhathacker.net/?m=201002) (1)
* [December 2009](https://www.greyhathacker.net/?m=200912) (1)
* [September 2009](https://www.greyhathacker.net/?m=200909) (1)
* [May 2009](https://www.greyhathacker.net/?m=200905) (1)
* [April 2009](https://www.greyhathacker.net/?m=200904) (1)
* [September 2008](https://www.greyhathacker.net/?m=200809) (1)
* [November 2007](https://www.greyhathacker.net/?m=200711) (2)
#### Meta

* [Log in](https://www.greyhathacker.net/wp-login.php)
* [Entries feed](https://www.greyhathacker.net/?feed=rss2)
* [Comments feed](https://www.greyhathacker.net/?feed=comments-rss2)
* [WordPress.org](https://wordpress.org/)

Proudly powered by [WordPress](http://wordpress.org/ "Semantic Personal Publishing Platform")  ·
Theme: Suits by [Theme Weaver](http://www.themeweaver.net/ "Theme Developer")


