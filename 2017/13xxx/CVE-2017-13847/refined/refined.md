Here's a breakdown of the information related to CVE-2017-13847:

**Root cause of vulnerability:**

*   Incorrect IOKit object lifetime management in `IOTimeSyncClockManagerUserClient`. The `clientClose` method is treated like a destructor, while it is not.

**Weaknesses/vulnerabilities present:**

*   **Use-After-Free (UAF):** The `clientClose` method in `IOTimeSyncClockManagerUserClient` drops references to OSArrays and destroys locks, leading to UAF if external methods access these arrays concurrently.
*   **Race condition:** Concurrent access to the arrays protected by the locks in the IOTimeSyncClockManagerUserClient.

**Impact of exploitation:**

*   **Denial of Service (DoS):** The vulnerability can lead to multiple UAFs which can cause the system to crash.
*   **Arbitrary code execution with kernel privileges**: As mentioned in Apple's security advisory, this vulnerability can lead to arbitrary code execution with kernel privileges.

**Attack vectors:**

*   **Local exploitation:** An application can exploit this vulnerability.
*   **Concurrent method calls**: The exploit involves calling `clientClose` in one thread and external methods that manipulate the same data structures in other threads simultaneously.

**Required attacker capabilities/position:**

*   The attacker needs to be able to execute code on the target system.

**Additional details:**

*   The vulnerable code exists in the IOTimeSyncClockManager IOService and its user client interface.
*   The exploit requires specific timing to ensure that the OSArray is freed before the lock meant to protect it is destroyed.
*   The vulnerability was tested on macOS 10.13 (17A365) on MacBookAir5,2
*   The vulnerability is present in both macOS and iOS.
*   The issue was reported by Ian Beer of Google Project Zero.

The provided exploit code demonstrates how to trigger the UAF vulnerability by creating a thread to close the connection while simultaneously calling an external method.