=== Content from github.com_cebc914f_20250124_233423.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fbc3aae2bbac46dd894c89db5d5e98f7f0ef9e205)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fbc3aae2bbac46dd894c89db5d5e98f7f0ef9e205)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.9k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  437](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/bc3aae2bbac46dd894c89db5d5e98f7f0ef9e205)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

net: check and errout if res->fi is NULL when RTM\_F\_FIB\_MATCH is set

[Browse files](/torvalds/linux/tree/bc3aae2bbac46dd894c89db5d5e98f7f0ef9e205)
Browse the repository at this point in the history

```
Syzkaller hit 'general protection fault in fib_dump_info' bug on
commit 4.13-rc5..

Guilty file: net/ipv4/fib_semantics.c

kasan: GPF could be caused by NULL-ptr deref or user memory access
general protection fault: 0000 [#1] SMP KASAN
Modules linked in:
CPU: 0 PID: 2808 Comm: syz-executor0 Not tainted 4.13.0-rc5 #1
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS
Ubuntu-1.8.2-1ubuntu1 04/01/2014
task: ffff880078562700 task.stack: ffff880078110000
RIP: 0010:fib_dump_info+0x388/0x1170 net/ipv4/fib_semantics.c:1314
RSP: 0018:ffff880078117010 EFLAGS: 00010206
RAX: dffffc0000000000 RBX: 00000000000000fe RCX: 0000000000000002
RDX: 0000000000000006 RSI: ffff880078117084 RDI: 0000000000000030
RBP: ffff880078117268 R08: 000000000000000c R09: ffff8800780d80c8
R10: 0000000058d629b4 R11: 0000000067fce681 R12: 0000000000000000
R13: ffff8800784bd540 R14: ffff8800780d80b5 R15: ffff8800780d80a4
FS:  00000000022fa940(0000) GS:ffff88007fc00000(0000)
knlGS:0000000000000000
CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 00000000004387d0 CR3: 0000000079135000 CR4: 00000000000006f0
Call Trace:
  inet_rtm_getroute+0xc89/0x1f50 net/ipv4/route.c:2766
  rtnetlink_rcv_msg+0x288/0x680 net/core/rtnetlink.c:4217
  netlink_rcv_skb+0x340/0x470 net/netlink/af_netlink.c:2397
  rtnetlink_rcv+0x28/0x30 net/core/rtnetlink.c:4223
  netlink_unicast_kernel net/netlink/af_netlink.c:1265 [inline]
  netlink_unicast+0x4c4/0x6e0 net/netlink/af_netlink.c:1291
  netlink_sendmsg+0x8c4/0xca0 net/netlink/af_netlink.c:1854
  sock_sendmsg_nosec net/socket.c:633 [inline]
  sock_sendmsg+0xca/0x110 net/socket.c:643
  ___sys_sendmsg+0x779/0x8d0 net/socket.c:2035
  __sys_sendmsg+0xd1/0x170 net/socket.c:2069
  SYSC_sendmsg net/socket.c:2080 [inline]
  SyS_sendmsg+0x2d/0x50 net/socket.c:2076
  entry_SYSCALL_64_fastpath+0x1a/0xa5
  RIP: 0033:0x4512e9
  RSP: 002b:00007ffc75584cc8 EFLAGS: 00000216 ORIG_RAX:
  000000000000002e
  RAX: ffffffffffffffda RBX: 0000000000000002 RCX: 00000000004512e9
  RDX: 0000000000000000 RSI: 0000000020f2cfc8 RDI: 0000000000000003
  RBP: 000000000000000e R08: 0000000000000000 R09: 0000000000000000
  R10: 0000000000000000 R11: 0000000000000216 R12: fffffffffffffffe
  R13: 0000000000718000 R14: 0000000020c44ff0 R15: 0000000000000000
  Code: 00 0f b6 8d ec fd ff ff 48 8b 85 f0 fd ff ff 88 48 17 48 8b 45
  28 48 8d 78 30 48 b8 00 00 00 00 00 fc ff df 48 89 fa 48 c1 ea 03
  <0f>
  b6 04 02 84 c0 74 08 3c 03 0f 8e cb 0c 00 00 48 8b 45 28 44
  RIP: fib_dump_info+0x388/0x1170 net/ipv4/fib_semantics.c:1314 RSP:
  ffff880078117010
---[ end trace 254a7af28348f88b ]---

This patch adds a res->fi NULL check.

example run:
$ip route get 0.0.0.0 iif virt1-0
broadcast 0.0.0.0 dev lo
    cache <local,brd> iif virt1-0

$ip route get 0.0.0.0 iif virt1-0 fibmatch
RTNETLINK answers: No route to host

Reported-by: idaifish <idaifish@gmail.com>
Reported-by: Dmitry Vyukov <dvyukov@google.com>
Fixes: [b617981](https://github.com/torvalds/linux/commit/b61798130f1be5bff08712308126c2d7ebe390ef) ("net: ipv4: RTM_GETROUTE: return matched fib result when requested")
Signed-off-by: Roopa Prabhu <roopa@cumulusnetworks.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
```

* Loading branch information

[![@roopa-prabhu](https://avatars.githubusercontent.com/u/5098686?s=40&v=4)](/roopa-prabhu) [![@davem330](https://avatars.githubusercontent.com/u/1053866?s=40&v=4)](/davem330)

[roopa-prabhu](/torvalds/linux/commits?author=roopa-prabhu "View all commits by roopa-prabhu")
authored and
[davem330](/torvalds/linux/commits?author=davem330 "View all commits by davem330")
committed
Aug 18, 2017

1 parent
[383143f](/torvalds/linux/commit/383143f31d7d3525a1dbff733d52fff917f82f15)

commit bc3aae2

Showing
**1 changed file**
with
**9 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

11 changes: 9 additions & 2 deletions

11
[net/ipv4/route.c](#diff-7cbc836f5a4ac6a61be67a1d3a8abef969bfe32d4a5fe4e76a8736ed7d4aa121 "net/ipv4/route.c")

Show comments

[View file](/torvalds/linux/blob/bc3aae2bbac46dd894c89db5d5e98f7f0ef9e205/net/ipv4/route.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2763,14 +2763,21 @@ static int inet\_rtm\_getroute(struct sk\_buff \*in\_skb, struct nlmsghdr \*nlh, |
|  |  | if (rtm->rtm\_flags & RTM\_F\_LOOKUP\_TABLE) |
|  |  | table\_id = rt->rt\_table\_id; |
|  |  |  |
|  |  | if (rtm->rtm\_flags & RTM\_F\_FIB\_MATCH) |
|  |  | if (rtm->rtm\_flags & RTM\_F\_FIB\_MATCH) { |
|  |  | if (!res.fi) { |
|  |  | err = fib\_props[res.type].error; |
|  |  | if (!err) |
|  |  | err = -EHOSTUNREACH; |
|  |  | goto errout\_free; |
|  |  | } |
|  |  | err = fib\_dump\_info(skb, NETLINK\_CB(in\_skb).portid, |
|  |  | nlh->nlmsg\_seq, RTM\_NEWROUTE, table\_id, |
|  |  | rt->rt\_type, res.prefix, res.prefixlen, |
|  |  | fl4.flowi4\_tos, res.fi, 0); |
|  |  | else |
|  |  | } else { |
|  |  | err = rt\_fill\_info(net, dst, src, table\_id, &fl4, skb, |
|  |  | NETLINK\_CB(in\_skb).portid, nlh->nlmsg\_seq); |
|  |  | } |
|  |  | if (err < 0) |
|  |  | goto errout\_free; |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `bc3aae2`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fbc3aae2bbac46dd894c89db5d5e98f7f0ef9e205) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from git.kernel.org_229689bf_20250124_233421.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=bc3aae2bbac46dd894c89db5d5e98f7f0ef9e205)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=bc3aae2bbac46dd894c89db5d5e98f7f0ef9e205)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=bc3aae2bbac46dd894c89db5d5e98f7f0ef9e205)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=bc3aae2bbac46dd894c89db5d5e98f7f0ef9e205)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Roopa Prabhu <roopa@cumulusnetworks.com> | 2017-08-16 12:38:52 -0700 |
| --- | --- | --- |
| committer | David S. Miller <davem@davemloft.net> | 2017-08-18 16:05:46 -0700 |
| commit | [bc3aae2bbac46dd894c89db5d5e98f7f0ef9e205](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=bc3aae2bbac46dd894c89db5d5e98f7f0ef9e205) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=bc3aae2bbac46dd894c89db5d5e98f7f0ef9e205)) | |
| tree | [a648fe67822cbb1f69081d1686e5397c60169e78](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=bc3aae2bbac46dd894c89db5d5e98f7f0ef9e205) | |
| parent | [383143f31d7d3525a1dbff733d52fff917f82f15](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=383143f31d7d3525a1dbff733d52fff917f82f15) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=bc3aae2bbac46dd894c89db5d5e98f7f0ef9e205&id2=383143f31d7d3525a1dbff733d52fff917f82f15)) | |
| download | [linux-bc3aae2bbac46dd894c89db5d5e98f7f0ef9e205.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-bc3aae2bbac46dd894c89db5d5e98f7f0ef9e205.tar.gz) | |

net: check and errout if res->fi is NULL when RTM\_F\_FIB\_MATCH is setSyzkaller hit 'general protection fault in fib\_dump\_info' bug on
commit 4.13-rc5..
Guilty file: net/ipv4/fib\_semantics.c
kasan: GPF could be caused by NULL-ptr deref or user memory access
general protection fault: 0000 [#1] SMP KASAN
Modules linked in:
CPU: 0 PID: 2808 Comm: syz-executor0 Not tainted 4.13.0-rc5 #1
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS
Ubuntu-1.8.2-1ubuntu1 04/01/2014
task: ffff880078562700 task.stack: ffff880078110000
RIP: 0010:fib\_dump\_info+0x388/0x1170 net/ipv4/fib\_semantics.c:1314
RSP: 0018:ffff880078117010 EFLAGS: 00010206
RAX: dffffc0000000000 RBX: 00000000000000fe RCX: 0000000000000002
RDX: 0000000000000006 RSI: ffff880078117084 RDI: 0000000000000030
RBP: ffff880078117268 R08: 000000000000000c R09: ffff8800780d80c8
R10: 0000000058d629b4 R11: 0000000067fce681 R12: 0000000000000000
R13: ffff8800784bd540 R14: ffff8800780d80b5 R15: ffff8800780d80a4
FS: 00000000022fa940(0000) GS:ffff88007fc00000(0000)
knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 00000000004387d0 CR3: 0000000079135000 CR4: 00000000000006f0
Call Trace:
inet\_rtm\_getroute+0xc89/0x1f50 net/ipv4/route.c:2766
rtnetlink\_rcv\_msg+0x288/0x680 net/core/rtnetlink.c:4217
netlink\_rcv\_skb+0x340/0x470 net/netlink/af\_netlink.c:2397
rtnetlink\_rcv+0x28/0x30 net/core/rtnetlink.c:4223
netlink\_unicast\_kernel net/netlink/af\_netlink.c:1265 [inline]
netlink\_unicast+0x4c4/0x6e0 net/netlink/af\_netlink.c:1291
netlink\_sendmsg+0x8c4/0xca0 net/netlink/af\_netlink.c:1854
sock\_sendmsg\_nosec net/socket.c:633 [inline]
sock\_sendmsg+0xca/0x110 net/socket.c:643
\_\_\_sys\_sendmsg+0x779/0x8d0 net/socket.c:2035
\_\_sys\_sendmsg+0xd1/0x170 net/socket.c:2069
SYSC\_sendmsg net/socket.c:2080 [inline]
SyS\_sendmsg+0x2d/0x50 net/socket.c:2076
entry\_SYSCALL\_64\_fastpath+0x1a/0xa5
RIP: 0033:0x4512e9
RSP: 002b:00007ffc75584cc8 EFLAGS: 00000216 ORIG\_RAX:
000000000000002e
RAX: ffffffffffffffda RBX: 0000000000000002 RCX: 00000000004512e9
RDX: 0000000000000000 RSI: 0000000020f2cfc8 RDI: 0000000000000003
RBP: 000000000000000e R08: 0000000000000000 R09: 0000000000000000
R10: 0000000000000000 R11: 0000000000000216 R12: fffffffffffffffe
R13: 0000000000718000 R14: 0000000020c44ff0 R15: 0000000000000000
Code: 00 0f b6 8d ec fd ff ff 48 8b 85 f0 fd ff ff 88 48 17 48 8b 45
28 48 8d 78 30 48 b8 00 00 00 00 00 fc ff df 48 89 fa 48 c1 ea 03
<0f>
b6 04 02 84 c0 74 08 3c 03 0f 8e cb 0c 00 00 48 8b 45 28 44
RIP: fib\_dump\_info+0x388/0x1170 net/ipv4/fib\_semantics.c:1314 RSP:
ffff880078117010
---[ end trace 254a7af28348f88b ]---
This patch adds a res->fi NULL check.
example run:
$ip route get 0.0.0.0 iif virt1-0
broadcast 0.0.0.0 dev lo
cache <local,brd> iif virt1-0
$ip route get 0.0.0.0 iif virt1-0 fibmatch
RTNETLINK answers: No route to host
Reported-by: idaifish <idaifish@gmail.com>
Reported-by: Dmitry Vyukov <dvyukov@google.com>
Fixes: b61798130f1b ("net: ipv4: RTM\_GETROUTE: return matched fib result when requested")
Signed-off-by: Roopa Prabhu <roopa@cumulusnetworks.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=bc3aae2bbac46dd894c89db5d5e98f7f0ef9e205)

| -rw-r--r-- | [net/ipv4/route.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/net/ipv4/route.c?id=bc3aae2bbac46dd894c89db5d5e98f7f0ef9e205) | 11 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 2 deletions

| diff --git a/net/ipv4/route.c b/net/ipv4/route.cindex fe877a4a72b1ec..2331de20ca505d 100644--- a/[net/ipv4/route.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/ipv4/route.c?id=383143f31d7d3525a1dbff733d52fff917f82f15)+++ b/[net/ipv4/route.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/ipv4/route.c?id=bc3aae2bbac46dd894c89db5d5e98f7f0ef9e205)@@ -2763,14 +2763,21 @@ static int inet\_rtm\_getroute(struct sk\_buff \*in\_skb, struct nlmsghdr \*nlh, if (rtm->rtm\_flags & RTM\_F\_LOOKUP\_TABLE) table\_id = rt->rt\_table\_id; - if (rtm->rtm\_flags & RTM\_F\_FIB\_MATCH)+ if (rtm->rtm\_flags & RTM\_F\_FIB\_MATCH) {+ if (!res.fi) {+ err = fib\_props[res.type].error;+ if (!err)+ err = -EHOSTUNREACH;+ goto errout\_free;+ } err = fib\_dump\_info(skb, NETLINK\_CB(in\_skb).portid, nlh->nlmsg\_seq, RTM\_NEWROUTE, table\_id, rt->rt\_type, res.prefix, res.prefixlen, fl4.flowi4\_tos, res.fi, 0);- else+ } else { err = rt\_fill\_info(net, dst, src, table\_id, &fl4, skb, NETLINK\_CB(in\_skb).portid, nlh->nlmsg\_seq);+ } if (err < 0) goto errout\_free; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-24 23:32:58 +0000


