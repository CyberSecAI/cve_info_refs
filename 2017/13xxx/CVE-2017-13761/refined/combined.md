=== Content from www.example.com_dcbfe5ad_20250126_060404.html ===

# Example Domain

This domain is for use in illustrative examples in documents. You may use this
domain in literature without prior coordination or asking for permission.

[More information...](https://www.iana.org/domains/example)



=== Content from github.com_55fbf9ae_20250126_060406.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffastly%2Ffastly-magento2%2Fcommit%2Fe077928e5f26015f59)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffastly%2Ffastly-magento2%2Fcommit%2Fe077928e5f26015f59)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=fastly%2Ffastly-magento2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[fastly](/fastly)
/
**[fastly-magento2](/fastly/fastly-magento2)**
Public

* [Notifications](/login?return_to=%2Ffastly%2Ffastly-magento2) You must be signed in to change notification settings
* [Fork
  123](/login?return_to=%2Ffastly%2Ffastly-magento2)
* [Star
   150](/login?return_to=%2Ffastly%2Ffastly-magento2)

* [Code](/fastly/fastly-magento2)
* [Issues
  16](/fastly/fastly-magento2/issues)
* [Pull requests
  9](/fastly/fastly-magento2/pulls)
* [Actions](/fastly/fastly-magento2/actions)
* [Security](/fastly/fastly-magento2/security)
* [Insights](/fastly/fastly-magento2/pulse)

Additional navigation options

* [Code](/fastly/fastly-magento2)
* [Issues](/fastly/fastly-magento2/issues)
* [Pull requests](/fastly/fastly-magento2/pulls)
* [Actions](/fastly/fastly-magento2/actions)
* [Security](/fastly/fastly-magento2/security)
* [Insights](/fastly/fastly-magento2/pulse)

## Commit

[Permalink](/fastly/fastly-magento2/commit/e077928e5f26015f5940ab12bc366d95354951d9)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

There was an edge case in the handling of non-successful HTTP codes w…

[Browse files](/fastly/fastly-magento2/tree/e077928e5f26015f5940ab12bc366d95354951d9)
Browse the repository at this point in the history

```
…here only 200, 301 and 404

response codes were considered successful. For non-successful codes we ended up doing an early
return (return(deliver)) which under load resulted in user sessions getting mixed up since
we cached responses with cookies. In this commit we are expanding the list of successful HTTP codes
and also stripping off Set-Cookies for error responses.

This commit also has few minor VCL code tweaks.
```

* Loading branch information

[![@vvuksan](https://avatars.githubusercontent.com/u/260877?s=40&v=4)](/vvuksan)

[vvuksan](/fastly/fastly-magento2/commits?author=vvuksan "View all commits by vvuksan")
committed
Aug 13, 2017

1 parent
[109620b](/fastly/fastly-magento2/commit/109620bf09c04d79cab1b5e6333f6d1bf9e4658f)

commit e077928

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**10 additions**
and
**7 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* etc/vcl\_snippets

  + etc/vcl\_snippets/fetch.vcl
    [fetch.vcl](#diff-32cb30ad048f481df4ba40221323829e7fd5d1cdb6c3a23cd713224621c4f682)
  + etc/vcl\_snippets/pass.vcl
    [pass.vcl](#diff-09dcc59120d2d94edee0b816132c24cc15853aaa2425da59d19ee00fb1d81c8e)
  + etc/vcl\_snippets/recv.vcl
    [recv.vcl](#diff-3e017bb1f97aeae089d5a86c12f4c7822a8c9c3f7e4d3b42dd43405e0d63b01a)

## There are no files selected for viewing

7 changes: 5 additions & 2 deletions

7
[etc/vcl\_snippets/fetch.vcl](#diff-32cb30ad048f481df4ba40221323829e7fd5d1cdb6c3a23cd713224621c4f682 "etc/vcl_snippets/fetch.vcl")

Show comments

[View file](/fastly/fastly-magento2/blob/e077928e5f26015f5940ab12bc366d95354951d9/etc/vcl_snippets/fetch.vcl)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -70,9 +70,12 @@ |
|  |  | return (pass); |
|  |  | } |
|  |  |  |
|  |  | # cache only successfully responses and 404s |
|  |  | if ( !http\_status\_matches(beresp.status, "200,301,404")) { |
|  |  | # Cache non-successful responses for 1 second to avoid onslaught of traffic if backend starts |
|  |  | # spewing 500s. Also set 5 second grace in case backend is timing out or otherwise messed up |
|  |  | if ( !http\_status\_matches(beresp.status, "200,203,300,301,302,404,410")) { |
|  |  | set req.http.Fastly-Cachetype = "ERROR"; |
|  |  | # Remove Set-Cookies so we don't inadvertenly cache them |
|  |  | unset beresp.http.Set-Cookie; |
|  |  | set beresp.ttl = 1s; |
|  |  | set beresp.grace = 5s; |
|  |  | return (deliver); |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[etc/vcl\_snippets/pass.vcl](#diff-09dcc59120d2d94edee0b816132c24cc15853aaa2425da59d19ee00fb1d81c8e "etc/vcl_snippets/pass.vcl")

Show comments

[View file](/fastly/fastly-magento2/blob/e077928e5f26015f5940ab12bc366d95354951d9/etc/vcl_snippets/pass.vcl)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2,9 +2,9 @@ |
|  |  | unset bereq.http.Accept-Encoding; |
|  |  |  |
|  |  | # Increase first byte timeouts for /admin\* URLs to 3 minutes |
|  |  | if ( req.url ~ "^/admin(\_.\*)?/" ) { |
|  |  | if ( req.url ~ "^/(index\.php/)?admin(\_.\*)?/" ) { |
|  |  |  |
|  |  | set bereq.first\_byte\_timeout = 180s; |
|  |  |  |
|  |  |  |
|  |  | } |
|  |  | } |

6 changes: 3 additions & 3 deletions

6
[etc/vcl\_snippets/recv.vcl](#diff-3e017bb1f97aeae089d5a86c12f4c7822a8c9c3f7e4d3b42dd43405e0d63b01a "etc/vcl_snippets/recv.vcl")

Show comments

[View file](/fastly/fastly-magento2/blob/e077928e5f26015f5940ab12bc366d95354951d9/etc/vcl_snippets/recv.vcl)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -58,11 +58,11 @@ |
|  |  | # geoip lookup |
|  |  | if (req.url ~ "fastlyCdn/geoip/getaction/") { |
|  |  | # check if GeoIP has been already processed by client. this normally happens before essential cookies are set. |
|  |  | if (req.http.cookie ~ "(X-Magento-Vary|form\_key)=") { |
|  |  | if (req.http.cookie:X-Magento-Vary || req.http.cookie:form\_key) { |
|  |  | error 200 ""; |
|  |  | } else { |
|  |  | # append parameter with country code only if it doesn't exist already |
|  |  | if ( req.url !~ "country\_code=" ) { |
|  |  | if ( req.url.qs !~ "country\_code=" ) { |
|  |  | set req.url = req.url "?country\_code=" if ( req.http.geo\_override, req.http.geo\_override, client.geo.country\_code); |
|  |  | } |
|  |  | } |
| Expand All | | @@ -86,4 +86,4 @@ |
|  |  | if (req.url ~ "^/(pub/)?(media|static)/.\*") { |
|  |  | unset req.http.Https; |
|  |  | unset req.http.Cookie; |
|  |  | } |
|  |  | } |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `e077928`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffastly%2Ffastly-magento2%2Fcommit%2Fe077928e5f26015f59) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_ac880088_20250126_060404.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffastly%2Ffastly-magento2%2Fcommit%2Fe077928e5f26015f5940ab12bc366d95354951d9)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffastly%2Ffastly-magento2%2Fcommit%2Fe077928e5f26015f5940ab12bc366d95354951d9)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=fastly%2Ffastly-magento2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[fastly](/fastly)
/
**[fastly-magento2](/fastly/fastly-magento2)**
Public

* [Notifications](/login?return_to=%2Ffastly%2Ffastly-magento2) You must be signed in to change notification settings
* [Fork
  123](/login?return_to=%2Ffastly%2Ffastly-magento2)
* [Star
   150](/login?return_to=%2Ffastly%2Ffastly-magento2)

* [Code](/fastly/fastly-magento2)
* [Issues
  16](/fastly/fastly-magento2/issues)
* [Pull requests
  9](/fastly/fastly-magento2/pulls)
* [Actions](/fastly/fastly-magento2/actions)
* [Security](/fastly/fastly-magento2/security)
* [Insights](/fastly/fastly-magento2/pulse)

Additional navigation options

* [Code](/fastly/fastly-magento2)
* [Issues](/fastly/fastly-magento2/issues)
* [Pull requests](/fastly/fastly-magento2/pulls)
* [Actions](/fastly/fastly-magento2/actions)
* [Security](/fastly/fastly-magento2/security)
* [Insights](/fastly/fastly-magento2/pulse)

## Commit

[Permalink](/fastly/fastly-magento2/commit/e077928e5f26015f5940ab12bc366d95354951d9)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

There was an edge case in the handling of non-successful HTTP codes w…

[Browse files](/fastly/fastly-magento2/tree/e077928e5f26015f5940ab12bc366d95354951d9)
Browse the repository at this point in the history

```
…here only 200, 301 and 404

response codes were considered successful. For non-successful codes we ended up doing an early
return (return(deliver)) which under load resulted in user sessions getting mixed up since
we cached responses with cookies. In this commit we are expanding the list of successful HTTP codes
and also stripping off Set-Cookies for error responses.

This commit also has few minor VCL code tweaks.
```

* Loading branch information

[![@vvuksan](https://avatars.githubusercontent.com/u/260877?s=40&v=4)](/vvuksan)

[vvuksan](/fastly/fastly-magento2/commits?author=vvuksan "View all commits by vvuksan")
committed
Aug 13, 2017

1 parent
[109620b](/fastly/fastly-magento2/commit/109620bf09c04d79cab1b5e6333f6d1bf9e4658f)

commit e077928

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**10 additions**
and
**7 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* etc/vcl\_snippets

  + etc/vcl\_snippets/fetch.vcl
    [fetch.vcl](#diff-32cb30ad048f481df4ba40221323829e7fd5d1cdb6c3a23cd713224621c4f682)
  + etc/vcl\_snippets/pass.vcl
    [pass.vcl](#diff-09dcc59120d2d94edee0b816132c24cc15853aaa2425da59d19ee00fb1d81c8e)
  + etc/vcl\_snippets/recv.vcl
    [recv.vcl](#diff-3e017bb1f97aeae089d5a86c12f4c7822a8c9c3f7e4d3b42dd43405e0d63b01a)

## There are no files selected for viewing

7 changes: 5 additions & 2 deletions

7
[etc/vcl\_snippets/fetch.vcl](#diff-32cb30ad048f481df4ba40221323829e7fd5d1cdb6c3a23cd713224621c4f682 "etc/vcl_snippets/fetch.vcl")

Show comments

[View file](/fastly/fastly-magento2/blob/e077928e5f26015f5940ab12bc366d95354951d9/etc/vcl_snippets/fetch.vcl)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -70,9 +70,12 @@ |
|  |  | return (pass); |
|  |  | } |
|  |  |  |
|  |  | # cache only successfully responses and 404s |
|  |  | if ( !http\_status\_matches(beresp.status, "200,301,404")) { |
|  |  | # Cache non-successful responses for 1 second to avoid onslaught of traffic if backend starts |
|  |  | # spewing 500s. Also set 5 second grace in case backend is timing out or otherwise messed up |
|  |  | if ( !http\_status\_matches(beresp.status, "200,203,300,301,302,404,410")) { |
|  |  | set req.http.Fastly-Cachetype = "ERROR"; |
|  |  | # Remove Set-Cookies so we don't inadvertenly cache them |
|  |  | unset beresp.http.Set-Cookie; |
|  |  | set beresp.ttl = 1s; |
|  |  | set beresp.grace = 5s; |
|  |  | return (deliver); |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[etc/vcl\_snippets/pass.vcl](#diff-09dcc59120d2d94edee0b816132c24cc15853aaa2425da59d19ee00fb1d81c8e "etc/vcl_snippets/pass.vcl")

Show comments

[View file](/fastly/fastly-magento2/blob/e077928e5f26015f5940ab12bc366d95354951d9/etc/vcl_snippets/pass.vcl)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2,9 +2,9 @@ |
|  |  | unset bereq.http.Accept-Encoding; |
|  |  |  |
|  |  | # Increase first byte timeouts for /admin\* URLs to 3 minutes |
|  |  | if ( req.url ~ "^/admin(\_.\*)?/" ) { |
|  |  | if ( req.url ~ "^/(index\.php/)?admin(\_.\*)?/" ) { |
|  |  |  |
|  |  | set bereq.first\_byte\_timeout = 180s; |
|  |  |  |
|  |  |  |
|  |  | } |
|  |  | } |

6 changes: 3 additions & 3 deletions

6
[etc/vcl\_snippets/recv.vcl](#diff-3e017bb1f97aeae089d5a86c12f4c7822a8c9c3f7e4d3b42dd43405e0d63b01a "etc/vcl_snippets/recv.vcl")

Show comments

[View file](/fastly/fastly-magento2/blob/e077928e5f26015f5940ab12bc366d95354951d9/etc/vcl_snippets/recv.vcl)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -58,11 +58,11 @@ |
|  |  | # geoip lookup |
|  |  | if (req.url ~ "fastlyCdn/geoip/getaction/") { |
|  |  | # check if GeoIP has been already processed by client. this normally happens before essential cookies are set. |
|  |  | if (req.http.cookie ~ "(X-Magento-Vary|form\_key)=") { |
|  |  | if (req.http.cookie:X-Magento-Vary || req.http.cookie:form\_key) { |
|  |  | error 200 ""; |
|  |  | } else { |
|  |  | # append parameter with country code only if it doesn't exist already |
|  |  | if ( req.url !~ "country\_code=" ) { |
|  |  | if ( req.url.qs !~ "country\_code=" ) { |
|  |  | set req.url = req.url "?country\_code=" if ( req.http.geo\_override, req.http.geo\_override, client.geo.country\_code); |
|  |  | } |
|  |  | } |
| Expand All | | @@ -86,4 +86,4 @@ |
|  |  | if (req.url ~ "^/(pub/)?(media|static)/.\*") { |
|  |  | unset req.http.Https; |
|  |  | unset req.http.Cookie; |
|  |  | } |
|  |  | } |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `e077928`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffastly%2Ffastly-magento2%2Fcommit%2Fe077928e5f26015f5940ab12bc366d95354951d9) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.fastly.com_f30ff058_20250125_044918.html ===
[Fastly](/)EN

* EN
* JA
* ES
* DE
* FR
[Under Attack?](/under-attack)(844) 4FASTLY[Support Center](https://support.fastly.com/)[Log in](https://manage.fastly.com/)

* Why?
* Products
* Services
* Solutions
* Devs
* Partners
* Resources
* [Pricing](/pricing)
[Talk to an expert](/contact-sales)[Try Fastly Free](/signup)[![](data:image/svg+xml;base64...)](/)EN

* EN
* JA
* ES
* DE
* FR
Menu
# Security advisories

[Security blog](/security-blog/)[Security advisories](/security-advisories)[Report a security issue](/security/report-security-issue)[Security documentation](https://docs.fastly.com/en/guides/security-measures)[< Back to security advisories](/security-advisories)
## Vulnerability in Fastly open source CDN module intended to be integrated into Magento2

September 12, 2017

## Summary

During the investigation of a customer report, Fastly became aware of and addressed a security vulnerability (CVE-2017-13761) in the Fastly CDN module intended to be integrated into Magento2. This is open source code which Fastly releases to enable easy integration with our partnerâs products. All versions prior to 1.2.26 are affected and customers are encouraged to upgrade.

Fastly has reached out directly to customers currently using affected versions of the module.

## Impact

This vulnerability, present in all versions of the module prior to version 1.2.26, caused redirect responses to be cached for a few seconds. A session leak could occur in certain cases when using a third-party authentication plugin, such as OAuth, which relies on redirects instead of POST requests.
As a result, the vulnerability could lead to information from one authenticated session leaking to another authenticated user.

## Fix / Workarounds

This vulnerability was addressed in version 1.2.26 of the Fastly CDN module. Customers who have downloaded and deployed any older version of the module are encouraged to upgrade to version 1.2.26 or later. The latest, and recommended, version available is 1.2.28.

You can run the following command to determine if your site is affected:

```
$ curl -H âFastly-Debug:1â -v -o /dev/null https://www.example.com/ | grep Fastly-Magento-VCL

< Fastly-Magento-VCL-Uploaded: 1.2.20

```

## More information

This vulnerability has been assigned CVE identifier [CVE-2017-13761](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-13761).

This issue was addressed in the [fastly-magento2 code repository](https://github.com/fastly/fastly-magento2/commit/e077928e5f26015f5940ab12bc366d95354951d9#diff-289d6f6e3e919eefdd63669665336cbc), and the latest version is available at <https://github.com/fastly/fastly-magento2/releases>.

### Subscribe to security advisories.

First name Last name Company Work Email Subscribe

By creating an account you agree to the [Terms of Service](/terms) and acknowledge our [Privacy Policy](/privacy).

## Ready to get started?

Get in touch or create an account.

[Try Fastly Free](/signup)[Talk to an expert](/contact-sales)![Fastly](data:image/svg+xml;base64...)

* Products
  + [Edge Cloud Platform](/products)
  + [Pricing](/pricing)
  + [Try Fastly Free](/signup)
  + [Network Map](/network-map)
* Solutions
  + [Professional Services](/solutions/professional-services)
  + [Managed CDN](/solutions/managed-cdn)
  + [Support Plans](/services/support-plans)
  + [Talk to an Expert](/contact-sales)
* Learn
  + [Documentation](/documentation/)
  + [Developers](/documentation/developers/)
  + [Resource Library](/resources)
  + [Blog](/blog)
  + [Events](/events)
* Support
  + [Support Center](https://support.fastly.com/)
  + [Network Status](https://www.fastlystatus.com/)
  + [Contact Us](/contact-us)
* Company
  + [About Us](/company)
  + [Careers](/about/careers)
  + [Customer Stories](/customers)
  + [Partners](/partners)
  + [News](/press)
  + [Investor Relations](https://investors.fastly.com/)
  + [Trust](/trust)
* Compare
  + [Fastly vs. Cloudflare](https://www.fastly.com/resources/datasheets/capability-comparison-cloudflare/)
  + [Fastly vs. Akamai CDN](https://www.fastly.com/resources/datasheets/capability-comparison-akamai/)
  + [Fastly vs. Akamai Security](https://www.fastly.com/resources/datasheets/capability-comparison-security-akamai/)
  + [Fastly vs. Edgio](https://www.fastly.com/resources/datasheets/network-services/edgio-capability-comparison/)
  + [Fastly vs. Imperva](https://www.fastly.com/resources/datasheets/capability-comparison-security-imperva/)
  + [Fastly vs. Cloud Providers](https://www.fastly.com/resources/datasheets/fastly-cdn-performance-compared-to-cloud-providers/)

Â©Â FastlyÂ 2025

* [Terms of Service](/terms/)
* [Privacy policy](/privacy/)
* [Acceptable Use](/acceptable-use)

* [X](https://www.twitter.com/fastly)
* [LinkedIn](https://www.linkedin.com/company/fastly)
* [Instagram](https://www.instagram.com/fastlyinc)
* [YouTube](https://www.youtube.com/channel/UC2Zx8R9llwwyNBB6thfIwxg)


