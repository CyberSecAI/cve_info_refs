```
{
  "vulnerability": {
    "cve_id": "CVE-2017-13867",
    "root_cause": "Incorrect API usage in flow divert socket option handling",
    "weaknesses": [
      "Double free",
      "Memory corruption"
    ],
    "impact": "An application may be able to execute arbitrary code with kernel privileges or cause a denial of service by triggering a kernel panic.",
    "attack_vectors": [
      "Local access",
      "Specifically crafted socket option"
    ],
    "attacker_capabilities": "Local user able to call setsockopt",
    "description": "The vulnerability lies in the `flow_divert_token_set` function in `flow_divert.c`, specifically when handling the `SO_FLOW_DIVERT_TOKEN` socket option. `soopt_getm` allocates a memory buffer (mbuf), and `soopt_mcopyin` attempts to copy data from userspace into this buffer. If `copyin` within `soopt_mcopyin` fails, it frees the allocated mbuf. However, `flow_divert_token_set` is unaware of this freeing and also attempts to free the same mbuf, resulting in a double free. This can lead to a kernel panic or, with proper manipulation, arbitrary code execution."
  }
}
```