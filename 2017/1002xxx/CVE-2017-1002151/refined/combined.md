=== Content from pagure.io_cd0e83d0_20250126_012205.html ===


[![pagure Logo](/theme/static/pagure-logo.png?version=5.14.1)](/)

* [Log In](/login/?next=https://pagure.io/pagure/pull-request/2426)

###

### [**pagure**](/pagure)

Clone
##### **Source Code**

GIT

##### **Documentation**

GIT

---

[Learn more about these different git repos.](https://docs.pagure.org/pagure/usage/)

Other Git URLs

* [Source](/pagure)
* [Docs](/docs/pagure/)
* [Issues
  485](/pagure/issues)
* [Pull Requests
  19](/pagure/pull-requests)
* [Roadmap](/pagure/roadmap)
* [Stats](/pagure/stats)

#### #2426 hide private repos in ssh too Closed 7 years ago by pingou. Opened 7 years ago by stbuehler. stbuehler/pagure [hide-private-repos-in-ssh](/fork/stbuehler/pagure/tree/hide-private-repos-in-ssh) Â intoÂ  [master](/pagure/tree/master)

* [Comments](#comments)
* [Files Changed
  1](#request_diff)
* [Commits
  1](#commit_list)
* [Patch](/pagure/pull-request/2426.patch)

[**hide private repos in ssh too**](/fork/stbuehler/pagure/c/4af96a179912fc651e544c8ff90d9ddc9c7e6f48)
[![](https://seccdn.libravatar.org/avatar/da4e9c92224dee1505a4796d347a68c1440fe1414b4f04a6d8dc5f7396f62ae0?s=16&d=retro)](/user/stbuehler) [Stefan BÃ¼hler](/pagure/commits/?author=stbuehler%40web.de)
 â€¢
7 years ago

[`4af96a1`](/fork/stbuehler/pagure/c/4af96a179912fc651e544c8ff90d9ddc9c7e6f48)

[pagure/lib/git\_auth.py](/fork/stbuehler/pagure/blob/577b668b7f2ef7aa932d2c06dd3eb309388d8af7/f/pagure/lib/git_auth.py "View file as of 577b668")

file modified

+1
-1

|  |  | ``` @@ -126,7 +126,7 @@Â  ``` |
| --- | --- | --- |
|  |  | ```                   repos = '' ``` |
|  |  | ```    ``` |
|  |  | ```               config.append('repo %s%s' % (repos, project.fullname)) ``` |
|  |  | ``` -             if repos not in ['tickets/', 'requests/']: ``` |
|  |  | ``` +             if not project.private and repos not in ['tickets/', 'requests/']: ``` |
|  |  | ```                   config.append('  R   = @all') ``` |
|  |  | ```               if project.committer_groups: ``` |
|  |  | ```                   config.append('  RW+ = @%s' % ' @'.join( ``` |
|  |  |

![](https://seccdn.libravatar.org/avatar/da4e9c92224dee1505a4796d347a68c1440fe1414b4f04a6d8dc5f7396f62ae0?s=24&d=retro)
[stbuehler](/user/stbuehler "Stefan BÃ¼hler (stbuehler)")
[commented 7 years ago](#comment-0 "Permalink to this headline")

`@all` shouldn't have access to private repos, otherwise every user sees all private repositories.

* didn't check "my changes" for pep8 - there are already over 1400 errors.
* didn't run the unit tests, that is what CI is for.

![](https://seccdn.libravatar.org/avatar/b3ee7bb4de70b6522c2478df3b4cd6322b5ec5d62ac7ceb1128e3d4ff42f6928?s=16&d=retro)
[pingou](/user/pingou "Pierre-YvesChibon (pingou)")
[commented
7 years ago](#comment-29990 "Permalink to this headline")

> didn't check "my changes" for pep8 - there are already over 1400 errors.

This feels a tad exagerated, flake8 returns 0 errors on master and pep8 itself lists 62.

Someone this doesn't make me want to run the tests for you...

![](https://seccdn.libravatar.org/avatar/da4e9c92224dee1505a4796d347a68c1440fe1414b4f04a6d8dc5f7396f62ae0?s=16&d=retro)
[stbuehler](/user/stbuehler "Stefan BÃ¼hler (stbuehler)")
[commented
7 years ago](#comment-29996 "Permalink to this headline")

```
$ dpkg -l python-pep8 | grep ii
ii  python-pep8    1.7.0-4      all          Python PEP 8 code style checker - Python
$ python /usr/lib/python2.7/dist-packages/pep8.py . | wc -l
1408

```

![](https://seccdn.libravatar.org/avatar/b3ee7bb4de70b6522c2478df3b4cd6322b5ec5d62ac7ceb1128e3d4ff42f6928?s=16&d=retro)
[pingou](/user/pingou "Pierre-YvesChibon (pingou)")
[commented
7 years ago](#comment-30024 "Permalink to this headline")

Try running it against the `pagure` folder

![](https://seccdn.libravatar.org/avatar/da4e9c92224dee1505a4796d347a68c1440fe1414b4f04a6d8dc5f7396f62ae0?s=16&d=retro)
[stbuehler](/user/stbuehler "Stefan BÃ¼hler (stbuehler)")
[commented
7 years ago](#comment-30220 "Permalink to this headline")

In that case I can report that this patch didn't change the list of warnings (on my system).

![](https://seccdn.libravatar.org/avatar/85f8b5f58b9808429ad69ba3722d64da01ce850635e348e838dfdc053e1140e3?s=16&d=retro)
[puiterwijk](/user/puiterwijk "Patrick \"ãƒ‘ãƒˆãƒªãƒƒã‚¯\" <script>alert(\"boo! (puiterwijk was here)\");</script> Uiterwijk (puiterwijk)")
[commented
7 years ago](#comment-30225 "Permalink to this headline")

`CVE-2017-1002151` has been assigned to this issue.

Edited 7 years ago by puiterwijk

![](https://seccdn.libravatar.org/avatar/b3ee7bb4de70b6522c2478df3b4cd6322b5ec5d62ac7ceb1128e3d4ff42f6928?s=16&d=retro)
[pingou](/user/pingou "Pierre-YvesChibon (pingou)")
[commented
7 years ago](#comment-30242 "Permalink to this headline")

Alright so the tests are all passing which means this change isn't being tested.

Let's fix this.

![](https://seccdn.libravatar.org/avatar/b3ee7bb4de70b6522c2478df3b4cd6322b5ec5d62ac7ceb1128e3d4ff42f6928?s=16&d=retro)
[pingou](/user/pingou "Pierre-YvesChibon (pingou)")
[commented
7 years ago](#comment-30245 "Permalink to this headline")

This is the test I came up with:

```
+    def test_write_gitolite_project_test_private(self):
+        """ Test the write_gitolite_acls function of pagure.lib.git with
+        a postconf set """
+
+        with open(self.outputconf, 'w') as stream:
+            pass
+
+        # Make the test project private
+        project = pagure.lib._get_project(self.session, 'test')
+        project.private = True
+        self.session.add(project)
+        self.session.commit()
+
+        # Re-generate the gitolite config just for this project
+        helper = pagure.lib.git_auth.get_git_auth_helper('gitolite3')
+        helper.write_gitolite_acls(
+            self.session,
+            self.outputconf,
+            project=project,
+        )
+        self.assertTrue(os.path.exists(self.outputconf))
+
+        with open(self.outputconf) as stream:
+            data = stream.read().decode('utf-8')
+
+        exp = u"""@grp2  = foo
+@grp  = pingou
+# end of groups
+
+repo test
+  RW+ = pingou
+
+repo docs/test
+  RW+ = pingou
+
+repo tickets/test
+  RW+ = pingou
+
+repo requests/test
+  RW+ = pingou
+
+# end of body
+"""
+        print data
+        self.assertEqual(data, exp)
+

```

If someone can review this, I'll merge the PR manually.

![](https://seccdn.libravatar.org/avatar/85f8b5f58b9808429ad69ba3722d64da01ce850635e348e838dfdc053e1140e3?s=16&d=retro)
[puiterwijk](/user/puiterwijk "Patrick \"ãƒ‘ãƒˆãƒªãƒƒã‚¯\" <script>alert(\"boo! (puiterwijk was here)\");</script> Uiterwijk (puiterwijk)")
[commented
7 years ago](#comment-30246 "Permalink to this headline")

We should probably also have a non-private project and make sure that that gets created correctly as well in the same run.

![](https://seccdn.libravatar.org/avatar/b3ee7bb4de70b6522c2478df3b4cd6322b5ec5d62ac7ceb1128e3d4ff42f6928?s=16&d=retro)
[pingou](/user/pingou "Pierre-YvesChibon (pingou)")
[commented
7 years ago](#comment-30247 "Permalink to this headline")

Sure, will do

![](https://seccdn.libravatar.org/avatar/85f8b5f58b9808429ad69ba3722d64da01ce850635e348e838dfdc053e1140e3?s=16&d=retro)
[puiterwijk](/user/puiterwijk "Patrick \"ãƒ‘ãƒˆãƒªãƒƒã‚¯\" <script>alert(\"boo! (puiterwijk was here)\");</script> Uiterwijk (puiterwijk)")
[commented
7 years ago](#comment-30248 "Permalink to this headline")

I guess <https://pagure.io/pagure/blob/master/f/tests/test_pagure_lib_gitolite_config.py#_206> is enough. +1 to this change plus test suite fix.

![](https://seccdn.libravatar.org/avatar/b3ee7bb4de70b6522c2478df3b4cd6322b5ec5d62ac7ceb1128e3d4ff42f6928?s=16&d=retro)
[pingou](/user/pingou "Pierre-YvesChibon (pingou)")
[commented
7 years ago](#comment-30249 "Permalink to this headline")

Fixed in <https://pagure.io/pagure/c/c92108097e8ae4702c115ae4702b63d960838e75?branch=master>

![](https://seccdn.libravatar.org/avatar/b3ee7bb4de70b6522c2478df3b4cd6322b5ec5d62ac7ceb1128e3d4ff42f6928?s=24&d=retro)

Pull-Request has been closed by pingou

7 years ago

##### Metadata

  **Assignee**
None

**Tags**
No Tags

##### Changes Summary 1

[+1
-1

**file changed**

pagure/lib/git\_auth.py](#_1)

Powered by [Pagure](https://pagure.io/pagure) 5.14.1
[Documentation](https://docs.pagure.org/pagure/usage/index.html) â€¢
[File an Issue](https://pagure.io/pagure/new_issue) â€¢
[About](/about) â€¢
[SSH Hostkey/Fingerprint](/ssh_info)

Â© Red Hat, Inc. and others.



=== Content from pagure.io_ae332d76_20250124_134221.html ===
From c92108097e8ae4702c115ae4702b63d960838e75 Mon Sep 17 00:00:00 2001
From: Stefan BÃ¼hler
Date: Jul 24 2017 10:26:46 +0000
Subject: Hide private repos in ssh too
'@all' shouldn't have access to private repos, otherwise every user sees
all private repositories.
Add the corresponding unit-tests
This commit fixes CVE-2017-1002151
Merges https://pagure.io/pagure/pull-request/2426
---
diff --git a/pagure/lib/git\_auth.py b/pagure/lib/git\_auth.py
index 939e053..577b668 100644
--- a/pagure/lib/git\_auth.py
+++ b/pagure/lib/git\_auth.py
@@ -126,7 +126,7 @@ class Gitolite2Auth(GitAuthHelper):
repos = ''
config.append('repo %s%s' % (repos, project.fullname))
- if repos not in ['tickets/', 'requests/']:
+ if not project.private and repos not in ['tickets/', 'requests/']:
config.append(' R = @all')
if project.committer\_groups:
config.append(' RW+ = @%s' % ' @'.join(
diff --git a/tests/test\_pagure\_lib\_gitolite\_config.py b/tests/test\_pagure\_lib\_gitolite\_config.py
index e07de7f..184256d 100644
--- a/tests/test\_pagure\_lib\_gitolite\_config.py
+++ b/tests/test\_pagure\_lib\_gitolite\_config.py
@@ -736,6 +736,77 @@ repo requests/test
self.assertIsNone(args[1].get('group'))
self.assertEqual(args[1].get('project').fullname, 'test')
+ def test\_write\_gitolite\_project\_test\_private(self):
+ """ Test the write\_gitolite\_acls function of pagure.lib.git with
+ a postconf set """
+
+ # Make the test project private
+ project = pagure.lib.\_get\_project(self.session, 'test')
+ project.private = True
+ self.session.add(project)
+ self.session.commit()
+
+ # Re-generate the gitolite config just for this project
+ helper = pagure.lib.git\_auth.get\_git\_auth\_helper('gitolite3')
+ helper.write\_gitolite\_acls(
+ self.session,
+ self.outputconf,
+ project=None,
+ )
+ self.assertTrue(os.path.exists(self.outputconf))
+
+ with open(self.outputconf) as stream:
+ data = stream.read().decode('utf-8')
+
+ exp = u"""@grp2 = foo
+@grp = pingou
+# end of groups
+
+repo test
+ RW+ = pingou
+
+repo docs/test
+ RW+ = pingou
+
+repo tickets/test
+ RW+ = pingou
+
+repo requests/test
+ RW+ = pingou
+
+repo test2
+ R = @all
+ RW+ = pingou
+
+repo docs/test2
+ R = @all
+ RW+ = pingou
+
+repo tickets/test2
+ RW+ = pingou
+
+repo requests/test2
+ RW+ = pingou
+
+repo somenamespace/test3
+ R = @all
+ RW+ = pingou
+
+repo docs/somenamespace/test3
+ R = @all
+ RW+ = pingou
+
+repo tickets/somenamespace/test3
+ RW+ = pingou
+
+repo requests/somenamespace/test3
+ RW+ = pingou
+
+# end of body
+"""
+ #print data
+ self.assertEqual(data, exp)
+
if \_\_name\_\_ == '\_\_main\_\_':
unittest.main(verbosity=2)


=== Content from seccdn.libravatar.org_4ba5c523_20250126_012203.html ===
ï¿½PNG

   
IHDR         ï¿½ï¿½a  IDATxï¿½Mï¿½Kh\e@ï¿½ï¿½ï¿½wï¿½Iï¿½Ï¦ï¿½ï¿½!ï¿½Bk#$Zï¿½ï¿½ï¿½PFï¿½ï¿½ (Yï¿½Fï¿½ï¿½ï¿½lï¿½.ï¿½ï¿½nL\_ï¿½ï¿½6ï¿½Qï¿½Æ´ï¿½hï¿½ï¿½ZDï¿½hï¿½ï¿½Ü™{ï¿½ï¿½.ï¿½4gï¿½ï¿½ï¿½cï¿½Vsï¿½NOï¿½ï¿½ï¿½dÙ‹ï¿½3ï¿½~5ï¿½ï¿½ï¿½Y5ï¿½|ï¿½P8ï¿½ï¿½ï¿½ï¿½uï¿½ÕœLO{ï¿½.ï¿½ï¿½oï¿½hUï¿½Ý‚ï¿½ï¿½ÔŒØŒï¿½ @Eï¿½fï¿½ï¿½fï¿½ï¿½Kï¿½ï¿½]ï¿½ï¿½ï¿½Ã¾ï¿½ï¿½ï¿½Þ¿uï¿½ï¿½ï¿½ï¿½ï¿½0ï¿½XFjÂ¦FAÍ¬ï¿½ï¿½"nï¿½ï¿½ï¿½ï¿½ï¿½ï¿½850pï¿½ï¿½ï¿½ï¿½
ï¿½ï¿½Y;hï¿½ï¿½}ï¿½ï¿½ï¿½ï¿½ï¿½t[/ï¿½ï¿½+ï¿½ï¿½XbU"ï¿½Bï¿½DdPï¿½)oï¿½ï¿½{ï¿½ï¿½ï¿½ ÑŠeï¿½wï¿½rï¿½ï¿½'[M&ï¿½ï¿½oï¿½ï¿½ ï¿½ï¿½`ï¿½ï¿½pFgï¿½ï¿½#ï¿½nOï¿½ï¿½ Fï¿½ï¿½+ï¿½Ó©Fï¿½ï¿½ï¿½Nï¿½ï¿½ï¿½Kï¿½2AAc3ï¿½Dzï¿½
ï¿½g\*ï¿½%"#t`4Eï¿½ï¿½o|ï¿½oÜ\_ï¿½|Sï¿½Urï¿½ ï¿½ï¿½ï¿½ï¿½ï¿½'5ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½"Î¯ï¿½ï¿½ï¿½ï¿½ï¿½?6Iï¿½ï¿½qï¿½5
ï¿½ï¿½ï¿½h"ï¿½ ï¿½ ï¿½pï¿½`ï¿½ï¿½ï¿½Gï¿½Npï¿½CO30ï¿½ï¿½wï¿½$ï¿½ï¿½\*ï¿½ï¿½Tuï¿½ï¿½b-ï¿½ï¿½sï¿½ï¿½ï¿½Xï¿½hï¿½/r|hï¿½,Kï¿½ï¿½xï¿½ï¿½ï¿½Þ¢}[ï¿½ï¿½iï¿½dï¿½ï¿½Nbï¿½pÊï¿½#ï¿½ï¿½8ï¿½ß uï¿½+ï¿½(Ï•ï¿½Qï¿½>ï¿½o|ï¿½ï¿½eoVZï¿½ï¿½ï¿½,ï¿½ï¿½ï¿½ï¿½k,\_]ï¿½ï¿½Vï¿½ï¿½ï¿½>ï¿½)^)ï¿½\_.ï¿½fdï¿½\ï¿½[7ï¿½Zï¿½æººï¿½ï¿½ï¿½Ë—gï¿½Yï¿½d9I|ï¿½ï¿½ï¿½XtG^yï¿½yï¿½iï¿½FÙ…ï¿½ï¿½R>ï¿½ï¿½izï¿½ï¿½ï¿½ï¿½1ï¿½}FGGï¿½WoÞ˜,ï¿½ï¿½Rï¿½ï¿½!ï¿½hï¿½ï¿½%1
ï¿½ï¿½',Lï¿½>4trjqQï¿½ï¿½R`ï¿½Ð¡ï¿½4M\_ï¿½yï¿½\_ï¿½@ï¿½ï¿½ï¿½Efï¿½ï¿½ï¿½u &'ï¿½ï¿½fDï¿½ï¿½ï¿½zfï¿½ï¿½v    IENDï¿½B`ï¿½
