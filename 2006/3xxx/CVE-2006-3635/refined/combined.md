=== Content from idp-portal.suse.com_6b95d262_20250126_011134.html ===

## UCS

# Welcome to Univention Corporate Server

## JavaScript required

A browser with JavaScript enabled is required in order to use this service.

When using Internet Explorer, please check your security settings and add this address to your trusted sites.



=== Content from github.com_cbd5d2cb_20250124_125129.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F4dcc29e1574d88f4465ba865ed82800032f76418)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F4dcc29e1574d88f4465ba865ed82800032f76418)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.9k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  437](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/4dcc29e1574d88f4465ba865ed82800032f76418)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[IA64] Workaround for RSE issue

[Browse files](/torvalds/linux/tree/4dcc29e1574d88f4465ba865ed82800032f76418)
Browse the repository at this point in the history

```
Problem: An application violating the architectural rules regarding
operation dependencies and having specific Register Stack Engine (RSE)
state at the time of the violation, may result in an illegal operation
fault and invalid RSE state.  Such faults may initiate a cascade of
repeated illegal operation faults within OS interruption handlers.
The specific behavior is OS dependent.

Implication: An application causing an illegal operation fault with
specific RSE state may result in a series of illegal operation faults
and an eventual OS stack overflow condition.

Workaround: OS interruption handlers that switch to kernel backing
store implement a check for invalid RSE state to avoid the series
of illegal operation faults.

The core of the workaround is the RSE_WORKAROUND code sequence
inserted into each invocation of the SAVE_MIN_WITH_COVER and
SAVE_MIN_WITH_COVER_R19 macros.  This sequence includes hard-coded
constants that depend on the number of stacked physical registers
being 96.  The rest of this patch consists of code to disable this
workaround should this not be the case (with the presumption that
if a future Itanium processor increases the number of registers, it
would also remove the need for this patch).

Move the start of the RBS up to a mod32 boundary to avoid some
corner cases.

The dispatch_illegal_op_fault code outgrew the spot it was
squatting in when built with this patch and CONFIG_VIRT_CPU_ACCOUNTING=y
Move it out to the end of the ivt.

Signed-off-by: Tony Luck <tony.luck@intel.com>
```

* Loading branch information

[![@aegl](https://avatars.githubusercontent.com/u/5446021?s=40&v=4)](/aegl)

[aegl](/torvalds/linux/commits?author=aegl "View all commits by aegl")
committed
May 27, 2008

1 parent
[e490517](/torvalds/linux/commit/e490517a039a99d692cb3a5561941b0a5f576172)

commit 4dcc29e

 Show file tree

 Hide file tree

Showing
**8 changed files**
with
**128 additions**
and
**47 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* arch/ia64/kernel

  + arch/ia64/kernel/ivt.S
    [ivt.S](#diff-5b2aeb0403f2a8c8d14f62cd5b78ff80fa89ca638be25fdb9e09ad38a6433a3c)
  + arch/ia64/kernel/minstate.h
    [minstate.h](#diff-eeb670d703f108bd0d7fbeef06c8eebf936a9c17818f8b9f727756b82e4c3662)
  + arch/ia64/kernel/patch.c
    [patch.c](#diff-3c0df67d46782c5577fd008a191b2f3ca237a2f3018a7b73bcba914e5f1d7aef)
  + arch/ia64/kernel/setup.c
    [setup.c](#diff-e534e4785c4f51fa7bba51b0a2980fff05a6faf56a16fc858ed352ec52406793)
  + arch/ia64/kernel/vmlinux.lds.S
    [vmlinux.lds.S](#diff-efc7c51bfa8846ab459d6ba73fde1b36ff83db4bd8e565fe5d6ead459cac89b4)
* include/asm-ia64

  + include/asm-ia64/patch.h
    [patch.h](#diff-c55e4bc8d249862787f6dceab69458c0103cdae8c8e926e8bb883fe6b911a573)
  + include/asm-ia64/ptrace.h
    [ptrace.h](#diff-0bec7782aa933c1d155314c12f88f562e81245fbc8ec3e1eb0e4f113c1fe881c)
  + include/asm-ia64/sections.h
    [sections.h](#diff-2d3c26ecff459c3165e6ed6255350a8ffdf94e024a5988bb2e351bc16cd8916a)

## There are no files selected for viewing

84 changes: 42 additions & 42 deletions

84
[arch/ia64/kernel/ivt.S](#diff-5b2aeb0403f2a8c8d14f62cd5b78ff80fa89ca638be25fdb9e09ad38a6433a3c "arch/ia64/kernel/ivt.S")

Show comments

[View file](/torvalds/linux/blob/4dcc29e1574d88f4465ba865ed82800032f76418/arch/ia64/kernel/ivt.S)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1076,48 +1076,6 @@ END(ia64\_syscall\_setup) |
|  |  | DBG\_FAULT(15) |
|  |  | FAULT(15) |
|  |  |  |
|  |  | /\* |
|  |  | \* Squatting in this space ... |
|  |  | \* |
|  |  | \* This special case dispatcher for illegal operation faults allows preserved |
|  |  | \* registers to be modified through a callback function (asm only) that is handed |
|  |  | \* back from the fault handler in r8. Up to three arguments can be passed to the |
|  |  | \* callback function by returning an aggregate with the callback as its first |
|  |  | \* element, followed by the arguments. |
|  |  | \*/ |
|  |  | ENTRY(dispatch\_illegal\_op\_fault) |
|  |  | .prologue |
|  |  | .body |
|  |  | SAVE\_MIN\_WITH\_COVER |
|  |  | ssm psr.ic | PSR\_DEFAULT\_BITS |
|  |  | ;; |
|  |  | srlz.i // guarantee that interruption collection is on |
|  |  | ;; |
|  |  | (p15) ssm psr.i // restore psr.i |
|  |  | adds r3=8,r2 // set up second base pointer for SAVE\_REST |
|  |  | ;; |
|  |  | alloc r14=ar.pfs,0,0,1,0 // must be first in insn group |
|  |  | mov out0=ar.ec |
|  |  | ;; |
|  |  | SAVE\_REST |
|  |  | PT\_REGS\_UNWIND\_INFO(0) |
|  |  | ;; |
|  |  | br.call.sptk.many rp=ia64\_illegal\_op\_fault |
|  |  | .ret0: ;; |
|  |  | alloc r14=ar.pfs,0,0,3,0 // must be first in insn group |
|  |  | mov out0=r9 |
|  |  | mov out1=r10 |
|  |  | mov out2=r11 |
|  |  | movl r15=ia64\_leave\_kernel |
|  |  | ;; |
|  |  | mov rp=r15 |
|  |  | mov b6=r8 |
|  |  | ;; |
|  |  | cmp.ne p6,p0=0,r8 |
|  |  | (p6) br.call.dpnt.many b6=b6 // call returns to ia64\_leave\_kernel |
|  |  | br.sptk.many ia64\_leave\_kernel |
|  |  | END(dispatch\_illegal\_op\_fault) |
|  |  |  |
|  |  | .org ia64\_ivt+0x4000 |
|  |  | ///////////////////////////////////////////////////////////////////////////////////////// |
|  |  | // 0x4000 Entry 16 (size 64 bundles) Reserved |
| Expand Down  Expand Up | | @@ -1715,6 +1673,48 @@ END(ia32\_interrupt) |
|  |  | DBG\_FAULT(67) |
|  |  | FAULT(67) |
|  |  |  |
|  |  | /\* |
|  |  | \* Squatting in this space ... |
|  |  | \* |
|  |  | \* This special case dispatcher for illegal operation faults allows preserved |
|  |  | \* registers to be modified through a callback function (asm only) that is handed |
|  |  | \* back from the fault handler in r8. Up to three arguments can be passed to the |
|  |  | \* callback function by returning an aggregate with the callback as its first |
|  |  | \* element, followed by the arguments. |
|  |  | \*/ |
|  |  | ENTRY(dispatch\_illegal\_op\_fault) |
|  |  | .prologue |
|  |  | .body |
|  |  | SAVE\_MIN\_WITH\_COVER |
|  |  | ssm psr.ic | PSR\_DEFAULT\_BITS |
|  |  | ;; |
|  |  | srlz.i // guarantee that interruption collection is on |
|  |  | ;; |
|  |  | (p15) ssm psr.i // restore psr.i |
|  |  | adds r3=8,r2 // set up second base pointer for SAVE\_REST |
|  |  | ;; |
|  |  | alloc r14=ar.pfs,0,0,1,0 // must be first in insn group |
|  |  | mov out0=ar.ec |
|  |  | ;; |
|  |  | SAVE\_REST |
|  |  | PT\_REGS\_UNWIND\_INFO(0) |
|  |  | ;; |
|  |  | br.call.sptk.many rp=ia64\_illegal\_op\_fault |
|  |  | .ret0: ;; |
|  |  | alloc r14=ar.pfs,0,0,3,0 // must be first in insn group |
|  |  | mov out0=r9 |
|  |  | mov out1=r10 |
|  |  | mov out2=r11 |
|  |  | movl r15=ia64\_leave\_kernel |
|  |  | ;; |
|  |  | mov rp=r15 |
|  |  | mov b6=r8 |
|  |  | ;; |
|  |  | cmp.ne p6,p0=0,r8 |
|  |  | (p6) br.call.dpnt.many b6=b6 // call returns to ia64\_leave\_kernel |
|  |  | br.sptk.many ia64\_leave\_kernel |
|  |  | END(dispatch\_illegal\_op\_fault) |
|  |  |  |
|  |  | #ifdef CONFIG\_IA32\_SUPPORT |
|  |  |  |
|  |  | /\* |
| Expand Down | |  |

46 changes: 42 additions & 4 deletions

46
[arch/ia64/kernel/minstate.h](#diff-eeb670d703f108bd0d7fbeef06c8eebf936a9c17818f8b9f727756b82e4c3662 "arch/ia64/kernel/minstate.h")

Show comments

[View file](/torvalds/linux/blob/4dcc29e1574d88f4465ba865ed82800032f76418/arch/ia64/kernel/minstate.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -15,6 +15,9 @@ |
|  |  | #define ACCOUNT\_SYS\_ENTER |
|  |  | #endif |
|  |  |  |
|  |  | .section ".data.patch.rse", "a" |
|  |  | .previous |
|  |  |  |
|  |  | /\* |
|  |  | \* DO\_SAVE\_MIN switches to the kernel stacks (if necessary) and saves |
|  |  | \* the minimum state necessary that allows us to turn psr.ic back |
| Expand All | | @@ -40,7 +43,7 @@ |
|  |  | \* Note that psr.ic is NOT turned on by this macro. This is so that |
|  |  | \* we can pass interruption state as arguments to a handler. |
|  |  | \*/ |
|  |  | #define DO\_SAVE\_MIN(COVER,SAVE\_IFS,EXTRA)  \ |
|  |  | #define DO\_SAVE\_MIN(COVER,SAVE\_IFS,EXTRA,WORKAROUND) \ |
|  |  | mov r16=IA64\_KR(CURRENT); /\* M \*/ \ |
|  |  | mov r27=ar.rsc; /\* M \*/ \ |
|  |  | mov r20=r1; /\* A \*/ \ |
| Expand Down  Expand Up | | @@ -87,6 +90,7 @@ |
|  |  | tbit.nz p15,p0=r29,IA64\_PSR\_I\_BIT; \ |
|  |  | mov r29=b0 \ |
|  |  | ;; \ |
|  |  | WORKAROUND; \ |
|  |  | adds r16=PT(R8),r1; /\* initialize first base pointer \*/ \ |
|  |  | adds r17=PT(R9),r1; /\* initialize second base pointer \*/ \ |
|  |  | (pKStk) mov r18=r0; /\* make sure r18 isn't NaT \*/ \ |
| Expand Down  Expand Up | | @@ -206,6 +210,40 @@ |
|  |  | st8 [r25]=r10; /\* ar.ssd \*/ \ |
|  |  | ;; |
|  |  |  |
|  |  | #define SAVE\_MIN\_WITH\_COVER DO\_SAVE\_MIN(cover, mov r30=cr.ifs,) |
|  |  | #define SAVE\_MIN\_WITH\_COVER\_R19 DO\_SAVE\_MIN(cover, mov r30=cr.ifs, mov r15=r19) |
|  |  | #define SAVE\_MIN DO\_SAVE\_MIN( , mov r30=r0, ) |
|  |  | #define RSE\_WORKAROUND \ |
|  |  | (pUStk) extr.u r17=r18,3,6; \ |
|  |  | (pUStk) sub r16=r18,r22; \ |
|  |  | [1:](pKStk) br.cond.sptk.many 1f; \ |
|  |  | .xdata4 ".data.patch.rse",1b-. \ |
|  |  | ;; \ |
|  |  | cmp.ge p6,p7 = 33,r17; \ |
|  |  | ;; \ |
|  |  | (p6) mov r17=0x310; \ |
|  |  | (p7) mov r17=0x308; \ |
|  |  | ;; \ |
|  |  | cmp.leu p1,p0=r16,r17; \ |
|  |  | (p1) br.cond.sptk.many 1f; \ |
|  |  | dep.z r17=r26,0,62; \ |
|  |  | movl r16=2f; \ |
|  |  | ;; \ |
|  |  | mov ar.pfs=r17; \ |
|  |  | dep r27=r0,r27,16,14; \ |
|  |  | mov b0=r16; \ |
|  |  | ;; \ |
|  |  | br.ret.sptk b0; \ |
|  |  | ;; \ |
|  |  | 2: \ |
|  |  | mov ar.rsc=r0 \ |
|  |  | ;; \ |
|  |  | flushrs; \ |
|  |  | ;; \ |
|  |  | mov ar.bspstore=r22 \ |
|  |  | ;; \ |
|  |  | mov r18=ar.bsp; \ |
|  |  | ;; \ |
|  |  | 1: \ |
|  |  | .pred.rel "mutex", pKStk, pUStk |
|  |  |  |
|  |  | #define SAVE\_MIN\_WITH\_COVER DO\_SAVE\_MIN(cover, mov r30=cr.ifs, , RSE\_WORKAROUND) |
|  |  | #define SAVE\_MIN\_WITH\_COVER\_R19 DO\_SAVE\_MIN(cover, mov r30=cr.ifs, mov r15=r19, RSE\_WORKAROUND) |
|  |  | #define SAVE\_MIN DO\_SAVE\_MIN( , mov r30=r0, , ) |

23 changes: 23 additions & 0 deletions

23
[arch/ia64/kernel/patch.c](#diff-3c0df67d46782c5577fd008a191b2f3ca237a2f3018a7b73bcba914e5f1d7aef "arch/ia64/kernel/patch.c")

Show comments

[View file](/torvalds/linux/blob/4dcc29e1574d88f4465ba865ed82800032f76418/arch/ia64/kernel/patch.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -115,6 +115,29 @@ ia64\_patch\_vtop (unsigned long start, unsigned long end) |
|  |  | ia64\_srlz\_i(); |
|  |  | } |
|  |  |  |
|  |  | /\* |
|  |  | \* Disable the RSE workaround by turning the conditional branch |
|  |  | \* that we tagged in each place the workaround was used into an |
|  |  | \* unconditional branch. |
|  |  | \*/ |
|  |  | void \_\_init |
|  |  | ia64\_patch\_rse (unsigned long start, unsigned long end) |
|  |  | { |
|  |  | s32 \*offp = (s32 \*) start; |
|  |  | u64 ip, \*b; |
|  |  |  |
|  |  | while (offp < (s32 \*) end) { |
|  |  | ip = (u64) offp + \*offp; |
|  |  |  |
|  |  | b = (u64 \*)(ip & -16); |
|  |  | b[1] &= ~0xf800000L; |
|  |  | ia64\_fc((void \*) ip); |
|  |  | ++offp; |
|  |  | } |
|  |  | ia64\_sync\_i(); |
|  |  | ia64\_srlz\_i(); |
|  |  | } |
|  |  |  |
|  |  | void \_\_init |
|  |  | ia64\_patch\_mckinley\_e9 (unsigned long start, unsigned long end) |
|  |  | { |
| Expand Down | |  |

11 changes: 11 additions & 0 deletions

11
[arch/ia64/kernel/setup.c](#diff-e534e4785c4f51fa7bba51b0a2980fff05a6faf56a16fc858ed352ec52406793 "arch/ia64/kernel/setup.c")

Show comments

[View file](/torvalds/linux/blob/4dcc29e1574d88f4465ba865ed82800032f76418/arch/ia64/kernel/setup.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -560,6 +560,17 @@ setup\_arch (char \*\*cmdline\_p) |
|  |  | /\* process SAL system table: \*/ |
|  |  | ia64\_sal\_init(\_\_va(efi.sal\_systab)); |
|  |  |  |
|  |  | #ifdef CONFIG\_ITANIUM |
|  |  | ia64\_patch\_rse((u64) \_\_start\_\_\_rse\_patchlist, (u64) \_\_end\_\_\_rse\_patchlist); |
|  |  | #else |
|  |  | { |
|  |  | u64 num\_phys\_stacked; |
|  |  |  |
|  |  | if (ia64\_pal\_rse\_info(&num\_phys\_stacked, 0) == 0 && num\_phys\_stacked > 96) |
|  |  | ia64\_patch\_rse((u64) \_\_start\_\_\_rse\_patchlist, (u64) \_\_end\_\_\_rse\_patchlist); |
|  |  | } |
|  |  | #endif |
|  |  |  |
|  |  | #ifdef CONFIG\_SMP |
|  |  | cpu\_physical\_id(0) = hard\_smp\_processor\_id(); |
|  |  | #endif |
| Expand Down | |  |

7 changes: 7 additions & 0 deletions

7
[arch/ia64/kernel/vmlinux.lds.S](#diff-efc7c51bfa8846ab459d6ba73fde1b36ff83db4bd8e565fe5d6ead459cac89b4 "arch/ia64/kernel/vmlinux.lds.S")

Show comments

[View file](/torvalds/linux/blob/4dcc29e1574d88f4465ba865ed82800032f76418/arch/ia64/kernel/vmlinux.lds.S)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -156,6 +156,13 @@ SECTIONS |
|  |  | \_\_end\_\_\_vtop\_patchlist = .; |
|  |  | } |
|  |  |  |
|  |  | .data.patch.rse : AT(ADDR(.data.patch.rse) - LOAD\_OFFSET) |
|  |  | { |
|  |  | \_\_start\_\_\_rse\_patchlist = .; |
|  |  | \*(.data.patch.rse) |
|  |  | \_\_end\_\_\_rse\_patchlist = .; |
|  |  | } |
|  |  |  |
|  |  | .data.patch.mckinley\_e9 : AT(ADDR(.data.patch.mckinley\_e9) - LOAD\_OFFSET) |
|  |  | { |
|  |  | \_\_start\_\_\_mckinley\_e9\_bundles = .; |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[include/asm-ia64/patch.h](#diff-c55e4bc8d249862787f6dceab69458c0103cdae8c8e926e8bb883fe6b911a573 "include/asm-ia64/patch.h")

Show comments

[View file](/torvalds/linux/blob/4dcc29e1574d88f4465ba865ed82800032f76418/include/asm-ia64/patch.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -21,6 +21,7 @@ extern void ia64\_patch\_imm60 (u64 insn\_addr, u64 val); /\* patch "brl" w/ip-rel |
|  |  | extern void ia64\_patch\_mckinley\_e9 (unsigned long start, unsigned long end); |
|  |  | extern void ia64\_patch\_vtop (unsigned long start, unsigned long end); |
|  |  | extern void ia64\_patch\_phys\_stack\_reg(unsigned long val); |
|  |  | extern void ia64\_patch\_rse (unsigned long start, unsigned long end); |
|  |  | extern void ia64\_patch\_gate (void); |
|  |  |  |
|  |  | #endif /\* \_ASM\_IA64\_PATCH\_H \*/ |

2 changes: 1 addition & 1 deletion

2
[include/asm-ia64/ptrace.h](#diff-0bec7782aa933c1d155314c12f88f562e81245fbc8ec3e1eb0e4f113c1fe881c "include/asm-ia64/ptrace.h")

Show comments

[View file](/torvalds/linux/blob/4dcc29e1574d88f4465ba865ed82800032f76418/include/asm-ia64/ptrace.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -76,7 +76,7 @@ |
|  |  | # define KERNEL\_STACK\_SIZE\_ORDER 0 |
|  |  | #endif |
|  |  |  |
|  |  | #define IA64\_RBS\_OFFSET ((IA64\_TASK\_SIZE + IA64\_THREAD\_INFO\_SIZE + 15) & ~15) |
|  |  | #define IA64\_RBS\_OFFSET ((IA64\_TASK\_SIZE + IA64\_THREAD\_INFO\_SIZE + 31) & ~31) |
|  |  | #define IA64\_STK\_OFFSET ((1 << KERNEL\_STACK\_SIZE\_ORDER)\*PAGE\_SIZE) |
|  |  |  |
|  |  | #define KERNEL\_STACK\_SIZE IA64\_STK\_OFFSET |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[include/asm-ia64/sections.h](#diff-2d3c26ecff459c3165e6ed6255350a8ffdf94e024a5988bb2e351bc16cd8916a "include/asm-ia64/sections.h")

Show comments

[View file](/torvalds/linux/blob/4dcc29e1574d88f4465ba865ed82800032f76418/include/asm-ia64/sections.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -10,6 +10,7 @@ |
|  |  |  |
|  |  | extern char \_\_per\_cpu\_start[], \_\_per\_cpu\_end[], \_\_phys\_per\_cpu\_start[]; |
|  |  | extern char \_\_start\_\_\_vtop\_patchlist[], \_\_end\_\_\_vtop\_patchlist[]; |
|  |  | extern char \_\_start\_\_\_rse\_patchlist[], \_\_end\_\_\_rse\_patchlist[]; |
|  |  | extern char \_\_start\_\_\_mckinley\_e9\_bundles[], \_\_end\_\_\_mckinley\_e9\_bundles[]; |
|  |  | extern char \_\_start\_\_\_phys\_stack\_reg\_patchlist[], \_\_end\_\_\_phys\_stack\_reg\_patchlist[]; |
|  |  | extern char \_\_start\_gate\_section[]; |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `4dcc29e`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F4dcc29e1574d88f4465ba865ed82800032f76418) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from git.kernel.org_5788c67b_20250124_125126.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=4dcc29e1574d88f4465ba865ed82800032f76418)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=4dcc29e1574d88f4465ba865ed82800032f76418)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=4dcc29e1574d88f4465ba865ed82800032f76418)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=4dcc29e1574d88f4465ba865ed82800032f76418)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Tony Luck <tony.luck@intel.com> | 2008-05-27 13:23:16 -0700 |
| --- | --- | --- |
| committer | Tony Luck <tony.luck@intel.com> | 2008-05-27 13:24:39 -0700 |
| commit | [4dcc29e1574d88f4465ba865ed82800032f76418](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=4dcc29e1574d88f4465ba865ed82800032f76418) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=4dcc29e1574d88f4465ba865ed82800032f76418)) | |
| tree | [5579a225a6782f0f5014cbbe6938847b7f3cd53f](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=4dcc29e1574d88f4465ba865ed82800032f76418) | |
| parent | [e490517a039a99d692cb3a5561941b0a5f576172](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=e490517a039a99d692cb3a5561941b0a5f576172) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=4dcc29e1574d88f4465ba865ed82800032f76418&id2=e490517a039a99d692cb3a5561941b0a5f576172)) | |
| download | [linux-4dcc29e1574d88f4465ba865ed82800032f76418.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-4dcc29e1574d88f4465ba865ed82800032f76418.tar.gz) | |

[IA64] Workaround for RSE issueProblem: An application violating the architectural rules regarding
operation dependencies and having specific Register Stack Engine (RSE)
state at the time of the violation, may result in an illegal operation
fault and invalid RSE state. Such faults may initiate a cascade of
repeated illegal operation faults within OS interruption handlers.
The specific behavior is OS dependent.
Implication: An application causing an illegal operation fault with
specific RSE state may result in a series of illegal operation faults
and an eventual OS stack overflow condition.
Workaround: OS interruption handlers that switch to kernel backing
store implement a check for invalid RSE state to avoid the series
of illegal operation faults.
The core of the workaround is the RSE\_WORKAROUND code sequence
inserted into each invocation of the SAVE\_MIN\_WITH\_COVER and
SAVE\_MIN\_WITH\_COVER\_R19 macros. This sequence includes hard-coded
constants that depend on the number of stacked physical registers
being 96. The rest of this patch consists of code to disable this
workaround should this not be the case (with the presumption that
if a future Itanium processor increases the number of registers, it
would also remove the need for this patch).
Move the start of the RBS up to a mod32 boundary to avoid some
corner cases.
The dispatch\_illegal\_op\_fault code outgrew the spot it was
squatting in when built with this patch and CONFIG\_VIRT\_CPU\_ACCOUNTING=y
Move it out to the end of the ivt.
Signed-off-by: Tony Luck <tony.luck@intel.com>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=4dcc29e1574d88f4465ba865ed82800032f76418)

| -rw-r--r-- | [arch/ia64/kernel/ivt.S](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/ia64/kernel/ivt.S?id=4dcc29e1574d88f4465ba865ed82800032f76418) | 84 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [arch/ia64/kernel/minstate.h](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/ia64/kernel/minstate.h?id=4dcc29e1574d88f4465ba865ed82800032f76418) | 46 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/ia64/kernel/patch.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/ia64/kernel/patch.c?id=4dcc29e1574d88f4465ba865ed82800032f76418) | 23 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/ia64/kernel/setup.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/ia64/kernel/setup.c?id=4dcc29e1574d88f4465ba865ed82800032f76418) | 11 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/ia64/kernel/vmlinux.lds.S](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/ia64/kernel/vmlinux.lds.S?id=4dcc29e1574d88f4465ba865ed82800032f76418) | 7 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [include/asm-ia64/patch.h](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/include/asm-ia64/patch.h?id=4dcc29e1574d88f4465ba865ed82800032f76418) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [include/asm-ia64/ptrace.h](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/include/asm-ia64/ptrace.h?id=4dcc29e1574d88f4465ba865ed82800032f76418) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [include/asm-ia64/sections.h](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/include/asm-ia64/sections.h?id=4dcc29e1574d88f4465ba865ed82800032f76418) | 1 | |  |  |  | | --- | --- | --- | |

8 files changed, 128 insertions, 47 deletions

| diff --git a/arch/ia64/kernel/ivt.S b/arch/ia64/kernel/ivt.Sindex 6678c49daba3c4..80b44ea052d744 100644--- a/[arch/ia64/kernel/ivt.S](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/ia64/kernel/ivt.S?id=e490517a039a99d692cb3a5561941b0a5f576172)+++ b/[arch/ia64/kernel/ivt.S](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/ia64/kernel/ivt.S?id=4dcc29e1574d88f4465ba865ed82800032f76418)@@ -1076,48 +1076,6 @@ END(ia64\_syscall\_setup) DBG\_FAULT(15) FAULT(15) - /\*- \* Squatting in this space ...- \*- \* This special case dispatcher for illegal operation faults allows preserved- \* registers to be modified through a callback function (asm only) that is handed- \* back from the fault handler in r8. Up to three arguments can be passed to the- \* callback function by returning an aggregate with the callback as its first- \* element, followed by the arguments.- \*/-ENTRY(dispatch\_illegal\_op\_fault)- .prologue- .body- SAVE\_MIN\_WITH\_COVER- ssm psr.ic | PSR\_DEFAULT\_BITS- ;;- srlz.i // guarantee that interruption collection is on- ;;-(p15) ssm psr.i // restore psr.i- adds r3=8,r2 // set up second base pointer for SAVE\_REST- ;;- alloc r14=ar.pfs,0,0,1,0 // must be first in insn group- mov out0=ar.ec- ;;- SAVE\_REST- PT\_REGS\_UNWIND\_INFO(0)- ;;- br.call.sptk.many rp=ia64\_illegal\_op\_fault-.ret0: ;;- alloc r14=ar.pfs,0,0,3,0 // must be first in insn group- mov out0=r9- mov out1=r10- mov out2=r11- movl r15=ia64\_leave\_kernel- ;;- mov rp=r15- mov b6=r8- ;;- cmp.ne p6,p0=0,r8-(p6) br.call.dpnt.many b6=b6 // call returns to ia64\_leave\_kernel- br.sptk.many ia64\_leave\_kernel-END(dispatch\_illegal\_op\_fault)- .org ia64\_ivt+0x4000 ///////////////////////////////////////////////////////////////////////////////////////// // 0x4000 Entry 16 (size 64 bundles) Reserved@@ -1715,6 +1673,48 @@ END(ia32\_interrupt) DBG\_FAULT(67) FAULT(67) + /\*+ \* Squatting in this space ...+ \*+ \* This special case dispatcher for illegal operation faults allows preserved+ \* registers to be modified through a callback function (asm only) that is handed+ \* back from the fault handler in r8. Up to three arguments can be passed to the+ \* callback function by returning an aggregate with the callback as its first+ \* element, followed by the arguments.+ \*/+ENTRY(dispatch\_illegal\_op\_fault)+ .prologue+ .body+ SAVE\_MIN\_WITH\_COVER+ ssm psr.ic | PSR\_DEFAULT\_BITS+ ;;+ srlz.i // guarantee that interruption collection is on+ ;;+(p15) ssm psr.i // restore psr.i+ adds r3=8,r2 // set up second base pointer for SAVE\_REST+ ;;+ alloc r14=ar.pfs,0,0,1,0 // must be first in insn group+ mov out0=ar.ec+ ;;+ SAVE\_REST+ PT\_REGS\_UNWIND\_INFO(0)+ ;;+ br.call.sptk.many rp=ia64\_illegal\_op\_fault+.ret0: ;;+ alloc r14=ar.pfs,0,0,3,0 // must be first in insn group+ mov out0=r9+ mov out1=r10+ mov out2=r11+ movl r15=ia64\_leave\_kernel+ ;;+ mov rp=r15+ mov b6=r8+ ;;+ cmp.ne p6,p0=0,r8+(p6) br.call.dpnt.many b6=b6 // call returns to ia64\_leave\_kernel+ br.sptk.many ia64\_leave\_kernel+END(dispatch\_illegal\_op\_fault)+ #ifdef CONFIG\_IA32\_SUPPORT  /\*diff --git a/arch/ia64/kernel/minstate.h b/arch/ia64/kernel/minstate.hindex 7c548ac52bbc09..74b6d670aaef2d 100644--- a/[arch/ia64/kernel/minstate.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/ia64/kernel/minstate.h?id=e490517a039a99d692cb3a5561941b0a5f576172)+++ b/[arch/ia64/kernel/minstate.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/ia64/kernel/minstate.h?id=4dcc29e1574d88f4465ba865ed82800032f76418)@@ -15,6 +15,9 @@ #define ACCOUNT\_SYS\_ENTER #endif +.section ".data.patch.rse", "a"+.previous+ /\* \* DO\_SAVE\_MIN switches to the kernel stacks (if necessary) and saves \* the minimum state necessary that allows us to turn psr.ic back@@ -40,7 +43,7 @@ \* Note that psr.ic is NOT turned on by this macro. This is so that \* we can pass interruption state as arguments to a handler. \*/-#define DO\_SAVE\_MIN(COVER,SAVE\_IFS,EXTRA) \+#define DO\_SAVE\_MIN(COVER,SAVE\_IFS,EXTRA,WORKAROUND) \ mov r16=IA64\_KR(CURRENT); /\* M \*/ \ mov r27=ar.rsc; /\* M \*/ \ mov r20=r1; /\* A \*/ \@@ -87,6 +90,7 @@ tbit.nz p15,p0=r29,IA64\_PSR\_I\_BIT; \ mov r29=b0 \ ;; \+ WORKAROUND; \ adds r16=PT(R8),r1; /\* initialize first base pointer \*/ \ adds r17=PT(R9),r1; /\* initialize second base pointer \*/ \ (pKStk) mov r18=r0; /\* make sure r18 isn't NaT \*/ \@@ -206,6 +210,40 @@ st8 [r25]=r10; /\* ar.ssd \*/ \ ;; -#define SAVE\_MIN\_WITH\_COVER DO\_SAVE\_MIN(cover, mov r30=cr.ifs,)-#define SAVE\_MIN\_WITH\_COVER\_R19 DO\_SAVE\_MIN(cover, mov r30=cr.ifs, mov r15=r19)-#define SAVE\_MIN DO\_SAVE\_MIN( , mov r30=r0, )+#define RSE\_WORKAROUND \+(pUStk) extr.u r17=r18,3,6; \+(pUStk) sub r16=r18,r22; \+[1:](pKStk) br.cond.sptk.many 1f; \+ .xdata4 ".data.patch.rse",1b-. \+ ;; \+ cmp.ge p6,p7 = 33,r17; \+ ;; \+(p6) mov r17=0x310; \+(p7) mov r17=0x308; \+ ;; \+ cmp.leu p1,p0=r16,r17; \+(p1) br.cond.sptk.many 1f; \+ dep.z r17=r26,0,62; \+ movl r16=2f; \+ ;; \+ mov ar.pfs=r17; \+ dep r27=r0,r27,16,14; \+ mov b0=r16; \+ ;; \+ br.ret.sptk b0; \+ ;; \+2: \+ mov ar.rsc=r0 \+ ;; \+ flushrs; \+ ;; \+ mov ar.bspstore=r22 \+ ;; \+ mov r18=ar.bsp; \+ ;; \+1: \+ .pred.rel "mutex", pKStk, pUStk++#define SAVE\_MIN\_WITH\_COVER DO\_SAVE\_MIN(cover, mov r30=cr.ifs, , RSE\_WORKAROUND)+#define SAVE\_MIN\_WITH\_COVER\_R19 DO\_SAVE\_MIN(cover, mov r30=cr.ifs, mov r15=r19, RSE\_WORKAROUND)+#define SAVE\_MIN DO\_SAVE\_MIN( , mov r30=r0, , )diff --git a/arch/ia64/kernel/patch.c b/arch/ia64/kernel/patch.cindex e0dca8743dbb11..b83b2c516008d4 100644--- a/[arch/ia64/kernel/patch.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/ia64/kernel/patch.c?id=e490517a039a99d692cb3a5561941b0a5f576172)+++ b/[arch/ia64/kernel/patch.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/ia64/kernel/patch.c?id=4dcc29e1574d88f4465ba865ed82800032f76418)@@ -115,6 +115,29 @@ ia64\_patch\_vtop (unsigned long start, unsigned long end) ia64\_srlz\_i(); } +/\*+ \* Disable the RSE workaround by turning the conditional branch+ \* that we tagged in each place the workaround was used into an+ \* unconditional branch.+ \*/+void \_\_init+ia64\_patch\_rse (unsigned long start, unsigned long end)+{+ s32 \*offp = (s32 \*) start;+ u64 ip, \*b;++ while (offp < (s32 \*) end) {+ ip = (u64) offp + \*offp;++ b = (u64 \*)(ip & -16);+ b[1] &= ~0xf800000L;+ ia64\_fc((void \*) ip);+ ++offp;+ }+ ia64\_sync\_i();+ ia64\_srlz\_i();+}+ void \_\_init ia64\_patch\_mckinley\_e9 (unsigned long start, unsigned long end) {diff --git a/arch/ia64/kernel/setup.c b/arch/ia64/kernel/setup.cindex e9596cd0cdab21..f48a809c686d89 100644--- a/[arch/ia64/kernel/setup.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/ia64/kernel/setup.c?id=e490517a039a99d692cb3a5561941b0a5f576172)+++ b/[arch/ia64/kernel/setup.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/ia64/kernel/setup.c?id=4dcc29e1574d88f4465ba865ed82800032f76418)@@ -560,6 +560,17 @@ setup\_arch (char \*\*cmdline\_p) /\* process SAL system table: \*/ ia64\_sal\_init(\_\_va(efi.sal\_systab)); +#ifdef CONFIG\_ITANIUM+ ia64\_patch\_rse((u64) \_\_start\_\_\_rse\_patchlist, (u64) \_\_end\_\_\_rse\_patchlist);+#else+ {+ u64 num\_phys\_stacked;++ if (ia64\_pal\_rse\_info(&num\_phys\_stacked, 0) == 0 && num\_phys\_stacked > 96)+ ia64\_patch\_rse((u64) \_\_start\_\_\_rse\_patchlist, (u64) \_\_end\_\_\_rse\_patchlist);+ }+#endif+ #ifdef CONFIG\_SMP cpu\_physical\_id(0) = hard\_smp\_processor\_id(); #endifdiff --git a/arch/ia64/kernel/vmlinux.lds.S b/arch/ia64/kernel/vmlinux.lds.Sindex 80622acc95deea..5929ab10a289d8 100644--- a/[arch/ia64/kernel/vmlinux.lds.S](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/ia64/kernel/vmlinux.lds.S?id=e490517a039a99d692cb3a5561941b0a5f576172)+++ b/[arch/ia64/kernel/vmlinux.lds.S](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/ia64/kernel/vmlinux.lds.S?id=4dcc29e1574d88f4465ba865ed82800032f76418)@@ -156,6 +156,13 @@ SECTIONS \_\_end\_\_\_vtop\_patchlist = .; } + .data.patch.rse : AT(ADDR(.data.patch.rse) - LOAD\_OFFSET)+ {+ \_\_start\_\_\_rse\_patchlist = .;+ \*(.data.patch.rse)+ \_\_end\_\_\_rse\_patchlist = .;+ }+ .data.patch.mckinley\_e9 : AT(ADDR(.data.patch.mckinley\_e9) - LOAD\_OFFSET) { \_\_start\_\_\_mckinley\_e9\_bundles = .;diff --git a/include/asm-ia64/patch.h b/include/asm-ia64/patch.hindex a71543084fb41d..295fe6ab4584c4 100644--- a/[include/asm-ia64/patch.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/asm-ia64/patch.h?id=e490517a039a99d692cb3a5561941b0a5f576172)+++ b/[include/asm-ia64/patch.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/asm-ia64/patch.h?id=4dcc29e1574d88f4465ba865ed82800032f76418)@@ -21,6 +21,7 @@ extern void ia64\_patch\_imm60 (u64 insn\_addr, u64 val); /\* patch "brl" w/ip-rel extern void ia64\_patch\_mckinley\_e9 (unsigned long start, unsigned long end); extern void ia64\_patch\_vtop (unsigned long start, unsigned long end); extern void ia64\_patch\_phys\_stack\_reg(unsigned long val);+extern void ia64\_patch\_rse (unsigned long start, unsigned long end); extern void ia64\_patch\_gate (void);  #endif /\* \_ASM\_IA64\_PATCH\_H \*/diff --git a/include/asm-ia64/ptrace.h b/include/asm-ia64/ptrace.hindex 4b2a8d40ebc5ed..15f8dcfe6eeef8 100644--- a/[include/asm-ia64/ptrace.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/asm-ia64/ptrace.h?id=e490517a039a99d692cb3a5561941b0a5f576172)+++ b/[include/asm-ia64/ptrace.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/asm-ia64/ptrace.h?id=4dcc29e1574d88f4465ba865ed82800032f76418)@@ -76,7 +76,7 @@ # define KERNEL\_STACK\_SIZE\_ORDER 0 #endif -#define IA64\_RBS\_OFFSET ((IA64\_TASK\_SIZE + IA64\_THREAD\_INFO\_SIZE + 15) & ~15)+#define IA64\_RBS\_OFFSET ((IA64\_TASK\_SIZE + IA64\_THREAD\_INFO\_SIZE + 31) & ~31) #define IA64\_STK\_OFFSET ((1 << KERNEL\_STACK\_SIZE\_ORDER)\*PAGE\_SIZE)  #define KERNEL\_STACK\_SIZE IA64\_STK\_OFFSETdiff --git a/include/asm-ia64/sections.h b/include/asm-ia64/sections.hindex dc42a359894fe7..7286e4a9fe8449 100644--- a/[include/asm-ia64/sections.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/asm-ia64/sections.h?id=e490517a039a99d692cb3a5561941b0a5f576172)+++ b/[include/asm-ia64/sections.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/asm-ia64/sections.h?id=4dcc29e1574d88f4465ba865ed82800032f76418)@@ -10,6 +10,7 @@  extern char \_\_per\_cpu\_start[], \_\_per\_cpu\_end[], \_\_phys\_per\_cpu\_start[]; extern char \_\_start\_\_\_vtop\_patchlist[], \_\_end\_\_\_vtop\_patchlist[];+extern char \_\_start\_\_\_rse\_patchlist[], \_\_end\_\_\_rse\_patchlist[]; extern char \_\_start\_\_\_mckinley\_e9\_bundles[], \_\_end\_\_\_mckinley\_e9\_bundles[]; extern char \_\_start\_\_\_phys\_stack\_reg\_patchlist[], \_\_end\_\_\_phys\_stack\_reg\_patchlist[]; extern char \_\_start\_gate\_section[]; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-24 12:50:03 +0000



=== Content from bugzilla.suse.com_f6dd6cc0_20250124_125127.html ===


| Bugzilla – Bug 199440 | VUL-0: CVE-2006-3635: kernel: local denial-of-service on Itanium | Last modified: 2019-05-01 14:48:09 UTC |
| --- | --- | --- |

|  |
| --- |

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [IDP Log In](/saml2_login.cgi?idp=IDP&target=show_bug.cgi%3Fid%3D199440)
* |
  [Forgot Password](https://idp-portal.suse.com/univention/self-service/#page=passwordreset)

[**Bug 199440**](show_bug.cgi?id=199440)
(CVE-2006-3635)
- VUL-0: CVE-2006-3635: kernel: local denial-of-service on Itanium

[Summary:](page.cgi?id=glossary.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
VUL-0: CVE-2006-3635: kernel: local denial-of-service on Itanium

| | [Status](page.cgi?id=status_resolution_matrix.html): | RESOLVED WONTFIX | | --- | --- | |  | | | [Alias:](page.cgi?id=glossary.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2006-3635 | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | SUSE Security Incidents | | [Classification:](page.cgi?id=glossary.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Novell Products | | [Component:](describecomponents.cgi?product=SUSE Security Incidents "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Incidents ([show other bugs](buglist.cgi?component=Incidents&product=SUSE%20Security%20Incidents&bug_status=__open__)) | | [Version:](page.cgi?id=glossary.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=glossary.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | IA64 Other | |  | | | [Priority](page.cgi?id=glossary.html#priority): | P5 - None **Severity**: Normal | | [Target Milestone:](page.cgi?id=glossary.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=glossary.html#assigned_to "The person in charge of resolving the bug.") | Andreas Schwab | | [QA Contact:](page.cgi?id=glossary.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | Security Team bot | |  | | | [URL:](page.cgi?id=glossary.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=glossary.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") | kernel:sles9 kernel:sles8 kernel:sle1... | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=glossary.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=glossary.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2006-08-15 10:38 UTC by Thomas Biege | | --- | --- | | Modified: | 2019-05-01 14:48 UTC ([History](show_activity.cgi?id=199440)) | | CC List: | 9 users (show)  forgotten\_vL9z7r9K-R gp jsegitz lmb meissner patch-request rw security-team tony.luck | |  | | | [See Also:](page.cgi?id=glossary.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Found By:](page.cgi?id=glossary.html#cf_foundby "A custom Drop Down field in this installation of Bugzilla.") | Other | | [Services Priority:](page.cgi?id=glossary.html#cf_nts_priority "A custom Free Text field in this installation of Bugzilla.") |  | | [Business Priority:](page.cgi?id=glossary.html#cf_biz_priority "A custom Free Text field in this installation of Bugzilla.") |  | | [Blocker:](page.cgi?id=glossary.html#cf_blocker "A custom Drop Down field in this installation of Bugzilla.") | --- | | [Marketing QA Status:](page.cgi?id=glossary.html#cf_marketing_qa_status "A custom Drop Down field in this installation of Bugzilla.") | --- | | [IT Deployment:](page.cgi?id=glossary.html#cf_it_deployment "A custom Drop Down field in this installation of Bugzilla.") | --- | |  | |  * [Clone This Bug](enter_bug.cgi?cloned_bug_id=199440) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [**p.diff**](attachment.cgi?id=96093 "View the content of the attachment") (8.86 KB, patch)  [2006-08-15 10:39 UTC](#attach_96093 "Go to the comment associated with the attachment"), Thomas Biege | [Details](attachment.cgi?id=96093&action=edit) | [Diff](attachment.cgi?id=96093&action=diff) | | [**Patch for 2.4.21**](attachment.cgi?id=96282 "View the content of the attachment") (3.83 KB, patch)  [2006-08-16 18:39 UTC](#attach_96282 "Go to the comment associated with the attachment"), Tony Luck | [Details](attachment.cgi?id=96282&action=edit) | [Diff](attachment.cgi?id=96282&action=diff) | | [**Patch for 2.6.16.21 (SLES10)**](attachment.cgi?id=96529 "View the content of the attachment") (6.92 KB, patch)  [2006-08-18 14:30 UTC](#attach_96529 "Go to the comment associated with the attachment"), Raymund Will | [Details](attachment.cgi?id=96529&action=edit) | [Diff](attachment.cgi?id=96529&action=diff) | | [**bug199440\_sles9sp3.diff**](attachment.cgi?id=99026 "View the content of the attachment") (5.34 KB, patch)  [2006-09-19 06:30 UTC](#attach_99026 "Go to the comment associated with the attachment"), Thomas Biege | [Details](attachment.cgi?id=99026&action=edit) | [Diff](attachment.cgi?id=99026&action=diff) | | [**bug199440\_sles10.diff**](attachment.cgi?id=99027 "View the content of the attachment") (5.48 KB, patch)  [2006-09-19 06:31 UTC](#attach_99027 "Go to the comment associated with the attachment"), Thomas Biege | [Details](attachment.cgi?id=99027&action=edit) | [Diff](attachment.cgi?id=99027&action=diff) | | [View All](attachment.cgi?bugid=199440&action=viewall)  [Add an attachment](attachment.cgi?bugid=199440&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=199440&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=199440#c0)  Thomas Biege   2006-08-15 10:38:19 UTC  ``` Here we go...  From: "Luck, Tony" <tony.luck@intel.com> To: vendor-sec@lst.de Subject: [vendor-sec] Local denial of service vulnerability for Itanium/Linux Errors-To: vendor-sec-admin@lst.de Date: Mon, 14 Aug 2006 14:03:33 -0700  [Mailed to security@kernel.org a couple of hours ago ... Greg  kindly pointed out that this really belongs on this list].  A user mode code sequence has been found that can crash Linux running on an Itanium system.  I have included the patch that detects this situation and prevents the user from crashing the kernel.  I intend to ship this upstream to Linus when he returns from his vacation, so this will be included in the next 2.6.18-rc release (or 2.6.18 itself if there are no more -rc releases).  I'm announcing here to give Linux distibutors the opportunity to incorporate this fix at the same time.  Other operating system vendors that may be affected are being contacted by other people at Intel.  Questions to me: tony.luck@intel.com  [If the question is: "What is the code sequence?", then the answer is that Intel is not releasing it. Sorry.]  -Tony  commit 7e6486b7758c1405a697bd5648f9bd0a67fc7d13 Author: Tony Luck <tony.luck@intel.com> Date:   Mon Aug 14 10:50:51 2006 -0700      [IA64] Workaround for RSE issue      Problem: An application violating the architectural rules regarding     operation dependencies and having specific Register Stack Engine (RSE)     state at the time of the violation, may result in an illegal operation     fault and invalid RSE state.  Such faults may initiate a cascade of     repeated illegal operation faults within OS interruption handlers.     The specific behavior is OS dependent.      Implication: An application causing an illegal operation fault with     specific RSE state may result in a series of illegal operation faults     and an eventual OS stack overflow condition.      Workaround: OS interruption handlers that switch to kernel backing     store implement a check for invalid RSE state to avoid the series     of illegal operation faults.      The core of the workaround is the RSE_WORKAROUND code sequence     inserted into each invocation of the SAVE_MIN_WITH_COVER and     SAVE_MIN_WITH_COVER_R19 macros.  This sequence includes hard-coded     constants that depend on the number of stacked physical registers     being 96.  The rest of this patch consists of code to disable this     workaround should this not be the case (with the presumption that     if a future Itanium processor increases the number of registers, it     would also remove the need for this patch).      Signed-off-by: Tony Luck <tony.luck@intel.com> ``` [Comment 1](show_bug.cgi?id=199440#c1)  Thomas Biege   2006-08-15 10:39:10 UTC  ``` Created [attachment 96093](attachment.cgi?id=96093&action=diff "p.diff") [[details]](attachment.cgi?id=96093&action=edit "p.diff") p.diff ``` [Comment 5](show_bug.cgi?id=199440#c5)  Raymund Will   2006-08-16 09:29:51 UTC  ``` Tony, would you mind to review the patches I'm about to prepare for our "older" kernels? Or do you (per chance ;) have patches for 2.6.5+ and 2.4.21+ at hand? ``` [Comment 6](show_bug.cgi?id=199440#c6)  Marcus Meissner   2006-08-16 11:49:52 UTC  ``` CVE-2006-3635 ``` [Comment 7](show_bug.cgi?id=199440#c7)  Tony Luck   2006-08-16 15:51:23 UTC  ``` I'm almost done with a version of the patch for another OSDs older kernel (2.4.21-47.EL).  I'll post it to vendor-sec (probably later today).  I can take a look at 2.6.5 too. ``` [Comment 8](show_bug.cgi?id=199440#c8)  Tony Luck   2006-08-16 18:39:34 UTC  ``` Created [attachment 96282](attachment.cgi?id=96282&action=diff "Patch for 2.4.21") [[details]](attachment.cgi?id=96282&action=edit "Patch for 2.4.21") Patch for 2.4.21  Patch for 2.4.21.  Very lightly tested (boots & my test cases no longer crash the kernel). ``` [Comment 9](show_bug.cgi?id=199440#c9)  Raymund Will   2006-08-18 14:30:52 UTC  ``` Created [attachment 96529](attachment.cgi?id=96529&action=diff "Patch for 2.6.16.21 (SLES10)") [[details]](attachment.cgi?id=96529&action=edit "Patch for 2.6.16.21 (SLES10)") Patch for 2.6.16.21 (SLES10)  [Attachment #96093](attachment.cgi?id=96093&action=diff "p.diff") [[details]](attachment.cgi?id=96093&action=edit "p.diff") with minor modification to apply to SLES10_GA_BRANCH. (i.e. no '__init' for 'ia64_patch_mckinley_e9()') ``` [Comment 10](show_bug.cgi?id=199440#c10)  Raymund Will   2006-08-18 14:32:28 UTC  ``` Andreas, please take over from here... CU in two weeks!  (c: ``` [Comment 11](show_bug.cgi?id=199440#c11)  Thomas Biege   2006-08-21 09:03:25 UTC  ``` From: Willy Tarreau <w@1wt.eu> To: "Luck, Tony" <tony.luck@intel.com> Cc: dann frazier <dannf@debian.org>, Marcel Holtmann <holtmann@redhat.com>,         vendor-sec@lst.de Subject: Re: [vendor-sec] Local denial of service vulnerability forItanium/Linux CVE-2006-3635 User-Agent: Mutt/1.5.11 Errors-To: vendor-sec-admin@lst.de Date: Sat, 19 Aug 2006 08:23:49 +0200  On Wed, Aug 16, 2006 at 02:50:46PM -0700, Luck, Tony wrote: > On Tue, Aug 15, 2006 at 10:17:30AM -0600, dann frazier wrote: > > Debian supports a 2.4.27-based kernel - a patch against the current > > Bjorn tree should suffice.  Thanks Tony. > > Current Bjorn tree is 2.4.29.  Here's the patch against that (almost > identical to the 2.4.21 version posted earlier ... only change is > that the "#define rARPFS r26" and "#define rARRSC r27" were removed > from minstate.h sometime between 2.4.21 and 2.4.29, so this version > of the patch uses the unobfuscated register numbers.) > > -Tony  I've queued this one for 2.4-mainline with the detailed explanation you provided for 2.4.21-47.  Thanks Tony! Willy  _______________________________________________ Vendor Security mailing list Vendor Security@lst.de <https://www.lst.de/cgi-bin/mailman/listinfo/vendor-sec>  ``` [Comment 12](show_bug.cgi?id=199440#c12)  Marcus Meissner   2006-08-23 08:39:00 UTC  ``` With the SCTP bug being public we will not wait with the current kernel update until the 29th of August. ``` [Comment 13](show_bug.cgi?id=199440#c13)  Andreas Schwab   2006-08-23 14:25:52 UTC  ``` What does that mean? ``` [Comment 14](show_bug.cgi?id=199440#c14)  Tony Luck   2006-08-23 16:20:12 UTC  ``` Additional note ... I posted a status update to vendor-sec yesterday.  Additional testing of the workaround that I posted has shown that it sometimes fails to recover (about 1 time in 30) on the current base kernel (2.6.18-rc4) with one of the test cases.  I think that SLES10 looks enough like the upstream kernel that it will be similarly affected.  Worse still, my backport for SLES9 (2.6.5 kernel) *always* fails on this same test case.  I requested that the embargo date be extended until after this issue is resolved.  It sound like you have some other pressing fix ([comment#12](show_bug.cgi?id=199440#c12) above) that needs to go out ... right now I have no new date for this issue, so you may want to go ahead with that one.  This issue will have to wait for the next train :-( ``` [Comment 15](show_bug.cgi?id=199440#c15)  Marcus Meissner   2006-08-24 08:46:54 UTC  ``` Checkin deadline is today (Aug 24) 17:00 CEST.  If this patch is not ready then, we take it for the round after the current one. ``` [Comment 16](show_bug.cgi?id=199440#c16)  Thomas Biege   2006-09-19 06:30:50 UTC  ``` Created [attachment 99026](attachment.cgi?id=99026&action=diff "bug199440_sles9sp3.diff") [[details]](attachment.cgi?id=99026&action=edit "bug199440_sles9sp3.diff") [bug199440](show_bug.cgi?id=199440 "RESOLVED WONTFIX - VUL-0: CVE-2006-3635: kernel: local denial-of-service on Itanium")_sles9sp3.diff  maybe superfluous ``` [Comment 17](show_bug.cgi?id=199440#c17)  Thomas Biege   2006-09-19 06:31:13 UTC  ``` Created [attachment 99027](attachment.cgi?id=99027&action=diff "bug199440_sles10.diff") [[details]](attachment.cgi?id=99027&action=edit "bug199440_sles10.diff") [bug199440](show_bug.cgi?id=199440 "RESOLVED WONTFIX - VUL-0: CVE-2006-3635: kernel: local denial-of-service on Itanium")_sles10.diff  maybe superfulous ``` [Comment 18](show_bug.cgi?id=199440#c18)  Tony Luck   2006-09-19 15:51:59 UTC  ``` Above attachment (in [comment#17](show_bug.cgi?id=199440#c17)) is the new and improved version (i.e. it actually works).  Please disregard earlier patches.  The critical change is the re-initialization of ar.bspstore from r22 at the end of the workaround. ``` [Comment 19](show_bug.cgi?id=199440#c19)  Thomas Biege   2006-09-26 06:56:48 UTC  ``` From: "Luck, Tony" <tony.luck@intel.com> To: vendor-sec@lst.de Subject: [vendor-sec] CVE-2006-3635 Errors-To: vendor-sec-admin@lst.de Date: Mon, 25 Sep 2006 17:12:47 -0700  No definitive news from the other OSs on whether October 5th will work as an embargo date ... so I'm putting this back on hold again :-(  One new thing did show up in their review ... the Linux patches I posted here have an off-by-one error in the calculation of the maximum legal RSE frame size.  The         cmp.ge p6,p7=32,r17 should actually compare with "33", not with 32.  This error didn't show up in my Linux testing because Linux always aligns ar.bspstore on a 16-byte address, and the 32 vs. 33 here only affects the outcome in one of the 8mod16 cases which can never occur on Linux (if a bug can never trigger is it still a bug?)  -Tony  _______________________________________________ Vendor Security mailing list Vendor Security@lst.de <https://www.lst.de/cgi-bin/mailman/listinfo/vendor-sec> ~  ``` [Comment 20](show_bug.cgi?id=199440#c20)  Marcus Meissner   2006-10-27 09:46:25 UTC  ``` the patch is not yet in kernel-source HEAD (SLES8).  please apply. ``` [Comment 21](show_bug.cgi?id=199440#c21)  Andreas Schwab   2006-10-27 10:56:34 UTC  ``` Does it actually work yet? ``` [Comment 22](show_bug.cgi?id=199440#c22)  Tony Luck   2006-10-27 16:10:07 UTC  ``` The Linux patch works ... there have been some issues on other operating systems that we had difficulty understanding (particularly as Linux didn't have the issues when running the exact same code sequence!).  I heard on Wednesday that this difference was now understood (turned out to be another side effect of the "align ar.bspstore on 16-byte boundary" that also meant that Linux hadn't noticed the off-by one problem that I described above in [comment#19](show_bug.cgi?id=199440#c19)). So, I expect that at the status meeting that I have at 2pm PDT this afternoon we'll finally get the go-ahead to unfreeze this.  Watch out for an announcement on vendor-sec. ``` [Comment 23](show_bug.cgi?id=199440#c23)  Tony Luck   2006-10-27 21:41:30 UTC  ``` All the other OS's were told about the findings yesterday, and some of them aren't using the 16-byte aligned ar.bspstore, so they need to make changes.  We're giving them a few days to make the changes and validate them.  New plan is that I'll announce on vendor-sec on Wednesday Nov 1st that the embargo date will be Tuesday November 7th.  Unless someone finds something new while implementing changes to the fix. ``` [Comment 24](show_bug.cgi?id=199440#c24)  Andreas Schwab   2006-10-30 12:28:16 UTC  ``` The patch does not fit to our kernel. ``` [Comment 25](show_bug.cgi?id=199440#c25)  Tony Luck   2006-10-30 19:01:40 UTC  ``` Which version of the kernel?  Thomas captured two of my patches (one for sles9sp3, and one for sles10) from the vendor-sec mailing list and attached them to this bugzilla.  Both of them need to change 32 to 33 in the "cmp.ge p6,p7 = 32,r17" line.  Have you made other changes to minstate.h since I created these patches? ``` [Comment 26](show_bug.cgi?id=199440#c26)  Andreas Schwab   2006-10-31 12:27:56 UTC  ``` Just leaving out the first hunk appears to work fine. ``` [Comment 27](show_bug.cgi?id=199440#c27)  Tony Luck   2006-10-31 16:57:37 UTC  ``` I'm confused.  The first hunk of the patch adds the WORKAROUND argument to the definition of the DO_SAVE_MIN() macro.  Leaving that out should give errors when it is used (extra arg is added in the invocations of this macro in the last hunk). ``` [Comment 28](show_bug.cgi?id=199440#c28)  Marcus Meissner   2006-11-23 13:08:53 UTC  ``` any update here?   slot for next kernel update is closing today. ``` [Comment 29](show_bug.cgi?id=199440#c29)  Andreas Schwab   2006-11-23 13:16:00 UTC  ``` What is the status of the patches?  "maybe superfluous" does not look promising. ``` [Comment 30](show_bug.cgi?id=199440#c30)  Marcus Meissner   2006-11-28 12:22:57 UTC  ``` andreas applied them apparently, so marking them up in whiteboard ``` [Comment 31](show_bug.cgi?id=199440#c31)  Tony Luck   2006-11-28 18:31:23 UTC  ``` Does this mean that these patches are visible (or will shortly become visible) in some external "kernel-of-the-day" tree? ``` [Comment 32](show_bug.cgi?id=199440#c32)  Marcus Meissner   2006-11-29 08:58:29 UTC  ``` actually yes.  either this way, or we take it out of this kernel update and publish them next February or March. ``` [Comment 33](show_bug.cgi?id=199440#c33)  Marcus Meissner   2006-11-29 10:54:43 UTC  ``` is there still an embargo and if yes, when does it end? ``` [Comment 34](show_bug.cgi?id=199440#c34)  Tony Luck   2006-11-29 16:43:05 UTC  ``` Yes, there is still an embargo. I still don't have a firm end date for it.  I've been told "in about another two weeks" for a long, long time :-(  New questions keep coming up as more OS vendors and OEMs look at this (and they are good questions, they deserve investigation ... one of them will require another small change to the patch for a potential issue).  ``` [Comment 35](show_bug.cgi?id=199440#c35)  Marcus Meissner   2006-11-29 16:47:38 UTC  ``` Andreas, can you remove the patch again please and the changes entry :( ``` [Comment 36](show_bug.cgi?id=199440#c36)  Andreas Schwab   2006-11-29 16:57:42 UTC  ``` Ok. ``` [Comment 37](show_bug.cgi?id=199440#c37)  Marcus Meissner   2007-02-09 11:01:23 UTC  ``` this is now 6 months old.  can we come to a conclusion? ``` [Comment 40](show_bug.cgi?id=199440#c40)  Tony Luck   2007-02-09 19:02:02 UTC  ``` Another way to exploit this illegal instruction sequence showed up during our discussions with other OS vendors and OEMS.  Our first attempts at workarounds will have a significant performance impact for Linux ... so we are re-evaluating our options (to find the least bad path to move forward ... none of the options are good):  1) Deploy a complete fix that has significant negative perform impact. 2) Deploy a partial fix that covers most cases with only slight performance impact, but leave some vulnerability. 3) Deploy no fix  We obviously don't like option 1.  We don't like option 2 because it raises the risk factor (might encourage bad guys to search for the illegal instruction sequence, and in doing so they might discover the gaps in the deployed fix).  Which leaves option 3 as the least-bad path (at the moment).  ``` [Comment 41](show_bug.cgi?id=199440#c41)  Marcus Meissner   2007-05-22 11:06:05 UTC  ``` any further updates? ``` [Comment 42](show_bug.cgi?id=199440#c42)  Tony Luck   2007-05-22 17:32:33 UTC  ``` Intel is sticking with the least-bad option ... deploy no fix.  In the unlikely event that this is seen in the wild, we will obviously have to act, but we see this as improbable. ``` [Comment 43](show_bug.cgi?id=199440#c43)  Thomas Biege   2007-09-04 12:26:20 UTC  ``` Should we close this bug report? ``` [Comment 44](show_bug.cgi?id=199440#c44)  Tony Luck   2007-09-05 07:49:55 UTC  ``` Do you have a "no fix planned" status (perhaps "WONT FIX"?).  That would be the most appropriate status.  Otherwise it is up to you whether to close an unfixed bug. ``` [Comment 45](show_bug.cgi?id=199440#c45)  Thomas Biege   2007-09-05 07:55:57 UTC  ``` closing ``` [Comment 46](show_bug.cgi?id=199440#c46)  Bugzilla Account Maintenance   2008-09-02 18:07:46 UTC  ``` Because the LATER and REMIND resolutions have been removed, the resolution of this bug has changed from LATER to WONTFIX. If this bug needs to be reconsidered, reopen it and set a future "Target Milestone for Fix." ``` [Comment 47](show_bug.cgi?id=199440#c47)  Marcus Meissner   2017-08-02 08:22:57 UTC  ``` It seems this was fixed in 2008.  commit 4dcc29e1574d88f4465ba865ed82800032f76418 Author: Tony Luck <tony.luck@intel.com> Date:   Tue May 27 13:23:16 2008 -0700      [IA64] Workaround for RSE issue          Problem: An application violating the architectural rules regarding     operation dependencies and having specific Register Stack Engine (RSE)     state at the time of the violation, may result in an illegal operation     fault and invalid RSE state.  Such faults may initiate a cascade of     repeated illegal operation faults within OS interruption handlers.     The specific behavior is OS dependent.          Implication: An application causing an illegal operation fault with     specific RSE state may result in a series of illegal operation faults     and an eventual OS stack overflow condition.          Workaround: OS interruption handlers that switch to kernel backing     store implement a check for invalid RSE state to avoid the series     of illegal operation faults.          The core of the workaround is the RSE_WORKAROUND code sequence     inserted into each invocation of the SAVE_MIN_WITH_COVER and     SAVE_MIN_WITH_COVER_R19 macros.  This sequence includes hard-coded     constants that depend on the number of stacked physical registers     being 96.  The rest of this patch consists of code to disable this     workaround should this not be the case (with the presumption that     if a future Itanium processor increases the number of registers, it     would also remove the need for this patch).          Move the start of the RBS up to a mod32 boundary to avoid some     corner cases.          The dispatch_illegal_op_fault code outgrew the spot it was     squatting in when built with this patch and CONFIG_VIRT_CPU_ACCOUNTING=y     Move it out to the end of the ivt.          Signed-off-by: Tony Luck <tony.luck@intel.com> ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=199440)
* - [XML](show_bug.cgi?ctype=xml&id=199440)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=199440)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [IDP Log In](/saml2_login.cgi?idp=IDP&target=show_bug.cgi%3Fid%3D199440)
  + |
    [Forgot Password](https://idp-portal.suse.com/univention/self-service/#page=passwordreset)

+ Legal:
+ [openSUSE](http://en.opensuse.org/Terms_of_site)
+ [SUSE](https://www.suse.com/company/legal/)


