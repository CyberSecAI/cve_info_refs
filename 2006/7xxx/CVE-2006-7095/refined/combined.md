=== Content from aluigi.altervista.org_6ac82934_20250125_105420.html ===
#######################################################################
Luigi Auriemma
Application: dim3 (dimension 3 engine)
http://www.klinksoftware.com
Versions: <= 1.5
Platforms: Windows and Mac
Bugs: A] network\_receive\_packet/data buffer-overflow
B] network\_host\_handle\_join buffer-overflow
Exploitation: A] remote, versus server and client
B] remote, versus server
Date: 23 Apr 2006
Author: Luigi Auriemma
e-mail: aluigi@autistici.org
web: aluigi.org
#######################################################################
1) Introduction
2) Bugs
3) The Code
4) Fix
#######################################################################
===============
1) Introduction
===============
dim3 is an interesting open source project for the creation of a game
engine easy to use for modders.
IMPORTANT NOTE:
The network code in the current version must be considered still a work
in progress (as written on the website) so don't consider the bugs
described in this advisory a real threat.
#######################################################################
=======
2) Bugs
=======
----------------------------------------------
A] network\_receive\_packet/data buffer-overflow
----------------------------------------------
The function network\_receive\_packet is used for reading data from the
network.
It first reads the header of the data which is composed by 3 fields of
16 bit which identify the size of the data block, the type of action
and the remote uid.
All these fields are signed short and the first one (data\_len) can be
used for bypassing the check
"if (data\_len>net\_max\_msg\_size) return(FALSE);" and for forcing the
reading of an arbitrary amount of data in network\_receive\_data causing
the overflowing of the data buffer of 2048 (net\_max\_msg\_size) bytes.
From Code/dim3NetworkUtility/Sources/socket.c:
bool network\_receive\_packet(d3socket sock,int \*action,int \*from\_remote\_uid,unsigned char \*data,int \*len)
{
int data\_len;
network\_header head;
if (!network\_receive\_data(sock,(unsigned char\*)&head,sizeof(network\_header))) return(FALSE);
\*len=data\_len=(signed short)ntohs(head.len);
\*action=(signed short)ntohs(head.action);
\*from\_remote\_uid=(signed short)ntohs(head.from\_remote\_uid);
if (data\_len==0) return(TRUE);
if (data\_len>net\_max\_msg\_size) return(FALSE);
// get the data
return(network\_receive\_data(sock,data,data\_len));
}
-------------------------------------------
B] network\_host\_handle\_join buffer-overflow
-------------------------------------------
The network\_host\_handle\_join function is used for handling the new
players which join the server.
This function reads the nickname sent by the client and uses strcpy for
copying it in a buffer of 32 (name\_str\_len) bytes.
From Code/dim3Server/Sources/host.c:
int network\_host\_handle\_join(int sock,network\_request\_join \*request\_join)
{
int remote\_uid;
network\_reply\_join reply\_join;
network\_request\_remote\_add remote\_add;
...
if (remote\_uid!=-1) {
strcpy(remote\_add.name,request\_join->name);
remote\_add.score=0;
network\_player\_send\_others\_packet(remote\_uid,net\_action\_request\_remote\_add,(unsigned char\*)&remote\_add,sizeof(network\_request\_remote\_add),FALSE);
}
return(remote\_uid);
}
#######################################################################
===========
3) The Code
===========
http://aluigi.org/poc/dim3bof.zip
#######################################################################
======
4) Fix
======
The version 1.6 will be released enough soon and will implement many
improvements for the network code, included the fixes for these bugs.
#######################################################################

