=== Content from bugzilla.mozilla.org_1fe43c3f_20250125_204030.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/356355)
* [XML](/show_bug.cgi?ctype=xml&id=356355)

Closed
[Bug 356355](/show_bug.cgi?id=356355)

Opened 18 years ago
Closed 18 years ago

# numeric domain normalization only happens on enchash table values

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

numeric domain normalization only happens on enchash table values

## Categories

### (Toolkit :: Safe Browsing, defect)

[Product:](/describecomponents.cgi?product=Toolkit)

Toolkit
▾

Toolkit
The Mozilla Toolkit is a set of APIs, built on top of Gecko, which provide advanced services to XUL applications. These services include Profile Management, Chrome Registration, Browsing History, Extension and Theme Management, Application Update Service, and Safe Mode. ([More info](https://wiki.mozilla.org/Modules/Toolkit))
[See Open Bugs in This Product](/buglist.cgi?product=Toolkit&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Toolkit)
Watch This Product

[Component:](/describecomponents.cgi?product=Toolkit&component=Safe%20Browsing#Safe%20Browsing)

Safe Browsing
▾

Toolkit :: Safe Browsing
Safe Browsing UI and service (includes phishing protection).
[See Open Bugs in This Component](/buglist.cgi?product=Toolkit&component=Safe%20Browsing&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Toolkit&component=Safe%20Browsing&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Toolkit&component=Safe%20Browsing)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: tony, Assigned: tony)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/f649648e89b7a08eaf922b4b24ed29d3?d=mm&size=40)  [tony](/user_profile?user_id=236963)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/f649648e89b7a08eaf922b4b24ed29d3?d=mm&size=40)  [tony](/user_profile?user_id=236963)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/bd10912fd8637cc64f00edd465ca8b0d?d=mm&size=40)  [dimi](/user_profile?user_id=468232)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[358966](/show_bug.cgi?id=358966 "RESOLVED DUPLICATE - Phising Control fails when a phising uri translated into it's hexadecimal equivalent")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: fixed1.8.1.1)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[fixed1.8.1.1](/buglist.cgi?keywords=fixed1.8.1.1&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

---

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [blocking1.8.1.1](#c0 "18 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | blocking1.8.1.1 | + |
| --- | --- | --- |
| [Gavin](/user_profile?user_id=103593) | [in-testsuite](#c0 "18 years ago") | + |
| --- | --- | --- |
| [Gavin](/user_profile?user_id=103593) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (5 files, 3 obsolete files)

| [v1: canonicalize urls before lookup in -url and -domain tables](/attachment.cgi?id=242005)  [18 years ago](#c1)  [Tony Chang (Google)](/user_profile?user_id=236963)   13.87 KB, patch | mmc : [review+](#c0 "18 years ago") | [Details](/attachment.cgi?id=242005&action=edit) | [Diff](/attachment.cgi?id=242005&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=356355&attachment=242005) |
| --- | --- | --- |
| [patch for ff2 branch](/attachment.cgi?id=244261)  [18 years ago](#c6)  [Tony Chang (Google)](/user_profile?user_id=236963)   13.94 KB, patch | mmc : [review+](#c0 "18 years ago") | [Details](/attachment.cgi?id=244261&action=edit) | [Diff](/attachment.cgi?id=244261&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=356355&attachment=244261) |
| [v2: additional fixes](/attachment.cgi?id=244971)  [18 years ago](#c10)  [Tony Chang (Google)](/user_profile?user_id=236963)   6.93 KB, patch | mmc : [review+](#c0 "18 years ago") | [Details](/attachment.cgi?id=244971&action=edit) | [Diff](/attachment.cgi?id=244971&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=356355&attachment=244971) |
| [v3: clean up line > 80 char](/attachment.cgi?id=245608)  [18 years ago](#c13)  [Tony Chang (Google)](/user_profile?user_id=236963)   6.95 KB, patch |  | [Details](/attachment.cgi?id=245608&action=edit) | [Diff](/attachment.cgi?id=245608&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=356355&attachment=245608) |
| [v2: patch for ff2 branch](/attachment.cgi?id=245614)  [18 years ago](#c15)  [Tony Chang (Google)](/user_profile?user_id=236963)   16.03 KB, patch | mmc : [review+](#c0 "18 years ago")  jay : [approval1.8.1.1-](#c0 "18 years ago") | [Details](/attachment.cgi?id=245614&action=edit) | [Diff](/attachment.cgi?id=245614&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=356355&attachment=245614) |
| [v4: check both old and new canonical form](/attachment.cgi?id=246235)  [18 years ago](#c22)  [Tony Chang (Google)](/user_profile?user_id=236963)   3.06 KB, patch | mmc : [review+](#c0 "18 years ago") | [Details](/attachment.cgi?id=246235&action=edit) | [Diff](/attachment.cgi?id=246235&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=356355&attachment=246235) |
| [v3: cumulative patch for branch](/attachment.cgi?id=246351)  [18 years ago](#c23)  [Tony Chang (Google)](/user_profile?user_id=236963)   17.56 KB, patch | mmc : [review+](#c0 "18 years ago")  dveditz : [approval1.8.1.1+](#c0 "18 years ago") | [Details](/attachment.cgi?id=246351&action=edit) | [Diff](/attachment.cgi?id=246351&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=356355&attachment=246351) |
| [unittests](/attachment.cgi?id=247594)  [18 years ago](#c34)  [Tony Chang (Google)](/user_profile?user_id=236963)   31.68 KB, patch |  | [Details](/attachment.cgi?id=247594&action=edit) | [Diff](/attachment.cgi?id=247594&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=356355&attachment=247594) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Tony Chang (Google)](/user_profile?user_id=236963)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=356355#c0)• 18 years ago |
|  | |

We should be normalizing numeric domains (hex/oct/dec form) for urls that appear on -url and -domain tables. For example, goog-black-url currently has [http://24.172.137.213/http.www.paypal.com/cgi-bin/webscrcmd=\_login-run/](http://24.172.137.213/http.www.paypal.com/cgi-bin/webscrcmd%3D_login-run/) , but a warning doesn't trigger on the following:
[http://0x18.0xac.0x89.0xd5/http.www.paypal.com/cgi-bin/webscrcmd=\_login-run/](http://0x18.0xac.0x89.0xd5/http.www.paypal.com/cgi-bin/webscrcmd%3D_login-run/)
[http://030.0254.0211.0325/http.www.paypal.com/cgi-bin/webscrcmd=\_login-run/](http://030.0254.0211.0325/http.www.paypal.com/cgi-bin/webscrcmd%3D_login-run/)
[http://0x18ac89d5/http.www.paypal.com/cgi-bin/webscrcmd=\_login-run/](http://0x18ac89d5/http.www.paypal.com/cgi-bin/webscrcmd%3D_login-run/)
[http://413960661/http.www.paypal.com/cgi-bin/webscrcmd=\_login-run/](http://413960661/http.www.paypal.com/cgi-bin/webscrcmd%3D_login-run/)
[http://03053104725/http.www.paypal.com/cgi-bin/webscrcmd=\_login-run/](http://03053104725/http.www.paypal.com/cgi-bin/webscrcmd%3D_login-run/)

|  | [Tony Chang (Google)](/user_profile?user_id=236963)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=356355#c1)• 18 years ago |
|  | |

Attached patch

[v1: canonicalize urls before lookup in -url and -domain tables](attachment.cgi?id=242005&action=diff)
— [Details](attachment.cgi?id=242005&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=356355&attachment=242005)

To test, make sure [http://24.172.137.213/http.www.paypal.com/cgi-bin/webscrcmd=\_login-run/](http://24.172.137.213/http.www.paypal.com/cgi-bin/webscrcmd%3D_login-run/) is in urlclassifier2.sqlite and try loading the variations mentioned above.
[Attachment #242005](/attachment.cgi?id=242005&action=edit "v1: canonicalize urls before lookup in -url and -domain tables") -
Flags: review?(mmchew)

|  | [[:mmc] Monica Chew (no longer reading bugmail)](/user_profile?user_id=237291) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=356355#c2)• 18 years ago |
|  | |

I know I already looked at this, but I just realized that the canonicalization only applies to enchash tables. Don't we want it for non-enchash tables as well?

|  | [[:mmc] Monica Chew (no longer reading bugmail)](/user_profile?user_id=237291) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=356355#c3)• 18 years ago |
|  | |

Comment on [attachment 242005](/attachment.cgi?id=242005 "v1: canonicalize urls before lookup in -url and -domain tables") [[details]](/attachment.cgi?id=242005&action=edit "v1: canonicalize urls before lookup in -url and -domain tables") [[diff]](/attachment.cgi?id=242005&action=diff "v1: canonicalize urls before lookup in -url and -domain tables") [[review]](/page.cgi?id=splinter.html&ignore=&bug=356355&attachment=242005)
v1: canonicalize urls before lookup in -url and -domain tables
Nevermind, I see in trtable.js the enchash canonicalization is called for all tables. Sorry for the confusion.
[Attachment #242005](/attachment.cgi?id=242005&action=edit "v1: canonicalize urls before lookup in -url and -domain tables") -
Flags: review?(mmchew) → review+

|  | [Tony Chang (Google)](/user_profile?user_id=236963)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=356355#c4)• 18 years ago |
|  | |

Checking in enchash-decrypter.js;
/cvsroot/mozilla/toolkit/components/url-classifier/content/enchash-decrypter.js,v <-- enchash-decrypter.js
new revision: 1.5; previous revision: 1.4
done
Checking in trtable.js;
/cvsroot/mozilla/toolkit/components/url-classifier/content/trtable.js,v <-- trtable.js
new revision: 1.7; previous revision: 1.6
done
Checking in url-canonicalizer.js;
/cvsroot/mozilla/toolkit/components/url-classifier/content/url-canonicalizer.js,v <-- url-canonicalizer.js
new revision: 1.4; previous revision: 1.3
On trunk.Status: NEW → RESOLVEDClosed: 18 years agoResolution: --- → FIXED

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=356355#c5)• 18 years ago |
|  | |

Tony, can we also get a branch patch worked up for 1.8.1.1?Flags: blocking1.8.1.1?

|  | [Tony Chang (Google)](/user_profile?user_id=236963)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=356355#c6)• 18 years ago |
|  | |

Attached patch

[patch for ff2 branch](attachment.cgi?id=244261&action=diff) (obsolete)
— [Details](attachment.cgi?id=244261&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=356355&attachment=244261)

Same as the other patch except one line was different in enchash-decrypter.js on branch/trunk. After this patch is applied, the two files will be the same.
[Attachment #244261](/attachment.cgi?id=244261&action=edit "patch for ff2 branch") -
Flags: review?(mmchew)

|  | [[:mmc] Monica Chew (no longer reading bugmail)](/user_profile?user_id=237291) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=356355#c7)• 18 years ago |
|  | |

Comment on [attachment 242005](/attachment.cgi?id=242005 "v1: canonicalize urls before lookup in -url and -domain tables") [[details]](/attachment.cgi?id=242005&action=edit "v1: canonicalize urls before lookup in -url and -domain tables") [[diff]](/attachment.cgi?id=242005&action=diff "v1: canonicalize urls before lookup in -url and -domain tables") [[review]](/page.cgi?id=splinter.html&ignore=&bug=356355&attachment=242005)
v1: canonicalize urls before lookup in -url and -domain tables
Looks fine.

|  | [Tony Chang (Google)](/user_profile?user_id=236963)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=356355#c8)• 18 years ago |
|  | |

\*\*\* [Bug 358966](/show_bug.cgi?id=358966 "RESOLVED DUPLICATE - Phising Control fails when a phising uri translated into it's hexadecimal equivalent") has been marked as a duplicate of this bug. \*\*\*

|  | [[:mmc] Monica Chew (no longer reading bugmail)](/user_profile?user_id=237291) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=356355#c9)• 18 years ago |
|  | |

Comment on [attachment 244261](/attachment.cgi?id=244261 "patch for ff2 branch") [[details]](/attachment.cgi?id=244261&action=edit "patch for ff2 branch") [[diff]](/attachment.cgi?id=244261&action=diff "patch for ff2 branch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=356355&attachment=244261)
patch for ff2 branch
Looks fine.
[Attachment #244261](/attachment.cgi?id=244261&action=edit "patch for ff2 branch") -
Flags: review?(mmchew) → review+

|  | [Tony Chang (Google)](/user_profile?user_id=236963)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=356355#a1732536_236963)• 18 years ago |

[Attachment #244261](/attachment.cgi?id=244261&action=edit "patch for ff2 branch") -
Flags: approval1.8.1.1?

|  | [Tony Chang (Google)](/user_profile?user_id=236963)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=356355#c10)• 18 years ago |
|  | |

Attached patch

[v2: additional fixes](attachment.cgi?id=244971&action=diff) (obsolete)
— [Details](attachment.cgi?id=244971&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=356355&attachment=244971)

Fixes 2 additional issues:
- a regression caused by the v1 patch where canonicalizing urls results in only using the first 5 dots of the hostname
- a bug in enchash lookups where we were comparing the non-normalized url against the regular expressions instead of the normalized url
I'll request a review from Monica once she's back from vacation (Nov 13).

|  | [Tony Chang (Google)](/user_profile?user_id=236963)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=356355#c11)• 18 years ago |
|  | |

Comment on [attachment 244971](/attachment.cgi?id=244971 "v2: additional fixes") [[details]](/attachment.cgi?id=244971&action=edit "v2: additional fixes") [[diff]](/attachment.cgi?id=244971&action=diff "v2: additional fixes") [[review]](/page.cgi?id=splinter.html&ignore=&bug=356355&attachment=244971)
v2: additional fixes
The only difference from toolbar code is that some unittests are missing (trtable.js doesn't have a unittest block).
I'll try to add the unittests back in in a different patch in a mozilla friendly way.
[Attachment #244971](/attachment.cgi?id=244971&action=edit "v2: additional fixes") -
Flags: review?(mmchew)

|  | [[:mmc] Monica Chew (no longer reading bugmail)](/user_profile?user_id=237291) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=356355#c12)• 18 years ago |
|  | |

Comment on [attachment 244971](/attachment.cgi?id=244971 "v2: additional fixes") [[details]](/attachment.cgi?id=244971&action=edit "v2: additional fixes") [[diff]](/attachment.cgi?id=244971&action=diff "v2: additional fixes") [[review]](/page.cgi?id=splinter.html&ignore=&bug=356355&attachment=244971)
v2: additional fixes
Looks fine.
>===================================================================
>--- toolkit/components/url-classifier/content/enchash-decrypter.js old
>+++ toolkit/components/url-classifier/content/enchash-decrypter.js new
>+ testing["<http://www.barclays.co.uk.brccontrol.assruspede.org.bz/detailsconfirm>"] = "co.uk.brccontrol.assruspede.org.bz";
over 80 chars (I think)
[Attachment #244971](/attachment.cgi?id=244971&action=edit "v2: additional fixes") -
Flags: review?(mmchew) → review+

|  | [Tony Chang (Google)](/user_profile?user_id=236963)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=356355#c13)• 18 years ago |
|  | |

Attached patch

[v3: clean up line > 80 char](attachment.cgi?id=245608&action=diff)
— [Details](attachment.cgi?id=245608&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=356355&attachment=245608)

Same as v2 with line wrapping.
[Attachment #244971](/attachment.cgi?id=244971&action=edit "v2: additional fixes") -
Attachment is obsolete: true

|  | [Tony Chang (Google)](/user_profile?user_id=236963)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=356355#c14)• 18 years ago |
|  | |

v3: on trunk
Checking in enchash-decrypter.js;
/cvsroot/mozilla/toolkit/components/url-classifier/content/enchash-decrypter.js,v <-- enchash-decrypter.js
new revision: 1.6; previous revision: 1.5
done
Checking in trtable.js;
/cvsroot/mozilla/toolkit/components/url-classifier/content/trtable.js,v <-- trtable.js
new revision: 1.8; previous revision: 1.7
done

|  | [Tony Chang (Google)](/user_profile?user_id=236963)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=356355#c15)• 18 years ago |
|  | |

Attached patch

[v2: patch for ff2 branch](attachment.cgi?id=245614&action=diff) (obsolete)
— [Details](attachment.cgi?id=245614&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=356355&attachment=245614)

Combine the two patches (v1 and v3) into a single patch for the ff 2 branch.
[Attachment #244261](/attachment.cgi?id=244261&action=edit "patch for ff2 branch") -
Attachment is obsolete: true
[Attachment #245614](/attachment.cgi?id=245614&action=edit "v2: patch for ff2 branch") -
Flags: review?(mmchew)
[Attachment #244261](/attachment.cgi?id=244261&action=edit "patch for ff2 branch") -
Flags: approval1.8.1.1?

|  | [[:mmc] Monica Chew (no longer reading bugmail)](/user_profile?user_id=237291) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=356355#c16)• 18 years ago |
|  | |

Comment on [attachment 245614](/attachment.cgi?id=245614 "v2: patch for ff2 branch") [[details]](/attachment.cgi?id=245614&action=edit "v2: patch for ff2 branch") [[diff]](/attachment.cgi?id=245614&action=diff "v2: patch for ff2 branch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=356355&attachment=245614)
v2: patch for ff2 branch
Looks fine.
[Attachment #245614](/attachment.cgi?id=245614&action=edit "v2: patch for ff2 branch") -
Flags: review?(mmchew) → review+

|  | [Tony Chang (Google)](/user_profile?user_id=236963)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=356355#a2938825_236963)• 18 years ago |

[Attachment #245614](/attachment.cgi?id=245614&action=edit "v2: patch for ff2 branch") -
Flags: approval1.8.1.1?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=356355#a2993406_1689)• 18 years ago |

Flags: blocking1.8.1.1? → blocking1.8.1.1+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=356355#c17)• 18 years ago |
|  | |

Does this patch also normalize the URLs coming from the server? In the urlclassifier database there are phishing urls of every conceivable obfuscation, I'd hate to add this check and start missing all the non-normalized ones.
qawanted: Need to verify that on trunk before we take this patch on the branch, because that result would be worse than the original problem if not handled.Keywords: [qawanted](/buglist.cgi?keywords=qawanted&resolution=---)

|  | [Tony Chang (Google)](/user_profile?user_id=236963)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=356355#c18)• 18 years ago |
|  | |

(In reply to [comment #17](/show_bug.cgi?id=356355#c17 "VERIFIED FIXED - numeric domain normalization only happens on enchash table values"))
> Does this patch also normalize the URLs coming from the server? In the
> urlclassifier database there are phishing urls of every conceivable
> obfuscation, I'd hate to add this check and start missing all the
> non-normalized ones.
This doesn't normalize the URLs from the server, but we're going to be normalizing all of them real soon now (we're still testing to make sure we're not losing anything in the process).
If we wanted to normalize URLs from the server, it would be more complicated since the update happens on a background thread but nsIIOService (to make the nsIURI objects) needs to run on the main thread.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=356355#c19)• 18 years ago |
|  | |

Define "Real Soon Now"... this sounds like the kind of thing where client and server need to update around the same time, or we're leaving some big gaps. Or the server could start sending both forms for non-normalized ones for a while... better to have a temporarily bloated list than holes in coverage. Especially since people won't upgrade to the fixed version instantaneously. The bulk update the first few days, but there's a tail of people who apparently have update problems or insufficient rights.
We're hoping to ship 2.0.0.1 mid December. Will the server be changed over by then?

|  | [Tony Chang (Google)](/user_profile?user_id=236963)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=356355#c20)• 18 years ago |
|  | |

(In reply to [comment #19](/show_bug.cgi?id=356355#c19 "VERIFIED FIXED - numeric domain normalization only happens on enchash table values"))
> Define "Real Soon Now"... this sounds like the kind of thing where client and
> server need to update around the same time, or we're leaving some big gaps. Or
> the server could start sending both forms for non-normalized ones for a
> while... better to have a temporarily bloated list than holes in coverage.
> Especially since people won't upgrade to the fixed version instantaneously. The
> bulk update the first few days, but there's a tail of people who apparently
> have update problems or insufficient rights.
>
> We're hoping to ship 2.0.0.1 mid December. Will the server be changed over by
> then?
After some more discussion, it seems to make more sense for the client to try both (check the table for the normalized and the non-normalized url). That way we don't need to try to sync the client with the server. The servers will make the switch some time after 2.0.0.1 ships.
I'll have an updated patch for this later today.

|  | [Jay Patel [:jay]](/user_profile?user_id=5564) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=356355#c21)• 18 years ago |
|  | |

Comment on [attachment 245614](/attachment.cgi?id=245614 "v2: patch for ff2 branch") [[details]](/attachment.cgi?id=245614&action=edit "v2: patch for ff2 branch") [[diff]](/attachment.cgi?id=245614&action=diff "v2: patch for ff2 branch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=356355&attachment=245614)
v2: patch for ff2 branch
Will wait for Tony's new patch, please request approval for that one.
[Attachment #245614](/attachment.cgi?id=245614&action=edit "v2: patch for ff2 branch") -
Flags: approval1.8.1.1? → approval1.8.1.1-

|  | [Tony Chang (Google)](/user_profile?user_id=236963)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=356355#c22)• 18 years ago |
|  | |

Attached patch

[v4: check both old and new canonical form](attachment.cgi?id=246235&action=diff)
— [Details](attachment.cgi?id=246235&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=356355&attachment=246235)

Additional patch for trunk:
Check both the URL both using the original canonicalized form and the new form in local database lookups.
[Attachment #246235](/attachment.cgi?id=246235&action=edit "v4: check both old and new canonical form") -
Flags: review?(mmchew)

|  | [Doug Shelton](/user_profile?user_id=119724) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=356355#a3611981_119724)• 18 years ago |

Blocks: [361542](/show_bug.cgi?id=361542 "RESOLVED FIXED - [BeOS] Linking fails in toolkit/components")

|  | [Tony Chang (Google)](/user_profile?user_id=236963)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=356355#a3613005_236963)• 18 years ago |

No longer blocks: [361542](/show_bug.cgi?id=361542 "RESOLVED FIXED - [BeOS] Linking fails in toolkit/components")

|  | [Tony Chang (Google)](/user_profile?user_id=236963)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=356355#c23)• 18 years ago |
|  | |

Attached patch

[v3: cumulative patch for branch](attachment.cgi?id=246351&action=diff)
— [Details](attachment.cgi?id=246351&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=356355&attachment=246351)

[Attachment #245614](/attachment.cgi?id=245614&action=edit "v2: patch for ff2 branch") -
Attachment is obsolete: true
[Attachment #246351](/attachment.cgi?id=246351&action=edit "v3: cumulative patch for branch") -
Flags: review?(mmchew)

|  | [[:mmc] Monica Chew (no longer reading bugmail)](/user_profile?user_id=237291) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=356355#c24)• 18 years ago |
|  | |

Comment on [attachment 246351](/attachment.cgi?id=246351 "v3: cumulative patch for branch") [[details]](/attachment.cgi?id=246351&action=edit "v3: cumulative patch for branch") [[diff]](/attachment.cgi?id=246351&action=diff "v3: cumulative patch for branch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=356355&attachment=246351)
v3: cumulative patch for branch
Looks fine.
[Attachment #246351](/attachment.cgi?id=246351&action=edit "v3: cumulative patch for branch") -
Flags: review?(mmchew) → review+

|  | [[:mmc] Monica Chew (no longer reading bugmail)](/user_profile?user_id=237291) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=356355#c25)• 18 years ago |
|  | |

Comment on [attachment 246235](/attachment.cgi?id=246235 "v4: check both old and new canonical form") [[details]](/attachment.cgi?id=246235&action=edit "v4: check both old and new canonical form") [[diff]](/attachment.cgi?id=246235&action=diff "v4: check both old and new canonical form") [[review]](/page.cgi?id=splinter.html&ignore=&bug=356355&attachment=246235)
v4: check both old and new canonical form
LG
[Attachment #246235](/attachment.cgi?id=246235&action=edit "v4: check both old and new canonical form") -
Flags: review?(mmchew) → review+

|  | [Tony Chang (Google)](/user_profile?user_id=236963)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=356355#a3631004_236963)• 18 years ago |

[Attachment #246351](/attachment.cgi?id=246351&action=edit "v3: cumulative patch for branch") -
Flags: approval1.8.1.1?

|  | [Tony Chang (Google)](/user_profile?user_id=236963)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=356355#c26)• 18 years ago |
|  | |

patch v4: check both old and new canonical form
on trunk
Checking in trtable.js;
/cvsroot/mozilla/toolkit/components/url-classifier/content/trtable.js,v <-- trtable.js
new revision: 1.9; previous revision: 1.8

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=356355#c27)• 18 years ago |
|  | |

Comment on [attachment 246351](/attachment.cgi?id=246351 "v3: cumulative patch for branch") [[details]](/attachment.cgi?id=246351&action=edit "v3: cumulative patch for branch") [[diff]](/attachment.cgi?id=246351&action=diff "v3: cumulative patch for branch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=356355&attachment=246351)
v3: cumulative patch for branch
approved for 1.8 branch, a=dveditz for drivers
[Attachment #246351](/attachment.cgi?id=246351&action=edit "v3: cumulative patch for branch") -
Flags: approval1.8.1.1? → approval1.8.1.1+

|  | [Tony Chang (Google)](/user_profile?user_id=236963)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=356355#c28)• 18 years ago |
|  | |

on branchKeywords: [fixed1.8.1.1](/buglist.cgi?keywords=fixed1.8.1.1&resolution=---)

|  | [Benjamin Smedberg](/user_profile?user_id=7044) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=356355#c29)• 18 years ago |
|  | |

This patch landed in the toolkit without a unit test. Tree rules for the toolkit now require unit tests, please prepare a test for this bug.Flags: in-testsuite?

|  | [Tony Chang (Google)](/user_profile?user_id=236963)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=356355#c30)• 18 years ago |
|  | |

(In reply to [comment #29](/show_bug.cgi?id=356355#c29 "VERIFIED FIXED - numeric domain normalization only happens on enchash table values"))
> This patch landed in the toolkit without a unit test. Tree rules for the
> toolkit now require unit tests, please prepare a test for this bug.
How do I go about testing chrome JS? There are a bunch of tests[1], they're just not automated.
<https://bugzilla.mozilla.org/attachment.cgi?id=246351&action=diff#toolkit/components/url-classifier/content/enchash-decrypter.js_sec3>

|  | [Benjamin Smedberg](/user_profile?user_id=7044) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=356355#c31)• 18 years ago |
|  | |

I'm pretty sure we could use mochitest for this. <http://developer.mozilla.org/en/docs/Mochitest_FAQ> and ask sayrer ;-)

|  | [Chris Cooper [:coop] (he/him)](/user_profile?user_id=30066) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=356355#c32)• 18 years ago |
|  | |

Trying to verify this fix, but the browser doesn't seem to want to load any hex, octal, or decimal IP addresses.
For ref: Mozilla/5.0 (Macintosh; U; Intel Mac OS X; en-US; rv:1.8.1.1pre) Gecko/20061201 BonEcho/2.0.0.1pre
The listed examples long since fell off the net, so I went to phishtank.com and grabbed a new dotted quad phishing address for testing. I ended up using:
<http://210.21.119.127/sbcbconfirm/>
...which the anti-phishing correctly catches. However, when I try to load both:
<http://0xd2.0x15.0x77.0x7f/sbcbconfirm/>
<http://0322.025.0167.0177/sbcbconfirm/>
...the anti-phishing \_does\_ pop up the web forgery warning, but the pages themselves do not actually load.
<http://3524622207/sbcbconfirm/>
...doesn't even load, redirecting instead to <http://www.3524622207.com/sbcbconfirm/>
Are these numeric domains supposed to load?

|  | [Tony Chang (Google)](/user_profile?user_id=236963)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=356355#c33)• 18 years ago |
|  | |

(In reply to [comment #32](/show_bug.cgi?id=356355#c32 "VERIFIED FIXED - numeric domain normalization only happens on enchash table values"))
> However, when I try to load both:
>
> <http://0xd2.0x15.0x77.0x7f/sbcbconfirm/>
> <http://0322.025.0167.0177/sbcbconfirm/>
>
> ...the anti-phishing \_does\_ pop up the web forgery warning, but the pages
> themselves do not actually load.
>
> <http://3524622207/sbcbconfirm/>
>
> ...doesn't even load, redirecting instead to
> <http://www.3524622207.com/sbcbconfirm/>
>
> Are these numeric domains supposed to load?
Hmm, it looks like hex/dec domains only load on Windows. Not sure why they get renamed in linux/OSX.

|  | [Tony Chang (Google)](/user_profile?user_id=236963)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=356355#c34)• 18 years ago |
|  | |

Attached patch

[unittests](attachment.cgi?id=247594&action=diff)
— [Details](attachment.cgi?id=247594&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=356355&attachment=247594)

Patch to move unittests to mochitest framework.

|  | [Tony Chang (Google)](/user_profile?user_id=236963)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=356355#c35)• 18 years ago |
|  | |

Tests on trunk.
Checking in testing/mochitest/tests/index.html;
/cvsroot/mozilla/testing/mochitest/tests/index.html,v <-- index.html
new revision: 1.47; previous revision: 1.46
done
RCS file: /cvsroot/mozilla/testing/mochitest/tests/test\_bug356355.xhtml,v
done
Checking in testing/mochitest/tests/test\_bug356355.xhtml;
/cvsroot/mozilla/testing/mochitest/tests/test\_bug356355.xhtml,v <-- test\_bug356355.xhtml
initial revision: 1.1
done
Checking in toolkit/components/url-classifier/content/enchash-decrypter.js;
/cvsroot/mozilla/toolkit/components/url-classifier/content/enchash-decrypter.js,v <-- enchash-decrypter.js
new revision: 1.7; previous revision: 1.6
done
Checking in toolkit/components/url-classifier/content/trtable.js;
/cvsroot/mozilla/toolkit/components/url-classifier/content/trtable.js,v <-- trtable.js
new revision: 1.12; previous revision: 1.11
done
Checking in toolkit/components/url-classifier/content/url-canonicalizer.js;
/cvsroot/mozilla/toolkit/components/url-classifier/content/url-canonicalizer.js,v <-- url-canonicalizer.js
new revision: 1.5; previous revision: 1.4
done

|  | [:Gavin Sharp [email: gavin@gavinsharp.com]](/user_profile?user_id=103593) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=356355#a4751432_103593)• 18 years ago |

Flags: in-testsuite? → in-testsuite+

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=356355#c36)• 15 years ago |
|  | |

I'm guessing QAWANTED is no longer needed on this bug?

|  | [Aakash Desai [:aakashd]](/user_profile?user_id=339035) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=356355#c37)• 15 years ago |
|  | |

It's not needed anymore as the qawanted flag was set back by [comment #17](/show_bug.cgi?id=356355#c17 "VERIFIED FIXED - numeric domain normalization only happens on enchash table values") before the patch landed on branch. Also, I'm verifying this due to the number of unit tests in mochitest that have been there since 2006 per [comment #35](/show_bug.cgi?id=356355#c35 "VERIFIED FIXED - numeric domain normalization only happens on enchash table values").Status: RESOLVED → VERIFIEDKeywords: [qawanted](/buglist.cgi?keywords=qawanted&resolution=---)

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=356355#a240607574_1)• 11 years ago |

Product: Firefox → Toolkit
You need to [log in](/show_bug.cgi?id=356355&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Tony Chang (Google)](/user_profile?user_id=236963)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


